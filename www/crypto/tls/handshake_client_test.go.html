<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7423668">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7423723">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7423777">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7423828">package</span>&nbsp;<span class="ident" id="7423836">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7423841">import</span>&nbsp;<span class="op" id="7423848">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423851">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423860">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423876">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423890">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423905">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423921">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423928">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423934">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423941">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423947">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423958">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423975">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423986">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423997">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7424004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7424007">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7424082">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7424098">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7424175">type</span>&nbsp;<span class="ident" id="7424180">blockingSource</span>&nbsp;<span class="keyword" id="7424195">chan</span>&nbsp;<span class="builtintype" id="7424200">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7424206">func</span>&nbsp;<span class="op" id="7424211">(</span><span class="ident" id="7424212">b</span>&nbsp;<span class="ident" id="7424214"><a href="/crypto/tls/handshake_client_test.go.html#7424180">blockingSource</a></span><span class="op" id="7424228">)</span>&nbsp;<span class="ident" id="7424230">Read</span><span class="op" id="7424234">(</span><span class="op" id="7424235">[</span><span class="op" id="7424236">]</span><span class="builtintype" id="7424237">byte</span><span class="op" id="7424241">)</span>&nbsp;<span class="op" id="7424243">(</span><span class="ident" id="7424244">n</span>&nbsp;<span class="builtintype" id="7424246">int</span><span class="op" id="7424249">,</span>&nbsp;<span class="ident" id="7424251">err</span>&nbsp;<span class="builtintype" id="7424255">error</span><span class="op" id="7424260">)</span>&nbsp;<span class="op" id="7424262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7424265">&lt;-</span><span class="ident" id="7424267"><a href="/crypto/tls/handshake_client_test.go.html#7424212">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7424270">return</span>&nbsp;<span class="num" id="7424277">0</span><span class="op" id="7424278">,</span>&nbsp;<span class="ident" id="7424280"><a href="/crypto/tls/handshake_client_test.go.html#7423928">io</a></span><span class="op" id="7424282">.</span><span class="ident" id="7424283">EOF</span><br>
<span class="lineno"></span><span class="op" id="7424287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7424290">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7424370">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7424389">type</span>&nbsp;<span class="ident" id="7424394">clientTest</span>&nbsp;<span class="keyword" id="7424405">struct</span>&nbsp;<span class="op" id="7424412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424415">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424488">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7424529">name</span>&nbsp;<span class="builtintype" id="7424534">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424542">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424608">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7424653">command</span>&nbsp;<span class="op" id="7424661">[</span><span class="op" id="7424662">]</span><span class="builtintype" id="7424663">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424671">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7424742">config</span>&nbsp;<span class="op" id="7424749">*</span><span class="ident" id="7424750"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424758">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424825">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7424847">cert</span>&nbsp;<span class="op" id="7424852">[</span><span class="op" id="7424853">]</span><span class="builtintype" id="7424854">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424860">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7424918">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7424991">key</span>&nbsp;<span class="keyword" id="7424995">interface</span><span class="op" id="7425004">{</span><span class="op" id="7425005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7425008">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7425077">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7425147">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425197">validate</span>&nbsp;<span class="keyword" id="7425206">func</span><span class="op" id="7425210">(</span><span class="ident" id="7425211"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7425226">)</span>&nbsp;<span class="builtintype" id="7425228">error</span><br>
<span class="lineno"></span><span class="op" id="7425234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7425237">var</span>&nbsp;<span class="ident" id="7425241">defaultServerCommand</span>&nbsp;<span class="op" id="7425262">=</span>&nbsp;<span class="op" id="7425264">[</span><span class="op" id="7425265">]</span><span class="builtintype" id="7425266">string</span><span class="op" id="7425272">{</span><span class="string" id="7425273">&#34;openssl&#34;</span><span class="op" id="7425282">,</span>&nbsp;<span class="string" id="7425284">&#34;s_server&#34;</span><span class="op" id="7425294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7425297">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7425372">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7425447">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7425526">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7425548">func</span>&nbsp;<span class="op" id="7425553">(</span><span class="ident" id="7425554">test</span>&nbsp;<span class="op" id="7425559">*</span><span class="ident" id="7425560"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7425570">)</span>&nbsp;<span class="ident" id="7425572">connFromCommand</span><span class="op" id="7425587">(</span><span class="op" id="7425588">)</span>&nbsp;<span class="op" id="7425590">(</span><span class="ident" id="7425591">conn</span>&nbsp;<span class="op" id="7425596">*</span><span class="ident" id="7425597"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7425610">,</span>&nbsp;<span class="ident" id="7425612">child</span>&nbsp;<span class="op" id="7425618">*</span><span class="ident" id="7425619"><a href="/crypto/tls/handshake_client_test.go.html#7423947">exec</a></span><span class="op" id="7425623">.</span><span class="ident" id="7425624">Cmd</span><span class="op" id="7425627">,</span>&nbsp;<span class="ident" id="7425629">stdin</span>&nbsp;<span class="ident" id="7425635"><a href="/crypto/tls/handshake_client_test.go.html#7424180">blockingSource</a></span><span class="op" id="7425649">,</span>&nbsp;<span class="ident" id="7425651">err</span>&nbsp;<span class="builtintype" id="7425655">error</span><span class="op" id="7425660">)</span>&nbsp;<span class="op" id="7425662">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425665">cert</span>&nbsp;<span class="op" id="7425670">:=</span>&nbsp;<span class="ident" id="7425673"><a href="/crypto/tls/handshake_server_test.go.html#7469490">testRSACertificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425693">if</span>&nbsp;<span class="builtinfunc" id="7425696">len</span><span class="op" id="7425699">(</span><span class="ident" id="7425700"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7425704">.</span><span class="ident" id="7425705">cert</span><span class="op" id="7425709">)</span>&nbsp;<span class="op" id="7425711">&gt;</span>&nbsp;<span class="num" id="7425713">0</span>&nbsp;<span class="op" id="7425715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425719"><a href="/crypto/tls/handshake_client_test.go.html#7425665">cert</a></span>&nbsp;<span class="op" id="7425724">=</span>&nbsp;<span class="ident" id="7425726"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7425730">.</span><span class="ident" id="7425731">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7425737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425740">certPath</span>&nbsp;<span class="op" id="7425749">:=</span>&nbsp;<span class="ident" id="7425752"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7425760">(</span><span class="builtintype" id="7425761">string</span><span class="op" id="7425767">(</span><span class="ident" id="7425768"><a href="/crypto/tls/handshake_client_test.go.html#7425665">cert</a></span><span class="op" id="7425772">)</span><span class="op" id="7425773">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425776">defer</span>&nbsp;<span class="ident" id="7425782"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7425784">.</span><span class="ident" id="7425785">Remove</span><span class="op" id="7425791">(</span><span class="ident" id="7425792"><a href="/crypto/tls/handshake_client_test.go.html#7425740">certPath</a></span><span class="op" id="7425800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425804">var</span>&nbsp;<span class="ident" id="7425808">key</span>&nbsp;<span class="keyword" id="7425812">interface</span><span class="op" id="7425821">{</span><span class="op" id="7425822">}</span>&nbsp;<span class="op" id="7425824">=</span>&nbsp;<span class="ident" id="7425826"><a href="/crypto/tls/handshake_server_test.go.html#7473026">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425845">if</span>&nbsp;<span class="ident" id="7425848"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7425852">.</span><span class="ident" id="7425853">key</span>&nbsp;<span class="op" id="7425857">!=</span>&nbsp;<span class="ident" id="7425860">nil</span>&nbsp;<span class="op" id="7425864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425868"><a href="/crypto/tls/handshake_client_test.go.html#7425808">key</a></span>&nbsp;<span class="op" id="7425872">=</span>&nbsp;<span class="ident" id="7425874"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7425878">.</span><span class="ident" id="7425879">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7425884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425887">var</span>&nbsp;<span class="ident" id="7425891">pemType</span>&nbsp;<span class="builtintype" id="7425899">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425907">var</span>&nbsp;<span class="ident" id="7425911">derBytes</span>&nbsp;<span class="op" id="7425920">[</span><span class="op" id="7425921">]</span><span class="builtintype" id="7425922">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425928">switch</span>&nbsp;<span class="ident" id="7425935">key</span>&nbsp;<span class="op" id="7425939">:=</span>&nbsp;<span class="ident" id="7425942"><a href="/crypto/tls/handshake_client_test.go.html#7425808">key</a></span><span class="op" id="7425945">.</span><span class="op" id="7425946">(</span><span class="keyword" id="7425947">type</span><span class="op" id="7425951">)</span>&nbsp;<span class="op" id="7425953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7425956">case</span>&nbsp;<span class="op" id="7425961">*</span><span class="ident" id="7425962"><a href="/crypto/tls/handshake_client_test.go.html#7423876">rsa</a></span><span class="op" id="7425965">.</span><span class="ident" id="7425966">PrivateKey</span><span class="op" id="7425976">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425980"><a href="/crypto/tls/handshake_client_test.go.html#7425891">pemType</a></span>&nbsp;<span class="op" id="7425988">=</span>&nbsp;<span class="string" id="7425990">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7425998"><a href="/crypto/tls/handshake_client_test.go.html#7425911">derBytes</a></span>&nbsp;<span class="op" id="7426007">=</span>&nbsp;<span class="ident" id="7426009"><a href="/crypto/tls/handshake_client_test.go.html#7423890">x509</a></span><span class="op" id="7426013">.</span><span class="ident" id="7426014">MarshalPKCS1PrivateKey</span><span class="op" id="7426036">(</span><span class="ident" id="7426037"><a href="/crypto/tls/handshake_client_test.go.html#7425935">key</a></span><span class="op" id="7426040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426043">case</span>&nbsp;<span class="op" id="7426048">*</span><span class="ident" id="7426049"><a href="/crypto/tls/handshake_client_test.go.html#7423860">ecdsa</a></span><span class="op" id="7426054">.</span><span class="ident" id="7426055">PrivateKey</span><span class="op" id="7426065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426069"><a href="/crypto/tls/handshake_client_test.go.html#7425891">pemType</a></span>&nbsp;<span class="op" id="7426077">=</span>&nbsp;<span class="string" id="7426079">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426086">var</span>&nbsp;<span class="ident" id="7426090">err</span>&nbsp;<span class="builtintype" id="7426094">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426102"><a href="/crypto/tls/handshake_client_test.go.html#7425911">derBytes</a></span><span class="op" id="7426110">,</span>&nbsp;<span class="ident" id="7426112"><a href="/crypto/tls/handshake_client_test.go.html#7426090">err</a></span>&nbsp;<span class="op" id="7426116">=</span>&nbsp;<span class="ident" id="7426118"><a href="/crypto/tls/handshake_client_test.go.html#7423890">x509</a></span><span class="op" id="7426122">.</span><span class="ident" id="7426123">MarshalECPrivateKey</span><span class="op" id="7426142">(</span><span class="ident" id="7426143"><a href="/crypto/tls/handshake_client_test.go.html#7425935">key</a></span><span class="op" id="7426146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426150">if</span>&nbsp;<span class="ident" id="7426153"><a href="/crypto/tls/handshake_client_test.go.html#7426090">err</a></span>&nbsp;<span class="op" id="7426157">!=</span>&nbsp;<span class="ident" id="7426160">nil</span>&nbsp;<span class="op" id="7426164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7426169">panic</span><span class="op" id="7426174">(</span><span class="ident" id="7426175"><a href="/crypto/tls/handshake_client_test.go.html#7426090">err</a></span><span class="op" id="7426178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7426182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426185">default</span><span class="op" id="7426192">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7426196">panic</span><span class="op" id="7426201">(</span><span class="string" id="7426202">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7426220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7426223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426227">var</span>&nbsp;<span class="ident" id="7426231">pemOut</span>&nbsp;<span class="ident" id="7426238"><a href="/crypto/tls/handshake_client_test.go.html#7423851">bytes</a></span><span class="op" id="7426243">.</span><span class="ident" id="7426244">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426252"><a href="/crypto/tls/handshake_client_test.go.html#7423905">pem</a></span><span class="op" id="7426255">.</span><span class="ident" id="7426256">Encode</span><span class="op" id="7426262">(</span><span class="op" id="7426263">&amp;</span><span class="ident" id="7426264"><a href="/crypto/tls/handshake_client_test.go.html#7426231">pemOut</a></span><span class="op" id="7426270">,</span>&nbsp;<span class="op" id="7426272">&amp;</span><span class="ident" id="7426273"><a href="/crypto/tls/handshake_client_test.go.html#7423905">pem</a></span><span class="op" id="7426276">.</span><span class="ident" id="7426277">Block</span><span class="op" id="7426282">{</span><span class="ident" id="7426283">Type</span><span class="op" id="7426287">:</span>&nbsp;<span class="ident" id="7426289"><a href="/crypto/tls/handshake_client_test.go.html#7425891">pemType</a></span>&nbsp;<span class="op" id="7426297">+</span>&nbsp;<span class="string" id="7426299">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7426313">,</span>&nbsp;<span class="ident" id="7426315">Bytes</span><span class="op" id="7426320">:</span>&nbsp;<span class="ident" id="7426322"><a href="/crypto/tls/handshake_client_test.go.html#7425911">derBytes</a></span><span class="op" id="7426330">}</span><span class="op" id="7426331">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426335">keyPath</span>&nbsp;<span class="op" id="7426343">:=</span>&nbsp;<span class="ident" id="7426346"><a href="/crypto/tls/handshake_test.go.html#7478903">tempFile</a></span><span class="op" id="7426354">(</span><span class="builtintype" id="7426355">string</span><span class="op" id="7426361">(</span><span class="ident" id="7426362"><a href="/crypto/tls/handshake_client_test.go.html#7426231">pemOut</a></span><span class="op" id="7426368">.</span><span class="ident" id="7426369">Bytes</span><span class="op" id="7426374">(</span><span class="op" id="7426375">)</span><span class="op" id="7426376">)</span><span class="op" id="7426377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426380">defer</span>&nbsp;<span class="ident" id="7426386"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7426388">.</span><span class="ident" id="7426389">Remove</span><span class="op" id="7426395">(</span><span class="ident" id="7426396"><a href="/crypto/tls/handshake_client_test.go.html#7426335">keyPath</a></span><span class="op" id="7426403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426407">var</span>&nbsp;<span class="ident" id="7426411">command</span>&nbsp;<span class="op" id="7426419">[</span><span class="op" id="7426420">]</span><span class="builtintype" id="7426421">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426429">if</span>&nbsp;<span class="builtinfunc" id="7426432">len</span><span class="op" id="7426435">(</span><span class="ident" id="7426436"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7426440">.</span><span class="ident" id="7426441">command</span><span class="op" id="7426448">)</span>&nbsp;<span class="op" id="7426450">&gt;</span>&nbsp;<span class="num" id="7426452">0</span>&nbsp;<span class="op" id="7426454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426458"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span>&nbsp;<span class="op" id="7426466">=</span>&nbsp;<span class="builtinfunc" id="7426468">append</span><span class="op" id="7426474">(</span><span class="ident" id="7426475"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7426482">,</span>&nbsp;<span class="ident" id="7426484"><a href="/crypto/tls/handshake_client_test.go.html#7425554">test</a></span><span class="op" id="7426488">.</span><span class="ident" id="7426489">command</span><span class="op" id="7426496">...</span><span class="op" id="7426499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7426502">}</span>&nbsp;<span class="keyword" id="7426504">else</span>&nbsp;<span class="op" id="7426509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426513"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span>&nbsp;<span class="op" id="7426521">=</span>&nbsp;<span class="builtinfunc" id="7426523">append</span><span class="op" id="7426529">(</span><span class="ident" id="7426530"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7426537">,</span>&nbsp;<span class="ident" id="7426539"><a href="/crypto/tls/handshake_client_test.go.html#7425241">defaultServerCommand</a></span><span class="op" id="7426559">...</span><span class="op" id="7426562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7426565">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426568"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span>&nbsp;<span class="op" id="7426576">=</span>&nbsp;<span class="builtinfunc" id="7426578">append</span><span class="op" id="7426584">(</span><span class="ident" id="7426585"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7426592">,</span>&nbsp;<span class="string" id="7426594">&#34;-cert&#34;</span><span class="op" id="7426601">,</span>&nbsp;<span class="ident" id="7426603"><a href="/crypto/tls/handshake_client_test.go.html#7425740">certPath</a></span><span class="op" id="7426611">,</span>&nbsp;<span class="string" id="7426613">&#34;-certform&#34;</span><span class="op" id="7426624">,</span>&nbsp;<span class="string" id="7426626">&#34;DER&#34;</span><span class="op" id="7426631">,</span>&nbsp;<span class="string" id="7426633">&#34;-key&#34;</span><span class="op" id="7426639">,</span>&nbsp;<span class="ident" id="7426641"><a href="/crypto/tls/handshake_client_test.go.html#7426335">keyPath</a></span><span class="op" id="7426648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7426651">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7426721">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7426792">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7426861">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7426930">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7426960">const</span>&nbsp;<span class="ident" id="7426966">serverPort</span>&nbsp;<span class="op" id="7426977">=</span>&nbsp;<span class="num" id="7426979">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7426986"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span>&nbsp;<span class="op" id="7426994">=</span>&nbsp;<span class="builtinfunc" id="7426996">append</span><span class="op" id="7427002">(</span><span class="ident" id="7427003"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7427010">,</span>&nbsp;<span class="string" id="7427012">&#34;-accept&#34;</span><span class="op" id="7427021">,</span>&nbsp;<span class="ident" id="7427023"><a href="/crypto/tls/handshake_client_test.go.html#7423975">strconv</a></span><span class="op" id="7427030">.</span><span class="ident" id="7427031">Itoa</span><span class="op" id="7427035">(</span><span class="ident" id="7427036"><a href="/crypto/tls/handshake_client_test.go.html#7426966">serverPort</a></span><span class="op" id="7427046">)</span><span class="op" id="7427047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427051">cmd</span>&nbsp;<span class="op" id="7427055">:=</span>&nbsp;<span class="ident" id="7427058"><a href="/crypto/tls/handshake_client_test.go.html#7423947">exec</a></span><span class="op" id="7427062">.</span><span class="ident" id="7427063">Command</span><span class="op" id="7427070">(</span><span class="ident" id="7427071"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7427078">[</span><span class="num" id="7427079">0</span><span class="op" id="7427080">]</span><span class="op" id="7427081">,</span>&nbsp;<span class="ident" id="7427083"><a href="/crypto/tls/handshake_client_test.go.html#7426411">command</a></span><span class="op" id="7427090">[</span><span class="num" id="7427091">1</span><span class="op" id="7427092">:</span><span class="op" id="7427093">]</span><span class="op" id="7427094">...</span><span class="op" id="7427097">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427100"><a href="/crypto/tls/handshake_client_test.go.html#7425629">stdin</a></span>&nbsp;<span class="op" id="7427106">=</span>&nbsp;<span class="ident" id="7427108"><a href="/crypto/tls/handshake_client_test.go.html#7424180">blockingSource</a></span><span class="op" id="7427122">(</span><span class="builtinfunc" id="7427123">make</span><span class="op" id="7427127">(</span><span class="keyword" id="7427128">chan</span>&nbsp;<span class="builtintype" id="7427133">bool</span><span class="op" id="7427137">)</span><span class="op" id="7427138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427141"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427144">.</span><span class="ident" id="7427145">Stdin</span>&nbsp;<span class="op" id="7427151">=</span>&nbsp;<span class="ident" id="7427153"><a href="/crypto/tls/handshake_client_test.go.html#7425629">stdin</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427160">var</span>&nbsp;<span class="ident" id="7427164">out</span>&nbsp;<span class="ident" id="7427168"><a href="/crypto/tls/handshake_client_test.go.html#7423851">bytes</a></span><span class="op" id="7427173">.</span><span class="ident" id="7427174">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427182"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427185">.</span><span class="ident" id="7427186">Stdout</span>&nbsp;<span class="op" id="7427193">=</span>&nbsp;<span class="op" id="7427195">&amp;</span><span class="ident" id="7427196"><a href="/crypto/tls/handshake_client_test.go.html#7427164">out</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427201"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427204">.</span><span class="ident" id="7427205">Stderr</span>&nbsp;<span class="op" id="7427212">=</span>&nbsp;<span class="op" id="7427214">&amp;</span><span class="ident" id="7427215"><a href="/crypto/tls/handshake_client_test.go.html#7427164">out</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427220">if</span>&nbsp;<span class="ident" id="7427223">err</span>&nbsp;<span class="op" id="7427227">:=</span>&nbsp;<span class="ident" id="7427230"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427233">.</span><span class="ident" id="7427234">Start</span><span class="op" id="7427239">(</span><span class="op" id="7427240">)</span><span class="op" id="7427241">;</span>&nbsp;<span class="ident" id="7427243"><a href="/crypto/tls/handshake_client_test.go.html#7427223">err</a></span>&nbsp;<span class="op" id="7427247">!=</span>&nbsp;<span class="ident" id="7427250">nil</span>&nbsp;<span class="op" id="7427254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427258">return</span>&nbsp;<span class="ident" id="7427265">nil</span><span class="op" id="7427268">,</span>&nbsp;<span class="ident" id="7427270">nil</span><span class="op" id="7427273">,</span>&nbsp;<span class="ident" id="7427275">nil</span><span class="op" id="7427278">,</span>&nbsp;<span class="ident" id="7427280"><a href="/crypto/tls/handshake_client_test.go.html#7427223">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7427289">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7427356">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7427428">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7427497">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427513">var</span>&nbsp;<span class="ident" id="7427517">tcpConn</span>&nbsp;<span class="ident" id="7427525"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7427528">.</span><span class="ident" id="7427529">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427535">for</span>&nbsp;<span class="ident" id="7427539">i</span>&nbsp;<span class="op" id="7427541">:=</span>&nbsp;<span class="builtintype" id="7427544">uint</span><span class="op" id="7427548">(</span><span class="num" id="7427549">0</span><span class="op" id="7427550">)</span><span class="op" id="7427551">;</span>&nbsp;<span class="ident" id="7427553"><a href="/crypto/tls/handshake_client_test.go.html#7427539">i</a></span>&nbsp;<span class="op" id="7427555">&lt;</span>&nbsp;<span class="num" id="7427557">5</span><span class="op" id="7427558">;</span>&nbsp;<span class="ident" id="7427560"><a href="/crypto/tls/handshake_client_test.go.html#7427539">i</a></span><span class="op" id="7427561">++</span>&nbsp;<span class="op" id="7427564">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427568">var</span>&nbsp;<span class="ident" id="7427572">err</span>&nbsp;<span class="builtintype" id="7427576">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427584"><a href="/crypto/tls/handshake_client_test.go.html#7427517">tcpConn</a></span><span class="op" id="7427591">,</span>&nbsp;<span class="ident" id="7427593"><a href="/crypto/tls/handshake_client_test.go.html#7427572">err</a></span>&nbsp;<span class="op" id="7427597">=</span>&nbsp;<span class="ident" id="7427599"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7427602">.</span><span class="ident" id="7427603">DialTCP</span><span class="op" id="7427610">(</span><span class="string" id="7427611">&#34;tcp&#34;</span><span class="op" id="7427616">,</span>&nbsp;<span class="ident" id="7427618">nil</span><span class="op" id="7427621">,</span>&nbsp;<span class="op" id="7427623">&amp;</span><span class="ident" id="7427624"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7427627">.</span><span class="ident" id="7427628">TCPAddr</span><span class="op" id="7427635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427640">IP</span><span class="op" id="7427642">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7427646"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7427649">.</span><span class="ident" id="7427650">IPv4</span><span class="op" id="7427654">(</span><span class="num" id="7427655">127</span><span class="op" id="7427658">,</span>&nbsp;<span class="num" id="7427660">0</span><span class="op" id="7427661">,</span>&nbsp;<span class="num" id="7427663">0</span><span class="op" id="7427664">,</span>&nbsp;<span class="num" id="7427666">1</span><span class="op" id="7427667">)</span><span class="op" id="7427668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427673">Port</span><span class="op" id="7427677">:</span>&nbsp;<span class="ident" id="7427679"><a href="/crypto/tls/handshake_client_test.go.html#7426966">serverPort</a></span><span class="op" id="7427689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427693">}</span><span class="op" id="7427694">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427698">if</span>&nbsp;<span class="ident" id="7427701"><a href="/crypto/tls/handshake_client_test.go.html#7427572">err</a></span>&nbsp;<span class="op" id="7427705">==</span>&nbsp;<span class="ident" id="7427708">nil</span>&nbsp;<span class="op" id="7427712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427717">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427729"><a href="/crypto/tls/handshake_client_test.go.html#7423997">time</a></span><span class="op" id="7427733">.</span><span class="ident" id="7427734">Sleep</span><span class="op" id="7427739">(</span><span class="op" id="7427740">(</span><span class="num" id="7427741">1</span>&nbsp;<span class="op" id="7427743">&lt;&lt;</span>&nbsp;<span class="ident" id="7427746"><a href="/crypto/tls/handshake_client_test.go.html#7427539">i</a></span><span class="op" id="7427747">)</span>&nbsp;<span class="op" id="7427749">*</span>&nbsp;<span class="num" id="7427751">5</span>&nbsp;<span class="op" id="7427753">*</span>&nbsp;<span class="ident" id="7427755"><a href="/crypto/tls/handshake_client_test.go.html#7423997">time</a></span><span class="op" id="7427759">.</span><span class="ident" id="7427760">Millisecond</span><span class="op" id="7427771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427774">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427777">if</span>&nbsp;<span class="ident" id="7427780"><a href="/crypto/tls/handshake_client_test.go.html#7427517">tcpConn</a></span>&nbsp;<span class="op" id="7427788">==</span>&nbsp;<span class="ident" id="7427791">nil</span>&nbsp;<span class="op" id="7427795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7427799">close</span><span class="op" id="7427804">(</span><span class="ident" id="7427805"><a href="/crypto/tls/handshake_client_test.go.html#7425629">stdin</a></span><span class="op" id="7427810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427814"><a href="/crypto/tls/handshake_client_test.go.html#7427164">out</a></span><span class="op" id="7427817">.</span><span class="ident" id="7427818">WriteTo</span><span class="op" id="7427825">(</span><span class="ident" id="7427826"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7427828">.</span><span class="ident" id="7427829">Stdout</span><span class="op" id="7427835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427839"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427842">.</span><span class="ident" id="7427843">Process</span><span class="op" id="7427850">.</span><span class="ident" id="7427851">Kill</span><span class="op" id="7427855">(</span><span class="op" id="7427856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427860">return</span>&nbsp;<span class="ident" id="7427867">nil</span><span class="op" id="7427870">,</span>&nbsp;<span class="ident" id="7427872">nil</span><span class="op" id="7427875">,</span>&nbsp;<span class="ident" id="7427877">nil</span><span class="op" id="7427880">,</span>&nbsp;<span class="ident" id="7427882"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427885">.</span><span class="ident" id="7427886">Wait</span><span class="op" id="7427890">(</span><span class="op" id="7427891">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427898">record</span>&nbsp;<span class="op" id="7427905">:=</span>&nbsp;<span class="op" id="7427908">&amp;</span><span class="ident" id="7427909"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7427922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7427926">Conn</span><span class="op" id="7427930">:</span>&nbsp;<span class="ident" id="7427932"><a href="/crypto/tls/handshake_client_test.go.html#7427517">tcpConn</a></span><span class="op" id="7427939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7427942">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7427946">return</span>&nbsp;<span class="ident" id="7427953"><a href="/crypto/tls/handshake_client_test.go.html#7427898">record</a></span><span class="op" id="7427959">,</span>&nbsp;<span class="ident" id="7427961"><a href="/crypto/tls/handshake_client_test.go.html#7427051">cmd</a></span><span class="op" id="7427964">,</span>&nbsp;<span class="ident" id="7427966"><a href="/crypto/tls/handshake_client_test.go.html#7425629">stdin</a></span><span class="op" id="7427971">,</span>&nbsp;<span class="ident" id="7427973">nil</span><br>
<span class="lineno"></span><span class="op" id="7427977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7427980">func</span>&nbsp;<span class="op" id="7427985">(</span><span class="ident" id="7427986">test</span>&nbsp;<span class="op" id="7427991">*</span><span class="ident" id="7427992"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7428002">)</span>&nbsp;<span class="ident" id="7428004">dataPath</span><span class="op" id="7428012">(</span><span class="op" id="7428013">)</span>&nbsp;<span class="builtintype" id="7428015">string</span>&nbsp;<span class="op" id="7428022">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428025">return</span>&nbsp;<span class="ident" id="7428032"><a href="/crypto/tls/handshake_client_test.go.html#7423958">filepath</a></span><span class="op" id="7428040">.</span><span class="ident" id="7428041">Join</span><span class="op" id="7428045">(</span><span class="string" id="7428046">&#34;testdata&#34;</span><span class="op" id="7428056">,</span>&nbsp;<span class="string" id="7428058">&#34;Client-&#34;</span><span class="op" id="7428067">+</span><span class="ident" id="7428068"><a href="/crypto/tls/handshake_client_test.go.html#7427986">test</a></span><span class="op" id="7428072">.</span><span class="ident" id="7428073">name</span><span class="op" id="7428077">)</span><br>
<span class="lineno"></span><span class="op" id="7428079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7428082">func</span>&nbsp;<span class="op" id="7428087">(</span><span class="ident" id="7428088">test</span>&nbsp;<span class="op" id="7428093">*</span><span class="ident" id="7428094"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7428104">)</span>&nbsp;<span class="ident" id="7428106">loadData</span><span class="op" id="7428114">(</span><span class="op" id="7428115">)</span>&nbsp;<span class="op" id="7428117">(</span><span class="ident" id="7428118">flows</span>&nbsp;<span class="op" id="7428124">[</span><span class="op" id="7428125">]</span><span class="op" id="7428126">[</span><span class="op" id="7428127">]</span><span class="builtintype" id="7428128">byte</span><span class="op" id="7428132">,</span>&nbsp;<span class="ident" id="7428134">err</span>&nbsp;<span class="builtintype" id="7428138">error</span><span class="op" id="7428143">)</span>&nbsp;<span class="op" id="7428145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428148">in</span><span class="op" id="7428150">,</span>&nbsp;<span class="ident" id="7428152"><a href="/crypto/tls/handshake_client_test.go.html#7428134">err</a></span>&nbsp;<span class="op" id="7428156">:=</span>&nbsp;<span class="ident" id="7428159"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7428161">.</span><span class="ident" id="7428162">Open</span><span class="op" id="7428166">(</span><span class="ident" id="7428167"><a href="/crypto/tls/handshake_client_test.go.html#7428088">test</a></span><span class="op" id="7428171">.</span><span class="ident" id="7428172">dataPath</span><span class="op" id="7428180">(</span><span class="op" id="7428181">)</span><span class="op" id="7428182">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428185">if</span>&nbsp;<span class="ident" id="7428188"><a href="/crypto/tls/handshake_client_test.go.html#7428134">err</a></span>&nbsp;<span class="op" id="7428192">!=</span>&nbsp;<span class="ident" id="7428195">nil</span>&nbsp;<span class="op" id="7428199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428203">return</span>&nbsp;<span class="ident" id="7428210">nil</span><span class="op" id="7428213">,</span>&nbsp;<span class="ident" id="7428215"><a href="/crypto/tls/handshake_client_test.go.html#7428134">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428223">defer</span>&nbsp;<span class="ident" id="7428229"><a href="/crypto/tls/handshake_client_test.go.html#7428148">in</a></span><span class="op" id="7428231">.</span><span class="ident" id="7428232">Close</span><span class="op" id="7428237">(</span><span class="op" id="7428238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428241">return</span>&nbsp;<span class="ident" id="7428248"><a href="/crypto/tls/handshake_test.go.html#7477603">parseTestData</a></span><span class="op" id="7428261">(</span><span class="ident" id="7428262"><a href="/crypto/tls/handshake_client_test.go.html#7428148">in</a></span><span class="op" id="7428264">)</span><br>
<span class="lineno">165</span><span class="op" id="7428266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7428269">func</span>&nbsp;<span class="op" id="7428274">(</span><span class="ident" id="7428275">test</span>&nbsp;<span class="op" id="7428280">*</span><span class="ident" id="7428281"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7428291">)</span>&nbsp;<span class="ident" id="7428293">run</span><span class="op" id="7428296">(</span><span class="ident" id="7428297">t</span>&nbsp;<span class="op" id="7428299">*</span><span class="ident" id="7428300"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7428307">.</span><span class="ident" id="7428308">T</span><span class="op" id="7428309">,</span>&nbsp;<span class="ident" id="7428311">write</span>&nbsp;<span class="builtintype" id="7428317">bool</span><span class="op" id="7428321">)</span>&nbsp;<span class="op" id="7428323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428326">var</span>&nbsp;<span class="ident" id="7428330">clientConn</span><span class="op" id="7428340">,</span>&nbsp;<span class="ident" id="7428342">serverConn</span>&nbsp;<span class="ident" id="7428353"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7428356">.</span><span class="ident" id="7428357">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428363">var</span>&nbsp;<span class="ident" id="7428367">recordingConn</span>&nbsp;<span class="op" id="7428381">*</span><span class="ident" id="7428382"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428397">var</span>&nbsp;<span class="ident" id="7428401">childProcess</span>&nbsp;<span class="op" id="7428414">*</span><span class="ident" id="7428415"><a href="/crypto/tls/handshake_client_test.go.html#7423947">exec</a></span><span class="op" id="7428419">.</span><span class="ident" id="7428420">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428425">var</span>&nbsp;<span class="ident" id="7428429">stdin</span>&nbsp;<span class="ident" id="7428435"><a href="/crypto/tls/handshake_client_test.go.html#7424180">blockingSource</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428452">if</span>&nbsp;<span class="ident" id="7428455"><a href="/crypto/tls/handshake_client_test.go.html#7428311">write</a></span>&nbsp;<span class="op" id="7428461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428465">var</span>&nbsp;<span class="ident" id="7428469">err</span>&nbsp;<span class="builtintype" id="7428473">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428481"><a href="/crypto/tls/handshake_client_test.go.html#7428367">recordingConn</a></span><span class="op" id="7428494">,</span>&nbsp;<span class="ident" id="7428496"><a href="/crypto/tls/handshake_client_test.go.html#7428401">childProcess</a></span><span class="op" id="7428508">,</span>&nbsp;<span class="ident" id="7428510"><a href="/crypto/tls/handshake_client_test.go.html#7428429">stdin</a></span><span class="op" id="7428515">,</span>&nbsp;<span class="ident" id="7428517"><a href="/crypto/tls/handshake_client_test.go.html#7428469">err</a></span>&nbsp;<span class="op" id="7428521">=</span>&nbsp;<span class="ident" id="7428523"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7428527">.</span><span class="ident" id="7428528">connFromCommand</span><span class="op" id="7428543">(</span><span class="op" id="7428544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428548">if</span>&nbsp;<span class="ident" id="7428551"><a href="/crypto/tls/handshake_client_test.go.html#7428469">err</a></span>&nbsp;<span class="op" id="7428555">!=</span>&nbsp;<span class="ident" id="7428558">nil</span>&nbsp;<span class="op" id="7428562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428567"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7428568">.</span><span class="ident" id="7428569">Fatalf</span><span class="op" id="7428575">(</span><span class="string" id="7428576">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7428608">,</span>&nbsp;<span class="ident" id="7428610"><a href="/crypto/tls/handshake_client_test.go.html#7428469">err</a></span><span class="op" id="7428613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428621"><a href="/crypto/tls/handshake_client_test.go.html#7428330">clientConn</a></span>&nbsp;<span class="op" id="7428632">=</span>&nbsp;<span class="ident" id="7428634"><a href="/crypto/tls/handshake_client_test.go.html#7428367">recordingConn</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428649">}</span>&nbsp;<span class="keyword" id="7428651">else</span>&nbsp;<span class="op" id="7428656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428660"><a href="/crypto/tls/handshake_client_test.go.html#7428330">clientConn</a></span><span class="op" id="7428670">,</span>&nbsp;<span class="ident" id="7428672"><a href="/crypto/tls/handshake_client_test.go.html#7428342">serverConn</a></span>&nbsp;<span class="op" id="7428683">=</span>&nbsp;<span class="ident" id="7428685"><a href="/crypto/tls/handshake_client_test.go.html#7423934">net</a></span><span class="op" id="7428688">.</span><span class="ident" id="7428689">Pipe</span><span class="op" id="7428693">(</span><span class="op" id="7428694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428701">config</span>&nbsp;<span class="op" id="7428708">:=</span>&nbsp;<span class="ident" id="7428711"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7428715">.</span><span class="ident" id="7428716">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428724">if</span>&nbsp;<span class="ident" id="7428727"><a href="/crypto/tls/handshake_client_test.go.html#7428701">config</a></span>&nbsp;<span class="op" id="7428734">==</span>&nbsp;<span class="ident" id="7428737">nil</span>&nbsp;<span class="op" id="7428741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428745"><a href="/crypto/tls/handshake_client_test.go.html#7428701">config</a></span>&nbsp;<span class="op" id="7428752">=</span>&nbsp;<span class="ident" id="7428754"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428769">client</span>&nbsp;<span class="op" id="7428776">:=</span>&nbsp;<span class="ident" id="7428779"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="7428785">(</span><span class="ident" id="7428786"><a href="/crypto/tls/handshake_client_test.go.html#7428330">clientConn</a></span><span class="op" id="7428796">,</span>&nbsp;<span class="ident" id="7428798"><a href="/crypto/tls/handshake_client_test.go.html#7428701">config</a></span><span class="op" id="7428804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428808">doneChan</span>&nbsp;<span class="op" id="7428817">:=</span>&nbsp;<span class="builtinfunc" id="7428820">make</span><span class="op" id="7428824">(</span><span class="keyword" id="7428825">chan</span>&nbsp;<span class="builtintype" id="7428830">bool</span><span class="op" id="7428834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428837">go</span>&nbsp;<span class="keyword" id="7428840">func</span><span class="op" id="7428844">(</span><span class="op" id="7428845">)</span>&nbsp;<span class="op" id="7428847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428851">if</span>&nbsp;<span class="ident" id="7428854">_</span><span class="op" id="7428855">,</span>&nbsp;<span class="ident" id="7428857">err</span>&nbsp;<span class="op" id="7428861">:=</span>&nbsp;<span class="ident" id="7428864"><a href="/crypto/tls/handshake_client_test.go.html#7428769">client</a></span><span class="op" id="7428870">.</span><span class="ident" id="7428871">Write</span><span class="op" id="7428876">(</span><span class="op" id="7428877">[</span><span class="op" id="7428878">]</span><span class="builtintype" id="7428879">byte</span><span class="op" id="7428883">(</span><span class="string" id="7428884">&#34;hello\n&#34;</span><span class="op" id="7428893">)</span><span class="op" id="7428894">)</span><span class="op" id="7428895">;</span>&nbsp;<span class="ident" id="7428897"><a href="/crypto/tls/handshake_client_test.go.html#7428857">err</a></span>&nbsp;<span class="op" id="7428901">!=</span>&nbsp;<span class="ident" id="7428904">nil</span>&nbsp;<span class="op" id="7428908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7428913"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7428914">.</span><span class="ident" id="7428915">Logf</span><span class="op" id="7428919">(</span><span class="string" id="7428920">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7428945">,</span>&nbsp;<span class="ident" id="7428947"><a href="/crypto/tls/handshake_client_test.go.html#7428857">err</a></span><span class="op" id="7428950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7428954">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428958">if</span>&nbsp;<span class="ident" id="7428961"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7428965">.</span><span class="ident" id="7428966">validate</span>&nbsp;<span class="op" id="7428975">!=</span>&nbsp;<span class="ident" id="7428978">nil</span>&nbsp;<span class="op" id="7428982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7428987">if</span>&nbsp;<span class="ident" id="7428990">err</span>&nbsp;<span class="op" id="7428994">:=</span>&nbsp;<span class="ident" id="7428997"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429001">.</span><span class="ident" id="7429002">validate</span><span class="op" id="7429010">(</span><span class="ident" id="7429011"><a href="/crypto/tls/handshake_client_test.go.html#7428769">client</a></span><span class="op" id="7429017">.</span><span class="ident" id="7429018">ConnectionState</span><span class="op" id="7429033">(</span><span class="op" id="7429034">)</span><span class="op" id="7429035">)</span><span class="op" id="7429036">;</span>&nbsp;<span class="ident" id="7429038"><a href="/crypto/tls/handshake_client_test.go.html#7428990">err</a></span>&nbsp;<span class="op" id="7429042">!=</span>&nbsp;<span class="ident" id="7429045">nil</span>&nbsp;<span class="op" id="7429049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429055"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7429056">.</span><span class="ident" id="7429057">Logf</span><span class="op" id="7429061">(</span><span class="string" id="7429062">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7429100">,</span>&nbsp;<span class="ident" id="7429102"><a href="/crypto/tls/handshake_client_test.go.html#7428990">err</a></span><span class="op" id="7429105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429114">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429118"><a href="/crypto/tls/handshake_client_test.go.html#7428769">client</a></span><span class="op" id="7429124">.</span><span class="ident" id="7429125">Close</span><span class="op" id="7429130">(</span><span class="op" id="7429131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429135"><a href="/crypto/tls/handshake_client_test.go.html#7428330">clientConn</a></span><span class="op" id="7429145">.</span><span class="ident" id="7429146">Close</span><span class="op" id="7429151">(</span><span class="op" id="7429152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429156"><a href="/crypto/tls/handshake_client_test.go.html#7428808">doneChan</a></span>&nbsp;<span class="op" id="7429165">&lt;-</span>&nbsp;<span class="builtintype" id="7429168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429174">}</span><span class="op" id="7429175">(</span><span class="op" id="7429176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429180">if</span>&nbsp;<span class="op" id="7429183">!</span><span class="ident" id="7429184"><a href="/crypto/tls/handshake_client_test.go.html#7428311">write</a></span>&nbsp;<span class="op" id="7429190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429194">flows</span><span class="op" id="7429199">,</span>&nbsp;<span class="ident" id="7429201">err</span>&nbsp;<span class="op" id="7429205">:=</span>&nbsp;<span class="ident" id="7429208"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429212">.</span><span class="ident" id="7429213">loadData</span><span class="op" id="7429221">(</span><span class="op" id="7429222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429226">if</span>&nbsp;<span class="ident" id="7429229"><a href="/crypto/tls/handshake_client_test.go.html#7429201">err</a></span>&nbsp;<span class="op" id="7429233">!=</span>&nbsp;<span class="ident" id="7429236">nil</span>&nbsp;<span class="op" id="7429240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429245"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7429246">.</span><span class="ident" id="7429247">Fatalf</span><span class="op" id="7429253">(</span><span class="string" id="7429254">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7429291">,</span>&nbsp;<span class="ident" id="7429293"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429297">.</span><span class="ident" id="7429298">name</span><span class="op" id="7429302">,</span>&nbsp;<span class="ident" id="7429304"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429308">.</span><span class="ident" id="7429309">dataPath</span><span class="op" id="7429317">(</span><span class="op" id="7429318">)</span><span class="op" id="7429319">,</span>&nbsp;<span class="ident" id="7429321"><a href="/crypto/tls/handshake_client_test.go.html#7429201">err</a></span><span class="op" id="7429324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429328">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429332">for</span>&nbsp;<span class="ident" id="7429336">i</span><span class="op" id="7429337">,</span>&nbsp;<span class="ident" id="7429339">b</span>&nbsp;<span class="op" id="7429341">:=</span>&nbsp;<span class="keyword" id="7429344">range</span>&nbsp;<span class="ident" id="7429350"><a href="/crypto/tls/handshake_client_test.go.html#7429194">flows</a></span>&nbsp;<span class="op" id="7429356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429361">if</span>&nbsp;<span class="ident" id="7429364"><a href="/crypto/tls/handshake_client_test.go.html#7429336">i</a></span><span class="op" id="7429365">%</span><span class="num" id="7429366">2</span>&nbsp;<span class="op" id="7429368">==</span>&nbsp;<span class="num" id="7429371">1</span>&nbsp;<span class="op" id="7429373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429379"><a href="/crypto/tls/handshake_client_test.go.html#7428342">serverConn</a></span><span class="op" id="7429389">.</span><span class="ident" id="7429390">Write</span><span class="op" id="7429395">(</span><span class="ident" id="7429396"><a href="/crypto/tls/handshake_client_test.go.html#7429339">b</a></span><span class="op" id="7429397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429403">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429415">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429420">bb</span>&nbsp;<span class="op" id="7429423">:=</span>&nbsp;<span class="builtinfunc" id="7429426">make</span><span class="op" id="7429430">(</span><span class="op" id="7429431">[</span><span class="op" id="7429432">]</span><span class="builtintype" id="7429433">byte</span><span class="op" id="7429437">,</span>&nbsp;<span class="builtinfunc" id="7429439">len</span><span class="op" id="7429442">(</span><span class="ident" id="7429443"><a href="/crypto/tls/handshake_client_test.go.html#7429339">b</a></span><span class="op" id="7429444">)</span><span class="op" id="7429445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429450">_</span><span class="op" id="7429451">,</span>&nbsp;<span class="ident" id="7429453">err</span>&nbsp;<span class="op" id="7429457">:=</span>&nbsp;<span class="ident" id="7429460"><a href="/crypto/tls/handshake_client_test.go.html#7423928">io</a></span><span class="op" id="7429462">.</span><span class="ident" id="7429463">ReadFull</span><span class="op" id="7429471">(</span><span class="ident" id="7429472"><a href="/crypto/tls/handshake_client_test.go.html#7428342">serverConn</a></span><span class="op" id="7429482">,</span>&nbsp;<span class="ident" id="7429484"><a href="/crypto/tls/handshake_client_test.go.html#7429420">bb</a></span><span class="op" id="7429486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429491">if</span>&nbsp;<span class="ident" id="7429494"><a href="/crypto/tls/handshake_client_test.go.html#7429453">err</a></span>&nbsp;<span class="op" id="7429498">!=</span>&nbsp;<span class="ident" id="7429501">nil</span>&nbsp;<span class="op" id="7429505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429511"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7429512">.</span><span class="ident" id="7429513">Fatalf</span><span class="op" id="7429519">(</span><span class="string" id="7429520">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7429532">,</span>&nbsp;<span class="ident" id="7429534"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429538">.</span><span class="ident" id="7429539">name</span><span class="op" id="7429543">,</span>&nbsp;<span class="ident" id="7429545"><a href="/crypto/tls/handshake_client_test.go.html#7429336">i</a></span><span class="op" id="7429546">,</span>&nbsp;<span class="ident" id="7429548"><a href="/crypto/tls/handshake_client_test.go.html#7429453">err</a></span><span class="op" id="7429551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429556">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429561">if</span>&nbsp;<span class="op" id="7429564">!</span><span class="ident" id="7429565"><a href="/crypto/tls/handshake_client_test.go.html#7423851">bytes</a></span><span class="op" id="7429570">.</span><span class="ident" id="7429571">Equal</span><span class="op" id="7429576">(</span><span class="ident" id="7429577"><a href="/crypto/tls/handshake_client_test.go.html#7429339">b</a></span><span class="op" id="7429578">,</span>&nbsp;<span class="ident" id="7429580"><a href="/crypto/tls/handshake_client_test.go.html#7429420">bb</a></span><span class="op" id="7429582">)</span>&nbsp;<span class="op" id="7429584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429590"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7429591">.</span><span class="ident" id="7429592">Fatalf</span><span class="op" id="7429598">(</span><span class="string" id="7429599">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7429641">,</span>&nbsp;<span class="ident" id="7429643"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429647">.</span><span class="ident" id="7429648">name</span><span class="op" id="7429652">,</span>&nbsp;<span class="ident" id="7429654"><a href="/crypto/tls/handshake_client_test.go.html#7429336">i</a></span><span class="op" id="7429655">,</span>&nbsp;<span class="ident" id="7429657"><a href="/crypto/tls/handshake_client_test.go.html#7429420">bb</a></span><span class="op" id="7429659">,</span>&nbsp;<span class="ident" id="7429661"><a href="/crypto/tls/handshake_client_test.go.html#7429339">b</a></span><span class="op" id="7429662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429675"><a href="/crypto/tls/handshake_client_test.go.html#7428342">serverConn</a></span><span class="op" id="7429685">.</span><span class="ident" id="7429686">Close</span><span class="op" id="7429691">(</span><span class="op" id="7429692">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429699">&lt;-</span><span class="ident" id="7429701"><a href="/crypto/tls/handshake_client_test.go.html#7428808">doneChan</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429712">if</span>&nbsp;<span class="ident" id="7429715"><a href="/crypto/tls/handshake_client_test.go.html#7428311">write</a></span>&nbsp;<span class="op" id="7429721">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429725">path</span>&nbsp;<span class="op" id="7429730">:=</span>&nbsp;<span class="ident" id="7429733"><a href="/crypto/tls/handshake_client_test.go.html#7428275">test</a></span><span class="op" id="7429737">.</span><span class="ident" id="7429738">dataPath</span><span class="op" id="7429746">(</span><span class="op" id="7429747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429751">out</span><span class="op" id="7429754">,</span>&nbsp;<span class="ident" id="7429756">err</span>&nbsp;<span class="op" id="7429760">:=</span>&nbsp;<span class="ident" id="7429763"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7429765">.</span><span class="ident" id="7429766">OpenFile</span><span class="op" id="7429774">(</span><span class="ident" id="7429775"><a href="/crypto/tls/handshake_client_test.go.html#7429725">path</a></span><span class="op" id="7429779">,</span>&nbsp;<span class="ident" id="7429781"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7429783">.</span><span class="ident" id="7429784">O_WRONLY</span><span class="op" id="7429792">|</span><span class="ident" id="7429793"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7429795">.</span><span class="ident" id="7429796">O_CREATE</span><span class="op" id="7429804">|</span><span class="ident" id="7429805"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7429807">.</span><span class="ident" id="7429808">O_TRUNC</span><span class="op" id="7429815">,</span>&nbsp;<span class="num" id="7429817">0644</span><span class="op" id="7429821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429825">if</span>&nbsp;<span class="ident" id="7429828"><a href="/crypto/tls/handshake_client_test.go.html#7429756">err</a></span>&nbsp;<span class="op" id="7429832">!=</span>&nbsp;<span class="ident" id="7429835">nil</span>&nbsp;<span class="op" id="7429839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429844"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7429845">.</span><span class="ident" id="7429846">Fatalf</span><span class="op" id="7429852">(</span><span class="string" id="7429853">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7429887">,</span>&nbsp;<span class="ident" id="7429889"><a href="/crypto/tls/handshake_client_test.go.html#7429756">err</a></span><span class="op" id="7429892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7429896">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7429900">defer</span>&nbsp;<span class="ident" id="7429906"><a href="/crypto/tls/handshake_client_test.go.html#7429751">out</a></span><span class="op" id="7429909">.</span><span class="ident" id="7429910">Close</span><span class="op" id="7429915">(</span><span class="op" id="7429916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429920"><a href="/crypto/tls/handshake_client_test.go.html#7428367">recordingConn</a></span><span class="op" id="7429933">.</span><span class="ident" id="7429934">Close</span><span class="op" id="7429939">(</span><span class="op" id="7429940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7429944">close</span><span class="op" id="7429949">(</span><span class="ident" id="7429950"><a href="/crypto/tls/handshake_client_test.go.html#7428429">stdin</a></span><span class="op" id="7429955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429959"><a href="/crypto/tls/handshake_client_test.go.html#7428401">childProcess</a></span><span class="op" id="7429971">.</span><span class="ident" id="7429972">Process</span><span class="op" id="7429979">.</span><span class="ident" id="7429980">Kill</span><span class="op" id="7429984">(</span><span class="op" id="7429985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7429989"><a href="/crypto/tls/handshake_client_test.go.html#7428401">childProcess</a></span><span class="op" id="7430001">.</span><span class="ident" id="7430002">Wait</span><span class="op" id="7430006">(</span><span class="op" id="7430007">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7430011">if</span>&nbsp;<span class="builtinfunc" id="7430014">len</span><span class="op" id="7430017">(</span><span class="ident" id="7430018"><a href="/crypto/tls/handshake_client_test.go.html#7428367">recordingConn</a></span><span class="op" id="7430031">.</span><span class="ident" id="7430032">flows</span><span class="op" id="7430037">)</span>&nbsp;<span class="op" id="7430039">&lt;</span>&nbsp;<span class="num" id="7430041">3</span>&nbsp;<span class="op" id="7430043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430048"><a href="/crypto/tls/handshake_client_test.go.html#7428401">childProcess</a></span><span class="op" id="7430060">.</span><span class="ident" id="7430061">Stdout</span><span class="op" id="7430067">.</span><span class="op" id="7430068">(</span><span class="op" id="7430069">*</span><span class="ident" id="7430070"><a href="/crypto/tls/handshake_client_test.go.html#7423851">bytes</a></span><span class="op" id="7430075">.</span><span class="ident" id="7430076">Buffer</span><span class="op" id="7430082">)</span><span class="op" id="7430083">.</span><span class="ident" id="7430084">WriteTo</span><span class="op" id="7430091">(</span><span class="ident" id="7430092"><a href="/crypto/tls/handshake_client_test.go.html#7423941">os</a></span><span class="op" id="7430094">.</span><span class="ident" id="7430095">Stdout</span><span class="op" id="7430101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430106"><a href="/crypto/tls/handshake_client_test.go.html#7428297">t</a></span><span class="op" id="7430107">.</span><span class="ident" id="7430108">Fatalf</span><span class="op" id="7430114">(</span><span class="string" id="7430115">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7430146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7430150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430154"><a href="/crypto/tls/handshake_client_test.go.html#7428367">recordingConn</a></span><span class="op" id="7430167">.</span><span class="ident" id="7430168">WriteTo</span><span class="op" id="7430175">(</span><span class="ident" id="7430176"><a href="/crypto/tls/handshake_client_test.go.html#7429751">out</a></span><span class="op" id="7430179">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430183"><a href="/crypto/tls/handshake_client_test.go.html#7423921">fmt</a></span><span class="op" id="7430186">.</span><span class="ident" id="7430187">Printf</span><span class="op" id="7430193">(</span><span class="string" id="7430194">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7430206">,</span>&nbsp;<span class="ident" id="7430208"><a href="/crypto/tls/handshake_client_test.go.html#7429725">path</a></span><span class="op" id="7430212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7430215">}</span><br>
<span class="lineno"></span><span class="op" id="7430217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430220">func</span>&nbsp;<span class="ident" id="7430225">runClientTestForVersion</span><span class="op" id="7430248">(</span><span class="ident" id="7430249">t</span>&nbsp;<span class="op" id="7430251">*</span><span class="ident" id="7430252"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7430259">.</span><span class="ident" id="7430260">T</span><span class="op" id="7430261">,</span>&nbsp;<span class="ident" id="7430263">template</span>&nbsp;<span class="op" id="7430272">*</span><span class="ident" id="7430273"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7430283">,</span>&nbsp;<span class="ident" id="7430285">prefix</span><span class="op" id="7430291">,</span>&nbsp;<span class="ident" id="7430293">option</span>&nbsp;<span class="builtintype" id="7430300">string</span><span class="op" id="7430306">)</span>&nbsp;<span class="op" id="7430308">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430311">test</span>&nbsp;<span class="op" id="7430316">:=</span>&nbsp;<span class="op" id="7430319">*</span><span class="ident" id="7430320"><a href="/crypto/tls/handshake_client_test.go.html#7430263">template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430330"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430334">.</span><span class="ident" id="7430335">name</span>&nbsp;<span class="op" id="7430340">=</span>&nbsp;<span class="ident" id="7430342"><a href="/crypto/tls/handshake_client_test.go.html#7430285">prefix</a></span>&nbsp;<span class="op" id="7430349">+</span>&nbsp;<span class="ident" id="7430351"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430355">.</span><span class="ident" id="7430356">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7430362">if</span>&nbsp;<span class="builtinfunc" id="7430365">len</span><span class="op" id="7430368">(</span><span class="ident" id="7430369"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430373">.</span><span class="ident" id="7430374">command</span><span class="op" id="7430381">)</span>&nbsp;<span class="op" id="7430383">==</span>&nbsp;<span class="num" id="7430386">0</span>&nbsp;<span class="op" id="7430388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430392"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430396">.</span><span class="ident" id="7430397">command</span>&nbsp;<span class="op" id="7430405">=</span>&nbsp;<span class="ident" id="7430407"><a href="/crypto/tls/handshake_server_test.go.html#7451569">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7430429">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430432"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430436">.</span><span class="ident" id="7430437">command</span>&nbsp;<span class="op" id="7430445">=</span>&nbsp;<span class="builtinfunc" id="7430447">append</span><span class="op" id="7430453">(</span><span class="op" id="7430454">[</span><span class="op" id="7430455">]</span><span class="builtintype" id="7430456">string</span><span class="op" id="7430462">(</span><span class="ident" id="7430463">nil</span><span class="op" id="7430466">)</span><span class="op" id="7430467">,</span>&nbsp;<span class="ident" id="7430469"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430473">.</span><span class="ident" id="7430474">command</span><span class="op" id="7430481">...</span><span class="op" id="7430484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430487"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430491">.</span><span class="ident" id="7430492">command</span>&nbsp;<span class="op" id="7430500">=</span>&nbsp;<span class="builtinfunc" id="7430502">append</span><span class="op" id="7430508">(</span><span class="ident" id="7430509"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430513">.</span><span class="ident" id="7430514">command</span><span class="op" id="7430521">,</span>&nbsp;<span class="ident" id="7430523"><a href="/crypto/tls/handshake_client_test.go.html#7430293">option</a></span><span class="op" id="7430529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430532"><a href="/crypto/tls/handshake_client_test.go.html#7430311">test</a></span><span class="op" id="7430536">.</span><span class="ident" id="7430537">run</span><span class="op" id="7430540">(</span><span class="ident" id="7430541"><a href="/crypto/tls/handshake_client_test.go.html#7430249">t</a></span><span class="op" id="7430542">,</span>&nbsp;<span class="op" id="7430544">*</span><span class="ident" id="7430545"><a href="/crypto/tls/handshake_test.go.html#7476047">update</a></span><span class="op" id="7430551">)</span><br>
<span class="lineno"></span><span class="op" id="7430553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7430556">func</span>&nbsp;<span class="ident" id="7430561">runClientTestTLS10</span><span class="op" id="7430579">(</span><span class="ident" id="7430580">t</span>&nbsp;<span class="op" id="7430582">*</span><span class="ident" id="7430583"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7430590">.</span><span class="ident" id="7430591">T</span><span class="op" id="7430592">,</span>&nbsp;<span class="ident" id="7430594">template</span>&nbsp;<span class="op" id="7430603">*</span><span class="ident" id="7430604"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7430614">)</span>&nbsp;<span class="op" id="7430616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430619"><a href="/crypto/tls/handshake_client_test.go.html#7430225">runClientTestForVersion</a></span><span class="op" id="7430642">(</span><span class="ident" id="7430643"><a href="/crypto/tls/handshake_client_test.go.html#7430580">t</a></span><span class="op" id="7430644">,</span>&nbsp;<span class="ident" id="7430646"><a href="/crypto/tls/handshake_client_test.go.html#7430594">template</a></span><span class="op" id="7430654">,</span>&nbsp;<span class="string" id="7430656">&#34;TLSv10-&#34;</span><span class="op" id="7430665">,</span>&nbsp;<span class="string" id="7430667">&#34;-tls1&#34;</span><span class="op" id="7430674">)</span><br>
<span class="lineno"></span><span class="op" id="7430676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430679">func</span>&nbsp;<span class="ident" id="7430684">runClientTestTLS11</span><span class="op" id="7430702">(</span><span class="ident" id="7430703">t</span>&nbsp;<span class="op" id="7430705">*</span><span class="ident" id="7430706"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7430713">.</span><span class="ident" id="7430714">T</span><span class="op" id="7430715">,</span>&nbsp;<span class="ident" id="7430717">template</span>&nbsp;<span class="op" id="7430726">*</span><span class="ident" id="7430727"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7430737">)</span>&nbsp;<span class="op" id="7430739">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430742"><a href="/crypto/tls/handshake_client_test.go.html#7430225">runClientTestForVersion</a></span><span class="op" id="7430765">(</span><span class="ident" id="7430766"><a href="/crypto/tls/handshake_client_test.go.html#7430703">t</a></span><span class="op" id="7430767">,</span>&nbsp;<span class="ident" id="7430769"><a href="/crypto/tls/handshake_client_test.go.html#7430717">template</a></span><span class="op" id="7430777">,</span>&nbsp;<span class="string" id="7430779">&#34;TLSv11-&#34;</span><span class="op" id="7430788">,</span>&nbsp;<span class="string" id="7430790">&#34;-tls1_1&#34;</span><span class="op" id="7430799">)</span><br>
<span class="lineno"></span><span class="op" id="7430801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430804">func</span>&nbsp;<span class="ident" id="7430809">runClientTestTLS12</span><span class="op" id="7430827">(</span><span class="ident" id="7430828">t</span>&nbsp;<span class="op" id="7430830">*</span><span class="ident" id="7430831"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7430838">.</span><span class="ident" id="7430839">T</span><span class="op" id="7430840">,</span>&nbsp;<span class="ident" id="7430842">template</span>&nbsp;<span class="op" id="7430851">*</span><span class="ident" id="7430852"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7430862">)</span>&nbsp;<span class="op" id="7430864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430867"><a href="/crypto/tls/handshake_client_test.go.html#7430225">runClientTestForVersion</a></span><span class="op" id="7430890">(</span><span class="ident" id="7430891"><a href="/crypto/tls/handshake_client_test.go.html#7430828">t</a></span><span class="op" id="7430892">,</span>&nbsp;<span class="ident" id="7430894"><a href="/crypto/tls/handshake_client_test.go.html#7430842">template</a></span><span class="op" id="7430902">,</span>&nbsp;<span class="string" id="7430904">&#34;TLSv12-&#34;</span><span class="op" id="7430913">,</span>&nbsp;<span class="string" id="7430915">&#34;-tls1_2&#34;</span><span class="op" id="7430924">)</span><br>
<span class="lineno">270</span><span class="op" id="7430926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430929">func</span>&nbsp;<span class="ident" id="7430934">TestHandshakeClientRSARC4</span><span class="op" id="7430959">(</span><span class="ident" id="7430960">t</span>&nbsp;<span class="op" id="7430962">*</span><span class="ident" id="7430963"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7430970">.</span><span class="ident" id="7430971">T</span><span class="op" id="7430972">)</span>&nbsp;<span class="op" id="7430974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7430977">test</span>&nbsp;<span class="op" id="7430982">:=</span>&nbsp;<span class="op" id="7430985">&amp;</span><span class="ident" id="7430986"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7430996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431000">name</span><span class="op" id="7431004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431009">&#34;RSA-RC4&#34;</span><span class="op" id="7431018">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431022">command</span><span class="op" id="7431029">:</span>&nbsp;<span class="op" id="7431031">[</span><span class="op" id="7431032">]</span><span class="builtintype" id="7431033">string</span><span class="op" id="7431039">{</span><span class="string" id="7431040">&#34;openssl&#34;</span><span class="op" id="7431049">,</span>&nbsp;<span class="string" id="7431051">&#34;s_server&#34;</span><span class="op" id="7431061">,</span>&nbsp;<span class="string" id="7431063">&#34;-cipher&#34;</span><span class="op" id="7431072">,</span>&nbsp;<span class="string" id="7431074">&#34;RC4-SHA&#34;</span><span class="op" id="7431083">}</span><span class="op" id="7431084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7431087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431090"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7431108">(</span><span class="ident" id="7431109"><a href="/crypto/tls/handshake_client_test.go.html#7430960">t</a></span><span class="op" id="7431110">,</span>&nbsp;<span class="ident" id="7431112"><a href="/crypto/tls/handshake_client_test.go.html#7430977">test</a></span><span class="op" id="7431116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431119"><a href="/crypto/tls/handshake_client_test.go.html#7430684">runClientTestTLS11</a></span><span class="op" id="7431137">(</span><span class="ident" id="7431138"><a href="/crypto/tls/handshake_client_test.go.html#7430960">t</a></span><span class="op" id="7431139">,</span>&nbsp;<span class="ident" id="7431141"><a href="/crypto/tls/handshake_client_test.go.html#7430977">test</a></span><span class="op" id="7431145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431148"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7431166">(</span><span class="ident" id="7431167"><a href="/crypto/tls/handshake_client_test.go.html#7430960">t</a></span><span class="op" id="7431168">,</span>&nbsp;<span class="ident" id="7431170"><a href="/crypto/tls/handshake_client_test.go.html#7430977">test</a></span><span class="op" id="7431174">)</span><br>
<span class="lineno">280</span><span class="op" id="7431176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431179">func</span>&nbsp;<span class="ident" id="7431184">TestHandshakeClientECDHERSAAES</span><span class="op" id="7431214">(</span><span class="ident" id="7431215">t</span>&nbsp;<span class="op" id="7431217">*</span><span class="ident" id="7431218"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7431225">.</span><span class="ident" id="7431226">T</span><span class="op" id="7431227">)</span>&nbsp;<span class="op" id="7431229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431232">test</span>&nbsp;<span class="op" id="7431237">:=</span>&nbsp;<span class="op" id="7431240">&amp;</span><span class="ident" id="7431241"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7431251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431255">name</span><span class="op" id="7431259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431264">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7431279">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431283">command</span><span class="op" id="7431290">:</span>&nbsp;<span class="op" id="7431292">[</span><span class="op" id="7431293">]</span><span class="builtintype" id="7431294">string</span><span class="op" id="7431300">{</span><span class="string" id="7431301">&#34;openssl&#34;</span><span class="op" id="7431310">,</span>&nbsp;<span class="string" id="7431312">&#34;s_server&#34;</span><span class="op" id="7431322">,</span>&nbsp;<span class="string" id="7431324">&#34;-cipher&#34;</span><span class="op" id="7431333">,</span>&nbsp;<span class="string" id="7431335">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7431357">}</span><span class="op" id="7431358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7431361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431364"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7431382">(</span><span class="ident" id="7431383"><a href="/crypto/tls/handshake_client_test.go.html#7431215">t</a></span><span class="op" id="7431384">,</span>&nbsp;<span class="ident" id="7431386"><a href="/crypto/tls/handshake_client_test.go.html#7431232">test</a></span><span class="op" id="7431390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431393"><a href="/crypto/tls/handshake_client_test.go.html#7430684">runClientTestTLS11</a></span><span class="op" id="7431411">(</span><span class="ident" id="7431412"><a href="/crypto/tls/handshake_client_test.go.html#7431215">t</a></span><span class="op" id="7431413">,</span>&nbsp;<span class="ident" id="7431415"><a href="/crypto/tls/handshake_client_test.go.html#7431232">test</a></span><span class="op" id="7431419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431422"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7431440">(</span><span class="ident" id="7431441"><a href="/crypto/tls/handshake_client_test.go.html#7431215">t</a></span><span class="op" id="7431442">,</span>&nbsp;<span class="ident" id="7431444"><a href="/crypto/tls/handshake_client_test.go.html#7431232">test</a></span><span class="op" id="7431448">)</span><br>
<span class="lineno">290</span><span class="op" id="7431450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431453">func</span>&nbsp;<span class="ident" id="7431458">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7431490">(</span><span class="ident" id="7431491">t</span>&nbsp;<span class="op" id="7431493">*</span><span class="ident" id="7431494"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7431501">.</span><span class="ident" id="7431502">T</span><span class="op" id="7431503">)</span>&nbsp;<span class="op" id="7431505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431508">test</span>&nbsp;<span class="op" id="7431513">:=</span>&nbsp;<span class="op" id="7431516">&amp;</span><span class="ident" id="7431517"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7431527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431531">name</span><span class="op" id="7431535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431540">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7431557">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431561">command</span><span class="op" id="7431568">:</span>&nbsp;<span class="op" id="7431570">[</span><span class="op" id="7431571">]</span><span class="builtintype" id="7431572">string</span><span class="op" id="7431578">{</span><span class="string" id="7431579">&#34;openssl&#34;</span><span class="op" id="7431588">,</span>&nbsp;<span class="string" id="7431590">&#34;s_server&#34;</span><span class="op" id="7431600">,</span>&nbsp;<span class="string" id="7431602">&#34;-cipher&#34;</span><span class="op" id="7431611">,</span>&nbsp;<span class="string" id="7431613">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7431637">}</span><span class="op" id="7431638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431642">cert</span><span class="op" id="7431646">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431651"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7431671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431675">key</span><span class="op" id="7431678">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431684"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><span class="op" id="7431703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7431706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431709"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7431727">(</span><span class="ident" id="7431728"><a href="/crypto/tls/handshake_client_test.go.html#7431491">t</a></span><span class="op" id="7431729">,</span>&nbsp;<span class="ident" id="7431731"><a href="/crypto/tls/handshake_client_test.go.html#7431508">test</a></span><span class="op" id="7431735">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431738"><a href="/crypto/tls/handshake_client_test.go.html#7430684">runClientTestTLS11</a></span><span class="op" id="7431756">(</span><span class="ident" id="7431757"><a href="/crypto/tls/handshake_client_test.go.html#7431491">t</a></span><span class="op" id="7431758">,</span>&nbsp;<span class="ident" id="7431760"><a href="/crypto/tls/handshake_client_test.go.html#7431508">test</a></span><span class="op" id="7431764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431767"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7431785">(</span><span class="ident" id="7431786"><a href="/crypto/tls/handshake_client_test.go.html#7431491">t</a></span><span class="op" id="7431787">,</span>&nbsp;<span class="ident" id="7431789"><a href="/crypto/tls/handshake_client_test.go.html#7431508">test</a></span><span class="op" id="7431793">)</span><br>
<span class="lineno"></span><span class="op" id="7431795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431798">func</span>&nbsp;<span class="ident" id="7431803">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7431838">(</span><span class="ident" id="7431839">t</span>&nbsp;<span class="op" id="7431841">*</span><span class="ident" id="7431842"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7431849">.</span><span class="ident" id="7431850">T</span><span class="op" id="7431851">)</span>&nbsp;<span class="op" id="7431853">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431856">test</span>&nbsp;<span class="op" id="7431861">:=</span>&nbsp;<span class="op" id="7431864">&amp;</span><span class="ident" id="7431865"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7431875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431879">name</span><span class="op" id="7431883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431888">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7431909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7431913">command</span><span class="op" id="7431920">:</span>&nbsp;<span class="op" id="7431922">[</span><span class="op" id="7431923">]</span><span class="builtintype" id="7431924">string</span><span class="op" id="7431930">{</span><span class="string" id="7431931">&#34;openssl&#34;</span><span class="op" id="7431940">,</span>&nbsp;<span class="string" id="7431942">&#34;s_server&#34;</span><span class="op" id="7431952">,</span>&nbsp;<span class="string" id="7431954">&#34;-cipher&#34;</span><span class="op" id="7431963">,</span>&nbsp;<span class="string" id="7431965">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7431996">}</span><span class="op" id="7431997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432001">cert</span><span class="op" id="7432005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432010"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7432030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432034">key</span><span class="op" id="7432037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432043"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><span class="op" id="7432062">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7432065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432068"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7432086">(</span><span class="ident" id="7432087"><a href="/crypto/tls/handshake_client_test.go.html#7431839">t</a></span><span class="op" id="7432088">,</span>&nbsp;<span class="ident" id="7432090"><a href="/crypto/tls/handshake_client_test.go.html#7431856">test</a></span><span class="op" id="7432094">)</span><br>
<span class="lineno"></span><span class="op" id="7432096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7432099">func</span>&nbsp;<span class="ident" id="7432104">TestHandshakeClientCertRSA</span><span class="op" id="7432130">(</span><span class="ident" id="7432131">t</span>&nbsp;<span class="op" id="7432133">*</span><span class="ident" id="7432134"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7432141">.</span><span class="ident" id="7432142">T</span><span class="op" id="7432143">)</span>&nbsp;<span class="op" id="7432145">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432148">config</span>&nbsp;<span class="op" id="7432155">:=</span>&nbsp;<span class="op" id="7432158">*</span><span class="ident" id="7432159"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432171">cert</span><span class="op" id="7432175">,</span>&nbsp;<span class="ident" id="7432177">_</span>&nbsp;<span class="op" id="7432179">:=</span>&nbsp;<span class="ident" id="7432182"><a href="/crypto/tls/tls.go.html#3968629">X509KeyPair</a></span><span class="op" id="7432193">(</span><span class="op" id="7432194">[</span><span class="op" id="7432195">]</span><span class="builtintype" id="7432196">byte</span><span class="op" id="7432200">(</span><span class="ident" id="7432201"><a href="/crypto/tls/handshake_server_test.go.html#7465073">clientCertificatePEM</a></span><span class="op" id="7432221">)</span><span class="op" id="7432222">,</span>&nbsp;<span class="op" id="7432224">[</span><span class="op" id="7432225">]</span><span class="builtintype" id="7432226">byte</span><span class="op" id="7432230">(</span><span class="ident" id="7432231"><a href="/crypto/tls/handshake_server_test.go.html#7465835">clientKeyPEM</a></span><span class="op" id="7432243">)</span><span class="op" id="7432244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432247"><a href="/crypto/tls/handshake_client_test.go.html#7432148">config</a></span><span class="op" id="7432253">.</span><span class="ident" id="7432254">Certificates</span>&nbsp;<span class="op" id="7432267">=</span>&nbsp;<span class="op" id="7432269">[</span><span class="op" id="7432270">]</span><span class="ident" id="7432271"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7432282">{</span><span class="ident" id="7432283"><a href="/crypto/tls/handshake_client_test.go.html#7432171">cert</a></span><span class="op" id="7432287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432291">test</span>&nbsp;<span class="op" id="7432296">:=</span>&nbsp;<span class="op" id="7432299">&amp;</span><span class="ident" id="7432300"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7432310">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432314">name</span><span class="op" id="7432318">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7432323">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7432343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432347">command</span><span class="op" id="7432354">:</span>&nbsp;<span class="op" id="7432356">[</span><span class="op" id="7432357">]</span><span class="builtintype" id="7432358">string</span><span class="op" id="7432364">{</span><span class="string" id="7432365">&#34;openssl&#34;</span><span class="op" id="7432374">,</span>&nbsp;<span class="string" id="7432376">&#34;s_server&#34;</span><span class="op" id="7432386">,</span>&nbsp;<span class="string" id="7432388">&#34;-cipher&#34;</span><span class="op" id="7432397">,</span>&nbsp;<span class="string" id="7432399">&#34;RC4-SHA&#34;</span><span class="op" id="7432408">,</span>&nbsp;<span class="string" id="7432410">&#34;-verify&#34;</span><span class="op" id="7432419">,</span>&nbsp;<span class="string" id="7432421">&#34;1&#34;</span><span class="op" id="7432424">}</span><span class="op" id="7432425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432429">config</span><span class="op" id="7432435">:</span>&nbsp;&nbsp;<span class="op" id="7432438">&amp;</span><span class="ident" id="7432439"><a href="/crypto/tls/handshake_client_test.go.html#7432148">config</a></span><span class="op" id="7432445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7432448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432452"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7432470">(</span><span class="ident" id="7432471"><a href="/crypto/tls/handshake_client_test.go.html#7432131">t</a></span><span class="op" id="7432472">,</span>&nbsp;<span class="ident" id="7432474"><a href="/crypto/tls/handshake_client_test.go.html#7432291">test</a></span><span class="op" id="7432478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432481"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7432499">(</span><span class="ident" id="7432500"><a href="/crypto/tls/handshake_client_test.go.html#7432131">t</a></span><span class="op" id="7432501">,</span>&nbsp;<span class="ident" id="7432503"><a href="/crypto/tls/handshake_client_test.go.html#7432291">test</a></span><span class="op" id="7432507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432511"><a href="/crypto/tls/handshake_client_test.go.html#7432291">test</a></span>&nbsp;<span class="op" id="7432516">=</span>&nbsp;<span class="op" id="7432518">&amp;</span><span class="ident" id="7432519"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7432529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432533">name</span><span class="op" id="7432537">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7432542">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7432564">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432568">command</span><span class="op" id="7432575">:</span>&nbsp;<span class="op" id="7432577">[</span><span class="op" id="7432578">]</span><span class="builtintype" id="7432579">string</span><span class="op" id="7432585">{</span><span class="string" id="7432586">&#34;openssl&#34;</span><span class="op" id="7432595">,</span>&nbsp;<span class="string" id="7432597">&#34;s_server&#34;</span><span class="op" id="7432607">,</span>&nbsp;<span class="string" id="7432609">&#34;-cipher&#34;</span><span class="op" id="7432618">,</span>&nbsp;<span class="string" id="7432620">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7432644">,</span>&nbsp;<span class="string" id="7432646">&#34;-verify&#34;</span><span class="op" id="7432655">,</span>&nbsp;<span class="string" id="7432657">&#34;1&#34;</span><span class="op" id="7432660">}</span><span class="op" id="7432661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432665">config</span><span class="op" id="7432671">:</span>&nbsp;&nbsp;<span class="op" id="7432674">&amp;</span><span class="ident" id="7432675"><a href="/crypto/tls/handshake_client_test.go.html#7432148">config</a></span><span class="op" id="7432681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432685">cert</span><span class="op" id="7432689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432694"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7432714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432718">key</span><span class="op" id="7432721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432727"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><span class="op" id="7432746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7432749">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432753"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7432771">(</span><span class="ident" id="7432772"><a href="/crypto/tls/handshake_client_test.go.html#7432131">t</a></span><span class="op" id="7432773">,</span>&nbsp;<span class="ident" id="7432775"><a href="/crypto/tls/handshake_client_test.go.html#7432291">test</a></span><span class="op" id="7432779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432782"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7432800">(</span><span class="ident" id="7432801"><a href="/crypto/tls/handshake_client_test.go.html#7432131">t</a></span><span class="op" id="7432802">,</span>&nbsp;<span class="ident" id="7432804"><a href="/crypto/tls/handshake_client_test.go.html#7432291">test</a></span><span class="op" id="7432808">)</span><br>
<span class="lineno"></span><span class="op" id="7432810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7432813">func</span>&nbsp;<span class="ident" id="7432818">TestHandshakeClientCertECDSA</span><span class="op" id="7432846">(</span><span class="ident" id="7432847">t</span>&nbsp;<span class="op" id="7432849">*</span><span class="ident" id="7432850"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7432857">.</span><span class="ident" id="7432858">T</span><span class="op" id="7432859">)</span>&nbsp;<span class="op" id="7432861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432864">config</span>&nbsp;<span class="op" id="7432871">:=</span>&nbsp;<span class="op" id="7432874">*</span><span class="ident" id="7432875"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432887">cert</span><span class="op" id="7432891">,</span>&nbsp;<span class="ident" id="7432893">_</span>&nbsp;<span class="op" id="7432895">:=</span>&nbsp;<span class="ident" id="7432898"><a href="/crypto/tls/tls.go.html#3968629">X509KeyPair</a></span><span class="op" id="7432909">(</span><span class="op" id="7432910">[</span><span class="op" id="7432911">]</span><span class="builtintype" id="7432912">byte</span><span class="op" id="7432916">(</span><span class="ident" id="7432917"><a href="/crypto/tls/handshake_server_test.go.html#7466743">clientECDSACertificatePEM</a></span><span class="op" id="7432942">)</span><span class="op" id="7432943">,</span>&nbsp;<span class="op" id="7432945">[</span><span class="op" id="7432946">]</span><span class="builtintype" id="7432947">byte</span><span class="op" id="7432951">(</span><span class="ident" id="7432952"><a href="/crypto/tls/handshake_server_test.go.html#7467530">clientECDSAKeyPEM</a></span><span class="op" id="7432969">)</span><span class="op" id="7432970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7432973"><a href="/crypto/tls/handshake_client_test.go.html#7432864">config</a></span><span class="op" id="7432979">.</span><span class="ident" id="7432980">Certificates</span>&nbsp;<span class="op" id="7432993">=</span>&nbsp;<span class="op" id="7432995">[</span><span class="op" id="7432996">]</span><span class="ident" id="7432997"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="7433008">{</span><span class="ident" id="7433009"><a href="/crypto/tls/handshake_client_test.go.html#7432887">cert</a></span><span class="op" id="7433013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433017">test</span>&nbsp;<span class="op" id="7433022">:=</span>&nbsp;<span class="op" id="7433025">&amp;</span><span class="ident" id="7433026"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7433036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433040">name</span><span class="op" id="7433044">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7433049">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7433071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433075">command</span><span class="op" id="7433082">:</span>&nbsp;<span class="op" id="7433084">[</span><span class="op" id="7433085">]</span><span class="builtintype" id="7433086">string</span><span class="op" id="7433092">{</span><span class="string" id="7433093">&#34;openssl&#34;</span><span class="op" id="7433102">,</span>&nbsp;<span class="string" id="7433104">&#34;s_server&#34;</span><span class="op" id="7433114">,</span>&nbsp;<span class="string" id="7433116">&#34;-cipher&#34;</span><span class="op" id="7433125">,</span>&nbsp;<span class="string" id="7433127">&#34;RC4-SHA&#34;</span><span class="op" id="7433136">,</span>&nbsp;<span class="string" id="7433138">&#34;-verify&#34;</span><span class="op" id="7433147">,</span>&nbsp;<span class="string" id="7433149">&#34;1&#34;</span><span class="op" id="7433152">}</span><span class="op" id="7433153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433157">config</span><span class="op" id="7433163">:</span>&nbsp;&nbsp;<span class="op" id="7433166">&amp;</span><span class="ident" id="7433167"><a href="/crypto/tls/handshake_client_test.go.html#7432864">config</a></span><span class="op" id="7433173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7433176">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433180"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7433198">(</span><span class="ident" id="7433199"><a href="/crypto/tls/handshake_client_test.go.html#7432847">t</a></span><span class="op" id="7433200">,</span>&nbsp;<span class="ident" id="7433202"><a href="/crypto/tls/handshake_client_test.go.html#7433017">test</a></span><span class="op" id="7433206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433209"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7433227">(</span><span class="ident" id="7433228"><a href="/crypto/tls/handshake_client_test.go.html#7432847">t</a></span><span class="op" id="7433229">,</span>&nbsp;<span class="ident" id="7433231"><a href="/crypto/tls/handshake_client_test.go.html#7433017">test</a></span><span class="op" id="7433235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433239"><a href="/crypto/tls/handshake_client_test.go.html#7433017">test</a></span>&nbsp;<span class="op" id="7433244">=</span>&nbsp;<span class="op" id="7433246">&amp;</span><span class="ident" id="7433247"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7433257">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433261">name</span><span class="op" id="7433265">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7433270">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7433294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433298">command</span><span class="op" id="7433305">:</span>&nbsp;<span class="op" id="7433307">[</span><span class="op" id="7433308">]</span><span class="builtintype" id="7433309">string</span><span class="op" id="7433315">{</span><span class="string" id="7433316">&#34;openssl&#34;</span><span class="op" id="7433325">,</span>&nbsp;<span class="string" id="7433327">&#34;s_server&#34;</span><span class="op" id="7433337">,</span>&nbsp;<span class="string" id="7433339">&#34;-cipher&#34;</span><span class="op" id="7433348">,</span>&nbsp;<span class="string" id="7433350">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7433374">,</span>&nbsp;<span class="string" id="7433376">&#34;-verify&#34;</span><span class="op" id="7433385">,</span>&nbsp;<span class="string" id="7433387">&#34;1&#34;</span><span class="op" id="7433390">}</span><span class="op" id="7433391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433395">config</span><span class="op" id="7433401">:</span>&nbsp;&nbsp;<span class="op" id="7433404">&amp;</span><span class="ident" id="7433405"><a href="/crypto/tls/handshake_client_test.go.html#7432864">config</a></span><span class="op" id="7433411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433415">cert</span><span class="op" id="7433419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433424"><a href="/crypto/tls/handshake_server_test.go.html#7470912">testECDSACertificate</a></span><span class="op" id="7433444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433448">key</span><span class="op" id="7433451">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433457"><a href="/crypto/tls/handshake_server_test.go.html#7474154">testECDSAPrivateKey</a></span><span class="op" id="7433476">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7433479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433483"><a href="/crypto/tls/handshake_client_test.go.html#7430561">runClientTestTLS10</a></span><span class="op" id="7433501">(</span><span class="ident" id="7433502"><a href="/crypto/tls/handshake_client_test.go.html#7432847">t</a></span><span class="op" id="7433503">,</span>&nbsp;<span class="ident" id="7433505"><a href="/crypto/tls/handshake_client_test.go.html#7433017">test</a></span><span class="op" id="7433509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433512"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7433530">(</span><span class="ident" id="7433531"><a href="/crypto/tls/handshake_client_test.go.html#7432847">t</a></span><span class="op" id="7433532">,</span>&nbsp;<span class="ident" id="7433534"><a href="/crypto/tls/handshake_client_test.go.html#7433017">test</a></span><span class="op" id="7433538">)</span><br>
<span class="lineno"></span><span class="op" id="7433540">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7433543">func</span>&nbsp;<span class="ident" id="7433548">TestClientResumption</span><span class="op" id="7433568">(</span><span class="ident" id="7433569">t</span>&nbsp;<span class="op" id="7433571">*</span><span class="ident" id="7433572"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7433579">.</span><span class="ident" id="7433580">T</span><span class="op" id="7433581">)</span>&nbsp;<span class="op" id="7433583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433586">serverConfig</span>&nbsp;<span class="op" id="7433599">:=</span>&nbsp;<span class="op" id="7433602">&amp;</span><span class="ident" id="7433603"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7433609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433613">CipherSuites</span><span class="op" id="7433625">:</span>&nbsp;<span class="op" id="7433627">[</span><span class="op" id="7433628">]</span><span class="builtintype" id="7433629">uint16</span><span class="op" id="7433635">{</span><span class="ident" id="7433636"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7433660">,</span>&nbsp;<span class="ident" id="7433662"><a href="/crypto/tls/cipher_suites.go.html#3821902">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7433692">}</span><span class="op" id="7433693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433697">Certificates</span><span class="op" id="7433709">:</span>&nbsp;<span class="ident" id="7433711"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><span class="op" id="7433721">.</span><span class="ident" id="7433722">Certificates</span><span class="op" id="7433734">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7433737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433740">clientConfig</span>&nbsp;<span class="op" id="7433753">:=</span>&nbsp;<span class="op" id="7433756">&amp;</span><span class="ident" id="7433757"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="7433763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433767">CipherSuites</span><span class="op" id="7433779">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433787">[</span><span class="op" id="7433788">]</span><span class="builtintype" id="7433789">uint16</span><span class="op" id="7433795">{</span><span class="ident" id="7433796"><a href="/crypto/tls/cipher_suites.go.html#3821503">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7433820">}</span><span class="op" id="7433821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433825">InsecureSkipVerify</span><span class="op" id="7433843">:</span>&nbsp;<span class="builtintype" id="7433845">true</span><span class="op" id="7433849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433853">ClientSessionCache</span><span class="op" id="7433871">:</span>&nbsp;<span class="ident" id="7433873"><a href="/crypto/tls/common.go.html#3839758">NewLRUClientSessionCache</a></span><span class="op" id="7433897">(</span><span class="num" id="7433898">32</span><span class="op" id="7433900">)</span><span class="op" id="7433901">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7433904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433908">testResumeState</span>&nbsp;<span class="op" id="7433924">:=</span>&nbsp;<span class="keyword" id="7433927">func</span><span class="op" id="7433931">(</span><span class="ident" id="7433932">test</span>&nbsp;<span class="builtintype" id="7433937">string</span><span class="op" id="7433943">,</span>&nbsp;<span class="ident" id="7433945">didResume</span>&nbsp;<span class="builtintype" id="7433955">bool</span><span class="op" id="7433959">)</span>&nbsp;<span class="op" id="7433961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7433965">hs</span><span class="op" id="7433967">,</span>&nbsp;<span class="ident" id="7433969">err</span>&nbsp;<span class="op" id="7433973">:=</span>&nbsp;<span class="ident" id="7433976"><a href="/crypto/tls/handshake_server_test.go.html#7448537">testHandshake</a></span><span class="op" id="7433989">(</span><span class="ident" id="7433990"><a href="/crypto/tls/handshake_client_test.go.html#7433740">clientConfig</a></span><span class="op" id="7434002">,</span>&nbsp;<span class="ident" id="7434004"><a href="/crypto/tls/handshake_client_test.go.html#7433586">serverConfig</a></span><span class="op" id="7434016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434020">if</span>&nbsp;<span class="ident" id="7434023"><a href="/crypto/tls/handshake_client_test.go.html#7433969">err</a></span>&nbsp;<span class="op" id="7434027">!=</span>&nbsp;<span class="ident" id="7434030">nil</span>&nbsp;<span class="op" id="7434034">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434039"><a href="/crypto/tls/handshake_client_test.go.html#7433569">t</a></span><span class="op" id="7434040">.</span><span class="ident" id="7434041">Fatalf</span><span class="op" id="7434047">(</span><span class="string" id="7434048">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7434074">,</span>&nbsp;<span class="ident" id="7434076"><a href="/crypto/tls/handshake_client_test.go.html#7433932">test</a></span><span class="op" id="7434080">,</span>&nbsp;<span class="ident" id="7434082"><a href="/crypto/tls/handshake_client_test.go.html#7433969">err</a></span><span class="op" id="7434085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434093">if</span>&nbsp;<span class="ident" id="7434096"><a href="/crypto/tls/handshake_client_test.go.html#7433965">hs</a></span><span class="op" id="7434098">.</span><span class="ident" id="7434099">DidResume</span>&nbsp;<span class="op" id="7434109">!=</span>&nbsp;<span class="ident" id="7434112"><a href="/crypto/tls/handshake_client_test.go.html#7433945">didResume</a></span>&nbsp;<span class="op" id="7434122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434127"><a href="/crypto/tls/handshake_client_test.go.html#7433569">t</a></span><span class="op" id="7434128">.</span><span class="ident" id="7434129">Fatalf</span><span class="op" id="7434135">(</span><span class="string" id="7434136">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7434166">,</span>&nbsp;<span class="ident" id="7434168"><a href="/crypto/tls/handshake_client_test.go.html#7433932">test</a></span><span class="op" id="7434172">,</span>&nbsp;<span class="ident" id="7434174"><a href="/crypto/tls/handshake_client_test.go.html#7433965">hs</a></span><span class="op" id="7434176">.</span><span class="ident" id="7434177">DidResume</span><span class="op" id="7434186">,</span>&nbsp;<span class="ident" id="7434188"><a href="/crypto/tls/handshake_client_test.go.html#7433945">didResume</a></span><span class="op" id="7434197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434201">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434208"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434223">(</span><span class="string" id="7434224">&#34;Handshake&#34;</span><span class="op" id="7434235">,</span>&nbsp;<span class="builtintype" id="7434237">false</span><span class="op" id="7434242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434245"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434260">(</span><span class="string" id="7434261">&#34;Resume&#34;</span><span class="op" id="7434269">,</span>&nbsp;<span class="builtintype" id="7434271">true</span><span class="op" id="7434275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434279">if</span>&nbsp;<span class="ident" id="7434282">_</span><span class="op" id="7434283">,</span>&nbsp;<span class="ident" id="7434285">err</span>&nbsp;<span class="op" id="7434289">:=</span>&nbsp;<span class="ident" id="7434292"><a href="/crypto/tls/handshake_client_test.go.html#7423928">io</a></span><span class="op" id="7434294">.</span><span class="ident" id="7434295">ReadFull</span><span class="op" id="7434303">(</span><span class="ident" id="7434304"><a href="/crypto/tls/handshake_client_test.go.html#7433586">serverConfig</a></span><span class="op" id="7434316">.</span><span class="ident" id="7434317">rand</span><span class="op" id="7434321">(</span><span class="op" id="7434322">)</span><span class="op" id="7434323">,</span>&nbsp;<span class="ident" id="7434325"><a href="/crypto/tls/handshake_client_test.go.html#7433586">serverConfig</a></span><span class="op" id="7434337">.</span><span class="ident" id="7434338">SessionTicketKey</span><span class="op" id="7434354">[</span><span class="op" id="7434355">:</span><span class="op" id="7434356">]</span><span class="op" id="7434357">)</span><span class="op" id="7434358">;</span>&nbsp;<span class="ident" id="7434360"><a href="/crypto/tls/handshake_client_test.go.html#7434285">err</a></span>&nbsp;<span class="op" id="7434364">!=</span>&nbsp;<span class="ident" id="7434367">nil</span>&nbsp;<span class="op" id="7434371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434375"><a href="/crypto/tls/handshake_client_test.go.html#7433569">t</a></span><span class="op" id="7434376">.</span><span class="ident" id="7434377">Fatalf</span><span class="op" id="7434383">(</span><span class="string" id="7434384">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7434423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434429"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434444">(</span><span class="string" id="7434445">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7434470">,</span>&nbsp;<span class="builtintype" id="7434472">false</span><span class="op" id="7434477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434480"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434495">(</span><span class="string" id="7434496">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7434532">,</span>&nbsp;<span class="builtintype" id="7434534">true</span><span class="op" id="7434538">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434542"><a href="/crypto/tls/handshake_client_test.go.html#7433740">clientConfig</a></span><span class="op" id="7434554">.</span><span class="ident" id="7434555">CipherSuites</span>&nbsp;<span class="op" id="7434568">=</span>&nbsp;<span class="op" id="7434570">[</span><span class="op" id="7434571">]</span><span class="builtintype" id="7434572">uint16</span><span class="op" id="7434578">{</span><span class="ident" id="7434579"><a href="/crypto/tls/cipher_suites.go.html#3821902">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7434609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434612"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434627">(</span><span class="string" id="7434628">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7434650">,</span>&nbsp;<span class="builtintype" id="7434652">false</span><span class="op" id="7434657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434660"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434675">(</span><span class="string" id="7434676">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7434706">,</span>&nbsp;<span class="builtintype" id="7434708">true</span><span class="op" id="7434712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434716"><a href="/crypto/tls/handshake_client_test.go.html#7433740">clientConfig</a></span><span class="op" id="7434728">.</span><span class="ident" id="7434729">ClientSessionCache</span>&nbsp;<span class="op" id="7434748">=</span>&nbsp;<span class="ident" id="7434750">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434755"><a href="/crypto/tls/handshake_client_test.go.html#7433908">testResumeState</a></span><span class="op" id="7434770">(</span><span class="string" id="7434771">&#34;WithoutSessionCache&#34;</span><span class="op" id="7434792">,</span>&nbsp;<span class="builtintype" id="7434794">false</span><span class="op" id="7434799">)</span><br>
<span class="lineno"></span><span class="op" id="7434801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7434804">func</span>&nbsp;<span class="ident" id="7434809">TestLRUClientSessionCache</span><span class="op" id="7434834">(</span><span class="ident" id="7434835">t</span>&nbsp;<span class="op" id="7434837">*</span><span class="ident" id="7434838"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7434845">.</span><span class="ident" id="7434846">T</span><span class="op" id="7434847">)</span>&nbsp;<span class="op" id="7434849">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7434852">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434888">cache</span>&nbsp;<span class="op" id="7434894">:=</span>&nbsp;<span class="ident" id="7434897"><a href="/crypto/tls/common.go.html#3839758">NewLRUClientSessionCache</a></span><span class="op" id="7434921">(</span><span class="num" id="7434922">4</span><span class="op" id="7434923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434926">cs</span>&nbsp;<span class="op" id="7434929">:=</span>&nbsp;<span class="builtinfunc" id="7434932">make</span><span class="op" id="7434936">(</span><span class="op" id="7434937">[</span><span class="op" id="7434938">]</span><span class="ident" id="7434939"><a href="/crypto/tls/common.go.html#3828491">ClientSessionState</a></span><span class="op" id="7434957">,</span>&nbsp;<span class="num" id="7434959">6</span><span class="op" id="7434960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434963">keys</span>&nbsp;<span class="op" id="7434968">:=</span>&nbsp;<span class="op" id="7434971">[</span><span class="op" id="7434972">]</span><span class="builtintype" id="7434973">string</span><span class="op" id="7434979">{</span><span class="string" id="7434980">&#34;0&#34;</span><span class="op" id="7434983">,</span>&nbsp;<span class="string" id="7434985">&#34;1&#34;</span><span class="op" id="7434988">,</span>&nbsp;<span class="string" id="7434990">&#34;2&#34;</span><span class="op" id="7434993">,</span>&nbsp;<span class="string" id="7434995">&#34;3&#34;</span><span class="op" id="7434998">,</span>&nbsp;<span class="string" id="7435000">&#34;4&#34;</span><span class="op" id="7435003">,</span>&nbsp;<span class="string" id="7435005">&#34;5&#34;</span><span class="op" id="7435008">,</span>&nbsp;<span class="string" id="7435010">&#34;6&#34;</span><span class="op" id="7435013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7435017">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435066">for</span>&nbsp;<span class="ident" id="7435070">i</span>&nbsp;<span class="op" id="7435072">:=</span>&nbsp;<span class="num" id="7435075">0</span><span class="op" id="7435076">;</span>&nbsp;<span class="ident" id="7435078"><a href="/crypto/tls/handshake_client_test.go.html#7435070">i</a></span>&nbsp;<span class="op" id="7435080">&lt;</span>&nbsp;<span class="num" id="7435082">4</span><span class="op" id="7435083">;</span>&nbsp;<span class="ident" id="7435085"><a href="/crypto/tls/handshake_client_test.go.html#7435070">i</a></span><span class="op" id="7435086">++</span>&nbsp;<span class="op" id="7435089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435093"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435098">.</span><span class="ident" id="7435099">Put</span><span class="op" id="7435102">(</span><span class="ident" id="7435103"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435107">[</span><span class="ident" id="7435108"><a href="/crypto/tls/handshake_client_test.go.html#7435070">i</a></span><span class="op" id="7435109">]</span><span class="op" id="7435110">,</span>&nbsp;<span class="op" id="7435112">&amp;</span><span class="ident" id="7435113"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435115">[</span><span class="ident" id="7435116"><a href="/crypto/tls/handshake_client_test.go.html#7435070">i</a></span><span class="op" id="7435117">]</span><span class="op" id="7435118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435124">for</span>&nbsp;<span class="ident" id="7435128">i</span>&nbsp;<span class="op" id="7435130">:=</span>&nbsp;<span class="num" id="7435133">0</span><span class="op" id="7435134">;</span>&nbsp;<span class="ident" id="7435136"><a href="/crypto/tls/handshake_client_test.go.html#7435128">i</a></span>&nbsp;<span class="op" id="7435138">&lt;</span>&nbsp;<span class="num" id="7435140">4</span><span class="op" id="7435141">;</span>&nbsp;<span class="ident" id="7435143"><a href="/crypto/tls/handshake_client_test.go.html#7435128">i</a></span><span class="op" id="7435144">++</span>&nbsp;<span class="op" id="7435147">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435151">if</span>&nbsp;<span class="ident" id="7435154">s</span><span class="op" id="7435155">,</span>&nbsp;<span class="ident" id="7435157">ok</span>&nbsp;<span class="op" id="7435160">:=</span>&nbsp;<span class="ident" id="7435163"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435168">.</span><span class="ident" id="7435169">Get</span><span class="op" id="7435172">(</span><span class="ident" id="7435173"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435177">[</span><span class="ident" id="7435178"><a href="/crypto/tls/handshake_client_test.go.html#7435128">i</a></span><span class="op" id="7435179">]</span><span class="op" id="7435180">)</span><span class="op" id="7435181">;</span>&nbsp;<span class="op" id="7435183">!</span><span class="ident" id="7435184"><a href="/crypto/tls/handshake_client_test.go.html#7435157">ok</a></span>&nbsp;<span class="op" id="7435187">||</span>&nbsp;<span class="ident" id="7435190"><a href="/crypto/tls/handshake_client_test.go.html#7435154">s</a></span>&nbsp;<span class="op" id="7435192">!=</span>&nbsp;<span class="op" id="7435195">&amp;</span><span class="ident" id="7435196"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435198">[</span><span class="ident" id="7435199"><a href="/crypto/tls/handshake_client_test.go.html#7435128">i</a></span><span class="op" id="7435200">]</span>&nbsp;<span class="op" id="7435202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435207"><a href="/crypto/tls/handshake_client_test.go.html#7434835">t</a></span><span class="op" id="7435208">.</span><span class="ident" id="7435209">Fatalf</span><span class="op" id="7435215">(</span><span class="string" id="7435216">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7435263">,</span>&nbsp;<span class="ident" id="7435265"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435269">[</span><span class="ident" id="7435270"><a href="/crypto/tls/handshake_client_test.go.html#7435128">i</a></span><span class="op" id="7435271">]</span><span class="op" id="7435272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7435283">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435347">for</span>&nbsp;<span class="ident" id="7435351">i</span>&nbsp;<span class="op" id="7435353">:=</span>&nbsp;<span class="num" id="7435356">4</span><span class="op" id="7435357">;</span>&nbsp;<span class="ident" id="7435359"><a href="/crypto/tls/handshake_client_test.go.html#7435351">i</a></span>&nbsp;<span class="op" id="7435361">&lt;</span>&nbsp;<span class="num" id="7435363">6</span><span class="op" id="7435364">;</span>&nbsp;<span class="ident" id="7435366"><a href="/crypto/tls/handshake_client_test.go.html#7435351">i</a></span><span class="op" id="7435367">++</span>&nbsp;<span class="op" id="7435370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435374"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435379">.</span><span class="ident" id="7435380">Put</span><span class="op" id="7435383">(</span><span class="ident" id="7435384"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435388">[</span><span class="ident" id="7435389"><a href="/crypto/tls/handshake_client_test.go.html#7435351">i</a></span><span class="op" id="7435390">]</span><span class="op" id="7435391">,</span>&nbsp;<span class="op" id="7435393">&amp;</span><span class="ident" id="7435394"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435396">[</span><span class="ident" id="7435397"><a href="/crypto/tls/handshake_client_test.go.html#7435351">i</a></span><span class="op" id="7435398">]</span><span class="op" id="7435399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435405">for</span>&nbsp;<span class="ident" id="7435409">i</span>&nbsp;<span class="op" id="7435411">:=</span>&nbsp;<span class="num" id="7435414">0</span><span class="op" id="7435415">;</span>&nbsp;<span class="ident" id="7435417"><a href="/crypto/tls/handshake_client_test.go.html#7435409">i</a></span>&nbsp;<span class="op" id="7435419">&lt;</span>&nbsp;<span class="num" id="7435421">2</span><span class="op" id="7435422">;</span>&nbsp;<span class="ident" id="7435424"><a href="/crypto/tls/handshake_client_test.go.html#7435409">i</a></span><span class="op" id="7435425">++</span>&nbsp;<span class="op" id="7435428">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435432">if</span>&nbsp;<span class="ident" id="7435435">s</span><span class="op" id="7435436">,</span>&nbsp;<span class="ident" id="7435438">ok</span>&nbsp;<span class="op" id="7435441">:=</span>&nbsp;<span class="ident" id="7435444"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435449">.</span><span class="ident" id="7435450">Get</span><span class="op" id="7435453">(</span><span class="ident" id="7435454"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435458">[</span><span class="ident" id="7435459"><a href="/crypto/tls/handshake_client_test.go.html#7435409">i</a></span><span class="op" id="7435460">]</span><span class="op" id="7435461">)</span><span class="op" id="7435462">;</span>&nbsp;<span class="ident" id="7435464"><a href="/crypto/tls/handshake_client_test.go.html#7435438">ok</a></span>&nbsp;<span class="op" id="7435467">||</span>&nbsp;<span class="ident" id="7435470"><a href="/crypto/tls/handshake_client_test.go.html#7435435">s</a></span>&nbsp;<span class="op" id="7435472">!=</span>&nbsp;<span class="ident" id="7435475">nil</span>&nbsp;<span class="op" id="7435479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435484"><a href="/crypto/tls/handshake_client_test.go.html#7434835">t</a></span><span class="op" id="7435485">.</span><span class="ident" id="7435486">Fatalf</span><span class="op" id="7435492">(</span><span class="string" id="7435493">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7435536">,</span>&nbsp;<span class="ident" id="7435538"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435542">[</span><span class="ident" id="7435543"><a href="/crypto/tls/handshake_client_test.go.html#7435409">i</a></span><span class="op" id="7435544">]</span><span class="op" id="7435545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7435556">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435600"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435605">.</span><span class="ident" id="7435606">Get</span><span class="op" id="7435609">(</span><span class="ident" id="7435610"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435614">[</span><span class="num" id="7435615">2</span><span class="op" id="7435616">]</span><span class="op" id="7435617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435620"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435625">.</span><span class="ident" id="7435626">Put</span><span class="op" id="7435629">(</span><span class="ident" id="7435630"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435634">[</span><span class="num" id="7435635">0</span><span class="op" id="7435636">]</span><span class="op" id="7435637">,</span>&nbsp;<span class="op" id="7435639">&amp;</span><span class="ident" id="7435640"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435642">[</span><span class="num" id="7435643">0</span><span class="op" id="7435644">]</span><span class="op" id="7435645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435648">if</span>&nbsp;<span class="ident" id="7435651">s</span><span class="op" id="7435652">,</span>&nbsp;<span class="ident" id="7435654">ok</span>&nbsp;<span class="op" id="7435657">:=</span>&nbsp;<span class="ident" id="7435660"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435665">.</span><span class="ident" id="7435666">Get</span><span class="op" id="7435669">(</span><span class="ident" id="7435670"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435674">[</span><span class="num" id="7435675">3</span><span class="op" id="7435676">]</span><span class="op" id="7435677">)</span><span class="op" id="7435678">;</span>&nbsp;<span class="ident" id="7435680"><a href="/crypto/tls/handshake_client_test.go.html#7435654">ok</a></span>&nbsp;<span class="op" id="7435683">||</span>&nbsp;<span class="ident" id="7435686"><a href="/crypto/tls/handshake_client_test.go.html#7435651">s</a></span>&nbsp;<span class="op" id="7435688">!=</span>&nbsp;<span class="ident" id="7435691">nil</span>&nbsp;<span class="op" id="7435695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435699"><a href="/crypto/tls/handshake_client_test.go.html#7434835">t</a></span><span class="op" id="7435700">.</span><span class="ident" id="7435701">Fatalf</span><span class="op" id="7435707">(</span><span class="string" id="7435708">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7435749">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7435756">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435785"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435790">.</span><span class="ident" id="7435791">Put</span><span class="op" id="7435794">(</span><span class="ident" id="7435795"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435799">[</span><span class="num" id="7435800">0</span><span class="op" id="7435801">]</span><span class="op" id="7435802">,</span>&nbsp;<span class="op" id="7435804">&amp;</span><span class="ident" id="7435805"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435807">[</span><span class="num" id="7435808">3</span><span class="op" id="7435809">]</span><span class="op" id="7435810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435813">if</span>&nbsp;<span class="ident" id="7435816">s</span><span class="op" id="7435817">,</span>&nbsp;<span class="ident" id="7435819">ok</span>&nbsp;<span class="op" id="7435822">:=</span>&nbsp;<span class="ident" id="7435825"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435830">.</span><span class="ident" id="7435831">Get</span><span class="op" id="7435834">(</span><span class="ident" id="7435835"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435839">[</span><span class="num" id="7435840">0</span><span class="op" id="7435841">]</span><span class="op" id="7435842">)</span><span class="op" id="7435843">;</span>&nbsp;<span class="op" id="7435845">!</span><span class="ident" id="7435846"><a href="/crypto/tls/handshake_client_test.go.html#7435819">ok</a></span>&nbsp;<span class="op" id="7435849">||</span>&nbsp;<span class="ident" id="7435852"><a href="/crypto/tls/handshake_client_test.go.html#7435816">s</a></span>&nbsp;<span class="op" id="7435854">!=</span>&nbsp;<span class="op" id="7435857">&amp;</span><span class="ident" id="7435858"><a href="/crypto/tls/handshake_client_test.go.html#7434926">cs</a></span><span class="op" id="7435860">[</span><span class="num" id="7435861">3</span><span class="op" id="7435862">]</span>&nbsp;<span class="op" id="7435864">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435868"><a href="/crypto/tls/handshake_client_test.go.html#7434835">t</a></span><span class="op" id="7435869">.</span><span class="ident" id="7435870">Fatalf</span><span class="op" id="7435876">(</span><span class="string" id="7435877">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7435916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7435923">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435956"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435961">.</span><span class="ident" id="7435962">Put</span><span class="op" id="7435965">(</span><span class="ident" id="7435966"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7435970">[</span><span class="num" id="7435971">0</span><span class="op" id="7435972">]</span><span class="op" id="7435973">,</span>&nbsp;<span class="ident" id="7435975">nil</span><span class="op" id="7435978">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435981">if</span>&nbsp;<span class="ident" id="7435984">s</span><span class="op" id="7435985">,</span>&nbsp;<span class="ident" id="7435987">ok</span>&nbsp;<span class="op" id="7435990">:=</span>&nbsp;<span class="ident" id="7435993"><a href="/crypto/tls/handshake_client_test.go.html#7434888">cache</a></span><span class="op" id="7435998">.</span><span class="ident" id="7435999">Get</span><span class="op" id="7436002">(</span><span class="ident" id="7436003"><a href="/crypto/tls/handshake_client_test.go.html#7434963">keys</a></span><span class="op" id="7436007">[</span><span class="num" id="7436008">0</span><span class="op" id="7436009">]</span><span class="op" id="7436010">)</span><span class="op" id="7436011">;</span>&nbsp;<span class="op" id="7436013">!</span><span class="ident" id="7436014"><a href="/crypto/tls/handshake_client_test.go.html#7435987">ok</a></span>&nbsp;<span class="op" id="7436017">||</span>&nbsp;<span class="ident" id="7436020"><a href="/crypto/tls/handshake_client_test.go.html#7435984">s</a></span>&nbsp;<span class="op" id="7436022">!=</span>&nbsp;<span class="ident" id="7436025">nil</span>&nbsp;<span class="op" id="7436029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436033"><a href="/crypto/tls/handshake_client_test.go.html#7434835">t</a></span><span class="op" id="7436034">.</span><span class="ident" id="7436035">Fatalf</span><span class="op" id="7436041">(</span><span class="string" id="7436042">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7436076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7436079">}</span><br>
<span class="lineno"></span><span class="op" id="7436081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7436084">func</span>&nbsp;<span class="ident" id="7436089">TestHandshakeClientALPNMatch</span><span class="op" id="7436117">(</span><span class="ident" id="7436118">t</span>&nbsp;<span class="op" id="7436120">*</span><span class="ident" id="7436121"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7436128">.</span><span class="ident" id="7436129">T</span><span class="op" id="7436130">)</span>&nbsp;<span class="op" id="7436132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436135">config</span>&nbsp;<span class="op" id="7436142">:=</span>&nbsp;<span class="op" id="7436145">*</span><span class="ident" id="7436146"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436158"><a href="/crypto/tls/handshake_client_test.go.html#7436135">config</a></span><span class="op" id="7436164">.</span><span class="ident" id="7436165">NextProtos</span>&nbsp;<span class="op" id="7436176">=</span>&nbsp;<span class="op" id="7436178">[</span><span class="op" id="7436179">]</span><span class="builtintype" id="7436180">string</span><span class="op" id="7436186">{</span><span class="string" id="7436187">&#34;proto2&#34;</span><span class="op" id="7436195">,</span>&nbsp;<span class="string" id="7436197">&#34;proto1&#34;</span><span class="op" id="7436205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436209">test</span>&nbsp;<span class="op" id="7436214">:=</span>&nbsp;<span class="op" id="7436217">&amp;</span><span class="ident" id="7436218"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7436228">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436232">name</span><span class="op" id="7436236">:</span>&nbsp;<span class="string" id="7436238">&#34;ALPN&#34;</span><span class="op" id="7436244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7436248">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7436314">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436357">command</span><span class="op" id="7436364">:</span>&nbsp;<span class="op" id="7436366">[</span><span class="op" id="7436367">]</span><span class="builtintype" id="7436368">string</span><span class="op" id="7436374">{</span><span class="string" id="7436375">&#34;openssl&#34;</span><span class="op" id="7436384">,</span>&nbsp;<span class="string" id="7436386">&#34;s_server&#34;</span><span class="op" id="7436396">,</span>&nbsp;<span class="string" id="7436398">&#34;-alpn&#34;</span><span class="op" id="7436405">,</span>&nbsp;<span class="string" id="7436407">&#34;proto1,proto2&#34;</span><span class="op" id="7436422">}</span><span class="op" id="7436423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436427">config</span><span class="op" id="7436433">:</span>&nbsp;&nbsp;<span class="op" id="7436436">&amp;</span><span class="ident" id="7436437"><a href="/crypto/tls/handshake_client_test.go.html#7436135">config</a></span><span class="op" id="7436443">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436447">validate</span><span class="op" id="7436455">:</span>&nbsp;<span class="keyword" id="7436457">func</span><span class="op" id="7436461">(</span><span class="ident" id="7436462">state</span>&nbsp;<span class="ident" id="7436468"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7436483">)</span>&nbsp;<span class="builtintype" id="7436485">error</span>&nbsp;<span class="op" id="7436491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7436496">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7436555">if</span>&nbsp;<span class="ident" id="7436558"><a href="/crypto/tls/handshake_client_test.go.html#7436462">state</a></span><span class="op" id="7436563">.</span><span class="ident" id="7436564">NegotiatedProtocol</span>&nbsp;<span class="op" id="7436583">!=</span>&nbsp;<span class="string" id="7436586">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7436595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7436601">return</span>&nbsp;<span class="ident" id="7436608"><a href="/crypto/tls/handshake_client_test.go.html#7423921">fmt</a></span><span class="op" id="7436611">.</span><span class="ident" id="7436612">Errorf</span><span class="op" id="7436618">(</span><span class="string" id="7436619">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7436651">,</span>&nbsp;<span class="ident" id="7436653"><a href="/crypto/tls/handshake_client_test.go.html#7436462">state</a></span><span class="op" id="7436658">.</span><span class="ident" id="7436659">NegotiatedProtocol</span><span class="op" id="7436677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7436682">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7436687">return</span>&nbsp;<span class="ident" id="7436694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7436700">}</span><span class="op" id="7436701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7436704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436707"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7436725">(</span><span class="ident" id="7436726"><a href="/crypto/tls/handshake_client_test.go.html#7436118">t</a></span><span class="op" id="7436727">,</span>&nbsp;<span class="ident" id="7436729"><a href="/crypto/tls/handshake_client_test.go.html#7436209">test</a></span><span class="op" id="7436733">)</span><br>
<span class="lineno"></span><span class="op" id="7436735">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7436738">func</span>&nbsp;<span class="ident" id="7436743">TestHandshakeClientALPNNoMatch</span><span class="op" id="7436773">(</span><span class="ident" id="7436774">t</span>&nbsp;<span class="op" id="7436776">*</span><span class="ident" id="7436777"><a href="/crypto/tls/handshake_client_test.go.html#7423986">testing</a></span><span class="op" id="7436784">.</span><span class="ident" id="7436785">T</span><span class="op" id="7436786">)</span>&nbsp;<span class="op" id="7436788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436791">config</span>&nbsp;<span class="op" id="7436798">:=</span>&nbsp;<span class="op" id="7436801">*</span><span class="ident" id="7436802"><a href="/crypto/tls/handshake_server_test.go.html#7444411">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436814"><a href="/crypto/tls/handshake_client_test.go.html#7436791">config</a></span><span class="op" id="7436820">.</span><span class="ident" id="7436821">NextProtos</span>&nbsp;<span class="op" id="7436832">=</span>&nbsp;<span class="op" id="7436834">[</span><span class="op" id="7436835">]</span><span class="builtintype" id="7436836">string</span><span class="op" id="7436842">{</span><span class="string" id="7436843">&#34;proto3&#34;</span><span class="op" id="7436851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436855">test</span>&nbsp;<span class="op" id="7436860">:=</span>&nbsp;<span class="op" id="7436863">&amp;</span><span class="ident" id="7436864"><a href="/crypto/tls/handshake_client_test.go.html#7424394">clientTest</a></span><span class="op" id="7436874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436878">name</span><span class="op" id="7436882">:</span>&nbsp;<span class="string" id="7436884">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7436898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7436902">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7436968">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437011">command</span><span class="op" id="7437018">:</span>&nbsp;<span class="op" id="7437020">[</span><span class="op" id="7437021">]</span><span class="builtintype" id="7437022">string</span><span class="op" id="7437028">{</span><span class="string" id="7437029">&#34;openssl&#34;</span><span class="op" id="7437038">,</span>&nbsp;<span class="string" id="7437040">&#34;s_server&#34;</span><span class="op" id="7437050">,</span>&nbsp;<span class="string" id="7437052">&#34;-alpn&#34;</span><span class="op" id="7437059">,</span>&nbsp;<span class="string" id="7437061">&#34;proto1,proto2&#34;</span><span class="op" id="7437076">}</span><span class="op" id="7437077">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437081">config</span><span class="op" id="7437087">:</span>&nbsp;&nbsp;<span class="op" id="7437090">&amp;</span><span class="ident" id="7437091"><a href="/crypto/tls/handshake_client_test.go.html#7436791">config</a></span><span class="op" id="7437097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437101">validate</span><span class="op" id="7437109">:</span>&nbsp;<span class="keyword" id="7437111">func</span><span class="op" id="7437115">(</span><span class="ident" id="7437116">state</span>&nbsp;<span class="ident" id="7437122"><a href="/crypto/tls/common.go.html#3826826">ConnectionState</a></span><span class="op" id="7437137">)</span>&nbsp;<span class="builtintype" id="7437139">error</span>&nbsp;<span class="op" id="7437145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7437150">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437214">if</span>&nbsp;<span class="ident" id="7437217"><a href="/crypto/tls/handshake_client_test.go.html#7437116">state</a></span><span class="op" id="7437222">.</span><span class="ident" id="7437223">NegotiatedProtocol</span>&nbsp;<span class="op" id="7437242">!=</span>&nbsp;<span class="string" id="7437245">&#34;&#34;</span>&nbsp;<span class="op" id="7437248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437254">return</span>&nbsp;<span class="ident" id="7437261"><a href="/crypto/tls/handshake_client_test.go.html#7423921">fmt</a></span><span class="op" id="7437264">.</span><span class="ident" id="7437265">Errorf</span><span class="op" id="7437271">(</span><span class="string" id="7437272">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7437300">,</span>&nbsp;<span class="ident" id="7437302"><a href="/crypto/tls/handshake_client_test.go.html#7437116">state</a></span><span class="op" id="7437307">.</span><span class="ident" id="7437308">NegotiatedProtocol</span><span class="op" id="7437326">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437336">return</span>&nbsp;<span class="ident" id="7437343">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437349">}</span><span class="op" id="7437350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437356"><a href="/crypto/tls/handshake_client_test.go.html#7430809">runClientTestTLS12</a></span><span class="op" id="7437374">(</span><span class="ident" id="7437375"><a href="/crypto/tls/handshake_client_test.go.html#7436774">t</a></span><span class="op" id="7437376">,</span>&nbsp;<span class="ident" id="7437378"><a href="/crypto/tls/handshake_client_test.go.html#7436855">test</a></span><span class="op" id="7437382">)</span><br>
<span class="lineno">490</span><span class="op" id="7437384">}</span>
</div>
</body>
</html>
