<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4043329">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4043385">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4043439">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4043490">package</span>&nbsp;<span class="ident" id="4043498">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4043506">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4043568">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4043588">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="4043662">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4043690">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4043765">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="4043803">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4043872">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="4043945">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="4044020">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4044072">//</span><br>
<span class="lineno"></span><span class="comment" id="4044075">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="4044091">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="4044160">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="4044239">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="4044318">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4044394">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4044473">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="4044551">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4044632">import</span>&nbsp;<span class="op" id="4044639">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4044642">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4044652">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="4044657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044660">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="4044734">const</span>&nbsp;<span class="op" id="4044740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044743">MaxVarintLen16</span>&nbsp;<span class="op" id="4044758">=</span>&nbsp;<span class="num" id="4044760">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044763">MaxVarintLen32</span>&nbsp;<span class="op" id="4044778">=</span>&nbsp;<span class="num" id="4044780">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044783">MaxVarintLen64</span>&nbsp;<span class="op" id="4044798">=</span>&nbsp;<span class="num" id="4044800">10</span><br>
<span class="lineno"></span><span class="op" id="4044803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044806">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="4044887">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4044941">func</span>&nbsp;<span class="ident" id="4044946">PutUvarint</span><span class="op" id="4044956">(</span><span class="ident" id="4044957">buf</span>&nbsp;<span class="op" id="4044961">[</span><span class="op" id="4044962">]</span><span class="builtintype" id="4044963">byte</span><span class="op" id="4044967">,</span>&nbsp;<span class="ident" id="4044969">x</span>&nbsp;<span class="ident" id="4044971">uint64</span><span class="op" id="4044977">)</span>&nbsp;<span class="builtintype" id="4044979">int</span>&nbsp;<span class="op" id="4044983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044986">i</span>&nbsp;<span class="op" id="4044988">:=</span>&nbsp;<span class="num" id="4044991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4044994">for</span>&nbsp;<span class="ident" id="4044998">x</span>&nbsp;<span class="op" id="4045000">&gt;=</span>&nbsp;<span class="num" id="4045003">0x80</span>&nbsp;<span class="op" id="4045008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045012">buf</span><span class="op" id="4045015">[</span><span class="ident" id="4045016">i</span><span class="op" id="4045017">]</span>&nbsp;<span class="op" id="4045019">=</span>&nbsp;<span class="builtintype" id="4045021">byte</span><span class="op" id="4045025">(</span><span class="ident" id="4045026">x</span><span class="op" id="4045027">)</span>&nbsp;<span class="op" id="4045029">|</span>&nbsp;<span class="num" id="4045031">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045038">x</span>&nbsp;<span class="op" id="4045040">&gt;&gt;=</span>&nbsp;<span class="num" id="4045044">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045048">i</span><span class="op" id="4045049">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045056">buf</span><span class="op" id="4045059">[</span><span class="ident" id="4045060">i</span><span class="op" id="4045061">]</span>&nbsp;<span class="op" id="4045063">=</span>&nbsp;<span class="builtintype" id="4045065">byte</span><span class="op" id="4045069">(</span><span class="ident" id="4045070">x</span><span class="op" id="4045071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045074">return</span>&nbsp;<span class="ident" id="4045081">i</span>&nbsp;<span class="op" id="4045083">+</span>&nbsp;<span class="num" id="4045085">1</span><br>
<span class="lineno">50</span><span class="op" id="4045087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4045090">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4045158">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4045226">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="4045272">//</span><br>
<span class="lineno"></span><span class="comment" id="4045275">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4045300">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4045348">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4045399">//</span><br>
<span class="lineno">60</span><span class="keyword" id="4045402">func</span>&nbsp;<span class="ident" id="4045407">Uvarint</span><span class="op" id="4045414">(</span><span class="ident" id="4045415">buf</span>&nbsp;<span class="op" id="4045419">[</span><span class="op" id="4045420">]</span><span class="builtintype" id="4045421">byte</span><span class="op" id="4045425">)</span>&nbsp;<span class="op" id="4045427">(</span><span class="ident" id="4045428">uint64</span><span class="op" id="4045434">,</span>&nbsp;<span class="builtintype" id="4045436">int</span><span class="op" id="4045439">)</span>&nbsp;<span class="op" id="4045441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045444">var</span>&nbsp;<span class="ident" id="4045448">x</span>&nbsp;<span class="ident" id="4045450">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045458">var</span>&nbsp;<span class="ident" id="4045462">s</span>&nbsp;<span class="builtintype" id="4045464">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045470">for</span>&nbsp;<span class="ident" id="4045474">i</span><span class="op" id="4045475">,</span>&nbsp;<span class="ident" id="4045477">b</span>&nbsp;<span class="op" id="4045479">:=</span>&nbsp;<span class="keyword" id="4045482">range</span>&nbsp;<span class="ident" id="4045488">buf</span>&nbsp;<span class="op" id="4045492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045496">if</span>&nbsp;<span class="ident" id="4045499">b</span>&nbsp;<span class="op" id="4045501">&lt;</span>&nbsp;<span class="num" id="4045503">0x80</span>&nbsp;<span class="op" id="4045508">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045513">if</span>&nbsp;<span class="ident" id="4045516">i</span>&nbsp;<span class="op" id="4045518">&gt;</span>&nbsp;<span class="num" id="4045520">9</span>&nbsp;<span class="op" id="4045522">||</span>&nbsp;<span class="ident" id="4045525">i</span>&nbsp;<span class="op" id="4045527">==</span>&nbsp;<span class="num" id="4045530">9</span>&nbsp;<span class="op" id="4045532">&amp;&amp;</span>&nbsp;<span class="ident" id="4045535">b</span>&nbsp;<span class="op" id="4045537">&gt;</span>&nbsp;<span class="num" id="4045539">1</span>&nbsp;<span class="op" id="4045541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045547">return</span>&nbsp;<span class="num" id="4045554">0</span><span class="op" id="4045555">,</span>&nbsp;<span class="op" id="4045557">-</span><span class="op" id="4045558">(</span><span class="ident" id="4045559">i</span>&nbsp;<span class="op" id="4045561">+</span>&nbsp;<span class="num" id="4045563">1</span><span class="op" id="4045564">)</span>&nbsp;<span class="comment" id="4045566">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045586">return</span>&nbsp;<span class="ident" id="4045593">x</span>&nbsp;<span class="op" id="4045595">|</span>&nbsp;<span class="ident" id="4045597">uint64</span><span class="op" id="4045603">(</span><span class="ident" id="4045604">b</span><span class="op" id="4045605">)</span><span class="op" id="4045606">&lt;&lt;</span><span class="ident" id="4045608">s</span><span class="op" id="4045609">,</span>&nbsp;<span class="ident" id="4045611">i</span>&nbsp;<span class="op" id="4045613">+</span>&nbsp;<span class="num" id="4045615">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045619">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045623">x</span>&nbsp;<span class="op" id="4045625">|=</span>&nbsp;<span class="ident" id="4045628">uint64</span><span class="op" id="4045634">(</span><span class="ident" id="4045635">b</span><span class="op" id="4045636">&amp;</span><span class="num" id="4045637">0x7f</span><span class="op" id="4045641">)</span>&nbsp;<span class="op" id="4045643">&lt;&lt;</span>&nbsp;<span class="ident" id="4045646">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045650">s</span>&nbsp;<span class="op" id="4045652">+=</span>&nbsp;<span class="num" id="4045655">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045661">return</span>&nbsp;<span class="num" id="4045668">0</span><span class="op" id="4045669">,</span>&nbsp;<span class="num" id="4045671">0</span><br>
<span class="lineno"></span><span class="op" id="4045673">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4045676">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4045756">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4045809">func</span>&nbsp;<span class="ident" id="4045814">PutVarint</span><span class="op" id="4045823">(</span><span class="ident" id="4045824">buf</span>&nbsp;<span class="op" id="4045828">[</span><span class="op" id="4045829">]</span><span class="builtintype" id="4045830">byte</span><span class="op" id="4045834">,</span>&nbsp;<span class="ident" id="4045836">x</span>&nbsp;<span class="ident" id="4045838">int64</span><span class="op" id="4045843">)</span>&nbsp;<span class="builtintype" id="4045845">int</span>&nbsp;<span class="op" id="4045849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045852">ux</span>&nbsp;<span class="op" id="4045855">:=</span>&nbsp;<span class="ident" id="4045858">uint64</span><span class="op" id="4045864">(</span><span class="ident" id="4045865">x</span><span class="op" id="4045866">)</span>&nbsp;<span class="op" id="4045868">&lt;&lt;</span>&nbsp;<span class="num" id="4045871">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045874">if</span>&nbsp;<span class="ident" id="4045877">x</span>&nbsp;<span class="op" id="4045879">&lt;</span>&nbsp;<span class="num" id="4045881">0</span>&nbsp;<span class="op" id="4045883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045887">ux</span>&nbsp;<span class="op" id="4045890">=</span>&nbsp;<span class="op" id="4045892">^</span><span class="ident" id="4045893">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045900">return</span>&nbsp;<span class="ident" id="4045907">PutUvarint</span><span class="op" id="4045917">(</span><span class="ident" id="4045918">buf</span><span class="op" id="4045921">,</span>&nbsp;<span class="ident" id="4045923">ux</span><span class="op" id="4045925">)</span><br>
<span class="lineno"></span><span class="op" id="4045927">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4045930">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4045997">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4046065">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="4046130">//</span><br>
<span class="lineno">90</span><span class="comment" id="4046133">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4046158">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4046206">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4046257">//</span><br>
<span class="lineno"></span><span class="keyword" id="4046260">func</span>&nbsp;<span class="ident" id="4046265">Varint</span><span class="op" id="4046271">(</span><span class="ident" id="4046272">buf</span>&nbsp;<span class="op" id="4046276">[</span><span class="op" id="4046277">]</span><span class="builtintype" id="4046278">byte</span><span class="op" id="4046282">)</span>&nbsp;<span class="op" id="4046284">(</span><span class="ident" id="4046285">int64</span><span class="op" id="4046290">,</span>&nbsp;<span class="builtintype" id="4046292">int</span><span class="op" id="4046295">)</span>&nbsp;<span class="op" id="4046297">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046300">ux</span><span class="op" id="4046302">,</span>&nbsp;<span class="ident" id="4046304">n</span>&nbsp;<span class="op" id="4046306">:=</span>&nbsp;<span class="ident" id="4046309">Uvarint</span><span class="op" id="4046316">(</span><span class="ident" id="4046317">buf</span><span class="op" id="4046320">)</span>&nbsp;<span class="comment" id="4046322">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046362">x</span>&nbsp;<span class="op" id="4046364">:=</span>&nbsp;<span class="ident" id="4046367">int64</span><span class="op" id="4046372">(</span><span class="ident" id="4046373">ux</span>&nbsp;<span class="op" id="4046376">&gt;&gt;</span>&nbsp;<span class="num" id="4046379">1</span><span class="op" id="4046380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046383">if</span>&nbsp;<span class="ident" id="4046386">ux</span><span class="op" id="4046388">&amp;</span><span class="num" id="4046389">1</span>&nbsp;<span class="op" id="4046391">!=</span>&nbsp;<span class="num" id="4046394">0</span>&nbsp;<span class="op" id="4046396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046400">x</span>&nbsp;<span class="op" id="4046402">=</span>&nbsp;<span class="op" id="4046404">^</span><span class="ident" id="4046405">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046408">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046411">return</span>&nbsp;<span class="ident" id="4046418">x</span><span class="op" id="4046419">,</span>&nbsp;<span class="ident" id="4046421">n</span><br>
<span class="lineno"></span><span class="op" id="4046423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046426">var</span>&nbsp;<span class="ident" id="4046430">overflow</span>&nbsp;<span class="op" id="4046439">=</span>&nbsp;<span class="ident" id="4046441">errors</span><span class="op" id="4046447">.</span><span class="ident" id="4046448">New</span><span class="op" id="4046451">(</span><span class="string" id="4046452">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="4046495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4046498">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="4046582">func</span>&nbsp;<span class="ident" id="4046587">ReadUvarint</span><span class="op" id="4046598">(</span><span class="ident" id="4046599">r</span>&nbsp;<span class="ident" id="4046601">io</span><span class="op" id="4046603">.</span><span class="ident" id="4046604">ByteReader</span><span class="op" id="4046614">)</span>&nbsp;<span class="op" id="4046616">(</span><span class="ident" id="4046617">uint64</span><span class="op" id="4046623">,</span>&nbsp;<span class="builtintype" id="4046625">error</span><span class="op" id="4046630">)</span>&nbsp;<span class="op" id="4046632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046635">var</span>&nbsp;<span class="ident" id="4046639">x</span>&nbsp;<span class="ident" id="4046641">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046649">var</span>&nbsp;<span class="ident" id="4046653">s</span>&nbsp;<span class="builtintype" id="4046655">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046661">for</span>&nbsp;<span class="ident" id="4046665">i</span>&nbsp;<span class="op" id="4046667">:=</span>&nbsp;<span class="num" id="4046670">0</span><span class="op" id="4046671">;</span>&nbsp;<span class="op" id="4046673">;</span>&nbsp;<span class="ident" id="4046675">i</span><span class="op" id="4046676">++</span>&nbsp;<span class="op" id="4046679">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046683">b</span><span class="op" id="4046684">,</span>&nbsp;<span class="ident" id="4046686">err</span>&nbsp;<span class="op" id="4046690">:=</span>&nbsp;<span class="ident" id="4046693">r</span><span class="op" id="4046694">.</span><span class="ident" id="4046695">ReadByte</span><span class="op" id="4046703">(</span><span class="op" id="4046704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046708">if</span>&nbsp;<span class="ident" id="4046711">err</span>&nbsp;<span class="op" id="4046715">!=</span>&nbsp;<span class="ident" id="4046718">nil</span>&nbsp;<span class="op" id="4046722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046727">return</span>&nbsp;<span class="ident" id="4046734">x</span><span class="op" id="4046735">,</span>&nbsp;<span class="ident" id="4046737">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046747">if</span>&nbsp;<span class="ident" id="4046750">b</span>&nbsp;<span class="op" id="4046752">&lt;</span>&nbsp;<span class="num" id="4046754">0x80</span>&nbsp;<span class="op" id="4046759">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046764">if</span>&nbsp;<span class="ident" id="4046767">i</span>&nbsp;<span class="op" id="4046769">&gt;</span>&nbsp;<span class="num" id="4046771">9</span>&nbsp;<span class="op" id="4046773">||</span>&nbsp;<span class="ident" id="4046776">i</span>&nbsp;<span class="op" id="4046778">==</span>&nbsp;<span class="num" id="4046781">9</span>&nbsp;<span class="op" id="4046783">&amp;&amp;</span>&nbsp;<span class="ident" id="4046786">b</span>&nbsp;<span class="op" id="4046788">&gt;</span>&nbsp;<span class="num" id="4046790">1</span>&nbsp;<span class="op" id="4046792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046798">return</span>&nbsp;<span class="ident" id="4046805">x</span><span class="op" id="4046806">,</span>&nbsp;<span class="ident" id="4046808">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046825">return</span>&nbsp;<span class="ident" id="4046832">x</span>&nbsp;<span class="op" id="4046834">|</span>&nbsp;<span class="ident" id="4046836">uint64</span><span class="op" id="4046842">(</span><span class="ident" id="4046843">b</span><span class="op" id="4046844">)</span><span class="op" id="4046845">&lt;&lt;</span><span class="ident" id="4046847">s</span><span class="op" id="4046848">,</span>&nbsp;<span class="ident" id="4046850">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046856">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046860">x</span>&nbsp;<span class="op" id="4046862">|=</span>&nbsp;<span class="ident" id="4046865">uint64</span><span class="op" id="4046871">(</span><span class="ident" id="4046872">b</span><span class="op" id="4046873">&amp;</span><span class="num" id="4046874">0x7f</span><span class="op" id="4046878">)</span>&nbsp;<span class="op" id="4046880">&lt;&lt;</span>&nbsp;<span class="ident" id="4046883">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046887">s</span>&nbsp;<span class="op" id="4046889">+=</span>&nbsp;<span class="num" id="4046892">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046895">}</span><br>
<span class="lineno"></span><span class="op" id="4046897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4046900">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="4046981">func</span>&nbsp;<span class="ident" id="4046986">ReadVarint</span><span class="op" id="4046996">(</span><span class="ident" id="4046997">r</span>&nbsp;<span class="ident" id="4046999">io</span><span class="op" id="4047001">.</span><span class="ident" id="4047002">ByteReader</span><span class="op" id="4047012">)</span>&nbsp;<span class="op" id="4047014">(</span><span class="ident" id="4047015">int64</span><span class="op" id="4047020">,</span>&nbsp;<span class="builtintype" id="4047022">error</span><span class="op" id="4047027">)</span>&nbsp;<span class="op" id="4047029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047032">ux</span><span class="op" id="4047034">,</span>&nbsp;<span class="ident" id="4047036">err</span>&nbsp;<span class="op" id="4047040">:=</span>&nbsp;<span class="ident" id="4047043">ReadUvarint</span><span class="op" id="4047054">(</span><span class="ident" id="4047055">r</span><span class="op" id="4047056">)</span>&nbsp;<span class="comment" id="4047058">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047098">x</span>&nbsp;<span class="op" id="4047100">:=</span>&nbsp;<span class="ident" id="4047103">int64</span><span class="op" id="4047108">(</span><span class="ident" id="4047109">ux</span>&nbsp;<span class="op" id="4047112">&gt;&gt;</span>&nbsp;<span class="num" id="4047115">1</span><span class="op" id="4047116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047119">if</span>&nbsp;<span class="ident" id="4047122">ux</span><span class="op" id="4047124">&amp;</span><span class="num" id="4047125">1</span>&nbsp;<span class="op" id="4047127">!=</span>&nbsp;<span class="num" id="4047130">0</span>&nbsp;<span class="op" id="4047132">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047136">x</span>&nbsp;<span class="op" id="4047138">=</span>&nbsp;<span class="op" id="4047140">^</span><span class="ident" id="4047141">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4047144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047147">return</span>&nbsp;<span class="ident" id="4047154">x</span><span class="op" id="4047155">,</span>&nbsp;<span class="ident" id="4047157">err</span><br>
<span class="lineno"></span><span class="op" id="4047161">}</span>
</div>
</body>
</html>
