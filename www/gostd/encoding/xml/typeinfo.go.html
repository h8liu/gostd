<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5015087">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5015143">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5015197">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5015248">package</span>&nbsp;<span class="ident" id="5015256">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015261">import</span>&nbsp;<span class="op" id="5015268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5015271">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5015278">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5015289">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5015300">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5015307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5015310">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="5015374">type</span>&nbsp;<span class="ident" id="5015379">typeInfo</span>&nbsp;<span class="keyword" id="5015388">struct</span>&nbsp;<span class="op" id="5015395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015398">xmlname</span>&nbsp;<span class="op" id="5015406">*</span><span class="ident" id="5015407">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015418">fields</span>&nbsp;&nbsp;<span class="op" id="5015426">[</span><span class="op" id="5015427">]</span><span class="ident" id="5015428">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="5015438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5015441">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5015514">type</span>&nbsp;<span class="ident" id="5015519">fieldInfo</span>&nbsp;<span class="keyword" id="5015529">struct</span>&nbsp;<span class="op" id="5015536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015539">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015547">[</span><span class="op" id="5015548">]</span><span class="builtintype" id="5015549">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015554">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5015562">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015570">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5015578">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015586">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5015594">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015606">parents</span>&nbsp;<span class="op" id="5015614">[</span><span class="op" id="5015615">]</span><span class="builtintype" id="5015616">string</span><br>
<span class="lineno"></span><span class="op" id="5015623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015626">type</span>&nbsp;<span class="ident" id="5015631">fieldFlags</span>&nbsp;<span class="builtintype" id="5015642">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5015647">const</span>&nbsp;<span class="op" id="5015653">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015656">fElement</span>&nbsp;<span class="ident" id="5015665">fieldFlags</span>&nbsp;<span class="op" id="5015676">=</span>&nbsp;<span class="num" id="5015678">1</span>&nbsp;<span class="op" id="5015680">&lt;&lt;</span>&nbsp;<span class="ident" id="5015683">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015689">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015696">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015707">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015718">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015728">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015735">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015748">fMode</span>&nbsp;<span class="op" id="5015754">=</span>&nbsp;<span class="ident" id="5015756">fElement</span>&nbsp;<span class="op" id="5015765">|</span>&nbsp;<span class="ident" id="5015767">fAttr</span>&nbsp;<span class="op" id="5015773">|</span>&nbsp;<span class="ident" id="5015775">fCharData</span>&nbsp;<span class="op" id="5015785">|</span>&nbsp;<span class="ident" id="5015787">fInnerXml</span>&nbsp;<span class="op" id="5015797">|</span>&nbsp;<span class="ident" id="5015799">fComment</span>&nbsp;<span class="op" id="5015808">|</span>&nbsp;<span class="ident" id="5015810">fAny</span><br>
<span class="lineno"></span><span class="op" id="5015815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015818">var</span>&nbsp;<span class="ident" id="5015822">tinfoMap</span>&nbsp;<span class="op" id="5015831">=</span>&nbsp;<span class="builtinfunc" id="5015833">make</span><span class="op" id="5015837">(</span><span class="keyword" id="5015838">map</span><span class="op" id="5015841">[</span><span class="ident" id="5015842">reflect</span><span class="op" id="5015849">.</span><span class="ident" id="5015850">Type</span><span class="op" id="5015854">]</span><span class="op" id="5015855">*</span><span class="ident" id="5015856">typeInfo</span><span class="op" id="5015864">)</span><br>
<span class="lineno">45</span><span class="keyword" id="5015866">var</span>&nbsp;<span class="ident" id="5015870">tinfoLock</span>&nbsp;<span class="ident" id="5015880">sync</span><span class="op" id="5015884">.</span><span class="ident" id="5015885">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015894">var</span>&nbsp;<span class="ident" id="5015898">nameType</span>&nbsp;<span class="op" id="5015907">=</span>&nbsp;<span class="ident" id="5015909">reflect</span><span class="op" id="5015916">.</span><span class="ident" id="5015917">TypeOf</span><span class="op" id="5015923">(</span><span class="ident" id="5015924">Name</span><span class="op" id="5015928">{</span><span class="op" id="5015929">}</span><span class="op" id="5015930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5015933">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="5016002">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="5016044">func</span>&nbsp;<span class="ident" id="5016049">getTypeInfo</span><span class="op" id="5016060">(</span><span class="ident" id="5016061">typ</span>&nbsp;<span class="ident" id="5016065">reflect</span><span class="op" id="5016072">.</span><span class="ident" id="5016073">Type</span><span class="op" id="5016077">)</span>&nbsp;<span class="op" id="5016079">(</span><span class="op" id="5016080">*</span><span class="ident" id="5016081">typeInfo</span><span class="op" id="5016089">,</span>&nbsp;<span class="builtintype" id="5016091">error</span><span class="op" id="5016096">)</span>&nbsp;<span class="op" id="5016098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016101">tinfoLock</span><span class="op" id="5016110">.</span><span class="ident" id="5016111">RLock</span><span class="op" id="5016116">(</span><span class="op" id="5016117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016120">tinfo</span><span class="op" id="5016125">,</span>&nbsp;<span class="ident" id="5016127">ok</span>&nbsp;<span class="op" id="5016130">:=</span>&nbsp;<span class="ident" id="5016133">tinfoMap</span><span class="op" id="5016141">[</span><span class="ident" id="5016142">typ</span><span class="op" id="5016145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016148">tinfoLock</span><span class="op" id="5016157">.</span><span class="ident" id="5016158">RUnlock</span><span class="op" id="5016165">(</span><span class="op" id="5016166">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016169">if</span>&nbsp;<span class="ident" id="5016172">ok</span>&nbsp;<span class="op" id="5016175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016179">return</span>&nbsp;<span class="ident" id="5016186">tinfo</span><span class="op" id="5016191">,</span>&nbsp;<span class="ident" id="5016193">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016201">tinfo</span>&nbsp;<span class="op" id="5016207">=</span>&nbsp;<span class="op" id="5016209">&amp;</span><span class="ident" id="5016210">typeInfo</span><span class="op" id="5016218">{</span><span class="op" id="5016219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016222">if</span>&nbsp;<span class="ident" id="5016225">typ</span><span class="op" id="5016228">.</span><span class="ident" id="5016229">Kind</span><span class="op" id="5016233">(</span><span class="op" id="5016234">)</span>&nbsp;<span class="op" id="5016236">==</span>&nbsp;<span class="ident" id="5016239">reflect</span><span class="op" id="5016246">.</span><span class="ident" id="5016247">Struct</span>&nbsp;<span class="op" id="5016254">&amp;&amp;</span>&nbsp;<span class="ident" id="5016257">typ</span>&nbsp;<span class="op" id="5016261">!=</span>&nbsp;<span class="ident" id="5016264">nameType</span>&nbsp;<span class="op" id="5016273">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016277">n</span>&nbsp;<span class="op" id="5016279">:=</span>&nbsp;<span class="ident" id="5016282">typ</span><span class="op" id="5016285">.</span><span class="ident" id="5016286">NumField</span><span class="op" id="5016294">(</span><span class="op" id="5016295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016299">for</span>&nbsp;<span class="ident" id="5016303">i</span>&nbsp;<span class="op" id="5016305">:=</span>&nbsp;<span class="num" id="5016308">0</span><span class="op" id="5016309">;</span>&nbsp;<span class="ident" id="5016311">i</span>&nbsp;<span class="op" id="5016313">&lt;</span>&nbsp;<span class="ident" id="5016315">n</span><span class="op" id="5016316">;</span>&nbsp;<span class="ident" id="5016318">i</span><span class="op" id="5016319">++</span>&nbsp;<span class="op" id="5016322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016327">f</span>&nbsp;<span class="op" id="5016329">:=</span>&nbsp;<span class="ident" id="5016332">typ</span><span class="op" id="5016335">.</span><span class="ident" id="5016336">Field</span><span class="op" id="5016341">(</span><span class="ident" id="5016342">i</span><span class="op" id="5016343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016348">if</span>&nbsp;<span class="ident" id="5016351">f</span><span class="op" id="5016352">.</span><span class="ident" id="5016353">PkgPath</span>&nbsp;<span class="op" id="5016361">!=</span>&nbsp;<span class="string" id="5016364">&#34;&#34;</span>&nbsp;<span class="op" id="5016367">||</span>&nbsp;<span class="ident" id="5016370">f</span><span class="op" id="5016371">.</span><span class="ident" id="5016372">Tag</span><span class="op" id="5016375">.</span><span class="ident" id="5016376">Get</span><span class="op" id="5016379">(</span><span class="string" id="5016380">&#34;xml&#34;</span><span class="op" id="5016385">)</span>&nbsp;<span class="op" id="5016387">==</span>&nbsp;<span class="string" id="5016390">&#34;-&#34;</span>&nbsp;<span class="op" id="5016394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016400">continue</span>&nbsp;<span class="comment" id="5016409">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016435">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016481">if</span>&nbsp;<span class="ident" id="5016484">f</span><span class="op" id="5016485">.</span><span class="ident" id="5016486">Anonymous</span>&nbsp;<span class="op" id="5016496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016502">t</span>&nbsp;<span class="op" id="5016504">:=</span>&nbsp;<span class="ident" id="5016507">f</span><span class="op" id="5016508">.</span><span class="ident" id="5016509">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016518">if</span>&nbsp;<span class="ident" id="5016521">t</span><span class="op" id="5016522">.</span><span class="ident" id="5016523">Kind</span><span class="op" id="5016527">(</span><span class="op" id="5016528">)</span>&nbsp;<span class="op" id="5016530">==</span>&nbsp;<span class="ident" id="5016533">reflect</span><span class="op" id="5016540">.</span><span class="ident" id="5016541">Ptr</span>&nbsp;<span class="op" id="5016545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016552">t</span>&nbsp;<span class="op" id="5016554">=</span>&nbsp;<span class="ident" id="5016556">t</span><span class="op" id="5016557">.</span><span class="ident" id="5016558">Elem</span><span class="op" id="5016562">(</span><span class="op" id="5016563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016575">if</span>&nbsp;<span class="ident" id="5016578">t</span><span class="op" id="5016579">.</span><span class="ident" id="5016580">Kind</span><span class="op" id="5016584">(</span><span class="op" id="5016585">)</span>&nbsp;<span class="op" id="5016587">==</span>&nbsp;<span class="ident" id="5016590">reflect</span><span class="op" id="5016597">.</span><span class="ident" id="5016598">Struct</span>&nbsp;<span class="op" id="5016605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016612">inner</span><span class="op" id="5016617">,</span>&nbsp;<span class="ident" id="5016619">err</span>&nbsp;<span class="op" id="5016623">:=</span>&nbsp;<span class="ident" id="5016626">getTypeInfo</span><span class="op" id="5016637">(</span><span class="ident" id="5016638">t</span><span class="op" id="5016639">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016646">if</span>&nbsp;<span class="ident" id="5016649">err</span>&nbsp;<span class="op" id="5016653">!=</span>&nbsp;<span class="ident" id="5016656">nil</span>&nbsp;<span class="op" id="5016660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016668">return</span>&nbsp;<span class="ident" id="5016675">nil</span><span class="op" id="5016678">,</span>&nbsp;<span class="ident" id="5016680">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016696">if</span>&nbsp;<span class="ident" id="5016699">tinfo</span><span class="op" id="5016704">.</span><span class="ident" id="5016705">xmlname</span>&nbsp;<span class="op" id="5016713">==</span>&nbsp;<span class="ident" id="5016716">nil</span>&nbsp;<span class="op" id="5016720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016728">tinfo</span><span class="op" id="5016733">.</span><span class="ident" id="5016734">xmlname</span>&nbsp;<span class="op" id="5016742">=</span>&nbsp;<span class="ident" id="5016744">inner</span><span class="op" id="5016749">.</span><span class="ident" id="5016750">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016770">for</span>&nbsp;<span class="ident" id="5016774">_</span><span class="op" id="5016775">,</span>&nbsp;<span class="ident" id="5016777">finfo</span>&nbsp;<span class="op" id="5016783">:=</span>&nbsp;<span class="keyword" id="5016786">range</span>&nbsp;<span class="ident" id="5016792">inner</span><span class="op" id="5016797">.</span><span class="ident" id="5016798">fields</span>&nbsp;<span class="op" id="5016805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016813">finfo</span><span class="op" id="5016818">.</span><span class="ident" id="5016819">idx</span>&nbsp;<span class="op" id="5016823">=</span>&nbsp;<span class="builtinfunc" id="5016825">append</span><span class="op" id="5016831">(</span><span class="op" id="5016832">[</span><span class="op" id="5016833">]</span><span class="builtintype" id="5016834">int</span><span class="op" id="5016837">{</span><span class="ident" id="5016838">i</span><span class="op" id="5016839">}</span><span class="op" id="5016840">,</span>&nbsp;<span class="ident" id="5016842">finfo</span><span class="op" id="5016847">.</span><span class="ident" id="5016848">idx</span><span class="op" id="5016851">...</span><span class="op" id="5016854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016862">if</span>&nbsp;<span class="ident" id="5016865">err</span>&nbsp;<span class="op" id="5016869">:=</span>&nbsp;<span class="ident" id="5016872">addFieldInfo</span><span class="op" id="5016884">(</span><span class="ident" id="5016885">typ</span><span class="op" id="5016888">,</span>&nbsp;<span class="ident" id="5016890">tinfo</span><span class="op" id="5016895">,</span>&nbsp;<span class="op" id="5016897">&amp;</span><span class="ident" id="5016898">finfo</span><span class="op" id="5016903">)</span><span class="op" id="5016904">;</span>&nbsp;<span class="ident" id="5016906">err</span>&nbsp;<span class="op" id="5016910">!=</span>&nbsp;<span class="ident" id="5016913">nil</span>&nbsp;<span class="op" id="5016917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016926">return</span>&nbsp;<span class="ident" id="5016933">nil</span><span class="op" id="5016936">,</span>&nbsp;<span class="ident" id="5016938">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016962">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016980">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016986">finfo</span><span class="op" id="5016991">,</span>&nbsp;<span class="ident" id="5016993">err</span>&nbsp;<span class="op" id="5016997">:=</span>&nbsp;<span class="ident" id="5017000">structFieldInfo</span><span class="op" id="5017015">(</span><span class="ident" id="5017016">typ</span><span class="op" id="5017019">,</span>&nbsp;<span class="op" id="5017021">&amp;</span><span class="ident" id="5017022">f</span><span class="op" id="5017023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017028">if</span>&nbsp;<span class="ident" id="5017031">err</span>&nbsp;<span class="op" id="5017035">!=</span>&nbsp;<span class="ident" id="5017038">nil</span>&nbsp;<span class="op" id="5017042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017048">return</span>&nbsp;<span class="ident" id="5017055">nil</span><span class="op" id="5017058">,</span>&nbsp;<span class="ident" id="5017060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017067">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017073">if</span>&nbsp;<span class="ident" id="5017076">f</span><span class="op" id="5017077">.</span><span class="ident" id="5017078">Name</span>&nbsp;<span class="op" id="5017083">==</span>&nbsp;<span class="string" id="5017086">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5017096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017102">tinfo</span><span class="op" id="5017107">.</span><span class="ident" id="5017108">xmlname</span>&nbsp;<span class="op" id="5017116">=</span>&nbsp;<span class="ident" id="5017118">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017128">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017140">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017146">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017208">if</span>&nbsp;<span class="ident" id="5017211">err</span>&nbsp;<span class="op" id="5017215">:=</span>&nbsp;<span class="ident" id="5017218">addFieldInfo</span><span class="op" id="5017230">(</span><span class="ident" id="5017231">typ</span><span class="op" id="5017234">,</span>&nbsp;<span class="ident" id="5017236">tinfo</span><span class="op" id="5017241">,</span>&nbsp;<span class="ident" id="5017243">finfo</span><span class="op" id="5017248">)</span><span class="op" id="5017249">;</span>&nbsp;<span class="ident" id="5017251">err</span>&nbsp;<span class="op" id="5017255">!=</span>&nbsp;<span class="ident" id="5017258">nil</span>&nbsp;<span class="op" id="5017262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017268">return</span>&nbsp;<span class="ident" id="5017275">nil</span><span class="op" id="5017278">,</span>&nbsp;<span class="ident" id="5017280">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017287">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017297">tinfoLock</span><span class="op" id="5017306">.</span><span class="ident" id="5017307">Lock</span><span class="op" id="5017311">(</span><span class="op" id="5017312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017315">tinfoMap</span><span class="op" id="5017323">[</span><span class="ident" id="5017324">typ</span><span class="op" id="5017327">]</span>&nbsp;<span class="op" id="5017329">=</span>&nbsp;<span class="ident" id="5017331">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017338">tinfoLock</span><span class="op" id="5017347">.</span><span class="ident" id="5017348">Unlock</span><span class="op" id="5017354">(</span><span class="op" id="5017355">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017358">return</span>&nbsp;<span class="ident" id="5017365">tinfo</span><span class="op" id="5017370">,</span>&nbsp;<span class="ident" id="5017372">nil</span><br>
<span class="lineno"></span><span class="op" id="5017376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5017379">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5017436">func</span>&nbsp;<span class="ident" id="5017441">structFieldInfo</span><span class="op" id="5017456">(</span><span class="ident" id="5017457">typ</span>&nbsp;<span class="ident" id="5017461">reflect</span><span class="op" id="5017468">.</span><span class="ident" id="5017469">Type</span><span class="op" id="5017473">,</span>&nbsp;<span class="ident" id="5017475">f</span>&nbsp;<span class="op" id="5017477">*</span><span class="ident" id="5017478">reflect</span><span class="op" id="5017485">.</span><span class="ident" id="5017486">StructField</span><span class="op" id="5017497">)</span>&nbsp;<span class="op" id="5017499">(</span><span class="op" id="5017500">*</span><span class="ident" id="5017501">fieldInfo</span><span class="op" id="5017510">,</span>&nbsp;<span class="builtintype" id="5017512">error</span><span class="op" id="5017517">)</span>&nbsp;<span class="op" id="5017519">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017522">finfo</span>&nbsp;<span class="op" id="5017528">:=</span>&nbsp;<span class="op" id="5017531">&amp;</span><span class="ident" id="5017532">fieldInfo</span><span class="op" id="5017541">{</span><span class="ident" id="5017542">idx</span><span class="op" id="5017545">:</span>&nbsp;<span class="ident" id="5017547">f</span><span class="op" id="5017548">.</span><span class="ident" id="5017549">Index</span><span class="op" id="5017554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017558">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017613">tag</span>&nbsp;<span class="op" id="5017617">:=</span>&nbsp;<span class="ident" id="5017620">f</span><span class="op" id="5017621">.</span><span class="ident" id="5017622">Tag</span><span class="op" id="5017625">.</span><span class="ident" id="5017626">Get</span><span class="op" id="5017629">(</span><span class="string" id="5017630">&#34;xml&#34;</span><span class="op" id="5017635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017638">if</span>&nbsp;<span class="ident" id="5017641">i</span>&nbsp;<span class="op" id="5017643">:=</span>&nbsp;<span class="ident" id="5017646">strings</span><span class="op" id="5017653">.</span><span class="ident" id="5017654">Index</span><span class="op" id="5017659">(</span><span class="ident" id="5017660">tag</span><span class="op" id="5017663">,</span>&nbsp;<span class="string" id="5017665">&#34;&nbsp;&#34;</span><span class="op" id="5017668">)</span><span class="op" id="5017669">;</span>&nbsp;<span class="ident" id="5017671">i</span>&nbsp;<span class="op" id="5017673">&gt;=</span>&nbsp;<span class="num" id="5017676">0</span>&nbsp;<span class="op" id="5017678">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017682">finfo</span><span class="op" id="5017687">.</span><span class="ident" id="5017688">xmlns</span><span class="op" id="5017693">,</span>&nbsp;<span class="ident" id="5017695">tag</span>&nbsp;<span class="op" id="5017699">=</span>&nbsp;<span class="ident" id="5017701">tag</span><span class="op" id="5017704">[</span><span class="op" id="5017705">:</span><span class="ident" id="5017706">i</span><span class="op" id="5017707">]</span><span class="op" id="5017708">,</span>&nbsp;<span class="ident" id="5017710">tag</span><span class="op" id="5017713">[</span><span class="ident" id="5017714">i</span><span class="op" id="5017715">+</span><span class="num" id="5017716">1</span><span class="op" id="5017717">:</span><span class="op" id="5017718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017725">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017742">tokens</span>&nbsp;<span class="op" id="5017749">:=</span>&nbsp;<span class="ident" id="5017752">strings</span><span class="op" id="5017759">.</span><span class="ident" id="5017760">Split</span><span class="op" id="5017765">(</span><span class="ident" id="5017766">tag</span><span class="op" id="5017769">,</span>&nbsp;<span class="string" id="5017771">&#34;,&#34;</span><span class="op" id="5017774">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017777">if</span>&nbsp;<span class="builtinfunc" id="5017780">len</span><span class="op" id="5017783">(</span><span class="ident" id="5017784">tokens</span><span class="op" id="5017790">)</span>&nbsp;<span class="op" id="5017792">==</span>&nbsp;<span class="num" id="5017795">1</span>&nbsp;<span class="op" id="5017797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017801">finfo</span><span class="op" id="5017806">.</span><span class="ident" id="5017807">flags</span>&nbsp;<span class="op" id="5017813">=</span>&nbsp;<span class="ident" id="5017815">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017825">}</span>&nbsp;<span class="keyword" id="5017827">else</span>&nbsp;<span class="op" id="5017832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017836">tag</span>&nbsp;<span class="op" id="5017840">=</span>&nbsp;<span class="ident" id="5017842">tokens</span><span class="op" id="5017848">[</span><span class="num" id="5017849">0</span><span class="op" id="5017850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017854">for</span>&nbsp;<span class="ident" id="5017858">_</span><span class="op" id="5017859">,</span>&nbsp;<span class="ident" id="5017861">flag</span>&nbsp;<span class="op" id="5017866">:=</span>&nbsp;<span class="keyword" id="5017869">range</span>&nbsp;<span class="ident" id="5017875">tokens</span><span class="op" id="5017881">[</span><span class="num" id="5017882">1</span><span class="op" id="5017883">:</span><span class="op" id="5017884">]</span>&nbsp;<span class="op" id="5017886">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017891">switch</span>&nbsp;<span class="ident" id="5017898">flag</span>&nbsp;<span class="op" id="5017903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017908">case</span>&nbsp;<span class="string" id="5017913">&#34;attr&#34;</span><span class="op" id="5017919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017925">finfo</span><span class="op" id="5017930">.</span><span class="ident" id="5017931">flags</span>&nbsp;<span class="op" id="5017937">|=</span>&nbsp;<span class="ident" id="5017940">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017949">case</span>&nbsp;<span class="string" id="5017954">&#34;chardata&#34;</span><span class="op" id="5017964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017970">finfo</span><span class="op" id="5017975">.</span><span class="ident" id="5017976">flags</span>&nbsp;<span class="op" id="5017982">|=</span>&nbsp;<span class="ident" id="5017985">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017998">case</span>&nbsp;<span class="string" id="5018003">&#34;innerxml&#34;</span><span class="op" id="5018013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018019">finfo</span><span class="op" id="5018024">.</span><span class="ident" id="5018025">flags</span>&nbsp;<span class="op" id="5018031">|=</span>&nbsp;<span class="ident" id="5018034">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018047">case</span>&nbsp;<span class="string" id="5018052">&#34;comment&#34;</span><span class="op" id="5018061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018067">finfo</span><span class="op" id="5018072">.</span><span class="ident" id="5018073">flags</span>&nbsp;<span class="op" id="5018079">|=</span>&nbsp;<span class="ident" id="5018082">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018094">case</span>&nbsp;<span class="string" id="5018099">&#34;any&#34;</span><span class="op" id="5018104">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018110">finfo</span><span class="op" id="5018115">.</span><span class="ident" id="5018116">flags</span>&nbsp;<span class="op" id="5018122">|=</span>&nbsp;<span class="ident" id="5018125">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018133">case</span>&nbsp;<span class="string" id="5018138">&#34;omitempty&#34;</span><span class="op" id="5018149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018155">finfo</span><span class="op" id="5018160">.</span><span class="ident" id="5018161">flags</span>&nbsp;<span class="op" id="5018167">|=</span>&nbsp;<span class="ident" id="5018170">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018188">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018193">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018223">valid</span>&nbsp;<span class="op" id="5018229">:=</span>&nbsp;<span class="builtintype" id="5018232">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018239">switch</span>&nbsp;<span class="ident" id="5018246">mode</span>&nbsp;<span class="op" id="5018251">:=</span>&nbsp;<span class="ident" id="5018254">finfo</span><span class="op" id="5018259">.</span><span class="ident" id="5018260">flags</span>&nbsp;<span class="op" id="5018266">&amp;</span>&nbsp;<span class="ident" id="5018268">fMode</span><span class="op" id="5018273">;</span>&nbsp;<span class="ident" id="5018275">mode</span>&nbsp;<span class="op" id="5018280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018284">case</span>&nbsp;<span class="num" id="5018289">0</span><span class="op" id="5018290">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018295">finfo</span><span class="op" id="5018300">.</span><span class="ident" id="5018301">flags</span>&nbsp;<span class="op" id="5018307">|=</span>&nbsp;<span class="ident" id="5018310">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018321">case</span>&nbsp;<span class="ident" id="5018326">fAttr</span><span class="op" id="5018331">,</span>&nbsp;<span class="ident" id="5018333">fCharData</span><span class="op" id="5018342">,</span>&nbsp;<span class="ident" id="5018344">fInnerXml</span><span class="op" id="5018353">,</span>&nbsp;<span class="ident" id="5018355">fComment</span><span class="op" id="5018363">,</span>&nbsp;<span class="ident" id="5018365">fAny</span><span class="op" id="5018369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018374">if</span>&nbsp;<span class="ident" id="5018377">f</span><span class="op" id="5018378">.</span><span class="ident" id="5018379">Name</span>&nbsp;<span class="op" id="5018384">==</span>&nbsp;<span class="string" id="5018387">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5018397">||</span>&nbsp;<span class="ident" id="5018400">tag</span>&nbsp;<span class="op" id="5018404">!=</span>&nbsp;<span class="string" id="5018407">&#34;&#34;</span>&nbsp;<span class="op" id="5018410">&amp;&amp;</span>&nbsp;<span class="ident" id="5018413">mode</span>&nbsp;<span class="op" id="5018418">!=</span>&nbsp;<span class="ident" id="5018421">fAttr</span>&nbsp;<span class="op" id="5018427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018433">valid</span>&nbsp;<span class="op" id="5018439">=</span>&nbsp;<span class="builtintype" id="5018441">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018450">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018454">default</span><span class="op" id="5018461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018466">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018527">valid</span>&nbsp;<span class="op" id="5018533">=</span>&nbsp;<span class="builtintype" id="5018535">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018547">if</span>&nbsp;<span class="ident" id="5018550">finfo</span><span class="op" id="5018555">.</span><span class="ident" id="5018556">flags</span><span class="op" id="5018561">&amp;</span><span class="ident" id="5018562">fMode</span>&nbsp;<span class="op" id="5018568">==</span>&nbsp;<span class="ident" id="5018571">fAny</span>&nbsp;<span class="op" id="5018576">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018581">finfo</span><span class="op" id="5018586">.</span><span class="ident" id="5018587">flags</span>&nbsp;<span class="op" id="5018593">|=</span>&nbsp;<span class="ident" id="5018596">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018611">if</span>&nbsp;<span class="ident" id="5018614">finfo</span><span class="op" id="5018619">.</span><span class="ident" id="5018620">flags</span><span class="op" id="5018625">&amp;</span><span class="ident" id="5018626">fOmitEmpty</span>&nbsp;<span class="op" id="5018637">!=</span>&nbsp;<span class="num" id="5018640">0</span>&nbsp;<span class="op" id="5018642">&amp;&amp;</span>&nbsp;<span class="ident" id="5018645">finfo</span><span class="op" id="5018650">.</span><span class="ident" id="5018651">flags</span><span class="op" id="5018656">&amp;</span><span class="op" id="5018657">(</span><span class="ident" id="5018658">fElement</span><span class="op" id="5018666">|</span><span class="ident" id="5018667">fAttr</span><span class="op" id="5018672">)</span>&nbsp;<span class="op" id="5018674">==</span>&nbsp;<span class="num" id="5018677">0</span>&nbsp;<span class="op" id="5018679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018684">valid</span>&nbsp;<span class="op" id="5018690">=</span>&nbsp;<span class="builtintype" id="5018692">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018700">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018704">if</span>&nbsp;<span class="op" id="5018707">!</span><span class="ident" id="5018708">valid</span>&nbsp;<span class="op" id="5018714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018719">return</span>&nbsp;<span class="ident" id="5018726">nil</span><span class="op" id="5018729">,</span>&nbsp;<span class="ident" id="5018731">fmt</span><span class="op" id="5018734">.</span><span class="ident" id="5018735">Errorf</span><span class="op" id="5018741">(</span><span class="string" id="5018742">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5018787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018793">f</span><span class="op" id="5018794">.</span><span class="ident" id="5018795">Name</span><span class="op" id="5018799">,</span>&nbsp;<span class="ident" id="5018801">typ</span><span class="op" id="5018804">,</span>&nbsp;<span class="ident" id="5018806">f</span><span class="op" id="5018807">.</span><span class="ident" id="5018808">Tag</span><span class="op" id="5018811">.</span><span class="ident" id="5018812">Get</span><span class="op" id="5018815">(</span><span class="string" id="5018816">&#34;xml&#34;</span><span class="op" id="5018821">)</span><span class="op" id="5018822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018829">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018833">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018881">if</span>&nbsp;<span class="ident" id="5018884">finfo</span><span class="op" id="5018889">.</span><span class="ident" id="5018890">xmlns</span>&nbsp;<span class="op" id="5018896">!=</span>&nbsp;<span class="string" id="5018899">&#34;&#34;</span>&nbsp;<span class="op" id="5018902">&amp;&amp;</span>&nbsp;<span class="ident" id="5018905">tag</span>&nbsp;<span class="op" id="5018909">==</span>&nbsp;<span class="string" id="5018912">&#34;&#34;</span>&nbsp;<span class="op" id="5018915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018919">return</span>&nbsp;<span class="ident" id="5018926">nil</span><span class="op" id="5018929">,</span>&nbsp;<span class="ident" id="5018931">fmt</span><span class="op" id="5018934">.</span><span class="ident" id="5018935">Errorf</span><span class="op" id="5018941">(</span><span class="string" id="5018942">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5018998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019003">f</span><span class="op" id="5019004">.</span><span class="ident" id="5019005">Name</span><span class="op" id="5019009">,</span>&nbsp;<span class="ident" id="5019011">typ</span><span class="op" id="5019014">,</span>&nbsp;<span class="ident" id="5019016">f</span><span class="op" id="5019017">.</span><span class="ident" id="5019018">Tag</span><span class="op" id="5019021">.</span><span class="ident" id="5019022">Get</span><span class="op" id="5019025">(</span><span class="string" id="5019026">&#34;xml&#34;</span><span class="op" id="5019031">)</span><span class="op" id="5019032">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019039">if</span>&nbsp;<span class="ident" id="5019042">f</span><span class="op" id="5019043">.</span><span class="ident" id="5019044">Name</span>&nbsp;<span class="op" id="5019049">==</span>&nbsp;<span class="string" id="5019052">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5019062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019066">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019125">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019185">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019227">finfo</span><span class="op" id="5019232">.</span><span class="ident" id="5019233">name</span>&nbsp;<span class="op" id="5019238">=</span>&nbsp;<span class="ident" id="5019240">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019246">return</span>&nbsp;<span class="ident" id="5019253">finfo</span><span class="op" id="5019258">,</span>&nbsp;<span class="ident" id="5019260">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019269">if</span>&nbsp;<span class="ident" id="5019272">tag</span>&nbsp;<span class="op" id="5019276">==</span>&nbsp;<span class="string" id="5019279">&#34;&#34;</span>&nbsp;<span class="op" id="5019282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019286">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019344">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019404">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019434">if</span>&nbsp;<span class="ident" id="5019437">xmlname</span>&nbsp;<span class="op" id="5019445">:=</span>&nbsp;<span class="ident" id="5019448">lookupXMLName</span><span class="op" id="5019461">(</span><span class="ident" id="5019462">f</span><span class="op" id="5019463">.</span><span class="ident" id="5019464">Type</span><span class="op" id="5019468">)</span><span class="op" id="5019469">;</span>&nbsp;<span class="ident" id="5019471">xmlname</span>&nbsp;<span class="op" id="5019479">!=</span>&nbsp;<span class="ident" id="5019482">nil</span>&nbsp;<span class="op" id="5019486">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019491">finfo</span><span class="op" id="5019496">.</span><span class="ident" id="5019497">xmlns</span><span class="op" id="5019502">,</span>&nbsp;<span class="ident" id="5019504">finfo</span><span class="op" id="5019509">.</span><span class="ident" id="5019510">name</span>&nbsp;<span class="op" id="5019515">=</span>&nbsp;<span class="ident" id="5019517">xmlname</span><span class="op" id="5019524">.</span><span class="ident" id="5019525">xmlns</span><span class="op" id="5019530">,</span>&nbsp;<span class="ident" id="5019532">xmlname</span><span class="op" id="5019539">.</span><span class="ident" id="5019540">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019547">}</span>&nbsp;<span class="keyword" id="5019549">else</span>&nbsp;<span class="op" id="5019554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019559">finfo</span><span class="op" id="5019564">.</span><span class="ident" id="5019565">name</span>&nbsp;<span class="op" id="5019570">=</span>&nbsp;<span class="ident" id="5019572">f</span><span class="op" id="5019573">.</span><span class="ident" id="5019574">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019585">return</span>&nbsp;<span class="ident" id="5019592">finfo</span><span class="op" id="5019597">,</span>&nbsp;<span class="ident" id="5019599">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019608">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019644">parents</span>&nbsp;<span class="op" id="5019652">:=</span>&nbsp;<span class="ident" id="5019655">strings</span><span class="op" id="5019662">.</span><span class="ident" id="5019663">Split</span><span class="op" id="5019668">(</span><span class="ident" id="5019669">tag</span><span class="op" id="5019672">,</span>&nbsp;<span class="string" id="5019674">&#34;&gt;&#34;</span><span class="op" id="5019677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019680">if</span>&nbsp;<span class="ident" id="5019683">parents</span><span class="op" id="5019690">[</span><span class="num" id="5019691">0</span><span class="op" id="5019692">]</span>&nbsp;<span class="op" id="5019694">==</span>&nbsp;<span class="string" id="5019697">&#34;&#34;</span>&nbsp;<span class="op" id="5019700">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019704">parents</span><span class="op" id="5019711">[</span><span class="num" id="5019712">0</span><span class="op" id="5019713">]</span>&nbsp;<span class="op" id="5019715">=</span>&nbsp;<span class="ident" id="5019717">f</span><span class="op" id="5019718">.</span><span class="ident" id="5019719">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019728">if</span>&nbsp;<span class="ident" id="5019731">parents</span><span class="op" id="5019738">[</span><span class="builtinfunc" id="5019739">len</span><span class="op" id="5019742">(</span><span class="ident" id="5019743">parents</span><span class="op" id="5019750">)</span><span class="op" id="5019751">-</span><span class="num" id="5019752">1</span><span class="op" id="5019753">]</span>&nbsp;<span class="op" id="5019755">==</span>&nbsp;<span class="string" id="5019758">&#34;&#34;</span>&nbsp;<span class="op" id="5019761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019765">return</span>&nbsp;<span class="ident" id="5019772">nil</span><span class="op" id="5019775">,</span>&nbsp;<span class="ident" id="5019777">fmt</span><span class="op" id="5019780">.</span><span class="ident" id="5019781">Errorf</span><span class="op" id="5019787">(</span><span class="string" id="5019788">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5019830">,</span>&nbsp;<span class="ident" id="5019832">f</span><span class="op" id="5019833">.</span><span class="ident" id="5019834">Name</span><span class="op" id="5019838">,</span>&nbsp;<span class="ident" id="5019840">typ</span><span class="op" id="5019843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019846">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019849">finfo</span><span class="op" id="5019854">.</span><span class="ident" id="5019855">name</span>&nbsp;<span class="op" id="5019860">=</span>&nbsp;<span class="ident" id="5019862">parents</span><span class="op" id="5019869">[</span><span class="builtinfunc" id="5019870">len</span><span class="op" id="5019873">(</span><span class="ident" id="5019874">parents</span><span class="op" id="5019881">)</span><span class="op" id="5019882">-</span><span class="num" id="5019883">1</span><span class="op" id="5019884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019887">if</span>&nbsp;<span class="builtinfunc" id="5019890">len</span><span class="op" id="5019893">(</span><span class="ident" id="5019894">parents</span><span class="op" id="5019901">)</span>&nbsp;<span class="op" id="5019903">&gt;</span>&nbsp;<span class="num" id="5019905">1</span>&nbsp;<span class="op" id="5019907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019911">if</span>&nbsp;<span class="op" id="5019914">(</span><span class="ident" id="5019915">finfo</span><span class="op" id="5019920">.</span><span class="ident" id="5019921">flags</span>&nbsp;<span class="op" id="5019927">&amp;</span>&nbsp;<span class="ident" id="5019929">fElement</span><span class="op" id="5019937">)</span>&nbsp;<span class="op" id="5019939">==</span>&nbsp;<span class="num" id="5019942">0</span>&nbsp;<span class="op" id="5019944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019949">return</span>&nbsp;<span class="ident" id="5019956">nil</span><span class="op" id="5019959">,</span>&nbsp;<span class="ident" id="5019961">fmt</span><span class="op" id="5019964">.</span><span class="ident" id="5019965">Errorf</span><span class="op" id="5019971">(</span><span class="string" id="5019972">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="5020010">,</span>&nbsp;<span class="ident" id="5020012">tag</span><span class="op" id="5020015">,</span>&nbsp;<span class="ident" id="5020017">strings</span><span class="op" id="5020024">.</span><span class="ident" id="5020025">Join</span><span class="op" id="5020029">(</span><span class="ident" id="5020030">tokens</span><span class="op" id="5020036">[</span><span class="num" id="5020037">1</span><span class="op" id="5020038">:</span><span class="op" id="5020039">]</span><span class="op" id="5020040">,</span>&nbsp;<span class="string" id="5020042">&#34;,&#34;</span><span class="op" id="5020045">)</span><span class="op" id="5020046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020050">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020054">finfo</span><span class="op" id="5020059">.</span><span class="ident" id="5020060">parents</span>&nbsp;<span class="op" id="5020068">=</span>&nbsp;<span class="ident" id="5020070">parents</span><span class="op" id="5020077">[</span><span class="op" id="5020078">:</span><span class="builtinfunc" id="5020079">len</span><span class="op" id="5020082">(</span><span class="ident" id="5020083">parents</span><span class="op" id="5020090">)</span><span class="op" id="5020091">-</span><span class="num" id="5020092">1</span><span class="op" id="5020093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020100">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020165">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020228">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020268">if</span>&nbsp;<span class="ident" id="5020271">finfo</span><span class="op" id="5020276">.</span><span class="ident" id="5020277">flags</span><span class="op" id="5020282">&amp;</span><span class="ident" id="5020283">fElement</span>&nbsp;<span class="op" id="5020292">!=</span>&nbsp;<span class="num" id="5020295">0</span>&nbsp;<span class="op" id="5020297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020301">ftyp</span>&nbsp;<span class="op" id="5020306">:=</span>&nbsp;<span class="ident" id="5020309">f</span><span class="op" id="5020310">.</span><span class="ident" id="5020311">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020318">xmlname</span>&nbsp;<span class="op" id="5020326">:=</span>&nbsp;<span class="ident" id="5020329">lookupXMLName</span><span class="op" id="5020342">(</span><span class="ident" id="5020343">ftyp</span><span class="op" id="5020347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020351">if</span>&nbsp;<span class="ident" id="5020354">xmlname</span>&nbsp;<span class="op" id="5020362">!=</span>&nbsp;<span class="ident" id="5020365">nil</span>&nbsp;<span class="op" id="5020369">&amp;&amp;</span>&nbsp;<span class="ident" id="5020372">xmlname</span><span class="op" id="5020379">.</span><span class="ident" id="5020380">name</span>&nbsp;<span class="op" id="5020385">!=</span>&nbsp;<span class="ident" id="5020388">finfo</span><span class="op" id="5020393">.</span><span class="ident" id="5020394">name</span>&nbsp;<span class="op" id="5020399">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020404">return</span>&nbsp;<span class="ident" id="5020411">nil</span><span class="op" id="5020414">,</span>&nbsp;<span class="ident" id="5020416">fmt</span><span class="op" id="5020419">.</span><span class="ident" id="5020420">Errorf</span><span class="op" id="5020426">(</span><span class="string" id="5020427">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="5020494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020500">finfo</span><span class="op" id="5020505">.</span><span class="ident" id="5020506">name</span><span class="op" id="5020510">,</span>&nbsp;<span class="ident" id="5020512">typ</span><span class="op" id="5020515">,</span>&nbsp;<span class="ident" id="5020517">f</span><span class="op" id="5020518">.</span><span class="ident" id="5020519">Name</span><span class="op" id="5020523">,</span>&nbsp;<span class="ident" id="5020525">xmlname</span><span class="op" id="5020532">.</span><span class="ident" id="5020533">name</span><span class="op" id="5020537">,</span>&nbsp;<span class="ident" id="5020539">ftyp</span><span class="op" id="5020543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020553">return</span>&nbsp;<span class="ident" id="5020560">finfo</span><span class="op" id="5020565">,</span>&nbsp;<span class="ident" id="5020567">nil</span><br>
<span class="lineno">225</span><span class="op" id="5020571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020574">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5020637">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5020699">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="5020718">func</span>&nbsp;<span class="ident" id="5020723">lookupXMLName</span><span class="op" id="5020736">(</span><span class="ident" id="5020737">typ</span>&nbsp;<span class="ident" id="5020741">reflect</span><span class="op" id="5020748">.</span><span class="ident" id="5020749">Type</span><span class="op" id="5020753">)</span>&nbsp;<span class="op" id="5020755">(</span><span class="ident" id="5020756">xmlname</span>&nbsp;<span class="op" id="5020764">*</span><span class="ident" id="5020765">fieldInfo</span><span class="op" id="5020774">)</span>&nbsp;<span class="op" id="5020776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020779">for</span>&nbsp;<span class="ident" id="5020783">typ</span><span class="op" id="5020786">.</span><span class="ident" id="5020787">Kind</span><span class="op" id="5020791">(</span><span class="op" id="5020792">)</span>&nbsp;<span class="op" id="5020794">==</span>&nbsp;<span class="ident" id="5020797">reflect</span><span class="op" id="5020804">.</span><span class="ident" id="5020805">Ptr</span>&nbsp;<span class="op" id="5020809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020813">typ</span>&nbsp;<span class="op" id="5020817">=</span>&nbsp;<span class="ident" id="5020819">typ</span><span class="op" id="5020822">.</span><span class="ident" id="5020823">Elem</span><span class="op" id="5020827">(</span><span class="op" id="5020828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020834">if</span>&nbsp;<span class="ident" id="5020837">typ</span><span class="op" id="5020840">.</span><span class="ident" id="5020841">Kind</span><span class="op" id="5020845">(</span><span class="op" id="5020846">)</span>&nbsp;<span class="op" id="5020848">!=</span>&nbsp;<span class="ident" id="5020851">reflect</span><span class="op" id="5020858">.</span><span class="ident" id="5020859">Struct</span>&nbsp;<span class="op" id="5020866">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020870">return</span>&nbsp;<span class="ident" id="5020877">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020885">for</span>&nbsp;<span class="ident" id="5020889">i</span><span class="op" id="5020890">,</span>&nbsp;<span class="ident" id="5020892">n</span>&nbsp;<span class="op" id="5020894">:=</span>&nbsp;<span class="num" id="5020897">0</span><span class="op" id="5020898">,</span>&nbsp;<span class="ident" id="5020900">typ</span><span class="op" id="5020903">.</span><span class="ident" id="5020904">NumField</span><span class="op" id="5020912">(</span><span class="op" id="5020913">)</span><span class="op" id="5020914">;</span>&nbsp;<span class="ident" id="5020916">i</span>&nbsp;<span class="op" id="5020918">&lt;</span>&nbsp;<span class="ident" id="5020920">n</span><span class="op" id="5020921">;</span>&nbsp;<span class="ident" id="5020923">i</span><span class="op" id="5020924">++</span>&nbsp;<span class="op" id="5020927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020931">f</span>&nbsp;<span class="op" id="5020933">:=</span>&nbsp;<span class="ident" id="5020936">typ</span><span class="op" id="5020939">.</span><span class="ident" id="5020940">Field</span><span class="op" id="5020945">(</span><span class="ident" id="5020946">i</span><span class="op" id="5020947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020951">if</span>&nbsp;<span class="ident" id="5020954">f</span><span class="op" id="5020955">.</span><span class="ident" id="5020956">Name</span>&nbsp;<span class="op" id="5020961">!=</span>&nbsp;<span class="string" id="5020964">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5020974">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020979">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020994">finfo</span><span class="op" id="5020999">,</span>&nbsp;<span class="ident" id="5021001">err</span>&nbsp;<span class="op" id="5021005">:=</span>&nbsp;<span class="ident" id="5021008">structFieldInfo</span><span class="op" id="5021023">(</span><span class="ident" id="5021024">typ</span><span class="op" id="5021027">,</span>&nbsp;<span class="op" id="5021029">&amp;</span><span class="ident" id="5021030">f</span><span class="op" id="5021031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021035">if</span>&nbsp;<span class="ident" id="5021038">finfo</span><span class="op" id="5021043">.</span><span class="ident" id="5021044">name</span>&nbsp;<span class="op" id="5021049">!=</span>&nbsp;<span class="string" id="5021052">&#34;&#34;</span>&nbsp;<span class="op" id="5021055">&amp;&amp;</span>&nbsp;<span class="ident" id="5021058">err</span>&nbsp;<span class="op" id="5021062">==</span>&nbsp;<span class="ident" id="5021065">nil</span>&nbsp;<span class="op" id="5021069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021074">return</span>&nbsp;<span class="ident" id="5021081">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021093">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021147">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021197">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021204">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021207">return</span>&nbsp;<span class="ident" id="5021214">nil</span><br>
<span class="lineno"></span><span class="op" id="5021218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5021221">func</span>&nbsp;<span class="ident" id="5021226">min</span><span class="op" id="5021229">(</span><span class="ident" id="5021230">a</span><span class="op" id="5021231">,</span>&nbsp;<span class="ident" id="5021233">b</span>&nbsp;<span class="builtintype" id="5021235">int</span><span class="op" id="5021238">)</span>&nbsp;<span class="builtintype" id="5021240">int</span>&nbsp;<span class="op" id="5021244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021247">if</span>&nbsp;<span class="ident" id="5021250">a</span>&nbsp;<span class="op" id="5021252">&lt;=</span>&nbsp;<span class="ident" id="5021255">b</span>&nbsp;<span class="op" id="5021257">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021261">return</span>&nbsp;<span class="ident" id="5021268">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021274">return</span>&nbsp;<span class="ident" id="5021281">b</span><br>
<span class="lineno"></span><span class="op" id="5021283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5021286">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5021345">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="5021412">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="5021482">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="5021528">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="5021593">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="5021662">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5021727">func</span>&nbsp;<span class="ident" id="5021732">addFieldInfo</span><span class="op" id="5021744">(</span><span class="ident" id="5021745">typ</span>&nbsp;<span class="ident" id="5021749">reflect</span><span class="op" id="5021756">.</span><span class="ident" id="5021757">Type</span><span class="op" id="5021761">,</span>&nbsp;<span class="ident" id="5021763">tinfo</span>&nbsp;<span class="op" id="5021769">*</span><span class="ident" id="5021770">typeInfo</span><span class="op" id="5021778">,</span>&nbsp;<span class="ident" id="5021780">newf</span>&nbsp;<span class="op" id="5021785">*</span><span class="ident" id="5021786">fieldInfo</span><span class="op" id="5021795">)</span>&nbsp;<span class="builtintype" id="5021797">error</span>&nbsp;<span class="op" id="5021803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021806">var</span>&nbsp;<span class="ident" id="5021810">conflicts</span>&nbsp;<span class="op" id="5021820">[</span><span class="op" id="5021821">]</span><span class="builtintype" id="5021822">int</span><br>
<span class="lineno"></span><span class="ident" id="5021826">Loop</span><span class="op" id="5021830">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021833">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021900">for</span>&nbsp;<span class="ident" id="5021904">i</span>&nbsp;<span class="op" id="5021906">:=</span>&nbsp;<span class="keyword" id="5021909">range</span>&nbsp;<span class="ident" id="5021915">tinfo</span><span class="op" id="5021920">.</span><span class="ident" id="5021921">fields</span>&nbsp;<span class="op" id="5021928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021932">oldf</span>&nbsp;<span class="op" id="5021937">:=</span>&nbsp;<span class="op" id="5021940">&amp;</span><span class="ident" id="5021941">tinfo</span><span class="op" id="5021946">.</span><span class="ident" id="5021947">fields</span><span class="op" id="5021953">[</span><span class="ident" id="5021954">i</span><span class="op" id="5021955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021959">if</span>&nbsp;<span class="ident" id="5021962">oldf</span><span class="op" id="5021966">.</span><span class="ident" id="5021967">flags</span><span class="op" id="5021972">&amp;</span><span class="ident" id="5021973">fMode</span>&nbsp;<span class="op" id="5021979">!=</span>&nbsp;<span class="ident" id="5021982">newf</span><span class="op" id="5021986">.</span><span class="ident" id="5021987">flags</span><span class="op" id="5021992">&amp;</span><span class="ident" id="5021993">fMode</span>&nbsp;<span class="op" id="5021999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022004">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022019">if</span>&nbsp;<span class="ident" id="5022022">oldf</span><span class="op" id="5022026">.</span><span class="ident" id="5022027">xmlns</span>&nbsp;<span class="op" id="5022033">!=</span>&nbsp;<span class="string" id="5022036">&#34;&#34;</span>&nbsp;<span class="op" id="5022039">&amp;&amp;</span>&nbsp;<span class="ident" id="5022042">newf</span><span class="op" id="5022046">.</span><span class="ident" id="5022047">xmlns</span>&nbsp;<span class="op" id="5022053">!=</span>&nbsp;<span class="string" id="5022056">&#34;&#34;</span>&nbsp;<span class="op" id="5022059">&amp;&amp;</span>&nbsp;<span class="ident" id="5022062">oldf</span><span class="op" id="5022066">.</span><span class="ident" id="5022067">xmlns</span>&nbsp;<span class="op" id="5022073">!=</span>&nbsp;<span class="ident" id="5022076">newf</span><span class="op" id="5022080">.</span><span class="ident" id="5022081">xmlns</span>&nbsp;<span class="op" id="5022087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022107">minl</span>&nbsp;<span class="op" id="5022112">:=</span>&nbsp;<span class="ident" id="5022115">min</span><span class="op" id="5022118">(</span><span class="builtinfunc" id="5022119">len</span><span class="op" id="5022122">(</span><span class="ident" id="5022123">newf</span><span class="op" id="5022127">.</span><span class="ident" id="5022128">parents</span><span class="op" id="5022135">)</span><span class="op" id="5022136">,</span>&nbsp;<span class="builtinfunc" id="5022138">len</span><span class="op" id="5022141">(</span><span class="ident" id="5022142">oldf</span><span class="op" id="5022146">.</span><span class="ident" id="5022147">parents</span><span class="op" id="5022154">)</span><span class="op" id="5022155">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022159">for</span>&nbsp;<span class="ident" id="5022163">p</span>&nbsp;<span class="op" id="5022165">:=</span>&nbsp;<span class="num" id="5022168">0</span><span class="op" id="5022169">;</span>&nbsp;<span class="ident" id="5022171">p</span>&nbsp;<span class="op" id="5022173">&lt;</span>&nbsp;<span class="ident" id="5022175">minl</span><span class="op" id="5022179">;</span>&nbsp;<span class="ident" id="5022181">p</span><span class="op" id="5022182">++</span>&nbsp;<span class="op" id="5022185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022190">if</span>&nbsp;<span class="ident" id="5022193">oldf</span><span class="op" id="5022197">.</span><span class="ident" id="5022198">parents</span><span class="op" id="5022205">[</span><span class="ident" id="5022206">p</span><span class="op" id="5022207">]</span>&nbsp;<span class="op" id="5022209">!=</span>&nbsp;<span class="ident" id="5022212">newf</span><span class="op" id="5022216">.</span><span class="ident" id="5022217">parents</span><span class="op" id="5022224">[</span><span class="ident" id="5022225">p</span><span class="op" id="5022226">]</span>&nbsp;<span class="op" id="5022228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022234">continue</span>&nbsp;<span class="ident" id="5022243">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022255">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022259">if</span>&nbsp;<span class="builtinfunc" id="5022262">len</span><span class="op" id="5022265">(</span><span class="ident" id="5022266">oldf</span><span class="op" id="5022270">.</span><span class="ident" id="5022271">parents</span><span class="op" id="5022278">)</span>&nbsp;<span class="op" id="5022280">&gt;</span>&nbsp;<span class="builtinfunc" id="5022282">len</span><span class="op" id="5022285">(</span><span class="ident" id="5022286">newf</span><span class="op" id="5022290">.</span><span class="ident" id="5022291">parents</span><span class="op" id="5022298">)</span>&nbsp;<span class="op" id="5022300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022305">if</span>&nbsp;<span class="ident" id="5022308">oldf</span><span class="op" id="5022312">.</span><span class="ident" id="5022313">parents</span><span class="op" id="5022320">[</span><span class="builtinfunc" id="5022321">len</span><span class="op" id="5022324">(</span><span class="ident" id="5022325">newf</span><span class="op" id="5022329">.</span><span class="ident" id="5022330">parents</span><span class="op" id="5022337">)</span><span class="op" id="5022338">]</span>&nbsp;<span class="op" id="5022340">==</span>&nbsp;<span class="ident" id="5022343">newf</span><span class="op" id="5022347">.</span><span class="ident" id="5022348">name</span>&nbsp;<span class="op" id="5022353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022359">conflicts</span>&nbsp;<span class="op" id="5022369">=</span>&nbsp;<span class="builtinfunc" id="5022371">append</span><span class="op" id="5022377">(</span><span class="ident" id="5022378">conflicts</span><span class="op" id="5022387">,</span>&nbsp;<span class="ident" id="5022389">i</span><span class="op" id="5022390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022399">}</span>&nbsp;<span class="keyword" id="5022401">else</span>&nbsp;<span class="keyword" id="5022406">if</span>&nbsp;<span class="builtinfunc" id="5022409">len</span><span class="op" id="5022412">(</span><span class="ident" id="5022413">oldf</span><span class="op" id="5022417">.</span><span class="ident" id="5022418">parents</span><span class="op" id="5022425">)</span>&nbsp;<span class="op" id="5022427">&lt;</span>&nbsp;<span class="builtinfunc" id="5022429">len</span><span class="op" id="5022432">(</span><span class="ident" id="5022433">newf</span><span class="op" id="5022437">.</span><span class="ident" id="5022438">parents</span><span class="op" id="5022445">)</span>&nbsp;<span class="op" id="5022447">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022452">if</span>&nbsp;<span class="ident" id="5022455">newf</span><span class="op" id="5022459">.</span><span class="ident" id="5022460">parents</span><span class="op" id="5022467">[</span><span class="builtinfunc" id="5022468">len</span><span class="op" id="5022471">(</span><span class="ident" id="5022472">oldf</span><span class="op" id="5022476">.</span><span class="ident" id="5022477">parents</span><span class="op" id="5022484">)</span><span class="op" id="5022485">]</span>&nbsp;<span class="op" id="5022487">==</span>&nbsp;<span class="ident" id="5022490">oldf</span><span class="op" id="5022494">.</span><span class="ident" id="5022495">name</span>&nbsp;<span class="op" id="5022500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022506">conflicts</span>&nbsp;<span class="op" id="5022516">=</span>&nbsp;<span class="builtinfunc" id="5022518">append</span><span class="op" id="5022524">(</span><span class="ident" id="5022525">conflicts</span><span class="op" id="5022534">,</span>&nbsp;<span class="ident" id="5022536">i</span><span class="op" id="5022537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022546">}</span>&nbsp;<span class="keyword" id="5022548">else</span>&nbsp;<span class="op" id="5022553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022558">if</span>&nbsp;<span class="ident" id="5022561">newf</span><span class="op" id="5022565">.</span><span class="ident" id="5022566">name</span>&nbsp;<span class="op" id="5022571">==</span>&nbsp;<span class="ident" id="5022574">oldf</span><span class="op" id="5022578">.</span><span class="ident" id="5022579">name</span>&nbsp;<span class="op" id="5022584">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022590">conflicts</span>&nbsp;<span class="op" id="5022600">=</span>&nbsp;<span class="builtinfunc" id="5022602">append</span><span class="op" id="5022608">(</span><span class="ident" id="5022609">conflicts</span><span class="op" id="5022618">,</span>&nbsp;<span class="ident" id="5022620">i</span><span class="op" id="5022621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022636">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022689">if</span>&nbsp;<span class="ident" id="5022692">conflicts</span>&nbsp;<span class="op" id="5022702">==</span>&nbsp;<span class="ident" id="5022705">nil</span>&nbsp;<span class="op" id="5022709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022713">tinfo</span><span class="op" id="5022718">.</span><span class="ident" id="5022719">fields</span>&nbsp;<span class="op" id="5022726">=</span>&nbsp;<span class="builtinfunc" id="5022728">append</span><span class="op" id="5022734">(</span><span class="ident" id="5022735">tinfo</span><span class="op" id="5022740">.</span><span class="ident" id="5022741">fields</span><span class="op" id="5022747">,</span>&nbsp;<span class="op" id="5022749">*</span><span class="ident" id="5022750">newf</span><span class="op" id="5022754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022758">return</span>&nbsp;<span class="ident" id="5022765">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022774">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022830">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022885">for</span>&nbsp;<span class="ident" id="5022889">_</span><span class="op" id="5022890">,</span>&nbsp;<span class="ident" id="5022892">i</span>&nbsp;<span class="op" id="5022894">:=</span>&nbsp;<span class="keyword" id="5022897">range</span>&nbsp;<span class="ident" id="5022903">conflicts</span>&nbsp;<span class="op" id="5022913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022917">if</span>&nbsp;<span class="builtinfunc" id="5022920">len</span><span class="op" id="5022923">(</span><span class="ident" id="5022924">tinfo</span><span class="op" id="5022929">.</span><span class="ident" id="5022930">fields</span><span class="op" id="5022936">[</span><span class="ident" id="5022937">i</span><span class="op" id="5022938">]</span><span class="op" id="5022939">.</span><span class="ident" id="5022940">idx</span><span class="op" id="5022943">)</span>&nbsp;<span class="op" id="5022945">&lt;</span>&nbsp;<span class="builtinfunc" id="5022947">len</span><span class="op" id="5022950">(</span><span class="ident" id="5022951">newf</span><span class="op" id="5022955">.</span><span class="ident" id="5022956">idx</span><span class="op" id="5022959">)</span>&nbsp;<span class="op" id="5022961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022966">return</span>&nbsp;<span class="ident" id="5022973">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022986">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023059">for</span>&nbsp;<span class="ident" id="5023063">_</span><span class="op" id="5023064">,</span>&nbsp;<span class="ident" id="5023066">i</span>&nbsp;<span class="op" id="5023068">:=</span>&nbsp;<span class="keyword" id="5023071">range</span>&nbsp;<span class="ident" id="5023077">conflicts</span>&nbsp;<span class="op" id="5023087">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023091">oldf</span>&nbsp;<span class="op" id="5023096">:=</span>&nbsp;<span class="op" id="5023099">&amp;</span><span class="ident" id="5023100">tinfo</span><span class="op" id="5023105">.</span><span class="ident" id="5023106">fields</span><span class="op" id="5023112">[</span><span class="ident" id="5023113">i</span><span class="op" id="5023114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023118">if</span>&nbsp;<span class="builtinfunc" id="5023121">len</span><span class="op" id="5023124">(</span><span class="ident" id="5023125">oldf</span><span class="op" id="5023129">.</span><span class="ident" id="5023130">idx</span><span class="op" id="5023133">)</span>&nbsp;<span class="op" id="5023135">==</span>&nbsp;<span class="builtinfunc" id="5023138">len</span><span class="op" id="5023141">(</span><span class="ident" id="5023142">newf</span><span class="op" id="5023146">.</span><span class="ident" id="5023147">idx</span><span class="op" id="5023150">)</span>&nbsp;<span class="op" id="5023152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023157">f1</span>&nbsp;<span class="op" id="5023160">:=</span>&nbsp;<span class="ident" id="5023163">typ</span><span class="op" id="5023166">.</span><span class="ident" id="5023167">FieldByIndex</span><span class="op" id="5023179">(</span><span class="ident" id="5023180">oldf</span><span class="op" id="5023184">.</span><span class="ident" id="5023185">idx</span><span class="op" id="5023188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023193">f2</span>&nbsp;<span class="op" id="5023196">:=</span>&nbsp;<span class="ident" id="5023199">typ</span><span class="op" id="5023202">.</span><span class="ident" id="5023203">FieldByIndex</span><span class="op" id="5023215">(</span><span class="ident" id="5023216">newf</span><span class="op" id="5023220">.</span><span class="ident" id="5023221">idx</span><span class="op" id="5023224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023229">return</span>&nbsp;<span class="op" id="5023236">&amp;</span><span class="ident" id="5023237">TagPathError</span><span class="op" id="5023249">{</span><span class="ident" id="5023250">typ</span><span class="op" id="5023253">,</span>&nbsp;<span class="ident" id="5023255">f1</span><span class="op" id="5023257">.</span><span class="ident" id="5023258">Name</span><span class="op" id="5023262">,</span>&nbsp;<span class="ident" id="5023264">f1</span><span class="op" id="5023266">.</span><span class="ident" id="5023267">Tag</span><span class="op" id="5023270">.</span><span class="ident" id="5023271">Get</span><span class="op" id="5023274">(</span><span class="string" id="5023275">&#34;xml&#34;</span><span class="op" id="5023280">)</span><span class="op" id="5023281">,</span>&nbsp;<span class="ident" id="5023283">f2</span><span class="op" id="5023285">.</span><span class="ident" id="5023286">Name</span><span class="op" id="5023290">,</span>&nbsp;<span class="ident" id="5023292">f2</span><span class="op" id="5023294">.</span><span class="ident" id="5023295">Tag</span><span class="op" id="5023298">.</span><span class="ident" id="5023299">Get</span><span class="op" id="5023302">(</span><span class="string" id="5023303">&#34;xml&#34;</span><span class="op" id="5023308">)</span><span class="op" id="5023309">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023320">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023390">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023460">for</span>&nbsp;<span class="ident" id="5023464">c</span>&nbsp;<span class="op" id="5023466">:=</span>&nbsp;<span class="builtinfunc" id="5023469">len</span><span class="op" id="5023472">(</span><span class="ident" id="5023473">conflicts</span><span class="op" id="5023482">)</span>&nbsp;<span class="op" id="5023484">-</span>&nbsp;<span class="num" id="5023486">1</span><span class="op" id="5023487">;</span>&nbsp;<span class="ident" id="5023489">c</span>&nbsp;<span class="op" id="5023491">&gt;=</span>&nbsp;<span class="num" id="5023494">0</span><span class="op" id="5023495">;</span>&nbsp;<span class="ident" id="5023497">c</span><span class="op" id="5023498">--</span>&nbsp;<span class="op" id="5023501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023505">i</span>&nbsp;<span class="op" id="5023507">:=</span>&nbsp;<span class="ident" id="5023510">conflicts</span><span class="op" id="5023519">[</span><span class="ident" id="5023520">c</span><span class="op" id="5023521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5023525">copy</span><span class="op" id="5023529">(</span><span class="ident" id="5023530">tinfo</span><span class="op" id="5023535">.</span><span class="ident" id="5023536">fields</span><span class="op" id="5023542">[</span><span class="ident" id="5023543">i</span><span class="op" id="5023544">:</span><span class="op" id="5023545">]</span><span class="op" id="5023546">,</span>&nbsp;<span class="ident" id="5023548">tinfo</span><span class="op" id="5023553">.</span><span class="ident" id="5023554">fields</span><span class="op" id="5023560">[</span><span class="ident" id="5023561">i</span><span class="op" id="5023562">+</span><span class="num" id="5023563">1</span><span class="op" id="5023564">:</span><span class="op" id="5023565">]</span><span class="op" id="5023566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023570">tinfo</span><span class="op" id="5023575">.</span><span class="ident" id="5023576">fields</span>&nbsp;<span class="op" id="5023583">=</span>&nbsp;<span class="ident" id="5023585">tinfo</span><span class="op" id="5023590">.</span><span class="ident" id="5023591">fields</span><span class="op" id="5023597">[</span><span class="op" id="5023598">:</span><span class="builtinfunc" id="5023599">len</span><span class="op" id="5023602">(</span><span class="ident" id="5023603">tinfo</span><span class="op" id="5023608">.</span><span class="ident" id="5023609">fields</span><span class="op" id="5023615">)</span><span class="op" id="5023616">-</span><span class="num" id="5023617">1</span><span class="op" id="5023618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023621">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023624">tinfo</span><span class="op" id="5023629">.</span><span class="ident" id="5023630">fields</span>&nbsp;<span class="op" id="5023637">=</span>&nbsp;<span class="builtinfunc" id="5023639">append</span><span class="op" id="5023645">(</span><span class="ident" id="5023646">tinfo</span><span class="op" id="5023651">.</span><span class="ident" id="5023652">fields</span><span class="op" id="5023658">,</span>&nbsp;<span class="op" id="5023660">*</span><span class="ident" id="5023661">newf</span><span class="op" id="5023665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023668">return</span>&nbsp;<span class="ident" id="5023675">nil</span><br>
<span class="lineno"></span><span class="op" id="5023679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5023682">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="5023749">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="5023808">type</span>&nbsp;<span class="ident" id="5023813">TagPathError</span>&nbsp;<span class="keyword" id="5023826">struct</span>&nbsp;<span class="op" id="5023833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023836">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5023849">reflect</span><span class="op" id="5023856">.</span><span class="ident" id="5023857">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023863">Field1</span><span class="op" id="5023869">,</span>&nbsp;<span class="ident" id="5023871">Tag1</span>&nbsp;<span class="builtintype" id="5023876">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023884">Field2</span><span class="op" id="5023890">,</span>&nbsp;<span class="ident" id="5023892">Tag2</span>&nbsp;<span class="builtintype" id="5023897">string</span><br>
<span class="lineno">340</span><span class="op" id="5023904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5023907">func</span>&nbsp;<span class="op" id="5023912">(</span><span class="ident" id="5023913">e</span>&nbsp;<span class="op" id="5023915">*</span><span class="ident" id="5023916">TagPathError</span><span class="op" id="5023928">)</span>&nbsp;<span class="ident" id="5023930">Error</span><span class="op" id="5023935">(</span><span class="op" id="5023936">)</span>&nbsp;<span class="builtintype" id="5023938">string</span>&nbsp;<span class="op" id="5023945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023948">return</span>&nbsp;<span class="ident" id="5023955">fmt</span><span class="op" id="5023958">.</span><span class="ident" id="5023959">Sprintf</span><span class="op" id="5023966">(</span><span class="string" id="5023967">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="5024028">,</span>&nbsp;<span class="ident" id="5024030">e</span><span class="op" id="5024031">.</span><span class="ident" id="5024032">Struct</span><span class="op" id="5024038">,</span>&nbsp;<span class="ident" id="5024040">e</span><span class="op" id="5024041">.</span><span class="ident" id="5024042">Field1</span><span class="op" id="5024048">,</span>&nbsp;<span class="ident" id="5024050">e</span><span class="op" id="5024051">.</span><span class="ident" id="5024052">Tag1</span><span class="op" id="5024056">,</span>&nbsp;<span class="ident" id="5024058">e</span><span class="op" id="5024059">.</span><span class="ident" id="5024060">Field2</span><span class="op" id="5024066">,</span>&nbsp;<span class="ident" id="5024068">e</span><span class="op" id="5024069">.</span><span class="ident" id="5024070">Tag2</span><span class="op" id="5024074">)</span><br>
<span class="lineno"></span><span class="op" id="5024076">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5024079">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="5024136">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="5024201">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5024244">func</span>&nbsp;<span class="op" id="5024249">(</span><span class="ident" id="5024250">finfo</span>&nbsp;<span class="op" id="5024256">*</span><span class="ident" id="5024257">fieldInfo</span><span class="op" id="5024266">)</span>&nbsp;<span class="ident" id="5024268">value</span><span class="op" id="5024273">(</span><span class="ident" id="5024274">v</span>&nbsp;<span class="ident" id="5024276">reflect</span><span class="op" id="5024283">.</span><span class="ident" id="5024284">Value</span><span class="op" id="5024289">)</span>&nbsp;<span class="ident" id="5024291">reflect</span><span class="op" id="5024298">.</span><span class="ident" id="5024299">Value</span>&nbsp;<span class="op" id="5024305">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024308">for</span>&nbsp;<span class="ident" id="5024312">i</span><span class="op" id="5024313">,</span>&nbsp;<span class="ident" id="5024315">x</span>&nbsp;<span class="op" id="5024317">:=</span>&nbsp;<span class="keyword" id="5024320">range</span>&nbsp;<span class="ident" id="5024326">finfo</span><span class="op" id="5024331">.</span><span class="ident" id="5024332">idx</span>&nbsp;<span class="op" id="5024336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024340">if</span>&nbsp;<span class="ident" id="5024343">i</span>&nbsp;<span class="op" id="5024345">&gt;</span>&nbsp;<span class="num" id="5024347">0</span>&nbsp;<span class="op" id="5024349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024354">t</span>&nbsp;<span class="op" id="5024356">:=</span>&nbsp;<span class="ident" id="5024359">v</span><span class="op" id="5024360">.</span><span class="ident" id="5024361">Type</span><span class="op" id="5024365">(</span><span class="op" id="5024366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024371">if</span>&nbsp;<span class="ident" id="5024374">t</span><span class="op" id="5024375">.</span><span class="ident" id="5024376">Kind</span><span class="op" id="5024380">(</span><span class="op" id="5024381">)</span>&nbsp;<span class="op" id="5024383">==</span>&nbsp;<span class="ident" id="5024386">reflect</span><span class="op" id="5024393">.</span><span class="ident" id="5024394">Ptr</span>&nbsp;<span class="op" id="5024398">&amp;&amp;</span>&nbsp;<span class="ident" id="5024401">t</span><span class="op" id="5024402">.</span><span class="ident" id="5024403">Elem</span><span class="op" id="5024407">(</span><span class="op" id="5024408">)</span><span class="op" id="5024409">.</span><span class="ident" id="5024410">Kind</span><span class="op" id="5024414">(</span><span class="op" id="5024415">)</span>&nbsp;<span class="op" id="5024417">==</span>&nbsp;<span class="ident" id="5024420">reflect</span><span class="op" id="5024427">.</span><span class="ident" id="5024428">Struct</span>&nbsp;<span class="op" id="5024435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024441">if</span>&nbsp;<span class="ident" id="5024444">v</span><span class="op" id="5024445">.</span><span class="ident" id="5024446">IsNil</span><span class="op" id="5024451">(</span><span class="op" id="5024452">)</span>&nbsp;<span class="op" id="5024454">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024461">v</span><span class="op" id="5024462">.</span><span class="ident" id="5024463">Set</span><span class="op" id="5024466">(</span><span class="ident" id="5024467">reflect</span><span class="op" id="5024474">.</span><span class="ident" id="5024475">New</span><span class="op" id="5024478">(</span><span class="ident" id="5024479">v</span><span class="op" id="5024480">.</span><span class="ident" id="5024481">Type</span><span class="op" id="5024485">(</span><span class="op" id="5024486">)</span><span class="op" id="5024487">.</span><span class="ident" id="5024488">Elem</span><span class="op" id="5024492">(</span><span class="op" id="5024493">)</span><span class="op" id="5024494">)</span><span class="op" id="5024495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024507">v</span>&nbsp;<span class="op" id="5024509">=</span>&nbsp;<span class="ident" id="5024511">v</span><span class="op" id="5024512">.</span><span class="ident" id="5024513">Elem</span><span class="op" id="5024517">(</span><span class="op" id="5024518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024527">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024531">v</span>&nbsp;<span class="op" id="5024533">=</span>&nbsp;<span class="ident" id="5024535">v</span><span class="op" id="5024536">.</span><span class="ident" id="5024537">Field</span><span class="op" id="5024542">(</span><span class="ident" id="5024543">x</span><span class="op" id="5024544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024550">return</span>&nbsp;<span class="ident" id="5024557">v</span><br>
<span class="lineno"></span><span class="op" id="5024559">}</span>
</div>
</body>
</html>
