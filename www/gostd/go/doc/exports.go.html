<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5452342">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5452397">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5452451">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5452502">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5452555">package</span>&nbsp;<span class="ident" id="5452563">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5452568">import</span>&nbsp;<span class="op" id="5452575">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5452578">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5452588">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="5452599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5452602">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="5452665">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="5452725">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5452771">//</span><br>
<span class="lineno"></span><span class="keyword" id="5452774">func</span>&nbsp;<span class="ident" id="5452779">filterIdentList</span><span class="op" id="5452794">(</span><span class="ident" id="5452795">list</span>&nbsp;<span class="op" id="5452800">[</span><span class="op" id="5452801">]</span><span class="op" id="5452802">*</span><span class="ident" id="5452803">ast</span><span class="op" id="5452806">.</span><span class="ident" id="5452807">Ident</span><span class="op" id="5452812">,</span>&nbsp;<span class="ident" id="5452814">blankOk</span>&nbsp;<span class="builtintype" id="5452822">bool</span><span class="op" id="5452826">)</span>&nbsp;<span class="op" id="5452828">[</span><span class="op" id="5452829">]</span><span class="op" id="5452830">*</span><span class="ident" id="5452831">ast</span><span class="op" id="5452834">.</span><span class="ident" id="5452835">Ident</span>&nbsp;<span class="op" id="5452841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452844">j</span>&nbsp;<span class="op" id="5452846">:=</span>&nbsp;<span class="num" id="5452849">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452852">for</span>&nbsp;<span class="ident" id="5452856">_</span><span class="op" id="5452857">,</span>&nbsp;<span class="ident" id="5452859">x</span>&nbsp;<span class="op" id="5452861">:=</span>&nbsp;<span class="keyword" id="5452864">range</span>&nbsp;<span class="ident" id="5452870">list</span>&nbsp;<span class="op" id="5452875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452879">if</span>&nbsp;<span class="ident" id="5452882">ast</span><span class="op" id="5452885">.</span><span class="ident" id="5452886">IsExported</span><span class="op" id="5452896">(</span><span class="ident" id="5452897">x</span><span class="op" id="5452898">.</span><span class="ident" id="5452899">Name</span><span class="op" id="5452903">)</span>&nbsp;<span class="op" id="5452905">||</span>&nbsp;<span class="op" id="5452908">(</span><span class="ident" id="5452909">blankOk</span>&nbsp;<span class="op" id="5452917">&amp;&amp;</span>&nbsp;<span class="ident" id="5452920">x</span><span class="op" id="5452921">.</span><span class="ident" id="5452922">Name</span>&nbsp;<span class="op" id="5452927">==</span>&nbsp;<span class="string" id="5452930">&#34;_&#34;</span><span class="op" id="5452933">)</span>&nbsp;<span class="op" id="5452935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452940">list</span><span class="op" id="5452944">[</span><span class="ident" id="5452945">j</span><span class="op" id="5452946">]</span>&nbsp;<span class="op" id="5452948">=</span>&nbsp;<span class="ident" id="5452950">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452955">j</span><span class="op" id="5452956">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452961">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452967">return</span>&nbsp;<span class="ident" id="5452974">list</span><span class="op" id="5452978">[</span><span class="num" id="5452979">0</span><span class="op" id="5452980">:</span><span class="ident" id="5452981">j</span><span class="op" id="5452982">]</span><br>
<span class="lineno"></span><span class="op" id="5452984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5452987">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="5453065">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="5453136">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5453165">//</span><br>
<span class="lineno"></span><span class="keyword" id="5453168">func</span>&nbsp;<span class="ident" id="5453173">removeErrorField</span><span class="op" id="5453189">(</span><span class="ident" id="5453190">ityp</span>&nbsp;<span class="op" id="5453195">*</span><span class="ident" id="5453196">ast</span><span class="op" id="5453199">.</span><span class="ident" id="5453200">InterfaceType</span><span class="op" id="5453213">)</span>&nbsp;<span class="op" id="5453215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453218">list</span>&nbsp;<span class="op" id="5453223">:=</span>&nbsp;<span class="ident" id="5453226">ityp</span><span class="op" id="5453230">.</span><span class="ident" id="5453231">Methods</span><span class="op" id="5453238">.</span><span class="ident" id="5453239">List</span>&nbsp;<span class="comment" id="5453244">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453281">j</span>&nbsp;<span class="op" id="5453283">:=</span>&nbsp;<span class="num" id="5453286">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453289">for</span>&nbsp;<span class="ident" id="5453293">_</span><span class="op" id="5453294">,</span>&nbsp;<span class="ident" id="5453296">field</span>&nbsp;<span class="op" id="5453302">:=</span>&nbsp;<span class="keyword" id="5453305">range</span>&nbsp;<span class="ident" id="5453311">list</span>&nbsp;<span class="op" id="5453316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453320">keepField</span>&nbsp;<span class="op" id="5453330">:=</span>&nbsp;<span class="builtintype" id="5453333">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453340">if</span>&nbsp;<span class="ident" id="5453343">n</span>&nbsp;<span class="op" id="5453345">:=</span>&nbsp;<span class="builtinfunc" id="5453348">len</span><span class="op" id="5453351">(</span><span class="ident" id="5453352">field</span><span class="op" id="5453357">.</span><span class="ident" id="5453358">Names</span><span class="op" id="5453363">)</span><span class="op" id="5453364">;</span>&nbsp;<span class="ident" id="5453366">n</span>&nbsp;<span class="op" id="5453368">==</span>&nbsp;<span class="num" id="5453371">0</span>&nbsp;<span class="op" id="5453373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453378">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453400">if</span>&nbsp;<span class="ident" id="5453403">fname</span><span class="op" id="5453408">,</span>&nbsp;<span class="ident" id="5453410">_</span>&nbsp;<span class="op" id="5453412">:=</span>&nbsp;<span class="ident" id="5453415">baseTypeName</span><span class="op" id="5453427">(</span><span class="ident" id="5453428">field</span><span class="op" id="5453433">.</span><span class="ident" id="5453434">Type</span><span class="op" id="5453438">)</span><span class="op" id="5453439">;</span>&nbsp;<span class="ident" id="5453441">fname</span>&nbsp;<span class="op" id="5453447">==</span>&nbsp;<span class="string" id="5453450">&#34;error&#34;</span>&nbsp;<span class="op" id="5453458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453464">keepField</span>&nbsp;<span class="op" id="5453474">=</span>&nbsp;<span class="builtintype" id="5453476">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453493">if</span>&nbsp;<span class="ident" id="5453496">keepField</span>&nbsp;<span class="op" id="5453506">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453511">list</span><span class="op" id="5453515">[</span><span class="ident" id="5453516">j</span><span class="op" id="5453517">]</span>&nbsp;<span class="op" id="5453519">=</span>&nbsp;<span class="ident" id="5453521">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453530">j</span><span class="op" id="5453531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453542">if</span>&nbsp;<span class="ident" id="5453545">j</span>&nbsp;<span class="op" id="5453547">&lt;</span>&nbsp;<span class="builtinfunc" id="5453549">len</span><span class="op" id="5453552">(</span><span class="ident" id="5453553">list</span><span class="op" id="5453557">)</span>&nbsp;<span class="op" id="5453559">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453563">ityp</span><span class="op" id="5453567">.</span><span class="ident" id="5453568">Incomplete</span>&nbsp;<span class="op" id="5453579">=</span>&nbsp;<span class="builtintype" id="5453581">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453590">ityp</span><span class="op" id="5453594">.</span><span class="ident" id="5453595">Methods</span><span class="op" id="5453602">.</span><span class="ident" id="5453603">List</span>&nbsp;<span class="op" id="5453608">=</span>&nbsp;<span class="ident" id="5453610">list</span><span class="op" id="5453614">[</span><span class="num" id="5453615">0</span><span class="op" id="5453616">:</span><span class="ident" id="5453617">j</span><span class="op" id="5453618">]</span><br>
<span class="lineno"></span><span class="op" id="5453620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5453623">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5453702">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5453776">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5453849">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5453874">//</span><br>
<span class="lineno">60</span><span class="keyword" id="5453877">func</span>&nbsp;<span class="op" id="5453882">(</span><span class="ident" id="5453883">r</span>&nbsp;<span class="op" id="5453885">*</span><span class="ident" id="5453886">reader</span><span class="op" id="5453892">)</span>&nbsp;<span class="ident" id="5453894">filterFieldList</span><span class="op" id="5453909">(</span><span class="ident" id="5453910">parent</span>&nbsp;<span class="op" id="5453917">*</span><span class="ident" id="5453918">namedType</span><span class="op" id="5453927">,</span>&nbsp;<span class="ident" id="5453929">fields</span>&nbsp;<span class="op" id="5453936">*</span><span class="ident" id="5453937">ast</span><span class="op" id="5453940">.</span><span class="ident" id="5453941">FieldList</span><span class="op" id="5453950">,</span>&nbsp;<span class="ident" id="5453952">ityp</span>&nbsp;<span class="op" id="5453957">*</span><span class="ident" id="5453958">ast</span><span class="op" id="5453961">.</span><span class="ident" id="5453962">InterfaceType</span><span class="op" id="5453975">)</span>&nbsp;<span class="op" id="5453977">(</span><span class="ident" id="5453978">removedFields</span>&nbsp;<span class="builtintype" id="5453992">bool</span><span class="op" id="5453996">)</span>&nbsp;<span class="op" id="5453998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454001">if</span>&nbsp;<span class="ident" id="5454004">fields</span>&nbsp;<span class="op" id="5454011">==</span>&nbsp;<span class="ident" id="5454014">nil</span>&nbsp;<span class="op" id="5454018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454022">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454033">list</span>&nbsp;<span class="op" id="5454038">:=</span>&nbsp;<span class="ident" id="5454041">fields</span><span class="op" id="5454047">.</span><span class="ident" id="5454048">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454054">j</span>&nbsp;<span class="op" id="5454056">:=</span>&nbsp;<span class="num" id="5454059">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454062">for</span>&nbsp;<span class="ident" id="5454066">_</span><span class="op" id="5454067">,</span>&nbsp;<span class="ident" id="5454069">field</span>&nbsp;<span class="op" id="5454075">:=</span>&nbsp;<span class="keyword" id="5454078">range</span>&nbsp;<span class="ident" id="5454084">list</span>&nbsp;<span class="op" id="5454089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454093">keepField</span>&nbsp;<span class="op" id="5454103">:=</span>&nbsp;<span class="builtintype" id="5454106">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454114">if</span>&nbsp;<span class="ident" id="5454117">n</span>&nbsp;<span class="op" id="5454119">:=</span>&nbsp;<span class="builtinfunc" id="5454122">len</span><span class="op" id="5454125">(</span><span class="ident" id="5454126">field</span><span class="op" id="5454131">.</span><span class="ident" id="5454132">Names</span><span class="op" id="5454137">)</span><span class="op" id="5454138">;</span>&nbsp;<span class="ident" id="5454140">n</span>&nbsp;<span class="op" id="5454142">==</span>&nbsp;<span class="num" id="5454145">0</span>&nbsp;<span class="op" id="5454147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454152">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454174">fname</span>&nbsp;<span class="op" id="5454180">:=</span>&nbsp;<span class="ident" id="5454183">r</span><span class="op" id="5454184">.</span><span class="ident" id="5454185">recordAnonymousField</span><span class="op" id="5454205">(</span><span class="ident" id="5454206">parent</span><span class="op" id="5454212">,</span>&nbsp;<span class="ident" id="5454214">field</span><span class="op" id="5454219">.</span><span class="ident" id="5454220">Type</span><span class="op" id="5454224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454229">if</span>&nbsp;<span class="ident" id="5454232">ast</span><span class="op" id="5454235">.</span><span class="ident" id="5454236">IsExported</span><span class="op" id="5454246">(</span><span class="ident" id="5454247">fname</span><span class="op" id="5454252">)</span>&nbsp;<span class="op" id="5454254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454260">keepField</span>&nbsp;<span class="op" id="5454270">=</span>&nbsp;<span class="builtintype" id="5454272">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454280">}</span>&nbsp;<span class="keyword" id="5454282">else</span>&nbsp;<span class="keyword" id="5454287">if</span>&nbsp;<span class="ident" id="5454290">ityp</span>&nbsp;<span class="op" id="5454295">!=</span>&nbsp;<span class="ident" id="5454298">nil</span>&nbsp;<span class="op" id="5454302">&amp;&amp;</span>&nbsp;<span class="ident" id="5454305">fname</span>&nbsp;<span class="op" id="5454311">==</span>&nbsp;<span class="string" id="5454314">&#34;error&#34;</span>&nbsp;<span class="op" id="5454322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454328">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454382">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454436">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454492">keepField</span>&nbsp;<span class="op" id="5454502">=</span>&nbsp;<span class="builtintype" id="5454504">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454513">r</span><span class="op" id="5454514">.</span><span class="ident" id="5454515">remember</span><span class="op" id="5454523">(</span><span class="ident" id="5454524">ityp</span><span class="op" id="5454528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454533">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454537">}</span>&nbsp;<span class="keyword" id="5454539">else</span>&nbsp;<span class="op" id="5454544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454549">field</span><span class="op" id="5454554">.</span><span class="ident" id="5454555">Names</span>&nbsp;<span class="op" id="5454561">=</span>&nbsp;<span class="ident" id="5454563">filterIdentList</span><span class="op" id="5454578">(</span><span class="ident" id="5454579">field</span><span class="op" id="5454584">.</span><span class="ident" id="5454585">Names</span><span class="op" id="5454590">,</span>&nbsp;<span class="builtintype" id="5454592">false</span><span class="op" id="5454597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454602">if</span>&nbsp;<span class="builtinfunc" id="5454605">len</span><span class="op" id="5454608">(</span><span class="ident" id="5454609">field</span><span class="op" id="5454614">.</span><span class="ident" id="5454615">Names</span><span class="op" id="5454620">)</span>&nbsp;<span class="op" id="5454622">&lt;</span>&nbsp;<span class="ident" id="5454624">n</span>&nbsp;<span class="op" id="5454626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454632">removedFields</span>&nbsp;<span class="op" id="5454646">=</span>&nbsp;<span class="builtintype" id="5454648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454656">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454661">if</span>&nbsp;<span class="builtinfunc" id="5454664">len</span><span class="op" id="5454667">(</span><span class="ident" id="5454668">field</span><span class="op" id="5454673">.</span><span class="ident" id="5454674">Names</span><span class="op" id="5454679">)</span>&nbsp;<span class="op" id="5454681">&gt;</span>&nbsp;<span class="num" id="5454683">0</span>&nbsp;<span class="op" id="5454685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454691">keepField</span>&nbsp;<span class="op" id="5454701">=</span>&nbsp;<span class="builtintype" id="5454703">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454719">if</span>&nbsp;<span class="ident" id="5454722">keepField</span>&nbsp;<span class="op" id="5454732">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454737">r</span><span class="op" id="5454738">.</span><span class="ident" id="5454739">filterType</span><span class="op" id="5454749">(</span><span class="ident" id="5454750">nil</span><span class="op" id="5454753">,</span>&nbsp;<span class="ident" id="5454755">field</span><span class="op" id="5454760">.</span><span class="ident" id="5454761">Type</span><span class="op" id="5454765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454770">list</span><span class="op" id="5454774">[</span><span class="ident" id="5454775">j</span><span class="op" id="5454776">]</span>&nbsp;<span class="op" id="5454778">=</span>&nbsp;<span class="ident" id="5454780">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454789">j</span><span class="op" id="5454790">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454798">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454801">if</span>&nbsp;<span class="ident" id="5454804">j</span>&nbsp;<span class="op" id="5454806">&lt;</span>&nbsp;<span class="builtinfunc" id="5454808">len</span><span class="op" id="5454811">(</span><span class="ident" id="5454812">list</span><span class="op" id="5454816">)</span>&nbsp;<span class="op" id="5454818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454822">removedFields</span>&nbsp;<span class="op" id="5454836">=</span>&nbsp;<span class="builtintype" id="5454838">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454847">fields</span><span class="op" id="5454853">.</span><span class="ident" id="5454854">List</span>&nbsp;<span class="op" id="5454859">=</span>&nbsp;<span class="ident" id="5454861">list</span><span class="op" id="5454865">[</span><span class="num" id="5454866">0</span><span class="op" id="5454867">:</span><span class="ident" id="5454868">j</span><span class="op" id="5454869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454872">return</span><br>
<span class="lineno">100</span><span class="op" id="5454879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454882">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5454954">//</span><br>
<span class="lineno"></span><span class="keyword" id="5454957">func</span>&nbsp;<span class="op" id="5454962">(</span><span class="ident" id="5454963">r</span>&nbsp;<span class="op" id="5454965">*</span><span class="ident" id="5454966">reader</span><span class="op" id="5454972">)</span>&nbsp;<span class="ident" id="5454974">filterParamList</span><span class="op" id="5454989">(</span><span class="ident" id="5454990">fields</span>&nbsp;<span class="op" id="5454997">*</span><span class="ident" id="5454998">ast</span><span class="op" id="5455001">.</span><span class="ident" id="5455002">FieldList</span><span class="op" id="5455011">)</span>&nbsp;<span class="op" id="5455013">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455016">if</span>&nbsp;<span class="ident" id="5455019">fields</span>&nbsp;<span class="op" id="5455026">!=</span>&nbsp;<span class="ident" id="5455029">nil</span>&nbsp;<span class="op" id="5455033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455037">for</span>&nbsp;<span class="ident" id="5455041">_</span><span class="op" id="5455042">,</span>&nbsp;<span class="ident" id="5455044">f</span>&nbsp;<span class="op" id="5455046">:=</span>&nbsp;<span class="keyword" id="5455049">range</span>&nbsp;<span class="ident" id="5455055">fields</span><span class="op" id="5455061">.</span><span class="ident" id="5455062">List</span>&nbsp;<span class="op" id="5455067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455072">r</span><span class="op" id="5455073">.</span><span class="ident" id="5455074">filterType</span><span class="op" id="5455084">(</span><span class="ident" id="5455085">nil</span><span class="op" id="5455088">,</span>&nbsp;<span class="ident" id="5455090">f</span><span class="op" id="5455091">.</span><span class="ident" id="5455092">Type</span><span class="op" id="5455096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455103">}</span><br>
<span class="lineno">110</span><span class="op" id="5455105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455108">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="5455183">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5455256">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="5455322">//</span><br>
<span class="lineno"></span><span class="keyword" id="5455325">func</span>&nbsp;<span class="op" id="5455330">(</span><span class="ident" id="5455331">r</span>&nbsp;<span class="op" id="5455333">*</span><span class="ident" id="5455334">reader</span><span class="op" id="5455340">)</span>&nbsp;<span class="ident" id="5455342">filterType</span><span class="op" id="5455352">(</span><span class="ident" id="5455353">parent</span>&nbsp;<span class="op" id="5455360">*</span><span class="ident" id="5455361">namedType</span><span class="op" id="5455370">,</span>&nbsp;<span class="ident" id="5455372">typ</span>&nbsp;<span class="ident" id="5455376">ast</span><span class="op" id="5455379">.</span><span class="ident" id="5455380">Expr</span><span class="op" id="5455384">)</span>&nbsp;<span class="op" id="5455386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455389">switch</span>&nbsp;<span class="ident" id="5455396">t</span>&nbsp;<span class="op" id="5455398">:=</span>&nbsp;<span class="ident" id="5455401">typ</span><span class="op" id="5455404">.</span><span class="op" id="5455405">(</span><span class="keyword" id="5455406">type</span><span class="op" id="5455410">)</span>&nbsp;<span class="op" id="5455412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455415">case</span>&nbsp;<span class="op" id="5455420">*</span><span class="ident" id="5455421">ast</span><span class="op" id="5455424">.</span><span class="ident" id="5455425">Ident</span><span class="op" id="5455430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5455434">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455452">case</span>&nbsp;<span class="op" id="5455457">*</span><span class="ident" id="5455458">ast</span><span class="op" id="5455461">.</span><span class="ident" id="5455462">ParenExpr</span><span class="op" id="5455471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455475">r</span><span class="op" id="5455476">.</span><span class="ident" id="5455477">filterType</span><span class="op" id="5455487">(</span><span class="ident" id="5455488">nil</span><span class="op" id="5455491">,</span>&nbsp;<span class="ident" id="5455493">t</span><span class="op" id="5455494">.</span><span class="ident" id="5455495">X</span><span class="op" id="5455496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455499">case</span>&nbsp;<span class="op" id="5455504">*</span><span class="ident" id="5455505">ast</span><span class="op" id="5455508">.</span><span class="ident" id="5455509">ArrayType</span><span class="op" id="5455518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455522">r</span><span class="op" id="5455523">.</span><span class="ident" id="5455524">filterType</span><span class="op" id="5455534">(</span><span class="ident" id="5455535">nil</span><span class="op" id="5455538">,</span>&nbsp;<span class="ident" id="5455540">t</span><span class="op" id="5455541">.</span><span class="ident" id="5455542">Elt</span><span class="op" id="5455545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455548">case</span>&nbsp;<span class="op" id="5455553">*</span><span class="ident" id="5455554">ast</span><span class="op" id="5455557">.</span><span class="ident" id="5455558">StructType</span><span class="op" id="5455568">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455572">if</span>&nbsp;<span class="ident" id="5455575">r</span><span class="op" id="5455576">.</span><span class="ident" id="5455577">filterFieldList</span><span class="op" id="5455592">(</span><span class="ident" id="5455593">parent</span><span class="op" id="5455599">,</span>&nbsp;<span class="ident" id="5455601">t</span><span class="op" id="5455602">.</span><span class="ident" id="5455603">Fields</span><span class="op" id="5455609">,</span>&nbsp;<span class="ident" id="5455611">nil</span><span class="op" id="5455614">)</span>&nbsp;<span class="op" id="5455616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455621">t</span><span class="op" id="5455622">.</span><span class="ident" id="5455623">Incomplete</span>&nbsp;<span class="op" id="5455634">=</span>&nbsp;<span class="builtintype" id="5455636">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455646">case</span>&nbsp;<span class="op" id="5455651">*</span><span class="ident" id="5455652">ast</span><span class="op" id="5455655">.</span><span class="ident" id="5455656">FuncType</span><span class="op" id="5455664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455668">r</span><span class="op" id="5455669">.</span><span class="ident" id="5455670">filterParamList</span><span class="op" id="5455685">(</span><span class="ident" id="5455686">t</span><span class="op" id="5455687">.</span><span class="ident" id="5455688">Params</span><span class="op" id="5455694">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455698">r</span><span class="op" id="5455699">.</span><span class="ident" id="5455700">filterParamList</span><span class="op" id="5455715">(</span><span class="ident" id="5455716">t</span><span class="op" id="5455717">.</span><span class="ident" id="5455718">Results</span><span class="op" id="5455725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455728">case</span>&nbsp;<span class="op" id="5455733">*</span><span class="ident" id="5455734">ast</span><span class="op" id="5455737">.</span><span class="ident" id="5455738">InterfaceType</span><span class="op" id="5455751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455755">if</span>&nbsp;<span class="ident" id="5455758">r</span><span class="op" id="5455759">.</span><span class="ident" id="5455760">filterFieldList</span><span class="op" id="5455775">(</span><span class="ident" id="5455776">parent</span><span class="op" id="5455782">,</span>&nbsp;<span class="ident" id="5455784">t</span><span class="op" id="5455785">.</span><span class="ident" id="5455786">Methods</span><span class="op" id="5455793">,</span>&nbsp;<span class="ident" id="5455795">t</span><span class="op" id="5455796">)</span>&nbsp;<span class="op" id="5455798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455803">t</span><span class="op" id="5455804">.</span><span class="ident" id="5455805">Incomplete</span>&nbsp;<span class="op" id="5455816">=</span>&nbsp;<span class="builtintype" id="5455818">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455825">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455828">case</span>&nbsp;<span class="op" id="5455833">*</span><span class="ident" id="5455834">ast</span><span class="op" id="5455837">.</span><span class="ident" id="5455838">MapType</span><span class="op" id="5455845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455849">r</span><span class="op" id="5455850">.</span><span class="ident" id="5455851">filterType</span><span class="op" id="5455861">(</span><span class="ident" id="5455862">nil</span><span class="op" id="5455865">,</span>&nbsp;<span class="ident" id="5455867">t</span><span class="op" id="5455868">.</span><span class="ident" id="5455869">Key</span><span class="op" id="5455872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455876">r</span><span class="op" id="5455877">.</span><span class="ident" id="5455878">filterType</span><span class="op" id="5455888">(</span><span class="ident" id="5455889">nil</span><span class="op" id="5455892">,</span>&nbsp;<span class="ident" id="5455894">t</span><span class="op" id="5455895">.</span><span class="ident" id="5455896">Value</span><span class="op" id="5455901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455904">case</span>&nbsp;<span class="op" id="5455909">*</span><span class="ident" id="5455910">ast</span><span class="op" id="5455913">.</span><span class="ident" id="5455914">ChanType</span><span class="op" id="5455922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455926">r</span><span class="op" id="5455927">.</span><span class="ident" id="5455928">filterType</span><span class="op" id="5455938">(</span><span class="ident" id="5455939">nil</span><span class="op" id="5455942">,</span>&nbsp;<span class="ident" id="5455944">t</span><span class="op" id="5455945">.</span><span class="ident" id="5455946">Value</span><span class="op" id="5455951">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455954">}</span><br>
<span class="lineno"></span><span class="op" id="5455956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5455959">func</span>&nbsp;<span class="op" id="5455964">(</span><span class="ident" id="5455965">r</span>&nbsp;<span class="op" id="5455967">*</span><span class="ident" id="5455968">reader</span><span class="op" id="5455974">)</span>&nbsp;<span class="ident" id="5455976">filterSpec</span><span class="op" id="5455986">(</span><span class="ident" id="5455987">spec</span>&nbsp;<span class="ident" id="5455992">ast</span><span class="op" id="5455995">.</span><span class="ident" id="5455996">Spec</span><span class="op" id="5456000">,</span>&nbsp;<span class="ident" id="5456002">tok</span>&nbsp;<span class="ident" id="5456006">token</span><span class="op" id="5456011">.</span><span class="ident" id="5456012">Token</span><span class="op" id="5456017">)</span>&nbsp;<span class="builtintype" id="5456019">bool</span>&nbsp;<span class="op" id="5456024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456027">switch</span>&nbsp;<span class="ident" id="5456034">s</span>&nbsp;<span class="op" id="5456036">:=</span>&nbsp;<span class="ident" id="5456039">spec</span><span class="op" id="5456043">.</span><span class="op" id="5456044">(</span><span class="keyword" id="5456045">type</span><span class="op" id="5456049">)</span>&nbsp;<span class="op" id="5456051">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456054">case</span>&nbsp;<span class="op" id="5456059">*</span><span class="ident" id="5456060">ast</span><span class="op" id="5456063">.</span><span class="ident" id="5456064">ImportSpec</span><span class="op" id="5456074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456078">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456126">return</span>&nbsp;<span class="builtintype" id="5456133">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456139">case</span>&nbsp;<span class="op" id="5456144">*</span><span class="ident" id="5456145">ast</span><span class="op" id="5456148">.</span><span class="ident" id="5456149">ValueSpec</span><span class="op" id="5456158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456162">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456218">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456252">s</span><span class="op" id="5456253">.</span><span class="ident" id="5456254">Names</span>&nbsp;<span class="op" id="5456260">=</span>&nbsp;<span class="ident" id="5456262">filterIdentList</span><span class="op" id="5456277">(</span><span class="ident" id="5456278">s</span><span class="op" id="5456279">.</span><span class="ident" id="5456280">Names</span><span class="op" id="5456285">,</span>&nbsp;<span class="ident" id="5456287">tok</span>&nbsp;<span class="op" id="5456291">==</span>&nbsp;<span class="ident" id="5456294">token</span><span class="op" id="5456299">.</span><span class="ident" id="5456300">CONST</span><span class="op" id="5456305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456309">if</span>&nbsp;<span class="builtinfunc" id="5456312">len</span><span class="op" id="5456315">(</span><span class="ident" id="5456316">s</span><span class="op" id="5456317">.</span><span class="ident" id="5456318">Names</span><span class="op" id="5456323">)</span>&nbsp;<span class="op" id="5456325">&gt;</span>&nbsp;<span class="num" id="5456327">0</span>&nbsp;<span class="op" id="5456329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456334">r</span><span class="op" id="5456335">.</span><span class="ident" id="5456336">filterType</span><span class="op" id="5456346">(</span><span class="ident" id="5456347">nil</span><span class="op" id="5456350">,</span>&nbsp;<span class="ident" id="5456352">s</span><span class="op" id="5456353">.</span><span class="ident" id="5456354">Type</span><span class="op" id="5456358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456363">return</span>&nbsp;<span class="builtintype" id="5456370">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456380">case</span>&nbsp;<span class="op" id="5456385">*</span><span class="ident" id="5456386">ast</span><span class="op" id="5456389">.</span><span class="ident" id="5456390">TypeSpec</span><span class="op" id="5456398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456402">if</span>&nbsp;<span class="ident" id="5456405">name</span>&nbsp;<span class="op" id="5456410">:=</span>&nbsp;<span class="ident" id="5456413">s</span><span class="op" id="5456414">.</span><span class="ident" id="5456415">Name</span><span class="op" id="5456419">.</span><span class="ident" id="5456420">Name</span><span class="op" id="5456424">;</span>&nbsp;<span class="ident" id="5456426">ast</span><span class="op" id="5456429">.</span><span class="ident" id="5456430">IsExported</span><span class="op" id="5456440">(</span><span class="ident" id="5456441">name</span><span class="op" id="5456445">)</span>&nbsp;<span class="op" id="5456447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456452">r</span><span class="op" id="5456453">.</span><span class="ident" id="5456454">filterType</span><span class="op" id="5456464">(</span><span class="ident" id="5456465">r</span><span class="op" id="5456466">.</span><span class="ident" id="5456467">lookupType</span><span class="op" id="5456477">(</span><span class="ident" id="5456478">s</span><span class="op" id="5456479">.</span><span class="ident" id="5456480">Name</span><span class="op" id="5456484">.</span><span class="ident" id="5456485">Name</span><span class="op" id="5456489">)</span><span class="op" id="5456490">,</span>&nbsp;<span class="ident" id="5456492">s</span><span class="op" id="5456493">.</span><span class="ident" id="5456494">Type</span><span class="op" id="5456498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456503">return</span>&nbsp;<span class="builtintype" id="5456510">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456517">}</span>&nbsp;<span class="keyword" id="5456519">else</span>&nbsp;<span class="keyword" id="5456524">if</span>&nbsp;<span class="ident" id="5456527">name</span>&nbsp;<span class="op" id="5456532">==</span>&nbsp;<span class="string" id="5456535">&#34;error&#34;</span>&nbsp;<span class="op" id="5456543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456548">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456608">r</span><span class="op" id="5456609">.</span><span class="ident" id="5456610">errorDecl</span>&nbsp;<span class="op" id="5456620">=</span>&nbsp;<span class="builtintype" id="5456622">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456632">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456635">return</span>&nbsp;<span class="builtintype" id="5456642">false</span><br>
<span class="lineno"></span><span class="op" id="5456648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456651">func</span>&nbsp;<span class="op" id="5456656">(</span><span class="ident" id="5456657">r</span>&nbsp;<span class="op" id="5456659">*</span><span class="ident" id="5456660">reader</span><span class="op" id="5456666">)</span>&nbsp;<span class="ident" id="5456668">filterSpecList</span><span class="op" id="5456682">(</span><span class="ident" id="5456683">list</span>&nbsp;<span class="op" id="5456688">[</span><span class="op" id="5456689">]</span><span class="ident" id="5456690">ast</span><span class="op" id="5456693">.</span><span class="ident" id="5456694">Spec</span><span class="op" id="5456698">,</span>&nbsp;<span class="ident" id="5456700">tok</span>&nbsp;<span class="ident" id="5456704">token</span><span class="op" id="5456709">.</span><span class="ident" id="5456710">Token</span><span class="op" id="5456715">)</span>&nbsp;<span class="op" id="5456717">[</span><span class="op" id="5456718">]</span><span class="ident" id="5456719">ast</span><span class="op" id="5456722">.</span><span class="ident" id="5456723">Spec</span>&nbsp;<span class="op" id="5456728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456731">j</span>&nbsp;<span class="op" id="5456733">:=</span>&nbsp;<span class="num" id="5456736">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456739">for</span>&nbsp;<span class="ident" id="5456743">_</span><span class="op" id="5456744">,</span>&nbsp;<span class="ident" id="5456746">s</span>&nbsp;<span class="op" id="5456748">:=</span>&nbsp;<span class="keyword" id="5456751">range</span>&nbsp;<span class="ident" id="5456757">list</span>&nbsp;<span class="op" id="5456762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456766">if</span>&nbsp;<span class="ident" id="5456769">r</span><span class="op" id="5456770">.</span><span class="ident" id="5456771">filterSpec</span><span class="op" id="5456781">(</span><span class="ident" id="5456782">s</span><span class="op" id="5456783">,</span>&nbsp;<span class="ident" id="5456785">tok</span><span class="op" id="5456788">)</span>&nbsp;<span class="op" id="5456790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456795">list</span><span class="op" id="5456799">[</span><span class="ident" id="5456800">j</span><span class="op" id="5456801">]</span>&nbsp;<span class="op" id="5456803">=</span>&nbsp;<span class="ident" id="5456805">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456810">j</span><span class="op" id="5456811">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456816">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456822">return</span>&nbsp;<span class="ident" id="5456829">list</span><span class="op" id="5456833">[</span><span class="num" id="5456834">0</span><span class="op" id="5456835">:</span><span class="ident" id="5456836">j</span><span class="op" id="5456837">]</span><br>
<span class="lineno"></span><span class="op" id="5456839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456842">func</span>&nbsp;<span class="op" id="5456847">(</span><span class="ident" id="5456848">r</span>&nbsp;<span class="op" id="5456850">*</span><span class="ident" id="5456851">reader</span><span class="op" id="5456857">)</span>&nbsp;<span class="ident" id="5456859">filterDecl</span><span class="op" id="5456869">(</span><span class="ident" id="5456870">decl</span>&nbsp;<span class="ident" id="5456875">ast</span><span class="op" id="5456878">.</span><span class="ident" id="5456879">Decl</span><span class="op" id="5456883">)</span>&nbsp;<span class="builtintype" id="5456885">bool</span>&nbsp;<span class="op" id="5456890">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456893">switch</span>&nbsp;<span class="ident" id="5456900">d</span>&nbsp;<span class="op" id="5456902">:=</span>&nbsp;<span class="ident" id="5456905">decl</span><span class="op" id="5456909">.</span><span class="op" id="5456910">(</span><span class="keyword" id="5456911">type</span><span class="op" id="5456915">)</span>&nbsp;<span class="op" id="5456917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456920">case</span>&nbsp;<span class="op" id="5456925">*</span><span class="ident" id="5456926">ast</span><span class="op" id="5456929">.</span><span class="ident" id="5456930">GenDecl</span><span class="op" id="5456937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456941">d</span><span class="op" id="5456942">.</span><span class="ident" id="5456943">Specs</span>&nbsp;<span class="op" id="5456949">=</span>&nbsp;<span class="ident" id="5456951">r</span><span class="op" id="5456952">.</span><span class="ident" id="5456953">filterSpecList</span><span class="op" id="5456967">(</span><span class="ident" id="5456968">d</span><span class="op" id="5456969">.</span><span class="ident" id="5456970">Specs</span><span class="op" id="5456975">,</span>&nbsp;<span class="ident" id="5456977">d</span><span class="op" id="5456978">.</span><span class="ident" id="5456979">Tok</span><span class="op" id="5456982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456986">return</span>&nbsp;<span class="builtinfunc" id="5456993">len</span><span class="op" id="5456996">(</span><span class="ident" id="5456997">d</span><span class="op" id="5456998">.</span><span class="ident" id="5456999">Specs</span><span class="op" id="5457004">)</span>&nbsp;<span class="op" id="5457006">&gt;</span>&nbsp;<span class="num" id="5457008">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457011">case</span>&nbsp;<span class="op" id="5457016">*</span><span class="ident" id="5457017">ast</span><span class="op" id="5457020">.</span><span class="ident" id="5457021">FuncDecl</span><span class="op" id="5457029">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457033">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457083">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457136">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457190">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457238">return</span>&nbsp;<span class="ident" id="5457245">ast</span><span class="op" id="5457248">.</span><span class="ident" id="5457249">IsExported</span><span class="op" id="5457259">(</span><span class="ident" id="5457260">d</span><span class="op" id="5457261">.</span><span class="ident" id="5457262">Name</span><span class="op" id="5457266">.</span><span class="ident" id="5457267">Name</span><span class="op" id="5457271">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457277">return</span>&nbsp;<span class="builtintype" id="5457284">false</span><br>
<span class="lineno"></span><span class="op" id="5457290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5457293">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="5457359">//</span><br>
<span class="lineno"></span><span class="keyword" id="5457362">func</span>&nbsp;<span class="op" id="5457367">(</span><span class="ident" id="5457368">r</span>&nbsp;<span class="op" id="5457370">*</span><span class="ident" id="5457371">reader</span><span class="op" id="5457377">)</span>&nbsp;<span class="ident" id="5457379">fileExports</span><span class="op" id="5457390">(</span><span class="ident" id="5457391">src</span>&nbsp;<span class="op" id="5457395">*</span><span class="ident" id="5457396">ast</span><span class="op" id="5457399">.</span><span class="ident" id="5457400">File</span><span class="op" id="5457404">)</span>&nbsp;<span class="op" id="5457406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457409">j</span>&nbsp;<span class="op" id="5457411">:=</span>&nbsp;<span class="num" id="5457414">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457417">for</span>&nbsp;<span class="ident" id="5457421">_</span><span class="op" id="5457422">,</span>&nbsp;<span class="ident" id="5457424">d</span>&nbsp;<span class="op" id="5457426">:=</span>&nbsp;<span class="keyword" id="5457429">range</span>&nbsp;<span class="ident" id="5457435">src</span><span class="op" id="5457438">.</span><span class="ident" id="5457439">Decls</span>&nbsp;<span class="op" id="5457445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457449">if</span>&nbsp;<span class="ident" id="5457452">r</span><span class="op" id="5457453">.</span><span class="ident" id="5457454">filterDecl</span><span class="op" id="5457464">(</span><span class="ident" id="5457465">d</span><span class="op" id="5457466">)</span>&nbsp;<span class="op" id="5457468">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457473">src</span><span class="op" id="5457476">.</span><span class="ident" id="5457477">Decls</span><span class="op" id="5457482">[</span><span class="ident" id="5457483">j</span><span class="op" id="5457484">]</span>&nbsp;<span class="op" id="5457486">=</span>&nbsp;<span class="ident" id="5457488">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457493">j</span><span class="op" id="5457494">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457505">src</span><span class="op" id="5457508">.</span><span class="ident" id="5457509">Decls</span>&nbsp;<span class="op" id="5457515">=</span>&nbsp;<span class="ident" id="5457517">src</span><span class="op" id="5457520">.</span><span class="ident" id="5457521">Decls</span><span class="op" id="5457526">[</span><span class="num" id="5457527">0</span><span class="op" id="5457528">:</span><span class="ident" id="5457529">j</span><span class="op" id="5457530">]</span><br>
<span class="lineno">205</span><span class="op" id="5457532">}</span>
</div>
</body>
</html>
