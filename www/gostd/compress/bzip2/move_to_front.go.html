<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4923523">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4923578">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4923632">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4923683">package</span>&nbsp;<span class="ident" id="4923691">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4923698">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4923771">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4923848">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="4923927">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="4924006">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="4924084">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="4924163">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="4924237">type</span>&nbsp;<span class="ident" id="4924242">moveToFrontDecoder</span>&nbsp;<span class="op" id="4924261">[</span><span class="op" id="4924262">]</span><span class="builtintype" id="4924263">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4924269">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4924348">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="4924363">func</span>&nbsp;<span class="ident" id="4924368">newMTFDecoder</span><span class="op" id="4924381">(</span><span class="ident" id="4924382">symbols</span>&nbsp;<span class="op" id="4924390">[</span><span class="op" id="4924391">]</span><span class="builtintype" id="4924392">byte</span><span class="op" id="4924396">)</span>&nbsp;<span class="ident" id="4924398">moveToFrontDecoder</span>&nbsp;<span class="op" id="4924417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924420">if</span>&nbsp;<span class="builtinfunc" id="4924423">len</span><span class="op" id="4924426">(</span><span class="ident" id="4924427">symbols</span><span class="op" id="4924434">)</span>&nbsp;<span class="op" id="4924436">&gt;</span>&nbsp;<span class="num" id="4924438">256</span>&nbsp;<span class="op" id="4924442">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4924446">panic</span><span class="op" id="4924451">(</span><span class="string" id="4924452">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="4924470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924476">return</span>&nbsp;<span class="ident" id="4924483">moveToFrontDecoder</span><span class="op" id="4924501">(</span><span class="ident" id="4924502">symbols</span><span class="op" id="4924509">)</span><br>
<span class="lineno"></span><span class="op" id="4924511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4924514">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="4924588">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="4924615">func</span>&nbsp;<span class="ident" id="4924620">newMTFDecoderWithRange</span><span class="op" id="4924642">(</span><span class="ident" id="4924643">n</span>&nbsp;<span class="builtintype" id="4924645">int</span><span class="op" id="4924648">)</span>&nbsp;<span class="ident" id="4924650">moveToFrontDecoder</span>&nbsp;<span class="op" id="4924669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924672">if</span>&nbsp;<span class="ident" id="4924675">n</span>&nbsp;<span class="op" id="4924677">&gt;</span>&nbsp;<span class="num" id="4924679">256</span>&nbsp;<span class="op" id="4924683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4924687">panic</span><span class="op" id="4924692">(</span><span class="string" id="4924693">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="4924744">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924751">m</span>&nbsp;<span class="op" id="4924753">:=</span>&nbsp;<span class="builtinfunc" id="4924756">make</span><span class="op" id="4924760">(</span><span class="op" id="4924761">[</span><span class="op" id="4924762">]</span><span class="builtintype" id="4924763">byte</span><span class="op" id="4924767">,</span>&nbsp;<span class="ident" id="4924769">n</span><span class="op" id="4924770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924773">for</span>&nbsp;<span class="ident" id="4924777">i</span>&nbsp;<span class="op" id="4924779">:=</span>&nbsp;<span class="num" id="4924782">0</span><span class="op" id="4924783">;</span>&nbsp;<span class="ident" id="4924785">i</span>&nbsp;<span class="op" id="4924787">&lt;</span>&nbsp;<span class="ident" id="4924789">n</span><span class="op" id="4924790">;</span>&nbsp;<span class="ident" id="4924792">i</span><span class="op" id="4924793">++</span>&nbsp;<span class="op" id="4924796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924800">m</span><span class="op" id="4924801">[</span><span class="ident" id="4924802">i</span><span class="op" id="4924803">]</span>&nbsp;<span class="op" id="4924805">=</span>&nbsp;<span class="builtintype" id="4924807">byte</span><span class="op" id="4924811">(</span><span class="ident" id="4924812">i</span><span class="op" id="4924813">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924819">return</span>&nbsp;<span class="ident" id="4924826">moveToFrontDecoder</span><span class="op" id="4924844">(</span><span class="ident" id="4924845">m</span><span class="op" id="4924846">)</span><br>
<span class="lineno"></span><span class="op" id="4924848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4924851">func</span>&nbsp;<span class="op" id="4924856">(</span><span class="ident" id="4924857">m</span>&nbsp;<span class="ident" id="4924859">moveToFrontDecoder</span><span class="op" id="4924877">)</span>&nbsp;<span class="ident" id="4924879">Decode</span><span class="op" id="4924885">(</span><span class="ident" id="4924886">n</span>&nbsp;<span class="builtintype" id="4924888">int</span><span class="op" id="4924891">)</span>&nbsp;<span class="op" id="4924893">(</span><span class="ident" id="4924894">b</span>&nbsp;<span class="builtintype" id="4924896">byte</span><span class="op" id="4924900">)</span>&nbsp;<span class="op" id="4924902">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924905">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924967">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4925033">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4925091">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925158">b</span>&nbsp;<span class="op" id="4925160">=</span>&nbsp;<span class="ident" id="4925162">m</span><span class="op" id="4925163">[</span><span class="ident" id="4925164">n</span><span class="op" id="4925165">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4925168">copy</span><span class="op" id="4925172">(</span><span class="ident" id="4925173">m</span><span class="op" id="4925174">[</span><span class="num" id="4925175">1</span><span class="op" id="4925176">:</span><span class="op" id="4925177">]</span><span class="op" id="4925178">,</span>&nbsp;<span class="ident" id="4925180">m</span><span class="op" id="4925181">[</span><span class="op" id="4925182">:</span><span class="ident" id="4925183">n</span><span class="op" id="4925184">]</span><span class="op" id="4925185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925188">m</span><span class="op" id="4925189">[</span><span class="num" id="4925190">0</span><span class="op" id="4925191">]</span>&nbsp;<span class="op" id="4925193">=</span>&nbsp;<span class="ident" id="4925195">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925198">return</span><br>
<span class="lineno"></span><span class="op" id="4925205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4925208">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="4925262">func</span>&nbsp;<span class="op" id="4925267">(</span><span class="ident" id="4925268">m</span>&nbsp;<span class="ident" id="4925270">moveToFrontDecoder</span><span class="op" id="4925288">)</span>&nbsp;<span class="ident" id="4925290">First</span><span class="op" id="4925295">(</span><span class="op" id="4925296">)</span>&nbsp;<span class="builtintype" id="4925298">byte</span>&nbsp;<span class="op" id="4925303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925306">return</span>&nbsp;<span class="ident" id="4925313">m</span><span class="op" id="4925314">[</span><span class="num" id="4925315">0</span><span class="op" id="4925316">]</span><br>
<span class="lineno"></span><span class="op" id="4925318">}</span>
</div>
</body>
</html>
