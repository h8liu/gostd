<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4811827">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4811882">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4811936">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4811987">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="4812044">package</span>&nbsp;<span class="ident" id="4812052">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4812062">import</span>&nbsp;<span class="op" id="4812069">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4812072">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4812081">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="4812092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812095">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4812164">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="4812220">type</span>&nbsp;<span class="ident" id="4812225">ResponseRecorder</span>&nbsp;<span class="keyword" id="4812242">struct</span>&nbsp;<span class="op" id="4812249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812252">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4812262">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812276">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812320">HeaderMap</span>&nbsp;<span class="ident" id="4812330"><a href="/net/http/httptest/recorder.go.html#4812081">http</a></span><span class="op" id="4812334">.</span><span class="ident" id="4812335">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4812344">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812374">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812384">*</span><span class="ident" id="4812385"><a href="/net/http/httptest/recorder.go.html#4812072">bytes</a></span><span class="op" id="4812390">.</span><span class="ident" id="4812391">Buffer</span>&nbsp;<span class="comment" id="4812398">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812457">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4812467">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812474">wroteHeader</span>&nbsp;<span class="builtintype" id="4812486">bool</span><br>
<span class="lineno"></span><span class="op" id="4812491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812494">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="4812550">func</span>&nbsp;<span class="ident" id="4812555">NewRecorder</span><span class="op" id="4812566">(</span><span class="op" id="4812567">)</span>&nbsp;<span class="op" id="4812569">*</span><span class="ident" id="4812570"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span>&nbsp;<span class="op" id="4812587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812590">return</span>&nbsp;<span class="op" id="4812597">&amp;</span><span class="ident" id="4812598"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span><span class="op" id="4812614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812618">HeaderMap</span><span class="op" id="4812627">:</span>&nbsp;<span class="builtinfunc" id="4812629">make</span><span class="op" id="4812633">(</span><span class="ident" id="4812634"><a href="/net/http/httptest/recorder.go.html#4812081">http</a></span><span class="op" id="4812638">.</span><span class="ident" id="4812639">Header</span><span class="op" id="4812645">)</span><span class="op" id="4812646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812650">Body</span><span class="op" id="4812654">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4812661">new</span><span class="op" id="4812664">(</span><span class="ident" id="4812665"><a href="/net/http/httptest/recorder.go.html#4812072">bytes</a></span><span class="op" id="4812670">.</span><span class="ident" id="4812671">Buffer</span><span class="op" id="4812677">)</span><span class="op" id="4812678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812682">Code</span><span class="op" id="4812686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4812693">200</span><span class="op" id="4812696">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812699">}</span><br>
<span class="lineno"></span><span class="op" id="4812701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812704">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4812782">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="4812846">const</span>&nbsp;<span class="ident" id="4812852">DefaultRemoteAddr</span>&nbsp;<span class="op" id="4812870">=</span>&nbsp;<span class="string" id="4812872">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812883">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="4812923">func</span>&nbsp;<span class="op" id="4812928">(</span><span class="ident" id="4812929">rw</span>&nbsp;<span class="op" id="4812932">*</span><span class="ident" id="4812933"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span><span class="op" id="4812949">)</span>&nbsp;<span class="ident" id="4812951">Header</span><span class="op" id="4812957">(</span><span class="op" id="4812958">)</span>&nbsp;<span class="ident" id="4812960"><a href="/net/http/httptest/recorder.go.html#4812081">http</a></span><span class="op" id="4812964">.</span><span class="ident" id="4812965">Header</span>&nbsp;<span class="op" id="4812972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812975">m</span>&nbsp;<span class="op" id="4812977">:=</span>&nbsp;<span class="ident" id="4812980"><a href="/net/http/httptest/recorder.go.html#4812929">rw</a></span><span class="op" id="4812982">.</span><span class="ident" id="4812983">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812994">if</span>&nbsp;<span class="ident" id="4812997"><a href="/net/http/httptest/recorder.go.html#4812975">m</a></span>&nbsp;<span class="op" id="4812999">==</span>&nbsp;<span class="ident" id="4813002">nil</span>&nbsp;<span class="op" id="4813006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813010"><a href="/net/http/httptest/recorder.go.html#4812975">m</a></span>&nbsp;<span class="op" id="4813012">=</span>&nbsp;<span class="builtinfunc" id="4813014">make</span><span class="op" id="4813018">(</span><span class="ident" id="4813019"><a href="/net/http/httptest/recorder.go.html#4812081">http</a></span><span class="op" id="4813023">.</span><span class="ident" id="4813024">Header</span><span class="op" id="4813030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813034"><a href="/net/http/httptest/recorder.go.html#4812929">rw</a></span><span class="op" id="4813036">.</span><span class="ident" id="4813037">HeaderMap</span>&nbsp;<span class="op" id="4813047">=</span>&nbsp;<span class="ident" id="4813049"><a href="/net/http/httptest/recorder.go.html#4812975">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813055">return</span>&nbsp;<span class="ident" id="4813062"><a href="/net/http/httptest/recorder.go.html#4812975">m</a></span><br>
<span class="lineno">45</span><span class="op" id="4813064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4813067">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4813127">func</span>&nbsp;<span class="op" id="4813132">(</span><span class="ident" id="4813133">rw</span>&nbsp;<span class="op" id="4813136">*</span><span class="ident" id="4813137"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span><span class="op" id="4813153">)</span>&nbsp;<span class="ident" id="4813155">Write</span><span class="op" id="4813160">(</span><span class="ident" id="4813161">buf</span>&nbsp;<span class="op" id="4813165">[</span><span class="op" id="4813166">]</span><span class="builtintype" id="4813167">byte</span><span class="op" id="4813171">)</span>&nbsp;<span class="op" id="4813173">(</span><span class="builtintype" id="4813174">int</span><span class="op" id="4813177">,</span>&nbsp;<span class="builtintype" id="4813179">error</span><span class="op" id="4813184">)</span>&nbsp;<span class="op" id="4813186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813189">if</span>&nbsp;<span class="op" id="4813192">!</span><span class="ident" id="4813193"><a href="/net/http/httptest/recorder.go.html#4813133">rw</a></span><span class="op" id="4813195">.</span><span class="ident" id="4813196">wroteHeader</span>&nbsp;<span class="op" id="4813208">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813212"><a href="/net/http/httptest/recorder.go.html#4813133">rw</a></span><span class="op" id="4813214">.</span><span class="ident" id="4813215">WriteHeader</span><span class="op" id="4813226">(</span><span class="num" id="4813227">200</span><span class="op" id="4813230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813236">if</span>&nbsp;<span class="ident" id="4813239"><a href="/net/http/httptest/recorder.go.html#4813133">rw</a></span><span class="op" id="4813241">.</span><span class="ident" id="4813242">Body</span>&nbsp;<span class="op" id="4813247">!=</span>&nbsp;<span class="ident" id="4813250">nil</span>&nbsp;<span class="op" id="4813254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813258"><a href="/net/http/httptest/recorder.go.html#4813133">rw</a></span><span class="op" id="4813260">.</span><span class="ident" id="4813261">Body</span><span class="op" id="4813265">.</span><span class="ident" id="4813266">Write</span><span class="op" id="4813271">(</span><span class="ident" id="4813272"><a href="/net/http/httptest/recorder.go.html#4813161">buf</a></span><span class="op" id="4813275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813278">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813281">return</span>&nbsp;<span class="builtinfunc" id="4813288">len</span><span class="op" id="4813291">(</span><span class="ident" id="4813292"><a href="/net/http/httptest/recorder.go.html#4813161">buf</a></span><span class="op" id="4813295">)</span><span class="op" id="4813296">,</span>&nbsp;<span class="ident" id="4813298">nil</span><br>
<span class="lineno"></span><span class="op" id="4813302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4813305">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="4813334">func</span>&nbsp;<span class="op" id="4813339">(</span><span class="ident" id="4813340">rw</span>&nbsp;<span class="op" id="4813343">*</span><span class="ident" id="4813344"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span><span class="op" id="4813360">)</span>&nbsp;<span class="ident" id="4813362">WriteHeader</span><span class="op" id="4813373">(</span><span class="ident" id="4813374">code</span>&nbsp;<span class="builtintype" id="4813379">int</span><span class="op" id="4813382">)</span>&nbsp;<span class="op" id="4813384">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813387">if</span>&nbsp;<span class="op" id="4813390">!</span><span class="ident" id="4813391"><a href="/net/http/httptest/recorder.go.html#4813340">rw</a></span><span class="op" id="4813393">.</span><span class="ident" id="4813394">wroteHeader</span>&nbsp;<span class="op" id="4813406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813410"><a href="/net/http/httptest/recorder.go.html#4813340">rw</a></span><span class="op" id="4813412">.</span><span class="ident" id="4813413">Code</span>&nbsp;<span class="op" id="4813418">=</span>&nbsp;<span class="ident" id="4813420"><a href="/net/http/httptest/recorder.go.html#4813374">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813429"><a href="/net/http/httptest/recorder.go.html#4813340">rw</a></span><span class="op" id="4813431">.</span><span class="ident" id="4813432">wroteHeader</span>&nbsp;<span class="op" id="4813444">=</span>&nbsp;<span class="ident" id="4813446">true</span><br>
<span class="lineno"></span><span class="op" id="4813451">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4813454">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4813488">func</span>&nbsp;<span class="op" id="4813493">(</span><span class="ident" id="4813494">rw</span>&nbsp;<span class="op" id="4813497">*</span><span class="ident" id="4813498"><a href="/net/http/httptest/recorder.go.html#4812225">ResponseRecorder</a></span><span class="op" id="4813514">)</span>&nbsp;<span class="ident" id="4813516">Flush</span><span class="op" id="4813521">(</span><span class="op" id="4813522">)</span>&nbsp;<span class="op" id="4813524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813527">if</span>&nbsp;<span class="op" id="4813530">!</span><span class="ident" id="4813531"><a href="/net/http/httptest/recorder.go.html#4813494">rw</a></span><span class="op" id="4813533">.</span><span class="ident" id="4813534">wroteHeader</span>&nbsp;<span class="op" id="4813546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813550"><a href="/net/http/httptest/recorder.go.html#4813494">rw</a></span><span class="op" id="4813552">.</span><span class="ident" id="4813553">WriteHeader</span><span class="op" id="4813564">(</span><span class="num" id="4813565">200</span><span class="op" id="4813568">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813574"><a href="/net/http/httptest/recorder.go.html#4813494">rw</a></span><span class="op" id="4813576">.</span><span class="ident" id="4813577">Flushed</span>&nbsp;<span class="op" id="4813585">=</span>&nbsp;<span class="ident" id="4813587">true</span><br>
<span class="lineno"></span><span class="op" id="4813592">}</span>
</div>
</body>
</html>
