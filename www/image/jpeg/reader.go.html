<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3135425">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3135480">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3135534">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3135585">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="3135646">//</span><br>
<span class="lineno"></span><span class="comment" id="3135649">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="3135728">package</span>&nbsp;<span class="ident" id="3135736">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3135742">import</span>&nbsp;<span class="op" id="3135749">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135752">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135761">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135776">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3135781">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3135784">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3135861">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3135918">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="3135979">type</span>&nbsp;<span class="ident" id="3135984">FormatError</span>&nbsp;<span class="builtintype" id="3135996">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136004">func</span>&nbsp;<span class="op" id="3136009">(</span><span class="ident" id="3136010">e</span>&nbsp;<span class="ident" id="3136012"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3136023">)</span>&nbsp;<span class="ident" id="3136025">Error</span><span class="op" id="3136030">(</span><span class="op" id="3136031">)</span>&nbsp;<span class="builtintype" id="3136033">string</span>&nbsp;<span class="op" id="3136040">{</span>&nbsp;<span class="keyword" id="3136042">return</span>&nbsp;<span class="string" id="3136049">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="3136073">+</span>&nbsp;<span class="builtintype" id="3136075">string</span><span class="op" id="3136081">(</span><span class="ident" id="3136082"><a href="/image/jpeg/reader.go.html#3136010">e</a></span><span class="op" id="3136083">)</span>&nbsp;<span class="op" id="3136085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3136088">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="3136179">type</span>&nbsp;<span class="ident" id="3136184">UnsupportedError</span>&nbsp;<span class="builtintype" id="3136201">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136209">func</span>&nbsp;<span class="op" id="3136214">(</span><span class="ident" id="3136215">e</span>&nbsp;<span class="ident" id="3136217"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3136233">)</span>&nbsp;<span class="ident" id="3136235">Error</span><span class="op" id="3136240">(</span><span class="op" id="3136241">)</span>&nbsp;<span class="builtintype" id="3136243">string</span>&nbsp;<span class="op" id="3136250">{</span>&nbsp;<span class="keyword" id="3136252">return</span>&nbsp;<span class="string" id="3136259">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="3136288">+</span>&nbsp;<span class="builtintype" id="3136290">string</span><span class="op" id="3136296">(</span><span class="ident" id="3136297"><a href="/image/jpeg/reader.go.html#3136215">e</a></span><span class="op" id="3136298">)</span>&nbsp;<span class="op" id="3136300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3136303">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="3136359">type</span>&nbsp;<span class="ident" id="3136364">component</span>&nbsp;<span class="keyword" id="3136374">struct</span>&nbsp;<span class="op" id="3136381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136384">h</span>&nbsp;&nbsp;<span class="builtintype" id="3136387">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3136393">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136425">v</span>&nbsp;&nbsp;<span class="builtintype" id="3136428">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3136434">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136464">c</span>&nbsp;&nbsp;<span class="builtintype" id="3136467">uint8</span>&nbsp;<span class="comment" id="3136473">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136499">tq</span>&nbsp;<span class="builtintype" id="3136502">uint8</span>&nbsp;<span class="comment" id="3136508">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="3136552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136555">const</span>&nbsp;<span class="op" id="3136561">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136564">dcTable</span>&nbsp;<span class="op" id="3136572">=</span>&nbsp;<span class="num" id="3136574">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136577">acTable</span>&nbsp;<span class="op" id="3136585">=</span>&nbsp;<span class="num" id="3136587">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136590">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3136598">=</span>&nbsp;<span class="num" id="3136600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136603">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3136611">=</span>&nbsp;<span class="num" id="3136613">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136616">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3136624">=</span>&nbsp;<span class="num" id="3136626">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136630">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136681">nGrayComponent</span>&nbsp;<span class="op" id="3136696">=</span>&nbsp;<span class="num" id="3136698">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136701">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136753">nColorComponent</span>&nbsp;<span class="op" id="3136769">=</span>&nbsp;<span class="num" id="3136771">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136775">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136857">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136933">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136970">maxH</span>&nbsp;<span class="op" id="3136975">=</span>&nbsp;<span class="num" id="3136977">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136980">maxV</span>&nbsp;<span class="op" id="3136985">=</span>&nbsp;<span class="num" id="3136987">2</span><br>
<span class="lineno"></span><span class="op" id="3136989">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3136992">const</span>&nbsp;<span class="op" id="3136998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137001">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137013">=</span>&nbsp;<span class="num" id="3137015">0xd8</span>&nbsp;<span class="comment" id="3137020">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137040">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137052">=</span>&nbsp;<span class="num" id="3137054">0xd9</span>&nbsp;<span class="comment" id="3137059">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137077">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="3137089">=</span>&nbsp;<span class="num" id="3137091">0xc0</span>&nbsp;<span class="comment" id="3137096">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137127">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="3137139">=</span>&nbsp;<span class="num" id="3137141">0xc2</span>&nbsp;<span class="comment" id="3137146">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137180">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137192">=</span>&nbsp;<span class="num" id="3137194">0xc4</span>&nbsp;<span class="comment" id="3137199">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137225">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137237">=</span>&nbsp;<span class="num" id="3137239">0xdb</span>&nbsp;<span class="comment" id="3137244">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137275">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137287">=</span>&nbsp;<span class="num" id="3137289">0xda</span>&nbsp;<span class="comment" id="3137294">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137313">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137325">=</span>&nbsp;<span class="num" id="3137327">0xdd</span>&nbsp;<span class="comment" id="3137332">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137361">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="3137373">=</span>&nbsp;<span class="num" id="3137375">0xd0</span>&nbsp;<span class="comment" id="3137380">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137397">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="3137409">=</span>&nbsp;<span class="num" id="3137411">0xd7</span>&nbsp;<span class="comment" id="3137416">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137433">app0Marker</span>&nbsp;&nbsp;<span class="op" id="3137445">=</span>&nbsp;<span class="num" id="3137447">0xe0</span>&nbsp;<span class="comment" id="3137452">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137482">app15Marker</span>&nbsp;<span class="op" id="3137494">=</span>&nbsp;<span class="num" id="3137496">0xef</span>&nbsp;<span class="comment" id="3137501">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137532">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3137544">=</span>&nbsp;<span class="num" id="3137546">0xfe</span>&nbsp;<span class="comment" id="3137551">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="3137563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3137566">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="3137644">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="3137722">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="3137802">var</span>&nbsp;<span class="ident" id="3137806">unzig</span>&nbsp;<span class="op" id="3137812">=</span>&nbsp;<span class="op" id="3137814">[</span><span class="ident" id="3137815"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3137824">]</span><span class="builtintype" id="3137825">int</span><span class="op" id="3137828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137831">0</span><span class="op" id="3137832">,</span>&nbsp;<span class="num" id="3137834">1</span><span class="op" id="3137835">,</span>&nbsp;<span class="num" id="3137837">8</span><span class="op" id="3137838">,</span>&nbsp;<span class="num" id="3137840">16</span><span class="op" id="3137842">,</span>&nbsp;<span class="num" id="3137844">9</span><span class="op" id="3137845">,</span>&nbsp;<span class="num" id="3137847">2</span><span class="op" id="3137848">,</span>&nbsp;<span class="num" id="3137850">3</span><span class="op" id="3137851">,</span>&nbsp;<span class="num" id="3137853">10</span><span class="op" id="3137855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137858">17</span><span class="op" id="3137860">,</span>&nbsp;<span class="num" id="3137862">24</span><span class="op" id="3137864">,</span>&nbsp;<span class="num" id="3137866">32</span><span class="op" id="3137868">,</span>&nbsp;<span class="num" id="3137870">25</span><span class="op" id="3137872">,</span>&nbsp;<span class="num" id="3137874">18</span><span class="op" id="3137876">,</span>&nbsp;<span class="num" id="3137878">11</span><span class="op" id="3137880">,</span>&nbsp;<span class="num" id="3137882">4</span><span class="op" id="3137883">,</span>&nbsp;<span class="num" id="3137885">5</span><span class="op" id="3137886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137889">12</span><span class="op" id="3137891">,</span>&nbsp;<span class="num" id="3137893">19</span><span class="op" id="3137895">,</span>&nbsp;<span class="num" id="3137897">26</span><span class="op" id="3137899">,</span>&nbsp;<span class="num" id="3137901">33</span><span class="op" id="3137903">,</span>&nbsp;<span class="num" id="3137905">40</span><span class="op" id="3137907">,</span>&nbsp;<span class="num" id="3137909">48</span><span class="op" id="3137911">,</span>&nbsp;<span class="num" id="3137913">41</span><span class="op" id="3137915">,</span>&nbsp;<span class="num" id="3137917">34</span><span class="op" id="3137919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137922">27</span><span class="op" id="3137924">,</span>&nbsp;<span class="num" id="3137926">20</span><span class="op" id="3137928">,</span>&nbsp;<span class="num" id="3137930">13</span><span class="op" id="3137932">,</span>&nbsp;<span class="num" id="3137934">6</span><span class="op" id="3137935">,</span>&nbsp;<span class="num" id="3137937">7</span><span class="op" id="3137938">,</span>&nbsp;<span class="num" id="3137940">14</span><span class="op" id="3137942">,</span>&nbsp;<span class="num" id="3137944">21</span><span class="op" id="3137946">,</span>&nbsp;<span class="num" id="3137948">28</span><span class="op" id="3137950">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137953">35</span><span class="op" id="3137955">,</span>&nbsp;<span class="num" id="3137957">42</span><span class="op" id="3137959">,</span>&nbsp;<span class="num" id="3137961">49</span><span class="op" id="3137963">,</span>&nbsp;<span class="num" id="3137965">56</span><span class="op" id="3137967">,</span>&nbsp;<span class="num" id="3137969">57</span><span class="op" id="3137971">,</span>&nbsp;<span class="num" id="3137973">50</span><span class="op" id="3137975">,</span>&nbsp;<span class="num" id="3137977">43</span><span class="op" id="3137979">,</span>&nbsp;<span class="num" id="3137981">36</span><span class="op" id="3137983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3137986">29</span><span class="op" id="3137988">,</span>&nbsp;<span class="num" id="3137990">22</span><span class="op" id="3137992">,</span>&nbsp;<span class="num" id="3137994">15</span><span class="op" id="3137996">,</span>&nbsp;<span class="num" id="3137998">23</span><span class="op" id="3138000">,</span>&nbsp;<span class="num" id="3138002">30</span><span class="op" id="3138004">,</span>&nbsp;<span class="num" id="3138006">37</span><span class="op" id="3138008">,</span>&nbsp;<span class="num" id="3138010">44</span><span class="op" id="3138012">,</span>&nbsp;<span class="num" id="3138014">51</span><span class="op" id="3138016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3138019">58</span><span class="op" id="3138021">,</span>&nbsp;<span class="num" id="3138023">59</span><span class="op" id="3138025">,</span>&nbsp;<span class="num" id="3138027">52</span><span class="op" id="3138029">,</span>&nbsp;<span class="num" id="3138031">45</span><span class="op" id="3138033">,</span>&nbsp;<span class="num" id="3138035">38</span><span class="op" id="3138037">,</span>&nbsp;<span class="num" id="3138039">31</span><span class="op" id="3138041">,</span>&nbsp;<span class="num" id="3138043">39</span><span class="op" id="3138045">,</span>&nbsp;<span class="num" id="3138047">46</span><span class="op" id="3138049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3138052">53</span><span class="op" id="3138054">,</span>&nbsp;<span class="num" id="3138056">60</span><span class="op" id="3138058">,</span>&nbsp;<span class="num" id="3138060">61</span><span class="op" id="3138062">,</span>&nbsp;<span class="num" id="3138064">54</span><span class="op" id="3138066">,</span>&nbsp;<span class="num" id="3138068">47</span><span class="op" id="3138070">,</span>&nbsp;<span class="num" id="3138072">55</span><span class="op" id="3138074">,</span>&nbsp;<span class="num" id="3138076">62</span><span class="op" id="3138078">,</span>&nbsp;<span class="num" id="3138080">63</span><span class="op" id="3138082">,</span><br>
<span class="lineno"></span><span class="op" id="3138084">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3138087">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="3138112">type</span>&nbsp;<span class="ident" id="3138117">Reader</span>&nbsp;<span class="keyword" id="3138124">interface</span>&nbsp;<span class="op" id="3138134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138137"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3138139">.</span><span class="ident" id="3138140">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138152"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3138154">.</span><span class="ident" id="3138155">Reader</span><br>
<span class="lineno">90</span><span class="op" id="3138162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3138165">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="3138243">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3138323">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="3138337">type</span>&nbsp;<span class="ident" id="3138342">bits</span>&nbsp;<span class="keyword" id="3138347">struct</span>&nbsp;<span class="op" id="3138354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138357">a</span>&nbsp;<span class="builtintype" id="3138359">uint32</span>&nbsp;<span class="comment" id="3138366">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138383">m</span>&nbsp;<span class="builtintype" id="3138385">uint32</span>&nbsp;<span class="comment" id="3138392">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138445">n</span>&nbsp;<span class="builtintype" id="3138447">int32</span>&nbsp;&nbsp;<span class="comment" id="3138454">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="3138489">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3138492">type</span>&nbsp;<span class="ident" id="3138497">decoder</span>&nbsp;<span class="keyword" id="3138505">struct</span>&nbsp;<span class="op" id="3138512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138515">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3138520"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3138522">.</span><span class="ident" id="3138523">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138531">bits</span>&nbsp;<span class="ident" id="3138536"><a href="/image/jpeg/reader.go.html#3138342">bits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138542">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138612">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138681">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138732">bytes</span>&nbsp;<span class="keyword" id="3138738">struct</span>&nbsp;<span class="op" id="3138745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138749">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138811">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138867">buf</span>&nbsp;&nbsp;<span class="op" id="3138872">[</span><span class="num" id="3138873">4096</span><span class="op" id="3138877">]</span><span class="builtintype" id="3138878">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138885">i</span><span class="op" id="3138886">,</span>&nbsp;<span class="ident" id="3138888">j</span>&nbsp;<span class="builtintype" id="3138890">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138896">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138955">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138995">nUnreadable</span>&nbsp;<span class="builtintype" id="3139007">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139015">width</span><span class="op" id="3139020">,</span>&nbsp;<span class="ident" id="3139022">height</span>&nbsp;<span class="builtintype" id="3139029">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139034">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139048">*</span><span class="ident" id="3139049"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3139054">.</span><span class="ident" id="3139055">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139061">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139075">*</span><span class="ident" id="3139076"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3139081">.</span><span class="ident" id="3139082">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139089">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3139103">int</span>&nbsp;<span class="comment" id="3139107">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139129">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3139143">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139148">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3139162">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139168">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3139182">uint16</span>&nbsp;<span class="comment" id="3139189">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139240">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139254">[</span><span class="ident" id="3139255"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3139270">]</span><span class="ident" id="3139271"><a href="/image/jpeg/reader.go.html#3136364">component</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139282">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139296">[</span><span class="ident" id="3139297"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3139312">]</span><span class="op" id="3139313">[</span><span class="op" id="3139314">]</span><span class="ident" id="3139315"><a href="/image/jpeg/idct.go.html#3131942">block</a></span>&nbsp;<span class="comment" id="3139321">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139369">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139383">[</span><span class="ident" id="3139384"><a href="/image/jpeg/reader.go.html#3136590">maxTc</a></span>&nbsp;<span class="op" id="3139390">+</span>&nbsp;<span class="num" id="3139392">1</span><span class="op" id="3139393">]</span><span class="op" id="3139394">[</span><span class="ident" id="3139395"><a href="/image/jpeg/reader.go.html#3136603">maxTh</a></span>&nbsp;<span class="op" id="3139401">+</span>&nbsp;<span class="num" id="3139403">1</span><span class="op" id="3139404">]</span><span class="ident" id="3139405"><a href="/image/jpeg/huffman.go.html#3124508">huffman</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139414">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139428">[</span><span class="ident" id="3139429"><a href="/image/jpeg/reader.go.html#3136616">maxTq</a></span>&nbsp;<span class="op" id="3139435">+</span>&nbsp;<span class="num" id="3139437">1</span><span class="op" id="3139438">]</span><span class="ident" id="3139439"><a href="/image/jpeg/idct.go.html#3131942">block</a></span>&nbsp;<span class="comment" id="3139445">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139488">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3139502">[</span><span class="ident" id="3139503"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span>&nbsp;<span class="op" id="3139513">+</span>&nbsp;<span class="num" id="3139515">1</span><span class="op" id="3139516">]</span><span class="builtintype" id="3139517">byte</span><br>
<span class="lineno"></span><span class="op" id="3139522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3139525">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3139599">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3139667">func</span>&nbsp;<span class="op" id="3139672">(</span><span class="ident" id="3139673">d</span>&nbsp;<span class="op" id="3139675">*</span><span class="ident" id="3139676"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3139683">)</span>&nbsp;<span class="ident" id="3139685">fill</span><span class="op" id="3139689">(</span><span class="op" id="3139690">)</span>&nbsp;<span class="builtintype" id="3139692">error</span>&nbsp;<span class="op" id="3139698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139701">if</span>&nbsp;<span class="ident" id="3139704"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139705">.</span><span class="ident" id="3139706">bytes</span><span class="op" id="3139711">.</span><span class="ident" id="3139712">i</span>&nbsp;<span class="op" id="3139714">!=</span>&nbsp;<span class="ident" id="3139717"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139718">.</span><span class="ident" id="3139719">bytes</span><span class="op" id="3139724">.</span><span class="ident" id="3139725">j</span>&nbsp;<span class="op" id="3139727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3139731">panic</span><span class="op" id="3139736">(</span><span class="string" id="3139737">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="3139780">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139786">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139856">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139891">if</span>&nbsp;<span class="ident" id="3139894"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139895">.</span><span class="ident" id="3139896">bytes</span><span class="op" id="3139901">.</span><span class="ident" id="3139902">j</span>&nbsp;<span class="op" id="3139904">&gt;</span>&nbsp;<span class="num" id="3139906">2</span>&nbsp;<span class="op" id="3139908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139912"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139913">.</span><span class="ident" id="3139914">bytes</span><span class="op" id="3139919">.</span><span class="ident" id="3139920">buf</span><span class="op" id="3139923">[</span><span class="num" id="3139924">0</span><span class="op" id="3139925">]</span>&nbsp;<span class="op" id="3139927">=</span>&nbsp;<span class="ident" id="3139929"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139930">.</span><span class="ident" id="3139931">bytes</span><span class="op" id="3139936">.</span><span class="ident" id="3139937">buf</span><span class="op" id="3139940">[</span><span class="ident" id="3139941"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139942">.</span><span class="ident" id="3139943">bytes</span><span class="op" id="3139948">.</span><span class="ident" id="3139949">j</span><span class="op" id="3139950">-</span><span class="num" id="3139951">2</span><span class="op" id="3139952">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139956"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139957">.</span><span class="ident" id="3139958">bytes</span><span class="op" id="3139963">.</span><span class="ident" id="3139964">buf</span><span class="op" id="3139967">[</span><span class="num" id="3139968">1</span><span class="op" id="3139969">]</span>&nbsp;<span class="op" id="3139971">=</span>&nbsp;<span class="ident" id="3139973"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139974">.</span><span class="ident" id="3139975">bytes</span><span class="op" id="3139980">.</span><span class="ident" id="3139981">buf</span><span class="op" id="3139984">[</span><span class="ident" id="3139985"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3139986">.</span><span class="ident" id="3139987">bytes</span><span class="op" id="3139992">.</span><span class="ident" id="3139993">j</span><span class="op" id="3139994">-</span><span class="num" id="3139995">1</span><span class="op" id="3139996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140000"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140001">.</span><span class="ident" id="3140002">bytes</span><span class="op" id="3140007">.</span><span class="ident" id="3140008">i</span><span class="op" id="3140009">,</span>&nbsp;<span class="ident" id="3140011"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140012">.</span><span class="ident" id="3140013">bytes</span><span class="op" id="3140018">.</span><span class="ident" id="3140019">j</span>&nbsp;<span class="op" id="3140021">=</span>&nbsp;<span class="num" id="3140023">2</span><span class="op" id="3140024">,</span>&nbsp;<span class="num" id="3140026">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140032">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140068">n</span><span class="op" id="3140069">,</span>&nbsp;<span class="ident" id="3140071">err</span>&nbsp;<span class="op" id="3140075">:=</span>&nbsp;<span class="ident" id="3140078"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140079">.</span><span class="ident" id="3140080">r</span><span class="op" id="3140081">.</span><span class="ident" id="3140082">Read</span><span class="op" id="3140086">(</span><span class="ident" id="3140087"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140088">.</span><span class="ident" id="3140089">bytes</span><span class="op" id="3140094">.</span><span class="ident" id="3140095">buf</span><span class="op" id="3140098">[</span><span class="ident" id="3140099"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140100">.</span><span class="ident" id="3140101">bytes</span><span class="op" id="3140106">.</span><span class="ident" id="3140107">j</span><span class="op" id="3140108">:</span><span class="op" id="3140109">]</span><span class="op" id="3140110">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140113"><a href="/image/jpeg/reader.go.html#3139673">d</a></span><span class="op" id="3140114">.</span><span class="ident" id="3140115">bytes</span><span class="op" id="3140120">.</span><span class="ident" id="3140121">j</span>&nbsp;<span class="op" id="3140123">+=</span>&nbsp;<span class="ident" id="3140126"><a href="/image/jpeg/reader.go.html#3140068">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140129">if</span>&nbsp;<span class="ident" id="3140132"><a href="/image/jpeg/reader.go.html#3140068">n</a></span>&nbsp;<span class="op" id="3140134">&gt;</span>&nbsp;<span class="num" id="3140136">0</span>&nbsp;<span class="op" id="3140138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140142"><a href="/image/jpeg/reader.go.html#3140071">err</a></span>&nbsp;<span class="op" id="3140146">=</span>&nbsp;<span class="ident" id="3140148">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140156">return</span>&nbsp;<span class="ident" id="3140163"><a href="/image/jpeg/reader.go.html#3140071">err</a></span><br>
<span class="lineno">150</span><span class="op" id="3140167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3140170">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="3140244">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="3140324">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="3140403">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="3140481">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3140549">func</span>&nbsp;<span class="op" id="3140554">(</span><span class="ident" id="3140555">d</span>&nbsp;<span class="op" id="3140557">*</span><span class="ident" id="3140558"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3140565">)</span>&nbsp;<span class="ident" id="3140567">unreadByteStuffedByte</span><span class="op" id="3140588">(</span><span class="op" id="3140589">)</span>&nbsp;<span class="op" id="3140591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140594">if</span>&nbsp;<span class="ident" id="3140597"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140598">.</span><span class="ident" id="3140599">bytes</span><span class="op" id="3140604">.</span><span class="ident" id="3140605">nUnreadable</span>&nbsp;<span class="op" id="3140617">==</span>&nbsp;<span class="num" id="3140620">0</span>&nbsp;<span class="op" id="3140622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3140626">panic</span><span class="op" id="3140631">(</span><span class="string" id="3140632">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="3140686">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140692"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140693">.</span><span class="ident" id="3140694">bytes</span><span class="op" id="3140699">.</span><span class="ident" id="3140700">i</span>&nbsp;<span class="op" id="3140702">-=</span>&nbsp;<span class="ident" id="3140705"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140706">.</span><span class="ident" id="3140707">bytes</span><span class="op" id="3140712">.</span><span class="ident" id="3140713">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140726"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140727">.</span><span class="ident" id="3140728">bytes</span><span class="op" id="3140733">.</span><span class="ident" id="3140734">nUnreadable</span>&nbsp;<span class="op" id="3140746">=</span>&nbsp;<span class="num" id="3140748">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140751">if</span>&nbsp;<span class="ident" id="3140754"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140755">.</span><span class="ident" id="3140756">bits</span><span class="op" id="3140760">.</span><span class="ident" id="3140761">n</span>&nbsp;<span class="op" id="3140763">&gt;=</span>&nbsp;<span class="num" id="3140766">8</span>&nbsp;<span class="op" id="3140768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140772"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140773">.</span><span class="ident" id="3140774">bits</span><span class="op" id="3140778">.</span><span class="ident" id="3140779">a</span>&nbsp;<span class="op" id="3140781">&gt;&gt;=</span>&nbsp;<span class="num" id="3140785">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140789"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140790">.</span><span class="ident" id="3140791">bits</span><span class="op" id="3140795">.</span><span class="ident" id="3140796">n</span>&nbsp;<span class="op" id="3140798">-=</span>&nbsp;<span class="num" id="3140801">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140805"><a href="/image/jpeg/reader.go.html#3140555">d</a></span><span class="op" id="3140806">.</span><span class="ident" id="3140807">bits</span><span class="op" id="3140811">.</span><span class="ident" id="3140812">m</span>&nbsp;<span class="op" id="3140814">&gt;&gt;=</span>&nbsp;<span class="num" id="3140818">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140821">}</span><br>
<span class="lineno"></span><span class="op" id="3140823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3140826">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="3140903">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="3140936">func</span>&nbsp;<span class="op" id="3140941">(</span><span class="ident" id="3140942">d</span>&nbsp;<span class="op" id="3140944">*</span><span class="ident" id="3140945"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3140952">)</span>&nbsp;<span class="ident" id="3140954">readByte</span><span class="op" id="3140962">(</span><span class="op" id="3140963">)</span>&nbsp;<span class="op" id="3140965">(</span><span class="ident" id="3140966">x</span>&nbsp;<span class="builtintype" id="3140968">byte</span><span class="op" id="3140972">,</span>&nbsp;<span class="ident" id="3140974">err</span>&nbsp;<span class="builtintype" id="3140978">error</span><span class="op" id="3140983">)</span>&nbsp;<span class="op" id="3140985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140988">for</span>&nbsp;<span class="ident" id="3140992"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3140993">.</span><span class="ident" id="3140994">bytes</span><span class="op" id="3140999">.</span><span class="ident" id="3141000">i</span>&nbsp;<span class="op" id="3141002">==</span>&nbsp;<span class="ident" id="3141005"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141006">.</span><span class="ident" id="3141007">bytes</span><span class="op" id="3141012">.</span><span class="ident" id="3141013">j</span>&nbsp;<span class="op" id="3141015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141019">if</span>&nbsp;<span class="ident" id="3141022"><a href="/image/jpeg/reader.go.html#3140974">err</a></span>&nbsp;<span class="op" id="3141026">=</span>&nbsp;<span class="ident" id="3141028"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141029">.</span><span class="ident" id="3141030">fill</span><span class="op" id="3141034">(</span><span class="op" id="3141035">)</span><span class="op" id="3141036">;</span>&nbsp;<span class="ident" id="3141038"><a href="/image/jpeg/reader.go.html#3140974">err</a></span>&nbsp;<span class="op" id="3141042">!=</span>&nbsp;<span class="ident" id="3141045">nil</span>&nbsp;<span class="op" id="3141049">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141054">return</span>&nbsp;<span class="num" id="3141061">0</span><span class="op" id="3141062">,</span>&nbsp;<span class="ident" id="3141064"><a href="/image/jpeg/reader.go.html#3140974">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141076"><a href="/image/jpeg/reader.go.html#3140966">x</a></span>&nbsp;<span class="op" id="3141078">=</span>&nbsp;<span class="ident" id="3141080"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141081">.</span><span class="ident" id="3141082">bytes</span><span class="op" id="3141087">.</span><span class="ident" id="3141088">buf</span><span class="op" id="3141091">[</span><span class="ident" id="3141092"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141093">.</span><span class="ident" id="3141094">bytes</span><span class="op" id="3141099">.</span><span class="ident" id="3141100">i</span><span class="op" id="3141101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141104"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141105">.</span><span class="ident" id="3141106">bytes</span><span class="op" id="3141111">.</span><span class="ident" id="3141112">i</span><span class="op" id="3141113">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141117"><a href="/image/jpeg/reader.go.html#3140942">d</a></span><span class="op" id="3141118">.</span><span class="ident" id="3141119">bytes</span><span class="op" id="3141124">.</span><span class="ident" id="3141125">nUnreadable</span>&nbsp;<span class="op" id="3141137">=</span>&nbsp;<span class="num" id="3141139">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141142">return</span>&nbsp;<span class="ident" id="3141149"><a href="/image/jpeg/reader.go.html#3140966">x</a></span><span class="op" id="3141150">,</span>&nbsp;<span class="ident" id="3141152">nil</span><br>
<span class="lineno"></span><span class="op" id="3141156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141159">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="3141236">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="3141311">var</span>&nbsp;<span class="ident" id="3141315">errMissingFF00</span>&nbsp;<span class="op" id="3141330">=</span>&nbsp;<span class="ident" id="3141332"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3141343">(</span><span class="string" id="3141344">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="3141369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141372">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3141450">func</span>&nbsp;<span class="op" id="3141455">(</span><span class="ident" id="3141456">d</span>&nbsp;<span class="op" id="3141458">*</span><span class="ident" id="3141459"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3141466">)</span>&nbsp;<span class="ident" id="3141468">readByteStuffedByte</span><span class="op" id="3141487">(</span><span class="op" id="3141488">)</span>&nbsp;<span class="op" id="3141490">(</span><span class="ident" id="3141491">x</span>&nbsp;<span class="builtintype" id="3141493">byte</span><span class="op" id="3141497">,</span>&nbsp;<span class="ident" id="3141499">err</span>&nbsp;<span class="builtintype" id="3141503">error</span><span class="op" id="3141508">)</span>&nbsp;<span class="op" id="3141510">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141513">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141580">if</span>&nbsp;<span class="ident" id="3141583"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141584">.</span><span class="ident" id="3141585">bytes</span><span class="op" id="3141590">.</span><span class="ident" id="3141591">i</span><span class="op" id="3141592">+</span><span class="num" id="3141593">2</span>&nbsp;<span class="op" id="3141595">&lt;=</span>&nbsp;<span class="ident" id="3141598"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141599">.</span><span class="ident" id="3141600">bytes</span><span class="op" id="3141605">.</span><span class="ident" id="3141606">j</span>&nbsp;<span class="op" id="3141608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141612"><a href="/image/jpeg/reader.go.html#3141491">x</a></span>&nbsp;<span class="op" id="3141614">=</span>&nbsp;<span class="ident" id="3141616"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141617">.</span><span class="ident" id="3141618">bytes</span><span class="op" id="3141623">.</span><span class="ident" id="3141624">buf</span><span class="op" id="3141627">[</span><span class="ident" id="3141628"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141629">.</span><span class="ident" id="3141630">bytes</span><span class="op" id="3141635">.</span><span class="ident" id="3141636">i</span><span class="op" id="3141637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141641"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141642">.</span><span class="ident" id="3141643">bytes</span><span class="op" id="3141648">.</span><span class="ident" id="3141649">i</span><span class="op" id="3141650">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141655"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141656">.</span><span class="ident" id="3141657">bytes</span><span class="op" id="3141662">.</span><span class="ident" id="3141663">nUnreadable</span>&nbsp;<span class="op" id="3141675">=</span>&nbsp;<span class="num" id="3141677">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141681">if</span>&nbsp;<span class="ident" id="3141684"><a href="/image/jpeg/reader.go.html#3141491">x</a></span>&nbsp;<span class="op" id="3141686">!=</span>&nbsp;<span class="num" id="3141689">0xff</span>&nbsp;<span class="op" id="3141694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141699">return</span>&nbsp;<span class="ident" id="3141706"><a href="/image/jpeg/reader.go.html#3141491">x</a></span><span class="op" id="3141707">,</span>&nbsp;<span class="ident" id="3141709"><a href="/image/jpeg/reader.go.html#3141499">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141719">if</span>&nbsp;<span class="ident" id="3141722"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141723">.</span><span class="ident" id="3141724">bytes</span><span class="op" id="3141729">.</span><span class="ident" id="3141730">buf</span><span class="op" id="3141733">[</span><span class="ident" id="3141734"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141735">.</span><span class="ident" id="3141736">bytes</span><span class="op" id="3141741">.</span><span class="ident" id="3141742">i</span><span class="op" id="3141743">]</span>&nbsp;<span class="op" id="3141745">!=</span>&nbsp;<span class="num" id="3141748">0x00</span>&nbsp;<span class="op" id="3141753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141758">return</span>&nbsp;<span class="num" id="3141765">0</span><span class="op" id="3141766">,</span>&nbsp;<span class="ident" id="3141768"><a href="/image/jpeg/reader.go.html#3141315">errMissingFF00</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141789"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141790">.</span><span class="ident" id="3141791">bytes</span><span class="op" id="3141796">.</span><span class="ident" id="3141797">i</span><span class="op" id="3141798">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141803"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141804">.</span><span class="ident" id="3141805">bytes</span><span class="op" id="3141810">.</span><span class="ident" id="3141811">nUnreadable</span>&nbsp;<span class="op" id="3141823">=</span>&nbsp;<span class="num" id="3141825">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141829">return</span>&nbsp;<span class="num" id="3141836">0xff</span><span class="op" id="3141840">,</span>&nbsp;<span class="ident" id="3141842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141847">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141851"><a href="/image/jpeg/reader.go.html#3141491">x</a></span><span class="op" id="3141852">,</span>&nbsp;<span class="ident" id="3141854"><a href="/image/jpeg/reader.go.html#3141499">err</a></span>&nbsp;<span class="op" id="3141858">=</span>&nbsp;<span class="ident" id="3141860"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141861">.</span><span class="ident" id="3141862">readByte</span><span class="op" id="3141870">(</span><span class="op" id="3141871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141874">if</span>&nbsp;<span class="ident" id="3141877"><a href="/image/jpeg/reader.go.html#3141499">err</a></span>&nbsp;<span class="op" id="3141881">!=</span>&nbsp;<span class="ident" id="3141884">nil</span>&nbsp;<span class="op" id="3141888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141892">return</span>&nbsp;<span class="num" id="3141899">0</span><span class="op" id="3141900">,</span>&nbsp;<span class="ident" id="3141902"><a href="/image/jpeg/reader.go.html#3141499">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141907">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141910">if</span>&nbsp;<span class="ident" id="3141913"><a href="/image/jpeg/reader.go.html#3141491">x</a></span>&nbsp;<span class="op" id="3141915">!=</span>&nbsp;<span class="num" id="3141918">0xff</span>&nbsp;<span class="op" id="3141923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141927"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141928">.</span><span class="ident" id="3141929">bytes</span><span class="op" id="3141934">.</span><span class="ident" id="3141935">nUnreadable</span>&nbsp;<span class="op" id="3141947">=</span>&nbsp;<span class="num" id="3141949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141953">return</span>&nbsp;<span class="ident" id="3141960"><a href="/image/jpeg/reader.go.html#3141491">x</a></span><span class="op" id="3141961">,</span>&nbsp;<span class="ident" id="3141963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141972"><a href="/image/jpeg/reader.go.html#3141491">x</a></span><span class="op" id="3141973">,</span>&nbsp;<span class="ident" id="3141975"><a href="/image/jpeg/reader.go.html#3141499">err</a></span>&nbsp;<span class="op" id="3141979">=</span>&nbsp;<span class="ident" id="3141981"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3141982">.</span><span class="ident" id="3141983">readByte</span><span class="op" id="3141991">(</span><span class="op" id="3141992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141995">if</span>&nbsp;<span class="ident" id="3141998"><a href="/image/jpeg/reader.go.html#3141499">err</a></span>&nbsp;<span class="op" id="3142002">!=</span>&nbsp;<span class="ident" id="3142005">nil</span>&nbsp;<span class="op" id="3142009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142013"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3142014">.</span><span class="ident" id="3142015">bytes</span><span class="op" id="3142020">.</span><span class="ident" id="3142021">nUnreadable</span>&nbsp;<span class="op" id="3142033">=</span>&nbsp;<span class="num" id="3142035">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142039">return</span>&nbsp;<span class="num" id="3142046">0</span><span class="op" id="3142047">,</span>&nbsp;<span class="ident" id="3142049"><a href="/image/jpeg/reader.go.html#3141499">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142054">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142057"><a href="/image/jpeg/reader.go.html#3141456">d</a></span><span class="op" id="3142058">.</span><span class="ident" id="3142059">bytes</span><span class="op" id="3142064">.</span><span class="ident" id="3142065">nUnreadable</span>&nbsp;<span class="op" id="3142077">=</span>&nbsp;<span class="num" id="3142079">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142082">if</span>&nbsp;<span class="ident" id="3142085"><a href="/image/jpeg/reader.go.html#3141491">x</a></span>&nbsp;<span class="op" id="3142087">!=</span>&nbsp;<span class="num" id="3142090">0x00</span>&nbsp;<span class="op" id="3142095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142099">return</span>&nbsp;<span class="num" id="3142106">0</span><span class="op" id="3142107">,</span>&nbsp;<span class="ident" id="3142109"><a href="/image/jpeg/reader.go.html#3141315">errMissingFF00</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142128">return</span>&nbsp;<span class="num" id="3142135">0xff</span><span class="op" id="3142139">,</span>&nbsp;<span class="ident" id="3142141">nil</span><br>
<span class="lineno">225</span><span class="op" id="3142145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3142148">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3142223">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="3142236">func</span>&nbsp;<span class="op" id="3142241">(</span><span class="ident" id="3142242">d</span>&nbsp;<span class="op" id="3142244">*</span><span class="ident" id="3142245"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3142252">)</span>&nbsp;<span class="ident" id="3142254">readFull</span><span class="op" id="3142262">(</span><span class="ident" id="3142263">p</span>&nbsp;<span class="op" id="3142265">[</span><span class="op" id="3142266">]</span><span class="builtintype" id="3142267">byte</span><span class="op" id="3142271">)</span>&nbsp;<span class="builtintype" id="3142273">error</span>&nbsp;<span class="op" id="3142279">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3142282">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142321">if</span>&nbsp;<span class="ident" id="3142324"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142325">.</span><span class="ident" id="3142326">bytes</span><span class="op" id="3142331">.</span><span class="ident" id="3142332">nUnreadable</span>&nbsp;<span class="op" id="3142344">!=</span>&nbsp;<span class="num" id="3142347">0</span>&nbsp;<span class="op" id="3142349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142353">if</span>&nbsp;<span class="ident" id="3142356"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142357">.</span><span class="ident" id="3142358">bits</span><span class="op" id="3142362">.</span><span class="ident" id="3142363">n</span>&nbsp;<span class="op" id="3142365">&gt;=</span>&nbsp;<span class="num" id="3142368">8</span>&nbsp;<span class="op" id="3142370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142375"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142376">.</span><span class="ident" id="3142377">unreadByteStuffedByte</span><span class="op" id="3142398">(</span><span class="op" id="3142399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142403">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142407"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142408">.</span><span class="ident" id="3142409">bytes</span><span class="op" id="3142414">.</span><span class="ident" id="3142415">nUnreadable</span>&nbsp;<span class="op" id="3142427">=</span>&nbsp;<span class="num" id="3142429">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142436">for</span>&nbsp;<span class="op" id="3142440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142444">n</span>&nbsp;<span class="op" id="3142446">:=</span>&nbsp;<span class="builtinfunc" id="3142449">copy</span><span class="op" id="3142453">(</span><span class="ident" id="3142454"><a href="/image/jpeg/reader.go.html#3142263">p</a></span><span class="op" id="3142455">,</span>&nbsp;<span class="ident" id="3142457"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142458">.</span><span class="ident" id="3142459">bytes</span><span class="op" id="3142464">.</span><span class="ident" id="3142465">buf</span><span class="op" id="3142468">[</span><span class="ident" id="3142469"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142470">.</span><span class="ident" id="3142471">bytes</span><span class="op" id="3142476">.</span><span class="ident" id="3142477">i</span><span class="op" id="3142478">:</span><span class="ident" id="3142479"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142480">.</span><span class="ident" id="3142481">bytes</span><span class="op" id="3142486">.</span><span class="ident" id="3142487">j</span><span class="op" id="3142488">]</span><span class="op" id="3142489">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142493"><a href="/image/jpeg/reader.go.html#3142263">p</a></span>&nbsp;<span class="op" id="3142495">=</span>&nbsp;<span class="ident" id="3142497"><a href="/image/jpeg/reader.go.html#3142263">p</a></span><span class="op" id="3142498">[</span><span class="ident" id="3142499"><a href="/image/jpeg/reader.go.html#3142444">n</a></span><span class="op" id="3142500">:</span><span class="op" id="3142501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142505"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142506">.</span><span class="ident" id="3142507">bytes</span><span class="op" id="3142512">.</span><span class="ident" id="3142513">i</span>&nbsp;<span class="op" id="3142515">+=</span>&nbsp;<span class="ident" id="3142518"><a href="/image/jpeg/reader.go.html#3142444">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142522">if</span>&nbsp;<span class="builtinfunc" id="3142525">len</span><span class="op" id="3142528">(</span><span class="ident" id="3142529"><a href="/image/jpeg/reader.go.html#3142263">p</a></span><span class="op" id="3142530">)</span>&nbsp;<span class="op" id="3142532">==</span>&nbsp;<span class="num" id="3142535">0</span>&nbsp;<span class="op" id="3142537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142542">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142550">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142554">if</span>&nbsp;<span class="ident" id="3142557">err</span>&nbsp;<span class="op" id="3142561">:=</span>&nbsp;<span class="ident" id="3142564"><a href="/image/jpeg/reader.go.html#3142242">d</a></span><span class="op" id="3142565">.</span><span class="ident" id="3142566">fill</span><span class="op" id="3142570">(</span><span class="op" id="3142571">)</span><span class="op" id="3142572">;</span>&nbsp;<span class="ident" id="3142574"><a href="/image/jpeg/reader.go.html#3142557">err</a></span>&nbsp;<span class="op" id="3142578">!=</span>&nbsp;<span class="ident" id="3142581">nil</span>&nbsp;<span class="op" id="3142585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142590">if</span>&nbsp;<span class="ident" id="3142593"><a href="/image/jpeg/reader.go.html#3142557">err</a></span>&nbsp;<span class="op" id="3142597">==</span>&nbsp;<span class="ident" id="3142600"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3142602">.</span><span class="ident" id="3142603">EOF</span>&nbsp;<span class="op" id="3142607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142613"><a href="/image/jpeg/reader.go.html#3142557">err</a></span>&nbsp;<span class="op" id="3142617">=</span>&nbsp;<span class="ident" id="3142619"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3142621">.</span><span class="ident" id="3142622">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142647">return</span>&nbsp;<span class="ident" id="3142654"><a href="/image/jpeg/reader.go.html#3142557">err</a></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142666">return</span>&nbsp;<span class="ident" id="3142673">nil</span><br>
<span class="lineno"></span><span class="op" id="3142677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3142680">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3142716">func</span>&nbsp;<span class="op" id="3142721">(</span><span class="ident" id="3142722">d</span>&nbsp;<span class="op" id="3142724">*</span><span class="ident" id="3142725"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3142732">)</span>&nbsp;<span class="ident" id="3142734">ignore</span><span class="op" id="3142740">(</span><span class="ident" id="3142741">n</span>&nbsp;<span class="builtintype" id="3142743">int</span><span class="op" id="3142746">)</span>&nbsp;<span class="builtintype" id="3142748">error</span>&nbsp;<span class="op" id="3142754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3142757">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142796">if</span>&nbsp;<span class="ident" id="3142799"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142800">.</span><span class="ident" id="3142801">bytes</span><span class="op" id="3142806">.</span><span class="ident" id="3142807">nUnreadable</span>&nbsp;<span class="op" id="3142819">!=</span>&nbsp;<span class="num" id="3142822">0</span>&nbsp;<span class="op" id="3142824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142828">if</span>&nbsp;<span class="ident" id="3142831"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142832">.</span><span class="ident" id="3142833">bits</span><span class="op" id="3142837">.</span><span class="ident" id="3142838">n</span>&nbsp;<span class="op" id="3142840">&gt;=</span>&nbsp;<span class="num" id="3142843">8</span>&nbsp;<span class="op" id="3142845">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142850"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142851">.</span><span class="ident" id="3142852">unreadByteStuffedByte</span><span class="op" id="3142873">(</span><span class="op" id="3142874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142882"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142883">.</span><span class="ident" id="3142884">bytes</span><span class="op" id="3142889">.</span><span class="ident" id="3142890">nUnreadable</span>&nbsp;<span class="op" id="3142902">=</span>&nbsp;<span class="num" id="3142904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142911">for</span>&nbsp;<span class="op" id="3142915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142919">m</span>&nbsp;<span class="op" id="3142921">:=</span>&nbsp;<span class="ident" id="3142924"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142925">.</span><span class="ident" id="3142926">bytes</span><span class="op" id="3142931">.</span><span class="ident" id="3142932">j</span>&nbsp;<span class="op" id="3142934">-</span>&nbsp;<span class="ident" id="3142936"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142937">.</span><span class="ident" id="3142938">bytes</span><span class="op" id="3142943">.</span><span class="ident" id="3142944">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142948">if</span>&nbsp;<span class="ident" id="3142951"><a href="/image/jpeg/reader.go.html#3142919">m</a></span>&nbsp;<span class="op" id="3142953">&gt;</span>&nbsp;<span class="ident" id="3142955"><a href="/image/jpeg/reader.go.html#3142741">n</a></span>&nbsp;<span class="op" id="3142957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142962"><a href="/image/jpeg/reader.go.html#3142919">m</a></span>&nbsp;<span class="op" id="3142964">=</span>&nbsp;<span class="ident" id="3142966"><a href="/image/jpeg/reader.go.html#3142741">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142970">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142974"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3142975">.</span><span class="ident" id="3142976">bytes</span><span class="op" id="3142981">.</span><span class="ident" id="3142982">i</span>&nbsp;<span class="op" id="3142984">+=</span>&nbsp;<span class="ident" id="3142987"><a href="/image/jpeg/reader.go.html#3142919">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142991"><a href="/image/jpeg/reader.go.html#3142741">n</a></span>&nbsp;<span class="op" id="3142993">-=</span>&nbsp;<span class="ident" id="3142996"><a href="/image/jpeg/reader.go.html#3142919">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143000">if</span>&nbsp;<span class="ident" id="3143003"><a href="/image/jpeg/reader.go.html#3142741">n</a></span>&nbsp;<span class="op" id="3143005">==</span>&nbsp;<span class="num" id="3143008">0</span>&nbsp;<span class="op" id="3143010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143015">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143023">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143027">if</span>&nbsp;<span class="ident" id="3143030">err</span>&nbsp;<span class="op" id="3143034">:=</span>&nbsp;<span class="ident" id="3143037"><a href="/image/jpeg/reader.go.html#3142722">d</a></span><span class="op" id="3143038">.</span><span class="ident" id="3143039">fill</span><span class="op" id="3143043">(</span><span class="op" id="3143044">)</span><span class="op" id="3143045">;</span>&nbsp;<span class="ident" id="3143047"><a href="/image/jpeg/reader.go.html#3143030">err</a></span>&nbsp;<span class="op" id="3143051">!=</span>&nbsp;<span class="ident" id="3143054">nil</span>&nbsp;<span class="op" id="3143058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143063">if</span>&nbsp;<span class="ident" id="3143066"><a href="/image/jpeg/reader.go.html#3143030">err</a></span>&nbsp;<span class="op" id="3143070">==</span>&nbsp;<span class="ident" id="3143073"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3143075">.</span><span class="ident" id="3143076">EOF</span>&nbsp;<span class="op" id="3143080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143086"><a href="/image/jpeg/reader.go.html#3143030">err</a></span>&nbsp;<span class="op" id="3143090">=</span>&nbsp;<span class="ident" id="3143092"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3143094">.</span><span class="ident" id="3143095">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143120">return</span>&nbsp;<span class="ident" id="3143127"><a href="/image/jpeg/reader.go.html#3143030">err</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143139">return</span>&nbsp;<span class="ident" id="3143146">nil</span><br>
<span class="lineno"></span><span class="op" id="3143150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="3143153">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="3143184">func</span>&nbsp;<span class="op" id="3143189">(</span><span class="ident" id="3143190">d</span>&nbsp;<span class="op" id="3143192">*</span><span class="ident" id="3143193"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3143200">)</span>&nbsp;<span class="ident" id="3143202">processSOF</span><span class="op" id="3143212">(</span><span class="ident" id="3143213">n</span>&nbsp;<span class="builtintype" id="3143215">int</span><span class="op" id="3143218">)</span>&nbsp;<span class="builtintype" id="3143220">error</span>&nbsp;<span class="op" id="3143226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143229">switch</span>&nbsp;<span class="ident" id="3143236"><a href="/image/jpeg/reader.go.html#3143213">n</a></span>&nbsp;<span class="op" id="3143238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143241">case</span>&nbsp;<span class="num" id="3143246">6</span>&nbsp;<span class="op" id="3143248">+</span>&nbsp;<span class="num" id="3143250">3</span><span class="op" id="3143251">*</span><span class="ident" id="3143252"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span><span class="op" id="3143266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143270"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143271">.</span><span class="ident" id="3143272">nComp</span>&nbsp;<span class="op" id="3143278">=</span>&nbsp;<span class="ident" id="3143280"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143296">case</span>&nbsp;<span class="num" id="3143301">6</span>&nbsp;<span class="op" id="3143303">+</span>&nbsp;<span class="num" id="3143305">3</span><span class="op" id="3143306">*</span><span class="ident" id="3143307"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3143322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143326"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143327">.</span><span class="ident" id="3143328">nComp</span>&nbsp;<span class="op" id="3143334">=</span>&nbsp;<span class="ident" id="3143336"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143353">default</span><span class="op" id="3143360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143364">return</span>&nbsp;<span class="ident" id="3143371"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3143387">(</span><span class="string" id="3143388">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3143410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143413">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143416">if</span>&nbsp;<span class="ident" id="3143419">err</span>&nbsp;<span class="op" id="3143423">:=</span>&nbsp;<span class="ident" id="3143426"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143427">.</span><span class="ident" id="3143428">readFull</span><span class="op" id="3143436">(</span><span class="ident" id="3143437"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143438">.</span><span class="ident" id="3143439">tmp</span><span class="op" id="3143442">[</span><span class="op" id="3143443">:</span><span class="ident" id="3143444"><a href="/image/jpeg/reader.go.html#3143213">n</a></span><span class="op" id="3143445">]</span><span class="op" id="3143446">)</span><span class="op" id="3143447">;</span>&nbsp;<span class="ident" id="3143449"><a href="/image/jpeg/reader.go.html#3143419">err</a></span>&nbsp;<span class="op" id="3143453">!=</span>&nbsp;<span class="ident" id="3143456">nil</span>&nbsp;<span class="op" id="3143460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143464">return</span>&nbsp;<span class="ident" id="3143471"><a href="/image/jpeg/reader.go.html#3143419">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3143479">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143516">if</span>&nbsp;<span class="ident" id="3143519"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143520">.</span><span class="ident" id="3143521">tmp</span><span class="op" id="3143524">[</span><span class="num" id="3143525">0</span><span class="op" id="3143526">]</span>&nbsp;<span class="op" id="3143528">!=</span>&nbsp;<span class="num" id="3143531">8</span>&nbsp;<span class="op" id="3143533">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143537">return</span>&nbsp;<span class="ident" id="3143544"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3143560">(</span><span class="string" id="3143561">&#34;precision&#34;</span><span class="op" id="3143572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143578"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143579">.</span><span class="ident" id="3143580">height</span>&nbsp;<span class="op" id="3143587">=</span>&nbsp;<span class="builtintype" id="3143589">int</span><span class="op" id="3143592">(</span><span class="ident" id="3143593"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143594">.</span><span class="ident" id="3143595">tmp</span><span class="op" id="3143598">[</span><span class="num" id="3143599">1</span><span class="op" id="3143600">]</span><span class="op" id="3143601">)</span><span class="op" id="3143602">&lt;&lt;</span><span class="num" id="3143604">8</span>&nbsp;<span class="op" id="3143606">+</span>&nbsp;<span class="builtintype" id="3143608">int</span><span class="op" id="3143611">(</span><span class="ident" id="3143612"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143613">.</span><span class="ident" id="3143614">tmp</span><span class="op" id="3143617">[</span><span class="num" id="3143618">2</span><span class="op" id="3143619">]</span><span class="op" id="3143620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143623"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143624">.</span><span class="ident" id="3143625">width</span>&nbsp;<span class="op" id="3143631">=</span>&nbsp;<span class="builtintype" id="3143633">int</span><span class="op" id="3143636">(</span><span class="ident" id="3143637"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143638">.</span><span class="ident" id="3143639">tmp</span><span class="op" id="3143642">[</span><span class="num" id="3143643">3</span><span class="op" id="3143644">]</span><span class="op" id="3143645">)</span><span class="op" id="3143646">&lt;&lt;</span><span class="num" id="3143648">8</span>&nbsp;<span class="op" id="3143650">+</span>&nbsp;<span class="builtintype" id="3143652">int</span><span class="op" id="3143655">(</span><span class="ident" id="3143656"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143657">.</span><span class="ident" id="3143658">tmp</span><span class="op" id="3143661">[</span><span class="num" id="3143662">4</span><span class="op" id="3143663">]</span><span class="op" id="3143664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143667">if</span>&nbsp;<span class="builtintype" id="3143670">int</span><span class="op" id="3143673">(</span><span class="ident" id="3143674"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143675">.</span><span class="ident" id="3143676">tmp</span><span class="op" id="3143679">[</span><span class="num" id="3143680">5</span><span class="op" id="3143681">]</span><span class="op" id="3143682">)</span>&nbsp;<span class="op" id="3143684">!=</span>&nbsp;<span class="ident" id="3143687"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143688">.</span><span class="ident" id="3143689">nComp</span>&nbsp;<span class="op" id="3143695">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143699">return</span>&nbsp;<span class="ident" id="3143706"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3143722">(</span><span class="string" id="3143723">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="3143765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143771">for</span>&nbsp;<span class="ident" id="3143775">i</span>&nbsp;<span class="op" id="3143777">:=</span>&nbsp;<span class="num" id="3143780">0</span><span class="op" id="3143781">;</span>&nbsp;<span class="ident" id="3143783"><a href="/image/jpeg/reader.go.html#3143775">i</a></span>&nbsp;<span class="op" id="3143785">&lt;</span>&nbsp;<span class="ident" id="3143787"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143788">.</span><span class="ident" id="3143789">nComp</span><span class="op" id="3143794">;</span>&nbsp;<span class="ident" id="3143796"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3143797">++</span>&nbsp;<span class="op" id="3143800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143804"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143805">.</span><span class="ident" id="3143806">comp</span><span class="op" id="3143810">[</span><span class="ident" id="3143811"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3143812">]</span><span class="op" id="3143813">.</span><span class="ident" id="3143814">c</span>&nbsp;<span class="op" id="3143816">=</span>&nbsp;<span class="ident" id="3143818"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143819">.</span><span class="ident" id="3143820">tmp</span><span class="op" id="3143823">[</span><span class="num" id="3143824">6</span><span class="op" id="3143825">+</span><span class="num" id="3143826">3</span><span class="op" id="3143827">*</span><span class="ident" id="3143828"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3143829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143833"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143834">.</span><span class="ident" id="3143835">comp</span><span class="op" id="3143839">[</span><span class="ident" id="3143840"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3143841">]</span><span class="op" id="3143842">.</span><span class="ident" id="3143843">tq</span>&nbsp;<span class="op" id="3143846">=</span>&nbsp;<span class="ident" id="3143848"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143849">.</span><span class="ident" id="3143850">tmp</span><span class="op" id="3143853">[</span><span class="num" id="3143854">8</span><span class="op" id="3143855">+</span><span class="num" id="3143856">3</span><span class="op" id="3143857">*</span><span class="ident" id="3143858"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3143859">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143863">if</span>&nbsp;<span class="ident" id="3143866"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3143867">.</span><span class="ident" id="3143868">nComp</span>&nbsp;<span class="op" id="3143874">==</span>&nbsp;<span class="ident" id="3143877"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span>&nbsp;<span class="op" id="3143892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3143897">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3143971">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144044">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144120">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144197">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144273">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144350">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144426">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144502">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144579">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144652">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144683"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3144684">.</span><span class="ident" id="3144685">comp</span><span class="op" id="3144689">[</span><span class="ident" id="3144690"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3144691">]</span><span class="op" id="3144692">.</span><span class="ident" id="3144693">h</span>&nbsp;<span class="op" id="3144695">=</span>&nbsp;<span class="num" id="3144697">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144702"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3144703">.</span><span class="ident" id="3144704">comp</span><span class="op" id="3144708">[</span><span class="ident" id="3144709"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3144710">]</span><span class="op" id="3144711">.</span><span class="ident" id="3144712">v</span>&nbsp;<span class="op" id="3144714">=</span>&nbsp;<span class="num" id="3144716">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144721">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144736">hv</span>&nbsp;<span class="op" id="3144739">:=</span>&nbsp;<span class="ident" id="3144742"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3144743">.</span><span class="ident" id="3144744">tmp</span><span class="op" id="3144747">[</span><span class="num" id="3144748">7</span><span class="op" id="3144749">+</span><span class="num" id="3144750">3</span><span class="op" id="3144751">*</span><span class="ident" id="3144752"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3144753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144757"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3144758">.</span><span class="ident" id="3144759">comp</span><span class="op" id="3144763">[</span><span class="ident" id="3144764"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3144765">]</span><span class="op" id="3144766">.</span><span class="ident" id="3144767">h</span>&nbsp;<span class="op" id="3144769">=</span>&nbsp;<span class="builtintype" id="3144771">int</span><span class="op" id="3144774">(</span><span class="ident" id="3144775"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3144778">&gt;&gt;</span>&nbsp;<span class="num" id="3144781">4</span><span class="op" id="3144782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144786"><a href="/image/jpeg/reader.go.html#3143190">d</a></span><span class="op" id="3144787">.</span><span class="ident" id="3144788">comp</span><span class="op" id="3144792">[</span><span class="ident" id="3144793"><a href="/image/jpeg/reader.go.html#3143775">i</a></span><span class="op" id="3144794">]</span><span class="op" id="3144795">.</span><span class="ident" id="3144796">v</span>&nbsp;<span class="op" id="3144798">=</span>&nbsp;<span class="builtintype" id="3144800">int</span><span class="op" id="3144803">(</span><span class="ident" id="3144804"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3144807">&amp;</span>&nbsp;<span class="num" id="3144809">0x0f</span><span class="op" id="3144813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144817">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144892">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144964">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3145039">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145096">if</span>&nbsp;<span class="ident" id="3145099"><a href="/image/jpeg/reader.go.html#3143775">i</a></span>&nbsp;<span class="op" id="3145101">==</span>&nbsp;<span class="num" id="3145104">0</span>&nbsp;<span class="op" id="3145106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145111">if</span>&nbsp;<span class="ident" id="3145114"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3145117">!=</span>&nbsp;<span class="num" id="3145120">0x11</span>&nbsp;<span class="op" id="3145125">&amp;&amp;</span>&nbsp;<span class="ident" id="3145128"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3145131">!=</span>&nbsp;<span class="num" id="3145134">0x21</span>&nbsp;<span class="op" id="3145139">&amp;&amp;</span>&nbsp;<span class="ident" id="3145142"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3145145">!=</span>&nbsp;<span class="num" id="3145148">0x22</span>&nbsp;<span class="op" id="3145153">&amp;&amp;</span>&nbsp;<span class="ident" id="3145156"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3145159">!=</span>&nbsp;<span class="num" id="3145162">0x12</span>&nbsp;<span class="op" id="3145167">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145173">return</span>&nbsp;<span class="ident" id="3145180"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3145196">(</span><span class="string" id="3145197">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="3145227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145236">}</span>&nbsp;<span class="keyword" id="3145238">else</span>&nbsp;<span class="keyword" id="3145243">if</span>&nbsp;<span class="ident" id="3145246"><a href="/image/jpeg/reader.go.html#3144736">hv</a></span>&nbsp;<span class="op" id="3145249">!=</span>&nbsp;<span class="num" id="3145252">0x11</span>&nbsp;<span class="op" id="3145257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145262">return</span>&nbsp;<span class="ident" id="3145269"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3145285">(</span><span class="string" id="3145286">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="3145316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145320">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145326">return</span>&nbsp;<span class="ident" id="3145333">nil</span><br>
<span class="lineno"></span><span class="op" id="3145337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3145340">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="3145373">func</span>&nbsp;<span class="op" id="3145378">(</span><span class="ident" id="3145379">d</span>&nbsp;<span class="op" id="3145381">*</span><span class="ident" id="3145382"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3145389">)</span>&nbsp;<span class="ident" id="3145391">processDQT</span><span class="op" id="3145401">(</span><span class="ident" id="3145402">n</span>&nbsp;<span class="builtintype" id="3145404">int</span><span class="op" id="3145407">)</span>&nbsp;<span class="builtintype" id="3145409">error</span>&nbsp;<span class="op" id="3145415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145418">const</span>&nbsp;<span class="ident" id="3145424">qtLength</span>&nbsp;<span class="op" id="3145433">=</span>&nbsp;<span class="num" id="3145435">1</span>&nbsp;<span class="op" id="3145437">+</span>&nbsp;<span class="ident" id="3145439"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145450">for</span>&nbsp;<span class="op" id="3145454">;</span>&nbsp;<span class="ident" id="3145456"><a href="/image/jpeg/reader.go.html#3145402">n</a></span>&nbsp;<span class="op" id="3145458">&gt;=</span>&nbsp;<span class="ident" id="3145461"><a href="/image/jpeg/reader.go.html#3145424">qtLength</a></span><span class="op" id="3145469">;</span>&nbsp;<span class="ident" id="3145471"><a href="/image/jpeg/reader.go.html#3145402">n</a></span>&nbsp;<span class="op" id="3145473">-=</span>&nbsp;<span class="ident" id="3145476"><a href="/image/jpeg/reader.go.html#3145424">qtLength</a></span>&nbsp;<span class="op" id="3145485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145489">if</span>&nbsp;<span class="ident" id="3145492">err</span>&nbsp;<span class="op" id="3145496">:=</span>&nbsp;<span class="ident" id="3145499"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145500">.</span><span class="ident" id="3145501">readFull</span><span class="op" id="3145509">(</span><span class="ident" id="3145510"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145511">.</span><span class="ident" id="3145512">tmp</span><span class="op" id="3145515">[</span><span class="op" id="3145516">:</span><span class="ident" id="3145517"><a href="/image/jpeg/reader.go.html#3145424">qtLength</a></span><span class="op" id="3145525">]</span><span class="op" id="3145526">)</span><span class="op" id="3145527">;</span>&nbsp;<span class="ident" id="3145529"><a href="/image/jpeg/reader.go.html#3145492">err</a></span>&nbsp;<span class="op" id="3145533">!=</span>&nbsp;<span class="ident" id="3145536">nil</span>&nbsp;<span class="op" id="3145540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145545">return</span>&nbsp;<span class="ident" id="3145552"><a href="/image/jpeg/reader.go.html#3145492">err</a></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145562">pq</span>&nbsp;<span class="op" id="3145565">:=</span>&nbsp;<span class="ident" id="3145568"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145569">.</span><span class="ident" id="3145570">tmp</span><span class="op" id="3145573">[</span><span class="num" id="3145574">0</span><span class="op" id="3145575">]</span>&nbsp;<span class="op" id="3145577">&gt;&gt;</span>&nbsp;<span class="num" id="3145580">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145584">if</span>&nbsp;<span class="ident" id="3145587"><a href="/image/jpeg/reader.go.html#3145562">pq</a></span>&nbsp;<span class="op" id="3145590">!=</span>&nbsp;<span class="num" id="3145593">0</span>&nbsp;<span class="op" id="3145595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145600">return</span>&nbsp;<span class="ident" id="3145607"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3145623">(</span><span class="string" id="3145624">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="3145638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145642">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145646">tq</span>&nbsp;<span class="op" id="3145649">:=</span>&nbsp;<span class="ident" id="3145652"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145653">.</span><span class="ident" id="3145654">tmp</span><span class="op" id="3145657">[</span><span class="num" id="3145658">0</span><span class="op" id="3145659">]</span>&nbsp;<span class="op" id="3145661">&amp;</span>&nbsp;<span class="num" id="3145663">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145670">if</span>&nbsp;<span class="ident" id="3145673"><a href="/image/jpeg/reader.go.html#3145646">tq</a></span>&nbsp;<span class="op" id="3145676">&gt;</span>&nbsp;<span class="ident" id="3145678"><a href="/image/jpeg/reader.go.html#3136616">maxTq</a></span>&nbsp;<span class="op" id="3145684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145689">return</span>&nbsp;<span class="ident" id="3145696"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3145707">(</span><span class="string" id="3145708">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="3145722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145730">for</span>&nbsp;<span class="ident" id="3145734">i</span>&nbsp;<span class="op" id="3145736">:=</span>&nbsp;<span class="keyword" id="3145739">range</span>&nbsp;<span class="ident" id="3145745"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145746">.</span><span class="ident" id="3145747">quant</span><span class="op" id="3145752">[</span><span class="ident" id="3145753"><a href="/image/jpeg/reader.go.html#3145646">tq</a></span><span class="op" id="3145755">]</span>&nbsp;<span class="op" id="3145757">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145762"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145763">.</span><span class="ident" id="3145764">quant</span><span class="op" id="3145769">[</span><span class="ident" id="3145770"><a href="/image/jpeg/reader.go.html#3145646">tq</a></span><span class="op" id="3145772">]</span><span class="op" id="3145773">[</span><span class="ident" id="3145774"><a href="/image/jpeg/reader.go.html#3145734">i</a></span><span class="op" id="3145775">]</span>&nbsp;<span class="op" id="3145777">=</span>&nbsp;<span class="builtintype" id="3145779">int32</span><span class="op" id="3145784">(</span><span class="ident" id="3145785"><a href="/image/jpeg/reader.go.html#3145379">d</a></span><span class="op" id="3145786">.</span><span class="ident" id="3145787">tmp</span><span class="op" id="3145790">[</span><span class="ident" id="3145791"><a href="/image/jpeg/reader.go.html#3145734">i</a></span><span class="op" id="3145792">+</span><span class="num" id="3145793">1</span><span class="op" id="3145794">]</span><span class="op" id="3145795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145805">if</span>&nbsp;<span class="ident" id="3145808"><a href="/image/jpeg/reader.go.html#3145402">n</a></span>&nbsp;<span class="op" id="3145810">!=</span>&nbsp;<span class="num" id="3145813">0</span>&nbsp;<span class="op" id="3145815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145819">return</span>&nbsp;<span class="ident" id="3145826"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3145837">(</span><span class="string" id="3145838">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3145860">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145866">return</span>&nbsp;<span class="ident" id="3145873">nil</span><br>
<span class="lineno"></span><span class="op" id="3145877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3145880">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="3145913">func</span>&nbsp;<span class="op" id="3145918">(</span><span class="ident" id="3145919">d</span>&nbsp;<span class="op" id="3145921">*</span><span class="ident" id="3145922"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3145929">)</span>&nbsp;<span class="ident" id="3145931">processDRI</span><span class="op" id="3145941">(</span><span class="ident" id="3145942">n</span>&nbsp;<span class="builtintype" id="3145944">int</span><span class="op" id="3145947">)</span>&nbsp;<span class="builtintype" id="3145949">error</span>&nbsp;<span class="op" id="3145955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145958">if</span>&nbsp;<span class="ident" id="3145961"><a href="/image/jpeg/reader.go.html#3145942">n</a></span>&nbsp;<span class="op" id="3145963">!=</span>&nbsp;<span class="num" id="3145966">2</span>&nbsp;<span class="op" id="3145968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145972">return</span>&nbsp;<span class="ident" id="3145979"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3145990">(</span><span class="string" id="3145991">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3146013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146019">if</span>&nbsp;<span class="ident" id="3146022">err</span>&nbsp;<span class="op" id="3146026">:=</span>&nbsp;<span class="ident" id="3146029"><a href="/image/jpeg/reader.go.html#3145919">d</a></span><span class="op" id="3146030">.</span><span class="ident" id="3146031">readFull</span><span class="op" id="3146039">(</span><span class="ident" id="3146040"><a href="/image/jpeg/reader.go.html#3145919">d</a></span><span class="op" id="3146041">.</span><span class="ident" id="3146042">tmp</span><span class="op" id="3146045">[</span><span class="op" id="3146046">:</span><span class="num" id="3146047">2</span><span class="op" id="3146048">]</span><span class="op" id="3146049">)</span><span class="op" id="3146050">;</span>&nbsp;<span class="ident" id="3146052"><a href="/image/jpeg/reader.go.html#3146022">err</a></span>&nbsp;<span class="op" id="3146056">!=</span>&nbsp;<span class="ident" id="3146059">nil</span>&nbsp;<span class="op" id="3146063">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146067">return</span>&nbsp;<span class="ident" id="3146074"><a href="/image/jpeg/reader.go.html#3146022">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146082"><a href="/image/jpeg/reader.go.html#3145919">d</a></span><span class="op" id="3146083">.</span><span class="ident" id="3146084">ri</span>&nbsp;<span class="op" id="3146087">=</span>&nbsp;<span class="builtintype" id="3146089">int</span><span class="op" id="3146092">(</span><span class="ident" id="3146093"><a href="/image/jpeg/reader.go.html#3145919">d</a></span><span class="op" id="3146094">.</span><span class="ident" id="3146095">tmp</span><span class="op" id="3146098">[</span><span class="num" id="3146099">0</span><span class="op" id="3146100">]</span><span class="op" id="3146101">)</span><span class="op" id="3146102">&lt;&lt;</span><span class="num" id="3146104">8</span>&nbsp;<span class="op" id="3146106">+</span>&nbsp;<span class="builtintype" id="3146108">int</span><span class="op" id="3146111">(</span><span class="ident" id="3146112"><a href="/image/jpeg/reader.go.html#3145919">d</a></span><span class="op" id="3146113">.</span><span class="ident" id="3146114">tmp</span><span class="op" id="3146117">[</span><span class="num" id="3146118">1</span><span class="op" id="3146119">]</span><span class="op" id="3146120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146123">return</span>&nbsp;<span class="ident" id="3146130">nil</span><br>
<span class="lineno"></span><span class="op" id="3146134">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="3146137">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="3146207">func</span>&nbsp;<span class="op" id="3146212">(</span><span class="ident" id="3146213">d</span>&nbsp;<span class="op" id="3146215">*</span><span class="ident" id="3146216"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3146223">)</span>&nbsp;<span class="ident" id="3146225">decode</span><span class="op" id="3146231">(</span><span class="ident" id="3146232">r</span>&nbsp;<span class="ident" id="3146234"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3146236">.</span><span class="ident" id="3146237">Reader</span><span class="op" id="3146243">,</span>&nbsp;<span class="ident" id="3146245">configOnly</span>&nbsp;<span class="builtintype" id="3146256">bool</span><span class="op" id="3146260">)</span>&nbsp;<span class="op" id="3146262">(</span><span class="ident" id="3146263"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3146268">.</span><span class="ident" id="3146269">Image</span><span class="op" id="3146274">,</span>&nbsp;<span class="builtintype" id="3146276">error</span><span class="op" id="3146281">)</span>&nbsp;<span class="op" id="3146283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146286"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146287">.</span><span class="ident" id="3146288">r</span>&nbsp;<span class="op" id="3146290">=</span>&nbsp;<span class="ident" id="3146292"><a href="/image/jpeg/reader.go.html#3146232">r</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146296">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146337">if</span>&nbsp;<span class="ident" id="3146340">err</span>&nbsp;<span class="op" id="3146344">:=</span>&nbsp;<span class="ident" id="3146347"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146348">.</span><span class="ident" id="3146349">readFull</span><span class="op" id="3146357">(</span><span class="ident" id="3146358"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146359">.</span><span class="ident" id="3146360">tmp</span><span class="op" id="3146363">[</span><span class="op" id="3146364">:</span><span class="num" id="3146365">2</span><span class="op" id="3146366">]</span><span class="op" id="3146367">)</span><span class="op" id="3146368">;</span>&nbsp;<span class="ident" id="3146370"><a href="/image/jpeg/reader.go.html#3146340">err</a></span>&nbsp;<span class="op" id="3146374">!=</span>&nbsp;<span class="ident" id="3146377">nil</span>&nbsp;<span class="op" id="3146381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146385">return</span>&nbsp;<span class="ident" id="3146392">nil</span><span class="op" id="3146395">,</span>&nbsp;<span class="ident" id="3146397"><a href="/image/jpeg/reader.go.html#3146340">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146405">if</span>&nbsp;<span class="ident" id="3146408"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146409">.</span><span class="ident" id="3146410">tmp</span><span class="op" id="3146413">[</span><span class="num" id="3146414">0</span><span class="op" id="3146415">]</span>&nbsp;<span class="op" id="3146417">!=</span>&nbsp;<span class="num" id="3146420">0xff</span>&nbsp;<span class="op" id="3146425">||</span>&nbsp;<span class="ident" id="3146428"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146429">.</span><span class="ident" id="3146430">tmp</span><span class="op" id="3146433">[</span><span class="num" id="3146434">1</span><span class="op" id="3146435">]</span>&nbsp;<span class="op" id="3146437">!=</span>&nbsp;<span class="ident" id="3146440"><a href="/image/jpeg/reader.go.html#3137001">soiMarker</a></span>&nbsp;<span class="op" id="3146450">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146454">return</span>&nbsp;<span class="ident" id="3146461">nil</span><span class="op" id="3146464">,</span>&nbsp;<span class="ident" id="3146466"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3146477">(</span><span class="string" id="3146478">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="3146498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146505">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146571">for</span>&nbsp;<span class="op" id="3146575">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146579">err</span>&nbsp;<span class="op" id="3146583">:=</span>&nbsp;<span class="ident" id="3146586"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146587">.</span><span class="ident" id="3146588">readFull</span><span class="op" id="3146596">(</span><span class="ident" id="3146597"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146598">.</span><span class="ident" id="3146599">tmp</span><span class="op" id="3146602">[</span><span class="op" id="3146603">:</span><span class="num" id="3146604">2</span><span class="op" id="3146605">]</span><span class="op" id="3146606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146610">if</span>&nbsp;<span class="ident" id="3146613"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3146617">!=</span>&nbsp;<span class="ident" id="3146620">nil</span>&nbsp;<span class="op" id="3146624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146629">return</span>&nbsp;<span class="ident" id="3146636">nil</span><span class="op" id="3146639">,</span>&nbsp;<span class="ident" id="3146641"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146651">for</span>&nbsp;<span class="ident" id="3146655"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3146656">.</span><span class="ident" id="3146657">tmp</span><span class="op" id="3146660">[</span><span class="num" id="3146661">0</span><span class="op" id="3146662">]</span>&nbsp;<span class="op" id="3146664">!=</span>&nbsp;<span class="num" id="3146667">0xff</span>&nbsp;<span class="op" id="3146672">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146677">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146746">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146812">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146881">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146948">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147018">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147084">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147153">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147225">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147292">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147364">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147394">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147465">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147492">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147498">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147565">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147619">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147625">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147695">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147762"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3147763">.</span><span class="ident" id="3147764">tmp</span><span class="op" id="3147767">[</span><span class="num" id="3147768">0</span><span class="op" id="3147769">]</span>&nbsp;<span class="op" id="3147771">=</span>&nbsp;<span class="ident" id="3147773"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3147774">.</span><span class="ident" id="3147775">tmp</span><span class="op" id="3147778">[</span><span class="num" id="3147779">1</span><span class="op" id="3147780">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147785"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3147786">.</span><span class="ident" id="3147787">tmp</span><span class="op" id="3147790">[</span><span class="num" id="3147791">1</span><span class="op" id="3147792">]</span><span class="op" id="3147793">,</span>&nbsp;<span class="ident" id="3147795"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3147799">=</span>&nbsp;<span class="ident" id="3147801"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3147802">.</span><span class="ident" id="3147803">readByte</span><span class="op" id="3147811">(</span><span class="op" id="3147812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147817">if</span>&nbsp;<span class="ident" id="3147820"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3147824">!=</span>&nbsp;<span class="ident" id="3147827">nil</span>&nbsp;<span class="op" id="3147831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147837">return</span>&nbsp;<span class="ident" id="3147844">nil</span><span class="op" id="3147847">,</span>&nbsp;<span class="ident" id="3147849"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147856">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147864">marker</span>&nbsp;<span class="op" id="3147871">:=</span>&nbsp;<span class="ident" id="3147874"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3147875">.</span><span class="ident" id="3147876">tmp</span><span class="op" id="3147879">[</span><span class="num" id="3147880">1</span><span class="op" id="3147881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147885">if</span>&nbsp;<span class="ident" id="3147888"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3147895">==</span>&nbsp;<span class="num" id="3147898">0</span>&nbsp;<span class="op" id="3147900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147905">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147948">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147963">for</span>&nbsp;<span class="ident" id="3147967"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3147974">==</span>&nbsp;<span class="num" id="3147977">0xff</span>&nbsp;<span class="op" id="3147982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147987">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148061">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148127"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span><span class="op" id="3148133">,</span>&nbsp;<span class="ident" id="3148135"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3148139">=</span>&nbsp;<span class="ident" id="3148141"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3148142">.</span><span class="ident" id="3148143">readByte</span><span class="op" id="3148151">(</span><span class="op" id="3148152">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148157">if</span>&nbsp;<span class="ident" id="3148160"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3148164">!=</span>&nbsp;<span class="ident" id="3148167">nil</span>&nbsp;<span class="op" id="3148171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148177">return</span>&nbsp;<span class="ident" id="3148184">nil</span><span class="op" id="3148187">,</span>&nbsp;<span class="ident" id="3148189"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148204">if</span>&nbsp;<span class="ident" id="3148207"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3148214">==</span>&nbsp;<span class="ident" id="3148217"><a href="/image/jpeg/reader.go.html#3137040">eoiMarker</a></span>&nbsp;<span class="op" id="3148227">{</span>&nbsp;<span class="comment" id="3148229">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148249">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148261">if</span>&nbsp;<span class="ident" id="3148264"><a href="/image/jpeg/reader.go.html#3137361">rst0Marker</a></span>&nbsp;<span class="op" id="3148275">&lt;=</span>&nbsp;<span class="ident" id="3148278"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3148285">&amp;&amp;</span>&nbsp;<span class="ident" id="3148288"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3148295">&lt;=</span>&nbsp;<span class="ident" id="3148298"><a href="/image/jpeg/reader.go.html#3137397">rst7Marker</a></span>&nbsp;<span class="op" id="3148309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148314">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148398">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148475">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148554">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148639">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148725">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148801">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148817">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148900">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148975">if</span>&nbsp;<span class="ident" id="3148978"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3148982">=</span>&nbsp;<span class="ident" id="3148984"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3148985">.</span><span class="ident" id="3148986">readFull</span><span class="op" id="3148994">(</span><span class="ident" id="3148995"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3148996">.</span><span class="ident" id="3148997">tmp</span><span class="op" id="3149000">[</span><span class="op" id="3149001">:</span><span class="num" id="3149002">2</span><span class="op" id="3149003">]</span><span class="op" id="3149004">)</span><span class="op" id="3149005">;</span>&nbsp;<span class="ident" id="3149007"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149011">!=</span>&nbsp;<span class="ident" id="3149014">nil</span>&nbsp;<span class="op" id="3149018">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149023">return</span>&nbsp;<span class="ident" id="3149030">nil</span><span class="op" id="3149033">,</span>&nbsp;<span class="ident" id="3149035"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149045">n</span>&nbsp;<span class="op" id="3149047">:=</span>&nbsp;<span class="builtintype" id="3149050">int</span><span class="op" id="3149053">(</span><span class="ident" id="3149054"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149055">.</span><span class="ident" id="3149056">tmp</span><span class="op" id="3149059">[</span><span class="num" id="3149060">0</span><span class="op" id="3149061">]</span><span class="op" id="3149062">)</span><span class="op" id="3149063">&lt;&lt;</span><span class="num" id="3149065">8</span>&nbsp;<span class="op" id="3149067">+</span>&nbsp;<span class="builtintype" id="3149069">int</span><span class="op" id="3149072">(</span><span class="ident" id="3149073"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149074">.</span><span class="ident" id="3149075">tmp</span><span class="op" id="3149078">[</span><span class="num" id="3149079">1</span><span class="op" id="3149080">]</span><span class="op" id="3149081">)</span>&nbsp;<span class="op" id="3149083">-</span>&nbsp;<span class="num" id="3149085">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149089">if</span>&nbsp;<span class="ident" id="3149092"><a href="/image/jpeg/reader.go.html#3149045">n</a></span>&nbsp;<span class="op" id="3149094">&lt;</span>&nbsp;<span class="num" id="3149096">0</span>&nbsp;<span class="op" id="3149098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149103">return</span>&nbsp;<span class="ident" id="3149110">nil</span><span class="op" id="3149113">,</span>&nbsp;<span class="ident" id="3149115"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3149126">(</span><span class="string" id="3149127">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="3149149">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149158">switch</span>&nbsp;<span class="op" id="3149165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149169">case</span>&nbsp;<span class="ident" id="3149174"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149181">==</span>&nbsp;<span class="ident" id="3149184"><a href="/image/jpeg/reader.go.html#3137077">sof0Marker</a></span>&nbsp;<span class="op" id="3149195">||</span>&nbsp;<span class="ident" id="3149198"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149205">==</span>&nbsp;<span class="ident" id="3149208"><a href="/image/jpeg/reader.go.html#3137127">sof2Marker</a></span><span class="op" id="3149218">:</span>&nbsp;<span class="comment" id="3149220">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149242"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149243">.</span><span class="ident" id="3149244">progressive</span>&nbsp;<span class="op" id="3149256">=</span>&nbsp;<span class="ident" id="3149258"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149265">==</span>&nbsp;<span class="ident" id="3149268"><a href="/image/jpeg/reader.go.html#3137127">sof2Marker</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149282"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149286">=</span>&nbsp;<span class="ident" id="3149288"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149289">.</span><span class="ident" id="3149290">processSOF</span><span class="op" id="3149300">(</span><span class="ident" id="3149301"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149307">if</span>&nbsp;<span class="ident" id="3149310"><a href="/image/jpeg/reader.go.html#3146245">configOnly</a></span>&nbsp;<span class="op" id="3149321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149327">return</span>&nbsp;<span class="ident" id="3149334">nil</span><span class="op" id="3149337">,</span>&nbsp;<span class="ident" id="3149339"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149350">case</span>&nbsp;<span class="ident" id="3149355"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149362">==</span>&nbsp;<span class="ident" id="3149365"><a href="/image/jpeg/reader.go.html#3137180">dhtMarker</a></span><span class="op" id="3149374">:</span>&nbsp;<span class="comment" id="3149376">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149404"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149408">=</span>&nbsp;<span class="ident" id="3149410"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149411">.</span><span class="ident" id="3149412">processDHT</span><span class="op" id="3149422">(</span><span class="ident" id="3149423"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149428">case</span>&nbsp;<span class="ident" id="3149433"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149440">==</span>&nbsp;<span class="ident" id="3149443"><a href="/image/jpeg/reader.go.html#3137225">dqtMarker</a></span><span class="op" id="3149452">:</span>&nbsp;<span class="comment" id="3149454">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149487"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149491">=</span>&nbsp;<span class="ident" id="3149493"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149494">.</span><span class="ident" id="3149495">processDQT</span><span class="op" id="3149505">(</span><span class="ident" id="3149506"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149511">case</span>&nbsp;<span class="ident" id="3149516"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149523">==</span>&nbsp;<span class="ident" id="3149526"><a href="/image/jpeg/reader.go.html#3137275">sosMarker</a></span><span class="op" id="3149535">:</span>&nbsp;<span class="comment" id="3149537">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149558"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149562">=</span>&nbsp;<span class="ident" id="3149564"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149565">.</span><span class="ident" id="3149566">processSOS</span><span class="op" id="3149576">(</span><span class="ident" id="3149577"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149578">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149582">case</span>&nbsp;<span class="ident" id="3149587"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149594">==</span>&nbsp;<span class="ident" id="3149597"><a href="/image/jpeg/reader.go.html#3137313">driMarker</a></span><span class="op" id="3149606">:</span>&nbsp;<span class="comment" id="3149608">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149639"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149643">=</span>&nbsp;<span class="ident" id="3149645"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149646">.</span><span class="ident" id="3149647">processDRI</span><span class="op" id="3149657">(</span><span class="ident" id="3149658"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149663">case</span>&nbsp;<span class="ident" id="3149668"><a href="/image/jpeg/reader.go.html#3137433">app0Marker</a></span>&nbsp;<span class="op" id="3149679">&lt;=</span>&nbsp;<span class="ident" id="3149682"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149689">&amp;&amp;</span>&nbsp;<span class="ident" id="3149692"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149699">&lt;=</span>&nbsp;<span class="ident" id="3149702"><a href="/image/jpeg/reader.go.html#3137482">app15Marker</a></span>&nbsp;<span class="op" id="3149714">||</span>&nbsp;<span class="ident" id="3149717"><a href="/image/jpeg/reader.go.html#3147864">marker</a></span>&nbsp;<span class="op" id="3149724">==</span>&nbsp;<span class="ident" id="3149727"><a href="/image/jpeg/reader.go.html#3137532">comMarker</a></span><span class="op" id="3149736">:</span>&nbsp;<span class="comment" id="3149738">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149778"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149782">=</span>&nbsp;<span class="ident" id="3149784"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149785">.</span><span class="ident" id="3149786">ignore</span><span class="op" id="3149792">(</span><span class="ident" id="3149793"><a href="/image/jpeg/reader.go.html#3149045">n</a></span><span class="op" id="3149794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149798">default</span><span class="op" id="3149805">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149810"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149814">=</span>&nbsp;<span class="ident" id="3149816"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3149832">(</span><span class="string" id="3149833">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="3149849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149857">if</span>&nbsp;<span class="ident" id="3149860"><a href="/image/jpeg/reader.go.html#3146579">err</a></span>&nbsp;<span class="op" id="3149864">!=</span>&nbsp;<span class="ident" id="3149867">nil</span>&nbsp;<span class="op" id="3149871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149876">return</span>&nbsp;<span class="ident" id="3149883">nil</span><span class="op" id="3149886">,</span>&nbsp;<span class="ident" id="3149888"><a href="/image/jpeg/reader.go.html#3146579">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149894">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149900">if</span>&nbsp;<span class="ident" id="3149903"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149904">.</span><span class="ident" id="3149905">img1</span>&nbsp;<span class="op" id="3149910">!=</span>&nbsp;<span class="ident" id="3149913">nil</span>&nbsp;<span class="op" id="3149917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149921">return</span>&nbsp;<span class="ident" id="3149928"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149929">.</span><span class="ident" id="3149930">img1</span><span class="op" id="3149934">,</span>&nbsp;<span class="ident" id="3149936">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149944">if</span>&nbsp;<span class="ident" id="3149947"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149948">.</span><span class="ident" id="3149949">img3</span>&nbsp;<span class="op" id="3149954">!=</span>&nbsp;<span class="ident" id="3149957">nil</span>&nbsp;<span class="op" id="3149961">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149965">return</span>&nbsp;<span class="ident" id="3149972"><a href="/image/jpeg/reader.go.html#3146213">d</a></span><span class="op" id="3149973">.</span><span class="ident" id="3149974">img3</span><span class="op" id="3149978">,</span>&nbsp;<span class="ident" id="3149980">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149988">return</span>&nbsp;<span class="ident" id="3149995">nil</span><span class="op" id="3149998">,</span>&nbsp;<span class="ident" id="3150000"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3150011">(</span><span class="string" id="3150012">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="3150032">)</span><br>
<span class="lineno"></span><span class="op" id="3150034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="3150037">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="3150107">func</span>&nbsp;<span class="ident" id="3150112">Decode</span><span class="op" id="3150118">(</span><span class="ident" id="3150119">r</span>&nbsp;<span class="ident" id="3150121"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3150123">.</span><span class="ident" id="3150124">Reader</span><span class="op" id="3150130">)</span>&nbsp;<span class="op" id="3150132">(</span><span class="ident" id="3150133"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150138">.</span><span class="ident" id="3150139">Image</span><span class="op" id="3150144">,</span>&nbsp;<span class="builtintype" id="3150146">error</span><span class="op" id="3150151">)</span>&nbsp;<span class="op" id="3150153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150156">var</span>&nbsp;<span class="ident" id="3150160">d</span>&nbsp;<span class="ident" id="3150162"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150171">return</span>&nbsp;<span class="ident" id="3150178"><a href="/image/jpeg/reader.go.html#3150160">d</a></span><span class="op" id="3150179">.</span><span class="ident" id="3150180">decode</span><span class="op" id="3150186">(</span><span class="ident" id="3150187"><a href="/image/jpeg/reader.go.html#3150119">r</a></span><span class="op" id="3150188">,</span>&nbsp;<span class="builtintype" id="3150190">false</span><span class="op" id="3150195">)</span><br>
<span class="lineno"></span><span class="op" id="3150197">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3150200">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="3150279">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3150309">func</span>&nbsp;<span class="ident" id="3150314">DecodeConfig</span><span class="op" id="3150326">(</span><span class="ident" id="3150327">r</span>&nbsp;<span class="ident" id="3150329"><a href="/image/jpeg/reader.go.html#3135776">io</a></span><span class="op" id="3150331">.</span><span class="ident" id="3150332">Reader</span><span class="op" id="3150338">)</span>&nbsp;<span class="op" id="3150340">(</span><span class="ident" id="3150341"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150346">.</span><span class="ident" id="3150347">Config</span><span class="op" id="3150353">,</span>&nbsp;<span class="builtintype" id="3150355">error</span><span class="op" id="3150360">)</span>&nbsp;<span class="op" id="3150362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150365">var</span>&nbsp;<span class="ident" id="3150369">d</span>&nbsp;<span class="ident" id="3150371"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150380">if</span>&nbsp;<span class="ident" id="3150383">_</span><span class="op" id="3150384">,</span>&nbsp;<span class="ident" id="3150386">err</span>&nbsp;<span class="op" id="3150390">:=</span>&nbsp;<span class="ident" id="3150393"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150394">.</span><span class="ident" id="3150395">decode</span><span class="op" id="3150401">(</span><span class="ident" id="3150402"><a href="/image/jpeg/reader.go.html#3150327">r</a></span><span class="op" id="3150403">,</span>&nbsp;<span class="builtintype" id="3150405">true</span><span class="op" id="3150409">)</span><span class="op" id="3150410">;</span>&nbsp;<span class="ident" id="3150412"><a href="/image/jpeg/reader.go.html#3150386">err</a></span>&nbsp;<span class="op" id="3150416">!=</span>&nbsp;<span class="ident" id="3150419">nil</span>&nbsp;<span class="op" id="3150423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150427">return</span>&nbsp;<span class="ident" id="3150434"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150439">.</span><span class="ident" id="3150440">Config</span><span class="op" id="3150446">{</span><span class="op" id="3150447">}</span><span class="op" id="3150448">,</span>&nbsp;<span class="ident" id="3150450"><a href="/image/jpeg/reader.go.html#3150386">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150458">switch</span>&nbsp;<span class="ident" id="3150465"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150466">.</span><span class="ident" id="3150467">nComp</span>&nbsp;<span class="op" id="3150473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150476">case</span>&nbsp;<span class="ident" id="3150481"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span><span class="op" id="3150495">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150499">return</span>&nbsp;<span class="ident" id="3150506"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150511">.</span><span class="ident" id="3150512">Config</span><span class="op" id="3150518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150523">ColorModel</span><span class="op" id="3150533">:</span>&nbsp;<span class="ident" id="3150535"><a href="/image/jpeg/reader.go.html#3135761">color</a></span><span class="op" id="3150540">.</span><span class="ident" id="3150541">GrayModel</span><span class="op" id="3150550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150555">Width</span><span class="op" id="3150560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3150567"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150568">.</span><span class="ident" id="3150569">width</span><span class="op" id="3150574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150579">Height</span><span class="op" id="3150585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3150591"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150592">.</span><span class="ident" id="3150593">height</span><span class="op" id="3150599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150603">}</span><span class="op" id="3150604">,</span>&nbsp;<span class="ident" id="3150606">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150611">case</span>&nbsp;<span class="ident" id="3150616"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3150631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150635">return</span>&nbsp;<span class="ident" id="3150642"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150647">.</span><span class="ident" id="3150648">Config</span><span class="op" id="3150654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150659">ColorModel</span><span class="op" id="3150669">:</span>&nbsp;<span class="ident" id="3150671"><a href="/image/jpeg/reader.go.html#3135761">color</a></span><span class="op" id="3150676">.</span><span class="ident" id="3150677">YCbCrModel</span><span class="op" id="3150687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150692">Width</span><span class="op" id="3150697">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3150704"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150705">.</span><span class="ident" id="3150706">width</span><span class="op" id="3150711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150716">Height</span><span class="op" id="3150722">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3150728"><a href="/image/jpeg/reader.go.html#3150369">d</a></span><span class="op" id="3150729">.</span><span class="ident" id="3150730">height</span><span class="op" id="3150736">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150740">}</span><span class="op" id="3150741">,</span>&nbsp;<span class="ident" id="3150743">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150751">return</span>&nbsp;<span class="ident" id="3150758"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150763">.</span><span class="ident" id="3150764">Config</span><span class="op" id="3150770">{</span><span class="op" id="3150771">}</span><span class="op" id="3150772">,</span>&nbsp;<span class="ident" id="3150774"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3150785">(</span><span class="string" id="3150786">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="3150806">)</span><br>
<span class="lineno"></span><span class="op" id="3150808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="3150811">func</span>&nbsp;<span class="ident" id="3150816">init</span><span class="op" id="3150820">(</span><span class="op" id="3150821">)</span>&nbsp;<span class="op" id="3150823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150826"><a href="/image/jpeg/reader.go.html#3135752">image</a></span><span class="op" id="3150831">.</span><span class="ident" id="3150832">RegisterFormat</span><span class="op" id="3150846">(</span><span class="string" id="3150847">&#34;jpeg&#34;</span><span class="op" id="3150853">,</span>&nbsp;<span class="string" id="3150855">&#34;\xff\xd8&#34;</span><span class="op" id="3150865">,</span>&nbsp;<span class="ident" id="3150867"><a href="/image/jpeg/reader.go.html#3150112">Decode</a></span><span class="op" id="3150873">,</span>&nbsp;<span class="ident" id="3150875"><a href="/image/jpeg/reader.go.html#3150314">DecodeConfig</a></span><span class="op" id="3150887">)</span><br>
<span class="lineno"></span><span class="op" id="3150889">}</span>
</div>
</body>
</html>
