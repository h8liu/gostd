<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7308062">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7308117">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7308171">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7308222">package</span>&nbsp;<span class="ident" id="7308230">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7308240">import</span>&nbsp;<span class="op" id="7308247">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7308250">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7308259">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7308269">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7308282">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7308293">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7308315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7308318">func</span>&nbsp;<span class="ident" id="7308323">TestAddParseTree</span><span class="op" id="7308339">(</span><span class="ident" id="7308340">t</span>&nbsp;<span class="op" id="7308342">*</span><span class="ident" id="7308343">testing</span><span class="op" id="7308350">.</span><span class="ident" id="7308351">T</span><span class="op" id="7308352">)</span>&nbsp;<span class="op" id="7308354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308357">root</span>&nbsp;<span class="op" id="7308362">:=</span>&nbsp;<span class="ident" id="7308365">Must</span><span class="op" id="7308369">(</span><span class="ident" id="7308370">New</span><span class="op" id="7308373">(</span><span class="string" id="7308374">&#34;root&#34;</span><span class="op" id="7308380">)</span><span class="op" id="7308381">.</span><span class="ident" id="7308382">Parse</span><span class="op" id="7308387">(</span><span class="string" id="7308388">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7308447">)</span><span class="op" id="7308448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308451">tree</span><span class="op" id="7308455">,</span>&nbsp;<span class="ident" id="7308457">err</span>&nbsp;<span class="op" id="7308461">:=</span>&nbsp;<span class="ident" id="7308464">parse</span><span class="op" id="7308469">.</span><span class="ident" id="7308470">Parse</span><span class="op" id="7308475">(</span><span class="string" id="7308476">&#34;t&#34;</span><span class="op" id="7308479">,</span>&nbsp;<span class="string" id="7308481">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7308513">,</span>&nbsp;<span class="string" id="7308515">&#34;&#34;</span><span class="op" id="7308517">,</span>&nbsp;<span class="string" id="7308519">&#34;&#34;</span><span class="op" id="7308521">,</span>&nbsp;<span class="ident" id="7308523">nil</span><span class="op" id="7308526">,</span>&nbsp;<span class="ident" id="7308528">nil</span><span class="op" id="7308531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7308534">if</span>&nbsp;<span class="ident" id="7308537">err</span>&nbsp;<span class="op" id="7308541">!=</span>&nbsp;<span class="ident" id="7308544">nil</span>&nbsp;<span class="op" id="7308548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308552">t</span><span class="op" id="7308553">.</span><span class="ident" id="7308554">Fatal</span><span class="op" id="7308559">(</span><span class="ident" id="7308560">err</span><span class="op" id="7308563">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7308566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308569">added</span>&nbsp;<span class="op" id="7308575">:=</span>&nbsp;<span class="ident" id="7308578">Must</span><span class="op" id="7308582">(</span><span class="ident" id="7308583">root</span><span class="op" id="7308587">.</span><span class="ident" id="7308588">AddParseTree</span><span class="op" id="7308600">(</span><span class="string" id="7308601">&#34;b&#34;</span><span class="op" id="7308604">,</span>&nbsp;<span class="ident" id="7308606">tree</span><span class="op" id="7308610">[</span><span class="string" id="7308611">&#34;b&#34;</span><span class="op" id="7308614">]</span><span class="op" id="7308615">)</span><span class="op" id="7308616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308619">b</span>&nbsp;<span class="op" id="7308621">:=</span>&nbsp;<span class="builtinfunc" id="7308624">new</span><span class="op" id="7308627">(</span><span class="ident" id="7308628">bytes</span><span class="op" id="7308633">.</span><span class="ident" id="7308634">Buffer</span><span class="op" id="7308640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308643">err</span>&nbsp;<span class="op" id="7308647">=</span>&nbsp;<span class="ident" id="7308649">added</span><span class="op" id="7308654">.</span><span class="ident" id="7308655">ExecuteTemplate</span><span class="op" id="7308670">(</span><span class="ident" id="7308671">b</span><span class="op" id="7308672">,</span>&nbsp;<span class="string" id="7308674">&#34;a&#34;</span><span class="op" id="7308677">,</span>&nbsp;<span class="string" id="7308679">&#34;1&gt;0&#34;</span><span class="op" id="7308684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7308687">if</span>&nbsp;<span class="ident" id="7308690">err</span>&nbsp;<span class="op" id="7308694">!=</span>&nbsp;<span class="ident" id="7308697">nil</span>&nbsp;<span class="op" id="7308701">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308705">t</span><span class="op" id="7308706">.</span><span class="ident" id="7308707">Fatal</span><span class="op" id="7308712">(</span><span class="ident" id="7308713">err</span><span class="op" id="7308716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7308719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7308722">if</span>&nbsp;<span class="ident" id="7308725">got</span><span class="op" id="7308728">,</span>&nbsp;<span class="ident" id="7308730">want</span>&nbsp;<span class="op" id="7308735">:=</span>&nbsp;<span class="ident" id="7308738">b</span><span class="op" id="7308739">.</span><span class="ident" id="7308740">String</span><span class="op" id="7308746">(</span><span class="op" id="7308747">)</span><span class="op" id="7308748">,</span>&nbsp;<span class="string" id="7308750">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7308782">;</span>&nbsp;<span class="ident" id="7308784">got</span>&nbsp;<span class="op" id="7308788">!=</span>&nbsp;<span class="ident" id="7308791">want</span>&nbsp;<span class="op" id="7308796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7308800">t</span><span class="op" id="7308801">.</span><span class="ident" id="7308802">Errorf</span><span class="op" id="7308808">(</span><span class="string" id="7308809">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7308825">,</span>&nbsp;<span class="ident" id="7308827">got</span><span class="op" id="7308830">,</span>&nbsp;<span class="ident" id="7308832">want</span><span class="op" id="7308836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7308839">}</span><br>
<span class="lineno">30</span><span class="op" id="7308841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7308844">func</span>&nbsp;<span class="ident" id="7308849">TestClone</span><span class="op" id="7308858">(</span><span class="ident" id="7308859">t</span>&nbsp;<span class="op" id="7308861">*</span><span class="ident" id="7308862">testing</span><span class="op" id="7308869">.</span><span class="ident" id="7308870">T</span><span class="op" id="7308871">)</span>&nbsp;<span class="op" id="7308873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7308876">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7308948">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309002">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309055">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309115">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7309168">const</span>&nbsp;<span class="ident" id="7309174">tmpl</span>&nbsp;<span class="op" id="7309179">=</span>&nbsp;<span class="string" id="7309181">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309247">b</span>&nbsp;<span class="op" id="7309249">:=</span>&nbsp;<span class="builtinfunc" id="7309252">new</span><span class="op" id="7309255">(</span><span class="ident" id="7309256">bytes</span><span class="op" id="7309261">.</span><span class="ident" id="7309262">Buffer</span><span class="op" id="7309268">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309272">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309310">t0</span>&nbsp;<span class="op" id="7309313">:=</span>&nbsp;<span class="ident" id="7309316">Must</span><span class="op" id="7309320">(</span><span class="ident" id="7309321">New</span><span class="op" id="7309324">(</span><span class="string" id="7309325">&#34;t0&#34;</span><span class="op" id="7309329">)</span><span class="op" id="7309330">.</span><span class="ident" id="7309331">Parse</span><span class="op" id="7309336">(</span><span class="ident" id="7309337">tmpl</span><span class="op" id="7309341">)</span><span class="op" id="7309342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309346">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309366">t1</span>&nbsp;<span class="op" id="7309369">:=</span>&nbsp;<span class="ident" id="7309372">Must</span><span class="op" id="7309376">(</span><span class="ident" id="7309377">t0</span><span class="op" id="7309379">.</span><span class="ident" id="7309380">Clone</span><span class="op" id="7309385">(</span><span class="op" id="7309386">)</span><span class="op" id="7309387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309390">Must</span><span class="op" id="7309394">(</span><span class="ident" id="7309395">t1</span><span class="op" id="7309397">.</span><span class="ident" id="7309398">Parse</span><span class="op" id="7309403">(</span><span class="string" id="7309404">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7309440">)</span><span class="op" id="7309441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309444">Must</span><span class="op" id="7309448">(</span><span class="ident" id="7309449">t1</span><span class="op" id="7309451">.</span><span class="ident" id="7309452">Parse</span><span class="op" id="7309457">(</span><span class="string" id="7309458">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7309491">)</span><span class="op" id="7309492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309496">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309512">b</span><span class="op" id="7309513">.</span><span class="ident" id="7309514">Reset</span><span class="op" id="7309519">(</span><span class="op" id="7309520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7309523">if</span>&nbsp;<span class="ident" id="7309526">err</span>&nbsp;<span class="op" id="7309530">:=</span>&nbsp;<span class="ident" id="7309533">t1</span><span class="op" id="7309535">.</span><span class="ident" id="7309536">ExecuteTemplate</span><span class="op" id="7309551">(</span><span class="ident" id="7309552">b</span><span class="op" id="7309553">,</span>&nbsp;<span class="string" id="7309555">&#34;a&#34;</span><span class="op" id="7309558">,</span>&nbsp;<span class="string" id="7309560">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7309567">)</span><span class="op" id="7309568">;</span>&nbsp;<span class="ident" id="7309570">err</span>&nbsp;<span class="op" id="7309574">!=</span>&nbsp;<span class="ident" id="7309577">nil</span>&nbsp;<span class="op" id="7309581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309585">t</span><span class="op" id="7309586">.</span><span class="ident" id="7309587">Fatal</span><span class="op" id="7309592">(</span><span class="ident" id="7309593">err</span><span class="op" id="7309596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7309599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7309602">if</span>&nbsp;<span class="ident" id="7309605">got</span><span class="op" id="7309608">,</span>&nbsp;<span class="ident" id="7309610">want</span>&nbsp;<span class="op" id="7309615">:=</span>&nbsp;<span class="ident" id="7309618">b</span><span class="op" id="7309619">.</span><span class="ident" id="7309620">String</span><span class="op" id="7309626">(</span><span class="op" id="7309627">)</span><span class="op" id="7309628">,</span>&nbsp;<span class="string" id="7309630">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7309660">;</span>&nbsp;<span class="ident" id="7309662">got</span>&nbsp;<span class="op" id="7309666">!=</span>&nbsp;<span class="ident" id="7309669">want</span>&nbsp;<span class="op" id="7309674">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309678">t</span><span class="op" id="7309679">.</span><span class="ident" id="7309680">Errorf</span><span class="op" id="7309686">(</span><span class="string" id="7309687">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7309707">,</span>&nbsp;<span class="ident" id="7309709">got</span><span class="op" id="7309712">,</span>&nbsp;<span class="ident" id="7309714">want</span><span class="op" id="7309718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7309721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309725">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309745">t2</span>&nbsp;<span class="op" id="7309748">:=</span>&nbsp;<span class="ident" id="7309751">Must</span><span class="op" id="7309755">(</span><span class="ident" id="7309756">t0</span><span class="op" id="7309758">.</span><span class="ident" id="7309759">Clone</span><span class="op" id="7309764">(</span><span class="op" id="7309765">)</span><span class="op" id="7309766">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309769">Must</span><span class="op" id="7309773">(</span><span class="ident" id="7309774">t2</span><span class="op" id="7309776">.</span><span class="ident" id="7309777">Parse</span><span class="op" id="7309782">(</span><span class="string" id="7309783">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7309833">)</span><span class="op" id="7309834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309837">Must</span><span class="op" id="7309841">(</span><span class="ident" id="7309842">t2</span><span class="op" id="7309844">.</span><span class="ident" id="7309845">Parse</span><span class="op" id="7309850">(</span><span class="string" id="7309851">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7309884">)</span><span class="op" id="7309885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7309889">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309905">b</span><span class="op" id="7309906">.</span><span class="ident" id="7309907">Reset</span><span class="op" id="7309912">(</span><span class="op" id="7309913">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7309916">if</span>&nbsp;<span class="ident" id="7309919">err</span>&nbsp;<span class="op" id="7309923">:=</span>&nbsp;<span class="ident" id="7309926">t2</span><span class="op" id="7309928">.</span><span class="ident" id="7309929">ExecuteTemplate</span><span class="op" id="7309944">(</span><span class="ident" id="7309945">b</span><span class="op" id="7309946">,</span>&nbsp;<span class="string" id="7309948">&#34;a&#34;</span><span class="op" id="7309951">,</span>&nbsp;<span class="string" id="7309953">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7309960">)</span><span class="op" id="7309961">;</span>&nbsp;<span class="ident" id="7309963">err</span>&nbsp;<span class="op" id="7309967">!=</span>&nbsp;<span class="ident" id="7309970">nil</span>&nbsp;<span class="op" id="7309974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7309978">t</span><span class="op" id="7309979">.</span><span class="ident" id="7309980">Fatal</span><span class="op" id="7309985">(</span><span class="ident" id="7309986">err</span><span class="op" id="7309989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7309992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7309995">if</span>&nbsp;<span class="ident" id="7309998">got</span><span class="op" id="7310001">,</span>&nbsp;<span class="ident" id="7310003">want</span>&nbsp;<span class="op" id="7310008">:=</span>&nbsp;<span class="ident" id="7310011">b</span><span class="op" id="7310012">.</span><span class="ident" id="7310013">String</span><span class="op" id="7310019">(</span><span class="op" id="7310020">)</span><span class="op" id="7310021">,</span>&nbsp;<span class="string" id="7310023">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7310083">;</span>&nbsp;<span class="ident" id="7310085">got</span>&nbsp;<span class="op" id="7310089">!=</span>&nbsp;<span class="ident" id="7310092">want</span>&nbsp;<span class="op" id="7310097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310101">t</span><span class="op" id="7310102">.</span><span class="ident" id="7310103">Errorf</span><span class="op" id="7310109">(</span><span class="string" id="7310110">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7310130">,</span>&nbsp;<span class="ident" id="7310132">got</span><span class="op" id="7310135">,</span>&nbsp;<span class="ident" id="7310137">want</span><span class="op" id="7310141">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7310144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7310148">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310195">t3</span>&nbsp;<span class="op" id="7310198">:=</span>&nbsp;<span class="ident" id="7310201">Must</span><span class="op" id="7310205">(</span><span class="ident" id="7310206">t0</span><span class="op" id="7310208">.</span><span class="ident" id="7310209">Clone</span><span class="op" id="7310214">(</span><span class="op" id="7310215">)</span><span class="op" id="7310216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310219">Must</span><span class="op" id="7310223">(</span><span class="ident" id="7310224">t3</span><span class="op" id="7310226">.</span><span class="ident" id="7310227">Parse</span><span class="op" id="7310232">(</span><span class="string" id="7310233">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7310267">)</span><span class="op" id="7310268">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310271">Must</span><span class="op" id="7310275">(</span><span class="ident" id="7310276">t3</span><span class="op" id="7310278">.</span><span class="ident" id="7310279">Parse</span><span class="op" id="7310284">(</span><span class="string" id="7310285">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7310320">)</span><span class="op" id="7310321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7310325">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310342">Must</span><span class="op" id="7310346">(</span><span class="ident" id="7310347">t0</span><span class="op" id="7310349">.</span><span class="ident" id="7310350">Parse</span><span class="op" id="7310355">(</span><span class="string" id="7310356">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7310384">)</span><span class="op" id="7310385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310388">Must</span><span class="op" id="7310392">(</span><span class="ident" id="7310393">t0</span><span class="op" id="7310395">.</span><span class="ident" id="7310396">Parse</span><span class="op" id="7310401">(</span><span class="string" id="7310402">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7310430">)</span><span class="op" id="7310431">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7310435">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310498">t4</span>&nbsp;<span class="op" id="7310501">:=</span>&nbsp;<span class="ident" id="7310504">Must</span><span class="op" id="7310508">(</span><span class="ident" id="7310509">t0</span><span class="op" id="7310511">.</span><span class="ident" id="7310512">Clone</span><span class="op" id="7310517">(</span><span class="op" id="7310518">)</span><span class="op" id="7310519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7310522">if</span>&nbsp;<span class="ident" id="7310525">_</span><span class="op" id="7310526">,</span>&nbsp;<span class="ident" id="7310528">err</span>&nbsp;<span class="op" id="7310532">:=</span>&nbsp;<span class="ident" id="7310535">t4</span><span class="op" id="7310537">.</span><span class="ident" id="7310538">Parse</span><span class="op" id="7310543">(</span><span class="string" id="7310544">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7310575">)</span><span class="op" id="7310576">;</span>&nbsp;<span class="ident" id="7310578">err</span>&nbsp;<span class="op" id="7310582">==</span>&nbsp;<span class="ident" id="7310585">nil</span>&nbsp;<span class="op" id="7310589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310593">t</span><span class="op" id="7310594">.</span><span class="ident" id="7310595">Error</span><span class="op" id="7310600">(</span><span class="string" id="7310601">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7310643">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7310646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7310650">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310666">b</span><span class="op" id="7310667">.</span><span class="ident" id="7310668">Reset</span><span class="op" id="7310673">(</span><span class="op" id="7310674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7310677">if</span>&nbsp;<span class="ident" id="7310680">err</span>&nbsp;<span class="op" id="7310684">:=</span>&nbsp;<span class="ident" id="7310687">t0</span><span class="op" id="7310689">.</span><span class="ident" id="7310690">ExecuteTemplate</span><span class="op" id="7310705">(</span><span class="ident" id="7310706">b</span><span class="op" id="7310707">,</span>&nbsp;<span class="string" id="7310709">&#34;a&#34;</span><span class="op" id="7310712">,</span>&nbsp;<span class="string" id="7310714">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7310721">)</span><span class="op" id="7310722">;</span>&nbsp;<span class="ident" id="7310724">err</span>&nbsp;<span class="op" id="7310728">!=</span>&nbsp;<span class="ident" id="7310731">nil</span>&nbsp;<span class="op" id="7310735">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310739">t</span><span class="op" id="7310740">.</span><span class="ident" id="7310741">Fatal</span><span class="op" id="7310746">(</span><span class="ident" id="7310747">err</span><span class="op" id="7310750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7310753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7310756">if</span>&nbsp;<span class="ident" id="7310759">got</span><span class="op" id="7310762">,</span>&nbsp;<span class="ident" id="7310764">want</span>&nbsp;<span class="op" id="7310769">:=</span>&nbsp;<span class="ident" id="7310772">b</span><span class="op" id="7310773">.</span><span class="ident" id="7310774">String</span><span class="op" id="7310780">(</span><span class="op" id="7310781">)</span><span class="op" id="7310782">,</span>&nbsp;<span class="string" id="7310784">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7310803">;</span>&nbsp;<span class="ident" id="7310805">got</span>&nbsp;<span class="op" id="7310809">!=</span>&nbsp;<span class="ident" id="7310812">want</span>&nbsp;<span class="op" id="7310817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310821">t</span><span class="op" id="7310822">.</span><span class="ident" id="7310823">Errorf</span><span class="op" id="7310829">(</span><span class="string" id="7310830">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7310850">,</span>&nbsp;<span class="ident" id="7310852">got</span><span class="op" id="7310855">,</span>&nbsp;<span class="ident" id="7310857">want</span><span class="op" id="7310861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7310864">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7310868">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7310928">if</span>&nbsp;<span class="ident" id="7310931">_</span><span class="op" id="7310932">,</span>&nbsp;<span class="ident" id="7310934">err</span>&nbsp;<span class="op" id="7310938">:=</span>&nbsp;<span class="ident" id="7310941">t0</span><span class="op" id="7310943">.</span><span class="ident" id="7310944">Clone</span><span class="op" id="7310949">(</span><span class="op" id="7310950">)</span><span class="op" id="7310951">;</span>&nbsp;<span class="ident" id="7310953">err</span>&nbsp;<span class="op" id="7310957">==</span>&nbsp;<span class="ident" id="7310960">nil</span>&nbsp;<span class="op" id="7310964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7310968">t</span><span class="op" id="7310969">.</span><span class="ident" id="7310970">Error</span><span class="op" id="7310975">(</span><span class="string" id="7310976">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7311014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311017">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7311021">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311071">if</span>&nbsp;<span class="ident" id="7311074">_</span><span class="op" id="7311075">,</span>&nbsp;<span class="ident" id="7311077">err</span>&nbsp;<span class="op" id="7311081">:=</span>&nbsp;<span class="ident" id="7311084">t0</span><span class="op" id="7311086">.</span><span class="ident" id="7311087">Lookup</span><span class="op" id="7311093">(</span><span class="string" id="7311094">&#34;a&#34;</span><span class="op" id="7311097">)</span><span class="op" id="7311098">.</span><span class="ident" id="7311099">Clone</span><span class="op" id="7311104">(</span><span class="op" id="7311105">)</span><span class="op" id="7311106">;</span>&nbsp;<span class="ident" id="7311108">err</span>&nbsp;<span class="op" id="7311112">==</span>&nbsp;<span class="ident" id="7311115">nil</span>&nbsp;<span class="op" id="7311119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311123">t</span><span class="op" id="7311124">.</span><span class="ident" id="7311125">Error</span><span class="op" id="7311130">(</span><span class="string" id="7311131">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7311181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311184">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311187">if</span>&nbsp;<span class="ident" id="7311190">_</span><span class="op" id="7311191">,</span>&nbsp;<span class="ident" id="7311193">err</span>&nbsp;<span class="op" id="7311197">:=</span>&nbsp;<span class="ident" id="7311200">t0</span><span class="op" id="7311202">.</span><span class="ident" id="7311203">Lookup</span><span class="op" id="7311209">(</span><span class="string" id="7311210">&#34;lhs&#34;</span><span class="op" id="7311215">)</span><span class="op" id="7311216">.</span><span class="ident" id="7311217">Clone</span><span class="op" id="7311222">(</span><span class="op" id="7311223">)</span><span class="op" id="7311224">;</span>&nbsp;<span class="ident" id="7311226">err</span>&nbsp;<span class="op" id="7311230">==</span>&nbsp;<span class="ident" id="7311233">nil</span>&nbsp;<span class="op" id="7311237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311241">t</span><span class="op" id="7311242">.</span><span class="ident" id="7311243">Error</span><span class="op" id="7311248">(</span><span class="string" id="7311249">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7311301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7311308">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311324">b</span><span class="op" id="7311325">.</span><span class="ident" id="7311326">Reset</span><span class="op" id="7311331">(</span><span class="op" id="7311332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311335">if</span>&nbsp;<span class="ident" id="7311338">err</span>&nbsp;<span class="op" id="7311342">:=</span>&nbsp;<span class="ident" id="7311345">t3</span><span class="op" id="7311347">.</span><span class="ident" id="7311348">ExecuteTemplate</span><span class="op" id="7311363">(</span><span class="ident" id="7311364">b</span><span class="op" id="7311365">,</span>&nbsp;<span class="string" id="7311367">&#34;a&#34;</span><span class="op" id="7311370">,</span>&nbsp;<span class="string" id="7311372">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7311379">)</span><span class="op" id="7311380">;</span>&nbsp;<span class="ident" id="7311382">err</span>&nbsp;<span class="op" id="7311386">!=</span>&nbsp;<span class="ident" id="7311389">nil</span>&nbsp;<span class="op" id="7311393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311397">t</span><span class="op" id="7311398">.</span><span class="ident" id="7311399">Fatal</span><span class="op" id="7311404">(</span><span class="ident" id="7311405">err</span><span class="op" id="7311408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311414">if</span>&nbsp;<span class="ident" id="7311417">got</span><span class="op" id="7311420">,</span>&nbsp;<span class="ident" id="7311422">want</span>&nbsp;<span class="op" id="7311427">:=</span>&nbsp;<span class="ident" id="7311430">b</span><span class="op" id="7311431">.</span><span class="ident" id="7311432">String</span><span class="op" id="7311438">(</span><span class="op" id="7311439">)</span><span class="op" id="7311440">,</span>&nbsp;<span class="string" id="7311442">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7311471">;</span>&nbsp;<span class="ident" id="7311473">got</span>&nbsp;<span class="op" id="7311477">!=</span>&nbsp;<span class="ident" id="7311480">want</span>&nbsp;<span class="op" id="7311485">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311489">t</span><span class="op" id="7311490">.</span><span class="ident" id="7311491">Errorf</span><span class="op" id="7311497">(</span><span class="string" id="7311498">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7311518">,</span>&nbsp;<span class="ident" id="7311520">got</span><span class="op" id="7311523">,</span>&nbsp;<span class="ident" id="7311525">want</span><span class="op" id="7311529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311532">}</span><br>
<span class="lineno"></span><span class="op" id="7311534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7311537">func</span>&nbsp;<span class="ident" id="7311542">TestTemplates</span><span class="op" id="7311555">(</span><span class="ident" id="7311556">t</span>&nbsp;<span class="op" id="7311558">*</span><span class="ident" id="7311559">testing</span><span class="op" id="7311566">.</span><span class="ident" id="7311567">T</span><span class="op" id="7311568">)</span>&nbsp;<span class="op" id="7311570">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311573">names</span>&nbsp;<span class="op" id="7311579">:=</span>&nbsp;<span class="op" id="7311582">[</span><span class="op" id="7311583">]</span><span class="builtintype" id="7311584">string</span><span class="op" id="7311590">{</span><span class="string" id="7311591">&#34;t0&#34;</span><span class="op" id="7311595">,</span>&nbsp;<span class="string" id="7311597">&#34;a&#34;</span><span class="op" id="7311600">,</span>&nbsp;<span class="string" id="7311602">&#34;lhs&#34;</span><span class="op" id="7311607">,</span>&nbsp;<span class="string" id="7311609">&#34;rhs&#34;</span><span class="op" id="7311614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7311617">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311672">const</span>&nbsp;<span class="ident" id="7311678">tmpl</span>&nbsp;<span class="op" id="7311683">=</span>&nbsp;<span class="string" id="7311685">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311825">t0</span>&nbsp;<span class="op" id="7311828">:=</span>&nbsp;<span class="ident" id="7311831">Must</span><span class="op" id="7311835">(</span><span class="ident" id="7311836">New</span><span class="op" id="7311839">(</span><span class="string" id="7311840">&#34;t0&#34;</span><span class="op" id="7311844">)</span><span class="op" id="7311845">.</span><span class="ident" id="7311846">Parse</span><span class="op" id="7311851">(</span><span class="ident" id="7311852">tmpl</span><span class="op" id="7311856">)</span><span class="op" id="7311857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311860">templates</span>&nbsp;<span class="op" id="7311870">:=</span>&nbsp;<span class="ident" id="7311873">t0</span><span class="op" id="7311875">.</span><span class="ident" id="7311876">Templates</span><span class="op" id="7311885">(</span><span class="op" id="7311886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311889">if</span>&nbsp;<span class="builtinfunc" id="7311892">len</span><span class="op" id="7311895">(</span><span class="ident" id="7311896">templates</span><span class="op" id="7311905">)</span>&nbsp;<span class="op" id="7311907">!=</span>&nbsp;<span class="builtinfunc" id="7311910">len</span><span class="op" id="7311913">(</span><span class="ident" id="7311914">names</span><span class="op" id="7311919">)</span>&nbsp;<span class="op" id="7311921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7311925">t</span><span class="op" id="7311926">.</span><span class="ident" id="7311927">Errorf</span><span class="op" id="7311933">(</span><span class="string" id="7311934">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7311965">,</span>&nbsp;<span class="builtinfunc" id="7311967">len</span><span class="op" id="7311970">(</span><span class="ident" id="7311971">names</span><span class="op" id="7311976">)</span><span class="op" id="7311977">,</span>&nbsp;<span class="builtinfunc" id="7311979">len</span><span class="op" id="7311982">(</span><span class="ident" id="7311983">templates</span><span class="op" id="7311992">)</span><span class="op" id="7311993">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7311996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7311999">for</span>&nbsp;<span class="ident" id="7312003">_</span><span class="op" id="7312004">,</span>&nbsp;<span class="ident" id="7312006">name</span>&nbsp;<span class="op" id="7312011">:=</span>&nbsp;<span class="keyword" id="7312014">range</span>&nbsp;<span class="ident" id="7312020">names</span>&nbsp;<span class="op" id="7312026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312030">found</span>&nbsp;<span class="op" id="7312036">:=</span>&nbsp;<span class="builtintype" id="7312039">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312047">for</span>&nbsp;<span class="ident" id="7312051">_</span><span class="op" id="7312052">,</span>&nbsp;<span class="ident" id="7312054">tmpl</span>&nbsp;<span class="op" id="7312059">:=</span>&nbsp;<span class="keyword" id="7312062">range</span>&nbsp;<span class="ident" id="7312068">templates</span>&nbsp;<span class="op" id="7312078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312083">if</span>&nbsp;<span class="ident" id="7312086">name</span>&nbsp;<span class="op" id="7312091">==</span>&nbsp;<span class="ident" id="7312094">tmpl</span><span class="op" id="7312098">.</span><span class="ident" id="7312099">text</span><span class="op" id="7312103">.</span><span class="ident" id="7312104">Name</span><span class="op" id="7312108">(</span><span class="op" id="7312109">)</span>&nbsp;<span class="op" id="7312111">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312117">found</span>&nbsp;<span class="op" id="7312123">=</span>&nbsp;<span class="builtintype" id="7312125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312134">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7312143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7312147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312151">if</span>&nbsp;<span class="op" id="7312154">!</span><span class="ident" id="7312155">found</span>&nbsp;<span class="op" id="7312161">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312166">t</span><span class="op" id="7312167">.</span><span class="ident" id="7312168">Error</span><span class="op" id="7312173">(</span><span class="string" id="7312174">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7312199">,</span>&nbsp;<span class="ident" id="7312201">name</span><span class="op" id="7312205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7312209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7312212">}</span><br>
<span class="lineno"></span><span class="op" id="7312214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7312217">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7312269">func</span>&nbsp;<span class="ident" id="7312274">TestCloneCrash</span><span class="op" id="7312288">(</span><span class="ident" id="7312289">t</span>&nbsp;<span class="op" id="7312291">*</span><span class="ident" id="7312292">testing</span><span class="op" id="7312299">.</span><span class="ident" id="7312300">T</span><span class="op" id="7312301">)</span>&nbsp;<span class="op" id="7312303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312306">t1</span>&nbsp;<span class="op" id="7312309">:=</span>&nbsp;<span class="ident" id="7312312">New</span><span class="op" id="7312315">(</span><span class="string" id="7312316">&#34;all&#34;</span><span class="op" id="7312321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312324">Must</span><span class="op" id="7312328">(</span><span class="ident" id="7312329">t1</span><span class="op" id="7312331">.</span><span class="ident" id="7312332">New</span><span class="op" id="7312335">(</span><span class="string" id="7312336">&#34;t1&#34;</span><span class="op" id="7312340">)</span><span class="op" id="7312341">.</span><span class="ident" id="7312342">Parse</span><span class="op" id="7312347">(</span><span class="string" id="7312348">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7312376">)</span><span class="op" id="7312377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312380">t1</span><span class="op" id="7312382">.</span><span class="ident" id="7312383">Clone</span><span class="op" id="7312388">(</span><span class="op" id="7312389">)</span><br>
<span class="lineno">150</span><span class="op" id="7312391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7312394">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7312449">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7312507">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7312548">func</span>&nbsp;<span class="ident" id="7312553">TestCloneThenParse</span><span class="op" id="7312571">(</span><span class="ident" id="7312572">t</span>&nbsp;<span class="op" id="7312574">*</span><span class="ident" id="7312575">testing</span><span class="op" id="7312582">.</span><span class="ident" id="7312583">T</span><span class="op" id="7312584">)</span>&nbsp;<span class="op" id="7312586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312589">t0</span>&nbsp;<span class="op" id="7312592">:=</span>&nbsp;<span class="ident" id="7312595">Must</span><span class="op" id="7312599">(</span><span class="ident" id="7312600">New</span><span class="op" id="7312603">(</span><span class="string" id="7312604">&#34;t0&#34;</span><span class="op" id="7312608">)</span><span class="op" id="7312609">.</span><span class="ident" id="7312610">Parse</span><span class="op" id="7312615">(</span><span class="string" id="7312616">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7312662">)</span><span class="op" id="7312663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312666">t1</span>&nbsp;<span class="op" id="7312669">:=</span>&nbsp;<span class="ident" id="7312672">Must</span><span class="op" id="7312676">(</span><span class="ident" id="7312677">t0</span><span class="op" id="7312679">.</span><span class="ident" id="7312680">Clone</span><span class="op" id="7312685">(</span><span class="op" id="7312686">)</span><span class="op" id="7312687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312690">Must</span><span class="op" id="7312694">(</span><span class="ident" id="7312695">t1</span><span class="op" id="7312697">.</span><span class="ident" id="7312698">Parse</span><span class="op" id="7312703">(</span><span class="string" id="7312704">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7312736">)</span><span class="op" id="7312737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312740">if</span>&nbsp;<span class="builtinfunc" id="7312743">len</span><span class="op" id="7312746">(</span><span class="ident" id="7312747">t0</span><span class="op" id="7312749">.</span><span class="ident" id="7312750">Templates</span><span class="op" id="7312759">(</span><span class="op" id="7312760">)</span><span class="op" id="7312761">)</span><span class="op" id="7312762">+</span><span class="num" id="7312763">1</span>&nbsp;<span class="op" id="7312765">!=</span>&nbsp;<span class="builtinfunc" id="7312768">len</span><span class="op" id="7312771">(</span><span class="ident" id="7312772">t1</span><span class="op" id="7312774">.</span><span class="ident" id="7312775">Templates</span><span class="op" id="7312784">(</span><span class="op" id="7312785">)</span><span class="op" id="7312786">)</span>&nbsp;<span class="op" id="7312788">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312792">t</span><span class="op" id="7312793">.</span><span class="ident" id="7312794">Error</span><span class="op" id="7312799">(</span><span class="string" id="7312800">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7312855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7312858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7312861">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7312937">err</span>&nbsp;<span class="op" id="7312941">:=</span>&nbsp;<span class="ident" id="7312944">t0</span><span class="op" id="7312946">.</span><span class="ident" id="7312947">ExecuteTemplate</span><span class="op" id="7312962">(</span><span class="ident" id="7312963">ioutil</span><span class="op" id="7312969">.</span><span class="ident" id="7312970">Discard</span><span class="op" id="7312977">,</span>&nbsp;<span class="string" id="7312979">&#34;a&#34;</span><span class="op" id="7312982">,</span>&nbsp;<span class="ident" id="7312984">nil</span><span class="op" id="7312987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7312990">if</span>&nbsp;<span class="ident" id="7312993">err</span>&nbsp;<span class="op" id="7312997">==</span>&nbsp;<span class="ident" id="7313000">nil</span>&nbsp;<span class="op" id="7313004">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313008">t</span><span class="op" id="7313009">.</span><span class="ident" id="7313010">Error</span><span class="op" id="7313015">(</span><span class="string" id="7313016">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7313051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7313054">}</span><br>
<span class="lineno"></span><span class="op" id="7313056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7313059">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7313113">func</span>&nbsp;<span class="ident" id="7313118">TestFuncMapWorksAfterClone</span><span class="op" id="7313144">(</span><span class="ident" id="7313145">t</span>&nbsp;<span class="op" id="7313147">*</span><span class="ident" id="7313148">testing</span><span class="op" id="7313155">.</span><span class="ident" id="7313156">T</span><span class="op" id="7313157">)</span>&nbsp;<span class="op" id="7313159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313162">funcs</span>&nbsp;<span class="op" id="7313168">:=</span>&nbsp;<span class="ident" id="7313171">FuncMap</span><span class="op" id="7313178">{</span><span class="string" id="7313179">&#34;customFunc&#34;</span><span class="op" id="7313191">:</span>&nbsp;<span class="keyword" id="7313193">func</span><span class="op" id="7313197">(</span><span class="op" id="7313198">)</span>&nbsp;<span class="op" id="7313200">(</span><span class="builtintype" id="7313201">string</span><span class="op" id="7313207">,</span>&nbsp;<span class="builtintype" id="7313209">error</span><span class="op" id="7313214">)</span>&nbsp;<span class="op" id="7313216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7313220">return</span>&nbsp;<span class="string" id="7313227">&#34;&#34;</span><span class="op" id="7313229">,</span>&nbsp;<span class="ident" id="7313231">errors</span><span class="op" id="7313237">.</span><span class="ident" id="7313238">New</span><span class="op" id="7313241">(</span><span class="string" id="7313242">&#34;issue5980&#34;</span><span class="op" id="7313253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7313256">}</span><span class="op" id="7313257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7313261">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313306">uncloned</span>&nbsp;<span class="op" id="7313315">:=</span>&nbsp;<span class="ident" id="7313318">Must</span><span class="op" id="7313322">(</span><span class="ident" id="7313323">New</span><span class="op" id="7313326">(</span><span class="string" id="7313327">&#34;&#34;</span><span class="op" id="7313329">)</span><span class="op" id="7313330">.</span><span class="ident" id="7313331">Funcs</span><span class="op" id="7313336">(</span><span class="ident" id="7313337">funcs</span><span class="op" id="7313342">)</span><span class="op" id="7313343">.</span><span class="ident" id="7313344">Parse</span><span class="op" id="7313349">(</span><span class="string" id="7313350">&#34;{{customFunc}}&#34;</span><span class="op" id="7313366">)</span><span class="op" id="7313367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313370">wantErr</span>&nbsp;<span class="op" id="7313378">:=</span>&nbsp;<span class="ident" id="7313381">uncloned</span><span class="op" id="7313389">.</span><span class="ident" id="7313390">Execute</span><span class="op" id="7313397">(</span><span class="ident" id="7313398">ioutil</span><span class="op" id="7313404">.</span><span class="ident" id="7313405">Discard</span><span class="op" id="7313412">,</span>&nbsp;<span class="ident" id="7313414">nil</span><span class="op" id="7313417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7313421">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7313500">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313548">toClone</span>&nbsp;<span class="op" id="7313556">:=</span>&nbsp;<span class="ident" id="7313559">Must</span><span class="op" id="7313563">(</span><span class="ident" id="7313564">New</span><span class="op" id="7313567">(</span><span class="string" id="7313568">&#34;&#34;</span><span class="op" id="7313570">)</span><span class="op" id="7313571">.</span><span class="ident" id="7313572">Funcs</span><span class="op" id="7313577">(</span><span class="ident" id="7313578">funcs</span><span class="op" id="7313583">)</span><span class="op" id="7313584">.</span><span class="ident" id="7313585">Parse</span><span class="op" id="7313590">(</span><span class="string" id="7313591">&#34;{{customFunc}}&#34;</span><span class="op" id="7313607">)</span><span class="op" id="7313608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313611">cloned</span>&nbsp;<span class="op" id="7313618">:=</span>&nbsp;<span class="ident" id="7313621">Must</span><span class="op" id="7313625">(</span><span class="ident" id="7313626">toClone</span><span class="op" id="7313633">.</span><span class="ident" id="7313634">Clone</span><span class="op" id="7313639">(</span><span class="op" id="7313640">)</span><span class="op" id="7313641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313644">gotErr</span>&nbsp;<span class="op" id="7313651">:=</span>&nbsp;<span class="ident" id="7313654">cloned</span><span class="op" id="7313660">.</span><span class="ident" id="7313661">Execute</span><span class="op" id="7313668">(</span><span class="ident" id="7313669">ioutil</span><span class="op" id="7313675">.</span><span class="ident" id="7313676">Discard</span><span class="op" id="7313683">,</span>&nbsp;<span class="ident" id="7313685">nil</span><span class="op" id="7313688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7313692">if</span>&nbsp;<span class="ident" id="7313695">wantErr</span><span class="op" id="7313702">.</span><span class="ident" id="7313703">Error</span><span class="op" id="7313708">(</span><span class="op" id="7313709">)</span>&nbsp;<span class="op" id="7313711">!=</span>&nbsp;<span class="ident" id="7313714">gotErr</span><span class="op" id="7313720">.</span><span class="ident" id="7313721">Error</span><span class="op" id="7313726">(</span><span class="op" id="7313727">)</span>&nbsp;<span class="op" id="7313729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7313733">t</span><span class="op" id="7313734">.</span><span class="ident" id="7313735">Errorf</span><span class="op" id="7313741">(</span><span class="string" id="7313742">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7313787">,</span>&nbsp;<span class="ident" id="7313789">wantErr</span><span class="op" id="7313796">,</span>&nbsp;<span class="ident" id="7313798">gotErr</span><span class="op" id="7313804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7313807">}</span><br>
<span class="lineno"></span><span class="op" id="7313809">}</span>
</div>
</body>
</html>
