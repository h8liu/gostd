<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5982939">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5982995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5983049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5983100">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5983167">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5983226">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5983267">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="5983314">//</span><br>
<span class="lineno">10</span><span class="comment" id="5983317">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5983382">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="5983416">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="5983467">//</span><br>
<span class="lineno"></span><span class="comment" id="5983470">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="5983524">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5983553">//</span><br>
<span class="lineno"></span><span class="comment" id="5983556">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="5983622">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5983690">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="5983735">//</span><br>
<span class="lineno"></span><span class="comment" id="5983738">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5983754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="5983815">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="5983823">//</span><br>
<span class="lineno">25</span><span class="comment" id="5983826">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5983882">//</span><br>
<span class="lineno"></span><span class="comment" id="5983885">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="5983941">//</span><br>
<span class="lineno"></span><span class="comment" id="5983944">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="5983986">//</span><br>
<span class="lineno"></span><span class="comment" id="5983989">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="5984048">//</span><br>
<span class="lineno"></span><span class="comment" id="5984051">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5984100">//</span><br>
<span class="lineno">35</span><span class="comment" id="5984103">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="5984160">//</span><br>
<span class="lineno"></span><span class="comment" id="5984163">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="5984238">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="5984258">//</span><br>
<span class="lineno">40</span><span class="comment" id="5984261">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="5984309">//</span><br>
<span class="lineno"></span><span class="comment" id="5984312">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="5984373">//</span><br>
<span class="lineno"></span><span class="keyword" id="5984376">package</span>&nbsp;<span class="ident" id="5984384">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5984391">import</span>&nbsp;<span class="op" id="5984398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984401">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984410">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984419">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984426">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984443">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984449">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984456">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984468">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984474">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984485">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984502">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984513">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984524">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="5984531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984534">func</span>&nbsp;<span class="ident" id="5984539">init</span><span class="op" id="5984543">(</span><span class="op" id="5984544">)</span>&nbsp;<span class="op" id="5984546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984549">http</span><span class="op" id="5984553">.</span><span class="ident" id="5984554">Handle</span><span class="op" id="5984560">(</span><span class="string" id="5984561">&#34;/debug/pprof/&#34;</span><span class="op" id="5984576">,</span>&nbsp;<span class="ident" id="5984578">http</span><span class="op" id="5984582">.</span><span class="ident" id="5984583">HandlerFunc</span><span class="op" id="5984594">(</span><span class="ident" id="5984595">Index</span><span class="op" id="5984600">)</span><span class="op" id="5984601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984604">http</span><span class="op" id="5984608">.</span><span class="ident" id="5984609">Handle</span><span class="op" id="5984615">(</span><span class="string" id="5984616">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="5984638">,</span>&nbsp;<span class="ident" id="5984640">http</span><span class="op" id="5984644">.</span><span class="ident" id="5984645">HandlerFunc</span><span class="op" id="5984656">(</span><span class="ident" id="5984657">Cmdline</span><span class="op" id="5984664">)</span><span class="op" id="5984665">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984668">http</span><span class="op" id="5984672">.</span><span class="ident" id="5984673">Handle</span><span class="op" id="5984679">(</span><span class="string" id="5984680">&#34;/debug/pprof/profile&#34;</span><span class="op" id="5984702">,</span>&nbsp;<span class="ident" id="5984704">http</span><span class="op" id="5984708">.</span><span class="ident" id="5984709">HandlerFunc</span><span class="op" id="5984720">(</span><span class="ident" id="5984721">Profile</span><span class="op" id="5984728">)</span><span class="op" id="5984729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984732">http</span><span class="op" id="5984736">.</span><span class="ident" id="5984737">Handle</span><span class="op" id="5984743">(</span><span class="string" id="5984744">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="5984765">,</span>&nbsp;<span class="ident" id="5984767">http</span><span class="op" id="5984771">.</span><span class="ident" id="5984772">HandlerFunc</span><span class="op" id="5984783">(</span><span class="ident" id="5984784">Symbol</span><span class="op" id="5984790">)</span><span class="op" id="5984791">)</span><br>
<span class="lineno"></span><span class="op" id="5984793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984796">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="5984843">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5984899">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="5984967">func</span>&nbsp;<span class="ident" id="5984972">Cmdline</span><span class="op" id="5984979">(</span><span class="ident" id="5984980">w</span>&nbsp;<span class="ident" id="5984982">http</span><span class="op" id="5984986">.</span><span class="ident" id="5984987">ResponseWriter</span><span class="op" id="5985001">,</span>&nbsp;<span class="ident" id="5985003">r</span>&nbsp;<span class="op" id="5985005">*</span><span class="ident" id="5985006">http</span><span class="op" id="5985010">.</span><span class="ident" id="5985011">Request</span><span class="op" id="5985018">)</span>&nbsp;<span class="op" id="5985020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985023">w</span><span class="op" id="5985024">.</span><span class="ident" id="5985025">Header</span><span class="op" id="5985031">(</span><span class="op" id="5985032">)</span><span class="op" id="5985033">.</span><span class="ident" id="5985034">Set</span><span class="op" id="5985037">(</span><span class="string" id="5985038">&#34;Content-Type&#34;</span><span class="op" id="5985052">,</span>&nbsp;<span class="string" id="5985054">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5985081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985084">fmt</span><span class="op" id="5985087">.</span><span class="ident" id="5985088">Fprintf</span><span class="op" id="5985095">(</span><span class="ident" id="5985096">w</span><span class="op" id="5985097">,</span>&nbsp;<span class="ident" id="5985099">strings</span><span class="op" id="5985106">.</span><span class="ident" id="5985107">Join</span><span class="op" id="5985111">(</span><span class="ident" id="5985112">os</span><span class="op" id="5985114">.</span><span class="ident" id="5985115">Args</span><span class="op" id="5985119">,</span>&nbsp;<span class="string" id="5985121">&#34;\x00&#34;</span><span class="op" id="5985127">)</span><span class="op" id="5985128">)</span><br>
<span class="lineno">75</span><span class="op" id="5985130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985133">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5985191">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5985259">func</span>&nbsp;<span class="ident" id="5985264">Profile</span><span class="op" id="5985271">(</span><span class="ident" id="5985272">w</span>&nbsp;<span class="ident" id="5985274">http</span><span class="op" id="5985278">.</span><span class="ident" id="5985279">ResponseWriter</span><span class="op" id="5985293">,</span>&nbsp;<span class="ident" id="5985295">r</span>&nbsp;<span class="op" id="5985297">*</span><span class="ident" id="5985298">http</span><span class="op" id="5985302">.</span><span class="ident" id="5985303">Request</span><span class="op" id="5985310">)</span>&nbsp;<span class="op" id="5985312">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985315">sec</span><span class="op" id="5985318">,</span>&nbsp;<span class="ident" id="5985320">_</span>&nbsp;<span class="op" id="5985322">:=</span>&nbsp;<span class="ident" id="5985325">strconv</span><span class="op" id="5985332">.</span><span class="ident" id="5985333">ParseInt</span><span class="op" id="5985341">(</span><span class="ident" id="5985342">r</span><span class="op" id="5985343">.</span><span class="ident" id="5985344">FormValue</span><span class="op" id="5985353">(</span><span class="string" id="5985354">&#34;seconds&#34;</span><span class="op" id="5985363">)</span><span class="op" id="5985364">,</span>&nbsp;<span class="num" id="5985366">10</span><span class="op" id="5985368">,</span>&nbsp;<span class="num" id="5985370">64</span><span class="op" id="5985372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985375">if</span>&nbsp;<span class="ident" id="5985378">sec</span>&nbsp;<span class="op" id="5985382">==</span>&nbsp;<span class="num" id="5985385">0</span>&nbsp;<span class="op" id="5985387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985391">sec</span>&nbsp;<span class="op" id="5985395">=</span>&nbsp;<span class="num" id="5985397">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985405">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985462">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985504">w</span><span class="op" id="5985505">.</span><span class="ident" id="5985506">Header</span><span class="op" id="5985512">(</span><span class="op" id="5985513">)</span><span class="op" id="5985514">.</span><span class="ident" id="5985515">Set</span><span class="op" id="5985518">(</span><span class="string" id="5985519">&#34;Content-Type&#34;</span><span class="op" id="5985533">,</span>&nbsp;<span class="string" id="5985535">&#34;application/octet-stream&#34;</span><span class="op" id="5985561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985564">if</span>&nbsp;<span class="ident" id="5985567">err</span>&nbsp;<span class="op" id="5985571">:=</span>&nbsp;<span class="ident" id="5985574">pprof</span><span class="op" id="5985579">.</span><span class="ident" id="5985580">StartCPUProfile</span><span class="op" id="5985595">(</span><span class="ident" id="5985596">w</span><span class="op" id="5985597">)</span><span class="op" id="5985598">;</span>&nbsp;<span class="ident" id="5985600">err</span>&nbsp;<span class="op" id="5985604">!=</span>&nbsp;<span class="ident" id="5985607">nil</span>&nbsp;<span class="op" id="5985611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985615">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985662">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985706">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985732">w</span><span class="op" id="5985733">.</span><span class="ident" id="5985734">Header</span><span class="op" id="5985740">(</span><span class="op" id="5985741">)</span><span class="op" id="5985742">.</span><span class="ident" id="5985743">Set</span><span class="op" id="5985746">(</span><span class="string" id="5985747">&#34;Content-Type&#34;</span><span class="op" id="5985761">,</span>&nbsp;<span class="string" id="5985763">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5985790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985794">w</span><span class="op" id="5985795">.</span><span class="ident" id="5985796">WriteHeader</span><span class="op" id="5985807">(</span><span class="ident" id="5985808">http</span><span class="op" id="5985812">.</span><span class="ident" id="5985813">StatusInternalServerError</span><span class="op" id="5985838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985842">fmt</span><span class="op" id="5985845">.</span><span class="ident" id="5985846">Fprintf</span><span class="op" id="5985853">(</span><span class="ident" id="5985854">w</span><span class="op" id="5985855">,</span>&nbsp;<span class="string" id="5985857">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="5985895">,</span>&nbsp;<span class="ident" id="5985897">err</span><span class="op" id="5985900">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985904">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5985912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985915">time</span><span class="op" id="5985919">.</span><span class="ident" id="5985920">Sleep</span><span class="op" id="5985925">(</span><span class="ident" id="5985926">time</span><span class="op" id="5985930">.</span><span class="ident" id="5985931">Duration</span><span class="op" id="5985939">(</span><span class="ident" id="5985940">sec</span><span class="op" id="5985943">)</span>&nbsp;<span class="op" id="5985945">*</span>&nbsp;<span class="ident" id="5985947">time</span><span class="op" id="5985951">.</span><span class="ident" id="5985952">Second</span><span class="op" id="5985958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985961">pprof</span><span class="op" id="5985966">.</span><span class="ident" id="5985967">StopCPUProfile</span><span class="op" id="5985981">(</span><span class="op" id="5985982">)</span><br>
<span class="lineno"></span><span class="op" id="5985984">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5985987">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="5986050">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5986121">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5986188">func</span>&nbsp;<span class="ident" id="5986193">Symbol</span><span class="op" id="5986199">(</span><span class="ident" id="5986200">w</span>&nbsp;<span class="ident" id="5986202">http</span><span class="op" id="5986206">.</span><span class="ident" id="5986207">ResponseWriter</span><span class="op" id="5986221">,</span>&nbsp;<span class="ident" id="5986223">r</span>&nbsp;<span class="op" id="5986225">*</span><span class="ident" id="5986226">http</span><span class="op" id="5986230">.</span><span class="ident" id="5986231">Request</span><span class="op" id="5986238">)</span>&nbsp;<span class="op" id="5986240">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986243">w</span><span class="op" id="5986244">.</span><span class="ident" id="5986245">Header</span><span class="op" id="5986251">(</span><span class="op" id="5986252">)</span><span class="op" id="5986253">.</span><span class="ident" id="5986254">Set</span><span class="op" id="5986257">(</span><span class="string" id="5986258">&#34;Content-Type&#34;</span><span class="op" id="5986272">,</span>&nbsp;<span class="string" id="5986274">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5986301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986305">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986352">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986401">var</span>&nbsp;<span class="ident" id="5986405">buf</span>&nbsp;<span class="ident" id="5986409">bytes</span><span class="op" id="5986414">.</span><span class="ident" id="5986415">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986424">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986475">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5986533">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986585">fmt</span><span class="op" id="5986588">.</span><span class="ident" id="5986589">Fprintf</span><span class="op" id="5986596">(</span><span class="op" id="5986597">&amp;</span><span class="ident" id="5986598">buf</span><span class="op" id="5986601">,</span>&nbsp;<span class="string" id="5986603">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="5986621">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986625">var</span>&nbsp;<span class="ident" id="5986629">b</span>&nbsp;<span class="op" id="5986631">*</span><span class="ident" id="5986632">bufio</span><span class="op" id="5986637">.</span><span class="ident" id="5986638">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986646">if</span>&nbsp;<span class="ident" id="5986649">r</span><span class="op" id="5986650">.</span><span class="ident" id="5986651">Method</span>&nbsp;<span class="op" id="5986658">==</span>&nbsp;<span class="string" id="5986661">&#34;POST&#34;</span>&nbsp;<span class="op" id="5986668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986672">b</span>&nbsp;<span class="op" id="5986674">=</span>&nbsp;<span class="ident" id="5986676">bufio</span><span class="op" id="5986681">.</span><span class="ident" id="5986682">NewReader</span><span class="op" id="5986691">(</span><span class="ident" id="5986692">r</span><span class="op" id="5986693">.</span><span class="ident" id="5986694">Body</span><span class="op" id="5986698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986701">}</span>&nbsp;<span class="keyword" id="5986703">else</span>&nbsp;<span class="op" id="5986708">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986712">b</span>&nbsp;<span class="op" id="5986714">=</span>&nbsp;<span class="ident" id="5986716">bufio</span><span class="op" id="5986721">.</span><span class="ident" id="5986722">NewReader</span><span class="op" id="5986731">(</span><span class="ident" id="5986732">strings</span><span class="op" id="5986739">.</span><span class="ident" id="5986740">NewReader</span><span class="op" id="5986749">(</span><span class="ident" id="5986750">r</span><span class="op" id="5986751">.</span><span class="ident" id="5986752">URL</span><span class="op" id="5986755">.</span><span class="ident" id="5986756">RawQuery</span><span class="op" id="5986764">)</span><span class="op" id="5986765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986772">for</span>&nbsp;<span class="op" id="5986776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986780">word</span><span class="op" id="5986784">,</span>&nbsp;<span class="ident" id="5986786">err</span>&nbsp;<span class="op" id="5986790">:=</span>&nbsp;<span class="ident" id="5986793">b</span><span class="op" id="5986794">.</span><span class="ident" id="5986795">ReadSlice</span><span class="op" id="5986804">(</span><span class="string" id="5986805">&#39;+&#39;</span><span class="op" id="5986808">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986812">if</span>&nbsp;<span class="ident" id="5986815">err</span>&nbsp;<span class="op" id="5986819">==</span>&nbsp;<span class="ident" id="5986822">nil</span>&nbsp;<span class="op" id="5986826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986831">word</span>&nbsp;<span class="op" id="5986836">=</span>&nbsp;<span class="ident" id="5986838">word</span><span class="op" id="5986842">[</span><span class="num" id="5986843">0</span>&nbsp;<span class="op" id="5986845">:</span>&nbsp;<span class="builtinfunc" id="5986847">len</span><span class="op" id="5986850">(</span><span class="ident" id="5986851">word</span><span class="op" id="5986855">)</span><span class="op" id="5986856">-</span><span class="num" id="5986857">1</span><span class="op" id="5986858">]</span>&nbsp;<span class="comment" id="5986860">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986876">pc</span><span class="op" id="5986878">,</span>&nbsp;<span class="ident" id="5986880">_</span>&nbsp;<span class="op" id="5986882">:=</span>&nbsp;<span class="ident" id="5986885">strconv</span><span class="op" id="5986892">.</span><span class="ident" id="5986893">ParseUint</span><span class="op" id="5986902">(</span><span class="builtintype" id="5986903">string</span><span class="op" id="5986909">(</span><span class="ident" id="5986910">word</span><span class="op" id="5986914">)</span><span class="op" id="5986915">,</span>&nbsp;<span class="num" id="5986917">0</span><span class="op" id="5986918">,</span>&nbsp;<span class="num" id="5986920">64</span><span class="op" id="5986922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986926">if</span>&nbsp;<span class="ident" id="5986929">pc</span>&nbsp;<span class="op" id="5986932">!=</span>&nbsp;<span class="num" id="5986935">0</span>&nbsp;<span class="op" id="5986937">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986942">f</span>&nbsp;<span class="op" id="5986944">:=</span>&nbsp;<span class="ident" id="5986947">runtime</span><span class="op" id="5986954">.</span><span class="ident" id="5986955">FuncForPC</span><span class="op" id="5986964">(</span><span class="builtintype" id="5986965">uintptr</span><span class="op" id="5986972">(</span><span class="ident" id="5986973">pc</span><span class="op" id="5986975">)</span><span class="op" id="5986976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986981">if</span>&nbsp;<span class="ident" id="5986984">f</span>&nbsp;<span class="op" id="5986986">!=</span>&nbsp;<span class="ident" id="5986989">nil</span>&nbsp;<span class="op" id="5986993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986999">fmt</span><span class="op" id="5987002">.</span><span class="ident" id="5987003">Fprintf</span><span class="op" id="5987010">(</span><span class="op" id="5987011">&amp;</span><span class="ident" id="5987012">buf</span><span class="op" id="5987015">,</span>&nbsp;<span class="string" id="5987017">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="5987027">,</span>&nbsp;<span class="ident" id="5987029">pc</span><span class="op" id="5987031">,</span>&nbsp;<span class="ident" id="5987033">f</span><span class="op" id="5987034">.</span><span class="ident" id="5987035">Name</span><span class="op" id="5987039">(</span><span class="op" id="5987040">)</span><span class="op" id="5987041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987050">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987055">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987103">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987161">if</span>&nbsp;<span class="ident" id="5987164">err</span>&nbsp;<span class="op" id="5987168">!=</span>&nbsp;<span class="ident" id="5987171">nil</span>&nbsp;<span class="op" id="5987175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987180">if</span>&nbsp;<span class="ident" id="5987183">err</span>&nbsp;<span class="op" id="5987187">!=</span>&nbsp;<span class="ident" id="5987190">io</span><span class="op" id="5987192">.</span><span class="ident" id="5987193">EOF</span>&nbsp;<span class="op" id="5987197">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987203">fmt</span><span class="op" id="5987206">.</span><span class="ident" id="5987207">Fprintf</span><span class="op" id="5987214">(</span><span class="op" id="5987215">&amp;</span><span class="ident" id="5987216">buf</span><span class="op" id="5987219">,</span>&nbsp;<span class="string" id="5987221">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="5987244">,</span>&nbsp;<span class="ident" id="5987246">err</span><span class="op" id="5987249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987259">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987270">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987274">w</span><span class="op" id="5987275">.</span><span class="ident" id="5987276">Write</span><span class="op" id="5987281">(</span><span class="ident" id="5987282">buf</span><span class="op" id="5987285">.</span><span class="ident" id="5987286">Bytes</span><span class="op" id="5987291">(</span><span class="op" id="5987292">)</span><span class="op" id="5987293">)</span><br>
<span class="lineno"></span><span class="op" id="5987295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987298">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="5987364">func</span>&nbsp;<span class="ident" id="5987369">Handler</span><span class="op" id="5987376">(</span><span class="ident" id="5987377">name</span>&nbsp;<span class="builtintype" id="5987382">string</span><span class="op" id="5987388">)</span>&nbsp;<span class="ident" id="5987390">http</span><span class="op" id="5987394">.</span><span class="ident" id="5987395">Handler</span>&nbsp;<span class="op" id="5987403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987406">return</span>&nbsp;<span class="ident" id="5987413">handler</span><span class="op" id="5987420">(</span><span class="ident" id="5987421">name</span><span class="op" id="5987425">)</span><br>
<span class="lineno"></span><span class="op" id="5987427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987430">type</span>&nbsp;<span class="ident" id="5987435">handler</span>&nbsp;<span class="builtintype" id="5987443">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5987451">func</span>&nbsp;<span class="op" id="5987456">(</span><span class="ident" id="5987457">name</span>&nbsp;<span class="ident" id="5987462">handler</span><span class="op" id="5987469">)</span>&nbsp;<span class="ident" id="5987471">ServeHTTP</span><span class="op" id="5987480">(</span><span class="ident" id="5987481">w</span>&nbsp;<span class="ident" id="5987483">http</span><span class="op" id="5987487">.</span><span class="ident" id="5987488">ResponseWriter</span><span class="op" id="5987502">,</span>&nbsp;<span class="ident" id="5987504">r</span>&nbsp;<span class="op" id="5987506">*</span><span class="ident" id="5987507">http</span><span class="op" id="5987511">.</span><span class="ident" id="5987512">Request</span><span class="op" id="5987519">)</span>&nbsp;<span class="op" id="5987521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987524">w</span><span class="op" id="5987525">.</span><span class="ident" id="5987526">Header</span><span class="op" id="5987532">(</span><span class="op" id="5987533">)</span><span class="op" id="5987534">.</span><span class="ident" id="5987535">Set</span><span class="op" id="5987538">(</span><span class="string" id="5987539">&#34;Content-Type&#34;</span><span class="op" id="5987553">,</span>&nbsp;<span class="string" id="5987555">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5987582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987585">debug</span><span class="op" id="5987590">,</span>&nbsp;<span class="ident" id="5987592">_</span>&nbsp;<span class="op" id="5987594">:=</span>&nbsp;<span class="ident" id="5987597">strconv</span><span class="op" id="5987604">.</span><span class="ident" id="5987605">Atoi</span><span class="op" id="5987609">(</span><span class="ident" id="5987610">r</span><span class="op" id="5987611">.</span><span class="ident" id="5987612">FormValue</span><span class="op" id="5987621">(</span><span class="string" id="5987622">&#34;debug&#34;</span><span class="op" id="5987629">)</span><span class="op" id="5987630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987633">p</span>&nbsp;<span class="op" id="5987635">:=</span>&nbsp;<span class="ident" id="5987638">pprof</span><span class="op" id="5987643">.</span><span class="ident" id="5987644">Lookup</span><span class="op" id="5987650">(</span><span class="builtintype" id="5987651">string</span><span class="op" id="5987657">(</span><span class="ident" id="5987658">name</span><span class="op" id="5987662">)</span><span class="op" id="5987663">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987666">if</span>&nbsp;<span class="ident" id="5987669">p</span>&nbsp;<span class="op" id="5987671">==</span>&nbsp;<span class="ident" id="5987674">nil</span>&nbsp;<span class="op" id="5987678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987682">w</span><span class="op" id="5987683">.</span><span class="ident" id="5987684">WriteHeader</span><span class="op" id="5987695">(</span><span class="num" id="5987696">404</span><span class="op" id="5987699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987703">fmt</span><span class="op" id="5987706">.</span><span class="ident" id="5987707">Fprintf</span><span class="op" id="5987714">(</span><span class="ident" id="5987715">w</span><span class="op" id="5987716">,</span>&nbsp;<span class="string" id="5987718">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="5987741">,</span>&nbsp;<span class="ident" id="5987743">name</span><span class="op" id="5987747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987751">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987759">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987762">gc</span><span class="op" id="5987764">,</span>&nbsp;<span class="ident" id="5987766">_</span>&nbsp;<span class="op" id="5987768">:=</span>&nbsp;<span class="ident" id="5987771">strconv</span><span class="op" id="5987778">.</span><span class="ident" id="5987779">Atoi</span><span class="op" id="5987783">(</span><span class="ident" id="5987784">r</span><span class="op" id="5987785">.</span><span class="ident" id="5987786">FormValue</span><span class="op" id="5987795">(</span><span class="string" id="5987796">&#34;gc&#34;</span><span class="op" id="5987800">)</span><span class="op" id="5987801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987804">if</span>&nbsp;<span class="ident" id="5987807">name</span>&nbsp;<span class="op" id="5987812">==</span>&nbsp;<span class="string" id="5987815">&#34;heap&#34;</span>&nbsp;<span class="op" id="5987822">&amp;&amp;</span>&nbsp;<span class="ident" id="5987825">gc</span>&nbsp;<span class="op" id="5987828">&gt;</span>&nbsp;<span class="num" id="5987830">0</span>&nbsp;<span class="op" id="5987832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987836">runtime</span><span class="op" id="5987843">.</span><span class="ident" id="5987844">GC</span><span class="op" id="5987846">(</span><span class="op" id="5987847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987853">p</span><span class="op" id="5987854">.</span><span class="ident" id="5987855">WriteTo</span><span class="op" id="5987862">(</span><span class="ident" id="5987863">w</span><span class="op" id="5987864">,</span>&nbsp;<span class="ident" id="5987866">debug</span><span class="op" id="5987871">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987874">return</span><br>
<span class="lineno"></span><span class="op" id="5987881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987884">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5987957">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="5988020">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="5988089">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5988124">func</span>&nbsp;<span class="ident" id="5988129">Index</span><span class="op" id="5988134">(</span><span class="ident" id="5988135">w</span>&nbsp;<span class="ident" id="5988137">http</span><span class="op" id="5988141">.</span><span class="ident" id="5988142">ResponseWriter</span><span class="op" id="5988156">,</span>&nbsp;<span class="ident" id="5988158">r</span>&nbsp;<span class="op" id="5988160">*</span><span class="ident" id="5988161">http</span><span class="op" id="5988165">.</span><span class="ident" id="5988166">Request</span><span class="op" id="5988173">)</span>&nbsp;<span class="op" id="5988175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988178">if</span>&nbsp;<span class="ident" id="5988181">strings</span><span class="op" id="5988188">.</span><span class="ident" id="5988189">HasPrefix</span><span class="op" id="5988198">(</span><span class="ident" id="5988199">r</span><span class="op" id="5988200">.</span><span class="ident" id="5988201">URL</span><span class="op" id="5988204">.</span><span class="ident" id="5988205">Path</span><span class="op" id="5988209">,</span>&nbsp;<span class="string" id="5988211">&#34;/debug/pprof/&#34;</span><span class="op" id="5988226">)</span>&nbsp;<span class="op" id="5988228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988232">name</span>&nbsp;<span class="op" id="5988237">:=</span>&nbsp;<span class="ident" id="5988240">strings</span><span class="op" id="5988247">.</span><span class="ident" id="5988248">TrimPrefix</span><span class="op" id="5988258">(</span><span class="ident" id="5988259">r</span><span class="op" id="5988260">.</span><span class="ident" id="5988261">URL</span><span class="op" id="5988264">.</span><span class="ident" id="5988265">Path</span><span class="op" id="5988269">,</span>&nbsp;<span class="string" id="5988271">&#34;/debug/pprof/&#34;</span><span class="op" id="5988286">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988290">if</span>&nbsp;<span class="ident" id="5988293">name</span>&nbsp;<span class="op" id="5988298">!=</span>&nbsp;<span class="string" id="5988301">&#34;&#34;</span>&nbsp;<span class="op" id="5988304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988309">handler</span><span class="op" id="5988316">(</span><span class="ident" id="5988317">name</span><span class="op" id="5988321">)</span><span class="op" id="5988322">.</span><span class="ident" id="5988323">ServeHTTP</span><span class="op" id="5988332">(</span><span class="ident" id="5988333">w</span><span class="op" id="5988334">,</span>&nbsp;<span class="ident" id="5988336">r</span><span class="op" id="5988337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988342">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988354">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988358">profiles</span>&nbsp;<span class="op" id="5988367">:=</span>&nbsp;<span class="ident" id="5988370">pprof</span><span class="op" id="5988375">.</span><span class="ident" id="5988376">Profiles</span><span class="op" id="5988384">(</span><span class="op" id="5988385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988388">if</span>&nbsp;<span class="ident" id="5988391">err</span>&nbsp;<span class="op" id="5988395">:=</span>&nbsp;<span class="ident" id="5988398">indexTmpl</span><span class="op" id="5988407">.</span><span class="ident" id="5988408">Execute</span><span class="op" id="5988415">(</span><span class="ident" id="5988416">w</span><span class="op" id="5988417">,</span>&nbsp;<span class="ident" id="5988419">profiles</span><span class="op" id="5988427">)</span><span class="op" id="5988428">;</span>&nbsp;<span class="ident" id="5988430">err</span>&nbsp;<span class="op" id="5988434">!=</span>&nbsp;<span class="ident" id="5988437">nil</span>&nbsp;<span class="op" id="5988441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988445">log</span><span class="op" id="5988448">.</span><span class="ident" id="5988449">Print</span><span class="op" id="5988454">(</span><span class="ident" id="5988455">err</span><span class="op" id="5988458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988461">}</span><br>
<span class="lineno">190</span><span class="op" id="5988463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5988466">var</span>&nbsp;<span class="ident" id="5988470">indexTmpl</span>&nbsp;<span class="op" id="5988480">=</span>&nbsp;<span class="ident" id="5988482">template</span><span class="op" id="5988490">.</span><span class="ident" id="5988491">Must</span><span class="op" id="5988495">(</span><span class="ident" id="5988496">template</span><span class="op" id="5988504">.</span><span class="ident" id="5988505">New</span><span class="op" id="5988508">(</span><span class="string" id="5988509">&#34;index&#34;</span><span class="op" id="5988516">)</span><span class="op" id="5988517">.</span><span class="ident" id="5988518">Parse</span><span class="op" id="5988523">(</span><span class="string" id="5988524">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="5988843">)</span><span class="op" id="5988844">)</span>
</div>
</body>
</html>
