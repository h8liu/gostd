<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html" class="current">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2454804">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2454859">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2454913">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2454964">package</span>&nbsp;<span class="ident" id="2454972">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2454976">import</span>&nbsp;<span class="op" id="2454983">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2454986">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2454992">&#34;syscall&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2455002">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2455005">//&nbsp;MkdirAll&nbsp;creates&nbsp;a&nbsp;directory&nbsp;named&nbsp;path,</span><br>
<span class="lineno"></span><span class="comment" id="2455049">//&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;parents,&nbsp;and&nbsp;returns&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="2455103">//&nbsp;or&nbsp;else&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">15</span><span class="comment" id="2455132">//&nbsp;The&nbsp;permission&nbsp;bits&nbsp;perm&nbsp;are&nbsp;used&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2455177">//&nbsp;directories&nbsp;that&nbsp;MkdirAll&nbsp;creates.</span><br>
<span class="lineno"></span><span class="comment" id="2455215">//&nbsp;If&nbsp;path&nbsp;is&nbsp;already&nbsp;a&nbsp;directory,&nbsp;MkdirAll&nbsp;does&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="2455272">//&nbsp;and&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2455292">func</span>&nbsp;<span class="ident" id="2455297">MkdirAll</span><span class="op" id="2455305">(</span><span class="ident" id="2455306">path</span>&nbsp;<span class="builtintype" id="2455311">string</span><span class="op" id="2455317">,</span>&nbsp;<span class="ident" id="2455319">perm</span>&nbsp;<span class="ident" id="2455324">FileMode</span><span class="op" id="2455332">)</span>&nbsp;<span class="builtintype" id="2455334">error</span>&nbsp;<span class="op" id="2455340">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2455343">//&nbsp;Fast&nbsp;path:&nbsp;if&nbsp;we&nbsp;can&nbsp;tell&nbsp;whether&nbsp;path&nbsp;is&nbsp;a&nbsp;directory&nbsp;or&nbsp;file,&nbsp;stop&nbsp;with&nbsp;success&nbsp;or&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455438">dir</span><span class="op" id="2455441">,</span>&nbsp;<span class="ident" id="2455443">err</span>&nbsp;<span class="op" id="2455447">:=</span>&nbsp;<span class="ident" id="2455450">Stat</span><span class="op" id="2455454">(</span><span class="ident" id="2455455">path</span><span class="op" id="2455459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455462">if</span>&nbsp;<span class="ident" id="2455465">err</span>&nbsp;<span class="op" id="2455469">==</span>&nbsp;<span class="builtintype" id="2455472">nil</span>&nbsp;<span class="op" id="2455476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455480">if</span>&nbsp;<span class="ident" id="2455483">dir</span><span class="op" id="2455486">.</span><span class="ident" id="2455487">IsDir</span><span class="op" id="2455492">(</span><span class="op" id="2455493">)</span>&nbsp;<span class="op" id="2455495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455500">return</span>&nbsp;<span class="builtintype" id="2455507">nil</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455517">return</span>&nbsp;<span class="op" id="2455524">&amp;</span><span class="ident" id="2455525">PathError</span><span class="op" id="2455534">{</span><span class="string" id="2455535">&#34;mkdir&#34;</span><span class="op" id="2455542">,</span>&nbsp;<span class="ident" id="2455544">path</span><span class="op" id="2455548">,</span>&nbsp;<span class="ident" id="2455550">syscall</span><span class="op" id="2455557">.</span><span class="ident" id="2455558">ENOTDIR</span><span class="op" id="2455565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2455572">//&nbsp;Slow&nbsp;path:&nbsp;make&nbsp;sure&nbsp;parent&nbsp;exists&nbsp;and&nbsp;then&nbsp;call&nbsp;Mkdir&nbsp;for&nbsp;path.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455641">i</span>&nbsp;<span class="op" id="2455643">:=</span>&nbsp;<span class="builtinfunc" id="2455646">len</span><span class="op" id="2455649">(</span><span class="ident" id="2455650">path</span><span class="op" id="2455654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455657">for</span>&nbsp;<span class="ident" id="2455661">i</span>&nbsp;<span class="op" id="2455663">&gt;</span>&nbsp;<span class="num" id="2455665">0</span>&nbsp;<span class="op" id="2455667">&amp;&amp;</span>&nbsp;<span class="ident" id="2455670">IsPathSeparator</span><span class="op" id="2455685">(</span><span class="ident" id="2455686">path</span><span class="op" id="2455690">[</span><span class="ident" id="2455691">i</span><span class="op" id="2455692">-</span><span class="num" id="2455693">1</span><span class="op" id="2455694">]</span><span class="op" id="2455695">)</span>&nbsp;<span class="op" id="2455697">{</span>&nbsp;<span class="comment" id="2455699">//&nbsp;Skip&nbsp;trailing&nbsp;path&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455734">i</span><span class="op" id="2455735">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455743">j</span>&nbsp;<span class="op" id="2455745">:=</span>&nbsp;<span class="ident" id="2455748">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455751">for</span>&nbsp;<span class="ident" id="2455755">j</span>&nbsp;<span class="op" id="2455757">&gt;</span>&nbsp;<span class="num" id="2455759">0</span>&nbsp;<span class="op" id="2455761">&amp;&amp;</span>&nbsp;<span class="op" id="2455764">!</span><span class="ident" id="2455765">IsPathSeparator</span><span class="op" id="2455780">(</span><span class="ident" id="2455781">path</span><span class="op" id="2455785">[</span><span class="ident" id="2455786">j</span><span class="op" id="2455787">-</span><span class="num" id="2455788">1</span><span class="op" id="2455789">]</span><span class="op" id="2455790">)</span>&nbsp;<span class="op" id="2455792">{</span>&nbsp;<span class="comment" id="2455794">//&nbsp;Scan&nbsp;backward&nbsp;over&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455827">j</span><span class="op" id="2455828">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455836">if</span>&nbsp;<span class="ident" id="2455839">j</span>&nbsp;<span class="op" id="2455841">&gt;</span>&nbsp;<span class="num" id="2455843">1</span>&nbsp;<span class="op" id="2455845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2455849">//&nbsp;Create&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455868">err</span>&nbsp;<span class="op" id="2455872">=</span>&nbsp;<span class="ident" id="2455874">MkdirAll</span><span class="op" id="2455882">(</span><span class="ident" id="2455883">path</span><span class="op" id="2455887">[</span><span class="num" id="2455888">0</span><span class="op" id="2455889">:</span><span class="ident" id="2455890">j</span><span class="op" id="2455891">-</span><span class="num" id="2455892">1</span><span class="op" id="2455893">]</span><span class="op" id="2455894">,</span>&nbsp;<span class="ident" id="2455896">perm</span><span class="op" id="2455900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455904">if</span>&nbsp;<span class="ident" id="2455907">err</span>&nbsp;<span class="op" id="2455911">!=</span>&nbsp;<span class="builtintype" id="2455914">nil</span>&nbsp;<span class="op" id="2455918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2455923">return</span>&nbsp;<span class="ident" id="2455930">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2455943">//&nbsp;Parent&nbsp;now&nbsp;exists;&nbsp;invoke&nbsp;Mkdir&nbsp;and&nbsp;use&nbsp;its&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2455999">err</span>&nbsp;<span class="op" id="2456003">=</span>&nbsp;<span class="ident" id="2456005">Mkdir</span><span class="op" id="2456010">(</span><span class="ident" id="2456011">path</span><span class="op" id="2456015">,</span>&nbsp;<span class="ident" id="2456017">perm</span><span class="op" id="2456021">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456024">if</span>&nbsp;<span class="ident" id="2456027">err</span>&nbsp;<span class="op" id="2456031">!=</span>&nbsp;<span class="builtintype" id="2456034">nil</span>&nbsp;<span class="op" id="2456038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456042">//&nbsp;Handle&nbsp;arguments&nbsp;like&nbsp;&#34;foo/.&#34;&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456080">//&nbsp;double-checking&nbsp;that&nbsp;directory&nbsp;doesn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2456131">dir</span><span class="op" id="2456134">,</span>&nbsp;<span class="ident" id="2456136">err1</span>&nbsp;<span class="op" id="2456141">:=</span>&nbsp;<span class="ident" id="2456144">Lstat</span><span class="op" id="2456149">(</span><span class="ident" id="2456150">path</span><span class="op" id="2456154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456158">if</span>&nbsp;<span class="ident" id="2456161">err1</span>&nbsp;<span class="op" id="2456166">==</span>&nbsp;<span class="builtintype" id="2456169">nil</span>&nbsp;<span class="op" id="2456173">&amp;&amp;</span>&nbsp;<span class="ident" id="2456176">dir</span><span class="op" id="2456179">.</span><span class="ident" id="2456180">IsDir</span><span class="op" id="2456185">(</span><span class="op" id="2456186">)</span>&nbsp;<span class="op" id="2456188">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456193">return</span>&nbsp;<span class="builtintype" id="2456200">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456210">return</span>&nbsp;<span class="ident" id="2456217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456225">return</span>&nbsp;<span class="builtintype" id="2456232">nil</span><br>
<span class="lineno">60</span><span class="op" id="2456236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2456239">//&nbsp;RemoveAll&nbsp;removes&nbsp;path&nbsp;and&nbsp;any&nbsp;children&nbsp;it&nbsp;contains.</span><br>
<span class="lineno"></span><span class="comment" id="2456295">//&nbsp;It&nbsp;removes&nbsp;everything&nbsp;it&nbsp;can&nbsp;but&nbsp;returns&nbsp;the&nbsp;first&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2456355">//&nbsp;it&nbsp;encounters.&nbsp;&nbsp;If&nbsp;the&nbsp;path&nbsp;does&nbsp;not&nbsp;exist,&nbsp;RemoveAll</span><br>
<span class="lineno">65</span><span class="comment" id="2456412">//&nbsp;returns&nbsp;nil&nbsp;(no&nbsp;error).</span><br>
<span class="lineno"></span><span class="keyword" id="2456439">func</span>&nbsp;<span class="ident" id="2456444">RemoveAll</span><span class="op" id="2456453">(</span><span class="ident" id="2456454">path</span>&nbsp;<span class="builtintype" id="2456459">string</span><span class="op" id="2456465">)</span>&nbsp;<span class="builtintype" id="2456467">error</span>&nbsp;<span class="op" id="2456473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456476">//&nbsp;Simple&nbsp;case:&nbsp;if&nbsp;Remove&nbsp;works,&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2456522">err</span>&nbsp;<span class="op" id="2456526">:=</span>&nbsp;<span class="ident" id="2456529">Remove</span><span class="op" id="2456535">(</span><span class="ident" id="2456536">path</span><span class="op" id="2456540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456543">if</span>&nbsp;<span class="ident" id="2456546">err</span>&nbsp;<span class="op" id="2456550">==</span>&nbsp;<span class="builtintype" id="2456553">nil</span>&nbsp;<span class="op" id="2456557">||</span>&nbsp;<span class="ident" id="2456560">IsNotExist</span><span class="op" id="2456570">(</span><span class="ident" id="2456571">err</span><span class="op" id="2456574">)</span>&nbsp;<span class="op" id="2456576">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456580">return</span>&nbsp;<span class="builtintype" id="2456587">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456596">//&nbsp;Otherwise,&nbsp;is&nbsp;this&nbsp;a&nbsp;directory&nbsp;we&nbsp;need&nbsp;to&nbsp;recurse&nbsp;into?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2456656">dir</span><span class="op" id="2456659">,</span>&nbsp;<span class="ident" id="2456661">serr</span>&nbsp;<span class="op" id="2456666">:=</span>&nbsp;<span class="ident" id="2456669">Lstat</span><span class="op" id="2456674">(</span><span class="ident" id="2456675">path</span><span class="op" id="2456679">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456682">if</span>&nbsp;<span class="ident" id="2456685">serr</span>&nbsp;<span class="op" id="2456690">!=</span>&nbsp;<span class="builtintype" id="2456693">nil</span>&nbsp;<span class="op" id="2456697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456701">if</span>&nbsp;<span class="ident" id="2456704">serr</span><span class="op" id="2456708">,</span>&nbsp;<span class="ident" id="2456710">ok</span>&nbsp;<span class="op" id="2456713">:=</span>&nbsp;<span class="ident" id="2456716">serr</span><span class="op" id="2456720">.</span><span class="op" id="2456721">(</span><span class="op" id="2456722">*</span><span class="ident" id="2456723">PathError</span><span class="op" id="2456732">)</span><span class="op" id="2456733">;</span>&nbsp;<span class="ident" id="2456735">ok</span>&nbsp;<span class="op" id="2456738">&amp;&amp;</span>&nbsp;<span class="op" id="2456741">(</span><span class="ident" id="2456742">IsNotExist</span><span class="op" id="2456752">(</span><span class="ident" id="2456753">serr</span><span class="op" id="2456757">.</span><span class="ident" id="2456758">Err</span><span class="op" id="2456761">)</span>&nbsp;<span class="op" id="2456763">||</span>&nbsp;<span class="ident" id="2456766">serr</span><span class="op" id="2456770">.</span><span class="ident" id="2456771">Err</span>&nbsp;<span class="op" id="2456775">==</span>&nbsp;<span class="ident" id="2456778">syscall</span><span class="op" id="2456785">.</span><span class="ident" id="2456786">ENOTDIR</span><span class="op" id="2456793">)</span>&nbsp;<span class="op" id="2456795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456800">return</span>&nbsp;<span class="builtintype" id="2456807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456817">return</span>&nbsp;<span class="ident" id="2456824">serr</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456833">if</span>&nbsp;<span class="op" id="2456836">!</span><span class="ident" id="2456837">dir</span><span class="op" id="2456840">.</span><span class="ident" id="2456841">IsDir</span><span class="op" id="2456846">(</span><span class="op" id="2456847">)</span>&nbsp;<span class="op" id="2456849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456853">//&nbsp;Not&nbsp;a&nbsp;directory;&nbsp;return&nbsp;the&nbsp;error&nbsp;from&nbsp;Remove.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456905">return</span>&nbsp;<span class="ident" id="2456912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2456917">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2456921">//&nbsp;Directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2456936">fd</span><span class="op" id="2456938">,</span>&nbsp;<span class="ident" id="2456940">err</span>&nbsp;<span class="op" id="2456944">:=</span>&nbsp;<span class="ident" id="2456947">Open</span><span class="op" id="2456951">(</span><span class="ident" id="2456952">path</span><span class="op" id="2456956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456959">if</span>&nbsp;<span class="ident" id="2456962">err</span>&nbsp;<span class="op" id="2456966">!=</span>&nbsp;<span class="builtintype" id="2456969">nil</span>&nbsp;<span class="op" id="2456973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2456977">if</span>&nbsp;<span class="ident" id="2456980">IsNotExist</span><span class="op" id="2456990">(</span><span class="ident" id="2456991">err</span><span class="op" id="2456994">)</span>&nbsp;<span class="op" id="2456996">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457001">//&nbsp;Race.&nbsp;It&nbsp;was&nbsp;deleted&nbsp;between&nbsp;the&nbsp;Lstat&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457056">//&nbsp;Return&nbsp;nil&nbsp;per&nbsp;RemoveAll&#39;s&nbsp;docs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457095">return</span>&nbsp;<span class="builtintype" id="2457102">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457112">return</span>&nbsp;<span class="ident" id="2457119">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457128">//&nbsp;Remove&nbsp;contents&nbsp;&amp;&nbsp;return&nbsp;first&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457170">err</span>&nbsp;<span class="op" id="2457174">=</span>&nbsp;<span class="builtintype" id="2457176">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457181">for</span>&nbsp;<span class="op" id="2457185">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457189">names</span><span class="op" id="2457194">,</span>&nbsp;<span class="ident" id="2457196">err1</span>&nbsp;<span class="op" id="2457201">:=</span>&nbsp;<span class="ident" id="2457204">fd</span><span class="op" id="2457206">.</span><span class="ident" id="2457207">Readdirnames</span><span class="op" id="2457219">(</span><span class="num" id="2457220">100</span><span class="op" id="2457223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457227">for</span>&nbsp;<span class="ident" id="2457231">_</span><span class="op" id="2457232">,</span>&nbsp;<span class="ident" id="2457234">name</span>&nbsp;<span class="op" id="2457239">:=</span>&nbsp;<span class="keyword" id="2457242">range</span>&nbsp;<span class="ident" id="2457248">names</span>&nbsp;<span class="op" id="2457254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457259">err1</span>&nbsp;<span class="op" id="2457264">:=</span>&nbsp;<span class="ident" id="2457267">RemoveAll</span><span class="op" id="2457276">(</span><span class="ident" id="2457277">path</span>&nbsp;<span class="op" id="2457282">+</span>&nbsp;<span class="builtintype" id="2457284">string</span><span class="op" id="2457290">(</span><span class="ident" id="2457291">PathSeparator</span><span class="op" id="2457304">)</span>&nbsp;<span class="op" id="2457306">+</span>&nbsp;<span class="ident" id="2457308">name</span><span class="op" id="2457312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457317">if</span>&nbsp;<span class="ident" id="2457320">err</span>&nbsp;<span class="op" id="2457324">==</span>&nbsp;<span class="builtintype" id="2457327">nil</span>&nbsp;<span class="op" id="2457331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457337">err</span>&nbsp;<span class="op" id="2457341">=</span>&nbsp;<span class="ident" id="2457343">err1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457359">if</span>&nbsp;<span class="ident" id="2457362">err1</span>&nbsp;<span class="op" id="2457367">==</span>&nbsp;<span class="ident" id="2457370">io</span><span class="op" id="2457372">.</span><span class="ident" id="2457373">EOF</span>&nbsp;<span class="op" id="2457377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457382">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457390">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457394">//&nbsp;If&nbsp;Readdirnames&nbsp;returned&nbsp;an&nbsp;error,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457442">if</span>&nbsp;<span class="ident" id="2457445">err</span>&nbsp;<span class="op" id="2457449">==</span>&nbsp;<span class="builtintype" id="2457452">nil</span>&nbsp;<span class="op" id="2457456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457461">err</span>&nbsp;<span class="op" id="2457465">=</span>&nbsp;<span class="ident" id="2457467">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457478">if</span>&nbsp;<span class="builtinfunc" id="2457481">len</span><span class="op" id="2457484">(</span><span class="ident" id="2457485">names</span><span class="op" id="2457490">)</span>&nbsp;<span class="op" id="2457492">==</span>&nbsp;<span class="num" id="2457495">0</span>&nbsp;<span class="op" id="2457497">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457502">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457517">//&nbsp;Close&nbsp;directory,&nbsp;because&nbsp;windows&nbsp;won&#39;t&nbsp;remove&nbsp;opened&nbsp;directory.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457585">fd</span><span class="op" id="2457587">.</span><span class="ident" id="2457588">Close</span><span class="op" id="2457593">(</span><span class="op" id="2457594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2457598">//&nbsp;Remove&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457620">err1</span>&nbsp;<span class="op" id="2457625">:=</span>&nbsp;<span class="ident" id="2457628">Remove</span><span class="op" id="2457634">(</span><span class="ident" id="2457635">path</span><span class="op" id="2457639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457642">if</span>&nbsp;<span class="ident" id="2457645">err1</span>&nbsp;<span class="op" id="2457650">==</span>&nbsp;<span class="builtintype" id="2457653">nil</span>&nbsp;<span class="op" id="2457657">||</span>&nbsp;<span class="ident" id="2457660">IsNotExist</span><span class="op" id="2457670">(</span><span class="ident" id="2457671">err1</span><span class="op" id="2457675">)</span>&nbsp;<span class="op" id="2457677">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457681">return</span>&nbsp;<span class="builtintype" id="2457688">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457696">if</span>&nbsp;<span class="ident" id="2457699">err</span>&nbsp;<span class="op" id="2457703">==</span>&nbsp;<span class="builtintype" id="2457706">nil</span>&nbsp;<span class="op" id="2457710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2457714">err</span>&nbsp;<span class="op" id="2457718">=</span>&nbsp;<span class="ident" id="2457720">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2457726">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2457729">return</span>&nbsp;<span class="ident" id="2457736">err</span><br>
<span class="lineno"></span><span class="op" id="2457740">}</span>
</div>
</body>
</html>
