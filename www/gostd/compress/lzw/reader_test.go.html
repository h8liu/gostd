<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6876698">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6876753">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6876807">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6876858">package</span>&nbsp;<span class="ident" id="6876866">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6876871">import</span>&nbsp;<span class="op" id="6876878">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876881">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876890">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876896">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876909">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876920">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876931">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876942">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6876952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6876955">type</span>&nbsp;<span class="ident" id="6876960">lzwTest</span>&nbsp;<span class="keyword" id="6876968">struct</span>&nbsp;<span class="op" id="6876975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876978">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6876989">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6876997">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877008">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877016">compressed</span>&nbsp;<span class="builtintype" id="6877027">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877035">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877046">error</span><br>
<span class="lineno"></span><span class="op" id="6877052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6877055">var</span>&nbsp;<span class="ident" id="6877059">lzwTests</span>&nbsp;<span class="op" id="6877068">=</span>&nbsp;<span class="op" id="6877070">[</span><span class="op" id="6877071">]</span><span class="ident" id="6877072">lzwTest</span><span class="op" id="6877079">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877086">&#34;empty;LSB;8&#34;</span><span class="op" id="6877099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877103">&#34;&#34;</span><span class="op" id="6877105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877109">&#34;\x01\x01&#34;</span><span class="op" id="6877119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877123">nil</span><span class="op" id="6877126">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877129">}</span><span class="op" id="6877130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877137">&#34;empty;MSB;8&#34;</span><span class="op" id="6877150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877154">&#34;&#34;</span><span class="op" id="6877156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877160">&#34;\x80\x80&#34;</span><span class="op" id="6877170">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877174">nil</span><span class="op" id="6877177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877180">}</span><span class="op" id="6877181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877188">&#34;tobe;LSB;7&#34;</span><span class="op" id="6877200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877204">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6877230">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877234">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6877304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877308">nil</span><span class="op" id="6877311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877314">}</span><span class="op" id="6877315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877322">&#34;tobe;LSB;8&#34;</span><span class="op" id="6877334">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877338">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6877364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877368">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="6877450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877454">nil</span><span class="op" id="6877457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877460">}</span><span class="op" id="6877461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877464">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877468">&#34;tobe;MSB;7&#34;</span><span class="op" id="6877480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877484">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6877510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877514">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6877584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877588">nil</span><span class="op" id="6877591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877594">}</span><span class="op" id="6877595">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877602">&#34;tobe;MSB;8&#34;</span><span class="op" id="6877614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877618">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6877644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877648">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="6877730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6877734">nil</span><span class="op" id="6877737">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877740">}</span><span class="op" id="6877741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877748">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="6877770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877774">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6877800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877804">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="6877850">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6877854">io</span><span class="op" id="6877856">.</span><span class="ident" id="6877857">ErrUnexpectedEOF</span><span class="op" id="6877873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877876">}</span><span class="op" id="6877877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6877880">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6877966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877970">&#34;gif;LSB;8&#34;</span><span class="op" id="6877981">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6877985">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="6878047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6878051">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="6878097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6878101">nil</span><span class="op" id="6878104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878107">}</span><span class="op" id="6878108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6878111">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6878224">&#34;pdf;MSB;8&#34;</span><span class="op" id="6878235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6878239">&#34;-----A---B&#34;</span><span class="op" id="6878251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6878255">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="6878293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6878297">nil</span><span class="op" id="6878300">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878303">}</span><span class="op" id="6878304">,</span><br>
<span class="lineno"></span><span class="op" id="6878306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6878309">func</span>&nbsp;<span class="ident" id="6878314">TestReader</span><span class="op" id="6878324">(</span><span class="ident" id="6878325">t</span>&nbsp;<span class="op" id="6878327">*</span><span class="ident" id="6878328">testing</span><span class="op" id="6878335">.</span><span class="ident" id="6878336">T</span><span class="op" id="6878337">)</span>&nbsp;<span class="op" id="6878339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878342">var</span>&nbsp;<span class="ident" id="6878346">b</span>&nbsp;<span class="ident" id="6878348">bytes</span><span class="op" id="6878353">.</span><span class="ident" id="6878354">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878362">for</span>&nbsp;<span class="ident" id="6878366">_</span><span class="op" id="6878367">,</span>&nbsp;<span class="ident" id="6878369">tt</span>&nbsp;<span class="op" id="6878372">:=</span>&nbsp;<span class="keyword" id="6878375">range</span>&nbsp;<span class="ident" id="6878381">lzwTests</span>&nbsp;<span class="op" id="6878390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878394">d</span>&nbsp;<span class="op" id="6878396">:=</span>&nbsp;<span class="ident" id="6878399">strings</span><span class="op" id="6878406">.</span><span class="ident" id="6878407">Split</span><span class="op" id="6878412">(</span><span class="ident" id="6878413">tt</span><span class="op" id="6878415">.</span><span class="ident" id="6878416">desc</span><span class="op" id="6878420">,</span>&nbsp;<span class="string" id="6878422">&#34;;&#34;</span><span class="op" id="6878425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878429">var</span>&nbsp;<span class="ident" id="6878433">order</span>&nbsp;<span class="ident" id="6878439">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878447">switch</span>&nbsp;<span class="ident" id="6878454">d</span><span class="op" id="6878455">[</span><span class="num" id="6878456">1</span><span class="op" id="6878457">]</span>&nbsp;<span class="op" id="6878459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878463">case</span>&nbsp;<span class="string" id="6878468">&#34;LSB&#34;</span><span class="op" id="6878473">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878478">order</span>&nbsp;<span class="op" id="6878484">=</span>&nbsp;<span class="ident" id="6878486">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878492">case</span>&nbsp;<span class="string" id="6878497">&#34;MSB&#34;</span><span class="op" id="6878502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878507">order</span>&nbsp;<span class="op" id="6878513">=</span>&nbsp;<span class="ident" id="6878515">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878521">default</span><span class="op" id="6878528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878533">t</span><span class="op" id="6878534">.</span><span class="ident" id="6878535">Errorf</span><span class="op" id="6878541">(</span><span class="string" id="6878542">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="6878560">,</span>&nbsp;<span class="ident" id="6878562">tt</span><span class="op" id="6878564">.</span><span class="ident" id="6878565">desc</span><span class="op" id="6878569">,</span>&nbsp;<span class="ident" id="6878571">d</span><span class="op" id="6878572">[</span><span class="num" id="6878573">1</span><span class="op" id="6878574">]</span><span class="op" id="6878575">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878583">litWidth</span><span class="op" id="6878591">,</span>&nbsp;<span class="ident" id="6878593">_</span>&nbsp;<span class="op" id="6878595">:=</span>&nbsp;<span class="ident" id="6878598">strconv</span><span class="op" id="6878605">.</span><span class="ident" id="6878606">Atoi</span><span class="op" id="6878610">(</span><span class="ident" id="6878611">d</span><span class="op" id="6878612">[</span><span class="num" id="6878613">2</span><span class="op" id="6878614">]</span><span class="op" id="6878615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878619">rc</span>&nbsp;<span class="op" id="6878622">:=</span>&nbsp;<span class="ident" id="6878625">NewReader</span><span class="op" id="6878634">(</span><span class="ident" id="6878635">strings</span><span class="op" id="6878642">.</span><span class="ident" id="6878643">NewReader</span><span class="op" id="6878652">(</span><span class="ident" id="6878653">tt</span><span class="op" id="6878655">.</span><span class="ident" id="6878656">compressed</span><span class="op" id="6878666">)</span><span class="op" id="6878667">,</span>&nbsp;<span class="ident" id="6878669">order</span><span class="op" id="6878674">,</span>&nbsp;<span class="ident" id="6878676">litWidth</span><span class="op" id="6878684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878688">defer</span>&nbsp;<span class="ident" id="6878694">rc</span><span class="op" id="6878696">.</span><span class="ident" id="6878697">Close</span><span class="op" id="6878702">(</span><span class="op" id="6878703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878707">b</span><span class="op" id="6878708">.</span><span class="ident" id="6878709">Reset</span><span class="op" id="6878714">(</span><span class="op" id="6878715">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878719">n</span><span class="op" id="6878720">,</span>&nbsp;<span class="ident" id="6878722">err</span>&nbsp;<span class="op" id="6878726">:=</span>&nbsp;<span class="ident" id="6878729">io</span><span class="op" id="6878731">.</span><span class="ident" id="6878732">Copy</span><span class="op" id="6878736">(</span><span class="op" id="6878737">&amp;</span><span class="ident" id="6878738">b</span><span class="op" id="6878739">,</span>&nbsp;<span class="ident" id="6878741">rc</span><span class="op" id="6878743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878747">if</span>&nbsp;<span class="ident" id="6878750">err</span>&nbsp;<span class="op" id="6878754">!=</span>&nbsp;<span class="builtintype" id="6878757">nil</span>&nbsp;<span class="op" id="6878761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878766">if</span>&nbsp;<span class="ident" id="6878769">err</span>&nbsp;<span class="op" id="6878773">!=</span>&nbsp;<span class="ident" id="6878776">tt</span><span class="op" id="6878778">.</span><span class="ident" id="6878779">err</span>&nbsp;<span class="op" id="6878783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878789">t</span><span class="op" id="6878790">.</span><span class="ident" id="6878791">Errorf</span><span class="op" id="6878797">(</span><span class="string" id="6878798">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6878823">,</span>&nbsp;<span class="ident" id="6878825">tt</span><span class="op" id="6878827">.</span><span class="ident" id="6878828">desc</span><span class="op" id="6878832">,</span>&nbsp;<span class="ident" id="6878834">err</span><span class="op" id="6878837">,</span>&nbsp;<span class="ident" id="6878839">tt</span><span class="op" id="6878841">.</span><span class="ident" id="6878842">err</span><span class="op" id="6878845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878850">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878855">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878870">s</span>&nbsp;<span class="op" id="6878872">:=</span>&nbsp;<span class="ident" id="6878875">b</span><span class="op" id="6878876">.</span><span class="ident" id="6878877">String</span><span class="op" id="6878883">(</span><span class="op" id="6878884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6878888">if</span>&nbsp;<span class="ident" id="6878891">s</span>&nbsp;<span class="op" id="6878893">!=</span>&nbsp;<span class="ident" id="6878896">tt</span><span class="op" id="6878898">.</span><span class="ident" id="6878899">raw</span>&nbsp;<span class="op" id="6878903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6878908">t</span><span class="op" id="6878909">.</span><span class="ident" id="6878910">Errorf</span><span class="op" id="6878916">(</span><span class="string" id="6878917">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="6878953">,</span>&nbsp;<span class="ident" id="6878955">tt</span><span class="op" id="6878957">.</span><span class="ident" id="6878958">desc</span><span class="op" id="6878962">,</span>&nbsp;<span class="ident" id="6878964">n</span><span class="op" id="6878965">,</span>&nbsp;<span class="ident" id="6878967">s</span><span class="op" id="6878968">,</span>&nbsp;<span class="builtinfunc" id="6878970">len</span><span class="op" id="6878973">(</span><span class="ident" id="6878974">tt</span><span class="op" id="6878976">.</span><span class="ident" id="6878977">raw</span><span class="op" id="6878980">)</span><span class="op" id="6878981">,</span>&nbsp;<span class="ident" id="6878983">tt</span><span class="op" id="6878985">.</span><span class="ident" id="6878986">raw</span><span class="op" id="6878989">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6878996">}</span><br>
<span class="lineno"></span><span class="op" id="6878998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6879001">func</span>&nbsp;<span class="ident" id="6879006">benchmarkDecoder</span><span class="op" id="6879022">(</span><span class="ident" id="6879023">b</span>&nbsp;<span class="op" id="6879025">*</span><span class="ident" id="6879026">testing</span><span class="op" id="6879033">.</span><span class="ident" id="6879034">B</span><span class="op" id="6879035">,</span>&nbsp;<span class="ident" id="6879037">n</span>&nbsp;<span class="builtintype" id="6879039">int</span><span class="op" id="6879042">)</span>&nbsp;<span class="op" id="6879044">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879047">b</span><span class="op" id="6879048">.</span><span class="ident" id="6879049">StopTimer</span><span class="op" id="6879058">(</span><span class="op" id="6879059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879062">b</span><span class="op" id="6879063">.</span><span class="ident" id="6879064">SetBytes</span><span class="op" id="6879072">(</span><span class="ident" id="6879073">int64</span><span class="op" id="6879078">(</span><span class="ident" id="6879079">n</span><span class="op" id="6879080">)</span><span class="op" id="6879081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879084">buf0</span><span class="op" id="6879088">,</span>&nbsp;<span class="ident" id="6879090">err</span>&nbsp;<span class="op" id="6879094">:=</span>&nbsp;<span class="ident" id="6879097">ioutil</span><span class="op" id="6879103">.</span><span class="ident" id="6879104">ReadFile</span><span class="op" id="6879112">(</span><span class="string" id="6879113">&#34;../testdata/e.txt&#34;</span><span class="op" id="6879132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879135">if</span>&nbsp;<span class="ident" id="6879138">err</span>&nbsp;<span class="op" id="6879142">!=</span>&nbsp;<span class="builtintype" id="6879145">nil</span>&nbsp;<span class="op" id="6879149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879153">b</span><span class="op" id="6879154">.</span><span class="ident" id="6879155">Fatal</span><span class="op" id="6879160">(</span><span class="ident" id="6879161">err</span><span class="op" id="6879164">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879170">if</span>&nbsp;<span class="builtinfunc" id="6879173">len</span><span class="op" id="6879176">(</span><span class="ident" id="6879177">buf0</span><span class="op" id="6879181">)</span>&nbsp;<span class="op" id="6879183">==</span>&nbsp;<span class="num" id="6879186">0</span>&nbsp;<span class="op" id="6879188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879192">b</span><span class="op" id="6879193">.</span><span class="ident" id="6879194">Fatalf</span><span class="op" id="6879200">(</span><span class="string" id="6879201">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="6879224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879230">compressed</span>&nbsp;<span class="op" id="6879241">:=</span>&nbsp;<span class="builtinfunc" id="6879244">new</span><span class="op" id="6879247">(</span><span class="ident" id="6879248">bytes</span><span class="op" id="6879253">.</span><span class="ident" id="6879254">Buffer</span><span class="op" id="6879260">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879263">w</span>&nbsp;<span class="op" id="6879265">:=</span>&nbsp;<span class="ident" id="6879268">NewWriter</span><span class="op" id="6879277">(</span><span class="ident" id="6879278">compressed</span><span class="op" id="6879288">,</span>&nbsp;<span class="ident" id="6879290">LSB</span><span class="op" id="6879293">,</span>&nbsp;<span class="num" id="6879295">8</span><span class="op" id="6879296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879299">for</span>&nbsp;<span class="ident" id="6879303">i</span>&nbsp;<span class="op" id="6879305">:=</span>&nbsp;<span class="num" id="6879308">0</span><span class="op" id="6879309">;</span>&nbsp;<span class="ident" id="6879311">i</span>&nbsp;<span class="op" id="6879313">&lt;</span>&nbsp;<span class="ident" id="6879315">n</span><span class="op" id="6879316">;</span>&nbsp;<span class="ident" id="6879318">i</span>&nbsp;<span class="op" id="6879320">+=</span>&nbsp;<span class="builtinfunc" id="6879323">len</span><span class="op" id="6879326">(</span><span class="ident" id="6879327">buf0</span><span class="op" id="6879331">)</span>&nbsp;<span class="op" id="6879333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879337">if</span>&nbsp;<span class="builtinfunc" id="6879340">len</span><span class="op" id="6879343">(</span><span class="ident" id="6879344">buf0</span><span class="op" id="6879348">)</span>&nbsp;<span class="op" id="6879350">&gt;</span>&nbsp;<span class="ident" id="6879352">n</span><span class="op" id="6879353">-</span><span class="ident" id="6879354">i</span>&nbsp;<span class="op" id="6879356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879361">buf0</span>&nbsp;<span class="op" id="6879366">=</span>&nbsp;<span class="ident" id="6879368">buf0</span><span class="op" id="6879372">[</span><span class="op" id="6879373">:</span><span class="ident" id="6879374">n</span><span class="op" id="6879375">-</span><span class="ident" id="6879376">i</span><span class="op" id="6879377">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879381">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879385">w</span><span class="op" id="6879386">.</span><span class="ident" id="6879387">Write</span><span class="op" id="6879392">(</span><span class="ident" id="6879393">buf0</span><span class="op" id="6879397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879403">w</span><span class="op" id="6879404">.</span><span class="ident" id="6879405">Close</span><span class="op" id="6879410">(</span><span class="op" id="6879411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879414">buf1</span>&nbsp;<span class="op" id="6879419">:=</span>&nbsp;<span class="ident" id="6879422">compressed</span><span class="op" id="6879432">.</span><span class="ident" id="6879433">Bytes</span><span class="op" id="6879438">(</span><span class="op" id="6879439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879442">buf0</span><span class="op" id="6879446">,</span>&nbsp;<span class="ident" id="6879448">compressed</span><span class="op" id="6879458">,</span>&nbsp;<span class="ident" id="6879460">w</span>&nbsp;<span class="op" id="6879462">=</span>&nbsp;<span class="builtintype" id="6879464">nil</span><span class="op" id="6879467">,</span>&nbsp;<span class="builtintype" id="6879469">nil</span><span class="op" id="6879472">,</span>&nbsp;<span class="builtintype" id="6879474">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879479">runtime</span><span class="op" id="6879486">.</span><span class="ident" id="6879487">GC</span><span class="op" id="6879489">(</span><span class="op" id="6879490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879493">b</span><span class="op" id="6879494">.</span><span class="ident" id="6879495">StartTimer</span><span class="op" id="6879505">(</span><span class="op" id="6879506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6879509">for</span>&nbsp;<span class="ident" id="6879513">i</span>&nbsp;<span class="op" id="6879515">:=</span>&nbsp;<span class="num" id="6879518">0</span><span class="op" id="6879519">;</span>&nbsp;<span class="ident" id="6879521">i</span>&nbsp;<span class="op" id="6879523">&lt;</span>&nbsp;<span class="ident" id="6879525">b</span><span class="op" id="6879526">.</span><span class="ident" id="6879527">N</span><span class="op" id="6879528">;</span>&nbsp;<span class="ident" id="6879530">i</span><span class="op" id="6879531">++</span>&nbsp;<span class="op" id="6879534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879538">io</span><span class="op" id="6879540">.</span><span class="ident" id="6879541">Copy</span><span class="op" id="6879545">(</span><span class="ident" id="6879546">ioutil</span><span class="op" id="6879552">.</span><span class="ident" id="6879553">Discard</span><span class="op" id="6879560">,</span>&nbsp;<span class="ident" id="6879562">NewReader</span><span class="op" id="6879571">(</span><span class="ident" id="6879572">bytes</span><span class="op" id="6879577">.</span><span class="ident" id="6879578">NewReader</span><span class="op" id="6879587">(</span><span class="ident" id="6879588">buf1</span><span class="op" id="6879592">)</span><span class="op" id="6879593">,</span>&nbsp;<span class="ident" id="6879595">LSB</span><span class="op" id="6879598">,</span>&nbsp;<span class="num" id="6879600">8</span><span class="op" id="6879601">)</span><span class="op" id="6879602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6879605">}</span><br>
<span class="lineno">140</span><span class="op" id="6879607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6879610">func</span>&nbsp;<span class="ident" id="6879615">BenchmarkDecoder1e4</span><span class="op" id="6879634">(</span><span class="ident" id="6879635">b</span>&nbsp;<span class="op" id="6879637">*</span><span class="ident" id="6879638">testing</span><span class="op" id="6879645">.</span><span class="ident" id="6879646">B</span><span class="op" id="6879647">)</span>&nbsp;<span class="op" id="6879649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879652">benchmarkDecoder</span><span class="op" id="6879668">(</span><span class="ident" id="6879669">b</span><span class="op" id="6879670">,</span>&nbsp;<span class="num" id="6879672">1e4</span><span class="op" id="6879675">)</span><br>
<span class="lineno"></span><span class="op" id="6879677">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6879680">func</span>&nbsp;<span class="ident" id="6879685">BenchmarkDecoder1e5</span><span class="op" id="6879704">(</span><span class="ident" id="6879705">b</span>&nbsp;<span class="op" id="6879707">*</span><span class="ident" id="6879708">testing</span><span class="op" id="6879715">.</span><span class="ident" id="6879716">B</span><span class="op" id="6879717">)</span>&nbsp;<span class="op" id="6879719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879722">benchmarkDecoder</span><span class="op" id="6879738">(</span><span class="ident" id="6879739">b</span><span class="op" id="6879740">,</span>&nbsp;<span class="num" id="6879742">1e5</span><span class="op" id="6879745">)</span><br>
<span class="lineno"></span><span class="op" id="6879747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6879750">func</span>&nbsp;<span class="ident" id="6879755">BenchmarkDecoder1e6</span><span class="op" id="6879774">(</span><span class="ident" id="6879775">b</span>&nbsp;<span class="op" id="6879777">*</span><span class="ident" id="6879778">testing</span><span class="op" id="6879785">.</span><span class="ident" id="6879786">B</span><span class="op" id="6879787">)</span>&nbsp;<span class="op" id="6879789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6879792">benchmarkDecoder</span><span class="op" id="6879808">(</span><span class="ident" id="6879809">b</span><span class="op" id="6879810">,</span>&nbsp;<span class="num" id="6879812">1e6</span><span class="op" id="6879815">)</span><br>
<span class="lineno"></span><span class="op" id="6879817">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
