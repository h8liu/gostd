<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1665875">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1665930">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1665984">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1666035">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1666090">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1666128">package</span>&nbsp;<span class="ident" id="1666136">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1666140">import</span>&nbsp;<span class="op" id="1666147">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1666150">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1666160">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1666167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1666170">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1666252">var</span>&nbsp;<span class="ident" id="1666256">ErrClosedPipe</span>&nbsp;<span class="op" id="1666270">=</span>&nbsp;<span class="ident" id="1666272"><a href="/io/pipe.go.html#1666150">errors</a></span><span class="op" id="1666278">.</span><span class="ident" id="1666279">New</span><span class="op" id="1666282">(</span><span class="string" id="1666283">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1666314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1666317">type</span>&nbsp;<span class="ident" id="1666322">pipeResult</span>&nbsp;<span class="keyword" id="1666333">struct</span>&nbsp;<span class="op" id="1666340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666343">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1666347">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666352">err</span>&nbsp;<span class="builtintype" id="1666356">error</span><br>
<span class="lineno"></span><span class="op" id="1666362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1666365">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1666442">type</span>&nbsp;<span class="ident" id="1666447">pipe</span>&nbsp;<span class="keyword" id="1666452">struct</span>&nbsp;<span class="op" id="1666459">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666462">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1666468"><a href="/io/pipe.go.html#1666160">sync</a></span><span class="op" id="1666472">.</span><span class="ident" id="1666473">Mutex</span>&nbsp;<span class="comment" id="1666479">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666511">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1666517"><a href="/io/pipe.go.html#1666160">sync</a></span><span class="op" id="1666521">.</span><span class="ident" id="1666522">Mutex</span>&nbsp;<span class="comment" id="1666528">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666560">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1666566"><a href="/io/pipe.go.html#1666160">sync</a></span><span class="op" id="1666570">.</span><span class="ident" id="1666571">Mutex</span>&nbsp;<span class="comment" id="1666577">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666607">data</span>&nbsp;&nbsp;<span class="op" id="1666613">[</span><span class="op" id="1666614">]</span><span class="builtintype" id="1666615">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1666624">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666660">rwait</span>&nbsp;<span class="ident" id="1666666"><a href="/io/pipe.go.html#1666160">sync</a></span><span class="op" id="1666670">.</span><span class="ident" id="1666671">Cond</span>&nbsp;&nbsp;<span class="comment" id="1666677">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666696">wwait</span>&nbsp;<span class="ident" id="1666702"><a href="/io/pipe.go.html#1666160">sync</a></span><span class="op" id="1666706">.</span><span class="ident" id="1666707">Cond</span>&nbsp;&nbsp;<span class="comment" id="1666713">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666732">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1666738">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1666749">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666792">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1666798">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1666809">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1666850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1666853">func</span>&nbsp;<span class="op" id="1666858">(</span><span class="ident" id="1666859">p</span>&nbsp;<span class="op" id="1666861">*</span><span class="ident" id="1666862"><a href="/io/pipe.go.html#1666447">pipe</a></span><span class="op" id="1666866">)</span>&nbsp;<span class="ident" id="1666868">read</span><span class="op" id="1666872">(</span><span class="ident" id="1666873">b</span>&nbsp;<span class="op" id="1666875">[</span><span class="op" id="1666876">]</span><span class="builtintype" id="1666877">byte</span><span class="op" id="1666881">)</span>&nbsp;<span class="op" id="1666883">(</span><span class="ident" id="1666884">n</span>&nbsp;<span class="builtintype" id="1666886">int</span><span class="op" id="1666889">,</span>&nbsp;<span class="ident" id="1666891">err</span>&nbsp;<span class="builtintype" id="1666895">error</span><span class="op" id="1666900">)</span>&nbsp;<span class="op" id="1666902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1666905">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666931"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1666932">.</span><span class="ident" id="1666933">rl</span><span class="op" id="1666935">.</span><span class="ident" id="1666936">Lock</span><span class="op" id="1666940">(</span><span class="op" id="1666941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1666944">defer</span>&nbsp;<span class="ident" id="1666950"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1666951">.</span><span class="ident" id="1666952">rl</span><span class="op" id="1666954">.</span><span class="ident" id="1666955">Unlock</span><span class="op" id="1666961">(</span><span class="op" id="1666962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666966"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1666967">.</span><span class="ident" id="1666968">l</span><span class="op" id="1666969">.</span><span class="ident" id="1666970">Lock</span><span class="op" id="1666974">(</span><span class="op" id="1666975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1666978">defer</span>&nbsp;<span class="ident" id="1666984"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1666985">.</span><span class="ident" id="1666986">l</span><span class="op" id="1666987">.</span><span class="ident" id="1666988">Unlock</span><span class="op" id="1666994">(</span><span class="op" id="1666995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1666998">for</span>&nbsp;<span class="op" id="1667002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667006">if</span>&nbsp;<span class="ident" id="1667009"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667010">.</span><span class="ident" id="1667011">rerr</span>&nbsp;<span class="op" id="1667016">!=</span>&nbsp;<span class="ident" id="1667019">nil</span>&nbsp;<span class="op" id="1667023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667028">return</span>&nbsp;<span class="num" id="1667035">0</span><span class="op" id="1667036">,</span>&nbsp;<span class="ident" id="1667038"><a href="/io/pipe.go.html#1666256">ErrClosedPipe</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667058">if</span>&nbsp;<span class="ident" id="1667061"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667062">.</span><span class="ident" id="1667063">data</span>&nbsp;<span class="op" id="1667068">!=</span>&nbsp;<span class="ident" id="1667071">nil</span>&nbsp;<span class="op" id="1667075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667092">if</span>&nbsp;<span class="ident" id="1667095"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667096">.</span><span class="ident" id="1667097">werr</span>&nbsp;<span class="op" id="1667102">!=</span>&nbsp;<span class="ident" id="1667105">nil</span>&nbsp;<span class="op" id="1667109">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667114">return</span>&nbsp;<span class="num" id="1667121">0</span><span class="op" id="1667122">,</span>&nbsp;<span class="ident" id="1667124"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667125">.</span><span class="ident" id="1667126">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667137"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667138">.</span><span class="ident" id="1667139">rwait</span><span class="op" id="1667144">.</span><span class="ident" id="1667145">Wait</span><span class="op" id="1667149">(</span><span class="op" id="1667150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667156"><a href="/io/pipe.go.html#1666884">n</a></span>&nbsp;<span class="op" id="1667158">=</span>&nbsp;<span class="builtinfunc" id="1667160">copy</span><span class="op" id="1667164">(</span><span class="ident" id="1667165"><a href="/io/pipe.go.html#1666873">b</a></span><span class="op" id="1667166">,</span>&nbsp;<span class="ident" id="1667168"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667169">.</span><span class="ident" id="1667170">data</span><span class="op" id="1667174">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667177"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667178">.</span><span class="ident" id="1667179">data</span>&nbsp;<span class="op" id="1667184">=</span>&nbsp;<span class="ident" id="1667186"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667187">.</span><span class="ident" id="1667188">data</span><span class="op" id="1667192">[</span><span class="ident" id="1667193"><a href="/io/pipe.go.html#1666884">n</a></span><span class="op" id="1667194">:</span><span class="op" id="1667195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667198">if</span>&nbsp;<span class="builtinfunc" id="1667201">len</span><span class="op" id="1667204">(</span><span class="ident" id="1667205"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667206">.</span><span class="ident" id="1667207">data</span><span class="op" id="1667211">)</span>&nbsp;<span class="op" id="1667213">==</span>&nbsp;<span class="num" id="1667216">0</span>&nbsp;<span class="op" id="1667218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667222"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667223">.</span><span class="ident" id="1667224">data</span>&nbsp;<span class="op" id="1667229">=</span>&nbsp;<span class="ident" id="1667231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667237"><a href="/io/pipe.go.html#1666859">p</a></span><span class="op" id="1667238">.</span><span class="ident" id="1667239">wwait</span><span class="op" id="1667244">.</span><span class="ident" id="1667245">Signal</span><span class="op" id="1667251">(</span><span class="op" id="1667252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667255">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667258">return</span><br>
<span class="lineno"></span><span class="op" id="1667265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1667268">var</span>&nbsp;<span class="ident" id="1667272">zero</span>&nbsp;<span class="op" id="1667277">[</span><span class="num" id="1667278">0</span><span class="op" id="1667279">]</span><span class="builtintype" id="1667280">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1667286">func</span>&nbsp;<span class="op" id="1667291">(</span><span class="ident" id="1667292">p</span>&nbsp;<span class="op" id="1667294">*</span><span class="ident" id="1667295"><a href="/io/pipe.go.html#1666447">pipe</a></span><span class="op" id="1667299">)</span>&nbsp;<span class="ident" id="1667301">write</span><span class="op" id="1667306">(</span><span class="ident" id="1667307">b</span>&nbsp;<span class="op" id="1667309">[</span><span class="op" id="1667310">]</span><span class="builtintype" id="1667311">byte</span><span class="op" id="1667315">)</span>&nbsp;<span class="op" id="1667317">(</span><span class="ident" id="1667318">n</span>&nbsp;<span class="builtintype" id="1667320">int</span><span class="op" id="1667323">,</span>&nbsp;<span class="ident" id="1667325">err</span>&nbsp;<span class="builtintype" id="1667329">error</span><span class="op" id="1667334">)</span>&nbsp;<span class="op" id="1667336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667339">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667379">if</span>&nbsp;<span class="ident" id="1667382"><a href="/io/pipe.go.html#1667307">b</a></span>&nbsp;<span class="op" id="1667384">==</span>&nbsp;<span class="ident" id="1667387">nil</span>&nbsp;<span class="op" id="1667391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667395"><a href="/io/pipe.go.html#1667307">b</a></span>&nbsp;<span class="op" id="1667397">=</span>&nbsp;<span class="ident" id="1667399"><a href="/io/pipe.go.html#1667272">zero</a></span><span class="op" id="1667403">[</span><span class="op" id="1667404">:</span><span class="op" id="1667405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667408">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667412">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667438"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667439">.</span><span class="ident" id="1667440">wl</span><span class="op" id="1667442">.</span><span class="ident" id="1667443">Lock</span><span class="op" id="1667447">(</span><span class="op" id="1667448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667451">defer</span>&nbsp;<span class="ident" id="1667457"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667458">.</span><span class="ident" id="1667459">wl</span><span class="op" id="1667461">.</span><span class="ident" id="1667462">Unlock</span><span class="op" id="1667468">(</span><span class="op" id="1667469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667473"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667474">.</span><span class="ident" id="1667475">l</span><span class="op" id="1667476">.</span><span class="ident" id="1667477">Lock</span><span class="op" id="1667481">(</span><span class="op" id="1667482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667485">defer</span>&nbsp;<span class="ident" id="1667491"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667492">.</span><span class="ident" id="1667493">l</span><span class="op" id="1667494">.</span><span class="ident" id="1667495">Unlock</span><span class="op" id="1667501">(</span><span class="op" id="1667502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667505">if</span>&nbsp;<span class="ident" id="1667508"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667509">.</span><span class="ident" id="1667510">werr</span>&nbsp;<span class="op" id="1667515">!=</span>&nbsp;<span class="ident" id="1667518">nil</span>&nbsp;<span class="op" id="1667522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667526"><a href="/io/pipe.go.html#1667325">err</a></span>&nbsp;<span class="op" id="1667530">=</span>&nbsp;<span class="ident" id="1667532"><a href="/io/pipe.go.html#1666256">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667548">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667559"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667560">.</span><span class="ident" id="1667561">data</span>&nbsp;<span class="op" id="1667566">=</span>&nbsp;<span class="ident" id="1667568"><a href="/io/pipe.go.html#1667307">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667571"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667572">.</span><span class="ident" id="1667573">rwait</span><span class="op" id="1667578">.</span><span class="ident" id="1667579">Signal</span><span class="op" id="1667585">(</span><span class="op" id="1667586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667589">for</span>&nbsp;<span class="op" id="1667593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667597">if</span>&nbsp;<span class="ident" id="1667600"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667601">.</span><span class="ident" id="1667602">data</span>&nbsp;<span class="op" id="1667607">==</span>&nbsp;<span class="ident" id="1667610">nil</span>&nbsp;<span class="op" id="1667614">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667619">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667631">if</span>&nbsp;<span class="ident" id="1667634"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667635">.</span><span class="ident" id="1667636">rerr</span>&nbsp;<span class="op" id="1667641">!=</span>&nbsp;<span class="ident" id="1667644">nil</span>&nbsp;<span class="op" id="1667648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667653"><a href="/io/pipe.go.html#1667325">err</a></span>&nbsp;<span class="op" id="1667657">=</span>&nbsp;<span class="ident" id="1667659"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667660">.</span><span class="ident" id="1667661">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667669">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667681">if</span>&nbsp;<span class="ident" id="1667684"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667685">.</span><span class="ident" id="1667686">werr</span>&nbsp;<span class="op" id="1667691">!=</span>&nbsp;<span class="ident" id="1667694">nil</span>&nbsp;<span class="op" id="1667698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667703"><a href="/io/pipe.go.html#1667325">err</a></span>&nbsp;<span class="op" id="1667707">=</span>&nbsp;<span class="ident" id="1667709"><a href="/io/pipe.go.html#1666256">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667729"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667730">.</span><span class="ident" id="1667731">wwait</span><span class="op" id="1667736">.</span><span class="ident" id="1667737">Wait</span><span class="op" id="1667741">(</span><span class="op" id="1667742">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667748"><a href="/io/pipe.go.html#1667318">n</a></span>&nbsp;<span class="op" id="1667750">=</span>&nbsp;<span class="builtinfunc" id="1667752">len</span><span class="op" id="1667755">(</span><span class="ident" id="1667756"><a href="/io/pipe.go.html#1667307">b</a></span><span class="op" id="1667757">)</span>&nbsp;<span class="op" id="1667759">-</span>&nbsp;<span class="builtinfunc" id="1667761">len</span><span class="op" id="1667764">(</span><span class="ident" id="1667765"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667766">.</span><span class="ident" id="1667767">data</span><span class="op" id="1667771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667774"><a href="/io/pipe.go.html#1667292">p</a></span><span class="op" id="1667775">.</span><span class="ident" id="1667776">data</span>&nbsp;<span class="op" id="1667781">=</span>&nbsp;<span class="ident" id="1667783">nil</span>&nbsp;<span class="comment" id="1667787">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667815">return</span><br>
<span class="lineno"></span><span class="op" id="1667822">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1667825">func</span>&nbsp;<span class="op" id="1667830">(</span><span class="ident" id="1667831">p</span>&nbsp;<span class="op" id="1667833">*</span><span class="ident" id="1667834"><a href="/io/pipe.go.html#1666447">pipe</a></span><span class="op" id="1667838">)</span>&nbsp;<span class="ident" id="1667840">rclose</span><span class="op" id="1667846">(</span><span class="ident" id="1667847">err</span>&nbsp;<span class="builtintype" id="1667851">error</span><span class="op" id="1667856">)</span>&nbsp;<span class="op" id="1667858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667861">if</span>&nbsp;<span class="ident" id="1667864"><a href="/io/pipe.go.html#1667847">err</a></span>&nbsp;<span class="op" id="1667868">==</span>&nbsp;<span class="ident" id="1667871">nil</span>&nbsp;<span class="op" id="1667875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667879"><a href="/io/pipe.go.html#1667847">err</a></span>&nbsp;<span class="op" id="1667883">=</span>&nbsp;<span class="ident" id="1667885"><a href="/io/pipe.go.html#1666256">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1667900">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667903"><a href="/io/pipe.go.html#1667831">p</a></span><span class="op" id="1667904">.</span><span class="ident" id="1667905">l</span><span class="op" id="1667906">.</span><span class="ident" id="1667907">Lock</span><span class="op" id="1667911">(</span><span class="op" id="1667912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1667915">defer</span>&nbsp;<span class="ident" id="1667921"><a href="/io/pipe.go.html#1667831">p</a></span><span class="op" id="1667922">.</span><span class="ident" id="1667923">l</span><span class="op" id="1667924">.</span><span class="ident" id="1667925">Unlock</span><span class="op" id="1667931">(</span><span class="op" id="1667932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667935"><a href="/io/pipe.go.html#1667831">p</a></span><span class="op" id="1667936">.</span><span class="ident" id="1667937">rerr</span>&nbsp;<span class="op" id="1667942">=</span>&nbsp;<span class="ident" id="1667944"><a href="/io/pipe.go.html#1667847">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667949"><a href="/io/pipe.go.html#1667831">p</a></span><span class="op" id="1667950">.</span><span class="ident" id="1667951">rwait</span><span class="op" id="1667956">.</span><span class="ident" id="1667957">Signal</span><span class="op" id="1667963">(</span><span class="op" id="1667964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667967"><a href="/io/pipe.go.html#1667831">p</a></span><span class="op" id="1667968">.</span><span class="ident" id="1667969">wwait</span><span class="op" id="1667974">.</span><span class="ident" id="1667975">Signal</span><span class="op" id="1667981">(</span><span class="op" id="1667982">)</span><br>
<span class="lineno">110</span><span class="op" id="1667984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1667987">func</span>&nbsp;<span class="op" id="1667992">(</span><span class="ident" id="1667993">p</span>&nbsp;<span class="op" id="1667995">*</span><span class="ident" id="1667996"><a href="/io/pipe.go.html#1666447">pipe</a></span><span class="op" id="1668000">)</span>&nbsp;<span class="ident" id="1668002">wclose</span><span class="op" id="1668008">(</span><span class="ident" id="1668009">err</span>&nbsp;<span class="builtintype" id="1668013">error</span><span class="op" id="1668018">)</span>&nbsp;<span class="op" id="1668020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668023">if</span>&nbsp;<span class="ident" id="1668026"><a href="/io/pipe.go.html#1668009">err</a></span>&nbsp;<span class="op" id="1668030">==</span>&nbsp;<span class="ident" id="1668033">nil</span>&nbsp;<span class="op" id="1668037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668041"><a href="/io/pipe.go.html#1668009">err</a></span>&nbsp;<span class="op" id="1668045">=</span>&nbsp;<span class="ident" id="1668047"><a href="/io/io.go.html#1649917">EOF</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668055"><a href="/io/pipe.go.html#1667993">p</a></span><span class="op" id="1668056">.</span><span class="ident" id="1668057">l</span><span class="op" id="1668058">.</span><span class="ident" id="1668059">Lock</span><span class="op" id="1668063">(</span><span class="op" id="1668064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668067">defer</span>&nbsp;<span class="ident" id="1668073"><a href="/io/pipe.go.html#1667993">p</a></span><span class="op" id="1668074">.</span><span class="ident" id="1668075">l</span><span class="op" id="1668076">.</span><span class="ident" id="1668077">Unlock</span><span class="op" id="1668083">(</span><span class="op" id="1668084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668087"><a href="/io/pipe.go.html#1667993">p</a></span><span class="op" id="1668088">.</span><span class="ident" id="1668089">werr</span>&nbsp;<span class="op" id="1668094">=</span>&nbsp;<span class="ident" id="1668096"><a href="/io/pipe.go.html#1668009">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668101"><a href="/io/pipe.go.html#1667993">p</a></span><span class="op" id="1668102">.</span><span class="ident" id="1668103">rwait</span><span class="op" id="1668108">.</span><span class="ident" id="1668109">Signal</span><span class="op" id="1668115">(</span><span class="op" id="1668116">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668119"><a href="/io/pipe.go.html#1667993">p</a></span><span class="op" id="1668120">.</span><span class="ident" id="1668121">wwait</span><span class="op" id="1668126">.</span><span class="ident" id="1668127">Signal</span><span class="op" id="1668133">(</span><span class="op" id="1668134">)</span><br>
<span class="lineno"></span><span class="op" id="1668136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1668139">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1668183">type</span>&nbsp;<span class="ident" id="1668188">PipeReader</span>&nbsp;<span class="keyword" id="1668199">struct</span>&nbsp;<span class="op" id="1668206">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668209">p</span>&nbsp;<span class="op" id="1668211">*</span><span class="ident" id="1668212"><a href="/io/pipe.go.html#1666447">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="1668217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1668220">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1668268">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1668324">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1668363">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1668422">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1668464">func</span>&nbsp;<span class="op" id="1668469">(</span><span class="ident" id="1668470">r</span>&nbsp;<span class="op" id="1668472">*</span><span class="ident" id="1668473"><a href="/io/pipe.go.html#1668188">PipeReader</a></span><span class="op" id="1668483">)</span>&nbsp;<span class="ident" id="1668485">Read</span><span class="op" id="1668489">(</span><span class="ident" id="1668490">data</span>&nbsp;<span class="op" id="1668495">[</span><span class="op" id="1668496">]</span><span class="builtintype" id="1668497">byte</span><span class="op" id="1668501">)</span>&nbsp;<span class="op" id="1668503">(</span><span class="ident" id="1668504">n</span>&nbsp;<span class="builtintype" id="1668506">int</span><span class="op" id="1668509">,</span>&nbsp;<span class="ident" id="1668511">err</span>&nbsp;<span class="builtintype" id="1668515">error</span><span class="op" id="1668520">)</span>&nbsp;<span class="op" id="1668522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668525">return</span>&nbsp;<span class="ident" id="1668532"><a href="/io/pipe.go.html#1668470">r</a></span><span class="op" id="1668533">.</span><span class="ident" id="1668534">p</span><span class="op" id="1668535">.</span><span class="ident" id="1668536">read</span><span class="op" id="1668540">(</span><span class="ident" id="1668541"><a href="/io/pipe.go.html#1668490">data</a></span><span class="op" id="1668545">)</span><br>
<span class="lineno">135</span><span class="op" id="1668547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1668550">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1668603">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1668666">func</span>&nbsp;<span class="op" id="1668671">(</span><span class="ident" id="1668672">r</span>&nbsp;<span class="op" id="1668674">*</span><span class="ident" id="1668675"><a href="/io/pipe.go.html#1668188">PipeReader</a></span><span class="op" id="1668685">)</span>&nbsp;<span class="ident" id="1668687">Close</span><span class="op" id="1668692">(</span><span class="op" id="1668693">)</span>&nbsp;<span class="builtintype" id="1668695">error</span>&nbsp;<span class="op" id="1668701">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668704">return</span>&nbsp;<span class="ident" id="1668711"><a href="/io/pipe.go.html#1668672">r</a></span><span class="op" id="1668712">.</span><span class="ident" id="1668713">CloseWithError</span><span class="op" id="1668727">(</span><span class="ident" id="1668728">nil</span><span class="op" id="1668731">)</span><br>
<span class="lineno"></span><span class="op" id="1668733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1668736">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1668791">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1668851">func</span>&nbsp;<span class="op" id="1668856">(</span><span class="ident" id="1668857">r</span>&nbsp;<span class="op" id="1668859">*</span><span class="ident" id="1668860"><a href="/io/pipe.go.html#1668188">PipeReader</a></span><span class="op" id="1668870">)</span>&nbsp;<span class="ident" id="1668872">CloseWithError</span><span class="op" id="1668886">(</span><span class="ident" id="1668887">err</span>&nbsp;<span class="builtintype" id="1668891">error</span><span class="op" id="1668896">)</span>&nbsp;<span class="builtintype" id="1668898">error</span>&nbsp;<span class="op" id="1668904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668907"><a href="/io/pipe.go.html#1668857">r</a></span><span class="op" id="1668908">.</span><span class="ident" id="1668909">p</span><span class="op" id="1668910">.</span><span class="ident" id="1668911">rclose</span><span class="op" id="1668917">(</span><span class="ident" id="1668918"><a href="/io/pipe.go.html#1668887">err</a></span><span class="op" id="1668921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668924">return</span>&nbsp;<span class="ident" id="1668931">nil</span><br>
<span class="lineno"></span><span class="op" id="1668935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1668938">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1668983">type</span>&nbsp;<span class="ident" id="1668988">PipeWriter</span>&nbsp;<span class="keyword" id="1668999">struct</span>&nbsp;<span class="op" id="1669006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669009">p</span>&nbsp;<span class="op" id="1669011">*</span><span class="ident" id="1669012"><a href="/io/pipe.go.html#1666447">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="1669017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1669020">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1669070">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1669124">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1669181">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1669237">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1669289">func</span>&nbsp;<span class="op" id="1669294">(</span><span class="ident" id="1669295">w</span>&nbsp;<span class="op" id="1669297">*</span><span class="ident" id="1669298"><a href="/io/pipe.go.html#1668988">PipeWriter</a></span><span class="op" id="1669308">)</span>&nbsp;<span class="ident" id="1669310">Write</span><span class="op" id="1669315">(</span><span class="ident" id="1669316">data</span>&nbsp;<span class="op" id="1669321">[</span><span class="op" id="1669322">]</span><span class="builtintype" id="1669323">byte</span><span class="op" id="1669327">)</span>&nbsp;<span class="op" id="1669329">(</span><span class="ident" id="1669330">n</span>&nbsp;<span class="builtintype" id="1669332">int</span><span class="op" id="1669335">,</span>&nbsp;<span class="ident" id="1669337">err</span>&nbsp;<span class="builtintype" id="1669341">error</span><span class="op" id="1669346">)</span>&nbsp;<span class="op" id="1669348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669351">return</span>&nbsp;<span class="ident" id="1669358"><a href="/io/pipe.go.html#1669295">w</a></span><span class="op" id="1669359">.</span><span class="ident" id="1669360">p</span><span class="op" id="1669361">.</span><span class="ident" id="1669362">write</span><span class="op" id="1669367">(</span><span class="ident" id="1669368"><a href="/io/pipe.go.html#1669316">data</a></span><span class="op" id="1669372">)</span><br>
<span class="lineno"></span><span class="op" id="1669374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1669377">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1669431">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1669486">func</span>&nbsp;<span class="op" id="1669491">(</span><span class="ident" id="1669492">w</span>&nbsp;<span class="op" id="1669494">*</span><span class="ident" id="1669495"><a href="/io/pipe.go.html#1668988">PipeWriter</a></span><span class="op" id="1669505">)</span>&nbsp;<span class="ident" id="1669507">Close</span><span class="op" id="1669512">(</span><span class="op" id="1669513">)</span>&nbsp;<span class="builtintype" id="1669515">error</span>&nbsp;<span class="op" id="1669521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669524">return</span>&nbsp;<span class="ident" id="1669531"><a href="/io/pipe.go.html#1669492">w</a></span><span class="op" id="1669532">.</span><span class="ident" id="1669533">CloseWithError</span><span class="op" id="1669547">(</span><span class="ident" id="1669548">nil</span><span class="op" id="1669551">)</span><br>
<span class="lineno"></span><span class="op" id="1669553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1669556">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1669619">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1669684">func</span>&nbsp;<span class="op" id="1669689">(</span><span class="ident" id="1669690">w</span>&nbsp;<span class="op" id="1669692">*</span><span class="ident" id="1669693"><a href="/io/pipe.go.html#1668988">PipeWriter</a></span><span class="op" id="1669703">)</span>&nbsp;<span class="ident" id="1669705">CloseWithError</span><span class="op" id="1669719">(</span><span class="ident" id="1669720">err</span>&nbsp;<span class="builtintype" id="1669724">error</span><span class="op" id="1669729">)</span>&nbsp;<span class="builtintype" id="1669731">error</span>&nbsp;<span class="op" id="1669737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669740"><a href="/io/pipe.go.html#1669690">w</a></span><span class="op" id="1669741">.</span><span class="ident" id="1669742">p</span><span class="op" id="1669743">.</span><span class="ident" id="1669744">wclose</span><span class="op" id="1669750">(</span><span class="ident" id="1669751"><a href="/io/pipe.go.html#1669720">err</a></span><span class="op" id="1669754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669757">return</span>&nbsp;<span class="ident" id="1669764">nil</span><br>
<span class="lineno">175</span><span class="op" id="1669768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1669771">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1669817">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1669874">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1669911">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1669969">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1670043">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1670116">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1670190">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1670243">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1670295">func</span>&nbsp;<span class="ident" id="1670300">Pipe</span><span class="op" id="1670304">(</span><span class="op" id="1670305">)</span>&nbsp;<span class="op" id="1670307">(</span><span class="op" id="1670308">*</span><span class="ident" id="1670309"><a href="/io/pipe.go.html#1668188">PipeReader</a></span><span class="op" id="1670319">,</span>&nbsp;<span class="op" id="1670321">*</span><span class="ident" id="1670322"><a href="/io/pipe.go.html#1668988">PipeWriter</a></span><span class="op" id="1670332">)</span>&nbsp;<span class="op" id="1670334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670337">p</span>&nbsp;<span class="op" id="1670339">:=</span>&nbsp;<span class="builtinfunc" id="1670342">new</span><span class="op" id="1670345">(</span><span class="ident" id="1670346"><a href="/io/pipe.go.html#1666447">pipe</a></span><span class="op" id="1670350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670353"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670354">.</span><span class="ident" id="1670355">rwait</span><span class="op" id="1670360">.</span><span class="ident" id="1670361">L</span>&nbsp;<span class="op" id="1670363">=</span>&nbsp;<span class="op" id="1670365">&amp;</span><span class="ident" id="1670366"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670367">.</span><span class="ident" id="1670368">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670371"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670372">.</span><span class="ident" id="1670373">wwait</span><span class="op" id="1670378">.</span><span class="ident" id="1670379">L</span>&nbsp;<span class="op" id="1670381">=</span>&nbsp;<span class="op" id="1670383">&amp;</span><span class="ident" id="1670384"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670385">.</span><span class="ident" id="1670386">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670389">r</span>&nbsp;<span class="op" id="1670391">:=</span>&nbsp;<span class="op" id="1670394">&amp;</span><span class="ident" id="1670395"><a href="/io/pipe.go.html#1668188">PipeReader</a></span><span class="op" id="1670405">{</span><span class="ident" id="1670406"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670410">w</span>&nbsp;<span class="op" id="1670412">:=</span>&nbsp;<span class="op" id="1670415">&amp;</span><span class="ident" id="1670416"><a href="/io/pipe.go.html#1668988">PipeWriter</a></span><span class="op" id="1670426">{</span><span class="ident" id="1670427"><a href="/io/pipe.go.html#1670337">p</a></span><span class="op" id="1670428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670431">return</span>&nbsp;<span class="ident" id="1670438"><a href="/io/pipe.go.html#1670389">r</a></span><span class="op" id="1670439">,</span>&nbsp;<span class="ident" id="1670441"><a href="/io/pipe.go.html#1670410">w</a></span><br>
<span class="lineno"></span><span class="op" id="1670443">}</span>
</div>
</body>
</html>
