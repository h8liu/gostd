<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6739923">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6739978">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6740032">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6740083">package</span>&nbsp;<span class="ident" id="6740091">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6740101">import</span>&nbsp;<span class="op" id="6740108">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6740111">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6740120">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6740130">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6740143">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6740154">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="6740176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6740179">func</span>&nbsp;<span class="ident" id="6740184">TestAddParseTree</span><span class="op" id="6740200">(</span><span class="ident" id="6740201">t</span>&nbsp;<span class="op" id="6740203">*</span><span class="ident" id="6740204">testing</span><span class="op" id="6740211">.</span><span class="ident" id="6740212">T</span><span class="op" id="6740213">)</span>&nbsp;<span class="op" id="6740215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740218">root</span>&nbsp;<span class="op" id="6740223">:=</span>&nbsp;<span class="ident" id="6740226">Must</span><span class="op" id="6740230">(</span><span class="ident" id="6740231">New</span><span class="op" id="6740234">(</span><span class="string" id="6740235">&#34;root&#34;</span><span class="op" id="6740241">)</span><span class="op" id="6740242">.</span><span class="ident" id="6740243">Parse</span><span class="op" id="6740248">(</span><span class="string" id="6740249">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="6740308">)</span><span class="op" id="6740309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740312">tree</span><span class="op" id="6740316">,</span>&nbsp;<span class="ident" id="6740318">err</span>&nbsp;<span class="op" id="6740322">:=</span>&nbsp;<span class="ident" id="6740325">parse</span><span class="op" id="6740330">.</span><span class="ident" id="6740331">Parse</span><span class="op" id="6740336">(</span><span class="string" id="6740337">&#34;t&#34;</span><span class="op" id="6740340">,</span>&nbsp;<span class="string" id="6740342">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="6740374">,</span>&nbsp;<span class="string" id="6740376">&#34;&#34;</span><span class="op" id="6740378">,</span>&nbsp;<span class="string" id="6740380">&#34;&#34;</span><span class="op" id="6740382">,</span>&nbsp;<span class="ident" id="6740384">nil</span><span class="op" id="6740387">,</span>&nbsp;<span class="ident" id="6740389">nil</span><span class="op" id="6740392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740395">if</span>&nbsp;<span class="ident" id="6740398">err</span>&nbsp;<span class="op" id="6740402">!=</span>&nbsp;<span class="ident" id="6740405">nil</span>&nbsp;<span class="op" id="6740409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740413">t</span><span class="op" id="6740414">.</span><span class="ident" id="6740415">Fatal</span><span class="op" id="6740420">(</span><span class="ident" id="6740421">err</span><span class="op" id="6740424">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740430">added</span>&nbsp;<span class="op" id="6740436">:=</span>&nbsp;<span class="ident" id="6740439">Must</span><span class="op" id="6740443">(</span><span class="ident" id="6740444">root</span><span class="op" id="6740448">.</span><span class="ident" id="6740449">AddParseTree</span><span class="op" id="6740461">(</span><span class="string" id="6740462">&#34;b&#34;</span><span class="op" id="6740465">,</span>&nbsp;<span class="ident" id="6740467">tree</span><span class="op" id="6740471">[</span><span class="string" id="6740472">&#34;b&#34;</span><span class="op" id="6740475">]</span><span class="op" id="6740476">)</span><span class="op" id="6740477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740480">b</span>&nbsp;<span class="op" id="6740482">:=</span>&nbsp;<span class="builtinfunc" id="6740485">new</span><span class="op" id="6740488">(</span><span class="ident" id="6740489">bytes</span><span class="op" id="6740494">.</span><span class="ident" id="6740495">Buffer</span><span class="op" id="6740501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740504">err</span>&nbsp;<span class="op" id="6740508">=</span>&nbsp;<span class="ident" id="6740510">added</span><span class="op" id="6740515">.</span><span class="ident" id="6740516">ExecuteTemplate</span><span class="op" id="6740531">(</span><span class="ident" id="6740532">b</span><span class="op" id="6740533">,</span>&nbsp;<span class="string" id="6740535">&#34;a&#34;</span><span class="op" id="6740538">,</span>&nbsp;<span class="string" id="6740540">&#34;1&gt;0&#34;</span><span class="op" id="6740545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740548">if</span>&nbsp;<span class="ident" id="6740551">err</span>&nbsp;<span class="op" id="6740555">!=</span>&nbsp;<span class="ident" id="6740558">nil</span>&nbsp;<span class="op" id="6740562">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740566">t</span><span class="op" id="6740567">.</span><span class="ident" id="6740568">Fatal</span><span class="op" id="6740573">(</span><span class="ident" id="6740574">err</span><span class="op" id="6740577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740583">if</span>&nbsp;<span class="ident" id="6740586">got</span><span class="op" id="6740589">,</span>&nbsp;<span class="ident" id="6740591">want</span>&nbsp;<span class="op" id="6740596">:=</span>&nbsp;<span class="ident" id="6740599">b</span><span class="op" id="6740600">.</span><span class="ident" id="6740601">String</span><span class="op" id="6740607">(</span><span class="op" id="6740608">)</span><span class="op" id="6740609">,</span>&nbsp;<span class="string" id="6740611">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="6740643">;</span>&nbsp;<span class="ident" id="6740645">got</span>&nbsp;<span class="op" id="6740649">!=</span>&nbsp;<span class="ident" id="6740652">want</span>&nbsp;<span class="op" id="6740657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740661">t</span><span class="op" id="6740662">.</span><span class="ident" id="6740663">Errorf</span><span class="op" id="6740669">(</span><span class="string" id="6740670">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6740686">,</span>&nbsp;<span class="ident" id="6740688">got</span><span class="op" id="6740691">,</span>&nbsp;<span class="ident" id="6740693">want</span><span class="op" id="6740697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740700">}</span><br>
<span class="lineno">30</span><span class="op" id="6740702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6740705">func</span>&nbsp;<span class="ident" id="6740710">TestClone</span><span class="op" id="6740719">(</span><span class="ident" id="6740720">t</span>&nbsp;<span class="op" id="6740722">*</span><span class="ident" id="6740723">testing</span><span class="op" id="6740730">.</span><span class="ident" id="6740731">T</span><span class="op" id="6740732">)</span>&nbsp;<span class="op" id="6740734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740737">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740809">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740863">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740916">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6740976">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741029">const</span>&nbsp;<span class="ident" id="6741035">tmpl</span>&nbsp;<span class="op" id="6741040">=</span>&nbsp;<span class="string" id="6741042">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741108">b</span>&nbsp;<span class="op" id="6741110">:=</span>&nbsp;<span class="builtinfunc" id="6741113">new</span><span class="op" id="6741116">(</span><span class="ident" id="6741117">bytes</span><span class="op" id="6741122">.</span><span class="ident" id="6741123">Buffer</span><span class="op" id="6741129">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741133">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741171">t0</span>&nbsp;<span class="op" id="6741174">:=</span>&nbsp;<span class="ident" id="6741177">Must</span><span class="op" id="6741181">(</span><span class="ident" id="6741182">New</span><span class="op" id="6741185">(</span><span class="string" id="6741186">&#34;t0&#34;</span><span class="op" id="6741190">)</span><span class="op" id="6741191">.</span><span class="ident" id="6741192">Parse</span><span class="op" id="6741197">(</span><span class="ident" id="6741198">tmpl</span><span class="op" id="6741202">)</span><span class="op" id="6741203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741207">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741227">t1</span>&nbsp;<span class="op" id="6741230">:=</span>&nbsp;<span class="ident" id="6741233">Must</span><span class="op" id="6741237">(</span><span class="ident" id="6741238">t0</span><span class="op" id="6741240">.</span><span class="ident" id="6741241">Clone</span><span class="op" id="6741246">(</span><span class="op" id="6741247">)</span><span class="op" id="6741248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741251">Must</span><span class="op" id="6741255">(</span><span class="ident" id="6741256">t1</span><span class="op" id="6741258">.</span><span class="ident" id="6741259">Parse</span><span class="op" id="6741264">(</span><span class="string" id="6741265">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="6741301">)</span><span class="op" id="6741302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741305">Must</span><span class="op" id="6741309">(</span><span class="ident" id="6741310">t1</span><span class="op" id="6741312">.</span><span class="ident" id="6741313">Parse</span><span class="op" id="6741318">(</span><span class="string" id="6741319">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="6741352">)</span><span class="op" id="6741353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741357">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741373">b</span><span class="op" id="6741374">.</span><span class="ident" id="6741375">Reset</span><span class="op" id="6741380">(</span><span class="op" id="6741381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741384">if</span>&nbsp;<span class="ident" id="6741387">err</span>&nbsp;<span class="op" id="6741391">:=</span>&nbsp;<span class="ident" id="6741394">t1</span><span class="op" id="6741396">.</span><span class="ident" id="6741397">ExecuteTemplate</span><span class="op" id="6741412">(</span><span class="ident" id="6741413">b</span><span class="op" id="6741414">,</span>&nbsp;<span class="string" id="6741416">&#34;a&#34;</span><span class="op" id="6741419">,</span>&nbsp;<span class="string" id="6741421">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6741428">)</span><span class="op" id="6741429">;</span>&nbsp;<span class="ident" id="6741431">err</span>&nbsp;<span class="op" id="6741435">!=</span>&nbsp;<span class="ident" id="6741438">nil</span>&nbsp;<span class="op" id="6741442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741446">t</span><span class="op" id="6741447">.</span><span class="ident" id="6741448">Fatal</span><span class="op" id="6741453">(</span><span class="ident" id="6741454">err</span><span class="op" id="6741457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741463">if</span>&nbsp;<span class="ident" id="6741466">got</span><span class="op" id="6741469">,</span>&nbsp;<span class="ident" id="6741471">want</span>&nbsp;<span class="op" id="6741476">:=</span>&nbsp;<span class="ident" id="6741479">b</span><span class="op" id="6741480">.</span><span class="ident" id="6741481">String</span><span class="op" id="6741487">(</span><span class="op" id="6741488">)</span><span class="op" id="6741489">,</span>&nbsp;<span class="string" id="6741491">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="6741521">;</span>&nbsp;<span class="ident" id="6741523">got</span>&nbsp;<span class="op" id="6741527">!=</span>&nbsp;<span class="ident" id="6741530">want</span>&nbsp;<span class="op" id="6741535">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741539">t</span><span class="op" id="6741540">.</span><span class="ident" id="6741541">Errorf</span><span class="op" id="6741547">(</span><span class="string" id="6741548">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6741568">,</span>&nbsp;<span class="ident" id="6741570">got</span><span class="op" id="6741573">,</span>&nbsp;<span class="ident" id="6741575">want</span><span class="op" id="6741579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741586">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741606">t2</span>&nbsp;<span class="op" id="6741609">:=</span>&nbsp;<span class="ident" id="6741612">Must</span><span class="op" id="6741616">(</span><span class="ident" id="6741617">t0</span><span class="op" id="6741619">.</span><span class="ident" id="6741620">Clone</span><span class="op" id="6741625">(</span><span class="op" id="6741626">)</span><span class="op" id="6741627">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741630">Must</span><span class="op" id="6741634">(</span><span class="ident" id="6741635">t2</span><span class="op" id="6741637">.</span><span class="ident" id="6741638">Parse</span><span class="op" id="6741643">(</span><span class="string" id="6741644">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="6741694">)</span><span class="op" id="6741695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741698">Must</span><span class="op" id="6741702">(</span><span class="ident" id="6741703">t2</span><span class="op" id="6741705">.</span><span class="ident" id="6741706">Parse</span><span class="op" id="6741711">(</span><span class="string" id="6741712">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="6741745">)</span><span class="op" id="6741746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6741750">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741766">b</span><span class="op" id="6741767">.</span><span class="ident" id="6741768">Reset</span><span class="op" id="6741773">(</span><span class="op" id="6741774">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741777">if</span>&nbsp;<span class="ident" id="6741780">err</span>&nbsp;<span class="op" id="6741784">:=</span>&nbsp;<span class="ident" id="6741787">t2</span><span class="op" id="6741789">.</span><span class="ident" id="6741790">ExecuteTemplate</span><span class="op" id="6741805">(</span><span class="ident" id="6741806">b</span><span class="op" id="6741807">,</span>&nbsp;<span class="string" id="6741809">&#34;a&#34;</span><span class="op" id="6741812">,</span>&nbsp;<span class="string" id="6741814">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6741821">)</span><span class="op" id="6741822">;</span>&nbsp;<span class="ident" id="6741824">err</span>&nbsp;<span class="op" id="6741828">!=</span>&nbsp;<span class="ident" id="6741831">nil</span>&nbsp;<span class="op" id="6741835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741839">t</span><span class="op" id="6741840">.</span><span class="ident" id="6741841">Fatal</span><span class="op" id="6741846">(</span><span class="ident" id="6741847">err</span><span class="op" id="6741850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741856">if</span>&nbsp;<span class="ident" id="6741859">got</span><span class="op" id="6741862">,</span>&nbsp;<span class="ident" id="6741864">want</span>&nbsp;<span class="op" id="6741869">:=</span>&nbsp;<span class="ident" id="6741872">b</span><span class="op" id="6741873">.</span><span class="ident" id="6741874">String</span><span class="op" id="6741880">(</span><span class="op" id="6741881">)</span><span class="op" id="6741882">,</span>&nbsp;<span class="string" id="6741884">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="6741944">;</span>&nbsp;<span class="ident" id="6741946">got</span>&nbsp;<span class="op" id="6741950">!=</span>&nbsp;<span class="ident" id="6741953">want</span>&nbsp;<span class="op" id="6741958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741962">t</span><span class="op" id="6741963">.</span><span class="ident" id="6741964">Errorf</span><span class="op" id="6741970">(</span><span class="string" id="6741971">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6741991">,</span>&nbsp;<span class="ident" id="6741993">got</span><span class="op" id="6741996">,</span>&nbsp;<span class="ident" id="6741998">want</span><span class="op" id="6742002">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742009">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742056">t3</span>&nbsp;<span class="op" id="6742059">:=</span>&nbsp;<span class="ident" id="6742062">Must</span><span class="op" id="6742066">(</span><span class="ident" id="6742067">t0</span><span class="op" id="6742069">.</span><span class="ident" id="6742070">Clone</span><span class="op" id="6742075">(</span><span class="op" id="6742076">)</span><span class="op" id="6742077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742080">Must</span><span class="op" id="6742084">(</span><span class="ident" id="6742085">t3</span><span class="op" id="6742087">.</span><span class="ident" id="6742088">Parse</span><span class="op" id="6742093">(</span><span class="string" id="6742094">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="6742128">)</span><span class="op" id="6742129">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742132">Must</span><span class="op" id="6742136">(</span><span class="ident" id="6742137">t3</span><span class="op" id="6742139">.</span><span class="ident" id="6742140">Parse</span><span class="op" id="6742145">(</span><span class="string" id="6742146">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="6742181">)</span><span class="op" id="6742182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742186">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742203">Must</span><span class="op" id="6742207">(</span><span class="ident" id="6742208">t0</span><span class="op" id="6742210">.</span><span class="ident" id="6742211">Parse</span><span class="op" id="6742216">(</span><span class="string" id="6742217">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="6742245">)</span><span class="op" id="6742246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742249">Must</span><span class="op" id="6742253">(</span><span class="ident" id="6742254">t0</span><span class="op" id="6742256">.</span><span class="ident" id="6742257">Parse</span><span class="op" id="6742262">(</span><span class="string" id="6742263">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="6742291">)</span><span class="op" id="6742292">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742296">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742359">t4</span>&nbsp;<span class="op" id="6742362">:=</span>&nbsp;<span class="ident" id="6742365">Must</span><span class="op" id="6742369">(</span><span class="ident" id="6742370">t0</span><span class="op" id="6742372">.</span><span class="ident" id="6742373">Clone</span><span class="op" id="6742378">(</span><span class="op" id="6742379">)</span><span class="op" id="6742380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742383">if</span>&nbsp;<span class="ident" id="6742386">_</span><span class="op" id="6742387">,</span>&nbsp;<span class="ident" id="6742389">err</span>&nbsp;<span class="op" id="6742393">:=</span>&nbsp;<span class="ident" id="6742396">t4</span><span class="op" id="6742398">.</span><span class="ident" id="6742399">Parse</span><span class="op" id="6742404">(</span><span class="string" id="6742405">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="6742436">)</span><span class="op" id="6742437">;</span>&nbsp;<span class="ident" id="6742439">err</span>&nbsp;<span class="op" id="6742443">==</span>&nbsp;<span class="ident" id="6742446">nil</span>&nbsp;<span class="op" id="6742450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742454">t</span><span class="op" id="6742455">.</span><span class="ident" id="6742456">Error</span><span class="op" id="6742461">(</span><span class="string" id="6742462">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6742504">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742511">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742527">b</span><span class="op" id="6742528">.</span><span class="ident" id="6742529">Reset</span><span class="op" id="6742534">(</span><span class="op" id="6742535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742538">if</span>&nbsp;<span class="ident" id="6742541">err</span>&nbsp;<span class="op" id="6742545">:=</span>&nbsp;<span class="ident" id="6742548">t0</span><span class="op" id="6742550">.</span><span class="ident" id="6742551">ExecuteTemplate</span><span class="op" id="6742566">(</span><span class="ident" id="6742567">b</span><span class="op" id="6742568">,</span>&nbsp;<span class="string" id="6742570">&#34;a&#34;</span><span class="op" id="6742573">,</span>&nbsp;<span class="string" id="6742575">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6742582">)</span><span class="op" id="6742583">;</span>&nbsp;<span class="ident" id="6742585">err</span>&nbsp;<span class="op" id="6742589">!=</span>&nbsp;<span class="ident" id="6742592">nil</span>&nbsp;<span class="op" id="6742596">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742600">t</span><span class="op" id="6742601">.</span><span class="ident" id="6742602">Fatal</span><span class="op" id="6742607">(</span><span class="ident" id="6742608">err</span><span class="op" id="6742611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742617">if</span>&nbsp;<span class="ident" id="6742620">got</span><span class="op" id="6742623">,</span>&nbsp;<span class="ident" id="6742625">want</span>&nbsp;<span class="op" id="6742630">:=</span>&nbsp;<span class="ident" id="6742633">b</span><span class="op" id="6742634">.</span><span class="ident" id="6742635">String</span><span class="op" id="6742641">(</span><span class="op" id="6742642">)</span><span class="op" id="6742643">,</span>&nbsp;<span class="string" id="6742645">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="6742664">;</span>&nbsp;<span class="ident" id="6742666">got</span>&nbsp;<span class="op" id="6742670">!=</span>&nbsp;<span class="ident" id="6742673">want</span>&nbsp;<span class="op" id="6742678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742682">t</span><span class="op" id="6742683">.</span><span class="ident" id="6742684">Errorf</span><span class="op" id="6742690">(</span><span class="string" id="6742691">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6742711">,</span>&nbsp;<span class="ident" id="6742713">got</span><span class="op" id="6742716">,</span>&nbsp;<span class="ident" id="6742718">want</span><span class="op" id="6742722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742725">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742729">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742789">if</span>&nbsp;<span class="ident" id="6742792">_</span><span class="op" id="6742793">,</span>&nbsp;<span class="ident" id="6742795">err</span>&nbsp;<span class="op" id="6742799">:=</span>&nbsp;<span class="ident" id="6742802">t0</span><span class="op" id="6742804">.</span><span class="ident" id="6742805">Clone</span><span class="op" id="6742810">(</span><span class="op" id="6742811">)</span><span class="op" id="6742812">;</span>&nbsp;<span class="ident" id="6742814">err</span>&nbsp;<span class="op" id="6742818">==</span>&nbsp;<span class="ident" id="6742821">nil</span>&nbsp;<span class="op" id="6742825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742829">t</span><span class="op" id="6742830">.</span><span class="ident" id="6742831">Error</span><span class="op" id="6742836">(</span><span class="string" id="6742837">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6742875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742878">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6742882">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742932">if</span>&nbsp;<span class="ident" id="6742935">_</span><span class="op" id="6742936">,</span>&nbsp;<span class="ident" id="6742938">err</span>&nbsp;<span class="op" id="6742942">:=</span>&nbsp;<span class="ident" id="6742945">t0</span><span class="op" id="6742947">.</span><span class="ident" id="6742948">Lookup</span><span class="op" id="6742954">(</span><span class="string" id="6742955">&#34;a&#34;</span><span class="op" id="6742958">)</span><span class="op" id="6742959">.</span><span class="ident" id="6742960">Clone</span><span class="op" id="6742965">(</span><span class="op" id="6742966">)</span><span class="op" id="6742967">;</span>&nbsp;<span class="ident" id="6742969">err</span>&nbsp;<span class="op" id="6742973">==</span>&nbsp;<span class="ident" id="6742976">nil</span>&nbsp;<span class="op" id="6742980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742984">t</span><span class="op" id="6742985">.</span><span class="ident" id="6742986">Error</span><span class="op" id="6742991">(</span><span class="string" id="6742992">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6743042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743045">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743048">if</span>&nbsp;<span class="ident" id="6743051">_</span><span class="op" id="6743052">,</span>&nbsp;<span class="ident" id="6743054">err</span>&nbsp;<span class="op" id="6743058">:=</span>&nbsp;<span class="ident" id="6743061">t0</span><span class="op" id="6743063">.</span><span class="ident" id="6743064">Lookup</span><span class="op" id="6743070">(</span><span class="string" id="6743071">&#34;lhs&#34;</span><span class="op" id="6743076">)</span><span class="op" id="6743077">.</span><span class="ident" id="6743078">Clone</span><span class="op" id="6743083">(</span><span class="op" id="6743084">)</span><span class="op" id="6743085">;</span>&nbsp;<span class="ident" id="6743087">err</span>&nbsp;<span class="op" id="6743091">==</span>&nbsp;<span class="ident" id="6743094">nil</span>&nbsp;<span class="op" id="6743098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743102">t</span><span class="op" id="6743103">.</span><span class="ident" id="6743104">Error</span><span class="op" id="6743109">(</span><span class="string" id="6743110">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6743162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6743169">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743185">b</span><span class="op" id="6743186">.</span><span class="ident" id="6743187">Reset</span><span class="op" id="6743192">(</span><span class="op" id="6743193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743196">if</span>&nbsp;<span class="ident" id="6743199">err</span>&nbsp;<span class="op" id="6743203">:=</span>&nbsp;<span class="ident" id="6743206">t3</span><span class="op" id="6743208">.</span><span class="ident" id="6743209">ExecuteTemplate</span><span class="op" id="6743224">(</span><span class="ident" id="6743225">b</span><span class="op" id="6743226">,</span>&nbsp;<span class="string" id="6743228">&#34;a&#34;</span><span class="op" id="6743231">,</span>&nbsp;<span class="string" id="6743233">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6743240">)</span><span class="op" id="6743241">;</span>&nbsp;<span class="ident" id="6743243">err</span>&nbsp;<span class="op" id="6743247">!=</span>&nbsp;<span class="ident" id="6743250">nil</span>&nbsp;<span class="op" id="6743254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743258">t</span><span class="op" id="6743259">.</span><span class="ident" id="6743260">Fatal</span><span class="op" id="6743265">(</span><span class="ident" id="6743266">err</span><span class="op" id="6743269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743275">if</span>&nbsp;<span class="ident" id="6743278">got</span><span class="op" id="6743281">,</span>&nbsp;<span class="ident" id="6743283">want</span>&nbsp;<span class="op" id="6743288">:=</span>&nbsp;<span class="ident" id="6743291">b</span><span class="op" id="6743292">.</span><span class="ident" id="6743293">String</span><span class="op" id="6743299">(</span><span class="op" id="6743300">)</span><span class="op" id="6743301">,</span>&nbsp;<span class="string" id="6743303">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="6743332">;</span>&nbsp;<span class="ident" id="6743334">got</span>&nbsp;<span class="op" id="6743338">!=</span>&nbsp;<span class="ident" id="6743341">want</span>&nbsp;<span class="op" id="6743346">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743350">t</span><span class="op" id="6743351">.</span><span class="ident" id="6743352">Errorf</span><span class="op" id="6743358">(</span><span class="string" id="6743359">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6743379">,</span>&nbsp;<span class="ident" id="6743381">got</span><span class="op" id="6743384">,</span>&nbsp;<span class="ident" id="6743386">want</span><span class="op" id="6743390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743393">}</span><br>
<span class="lineno"></span><span class="op" id="6743395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6743398">func</span>&nbsp;<span class="ident" id="6743403">TestTemplates</span><span class="op" id="6743416">(</span><span class="ident" id="6743417">t</span>&nbsp;<span class="op" id="6743419">*</span><span class="ident" id="6743420">testing</span><span class="op" id="6743427">.</span><span class="ident" id="6743428">T</span><span class="op" id="6743429">)</span>&nbsp;<span class="op" id="6743431">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743434">names</span>&nbsp;<span class="op" id="6743440">:=</span>&nbsp;<span class="op" id="6743443">[</span><span class="op" id="6743444">]</span><span class="builtintype" id="6743445">string</span><span class="op" id="6743451">{</span><span class="string" id="6743452">&#34;t0&#34;</span><span class="op" id="6743456">,</span>&nbsp;<span class="string" id="6743458">&#34;a&#34;</span><span class="op" id="6743461">,</span>&nbsp;<span class="string" id="6743463">&#34;lhs&#34;</span><span class="op" id="6743468">,</span>&nbsp;<span class="string" id="6743470">&#34;rhs&#34;</span><span class="op" id="6743475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6743478">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743533">const</span>&nbsp;<span class="ident" id="6743539">tmpl</span>&nbsp;<span class="op" id="6743544">=</span>&nbsp;<span class="string" id="6743546">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743686">t0</span>&nbsp;<span class="op" id="6743689">:=</span>&nbsp;<span class="ident" id="6743692">Must</span><span class="op" id="6743696">(</span><span class="ident" id="6743697">New</span><span class="op" id="6743700">(</span><span class="string" id="6743701">&#34;t0&#34;</span><span class="op" id="6743705">)</span><span class="op" id="6743706">.</span><span class="ident" id="6743707">Parse</span><span class="op" id="6743712">(</span><span class="ident" id="6743713">tmpl</span><span class="op" id="6743717">)</span><span class="op" id="6743718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743721">templates</span>&nbsp;<span class="op" id="6743731">:=</span>&nbsp;<span class="ident" id="6743734">t0</span><span class="op" id="6743736">.</span><span class="ident" id="6743737">Templates</span><span class="op" id="6743746">(</span><span class="op" id="6743747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743750">if</span>&nbsp;<span class="builtinfunc" id="6743753">len</span><span class="op" id="6743756">(</span><span class="ident" id="6743757">templates</span><span class="op" id="6743766">)</span>&nbsp;<span class="op" id="6743768">!=</span>&nbsp;<span class="builtinfunc" id="6743771">len</span><span class="op" id="6743774">(</span><span class="ident" id="6743775">names</span><span class="op" id="6743780">)</span>&nbsp;<span class="op" id="6743782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743786">t</span><span class="op" id="6743787">.</span><span class="ident" id="6743788">Errorf</span><span class="op" id="6743794">(</span><span class="string" id="6743795">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6743826">,</span>&nbsp;<span class="builtinfunc" id="6743828">len</span><span class="op" id="6743831">(</span><span class="ident" id="6743832">names</span><span class="op" id="6743837">)</span><span class="op" id="6743838">,</span>&nbsp;<span class="builtinfunc" id="6743840">len</span><span class="op" id="6743843">(</span><span class="ident" id="6743844">templates</span><span class="op" id="6743853">)</span><span class="op" id="6743854">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743860">for</span>&nbsp;<span class="ident" id="6743864">_</span><span class="op" id="6743865">,</span>&nbsp;<span class="ident" id="6743867">name</span>&nbsp;<span class="op" id="6743872">:=</span>&nbsp;<span class="keyword" id="6743875">range</span>&nbsp;<span class="ident" id="6743881">names</span>&nbsp;<span class="op" id="6743887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743891">found</span>&nbsp;<span class="op" id="6743897">:=</span>&nbsp;<span class="ident" id="6743900">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743908">for</span>&nbsp;<span class="ident" id="6743912">_</span><span class="op" id="6743913">,</span>&nbsp;<span class="ident" id="6743915">tmpl</span>&nbsp;<span class="op" id="6743920">:=</span>&nbsp;<span class="keyword" id="6743923">range</span>&nbsp;<span class="ident" id="6743929">templates</span>&nbsp;<span class="op" id="6743939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743944">if</span>&nbsp;<span class="ident" id="6743947">name</span>&nbsp;<span class="op" id="6743952">==</span>&nbsp;<span class="ident" id="6743955">tmpl</span><span class="op" id="6743959">.</span><span class="ident" id="6743960">text</span><span class="op" id="6743964">.</span><span class="ident" id="6743965">Name</span><span class="op" id="6743969">(</span><span class="op" id="6743970">)</span>&nbsp;<span class="op" id="6743972">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743978">found</span>&nbsp;<span class="op" id="6743984">=</span>&nbsp;<span class="ident" id="6743986">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743995">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744012">if</span>&nbsp;<span class="op" id="6744015">!</span><span class="ident" id="6744016">found</span>&nbsp;<span class="op" id="6744022">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744027">t</span><span class="op" id="6744028">.</span><span class="ident" id="6744029">Error</span><span class="op" id="6744034">(</span><span class="string" id="6744035">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="6744060">,</span>&nbsp;<span class="ident" id="6744062">name</span><span class="op" id="6744066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744073">}</span><br>
<span class="lineno"></span><span class="op" id="6744075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6744078">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="6744130">func</span>&nbsp;<span class="ident" id="6744135">TestCloneCrash</span><span class="op" id="6744149">(</span><span class="ident" id="6744150">t</span>&nbsp;<span class="op" id="6744152">*</span><span class="ident" id="6744153">testing</span><span class="op" id="6744160">.</span><span class="ident" id="6744161">T</span><span class="op" id="6744162">)</span>&nbsp;<span class="op" id="6744164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744167">t1</span>&nbsp;<span class="op" id="6744170">:=</span>&nbsp;<span class="ident" id="6744173">New</span><span class="op" id="6744176">(</span><span class="string" id="6744177">&#34;all&#34;</span><span class="op" id="6744182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744185">Must</span><span class="op" id="6744189">(</span><span class="ident" id="6744190">t1</span><span class="op" id="6744192">.</span><span class="ident" id="6744193">New</span><span class="op" id="6744196">(</span><span class="string" id="6744197">&#34;t1&#34;</span><span class="op" id="6744201">)</span><span class="op" id="6744202">.</span><span class="ident" id="6744203">Parse</span><span class="op" id="6744208">(</span><span class="string" id="6744209">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="6744237">)</span><span class="op" id="6744238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744241">t1</span><span class="op" id="6744243">.</span><span class="ident" id="6744244">Clone</span><span class="op" id="6744249">(</span><span class="op" id="6744250">)</span><br>
<span class="lineno">150</span><span class="op" id="6744252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6744255">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="6744310">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="6744368">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="6744409">func</span>&nbsp;<span class="ident" id="6744414">TestCloneThenParse</span><span class="op" id="6744432">(</span><span class="ident" id="6744433">t</span>&nbsp;<span class="op" id="6744435">*</span><span class="ident" id="6744436">testing</span><span class="op" id="6744443">.</span><span class="ident" id="6744444">T</span><span class="op" id="6744445">)</span>&nbsp;<span class="op" id="6744447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744450">t0</span>&nbsp;<span class="op" id="6744453">:=</span>&nbsp;<span class="ident" id="6744456">Must</span><span class="op" id="6744460">(</span><span class="ident" id="6744461">New</span><span class="op" id="6744464">(</span><span class="string" id="6744465">&#34;t0&#34;</span><span class="op" id="6744469">)</span><span class="op" id="6744470">.</span><span class="ident" id="6744471">Parse</span><span class="op" id="6744476">(</span><span class="string" id="6744477">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="6744523">)</span><span class="op" id="6744524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744527">t1</span>&nbsp;<span class="op" id="6744530">:=</span>&nbsp;<span class="ident" id="6744533">Must</span><span class="op" id="6744537">(</span><span class="ident" id="6744538">t0</span><span class="op" id="6744540">.</span><span class="ident" id="6744541">Clone</span><span class="op" id="6744546">(</span><span class="op" id="6744547">)</span><span class="op" id="6744548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744551">Must</span><span class="op" id="6744555">(</span><span class="ident" id="6744556">t1</span><span class="op" id="6744558">.</span><span class="ident" id="6744559">Parse</span><span class="op" id="6744564">(</span><span class="string" id="6744565">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="6744597">)</span><span class="op" id="6744598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744601">if</span>&nbsp;<span class="builtinfunc" id="6744604">len</span><span class="op" id="6744607">(</span><span class="ident" id="6744608">t0</span><span class="op" id="6744610">.</span><span class="ident" id="6744611">Templates</span><span class="op" id="6744620">(</span><span class="op" id="6744621">)</span><span class="op" id="6744622">)</span><span class="op" id="6744623">+</span><span class="num" id="6744624">1</span>&nbsp;<span class="op" id="6744626">!=</span>&nbsp;<span class="builtinfunc" id="6744629">len</span><span class="op" id="6744632">(</span><span class="ident" id="6744633">t1</span><span class="op" id="6744635">.</span><span class="ident" id="6744636">Templates</span><span class="op" id="6744645">(</span><span class="op" id="6744646">)</span><span class="op" id="6744647">)</span>&nbsp;<span class="op" id="6744649">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744653">t</span><span class="op" id="6744654">.</span><span class="ident" id="6744655">Error</span><span class="op" id="6744660">(</span><span class="string" id="6744661">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="6744716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744722">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744798">err</span>&nbsp;<span class="op" id="6744802">:=</span>&nbsp;<span class="ident" id="6744805">t0</span><span class="op" id="6744807">.</span><span class="ident" id="6744808">ExecuteTemplate</span><span class="op" id="6744823">(</span><span class="ident" id="6744824">ioutil</span><span class="op" id="6744830">.</span><span class="ident" id="6744831">Discard</span><span class="op" id="6744838">,</span>&nbsp;<span class="string" id="6744840">&#34;a&#34;</span><span class="op" id="6744843">,</span>&nbsp;<span class="ident" id="6744845">nil</span><span class="op" id="6744848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744851">if</span>&nbsp;<span class="ident" id="6744854">err</span>&nbsp;<span class="op" id="6744858">==</span>&nbsp;<span class="ident" id="6744861">nil</span>&nbsp;<span class="op" id="6744865">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744869">t</span><span class="op" id="6744870">.</span><span class="ident" id="6744871">Error</span><span class="op" id="6744876">(</span><span class="string" id="6744877">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="6744912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744915">}</span><br>
<span class="lineno"></span><span class="op" id="6744917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6744920">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="6744974">func</span>&nbsp;<span class="ident" id="6744979">TestFuncMapWorksAfterClone</span><span class="op" id="6745005">(</span><span class="ident" id="6745006">t</span>&nbsp;<span class="op" id="6745008">*</span><span class="ident" id="6745009">testing</span><span class="op" id="6745016">.</span><span class="ident" id="6745017">T</span><span class="op" id="6745018">)</span>&nbsp;<span class="op" id="6745020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745023">funcs</span>&nbsp;<span class="op" id="6745029">:=</span>&nbsp;<span class="ident" id="6745032">FuncMap</span><span class="op" id="6745039">{</span><span class="string" id="6745040">&#34;customFunc&#34;</span><span class="op" id="6745052">:</span>&nbsp;<span class="keyword" id="6745054">func</span><span class="op" id="6745058">(</span><span class="op" id="6745059">)</span>&nbsp;<span class="op" id="6745061">(</span><span class="builtintype" id="6745062">string</span><span class="op" id="6745068">,</span>&nbsp;<span class="builtintype" id="6745070">error</span><span class="op" id="6745075">)</span>&nbsp;<span class="op" id="6745077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745081">return</span>&nbsp;<span class="string" id="6745088">&#34;&#34;</span><span class="op" id="6745090">,</span>&nbsp;<span class="ident" id="6745092">errors</span><span class="op" id="6745098">.</span><span class="ident" id="6745099">New</span><span class="op" id="6745102">(</span><span class="string" id="6745103">&#34;issue5980&#34;</span><span class="op" id="6745114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745117">}</span><span class="op" id="6745118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6745122">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745167">uncloned</span>&nbsp;<span class="op" id="6745176">:=</span>&nbsp;<span class="ident" id="6745179">Must</span><span class="op" id="6745183">(</span><span class="ident" id="6745184">New</span><span class="op" id="6745187">(</span><span class="string" id="6745188">&#34;&#34;</span><span class="op" id="6745190">)</span><span class="op" id="6745191">.</span><span class="ident" id="6745192">Funcs</span><span class="op" id="6745197">(</span><span class="ident" id="6745198">funcs</span><span class="op" id="6745203">)</span><span class="op" id="6745204">.</span><span class="ident" id="6745205">Parse</span><span class="op" id="6745210">(</span><span class="string" id="6745211">&#34;{{customFunc}}&#34;</span><span class="op" id="6745227">)</span><span class="op" id="6745228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745231">wantErr</span>&nbsp;<span class="op" id="6745239">:=</span>&nbsp;<span class="ident" id="6745242">uncloned</span><span class="op" id="6745250">.</span><span class="ident" id="6745251">Execute</span><span class="op" id="6745258">(</span><span class="ident" id="6745259">ioutil</span><span class="op" id="6745265">.</span><span class="ident" id="6745266">Discard</span><span class="op" id="6745273">,</span>&nbsp;<span class="ident" id="6745275">nil</span><span class="op" id="6745278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6745282">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6745361">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745409">toClone</span>&nbsp;<span class="op" id="6745417">:=</span>&nbsp;<span class="ident" id="6745420">Must</span><span class="op" id="6745424">(</span><span class="ident" id="6745425">New</span><span class="op" id="6745428">(</span><span class="string" id="6745429">&#34;&#34;</span><span class="op" id="6745431">)</span><span class="op" id="6745432">.</span><span class="ident" id="6745433">Funcs</span><span class="op" id="6745438">(</span><span class="ident" id="6745439">funcs</span><span class="op" id="6745444">)</span><span class="op" id="6745445">.</span><span class="ident" id="6745446">Parse</span><span class="op" id="6745451">(</span><span class="string" id="6745452">&#34;{{customFunc}}&#34;</span><span class="op" id="6745468">)</span><span class="op" id="6745469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745472">cloned</span>&nbsp;<span class="op" id="6745479">:=</span>&nbsp;<span class="ident" id="6745482">Must</span><span class="op" id="6745486">(</span><span class="ident" id="6745487">toClone</span><span class="op" id="6745494">.</span><span class="ident" id="6745495">Clone</span><span class="op" id="6745500">(</span><span class="op" id="6745501">)</span><span class="op" id="6745502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745505">gotErr</span>&nbsp;<span class="op" id="6745512">:=</span>&nbsp;<span class="ident" id="6745515">cloned</span><span class="op" id="6745521">.</span><span class="ident" id="6745522">Execute</span><span class="op" id="6745529">(</span><span class="ident" id="6745530">ioutil</span><span class="op" id="6745536">.</span><span class="ident" id="6745537">Discard</span><span class="op" id="6745544">,</span>&nbsp;<span class="ident" id="6745546">nil</span><span class="op" id="6745549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745553">if</span>&nbsp;<span class="ident" id="6745556">wantErr</span><span class="op" id="6745563">.</span><span class="ident" id="6745564">Error</span><span class="op" id="6745569">(</span><span class="op" id="6745570">)</span>&nbsp;<span class="op" id="6745572">!=</span>&nbsp;<span class="ident" id="6745575">gotErr</span><span class="op" id="6745581">.</span><span class="ident" id="6745582">Error</span><span class="op" id="6745587">(</span><span class="op" id="6745588">)</span>&nbsp;<span class="op" id="6745590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745594">t</span><span class="op" id="6745595">.</span><span class="ident" id="6745596">Errorf</span><span class="op" id="6745602">(</span><span class="string" id="6745603">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6745648">,</span>&nbsp;<span class="ident" id="6745650">wantErr</span><span class="op" id="6745657">,</span>&nbsp;<span class="ident" id="6745659">gotErr</span><span class="op" id="6745665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745668">}</span><br>
<span class="lineno"></span><span class="op" id="6745670">}</span>
</div>
</body>
</html>
