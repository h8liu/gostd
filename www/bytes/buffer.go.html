<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2995442">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2995497">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2995551">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2995602">package</span>&nbsp;<span class="ident" id="2995610">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2995617">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995661">import</span>&nbsp;<span class="op" id="2995668">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995671">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995681">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995687">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2995702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2995705">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="2995782">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="2995844">type</span>&nbsp;<span class="ident" id="2995849">Buffer</span>&nbsp;<span class="keyword" id="2995856">struct</span>&nbsp;<span class="op" id="2995863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995866">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995876">[</span><span class="op" id="2995877">]</span><span class="builtintype" id="2995878">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995894">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995941">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2995951">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2995969">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996016">runeBytes</span>&nbsp;<span class="op" id="2996026">[</span><span class="ident" id="2996027">utf8</span><span class="op" id="2996031">.</span><span class="ident" id="2996032">UTFMax</span><span class="op" id="2996038">]</span><span class="builtintype" id="2996039">byte</span>&nbsp;<span class="comment" id="2996044">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996100">bootstrap</span>&nbsp;<span class="op" id="2996110">[</span><span class="num" id="2996111">64</span><span class="op" id="2996113">]</span><span class="builtintype" id="2996114">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996128">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996207">lastRead</span>&nbsp;&nbsp;<span class="ident" id="2996217">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996235">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="2996295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2996298">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2996360">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2996413">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="2996441">type</span>&nbsp;<span class="ident" id="2996446">readOp</span>&nbsp;<span class="builtintype" id="2996453">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="2996458">const</span>&nbsp;<span class="op" id="2996464">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996467">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="2996478">readOp</span>&nbsp;<span class="op" id="2996485">=</span>&nbsp;<span class="ident" id="2996487">iota</span>&nbsp;<span class="comment" id="2996492">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996516">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996541">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996556">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996581">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="2996610">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2996613">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2996704">var</span>&nbsp;<span class="ident" id="2996708">ErrTooLarge</span>&nbsp;<span class="op" id="2996720">=</span>&nbsp;<span class="ident" id="2996722">errors</span><span class="op" id="2996728">.</span><span class="ident" id="2996729">New</span><span class="op" id="2996732">(</span><span class="string" id="2996733">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="2996758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2996761">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="2996839">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2996912">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2996985">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2997035">func</span>&nbsp;<span class="op" id="2997040">(</span><span class="ident" id="2997041">b</span>&nbsp;<span class="op" id="2997043">*</span><span class="ident" id="2997044">Buffer</span><span class="op" id="2997050">)</span>&nbsp;<span class="ident" id="2997052">Bytes</span><span class="op" id="2997057">(</span><span class="op" id="2997058">)</span>&nbsp;<span class="op" id="2997060">[</span><span class="op" id="2997061">]</span><span class="builtintype" id="2997062">byte</span>&nbsp;<span class="op" id="2997067">{</span>&nbsp;<span class="keyword" id="2997069">return</span>&nbsp;<span class="ident" id="2997076">b</span><span class="op" id="2997077">.</span><span class="ident" id="2997078">buf</span><span class="op" id="2997081">[</span><span class="ident" id="2997082">b</span><span class="op" id="2997083">.</span><span class="ident" id="2997084">off</span><span class="op" id="2997087">:</span><span class="op" id="2997088">]</span>&nbsp;<span class="op" id="2997090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2997093">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2997160">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2997229">func</span>&nbsp;<span class="op" id="2997234">(</span><span class="ident" id="2997235">b</span>&nbsp;<span class="op" id="2997237">*</span><span class="ident" id="2997238">Buffer</span><span class="op" id="2997244">)</span>&nbsp;<span class="ident" id="2997246">String</span><span class="op" id="2997252">(</span><span class="op" id="2997253">)</span>&nbsp;<span class="builtintype" id="2997255">string</span>&nbsp;<span class="op" id="2997262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997265">if</span>&nbsp;<span class="ident" id="2997268">b</span>&nbsp;<span class="op" id="2997270">==</span>&nbsp;<span class="ident" id="2997273">nil</span>&nbsp;<span class="op" id="2997277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997281">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997321">return</span>&nbsp;<span class="string" id="2997328">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997340">return</span>&nbsp;<span class="builtintype" id="2997347">string</span><span class="op" id="2997353">(</span><span class="ident" id="2997354">b</span><span class="op" id="2997355">.</span><span class="ident" id="2997356">buf</span><span class="op" id="2997359">[</span><span class="ident" id="2997360">b</span><span class="op" id="2997361">.</span><span class="ident" id="2997362">off</span><span class="op" id="2997365">:</span><span class="op" id="2997366">]</span><span class="op" id="2997367">)</span><br>
<span class="lineno"></span><span class="op" id="2997369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2997372">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="2997444">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="2997474">func</span>&nbsp;<span class="op" id="2997479">(</span><span class="ident" id="2997480">b</span>&nbsp;<span class="op" id="2997482">*</span><span class="ident" id="2997483">Buffer</span><span class="op" id="2997489">)</span>&nbsp;<span class="ident" id="2997491">Len</span><span class="op" id="2997494">(</span><span class="op" id="2997495">)</span>&nbsp;<span class="builtintype" id="2997497">int</span>&nbsp;<span class="op" id="2997501">{</span>&nbsp;<span class="keyword" id="2997503">return</span>&nbsp;<span class="builtinfunc" id="2997510">len</span><span class="op" id="2997513">(</span><span class="ident" id="2997514">b</span><span class="op" id="2997515">.</span><span class="ident" id="2997516">buf</span><span class="op" id="2997519">)</span>&nbsp;<span class="op" id="2997521">-</span>&nbsp;<span class="ident" id="2997523">b</span><span class="op" id="2997524">.</span><span class="ident" id="2997525">off</span>&nbsp;<span class="op" id="2997529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2997532">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="2997603">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2997675">func</span>&nbsp;<span class="op" id="2997680">(</span><span class="ident" id="2997681">b</span>&nbsp;<span class="op" id="2997683">*</span><span class="ident" id="2997684">Buffer</span><span class="op" id="2997690">)</span>&nbsp;<span class="ident" id="2997692">Truncate</span><span class="op" id="2997700">(</span><span class="ident" id="2997701">n</span>&nbsp;<span class="builtintype" id="2997703">int</span><span class="op" id="2997706">)</span>&nbsp;<span class="op" id="2997708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997711">b</span><span class="op" id="2997712">.</span><span class="ident" id="2997713">lastRead</span>&nbsp;<span class="op" id="2997722">=</span>&nbsp;<span class="ident" id="2997724">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997735">switch</span>&nbsp;<span class="op" id="2997742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997745">case</span>&nbsp;<span class="ident" id="2997750">n</span>&nbsp;<span class="op" id="2997752">&lt;</span>&nbsp;<span class="num" id="2997754">0</span>&nbsp;<span class="op" id="2997756">||</span>&nbsp;<span class="ident" id="2997759">n</span>&nbsp;<span class="op" id="2997761">&gt;</span>&nbsp;<span class="ident" id="2997763">b</span><span class="op" id="2997764">.</span><span class="ident" id="2997765">Len</span><span class="op" id="2997768">(</span><span class="op" id="2997769">)</span><span class="op" id="2997770">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2997774">panic</span><span class="op" id="2997779">(</span><span class="string" id="2997780">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2997819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997822">case</span>&nbsp;<span class="ident" id="2997827">n</span>&nbsp;<span class="op" id="2997829">==</span>&nbsp;<span class="num" id="2997832">0</span><span class="op" id="2997833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997837">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997862">b</span><span class="op" id="2997863">.</span><span class="ident" id="2997864">off</span>&nbsp;<span class="op" id="2997868">=</span>&nbsp;<span class="num" id="2997870">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997873">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997876">b</span><span class="op" id="2997877">.</span><span class="ident" id="2997878">buf</span>&nbsp;<span class="op" id="2997882">=</span>&nbsp;<span class="ident" id="2997884">b</span><span class="op" id="2997885">.</span><span class="ident" id="2997886">buf</span><span class="op" id="2997889">[</span><span class="num" id="2997890">0</span>&nbsp;<span class="op" id="2997892">:</span>&nbsp;<span class="ident" id="2997894">b</span><span class="op" id="2997895">.</span><span class="ident" id="2997896">off</span><span class="op" id="2997899">+</span><span class="ident" id="2997900">n</span><span class="op" id="2997901">]</span><br>
<span class="lineno"></span><span class="op" id="2997903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2997906">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="2997955">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="2997998">func</span>&nbsp;<span class="op" id="2998003">(</span><span class="ident" id="2998004">b</span>&nbsp;<span class="op" id="2998006">*</span><span class="ident" id="2998007">Buffer</span><span class="op" id="2998013">)</span>&nbsp;<span class="ident" id="2998015">Reset</span><span class="op" id="2998020">(</span><span class="op" id="2998021">)</span>&nbsp;<span class="op" id="2998023">{</span>&nbsp;<span class="ident" id="2998025">b</span><span class="op" id="2998026">.</span><span class="ident" id="2998027">Truncate</span><span class="op" id="2998035">(</span><span class="num" id="2998036">0</span><span class="op" id="2998037">)</span>&nbsp;<span class="op" id="2998039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2998042">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2998104">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2998159">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="2998219">func</span>&nbsp;<span class="op" id="2998224">(</span><span class="ident" id="2998225">b</span>&nbsp;<span class="op" id="2998227">*</span><span class="ident" id="2998228">Buffer</span><span class="op" id="2998234">)</span>&nbsp;<span class="ident" id="2998236">grow</span><span class="op" id="2998240">(</span><span class="ident" id="2998241">n</span>&nbsp;<span class="builtintype" id="2998243">int</span><span class="op" id="2998246">)</span>&nbsp;<span class="builtintype" id="2998248">int</span>&nbsp;<span class="op" id="2998252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998255">m</span>&nbsp;<span class="op" id="2998257">:=</span>&nbsp;<span class="ident" id="2998260">b</span><span class="op" id="2998261">.</span><span class="ident" id="2998262">Len</span><span class="op" id="2998265">(</span><span class="op" id="2998266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998269">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998317">if</span>&nbsp;<span class="ident" id="2998320">m</span>&nbsp;<span class="op" id="2998322">==</span>&nbsp;<span class="num" id="2998325">0</span>&nbsp;<span class="op" id="2998327">&amp;&amp;</span>&nbsp;<span class="ident" id="2998330">b</span><span class="op" id="2998331">.</span><span class="ident" id="2998332">off</span>&nbsp;<span class="op" id="2998336">!=</span>&nbsp;<span class="num" id="2998339">0</span>&nbsp;<span class="op" id="2998341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998345">b</span><span class="op" id="2998346">.</span><span class="ident" id="2998347">Truncate</span><span class="op" id="2998355">(</span><span class="num" id="2998356">0</span><span class="op" id="2998357">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998363">if</span>&nbsp;<span class="builtinfunc" id="2998366">len</span><span class="op" id="2998369">(</span><span class="ident" id="2998370">b</span><span class="op" id="2998371">.</span><span class="ident" id="2998372">buf</span><span class="op" id="2998375">)</span><span class="op" id="2998376">+</span><span class="ident" id="2998377">n</span>&nbsp;<span class="op" id="2998379">&gt;</span>&nbsp;<span class="builtinfunc" id="2998381">cap</span><span class="op" id="2998384">(</span><span class="ident" id="2998385">b</span><span class="op" id="2998386">.</span><span class="ident" id="2998387">buf</span><span class="op" id="2998390">)</span>&nbsp;<span class="op" id="2998392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998396">var</span>&nbsp;<span class="ident" id="2998400">buf</span>&nbsp;<span class="op" id="2998404">[</span><span class="op" id="2998405">]</span><span class="builtintype" id="2998406">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998413">if</span>&nbsp;<span class="ident" id="2998416">b</span><span class="op" id="2998417">.</span><span class="ident" id="2998418">buf</span>&nbsp;<span class="op" id="2998422">==</span>&nbsp;<span class="ident" id="2998425">nil</span>&nbsp;<span class="op" id="2998429">&amp;&amp;</span>&nbsp;<span class="ident" id="2998432">n</span>&nbsp;<span class="op" id="2998434">&lt;=</span>&nbsp;<span class="builtinfunc" id="2998437">len</span><span class="op" id="2998440">(</span><span class="ident" id="2998441">b</span><span class="op" id="2998442">.</span><span class="ident" id="2998443">bootstrap</span><span class="op" id="2998452">)</span>&nbsp;<span class="op" id="2998454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998459">buf</span>&nbsp;<span class="op" id="2998463">=</span>&nbsp;<span class="ident" id="2998465">b</span><span class="op" id="2998466">.</span><span class="ident" id="2998467">bootstrap</span><span class="op" id="2998476">[</span><span class="num" id="2998477">0</span><span class="op" id="2998478">:</span><span class="op" id="2998479">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998483">}</span>&nbsp;<span class="keyword" id="2998485">else</span>&nbsp;<span class="keyword" id="2998490">if</span>&nbsp;<span class="ident" id="2998493">m</span><span class="op" id="2998494">+</span><span class="ident" id="2998495">n</span>&nbsp;<span class="op" id="2998497">&lt;=</span>&nbsp;<span class="builtinfunc" id="2998500">cap</span><span class="op" id="2998503">(</span><span class="ident" id="2998504">b</span><span class="op" id="2998505">.</span><span class="ident" id="2998506">buf</span><span class="op" id="2998509">)</span><span class="op" id="2998510">/</span><span class="num" id="2998511">2</span>&nbsp;<span class="op" id="2998513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998518">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998577">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998635">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998690">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2998730">copy</span><span class="op" id="2998734">(</span><span class="ident" id="2998735">b</span><span class="op" id="2998736">.</span><span class="ident" id="2998737">buf</span><span class="op" id="2998740">[</span><span class="op" id="2998741">:</span><span class="op" id="2998742">]</span><span class="op" id="2998743">,</span>&nbsp;<span class="ident" id="2998745">b</span><span class="op" id="2998746">.</span><span class="ident" id="2998747">buf</span><span class="op" id="2998750">[</span><span class="ident" id="2998751">b</span><span class="op" id="2998752">.</span><span class="ident" id="2998753">off</span><span class="op" id="2998756">:</span><span class="op" id="2998757">]</span><span class="op" id="2998758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998763">buf</span>&nbsp;<span class="op" id="2998767">=</span>&nbsp;<span class="ident" id="2998769">b</span><span class="op" id="2998770">.</span><span class="ident" id="2998771">buf</span><span class="op" id="2998774">[</span><span class="op" id="2998775">:</span><span class="ident" id="2998776">m</span><span class="op" id="2998777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998781">}</span>&nbsp;<span class="keyword" id="2998783">else</span>&nbsp;<span class="op" id="2998788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998793">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998825">buf</span>&nbsp;<span class="op" id="2998829">=</span>&nbsp;<span class="ident" id="2998831">makeSlice</span><span class="op" id="2998840">(</span><span class="num" id="2998841">2</span><span class="op" id="2998842">*</span><span class="builtinfunc" id="2998843">cap</span><span class="op" id="2998846">(</span><span class="ident" id="2998847">b</span><span class="op" id="2998848">.</span><span class="ident" id="2998849">buf</span><span class="op" id="2998852">)</span>&nbsp;<span class="op" id="2998854">+</span>&nbsp;<span class="ident" id="2998856">n</span><span class="op" id="2998857">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2998862">copy</span><span class="op" id="2998866">(</span><span class="ident" id="2998867">buf</span><span class="op" id="2998870">,</span>&nbsp;<span class="ident" id="2998872">b</span><span class="op" id="2998873">.</span><span class="ident" id="2998874">buf</span><span class="op" id="2998877">[</span><span class="ident" id="2998878">b</span><span class="op" id="2998879">.</span><span class="ident" id="2998880">off</span><span class="op" id="2998883">:</span><span class="op" id="2998884">]</span><span class="op" id="2998885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998893">b</span><span class="op" id="2998894">.</span><span class="ident" id="2998895">buf</span>&nbsp;<span class="op" id="2998899">=</span>&nbsp;<span class="ident" id="2998901">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998907">b</span><span class="op" id="2998908">.</span><span class="ident" id="2998909">off</span>&nbsp;<span class="op" id="2998913">=</span>&nbsp;<span class="num" id="2998915">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998918">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998921">b</span><span class="op" id="2998922">.</span><span class="ident" id="2998923">buf</span>&nbsp;<span class="op" id="2998927">=</span>&nbsp;<span class="ident" id="2998929">b</span><span class="op" id="2998930">.</span><span class="ident" id="2998931">buf</span><span class="op" id="2998934">[</span><span class="num" id="2998935">0</span>&nbsp;<span class="op" id="2998937">:</span>&nbsp;<span class="ident" id="2998939">b</span><span class="op" id="2998940">.</span><span class="ident" id="2998941">off</span><span class="op" id="2998944">+</span><span class="ident" id="2998945">m</span><span class="op" id="2998946">+</span><span class="ident" id="2998947">n</span><span class="op" id="2998948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998951">return</span>&nbsp;<span class="ident" id="2998958">b</span><span class="op" id="2998959">.</span><span class="ident" id="2998960">off</span>&nbsp;<span class="op" id="2998964">+</span>&nbsp;<span class="ident" id="2998966">m</span><br>
<span class="lineno"></span><span class="op" id="2998968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2998971">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="2999045">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2999119">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="2999157">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="2999195">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2999255">func</span>&nbsp;<span class="op" id="2999260">(</span><span class="ident" id="2999261">b</span>&nbsp;<span class="op" id="2999263">*</span><span class="ident" id="2999264">Buffer</span><span class="op" id="2999270">)</span>&nbsp;<span class="ident" id="2999272">Grow</span><span class="op" id="2999276">(</span><span class="ident" id="2999277">n</span>&nbsp;<span class="builtintype" id="2999279">int</span><span class="op" id="2999282">)</span>&nbsp;<span class="op" id="2999284">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999287">if</span>&nbsp;<span class="ident" id="2999290">n</span>&nbsp;<span class="op" id="2999292">&lt;</span>&nbsp;<span class="num" id="2999294">0</span>&nbsp;<span class="op" id="2999296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2999300">panic</span><span class="op" id="2999305">(</span><span class="string" id="2999306">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2999341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999347">m</span>&nbsp;<span class="op" id="2999349">:=</span>&nbsp;<span class="ident" id="2999352">b</span><span class="op" id="2999353">.</span><span class="ident" id="2999354">grow</span><span class="op" id="2999358">(</span><span class="ident" id="2999359">n</span><span class="op" id="2999360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999363">b</span><span class="op" id="2999364">.</span><span class="ident" id="2999365">buf</span>&nbsp;<span class="op" id="2999369">=</span>&nbsp;<span class="ident" id="2999371">b</span><span class="op" id="2999372">.</span><span class="ident" id="2999373">buf</span><span class="op" id="2999376">[</span><span class="num" id="2999377">0</span><span class="op" id="2999378">:</span><span class="ident" id="2999379">m</span><span class="op" id="2999380">]</span><br>
<span class="lineno">120</span><span class="op" id="2999382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2999385">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2999457">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2999533">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="2999597">func</span>&nbsp;<span class="op" id="2999602">(</span><span class="ident" id="2999603">b</span>&nbsp;<span class="op" id="2999605">*</span><span class="ident" id="2999606">Buffer</span><span class="op" id="2999612">)</span>&nbsp;<span class="ident" id="2999614">Write</span><span class="op" id="2999619">(</span><span class="ident" id="2999620">p</span>&nbsp;<span class="op" id="2999622">[</span><span class="op" id="2999623">]</span><span class="builtintype" id="2999624">byte</span><span class="op" id="2999628">)</span>&nbsp;<span class="op" id="2999630">(</span><span class="ident" id="2999631">n</span>&nbsp;<span class="builtintype" id="2999633">int</span><span class="op" id="2999636">,</span>&nbsp;<span class="ident" id="2999638">err</span>&nbsp;<span class="builtintype" id="2999642">error</span><span class="op" id="2999647">)</span>&nbsp;<span class="op" id="2999649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999652">b</span><span class="op" id="2999653">.</span><span class="ident" id="2999654">lastRead</span>&nbsp;<span class="op" id="2999663">=</span>&nbsp;<span class="ident" id="2999665">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999676">m</span>&nbsp;<span class="op" id="2999678">:=</span>&nbsp;<span class="ident" id="2999681">b</span><span class="op" id="2999682">.</span><span class="ident" id="2999683">grow</span><span class="op" id="2999687">(</span><span class="builtinfunc" id="2999688">len</span><span class="op" id="2999691">(</span><span class="ident" id="2999692">p</span><span class="op" id="2999693">)</span><span class="op" id="2999694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999697">return</span>&nbsp;<span class="builtinfunc" id="2999704">copy</span><span class="op" id="2999708">(</span><span class="ident" id="2999709">b</span><span class="op" id="2999710">.</span><span class="ident" id="2999711">buf</span><span class="op" id="2999714">[</span><span class="ident" id="2999715">m</span><span class="op" id="2999716">:</span><span class="op" id="2999717">]</span><span class="op" id="2999718">,</span>&nbsp;<span class="ident" id="2999720">p</span><span class="op" id="2999721">)</span><span class="op" id="2999722">,</span>&nbsp;<span class="ident" id="2999724">nil</span><br>
<span class="lineno"></span><span class="op" id="2999728">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="2999731">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2999809">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2999885">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2999955">func</span>&nbsp;<span class="op" id="2999960">(</span><span class="ident" id="2999961">b</span>&nbsp;<span class="op" id="2999963">*</span><span class="ident" id="2999964">Buffer</span><span class="op" id="2999970">)</span>&nbsp;<span class="ident" id="2999972">WriteString</span><span class="op" id="2999983">(</span><span class="ident" id="2999984">s</span>&nbsp;<span class="builtintype" id="2999986">string</span><span class="op" id="2999992">)</span>&nbsp;<span class="op" id="2999994">(</span><span class="ident" id="2999995">n</span>&nbsp;<span class="builtintype" id="2999997">int</span><span class="op" id="3000000">,</span>&nbsp;<span class="ident" id="3000002">err</span>&nbsp;<span class="builtintype" id="3000006">error</span><span class="op" id="3000011">)</span>&nbsp;<span class="op" id="3000013">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000016">b</span><span class="op" id="3000017">.</span><span class="ident" id="3000018">lastRead</span>&nbsp;<span class="op" id="3000027">=</span>&nbsp;<span class="ident" id="3000029">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000040">m</span>&nbsp;<span class="op" id="3000042">:=</span>&nbsp;<span class="ident" id="3000045">b</span><span class="op" id="3000046">.</span><span class="ident" id="3000047">grow</span><span class="op" id="3000051">(</span><span class="builtinfunc" id="3000052">len</span><span class="op" id="3000055">(</span><span class="ident" id="3000056">s</span><span class="op" id="3000057">)</span><span class="op" id="3000058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000061">return</span>&nbsp;<span class="builtinfunc" id="3000068">copy</span><span class="op" id="3000072">(</span><span class="ident" id="3000073">b</span><span class="op" id="3000074">.</span><span class="ident" id="3000075">buf</span><span class="op" id="3000078">[</span><span class="ident" id="3000079">m</span><span class="op" id="3000080">:</span><span class="op" id="3000081">]</span><span class="op" id="3000082">,</span>&nbsp;<span class="ident" id="3000084">s</span><span class="op" id="3000085">)</span><span class="op" id="3000086">,</span>&nbsp;<span class="ident" id="3000088">nil</span><br>
<span class="lineno"></span><span class="op" id="3000092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3000095">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3000157">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="3000234">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3000308">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3000330">const</span>&nbsp;<span class="ident" id="3000336">MinRead</span>&nbsp;<span class="op" id="3000344">=</span>&nbsp;<span class="num" id="3000346">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3000351">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="3000429">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="3000506">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3000582">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="3000649">func</span>&nbsp;<span class="op" id="3000654">(</span><span class="ident" id="3000655">b</span>&nbsp;<span class="op" id="3000657">*</span><span class="ident" id="3000658">Buffer</span><span class="op" id="3000664">)</span>&nbsp;<span class="ident" id="3000666">ReadFrom</span><span class="op" id="3000674">(</span><span class="ident" id="3000675">r</span>&nbsp;<span class="ident" id="3000677">io</span><span class="op" id="3000679">.</span><span class="ident" id="3000680">Reader</span><span class="op" id="3000686">)</span>&nbsp;<span class="op" id="3000688">(</span><span class="ident" id="3000689">n</span>&nbsp;<span class="ident" id="3000691">int64</span><span class="op" id="3000696">,</span>&nbsp;<span class="ident" id="3000698">err</span>&nbsp;<span class="builtintype" id="3000702">error</span><span class="op" id="3000707">)</span>&nbsp;<span class="op" id="3000709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000712">b</span><span class="op" id="3000713">.</span><span class="ident" id="3000714">lastRead</span>&nbsp;<span class="op" id="3000723">=</span>&nbsp;<span class="ident" id="3000725">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000736">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000784">if</span>&nbsp;<span class="ident" id="3000787">b</span><span class="op" id="3000788">.</span><span class="ident" id="3000789">off</span>&nbsp;<span class="op" id="3000793">&gt;=</span>&nbsp;<span class="builtinfunc" id="3000796">len</span><span class="op" id="3000799">(</span><span class="ident" id="3000800">b</span><span class="op" id="3000801">.</span><span class="ident" id="3000802">buf</span><span class="op" id="3000805">)</span>&nbsp;<span class="op" id="3000807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000811">b</span><span class="op" id="3000812">.</span><span class="ident" id="3000813">Truncate</span><span class="op" id="3000821">(</span><span class="num" id="3000822">0</span><span class="op" id="3000823">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000829">for</span>&nbsp;<span class="op" id="3000833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000837">if</span>&nbsp;<span class="ident" id="3000840">free</span>&nbsp;<span class="op" id="3000845">:=</span>&nbsp;<span class="builtinfunc" id="3000848">cap</span><span class="op" id="3000851">(</span><span class="ident" id="3000852">b</span><span class="op" id="3000853">.</span><span class="ident" id="3000854">buf</span><span class="op" id="3000857">)</span>&nbsp;<span class="op" id="3000859">-</span>&nbsp;<span class="builtinfunc" id="3000861">len</span><span class="op" id="3000864">(</span><span class="ident" id="3000865">b</span><span class="op" id="3000866">.</span><span class="ident" id="3000867">buf</span><span class="op" id="3000870">)</span><span class="op" id="3000871">;</span>&nbsp;<span class="ident" id="3000873">free</span>&nbsp;<span class="op" id="3000878">&lt;</span>&nbsp;<span class="ident" id="3000880">MinRead</span>&nbsp;<span class="op" id="3000888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000893">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000923">newBuf</span>&nbsp;<span class="op" id="3000930">:=</span>&nbsp;<span class="ident" id="3000933">b</span><span class="op" id="3000934">.</span><span class="ident" id="3000935">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000942">if</span>&nbsp;<span class="ident" id="3000945">b</span><span class="op" id="3000946">.</span><span class="ident" id="3000947">off</span><span class="op" id="3000950">+</span><span class="ident" id="3000951">free</span>&nbsp;<span class="op" id="3000956">&lt;</span>&nbsp;<span class="ident" id="3000958">MinRead</span>&nbsp;<span class="op" id="3000966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000972">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001023">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001053">newBuf</span>&nbsp;<span class="op" id="3001060">=</span>&nbsp;<span class="ident" id="3001062">makeSlice</span><span class="op" id="3001071">(</span><span class="num" id="3001072">2</span><span class="op" id="3001073">*</span><span class="builtinfunc" id="3001074">cap</span><span class="op" id="3001077">(</span><span class="ident" id="3001078">b</span><span class="op" id="3001079">.</span><span class="ident" id="3001080">buf</span><span class="op" id="3001083">)</span>&nbsp;<span class="op" id="3001085">+</span>&nbsp;<span class="ident" id="3001087">MinRead</span><span class="op" id="3001094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001099">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3001104">copy</span><span class="op" id="3001108">(</span><span class="ident" id="3001109">newBuf</span><span class="op" id="3001115">,</span>&nbsp;<span class="ident" id="3001117">b</span><span class="op" id="3001118">.</span><span class="ident" id="3001119">buf</span><span class="op" id="3001122">[</span><span class="ident" id="3001123">b</span><span class="op" id="3001124">.</span><span class="ident" id="3001125">off</span><span class="op" id="3001128">:</span><span class="op" id="3001129">]</span><span class="op" id="3001130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001135">b</span><span class="op" id="3001136">.</span><span class="ident" id="3001137">buf</span>&nbsp;<span class="op" id="3001141">=</span>&nbsp;<span class="ident" id="3001143">newBuf</span><span class="op" id="3001149">[</span><span class="op" id="3001150">:</span><span class="builtinfunc" id="3001151">len</span><span class="op" id="3001154">(</span><span class="ident" id="3001155">b</span><span class="op" id="3001156">.</span><span class="ident" id="3001157">buf</span><span class="op" id="3001160">)</span><span class="op" id="3001161">-</span><span class="ident" id="3001162">b</span><span class="op" id="3001163">.</span><span class="ident" id="3001164">off</span><span class="op" id="3001167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001172">b</span><span class="op" id="3001173">.</span><span class="ident" id="3001174">off</span>&nbsp;<span class="op" id="3001178">=</span>&nbsp;<span class="num" id="3001180">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001188">m</span><span class="op" id="3001189">,</span>&nbsp;<span class="ident" id="3001191">e</span>&nbsp;<span class="op" id="3001193">:=</span>&nbsp;<span class="ident" id="3001196">r</span><span class="op" id="3001197">.</span><span class="ident" id="3001198">Read</span><span class="op" id="3001202">(</span><span class="ident" id="3001203">b</span><span class="op" id="3001204">.</span><span class="ident" id="3001205">buf</span><span class="op" id="3001208">[</span><span class="builtinfunc" id="3001209">len</span><span class="op" id="3001212">(</span><span class="ident" id="3001213">b</span><span class="op" id="3001214">.</span><span class="ident" id="3001215">buf</span><span class="op" id="3001218">)</span><span class="op" id="3001219">:</span><span class="builtinfunc" id="3001220">cap</span><span class="op" id="3001223">(</span><span class="ident" id="3001224">b</span><span class="op" id="3001225">.</span><span class="ident" id="3001226">buf</span><span class="op" id="3001229">)</span><span class="op" id="3001230">]</span><span class="op" id="3001231">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001235">b</span><span class="op" id="3001236">.</span><span class="ident" id="3001237">buf</span>&nbsp;<span class="op" id="3001241">=</span>&nbsp;<span class="ident" id="3001243">b</span><span class="op" id="3001244">.</span><span class="ident" id="3001245">buf</span><span class="op" id="3001248">[</span><span class="num" id="3001249">0</span>&nbsp;<span class="op" id="3001251">:</span>&nbsp;<span class="builtinfunc" id="3001253">len</span><span class="op" id="3001256">(</span><span class="ident" id="3001257">b</span><span class="op" id="3001258">.</span><span class="ident" id="3001259">buf</span><span class="op" id="3001262">)</span><span class="op" id="3001263">+</span><span class="ident" id="3001264">m</span><span class="op" id="3001265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001269">n</span>&nbsp;<span class="op" id="3001271">+=</span>&nbsp;<span class="ident" id="3001274">int64</span><span class="op" id="3001279">(</span><span class="ident" id="3001280">m</span><span class="op" id="3001281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001285">if</span>&nbsp;<span class="ident" id="3001288">e</span>&nbsp;<span class="op" id="3001290">==</span>&nbsp;<span class="ident" id="3001293">io</span><span class="op" id="3001295">.</span><span class="ident" id="3001296">EOF</span>&nbsp;<span class="op" id="3001300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001305">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001313">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001317">if</span>&nbsp;<span class="ident" id="3001320">e</span>&nbsp;<span class="op" id="3001322">!=</span>&nbsp;<span class="ident" id="3001325">nil</span>&nbsp;<span class="op" id="3001329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001334">return</span>&nbsp;<span class="ident" id="3001341">n</span><span class="op" id="3001342">,</span>&nbsp;<span class="ident" id="3001344">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001354">return</span>&nbsp;<span class="ident" id="3001361">n</span><span class="op" id="3001362">,</span>&nbsp;<span class="ident" id="3001364">nil</span>&nbsp;<span class="comment" id="3001368">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="3001408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3001411">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="3001488">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="3001509">func</span>&nbsp;<span class="ident" id="3001514">makeSlice</span><span class="op" id="3001523">(</span><span class="ident" id="3001524">n</span>&nbsp;<span class="builtintype" id="3001526">int</span><span class="op" id="3001529">)</span>&nbsp;<span class="op" id="3001531">[</span><span class="op" id="3001532">]</span><span class="builtintype" id="3001533">byte</span>&nbsp;<span class="op" id="3001538">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001541">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001584">defer</span>&nbsp;<span class="keyword" id="3001590">func</span><span class="op" id="3001594">(</span><span class="op" id="3001595">)</span>&nbsp;<span class="op" id="3001597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001601">if</span>&nbsp;<span class="builtinfunc" id="3001604">recover</span><span class="op" id="3001611">(</span><span class="op" id="3001612">)</span>&nbsp;<span class="op" id="3001614">!=</span>&nbsp;<span class="ident" id="3001617">nil</span>&nbsp;<span class="op" id="3001621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3001626">panic</span><span class="op" id="3001631">(</span><span class="ident" id="3001632">ErrTooLarge</span><span class="op" id="3001643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001647">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001650">}</span><span class="op" id="3001651">(</span><span class="op" id="3001652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001655">return</span>&nbsp;<span class="builtinfunc" id="3001662">make</span><span class="op" id="3001666">(</span><span class="op" id="3001667">[</span><span class="op" id="3001668">]</span><span class="builtintype" id="3001669">byte</span><span class="op" id="3001673">,</span>&nbsp;<span class="ident" id="3001675">n</span><span class="op" id="3001676">)</span><br>
<span class="lineno"></span><span class="op" id="3001678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3001681">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="3001757">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3001834">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3001904">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3001954">func</span>&nbsp;<span class="op" id="3001959">(</span><span class="ident" id="3001960">b</span>&nbsp;<span class="op" id="3001962">*</span><span class="ident" id="3001963">Buffer</span><span class="op" id="3001969">)</span>&nbsp;<span class="ident" id="3001971">WriteTo</span><span class="op" id="3001978">(</span><span class="ident" id="3001979">w</span>&nbsp;<span class="ident" id="3001981">io</span><span class="op" id="3001983">.</span><span class="ident" id="3001984">Writer</span><span class="op" id="3001990">)</span>&nbsp;<span class="op" id="3001992">(</span><span class="ident" id="3001993">n</span>&nbsp;<span class="ident" id="3001995">int64</span><span class="op" id="3002000">,</span>&nbsp;<span class="ident" id="3002002">err</span>&nbsp;<span class="builtintype" id="3002006">error</span><span class="op" id="3002011">)</span>&nbsp;<span class="op" id="3002013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002016">b</span><span class="op" id="3002017">.</span><span class="ident" id="3002018">lastRead</span>&nbsp;<span class="op" id="3002027">=</span>&nbsp;<span class="ident" id="3002029">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002040">if</span>&nbsp;<span class="ident" id="3002043">b</span><span class="op" id="3002044">.</span><span class="ident" id="3002045">off</span>&nbsp;<span class="op" id="3002049">&lt;</span>&nbsp;<span class="builtinfunc" id="3002051">len</span><span class="op" id="3002054">(</span><span class="ident" id="3002055">b</span><span class="op" id="3002056">.</span><span class="ident" id="3002057">buf</span><span class="op" id="3002060">)</span>&nbsp;<span class="op" id="3002062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002066">nBytes</span>&nbsp;<span class="op" id="3002073">:=</span>&nbsp;<span class="ident" id="3002076">b</span><span class="op" id="3002077">.</span><span class="ident" id="3002078">Len</span><span class="op" id="3002081">(</span><span class="op" id="3002082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002086">m</span><span class="op" id="3002087">,</span>&nbsp;<span class="ident" id="3002089">e</span>&nbsp;<span class="op" id="3002091">:=</span>&nbsp;<span class="ident" id="3002094">w</span><span class="op" id="3002095">.</span><span class="ident" id="3002096">Write</span><span class="op" id="3002101">(</span><span class="ident" id="3002102">b</span><span class="op" id="3002103">.</span><span class="ident" id="3002104">buf</span><span class="op" id="3002107">[</span><span class="ident" id="3002108">b</span><span class="op" id="3002109">.</span><span class="ident" id="3002110">off</span><span class="op" id="3002113">:</span><span class="op" id="3002114">]</span><span class="op" id="3002115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002119">if</span>&nbsp;<span class="ident" id="3002122">m</span>&nbsp;<span class="op" id="3002124">&gt;</span>&nbsp;<span class="ident" id="3002126">nBytes</span>&nbsp;<span class="op" id="3002133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3002138">panic</span><span class="op" id="3002143">(</span><span class="string" id="3002144">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="3002187">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002195">b</span><span class="op" id="3002196">.</span><span class="ident" id="3002197">off</span>&nbsp;<span class="op" id="3002201">+=</span>&nbsp;<span class="ident" id="3002204">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002208">n</span>&nbsp;<span class="op" id="3002210">=</span>&nbsp;<span class="ident" id="3002212">int64</span><span class="op" id="3002217">(</span><span class="ident" id="3002218">m</span><span class="op" id="3002219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002223">if</span>&nbsp;<span class="ident" id="3002226">e</span>&nbsp;<span class="op" id="3002228">!=</span>&nbsp;<span class="ident" id="3002231">nil</span>&nbsp;<span class="op" id="3002235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002240">return</span>&nbsp;<span class="ident" id="3002247">n</span><span class="op" id="3002248">,</span>&nbsp;<span class="ident" id="3002250">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002258">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002316">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002347">if</span>&nbsp;<span class="ident" id="3002350">m</span>&nbsp;<span class="op" id="3002352">!=</span>&nbsp;<span class="ident" id="3002355">nBytes</span>&nbsp;<span class="op" id="3002362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002367">return</span>&nbsp;<span class="ident" id="3002374">n</span><span class="op" id="3002375">,</span>&nbsp;<span class="ident" id="3002377">io</span><span class="op" id="3002379">.</span><span class="ident" id="3002380">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002402">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002434">b</span><span class="op" id="3002435">.</span><span class="ident" id="3002436">Truncate</span><span class="op" id="3002444">(</span><span class="num" id="3002445">0</span><span class="op" id="3002446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002449">return</span><br>
<span class="lineno">220</span><span class="op" id="3002456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002459">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="3002536">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3002613">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="3002686">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="3002702">func</span>&nbsp;<span class="op" id="3002707">(</span><span class="ident" id="3002708">b</span>&nbsp;<span class="op" id="3002710">*</span><span class="ident" id="3002711">Buffer</span><span class="op" id="3002717">)</span>&nbsp;<span class="ident" id="3002719">WriteByte</span><span class="op" id="3002728">(</span><span class="ident" id="3002729">c</span>&nbsp;<span class="builtintype" id="3002731">byte</span><span class="op" id="3002735">)</span>&nbsp;<span class="builtintype" id="3002737">error</span>&nbsp;<span class="op" id="3002743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002746">b</span><span class="op" id="3002747">.</span><span class="ident" id="3002748">lastRead</span>&nbsp;<span class="op" id="3002757">=</span>&nbsp;<span class="ident" id="3002759">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002770">m</span>&nbsp;<span class="op" id="3002772">:=</span>&nbsp;<span class="ident" id="3002775">b</span><span class="op" id="3002776">.</span><span class="ident" id="3002777">grow</span><span class="op" id="3002781">(</span><span class="num" id="3002782">1</span><span class="op" id="3002783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002786">b</span><span class="op" id="3002787">.</span><span class="ident" id="3002788">buf</span><span class="op" id="3002791">[</span><span class="ident" id="3002792">m</span><span class="op" id="3002793">]</span>&nbsp;<span class="op" id="3002795">=</span>&nbsp;<span class="ident" id="3002797">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002800">return</span>&nbsp;<span class="ident" id="3002807">nil</span><br>
<span class="lineno"></span><span class="op" id="3002811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002814">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3002885">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="3002958">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="3003036">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="3003103">func</span>&nbsp;<span class="op" id="3003108">(</span><span class="ident" id="3003109">b</span>&nbsp;<span class="op" id="3003111">*</span><span class="ident" id="3003112">Buffer</span><span class="op" id="3003118">)</span>&nbsp;<span class="ident" id="3003120">WriteRune</span><span class="op" id="3003129">(</span><span class="ident" id="3003130">r</span>&nbsp;<span class="builtintype" id="3003132">rune</span><span class="op" id="3003136">)</span>&nbsp;<span class="op" id="3003138">(</span><span class="ident" id="3003139">n</span>&nbsp;<span class="builtintype" id="3003141">int</span><span class="op" id="3003144">,</span>&nbsp;<span class="ident" id="3003146">err</span>&nbsp;<span class="builtintype" id="3003150">error</span><span class="op" id="3003155">)</span>&nbsp;<span class="op" id="3003157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003160">if</span>&nbsp;<span class="ident" id="3003163">r</span>&nbsp;<span class="op" id="3003165">&lt;</span>&nbsp;<span class="ident" id="3003167">utf8</span><span class="op" id="3003171">.</span><span class="ident" id="3003172">RuneSelf</span>&nbsp;<span class="op" id="3003181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003185">b</span><span class="op" id="3003186">.</span><span class="ident" id="3003187">WriteByte</span><span class="op" id="3003196">(</span><span class="builtintype" id="3003197">byte</span><span class="op" id="3003201">(</span><span class="ident" id="3003202">r</span><span class="op" id="3003203">)</span><span class="op" id="3003204">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003208">return</span>&nbsp;<span class="num" id="3003215">1</span><span class="op" id="3003216">,</span>&nbsp;<span class="ident" id="3003218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003226">n</span>&nbsp;<span class="op" id="3003228">=</span>&nbsp;<span class="ident" id="3003230">utf8</span><span class="op" id="3003234">.</span><span class="ident" id="3003235">EncodeRune</span><span class="op" id="3003245">(</span><span class="ident" id="3003246">b</span><span class="op" id="3003247">.</span><span class="ident" id="3003248">runeBytes</span><span class="op" id="3003257">[</span><span class="num" id="3003258">0</span><span class="op" id="3003259">:</span><span class="op" id="3003260">]</span><span class="op" id="3003261">,</span>&nbsp;<span class="ident" id="3003263">r</span><span class="op" id="3003264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003267">b</span><span class="op" id="3003268">.</span><span class="ident" id="3003269">Write</span><span class="op" id="3003274">(</span><span class="ident" id="3003275">b</span><span class="op" id="3003276">.</span><span class="ident" id="3003277">runeBytes</span><span class="op" id="3003286">[</span><span class="num" id="3003287">0</span><span class="op" id="3003288">:</span><span class="ident" id="3003289">n</span><span class="op" id="3003290">]</span><span class="op" id="3003291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003294">return</span>&nbsp;<span class="ident" id="3003301">n</span><span class="op" id="3003302">,</span>&nbsp;<span class="ident" id="3003304">nil</span><br>
<span class="lineno">245</span><span class="op" id="3003308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3003311">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3003383">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3003455">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="3003527">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3003551">func</span>&nbsp;<span class="op" id="3003556">(</span><span class="ident" id="3003557">b</span>&nbsp;<span class="op" id="3003559">*</span><span class="ident" id="3003560">Buffer</span><span class="op" id="3003566">)</span>&nbsp;<span class="ident" id="3003568">Read</span><span class="op" id="3003572">(</span><span class="ident" id="3003573">p</span>&nbsp;<span class="op" id="3003575">[</span><span class="op" id="3003576">]</span><span class="builtintype" id="3003577">byte</span><span class="op" id="3003581">)</span>&nbsp;<span class="op" id="3003583">(</span><span class="ident" id="3003584">n</span>&nbsp;<span class="builtintype" id="3003586">int</span><span class="op" id="3003589">,</span>&nbsp;<span class="ident" id="3003591">err</span>&nbsp;<span class="builtintype" id="3003595">error</span><span class="op" id="3003600">)</span>&nbsp;<span class="op" id="3003602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003605">b</span><span class="op" id="3003606">.</span><span class="ident" id="3003607">lastRead</span>&nbsp;<span class="op" id="3003616">=</span>&nbsp;<span class="ident" id="3003618">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003629">if</span>&nbsp;<span class="ident" id="3003632">b</span><span class="op" id="3003633">.</span><span class="ident" id="3003634">off</span>&nbsp;<span class="op" id="3003638">&gt;=</span>&nbsp;<span class="builtinfunc" id="3003641">len</span><span class="op" id="3003644">(</span><span class="ident" id="3003645">b</span><span class="op" id="3003646">.</span><span class="ident" id="3003647">buf</span><span class="op" id="3003650">)</span>&nbsp;<span class="op" id="3003652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003656">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003702">b</span><span class="op" id="3003703">.</span><span class="ident" id="3003704">Truncate</span><span class="op" id="3003712">(</span><span class="num" id="3003713">0</span><span class="op" id="3003714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003718">if</span>&nbsp;<span class="builtinfunc" id="3003721">len</span><span class="op" id="3003724">(</span><span class="ident" id="3003725">p</span><span class="op" id="3003726">)</span>&nbsp;<span class="op" id="3003728">==</span>&nbsp;<span class="num" id="3003731">0</span>&nbsp;<span class="op" id="3003733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003738">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003751">return</span>&nbsp;<span class="num" id="3003758">0</span><span class="op" id="3003759">,</span>&nbsp;<span class="ident" id="3003761">io</span><span class="op" id="3003763">.</span><span class="ident" id="3003764">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003772">n</span>&nbsp;<span class="op" id="3003774">=</span>&nbsp;<span class="builtinfunc" id="3003776">copy</span><span class="op" id="3003780">(</span><span class="ident" id="3003781">p</span><span class="op" id="3003782">,</span>&nbsp;<span class="ident" id="3003784">b</span><span class="op" id="3003785">.</span><span class="ident" id="3003786">buf</span><span class="op" id="3003789">[</span><span class="ident" id="3003790">b</span><span class="op" id="3003791">.</span><span class="ident" id="3003792">off</span><span class="op" id="3003795">:</span><span class="op" id="3003796">]</span><span class="op" id="3003797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003800">b</span><span class="op" id="3003801">.</span><span class="ident" id="3003802">off</span>&nbsp;<span class="op" id="3003806">+=</span>&nbsp;<span class="ident" id="3003809">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003812">if</span>&nbsp;<span class="ident" id="3003815">n</span>&nbsp;<span class="op" id="3003817">&gt;</span>&nbsp;<span class="num" id="3003819">0</span>&nbsp;<span class="op" id="3003821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003825">b</span><span class="op" id="3003826">.</span><span class="ident" id="3003827">lastRead</span>&nbsp;<span class="op" id="3003836">=</span>&nbsp;<span class="ident" id="3003838">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003849">return</span><br>
<span class="lineno"></span><span class="op" id="3003856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3003859">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="3003928">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="3003995">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3004077">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3004151">func</span>&nbsp;<span class="op" id="3004156">(</span><span class="ident" id="3004157">b</span>&nbsp;<span class="op" id="3004159">*</span><span class="ident" id="3004160">Buffer</span><span class="op" id="3004166">)</span>&nbsp;<span class="ident" id="3004168">Next</span><span class="op" id="3004172">(</span><span class="ident" id="3004173">n</span>&nbsp;<span class="builtintype" id="3004175">int</span><span class="op" id="3004178">)</span>&nbsp;<span class="op" id="3004180">[</span><span class="op" id="3004181">]</span><span class="builtintype" id="3004182">byte</span>&nbsp;<span class="op" id="3004187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004190">b</span><span class="op" id="3004191">.</span><span class="ident" id="3004192">lastRead</span>&nbsp;<span class="op" id="3004201">=</span>&nbsp;<span class="ident" id="3004203">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004214">m</span>&nbsp;<span class="op" id="3004216">:=</span>&nbsp;<span class="ident" id="3004219">b</span><span class="op" id="3004220">.</span><span class="ident" id="3004221">Len</span><span class="op" id="3004224">(</span><span class="op" id="3004225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004228">if</span>&nbsp;<span class="ident" id="3004231">n</span>&nbsp;<span class="op" id="3004233">&gt;</span>&nbsp;<span class="ident" id="3004235">m</span>&nbsp;<span class="op" id="3004237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004241">n</span>&nbsp;<span class="op" id="3004243">=</span>&nbsp;<span class="ident" id="3004245">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004251">data</span>&nbsp;<span class="op" id="3004256">:=</span>&nbsp;<span class="ident" id="3004259">b</span><span class="op" id="3004260">.</span><span class="ident" id="3004261">buf</span><span class="op" id="3004264">[</span><span class="ident" id="3004265">b</span><span class="op" id="3004266">.</span><span class="ident" id="3004267">off</span>&nbsp;<span class="op" id="3004271">:</span>&nbsp;<span class="ident" id="3004273">b</span><span class="op" id="3004274">.</span><span class="ident" id="3004275">off</span><span class="op" id="3004278">+</span><span class="ident" id="3004279">n</span><span class="op" id="3004280">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004283">b</span><span class="op" id="3004284">.</span><span class="ident" id="3004285">off</span>&nbsp;<span class="op" id="3004289">+=</span>&nbsp;<span class="ident" id="3004292">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004295">if</span>&nbsp;<span class="ident" id="3004298">n</span>&nbsp;<span class="op" id="3004300">&gt;</span>&nbsp;<span class="num" id="3004302">0</span>&nbsp;<span class="op" id="3004304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004308">b</span><span class="op" id="3004309">.</span><span class="ident" id="3004310">lastRead</span>&nbsp;<span class="op" id="3004319">=</span>&nbsp;<span class="ident" id="3004321">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004332">return</span>&nbsp;<span class="ident" id="3004339">data</span><br>
<span class="lineno">285</span><span class="op" id="3004344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3004347">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3004408">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3004461">func</span>&nbsp;<span class="op" id="3004466">(</span><span class="ident" id="3004467">b</span>&nbsp;<span class="op" id="3004469">*</span><span class="ident" id="3004470">Buffer</span><span class="op" id="3004476">)</span>&nbsp;<span class="ident" id="3004478">ReadByte</span><span class="op" id="3004486">(</span><span class="op" id="3004487">)</span>&nbsp;<span class="op" id="3004489">(</span><span class="ident" id="3004490">c</span>&nbsp;<span class="builtintype" id="3004492">byte</span><span class="op" id="3004496">,</span>&nbsp;<span class="ident" id="3004498">err</span>&nbsp;<span class="builtintype" id="3004502">error</span><span class="op" id="3004507">)</span>&nbsp;<span class="op" id="3004509">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004512">b</span><span class="op" id="3004513">.</span><span class="ident" id="3004514">lastRead</span>&nbsp;<span class="op" id="3004523">=</span>&nbsp;<span class="ident" id="3004525">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004536">if</span>&nbsp;<span class="ident" id="3004539">b</span><span class="op" id="3004540">.</span><span class="ident" id="3004541">off</span>&nbsp;<span class="op" id="3004545">&gt;=</span>&nbsp;<span class="builtinfunc" id="3004548">len</span><span class="op" id="3004551">(</span><span class="ident" id="3004552">b</span><span class="op" id="3004553">.</span><span class="ident" id="3004554">buf</span><span class="op" id="3004557">)</span>&nbsp;<span class="op" id="3004559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004563">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004609">b</span><span class="op" id="3004610">.</span><span class="ident" id="3004611">Truncate</span><span class="op" id="3004619">(</span><span class="num" id="3004620">0</span><span class="op" id="3004621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004625">return</span>&nbsp;<span class="num" id="3004632">0</span><span class="op" id="3004633">,</span>&nbsp;<span class="ident" id="3004635">io</span><span class="op" id="3004637">.</span><span class="ident" id="3004638">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004646">c</span>&nbsp;<span class="op" id="3004648">=</span>&nbsp;<span class="ident" id="3004650">b</span><span class="op" id="3004651">.</span><span class="ident" id="3004652">buf</span><span class="op" id="3004655">[</span><span class="ident" id="3004656">b</span><span class="op" id="3004657">.</span><span class="ident" id="3004658">off</span><span class="op" id="3004661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004664">b</span><span class="op" id="3004665">.</span><span class="ident" id="3004666">off</span><span class="op" id="3004669">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004673">b</span><span class="op" id="3004674">.</span><span class="ident" id="3004675">lastRead</span>&nbsp;<span class="op" id="3004684">=</span>&nbsp;<span class="ident" id="3004686">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004694">return</span>&nbsp;<span class="ident" id="3004701">c</span><span class="op" id="3004702">,</span>&nbsp;<span class="ident" id="3004704">nil</span><br>
<span class="lineno">300</span><span class="op" id="3004708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3004711">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="3004764">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3004803">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="3004863">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3004915">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3004959">func</span>&nbsp;<span class="op" id="3004964">(</span><span class="ident" id="3004965">b</span>&nbsp;<span class="op" id="3004967">*</span><span class="ident" id="3004968">Buffer</span><span class="op" id="3004974">)</span>&nbsp;<span class="ident" id="3004976">ReadRune</span><span class="op" id="3004984">(</span><span class="op" id="3004985">)</span>&nbsp;<span class="op" id="3004987">(</span><span class="ident" id="3004988">r</span>&nbsp;<span class="builtintype" id="3004990">rune</span><span class="op" id="3004994">,</span>&nbsp;<span class="ident" id="3004996">size</span>&nbsp;<span class="builtintype" id="3005001">int</span><span class="op" id="3005004">,</span>&nbsp;<span class="ident" id="3005006">err</span>&nbsp;<span class="builtintype" id="3005010">error</span><span class="op" id="3005015">)</span>&nbsp;<span class="op" id="3005017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005020">b</span><span class="op" id="3005021">.</span><span class="ident" id="3005022">lastRead</span>&nbsp;<span class="op" id="3005031">=</span>&nbsp;<span class="ident" id="3005033">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005044">if</span>&nbsp;<span class="ident" id="3005047">b</span><span class="op" id="3005048">.</span><span class="ident" id="3005049">off</span>&nbsp;<span class="op" id="3005053">&gt;=</span>&nbsp;<span class="builtinfunc" id="3005056">len</span><span class="op" id="3005059">(</span><span class="ident" id="3005060">b</span><span class="op" id="3005061">.</span><span class="ident" id="3005062">buf</span><span class="op" id="3005065">)</span>&nbsp;<span class="op" id="3005067">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005071">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005117">b</span><span class="op" id="3005118">.</span><span class="ident" id="3005119">Truncate</span><span class="op" id="3005127">(</span><span class="num" id="3005128">0</span><span class="op" id="3005129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005133">return</span>&nbsp;<span class="num" id="3005140">0</span><span class="op" id="3005141">,</span>&nbsp;<span class="num" id="3005143">0</span><span class="op" id="3005144">,</span>&nbsp;<span class="ident" id="3005146">io</span><span class="op" id="3005148">.</span><span class="ident" id="3005149">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005157">b</span><span class="op" id="3005158">.</span><span class="ident" id="3005159">lastRead</span>&nbsp;<span class="op" id="3005168">=</span>&nbsp;<span class="ident" id="3005170">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005182">c</span>&nbsp;<span class="op" id="3005184">:=</span>&nbsp;<span class="ident" id="3005187">b</span><span class="op" id="3005188">.</span><span class="ident" id="3005189">buf</span><span class="op" id="3005192">[</span><span class="ident" id="3005193">b</span><span class="op" id="3005194">.</span><span class="ident" id="3005195">off</span><span class="op" id="3005198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005201">if</span>&nbsp;<span class="ident" id="3005204">c</span>&nbsp;<span class="op" id="3005206">&lt;</span>&nbsp;<span class="ident" id="3005208">utf8</span><span class="op" id="3005212">.</span><span class="ident" id="3005213">RuneSelf</span>&nbsp;<span class="op" id="3005222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005226">b</span><span class="op" id="3005227">.</span><span class="ident" id="3005228">off</span><span class="op" id="3005231">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005236">return</span>&nbsp;<span class="builtintype" id="3005243">rune</span><span class="op" id="3005247">(</span><span class="ident" id="3005248">c</span><span class="op" id="3005249">)</span><span class="op" id="3005250">,</span>&nbsp;<span class="num" id="3005252">1</span><span class="op" id="3005253">,</span>&nbsp;<span class="ident" id="3005255">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005260">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005263">r</span><span class="op" id="3005264">,</span>&nbsp;<span class="ident" id="3005266">n</span>&nbsp;<span class="op" id="3005268">:=</span>&nbsp;<span class="ident" id="3005271">utf8</span><span class="op" id="3005275">.</span><span class="ident" id="3005276">DecodeRune</span><span class="op" id="3005286">(</span><span class="ident" id="3005287">b</span><span class="op" id="3005288">.</span><span class="ident" id="3005289">buf</span><span class="op" id="3005292">[</span><span class="ident" id="3005293">b</span><span class="op" id="3005294">.</span><span class="ident" id="3005295">off</span><span class="op" id="3005298">:</span><span class="op" id="3005299">]</span><span class="op" id="3005300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005303">b</span><span class="op" id="3005304">.</span><span class="ident" id="3005305">off</span>&nbsp;<span class="op" id="3005309">+=</span>&nbsp;<span class="ident" id="3005312">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005315">return</span>&nbsp;<span class="ident" id="3005322">r</span><span class="op" id="3005323">,</span>&nbsp;<span class="ident" id="3005325">n</span><span class="op" id="3005326">,</span>&nbsp;<span class="ident" id="3005328">nil</span><br>
<span class="lineno"></span><span class="op" id="3005332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="3005335">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="3005393">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="3005457">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="3005522">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3005589">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="3005618">func</span>&nbsp;<span class="op" id="3005623">(</span><span class="ident" id="3005624">b</span>&nbsp;<span class="op" id="3005626">*</span><span class="ident" id="3005627">Buffer</span><span class="op" id="3005633">)</span>&nbsp;<span class="ident" id="3005635">UnreadRune</span><span class="op" id="3005645">(</span><span class="op" id="3005646">)</span>&nbsp;<span class="builtintype" id="3005648">error</span>&nbsp;<span class="op" id="3005654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005657">if</span>&nbsp;<span class="ident" id="3005660">b</span><span class="op" id="3005661">.</span><span class="ident" id="3005662">lastRead</span>&nbsp;<span class="op" id="3005671">!=</span>&nbsp;<span class="ident" id="3005674">opReadRune</span>&nbsp;<span class="op" id="3005685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005689">return</span>&nbsp;<span class="ident" id="3005696">errors</span><span class="op" id="3005702">.</span><span class="ident" id="3005703">New</span><span class="op" id="3005706">(</span><span class="string" id="3005707">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="3005770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005776">b</span><span class="op" id="3005777">.</span><span class="ident" id="3005778">lastRead</span>&nbsp;<span class="op" id="3005787">=</span>&nbsp;<span class="ident" id="3005789">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005800">if</span>&nbsp;<span class="ident" id="3005803">b</span><span class="op" id="3005804">.</span><span class="ident" id="3005805">off</span>&nbsp;<span class="op" id="3005809">&gt;</span>&nbsp;<span class="num" id="3005811">0</span>&nbsp;<span class="op" id="3005813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005817">_</span><span class="op" id="3005818">,</span>&nbsp;<span class="ident" id="3005820">n</span>&nbsp;<span class="op" id="3005822">:=</span>&nbsp;<span class="ident" id="3005825">utf8</span><span class="op" id="3005829">.</span><span class="ident" id="3005830">DecodeLastRune</span><span class="op" id="3005844">(</span><span class="ident" id="3005845">b</span><span class="op" id="3005846">.</span><span class="ident" id="3005847">buf</span><span class="op" id="3005850">[</span><span class="num" id="3005851">0</span><span class="op" id="3005852">:</span><span class="ident" id="3005853">b</span><span class="op" id="3005854">.</span><span class="ident" id="3005855">off</span><span class="op" id="3005858">]</span><span class="op" id="3005859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005863">b</span><span class="op" id="3005864">.</span><span class="ident" id="3005865">off</span>&nbsp;<span class="op" id="3005869">-=</span>&nbsp;<span class="ident" id="3005872">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005878">return</span>&nbsp;<span class="ident" id="3005885">nil</span><br>
<span class="lineno">340</span><span class="op" id="3005889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3005892">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="3005956">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="3006030">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="3006051">func</span>&nbsp;<span class="op" id="3006056">(</span><span class="ident" id="3006057">b</span>&nbsp;<span class="op" id="3006059">*</span><span class="ident" id="3006060">Buffer</span><span class="op" id="3006066">)</span>&nbsp;<span class="ident" id="3006068">UnreadByte</span><span class="op" id="3006078">(</span><span class="op" id="3006079">)</span>&nbsp;<span class="builtintype" id="3006081">error</span>&nbsp;<span class="op" id="3006087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006090">if</span>&nbsp;<span class="ident" id="3006093">b</span><span class="op" id="3006094">.</span><span class="ident" id="3006095">lastRead</span>&nbsp;<span class="op" id="3006104">!=</span>&nbsp;<span class="ident" id="3006107">opReadRune</span>&nbsp;<span class="op" id="3006118">&amp;&amp;</span>&nbsp;<span class="ident" id="3006121">b</span><span class="op" id="3006122">.</span><span class="ident" id="3006123">lastRead</span>&nbsp;<span class="op" id="3006132">!=</span>&nbsp;<span class="ident" id="3006135">opRead</span>&nbsp;<span class="op" id="3006142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006146">return</span>&nbsp;<span class="ident" id="3006153">errors</span><span class="op" id="3006159">.</span><span class="ident" id="3006160">New</span><span class="op" id="3006163">(</span><span class="string" id="3006164">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="3006225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006231">b</span><span class="op" id="3006232">.</span><span class="ident" id="3006233">lastRead</span>&nbsp;<span class="op" id="3006242">=</span>&nbsp;<span class="ident" id="3006244">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006255">if</span>&nbsp;<span class="ident" id="3006258">b</span><span class="op" id="3006259">.</span><span class="ident" id="3006260">off</span>&nbsp;<span class="op" id="3006264">&gt;</span>&nbsp;<span class="num" id="3006266">0</span>&nbsp;<span class="op" id="3006268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006272">b</span><span class="op" id="3006273">.</span><span class="ident" id="3006274">off</span><span class="op" id="3006277">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006284">return</span>&nbsp;<span class="ident" id="3006291">nil</span><br>
<span class="lineno"></span><span class="op" id="3006295">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="3006298">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3006367">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3006443">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3006507">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="3006589">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3006670">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="3006680">func</span>&nbsp;<span class="op" id="3006685">(</span><span class="ident" id="3006686">b</span>&nbsp;<span class="op" id="3006688">*</span><span class="ident" id="3006689">Buffer</span><span class="op" id="3006695">)</span>&nbsp;<span class="ident" id="3006697">ReadBytes</span><span class="op" id="3006706">(</span><span class="ident" id="3006707">delim</span>&nbsp;<span class="builtintype" id="3006713">byte</span><span class="op" id="3006717">)</span>&nbsp;<span class="op" id="3006719">(</span><span class="ident" id="3006720">line</span>&nbsp;<span class="op" id="3006725">[</span><span class="op" id="3006726">]</span><span class="builtintype" id="3006727">byte</span><span class="op" id="3006731">,</span>&nbsp;<span class="ident" id="3006733">err</span>&nbsp;<span class="builtintype" id="3006737">error</span><span class="op" id="3006742">)</span>&nbsp;<span class="op" id="3006744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006747">slice</span><span class="op" id="3006752">,</span>&nbsp;<span class="ident" id="3006754">err</span>&nbsp;<span class="op" id="3006758">:=</span>&nbsp;<span class="ident" id="3006761">b</span><span class="op" id="3006762">.</span><span class="ident" id="3006763">readSlice</span><span class="op" id="3006772">(</span><span class="ident" id="3006773">delim</span><span class="op" id="3006778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006781">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006840">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006875">line</span>&nbsp;<span class="op" id="3006880">=</span>&nbsp;<span class="builtinfunc" id="3006882">append</span><span class="op" id="3006888">(</span><span class="ident" id="3006889">line</span><span class="op" id="3006893">,</span>&nbsp;<span class="ident" id="3006895">slice</span><span class="op" id="3006900">...</span><span class="op" id="3006903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006906">return</span><br>
<span class="lineno"></span><span class="op" id="3006913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="3006916">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3006996">func</span>&nbsp;<span class="op" id="3007001">(</span><span class="ident" id="3007002">b</span>&nbsp;<span class="op" id="3007004">*</span><span class="ident" id="3007005">Buffer</span><span class="op" id="3007011">)</span>&nbsp;<span class="ident" id="3007013">readSlice</span><span class="op" id="3007022">(</span><span class="ident" id="3007023">delim</span>&nbsp;<span class="builtintype" id="3007029">byte</span><span class="op" id="3007033">)</span>&nbsp;<span class="op" id="3007035">(</span><span class="ident" id="3007036">line</span>&nbsp;<span class="op" id="3007041">[</span><span class="op" id="3007042">]</span><span class="builtintype" id="3007043">byte</span><span class="op" id="3007047">,</span>&nbsp;<span class="ident" id="3007049">err</span>&nbsp;<span class="builtintype" id="3007053">error</span><span class="op" id="3007058">)</span>&nbsp;<span class="op" id="3007060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007063">i</span>&nbsp;<span class="op" id="3007065">:=</span>&nbsp;<span class="ident" id="3007068">IndexByte</span><span class="op" id="3007077">(</span><span class="ident" id="3007078">b</span><span class="op" id="3007079">.</span><span class="ident" id="3007080">buf</span><span class="op" id="3007083">[</span><span class="ident" id="3007084">b</span><span class="op" id="3007085">.</span><span class="ident" id="3007086">off</span><span class="op" id="3007089">:</span><span class="op" id="3007090">]</span><span class="op" id="3007091">,</span>&nbsp;<span class="ident" id="3007093">delim</span><span class="op" id="3007098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007101">end</span>&nbsp;<span class="op" id="3007105">:=</span>&nbsp;<span class="ident" id="3007108">b</span><span class="op" id="3007109">.</span><span class="ident" id="3007110">off</span>&nbsp;<span class="op" id="3007114">+</span>&nbsp;<span class="ident" id="3007116">i</span>&nbsp;<span class="op" id="3007118">+</span>&nbsp;<span class="num" id="3007120">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007123">if</span>&nbsp;<span class="ident" id="3007126">i</span>&nbsp;<span class="op" id="3007128">&lt;</span>&nbsp;<span class="num" id="3007130">0</span>&nbsp;<span class="op" id="3007132">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007136">end</span>&nbsp;<span class="op" id="3007140">=</span>&nbsp;<span class="builtinfunc" id="3007142">len</span><span class="op" id="3007145">(</span><span class="ident" id="3007146">b</span><span class="op" id="3007147">.</span><span class="ident" id="3007148">buf</span><span class="op" id="3007151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007155">err</span>&nbsp;<span class="op" id="3007159">=</span>&nbsp;<span class="ident" id="3007161">io</span><span class="op" id="3007163">.</span><span class="ident" id="3007164">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3007169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007172">line</span>&nbsp;<span class="op" id="3007177">=</span>&nbsp;<span class="ident" id="3007179">b</span><span class="op" id="3007180">.</span><span class="ident" id="3007181">buf</span><span class="op" id="3007184">[</span><span class="ident" id="3007185">b</span><span class="op" id="3007186">.</span><span class="ident" id="3007187">off</span><span class="op" id="3007190">:</span><span class="ident" id="3007191">end</span><span class="op" id="3007194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007197">b</span><span class="op" id="3007198">.</span><span class="ident" id="3007199">off</span>&nbsp;<span class="op" id="3007203">=</span>&nbsp;<span class="ident" id="3007205">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007210">b</span><span class="op" id="3007211">.</span><span class="ident" id="3007212">lastRead</span>&nbsp;<span class="op" id="3007221">=</span>&nbsp;<span class="ident" id="3007223">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007231">return</span>&nbsp;<span class="ident" id="3007238">line</span><span class="op" id="3007242">,</span>&nbsp;<span class="ident" id="3007244">err</span><br>
<span class="lineno"></span><span class="op" id="3007248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3007251">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="3007321">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3007398">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3007463">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3007545">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="3007624">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="3007637">func</span>&nbsp;<span class="op" id="3007642">(</span><span class="ident" id="3007643">b</span>&nbsp;<span class="op" id="3007645">*</span><span class="ident" id="3007646">Buffer</span><span class="op" id="3007652">)</span>&nbsp;<span class="ident" id="3007654">ReadString</span><span class="op" id="3007664">(</span><span class="ident" id="3007665">delim</span>&nbsp;<span class="builtintype" id="3007671">byte</span><span class="op" id="3007675">)</span>&nbsp;<span class="op" id="3007677">(</span><span class="ident" id="3007678">line</span>&nbsp;<span class="builtintype" id="3007683">string</span><span class="op" id="3007689">,</span>&nbsp;<span class="ident" id="3007691">err</span>&nbsp;<span class="builtintype" id="3007695">error</span><span class="op" id="3007700">)</span>&nbsp;<span class="op" id="3007702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007705">slice</span><span class="op" id="3007710">,</span>&nbsp;<span class="ident" id="3007712">err</span>&nbsp;<span class="op" id="3007716">:=</span>&nbsp;<span class="ident" id="3007719">b</span><span class="op" id="3007720">.</span><span class="ident" id="3007721">readSlice</span><span class="op" id="3007730">(</span><span class="ident" id="3007731">delim</span><span class="op" id="3007736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007739">return</span>&nbsp;<span class="builtintype" id="3007746">string</span><span class="op" id="3007752">(</span><span class="ident" id="3007753">slice</span><span class="op" id="3007758">)</span><span class="op" id="3007759">,</span>&nbsp;<span class="ident" id="3007761">err</span><br>
<span class="lineno"></span><span class="op" id="3007765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="3007768">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="3007843">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3007919">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="3007992">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="3008054">//</span><br>
<span class="lineno">400</span><span class="comment" id="3008057">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3008128">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3008166">func</span>&nbsp;<span class="ident" id="3008171">NewBuffer</span><span class="op" id="3008180">(</span><span class="ident" id="3008181">buf</span>&nbsp;<span class="op" id="3008185">[</span><span class="op" id="3008186">]</span><span class="builtintype" id="3008187">byte</span><span class="op" id="3008191">)</span>&nbsp;<span class="op" id="3008193">*</span><span class="ident" id="3008194">Buffer</span>&nbsp;<span class="op" id="3008201">{</span>&nbsp;<span class="keyword" id="3008203">return</span>&nbsp;<span class="op" id="3008210">&amp;</span><span class="ident" id="3008211">Buffer</span><span class="op" id="3008217">{</span><span class="ident" id="3008218">buf</span><span class="op" id="3008221">:</span>&nbsp;<span class="ident" id="3008223">buf</span><span class="op" id="3008226">}</span>&nbsp;<span class="op" id="3008228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3008231">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="3008309">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3008385">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3008396">//</span><br>
<span class="lineno"></span><span class="comment" id="3008399">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3008470">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="3008508">func</span>&nbsp;<span class="ident" id="3008513">NewBufferString</span><span class="op" id="3008528">(</span><span class="ident" id="3008529">s</span>&nbsp;<span class="builtintype" id="3008531">string</span><span class="op" id="3008537">)</span>&nbsp;<span class="op" id="3008539">*</span><span class="ident" id="3008540">Buffer</span>&nbsp;<span class="op" id="3008547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008550">return</span>&nbsp;<span class="op" id="3008557">&amp;</span><span class="ident" id="3008558">Buffer</span><span class="op" id="3008564">{</span><span class="ident" id="3008565">buf</span><span class="op" id="3008568">:</span>&nbsp;<span class="op" id="3008570">[</span><span class="op" id="3008571">]</span><span class="builtintype" id="3008572">byte</span><span class="op" id="3008576">(</span><span class="ident" id="3008577">s</span><span class="op" id="3008578">)</span><span class="op" id="3008579">}</span><br>
<span class="lineno"></span><span class="op" id="3008581">}</span>
</div>
</body>
</html>
