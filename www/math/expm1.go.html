<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1450910">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1450965">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1451019">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1451070">package</span>&nbsp;<span class="ident" id="1451078">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1451084">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="1451144">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="1451204">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="1451263">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1451293">//</span><br>
<span class="lineno"></span><span class="comment" id="1451296">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="1451352">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1451421">//</span><br>
<span class="lineno">15</span><span class="comment" id="1451424">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="1451483">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="1451539">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="1451596">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="1451613">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="1451669">//</span><br>
<span class="lineno"></span><span class="comment" id="1451672">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="1451684">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1451735">//</span><br>
<span class="lineno"></span><span class="comment" id="1451738">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="1451748">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="1451776">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1451824">//</span><br>
<span class="lineno"></span><span class="comment" id="1451827">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="1451885">//</span><br>
<span class="lineno">30</span><span class="comment" id="1451888">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="1451952">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="1452016">//</span><br>
<span class="lineno"></span><span class="comment" id="1452019">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1452084">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="1452118">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="1452132">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1452197">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1452226">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="1452284">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="1452301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="1452359">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="1452420">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1452487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="1452552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="1452615">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="1452681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="1452716">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="1452787">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="1452837">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="1452887">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="1452937">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="1452987">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="1453037">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="1453104">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="1453134">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="1453187">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="1453237">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="1453282">//</span><br>
<span class="lineno"></span><span class="comment" id="1453285">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="1453347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="1453416">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="1453455">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="1453519">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="1453583">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="1453647">//</span><br>
<span class="lineno"></span><span class="comment" id="1453650">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1453716">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="1453771">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="1453819">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="1453883">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="1453948">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="1453966">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1454038">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1454110">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="1454182">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1454254">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1454326">//</span><br>
<span class="lineno"></span><span class="comment" id="1454329">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="1454356">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="1454395">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1454424">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="1454475">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="1454532">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="1454562">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="1454631">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="1454683">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1454748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="1454819">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="1454854">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="1454900">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="1454959">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="1455019">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="1455090">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="1455153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="1455198">//</span><br>
<span class="lineno"></span><span class="comment" id="1455201">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="1455219">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="1455265">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1455296">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="1455351">//</span><br>
<span class="lineno"></span><span class="comment" id="1455354">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="1455367">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="1455437">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="1455477">//</span><br>
<span class="lineno">105</span><span class="comment" id="1455480">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="1455495">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="1455519">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="1455589">//</span><br>
<span class="lineno"></span><span class="comment" id="1455592">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="1455606">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="1455672">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1455736">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="1455802">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="1455846">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1455850">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1455914">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1455974">//</span><br>
<span class="lineno"></span><span class="comment" id="1455977">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="1455999">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="1456021">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="1456041">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="1456061">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="1456106">func</span>&nbsp;<span class="ident" id="1456111">Expm1</span><span class="op" id="1456116">(</span><span class="ident" id="1456117">x</span>&nbsp;<span class="builtintype" id="1456119">float64</span><span class="op" id="1456126">)</span>&nbsp;<span class="builtintype" id="1456128">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1456137">func</span>&nbsp;<span class="ident" id="1456142">expm1</span><span class="op" id="1456147">(</span><span class="ident" id="1456148">x</span>&nbsp;<span class="builtintype" id="1456150">float64</span><span class="op" id="1456157">)</span>&nbsp;<span class="builtintype" id="1456159">float64</span>&nbsp;<span class="op" id="1456167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456170">const</span>&nbsp;<span class="op" id="1456176">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456180">Othreshold</span>&nbsp;<span class="op" id="1456191">=</span>&nbsp;<span class="num" id="1456193">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="1456220">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456244">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456255">=</span>&nbsp;<span class="num" id="1456257">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="1456284">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456308">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="1456319">=</span>&nbsp;<span class="num" id="1456321">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="1456348">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456372">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456383">=</span>&nbsp;<span class="num" id="1456385">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="1456412">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456436">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456447">=</span>&nbsp;<span class="num" id="1456449">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="1456476">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456500">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456511">=</span>&nbsp;<span class="num" id="1456513">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="1456540">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456564">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456575">=</span>&nbsp;<span class="num" id="1456577">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="1456604">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456628">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1456639">=</span>&nbsp;<span class="num" id="1456641">1.0</span>&nbsp;<span class="op" id="1456645">/</span>&nbsp;<span class="op" id="1456647">(</span><span class="num" id="1456648">1</span>&nbsp;<span class="op" id="1456650">&lt;&lt;</span>&nbsp;<span class="num" id="1456653">54</span><span class="op" id="1456655">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1456668">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456701">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456743">Q1</span>&nbsp;<span class="op" id="1456746">=</span>&nbsp;<span class="op" id="1456748">-</span><span class="num" id="1456749">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="1456776">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456800">Q2</span>&nbsp;<span class="op" id="1456803">=</span>&nbsp;<span class="num" id="1456805">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="1456833">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456857">Q3</span>&nbsp;<span class="op" id="1456860">=</span>&nbsp;<span class="op" id="1456862">-</span><span class="num" id="1456863">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="1456890">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456914">Q4</span>&nbsp;<span class="op" id="1456917">=</span>&nbsp;<span class="num" id="1456919">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="1456947">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456971">Q5</span>&nbsp;<span class="op" id="1456974">=</span>&nbsp;<span class="op" id="1456976">-</span><span class="num" id="1456977">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="1457004">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1457031">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457049">switch</span>&nbsp;<span class="op" id="1457056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457059">case</span>&nbsp;<span class="ident" id="1457064"><a href="/math/bits.go.html#1427892">IsInf</a></span><span class="op" id="1457069">(</span><span class="ident" id="1457070"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1457071">,</span>&nbsp;<span class="num" id="1457073">1</span><span class="op" id="1457074">)</span>&nbsp;<span class="op" id="1457076">||</span>&nbsp;<span class="ident" id="1457079"><a href="/math/bits.go.html#1427394">IsNaN</a></span><span class="op" id="1457084">(</span><span class="ident" id="1457085"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1457086">)</span><span class="op" id="1457087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457091">return</span>&nbsp;<span class="ident" id="1457098"><a href="/math/expm1.go.html#1456148">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457101">case</span>&nbsp;<span class="ident" id="1457106"><a href="/math/bits.go.html#1427892">IsInf</a></span><span class="op" id="1457111">(</span><span class="ident" id="1457112"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1457113">,</span>&nbsp;<span class="op" id="1457115">-</span><span class="num" id="1457116">1</span><span class="op" id="1457117">)</span><span class="op" id="1457118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457122">return</span>&nbsp;<span class="op" id="1457129">-</span><span class="num" id="1457130">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457137">absx</span>&nbsp;<span class="op" id="1457142">:=</span>&nbsp;<span class="ident" id="1457145"><a href="/math/expm1.go.html#1456148">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457148">sign</span>&nbsp;<span class="op" id="1457153">:=</span>&nbsp;<span class="ident" id="1457156">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457163">if</span>&nbsp;<span class="ident" id="1457166"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457168">&lt;</span>&nbsp;<span class="num" id="1457170">0</span>&nbsp;<span class="op" id="1457172">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457176"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457181">=</span>&nbsp;<span class="op" id="1457183">-</span><span class="ident" id="1457184"><a href="/math/expm1.go.html#1457137">absx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457191"><a href="/math/expm1.go.html#1457148">sign</a></span>&nbsp;<span class="op" id="1457196">=</span>&nbsp;<span class="ident" id="1457198">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1457208">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457237">if</span>&nbsp;<span class="ident" id="1457240"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457245">&gt;=</span>&nbsp;<span class="ident" id="1457248"><a href="/math/expm1.go.html#1456244">Ln2X56</a></span>&nbsp;<span class="op" id="1457255">{</span>&nbsp;<span class="comment" id="1457257">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457281">if</span>&nbsp;<span class="ident" id="1457284"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457289">&gt;=</span>&nbsp;<span class="ident" id="1457292"><a href="/math/expm1.go.html#1456180">Othreshold</a></span>&nbsp;<span class="op" id="1457303">{</span>&nbsp;<span class="comment" id="1457305">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457331">return</span>&nbsp;<span class="ident" id="1457338"><a href="/math/bits.go.html#1427094">Inf</a></span><span class="op" id="1457341">(</span><span class="num" id="1457342">1</span><span class="op" id="1457343">)</span>&nbsp;<span class="comment" id="1457345">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457363">if</span>&nbsp;<span class="ident" id="1457366"><a href="/math/expm1.go.html#1457148">sign</a></span>&nbsp;<span class="op" id="1457371">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457376">return</span>&nbsp;<span class="op" id="1457383">-</span><span class="num" id="1457384">1</span>&nbsp;<span class="comment" id="1457386">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1457423">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457446">var</span>&nbsp;<span class="ident" id="1457450">c</span>&nbsp;<span class="builtintype" id="1457452">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457461">var</span>&nbsp;<span class="ident" id="1457465">k</span>&nbsp;<span class="builtintype" id="1457467">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457472">if</span>&nbsp;<span class="ident" id="1457475"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457480">&gt;</span>&nbsp;<span class="ident" id="1457482"><a href="/math/expm1.go.html#1456372">Ln2Half</a></span>&nbsp;<span class="op" id="1457490">{</span>&nbsp;<span class="comment" id="1457492">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457517">var</span>&nbsp;<span class="ident" id="1457521">hi</span><span class="op" id="1457523">,</span>&nbsp;<span class="ident" id="1457525">lo</span>&nbsp;<span class="builtintype" id="1457528">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457538">if</span>&nbsp;<span class="ident" id="1457541"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457546">&lt;</span>&nbsp;<span class="ident" id="1457548"><a href="/math/expm1.go.html#1456308">Ln2HalfX3</a></span>&nbsp;<span class="op" id="1457558">{</span>&nbsp;<span class="comment" id="1457560">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457586">if</span>&nbsp;<span class="op" id="1457589">!</span><span class="ident" id="1457590"><a href="/math/expm1.go.html#1457148">sign</a></span>&nbsp;<span class="op" id="1457595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457601"><a href="/math/expm1.go.html#1457521">hi</a></span>&nbsp;<span class="op" id="1457604">=</span>&nbsp;<span class="ident" id="1457606"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457608">-</span>&nbsp;<span class="ident" id="1457610"><a href="/math/expm1.go.html#1456436">Ln2Hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457620"><a href="/math/expm1.go.html#1457525">lo</a></span>&nbsp;<span class="op" id="1457623">=</span>&nbsp;<span class="ident" id="1457625"><a href="/math/expm1.go.html#1456500">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457635"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1457637">=</span>&nbsp;<span class="num" id="1457639">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457644">}</span>&nbsp;<span class="keyword" id="1457646">else</span>&nbsp;<span class="op" id="1457651">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457657"><a href="/math/expm1.go.html#1457521">hi</a></span>&nbsp;<span class="op" id="1457660">=</span>&nbsp;<span class="ident" id="1457662"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457664">+</span>&nbsp;<span class="ident" id="1457666"><a href="/math/expm1.go.html#1456436">Ln2Hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457676"><a href="/math/expm1.go.html#1457525">lo</a></span>&nbsp;<span class="op" id="1457679">=</span>&nbsp;<span class="op" id="1457681">-</span><span class="ident" id="1457682"><a href="/math/expm1.go.html#1456500">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457692"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1457694">=</span>&nbsp;<span class="op" id="1457696">-</span><span class="num" id="1457697">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457706">}</span>&nbsp;<span class="keyword" id="1457708">else</span>&nbsp;<span class="op" id="1457713">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457718">if</span>&nbsp;<span class="op" id="1457721">!</span><span class="ident" id="1457722"><a href="/math/expm1.go.html#1457148">sign</a></span>&nbsp;<span class="op" id="1457727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457733"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1457735">=</span>&nbsp;<span class="builtintype" id="1457737">int</span><span class="op" id="1457740">(</span><span class="ident" id="1457741"><a href="/math/expm1.go.html#1456564">InvLn2</a></span><span class="op" id="1457747">*</span><span class="ident" id="1457748"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457750">+</span>&nbsp;<span class="num" id="1457752">0.5</span><span class="op" id="1457755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457760">}</span>&nbsp;<span class="keyword" id="1457762">else</span>&nbsp;<span class="op" id="1457767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457773"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1457775">=</span>&nbsp;<span class="builtintype" id="1457777">int</span><span class="op" id="1457780">(</span><span class="ident" id="1457781"><a href="/math/expm1.go.html#1456564">InvLn2</a></span><span class="op" id="1457787">*</span><span class="ident" id="1457788"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457790">-</span>&nbsp;<span class="num" id="1457792">0.5</span><span class="op" id="1457795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457800">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457805">t</span>&nbsp;<span class="op" id="1457807">:=</span>&nbsp;<span class="builtintype" id="1457810">float64</span><span class="op" id="1457817">(</span><span class="ident" id="1457818"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1457819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457824"><a href="/math/expm1.go.html#1457521">hi</a></span>&nbsp;<span class="op" id="1457827">=</span>&nbsp;<span class="ident" id="1457829"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457831">-</span>&nbsp;<span class="ident" id="1457833"><a href="/math/expm1.go.html#1457805">t</a></span><span class="op" id="1457834">*</span><span class="ident" id="1457835"><a href="/math/expm1.go.html#1456436">Ln2Hi</a></span>&nbsp;<span class="comment" id="1457841">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457871"><a href="/math/expm1.go.html#1457525">lo</a></span>&nbsp;<span class="op" id="1457874">=</span>&nbsp;<span class="ident" id="1457876"><a href="/math/expm1.go.html#1457805">t</a></span>&nbsp;<span class="op" id="1457878">*</span>&nbsp;<span class="ident" id="1457880"><a href="/math/expm1.go.html#1456500">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457892"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1457894">=</span>&nbsp;<span class="ident" id="1457896"><a href="/math/expm1.go.html#1457521">hi</a></span>&nbsp;<span class="op" id="1457899">-</span>&nbsp;<span class="ident" id="1457901"><a href="/math/expm1.go.html#1457525">lo</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1457906"><a href="/math/expm1.go.html#1457450">c</a></span>&nbsp;<span class="op" id="1457908">=</span>&nbsp;<span class="op" id="1457910">(</span><span class="ident" id="1457911"><a href="/math/expm1.go.html#1457521">hi</a></span>&nbsp;<span class="op" id="1457914">-</span>&nbsp;<span class="ident" id="1457916"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1457917">)</span>&nbsp;<span class="op" id="1457919">-</span>&nbsp;<span class="ident" id="1457921"><a href="/math/expm1.go.html#1457525">lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457925">}</span>&nbsp;<span class="keyword" id="1457927">else</span>&nbsp;<span class="keyword" id="1457932">if</span>&nbsp;<span class="ident" id="1457935"><a href="/math/expm1.go.html#1457137">absx</a></span>&nbsp;<span class="op" id="1457940">&lt;</span>&nbsp;<span class="ident" id="1457942"><a href="/math/expm1.go.html#1456628">Tiny</a></span>&nbsp;<span class="op" id="1457947">{</span>&nbsp;<span class="comment" id="1457949">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457982">return</span>&nbsp;<span class="ident" id="1457989"><a href="/math/expm1.go.html#1456148">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1457992">}</span>&nbsp;<span class="keyword" id="1457994">else</span>&nbsp;<span class="op" id="1457999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458003"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458005">=</span>&nbsp;<span class="num" id="1458007">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1458010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1458014">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458044">hfx</span>&nbsp;<span class="op" id="1458048">:=</span>&nbsp;<span class="num" id="1458051">0.5</span>&nbsp;<span class="op" id="1458055">*</span>&nbsp;<span class="ident" id="1458057"><a href="/math/expm1.go.html#1456148">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458060">hxs</span>&nbsp;<span class="op" id="1458064">:=</span>&nbsp;<span class="ident" id="1458067"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1458069">*</span>&nbsp;<span class="ident" id="1458071"><a href="/math/expm1.go.html#1458044">hfx</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458076">r1</span>&nbsp;<span class="op" id="1458079">:=</span>&nbsp;<span class="num" id="1458082">1</span>&nbsp;<span class="op" id="1458084">+</span>&nbsp;<span class="ident" id="1458086"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458089">*</span><span class="op" id="1458090">(</span><span class="ident" id="1458091"><a href="/math/expm1.go.html#1456743">Q1</a></span><span class="op" id="1458093">+</span><span class="ident" id="1458094"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458097">*</span><span class="op" id="1458098">(</span><span class="ident" id="1458099"><a href="/math/expm1.go.html#1456800">Q2</a></span><span class="op" id="1458101">+</span><span class="ident" id="1458102"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458105">*</span><span class="op" id="1458106">(</span><span class="ident" id="1458107"><a href="/math/expm1.go.html#1456857">Q3</a></span><span class="op" id="1458109">+</span><span class="ident" id="1458110"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458113">*</span><span class="op" id="1458114">(</span><span class="ident" id="1458115"><a href="/math/expm1.go.html#1456914">Q4</a></span><span class="op" id="1458117">+</span><span class="ident" id="1458118"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458121">*</span><span class="ident" id="1458122"><a href="/math/expm1.go.html#1456971">Q5</a></span><span class="op" id="1458124">)</span><span class="op" id="1458125">)</span><span class="op" id="1458126">)</span><span class="op" id="1458127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458130">t</span>&nbsp;<span class="op" id="1458132">:=</span>&nbsp;<span class="num" id="1458135">3</span>&nbsp;<span class="op" id="1458137">-</span>&nbsp;<span class="ident" id="1458139"><a href="/math/expm1.go.html#1458076">r1</a></span><span class="op" id="1458141">*</span><span class="ident" id="1458142"><a href="/math/expm1.go.html#1458044">hfx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458147">e</span>&nbsp;<span class="op" id="1458149">:=</span>&nbsp;<span class="ident" id="1458152"><a href="/math/expm1.go.html#1458060">hxs</a></span>&nbsp;<span class="op" id="1458156">*</span>&nbsp;<span class="op" id="1458158">(</span><span class="op" id="1458159">(</span><span class="ident" id="1458160"><a href="/math/expm1.go.html#1458076">r1</a></span>&nbsp;<span class="op" id="1458163">-</span>&nbsp;<span class="ident" id="1458165"><a href="/math/expm1.go.html#1458130">t</a></span><span class="op" id="1458166">)</span>&nbsp;<span class="op" id="1458168">/</span>&nbsp;<span class="op" id="1458170">(</span><span class="num" id="1458171">6.0</span>&nbsp;<span class="op" id="1458175">-</span>&nbsp;<span class="ident" id="1458177"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458178">*</span><span class="ident" id="1458179"><a href="/math/expm1.go.html#1458130">t</a></span><span class="op" id="1458180">)</span><span class="op" id="1458181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458184">if</span>&nbsp;<span class="ident" id="1458187"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458189">!=</span>&nbsp;<span class="num" id="1458192">0</span>&nbsp;<span class="op" id="1458194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458198"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458200">=</span>&nbsp;<span class="op" id="1458202">(</span><span class="ident" id="1458203"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458204">*</span><span class="op" id="1458205">(</span><span class="ident" id="1458206"><a href="/math/expm1.go.html#1458147">e</a></span><span class="op" id="1458207">-</span><span class="ident" id="1458208"><a href="/math/expm1.go.html#1457450">c</a></span><span class="op" id="1458209">)</span>&nbsp;<span class="op" id="1458211">-</span>&nbsp;<span class="ident" id="1458213"><a href="/math/expm1.go.html#1457450">c</a></span><span class="op" id="1458214">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458218"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458220">-=</span>&nbsp;<span class="ident" id="1458223"><a href="/math/expm1.go.html#1458060">hxs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458229">switch</span>&nbsp;<span class="op" id="1458236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458240">case</span>&nbsp;<span class="ident" id="1458245"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458247">==</span>&nbsp;<span class="op" id="1458250">-</span><span class="num" id="1458251">1</span><span class="op" id="1458252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458257">return</span>&nbsp;<span class="num" id="1458264">0.5</span><span class="op" id="1458267">*</span><span class="op" id="1458268">(</span><span class="ident" id="1458269"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458270">-</span><span class="ident" id="1458271"><a href="/math/expm1.go.html#1458147">e</a></span><span class="op" id="1458272">)</span>&nbsp;<span class="op" id="1458274">-</span>&nbsp;<span class="num" id="1458276">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458282">case</span>&nbsp;<span class="ident" id="1458287"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458289">==</span>&nbsp;<span class="num" id="1458292">1</span><span class="op" id="1458293">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458298">if</span>&nbsp;<span class="ident" id="1458301"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1458303">&lt;</span>&nbsp;<span class="op" id="1458305">-</span><span class="num" id="1458306">0.25</span>&nbsp;<span class="op" id="1458311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458317">return</span>&nbsp;<span class="op" id="1458324">-</span><span class="num" id="1458325">2</span>&nbsp;<span class="op" id="1458327">*</span>&nbsp;<span class="op" id="1458329">(</span><span class="ident" id="1458330"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458332">-</span>&nbsp;<span class="op" id="1458334">(</span><span class="ident" id="1458335"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1458337">+</span>&nbsp;<span class="num" id="1458339">0.5</span><span class="op" id="1458342">)</span><span class="op" id="1458343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1458348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458353">return</span>&nbsp;<span class="num" id="1458360">1</span>&nbsp;<span class="op" id="1458362">+</span>&nbsp;<span class="num" id="1458364">2</span><span class="op" id="1458365">*</span><span class="op" id="1458366">(</span><span class="ident" id="1458367"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458368">-</span><span class="ident" id="1458369"><a href="/math/expm1.go.html#1458147">e</a></span><span class="op" id="1458370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458374">case</span>&nbsp;<span class="ident" id="1458379"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458381">&lt;=</span>&nbsp;<span class="op" id="1458384">-</span><span class="num" id="1458385">2</span>&nbsp;<span class="op" id="1458387">||</span>&nbsp;<span class="ident" id="1458390"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458392">&gt;</span>&nbsp;<span class="num" id="1458394">56</span><span class="op" id="1458396">:</span>&nbsp;<span class="comment" id="1458398">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458431">y</span>&nbsp;<span class="op" id="1458433">:=</span>&nbsp;<span class="num" id="1458436">1</span>&nbsp;<span class="op" id="1458438">-</span>&nbsp;<span class="op" id="1458440">(</span><span class="ident" id="1458441"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458443">-</span>&nbsp;<span class="ident" id="1458445"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458451"><a href="/math/expm1.go.html#1458431">y</a></span>&nbsp;<span class="op" id="1458453">=</span>&nbsp;<span class="ident" id="1458455"><a href="/math/unsafe.go.html#1556218">Float64frombits</a></span><span class="op" id="1458470">(</span><span class="ident" id="1458471"><a href="/math/unsafe.go.html#1556032">Float64bits</a></span><span class="op" id="1458482">(</span><span class="ident" id="1458483"><a href="/math/expm1.go.html#1458431">y</a></span><span class="op" id="1458484">)</span>&nbsp;<span class="op" id="1458486">+</span>&nbsp;<span class="ident" id="1458488">uint64</span><span class="op" id="1458494">(</span><span class="ident" id="1458495"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1458496">)</span><span class="op" id="1458497">&lt;&lt;</span><span class="num" id="1458499">52</span><span class="op" id="1458501">)</span>&nbsp;<span class="comment" id="1458503">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458531">return</span>&nbsp;<span class="ident" id="1458538"><a href="/math/expm1.go.html#1458431">y</a></span>&nbsp;<span class="op" id="1458540">-</span>&nbsp;<span class="num" id="1458542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1458546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458550">if</span>&nbsp;<span class="ident" id="1458553"><a href="/math/expm1.go.html#1457465">k</a></span>&nbsp;<span class="op" id="1458555">&lt;</span>&nbsp;<span class="num" id="1458557">20</span>&nbsp;<span class="op" id="1458560">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458565">t</span>&nbsp;<span class="op" id="1458567">:=</span>&nbsp;<span class="ident" id="1458570"><a href="/math/unsafe.go.html#1556218">Float64frombits</a></span><span class="op" id="1458585">(</span><span class="num" id="1458586">0x3ff0000000000000</span>&nbsp;<span class="op" id="1458605">-</span>&nbsp;<span class="op" id="1458607">(</span><span class="num" id="1458608">0x20000000000000</span>&nbsp;<span class="op" id="1458625">&gt;&gt;</span>&nbsp;<span class="builtintype" id="1458628">uint</span><span class="op" id="1458632">(</span><span class="ident" id="1458633"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1458634">)</span><span class="op" id="1458635">)</span><span class="op" id="1458636">)</span>&nbsp;<span class="comment" id="1458638">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458654">y</span>&nbsp;<span class="op" id="1458656">:=</span>&nbsp;<span class="ident" id="1458659"><a href="/math/expm1.go.html#1458565">t</a></span>&nbsp;<span class="op" id="1458661">-</span>&nbsp;<span class="op" id="1458663">(</span><span class="ident" id="1458664"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458666">-</span>&nbsp;<span class="ident" id="1458668"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458674"><a href="/math/expm1.go.html#1458654">y</a></span>&nbsp;<span class="op" id="1458676">=</span>&nbsp;<span class="ident" id="1458678"><a href="/math/unsafe.go.html#1556218">Float64frombits</a></span><span class="op" id="1458693">(</span><span class="ident" id="1458694"><a href="/math/unsafe.go.html#1556032">Float64bits</a></span><span class="op" id="1458705">(</span><span class="ident" id="1458706"><a href="/math/expm1.go.html#1458654">y</a></span><span class="op" id="1458707">)</span>&nbsp;<span class="op" id="1458709">+</span>&nbsp;<span class="ident" id="1458711">uint64</span><span class="op" id="1458717">(</span><span class="ident" id="1458718"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1458719">)</span><span class="op" id="1458720">&lt;&lt;</span><span class="num" id="1458722">52</span><span class="op" id="1458724">)</span>&nbsp;<span class="comment" id="1458726">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458754">return</span>&nbsp;<span class="ident" id="1458761"><a href="/math/expm1.go.html#1458654">y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1458765">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458769">t</span>&nbsp;<span class="op" id="1458771">:=</span>&nbsp;<span class="ident" id="1458774"><a href="/math/unsafe.go.html#1556218">Float64frombits</a></span><span class="op" id="1458789">(</span><span class="ident" id="1458790">uint64</span><span class="op" id="1458796">(</span><span class="op" id="1458797">(</span><span class="num" id="1458798">0x3ff</span>&nbsp;<span class="op" id="1458804">-</span>&nbsp;<span class="ident" id="1458806"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1458807">)</span>&nbsp;<span class="op" id="1458809">&lt;&lt;</span>&nbsp;<span class="num" id="1458812">52</span><span class="op" id="1458814">)</span><span class="op" id="1458815">)</span>&nbsp;<span class="comment" id="1458817">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458828">y</span>&nbsp;<span class="op" id="1458830">:=</span>&nbsp;<span class="ident" id="1458833"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1458835">-</span>&nbsp;<span class="op" id="1458837">(</span><span class="ident" id="1458838"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458840">+</span>&nbsp;<span class="ident" id="1458842"><a href="/math/expm1.go.html#1458769">t</a></span><span class="op" id="1458843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458847"><a href="/math/expm1.go.html#1458828">y</a></span>&nbsp;<span class="op" id="1458849">+=</span>&nbsp;<span class="num" id="1458852">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1458856"><a href="/math/expm1.go.html#1458828">y</a></span>&nbsp;<span class="op" id="1458858">=</span>&nbsp;<span class="ident" id="1458860"><a href="/math/unsafe.go.html#1556218">Float64frombits</a></span><span class="op" id="1458875">(</span><span class="ident" id="1458876"><a href="/math/unsafe.go.html#1556032">Float64bits</a></span><span class="op" id="1458887">(</span><span class="ident" id="1458888"><a href="/math/expm1.go.html#1458828">y</a></span><span class="op" id="1458889">)</span>&nbsp;<span class="op" id="1458891">+</span>&nbsp;<span class="ident" id="1458893">uint64</span><span class="op" id="1458899">(</span><span class="ident" id="1458900"><a href="/math/expm1.go.html#1457465">k</a></span><span class="op" id="1458901">)</span><span class="op" id="1458902">&lt;&lt;</span><span class="num" id="1458904">52</span><span class="op" id="1458906">)</span>&nbsp;<span class="comment" id="1458908">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458935">return</span>&nbsp;<span class="ident" id="1458942"><a href="/math/expm1.go.html#1458828">y</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1458945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458948">return</span>&nbsp;<span class="ident" id="1458955"><a href="/math/expm1.go.html#1456148">x</a></span>&nbsp;<span class="op" id="1458957">-</span>&nbsp;<span class="op" id="1458959">(</span><span class="ident" id="1458960"><a href="/math/expm1.go.html#1456148">x</a></span><span class="op" id="1458961">*</span><span class="ident" id="1458962"><a href="/math/expm1.go.html#1458147">e</a></span>&nbsp;<span class="op" id="1458964">-</span>&nbsp;<span class="ident" id="1458966"><a href="/math/expm1.go.html#1458060">hxs</a></span><span class="op" id="1458969">)</span>&nbsp;<span class="comment" id="1458971">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="1458981">}</span>
</div>
</body>
</html>
