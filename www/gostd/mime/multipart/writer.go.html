<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5076471">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5076526">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5076580">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5076631">package</span>&nbsp;<span class="ident" id="5076639">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5076650">import</span>&nbsp;<span class="op" id="5076657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076660">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076669">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076684">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076694">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076701">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076707">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5076724">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5076734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076737">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="5076779">type</span>&nbsp;<span class="ident" id="5076784">Writer</span>&nbsp;<span class="keyword" id="5076791">struct</span>&nbsp;<span class="op" id="5076798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076801">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076810">io</span><span class="op" id="5076812">.</span><span class="ident" id="5076813">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076821">boundary</span>&nbsp;<span class="builtintype" id="5076830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076838">lastpart</span>&nbsp;<span class="op" id="5076847">*</span><span class="ident" id="5076848">part</span><br>
<span class="lineno"></span><span class="op" id="5076853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076856">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="5076924">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5076941">func</span>&nbsp;<span class="ident" id="5076946">NewWriter</span><span class="op" id="5076955">(</span><span class="ident" id="5076956">w</span>&nbsp;<span class="ident" id="5076958">io</span><span class="op" id="5076960">.</span><span class="ident" id="5076961">Writer</span><span class="op" id="5076967">)</span>&nbsp;<span class="op" id="5076969">*</span><span class="ident" id="5076970">Writer</span>&nbsp;<span class="op" id="5076977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076980">return</span>&nbsp;<span class="op" id="5076987">&amp;</span><span class="ident" id="5076988">Writer</span><span class="op" id="5076994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076998">w</span><span class="op" id="5076999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077008">w</span><span class="op" id="5077009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077013">boundary</span><span class="op" id="5077021">:</span>&nbsp;<span class="ident" id="5077023">randomBoundary</span><span class="op" id="5077037">(</span><span class="op" id="5077038">)</span><span class="op" id="5077039">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077042">}</span><br>
<span class="lineno"></span><span class="op" id="5077044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5077047">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5077090">func</span>&nbsp;<span class="op" id="5077095">(</span><span class="ident" id="5077096">w</span>&nbsp;<span class="op" id="5077098">*</span><span class="ident" id="5077099">Writer</span><span class="op" id="5077105">)</span>&nbsp;<span class="ident" id="5077107">Boundary</span><span class="op" id="5077115">(</span><span class="op" id="5077116">)</span>&nbsp;<span class="builtintype" id="5077118">string</span>&nbsp;<span class="op" id="5077125">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077128">return</span>&nbsp;<span class="ident" id="5077135">w</span><span class="op" id="5077136">.</span><span class="ident" id="5077137">boundary</span><br>
<span class="lineno"></span><span class="op" id="5077146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5077149">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="5077214">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="5077260">//</span><br>
<span class="lineno"></span><span class="comment" id="5077263">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="5077332">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5077398">func</span>&nbsp;<span class="op" id="5077403">(</span><span class="ident" id="5077404">w</span>&nbsp;<span class="op" id="5077406">*</span><span class="ident" id="5077407">Writer</span><span class="op" id="5077413">)</span>&nbsp;<span class="ident" id="5077415">SetBoundary</span><span class="op" id="5077426">(</span><span class="ident" id="5077427">boundary</span>&nbsp;<span class="builtintype" id="5077436">string</span><span class="op" id="5077442">)</span>&nbsp;<span class="builtintype" id="5077444">error</span>&nbsp;<span class="op" id="5077450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077453">if</span>&nbsp;<span class="ident" id="5077456">w</span><span class="op" id="5077457">.</span><span class="ident" id="5077458">lastpart</span>&nbsp;<span class="op" id="5077467">!=</span>&nbsp;<span class="ident" id="5077470">nil</span>&nbsp;<span class="op" id="5077474">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077478">return</span>&nbsp;<span class="ident" id="5077485">errors</span><span class="op" id="5077491">.</span><span class="ident" id="5077492">New</span><span class="op" id="5077495">(</span><span class="string" id="5077496">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="5077534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5077540">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077566">if</span>&nbsp;<span class="builtinfunc" id="5077569">len</span><span class="op" id="5077572">(</span><span class="ident" id="5077573">boundary</span><span class="op" id="5077581">)</span>&nbsp;<span class="op" id="5077583">&lt;</span>&nbsp;<span class="num" id="5077585">1</span>&nbsp;<span class="op" id="5077587">||</span>&nbsp;<span class="builtinfunc" id="5077590">len</span><span class="op" id="5077593">(</span><span class="ident" id="5077594">boundary</span><span class="op" id="5077602">)</span>&nbsp;<span class="op" id="5077604">&gt;</span>&nbsp;<span class="num" id="5077606">69</span>&nbsp;<span class="op" id="5077609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077613">return</span>&nbsp;<span class="ident" id="5077620">errors</span><span class="op" id="5077626">.</span><span class="ident" id="5077627">New</span><span class="op" id="5077630">(</span><span class="string" id="5077631">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="5077662">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077668">for</span>&nbsp;<span class="ident" id="5077672">_</span><span class="op" id="5077673">,</span>&nbsp;<span class="ident" id="5077675">b</span>&nbsp;<span class="op" id="5077677">:=</span>&nbsp;<span class="keyword" id="5077680">range</span>&nbsp;<span class="ident" id="5077686">boundary</span>&nbsp;<span class="op" id="5077695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077699">if</span>&nbsp;<span class="string" id="5077702">&#39;A&#39;</span>&nbsp;<span class="op" id="5077706">&lt;=</span>&nbsp;<span class="ident" id="5077709">b</span>&nbsp;<span class="op" id="5077711">&amp;&amp;</span>&nbsp;<span class="ident" id="5077714">b</span>&nbsp;<span class="op" id="5077716">&lt;=</span>&nbsp;<span class="string" id="5077719">&#39;Z&#39;</span>&nbsp;<span class="op" id="5077723">||</span>&nbsp;<span class="string" id="5077726">&#39;a&#39;</span>&nbsp;<span class="op" id="5077730">&lt;=</span>&nbsp;<span class="ident" id="5077733">b</span>&nbsp;<span class="op" id="5077735">&amp;&amp;</span>&nbsp;<span class="ident" id="5077738">b</span>&nbsp;<span class="op" id="5077740">&lt;=</span>&nbsp;<span class="string" id="5077743">&#39;z&#39;</span>&nbsp;<span class="op" id="5077747">||</span>&nbsp;<span class="string" id="5077750">&#39;0&#39;</span>&nbsp;<span class="op" id="5077754">&lt;=</span>&nbsp;<span class="ident" id="5077757">b</span>&nbsp;<span class="op" id="5077759">&amp;&amp;</span>&nbsp;<span class="ident" id="5077762">b</span>&nbsp;<span class="op" id="5077764">&lt;=</span>&nbsp;<span class="string" id="5077767">&#39;9&#39;</span>&nbsp;<span class="op" id="5077771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077776">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077787">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077791">switch</span>&nbsp;<span class="ident" id="5077798">b</span>&nbsp;<span class="op" id="5077800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077804">case</span>&nbsp;<span class="string" id="5077809">&#39;\&#39;&#39;</span><span class="op" id="5077813">,</span>&nbsp;<span class="string" id="5077815">&#39;(&#39;</span><span class="op" id="5077818">,</span>&nbsp;<span class="string" id="5077820">&#39;)&#39;</span><span class="op" id="5077823">,</span>&nbsp;<span class="string" id="5077825">&#39;+&#39;</span><span class="op" id="5077828">,</span>&nbsp;<span class="string" id="5077830">&#39;_&#39;</span><span class="op" id="5077833">,</span>&nbsp;<span class="string" id="5077835">&#39;,&#39;</span><span class="op" id="5077838">,</span>&nbsp;<span class="string" id="5077840">&#39;-&#39;</span><span class="op" id="5077843">,</span>&nbsp;<span class="string" id="5077845">&#39;.&#39;</span><span class="op" id="5077848">,</span>&nbsp;<span class="string" id="5077850">&#39;/&#39;</span><span class="op" id="5077853">,</span>&nbsp;<span class="string" id="5077855">&#39;:&#39;</span><span class="op" id="5077858">,</span>&nbsp;<span class="string" id="5077860">&#39;=&#39;</span><span class="op" id="5077863">,</span>&nbsp;<span class="string" id="5077865">&#39;?&#39;</span><span class="op" id="5077868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077873">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077888">return</span>&nbsp;<span class="ident" id="5077895">errors</span><span class="op" id="5077901">.</span><span class="ident" id="5077902">New</span><span class="op" id="5077905">(</span><span class="string" id="5077906">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="5077940">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077946">w</span><span class="op" id="5077947">.</span><span class="ident" id="5077948">boundary</span>&nbsp;<span class="op" id="5077957">=</span>&nbsp;<span class="ident" id="5077959">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077969">return</span>&nbsp;<span class="ident" id="5077976">nil</span><br>
<span class="lineno"></span><span class="op" id="5077980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5077983">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="5078043">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5078095">func</span>&nbsp;<span class="op" id="5078100">(</span><span class="ident" id="5078101">w</span>&nbsp;<span class="op" id="5078103">*</span><span class="ident" id="5078104">Writer</span><span class="op" id="5078110">)</span>&nbsp;<span class="ident" id="5078112">FormDataContentType</span><span class="op" id="5078131">(</span><span class="op" id="5078132">)</span>&nbsp;<span class="builtintype" id="5078134">string</span>&nbsp;<span class="op" id="5078141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078144">return</span>&nbsp;<span class="string" id="5078151">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="5078184">+</span>&nbsp;<span class="ident" id="5078186">w</span><span class="op" id="5078187">.</span><span class="ident" id="5078188">boundary</span><br>
<span class="lineno"></span><span class="op" id="5078197">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5078200">func</span>&nbsp;<span class="ident" id="5078205">randomBoundary</span><span class="op" id="5078219">(</span><span class="op" id="5078220">)</span>&nbsp;<span class="builtintype" id="5078222">string</span>&nbsp;<span class="op" id="5078229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078232">var</span>&nbsp;<span class="ident" id="5078236">buf</span>&nbsp;<span class="op" id="5078240">[</span><span class="num" id="5078241">30</span><span class="op" id="5078243">]</span><span class="builtintype" id="5078244">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078250">_</span><span class="op" id="5078251">,</span>&nbsp;<span class="ident" id="5078253">err</span>&nbsp;<span class="op" id="5078257">:=</span>&nbsp;<span class="ident" id="5078260">io</span><span class="op" id="5078262">.</span><span class="ident" id="5078263">ReadFull</span><span class="op" id="5078271">(</span><span class="ident" id="5078272">rand</span><span class="op" id="5078276">.</span><span class="ident" id="5078277">Reader</span><span class="op" id="5078283">,</span>&nbsp;<span class="ident" id="5078285">buf</span><span class="op" id="5078288">[</span><span class="op" id="5078289">:</span><span class="op" id="5078290">]</span><span class="op" id="5078291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078294">if</span>&nbsp;<span class="ident" id="5078297">err</span>&nbsp;<span class="op" id="5078301">!=</span>&nbsp;<span class="ident" id="5078304">nil</span>&nbsp;<span class="op" id="5078308">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5078312">panic</span><span class="op" id="5078317">(</span><span class="ident" id="5078318">err</span><span class="op" id="5078321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078327">return</span>&nbsp;<span class="ident" id="5078334">fmt</span><span class="op" id="5078337">.</span><span class="ident" id="5078338">Sprintf</span><span class="op" id="5078345">(</span><span class="string" id="5078346">&#34;%x&#34;</span><span class="op" id="5078350">,</span>&nbsp;<span class="ident" id="5078352">buf</span><span class="op" id="5078355">[</span><span class="op" id="5078356">:</span><span class="op" id="5078357">]</span><span class="op" id="5078358">)</span><br>
<span class="lineno"></span><span class="op" id="5078360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5078363">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="5078427">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5078493">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="5078562">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="5078580">func</span>&nbsp;<span class="op" id="5078585">(</span><span class="ident" id="5078586">w</span>&nbsp;<span class="op" id="5078588">*</span><span class="ident" id="5078589">Writer</span><span class="op" id="5078595">)</span>&nbsp;<span class="ident" id="5078597">CreatePart</span><span class="op" id="5078607">(</span><span class="ident" id="5078608">header</span>&nbsp;<span class="ident" id="5078615">textproto</span><span class="op" id="5078624">.</span><span class="ident" id="5078625">MIMEHeader</span><span class="op" id="5078635">)</span>&nbsp;<span class="op" id="5078637">(</span><span class="ident" id="5078638">io</span><span class="op" id="5078640">.</span><span class="ident" id="5078641">Writer</span><span class="op" id="5078647">,</span>&nbsp;<span class="builtintype" id="5078649">error</span><span class="op" id="5078654">)</span>&nbsp;<span class="op" id="5078656">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078659">if</span>&nbsp;<span class="ident" id="5078662">w</span><span class="op" id="5078663">.</span><span class="ident" id="5078664">lastpart</span>&nbsp;<span class="op" id="5078673">!=</span>&nbsp;<span class="ident" id="5078676">nil</span>&nbsp;<span class="op" id="5078680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078684">if</span>&nbsp;<span class="ident" id="5078687">err</span>&nbsp;<span class="op" id="5078691">:=</span>&nbsp;<span class="ident" id="5078694">w</span><span class="op" id="5078695">.</span><span class="ident" id="5078696">lastpart</span><span class="op" id="5078704">.</span><span class="builtinfunc" id="5078705">close</span><span class="op" id="5078710">(</span><span class="op" id="5078711">)</span><span class="op" id="5078712">;</span>&nbsp;<span class="ident" id="5078714">err</span>&nbsp;<span class="op" id="5078718">!=</span>&nbsp;<span class="ident" id="5078721">nil</span>&nbsp;<span class="op" id="5078725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078730">return</span>&nbsp;<span class="ident" id="5078737">nil</span><span class="op" id="5078740">,</span>&nbsp;<span class="ident" id="5078742">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078751">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078754">var</span>&nbsp;<span class="ident" id="5078758">b</span>&nbsp;<span class="ident" id="5078760">bytes</span><span class="op" id="5078765">.</span><span class="ident" id="5078766">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078774">if</span>&nbsp;<span class="ident" id="5078777">w</span><span class="op" id="5078778">.</span><span class="ident" id="5078779">lastpart</span>&nbsp;<span class="op" id="5078788">!=</span>&nbsp;<span class="ident" id="5078791">nil</span>&nbsp;<span class="op" id="5078795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078799">fmt</span><span class="op" id="5078802">.</span><span class="ident" id="5078803">Fprintf</span><span class="op" id="5078810">(</span><span class="op" id="5078811">&amp;</span><span class="ident" id="5078812">b</span><span class="op" id="5078813">,</span>&nbsp;<span class="string" id="5078815">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="5078829">,</span>&nbsp;<span class="ident" id="5078831">w</span><span class="op" id="5078832">.</span><span class="ident" id="5078833">boundary</span><span class="op" id="5078841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078844">}</span>&nbsp;<span class="keyword" id="5078846">else</span>&nbsp;<span class="op" id="5078851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078855">fmt</span><span class="op" id="5078858">.</span><span class="ident" id="5078859">Fprintf</span><span class="op" id="5078866">(</span><span class="op" id="5078867">&amp;</span><span class="ident" id="5078868">b</span><span class="op" id="5078869">,</span>&nbsp;<span class="string" id="5078871">&#34;--%s\r\n&#34;</span><span class="op" id="5078881">,</span>&nbsp;<span class="ident" id="5078883">w</span><span class="op" id="5078884">.</span><span class="ident" id="5078885">boundary</span><span class="op" id="5078893">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078899">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078976">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079023">for</span>&nbsp;<span class="ident" id="5079027">k</span><span class="op" id="5079028">,</span>&nbsp;<span class="ident" id="5079030">vv</span>&nbsp;<span class="op" id="5079033">:=</span>&nbsp;<span class="keyword" id="5079036">range</span>&nbsp;<span class="ident" id="5079042">header</span>&nbsp;<span class="op" id="5079049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079053">for</span>&nbsp;<span class="ident" id="5079057">_</span><span class="op" id="5079058">,</span>&nbsp;<span class="ident" id="5079060">v</span>&nbsp;<span class="op" id="5079062">:=</span>&nbsp;<span class="keyword" id="5079065">range</span>&nbsp;<span class="ident" id="5079071">vv</span>&nbsp;<span class="op" id="5079074">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079079">fmt</span><span class="op" id="5079082">.</span><span class="ident" id="5079083">Fprintf</span><span class="op" id="5079090">(</span><span class="op" id="5079091">&amp;</span><span class="ident" id="5079092">b</span><span class="op" id="5079093">,</span>&nbsp;<span class="string" id="5079095">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="5079107">,</span>&nbsp;<span class="ident" id="5079109">k</span><span class="op" id="5079110">,</span>&nbsp;<span class="ident" id="5079112">v</span><span class="op" id="5079113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079123">fmt</span><span class="op" id="5079126">.</span><span class="ident" id="5079127">Fprintf</span><span class="op" id="5079134">(</span><span class="op" id="5079135">&amp;</span><span class="ident" id="5079136">b</span><span class="op" id="5079137">,</span>&nbsp;<span class="string" id="5079139">&#34;\r\n&#34;</span><span class="op" id="5079145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079148">_</span><span class="op" id="5079149">,</span>&nbsp;<span class="ident" id="5079151">err</span>&nbsp;<span class="op" id="5079155">:=</span>&nbsp;<span class="ident" id="5079158">io</span><span class="op" id="5079160">.</span><span class="ident" id="5079161">Copy</span><span class="op" id="5079165">(</span><span class="ident" id="5079166">w</span><span class="op" id="5079167">.</span><span class="ident" id="5079168">w</span><span class="op" id="5079169">,</span>&nbsp;<span class="op" id="5079171">&amp;</span><span class="ident" id="5079172">b</span><span class="op" id="5079173">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079176">if</span>&nbsp;<span class="ident" id="5079179">err</span>&nbsp;<span class="op" id="5079183">!=</span>&nbsp;<span class="ident" id="5079186">nil</span>&nbsp;<span class="op" id="5079190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079194">return</span>&nbsp;<span class="ident" id="5079201">nil</span><span class="op" id="5079204">,</span>&nbsp;<span class="ident" id="5079206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079214">p</span>&nbsp;<span class="op" id="5079216">:=</span>&nbsp;<span class="op" id="5079219">&amp;</span><span class="ident" id="5079220">part</span><span class="op" id="5079224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079228">mw</span><span class="op" id="5079230">:</span>&nbsp;<span class="ident" id="5079232">w</span><span class="op" id="5079233">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079239">w</span><span class="op" id="5079240">.</span><span class="ident" id="5079241">lastpart</span>&nbsp;<span class="op" id="5079250">=</span>&nbsp;<span class="ident" id="5079252">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079255">return</span>&nbsp;<span class="ident" id="5079262">p</span><span class="op" id="5079263">,</span>&nbsp;<span class="ident" id="5079265">nil</span><br>
<span class="lineno"></span><span class="op" id="5079269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5079272">var</span>&nbsp;<span class="ident" id="5079276">quoteEscaper</span>&nbsp;<span class="op" id="5079289">=</span>&nbsp;<span class="ident" id="5079291">strings</span><span class="op" id="5079298">.</span><span class="ident" id="5079299">NewReplacer</span><span class="op" id="5079310">(</span><span class="string" id="5079311">&#34;\\&#34;</span><span class="op" id="5079315">,</span>&nbsp;<span class="string" id="5079317">&#34;\\\\&#34;</span><span class="op" id="5079323">,</span>&nbsp;<span class="string" id="5079325">`&#34;`</span><span class="op" id="5079328">,</span>&nbsp;<span class="string" id="5079330">&#34;\\\&#34;&#34;</span><span class="op" id="5079336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5079339">func</span>&nbsp;<span class="ident" id="5079344">escapeQuotes</span><span class="op" id="5079356">(</span><span class="ident" id="5079357">s</span>&nbsp;<span class="builtintype" id="5079359">string</span><span class="op" id="5079365">)</span>&nbsp;<span class="builtintype" id="5079367">string</span>&nbsp;<span class="op" id="5079374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079377">return</span>&nbsp;<span class="ident" id="5079384">quoteEscaper</span><span class="op" id="5079396">.</span><span class="ident" id="5079397">Replace</span><span class="op" id="5079404">(</span><span class="ident" id="5079405">s</span><span class="op" id="5079406">)</span><br>
<span class="lineno"></span><span class="op" id="5079408">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5079411">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="5079484">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5079554">func</span>&nbsp;<span class="op" id="5079559">(</span><span class="ident" id="5079560">w</span>&nbsp;<span class="op" id="5079562">*</span><span class="ident" id="5079563">Writer</span><span class="op" id="5079569">)</span>&nbsp;<span class="ident" id="5079571">CreateFormFile</span><span class="op" id="5079585">(</span><span class="ident" id="5079586">fieldname</span><span class="op" id="5079595">,</span>&nbsp;<span class="ident" id="5079597">filename</span>&nbsp;<span class="builtintype" id="5079606">string</span><span class="op" id="5079612">)</span>&nbsp;<span class="op" id="5079614">(</span><span class="ident" id="5079615">io</span><span class="op" id="5079617">.</span><span class="ident" id="5079618">Writer</span><span class="op" id="5079624">,</span>&nbsp;<span class="builtintype" id="5079626">error</span><span class="op" id="5079631">)</span>&nbsp;<span class="op" id="5079633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079636">h</span>&nbsp;<span class="op" id="5079638">:=</span>&nbsp;<span class="builtinfunc" id="5079641">make</span><span class="op" id="5079645">(</span><span class="ident" id="5079646">textproto</span><span class="op" id="5079655">.</span><span class="ident" id="5079656">MIMEHeader</span><span class="op" id="5079666">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079669">h</span><span class="op" id="5079670">.</span><span class="ident" id="5079671">Set</span><span class="op" id="5079674">(</span><span class="string" id="5079675">&#34;Content-Disposition&#34;</span><span class="op" id="5079696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079700">fmt</span><span class="op" id="5079703">.</span><span class="ident" id="5079704">Sprintf</span><span class="op" id="5079711">(</span><span class="string" id="5079712">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="5079749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079754">escapeQuotes</span><span class="op" id="5079766">(</span><span class="ident" id="5079767">fieldname</span><span class="op" id="5079776">)</span><span class="op" id="5079777">,</span>&nbsp;<span class="ident" id="5079779">escapeQuotes</span><span class="op" id="5079791">(</span><span class="ident" id="5079792">filename</span><span class="op" id="5079800">)</span><span class="op" id="5079801">)</span><span class="op" id="5079802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079805">h</span><span class="op" id="5079806">.</span><span class="ident" id="5079807">Set</span><span class="op" id="5079810">(</span><span class="string" id="5079811">&#34;Content-Type&#34;</span><span class="op" id="5079825">,</span>&nbsp;<span class="string" id="5079827">&#34;application/octet-stream&#34;</span><span class="op" id="5079853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079856">return</span>&nbsp;<span class="ident" id="5079863">w</span><span class="op" id="5079864">.</span><span class="ident" id="5079865">CreatePart</span><span class="op" id="5079875">(</span><span class="ident" id="5079876">h</span><span class="op" id="5079877">)</span><br>
<span class="lineno">130</span><span class="op" id="5079879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5079882">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5079942">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5079963">func</span>&nbsp;<span class="op" id="5079968">(</span><span class="ident" id="5079969">w</span>&nbsp;<span class="op" id="5079971">*</span><span class="ident" id="5079972">Writer</span><span class="op" id="5079978">)</span>&nbsp;<span class="ident" id="5079980">CreateFormField</span><span class="op" id="5079995">(</span><span class="ident" id="5079996">fieldname</span>&nbsp;<span class="builtintype" id="5080006">string</span><span class="op" id="5080012">)</span>&nbsp;<span class="op" id="5080014">(</span><span class="ident" id="5080015">io</span><span class="op" id="5080017">.</span><span class="ident" id="5080018">Writer</span><span class="op" id="5080024">,</span>&nbsp;<span class="builtintype" id="5080026">error</span><span class="op" id="5080031">)</span>&nbsp;<span class="op" id="5080033">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080036">h</span>&nbsp;<span class="op" id="5080038">:=</span>&nbsp;<span class="builtinfunc" id="5080041">make</span><span class="op" id="5080045">(</span><span class="ident" id="5080046">textproto</span><span class="op" id="5080055">.</span><span class="ident" id="5080056">MIMEHeader</span><span class="op" id="5080066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080069">h</span><span class="op" id="5080070">.</span><span class="ident" id="5080071">Set</span><span class="op" id="5080074">(</span><span class="string" id="5080075">&#34;Content-Disposition&#34;</span><span class="op" id="5080096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080100">fmt</span><span class="op" id="5080103">.</span><span class="ident" id="5080104">Sprintf</span><span class="op" id="5080111">(</span><span class="string" id="5080112">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="5080134">,</span>&nbsp;<span class="ident" id="5080136">escapeQuotes</span><span class="op" id="5080148">(</span><span class="ident" id="5080149">fieldname</span><span class="op" id="5080158">)</span><span class="op" id="5080159">)</span><span class="op" id="5080160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080163">return</span>&nbsp;<span class="ident" id="5080170">w</span><span class="op" id="5080171">.</span><span class="ident" id="5080172">CreatePart</span><span class="op" id="5080182">(</span><span class="ident" id="5080183">h</span><span class="op" id="5080184">)</span><br>
<span class="lineno"></span><span class="op" id="5080186">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="5080189">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5080258">func</span>&nbsp;<span class="op" id="5080263">(</span><span class="ident" id="5080264">w</span>&nbsp;<span class="op" id="5080266">*</span><span class="ident" id="5080267">Writer</span><span class="op" id="5080273">)</span>&nbsp;<span class="ident" id="5080275">WriteField</span><span class="op" id="5080285">(</span><span class="ident" id="5080286">fieldname</span><span class="op" id="5080295">,</span>&nbsp;<span class="ident" id="5080297">value</span>&nbsp;<span class="builtintype" id="5080303">string</span><span class="op" id="5080309">)</span>&nbsp;<span class="builtintype" id="5080311">error</span>&nbsp;<span class="op" id="5080317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080320">p</span><span class="op" id="5080321">,</span>&nbsp;<span class="ident" id="5080323">err</span>&nbsp;<span class="op" id="5080327">:=</span>&nbsp;<span class="ident" id="5080330">w</span><span class="op" id="5080331">.</span><span class="ident" id="5080332">CreateFormField</span><span class="op" id="5080347">(</span><span class="ident" id="5080348">fieldname</span><span class="op" id="5080357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080360">if</span>&nbsp;<span class="ident" id="5080363">err</span>&nbsp;<span class="op" id="5080367">!=</span>&nbsp;<span class="ident" id="5080370">nil</span>&nbsp;<span class="op" id="5080374">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080378">return</span>&nbsp;<span class="ident" id="5080385">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080393">_</span><span class="op" id="5080394">,</span>&nbsp;<span class="ident" id="5080396">err</span>&nbsp;<span class="op" id="5080400">=</span>&nbsp;<span class="ident" id="5080402">p</span><span class="op" id="5080403">.</span><span class="ident" id="5080404">Write</span><span class="op" id="5080409">(</span><span class="op" id="5080410">[</span><span class="op" id="5080411">]</span><span class="builtintype" id="5080412">byte</span><span class="op" id="5080416">(</span><span class="ident" id="5080417">value</span><span class="op" id="5080422">)</span><span class="op" id="5080423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080426">return</span>&nbsp;<span class="ident" id="5080433">err</span><br>
<span class="lineno"></span><span class="op" id="5080437">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5080440">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5080504">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5080540">func</span>&nbsp;<span class="op" id="5080545">(</span><span class="ident" id="5080546">w</span>&nbsp;<span class="op" id="5080548">*</span><span class="ident" id="5080549">Writer</span><span class="op" id="5080555">)</span>&nbsp;<span class="ident" id="5080557">Close</span><span class="op" id="5080562">(</span><span class="op" id="5080563">)</span>&nbsp;<span class="builtintype" id="5080565">error</span>&nbsp;<span class="op" id="5080571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080574">if</span>&nbsp;<span class="ident" id="5080577">w</span><span class="op" id="5080578">.</span><span class="ident" id="5080579">lastpart</span>&nbsp;<span class="op" id="5080588">!=</span>&nbsp;<span class="ident" id="5080591">nil</span>&nbsp;<span class="op" id="5080595">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080599">if</span>&nbsp;<span class="ident" id="5080602">err</span>&nbsp;<span class="op" id="5080606">:=</span>&nbsp;<span class="ident" id="5080609">w</span><span class="op" id="5080610">.</span><span class="ident" id="5080611">lastpart</span><span class="op" id="5080619">.</span><span class="builtinfunc" id="5080620">close</span><span class="op" id="5080625">(</span><span class="op" id="5080626">)</span><span class="op" id="5080627">;</span>&nbsp;<span class="ident" id="5080629">err</span>&nbsp;<span class="op" id="5080633">!=</span>&nbsp;<span class="ident" id="5080636">nil</span>&nbsp;<span class="op" id="5080640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080645">return</span>&nbsp;<span class="ident" id="5080652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080662">w</span><span class="op" id="5080663">.</span><span class="ident" id="5080664">lastpart</span>&nbsp;<span class="op" id="5080673">=</span>&nbsp;<span class="ident" id="5080675">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080680">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080683">_</span><span class="op" id="5080684">,</span>&nbsp;<span class="ident" id="5080686">err</span>&nbsp;<span class="op" id="5080690">:=</span>&nbsp;<span class="ident" id="5080693">fmt</span><span class="op" id="5080696">.</span><span class="ident" id="5080697">Fprintf</span><span class="op" id="5080704">(</span><span class="ident" id="5080705">w</span><span class="op" id="5080706">.</span><span class="ident" id="5080707">w</span><span class="op" id="5080708">,</span>&nbsp;<span class="string" id="5080710">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="5080726">,</span>&nbsp;<span class="ident" id="5080728">w</span><span class="op" id="5080729">.</span><span class="ident" id="5080730">boundary</span><span class="op" id="5080738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080741">return</span>&nbsp;<span class="ident" id="5080748">err</span><br>
<span class="lineno"></span><span class="op" id="5080752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5080755">type</span>&nbsp;<span class="ident" id="5080760">part</span>&nbsp;<span class="keyword" id="5080765">struct</span>&nbsp;<span class="op" id="5080772">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080775">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080782">*</span><span class="ident" id="5080783">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080791">closed</span>&nbsp;<span class="builtintype" id="5080798">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080804">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5080811">error</span>&nbsp;<span class="comment" id="5080817">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="5080853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5080856">func</span>&nbsp;<span class="op" id="5080861">(</span><span class="ident" id="5080862">p</span>&nbsp;<span class="op" id="5080864">*</span><span class="ident" id="5080865">part</span><span class="op" id="5080869">)</span>&nbsp;<span class="builtinfunc" id="5080871">close</span><span class="op" id="5080876">(</span><span class="op" id="5080877">)</span>&nbsp;<span class="builtintype" id="5080879">error</span>&nbsp;<span class="op" id="5080885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080888">p</span><span class="op" id="5080889">.</span><span class="ident" id="5080890">closed</span>&nbsp;<span class="op" id="5080897">=</span>&nbsp;<span class="builtintype" id="5080899">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080905">return</span>&nbsp;<span class="ident" id="5080912">p</span><span class="op" id="5080913">.</span><span class="ident" id="5080914">we</span><br>
<span class="lineno"></span><span class="op" id="5080917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="5080920">func</span>&nbsp;<span class="op" id="5080925">(</span><span class="ident" id="5080926">p</span>&nbsp;<span class="op" id="5080928">*</span><span class="ident" id="5080929">part</span><span class="op" id="5080933">)</span>&nbsp;<span class="ident" id="5080935">Write</span><span class="op" id="5080940">(</span><span class="ident" id="5080941">d</span>&nbsp;<span class="op" id="5080943">[</span><span class="op" id="5080944">]</span><span class="builtintype" id="5080945">byte</span><span class="op" id="5080949">)</span>&nbsp;<span class="op" id="5080951">(</span><span class="ident" id="5080952">n</span>&nbsp;<span class="builtintype" id="5080954">int</span><span class="op" id="5080957">,</span>&nbsp;<span class="ident" id="5080959">err</span>&nbsp;<span class="builtintype" id="5080963">error</span><span class="op" id="5080968">)</span>&nbsp;<span class="op" id="5080970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080973">if</span>&nbsp;<span class="ident" id="5080976">p</span><span class="op" id="5080977">.</span><span class="ident" id="5080978">closed</span>&nbsp;<span class="op" id="5080985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080989">return</span>&nbsp;<span class="num" id="5080996">0</span><span class="op" id="5080997">,</span>&nbsp;<span class="ident" id="5080999">errors</span><span class="op" id="5081005">.</span><span class="ident" id="5081006">New</span><span class="op" id="5081009">(</span><span class="string" id="5081010">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="5081051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081057">n</span><span class="op" id="5081058">,</span>&nbsp;<span class="ident" id="5081060">err</span>&nbsp;<span class="op" id="5081064">=</span>&nbsp;<span class="ident" id="5081066">p</span><span class="op" id="5081067">.</span><span class="ident" id="5081068">mw</span><span class="op" id="5081070">.</span><span class="ident" id="5081071">w</span><span class="op" id="5081072">.</span><span class="ident" id="5081073">Write</span><span class="op" id="5081078">(</span><span class="ident" id="5081079">d</span><span class="op" id="5081080">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081083">if</span>&nbsp;<span class="ident" id="5081086">err</span>&nbsp;<span class="op" id="5081090">!=</span>&nbsp;<span class="ident" id="5081093">nil</span>&nbsp;<span class="op" id="5081097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5081101">p</span><span class="op" id="5081102">.</span><span class="ident" id="5081103">we</span>&nbsp;<span class="op" id="5081106">=</span>&nbsp;<span class="ident" id="5081108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5081113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5081116">return</span><br>
<span class="lineno"></span><span class="op" id="5081123">}</span>
</div>
</body>
</html>
