<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1638383">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1638438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1638492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1638543">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1638560">package</span>&nbsp;<span class="ident" id="1638568">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1638577">import</span>&nbsp;<span class="string" id="1638584">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1638594">func</span>&nbsp;<span class="ident" id="1638599">epollcreate</span><span class="op" id="1638610">(</span><span class="ident" id="1638611">size</span>&nbsp;<span class="builtintype" id="1638616">int32</span><span class="op" id="1638621">)</span>&nbsp;<span class="builtintype" id="1638623">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1638629">func</span>&nbsp;<span class="ident" id="1638634">epollcreate1</span><span class="op" id="1638646">(</span><span class="ident" id="1638647">flags</span>&nbsp;<span class="builtintype" id="1638653">int32</span><span class="op" id="1638658">)</span>&nbsp;<span class="builtintype" id="1638660">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638667">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1638681">func</span>&nbsp;<span class="ident" id="1638686">epollctl</span><span class="op" id="1638694">(</span><span class="ident" id="1638695">epfd</span><span class="op" id="1638699">,</span>&nbsp;<span class="ident" id="1638701">op</span><span class="op" id="1638703">,</span>&nbsp;<span class="ident" id="1638705">fd</span>&nbsp;<span class="builtintype" id="1638708">int32</span><span class="op" id="1638713">,</span>&nbsp;<span class="ident" id="1638715">ev</span>&nbsp;<span class="op" id="1638718">*</span><span class="ident" id="1638719">epollevent</span><span class="op" id="1638729">)</span>&nbsp;<span class="builtintype" id="1638731">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638738">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1638752">func</span>&nbsp;<span class="ident" id="1638757">epollwait</span><span class="op" id="1638766">(</span><span class="ident" id="1638767">epfd</span>&nbsp;<span class="builtintype" id="1638772">int32</span><span class="op" id="1638777">,</span>&nbsp;<span class="ident" id="1638779">ev</span>&nbsp;<span class="op" id="1638782">*</span><span class="ident" id="1638783">epollevent</span><span class="op" id="1638793">,</span>&nbsp;<span class="ident" id="1638795">nev</span><span class="op" id="1638798">,</span>&nbsp;<span class="ident" id="1638800">timeout</span>&nbsp;<span class="builtintype" id="1638808">int32</span><span class="op" id="1638813">)</span>&nbsp;<span class="builtintype" id="1638815">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1638821">func</span>&nbsp;<span class="ident" id="1638826">closeonexec</span><span class="op" id="1638837">(</span><span class="ident" id="1638838">fd</span>&nbsp;<span class="builtintype" id="1638841">int32</span><span class="op" id="1638846">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1638849">var</span>&nbsp;<span class="op" id="1638853">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638856">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1638871">int32</span>&nbsp;<span class="op" id="1638877">=</span>&nbsp;<span class="op" id="1638879">-</span><span class="num" id="1638880">1</span>&nbsp;<span class="comment" id="1638882">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638903">netpolllasterr</span>&nbsp;<span class="builtintype" id="1638918">int32</span><br>
<span class="lineno"></span><span class="op" id="1638924">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1638927">func</span>&nbsp;<span class="ident" id="1638932">netpollinit</span><span class="op" id="1638943">(</span><span class="op" id="1638944">)</span>&nbsp;<span class="op" id="1638946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638949">epfd</span>&nbsp;<span class="op" id="1638954">=</span>&nbsp;<span class="ident" id="1638956">epollcreate1</span><span class="op" id="1638968">(</span><span class="ident" id="1638969">_EPOLL_CLOEXEC</span><span class="op" id="1638983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638986">if</span>&nbsp;<span class="ident" id="1638989">epfd</span>&nbsp;<span class="op" id="1638994">&gt;=</span>&nbsp;<span class="num" id="1638997">0</span>&nbsp;<span class="op" id="1638999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639003">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639014">epfd</span>&nbsp;<span class="op" id="1639019">=</span>&nbsp;<span class="ident" id="1639021">epollcreate</span><span class="op" id="1639032">(</span><span class="num" id="1639033">1024</span><span class="op" id="1639037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639040">if</span>&nbsp;<span class="ident" id="1639043">epfd</span>&nbsp;<span class="op" id="1639048">&gt;=</span>&nbsp;<span class="num" id="1639051">0</span>&nbsp;<span class="op" id="1639053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639057">closeonexec</span><span class="op" id="1639068">(</span><span class="ident" id="1639069">epfd</span><span class="op" id="1639073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639077">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1639088">println</span><span class="op" id="1639095">(</span><span class="string" id="1639096">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1639144">,</span>&nbsp;<span class="op" id="1639146">-</span><span class="ident" id="1639147">epfd</span><span class="op" id="1639151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639154">gothrow</span><span class="op" id="1639161">(</span><span class="string" id="1639162">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1639204">)</span><br>
<span class="lineno"></span><span class="op" id="1639206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1639209">func</span>&nbsp;<span class="ident" id="1639214">netpollopen</span><span class="op" id="1639225">(</span><span class="ident" id="1639226">fd</span>&nbsp;<span class="builtintype" id="1639229">uintptr</span><span class="op" id="1639236">,</span>&nbsp;<span class="ident" id="1639238">pd</span>&nbsp;<span class="op" id="1639241">*</span><span class="ident" id="1639242">pollDesc</span><span class="op" id="1639250">)</span>&nbsp;<span class="builtintype" id="1639252">int32</span>&nbsp;<span class="op" id="1639258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639261">var</span>&nbsp;<span class="ident" id="1639265">ev</span>&nbsp;<span class="ident" id="1639268">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639280">ev</span><span class="op" id="1639282">.</span><span class="ident" id="1639283">events</span>&nbsp;<span class="op" id="1639290">=</span>&nbsp;<span class="ident" id="1639292">_EPOLLIN</span>&nbsp;<span class="op" id="1639301">|</span>&nbsp;<span class="ident" id="1639303">_EPOLLOUT</span>&nbsp;<span class="op" id="1639313">|</span>&nbsp;<span class="ident" id="1639315">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1639327">|</span>&nbsp;<span class="ident" id="1639329">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639339">*</span><span class="op" id="1639340">(</span><span class="op" id="1639341">*</span><span class="op" id="1639342">*</span><span class="ident" id="1639343">pollDesc</span><span class="op" id="1639351">)</span><span class="op" id="1639352">(</span><span class="ident" id="1639353">unsafe</span><span class="op" id="1639359">.</span><span class="ident" id="1639360">Pointer</span><span class="op" id="1639367">(</span><span class="op" id="1639368">&amp;</span><span class="ident" id="1639369">ev</span><span class="op" id="1639371">.</span><span class="ident" id="1639372">data</span><span class="op" id="1639376">)</span><span class="op" id="1639377">)</span>&nbsp;<span class="op" id="1639379">=</span>&nbsp;<span class="ident" id="1639381">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639385">return</span>&nbsp;<span class="op" id="1639392">-</span><span class="ident" id="1639393">epollctl</span><span class="op" id="1639401">(</span><span class="ident" id="1639402">epfd</span><span class="op" id="1639406">,</span>&nbsp;<span class="ident" id="1639408">_EPOLL_CTL_ADD</span><span class="op" id="1639422">,</span>&nbsp;<span class="builtintype" id="1639424">int32</span><span class="op" id="1639429">(</span><span class="ident" id="1639430">fd</span><span class="op" id="1639432">)</span><span class="op" id="1639433">,</span>&nbsp;<span class="op" id="1639435">&amp;</span><span class="ident" id="1639436">ev</span><span class="op" id="1639438">)</span><br>
<span class="lineno">45</span><span class="op" id="1639440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1639443">func</span>&nbsp;<span class="ident" id="1639448">netpollclose</span><span class="op" id="1639460">(</span><span class="ident" id="1639461">fd</span>&nbsp;<span class="builtintype" id="1639464">uintptr</span><span class="op" id="1639471">)</span>&nbsp;<span class="builtintype" id="1639473">int32</span>&nbsp;<span class="op" id="1639479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639482">var</span>&nbsp;<span class="ident" id="1639486">ev</span>&nbsp;<span class="ident" id="1639489">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639501">return</span>&nbsp;<span class="op" id="1639508">-</span><span class="ident" id="1639509">epollctl</span><span class="op" id="1639517">(</span><span class="ident" id="1639518">epfd</span><span class="op" id="1639522">,</span>&nbsp;<span class="ident" id="1639524">_EPOLL_CTL_DEL</span><span class="op" id="1639538">,</span>&nbsp;<span class="builtintype" id="1639540">int32</span><span class="op" id="1639545">(</span><span class="ident" id="1639546">fd</span><span class="op" id="1639548">)</span><span class="op" id="1639549">,</span>&nbsp;<span class="op" id="1639551">&amp;</span><span class="ident" id="1639552">ev</span><span class="op" id="1639554">)</span><br>
<span class="lineno">50</span><span class="op" id="1639556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1639559">func</span>&nbsp;<span class="ident" id="1639564">netpollarm</span><span class="op" id="1639574">(</span><span class="ident" id="1639575">pd</span>&nbsp;<span class="op" id="1639578">*</span><span class="ident" id="1639579">pollDesc</span><span class="op" id="1639587">,</span>&nbsp;<span class="ident" id="1639589">mode</span>&nbsp;<span class="builtintype" id="1639594">int</span><span class="op" id="1639597">)</span>&nbsp;<span class="op" id="1639599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639602">gothrow</span><span class="op" id="1639609">(</span><span class="string" id="1639610">&#34;unused&#34;</span><span class="op" id="1639618">)</span><br>
<span class="lineno"></span><span class="op" id="1639620">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1639623">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1639662">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1639713">func</span>&nbsp;<span class="ident" id="1639718">netpoll</span><span class="op" id="1639725">(</span><span class="ident" id="1639726">block</span>&nbsp;<span class="builtintype" id="1639732">bool</span><span class="op" id="1639736">)</span>&nbsp;<span class="op" id="1639738">(</span><span class="ident" id="1639739">gp</span>&nbsp;<span class="op" id="1639742">*</span><span class="ident" id="1639743">g</span><span class="op" id="1639744">)</span>&nbsp;<span class="op" id="1639746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639749">if</span>&nbsp;<span class="ident" id="1639752">epfd</span>&nbsp;<span class="op" id="1639757">==</span>&nbsp;<span class="op" id="1639760">-</span><span class="num" id="1639761">1</span>&nbsp;<span class="op" id="1639763">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639767">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639778">waitms</span>&nbsp;<span class="op" id="1639785">:=</span>&nbsp;<span class="builtintype" id="1639788">int32</span><span class="op" id="1639793">(</span><span class="op" id="1639794">-</span><span class="num" id="1639795">1</span><span class="op" id="1639796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639799">if</span>&nbsp;<span class="op" id="1639802">!</span><span class="ident" id="1639803">block</span>&nbsp;<span class="op" id="1639809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639813">waitms</span>&nbsp;<span class="op" id="1639820">=</span>&nbsp;<span class="num" id="1639822">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639828">var</span>&nbsp;<span class="ident" id="1639832">events</span>&nbsp;<span class="op" id="1639839">[</span><span class="num" id="1639840">128</span><span class="op" id="1639843">]</span><span class="ident" id="1639844">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1639855">retry</span><span class="op" id="1639860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639863">n</span>&nbsp;<span class="op" id="1639865">:=</span>&nbsp;<span class="ident" id="1639868">epollwait</span><span class="op" id="1639877">(</span><span class="ident" id="1639878">epfd</span><span class="op" id="1639882">,</span>&nbsp;<span class="op" id="1639884">&amp;</span><span class="ident" id="1639885">events</span><span class="op" id="1639891">[</span><span class="num" id="1639892">0</span><span class="op" id="1639893">]</span><span class="op" id="1639894">,</span>&nbsp;<span class="builtintype" id="1639896">int32</span><span class="op" id="1639901">(</span><span class="builtinfunc" id="1639902">len</span><span class="op" id="1639905">(</span><span class="ident" id="1639906">events</span><span class="op" id="1639912">)</span><span class="op" id="1639913">)</span><span class="op" id="1639914">,</span>&nbsp;<span class="ident" id="1639916">waitms</span><span class="op" id="1639922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639925">if</span>&nbsp;<span class="ident" id="1639928">n</span>&nbsp;<span class="op" id="1639930">&lt;</span>&nbsp;<span class="num" id="1639932">0</span>&nbsp;<span class="op" id="1639934">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639938">if</span>&nbsp;<span class="ident" id="1639941">n</span>&nbsp;<span class="op" id="1639943">!=</span>&nbsp;<span class="op" id="1639946">-</span><span class="ident" id="1639947">_EINTR</span>&nbsp;<span class="op" id="1639954">&amp;&amp;</span>&nbsp;<span class="ident" id="1639957">n</span>&nbsp;<span class="op" id="1639959">!=</span>&nbsp;<span class="ident" id="1639962">netpolllasterr</span>&nbsp;<span class="op" id="1639977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639982">netpolllasterr</span>&nbsp;<span class="op" id="1639997">=</span>&nbsp;<span class="ident" id="1639999">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1640004">println</span><span class="op" id="1640011">(</span><span class="string" id="1640012">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1640038">,</span>&nbsp;<span class="ident" id="1640040">epfd</span><span class="op" id="1640044">,</span>&nbsp;<span class="string" id="1640046">&#34;failed&nbsp;with&#34;</span><span class="op" id="1640059">,</span>&nbsp;<span class="op" id="1640061">-</span><span class="ident" id="1640062">n</span><span class="op" id="1640063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640071">goto</span>&nbsp;<span class="ident" id="1640076">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640086">for</span>&nbsp;<span class="ident" id="1640090">i</span>&nbsp;<span class="op" id="1640092">:=</span>&nbsp;<span class="builtintype" id="1640095">int32</span><span class="op" id="1640100">(</span><span class="num" id="1640101">0</span><span class="op" id="1640102">)</span><span class="op" id="1640103">;</span>&nbsp;<span class="ident" id="1640105">i</span>&nbsp;<span class="op" id="1640107">&lt;</span>&nbsp;<span class="ident" id="1640109">n</span><span class="op" id="1640110">;</span>&nbsp;<span class="ident" id="1640112">i</span><span class="op" id="1640113">++</span>&nbsp;<span class="op" id="1640116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640120">ev</span>&nbsp;<span class="op" id="1640123">:=</span>&nbsp;<span class="op" id="1640126">&amp;</span><span class="ident" id="1640127">events</span><span class="op" id="1640133">[</span><span class="ident" id="1640134">i</span><span class="op" id="1640135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640139">if</span>&nbsp;<span class="ident" id="1640142">ev</span><span class="op" id="1640144">.</span><span class="ident" id="1640145">events</span>&nbsp;<span class="op" id="1640152">==</span>&nbsp;<span class="num" id="1640155">0</span>&nbsp;<span class="op" id="1640157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640162">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640177">var</span>&nbsp;<span class="ident" id="1640181">mode</span>&nbsp;<span class="builtintype" id="1640186">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640194">if</span>&nbsp;<span class="ident" id="1640197">ev</span><span class="op" id="1640199">.</span><span class="ident" id="1640200">events</span><span class="op" id="1640206">&amp;</span><span class="op" id="1640207">(</span><span class="ident" id="1640208">_EPOLLIN</span><span class="op" id="1640216">|</span><span class="ident" id="1640217">_EPOLLRDHUP</span><span class="op" id="1640228">|</span><span class="ident" id="1640229">_EPOLLHUP</span><span class="op" id="1640238">|</span><span class="ident" id="1640239">_EPOLLERR</span><span class="op" id="1640248">)</span>&nbsp;<span class="op" id="1640250">!=</span>&nbsp;<span class="num" id="1640253">0</span>&nbsp;<span class="op" id="1640255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640260">mode</span>&nbsp;<span class="op" id="1640265">+=</span>&nbsp;<span class="string" id="1640268">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640274">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640278">if</span>&nbsp;<span class="ident" id="1640281">ev</span><span class="op" id="1640283">.</span><span class="ident" id="1640284">events</span><span class="op" id="1640290">&amp;</span><span class="op" id="1640291">(</span><span class="ident" id="1640292">_EPOLLOUT</span><span class="op" id="1640301">|</span><span class="ident" id="1640302">_EPOLLHUP</span><span class="op" id="1640311">|</span><span class="ident" id="1640312">_EPOLLERR</span><span class="op" id="1640321">)</span>&nbsp;<span class="op" id="1640323">!=</span>&nbsp;<span class="num" id="1640326">0</span>&nbsp;<span class="op" id="1640328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640333">mode</span>&nbsp;<span class="op" id="1640338">+=</span>&nbsp;<span class="string" id="1640341">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640351">if</span>&nbsp;<span class="ident" id="1640354">mode</span>&nbsp;<span class="op" id="1640359">!=</span>&nbsp;<span class="num" id="1640362">0</span>&nbsp;<span class="op" id="1640364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640369">pd</span>&nbsp;<span class="op" id="1640372">:=</span>&nbsp;<span class="op" id="1640375">*</span><span class="op" id="1640376">(</span><span class="op" id="1640377">*</span><span class="op" id="1640378">*</span><span class="ident" id="1640379">pollDesc</span><span class="op" id="1640387">)</span><span class="op" id="1640388">(</span><span class="ident" id="1640389">unsafe</span><span class="op" id="1640395">.</span><span class="ident" id="1640396">Pointer</span><span class="op" id="1640403">(</span><span class="op" id="1640404">&amp;</span><span class="ident" id="1640405">ev</span><span class="op" id="1640407">.</span><span class="ident" id="1640408">data</span><span class="op" id="1640412">)</span><span class="op" id="1640413">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640418">netpollready</span><span class="op" id="1640430">(</span><span class="op" id="1640431">(</span><span class="op" id="1640432">*</span><span class="op" id="1640433">*</span><span class="ident" id="1640434">g</span><span class="op" id="1640435">)</span><span class="op" id="1640436">(</span><span class="ident" id="1640437">noescape</span><span class="op" id="1640445">(</span><span class="ident" id="1640446">unsafe</span><span class="op" id="1640452">.</span><span class="ident" id="1640453">Pointer</span><span class="op" id="1640460">(</span><span class="op" id="1640461">&amp;</span><span class="ident" id="1640462">gp</span><span class="op" id="1640464">)</span><span class="op" id="1640465">)</span><span class="op" id="1640466">)</span><span class="op" id="1640467">,</span>&nbsp;<span class="ident" id="1640469">pd</span><span class="op" id="1640471">,</span>&nbsp;<span class="ident" id="1640473">mode</span><span class="op" id="1640477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640487">if</span>&nbsp;<span class="ident" id="1640490">block</span>&nbsp;<span class="op" id="1640496">&amp;&amp;</span>&nbsp;<span class="ident" id="1640499">gp</span>&nbsp;<span class="op" id="1640502">==</span>&nbsp;<span class="ident" id="1640505">nil</span>&nbsp;<span class="op" id="1640509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640513">goto</span>&nbsp;<span class="ident" id="1640518">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640528">return</span>&nbsp;<span class="ident" id="1640535">gp</span><br>
<span class="lineno"></span><span class="op" id="1640538">}</span>
</div>
</body>
</html>
