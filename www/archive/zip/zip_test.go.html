<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6675023">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6675078">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6675132">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6675183">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6675232">package</span>&nbsp;<span class="ident" id="6675240">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6675245">import</span>&nbsp;<span class="op" id="6675252">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675255">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675264">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675271">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675279">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675285">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675298">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675306">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675317">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6675328">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6675335">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6675338">func</span>&nbsp;<span class="ident" id="6675343">TestOver65kFiles</span><span class="op" id="6675359">(</span><span class="ident" id="6675360">t</span>&nbsp;<span class="op" id="6675362">*</span><span class="ident" id="6675363"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6675370">.</span><span class="ident" id="6675371">T</span><span class="op" id="6675372">)</span>&nbsp;<span class="op" id="6675374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675377">buf</span>&nbsp;<span class="op" id="6675381">:=</span>&nbsp;<span class="builtinfunc" id="6675384">new</span><span class="op" id="6675387">(</span><span class="ident" id="6675388"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6675393">.</span><span class="ident" id="6675394">Buffer</span><span class="op" id="6675400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675403">w</span>&nbsp;<span class="op" id="6675405">:=</span>&nbsp;<span class="ident" id="6675408"><a href="/archive/zip/writer.go.html#6411718">NewWriter</a></span><span class="op" id="6675417">(</span><span class="ident" id="6675418"><a href="/archive/zip/zip_test.go.html#6675377">buf</a></span><span class="op" id="6675421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675424">const</span>&nbsp;<span class="ident" id="6675430">nFiles</span>&nbsp;<span class="op" id="6675437">=</span>&nbsp;<span class="op" id="6675439">(</span><span class="num" id="6675440">1</span>&nbsp;<span class="op" id="6675442">&lt;&lt;</span>&nbsp;<span class="num" id="6675445">16</span><span class="op" id="6675447">)</span>&nbsp;<span class="op" id="6675449">+</span>&nbsp;<span class="num" id="6675451">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675455">for</span>&nbsp;<span class="ident" id="6675459">i</span>&nbsp;<span class="op" id="6675461">:=</span>&nbsp;<span class="num" id="6675464">0</span><span class="op" id="6675465">;</span>&nbsp;<span class="ident" id="6675467"><a href="/archive/zip/zip_test.go.html#6675459">i</a></span>&nbsp;<span class="op" id="6675469">&lt;</span>&nbsp;<span class="ident" id="6675471"><a href="/archive/zip/zip_test.go.html#6675430">nFiles</a></span><span class="op" id="6675477">;</span>&nbsp;<span class="ident" id="6675479"><a href="/archive/zip/zip_test.go.html#6675459">i</a></span><span class="op" id="6675480">++</span>&nbsp;<span class="op" id="6675483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675487">_</span><span class="op" id="6675488">,</span>&nbsp;<span class="ident" id="6675490">err</span>&nbsp;<span class="op" id="6675494">:=</span>&nbsp;<span class="ident" id="6675497"><a href="/archive/zip/zip_test.go.html#6675403">w</a></span><span class="op" id="6675498">.</span><span class="ident" id="6675499">CreateHeader</span><span class="op" id="6675511">(</span><span class="op" id="6675512">&amp;</span><span class="ident" id="6675513"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6675523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675528">Name</span><span class="op" id="6675532">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6675536"><a href="/archive/zip/zip_test.go.html#6675264">fmt</a></span><span class="op" id="6675539">.</span><span class="ident" id="6675540">Sprintf</span><span class="op" id="6675547">(</span><span class="string" id="6675548">&#34;%d.dat&#34;</span><span class="op" id="6675556">,</span>&nbsp;<span class="ident" id="6675558"><a href="/archive/zip/zip_test.go.html#6675459">i</a></span><span class="op" id="6675559">)</span><span class="op" id="6675560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675565">Method</span><span class="op" id="6675571">:</span>&nbsp;<span class="ident" id="6675573"><a href="/archive/zip/struct.go.html#6403390">Store</a></span><span class="op" id="6675578">,</span>&nbsp;<span class="comment" id="6675580">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675617">}</span><span class="op" id="6675618">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675622">if</span>&nbsp;<span class="ident" id="6675625"><a href="/archive/zip/zip_test.go.html#6675490">err</a></span>&nbsp;<span class="op" id="6675629">!=</span>&nbsp;<span class="ident" id="6675632">nil</span>&nbsp;<span class="op" id="6675636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675641"><a href="/archive/zip/zip_test.go.html#6675360">t</a></span><span class="op" id="6675642">.</span><span class="ident" id="6675643">Fatalf</span><span class="op" id="6675649">(</span><span class="string" id="6675650">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6675672">,</span>&nbsp;<span class="ident" id="6675674"><a href="/archive/zip/zip_test.go.html#6675459">i</a></span><span class="op" id="6675675">,</span>&nbsp;<span class="ident" id="6675677"><a href="/archive/zip/zip_test.go.html#6675490">err</a></span><span class="op" id="6675680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675690">if</span>&nbsp;<span class="ident" id="6675693">err</span>&nbsp;<span class="op" id="6675697">:=</span>&nbsp;<span class="ident" id="6675700"><a href="/archive/zip/zip_test.go.html#6675403">w</a></span><span class="op" id="6675701">.</span><span class="ident" id="6675702">Close</span><span class="op" id="6675707">(</span><span class="op" id="6675708">)</span><span class="op" id="6675709">;</span>&nbsp;<span class="ident" id="6675711"><a href="/archive/zip/zip_test.go.html#6675693">err</a></span>&nbsp;<span class="op" id="6675715">!=</span>&nbsp;<span class="ident" id="6675718">nil</span>&nbsp;<span class="op" id="6675722">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675726"><a href="/archive/zip/zip_test.go.html#6675360">t</a></span><span class="op" id="6675727">.</span><span class="ident" id="6675728">Fatalf</span><span class="op" id="6675734">(</span><span class="string" id="6675735">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6675753">,</span>&nbsp;<span class="ident" id="6675755"><a href="/archive/zip/zip_test.go.html#6675693">err</a></span><span class="op" id="6675758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675764">s</span>&nbsp;<span class="op" id="6675766">:=</span>&nbsp;<span class="ident" id="6675769"><a href="/archive/zip/zip_test.go.html#6675377">buf</a></span><span class="op" id="6675772">.</span><span class="ident" id="6675773">String</span><span class="op" id="6675779">(</span><span class="op" id="6675780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675783">zr</span><span class="op" id="6675785">,</span>&nbsp;<span class="ident" id="6675787">err</span>&nbsp;<span class="op" id="6675791">:=</span>&nbsp;<span class="ident" id="6675794"><a href="/archive/zip/reader.go.html#6388809">NewReader</a></span><span class="op" id="6675803">(</span><span class="ident" id="6675804"><a href="/archive/zip/zip_test.go.html#6675306">strings</a></span><span class="op" id="6675811">.</span><span class="ident" id="6675812">NewReader</span><span class="op" id="6675821">(</span><span class="ident" id="6675822"><a href="/archive/zip/zip_test.go.html#6675764">s</a></span><span class="op" id="6675823">)</span><span class="op" id="6675824">,</span>&nbsp;<span class="ident" id="6675826">int64</span><span class="op" id="6675831">(</span><span class="builtinfunc" id="6675832">len</span><span class="op" id="6675835">(</span><span class="ident" id="6675836"><a href="/archive/zip/zip_test.go.html#6675764">s</a></span><span class="op" id="6675837">)</span><span class="op" id="6675838">)</span><span class="op" id="6675839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675842">if</span>&nbsp;<span class="ident" id="6675845"><a href="/archive/zip/zip_test.go.html#6675787">err</a></span>&nbsp;<span class="op" id="6675849">!=</span>&nbsp;<span class="ident" id="6675852">nil</span>&nbsp;<span class="op" id="6675856">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675860"><a href="/archive/zip/zip_test.go.html#6675360">t</a></span><span class="op" id="6675861">.</span><span class="ident" id="6675862">Fatalf</span><span class="op" id="6675868">(</span><span class="string" id="6675869">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6675884">,</span>&nbsp;<span class="ident" id="6675886"><a href="/archive/zip/zip_test.go.html#6675787">err</a></span><span class="op" id="6675889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675895">if</span>&nbsp;<span class="ident" id="6675898">got</span>&nbsp;<span class="op" id="6675902">:=</span>&nbsp;<span class="builtinfunc" id="6675905">len</span><span class="op" id="6675908">(</span><span class="ident" id="6675909"><a href="/archive/zip/zip_test.go.html#6675783">zr</a></span><span class="op" id="6675911">.</span><span class="ident" id="6675912">File</span><span class="op" id="6675916">)</span><span class="op" id="6675917">;</span>&nbsp;<span class="ident" id="6675919"><a href="/archive/zip/zip_test.go.html#6675898">got</a></span>&nbsp;<span class="op" id="6675923">!=</span>&nbsp;<span class="ident" id="6675926"><a href="/archive/zip/zip_test.go.html#6675430">nFiles</a></span>&nbsp;<span class="op" id="6675933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675937"><a href="/archive/zip/zip_test.go.html#6675360">t</a></span><span class="op" id="6675938">.</span><span class="ident" id="6675939">Fatalf</span><span class="op" id="6675945">(</span><span class="string" id="6675946">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6675979">,</span>&nbsp;<span class="ident" id="6675981"><a href="/archive/zip/zip_test.go.html#6675898">got</a></span><span class="op" id="6675984">,</span>&nbsp;<span class="ident" id="6675986"><a href="/archive/zip/zip_test.go.html#6675430">nFiles</a></span><span class="op" id="6675992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675995">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675998">for</span>&nbsp;<span class="ident" id="6676002">i</span>&nbsp;<span class="op" id="6676004">:=</span>&nbsp;<span class="num" id="6676007">0</span><span class="op" id="6676008">;</span>&nbsp;<span class="ident" id="6676010"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span>&nbsp;<span class="op" id="6676012">&lt;</span>&nbsp;<span class="ident" id="6676014"><a href="/archive/zip/zip_test.go.html#6675430">nFiles</a></span><span class="op" id="6676020">;</span>&nbsp;<span class="ident" id="6676022"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span><span class="op" id="6676023">++</span>&nbsp;<span class="op" id="6676026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676030">want</span>&nbsp;<span class="op" id="6676035">:=</span>&nbsp;<span class="ident" id="6676038"><a href="/archive/zip/zip_test.go.html#6675264">fmt</a></span><span class="op" id="6676041">.</span><span class="ident" id="6676042">Sprintf</span><span class="op" id="6676049">(</span><span class="string" id="6676050">&#34;%d.dat&#34;</span><span class="op" id="6676058">,</span>&nbsp;<span class="ident" id="6676060"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span><span class="op" id="6676061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676065">if</span>&nbsp;<span class="ident" id="6676068"><a href="/archive/zip/zip_test.go.html#6675783">zr</a></span><span class="op" id="6676070">.</span><span class="ident" id="6676071">File</span><span class="op" id="6676075">[</span><span class="ident" id="6676076"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span><span class="op" id="6676077">]</span><span class="op" id="6676078">.</span><span class="ident" id="6676079">Name</span>&nbsp;<span class="op" id="6676084">!=</span>&nbsp;<span class="ident" id="6676087"><a href="/archive/zip/zip_test.go.html#6676030">want</a></span>&nbsp;<span class="op" id="6676092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676097"><a href="/archive/zip/zip_test.go.html#6675360">t</a></span><span class="op" id="6676098">.</span><span class="ident" id="6676099">Fatalf</span><span class="op" id="6676105">(</span><span class="string" id="6676106">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6676130">,</span>&nbsp;<span class="ident" id="6676132"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span><span class="op" id="6676133">,</span>&nbsp;<span class="ident" id="6676135"><a href="/archive/zip/zip_test.go.html#6675783">zr</a></span><span class="op" id="6676137">.</span><span class="ident" id="6676138">File</span><span class="op" id="6676142">[</span><span class="ident" id="6676143"><a href="/archive/zip/zip_test.go.html#6676002">i</a></span><span class="op" id="6676144">]</span><span class="op" id="6676145">.</span><span class="ident" id="6676146">Name</span><span class="op" id="6676150">,</span>&nbsp;<span class="ident" id="6676152"><a href="/archive/zip/zip_test.go.html#6676030">want</a></span><span class="op" id="6676156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676160">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676163">}</span><br>
<span class="lineno"></span><span class="op" id="6676165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676168">func</span>&nbsp;<span class="ident" id="6676173">TestModTime</span><span class="op" id="6676184">(</span><span class="ident" id="6676185">t</span>&nbsp;<span class="op" id="6676187">*</span><span class="ident" id="6676188"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6676195">.</span><span class="ident" id="6676196">T</span><span class="op" id="6676197">)</span>&nbsp;<span class="op" id="6676199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676202">var</span>&nbsp;<span class="ident" id="6676206">testTime</span>&nbsp;<span class="op" id="6676215">=</span>&nbsp;<span class="ident" id="6676217"><a href="/archive/zip/zip_test.go.html#6675328">time</a></span><span class="op" id="6676221">.</span><span class="ident" id="6676222">Date</span><span class="op" id="6676226">(</span><span class="num" id="6676227">2009</span><span class="op" id="6676231">,</span>&nbsp;<span class="ident" id="6676233"><a href="/archive/zip/zip_test.go.html#6675328">time</a></span><span class="op" id="6676237">.</span><span class="ident" id="6676238">November</span><span class="op" id="6676246">,</span>&nbsp;<span class="num" id="6676248">10</span><span class="op" id="6676250">,</span>&nbsp;<span class="num" id="6676252">23</span><span class="op" id="6676254">,</span>&nbsp;<span class="num" id="6676256">45</span><span class="op" id="6676258">,</span>&nbsp;<span class="num" id="6676260">58</span><span class="op" id="6676262">,</span>&nbsp;<span class="num" id="6676264">0</span><span class="op" id="6676265">,</span>&nbsp;<span class="ident" id="6676267"><a href="/archive/zip/zip_test.go.html#6675328">time</a></span><span class="op" id="6676271">.</span><span class="ident" id="6676272">UTC</span><span class="op" id="6676275">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676278">fh</span>&nbsp;<span class="op" id="6676281">:=</span>&nbsp;<span class="builtinfunc" id="6676284">new</span><span class="op" id="6676287">(</span><span class="ident" id="6676288"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6676298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676301"><a href="/archive/zip/zip_test.go.html#6676278">fh</a></span><span class="op" id="6676303">.</span><span class="ident" id="6676304">SetModTime</span><span class="op" id="6676314">(</span><span class="ident" id="6676315"><a href="/archive/zip/zip_test.go.html#6676206">testTime</a></span><span class="op" id="6676323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676326">outTime</span>&nbsp;<span class="op" id="6676334">:=</span>&nbsp;<span class="ident" id="6676337"><a href="/archive/zip/zip_test.go.html#6676278">fh</a></span><span class="op" id="6676339">.</span><span class="ident" id="6676340">ModTime</span><span class="op" id="6676347">(</span><span class="op" id="6676348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676351">if</span>&nbsp;<span class="op" id="6676354">!</span><span class="ident" id="6676355"><a href="/archive/zip/zip_test.go.html#6676326">outTime</a></span><span class="op" id="6676362">.</span><span class="ident" id="6676363">Equal</span><span class="op" id="6676368">(</span><span class="ident" id="6676369"><a href="/archive/zip/zip_test.go.html#6676206">testTime</a></span><span class="op" id="6676377">)</span>&nbsp;<span class="op" id="6676379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676383"><a href="/archive/zip/zip_test.go.html#6676185">t</a></span><span class="op" id="6676384">.</span><span class="ident" id="6676385">Errorf</span><span class="op" id="6676391">(</span><span class="string" id="6676392">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6676428">,</span>&nbsp;<span class="ident" id="6676430"><a href="/archive/zip/zip_test.go.html#6676326">outTime</a></span><span class="op" id="6676437">,</span>&nbsp;<span class="ident" id="6676439"><a href="/archive/zip/zip_test.go.html#6676206">testTime</a></span><span class="op" id="6676447">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676450">}</span><br>
<span class="lineno"></span><span class="op" id="6676452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676455">func</span>&nbsp;<span class="ident" id="6676460">testHeaderRoundTrip</span><span class="op" id="6676479">(</span><span class="ident" id="6676480">fh</span>&nbsp;<span class="op" id="6676483">*</span><span class="ident" id="6676484"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6676494">,</span>&nbsp;<span class="ident" id="6676496">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="6676517">uint32</span><span class="op" id="6676523">,</span>&nbsp;<span class="ident" id="6676525">wantUncompressedSize64</span>&nbsp;<span class="ident" id="6676548">uint64</span><span class="op" id="6676554">,</span>&nbsp;<span class="ident" id="6676556">t</span>&nbsp;<span class="op" id="6676558">*</span><span class="ident" id="6676559"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6676566">.</span><span class="ident" id="6676567">T</span><span class="op" id="6676568">)</span>&nbsp;<span class="op" id="6676570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676573">fi</span>&nbsp;<span class="op" id="6676576">:=</span>&nbsp;<span class="ident" id="6676579"><a href="/archive/zip/zip_test.go.html#6676480">fh</a></span><span class="op" id="6676581">.</span><span class="ident" id="6676582">FileInfo</span><span class="op" id="6676590">(</span><span class="op" id="6676591">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676594">fh2</span><span class="op" id="6676597">,</span>&nbsp;<span class="ident" id="6676599">err</span>&nbsp;<span class="op" id="6676603">:=</span>&nbsp;<span class="ident" id="6676606"><a href="/archive/zip/struct.go.html#6406453">FileInfoHeader</a></span><span class="op" id="6676620">(</span><span class="ident" id="6676621"><a href="/archive/zip/zip_test.go.html#6676573">fi</a></span><span class="op" id="6676623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676626">if</span>&nbsp;<span class="ident" id="6676629"><a href="/archive/zip/zip_test.go.html#6676599">err</a></span>&nbsp;<span class="op" id="6676633">!=</span>&nbsp;<span class="ident" id="6676636">nil</span>&nbsp;<span class="op" id="6676640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676644"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6676645">.</span><span class="ident" id="6676646">Fatal</span><span class="op" id="6676651">(</span><span class="ident" id="6676652"><a href="/archive/zip/zip_test.go.html#6676599">err</a></span><span class="op" id="6676655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676661">if</span>&nbsp;<span class="ident" id="6676664">got</span><span class="op" id="6676667">,</span>&nbsp;<span class="ident" id="6676669">want</span>&nbsp;<span class="op" id="6676674">:=</span>&nbsp;<span class="ident" id="6676677"><a href="/archive/zip/zip_test.go.html#6676594">fh2</a></span><span class="op" id="6676680">.</span><span class="ident" id="6676681">Name</span><span class="op" id="6676685">,</span>&nbsp;<span class="ident" id="6676687"><a href="/archive/zip/zip_test.go.html#6676480">fh</a></span><span class="op" id="6676689">.</span><span class="ident" id="6676690">Name</span><span class="op" id="6676694">;</span>&nbsp;<span class="ident" id="6676696"><a href="/archive/zip/zip_test.go.html#6676664">got</a></span>&nbsp;<span class="op" id="6676700">!=</span>&nbsp;<span class="ident" id="6676703"><a href="/archive/zip/zip_test.go.html#6676669">want</a></span>&nbsp;<span class="op" id="6676708">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676712"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6676713">.</span><span class="ident" id="6676714">Errorf</span><span class="op" id="6676720">(</span><span class="string" id="6676721">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="6676746">,</span>&nbsp;<span class="ident" id="6676748"><a href="/archive/zip/zip_test.go.html#6676664">got</a></span><span class="op" id="6676751">,</span>&nbsp;<span class="ident" id="6676753"><a href="/archive/zip/zip_test.go.html#6676669">want</a></span><span class="op" id="6676757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676763">if</span>&nbsp;<span class="ident" id="6676766">got</span><span class="op" id="6676769">,</span>&nbsp;<span class="ident" id="6676771">want</span>&nbsp;<span class="op" id="6676776">:=</span>&nbsp;<span class="ident" id="6676779"><a href="/archive/zip/zip_test.go.html#6676594">fh2</a></span><span class="op" id="6676782">.</span><span class="ident" id="6676783">UncompressedSize</span><span class="op" id="6676799">,</span>&nbsp;<span class="ident" id="6676801"><a href="/archive/zip/zip_test.go.html#6676496">wantUncompressedSize</a></span><span class="op" id="6676821">;</span>&nbsp;<span class="ident" id="6676823"><a href="/archive/zip/zip_test.go.html#6676766">got</a></span>&nbsp;<span class="op" id="6676827">!=</span>&nbsp;<span class="ident" id="6676830"><a href="/archive/zip/zip_test.go.html#6676771">want</a></span>&nbsp;<span class="op" id="6676835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676839"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6676840">.</span><span class="ident" id="6676841">Errorf</span><span class="op" id="6676847">(</span><span class="string" id="6676848">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6676885">,</span>&nbsp;<span class="ident" id="6676887"><a href="/archive/zip/zip_test.go.html#6676766">got</a></span><span class="op" id="6676890">,</span>&nbsp;<span class="ident" id="6676892"><a href="/archive/zip/zip_test.go.html#6676771">want</a></span><span class="op" id="6676896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676899">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676902">if</span>&nbsp;<span class="ident" id="6676905">got</span><span class="op" id="6676908">,</span>&nbsp;<span class="ident" id="6676910">want</span>&nbsp;<span class="op" id="6676915">:=</span>&nbsp;<span class="ident" id="6676918"><a href="/archive/zip/zip_test.go.html#6676594">fh2</a></span><span class="op" id="6676921">.</span><span class="ident" id="6676922">UncompressedSize64</span><span class="op" id="6676940">,</span>&nbsp;<span class="ident" id="6676942"><a href="/archive/zip/zip_test.go.html#6676525">wantUncompressedSize64</a></span><span class="op" id="6676964">;</span>&nbsp;<span class="ident" id="6676966"><a href="/archive/zip/zip_test.go.html#6676905">got</a></span>&nbsp;<span class="op" id="6676970">!=</span>&nbsp;<span class="ident" id="6676973"><a href="/archive/zip/zip_test.go.html#6676910">want</a></span>&nbsp;<span class="op" id="6676978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676982"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6676983">.</span><span class="ident" id="6676984">Errorf</span><span class="op" id="6676990">(</span><span class="string" id="6676991">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6677030">,</span>&nbsp;<span class="ident" id="6677032"><a href="/archive/zip/zip_test.go.html#6676905">got</a></span><span class="op" id="6677035">,</span>&nbsp;<span class="ident" id="6677037"><a href="/archive/zip/zip_test.go.html#6676910">want</a></span><span class="op" id="6677041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677047">if</span>&nbsp;<span class="ident" id="6677050">got</span><span class="op" id="6677053">,</span>&nbsp;<span class="ident" id="6677055">want</span>&nbsp;<span class="op" id="6677060">:=</span>&nbsp;<span class="ident" id="6677063"><a href="/archive/zip/zip_test.go.html#6676594">fh2</a></span><span class="op" id="6677066">.</span><span class="ident" id="6677067">ModifiedTime</span><span class="op" id="6677079">,</span>&nbsp;<span class="ident" id="6677081"><a href="/archive/zip/zip_test.go.html#6676480">fh</a></span><span class="op" id="6677083">.</span><span class="ident" id="6677084">ModifiedTime</span><span class="op" id="6677096">;</span>&nbsp;<span class="ident" id="6677098"><a href="/archive/zip/zip_test.go.html#6677050">got</a></span>&nbsp;<span class="op" id="6677102">!=</span>&nbsp;<span class="ident" id="6677105"><a href="/archive/zip/zip_test.go.html#6677055">want</a></span>&nbsp;<span class="op" id="6677110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677114"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6677115">.</span><span class="ident" id="6677116">Errorf</span><span class="op" id="6677122">(</span><span class="string" id="6677123">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6677156">,</span>&nbsp;<span class="ident" id="6677158"><a href="/archive/zip/zip_test.go.html#6677050">got</a></span><span class="op" id="6677161">,</span>&nbsp;<span class="ident" id="6677163"><a href="/archive/zip/zip_test.go.html#6677055">want</a></span><span class="op" id="6677167">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677173">if</span>&nbsp;<span class="ident" id="6677176">got</span><span class="op" id="6677179">,</span>&nbsp;<span class="ident" id="6677181">want</span>&nbsp;<span class="op" id="6677186">:=</span>&nbsp;<span class="ident" id="6677189"><a href="/archive/zip/zip_test.go.html#6676594">fh2</a></span><span class="op" id="6677192">.</span><span class="ident" id="6677193">ModifiedDate</span><span class="op" id="6677205">,</span>&nbsp;<span class="ident" id="6677207"><a href="/archive/zip/zip_test.go.html#6676480">fh</a></span><span class="op" id="6677209">.</span><span class="ident" id="6677210">ModifiedDate</span><span class="op" id="6677222">;</span>&nbsp;<span class="ident" id="6677224"><a href="/archive/zip/zip_test.go.html#6677176">got</a></span>&nbsp;<span class="op" id="6677228">!=</span>&nbsp;<span class="ident" id="6677231"><a href="/archive/zip/zip_test.go.html#6677181">want</a></span>&nbsp;<span class="op" id="6677236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677240"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6677241">.</span><span class="ident" id="6677242">Errorf</span><span class="op" id="6677248">(</span><span class="string" id="6677249">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6677282">,</span>&nbsp;<span class="ident" id="6677284"><a href="/archive/zip/zip_test.go.html#6677176">got</a></span><span class="op" id="6677287">,</span>&nbsp;<span class="ident" id="6677289"><a href="/archive/zip/zip_test.go.html#6677181">want</a></span><span class="op" id="6677293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677300">if</span>&nbsp;<span class="ident" id="6677303">sysfh</span><span class="op" id="6677308">,</span>&nbsp;<span class="ident" id="6677310">ok</span>&nbsp;<span class="op" id="6677313">:=</span>&nbsp;<span class="ident" id="6677316"><a href="/archive/zip/zip_test.go.html#6676573">fi</a></span><span class="op" id="6677318">.</span><span class="ident" id="6677319">Sys</span><span class="op" id="6677322">(</span><span class="op" id="6677323">)</span><span class="op" id="6677324">.</span><span class="op" id="6677325">(</span><span class="op" id="6677326">*</span><span class="ident" id="6677327"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6677337">)</span><span class="op" id="6677338">;</span>&nbsp;<span class="op" id="6677340">!</span><span class="ident" id="6677341"><a href="/archive/zip/zip_test.go.html#6677310">ok</a></span>&nbsp;<span class="op" id="6677344">&amp;&amp;</span>&nbsp;<span class="ident" id="6677347"><a href="/archive/zip/zip_test.go.html#6677303">sysfh</a></span>&nbsp;<span class="op" id="6677353">!=</span>&nbsp;<span class="ident" id="6677356"><a href="/archive/zip/zip_test.go.html#6676480">fh</a></span>&nbsp;<span class="op" id="6677359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677363"><a href="/archive/zip/zip_test.go.html#6676556">t</a></span><span class="op" id="6677364">.</span><span class="ident" id="6677365">Errorf</span><span class="op" id="6677371">(</span><span class="string" id="6677372">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="6677412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677415">}</span><br>
<span class="lineno"></span><span class="op" id="6677417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6677420">func</span>&nbsp;<span class="ident" id="6677425">TestFileHeaderRoundTrip</span><span class="op" id="6677448">(</span><span class="ident" id="6677449">t</span>&nbsp;<span class="op" id="6677451">*</span><span class="ident" id="6677452"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6677459">.</span><span class="ident" id="6677460">T</span><span class="op" id="6677461">)</span>&nbsp;<span class="op" id="6677463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677466">fh</span>&nbsp;<span class="op" id="6677469">:=</span>&nbsp;<span class="op" id="6677472">&amp;</span><span class="ident" id="6677473"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6677483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677487">Name</span><span class="op" id="6677491">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6677505">&#34;foo.txt&#34;</span><span class="op" id="6677514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677518">UncompressedSize</span><span class="op" id="6677534">:</span>&nbsp;<span class="num" id="6677536">987654321</span><span class="op" id="6677545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677549">ModifiedTime</span><span class="op" id="6677561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6677567">1234</span><span class="op" id="6677571">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677575">ModifiedDate</span><span class="op" id="6677587">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6677593">5678</span><span class="op" id="6677597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677603"><a href="/archive/zip/zip_test.go.html#6676460">testHeaderRoundTrip</a></span><span class="op" id="6677622">(</span><span class="ident" id="6677623"><a href="/archive/zip/zip_test.go.html#6677466">fh</a></span><span class="op" id="6677625">,</span>&nbsp;<span class="ident" id="6677627"><a href="/archive/zip/zip_test.go.html#6677466">fh</a></span><span class="op" id="6677629">.</span><span class="ident" id="6677630">UncompressedSize</span><span class="op" id="6677646">,</span>&nbsp;<span class="ident" id="6677648">uint64</span><span class="op" id="6677654">(</span><span class="ident" id="6677655"><a href="/archive/zip/zip_test.go.html#6677466">fh</a></span><span class="op" id="6677657">.</span><span class="ident" id="6677658">UncompressedSize</span><span class="op" id="6677674">)</span><span class="op" id="6677675">,</span>&nbsp;<span class="ident" id="6677677"><a href="/archive/zip/zip_test.go.html#6677449">t</a></span><span class="op" id="6677678">)</span><br>
<span class="lineno"></span><span class="op" id="6677680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6677683">func</span>&nbsp;<span class="ident" id="6677688">TestFileHeaderRoundTrip64</span><span class="op" id="6677713">(</span><span class="ident" id="6677714">t</span>&nbsp;<span class="op" id="6677716">*</span><span class="ident" id="6677717"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6677724">.</span><span class="ident" id="6677725">T</span><span class="op" id="6677726">)</span>&nbsp;<span class="op" id="6677728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677731">fh</span>&nbsp;<span class="op" id="6677734">:=</span>&nbsp;<span class="op" id="6677737">&amp;</span><span class="ident" id="6677738"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6677748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677752">Name</span><span class="op" id="6677756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6677772">&#34;foo.txt&#34;</span><span class="op" id="6677781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677785">UncompressedSize64</span><span class="op" id="6677803">:</span>&nbsp;<span class="num" id="6677805">9876543210</span><span class="op" id="6677815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677819">ModifiedTime</span><span class="op" id="6677831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6677839">1234</span><span class="op" id="6677843">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677847">ModifiedDate</span><span class="op" id="6677859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6677867">5678</span><span class="op" id="6677871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677877"><a href="/archive/zip/zip_test.go.html#6676460">testHeaderRoundTrip</a></span><span class="op" id="6677896">(</span><span class="ident" id="6677897"><a href="/archive/zip/zip_test.go.html#6677731">fh</a></span><span class="op" id="6677899">,</span>&nbsp;<span class="ident" id="6677901"><a href="/archive/zip/struct.go.html#6404490">uint32max</a></span><span class="op" id="6677910">,</span>&nbsp;<span class="ident" id="6677912"><a href="/archive/zip/zip_test.go.html#6677731">fh</a></span><span class="op" id="6677914">.</span><span class="ident" id="6677915">UncompressedSize64</span><span class="op" id="6677933">,</span>&nbsp;<span class="ident" id="6677935"><a href="/archive/zip/zip_test.go.html#6677714">t</a></span><span class="op" id="6677936">)</span><br>
<span class="lineno"></span><span class="op" id="6677938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6677941">type</span>&nbsp;<span class="ident" id="6677946">repeatedByte</span>&nbsp;<span class="keyword" id="6677959">struct</span>&nbsp;<span class="op" id="6677966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677969">off</span>&nbsp;<span class="ident" id="6677973">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677980">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6677984">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677990">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6677994">int64</span><br>
<span class="lineno"></span><span class="op" id="6678000">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6678003">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6678053">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="6678121">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="6678154">type</span>&nbsp;<span class="ident" id="6678159">rleBuffer</span>&nbsp;<span class="keyword" id="6678169">struct</span>&nbsp;<span class="op" id="6678176">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678179">buf</span>&nbsp;<span class="op" id="6678183">[</span><span class="op" id="6678184">]</span><span class="ident" id="6678185"><a href="/archive/zip/zip_test.go.html#6677946">repeatedByte</a></span><br>
<span class="lineno"></span><span class="op" id="6678198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6678201">func</span>&nbsp;<span class="op" id="6678206">(</span><span class="ident" id="6678207">r</span>&nbsp;<span class="op" id="6678209">*</span><span class="ident" id="6678210"><a href="/archive/zip/zip_test.go.html#6678159">rleBuffer</a></span><span class="op" id="6678219">)</span>&nbsp;<span class="ident" id="6678221">Size</span><span class="op" id="6678225">(</span><span class="op" id="6678226">)</span>&nbsp;<span class="ident" id="6678228">int64</span>&nbsp;<span class="op" id="6678234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678237">if</span>&nbsp;<span class="builtinfunc" id="6678240">len</span><span class="op" id="6678243">(</span><span class="ident" id="6678244"><a href="/archive/zip/zip_test.go.html#6678207">r</a></span><span class="op" id="6678245">.</span><span class="ident" id="6678246">buf</span><span class="op" id="6678249">)</span>&nbsp;<span class="op" id="6678251">==</span>&nbsp;<span class="num" id="6678254">0</span>&nbsp;<span class="op" id="6678256">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678260">return</span>&nbsp;<span class="num" id="6678267">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678273">last</span>&nbsp;<span class="op" id="6678278">:=</span>&nbsp;<span class="op" id="6678281">&amp;</span><span class="ident" id="6678282"><a href="/archive/zip/zip_test.go.html#6678207">r</a></span><span class="op" id="6678283">.</span><span class="ident" id="6678284">buf</span><span class="op" id="6678287">[</span><span class="builtinfunc" id="6678288">len</span><span class="op" id="6678291">(</span><span class="ident" id="6678292"><a href="/archive/zip/zip_test.go.html#6678207">r</a></span><span class="op" id="6678293">.</span><span class="ident" id="6678294">buf</span><span class="op" id="6678297">)</span><span class="op" id="6678298">-</span><span class="num" id="6678299">1</span><span class="op" id="6678300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678303">return</span>&nbsp;<span class="ident" id="6678310"><a href="/archive/zip/zip_test.go.html#6678273">last</a></span><span class="op" id="6678314">.</span><span class="ident" id="6678315">off</span>&nbsp;<span class="op" id="6678319">+</span>&nbsp;<span class="ident" id="6678321"><a href="/archive/zip/zip_test.go.html#6678273">last</a></span><span class="op" id="6678325">.</span><span class="ident" id="6678326">n</span><br>
<span class="lineno"></span><span class="op" id="6678328">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6678331">func</span>&nbsp;<span class="op" id="6678336">(</span><span class="ident" id="6678337">r</span>&nbsp;<span class="op" id="6678339">*</span><span class="ident" id="6678340"><a href="/archive/zip/zip_test.go.html#6678159">rleBuffer</a></span><span class="op" id="6678349">)</span>&nbsp;<span class="ident" id="6678351">Write</span><span class="op" id="6678356">(</span><span class="ident" id="6678357">p</span>&nbsp;<span class="op" id="6678359">[</span><span class="op" id="6678360">]</span><span class="builtintype" id="6678361">byte</span><span class="op" id="6678365">)</span>&nbsp;<span class="op" id="6678367">(</span><span class="ident" id="6678368">n</span>&nbsp;<span class="builtintype" id="6678370">int</span><span class="op" id="6678373">,</span>&nbsp;<span class="ident" id="6678375">err</span>&nbsp;<span class="builtintype" id="6678379">error</span><span class="op" id="6678384">)</span>&nbsp;<span class="op" id="6678386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678389">var</span>&nbsp;<span class="ident" id="6678393">rp</span>&nbsp;<span class="op" id="6678396">*</span><span class="ident" id="6678397"><a href="/archive/zip/zip_test.go.html#6677946">repeatedByte</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678411">if</span>&nbsp;<span class="builtinfunc" id="6678414">len</span><span class="op" id="6678417">(</span><span class="ident" id="6678418"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678419">.</span><span class="ident" id="6678420">buf</span><span class="op" id="6678423">)</span>&nbsp;<span class="op" id="6678425">&gt;</span>&nbsp;<span class="num" id="6678427">0</span>&nbsp;<span class="op" id="6678429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678433"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span>&nbsp;<span class="op" id="6678436">=</span>&nbsp;<span class="op" id="6678438">&amp;</span><span class="ident" id="6678439"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678440">.</span><span class="ident" id="6678441">buf</span><span class="op" id="6678444">[</span><span class="builtinfunc" id="6678445">len</span><span class="op" id="6678448">(</span><span class="ident" id="6678449"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678450">.</span><span class="ident" id="6678451">buf</span><span class="op" id="6678454">)</span><span class="op" id="6678455">-</span><span class="num" id="6678456">1</span><span class="op" id="6678457">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6678461">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678518">if</span>&nbsp;<span class="ident" id="6678521">lastByte</span>&nbsp;<span class="op" id="6678530">:=</span>&nbsp;<span class="ident" id="6678533"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span><span class="op" id="6678535">.</span><span class="ident" id="6678536">b</span><span class="op" id="6678537">;</span>&nbsp;<span class="builtinfunc" id="6678539">len</span><span class="op" id="6678542">(</span><span class="ident" id="6678543"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span><span class="op" id="6678544">)</span>&nbsp;<span class="op" id="6678546">&gt;</span>&nbsp;<span class="num" id="6678548">0</span>&nbsp;<span class="op" id="6678550">&amp;&amp;</span>&nbsp;<span class="ident" id="6678553"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span><span class="op" id="6678554">[</span><span class="num" id="6678555">0</span><span class="op" id="6678556">]</span>&nbsp;<span class="op" id="6678558">==</span>&nbsp;<span class="ident" id="6678561"><a href="/archive/zip/zip_test.go.html#6678521">lastByte</a></span>&nbsp;<span class="op" id="6678570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678575">all</span>&nbsp;<span class="op" id="6678579">:=</span>&nbsp;<span class="ident" id="6678582">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678590">for</span>&nbsp;<span class="ident" id="6678594">_</span><span class="op" id="6678595">,</span>&nbsp;<span class="ident" id="6678597">b</span>&nbsp;<span class="op" id="6678599">:=</span>&nbsp;<span class="keyword" id="6678602">range</span>&nbsp;<span class="ident" id="6678608"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span>&nbsp;<span class="op" id="6678610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678616">if</span>&nbsp;<span class="ident" id="6678619"><a href="/archive/zip/zip_test.go.html#6678597">b</a></span>&nbsp;<span class="op" id="6678621">!=</span>&nbsp;<span class="ident" id="6678624"><a href="/archive/zip/zip_test.go.html#6678521">lastByte</a></span>&nbsp;<span class="op" id="6678633">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678640"><a href="/archive/zip/zip_test.go.html#6678575">all</a></span>&nbsp;<span class="op" id="6678644">=</span>&nbsp;<span class="ident" id="6678646">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678657">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678677">if</span>&nbsp;<span class="ident" id="6678680"><a href="/archive/zip/zip_test.go.html#6678575">all</a></span>&nbsp;<span class="op" id="6678684">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678690"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span><span class="op" id="6678692">.</span><span class="ident" id="6678693">n</span>&nbsp;<span class="op" id="6678695">+=</span>&nbsp;<span class="ident" id="6678698">int64</span><span class="op" id="6678703">(</span><span class="builtinfunc" id="6678704">len</span><span class="op" id="6678707">(</span><span class="ident" id="6678708"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span><span class="op" id="6678709">)</span><span class="op" id="6678710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678716">return</span>&nbsp;<span class="builtinfunc" id="6678723">len</span><span class="op" id="6678726">(</span><span class="ident" id="6678727"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span><span class="op" id="6678728">)</span><span class="op" id="6678729">,</span>&nbsp;<span class="ident" id="6678731">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678745">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678749">for</span>&nbsp;<span class="ident" id="6678753">_</span><span class="op" id="6678754">,</span>&nbsp;<span class="ident" id="6678756">b</span>&nbsp;<span class="op" id="6678758">:=</span>&nbsp;<span class="keyword" id="6678761">range</span>&nbsp;<span class="ident" id="6678767"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span>&nbsp;<span class="op" id="6678769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678773">if</span>&nbsp;<span class="ident" id="6678776"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span>&nbsp;<span class="op" id="6678779">==</span>&nbsp;<span class="ident" id="6678782">nil</span>&nbsp;<span class="op" id="6678786">||</span>&nbsp;<span class="ident" id="6678789"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span><span class="op" id="6678791">.</span><span class="ident" id="6678792">b</span>&nbsp;<span class="op" id="6678794">!=</span>&nbsp;<span class="ident" id="6678797"><a href="/archive/zip/zip_test.go.html#6678756">b</a></span>&nbsp;<span class="op" id="6678799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678804"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678805">.</span><span class="ident" id="6678806">buf</span>&nbsp;<span class="op" id="6678810">=</span>&nbsp;<span class="builtinfunc" id="6678812">append</span><span class="op" id="6678818">(</span><span class="ident" id="6678819"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678820">.</span><span class="ident" id="6678821">buf</span><span class="op" id="6678824">,</span>&nbsp;<span class="ident" id="6678826"><a href="/archive/zip/zip_test.go.html#6677946">repeatedByte</a></span><span class="op" id="6678838">{</span><span class="ident" id="6678839"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678840">.</span><span class="ident" id="6678841">Size</span><span class="op" id="6678845">(</span><span class="op" id="6678846">)</span><span class="op" id="6678847">,</span>&nbsp;<span class="ident" id="6678849"><a href="/archive/zip/zip_test.go.html#6678756">b</a></span><span class="op" id="6678850">,</span>&nbsp;<span class="num" id="6678852">1</span><span class="op" id="6678853">}</span><span class="op" id="6678854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678859"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span>&nbsp;<span class="op" id="6678862">=</span>&nbsp;<span class="op" id="6678864">&amp;</span><span class="ident" id="6678865"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678866">.</span><span class="ident" id="6678867">buf</span><span class="op" id="6678870">[</span><span class="builtinfunc" id="6678871">len</span><span class="op" id="6678874">(</span><span class="ident" id="6678875"><a href="/archive/zip/zip_test.go.html#6678337">r</a></span><span class="op" id="6678876">.</span><span class="ident" id="6678877">buf</span><span class="op" id="6678880">)</span><span class="op" id="6678881">-</span><span class="num" id="6678882">1</span><span class="op" id="6678883">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678887">}</span>&nbsp;<span class="keyword" id="6678889">else</span>&nbsp;<span class="op" id="6678894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678899"><a href="/archive/zip/zip_test.go.html#6678393">rp</a></span><span class="op" id="6678901">.</span><span class="ident" id="6678902">n</span><span class="op" id="6678903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678914">return</span>&nbsp;<span class="builtinfunc" id="6678921">len</span><span class="op" id="6678924">(</span><span class="ident" id="6678925"><a href="/archive/zip/zip_test.go.html#6678357">p</a></span><span class="op" id="6678926">)</span><span class="op" id="6678927">,</span>&nbsp;<span class="ident" id="6678929">nil</span><br>
<span class="lineno">160</span><span class="op" id="6678933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6678936">func</span>&nbsp;<span class="op" id="6678941">(</span><span class="ident" id="6678942">r</span>&nbsp;<span class="op" id="6678944">*</span><span class="ident" id="6678945"><a href="/archive/zip/zip_test.go.html#6678159">rleBuffer</a></span><span class="op" id="6678954">)</span>&nbsp;<span class="ident" id="6678956">ReadAt</span><span class="op" id="6678962">(</span><span class="ident" id="6678963">p</span>&nbsp;<span class="op" id="6678965">[</span><span class="op" id="6678966">]</span><span class="builtintype" id="6678967">byte</span><span class="op" id="6678971">,</span>&nbsp;<span class="ident" id="6678973">off</span>&nbsp;<span class="ident" id="6678977">int64</span><span class="op" id="6678982">)</span>&nbsp;<span class="op" id="6678984">(</span><span class="ident" id="6678985">n</span>&nbsp;<span class="builtintype" id="6678987">int</span><span class="op" id="6678990">,</span>&nbsp;<span class="ident" id="6678992">err</span>&nbsp;<span class="builtintype" id="6678996">error</span><span class="op" id="6679001">)</span>&nbsp;<span class="op" id="6679003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679006">if</span>&nbsp;<span class="builtinfunc" id="6679009">len</span><span class="op" id="6679012">(</span><span class="ident" id="6679013"><a href="/archive/zip/zip_test.go.html#6678963">p</a></span><span class="op" id="6679014">)</span>&nbsp;<span class="op" id="6679016">==</span>&nbsp;<span class="num" id="6679019">0</span>&nbsp;<span class="op" id="6679021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679025">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679036">skipParts</span>&nbsp;<span class="op" id="6679046">:=</span>&nbsp;<span class="ident" id="6679049"><a href="/archive/zip/zip_test.go.html#6675298">sort</a></span><span class="op" id="6679053">.</span><span class="ident" id="6679054">Search</span><span class="op" id="6679060">(</span><span class="builtinfunc" id="6679061">len</span><span class="op" id="6679064">(</span><span class="ident" id="6679065"><a href="/archive/zip/zip_test.go.html#6678942">r</a></span><span class="op" id="6679066">.</span><span class="ident" id="6679067">buf</span><span class="op" id="6679070">)</span><span class="op" id="6679071">,</span>&nbsp;<span class="keyword" id="6679073">func</span><span class="op" id="6679077">(</span><span class="ident" id="6679078">i</span>&nbsp;<span class="builtintype" id="6679080">int</span><span class="op" id="6679083">)</span>&nbsp;<span class="builtintype" id="6679085">bool</span>&nbsp;<span class="op" id="6679090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679094">part</span>&nbsp;<span class="op" id="6679099">:=</span>&nbsp;<span class="op" id="6679102">&amp;</span><span class="ident" id="6679103"><a href="/archive/zip/zip_test.go.html#6678942">r</a></span><span class="op" id="6679104">.</span><span class="ident" id="6679105">buf</span><span class="op" id="6679108">[</span><span class="ident" id="6679109"><a href="/archive/zip/zip_test.go.html#6679078">i</a></span><span class="op" id="6679110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679114">return</span>&nbsp;<span class="ident" id="6679121"><a href="/archive/zip/zip_test.go.html#6679094">part</a></span><span class="op" id="6679125">.</span><span class="ident" id="6679126">off</span><span class="op" id="6679129">+</span><span class="ident" id="6679130"><a href="/archive/zip/zip_test.go.html#6679094">part</a></span><span class="op" id="6679134">.</span><span class="ident" id="6679135">n</span>&nbsp;<span class="op" id="6679137">&gt;</span>&nbsp;<span class="ident" id="6679139"><a href="/archive/zip/zip_test.go.html#6678973">off</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679144">}</span><span class="op" id="6679145">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679148">parts</span>&nbsp;<span class="op" id="6679154">:=</span>&nbsp;<span class="ident" id="6679157"><a href="/archive/zip/zip_test.go.html#6678942">r</a></span><span class="op" id="6679158">.</span><span class="ident" id="6679159">buf</span><span class="op" id="6679162">[</span><span class="ident" id="6679163"><a href="/archive/zip/zip_test.go.html#6679036">skipParts</a></span><span class="op" id="6679172">:</span><span class="op" id="6679173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679176">if</span>&nbsp;<span class="builtinfunc" id="6679179">len</span><span class="op" id="6679182">(</span><span class="ident" id="6679183"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span><span class="op" id="6679188">)</span>&nbsp;<span class="op" id="6679190">&gt;</span>&nbsp;<span class="num" id="6679192">0</span>&nbsp;<span class="op" id="6679194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679198">skipBytes</span>&nbsp;<span class="op" id="6679208">:=</span>&nbsp;<span class="ident" id="6679211"><a href="/archive/zip/zip_test.go.html#6678973">off</a></span>&nbsp;<span class="op" id="6679215">-</span>&nbsp;<span class="ident" id="6679217"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span><span class="op" id="6679222">[</span><span class="num" id="6679223">0</span><span class="op" id="6679224">]</span><span class="op" id="6679225">.</span><span class="ident" id="6679226">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679232">for</span>&nbsp;<span class="builtinfunc" id="6679236">len</span><span class="op" id="6679239">(</span><span class="ident" id="6679240"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span><span class="op" id="6679245">)</span>&nbsp;<span class="op" id="6679247">&gt;</span>&nbsp;<span class="num" id="6679249">0</span>&nbsp;<span class="op" id="6679251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679256">part</span>&nbsp;<span class="op" id="6679261">:=</span>&nbsp;<span class="ident" id="6679264"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span><span class="op" id="6679269">[</span><span class="num" id="6679270">0</span><span class="op" id="6679271">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679276">for</span>&nbsp;<span class="ident" id="6679280">i</span>&nbsp;<span class="op" id="6679282">:=</span>&nbsp;<span class="ident" id="6679285"><a href="/archive/zip/zip_test.go.html#6679198">skipBytes</a></span><span class="op" id="6679294">;</span>&nbsp;<span class="ident" id="6679296"><a href="/archive/zip/zip_test.go.html#6679280">i</a></span>&nbsp;<span class="op" id="6679298">&lt;</span>&nbsp;<span class="ident" id="6679300"><a href="/archive/zip/zip_test.go.html#6679256">part</a></span><span class="op" id="6679304">.</span><span class="ident" id="6679305">n</span><span class="op" id="6679306">;</span>&nbsp;<span class="ident" id="6679308"><a href="/archive/zip/zip_test.go.html#6679280">i</a></span><span class="op" id="6679309">++</span>&nbsp;<span class="op" id="6679312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679318">if</span>&nbsp;<span class="ident" id="6679321"><a href="/archive/zip/zip_test.go.html#6678985">n</a></span>&nbsp;<span class="op" id="6679323">==</span>&nbsp;<span class="builtinfunc" id="6679326">len</span><span class="op" id="6679329">(</span><span class="ident" id="6679330"><a href="/archive/zip/zip_test.go.html#6678963">p</a></span><span class="op" id="6679331">)</span>&nbsp;<span class="op" id="6679333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679340">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679357"><a href="/archive/zip/zip_test.go.html#6678963">p</a></span><span class="op" id="6679358">[</span><span class="ident" id="6679359"><a href="/archive/zip/zip_test.go.html#6678985">n</a></span><span class="op" id="6679360">]</span>&nbsp;<span class="op" id="6679362">=</span>&nbsp;<span class="ident" id="6679364"><a href="/archive/zip/zip_test.go.html#6679256">part</a></span><span class="op" id="6679368">.</span><span class="ident" id="6679369">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679375"><a href="/archive/zip/zip_test.go.html#6678985">n</a></span><span class="op" id="6679376">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679387"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span>&nbsp;<span class="op" id="6679393">=</span>&nbsp;<span class="ident" id="6679395"><a href="/archive/zip/zip_test.go.html#6679148">parts</a></span><span class="op" id="6679400">[</span><span class="num" id="6679401">1</span><span class="op" id="6679402">:</span><span class="op" id="6679403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679408"><a href="/archive/zip/zip_test.go.html#6679198">skipBytes</a></span>&nbsp;<span class="op" id="6679418">=</span>&nbsp;<span class="num" id="6679420">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679424">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679430">if</span>&nbsp;<span class="ident" id="6679433"><a href="/archive/zip/zip_test.go.html#6678985">n</a></span>&nbsp;<span class="op" id="6679435">!=</span>&nbsp;<span class="builtinfunc" id="6679438">len</span><span class="op" id="6679441">(</span><span class="ident" id="6679442"><a href="/archive/zip/zip_test.go.html#6678963">p</a></span><span class="op" id="6679443">)</span>&nbsp;<span class="op" id="6679445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679449"><a href="/archive/zip/zip_test.go.html#6678992">err</a></span>&nbsp;<span class="op" id="6679453">=</span>&nbsp;<span class="ident" id="6679455"><a href="/archive/zip/zip_test.go.html#6675279">io</a></span><span class="op" id="6679457">.</span><span class="ident" id="6679458">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679479">return</span><br>
<span class="lineno">190</span><span class="op" id="6679486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6679489">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="6679575">func</span>&nbsp;<span class="ident" id="6679580">TestRLEBuffer</span><span class="op" id="6679593">(</span><span class="ident" id="6679594">t</span>&nbsp;<span class="op" id="6679596">*</span><span class="ident" id="6679597"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6679604">.</span><span class="ident" id="6679605">T</span><span class="op" id="6679606">)</span>&nbsp;<span class="op" id="6679608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679611">b</span>&nbsp;<span class="op" id="6679613">:=</span>&nbsp;<span class="builtinfunc" id="6679616">new</span><span class="op" id="6679619">(</span><span class="ident" id="6679620"><a href="/archive/zip/zip_test.go.html#6678159">rleBuffer</a></span><span class="op" id="6679629">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679632">var</span>&nbsp;<span class="ident" id="6679636">all</span>&nbsp;<span class="op" id="6679640">[</span><span class="op" id="6679641">]</span><span class="builtintype" id="6679642">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679648">writes</span>&nbsp;<span class="op" id="6679655">:=</span>&nbsp;<span class="op" id="6679658">[</span><span class="op" id="6679659">]</span><span class="builtintype" id="6679660">string</span><span class="op" id="6679666">{</span><span class="string" id="6679667">&#34;abcdeee&#34;</span><span class="op" id="6679676">,</span>&nbsp;<span class="string" id="6679678">&#34;eeeeeee&#34;</span><span class="op" id="6679687">,</span>&nbsp;<span class="string" id="6679689">&#34;eeeefghaaiii&#34;</span><span class="op" id="6679703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679706">for</span>&nbsp;<span class="ident" id="6679710">_</span><span class="op" id="6679711">,</span>&nbsp;<span class="ident" id="6679713">w</span>&nbsp;<span class="op" id="6679715">:=</span>&nbsp;<span class="keyword" id="6679718">range</span>&nbsp;<span class="ident" id="6679724"><a href="/archive/zip/zip_test.go.html#6679648">writes</a></span>&nbsp;<span class="op" id="6679731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679735"><a href="/archive/zip/zip_test.go.html#6679611">b</a></span><span class="op" id="6679736">.</span><span class="ident" id="6679737">Write</span><span class="op" id="6679742">(</span><span class="op" id="6679743">[</span><span class="op" id="6679744">]</span><span class="builtintype" id="6679745">byte</span><span class="op" id="6679749">(</span><span class="ident" id="6679750"><a href="/archive/zip/zip_test.go.html#6679713">w</a></span><span class="op" id="6679751">)</span><span class="op" id="6679752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679756"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span>&nbsp;<span class="op" id="6679760">=</span>&nbsp;<span class="builtinfunc" id="6679762">append</span><span class="op" id="6679768">(</span><span class="ident" id="6679769"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span><span class="op" id="6679772">,</span>&nbsp;<span class="ident" id="6679774"><a href="/archive/zip/zip_test.go.html#6679713">w</a></span><span class="op" id="6679775">...</span><span class="op" id="6679778">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679784">if</span>&nbsp;<span class="builtinfunc" id="6679787">len</span><span class="op" id="6679790">(</span><span class="ident" id="6679791"><a href="/archive/zip/zip_test.go.html#6679611">b</a></span><span class="op" id="6679792">.</span><span class="ident" id="6679793">buf</span><span class="op" id="6679796">)</span>&nbsp;<span class="op" id="6679798">!=</span>&nbsp;<span class="num" id="6679801">10</span>&nbsp;<span class="op" id="6679804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679808"><a href="/archive/zip/zip_test.go.html#6679594">t</a></span><span class="op" id="6679809">.</span><span class="ident" id="6679810">Fatalf</span><span class="op" id="6679816">(</span><span class="string" id="6679817">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="6679843">,</span>&nbsp;<span class="builtinfunc" id="6679845">len</span><span class="op" id="6679848">(</span><span class="ident" id="6679849"><a href="/archive/zip/zip_test.go.html#6679611">b</a></span><span class="op" id="6679850">.</span><span class="ident" id="6679851">buf</span><span class="op" id="6679854">)</span><span class="op" id="6679855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679862">for</span>&nbsp;<span class="ident" id="6679866">i</span>&nbsp;<span class="op" id="6679868">:=</span>&nbsp;<span class="num" id="6679871">0</span><span class="op" id="6679872">;</span>&nbsp;<span class="ident" id="6679874"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span>&nbsp;<span class="op" id="6679876">&lt;</span>&nbsp;<span class="builtinfunc" id="6679878">len</span><span class="op" id="6679881">(</span><span class="ident" id="6679882"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span><span class="op" id="6679885">)</span><span class="op" id="6679886">;</span>&nbsp;<span class="ident" id="6679888"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6679889">++</span>&nbsp;<span class="op" id="6679892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679896">for</span>&nbsp;<span class="ident" id="6679900">j</span>&nbsp;<span class="op" id="6679902">:=</span>&nbsp;<span class="num" id="6679905">0</span><span class="op" id="6679906">;</span>&nbsp;<span class="ident" id="6679908"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span>&nbsp;<span class="op" id="6679910">&lt;</span>&nbsp;<span class="builtinfunc" id="6679912">len</span><span class="op" id="6679915">(</span><span class="ident" id="6679916"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span><span class="op" id="6679919">)</span><span class="op" id="6679920">-</span><span class="ident" id="6679921"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6679922">;</span>&nbsp;<span class="ident" id="6679924"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6679925">++</span>&nbsp;<span class="op" id="6679928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679933">buf</span>&nbsp;<span class="op" id="6679937">:=</span>&nbsp;<span class="builtinfunc" id="6679940">make</span><span class="op" id="6679944">(</span><span class="op" id="6679945">[</span><span class="op" id="6679946">]</span><span class="builtintype" id="6679947">byte</span><span class="op" id="6679951">,</span>&nbsp;<span class="ident" id="6679953"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6679954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679959">n</span><span class="op" id="6679960">,</span>&nbsp;<span class="ident" id="6679962">err</span>&nbsp;<span class="op" id="6679966">:=</span>&nbsp;<span class="ident" id="6679969"><a href="/archive/zip/zip_test.go.html#6679611">b</a></span><span class="op" id="6679970">.</span><span class="ident" id="6679971">ReadAt</span><span class="op" id="6679977">(</span><span class="ident" id="6679978"><a href="/archive/zip/zip_test.go.html#6679933">buf</a></span><span class="op" id="6679981">,</span>&nbsp;<span class="ident" id="6679983">int64</span><span class="op" id="6679988">(</span><span class="ident" id="6679989"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6679990">)</span><span class="op" id="6679991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679996">if</span>&nbsp;<span class="ident" id="6679999"><a href="/archive/zip/zip_test.go.html#6679962">err</a></span>&nbsp;<span class="op" id="6680003">!=</span>&nbsp;<span class="ident" id="6680006">nil</span>&nbsp;<span class="op" id="6680010">||</span>&nbsp;<span class="ident" id="6680013"><a href="/archive/zip/zip_test.go.html#6679959">n</a></span>&nbsp;<span class="op" id="6680015">!=</span>&nbsp;<span class="builtinfunc" id="6680018">len</span><span class="op" id="6680021">(</span><span class="ident" id="6680022"><a href="/archive/zip/zip_test.go.html#6679933">buf</a></span><span class="op" id="6680025">)</span>&nbsp;<span class="op" id="6680027">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680033"><a href="/archive/zip/zip_test.go.html#6679594">t</a></span><span class="op" id="6680034">.</span><span class="ident" id="6680035">Errorf</span><span class="op" id="6680041">(</span><span class="string" id="6680042">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6680081">,</span>&nbsp;<span class="ident" id="6680083"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680084">,</span>&nbsp;<span class="ident" id="6680086"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6680087">,</span>&nbsp;<span class="ident" id="6680089"><a href="/archive/zip/zip_test.go.html#6679959">n</a></span><span class="op" id="6680090">,</span>&nbsp;<span class="ident" id="6680092"><a href="/archive/zip/zip_test.go.html#6679962">err</a></span><span class="op" id="6680095">,</span>&nbsp;<span class="builtinfunc" id="6680097">len</span><span class="op" id="6680100">(</span><span class="ident" id="6680101"><a href="/archive/zip/zip_test.go.html#6679933">buf</a></span><span class="op" id="6680104">)</span><span class="op" id="6680105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680115">if</span>&nbsp;<span class="op" id="6680118">!</span><span class="ident" id="6680119"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6680124">.</span><span class="ident" id="6680125">Equal</span><span class="op" id="6680130">(</span><span class="ident" id="6680131"><a href="/archive/zip/zip_test.go.html#6679933">buf</a></span><span class="op" id="6680134">,</span>&nbsp;<span class="ident" id="6680136"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span><span class="op" id="6680139">[</span><span class="ident" id="6680140"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680141">:</span><span class="ident" id="6680142"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680143">+</span><span class="ident" id="6680144"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6680145">]</span><span class="op" id="6680146">)</span>&nbsp;<span class="op" id="6680148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680154"><a href="/archive/zip/zip_test.go.html#6679594">t</a></span><span class="op" id="6680155">.</span><span class="ident" id="6680156">Errorf</span><span class="op" id="6680162">(</span><span class="string" id="6680163">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6680193">,</span>&nbsp;<span class="ident" id="6680195"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680196">,</span>&nbsp;<span class="ident" id="6680198"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6680199">,</span>&nbsp;<span class="ident" id="6680201"><a href="/archive/zip/zip_test.go.html#6679933">buf</a></span><span class="op" id="6680204">,</span>&nbsp;<span class="ident" id="6680206"><a href="/archive/zip/zip_test.go.html#6679636">all</a></span><span class="op" id="6680209">[</span><span class="ident" id="6680210"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680211">:</span><span class="ident" id="6680212"><a href="/archive/zip/zip_test.go.html#6679866">i</a></span><span class="op" id="6680213">+</span><span class="ident" id="6680214"><a href="/archive/zip/zip_test.go.html#6679900">j</a></span><span class="op" id="6680215">]</span><span class="op" id="6680216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680221">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680228">}</span><br>
<span class="lineno"></span><span class="op" id="6680230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6680233">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="6680288">type</span>&nbsp;<span class="ident" id="6680293">fakeHash32</span>&nbsp;<span class="keyword" id="6680304">struct</span>&nbsp;<span class="op" id="6680311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680314"><a href="/archive/zip/zip_test.go.html#6675271">hash</a></span><span class="op" id="6680318">.</span><span class="ident" id="6680319">Hash32</span><br>
<span class="lineno"></span><span class="op" id="6680326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6680329">func</span>&nbsp;<span class="op" id="6680334">(</span><span class="ident" id="6680335"><a href="/archive/zip/zip_test.go.html#6680293">fakeHash32</a></span><span class="op" id="6680345">)</span>&nbsp;<span class="ident" id="6680347">Write</span><span class="op" id="6680352">(</span><span class="ident" id="6680353">p</span>&nbsp;<span class="op" id="6680355">[</span><span class="op" id="6680356">]</span><span class="builtintype" id="6680357">byte</span><span class="op" id="6680361">)</span>&nbsp;<span class="op" id="6680363">(</span><span class="builtintype" id="6680364">int</span><span class="op" id="6680367">,</span>&nbsp;<span class="builtintype" id="6680369">error</span><span class="op" id="6680374">)</span>&nbsp;<span class="op" id="6680376">{</span>&nbsp;<span class="keyword" id="6680378">return</span>&nbsp;<span class="builtinfunc" id="6680385">len</span><span class="op" id="6680388">(</span><span class="ident" id="6680389"><a href="/archive/zip/zip_test.go.html#6680353">p</a></span><span class="op" id="6680390">)</span><span class="op" id="6680391">,</span>&nbsp;<span class="ident" id="6680393">nil</span>&nbsp;<span class="op" id="6680397">}</span><br>
<span class="lineno">225</span><span class="keyword" id="6680399">func</span>&nbsp;<span class="op" id="6680404">(</span><span class="ident" id="6680405"><a href="/archive/zip/zip_test.go.html#6680293">fakeHash32</a></span><span class="op" id="6680415">)</span>&nbsp;<span class="ident" id="6680417">Sum32</span><span class="op" id="6680422">(</span><span class="op" id="6680423">)</span>&nbsp;<span class="builtintype" id="6680425">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6680446">{</span>&nbsp;<span class="keyword" id="6680448">return</span>&nbsp;<span class="num" id="6680455">0</span>&nbsp;<span class="op" id="6680457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6680460">func</span>&nbsp;<span class="ident" id="6680465">TestZip64</span><span class="op" id="6680474">(</span><span class="ident" id="6680475">t</span>&nbsp;<span class="op" id="6680477">*</span><span class="ident" id="6680478"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6680485">.</span><span class="ident" id="6680486">T</span><span class="op" id="6680487">)</span>&nbsp;<span class="op" id="6680489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680492">if</span>&nbsp;<span class="ident" id="6680495"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6680502">.</span><span class="ident" id="6680503">Short</span><span class="op" id="6680508">(</span><span class="op" id="6680509">)</span>&nbsp;<span class="op" id="6680511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680515"><a href="/archive/zip/zip_test.go.html#6680475">t</a></span><span class="op" id="6680516">.</span><span class="ident" id="6680517">Skip</span><span class="op" id="6680521">(</span><span class="string" id="6680522">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="6680543">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680549">const</span>&nbsp;<span class="ident" id="6680555">size</span>&nbsp;<span class="op" id="6680560">=</span>&nbsp;<span class="num" id="6680562">1</span>&nbsp;<span class="op" id="6680564">&lt;&lt;</span>&nbsp;<span class="num" id="6680567">32</span>&nbsp;<span class="comment" id="6680570">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680598"><a href="/archive/zip/zip_test.go.html#6680625">testZip64</a></span><span class="op" id="6680607">(</span><span class="ident" id="6680608"><a href="/archive/zip/zip_test.go.html#6680475">t</a></span><span class="op" id="6680609">,</span>&nbsp;<span class="ident" id="6680611"><a href="/archive/zip/zip_test.go.html#6680555">size</a></span><span class="op" id="6680615">)</span><br>
<span class="lineno"></span><span class="op" id="6680617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="6680620">func</span>&nbsp;<span class="ident" id="6680625">testZip64</span><span class="op" id="6680634">(</span><span class="ident" id="6680635">t</span>&nbsp;<span class="ident" id="6680637"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6680644">.</span><span class="ident" id="6680645">TB</span><span class="op" id="6680647">,</span>&nbsp;<span class="ident" id="6680649">size</span>&nbsp;<span class="ident" id="6680654">int64</span><span class="op" id="6680659">)</span>&nbsp;<span class="op" id="6680661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680664">const</span>&nbsp;<span class="ident" id="6680670">chunkSize</span>&nbsp;<span class="op" id="6680680">=</span>&nbsp;<span class="num" id="6680682">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680688">chunks</span>&nbsp;<span class="op" id="6680695">:=</span>&nbsp;<span class="builtintype" id="6680698">int</span><span class="op" id="6680701">(</span><span class="ident" id="6680702"><a href="/archive/zip/zip_test.go.html#6680649">size</a></span>&nbsp;<span class="op" id="6680707">/</span>&nbsp;<span class="ident" id="6680709"><a href="/archive/zip/zip_test.go.html#6680670">chunkSize</a></span><span class="op" id="6680718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6680721">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680769">buf</span>&nbsp;<span class="op" id="6680773">:=</span>&nbsp;<span class="builtinfunc" id="6680776">new</span><span class="op" id="6680779">(</span><span class="ident" id="6680780"><a href="/archive/zip/zip_test.go.html#6678159">rleBuffer</a></span><span class="op" id="6680789">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680792">w</span>&nbsp;<span class="op" id="6680794">:=</span>&nbsp;<span class="ident" id="6680797"><a href="/archive/zip/writer.go.html#6411718">NewWriter</a></span><span class="op" id="6680806">(</span><span class="ident" id="6680807"><a href="/archive/zip/zip_test.go.html#6680769">buf</a></span><span class="op" id="6680810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680813">f</span><span class="op" id="6680814">,</span>&nbsp;<span class="ident" id="6680816">err</span>&nbsp;<span class="op" id="6680820">:=</span>&nbsp;<span class="ident" id="6680823"><a href="/archive/zip/zip_test.go.html#6680792">w</a></span><span class="op" id="6680824">.</span><span class="ident" id="6680825">CreateHeader</span><span class="op" id="6680837">(</span><span class="op" id="6680838">&amp;</span><span class="ident" id="6680839"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6680849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680853">Name</span><span class="op" id="6680857">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6680861">&#34;huge.txt&#34;</span><span class="op" id="6680871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680875">Method</span><span class="op" id="6680881">:</span>&nbsp;<span class="ident" id="6680883"><a href="/archive/zip/struct.go.html#6403390">Store</a></span><span class="op" id="6680888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680891">}</span><span class="op" id="6680892">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680895">if</span>&nbsp;<span class="ident" id="6680898"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6680902">!=</span>&nbsp;<span class="ident" id="6680905">nil</span>&nbsp;<span class="op" id="6680909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680913"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6680914">.</span><span class="ident" id="6680915">Fatal</span><span class="op" id="6680920">(</span><span class="ident" id="6680921"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6680924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680930"><a href="/archive/zip/zip_test.go.html#6680813">f</a></span><span class="op" id="6680931">.</span><span class="op" id="6680932">(</span><span class="op" id="6680933">*</span><span class="ident" id="6680934"><a href="/archive/zip/writer.go.html#6418413">fileWriter</a></span><span class="op" id="6680944">)</span><span class="op" id="6680945">.</span><span class="ident" id="6680946">crc32</span>&nbsp;<span class="op" id="6680952">=</span>&nbsp;<span class="ident" id="6680954"><a href="/archive/zip/zip_test.go.html#6680293">fakeHash32</a></span><span class="op" id="6680964">{</span><span class="op" id="6680965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680968">chunk</span>&nbsp;<span class="op" id="6680974">:=</span>&nbsp;<span class="builtinfunc" id="6680977">make</span><span class="op" id="6680981">(</span><span class="op" id="6680982">[</span><span class="op" id="6680983">]</span><span class="builtintype" id="6680984">byte</span><span class="op" id="6680988">,</span>&nbsp;<span class="ident" id="6680990"><a href="/archive/zip/zip_test.go.html#6680670">chunkSize</a></span><span class="op" id="6680999">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681002">for</span>&nbsp;<span class="ident" id="6681006">i</span>&nbsp;<span class="op" id="6681008">:=</span>&nbsp;<span class="keyword" id="6681011">range</span>&nbsp;<span class="ident" id="6681017"><a href="/archive/zip/zip_test.go.html#6680968">chunk</a></span>&nbsp;<span class="op" id="6681023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681027"><a href="/archive/zip/zip_test.go.html#6680968">chunk</a></span><span class="op" id="6681032">[</span><span class="ident" id="6681033"><a href="/archive/zip/zip_test.go.html#6681006">i</a></span><span class="op" id="6681034">]</span>&nbsp;<span class="op" id="6681036">=</span>&nbsp;<span class="string" id="6681038">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681046">for</span>&nbsp;<span class="ident" id="6681050">i</span>&nbsp;<span class="op" id="6681052">:=</span>&nbsp;<span class="num" id="6681055">0</span><span class="op" id="6681056">;</span>&nbsp;<span class="ident" id="6681058"><a href="/archive/zip/zip_test.go.html#6681050">i</a></span>&nbsp;<span class="op" id="6681060">&lt;</span>&nbsp;<span class="ident" id="6681062"><a href="/archive/zip/zip_test.go.html#6680688">chunks</a></span><span class="op" id="6681068">;</span>&nbsp;<span class="ident" id="6681070"><a href="/archive/zip/zip_test.go.html#6681050">i</a></span><span class="op" id="6681071">++</span>&nbsp;<span class="op" id="6681074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681078">_</span><span class="op" id="6681079">,</span>&nbsp;<span class="ident" id="6681081">err</span>&nbsp;<span class="op" id="6681085">:=</span>&nbsp;<span class="ident" id="6681088"><a href="/archive/zip/zip_test.go.html#6680813">f</a></span><span class="op" id="6681089">.</span><span class="ident" id="6681090">Write</span><span class="op" id="6681095">(</span><span class="ident" id="6681096"><a href="/archive/zip/zip_test.go.html#6680968">chunk</a></span><span class="op" id="6681101">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681105">if</span>&nbsp;<span class="ident" id="6681108"><a href="/archive/zip/zip_test.go.html#6681081">err</a></span>&nbsp;<span class="op" id="6681112">!=</span>&nbsp;<span class="ident" id="6681115">nil</span>&nbsp;<span class="op" id="6681119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681124"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681125">.</span><span class="ident" id="6681126">Fatal</span><span class="op" id="6681131">(</span><span class="string" id="6681132">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="6681146">,</span>&nbsp;<span class="ident" id="6681148"><a href="/archive/zip/zip_test.go.html#6681081">err</a></span><span class="op" id="6681151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681161">end</span>&nbsp;<span class="op" id="6681165">:=</span>&nbsp;<span class="op" id="6681168">[</span><span class="op" id="6681169">]</span><span class="builtintype" id="6681170">byte</span><span class="op" id="6681174">(</span><span class="string" id="6681175">&#34;END\n&#34;</span><span class="op" id="6681182">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681185">_</span><span class="op" id="6681186">,</span>&nbsp;<span class="ident" id="6681188"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681192">=</span>&nbsp;<span class="ident" id="6681194"><a href="/archive/zip/zip_test.go.html#6680813">f</a></span><span class="op" id="6681195">.</span><span class="ident" id="6681196">Write</span><span class="op" id="6681201">(</span><span class="ident" id="6681202"><a href="/archive/zip/zip_test.go.html#6681161">end</a></span><span class="op" id="6681205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681208">if</span>&nbsp;<span class="ident" id="6681211"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681215">!=</span>&nbsp;<span class="ident" id="6681218">nil</span>&nbsp;<span class="op" id="6681222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681226"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681227">.</span><span class="ident" id="6681228">Fatal</span><span class="op" id="6681233">(</span><span class="string" id="6681234">&#34;write&nbsp;end:&#34;</span><span class="op" id="6681246">,</span>&nbsp;<span class="ident" id="6681248"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6681251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681257">if</span>&nbsp;<span class="ident" id="6681260">err</span>&nbsp;<span class="op" id="6681264">:=</span>&nbsp;<span class="ident" id="6681267"><a href="/archive/zip/zip_test.go.html#6680792">w</a></span><span class="op" id="6681268">.</span><span class="ident" id="6681269">Close</span><span class="op" id="6681274">(</span><span class="op" id="6681275">)</span><span class="op" id="6681276">;</span>&nbsp;<span class="ident" id="6681278"><a href="/archive/zip/zip_test.go.html#6681260">err</a></span>&nbsp;<span class="op" id="6681282">!=</span>&nbsp;<span class="ident" id="6681285">nil</span>&nbsp;<span class="op" id="6681289">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681293"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681294">.</span><span class="ident" id="6681295">Fatal</span><span class="op" id="6681300">(</span><span class="ident" id="6681301"><a href="/archive/zip/zip_test.go.html#6681260">err</a></span><span class="op" id="6681304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681311">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681373">r</span><span class="op" id="6681374">,</span>&nbsp;<span class="ident" id="6681376"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681380">:=</span>&nbsp;<span class="ident" id="6681383"><a href="/archive/zip/reader.go.html#6388809">NewReader</a></span><span class="op" id="6681392">(</span><span class="ident" id="6681393"><a href="/archive/zip/zip_test.go.html#6680769">buf</a></span><span class="op" id="6681396">,</span>&nbsp;<span class="ident" id="6681398">int64</span><span class="op" id="6681403">(</span><span class="ident" id="6681404"><a href="/archive/zip/zip_test.go.html#6680769">buf</a></span><span class="op" id="6681407">.</span><span class="ident" id="6681408">Size</span><span class="op" id="6681412">(</span><span class="op" id="6681413">)</span><span class="op" id="6681414">)</span><span class="op" id="6681415">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681418">if</span>&nbsp;<span class="ident" id="6681421"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681425">!=</span>&nbsp;<span class="ident" id="6681428">nil</span>&nbsp;<span class="op" id="6681432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681436"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681437">.</span><span class="ident" id="6681438">Fatal</span><span class="op" id="6681443">(</span><span class="string" id="6681444">&#34;reader:&#34;</span><span class="op" id="6681453">,</span>&nbsp;<span class="ident" id="6681455"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6681458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681464">f0</span>&nbsp;<span class="op" id="6681467">:=</span>&nbsp;<span class="ident" id="6681470"><a href="/archive/zip/zip_test.go.html#6681373">r</a></span><span class="op" id="6681471">.</span><span class="ident" id="6681472">File</span><span class="op" id="6681476">[</span><span class="num" id="6681477">0</span><span class="op" id="6681478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681481">rc</span><span class="op" id="6681483">,</span>&nbsp;<span class="ident" id="6681485"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681489">:=</span>&nbsp;<span class="ident" id="6681492"><a href="/archive/zip/zip_test.go.html#6681464">f0</a></span><span class="op" id="6681494">.</span><span class="ident" id="6681495">Open</span><span class="op" id="6681499">(</span><span class="op" id="6681500">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681503">if</span>&nbsp;<span class="ident" id="6681506"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681510">!=</span>&nbsp;<span class="ident" id="6681513">nil</span>&nbsp;<span class="op" id="6681517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681521"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681522">.</span><span class="ident" id="6681523">Fatal</span><span class="op" id="6681528">(</span><span class="string" id="6681529">&#34;opening:&#34;</span><span class="op" id="6681539">,</span>&nbsp;<span class="ident" id="6681541"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6681544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681550"><a href="/archive/zip/zip_test.go.html#6681481">rc</a></span><span class="op" id="6681552">.</span><span class="op" id="6681553">(</span><span class="op" id="6681554">*</span><span class="ident" id="6681555"><a href="/archive/zip/reader.go.html#6391182">checksumReader</a></span><span class="op" id="6681569">)</span><span class="op" id="6681570">.</span><span class="ident" id="6681571">hash</span>&nbsp;<span class="op" id="6681576">=</span>&nbsp;<span class="ident" id="6681578"><a href="/archive/zip/zip_test.go.html#6680293">fakeHash32</a></span><span class="op" id="6681588">{</span><span class="op" id="6681589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681592">for</span>&nbsp;<span class="ident" id="6681596">i</span>&nbsp;<span class="op" id="6681598">:=</span>&nbsp;<span class="num" id="6681601">0</span><span class="op" id="6681602">;</span>&nbsp;<span class="ident" id="6681604"><a href="/archive/zip/zip_test.go.html#6681596">i</a></span>&nbsp;<span class="op" id="6681606">&lt;</span>&nbsp;<span class="ident" id="6681608"><a href="/archive/zip/zip_test.go.html#6680688">chunks</a></span><span class="op" id="6681614">;</span>&nbsp;<span class="ident" id="6681616"><a href="/archive/zip/zip_test.go.html#6681596">i</a></span><span class="op" id="6681617">++</span>&nbsp;<span class="op" id="6681620">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681624">_</span><span class="op" id="6681625">,</span>&nbsp;<span class="ident" id="6681627">err</span>&nbsp;<span class="op" id="6681631">:=</span>&nbsp;<span class="ident" id="6681634"><a href="/archive/zip/zip_test.go.html#6675279">io</a></span><span class="op" id="6681636">.</span><span class="ident" id="6681637">ReadFull</span><span class="op" id="6681645">(</span><span class="ident" id="6681646"><a href="/archive/zip/zip_test.go.html#6681481">rc</a></span><span class="op" id="6681648">,</span>&nbsp;<span class="ident" id="6681650"><a href="/archive/zip/zip_test.go.html#6680968">chunk</a></span><span class="op" id="6681655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681659">if</span>&nbsp;<span class="ident" id="6681662"><a href="/archive/zip/zip_test.go.html#6681627">err</a></span>&nbsp;<span class="op" id="6681666">!=</span>&nbsp;<span class="ident" id="6681669">nil</span>&nbsp;<span class="op" id="6681673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681678"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681679">.</span><span class="ident" id="6681680">Fatal</span><span class="op" id="6681685">(</span><span class="string" id="6681686">&#34;read:&#34;</span><span class="op" id="6681693">,</span>&nbsp;<span class="ident" id="6681695"><a href="/archive/zip/zip_test.go.html#6681627">err</a></span><span class="op" id="6681698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681705">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681708">gotEnd</span><span class="op" id="6681714">,</span>&nbsp;<span class="ident" id="6681716"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681720">:=</span>&nbsp;<span class="ident" id="6681723"><a href="/archive/zip/zip_test.go.html#6675285">ioutil</a></span><span class="op" id="6681729">.</span><span class="ident" id="6681730">ReadAll</span><span class="op" id="6681737">(</span><span class="ident" id="6681738"><a href="/archive/zip/zip_test.go.html#6681481">rc</a></span><span class="op" id="6681740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681743">if</span>&nbsp;<span class="ident" id="6681746"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681750">!=</span>&nbsp;<span class="ident" id="6681753">nil</span>&nbsp;<span class="op" id="6681757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681761"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681762">.</span><span class="ident" id="6681763">Fatal</span><span class="op" id="6681768">(</span><span class="string" id="6681769">&#34;read&nbsp;end:&#34;</span><span class="op" id="6681780">,</span>&nbsp;<span class="ident" id="6681782"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6681785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681791">if</span>&nbsp;<span class="op" id="6681794">!</span><span class="ident" id="6681795"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6681800">.</span><span class="ident" id="6681801">Equal</span><span class="op" id="6681806">(</span><span class="ident" id="6681807"><a href="/archive/zip/zip_test.go.html#6681708">gotEnd</a></span><span class="op" id="6681813">,</span>&nbsp;<span class="ident" id="6681815"><a href="/archive/zip/zip_test.go.html#6681161">end</a></span><span class="op" id="6681818">)</span>&nbsp;<span class="op" id="6681820">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681824"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681825">.</span><span class="ident" id="6681826">Errorf</span><span class="op" id="6681832">(</span><span class="string" id="6681833">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6681867">,</span>&nbsp;<span class="ident" id="6681869"><a href="/archive/zip/zip_test.go.html#6681708">gotEnd</a></span><span class="op" id="6681875">,</span>&nbsp;<span class="ident" id="6681877"><a href="/archive/zip/zip_test.go.html#6681161">end</a></span><span class="op" id="6681880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681886"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681890">=</span>&nbsp;<span class="ident" id="6681892"><a href="/archive/zip/zip_test.go.html#6681481">rc</a></span><span class="op" id="6681894">.</span><span class="ident" id="6681895">Close</span><span class="op" id="6681900">(</span><span class="op" id="6681901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681904">if</span>&nbsp;<span class="ident" id="6681907"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span>&nbsp;<span class="op" id="6681911">!=</span>&nbsp;<span class="ident" id="6681914">nil</span>&nbsp;<span class="op" id="6681918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681922"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6681923">.</span><span class="ident" id="6681924">Fatal</span><span class="op" id="6681929">(</span><span class="string" id="6681930">&#34;closing:&#34;</span><span class="op" id="6681940">,</span>&nbsp;<span class="ident" id="6681942"><a href="/archive/zip/zip_test.go.html#6680816">err</a></span><span class="op" id="6681945">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681951">if</span>&nbsp;<span class="ident" id="6681954"><a href="/archive/zip/zip_test.go.html#6680649">size</a></span>&nbsp;<span class="op" id="6681959">==</span>&nbsp;<span class="num" id="6681962">1</span><span class="op" id="6681963">&lt;&lt;</span><span class="num" id="6681965">32</span>&nbsp;<span class="op" id="6681968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681972">if</span>&nbsp;<span class="ident" id="6681975">got</span><span class="op" id="6681978">,</span>&nbsp;<span class="ident" id="6681980">want</span>&nbsp;<span class="op" id="6681985">:=</span>&nbsp;<span class="ident" id="6681988"><a href="/archive/zip/zip_test.go.html#6681464">f0</a></span><span class="op" id="6681990">.</span><span class="ident" id="6681991">UncompressedSize</span><span class="op" id="6682007">,</span>&nbsp;<span class="builtintype" id="6682009">uint32</span><span class="op" id="6682015">(</span><span class="ident" id="6682016"><a href="/archive/zip/struct.go.html#6404490">uint32max</a></span><span class="op" id="6682025">)</span><span class="op" id="6682026">;</span>&nbsp;<span class="ident" id="6682028"><a href="/archive/zip/zip_test.go.html#6681975">got</a></span>&nbsp;<span class="op" id="6682032">!=</span>&nbsp;<span class="ident" id="6682035"><a href="/archive/zip/zip_test.go.html#6681980">want</a></span>&nbsp;<span class="op" id="6682040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682045"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6682046">.</span><span class="ident" id="6682047">Errorf</span><span class="op" id="6682053">(</span><span class="string" id="6682054">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6682084">,</span>&nbsp;<span class="ident" id="6682086"><a href="/archive/zip/zip_test.go.html#6681975">got</a></span><span class="op" id="6682089">,</span>&nbsp;<span class="ident" id="6682091"><a href="/archive/zip/zip_test.go.html#6681980">want</a></span><span class="op" id="6682095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682099">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682106">if</span>&nbsp;<span class="ident" id="6682109">got</span><span class="op" id="6682112">,</span>&nbsp;<span class="ident" id="6682114">want</span>&nbsp;<span class="op" id="6682119">:=</span>&nbsp;<span class="ident" id="6682122"><a href="/archive/zip/zip_test.go.html#6681464">f0</a></span><span class="op" id="6682124">.</span><span class="ident" id="6682125">UncompressedSize64</span><span class="op" id="6682143">,</span>&nbsp;<span class="ident" id="6682145">uint64</span><span class="op" id="6682151">(</span><span class="ident" id="6682152"><a href="/archive/zip/zip_test.go.html#6680649">size</a></span><span class="op" id="6682156">)</span><span class="op" id="6682157">+</span><span class="ident" id="6682158">uint64</span><span class="op" id="6682164">(</span><span class="builtinfunc" id="6682165">len</span><span class="op" id="6682168">(</span><span class="ident" id="6682169"><a href="/archive/zip/zip_test.go.html#6681161">end</a></span><span class="op" id="6682172">)</span><span class="op" id="6682173">)</span><span class="op" id="6682174">;</span>&nbsp;<span class="ident" id="6682176"><a href="/archive/zip/zip_test.go.html#6682109">got</a></span>&nbsp;<span class="op" id="6682180">!=</span>&nbsp;<span class="ident" id="6682183"><a href="/archive/zip/zip_test.go.html#6682114">want</a></span>&nbsp;<span class="op" id="6682188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682192"><a href="/archive/zip/zip_test.go.html#6680635">t</a></span><span class="op" id="6682193">.</span><span class="ident" id="6682194">Errorf</span><span class="op" id="6682200">(</span><span class="string" id="6682201">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6682233">,</span>&nbsp;<span class="ident" id="6682235"><a href="/archive/zip/zip_test.go.html#6682109">got</a></span><span class="op" id="6682238">,</span>&nbsp;<span class="ident" id="6682240"><a href="/archive/zip/zip_test.go.html#6682114">want</a></span><span class="op" id="6682244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682247">}</span><br>
<span class="lineno">305</span><span class="op" id="6682249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6682252">func</span>&nbsp;<span class="ident" id="6682257">testInvalidHeader</span><span class="op" id="6682274">(</span><span class="ident" id="6682275">h</span>&nbsp;<span class="op" id="6682277">*</span><span class="ident" id="6682278"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6682288">,</span>&nbsp;<span class="ident" id="6682290">t</span>&nbsp;<span class="op" id="6682292">*</span><span class="ident" id="6682293"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6682300">.</span><span class="ident" id="6682301">T</span><span class="op" id="6682302">)</span>&nbsp;<span class="op" id="6682304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682307">var</span>&nbsp;<span class="ident" id="6682311">buf</span>&nbsp;<span class="ident" id="6682315"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6682320">.</span><span class="ident" id="6682321">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682329">z</span>&nbsp;<span class="op" id="6682331">:=</span>&nbsp;<span class="ident" id="6682334"><a href="/archive/zip/writer.go.html#6411718">NewWriter</a></span><span class="op" id="6682343">(</span><span class="op" id="6682344">&amp;</span><span class="ident" id="6682345"><a href="/archive/zip/zip_test.go.html#6682311">buf</a></span><span class="op" id="6682348">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682352">f</span><span class="op" id="6682353">,</span>&nbsp;<span class="ident" id="6682355">err</span>&nbsp;<span class="op" id="6682359">:=</span>&nbsp;<span class="ident" id="6682362"><a href="/archive/zip/zip_test.go.html#6682329">z</a></span><span class="op" id="6682363">.</span><span class="ident" id="6682364">CreateHeader</span><span class="op" id="6682376">(</span><span class="ident" id="6682377"><a href="/archive/zip/zip_test.go.html#6682275">h</a></span><span class="op" id="6682378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682381">if</span>&nbsp;<span class="ident" id="6682384"><a href="/archive/zip/zip_test.go.html#6682355">err</a></span>&nbsp;<span class="op" id="6682388">!=</span>&nbsp;<span class="ident" id="6682391">nil</span>&nbsp;<span class="op" id="6682395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682399"><a href="/archive/zip/zip_test.go.html#6682290">t</a></span><span class="op" id="6682400">.</span><span class="ident" id="6682401">Fatalf</span><span class="op" id="6682407">(</span><span class="string" id="6682408">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6682435">,</span>&nbsp;<span class="ident" id="6682437"><a href="/archive/zip/zip_test.go.html#6682355">err</a></span><span class="op" id="6682440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682443">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682446">if</span>&nbsp;<span class="ident" id="6682449">_</span><span class="op" id="6682450">,</span>&nbsp;<span class="ident" id="6682452">err</span>&nbsp;<span class="op" id="6682456">:=</span>&nbsp;<span class="ident" id="6682459"><a href="/archive/zip/zip_test.go.html#6682352">f</a></span><span class="op" id="6682460">.</span><span class="ident" id="6682461">Write</span><span class="op" id="6682466">(</span><span class="op" id="6682467">[</span><span class="op" id="6682468">]</span><span class="builtintype" id="6682469">byte</span><span class="op" id="6682473">(</span><span class="string" id="6682474">&#34;hi&#34;</span><span class="op" id="6682478">)</span><span class="op" id="6682479">)</span><span class="op" id="6682480">;</span>&nbsp;<span class="ident" id="6682482"><a href="/archive/zip/zip_test.go.html#6682452">err</a></span>&nbsp;<span class="op" id="6682486">!=</span>&nbsp;<span class="ident" id="6682489">nil</span>&nbsp;<span class="op" id="6682493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682497"><a href="/archive/zip/zip_test.go.html#6682290">t</a></span><span class="op" id="6682498">.</span><span class="ident" id="6682499">Fatalf</span><span class="op" id="6682505">(</span><span class="string" id="6682506">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6682533">,</span>&nbsp;<span class="ident" id="6682535"><a href="/archive/zip/zip_test.go.html#6682452">err</a></span><span class="op" id="6682538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682544">if</span>&nbsp;<span class="ident" id="6682547">err</span>&nbsp;<span class="op" id="6682551">:=</span>&nbsp;<span class="ident" id="6682554"><a href="/archive/zip/zip_test.go.html#6682329">z</a></span><span class="op" id="6682555">.</span><span class="ident" id="6682556">Close</span><span class="op" id="6682561">(</span><span class="op" id="6682562">)</span><span class="op" id="6682563">;</span>&nbsp;<span class="ident" id="6682565"><a href="/archive/zip/zip_test.go.html#6682547">err</a></span>&nbsp;<span class="op" id="6682569">!=</span>&nbsp;<span class="ident" id="6682572">nil</span>&nbsp;<span class="op" id="6682576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682580"><a href="/archive/zip/zip_test.go.html#6682290">t</a></span><span class="op" id="6682581">.</span><span class="ident" id="6682582">Fatalf</span><span class="op" id="6682588">(</span><span class="string" id="6682589">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6682619">,</span>&nbsp;<span class="ident" id="6682621"><a href="/archive/zip/zip_test.go.html#6682547">err</a></span><span class="op" id="6682624">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682631">b</span>&nbsp;<span class="op" id="6682633">:=</span>&nbsp;<span class="ident" id="6682636"><a href="/archive/zip/zip_test.go.html#6682311">buf</a></span><span class="op" id="6682639">.</span><span class="ident" id="6682640">Bytes</span><span class="op" id="6682645">(</span><span class="op" id="6682646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682649">if</span>&nbsp;<span class="ident" id="6682652">_</span><span class="op" id="6682653">,</span>&nbsp;<span class="ident" id="6682655"><a href="/archive/zip/zip_test.go.html#6682355">err</a></span>&nbsp;<span class="op" id="6682659">=</span>&nbsp;<span class="ident" id="6682661"><a href="/archive/zip/reader.go.html#6388809">NewReader</a></span><span class="op" id="6682670">(</span><span class="ident" id="6682671"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6682676">.</span><span class="ident" id="6682677">NewReader</span><span class="op" id="6682686">(</span><span class="ident" id="6682687"><a href="/archive/zip/zip_test.go.html#6682631">b</a></span><span class="op" id="6682688">)</span><span class="op" id="6682689">,</span>&nbsp;<span class="ident" id="6682691">int64</span><span class="op" id="6682696">(</span><span class="builtinfunc" id="6682697">len</span><span class="op" id="6682700">(</span><span class="ident" id="6682701"><a href="/archive/zip/zip_test.go.html#6682631">b</a></span><span class="op" id="6682702">)</span><span class="op" id="6682703">)</span><span class="op" id="6682704">)</span><span class="op" id="6682705">;</span>&nbsp;<span class="ident" id="6682707"><a href="/archive/zip/zip_test.go.html#6682355">err</a></span>&nbsp;<span class="op" id="6682711">!=</span>&nbsp;<span class="ident" id="6682714"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span>&nbsp;<span class="op" id="6682724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682728"><a href="/archive/zip/zip_test.go.html#6682290">t</a></span><span class="op" id="6682729">.</span><span class="ident" id="6682730">Fatalf</span><span class="op" id="6682736">(</span><span class="string" id="6682737">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="6682765">,</span>&nbsp;<span class="ident" id="6682767"><a href="/archive/zip/zip_test.go.html#6682355">err</a></span><span class="op" id="6682770">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682773">}</span><br>
<span class="lineno"></span><span class="op" id="6682775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6682778">func</span>&nbsp;<span class="ident" id="6682783">testValidHeader</span><span class="op" id="6682798">(</span><span class="ident" id="6682799">h</span>&nbsp;<span class="op" id="6682801">*</span><span class="ident" id="6682802"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6682812">,</span>&nbsp;<span class="ident" id="6682814">t</span>&nbsp;<span class="op" id="6682816">*</span><span class="ident" id="6682817"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6682824">.</span><span class="ident" id="6682825">T</span><span class="op" id="6682826">)</span>&nbsp;<span class="op" id="6682828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682831">var</span>&nbsp;<span class="ident" id="6682835">buf</span>&nbsp;<span class="ident" id="6682839"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6682844">.</span><span class="ident" id="6682845">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682853">z</span>&nbsp;<span class="op" id="6682855">:=</span>&nbsp;<span class="ident" id="6682858"><a href="/archive/zip/writer.go.html#6411718">NewWriter</a></span><span class="op" id="6682867">(</span><span class="op" id="6682868">&amp;</span><span class="ident" id="6682869"><a href="/archive/zip/zip_test.go.html#6682835">buf</a></span><span class="op" id="6682872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682876">f</span><span class="op" id="6682877">,</span>&nbsp;<span class="ident" id="6682879">err</span>&nbsp;<span class="op" id="6682883">:=</span>&nbsp;<span class="ident" id="6682886"><a href="/archive/zip/zip_test.go.html#6682853">z</a></span><span class="op" id="6682887">.</span><span class="ident" id="6682888">CreateHeader</span><span class="op" id="6682900">(</span><span class="ident" id="6682901"><a href="/archive/zip/zip_test.go.html#6682799">h</a></span><span class="op" id="6682902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682905">if</span>&nbsp;<span class="ident" id="6682908"><a href="/archive/zip/zip_test.go.html#6682879">err</a></span>&nbsp;<span class="op" id="6682912">!=</span>&nbsp;<span class="ident" id="6682915">nil</span>&nbsp;<span class="op" id="6682919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682923"><a href="/archive/zip/zip_test.go.html#6682814">t</a></span><span class="op" id="6682924">.</span><span class="ident" id="6682925">Fatalf</span><span class="op" id="6682931">(</span><span class="string" id="6682932">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6682959">,</span>&nbsp;<span class="ident" id="6682961"><a href="/archive/zip/zip_test.go.html#6682879">err</a></span><span class="op" id="6682964">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682970">if</span>&nbsp;<span class="ident" id="6682973">_</span><span class="op" id="6682974">,</span>&nbsp;<span class="ident" id="6682976">err</span>&nbsp;<span class="op" id="6682980">:=</span>&nbsp;<span class="ident" id="6682983"><a href="/archive/zip/zip_test.go.html#6682876">f</a></span><span class="op" id="6682984">.</span><span class="ident" id="6682985">Write</span><span class="op" id="6682990">(</span><span class="op" id="6682991">[</span><span class="op" id="6682992">]</span><span class="builtintype" id="6682993">byte</span><span class="op" id="6682997">(</span><span class="string" id="6682998">&#34;hi&#34;</span><span class="op" id="6683002">)</span><span class="op" id="6683003">)</span><span class="op" id="6683004">;</span>&nbsp;<span class="ident" id="6683006"><a href="/archive/zip/zip_test.go.html#6682976">err</a></span>&nbsp;<span class="op" id="6683010">!=</span>&nbsp;<span class="ident" id="6683013">nil</span>&nbsp;<span class="op" id="6683017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683021"><a href="/archive/zip/zip_test.go.html#6682814">t</a></span><span class="op" id="6683022">.</span><span class="ident" id="6683023">Fatalf</span><span class="op" id="6683029">(</span><span class="string" id="6683030">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6683057">,</span>&nbsp;<span class="ident" id="6683059"><a href="/archive/zip/zip_test.go.html#6682976">err</a></span><span class="op" id="6683062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683068">if</span>&nbsp;<span class="ident" id="6683071">err</span>&nbsp;<span class="op" id="6683075">:=</span>&nbsp;<span class="ident" id="6683078"><a href="/archive/zip/zip_test.go.html#6682853">z</a></span><span class="op" id="6683079">.</span><span class="ident" id="6683080">Close</span><span class="op" id="6683085">(</span><span class="op" id="6683086">)</span><span class="op" id="6683087">;</span>&nbsp;<span class="ident" id="6683089"><a href="/archive/zip/zip_test.go.html#6683071">err</a></span>&nbsp;<span class="op" id="6683093">!=</span>&nbsp;<span class="ident" id="6683096">nil</span>&nbsp;<span class="op" id="6683100">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683104"><a href="/archive/zip/zip_test.go.html#6682814">t</a></span><span class="op" id="6683105">.</span><span class="ident" id="6683106">Fatalf</span><span class="op" id="6683112">(</span><span class="string" id="6683113">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6683143">,</span>&nbsp;<span class="ident" id="6683145"><a href="/archive/zip/zip_test.go.html#6683071">err</a></span><span class="op" id="6683148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683155">b</span>&nbsp;<span class="op" id="6683157">:=</span>&nbsp;<span class="ident" id="6683160"><a href="/archive/zip/zip_test.go.html#6682835">buf</a></span><span class="op" id="6683163">.</span><span class="ident" id="6683164">Bytes</span><span class="op" id="6683169">(</span><span class="op" id="6683170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683173">if</span>&nbsp;<span class="ident" id="6683176">_</span><span class="op" id="6683177">,</span>&nbsp;<span class="ident" id="6683179"><a href="/archive/zip/zip_test.go.html#6682879">err</a></span>&nbsp;<span class="op" id="6683183">=</span>&nbsp;<span class="ident" id="6683185"><a href="/archive/zip/reader.go.html#6388809">NewReader</a></span><span class="op" id="6683194">(</span><span class="ident" id="6683195"><a href="/archive/zip/zip_test.go.html#6675255">bytes</a></span><span class="op" id="6683200">.</span><span class="ident" id="6683201">NewReader</span><span class="op" id="6683210">(</span><span class="ident" id="6683211"><a href="/archive/zip/zip_test.go.html#6683155">b</a></span><span class="op" id="6683212">)</span><span class="op" id="6683213">,</span>&nbsp;<span class="ident" id="6683215">int64</span><span class="op" id="6683220">(</span><span class="builtinfunc" id="6683221">len</span><span class="op" id="6683224">(</span><span class="ident" id="6683225"><a href="/archive/zip/zip_test.go.html#6683155">b</a></span><span class="op" id="6683226">)</span><span class="op" id="6683227">)</span><span class="op" id="6683228">)</span><span class="op" id="6683229">;</span>&nbsp;<span class="ident" id="6683231"><a href="/archive/zip/zip_test.go.html#6682879">err</a></span>&nbsp;<span class="op" id="6683235">!=</span>&nbsp;<span class="ident" id="6683238">nil</span>&nbsp;<span class="op" id="6683242">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683246"><a href="/archive/zip/zip_test.go.html#6682814">t</a></span><span class="op" id="6683247">.</span><span class="ident" id="6683248">Fatalf</span><span class="op" id="6683254">(</span><span class="string" id="6683255">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="6683277">,</span>&nbsp;<span class="ident" id="6683279"><a href="/archive/zip/zip_test.go.html#6682879">err</a></span><span class="op" id="6683282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683285">}</span><br>
<span class="lineno"></span><span class="op" id="6683287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6683290">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="6683305">func</span>&nbsp;<span class="ident" id="6683310">TestHeaderInvalidTagAndSize</span><span class="op" id="6683337">(</span><span class="ident" id="6683338">t</span>&nbsp;<span class="op" id="6683340">*</span><span class="ident" id="6683341"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6683348">.</span><span class="ident" id="6683349">T</span><span class="op" id="6683350">)</span>&nbsp;<span class="op" id="6683352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683355">const</span>&nbsp;<span class="ident" id="6683361">timeFormat</span>&nbsp;<span class="op" id="6683372">=</span>&nbsp;<span class="string" id="6683374">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683402">ts</span>&nbsp;<span class="op" id="6683405">:=</span>&nbsp;<span class="ident" id="6683408"><a href="/archive/zip/zip_test.go.html#6675328">time</a></span><span class="op" id="6683412">.</span><span class="ident" id="6683413">Now</span><span class="op" id="6683416">(</span><span class="op" id="6683417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683420">filename</span>&nbsp;<span class="op" id="6683429">:=</span>&nbsp;<span class="ident" id="6683432"><a href="/archive/zip/zip_test.go.html#6683402">ts</a></span><span class="op" id="6683434">.</span><span class="ident" id="6683435">Format</span><span class="op" id="6683441">(</span><span class="ident" id="6683442"><a href="/archive/zip/zip_test.go.html#6683361">timeFormat</a></span><span class="op" id="6683452">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683456">h</span>&nbsp;<span class="op" id="6683458">:=</span>&nbsp;<span class="ident" id="6683461"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6683471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683475">Name</span><span class="op" id="6683479">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6683483"><a href="/archive/zip/zip_test.go.html#6683420">filename</a></span><span class="op" id="6683491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683495">Method</span><span class="op" id="6683501">:</span>&nbsp;<span class="ident" id="6683503"><a href="/archive/zip/struct.go.html#6403410">Deflate</a></span><span class="op" id="6683510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683514">Extra</span><span class="op" id="6683519">:</span>&nbsp;&nbsp;<span class="op" id="6683522">[</span><span class="op" id="6683523">]</span><span class="builtintype" id="6683524">byte</span><span class="op" id="6683528">(</span><span class="ident" id="6683529"><a href="/archive/zip/zip_test.go.html#6683402">ts</a></span><span class="op" id="6683531">.</span><span class="ident" id="6683532">Format</span><span class="op" id="6683538">(</span><span class="ident" id="6683539"><a href="/archive/zip/zip_test.go.html#6675328">time</a></span><span class="op" id="6683543">.</span><span class="ident" id="6683544">RFC3339Nano</span><span class="op" id="6683555">)</span><span class="op" id="6683556">)</span><span class="op" id="6683557">,</span>&nbsp;<span class="comment" id="6683559">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683586"><a href="/archive/zip/zip_test.go.html#6683456">h</a></span><span class="op" id="6683587">.</span><span class="ident" id="6683588">SetModTime</span><span class="op" id="6683598">(</span><span class="ident" id="6683599"><a href="/archive/zip/zip_test.go.html#6683402">ts</a></span><span class="op" id="6683601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683605"><a href="/archive/zip/zip_test.go.html#6682257">testInvalidHeader</a></span><span class="op" id="6683622">(</span><span class="op" id="6683623">&amp;</span><span class="ident" id="6683624"><a href="/archive/zip/zip_test.go.html#6683456">h</a></span><span class="op" id="6683625">,</span>&nbsp;<span class="ident" id="6683627"><a href="/archive/zip/zip_test.go.html#6683338">t</a></span><span class="op" id="6683628">)</span><br>
<span class="lineno"></span><span class="op" id="6683630">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6683633">func</span>&nbsp;<span class="ident" id="6683638">TestHeaderTooShort</span><span class="op" id="6683656">(</span><span class="ident" id="6683657">t</span>&nbsp;<span class="op" id="6683659">*</span><span class="ident" id="6683660"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6683667">.</span><span class="ident" id="6683668">T</span><span class="op" id="6683669">)</span>&nbsp;<span class="op" id="6683671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683674">h</span>&nbsp;<span class="op" id="6683676">:=</span>&nbsp;<span class="ident" id="6683679"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6683689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683693">Name</span><span class="op" id="6683697">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6683701">&#34;foo.txt&#34;</span><span class="op" id="6683710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683714">Method</span><span class="op" id="6683720">:</span>&nbsp;<span class="ident" id="6683722"><a href="/archive/zip/struct.go.html#6403410">Deflate</a></span><span class="op" id="6683729">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683733">Extra</span><span class="op" id="6683738">:</span>&nbsp;&nbsp;<span class="op" id="6683741">[</span><span class="op" id="6683742">]</span><span class="builtintype" id="6683743">byte</span><span class="op" id="6683747">{</span><span class="ident" id="6683748"><a href="/archive/zip/struct.go.html#6404540">zip64ExtraId</a></span><span class="op" id="6683760">}</span><span class="op" id="6683761">,</span>&nbsp;<span class="comment" id="6683763">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683783"><a href="/archive/zip/zip_test.go.html#6682257">testInvalidHeader</a></span><span class="op" id="6683800">(</span><span class="op" id="6683801">&amp;</span><span class="ident" id="6683802"><a href="/archive/zip/zip_test.go.html#6683674">h</a></span><span class="op" id="6683803">,</span>&nbsp;<span class="ident" id="6683805"><a href="/archive/zip/zip_test.go.html#6683657">t</a></span><span class="op" id="6683806">)</span><br>
<span class="lineno"></span><span class="op" id="6683808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="6683811">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6683867">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6683894">func</span>&nbsp;<span class="ident" id="6683899">TestZeroLengthHeader</span><span class="op" id="6683919">(</span><span class="ident" id="6683920">t</span>&nbsp;<span class="op" id="6683922">*</span><span class="ident" id="6683923"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6683930">.</span><span class="ident" id="6683931">T</span><span class="op" id="6683932">)</span>&nbsp;<span class="op" id="6683934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683937">h</span>&nbsp;<span class="op" id="6683939">:=</span>&nbsp;<span class="ident" id="6683942"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><span class="op" id="6683952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683956">Name</span><span class="op" id="6683960">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6683964">&#34;extadata.txt&#34;</span><span class="op" id="6683978">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683982">Method</span><span class="op" id="6683988">:</span>&nbsp;<span class="ident" id="6683990"><a href="/archive/zip/struct.go.html#6403410">Deflate</a></span><span class="op" id="6683997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684001">Extra</span><span class="op" id="6684006">:</span>&nbsp;<span class="op" id="6684008">[</span><span class="op" id="6684009">]</span><span class="builtintype" id="6684010">byte</span><span class="op" id="6684014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6684019">85</span><span class="op" id="6684021">,</span>&nbsp;<span class="num" id="6684023">84</span><span class="op" id="6684025">,</span>&nbsp;<span class="num" id="6684027">5</span><span class="op" id="6684028">,</span>&nbsp;<span class="num" id="6684030">0</span><span class="op" id="6684031">,</span>&nbsp;<span class="num" id="6684033">3</span><span class="op" id="6684034">,</span>&nbsp;<span class="num" id="6684036">154</span><span class="op" id="6684039">,</span>&nbsp;<span class="num" id="6684041">144</span><span class="op" id="6684044">,</span>&nbsp;<span class="num" id="6684046">195</span><span class="op" id="6684049">,</span>&nbsp;<span class="num" id="6684051">77</span><span class="op" id="6684053">,</span>&nbsp;<span class="comment" id="6684055">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6684078">85</span><span class="op" id="6684080">,</span>&nbsp;<span class="num" id="6684082">120</span><span class="op" id="6684085">,</span>&nbsp;<span class="num" id="6684087">0</span><span class="op" id="6684088">,</span>&nbsp;<span class="num" id="6684090">0</span><span class="op" id="6684091">,</span>&nbsp;<span class="comment" id="6684093">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6684115">}</span><span class="op" id="6684116">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6684119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684122"><a href="/archive/zip/zip_test.go.html#6682783">testValidHeader</a></span><span class="op" id="6684137">(</span><span class="op" id="6684138">&amp;</span><span class="ident" id="6684139"><a href="/archive/zip/zip_test.go.html#6683937">h</a></span><span class="op" id="6684140">,</span>&nbsp;<span class="ident" id="6684142"><a href="/archive/zip/zip_test.go.html#6683920">t</a></span><span class="op" id="6684143">)</span><br>
<span class="lineno"></span><span class="op" id="6684145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6684148">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="6684218">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="6684289">func</span>&nbsp;<span class="ident" id="6684294">BenchmarkZip64Test</span><span class="op" id="6684312">(</span><span class="ident" id="6684313">b</span>&nbsp;<span class="op" id="6684315">*</span><span class="ident" id="6684316"><a href="/archive/zip/zip_test.go.html#6675317">testing</a></span><span class="op" id="6684323">.</span><span class="ident" id="6684324">B</span><span class="op" id="6684325">)</span>&nbsp;<span class="op" id="6684327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6684330">for</span>&nbsp;<span class="ident" id="6684334">i</span>&nbsp;<span class="op" id="6684336">:=</span>&nbsp;<span class="num" id="6684339">0</span><span class="op" id="6684340">;</span>&nbsp;<span class="ident" id="6684342"><a href="/archive/zip/zip_test.go.html#6684334">i</a></span>&nbsp;<span class="op" id="6684344">&lt;</span>&nbsp;<span class="ident" id="6684346"><a href="/archive/zip/zip_test.go.html#6684313">b</a></span><span class="op" id="6684347">.</span><span class="ident" id="6684348">N</span><span class="op" id="6684349">;</span>&nbsp;<span class="ident" id="6684351"><a href="/archive/zip/zip_test.go.html#6684334">i</a></span><span class="op" id="6684352">++</span>&nbsp;<span class="op" id="6684355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684359"><a href="/archive/zip/zip_test.go.html#6680625">testZip64</a></span><span class="op" id="6684368">(</span><span class="ident" id="6684369"><a href="/archive/zip/zip_test.go.html#6684313">b</a></span><span class="op" id="6684370">,</span>&nbsp;<span class="num" id="6684372">1</span><span class="op" id="6684373">&lt;&lt;</span><span class="num" id="6684375">26</span><span class="op" id="6684377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6684380">}</span><br>
<span class="lineno">395</span><span class="op" id="6684382">}</span>
</div>
</body>
</html>
