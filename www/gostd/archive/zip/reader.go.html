<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4207141">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4207196">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4207250">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4207301">package</span>&nbsp;<span class="ident" id="4207309">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4207314">import</span>&nbsp;<span class="op" id="4207321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207324">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207333">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207352">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207362">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207370">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207384">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4207390">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4207395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4207398">var</span>&nbsp;<span class="op" id="4207402">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207405">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207418">=</span>&nbsp;<span class="ident" id="4207420">errors</span><span class="op" id="4207426">.</span><span class="ident" id="4207427">New</span><span class="op" id="4207430">(</span><span class="string" id="4207431">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="4207458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207461">ErrAlgorithm</span>&nbsp;<span class="op" id="4207474">=</span>&nbsp;<span class="ident" id="4207476">errors</span><span class="op" id="4207482">.</span><span class="ident" id="4207483">New</span><span class="op" id="4207486">(</span><span class="string" id="4207487">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="4207527">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207530">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="4207543">=</span>&nbsp;<span class="ident" id="4207545">errors</span><span class="op" id="4207551">.</span><span class="ident" id="4207552">New</span><span class="op" id="4207555">(</span><span class="string" id="4207556">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="4207577">)</span><br>
<span class="lineno"></span><span class="op" id="4207579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4207582">type</span>&nbsp;<span class="ident" id="4207587">Reader</span>&nbsp;<span class="keyword" id="4207594">struct</span>&nbsp;<span class="op" id="4207601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207604">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207612">io</span><span class="op" id="4207614">.</span><span class="ident" id="4207615">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207625">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207633">[</span><span class="op" id="4207634">]</span><span class="op" id="4207635">*</span><span class="ident" id="4207636">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207642">Comment</span>&nbsp;<span class="builtintype" id="4207650">string</span><br>
<span class="lineno"></span><span class="op" id="4207657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4207660">type</span>&nbsp;<span class="ident" id="4207665">ReadCloser</span>&nbsp;<span class="keyword" id="4207676">struct</span>&nbsp;<span class="op" id="4207683">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207686">f</span>&nbsp;<span class="op" id="4207688">*</span><span class="ident" id="4207689">os</span><span class="op" id="4207691">.</span><span class="ident" id="4207692">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207698">Reader</span><br>
<span class="lineno"></span><span class="op" id="4207705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4207708">type</span>&nbsp;<span class="ident" id="4207713">File</span>&nbsp;<span class="keyword" id="4207718">struct</span>&nbsp;<span class="op" id="4207725">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207728">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207740">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207753">io</span><span class="op" id="4207755">.</span><span class="ident" id="4207756">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207766">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207779">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207786">headerOffset</span>&nbsp;<span class="ident" id="4207799">int64</span><br>
<span class="lineno"></span><span class="op" id="4207805">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4207808">func</span>&nbsp;<span class="op" id="4207813">(</span><span class="ident" id="4207814">f</span>&nbsp;<span class="op" id="4207816">*</span><span class="ident" id="4207817">File</span><span class="op" id="4207821">)</span>&nbsp;<span class="ident" id="4207823">hasDataDescriptor</span><span class="op" id="4207840">(</span><span class="op" id="4207841">)</span>&nbsp;<span class="builtintype" id="4207843">bool</span>&nbsp;<span class="op" id="4207848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207851">return</span>&nbsp;<span class="ident" id="4207858">f</span><span class="op" id="4207859">.</span><span class="ident" id="4207860">Flags</span><span class="op" id="4207865">&amp;</span><span class="num" id="4207866">0x8</span>&nbsp;<span class="op" id="4207870">!=</span>&nbsp;<span class="num" id="4207873">0</span><br>
<span class="lineno"></span><span class="op" id="4207875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4207878">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="4207958">func</span>&nbsp;<span class="ident" id="4207963">OpenReader</span><span class="op" id="4207973">(</span><span class="ident" id="4207974">name</span>&nbsp;<span class="builtintype" id="4207979">string</span><span class="op" id="4207985">)</span>&nbsp;<span class="op" id="4207987">(</span><span class="op" id="4207988">*</span><span class="ident" id="4207989">ReadCloser</span><span class="op" id="4207999">,</span>&nbsp;<span class="builtintype" id="4208001">error</span><span class="op" id="4208006">)</span>&nbsp;<span class="op" id="4208008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208011">f</span><span class="op" id="4208012">,</span>&nbsp;<span class="ident" id="4208014">err</span>&nbsp;<span class="op" id="4208018">:=</span>&nbsp;<span class="ident" id="4208021">os</span><span class="op" id="4208023">.</span><span class="ident" id="4208024">Open</span><span class="op" id="4208028">(</span><span class="ident" id="4208029">name</span><span class="op" id="4208033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208036">if</span>&nbsp;<span class="ident" id="4208039">err</span>&nbsp;<span class="op" id="4208043">!=</span>&nbsp;<span class="ident" id="4208046">nil</span>&nbsp;<span class="op" id="4208050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208054">return</span>&nbsp;<span class="ident" id="4208061">nil</span><span class="op" id="4208064">,</span>&nbsp;<span class="ident" id="4208066">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208074">fi</span><span class="op" id="4208076">,</span>&nbsp;<span class="ident" id="4208078">err</span>&nbsp;<span class="op" id="4208082">:=</span>&nbsp;<span class="ident" id="4208085">f</span><span class="op" id="4208086">.</span><span class="ident" id="4208087">Stat</span><span class="op" id="4208091">(</span><span class="op" id="4208092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208095">if</span>&nbsp;<span class="ident" id="4208098">err</span>&nbsp;<span class="op" id="4208102">!=</span>&nbsp;<span class="ident" id="4208105">nil</span>&nbsp;<span class="op" id="4208109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208113">f</span><span class="op" id="4208114">.</span><span class="ident" id="4208115">Close</span><span class="op" id="4208120">(</span><span class="op" id="4208121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208125">return</span>&nbsp;<span class="ident" id="4208132">nil</span><span class="op" id="4208135">,</span>&nbsp;<span class="ident" id="4208137">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208145">r</span>&nbsp;<span class="op" id="4208147">:=</span>&nbsp;<span class="builtinfunc" id="4208150">new</span><span class="op" id="4208153">(</span><span class="ident" id="4208154">ReadCloser</span><span class="op" id="4208164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208167">if</span>&nbsp;<span class="ident" id="4208170">err</span>&nbsp;<span class="op" id="4208174">:=</span>&nbsp;<span class="ident" id="4208177">r</span><span class="op" id="4208178">.</span><span class="ident" id="4208179">init</span><span class="op" id="4208183">(</span><span class="ident" id="4208184">f</span><span class="op" id="4208185">,</span>&nbsp;<span class="ident" id="4208187">fi</span><span class="op" id="4208189">.</span><span class="ident" id="4208190">Size</span><span class="op" id="4208194">(</span><span class="op" id="4208195">)</span><span class="op" id="4208196">)</span><span class="op" id="4208197">;</span>&nbsp;<span class="ident" id="4208199">err</span>&nbsp;<span class="op" id="4208203">!=</span>&nbsp;<span class="ident" id="4208206">nil</span>&nbsp;<span class="op" id="4208210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208214">f</span><span class="op" id="4208215">.</span><span class="ident" id="4208216">Close</span><span class="op" id="4208221">(</span><span class="op" id="4208222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208226">return</span>&nbsp;<span class="ident" id="4208233">nil</span><span class="op" id="4208236">,</span>&nbsp;<span class="ident" id="4208238">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208246">r</span><span class="op" id="4208247">.</span><span class="ident" id="4208248">f</span>&nbsp;<span class="op" id="4208250">=</span>&nbsp;<span class="ident" id="4208252">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208255">return</span>&nbsp;<span class="ident" id="4208262">r</span><span class="op" id="4208263">,</span>&nbsp;<span class="ident" id="4208265">nil</span><br>
<span class="lineno"></span><span class="op" id="4208269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4208272">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4208342">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4208375">func</span>&nbsp;<span class="ident" id="4208380">NewReader</span><span class="op" id="4208389">(</span><span class="ident" id="4208390">r</span>&nbsp;<span class="ident" id="4208392">io</span><span class="op" id="4208394">.</span><span class="ident" id="4208395">ReaderAt</span><span class="op" id="4208403">,</span>&nbsp;<span class="ident" id="4208405">size</span>&nbsp;<span class="ident" id="4208410">int64</span><span class="op" id="4208415">)</span>&nbsp;<span class="op" id="4208417">(</span><span class="op" id="4208418">*</span><span class="ident" id="4208419">Reader</span><span class="op" id="4208425">,</span>&nbsp;<span class="builtintype" id="4208427">error</span><span class="op" id="4208432">)</span>&nbsp;<span class="op" id="4208434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208437">zr</span>&nbsp;<span class="op" id="4208440">:=</span>&nbsp;<span class="builtinfunc" id="4208443">new</span><span class="op" id="4208446">(</span><span class="ident" id="4208447">Reader</span><span class="op" id="4208453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208456">if</span>&nbsp;<span class="ident" id="4208459">err</span>&nbsp;<span class="op" id="4208463">:=</span>&nbsp;<span class="ident" id="4208466">zr</span><span class="op" id="4208468">.</span><span class="ident" id="4208469">init</span><span class="op" id="4208473">(</span><span class="ident" id="4208474">r</span><span class="op" id="4208475">,</span>&nbsp;<span class="ident" id="4208477">size</span><span class="op" id="4208481">)</span><span class="op" id="4208482">;</span>&nbsp;<span class="ident" id="4208484">err</span>&nbsp;<span class="op" id="4208488">!=</span>&nbsp;<span class="ident" id="4208491">nil</span>&nbsp;<span class="op" id="4208495">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208499">return</span>&nbsp;<span class="ident" id="4208506">nil</span><span class="op" id="4208509">,</span>&nbsp;<span class="ident" id="4208511">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208519">return</span>&nbsp;<span class="ident" id="4208526">zr</span><span class="op" id="4208528">,</span>&nbsp;<span class="ident" id="4208530">nil</span><br>
<span class="lineno"></span><span class="op" id="4208534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="4208537">func</span>&nbsp;<span class="op" id="4208542">(</span><span class="ident" id="4208543">z</span>&nbsp;<span class="op" id="4208545">*</span><span class="ident" id="4208546">Reader</span><span class="op" id="4208552">)</span>&nbsp;<span class="ident" id="4208554">init</span><span class="op" id="4208558">(</span><span class="ident" id="4208559">r</span>&nbsp;<span class="ident" id="4208561">io</span><span class="op" id="4208563">.</span><span class="ident" id="4208564">ReaderAt</span><span class="op" id="4208572">,</span>&nbsp;<span class="ident" id="4208574">size</span>&nbsp;<span class="ident" id="4208579">int64</span><span class="op" id="4208584">)</span>&nbsp;<span class="builtintype" id="4208586">error</span>&nbsp;<span class="op" id="4208592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208595">end</span><span class="op" id="4208598">,</span>&nbsp;<span class="ident" id="4208600">err</span>&nbsp;<span class="op" id="4208604">:=</span>&nbsp;<span class="ident" id="4208607">readDirectoryEnd</span><span class="op" id="4208623">(</span><span class="ident" id="4208624">r</span><span class="op" id="4208625">,</span>&nbsp;<span class="ident" id="4208627">size</span><span class="op" id="4208631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208634">if</span>&nbsp;<span class="ident" id="4208637">err</span>&nbsp;<span class="op" id="4208641">!=</span>&nbsp;<span class="ident" id="4208644">nil</span>&nbsp;<span class="op" id="4208648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208652">return</span>&nbsp;<span class="ident" id="4208659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208664">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208667">z</span><span class="op" id="4208668">.</span><span class="ident" id="4208669">r</span>&nbsp;<span class="op" id="4208671">=</span>&nbsp;<span class="ident" id="4208673">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208676">z</span><span class="op" id="4208677">.</span><span class="ident" id="4208678">File</span>&nbsp;<span class="op" id="4208683">=</span>&nbsp;<span class="builtinfunc" id="4208685">make</span><span class="op" id="4208689">(</span><span class="op" id="4208690">[</span><span class="op" id="4208691">]</span><span class="op" id="4208692">*</span><span class="ident" id="4208693">File</span><span class="op" id="4208697">,</span>&nbsp;<span class="num" id="4208699">0</span><span class="op" id="4208700">,</span>&nbsp;<span class="ident" id="4208702">end</span><span class="op" id="4208705">.</span><span class="ident" id="4208706">directoryRecords</span><span class="op" id="4208722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208725">z</span><span class="op" id="4208726">.</span><span class="ident" id="4208727">Comment</span>&nbsp;<span class="op" id="4208735">=</span>&nbsp;<span class="ident" id="4208737">end</span><span class="op" id="4208740">.</span><span class="ident" id="4208741">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208750">rs</span>&nbsp;<span class="op" id="4208753">:=</span>&nbsp;<span class="ident" id="4208756">io</span><span class="op" id="4208758">.</span><span class="ident" id="4208759">NewSectionReader</span><span class="op" id="4208775">(</span><span class="ident" id="4208776">r</span><span class="op" id="4208777">,</span>&nbsp;<span class="num" id="4208779">0</span><span class="op" id="4208780">,</span>&nbsp;<span class="ident" id="4208782">size</span><span class="op" id="4208786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208789">if</span>&nbsp;<span class="ident" id="4208792">_</span><span class="op" id="4208793">,</span>&nbsp;<span class="ident" id="4208795">err</span>&nbsp;<span class="op" id="4208799">=</span>&nbsp;<span class="ident" id="4208801">rs</span><span class="op" id="4208803">.</span><span class="ident" id="4208804">Seek</span><span class="op" id="4208808">(</span><span class="ident" id="4208809">int64</span><span class="op" id="4208814">(</span><span class="ident" id="4208815">end</span><span class="op" id="4208818">.</span><span class="ident" id="4208819">directoryOffset</span><span class="op" id="4208834">)</span><span class="op" id="4208835">,</span>&nbsp;<span class="ident" id="4208837">os</span><span class="op" id="4208839">.</span><span class="ident" id="4208840">SEEK_SET</span><span class="op" id="4208848">)</span><span class="op" id="4208849">;</span>&nbsp;<span class="ident" id="4208851">err</span>&nbsp;<span class="op" id="4208855">!=</span>&nbsp;<span class="ident" id="4208858">nil</span>&nbsp;<span class="op" id="4208862">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208866">return</span>&nbsp;<span class="ident" id="4208873">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208881">buf</span>&nbsp;<span class="op" id="4208885">:=</span>&nbsp;<span class="ident" id="4208888">bufio</span><span class="op" id="4208893">.</span><span class="ident" id="4208894">NewReader</span><span class="op" id="4208903">(</span><span class="ident" id="4208904">rs</span><span class="op" id="4208906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4208910">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4208979">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4209037">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4209105">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209151">for</span>&nbsp;<span class="op" id="4209155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4209159">f</span>&nbsp;<span class="op" id="4209161">:=</span>&nbsp;<span class="op" id="4209164">&amp;</span><span class="ident" id="4209165">File</span><span class="op" id="4209169">{</span><span class="ident" id="4209170">zipr</span><span class="op" id="4209174">:</span>&nbsp;<span class="ident" id="4209176">r</span><span class="op" id="4209177">,</span>&nbsp;<span class="ident" id="4209179">zipsize</span><span class="op" id="4209186">:</span>&nbsp;<span class="ident" id="4209188">size</span><span class="op" id="4209192">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4209196">err</span>&nbsp;<span class="op" id="4209200">=</span>&nbsp;<span class="ident" id="4209202">readDirectoryHeader</span><span class="op" id="4209221">(</span><span class="ident" id="4209222">f</span><span class="op" id="4209223">,</span>&nbsp;<span class="ident" id="4209225">buf</span><span class="op" id="4209228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209232">if</span>&nbsp;<span class="ident" id="4209235">err</span>&nbsp;<span class="op" id="4209239">==</span>&nbsp;<span class="ident" id="4209242">ErrFormat</span>&nbsp;<span class="op" id="4209252">||</span>&nbsp;<span class="ident" id="4209255">err</span>&nbsp;<span class="op" id="4209259">==</span>&nbsp;<span class="ident" id="4209262">io</span><span class="op" id="4209264">.</span><span class="ident" id="4209265">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="4209282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209287">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209299">if</span>&nbsp;<span class="ident" id="4209302">err</span>&nbsp;<span class="op" id="4209306">!=</span>&nbsp;<span class="ident" id="4209309">nil</span>&nbsp;<span class="op" id="4209313">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209318">return</span>&nbsp;<span class="ident" id="4209325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4209335">z</span><span class="op" id="4209336">.</span><span class="ident" id="4209337">File</span>&nbsp;<span class="op" id="4209342">=</span>&nbsp;<span class="builtinfunc" id="4209344">append</span><span class="op" id="4209350">(</span><span class="ident" id="4209351">z</span><span class="op" id="4209352">.</span><span class="ident" id="4209353">File</span><span class="op" id="4209357">,</span>&nbsp;<span class="ident" id="4209359">f</span><span class="op" id="4209360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209366">if</span>&nbsp;<span class="builtintype" id="4209369">uint16</span><span class="op" id="4209375">(</span><span class="builtinfunc" id="4209376">len</span><span class="op" id="4209379">(</span><span class="ident" id="4209380">z</span><span class="op" id="4209381">.</span><span class="ident" id="4209382">File</span><span class="op" id="4209386">)</span><span class="op" id="4209387">)</span>&nbsp;<span class="op" id="4209389">!=</span>&nbsp;<span class="builtintype" id="4209392">uint16</span><span class="op" id="4209398">(</span><span class="ident" id="4209399">end</span><span class="op" id="4209402">.</span><span class="ident" id="4209403">directoryRecords</span><span class="op" id="4209419">)</span>&nbsp;<span class="op" id="4209421">{</span>&nbsp;<span class="comment" id="4209423">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4209454">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4209507">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209551">return</span>&nbsp;<span class="ident" id="4209558">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209566">return</span>&nbsp;<span class="ident" id="4209573">nil</span><br>
<span class="lineno">110</span><span class="op" id="4209577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4209580">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="4209641">func</span>&nbsp;<span class="op" id="4209646">(</span><span class="ident" id="4209647">rc</span>&nbsp;<span class="op" id="4209650">*</span><span class="ident" id="4209651">ReadCloser</span><span class="op" id="4209661">)</span>&nbsp;<span class="ident" id="4209663">Close</span><span class="op" id="4209668">(</span><span class="op" id="4209669">)</span>&nbsp;<span class="builtintype" id="4209671">error</span>&nbsp;<span class="op" id="4209677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209680">return</span>&nbsp;<span class="ident" id="4209687">rc</span><span class="op" id="4209689">.</span><span class="ident" id="4209690">f</span><span class="op" id="4209691">.</span><span class="ident" id="4209692">Close</span><span class="op" id="4209697">(</span><span class="op" id="4209698">)</span><br>
<span class="lineno">115</span><span class="op" id="4209700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4209703">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="4209770">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4209822">//</span><br>
<span class="lineno">120</span><span class="comment" id="4209825">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="4209886">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="4209931">func</span>&nbsp;<span class="op" id="4209936">(</span><span class="ident" id="4209937">f</span>&nbsp;<span class="op" id="4209939">*</span><span class="ident" id="4209940">File</span><span class="op" id="4209944">)</span>&nbsp;<span class="ident" id="4209946">DataOffset</span><span class="op" id="4209956">(</span><span class="op" id="4209957">)</span>&nbsp;<span class="op" id="4209959">(</span><span class="ident" id="4209960">offset</span>&nbsp;<span class="ident" id="4209967">int64</span><span class="op" id="4209972">,</span>&nbsp;<span class="ident" id="4209974">err</span>&nbsp;<span class="builtintype" id="4209978">error</span><span class="op" id="4209983">)</span>&nbsp;<span class="op" id="4209985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4209988">bodyOffset</span><span class="op" id="4209998">,</span>&nbsp;<span class="ident" id="4210000">err</span>&nbsp;<span class="op" id="4210004">:=</span>&nbsp;<span class="ident" id="4210007">f</span><span class="op" id="4210008">.</span><span class="ident" id="4210009">findBodyOffset</span><span class="op" id="4210023">(</span><span class="op" id="4210024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210027">if</span>&nbsp;<span class="ident" id="4210030">err</span>&nbsp;<span class="op" id="4210034">!=</span>&nbsp;<span class="ident" id="4210037">nil</span>&nbsp;<span class="op" id="4210041">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210045">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4210053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210056">return</span>&nbsp;<span class="ident" id="4210063">f</span><span class="op" id="4210064">.</span><span class="ident" id="4210065">headerOffset</span>&nbsp;<span class="op" id="4210078">+</span>&nbsp;<span class="ident" id="4210080">bodyOffset</span><span class="op" id="4210090">,</span>&nbsp;<span class="ident" id="4210092">nil</span><br>
<span class="lineno"></span><span class="op" id="4210096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4210099">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="4210173">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="4210217">func</span>&nbsp;<span class="op" id="4210222">(</span><span class="ident" id="4210223">f</span>&nbsp;<span class="op" id="4210225">*</span><span class="ident" id="4210226">File</span><span class="op" id="4210230">)</span>&nbsp;<span class="ident" id="4210232">Open</span><span class="op" id="4210236">(</span><span class="op" id="4210237">)</span>&nbsp;<span class="op" id="4210239">(</span><span class="ident" id="4210240">rc</span>&nbsp;<span class="ident" id="4210243">io</span><span class="op" id="4210245">.</span><span class="ident" id="4210246">ReadCloser</span><span class="op" id="4210256">,</span>&nbsp;<span class="ident" id="4210258">err</span>&nbsp;<span class="builtintype" id="4210262">error</span><span class="op" id="4210267">)</span>&nbsp;<span class="op" id="4210269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210272">bodyOffset</span><span class="op" id="4210282">,</span>&nbsp;<span class="ident" id="4210284">err</span>&nbsp;<span class="op" id="4210288">:=</span>&nbsp;<span class="ident" id="4210291">f</span><span class="op" id="4210292">.</span><span class="ident" id="4210293">findBodyOffset</span><span class="op" id="4210307">(</span><span class="op" id="4210308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210311">if</span>&nbsp;<span class="ident" id="4210314">err</span>&nbsp;<span class="op" id="4210318">!=</span>&nbsp;<span class="ident" id="4210321">nil</span>&nbsp;<span class="op" id="4210325">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210329">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4210337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210340">size</span>&nbsp;<span class="op" id="4210345">:=</span>&nbsp;<span class="ident" id="4210348">int64</span><span class="op" id="4210353">(</span><span class="ident" id="4210354">f</span><span class="op" id="4210355">.</span><span class="ident" id="4210356">CompressedSize64</span><span class="op" id="4210372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210375">r</span>&nbsp;<span class="op" id="4210377">:=</span>&nbsp;<span class="ident" id="4210380">io</span><span class="op" id="4210382">.</span><span class="ident" id="4210383">NewSectionReader</span><span class="op" id="4210399">(</span><span class="ident" id="4210400">f</span><span class="op" id="4210401">.</span><span class="ident" id="4210402">zipr</span><span class="op" id="4210406">,</span>&nbsp;<span class="ident" id="4210408">f</span><span class="op" id="4210409">.</span><span class="ident" id="4210410">headerOffset</span><span class="op" id="4210422">+</span><span class="ident" id="4210423">bodyOffset</span><span class="op" id="4210433">,</span>&nbsp;<span class="ident" id="4210435">size</span><span class="op" id="4210439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210442">dcomp</span>&nbsp;<span class="op" id="4210448">:=</span>&nbsp;<span class="ident" id="4210451">decompressor</span><span class="op" id="4210463">(</span><span class="ident" id="4210464">f</span><span class="op" id="4210465">.</span><span class="ident" id="4210466">Method</span><span class="op" id="4210472">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210475">if</span>&nbsp;<span class="ident" id="4210478">dcomp</span>&nbsp;<span class="op" id="4210484">==</span>&nbsp;<span class="ident" id="4210487">nil</span>&nbsp;<span class="op" id="4210491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210495">err</span>&nbsp;<span class="op" id="4210499">=</span>&nbsp;<span class="ident" id="4210501">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210516">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4210524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210527">rc</span>&nbsp;<span class="op" id="4210530">=</span>&nbsp;<span class="ident" id="4210532">dcomp</span><span class="op" id="4210537">(</span><span class="ident" id="4210538">r</span><span class="op" id="4210539">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210542">var</span>&nbsp;<span class="ident" id="4210546">desr</span>&nbsp;<span class="ident" id="4210551">io</span><span class="op" id="4210553">.</span><span class="ident" id="4210554">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210562">if</span>&nbsp;<span class="ident" id="4210565">f</span><span class="op" id="4210566">.</span><span class="ident" id="4210567">hasDataDescriptor</span><span class="op" id="4210584">(</span><span class="op" id="4210585">)</span>&nbsp;<span class="op" id="4210587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210591">desr</span>&nbsp;<span class="op" id="4210596">=</span>&nbsp;<span class="ident" id="4210598">io</span><span class="op" id="4210600">.</span><span class="ident" id="4210601">NewSectionReader</span><span class="op" id="4210617">(</span><span class="ident" id="4210618">f</span><span class="op" id="4210619">.</span><span class="ident" id="4210620">zipr</span><span class="op" id="4210624">,</span>&nbsp;<span class="ident" id="4210626">f</span><span class="op" id="4210627">.</span><span class="ident" id="4210628">headerOffset</span><span class="op" id="4210640">+</span><span class="ident" id="4210641">bodyOffset</span><span class="op" id="4210651">+</span><span class="ident" id="4210652">size</span><span class="op" id="4210656">,</span>&nbsp;<span class="ident" id="4210658">dataDescriptorLen</span><span class="op" id="4210675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4210678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210681">rc</span>&nbsp;<span class="op" id="4210684">=</span>&nbsp;<span class="op" id="4210686">&amp;</span><span class="ident" id="4210687">checksumReader</span><span class="op" id="4210701">{</span><span class="ident" id="4210702">rc</span><span class="op" id="4210704">,</span>&nbsp;<span class="ident" id="4210706">crc32</span><span class="op" id="4210711">.</span><span class="ident" id="4210712">NewIEEE</span><span class="op" id="4210719">(</span><span class="op" id="4210720">)</span><span class="op" id="4210721">,</span>&nbsp;<span class="ident" id="4210723">f</span><span class="op" id="4210724">,</span>&nbsp;<span class="ident" id="4210726">desr</span><span class="op" id="4210730">,</span>&nbsp;<span class="ident" id="4210732">nil</span><span class="op" id="4210735">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210738">return</span><br>
<span class="lineno"></span><span class="op" id="4210745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4210748">type</span>&nbsp;<span class="ident" id="4210753">checksumReader</span>&nbsp;<span class="keyword" id="4210768">struct</span>&nbsp;<span class="op" id="4210775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210778">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4210783">io</span><span class="op" id="4210785">.</span><span class="ident" id="4210786">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210798">hash</span>&nbsp;<span class="ident" id="4210803">hash</span><span class="op" id="4210807">.</span><span class="ident" id="4210808">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210816">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4210821">*</span><span class="ident" id="4210822">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210828">desr</span>&nbsp;<span class="ident" id="4210833">io</span><span class="op" id="4210835">.</span><span class="ident" id="4210836">Reader</span>&nbsp;<span class="comment" id="4210843">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4210893">err</span>&nbsp;&nbsp;<span class="builtintype" id="4210898">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4210908">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="4210924">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="4210927">func</span>&nbsp;<span class="op" id="4210932">(</span><span class="ident" id="4210933">r</span>&nbsp;<span class="op" id="4210935">*</span><span class="ident" id="4210936">checksumReader</span><span class="op" id="4210950">)</span>&nbsp;<span class="ident" id="4210952">Read</span><span class="op" id="4210956">(</span><span class="ident" id="4210957">b</span>&nbsp;<span class="op" id="4210959">[</span><span class="op" id="4210960">]</span><span class="builtintype" id="4210961">byte</span><span class="op" id="4210965">)</span>&nbsp;<span class="op" id="4210967">(</span><span class="ident" id="4210968">n</span>&nbsp;<span class="builtintype" id="4210970">int</span><span class="op" id="4210973">,</span>&nbsp;<span class="ident" id="4210975">err</span>&nbsp;<span class="builtintype" id="4210979">error</span><span class="op" id="4210984">)</span>&nbsp;<span class="op" id="4210986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4210989">if</span>&nbsp;<span class="ident" id="4210992">r</span><span class="op" id="4210993">.</span><span class="ident" id="4210994">err</span>&nbsp;<span class="op" id="4210998">!=</span>&nbsp;<span class="ident" id="4211001">nil</span>&nbsp;<span class="op" id="4211005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211009">return</span>&nbsp;<span class="num" id="4211016">0</span><span class="op" id="4211017">,</span>&nbsp;<span class="ident" id="4211019">r</span><span class="op" id="4211020">.</span><span class="ident" id="4211021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211026">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211029">n</span><span class="op" id="4211030">,</span>&nbsp;<span class="ident" id="4211032">err</span>&nbsp;<span class="op" id="4211036">=</span>&nbsp;<span class="ident" id="4211038">r</span><span class="op" id="4211039">.</span><span class="ident" id="4211040">rc</span><span class="op" id="4211042">.</span><span class="ident" id="4211043">Read</span><span class="op" id="4211047">(</span><span class="ident" id="4211048">b</span><span class="op" id="4211049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211052">r</span><span class="op" id="4211053">.</span><span class="ident" id="4211054">hash</span><span class="op" id="4211058">.</span><span class="ident" id="4211059">Write</span><span class="op" id="4211064">(</span><span class="ident" id="4211065">b</span><span class="op" id="4211066">[</span><span class="op" id="4211067">:</span><span class="ident" id="4211068">n</span><span class="op" id="4211069">]</span><span class="op" id="4211070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211073">if</span>&nbsp;<span class="ident" id="4211076">err</span>&nbsp;<span class="op" id="4211080">==</span>&nbsp;<span class="ident" id="4211083">nil</span>&nbsp;<span class="op" id="4211087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211091">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211099">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211102">if</span>&nbsp;<span class="ident" id="4211105">err</span>&nbsp;<span class="op" id="4211109">==</span>&nbsp;<span class="ident" id="4211112">io</span><span class="op" id="4211114">.</span><span class="ident" id="4211115">EOF</span>&nbsp;<span class="op" id="4211119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211123">if</span>&nbsp;<span class="ident" id="4211126">r</span><span class="op" id="4211127">.</span><span class="ident" id="4211128">desr</span>&nbsp;<span class="op" id="4211133">!=</span>&nbsp;<span class="ident" id="4211136">nil</span>&nbsp;<span class="op" id="4211140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211145">if</span>&nbsp;<span class="ident" id="4211148">err1</span>&nbsp;<span class="op" id="4211153">:=</span>&nbsp;<span class="ident" id="4211156">readDataDescriptor</span><span class="op" id="4211174">(</span><span class="ident" id="4211175">r</span><span class="op" id="4211176">.</span><span class="ident" id="4211177">desr</span><span class="op" id="4211181">,</span>&nbsp;<span class="ident" id="4211183">r</span><span class="op" id="4211184">.</span><span class="ident" id="4211185">f</span><span class="op" id="4211186">)</span><span class="op" id="4211187">;</span>&nbsp;<span class="ident" id="4211189">err1</span>&nbsp;<span class="op" id="4211194">!=</span>&nbsp;<span class="ident" id="4211197">nil</span>&nbsp;<span class="op" id="4211201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211207">err</span>&nbsp;<span class="op" id="4211211">=</span>&nbsp;<span class="ident" id="4211213">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211221">}</span>&nbsp;<span class="keyword" id="4211223">else</span>&nbsp;<span class="keyword" id="4211228">if</span>&nbsp;<span class="ident" id="4211231">r</span><span class="op" id="4211232">.</span><span class="ident" id="4211233">hash</span><span class="op" id="4211237">.</span><span class="ident" id="4211238">Sum32</span><span class="op" id="4211243">(</span><span class="op" id="4211244">)</span>&nbsp;<span class="op" id="4211246">!=</span>&nbsp;<span class="ident" id="4211249">r</span><span class="op" id="4211250">.</span><span class="ident" id="4211251">f</span><span class="op" id="4211252">.</span><span class="ident" id="4211253">CRC32</span>&nbsp;<span class="op" id="4211259">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211265">err</span>&nbsp;<span class="op" id="4211269">=</span>&nbsp;<span class="ident" id="4211271">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211290">}</span>&nbsp;<span class="keyword" id="4211292">else</span>&nbsp;<span class="op" id="4211297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4211302">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4211359">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4211418">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211469">if</span>&nbsp;<span class="ident" id="4211472">r</span><span class="op" id="4211473">.</span><span class="ident" id="4211474">f</span><span class="op" id="4211475">.</span><span class="ident" id="4211476">CRC32</span>&nbsp;<span class="op" id="4211482">!=</span>&nbsp;<span class="num" id="4211485">0</span>&nbsp;<span class="op" id="4211487">&amp;&amp;</span>&nbsp;<span class="ident" id="4211490">r</span><span class="op" id="4211491">.</span><span class="ident" id="4211492">hash</span><span class="op" id="4211496">.</span><span class="ident" id="4211497">Sum32</span><span class="op" id="4211502">(</span><span class="op" id="4211503">)</span>&nbsp;<span class="op" id="4211505">!=</span>&nbsp;<span class="ident" id="4211508">r</span><span class="op" id="4211509">.</span><span class="ident" id="4211510">f</span><span class="op" id="4211511">.</span><span class="ident" id="4211512">CRC32</span>&nbsp;<span class="op" id="4211518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211524">err</span>&nbsp;<span class="op" id="4211528">=</span>&nbsp;<span class="ident" id="4211530">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211549">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211555">r</span><span class="op" id="4211556">.</span><span class="ident" id="4211557">err</span>&nbsp;<span class="op" id="4211561">=</span>&nbsp;<span class="ident" id="4211563">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211568">return</span><br>
<span class="lineno"></span><span class="op" id="4211575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="4211578">func</span>&nbsp;<span class="op" id="4211583">(</span><span class="ident" id="4211584">r</span>&nbsp;<span class="op" id="4211586">*</span><span class="ident" id="4211587">checksumReader</span><span class="op" id="4211601">)</span>&nbsp;<span class="ident" id="4211603">Close</span><span class="op" id="4211608">(</span><span class="op" id="4211609">)</span>&nbsp;<span class="builtintype" id="4211611">error</span>&nbsp;<span class="op" id="4211617">{</span>&nbsp;<span class="keyword" id="4211619">return</span>&nbsp;<span class="ident" id="4211626">r</span><span class="op" id="4211627">.</span><span class="ident" id="4211628">rc</span><span class="op" id="4211630">.</span><span class="ident" id="4211631">Close</span><span class="op" id="4211636">(</span><span class="op" id="4211637">)</span>&nbsp;<span class="op" id="4211639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4211642">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4211714">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4211751">func</span>&nbsp;<span class="op" id="4211756">(</span><span class="ident" id="4211757">f</span>&nbsp;<span class="op" id="4211759">*</span><span class="ident" id="4211760">File</span><span class="op" id="4211764">)</span>&nbsp;<span class="ident" id="4211766">findBodyOffset</span><span class="op" id="4211780">(</span><span class="op" id="4211781">)</span>&nbsp;<span class="op" id="4211783">(</span><span class="ident" id="4211784">int64</span><span class="op" id="4211789">,</span>&nbsp;<span class="builtintype" id="4211791">error</span><span class="op" id="4211796">)</span>&nbsp;<span class="op" id="4211798">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211801">var</span>&nbsp;<span class="ident" id="4211805">buf</span>&nbsp;<span class="op" id="4211809">[</span><span class="ident" id="4211810">fileHeaderLen</span><span class="op" id="4211823">]</span><span class="builtintype" id="4211824">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211830">if</span>&nbsp;<span class="ident" id="4211833">_</span><span class="op" id="4211834">,</span>&nbsp;<span class="ident" id="4211836">err</span>&nbsp;<span class="op" id="4211840">:=</span>&nbsp;<span class="ident" id="4211843">f</span><span class="op" id="4211844">.</span><span class="ident" id="4211845">zipr</span><span class="op" id="4211849">.</span><span class="ident" id="4211850">ReadAt</span><span class="op" id="4211856">(</span><span class="ident" id="4211857">buf</span><span class="op" id="4211860">[</span><span class="op" id="4211861">:</span><span class="op" id="4211862">]</span><span class="op" id="4211863">,</span>&nbsp;<span class="ident" id="4211865">f</span><span class="op" id="4211866">.</span><span class="ident" id="4211867">headerOffset</span><span class="op" id="4211879">)</span><span class="op" id="4211880">;</span>&nbsp;<span class="ident" id="4211882">err</span>&nbsp;<span class="op" id="4211886">!=</span>&nbsp;<span class="ident" id="4211889">nil</span>&nbsp;<span class="op" id="4211893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211897">return</span>&nbsp;<span class="num" id="4211904">0</span><span class="op" id="4211905">,</span>&nbsp;<span class="ident" id="4211907">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4211912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4211915">b</span>&nbsp;<span class="op" id="4211917">:=</span>&nbsp;<span class="ident" id="4211920">readBuf</span><span class="op" id="4211927">(</span><span class="ident" id="4211928">buf</span><span class="op" id="4211931">[</span><span class="op" id="4211932">:</span><span class="op" id="4211933">]</span><span class="op" id="4211934">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211937">if</span>&nbsp;<span class="ident" id="4211940">sig</span>&nbsp;<span class="op" id="4211944">:=</span>&nbsp;<span class="ident" id="4211947">b</span><span class="op" id="4211948">.</span><span class="builtintype" id="4211949">uint32</span><span class="op" id="4211955">(</span><span class="op" id="4211956">)</span><span class="op" id="4211957">;</span>&nbsp;<span class="ident" id="4211959">sig</span>&nbsp;<span class="op" id="4211963">!=</span>&nbsp;<span class="ident" id="4211966">fileHeaderSignature</span>&nbsp;<span class="op" id="4211986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4211990">return</span>&nbsp;<span class="num" id="4211997">0</span><span class="op" id="4211998">,</span>&nbsp;<span class="ident" id="4212000">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4212011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212014">b</span>&nbsp;<span class="op" id="4212016">=</span>&nbsp;<span class="ident" id="4212018">b</span><span class="op" id="4212019">[</span><span class="num" id="4212020">22</span><span class="op" id="4212022">:</span><span class="op" id="4212023">]</span>&nbsp;<span class="comment" id="4212025">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212058">filenameLen</span>&nbsp;<span class="op" id="4212070">:=</span>&nbsp;<span class="builtintype" id="4212073">int</span><span class="op" id="4212076">(</span><span class="ident" id="4212077">b</span><span class="op" id="4212078">.</span><span class="builtintype" id="4212079">uint16</span><span class="op" id="4212085">(</span><span class="op" id="4212086">)</span><span class="op" id="4212087">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212090">extraLen</span>&nbsp;<span class="op" id="4212099">:=</span>&nbsp;<span class="builtintype" id="4212102">int</span><span class="op" id="4212105">(</span><span class="ident" id="4212106">b</span><span class="op" id="4212107">.</span><span class="builtintype" id="4212108">uint16</span><span class="op" id="4212114">(</span><span class="op" id="4212115">)</span><span class="op" id="4212116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212119">return</span>&nbsp;<span class="ident" id="4212126">int64</span><span class="op" id="4212131">(</span><span class="ident" id="4212132">fileHeaderLen</span>&nbsp;<span class="op" id="4212146">+</span>&nbsp;<span class="ident" id="4212148">filenameLen</span>&nbsp;<span class="op" id="4212160">+</span>&nbsp;<span class="ident" id="4212162">extraLen</span><span class="op" id="4212170">)</span><span class="op" id="4212171">,</span>&nbsp;<span class="ident" id="4212173">nil</span><br>
<span class="lineno"></span><span class="op" id="4212177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4212180">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="4212247">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="4212318">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4212380">func</span>&nbsp;<span class="ident" id="4212385">readDirectoryHeader</span><span class="op" id="4212404">(</span><span class="ident" id="4212405">f</span>&nbsp;<span class="op" id="4212407">*</span><span class="ident" id="4212408">File</span><span class="op" id="4212412">,</span>&nbsp;<span class="ident" id="4212414">r</span>&nbsp;<span class="ident" id="4212416">io</span><span class="op" id="4212418">.</span><span class="ident" id="4212419">Reader</span><span class="op" id="4212425">)</span>&nbsp;<span class="builtintype" id="4212427">error</span>&nbsp;<span class="op" id="4212433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212436">var</span>&nbsp;<span class="ident" id="4212440">buf</span>&nbsp;<span class="op" id="4212444">[</span><span class="ident" id="4212445">directoryHeaderLen</span><span class="op" id="4212463">]</span><span class="builtintype" id="4212464">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212470">if</span>&nbsp;<span class="ident" id="4212473">_</span><span class="op" id="4212474">,</span>&nbsp;<span class="ident" id="4212476">err</span>&nbsp;<span class="op" id="4212480">:=</span>&nbsp;<span class="ident" id="4212483">io</span><span class="op" id="4212485">.</span><span class="ident" id="4212486">ReadFull</span><span class="op" id="4212494">(</span><span class="ident" id="4212495">r</span><span class="op" id="4212496">,</span>&nbsp;<span class="ident" id="4212498">buf</span><span class="op" id="4212501">[</span><span class="op" id="4212502">:</span><span class="op" id="4212503">]</span><span class="op" id="4212504">)</span><span class="op" id="4212505">;</span>&nbsp;<span class="ident" id="4212507">err</span>&nbsp;<span class="op" id="4212511">!=</span>&nbsp;<span class="ident" id="4212514">nil</span>&nbsp;<span class="op" id="4212518">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212522">return</span>&nbsp;<span class="ident" id="4212529">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4212534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212537">b</span>&nbsp;<span class="op" id="4212539">:=</span>&nbsp;<span class="ident" id="4212542">readBuf</span><span class="op" id="4212549">(</span><span class="ident" id="4212550">buf</span><span class="op" id="4212553">[</span><span class="op" id="4212554">:</span><span class="op" id="4212555">]</span><span class="op" id="4212556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212559">if</span>&nbsp;<span class="ident" id="4212562">sig</span>&nbsp;<span class="op" id="4212566">:=</span>&nbsp;<span class="ident" id="4212569">b</span><span class="op" id="4212570">.</span><span class="builtintype" id="4212571">uint32</span><span class="op" id="4212577">(</span><span class="op" id="4212578">)</span><span class="op" id="4212579">;</span>&nbsp;<span class="ident" id="4212581">sig</span>&nbsp;<span class="op" id="4212585">!=</span>&nbsp;<span class="ident" id="4212588">directoryHeaderSignature</span>&nbsp;<span class="op" id="4212613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4212617">return</span>&nbsp;<span class="ident" id="4212624">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4212635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212638">f</span><span class="op" id="4212639">.</span><span class="ident" id="4212640">CreatorVersion</span>&nbsp;<span class="op" id="4212655">=</span>&nbsp;<span class="ident" id="4212657">b</span><span class="op" id="4212658">.</span><span class="builtintype" id="4212659">uint16</span><span class="op" id="4212665">(</span><span class="op" id="4212666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212669">f</span><span class="op" id="4212670">.</span><span class="ident" id="4212671">ReaderVersion</span>&nbsp;<span class="op" id="4212685">=</span>&nbsp;<span class="ident" id="4212687">b</span><span class="op" id="4212688">.</span><span class="builtintype" id="4212689">uint16</span><span class="op" id="4212695">(</span><span class="op" id="4212696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212699">f</span><span class="op" id="4212700">.</span><span class="ident" id="4212701">Flags</span>&nbsp;<span class="op" id="4212707">=</span>&nbsp;<span class="ident" id="4212709">b</span><span class="op" id="4212710">.</span><span class="builtintype" id="4212711">uint16</span><span class="op" id="4212717">(</span><span class="op" id="4212718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212721">f</span><span class="op" id="4212722">.</span><span class="ident" id="4212723">Method</span>&nbsp;<span class="op" id="4212730">=</span>&nbsp;<span class="ident" id="4212732">b</span><span class="op" id="4212733">.</span><span class="builtintype" id="4212734">uint16</span><span class="op" id="4212740">(</span><span class="op" id="4212741">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212744">f</span><span class="op" id="4212745">.</span><span class="ident" id="4212746">ModifiedTime</span>&nbsp;<span class="op" id="4212759">=</span>&nbsp;<span class="ident" id="4212761">b</span><span class="op" id="4212762">.</span><span class="builtintype" id="4212763">uint16</span><span class="op" id="4212769">(</span><span class="op" id="4212770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212773">f</span><span class="op" id="4212774">.</span><span class="ident" id="4212775">ModifiedDate</span>&nbsp;<span class="op" id="4212788">=</span>&nbsp;<span class="ident" id="4212790">b</span><span class="op" id="4212791">.</span><span class="builtintype" id="4212792">uint16</span><span class="op" id="4212798">(</span><span class="op" id="4212799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212802">f</span><span class="op" id="4212803">.</span><span class="ident" id="4212804">CRC32</span>&nbsp;<span class="op" id="4212810">=</span>&nbsp;<span class="ident" id="4212812">b</span><span class="op" id="4212813">.</span><span class="builtintype" id="4212814">uint32</span><span class="op" id="4212820">(</span><span class="op" id="4212821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212824">f</span><span class="op" id="4212825">.</span><span class="ident" id="4212826">CompressedSize</span>&nbsp;<span class="op" id="4212841">=</span>&nbsp;<span class="ident" id="4212843">b</span><span class="op" id="4212844">.</span><span class="builtintype" id="4212845">uint32</span><span class="op" id="4212851">(</span><span class="op" id="4212852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212855">f</span><span class="op" id="4212856">.</span><span class="ident" id="4212857">UncompressedSize</span>&nbsp;<span class="op" id="4212874">=</span>&nbsp;<span class="ident" id="4212876">b</span><span class="op" id="4212877">.</span><span class="builtintype" id="4212878">uint32</span><span class="op" id="4212884">(</span><span class="op" id="4212885">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212888">f</span><span class="op" id="4212889">.</span><span class="ident" id="4212890">CompressedSize64</span>&nbsp;<span class="op" id="4212907">=</span>&nbsp;<span class="ident" id="4212909">uint64</span><span class="op" id="4212915">(</span><span class="ident" id="4212916">f</span><span class="op" id="4212917">.</span><span class="ident" id="4212918">CompressedSize</span><span class="op" id="4212932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212935">f</span><span class="op" id="4212936">.</span><span class="ident" id="4212937">UncompressedSize64</span>&nbsp;<span class="op" id="4212956">=</span>&nbsp;<span class="ident" id="4212958">uint64</span><span class="op" id="4212964">(</span><span class="ident" id="4212965">f</span><span class="op" id="4212966">.</span><span class="ident" id="4212967">UncompressedSize</span><span class="op" id="4212983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212986">filenameLen</span>&nbsp;<span class="op" id="4212998">:=</span>&nbsp;<span class="builtintype" id="4213001">int</span><span class="op" id="4213004">(</span><span class="ident" id="4213005">b</span><span class="op" id="4213006">.</span><span class="builtintype" id="4213007">uint16</span><span class="op" id="4213013">(</span><span class="op" id="4213014">)</span><span class="op" id="4213015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213018">extraLen</span>&nbsp;<span class="op" id="4213027">:=</span>&nbsp;<span class="builtintype" id="4213030">int</span><span class="op" id="4213033">(</span><span class="ident" id="4213034">b</span><span class="op" id="4213035">.</span><span class="builtintype" id="4213036">uint16</span><span class="op" id="4213042">(</span><span class="op" id="4213043">)</span><span class="op" id="4213044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213047">commentLen</span>&nbsp;<span class="op" id="4213058">:=</span>&nbsp;<span class="builtintype" id="4213061">int</span><span class="op" id="4213064">(</span><span class="ident" id="4213065">b</span><span class="op" id="4213066">.</span><span class="builtintype" id="4213067">uint16</span><span class="op" id="4213073">(</span><span class="op" id="4213074">)</span><span class="op" id="4213075">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213078">b</span>&nbsp;<span class="op" id="4213080">=</span>&nbsp;<span class="ident" id="4213082">b</span><span class="op" id="4213083">[</span><span class="num" id="4213084">4</span><span class="op" id="4213085">:</span><span class="op" id="4213086">]</span>&nbsp;<span class="comment" id="4213088">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213154">f</span><span class="op" id="4213155">.</span><span class="ident" id="4213156">ExternalAttrs</span>&nbsp;<span class="op" id="4213170">=</span>&nbsp;<span class="ident" id="4213172">b</span><span class="op" id="4213173">.</span><span class="builtintype" id="4213174">uint32</span><span class="op" id="4213180">(</span><span class="op" id="4213181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213184">f</span><span class="op" id="4213185">.</span><span class="ident" id="4213186">headerOffset</span>&nbsp;<span class="op" id="4213199">=</span>&nbsp;<span class="ident" id="4213201">int64</span><span class="op" id="4213206">(</span><span class="ident" id="4213207">b</span><span class="op" id="4213208">.</span><span class="builtintype" id="4213209">uint32</span><span class="op" id="4213215">(</span><span class="op" id="4213216">)</span><span class="op" id="4213217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213220">d</span>&nbsp;<span class="op" id="4213222">:=</span>&nbsp;<span class="builtinfunc" id="4213225">make</span><span class="op" id="4213229">(</span><span class="op" id="4213230">[</span><span class="op" id="4213231">]</span><span class="builtintype" id="4213232">byte</span><span class="op" id="4213236">,</span>&nbsp;<span class="ident" id="4213238">filenameLen</span><span class="op" id="4213249">+</span><span class="ident" id="4213250">extraLen</span><span class="op" id="4213258">+</span><span class="ident" id="4213259">commentLen</span><span class="op" id="4213269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213272">if</span>&nbsp;<span class="ident" id="4213275">_</span><span class="op" id="4213276">,</span>&nbsp;<span class="ident" id="4213278">err</span>&nbsp;<span class="op" id="4213282">:=</span>&nbsp;<span class="ident" id="4213285">io</span><span class="op" id="4213287">.</span><span class="ident" id="4213288">ReadFull</span><span class="op" id="4213296">(</span><span class="ident" id="4213297">r</span><span class="op" id="4213298">,</span>&nbsp;<span class="ident" id="4213300">d</span><span class="op" id="4213301">)</span><span class="op" id="4213302">;</span>&nbsp;<span class="ident" id="4213304">err</span>&nbsp;<span class="op" id="4213308">!=</span>&nbsp;<span class="ident" id="4213311">nil</span>&nbsp;<span class="op" id="4213315">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213319">return</span>&nbsp;<span class="ident" id="4213326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213334">f</span><span class="op" id="4213335">.</span><span class="ident" id="4213336">Name</span>&nbsp;<span class="op" id="4213341">=</span>&nbsp;<span class="builtintype" id="4213343">string</span><span class="op" id="4213349">(</span><span class="ident" id="4213350">d</span><span class="op" id="4213351">[</span><span class="op" id="4213352">:</span><span class="ident" id="4213353">filenameLen</span><span class="op" id="4213364">]</span><span class="op" id="4213365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213368">f</span><span class="op" id="4213369">.</span><span class="ident" id="4213370">Extra</span>&nbsp;<span class="op" id="4213376">=</span>&nbsp;<span class="ident" id="4213378">d</span><span class="op" id="4213379">[</span><span class="ident" id="4213380">filenameLen</span>&nbsp;<span class="op" id="4213392">:</span>&nbsp;<span class="ident" id="4213394">filenameLen</span><span class="op" id="4213405">+</span><span class="ident" id="4213406">extraLen</span><span class="op" id="4213414">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213417">f</span><span class="op" id="4213418">.</span><span class="ident" id="4213419">Comment</span>&nbsp;<span class="op" id="4213427">=</span>&nbsp;<span class="builtintype" id="4213429">string</span><span class="op" id="4213435">(</span><span class="ident" id="4213436">d</span><span class="op" id="4213437">[</span><span class="ident" id="4213438">filenameLen</span><span class="op" id="4213449">+</span><span class="ident" id="4213450">extraLen</span><span class="op" id="4213458">:</span><span class="op" id="4213459">]</span><span class="op" id="4213460">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213464">if</span>&nbsp;<span class="builtinfunc" id="4213467">len</span><span class="op" id="4213470">(</span><span class="ident" id="4213471">f</span><span class="op" id="4213472">.</span><span class="ident" id="4213473">Extra</span><span class="op" id="4213478">)</span>&nbsp;<span class="op" id="4213480">&gt;</span>&nbsp;<span class="num" id="4213482">0</span>&nbsp;<span class="op" id="4213484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213488">b</span>&nbsp;<span class="op" id="4213490">:=</span>&nbsp;<span class="ident" id="4213493">readBuf</span><span class="op" id="4213500">(</span><span class="ident" id="4213501">f</span><span class="op" id="4213502">.</span><span class="ident" id="4213503">Extra</span><span class="op" id="4213508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213512">for</span>&nbsp;<span class="builtinfunc" id="4213516">len</span><span class="op" id="4213519">(</span><span class="ident" id="4213520">b</span><span class="op" id="4213521">)</span>&nbsp;<span class="op" id="4213523">&gt;=</span>&nbsp;<span class="num" id="4213526">4</span>&nbsp;<span class="op" id="4213528">{</span>&nbsp;<span class="comment" id="4213530">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213563">tag</span>&nbsp;<span class="op" id="4213567">:=</span>&nbsp;<span class="ident" id="4213570">b</span><span class="op" id="4213571">.</span><span class="builtintype" id="4213572">uint16</span><span class="op" id="4213578">(</span><span class="op" id="4213579">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213584">size</span>&nbsp;<span class="op" id="4213589">:=</span>&nbsp;<span class="ident" id="4213592">b</span><span class="op" id="4213593">.</span><span class="builtintype" id="4213594">uint16</span><span class="op" id="4213600">(</span><span class="op" id="4213601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213606">if</span>&nbsp;<span class="builtintype" id="4213609">int</span><span class="op" id="4213612">(</span><span class="ident" id="4213613">size</span><span class="op" id="4213617">)</span>&nbsp;<span class="op" id="4213619">&gt;</span>&nbsp;<span class="builtinfunc" id="4213621">len</span><span class="op" id="4213624">(</span><span class="ident" id="4213625">b</span><span class="op" id="4213626">)</span>&nbsp;<span class="op" id="4213628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213634">return</span>&nbsp;<span class="ident" id="4213641">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213659">if</span>&nbsp;<span class="ident" id="4213662">tag</span>&nbsp;<span class="op" id="4213666">==</span>&nbsp;<span class="ident" id="4213669">zip64ExtraId</span>&nbsp;<span class="op" id="4213682">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4213688">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213746">eb</span>&nbsp;<span class="op" id="4213749">:=</span>&nbsp;<span class="ident" id="4213752">readBuf</span><span class="op" id="4213759">(</span><span class="ident" id="4213760">b</span><span class="op" id="4213761">[</span><span class="op" id="4213762">:</span><span class="ident" id="4213763">size</span><span class="op" id="4213767">]</span><span class="op" id="4213768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213774">if</span>&nbsp;<span class="builtinfunc" id="4213777">len</span><span class="op" id="4213780">(</span><span class="ident" id="4213781">eb</span><span class="op" id="4213783">)</span>&nbsp;<span class="op" id="4213785">&gt;=</span>&nbsp;<span class="num" id="4213788">8</span>&nbsp;<span class="op" id="4213790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213797">f</span><span class="op" id="4213798">.</span><span class="ident" id="4213799">UncompressedSize64</span>&nbsp;<span class="op" id="4213818">=</span>&nbsp;<span class="ident" id="4213820">eb</span><span class="op" id="4213822">.</span><span class="ident" id="4213823">uint64</span><span class="op" id="4213829">(</span><span class="op" id="4213830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213836">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213842">if</span>&nbsp;<span class="builtinfunc" id="4213845">len</span><span class="op" id="4213848">(</span><span class="ident" id="4213849">eb</span><span class="op" id="4213851">)</span>&nbsp;<span class="op" id="4213853">&gt;=</span>&nbsp;<span class="num" id="4213856">8</span>&nbsp;<span class="op" id="4213858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213865">f</span><span class="op" id="4213866">.</span><span class="ident" id="4213867">CompressedSize64</span>&nbsp;<span class="op" id="4213884">=</span>&nbsp;<span class="ident" id="4213886">eb</span><span class="op" id="4213888">.</span><span class="ident" id="4213889">uint64</span><span class="op" id="4213895">(</span><span class="op" id="4213896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213908">if</span>&nbsp;<span class="builtinfunc" id="4213911">len</span><span class="op" id="4213914">(</span><span class="ident" id="4213915">eb</span><span class="op" id="4213917">)</span>&nbsp;<span class="op" id="4213919">&gt;=</span>&nbsp;<span class="num" id="4213922">8</span>&nbsp;<span class="op" id="4213924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213931">f</span><span class="op" id="4213932">.</span><span class="ident" id="4213933">headerOffset</span>&nbsp;<span class="op" id="4213946">=</span>&nbsp;<span class="ident" id="4213948">int64</span><span class="op" id="4213953">(</span><span class="ident" id="4213954">eb</span><span class="op" id="4213956">.</span><span class="ident" id="4213957">uint64</span><span class="op" id="4213963">(</span><span class="op" id="4213964">)</span><span class="op" id="4213965">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213981">b</span>&nbsp;<span class="op" id="4213983">=</span>&nbsp;<span class="ident" id="4213985">b</span><span class="op" id="4213986">[</span><span class="ident" id="4213987">size</span><span class="op" id="4213991">:</span><span class="op" id="4213992">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214000">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214044">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214101">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214154">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214191">for</span>&nbsp;<span class="ident" id="4214195">_</span><span class="op" id="4214196">,</span>&nbsp;<span class="ident" id="4214198">v</span>&nbsp;<span class="op" id="4214200">:=</span>&nbsp;<span class="keyword" id="4214203">range</span>&nbsp;<span class="ident" id="4214209">b</span>&nbsp;<span class="op" id="4214211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214216">if</span>&nbsp;<span class="ident" id="4214219">v</span>&nbsp;<span class="op" id="4214221">!=</span>&nbsp;<span class="num" id="4214224">0</span>&nbsp;<span class="op" id="4214226">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214232">return</span>&nbsp;<span class="ident" id="4214239">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214262">return</span>&nbsp;<span class="ident" id="4214269">nil</span><br>
<span class="lineno">280</span><span class="op" id="4214273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4214276">func</span>&nbsp;<span class="ident" id="4214281">readDataDescriptor</span><span class="op" id="4214299">(</span><span class="ident" id="4214300">r</span>&nbsp;<span class="ident" id="4214302">io</span><span class="op" id="4214304">.</span><span class="ident" id="4214305">Reader</span><span class="op" id="4214311">,</span>&nbsp;<span class="ident" id="4214313">f</span>&nbsp;<span class="op" id="4214315">*</span><span class="ident" id="4214316">File</span><span class="op" id="4214320">)</span>&nbsp;<span class="builtintype" id="4214322">error</span>&nbsp;<span class="op" id="4214328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214331">var</span>&nbsp;<span class="ident" id="4214335">buf</span>&nbsp;<span class="op" id="4214339">[</span><span class="ident" id="4214340">dataDescriptorLen</span><span class="op" id="4214357">]</span><span class="builtintype" id="4214358">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214365">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214420">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214482">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214539">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214594">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214654">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214718">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214758">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214762">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4214823">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214878">if</span>&nbsp;<span class="ident" id="4214881">_</span><span class="op" id="4214882">,</span>&nbsp;<span class="ident" id="4214884">err</span>&nbsp;<span class="op" id="4214888">:=</span>&nbsp;<span class="ident" id="4214891">io</span><span class="op" id="4214893">.</span><span class="ident" id="4214894">ReadFull</span><span class="op" id="4214902">(</span><span class="ident" id="4214903">r</span><span class="op" id="4214904">,</span>&nbsp;<span class="ident" id="4214906">buf</span><span class="op" id="4214909">[</span><span class="op" id="4214910">:</span><span class="num" id="4214911">4</span><span class="op" id="4214912">]</span><span class="op" id="4214913">)</span><span class="op" id="4214914">;</span>&nbsp;<span class="ident" id="4214916">err</span>&nbsp;<span class="op" id="4214920">!=</span>&nbsp;<span class="ident" id="4214923">nil</span>&nbsp;<span class="op" id="4214927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214931">return</span>&nbsp;<span class="ident" id="4214938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214946">off</span>&nbsp;<span class="op" id="4214950">:=</span>&nbsp;<span class="num" id="4214953">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214956">maybeSig</span>&nbsp;<span class="op" id="4214965">:=</span>&nbsp;<span class="ident" id="4214968">readBuf</span><span class="op" id="4214975">(</span><span class="ident" id="4214976">buf</span><span class="op" id="4214979">[</span><span class="op" id="4214980">:</span><span class="num" id="4214981">4</span><span class="op" id="4214982">]</span><span class="op" id="4214983">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214986">if</span>&nbsp;<span class="ident" id="4214989">maybeSig</span><span class="op" id="4214997">.</span><span class="builtintype" id="4214998">uint32</span><span class="op" id="4215004">(</span><span class="op" id="4215005">)</span>&nbsp;<span class="op" id="4215007">!=</span>&nbsp;<span class="ident" id="4215010">dataDescriptorSignature</span>&nbsp;<span class="op" id="4215034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215038">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215089">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215101">off</span>&nbsp;<span class="op" id="4215105">+=</span>&nbsp;<span class="num" id="4215108">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215111">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215114">if</span>&nbsp;<span class="ident" id="4215117">_</span><span class="op" id="4215118">,</span>&nbsp;<span class="ident" id="4215120">err</span>&nbsp;<span class="op" id="4215124">:=</span>&nbsp;<span class="ident" id="4215127">io</span><span class="op" id="4215129">.</span><span class="ident" id="4215130">ReadFull</span><span class="op" id="4215138">(</span><span class="ident" id="4215139">r</span><span class="op" id="4215140">,</span>&nbsp;<span class="ident" id="4215142">buf</span><span class="op" id="4215145">[</span><span class="ident" id="4215146">off</span><span class="op" id="4215149">:</span><span class="num" id="4215150">12</span><span class="op" id="4215152">]</span><span class="op" id="4215153">)</span><span class="op" id="4215154">;</span>&nbsp;<span class="ident" id="4215156">err</span>&nbsp;<span class="op" id="4215160">!=</span>&nbsp;<span class="ident" id="4215163">nil</span>&nbsp;<span class="op" id="4215167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215171">return</span>&nbsp;<span class="ident" id="4215178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215186">b</span>&nbsp;<span class="op" id="4215188">:=</span>&nbsp;<span class="ident" id="4215191">readBuf</span><span class="op" id="4215198">(</span><span class="ident" id="4215199">buf</span><span class="op" id="4215202">[</span><span class="op" id="4215203">:</span><span class="num" id="4215204">12</span><span class="op" id="4215206">]</span><span class="op" id="4215207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215210">if</span>&nbsp;<span class="ident" id="4215213">b</span><span class="op" id="4215214">.</span><span class="builtintype" id="4215215">uint32</span><span class="op" id="4215221">(</span><span class="op" id="4215222">)</span>&nbsp;<span class="op" id="4215224">!=</span>&nbsp;<span class="ident" id="4215227">f</span><span class="op" id="4215228">.</span><span class="ident" id="4215229">CRC32</span>&nbsp;<span class="op" id="4215235">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215239">return</span>&nbsp;<span class="ident" id="4215246">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215263">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215331">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215388">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215452">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215516">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215540">return</span>&nbsp;<span class="ident" id="4215547">nil</span><br>
<span class="lineno">320</span><span class="op" id="4215551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4215554">func</span>&nbsp;<span class="ident" id="4215559">readDirectoryEnd</span><span class="op" id="4215575">(</span><span class="ident" id="4215576">r</span>&nbsp;<span class="ident" id="4215578">io</span><span class="op" id="4215580">.</span><span class="ident" id="4215581">ReaderAt</span><span class="op" id="4215589">,</span>&nbsp;<span class="ident" id="4215591">size</span>&nbsp;<span class="ident" id="4215596">int64</span><span class="op" id="4215601">)</span>&nbsp;<span class="op" id="4215603">(</span><span class="ident" id="4215604">dir</span>&nbsp;<span class="op" id="4215608">*</span><span class="ident" id="4215609">directoryEnd</span><span class="op" id="4215621">,</span>&nbsp;<span class="ident" id="4215623">err</span>&nbsp;<span class="builtintype" id="4215627">error</span><span class="op" id="4215632">)</span>&nbsp;<span class="op" id="4215634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4215637">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215709">var</span>&nbsp;<span class="ident" id="4215713">buf</span>&nbsp;<span class="op" id="4215717">[</span><span class="op" id="4215718">]</span><span class="builtintype" id="4215719">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215725">var</span>&nbsp;<span class="ident" id="4215729">directoryEndOffset</span>&nbsp;<span class="ident" id="4215748">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215755">for</span>&nbsp;<span class="ident" id="4215759">i</span><span class="op" id="4215760">,</span>&nbsp;<span class="ident" id="4215762">bLen</span>&nbsp;<span class="op" id="4215767">:=</span>&nbsp;<span class="keyword" id="4215770">range</span>&nbsp;<span class="op" id="4215776">[</span><span class="op" id="4215777">]</span><span class="ident" id="4215778">int64</span><span class="op" id="4215783">{</span><span class="num" id="4215784">1024</span><span class="op" id="4215788">,</span>&nbsp;<span class="num" id="4215790">65</span>&nbsp;<span class="op" id="4215793">*</span>&nbsp;<span class="num" id="4215795">1024</span><span class="op" id="4215799">}</span>&nbsp;<span class="op" id="4215801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215805">if</span>&nbsp;<span class="ident" id="4215808">bLen</span>&nbsp;<span class="op" id="4215813">&gt;</span>&nbsp;<span class="ident" id="4215815">size</span>&nbsp;<span class="op" id="4215820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215825">bLen</span>&nbsp;<span class="op" id="4215830">=</span>&nbsp;<span class="ident" id="4215832">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215839">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215843">buf</span>&nbsp;<span class="op" id="4215847">=</span>&nbsp;<span class="builtinfunc" id="4215849">make</span><span class="op" id="4215853">(</span><span class="op" id="4215854">[</span><span class="op" id="4215855">]</span><span class="builtintype" id="4215856">byte</span><span class="op" id="4215860">,</span>&nbsp;<span class="builtintype" id="4215862">int</span><span class="op" id="4215865">(</span><span class="ident" id="4215866">bLen</span><span class="op" id="4215870">)</span><span class="op" id="4215871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215875">if</span>&nbsp;<span class="ident" id="4215878">_</span><span class="op" id="4215879">,</span>&nbsp;<span class="ident" id="4215881">err</span>&nbsp;<span class="op" id="4215885">:=</span>&nbsp;<span class="ident" id="4215888">r</span><span class="op" id="4215889">.</span><span class="ident" id="4215890">ReadAt</span><span class="op" id="4215896">(</span><span class="ident" id="4215897">buf</span><span class="op" id="4215900">,</span>&nbsp;<span class="ident" id="4215902">size</span><span class="op" id="4215906">-</span><span class="ident" id="4215907">bLen</span><span class="op" id="4215911">)</span><span class="op" id="4215912">;</span>&nbsp;<span class="ident" id="4215914">err</span>&nbsp;<span class="op" id="4215918">!=</span>&nbsp;<span class="ident" id="4215921">nil</span>&nbsp;<span class="op" id="4215925">&amp;&amp;</span>&nbsp;<span class="ident" id="4215928">err</span>&nbsp;<span class="op" id="4215932">!=</span>&nbsp;<span class="ident" id="4215935">io</span><span class="op" id="4215937">.</span><span class="ident" id="4215938">EOF</span>&nbsp;<span class="op" id="4215942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215947">return</span>&nbsp;<span class="ident" id="4215954">nil</span><span class="op" id="4215957">,</span>&nbsp;<span class="ident" id="4215959">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215969">if</span>&nbsp;<span class="ident" id="4215972">p</span>&nbsp;<span class="op" id="4215974">:=</span>&nbsp;<span class="ident" id="4215977">findSignatureInBlock</span><span class="op" id="4215997">(</span><span class="ident" id="4215998">buf</span><span class="op" id="4216001">)</span><span class="op" id="4216002">;</span>&nbsp;<span class="ident" id="4216004">p</span>&nbsp;<span class="op" id="4216006">&gt;=</span>&nbsp;<span class="num" id="4216009">0</span>&nbsp;<span class="op" id="4216011">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216016">buf</span>&nbsp;<span class="op" id="4216020">=</span>&nbsp;<span class="ident" id="4216022">buf</span><span class="op" id="4216025">[</span><span class="ident" id="4216026">p</span><span class="op" id="4216027">:</span><span class="op" id="4216028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216033">directoryEndOffset</span>&nbsp;<span class="op" id="4216052">=</span>&nbsp;<span class="ident" id="4216054">size</span>&nbsp;<span class="op" id="4216059">-</span>&nbsp;<span class="ident" id="4216061">bLen</span>&nbsp;<span class="op" id="4216066">+</span>&nbsp;<span class="ident" id="4216068">int64</span><span class="op" id="4216073">(</span><span class="ident" id="4216074">p</span><span class="op" id="4216075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216092">if</span>&nbsp;<span class="ident" id="4216095">i</span>&nbsp;<span class="op" id="4216097">==</span>&nbsp;<span class="num" id="4216100">1</span>&nbsp;<span class="op" id="4216102">||</span>&nbsp;<span class="ident" id="4216105">bLen</span>&nbsp;<span class="op" id="4216110">==</span>&nbsp;<span class="ident" id="4216113">size</span>&nbsp;<span class="op" id="4216118">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216123">return</span>&nbsp;<span class="ident" id="4216130">nil</span><span class="op" id="4216133">,</span>&nbsp;<span class="ident" id="4216135">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4216154">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216182">b</span>&nbsp;<span class="op" id="4216184">:=</span>&nbsp;<span class="ident" id="4216187">readBuf</span><span class="op" id="4216194">(</span><span class="ident" id="4216195">buf</span><span class="op" id="4216198">[</span><span class="num" id="4216199">4</span><span class="op" id="4216200">:</span><span class="op" id="4216201">]</span><span class="op" id="4216202">)</span>&nbsp;<span class="comment" id="4216204">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216223">d</span>&nbsp;<span class="op" id="4216225">:=</span>&nbsp;<span class="op" id="4216228">&amp;</span><span class="ident" id="4216229">directoryEnd</span><span class="op" id="4216241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216245">diskNbr</span><span class="op" id="4216252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4216265">uint32</span><span class="op" id="4216271">(</span><span class="ident" id="4216272">b</span><span class="op" id="4216273">.</span><span class="builtintype" id="4216274">uint16</span><span class="op" id="4216280">(</span><span class="op" id="4216281">)</span><span class="op" id="4216282">)</span><span class="op" id="4216283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216287">dirDiskNbr</span><span class="op" id="4216297">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4216307">uint32</span><span class="op" id="4216313">(</span><span class="ident" id="4216314">b</span><span class="op" id="4216315">.</span><span class="builtintype" id="4216316">uint16</span><span class="op" id="4216322">(</span><span class="op" id="4216323">)</span><span class="op" id="4216324">)</span><span class="op" id="4216325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216329">dirRecordsThisDisk</span><span class="op" id="4216347">:</span>&nbsp;<span class="ident" id="4216349">uint64</span><span class="op" id="4216355">(</span><span class="ident" id="4216356">b</span><span class="op" id="4216357">.</span><span class="builtintype" id="4216358">uint16</span><span class="op" id="4216364">(</span><span class="op" id="4216365">)</span><span class="op" id="4216366">)</span><span class="op" id="4216367">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216371">directoryRecords</span><span class="op" id="4216387">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4216391">uint64</span><span class="op" id="4216397">(</span><span class="ident" id="4216398">b</span><span class="op" id="4216399">.</span><span class="builtintype" id="4216400">uint16</span><span class="op" id="4216406">(</span><span class="op" id="4216407">)</span><span class="op" id="4216408">)</span><span class="op" id="4216409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216413">directorySize</span><span class="op" id="4216426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4216433">uint64</span><span class="op" id="4216439">(</span><span class="ident" id="4216440">b</span><span class="op" id="4216441">.</span><span class="builtintype" id="4216442">uint32</span><span class="op" id="4216448">(</span><span class="op" id="4216449">)</span><span class="op" id="4216450">)</span><span class="op" id="4216451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216455">directoryOffset</span><span class="op" id="4216470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4216475">uint64</span><span class="op" id="4216481">(</span><span class="ident" id="4216482">b</span><span class="op" id="4216483">.</span><span class="builtintype" id="4216484">uint32</span><span class="op" id="4216490">(</span><span class="op" id="4216491">)</span><span class="op" id="4216492">)</span><span class="op" id="4216493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216497">commentLen</span><span class="op" id="4216507">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4216517">b</span><span class="op" id="4216518">.</span><span class="builtintype" id="4216519">uint16</span><span class="op" id="4216525">(</span><span class="op" id="4216526">)</span><span class="op" id="4216527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216530">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216533">l</span>&nbsp;<span class="op" id="4216535">:=</span>&nbsp;<span class="builtintype" id="4216538">int</span><span class="op" id="4216541">(</span><span class="ident" id="4216542">d</span><span class="op" id="4216543">.</span><span class="ident" id="4216544">commentLen</span><span class="op" id="4216554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216557">if</span>&nbsp;<span class="ident" id="4216560">l</span>&nbsp;<span class="op" id="4216562">&gt;</span>&nbsp;<span class="builtinfunc" id="4216564">len</span><span class="op" id="4216567">(</span><span class="ident" id="4216568">b</span><span class="op" id="4216569">)</span>&nbsp;<span class="op" id="4216571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216575">return</span>&nbsp;<span class="ident" id="4216582">nil</span><span class="op" id="4216585">,</span>&nbsp;<span class="ident" id="4216587">errors</span><span class="op" id="4216593">.</span><span class="ident" id="4216594">New</span><span class="op" id="4216597">(</span><span class="string" id="4216598">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="4216627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216633">d</span><span class="op" id="4216634">.</span><span class="ident" id="4216635">comment</span>&nbsp;<span class="op" id="4216643">=</span>&nbsp;<span class="builtintype" id="4216645">string</span><span class="op" id="4216651">(</span><span class="ident" id="4216652">b</span><span class="op" id="4216653">[</span><span class="op" id="4216654">:</span><span class="ident" id="4216655">l</span><span class="op" id="4216656">]</span><span class="op" id="4216657">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216661">p</span><span class="op" id="4216662">,</span>&nbsp;<span class="ident" id="4216664">err</span>&nbsp;<span class="op" id="4216668">:=</span>&nbsp;<span class="ident" id="4216671">findDirectory64End</span><span class="op" id="4216689">(</span><span class="ident" id="4216690">r</span><span class="op" id="4216691">,</span>&nbsp;<span class="ident" id="4216693">directoryEndOffset</span><span class="op" id="4216711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216714">if</span>&nbsp;<span class="ident" id="4216717">err</span>&nbsp;<span class="op" id="4216721">==</span>&nbsp;<span class="ident" id="4216724">nil</span>&nbsp;<span class="op" id="4216728">&amp;&amp;</span>&nbsp;<span class="ident" id="4216731">p</span>&nbsp;<span class="op" id="4216733">&gt;=</span>&nbsp;<span class="num" id="4216736">0</span>&nbsp;<span class="op" id="4216738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216742">err</span>&nbsp;<span class="op" id="4216746">=</span>&nbsp;<span class="ident" id="4216748">readDirectory64End</span><span class="op" id="4216766">(</span><span class="ident" id="4216767">r</span><span class="op" id="4216768">,</span>&nbsp;<span class="ident" id="4216770">p</span><span class="op" id="4216771">,</span>&nbsp;<span class="ident" id="4216773">d</span><span class="op" id="4216774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216777">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216780">if</span>&nbsp;<span class="ident" id="4216783">err</span>&nbsp;<span class="op" id="4216787">!=</span>&nbsp;<span class="ident" id="4216790">nil</span>&nbsp;<span class="op" id="4216794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216798">return</span>&nbsp;<span class="ident" id="4216805">nil</span><span class="op" id="4216808">,</span>&nbsp;<span class="ident" id="4216810">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4216819">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216882">if</span>&nbsp;<span class="ident" id="4216885">o</span>&nbsp;<span class="op" id="4216887">:=</span>&nbsp;<span class="ident" id="4216890">int64</span><span class="op" id="4216895">(</span><span class="ident" id="4216896">d</span><span class="op" id="4216897">.</span><span class="ident" id="4216898">directoryOffset</span><span class="op" id="4216913">)</span><span class="op" id="4216914">;</span>&nbsp;<span class="ident" id="4216916">o</span>&nbsp;<span class="op" id="4216918">&lt;</span>&nbsp;<span class="num" id="4216920">0</span>&nbsp;<span class="op" id="4216922">||</span>&nbsp;<span class="ident" id="4216925">o</span>&nbsp;<span class="op" id="4216927">&gt;=</span>&nbsp;<span class="ident" id="4216930">size</span>&nbsp;<span class="op" id="4216935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216939">return</span>&nbsp;<span class="ident" id="4216946">nil</span><span class="op" id="4216949">,</span>&nbsp;<span class="ident" id="4216951">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216965">return</span>&nbsp;<span class="ident" id="4216972">d</span><span class="op" id="4216973">,</span>&nbsp;<span class="ident" id="4216975">nil</span><br>
<span class="lineno"></span><span class="op" id="4216979">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="4216982">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4217052">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4217122">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4217132">func</span>&nbsp;<span class="ident" id="4217137">findDirectory64End</span><span class="op" id="4217155">(</span><span class="ident" id="4217156">r</span>&nbsp;<span class="ident" id="4217158">io</span><span class="op" id="4217160">.</span><span class="ident" id="4217161">ReaderAt</span><span class="op" id="4217169">,</span>&nbsp;<span class="ident" id="4217171">directoryEndOffset</span>&nbsp;<span class="ident" id="4217190">int64</span><span class="op" id="4217195">)</span>&nbsp;<span class="op" id="4217197">(</span><span class="ident" id="4217198">int64</span><span class="op" id="4217203">,</span>&nbsp;<span class="builtintype" id="4217205">error</span><span class="op" id="4217210">)</span>&nbsp;<span class="op" id="4217212">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217215">locOffset</span>&nbsp;<span class="op" id="4217225">:=</span>&nbsp;<span class="ident" id="4217228">directoryEndOffset</span>&nbsp;<span class="op" id="4217247">-</span>&nbsp;<span class="ident" id="4217249">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217268">if</span>&nbsp;<span class="ident" id="4217271">locOffset</span>&nbsp;<span class="op" id="4217281">&lt;</span>&nbsp;<span class="num" id="4217283">0</span>&nbsp;<span class="op" id="4217285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217289">return</span>&nbsp;<span class="op" id="4217296">-</span><span class="num" id="4217297">1</span><span class="op" id="4217298">,</span>&nbsp;<span class="ident" id="4217300">nil</span>&nbsp;<span class="comment" id="4217304">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217357">buf</span>&nbsp;<span class="op" id="4217361">:=</span>&nbsp;<span class="builtinfunc" id="4217364">make</span><span class="op" id="4217368">(</span><span class="op" id="4217369">[</span><span class="op" id="4217370">]</span><span class="builtintype" id="4217371">byte</span><span class="op" id="4217375">,</span>&nbsp;<span class="ident" id="4217377">directory64LocLen</span><span class="op" id="4217394">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217397">if</span>&nbsp;<span class="ident" id="4217400">_</span><span class="op" id="4217401">,</span>&nbsp;<span class="ident" id="4217403">err</span>&nbsp;<span class="op" id="4217407">:=</span>&nbsp;<span class="ident" id="4217410">r</span><span class="op" id="4217411">.</span><span class="ident" id="4217412">ReadAt</span><span class="op" id="4217418">(</span><span class="ident" id="4217419">buf</span><span class="op" id="4217422">,</span>&nbsp;<span class="ident" id="4217424">locOffset</span><span class="op" id="4217433">)</span><span class="op" id="4217434">;</span>&nbsp;<span class="ident" id="4217436">err</span>&nbsp;<span class="op" id="4217440">!=</span>&nbsp;<span class="ident" id="4217443">nil</span>&nbsp;<span class="op" id="4217447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217451">return</span>&nbsp;<span class="op" id="4217458">-</span><span class="num" id="4217459">1</span><span class="op" id="4217460">,</span>&nbsp;<span class="ident" id="4217462">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217470">b</span>&nbsp;<span class="op" id="4217472">:=</span>&nbsp;<span class="ident" id="4217475">readBuf</span><span class="op" id="4217482">(</span><span class="ident" id="4217483">buf</span><span class="op" id="4217486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217489">if</span>&nbsp;<span class="ident" id="4217492">sig</span>&nbsp;<span class="op" id="4217496">:=</span>&nbsp;<span class="ident" id="4217499">b</span><span class="op" id="4217500">.</span><span class="builtintype" id="4217501">uint32</span><span class="op" id="4217507">(</span><span class="op" id="4217508">)</span><span class="op" id="4217509">;</span>&nbsp;<span class="ident" id="4217511">sig</span>&nbsp;<span class="op" id="4217515">!=</span>&nbsp;<span class="ident" id="4217518">directory64LocSignature</span>&nbsp;<span class="op" id="4217542">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217546">return</span>&nbsp;<span class="op" id="4217553">-</span><span class="num" id="4217554">1</span><span class="op" id="4217555">,</span>&nbsp;<span class="ident" id="4217557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217565">b</span>&nbsp;<span class="op" id="4217567">=</span>&nbsp;<span class="ident" id="4217569">b</span><span class="op" id="4217570">[</span><span class="num" id="4217571">4</span><span class="op" id="4217572">:</span><span class="op" id="4217573">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4217581">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217662">p</span>&nbsp;<span class="op" id="4217664">:=</span>&nbsp;<span class="ident" id="4217667">b</span><span class="op" id="4217668">.</span><span class="ident" id="4217669">uint64</span><span class="op" id="4217675">(</span><span class="op" id="4217676">)</span>&nbsp;<span class="comment" id="4217678">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217743">return</span>&nbsp;<span class="ident" id="4217750">int64</span><span class="op" id="4217755">(</span><span class="ident" id="4217756">p</span><span class="op" id="4217757">)</span><span class="op" id="4217758">,</span>&nbsp;<span class="ident" id="4217760">nil</span><br>
<span class="lineno">395</span><span class="op" id="4217764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4217767">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4217835">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4217889">func</span>&nbsp;<span class="ident" id="4217894">readDirectory64End</span><span class="op" id="4217912">(</span><span class="ident" id="4217913">r</span>&nbsp;<span class="ident" id="4217915">io</span><span class="op" id="4217917">.</span><span class="ident" id="4217918">ReaderAt</span><span class="op" id="4217926">,</span>&nbsp;<span class="ident" id="4217928">offset</span>&nbsp;<span class="ident" id="4217935">int64</span><span class="op" id="4217940">,</span>&nbsp;<span class="ident" id="4217942">d</span>&nbsp;<span class="op" id="4217944">*</span><span class="ident" id="4217945">directoryEnd</span><span class="op" id="4217957">)</span>&nbsp;<span class="op" id="4217959">(</span><span class="ident" id="4217960">err</span>&nbsp;<span class="builtintype" id="4217964">error</span><span class="op" id="4217969">)</span>&nbsp;<span class="op" id="4217971">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217974">buf</span>&nbsp;<span class="op" id="4217978">:=</span>&nbsp;<span class="builtinfunc" id="4217981">make</span><span class="op" id="4217985">(</span><span class="op" id="4217986">[</span><span class="op" id="4217987">]</span><span class="builtintype" id="4217988">byte</span><span class="op" id="4217992">,</span>&nbsp;<span class="ident" id="4217994">directory64EndLen</span><span class="op" id="4218011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218014">if</span>&nbsp;<span class="ident" id="4218017">_</span><span class="op" id="4218018">,</span>&nbsp;<span class="ident" id="4218020">err</span>&nbsp;<span class="op" id="4218024">:=</span>&nbsp;<span class="ident" id="4218027">r</span><span class="op" id="4218028">.</span><span class="ident" id="4218029">ReadAt</span><span class="op" id="4218035">(</span><span class="ident" id="4218036">buf</span><span class="op" id="4218039">,</span>&nbsp;<span class="ident" id="4218041">offset</span><span class="op" id="4218047">)</span><span class="op" id="4218048">;</span>&nbsp;<span class="ident" id="4218050">err</span>&nbsp;<span class="op" id="4218054">!=</span>&nbsp;<span class="ident" id="4218057">nil</span>&nbsp;<span class="op" id="4218061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218065">return</span>&nbsp;<span class="ident" id="4218072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4218077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218081">b</span>&nbsp;<span class="op" id="4218083">:=</span>&nbsp;<span class="ident" id="4218086">readBuf</span><span class="op" id="4218093">(</span><span class="ident" id="4218094">buf</span><span class="op" id="4218097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218100">if</span>&nbsp;<span class="ident" id="4218103">sig</span>&nbsp;<span class="op" id="4218107">:=</span>&nbsp;<span class="ident" id="4218110">b</span><span class="op" id="4218111">.</span><span class="builtintype" id="4218112">uint32</span><span class="op" id="4218118">(</span><span class="op" id="4218119">)</span><span class="op" id="4218120">;</span>&nbsp;<span class="ident" id="4218122">sig</span>&nbsp;<span class="op" id="4218126">!=</span>&nbsp;<span class="ident" id="4218129">directory64EndSignature</span>&nbsp;<span class="op" id="4218153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218157">return</span>&nbsp;<span class="ident" id="4218164">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4218175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218179">b</span>&nbsp;<span class="op" id="4218181">=</span>&nbsp;<span class="ident" id="4218183">b</span><span class="op" id="4218184">[</span><span class="num" id="4218185">12</span><span class="op" id="4218187">:</span><span class="op" id="4218188">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4218213">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218280">d</span><span class="op" id="4218281">.</span><span class="ident" id="4218282">diskNbr</span>&nbsp;<span class="op" id="4218290">=</span>&nbsp;<span class="ident" id="4218292">b</span><span class="op" id="4218293">.</span><span class="builtintype" id="4218294">uint32</span><span class="op" id="4218300">(</span><span class="op" id="4218301">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4218314">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218338">d</span><span class="op" id="4218339">.</span><span class="ident" id="4218340">dirDiskNbr</span>&nbsp;<span class="op" id="4218351">=</span>&nbsp;<span class="ident" id="4218353">b</span><span class="op" id="4218354">.</span><span class="builtintype" id="4218355">uint32</span><span class="op" id="4218361">(</span><span class="op" id="4218362">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4218372">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218435">d</span><span class="op" id="4218436">.</span><span class="ident" id="4218437">dirRecordsThisDisk</span>&nbsp;<span class="op" id="4218456">=</span>&nbsp;<span class="ident" id="4218458">b</span><span class="op" id="4218459">.</span><span class="ident" id="4218460">uint64</span><span class="op" id="4218466">(</span><span class="op" id="4218467">)</span>&nbsp;<span class="comment" id="4218469">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218535">d</span><span class="op" id="4218536">.</span><span class="ident" id="4218537">directoryRecords</span>&nbsp;<span class="op" id="4218554">=</span>&nbsp;<span class="ident" id="4218556">b</span><span class="op" id="4218557">.</span><span class="ident" id="4218558">uint64</span><span class="op" id="4218564">(</span><span class="op" id="4218565">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4218569">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218622">d</span><span class="op" id="4218623">.</span><span class="ident" id="4218624">directorySize</span>&nbsp;<span class="op" id="4218638">=</span>&nbsp;<span class="ident" id="4218640">b</span><span class="op" id="4218641">.</span><span class="ident" id="4218642">uint64</span><span class="op" id="4218648">(</span><span class="op" id="4218649">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4218656">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218690">d</span><span class="op" id="4218691">.</span><span class="ident" id="4218692">directoryOffset</span>&nbsp;<span class="op" id="4218708">=</span>&nbsp;<span class="ident" id="4218710">b</span><span class="op" id="4218711">.</span><span class="ident" id="4218712">uint64</span><span class="op" id="4218718">(</span><span class="op" id="4218719">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4218724">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218807">return</span>&nbsp;<span class="ident" id="4218814">nil</span><br>
<span class="lineno"></span><span class="op" id="4218818">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="4218821">func</span>&nbsp;<span class="ident" id="4218826">findSignatureInBlock</span><span class="op" id="4218846">(</span><span class="ident" id="4218847">b</span>&nbsp;<span class="op" id="4218849">[</span><span class="op" id="4218850">]</span><span class="builtintype" id="4218851">byte</span><span class="op" id="4218855">)</span>&nbsp;<span class="builtintype" id="4218857">int</span>&nbsp;<span class="op" id="4218861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218864">for</span>&nbsp;<span class="ident" id="4218868">i</span>&nbsp;<span class="op" id="4218870">:=</span>&nbsp;<span class="builtinfunc" id="4218873">len</span><span class="op" id="4218876">(</span><span class="ident" id="4218877">b</span><span class="op" id="4218878">)</span>&nbsp;<span class="op" id="4218880">-</span>&nbsp;<span class="ident" id="4218882">directoryEndLen</span><span class="op" id="4218897">;</span>&nbsp;<span class="ident" id="4218899">i</span>&nbsp;<span class="op" id="4218901">&gt;=</span>&nbsp;<span class="num" id="4218904">0</span><span class="op" id="4218905">;</span>&nbsp;<span class="ident" id="4218907">i</span><span class="op" id="4218908">--</span>&nbsp;<span class="op" id="4218911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4218915">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218968">if</span>&nbsp;<span class="ident" id="4218971">b</span><span class="op" id="4218972">[</span><span class="ident" id="4218973">i</span><span class="op" id="4218974">]</span>&nbsp;<span class="op" id="4218976">==</span>&nbsp;<span class="string" id="4218979">&#39;P&#39;</span>&nbsp;<span class="op" id="4218983">&amp;&amp;</span>&nbsp;<span class="ident" id="4218986">b</span><span class="op" id="4218987">[</span><span class="ident" id="4218988">i</span><span class="op" id="4218989">+</span><span class="num" id="4218990">1</span><span class="op" id="4218991">]</span>&nbsp;<span class="op" id="4218993">==</span>&nbsp;<span class="string" id="4218996">&#39;K&#39;</span>&nbsp;<span class="op" id="4219000">&amp;&amp;</span>&nbsp;<span class="ident" id="4219003">b</span><span class="op" id="4219004">[</span><span class="ident" id="4219005">i</span><span class="op" id="4219006">+</span><span class="num" id="4219007">2</span><span class="op" id="4219008">]</span>&nbsp;<span class="op" id="4219010">==</span>&nbsp;<span class="num" id="4219013">0x05</span>&nbsp;<span class="op" id="4219018">&amp;&amp;</span>&nbsp;<span class="ident" id="4219021">b</span><span class="op" id="4219022">[</span><span class="ident" id="4219023">i</span><span class="op" id="4219024">+</span><span class="num" id="4219025">3</span><span class="op" id="4219026">]</span>&nbsp;<span class="op" id="4219028">==</span>&nbsp;<span class="num" id="4219031">0x06</span>&nbsp;<span class="op" id="4219036">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4219041">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219070">n</span>&nbsp;<span class="op" id="4219072">:=</span>&nbsp;<span class="builtintype" id="4219075">int</span><span class="op" id="4219078">(</span><span class="ident" id="4219079">b</span><span class="op" id="4219080">[</span><span class="ident" id="4219081">i</span><span class="op" id="4219082">+</span><span class="ident" id="4219083">directoryEndLen</span><span class="op" id="4219098">-</span><span class="num" id="4219099">2</span><span class="op" id="4219100">]</span><span class="op" id="4219101">)</span>&nbsp;<span class="op" id="4219103">|</span>&nbsp;<span class="builtintype" id="4219105">int</span><span class="op" id="4219108">(</span><span class="ident" id="4219109">b</span><span class="op" id="4219110">[</span><span class="ident" id="4219111">i</span><span class="op" id="4219112">+</span><span class="ident" id="4219113">directoryEndLen</span><span class="op" id="4219128">-</span><span class="num" id="4219129">1</span><span class="op" id="4219130">]</span><span class="op" id="4219131">)</span><span class="op" id="4219132">&lt;&lt;</span><span class="num" id="4219134">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219139">if</span>&nbsp;<span class="ident" id="4219142">n</span><span class="op" id="4219143">+</span><span class="ident" id="4219144">directoryEndLen</span><span class="op" id="4219159">+</span><span class="ident" id="4219160">i</span>&nbsp;<span class="op" id="4219162">&lt;=</span>&nbsp;<span class="builtinfunc" id="4219165">len</span><span class="op" id="4219168">(</span><span class="ident" id="4219169">b</span><span class="op" id="4219170">)</span>&nbsp;<span class="op" id="4219172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219178">return</span>&nbsp;<span class="ident" id="4219185">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219190">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219200">return</span>&nbsp;<span class="op" id="4219207">-</span><span class="num" id="4219208">1</span><br>
<span class="lineno"></span><span class="op" id="4219210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4219213">type</span>&nbsp;<span class="ident" id="4219218">readBuf</span>&nbsp;<span class="op" id="4219226">[</span><span class="op" id="4219227">]</span><span class="builtintype" id="4219228">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4219234">func</span>&nbsp;<span class="op" id="4219239">(</span><span class="ident" id="4219240">b</span>&nbsp;<span class="op" id="4219242">*</span><span class="ident" id="4219243">readBuf</span><span class="op" id="4219250">)</span>&nbsp;<span class="builtintype" id="4219252">uint16</span><span class="op" id="4219258">(</span><span class="op" id="4219259">)</span>&nbsp;<span class="builtintype" id="4219261">uint16</span>&nbsp;<span class="op" id="4219268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219271">v</span>&nbsp;<span class="op" id="4219273">:=</span>&nbsp;<span class="ident" id="4219276">binary</span><span class="op" id="4219282">.</span><span class="ident" id="4219283">LittleEndian</span><span class="op" id="4219295">.</span><span class="ident" id="4219296">Uint16</span><span class="op" id="4219302">(</span><span class="op" id="4219303">*</span><span class="ident" id="4219304">b</span><span class="op" id="4219305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219308">*</span><span class="ident" id="4219309">b</span>&nbsp;<span class="op" id="4219311">=</span>&nbsp;<span class="op" id="4219313">(</span><span class="op" id="4219314">*</span><span class="ident" id="4219315">b</span><span class="op" id="4219316">)</span><span class="op" id="4219317">[</span><span class="num" id="4219318">2</span><span class="op" id="4219319">:</span><span class="op" id="4219320">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219323">return</span>&nbsp;<span class="ident" id="4219330">v</span><br>
<span class="lineno"></span><span class="op" id="4219332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4219335">func</span>&nbsp;<span class="op" id="4219340">(</span><span class="ident" id="4219341">b</span>&nbsp;<span class="op" id="4219343">*</span><span class="ident" id="4219344">readBuf</span><span class="op" id="4219351">)</span>&nbsp;<span class="builtintype" id="4219353">uint32</span><span class="op" id="4219359">(</span><span class="op" id="4219360">)</span>&nbsp;<span class="builtintype" id="4219362">uint32</span>&nbsp;<span class="op" id="4219369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219372">v</span>&nbsp;<span class="op" id="4219374">:=</span>&nbsp;<span class="ident" id="4219377">binary</span><span class="op" id="4219383">.</span><span class="ident" id="4219384">LittleEndian</span><span class="op" id="4219396">.</span><span class="ident" id="4219397">Uint32</span><span class="op" id="4219403">(</span><span class="op" id="4219404">*</span><span class="ident" id="4219405">b</span><span class="op" id="4219406">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219409">*</span><span class="ident" id="4219410">b</span>&nbsp;<span class="op" id="4219412">=</span>&nbsp;<span class="op" id="4219414">(</span><span class="op" id="4219415">*</span><span class="ident" id="4219416">b</span><span class="op" id="4219417">)</span><span class="op" id="4219418">[</span><span class="num" id="4219419">4</span><span class="op" id="4219420">:</span><span class="op" id="4219421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219424">return</span>&nbsp;<span class="ident" id="4219431">v</span><br>
<span class="lineno"></span><span class="op" id="4219433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4219436">func</span>&nbsp;<span class="op" id="4219441">(</span><span class="ident" id="4219442">b</span>&nbsp;<span class="op" id="4219444">*</span><span class="ident" id="4219445">readBuf</span><span class="op" id="4219452">)</span>&nbsp;<span class="ident" id="4219454">uint64</span><span class="op" id="4219460">(</span><span class="op" id="4219461">)</span>&nbsp;<span class="ident" id="4219463">uint64</span>&nbsp;<span class="op" id="4219470">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219473">v</span>&nbsp;<span class="op" id="4219475">:=</span>&nbsp;<span class="ident" id="4219478">binary</span><span class="op" id="4219484">.</span><span class="ident" id="4219485">LittleEndian</span><span class="op" id="4219497">.</span><span class="ident" id="4219498">Uint64</span><span class="op" id="4219504">(</span><span class="op" id="4219505">*</span><span class="ident" id="4219506">b</span><span class="op" id="4219507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219510">*</span><span class="ident" id="4219511">b</span>&nbsp;<span class="op" id="4219513">=</span>&nbsp;<span class="op" id="4219515">(</span><span class="op" id="4219516">*</span><span class="ident" id="4219517">b</span><span class="op" id="4219518">)</span><span class="op" id="4219519">[</span><span class="num" id="4219520">8</span><span class="op" id="4219521">:</span><span class="op" id="4219522">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219525">return</span>&nbsp;<span class="ident" id="4219532">v</span><br>
<span class="lineno"></span><span class="op" id="4219534">}</span>
</div>
</body>
</html>
