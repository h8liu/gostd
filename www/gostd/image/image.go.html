<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1788402">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1788457">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1788511">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1788562">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="1788617">//</span><br>
<span class="lineno"></span><span class="comment" id="1788620">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="1788698">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1788743">//</span><br>
<span class="lineno">10</span><span class="comment" id="1788746">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="1788824">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="1788903">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="1788979">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="1789050">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="1789127">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1789199">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1789223">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="1789302">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="1789334">//</span><br>
<span class="lineno">20</span><span class="comment" id="1789337">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="1789385">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="1789438">package</span>&nbsp;<span class="ident" id="1789446">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1789453">import</span>&nbsp;<span class="op" id="1789460">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1789463">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="1789477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1789480">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="1789535">type</span>&nbsp;<span class="ident" id="1789540">Config</span>&nbsp;<span class="keyword" id="1789547">struct</span>&nbsp;<span class="op" id="1789554">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1789557">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1789571">color</span><span class="op" id="1789576">.</span><span class="ident" id="1789577">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1789584">Width</span><span class="op" id="1789589">,</span>&nbsp;<span class="ident" id="1789591">Height</span>&nbsp;<span class="builtintype" id="1789598">int</span><br>
<span class="lineno"></span><span class="op" id="1789602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1789605">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="1789684">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="1789694">type</span>&nbsp;<span class="ident" id="1789699">Image</span>&nbsp;<span class="keyword" id="1789705">interface</span>&nbsp;<span class="op" id="1789715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1789718">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1789766">ColorModel</span><span class="op" id="1789776">(</span><span class="op" id="1789777">)</span>&nbsp;<span class="ident" id="1789779">color</span><span class="op" id="1789784">.</span><span class="ident" id="1789785">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1789792">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1789862">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1789922">Bounds</span><span class="op" id="1789928">(</span><span class="op" id="1789929">)</span>&nbsp;<span class="ident" id="1789931">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1789942">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1789991">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790072">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790144">At</span><span class="op" id="1790146">(</span><span class="ident" id="1790147">x</span><span class="op" id="1790148">,</span>&nbsp;<span class="ident" id="1790150">y</span>&nbsp;<span class="builtintype" id="1790152">int</span><span class="op" id="1790155">)</span>&nbsp;<span class="ident" id="1790157">color</span><span class="op" id="1790162">.</span><span class="ident" id="1790163">Color</span><br>
<span class="lineno"></span><span class="op" id="1790169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1790172">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="1790247">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="1790325">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1790400">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1790476">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="1790490">type</span>&nbsp;<span class="ident" id="1790495">PalettedImage</span>&nbsp;<span class="keyword" id="1790509">interface</span>&nbsp;<span class="op" id="1790519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790522">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790589">ColorIndexAt</span><span class="op" id="1790601">(</span><span class="ident" id="1790602">x</span><span class="op" id="1790603">,</span>&nbsp;<span class="ident" id="1790605">y</span>&nbsp;<span class="builtintype" id="1790607">int</span><span class="op" id="1790610">)</span>&nbsp;<span class="builtintype" id="1790612">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790619">Image</span><br>
<span class="lineno"></span><span class="op" id="1790625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1790628">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="1790701">type</span>&nbsp;<span class="ident" id="1790706">RGBA</span>&nbsp;<span class="keyword" id="1790711">struct</span>&nbsp;<span class="op" id="1790718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790721">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790789">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790857">Pix</span>&nbsp;<span class="op" id="1790861">[</span><span class="op" id="1790862">]</span><span class="builtintype" id="1790863">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790870">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790946">Stride</span>&nbsp;<span class="builtintype" id="1790953">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1790958">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1790990">Rect</span>&nbsp;<span class="ident" id="1790995">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1791005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="1791008">func</span>&nbsp;<span class="op" id="1791013">(</span><span class="ident" id="1791014">p</span>&nbsp;<span class="op" id="1791016">*</span><span class="ident" id="1791017">RGBA</span><span class="op" id="1791021">)</span>&nbsp;<span class="ident" id="1791023">ColorModel</span><span class="op" id="1791033">(</span><span class="op" id="1791034">)</span>&nbsp;<span class="ident" id="1791036">color</span><span class="op" id="1791041">.</span><span class="ident" id="1791042">Model</span>&nbsp;<span class="op" id="1791048">{</span>&nbsp;<span class="keyword" id="1791050">return</span>&nbsp;<span class="ident" id="1791057">color</span><span class="op" id="1791062">.</span><span class="ident" id="1791063">RGBAModel</span>&nbsp;<span class="op" id="1791073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1791076">func</span>&nbsp;<span class="op" id="1791081">(</span><span class="ident" id="1791082">p</span>&nbsp;<span class="op" id="1791084">*</span><span class="ident" id="1791085">RGBA</span><span class="op" id="1791089">)</span>&nbsp;<span class="ident" id="1791091">Bounds</span><span class="op" id="1791097">(</span><span class="op" id="1791098">)</span>&nbsp;<span class="ident" id="1791100">Rectangle</span>&nbsp;<span class="op" id="1791110">{</span>&nbsp;<span class="keyword" id="1791112">return</span>&nbsp;<span class="ident" id="1791119">p</span><span class="op" id="1791120">.</span><span class="ident" id="1791121">Rect</span>&nbsp;<span class="op" id="1791126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1791129">func</span>&nbsp;<span class="op" id="1791134">(</span><span class="ident" id="1791135">p</span>&nbsp;<span class="op" id="1791137">*</span><span class="ident" id="1791138">RGBA</span><span class="op" id="1791142">)</span>&nbsp;<span class="ident" id="1791144">At</span><span class="op" id="1791146">(</span><span class="ident" id="1791147">x</span><span class="op" id="1791148">,</span>&nbsp;<span class="ident" id="1791150">y</span>&nbsp;<span class="builtintype" id="1791152">int</span><span class="op" id="1791155">)</span>&nbsp;<span class="ident" id="1791157">color</span><span class="op" id="1791162">.</span><span class="ident" id="1791163">Color</span>&nbsp;<span class="op" id="1791169">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791172">return</span>&nbsp;<span class="ident" id="1791179">p</span><span class="op" id="1791180">.</span><span class="ident" id="1791181">RGBAAt</span><span class="op" id="1791187">(</span><span class="ident" id="1791188">x</span><span class="op" id="1791189">,</span>&nbsp;<span class="ident" id="1791191">y</span><span class="op" id="1791192">)</span><br>
<span class="lineno"></span><span class="op" id="1791194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1791197">func</span>&nbsp;<span class="op" id="1791202">(</span><span class="ident" id="1791203">p</span>&nbsp;<span class="op" id="1791205">*</span><span class="ident" id="1791206">RGBA</span><span class="op" id="1791210">)</span>&nbsp;<span class="ident" id="1791212">RGBAAt</span><span class="op" id="1791218">(</span><span class="ident" id="1791219">x</span><span class="op" id="1791220">,</span>&nbsp;<span class="ident" id="1791222">y</span>&nbsp;<span class="builtintype" id="1791224">int</span><span class="op" id="1791227">)</span>&nbsp;<span class="ident" id="1791229">color</span><span class="op" id="1791234">.</span><span class="ident" id="1791235">RGBA</span>&nbsp;<span class="op" id="1791240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791243">if</span>&nbsp;<span class="op" id="1791246">!</span><span class="op" id="1791247">(</span><span class="ident" id="1791248">Point</span><span class="op" id="1791253">{</span><span class="ident" id="1791254">x</span><span class="op" id="1791255">,</span>&nbsp;<span class="ident" id="1791257">y</span><span class="op" id="1791258">}</span><span class="op" id="1791259">.</span><span class="ident" id="1791260">In</span><span class="op" id="1791262">(</span><span class="ident" id="1791263">p</span><span class="op" id="1791264">.</span><span class="ident" id="1791265">Rect</span><span class="op" id="1791269">)</span><span class="op" id="1791270">)</span>&nbsp;<span class="op" id="1791272">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791276">return</span>&nbsp;<span class="ident" id="1791283">color</span><span class="op" id="1791288">.</span><span class="ident" id="1791289">RGBA</span><span class="op" id="1791293">{</span><span class="op" id="1791294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1791297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791300">i</span>&nbsp;<span class="op" id="1791302">:=</span>&nbsp;<span class="ident" id="1791305">p</span><span class="op" id="1791306">.</span><span class="ident" id="1791307">PixOffset</span><span class="op" id="1791316">(</span><span class="ident" id="1791317">x</span><span class="op" id="1791318">,</span>&nbsp;<span class="ident" id="1791320">y</span><span class="op" id="1791321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791324">return</span>&nbsp;<span class="ident" id="1791331">color</span><span class="op" id="1791336">.</span><span class="ident" id="1791337">RGBA</span><span class="op" id="1791341">{</span><span class="ident" id="1791342">p</span><span class="op" id="1791343">.</span><span class="ident" id="1791344">Pix</span><span class="op" id="1791347">[</span><span class="ident" id="1791348">i</span><span class="op" id="1791349">+</span><span class="num" id="1791350">0</span><span class="op" id="1791351">]</span><span class="op" id="1791352">,</span>&nbsp;<span class="ident" id="1791354">p</span><span class="op" id="1791355">.</span><span class="ident" id="1791356">Pix</span><span class="op" id="1791359">[</span><span class="ident" id="1791360">i</span><span class="op" id="1791361">+</span><span class="num" id="1791362">1</span><span class="op" id="1791363">]</span><span class="op" id="1791364">,</span>&nbsp;<span class="ident" id="1791366">p</span><span class="op" id="1791367">.</span><span class="ident" id="1791368">Pix</span><span class="op" id="1791371">[</span><span class="ident" id="1791372">i</span><span class="op" id="1791373">+</span><span class="num" id="1791374">2</span><span class="op" id="1791375">]</span><span class="op" id="1791376">,</span>&nbsp;<span class="ident" id="1791378">p</span><span class="op" id="1791379">.</span><span class="ident" id="1791380">Pix</span><span class="op" id="1791383">[</span><span class="ident" id="1791384">i</span><span class="op" id="1791385">+</span><span class="num" id="1791386">3</span><span class="op" id="1791387">]</span><span class="op" id="1791388">}</span><br>
<span class="lineno"></span><span class="op" id="1791390">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="1791393">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1791472">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1791496">func</span>&nbsp;<span class="op" id="1791501">(</span><span class="ident" id="1791502">p</span>&nbsp;<span class="op" id="1791504">*</span><span class="ident" id="1791505">RGBA</span><span class="op" id="1791509">)</span>&nbsp;<span class="ident" id="1791511">PixOffset</span><span class="op" id="1791520">(</span><span class="ident" id="1791521">x</span><span class="op" id="1791522">,</span>&nbsp;<span class="ident" id="1791524">y</span>&nbsp;<span class="builtintype" id="1791526">int</span><span class="op" id="1791529">)</span>&nbsp;<span class="builtintype" id="1791531">int</span>&nbsp;<span class="op" id="1791535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791538">return</span>&nbsp;<span class="op" id="1791545">(</span><span class="ident" id="1791546">y</span><span class="op" id="1791547">-</span><span class="ident" id="1791548">p</span><span class="op" id="1791549">.</span><span class="ident" id="1791550">Rect</span><span class="op" id="1791554">.</span><span class="ident" id="1791555">Min</span><span class="op" id="1791558">.</span><span class="ident" id="1791559">Y</span><span class="op" id="1791560">)</span><span class="op" id="1791561">*</span><span class="ident" id="1791562">p</span><span class="op" id="1791563">.</span><span class="ident" id="1791564">Stride</span>&nbsp;<span class="op" id="1791571">+</span>&nbsp;<span class="op" id="1791573">(</span><span class="ident" id="1791574">x</span><span class="op" id="1791575">-</span><span class="ident" id="1791576">p</span><span class="op" id="1791577">.</span><span class="ident" id="1791578">Rect</span><span class="op" id="1791582">.</span><span class="ident" id="1791583">Min</span><span class="op" id="1791586">.</span><span class="ident" id="1791587">X</span><span class="op" id="1791588">)</span><span class="op" id="1791589">*</span><span class="num" id="1791590">4</span><br>
<span class="lineno">90</span><span class="op" id="1791592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1791595">func</span>&nbsp;<span class="op" id="1791600">(</span><span class="ident" id="1791601">p</span>&nbsp;<span class="op" id="1791603">*</span><span class="ident" id="1791604">RGBA</span><span class="op" id="1791608">)</span>&nbsp;<span class="ident" id="1791610">Set</span><span class="op" id="1791613">(</span><span class="ident" id="1791614">x</span><span class="op" id="1791615">,</span>&nbsp;<span class="ident" id="1791617">y</span>&nbsp;<span class="builtintype" id="1791619">int</span><span class="op" id="1791622">,</span>&nbsp;<span class="ident" id="1791624">c</span>&nbsp;<span class="ident" id="1791626">color</span><span class="op" id="1791631">.</span><span class="ident" id="1791632">Color</span><span class="op" id="1791637">)</span>&nbsp;<span class="op" id="1791639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791642">if</span>&nbsp;<span class="op" id="1791645">!</span><span class="op" id="1791646">(</span><span class="ident" id="1791647">Point</span><span class="op" id="1791652">{</span><span class="ident" id="1791653">x</span><span class="op" id="1791654">,</span>&nbsp;<span class="ident" id="1791656">y</span><span class="op" id="1791657">}</span><span class="op" id="1791658">.</span><span class="ident" id="1791659">In</span><span class="op" id="1791661">(</span><span class="ident" id="1791662">p</span><span class="op" id="1791663">.</span><span class="ident" id="1791664">Rect</span><span class="op" id="1791668">)</span><span class="op" id="1791669">)</span>&nbsp;<span class="op" id="1791671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791675">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1791683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791686">i</span>&nbsp;<span class="op" id="1791688">:=</span>&nbsp;<span class="ident" id="1791691">p</span><span class="op" id="1791692">.</span><span class="ident" id="1791693">PixOffset</span><span class="op" id="1791702">(</span><span class="ident" id="1791703">x</span><span class="op" id="1791704">,</span>&nbsp;<span class="ident" id="1791706">y</span><span class="op" id="1791707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791710">c1</span>&nbsp;<span class="op" id="1791713">:=</span>&nbsp;<span class="ident" id="1791716">color</span><span class="op" id="1791721">.</span><span class="ident" id="1791722">RGBAModel</span><span class="op" id="1791731">.</span><span class="ident" id="1791732">Convert</span><span class="op" id="1791739">(</span><span class="ident" id="1791740">c</span><span class="op" id="1791741">)</span><span class="op" id="1791742">.</span><span class="op" id="1791743">(</span><span class="ident" id="1791744">color</span><span class="op" id="1791749">.</span><span class="ident" id="1791750">RGBA</span><span class="op" id="1791754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791757">p</span><span class="op" id="1791758">.</span><span class="ident" id="1791759">Pix</span><span class="op" id="1791762">[</span><span class="ident" id="1791763">i</span><span class="op" id="1791764">+</span><span class="num" id="1791765">0</span><span class="op" id="1791766">]</span>&nbsp;<span class="op" id="1791768">=</span>&nbsp;<span class="ident" id="1791770">c1</span><span class="op" id="1791772">.</span><span class="ident" id="1791773">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791776">p</span><span class="op" id="1791777">.</span><span class="ident" id="1791778">Pix</span><span class="op" id="1791781">[</span><span class="ident" id="1791782">i</span><span class="op" id="1791783">+</span><span class="num" id="1791784">1</span><span class="op" id="1791785">]</span>&nbsp;<span class="op" id="1791787">=</span>&nbsp;<span class="ident" id="1791789">c1</span><span class="op" id="1791791">.</span><span class="ident" id="1791792">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791795">p</span><span class="op" id="1791796">.</span><span class="ident" id="1791797">Pix</span><span class="op" id="1791800">[</span><span class="ident" id="1791801">i</span><span class="op" id="1791802">+</span><span class="num" id="1791803">2</span><span class="op" id="1791804">]</span>&nbsp;<span class="op" id="1791806">=</span>&nbsp;<span class="ident" id="1791808">c1</span><span class="op" id="1791810">.</span><span class="ident" id="1791811">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791814">p</span><span class="op" id="1791815">.</span><span class="ident" id="1791816">Pix</span><span class="op" id="1791819">[</span><span class="ident" id="1791820">i</span><span class="op" id="1791821">+</span><span class="num" id="1791822">3</span><span class="op" id="1791823">]</span>&nbsp;<span class="op" id="1791825">=</span>&nbsp;<span class="ident" id="1791827">c1</span><span class="op" id="1791829">.</span><span class="ident" id="1791830">A</span><br>
<span class="lineno"></span><span class="op" id="1791832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1791835">func</span>&nbsp;<span class="op" id="1791840">(</span><span class="ident" id="1791841">p</span>&nbsp;<span class="op" id="1791843">*</span><span class="ident" id="1791844">RGBA</span><span class="op" id="1791848">)</span>&nbsp;<span class="ident" id="1791850">SetRGBA</span><span class="op" id="1791857">(</span><span class="ident" id="1791858">x</span><span class="op" id="1791859">,</span>&nbsp;<span class="ident" id="1791861">y</span>&nbsp;<span class="builtintype" id="1791863">int</span><span class="op" id="1791866">,</span>&nbsp;<span class="ident" id="1791868">c</span>&nbsp;<span class="ident" id="1791870">color</span><span class="op" id="1791875">.</span><span class="ident" id="1791876">RGBA</span><span class="op" id="1791880">)</span>&nbsp;<span class="op" id="1791882">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791885">if</span>&nbsp;<span class="op" id="1791888">!</span><span class="op" id="1791889">(</span><span class="ident" id="1791890">Point</span><span class="op" id="1791895">{</span><span class="ident" id="1791896">x</span><span class="op" id="1791897">,</span>&nbsp;<span class="ident" id="1791899">y</span><span class="op" id="1791900">}</span><span class="op" id="1791901">.</span><span class="ident" id="1791902">In</span><span class="op" id="1791904">(</span><span class="ident" id="1791905">p</span><span class="op" id="1791906">.</span><span class="ident" id="1791907">Rect</span><span class="op" id="1791911">)</span><span class="op" id="1791912">)</span>&nbsp;<span class="op" id="1791914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1791918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1791926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791929">i</span>&nbsp;<span class="op" id="1791931">:=</span>&nbsp;<span class="ident" id="1791934">p</span><span class="op" id="1791935">.</span><span class="ident" id="1791936">PixOffset</span><span class="op" id="1791945">(</span><span class="ident" id="1791946">x</span><span class="op" id="1791947">,</span>&nbsp;<span class="ident" id="1791949">y</span><span class="op" id="1791950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791953">p</span><span class="op" id="1791954">.</span><span class="ident" id="1791955">Pix</span><span class="op" id="1791958">[</span><span class="ident" id="1791959">i</span><span class="op" id="1791960">+</span><span class="num" id="1791961">0</span><span class="op" id="1791962">]</span>&nbsp;<span class="op" id="1791964">=</span>&nbsp;<span class="ident" id="1791966">c</span><span class="op" id="1791967">.</span><span class="ident" id="1791968">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791971">p</span><span class="op" id="1791972">.</span><span class="ident" id="1791973">Pix</span><span class="op" id="1791976">[</span><span class="ident" id="1791977">i</span><span class="op" id="1791978">+</span><span class="num" id="1791979">1</span><span class="op" id="1791980">]</span>&nbsp;<span class="op" id="1791982">=</span>&nbsp;<span class="ident" id="1791984">c</span><span class="op" id="1791985">.</span><span class="ident" id="1791986">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1791989">p</span><span class="op" id="1791990">.</span><span class="ident" id="1791991">Pix</span><span class="op" id="1791994">[</span><span class="ident" id="1791995">i</span><span class="op" id="1791996">+</span><span class="num" id="1791997">2</span><span class="op" id="1791998">]</span>&nbsp;<span class="op" id="1792000">=</span>&nbsp;<span class="ident" id="1792002">c</span><span class="op" id="1792003">.</span><span class="ident" id="1792004">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792007">p</span><span class="op" id="1792008">.</span><span class="ident" id="1792009">Pix</span><span class="op" id="1792012">[</span><span class="ident" id="1792013">i</span><span class="op" id="1792014">+</span><span class="num" id="1792015">3</span><span class="op" id="1792016">]</span>&nbsp;<span class="op" id="1792018">=</span>&nbsp;<span class="ident" id="1792020">c</span><span class="op" id="1792021">.</span><span class="ident" id="1792022">A</span><br>
<span class="lineno"></span><span class="op" id="1792024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="1792027">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1792104">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1792176">func</span>&nbsp;<span class="op" id="1792181">(</span><span class="ident" id="1792182">p</span>&nbsp;<span class="op" id="1792184">*</span><span class="ident" id="1792185">RGBA</span><span class="op" id="1792189">)</span>&nbsp;<span class="ident" id="1792191">SubImage</span><span class="op" id="1792199">(</span><span class="ident" id="1792200">r</span>&nbsp;<span class="ident" id="1792202">Rectangle</span><span class="op" id="1792211">)</span>&nbsp;<span class="ident" id="1792213">Image</span>&nbsp;<span class="op" id="1792219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792222">r</span>&nbsp;<span class="op" id="1792224">=</span>&nbsp;<span class="ident" id="1792226">r</span><span class="op" id="1792227">.</span><span class="ident" id="1792228">Intersect</span><span class="op" id="1792237">(</span><span class="ident" id="1792238">p</span><span class="op" id="1792239">.</span><span class="ident" id="1792240">Rect</span><span class="op" id="1792244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1792247">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1792328">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1792410">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792460">if</span>&nbsp;<span class="ident" id="1792463">r</span><span class="op" id="1792464">.</span><span class="ident" id="1792465">Empty</span><span class="op" id="1792470">(</span><span class="op" id="1792471">)</span>&nbsp;<span class="op" id="1792473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792477">return</span>&nbsp;<span class="op" id="1792484">&amp;</span><span class="ident" id="1792485">RGBA</span><span class="op" id="1792489">{</span><span class="op" id="1792490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792493">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792496">i</span>&nbsp;<span class="op" id="1792498">:=</span>&nbsp;<span class="ident" id="1792501">p</span><span class="op" id="1792502">.</span><span class="ident" id="1792503">PixOffset</span><span class="op" id="1792512">(</span><span class="ident" id="1792513">r</span><span class="op" id="1792514">.</span><span class="ident" id="1792515">Min</span><span class="op" id="1792518">.</span><span class="ident" id="1792519">X</span><span class="op" id="1792520">,</span>&nbsp;<span class="ident" id="1792522">r</span><span class="op" id="1792523">.</span><span class="ident" id="1792524">Min</span><span class="op" id="1792527">.</span><span class="ident" id="1792528">Y</span><span class="op" id="1792529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792532">return</span>&nbsp;<span class="op" id="1792539">&amp;</span><span class="ident" id="1792540">RGBA</span><span class="op" id="1792544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792548">Pix</span><span class="op" id="1792551">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792556">p</span><span class="op" id="1792557">.</span><span class="ident" id="1792558">Pix</span><span class="op" id="1792561">[</span><span class="ident" id="1792562">i</span><span class="op" id="1792563">:</span><span class="op" id="1792564">]</span><span class="op" id="1792565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792569">Stride</span><span class="op" id="1792575">:</span>&nbsp;<span class="ident" id="1792577">p</span><span class="op" id="1792578">.</span><span class="ident" id="1792579">Stride</span><span class="op" id="1792585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792589">Rect</span><span class="op" id="1792593">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1792597">r</span><span class="op" id="1792598">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792601">}</span><br>
<span class="lineno"></span><span class="op" id="1792603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1792606">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1792679">func</span>&nbsp;<span class="op" id="1792684">(</span><span class="ident" id="1792685">p</span>&nbsp;<span class="op" id="1792687">*</span><span class="ident" id="1792688">RGBA</span><span class="op" id="1792692">)</span>&nbsp;<span class="ident" id="1792694">Opaque</span><span class="op" id="1792700">(</span><span class="op" id="1792701">)</span>&nbsp;<span class="builtintype" id="1792703">bool</span>&nbsp;<span class="op" id="1792708">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792711">if</span>&nbsp;<span class="ident" id="1792714">p</span><span class="op" id="1792715">.</span><span class="ident" id="1792716">Rect</span><span class="op" id="1792720">.</span><span class="ident" id="1792721">Empty</span><span class="op" id="1792726">(</span><span class="op" id="1792727">)</span>&nbsp;<span class="op" id="1792729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792733">return</span>&nbsp;<span class="builtintype" id="1792740">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792749">i0</span><span class="op" id="1792751">,</span>&nbsp;<span class="ident" id="1792753">i1</span>&nbsp;<span class="op" id="1792756">:=</span>&nbsp;<span class="num" id="1792759">3</span><span class="op" id="1792760">,</span>&nbsp;<span class="ident" id="1792762">p</span><span class="op" id="1792763">.</span><span class="ident" id="1792764">Rect</span><span class="op" id="1792768">.</span><span class="ident" id="1792769">Dx</span><span class="op" id="1792771">(</span><span class="op" id="1792772">)</span><span class="op" id="1792773">*</span><span class="num" id="1792774">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792777">for</span>&nbsp;<span class="ident" id="1792781">y</span>&nbsp;<span class="op" id="1792783">:=</span>&nbsp;<span class="ident" id="1792786">p</span><span class="op" id="1792787">.</span><span class="ident" id="1792788">Rect</span><span class="op" id="1792792">.</span><span class="ident" id="1792793">Min</span><span class="op" id="1792796">.</span><span class="ident" id="1792797">Y</span><span class="op" id="1792798">;</span>&nbsp;<span class="ident" id="1792800">y</span>&nbsp;<span class="op" id="1792802">&lt;</span>&nbsp;<span class="ident" id="1792804">p</span><span class="op" id="1792805">.</span><span class="ident" id="1792806">Rect</span><span class="op" id="1792810">.</span><span class="ident" id="1792811">Max</span><span class="op" id="1792814">.</span><span class="ident" id="1792815">Y</span><span class="op" id="1792816">;</span>&nbsp;<span class="ident" id="1792818">y</span><span class="op" id="1792819">++</span>&nbsp;<span class="op" id="1792822">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792826">for</span>&nbsp;<span class="ident" id="1792830">i</span>&nbsp;<span class="op" id="1792832">:=</span>&nbsp;<span class="ident" id="1792835">i0</span><span class="op" id="1792837">;</span>&nbsp;<span class="ident" id="1792839">i</span>&nbsp;<span class="op" id="1792841">&lt;</span>&nbsp;<span class="ident" id="1792843">i1</span><span class="op" id="1792845">;</span>&nbsp;<span class="ident" id="1792847">i</span>&nbsp;<span class="op" id="1792849">+=</span>&nbsp;<span class="num" id="1792852">4</span>&nbsp;<span class="op" id="1792854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792859">if</span>&nbsp;<span class="ident" id="1792862">p</span><span class="op" id="1792863">.</span><span class="ident" id="1792864">Pix</span><span class="op" id="1792867">[</span><span class="ident" id="1792868">i</span><span class="op" id="1792869">]</span>&nbsp;<span class="op" id="1792871">!=</span>&nbsp;<span class="num" id="1792874">0xff</span>&nbsp;<span class="op" id="1792879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792885">return</span>&nbsp;<span class="builtintype" id="1792892">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792905">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792909">i0</span>&nbsp;<span class="op" id="1792912">+=</span>&nbsp;<span class="ident" id="1792915">p</span><span class="op" id="1792916">.</span><span class="ident" id="1792917">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1792926">i1</span>&nbsp;<span class="op" id="1792929">+=</span>&nbsp;<span class="ident" id="1792932">p</span><span class="op" id="1792933">.</span><span class="ident" id="1792934">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1792942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1792945">return</span>&nbsp;<span class="builtintype" id="1792952">true</span><br>
<span class="lineno"></span><span class="op" id="1792957">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="1792960">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1793013">func</span>&nbsp;<span class="ident" id="1793018">NewRGBA</span><span class="op" id="1793025">(</span><span class="ident" id="1793026">r</span>&nbsp;<span class="ident" id="1793028">Rectangle</span><span class="op" id="1793037">)</span>&nbsp;<span class="op" id="1793039">*</span><span class="ident" id="1793040">RGBA</span>&nbsp;<span class="op" id="1793045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793048">w</span><span class="op" id="1793049">,</span>&nbsp;<span class="ident" id="1793051">h</span>&nbsp;<span class="op" id="1793053">:=</span>&nbsp;<span class="ident" id="1793056">r</span><span class="op" id="1793057">.</span><span class="ident" id="1793058">Dx</span><span class="op" id="1793060">(</span><span class="op" id="1793061">)</span><span class="op" id="1793062">,</span>&nbsp;<span class="ident" id="1793064">r</span><span class="op" id="1793065">.</span><span class="ident" id="1793066">Dy</span><span class="op" id="1793068">(</span><span class="op" id="1793069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793072">buf</span>&nbsp;<span class="op" id="1793076">:=</span>&nbsp;<span class="builtinfunc" id="1793079">make</span><span class="op" id="1793083">(</span><span class="op" id="1793084">[</span><span class="op" id="1793085">]</span><span class="builtintype" id="1793086">uint8</span><span class="op" id="1793091">,</span>&nbsp;<span class="num" id="1793093">4</span><span class="op" id="1793094">*</span><span class="ident" id="1793095">w</span><span class="op" id="1793096">*</span><span class="ident" id="1793097">h</span><span class="op" id="1793098">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1793101">return</span>&nbsp;<span class="op" id="1793108">&amp;</span><span class="ident" id="1793109">RGBA</span><span class="op" id="1793113">{</span><span class="ident" id="1793114">buf</span><span class="op" id="1793117">,</span>&nbsp;<span class="num" id="1793119">4</span>&nbsp;<span class="op" id="1793121">*</span>&nbsp;<span class="ident" id="1793123">w</span><span class="op" id="1793124">,</span>&nbsp;<span class="ident" id="1793126">r</span><span class="op" id="1793127">}</span><br>
<span class="lineno"></span><span class="op" id="1793129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1793132">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1793209">type</span>&nbsp;<span class="ident" id="1793214">RGBA64</span>&nbsp;<span class="keyword" id="1793221">struct</span>&nbsp;<span class="op" id="1793228">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1793231">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1793321">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793389">Pix</span>&nbsp;<span class="op" id="1793393">[</span><span class="op" id="1793394">]</span><span class="builtintype" id="1793395">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1793402">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793478">Stride</span>&nbsp;<span class="builtintype" id="1793485">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1793490">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793522">Rect</span>&nbsp;<span class="ident" id="1793527">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1793537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1793540">func</span>&nbsp;<span class="op" id="1793545">(</span><span class="ident" id="1793546">p</span>&nbsp;<span class="op" id="1793548">*</span><span class="ident" id="1793549">RGBA64</span><span class="op" id="1793555">)</span>&nbsp;<span class="ident" id="1793557">ColorModel</span><span class="op" id="1793567">(</span><span class="op" id="1793568">)</span>&nbsp;<span class="ident" id="1793570">color</span><span class="op" id="1793575">.</span><span class="ident" id="1793576">Model</span>&nbsp;<span class="op" id="1793582">{</span>&nbsp;<span class="keyword" id="1793584">return</span>&nbsp;<span class="ident" id="1793591">color</span><span class="op" id="1793596">.</span><span class="ident" id="1793597">RGBA64Model</span>&nbsp;<span class="op" id="1793609">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="1793612">func</span>&nbsp;<span class="op" id="1793617">(</span><span class="ident" id="1793618">p</span>&nbsp;<span class="op" id="1793620">*</span><span class="ident" id="1793621">RGBA64</span><span class="op" id="1793627">)</span>&nbsp;<span class="ident" id="1793629">Bounds</span><span class="op" id="1793635">(</span><span class="op" id="1793636">)</span>&nbsp;<span class="ident" id="1793638">Rectangle</span>&nbsp;<span class="op" id="1793648">{</span>&nbsp;<span class="keyword" id="1793650">return</span>&nbsp;<span class="ident" id="1793657">p</span><span class="op" id="1793658">.</span><span class="ident" id="1793659">Rect</span>&nbsp;<span class="op" id="1793664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1793667">func</span>&nbsp;<span class="op" id="1793672">(</span><span class="ident" id="1793673">p</span>&nbsp;<span class="op" id="1793675">*</span><span class="ident" id="1793676">RGBA64</span><span class="op" id="1793682">)</span>&nbsp;<span class="ident" id="1793684">At</span><span class="op" id="1793686">(</span><span class="ident" id="1793687">x</span><span class="op" id="1793688">,</span>&nbsp;<span class="ident" id="1793690">y</span>&nbsp;<span class="builtintype" id="1793692">int</span><span class="op" id="1793695">)</span>&nbsp;<span class="ident" id="1793697">color</span><span class="op" id="1793702">.</span><span class="ident" id="1793703">Color</span>&nbsp;<span class="op" id="1793709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1793712">return</span>&nbsp;<span class="ident" id="1793719">p</span><span class="op" id="1793720">.</span><span class="ident" id="1793721">RGBA64At</span><span class="op" id="1793729">(</span><span class="ident" id="1793730">x</span><span class="op" id="1793731">,</span>&nbsp;<span class="ident" id="1793733">y</span><span class="op" id="1793734">)</span><br>
<span class="lineno">175</span><span class="op" id="1793736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1793739">func</span>&nbsp;<span class="op" id="1793744">(</span><span class="ident" id="1793745">p</span>&nbsp;<span class="op" id="1793747">*</span><span class="ident" id="1793748">RGBA64</span><span class="op" id="1793754">)</span>&nbsp;<span class="ident" id="1793756">RGBA64At</span><span class="op" id="1793764">(</span><span class="ident" id="1793765">x</span><span class="op" id="1793766">,</span>&nbsp;<span class="ident" id="1793768">y</span>&nbsp;<span class="builtintype" id="1793770">int</span><span class="op" id="1793773">)</span>&nbsp;<span class="ident" id="1793775">color</span><span class="op" id="1793780">.</span><span class="ident" id="1793781">RGBA64</span>&nbsp;<span class="op" id="1793788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1793791">if</span>&nbsp;<span class="op" id="1793794">!</span><span class="op" id="1793795">(</span><span class="ident" id="1793796">Point</span><span class="op" id="1793801">{</span><span class="ident" id="1793802">x</span><span class="op" id="1793803">,</span>&nbsp;<span class="ident" id="1793805">y</span><span class="op" id="1793806">}</span><span class="op" id="1793807">.</span><span class="ident" id="1793808">In</span><span class="op" id="1793810">(</span><span class="ident" id="1793811">p</span><span class="op" id="1793812">.</span><span class="ident" id="1793813">Rect</span><span class="op" id="1793817">)</span><span class="op" id="1793818">)</span>&nbsp;<span class="op" id="1793820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1793824">return</span>&nbsp;<span class="ident" id="1793831">color</span><span class="op" id="1793836">.</span><span class="ident" id="1793837">RGBA64</span><span class="op" id="1793843">{</span><span class="op" id="1793844">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1793847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1793850">i</span>&nbsp;<span class="op" id="1793852">:=</span>&nbsp;<span class="ident" id="1793855">p</span><span class="op" id="1793856">.</span><span class="ident" id="1793857">PixOffset</span><span class="op" id="1793866">(</span><span class="ident" id="1793867">x</span><span class="op" id="1793868">,</span>&nbsp;<span class="ident" id="1793870">y</span><span class="op" id="1793871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1793874">return</span>&nbsp;<span class="ident" id="1793881">color</span><span class="op" id="1793886">.</span><span class="ident" id="1793887">RGBA64</span><span class="op" id="1793893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1793897">uint16</span><span class="op" id="1793903">(</span><span class="ident" id="1793904">p</span><span class="op" id="1793905">.</span><span class="ident" id="1793906">Pix</span><span class="op" id="1793909">[</span><span class="ident" id="1793910">i</span><span class="op" id="1793911">+</span><span class="num" id="1793912">0</span><span class="op" id="1793913">]</span><span class="op" id="1793914">)</span><span class="op" id="1793915">&lt;&lt;</span><span class="num" id="1793917">8</span>&nbsp;<span class="op" id="1793919">|</span>&nbsp;<span class="builtintype" id="1793921">uint16</span><span class="op" id="1793927">(</span><span class="ident" id="1793928">p</span><span class="op" id="1793929">.</span><span class="ident" id="1793930">Pix</span><span class="op" id="1793933">[</span><span class="ident" id="1793934">i</span><span class="op" id="1793935">+</span><span class="num" id="1793936">1</span><span class="op" id="1793937">]</span><span class="op" id="1793938">)</span><span class="op" id="1793939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1793943">uint16</span><span class="op" id="1793949">(</span><span class="ident" id="1793950">p</span><span class="op" id="1793951">.</span><span class="ident" id="1793952">Pix</span><span class="op" id="1793955">[</span><span class="ident" id="1793956">i</span><span class="op" id="1793957">+</span><span class="num" id="1793958">2</span><span class="op" id="1793959">]</span><span class="op" id="1793960">)</span><span class="op" id="1793961">&lt;&lt;</span><span class="num" id="1793963">8</span>&nbsp;<span class="op" id="1793965">|</span>&nbsp;<span class="builtintype" id="1793967">uint16</span><span class="op" id="1793973">(</span><span class="ident" id="1793974">p</span><span class="op" id="1793975">.</span><span class="ident" id="1793976">Pix</span><span class="op" id="1793979">[</span><span class="ident" id="1793980">i</span><span class="op" id="1793981">+</span><span class="num" id="1793982">3</span><span class="op" id="1793983">]</span><span class="op" id="1793984">)</span><span class="op" id="1793985">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1793989">uint16</span><span class="op" id="1793995">(</span><span class="ident" id="1793996">p</span><span class="op" id="1793997">.</span><span class="ident" id="1793998">Pix</span><span class="op" id="1794001">[</span><span class="ident" id="1794002">i</span><span class="op" id="1794003">+</span><span class="num" id="1794004">4</span><span class="op" id="1794005">]</span><span class="op" id="1794006">)</span><span class="op" id="1794007">&lt;&lt;</span><span class="num" id="1794009">8</span>&nbsp;<span class="op" id="1794011">|</span>&nbsp;<span class="builtintype" id="1794013">uint16</span><span class="op" id="1794019">(</span><span class="ident" id="1794020">p</span><span class="op" id="1794021">.</span><span class="ident" id="1794022">Pix</span><span class="op" id="1794025">[</span><span class="ident" id="1794026">i</span><span class="op" id="1794027">+</span><span class="num" id="1794028">5</span><span class="op" id="1794029">]</span><span class="op" id="1794030">)</span><span class="op" id="1794031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1794035">uint16</span><span class="op" id="1794041">(</span><span class="ident" id="1794042">p</span><span class="op" id="1794043">.</span><span class="ident" id="1794044">Pix</span><span class="op" id="1794047">[</span><span class="ident" id="1794048">i</span><span class="op" id="1794049">+</span><span class="num" id="1794050">6</span><span class="op" id="1794051">]</span><span class="op" id="1794052">)</span><span class="op" id="1794053">&lt;&lt;</span><span class="num" id="1794055">8</span>&nbsp;<span class="op" id="1794057">|</span>&nbsp;<span class="builtintype" id="1794059">uint16</span><span class="op" id="1794065">(</span><span class="ident" id="1794066">p</span><span class="op" id="1794067">.</span><span class="ident" id="1794068">Pix</span><span class="op" id="1794071">[</span><span class="ident" id="1794072">i</span><span class="op" id="1794073">+</span><span class="num" id="1794074">7</span><span class="op" id="1794075">]</span><span class="op" id="1794076">)</span><span class="op" id="1794077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1794080">}</span><br>
<span class="lineno"></span><span class="op" id="1794082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="1794085">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1794164">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1794188">func</span>&nbsp;<span class="op" id="1794193">(</span><span class="ident" id="1794194">p</span>&nbsp;<span class="op" id="1794196">*</span><span class="ident" id="1794197">RGBA64</span><span class="op" id="1794203">)</span>&nbsp;<span class="ident" id="1794205">PixOffset</span><span class="op" id="1794214">(</span><span class="ident" id="1794215">x</span><span class="op" id="1794216">,</span>&nbsp;<span class="ident" id="1794218">y</span>&nbsp;<span class="builtintype" id="1794220">int</span><span class="op" id="1794223">)</span>&nbsp;<span class="builtintype" id="1794225">int</span>&nbsp;<span class="op" id="1794229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1794232">return</span>&nbsp;<span class="op" id="1794239">(</span><span class="ident" id="1794240">y</span><span class="op" id="1794241">-</span><span class="ident" id="1794242">p</span><span class="op" id="1794243">.</span><span class="ident" id="1794244">Rect</span><span class="op" id="1794248">.</span><span class="ident" id="1794249">Min</span><span class="op" id="1794252">.</span><span class="ident" id="1794253">Y</span><span class="op" id="1794254">)</span><span class="op" id="1794255">*</span><span class="ident" id="1794256">p</span><span class="op" id="1794257">.</span><span class="ident" id="1794258">Stride</span>&nbsp;<span class="op" id="1794265">+</span>&nbsp;<span class="op" id="1794267">(</span><span class="ident" id="1794268">x</span><span class="op" id="1794269">-</span><span class="ident" id="1794270">p</span><span class="op" id="1794271">.</span><span class="ident" id="1794272">Rect</span><span class="op" id="1794276">.</span><span class="ident" id="1794277">Min</span><span class="op" id="1794280">.</span><span class="ident" id="1794281">X</span><span class="op" id="1794282">)</span><span class="op" id="1794283">*</span><span class="num" id="1794284">8</span><br>
<span class="lineno"></span><span class="op" id="1794286">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="1794289">func</span>&nbsp;<span class="op" id="1794294">(</span><span class="ident" id="1794295">p</span>&nbsp;<span class="op" id="1794297">*</span><span class="ident" id="1794298">RGBA64</span><span class="op" id="1794304">)</span>&nbsp;<span class="ident" id="1794306">Set</span><span class="op" id="1794309">(</span><span class="ident" id="1794310">x</span><span class="op" id="1794311">,</span>&nbsp;<span class="ident" id="1794313">y</span>&nbsp;<span class="builtintype" id="1794315">int</span><span class="op" id="1794318">,</span>&nbsp;<span class="ident" id="1794320">c</span>&nbsp;<span class="ident" id="1794322">color</span><span class="op" id="1794327">.</span><span class="ident" id="1794328">Color</span><span class="op" id="1794333">)</span>&nbsp;<span class="op" id="1794335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1794338">if</span>&nbsp;<span class="op" id="1794341">!</span><span class="op" id="1794342">(</span><span class="ident" id="1794343">Point</span><span class="op" id="1794348">{</span><span class="ident" id="1794349">x</span><span class="op" id="1794350">,</span>&nbsp;<span class="ident" id="1794352">y</span><span class="op" id="1794353">}</span><span class="op" id="1794354">.</span><span class="ident" id="1794355">In</span><span class="op" id="1794357">(</span><span class="ident" id="1794358">p</span><span class="op" id="1794359">.</span><span class="ident" id="1794360">Rect</span><span class="op" id="1794364">)</span><span class="op" id="1794365">)</span>&nbsp;<span class="op" id="1794367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1794371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1794379">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794382">i</span>&nbsp;<span class="op" id="1794384">:=</span>&nbsp;<span class="ident" id="1794387">p</span><span class="op" id="1794388">.</span><span class="ident" id="1794389">PixOffset</span><span class="op" id="1794398">(</span><span class="ident" id="1794399">x</span><span class="op" id="1794400">,</span>&nbsp;<span class="ident" id="1794402">y</span><span class="op" id="1794403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794406">c1</span>&nbsp;<span class="op" id="1794409">:=</span>&nbsp;<span class="ident" id="1794412">color</span><span class="op" id="1794417">.</span><span class="ident" id="1794418">RGBA64Model</span><span class="op" id="1794429">.</span><span class="ident" id="1794430">Convert</span><span class="op" id="1794437">(</span><span class="ident" id="1794438">c</span><span class="op" id="1794439">)</span><span class="op" id="1794440">.</span><span class="op" id="1794441">(</span><span class="ident" id="1794442">color</span><span class="op" id="1794447">.</span><span class="ident" id="1794448">RGBA64</span><span class="op" id="1794454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794457">p</span><span class="op" id="1794458">.</span><span class="ident" id="1794459">Pix</span><span class="op" id="1794462">[</span><span class="ident" id="1794463">i</span><span class="op" id="1794464">+</span><span class="num" id="1794465">0</span><span class="op" id="1794466">]</span>&nbsp;<span class="op" id="1794468">=</span>&nbsp;<span class="builtintype" id="1794470">uint8</span><span class="op" id="1794475">(</span><span class="ident" id="1794476">c1</span><span class="op" id="1794478">.</span><span class="ident" id="1794479">R</span>&nbsp;<span class="op" id="1794481">&gt;&gt;</span>&nbsp;<span class="num" id="1794484">8</span><span class="op" id="1794485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794488">p</span><span class="op" id="1794489">.</span><span class="ident" id="1794490">Pix</span><span class="op" id="1794493">[</span><span class="ident" id="1794494">i</span><span class="op" id="1794495">+</span><span class="num" id="1794496">1</span><span class="op" id="1794497">]</span>&nbsp;<span class="op" id="1794499">=</span>&nbsp;<span class="builtintype" id="1794501">uint8</span><span class="op" id="1794506">(</span><span class="ident" id="1794507">c1</span><span class="op" id="1794509">.</span><span class="ident" id="1794510">R</span><span class="op" id="1794511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794514">p</span><span class="op" id="1794515">.</span><span class="ident" id="1794516">Pix</span><span class="op" id="1794519">[</span><span class="ident" id="1794520">i</span><span class="op" id="1794521">+</span><span class="num" id="1794522">2</span><span class="op" id="1794523">]</span>&nbsp;<span class="op" id="1794525">=</span>&nbsp;<span class="builtintype" id="1794527">uint8</span><span class="op" id="1794532">(</span><span class="ident" id="1794533">c1</span><span class="op" id="1794535">.</span><span class="ident" id="1794536">G</span>&nbsp;<span class="op" id="1794538">&gt;&gt;</span>&nbsp;<span class="num" id="1794541">8</span><span class="op" id="1794542">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794545">p</span><span class="op" id="1794546">.</span><span class="ident" id="1794547">Pix</span><span class="op" id="1794550">[</span><span class="ident" id="1794551">i</span><span class="op" id="1794552">+</span><span class="num" id="1794553">3</span><span class="op" id="1794554">]</span>&nbsp;<span class="op" id="1794556">=</span>&nbsp;<span class="builtintype" id="1794558">uint8</span><span class="op" id="1794563">(</span><span class="ident" id="1794564">c1</span><span class="op" id="1794566">.</span><span class="ident" id="1794567">G</span><span class="op" id="1794568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794571">p</span><span class="op" id="1794572">.</span><span class="ident" id="1794573">Pix</span><span class="op" id="1794576">[</span><span class="ident" id="1794577">i</span><span class="op" id="1794578">+</span><span class="num" id="1794579">4</span><span class="op" id="1794580">]</span>&nbsp;<span class="op" id="1794582">=</span>&nbsp;<span class="builtintype" id="1794584">uint8</span><span class="op" id="1794589">(</span><span class="ident" id="1794590">c1</span><span class="op" id="1794592">.</span><span class="ident" id="1794593">B</span>&nbsp;<span class="op" id="1794595">&gt;&gt;</span>&nbsp;<span class="num" id="1794598">8</span><span class="op" id="1794599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794602">p</span><span class="op" id="1794603">.</span><span class="ident" id="1794604">Pix</span><span class="op" id="1794607">[</span><span class="ident" id="1794608">i</span><span class="op" id="1794609">+</span><span class="num" id="1794610">5</span><span class="op" id="1794611">]</span>&nbsp;<span class="op" id="1794613">=</span>&nbsp;<span class="builtintype" id="1794615">uint8</span><span class="op" id="1794620">(</span><span class="ident" id="1794621">c1</span><span class="op" id="1794623">.</span><span class="ident" id="1794624">B</span><span class="op" id="1794625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794628">p</span><span class="op" id="1794629">.</span><span class="ident" id="1794630">Pix</span><span class="op" id="1794633">[</span><span class="ident" id="1794634">i</span><span class="op" id="1794635">+</span><span class="num" id="1794636">6</span><span class="op" id="1794637">]</span>&nbsp;<span class="op" id="1794639">=</span>&nbsp;<span class="builtintype" id="1794641">uint8</span><span class="op" id="1794646">(</span><span class="ident" id="1794647">c1</span><span class="op" id="1794649">.</span><span class="ident" id="1794650">A</span>&nbsp;<span class="op" id="1794652">&gt;&gt;</span>&nbsp;<span class="num" id="1794655">8</span><span class="op" id="1794656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794659">p</span><span class="op" id="1794660">.</span><span class="ident" id="1794661">Pix</span><span class="op" id="1794664">[</span><span class="ident" id="1794665">i</span><span class="op" id="1794666">+</span><span class="num" id="1794667">7</span><span class="op" id="1794668">]</span>&nbsp;<span class="op" id="1794670">=</span>&nbsp;<span class="builtintype" id="1794672">uint8</span><span class="op" id="1794677">(</span><span class="ident" id="1794678">c1</span><span class="op" id="1794680">.</span><span class="ident" id="1794681">A</span><span class="op" id="1794682">)</span><br>
<span class="lineno">210</span><span class="op" id="1794684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1794687">func</span>&nbsp;<span class="op" id="1794692">(</span><span class="ident" id="1794693">p</span>&nbsp;<span class="op" id="1794695">*</span><span class="ident" id="1794696">RGBA64</span><span class="op" id="1794702">)</span>&nbsp;<span class="ident" id="1794704">SetRGBA64</span><span class="op" id="1794713">(</span><span class="ident" id="1794714">x</span><span class="op" id="1794715">,</span>&nbsp;<span class="ident" id="1794717">y</span>&nbsp;<span class="builtintype" id="1794719">int</span><span class="op" id="1794722">,</span>&nbsp;<span class="ident" id="1794724">c</span>&nbsp;<span class="ident" id="1794726">color</span><span class="op" id="1794731">.</span><span class="ident" id="1794732">RGBA64</span><span class="op" id="1794738">)</span>&nbsp;<span class="op" id="1794740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1794743">if</span>&nbsp;<span class="op" id="1794746">!</span><span class="op" id="1794747">(</span><span class="ident" id="1794748">Point</span><span class="op" id="1794753">{</span><span class="ident" id="1794754">x</span><span class="op" id="1794755">,</span>&nbsp;<span class="ident" id="1794757">y</span><span class="op" id="1794758">}</span><span class="op" id="1794759">.</span><span class="ident" id="1794760">In</span><span class="op" id="1794762">(</span><span class="ident" id="1794763">p</span><span class="op" id="1794764">.</span><span class="ident" id="1794765">Rect</span><span class="op" id="1794769">)</span><span class="op" id="1794770">)</span>&nbsp;<span class="op" id="1794772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1794776">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1794784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794787">i</span>&nbsp;<span class="op" id="1794789">:=</span>&nbsp;<span class="ident" id="1794792">p</span><span class="op" id="1794793">.</span><span class="ident" id="1794794">PixOffset</span><span class="op" id="1794803">(</span><span class="ident" id="1794804">x</span><span class="op" id="1794805">,</span>&nbsp;<span class="ident" id="1794807">y</span><span class="op" id="1794808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794811">p</span><span class="op" id="1794812">.</span><span class="ident" id="1794813">Pix</span><span class="op" id="1794816">[</span><span class="ident" id="1794817">i</span><span class="op" id="1794818">+</span><span class="num" id="1794819">0</span><span class="op" id="1794820">]</span>&nbsp;<span class="op" id="1794822">=</span>&nbsp;<span class="builtintype" id="1794824">uint8</span><span class="op" id="1794829">(</span><span class="ident" id="1794830">c</span><span class="op" id="1794831">.</span><span class="ident" id="1794832">R</span>&nbsp;<span class="op" id="1794834">&gt;&gt;</span>&nbsp;<span class="num" id="1794837">8</span><span class="op" id="1794838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794841">p</span><span class="op" id="1794842">.</span><span class="ident" id="1794843">Pix</span><span class="op" id="1794846">[</span><span class="ident" id="1794847">i</span><span class="op" id="1794848">+</span><span class="num" id="1794849">1</span><span class="op" id="1794850">]</span>&nbsp;<span class="op" id="1794852">=</span>&nbsp;<span class="builtintype" id="1794854">uint8</span><span class="op" id="1794859">(</span><span class="ident" id="1794860">c</span><span class="op" id="1794861">.</span><span class="ident" id="1794862">R</span><span class="op" id="1794863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794866">p</span><span class="op" id="1794867">.</span><span class="ident" id="1794868">Pix</span><span class="op" id="1794871">[</span><span class="ident" id="1794872">i</span><span class="op" id="1794873">+</span><span class="num" id="1794874">2</span><span class="op" id="1794875">]</span>&nbsp;<span class="op" id="1794877">=</span>&nbsp;<span class="builtintype" id="1794879">uint8</span><span class="op" id="1794884">(</span><span class="ident" id="1794885">c</span><span class="op" id="1794886">.</span><span class="ident" id="1794887">G</span>&nbsp;<span class="op" id="1794889">&gt;&gt;</span>&nbsp;<span class="num" id="1794892">8</span><span class="op" id="1794893">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794896">p</span><span class="op" id="1794897">.</span><span class="ident" id="1794898">Pix</span><span class="op" id="1794901">[</span><span class="ident" id="1794902">i</span><span class="op" id="1794903">+</span><span class="num" id="1794904">3</span><span class="op" id="1794905">]</span>&nbsp;<span class="op" id="1794907">=</span>&nbsp;<span class="builtintype" id="1794909">uint8</span><span class="op" id="1794914">(</span><span class="ident" id="1794915">c</span><span class="op" id="1794916">.</span><span class="ident" id="1794917">G</span><span class="op" id="1794918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794921">p</span><span class="op" id="1794922">.</span><span class="ident" id="1794923">Pix</span><span class="op" id="1794926">[</span><span class="ident" id="1794927">i</span><span class="op" id="1794928">+</span><span class="num" id="1794929">4</span><span class="op" id="1794930">]</span>&nbsp;<span class="op" id="1794932">=</span>&nbsp;<span class="builtintype" id="1794934">uint8</span><span class="op" id="1794939">(</span><span class="ident" id="1794940">c</span><span class="op" id="1794941">.</span><span class="ident" id="1794942">B</span>&nbsp;<span class="op" id="1794944">&gt;&gt;</span>&nbsp;<span class="num" id="1794947">8</span><span class="op" id="1794948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794951">p</span><span class="op" id="1794952">.</span><span class="ident" id="1794953">Pix</span><span class="op" id="1794956">[</span><span class="ident" id="1794957">i</span><span class="op" id="1794958">+</span><span class="num" id="1794959">5</span><span class="op" id="1794960">]</span>&nbsp;<span class="op" id="1794962">=</span>&nbsp;<span class="builtintype" id="1794964">uint8</span><span class="op" id="1794969">(</span><span class="ident" id="1794970">c</span><span class="op" id="1794971">.</span><span class="ident" id="1794972">B</span><span class="op" id="1794973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1794976">p</span><span class="op" id="1794977">.</span><span class="ident" id="1794978">Pix</span><span class="op" id="1794981">[</span><span class="ident" id="1794982">i</span><span class="op" id="1794983">+</span><span class="num" id="1794984">6</span><span class="op" id="1794985">]</span>&nbsp;<span class="op" id="1794987">=</span>&nbsp;<span class="builtintype" id="1794989">uint8</span><span class="op" id="1794994">(</span><span class="ident" id="1794995">c</span><span class="op" id="1794996">.</span><span class="ident" id="1794997">A</span>&nbsp;<span class="op" id="1794999">&gt;&gt;</span>&nbsp;<span class="num" id="1795002">8</span><span class="op" id="1795003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795006">p</span><span class="op" id="1795007">.</span><span class="ident" id="1795008">Pix</span><span class="op" id="1795011">[</span><span class="ident" id="1795012">i</span><span class="op" id="1795013">+</span><span class="num" id="1795014">7</span><span class="op" id="1795015">]</span>&nbsp;<span class="op" id="1795017">=</span>&nbsp;<span class="builtintype" id="1795019">uint8</span><span class="op" id="1795024">(</span><span class="ident" id="1795025">c</span><span class="op" id="1795026">.</span><span class="ident" id="1795027">A</span><span class="op" id="1795028">)</span><br>
<span class="lineno">225</span><span class="op" id="1795030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1795033">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1795110">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1795182">func</span>&nbsp;<span class="op" id="1795187">(</span><span class="ident" id="1795188">p</span>&nbsp;<span class="op" id="1795190">*</span><span class="ident" id="1795191">RGBA64</span><span class="op" id="1795197">)</span>&nbsp;<span class="ident" id="1795199">SubImage</span><span class="op" id="1795207">(</span><span class="ident" id="1795208">r</span>&nbsp;<span class="ident" id="1795210">Rectangle</span><span class="op" id="1795219">)</span>&nbsp;<span class="ident" id="1795221">Image</span>&nbsp;<span class="op" id="1795227">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795230">r</span>&nbsp;<span class="op" id="1795232">=</span>&nbsp;<span class="ident" id="1795234">r</span><span class="op" id="1795235">.</span><span class="ident" id="1795236">Intersect</span><span class="op" id="1795245">(</span><span class="ident" id="1795246">p</span><span class="op" id="1795247">.</span><span class="ident" id="1795248">Rect</span><span class="op" id="1795252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795255">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795336">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795418">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795468">if</span>&nbsp;<span class="ident" id="1795471">r</span><span class="op" id="1795472">.</span><span class="ident" id="1795473">Empty</span><span class="op" id="1795478">(</span><span class="op" id="1795479">)</span>&nbsp;<span class="op" id="1795481">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795485">return</span>&nbsp;<span class="op" id="1795492">&amp;</span><span class="ident" id="1795493">RGBA64</span><span class="op" id="1795499">{</span><span class="op" id="1795500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795506">i</span>&nbsp;<span class="op" id="1795508">:=</span>&nbsp;<span class="ident" id="1795511">p</span><span class="op" id="1795512">.</span><span class="ident" id="1795513">PixOffset</span><span class="op" id="1795522">(</span><span class="ident" id="1795523">r</span><span class="op" id="1795524">.</span><span class="ident" id="1795525">Min</span><span class="op" id="1795528">.</span><span class="ident" id="1795529">X</span><span class="op" id="1795530">,</span>&nbsp;<span class="ident" id="1795532">r</span><span class="op" id="1795533">.</span><span class="ident" id="1795534">Min</span><span class="op" id="1795537">.</span><span class="ident" id="1795538">Y</span><span class="op" id="1795539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795542">return</span>&nbsp;<span class="op" id="1795549">&amp;</span><span class="ident" id="1795550">RGBA64</span><span class="op" id="1795556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795560">Pix</span><span class="op" id="1795563">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795568">p</span><span class="op" id="1795569">.</span><span class="ident" id="1795570">Pix</span><span class="op" id="1795573">[</span><span class="ident" id="1795574">i</span><span class="op" id="1795575">:</span><span class="op" id="1795576">]</span><span class="op" id="1795577">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795581">Stride</span><span class="op" id="1795587">:</span>&nbsp;<span class="ident" id="1795589">p</span><span class="op" id="1795590">.</span><span class="ident" id="1795591">Stride</span><span class="op" id="1795597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795601">Rect</span><span class="op" id="1795605">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1795609">r</span><span class="op" id="1795610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795613">}</span><br>
<span class="lineno"></span><span class="op" id="1795615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="1795618">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1795691">func</span>&nbsp;<span class="op" id="1795696">(</span><span class="ident" id="1795697">p</span>&nbsp;<span class="op" id="1795699">*</span><span class="ident" id="1795700">RGBA64</span><span class="op" id="1795706">)</span>&nbsp;<span class="ident" id="1795708">Opaque</span><span class="op" id="1795714">(</span><span class="op" id="1795715">)</span>&nbsp;<span class="builtintype" id="1795717">bool</span>&nbsp;<span class="op" id="1795722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795725">if</span>&nbsp;<span class="ident" id="1795728">p</span><span class="op" id="1795729">.</span><span class="ident" id="1795730">Rect</span><span class="op" id="1795734">.</span><span class="ident" id="1795735">Empty</span><span class="op" id="1795740">(</span><span class="op" id="1795741">)</span>&nbsp;<span class="op" id="1795743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795747">return</span>&nbsp;<span class="builtintype" id="1795754">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795760">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795763">i0</span><span class="op" id="1795765">,</span>&nbsp;<span class="ident" id="1795767">i1</span>&nbsp;<span class="op" id="1795770">:=</span>&nbsp;<span class="num" id="1795773">6</span><span class="op" id="1795774">,</span>&nbsp;<span class="ident" id="1795776">p</span><span class="op" id="1795777">.</span><span class="ident" id="1795778">Rect</span><span class="op" id="1795782">.</span><span class="ident" id="1795783">Dx</span><span class="op" id="1795785">(</span><span class="op" id="1795786">)</span><span class="op" id="1795787">*</span><span class="num" id="1795788">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795791">for</span>&nbsp;<span class="ident" id="1795795">y</span>&nbsp;<span class="op" id="1795797">:=</span>&nbsp;<span class="ident" id="1795800">p</span><span class="op" id="1795801">.</span><span class="ident" id="1795802">Rect</span><span class="op" id="1795806">.</span><span class="ident" id="1795807">Min</span><span class="op" id="1795810">.</span><span class="ident" id="1795811">Y</span><span class="op" id="1795812">;</span>&nbsp;<span class="ident" id="1795814">y</span>&nbsp;<span class="op" id="1795816">&lt;</span>&nbsp;<span class="ident" id="1795818">p</span><span class="op" id="1795819">.</span><span class="ident" id="1795820">Rect</span><span class="op" id="1795824">.</span><span class="ident" id="1795825">Max</span><span class="op" id="1795828">.</span><span class="ident" id="1795829">Y</span><span class="op" id="1795830">;</span>&nbsp;<span class="ident" id="1795832">y</span><span class="op" id="1795833">++</span>&nbsp;<span class="op" id="1795836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795840">for</span>&nbsp;<span class="ident" id="1795844">i</span>&nbsp;<span class="op" id="1795846">:=</span>&nbsp;<span class="ident" id="1795849">i0</span><span class="op" id="1795851">;</span>&nbsp;<span class="ident" id="1795853">i</span>&nbsp;<span class="op" id="1795855">&lt;</span>&nbsp;<span class="ident" id="1795857">i1</span><span class="op" id="1795859">;</span>&nbsp;<span class="ident" id="1795861">i</span>&nbsp;<span class="op" id="1795863">+=</span>&nbsp;<span class="num" id="1795866">8</span>&nbsp;<span class="op" id="1795868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795873">if</span>&nbsp;<span class="ident" id="1795876">p</span><span class="op" id="1795877">.</span><span class="ident" id="1795878">Pix</span><span class="op" id="1795881">[</span><span class="ident" id="1795882">i</span><span class="op" id="1795883">+</span><span class="num" id="1795884">0</span><span class="op" id="1795885">]</span>&nbsp;<span class="op" id="1795887">!=</span>&nbsp;<span class="num" id="1795890">0xff</span>&nbsp;<span class="op" id="1795895">||</span>&nbsp;<span class="ident" id="1795898">p</span><span class="op" id="1795899">.</span><span class="ident" id="1795900">Pix</span><span class="op" id="1795903">[</span><span class="ident" id="1795904">i</span><span class="op" id="1795905">+</span><span class="num" id="1795906">1</span><span class="op" id="1795907">]</span>&nbsp;<span class="op" id="1795909">!=</span>&nbsp;<span class="num" id="1795912">0xff</span>&nbsp;<span class="op" id="1795917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795923">return</span>&nbsp;<span class="builtintype" id="1795930">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795947">i0</span>&nbsp;<span class="op" id="1795950">+=</span>&nbsp;<span class="ident" id="1795953">p</span><span class="op" id="1795954">.</span><span class="ident" id="1795955">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1795964">i1</span>&nbsp;<span class="op" id="1795967">+=</span>&nbsp;<span class="ident" id="1795970">p</span><span class="op" id="1795971">.</span><span class="ident" id="1795972">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795980">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1795983">return</span>&nbsp;<span class="builtintype" id="1795990">true</span><br>
<span class="lineno"></span><span class="op" id="1795995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1795998">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1796055">func</span>&nbsp;<span class="ident" id="1796060">NewRGBA64</span><span class="op" id="1796069">(</span><span class="ident" id="1796070">r</span>&nbsp;<span class="ident" id="1796072">Rectangle</span><span class="op" id="1796081">)</span>&nbsp;<span class="op" id="1796083">*</span><span class="ident" id="1796084">RGBA64</span>&nbsp;<span class="op" id="1796091">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796094">w</span><span class="op" id="1796095">,</span>&nbsp;<span class="ident" id="1796097">h</span>&nbsp;<span class="op" id="1796099">:=</span>&nbsp;<span class="ident" id="1796102">r</span><span class="op" id="1796103">.</span><span class="ident" id="1796104">Dx</span><span class="op" id="1796106">(</span><span class="op" id="1796107">)</span><span class="op" id="1796108">,</span>&nbsp;<span class="ident" id="1796110">r</span><span class="op" id="1796111">.</span><span class="ident" id="1796112">Dy</span><span class="op" id="1796114">(</span><span class="op" id="1796115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796118">pix</span>&nbsp;<span class="op" id="1796122">:=</span>&nbsp;<span class="builtinfunc" id="1796125">make</span><span class="op" id="1796129">(</span><span class="op" id="1796130">[</span><span class="op" id="1796131">]</span><span class="builtintype" id="1796132">uint8</span><span class="op" id="1796137">,</span>&nbsp;<span class="num" id="1796139">8</span><span class="op" id="1796140">*</span><span class="ident" id="1796141">w</span><span class="op" id="1796142">*</span><span class="ident" id="1796143">h</span><span class="op" id="1796144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1796147">return</span>&nbsp;<span class="op" id="1796154">&amp;</span><span class="ident" id="1796155">RGBA64</span><span class="op" id="1796161">{</span><span class="ident" id="1796162">pix</span><span class="op" id="1796165">,</span>&nbsp;<span class="num" id="1796167">8</span>&nbsp;<span class="op" id="1796169">*</span>&nbsp;<span class="ident" id="1796171">w</span><span class="op" id="1796172">,</span>&nbsp;<span class="ident" id="1796174">r</span><span class="op" id="1796175">}</span><br>
<span class="lineno"></span><span class="op" id="1796177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="1796180">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1796255">type</span>&nbsp;<span class="ident" id="1796260">NRGBA</span>&nbsp;<span class="keyword" id="1796266">struct</span>&nbsp;<span class="op" id="1796273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1796276">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1796344">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796412">Pix</span>&nbsp;<span class="op" id="1796416">[</span><span class="op" id="1796417">]</span><span class="builtintype" id="1796418">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1796425">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796501">Stride</span>&nbsp;<span class="builtintype" id="1796508">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1796513">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796545">Rect</span>&nbsp;<span class="ident" id="1796550">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1796560">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1796563">func</span>&nbsp;<span class="op" id="1796568">(</span><span class="ident" id="1796569">p</span>&nbsp;<span class="op" id="1796571">*</span><span class="ident" id="1796572">NRGBA</span><span class="op" id="1796577">)</span>&nbsp;<span class="ident" id="1796579">ColorModel</span><span class="op" id="1796589">(</span><span class="op" id="1796590">)</span>&nbsp;<span class="ident" id="1796592">color</span><span class="op" id="1796597">.</span><span class="ident" id="1796598">Model</span>&nbsp;<span class="op" id="1796604">{</span>&nbsp;<span class="keyword" id="1796606">return</span>&nbsp;<span class="ident" id="1796613">color</span><span class="op" id="1796618">.</span><span class="ident" id="1796619">NRGBAModel</span>&nbsp;<span class="op" id="1796630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1796633">func</span>&nbsp;<span class="op" id="1796638">(</span><span class="ident" id="1796639">p</span>&nbsp;<span class="op" id="1796641">*</span><span class="ident" id="1796642">NRGBA</span><span class="op" id="1796647">)</span>&nbsp;<span class="ident" id="1796649">Bounds</span><span class="op" id="1796655">(</span><span class="op" id="1796656">)</span>&nbsp;<span class="ident" id="1796658">Rectangle</span>&nbsp;<span class="op" id="1796668">{</span>&nbsp;<span class="keyword" id="1796670">return</span>&nbsp;<span class="ident" id="1796677">p</span><span class="op" id="1796678">.</span><span class="ident" id="1796679">Rect</span>&nbsp;<span class="op" id="1796684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="1796687">func</span>&nbsp;<span class="op" id="1796692">(</span><span class="ident" id="1796693">p</span>&nbsp;<span class="op" id="1796695">*</span><span class="ident" id="1796696">NRGBA</span><span class="op" id="1796701">)</span>&nbsp;<span class="ident" id="1796703">At</span><span class="op" id="1796705">(</span><span class="ident" id="1796706">x</span><span class="op" id="1796707">,</span>&nbsp;<span class="ident" id="1796709">y</span>&nbsp;<span class="builtintype" id="1796711">int</span><span class="op" id="1796714">)</span>&nbsp;<span class="ident" id="1796716">color</span><span class="op" id="1796721">.</span><span class="ident" id="1796722">Color</span>&nbsp;<span class="op" id="1796728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1796731">return</span>&nbsp;<span class="ident" id="1796738">p</span><span class="op" id="1796739">.</span><span class="ident" id="1796740">NRGBAAt</span><span class="op" id="1796747">(</span><span class="ident" id="1796748">x</span><span class="op" id="1796749">,</span>&nbsp;<span class="ident" id="1796751">y</span><span class="op" id="1796752">)</span><br>
<span class="lineno"></span><span class="op" id="1796754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1796757">func</span>&nbsp;<span class="op" id="1796762">(</span><span class="ident" id="1796763">p</span>&nbsp;<span class="op" id="1796765">*</span><span class="ident" id="1796766">NRGBA</span><span class="op" id="1796771">)</span>&nbsp;<span class="ident" id="1796773">NRGBAAt</span><span class="op" id="1796780">(</span><span class="ident" id="1796781">x</span><span class="op" id="1796782">,</span>&nbsp;<span class="ident" id="1796784">y</span>&nbsp;<span class="builtintype" id="1796786">int</span><span class="op" id="1796789">)</span>&nbsp;<span class="ident" id="1796791">color</span><span class="op" id="1796796">.</span><span class="ident" id="1796797">NRGBA</span>&nbsp;<span class="op" id="1796803">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1796806">if</span>&nbsp;<span class="op" id="1796809">!</span><span class="op" id="1796810">(</span><span class="ident" id="1796811">Point</span><span class="op" id="1796816">{</span><span class="ident" id="1796817">x</span><span class="op" id="1796818">,</span>&nbsp;<span class="ident" id="1796820">y</span><span class="op" id="1796821">}</span><span class="op" id="1796822">.</span><span class="ident" id="1796823">In</span><span class="op" id="1796825">(</span><span class="ident" id="1796826">p</span><span class="op" id="1796827">.</span><span class="ident" id="1796828">Rect</span><span class="op" id="1796832">)</span><span class="op" id="1796833">)</span>&nbsp;<span class="op" id="1796835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1796839">return</span>&nbsp;<span class="ident" id="1796846">color</span><span class="op" id="1796851">.</span><span class="ident" id="1796852">NRGBA</span><span class="op" id="1796857">{</span><span class="op" id="1796858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1796861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1796864">i</span>&nbsp;<span class="op" id="1796866">:=</span>&nbsp;<span class="ident" id="1796869">p</span><span class="op" id="1796870">.</span><span class="ident" id="1796871">PixOffset</span><span class="op" id="1796880">(</span><span class="ident" id="1796881">x</span><span class="op" id="1796882">,</span>&nbsp;<span class="ident" id="1796884">y</span><span class="op" id="1796885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1796888">return</span>&nbsp;<span class="ident" id="1796895">color</span><span class="op" id="1796900">.</span><span class="ident" id="1796901">NRGBA</span><span class="op" id="1796906">{</span><span class="ident" id="1796907">p</span><span class="op" id="1796908">.</span><span class="ident" id="1796909">Pix</span><span class="op" id="1796912">[</span><span class="ident" id="1796913">i</span><span class="op" id="1796914">+</span><span class="num" id="1796915">0</span><span class="op" id="1796916">]</span><span class="op" id="1796917">,</span>&nbsp;<span class="ident" id="1796919">p</span><span class="op" id="1796920">.</span><span class="ident" id="1796921">Pix</span><span class="op" id="1796924">[</span><span class="ident" id="1796925">i</span><span class="op" id="1796926">+</span><span class="num" id="1796927">1</span><span class="op" id="1796928">]</span><span class="op" id="1796929">,</span>&nbsp;<span class="ident" id="1796931">p</span><span class="op" id="1796932">.</span><span class="ident" id="1796933">Pix</span><span class="op" id="1796936">[</span><span class="ident" id="1796937">i</span><span class="op" id="1796938">+</span><span class="num" id="1796939">2</span><span class="op" id="1796940">]</span><span class="op" id="1796941">,</span>&nbsp;<span class="ident" id="1796943">p</span><span class="op" id="1796944">.</span><span class="ident" id="1796945">Pix</span><span class="op" id="1796948">[</span><span class="ident" id="1796949">i</span><span class="op" id="1796950">+</span><span class="num" id="1796951">3</span><span class="op" id="1796952">]</span><span class="op" id="1796953">}</span><br>
<span class="lineno">295</span><span class="op" id="1796955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1796958">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1797037">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1797061">func</span>&nbsp;<span class="op" id="1797066">(</span><span class="ident" id="1797067">p</span>&nbsp;<span class="op" id="1797069">*</span><span class="ident" id="1797070">NRGBA</span><span class="op" id="1797075">)</span>&nbsp;<span class="ident" id="1797077">PixOffset</span><span class="op" id="1797086">(</span><span class="ident" id="1797087">x</span><span class="op" id="1797088">,</span>&nbsp;<span class="ident" id="1797090">y</span>&nbsp;<span class="builtintype" id="1797092">int</span><span class="op" id="1797095">)</span>&nbsp;<span class="builtintype" id="1797097">int</span>&nbsp;<span class="op" id="1797101">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1797104">return</span>&nbsp;<span class="op" id="1797111">(</span><span class="ident" id="1797112">y</span><span class="op" id="1797113">-</span><span class="ident" id="1797114">p</span><span class="op" id="1797115">.</span><span class="ident" id="1797116">Rect</span><span class="op" id="1797120">.</span><span class="ident" id="1797121">Min</span><span class="op" id="1797124">.</span><span class="ident" id="1797125">Y</span><span class="op" id="1797126">)</span><span class="op" id="1797127">*</span><span class="ident" id="1797128">p</span><span class="op" id="1797129">.</span><span class="ident" id="1797130">Stride</span>&nbsp;<span class="op" id="1797137">+</span>&nbsp;<span class="op" id="1797139">(</span><span class="ident" id="1797140">x</span><span class="op" id="1797141">-</span><span class="ident" id="1797142">p</span><span class="op" id="1797143">.</span><span class="ident" id="1797144">Rect</span><span class="op" id="1797148">.</span><span class="ident" id="1797149">Min</span><span class="op" id="1797152">.</span><span class="ident" id="1797153">X</span><span class="op" id="1797154">)</span><span class="op" id="1797155">*</span><span class="num" id="1797156">4</span><br>
<span class="lineno"></span><span class="op" id="1797158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1797161">func</span>&nbsp;<span class="op" id="1797166">(</span><span class="ident" id="1797167">p</span>&nbsp;<span class="op" id="1797169">*</span><span class="ident" id="1797170">NRGBA</span><span class="op" id="1797175">)</span>&nbsp;<span class="ident" id="1797177">Set</span><span class="op" id="1797180">(</span><span class="ident" id="1797181">x</span><span class="op" id="1797182">,</span>&nbsp;<span class="ident" id="1797184">y</span>&nbsp;<span class="builtintype" id="1797186">int</span><span class="op" id="1797189">,</span>&nbsp;<span class="ident" id="1797191">c</span>&nbsp;<span class="ident" id="1797193">color</span><span class="op" id="1797198">.</span><span class="ident" id="1797199">Color</span><span class="op" id="1797204">)</span>&nbsp;<span class="op" id="1797206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1797209">if</span>&nbsp;<span class="op" id="1797212">!</span><span class="op" id="1797213">(</span><span class="ident" id="1797214">Point</span><span class="op" id="1797219">{</span><span class="ident" id="1797220">x</span><span class="op" id="1797221">,</span>&nbsp;<span class="ident" id="1797223">y</span><span class="op" id="1797224">}</span><span class="op" id="1797225">.</span><span class="ident" id="1797226">In</span><span class="op" id="1797228">(</span><span class="ident" id="1797229">p</span><span class="op" id="1797230">.</span><span class="ident" id="1797231">Rect</span><span class="op" id="1797235">)</span><span class="op" id="1797236">)</span>&nbsp;<span class="op" id="1797238">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1797242">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1797250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797253">i</span>&nbsp;<span class="op" id="1797255">:=</span>&nbsp;<span class="ident" id="1797258">p</span><span class="op" id="1797259">.</span><span class="ident" id="1797260">PixOffset</span><span class="op" id="1797269">(</span><span class="ident" id="1797270">x</span><span class="op" id="1797271">,</span>&nbsp;<span class="ident" id="1797273">y</span><span class="op" id="1797274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797277">c1</span>&nbsp;<span class="op" id="1797280">:=</span>&nbsp;<span class="ident" id="1797283">color</span><span class="op" id="1797288">.</span><span class="ident" id="1797289">NRGBAModel</span><span class="op" id="1797299">.</span><span class="ident" id="1797300">Convert</span><span class="op" id="1797307">(</span><span class="ident" id="1797308">c</span><span class="op" id="1797309">)</span><span class="op" id="1797310">.</span><span class="op" id="1797311">(</span><span class="ident" id="1797312">color</span><span class="op" id="1797317">.</span><span class="ident" id="1797318">NRGBA</span><span class="op" id="1797323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797326">p</span><span class="op" id="1797327">.</span><span class="ident" id="1797328">Pix</span><span class="op" id="1797331">[</span><span class="ident" id="1797332">i</span><span class="op" id="1797333">+</span><span class="num" id="1797334">0</span><span class="op" id="1797335">]</span>&nbsp;<span class="op" id="1797337">=</span>&nbsp;<span class="ident" id="1797339">c1</span><span class="op" id="1797341">.</span><span class="ident" id="1797342">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797345">p</span><span class="op" id="1797346">.</span><span class="ident" id="1797347">Pix</span><span class="op" id="1797350">[</span><span class="ident" id="1797351">i</span><span class="op" id="1797352">+</span><span class="num" id="1797353">1</span><span class="op" id="1797354">]</span>&nbsp;<span class="op" id="1797356">=</span>&nbsp;<span class="ident" id="1797358">c1</span><span class="op" id="1797360">.</span><span class="ident" id="1797361">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797364">p</span><span class="op" id="1797365">.</span><span class="ident" id="1797366">Pix</span><span class="op" id="1797369">[</span><span class="ident" id="1797370">i</span><span class="op" id="1797371">+</span><span class="num" id="1797372">2</span><span class="op" id="1797373">]</span>&nbsp;<span class="op" id="1797375">=</span>&nbsp;<span class="ident" id="1797377">c1</span><span class="op" id="1797379">.</span><span class="ident" id="1797380">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797383">p</span><span class="op" id="1797384">.</span><span class="ident" id="1797385">Pix</span><span class="op" id="1797388">[</span><span class="ident" id="1797389">i</span><span class="op" id="1797390">+</span><span class="num" id="1797391">3</span><span class="op" id="1797392">]</span>&nbsp;<span class="op" id="1797394">=</span>&nbsp;<span class="ident" id="1797396">c1</span><span class="op" id="1797398">.</span><span class="ident" id="1797399">A</span><br>
<span class="lineno"></span><span class="op" id="1797401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="1797404">func</span>&nbsp;<span class="op" id="1797409">(</span><span class="ident" id="1797410">p</span>&nbsp;<span class="op" id="1797412">*</span><span class="ident" id="1797413">NRGBA</span><span class="op" id="1797418">)</span>&nbsp;<span class="ident" id="1797420">SetNRGBA</span><span class="op" id="1797428">(</span><span class="ident" id="1797429">x</span><span class="op" id="1797430">,</span>&nbsp;<span class="ident" id="1797432">y</span>&nbsp;<span class="builtintype" id="1797434">int</span><span class="op" id="1797437">,</span>&nbsp;<span class="ident" id="1797439">c</span>&nbsp;<span class="ident" id="1797441">color</span><span class="op" id="1797446">.</span><span class="ident" id="1797447">NRGBA</span><span class="op" id="1797452">)</span>&nbsp;<span class="op" id="1797454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1797457">if</span>&nbsp;<span class="op" id="1797460">!</span><span class="op" id="1797461">(</span><span class="ident" id="1797462">Point</span><span class="op" id="1797467">{</span><span class="ident" id="1797468">x</span><span class="op" id="1797469">,</span>&nbsp;<span class="ident" id="1797471">y</span><span class="op" id="1797472">}</span><span class="op" id="1797473">.</span><span class="ident" id="1797474">In</span><span class="op" id="1797476">(</span><span class="ident" id="1797477">p</span><span class="op" id="1797478">.</span><span class="ident" id="1797479">Rect</span><span class="op" id="1797483">)</span><span class="op" id="1797484">)</span>&nbsp;<span class="op" id="1797486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1797490">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1797498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797501">i</span>&nbsp;<span class="op" id="1797503">:=</span>&nbsp;<span class="ident" id="1797506">p</span><span class="op" id="1797507">.</span><span class="ident" id="1797508">PixOffset</span><span class="op" id="1797517">(</span><span class="ident" id="1797518">x</span><span class="op" id="1797519">,</span>&nbsp;<span class="ident" id="1797521">y</span><span class="op" id="1797522">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797525">p</span><span class="op" id="1797526">.</span><span class="ident" id="1797527">Pix</span><span class="op" id="1797530">[</span><span class="ident" id="1797531">i</span><span class="op" id="1797532">+</span><span class="num" id="1797533">0</span><span class="op" id="1797534">]</span>&nbsp;<span class="op" id="1797536">=</span>&nbsp;<span class="ident" id="1797538">c</span><span class="op" id="1797539">.</span><span class="ident" id="1797540">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797543">p</span><span class="op" id="1797544">.</span><span class="ident" id="1797545">Pix</span><span class="op" id="1797548">[</span><span class="ident" id="1797549">i</span><span class="op" id="1797550">+</span><span class="num" id="1797551">1</span><span class="op" id="1797552">]</span>&nbsp;<span class="op" id="1797554">=</span>&nbsp;<span class="ident" id="1797556">c</span><span class="op" id="1797557">.</span><span class="ident" id="1797558">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797561">p</span><span class="op" id="1797562">.</span><span class="ident" id="1797563">Pix</span><span class="op" id="1797566">[</span><span class="ident" id="1797567">i</span><span class="op" id="1797568">+</span><span class="num" id="1797569">2</span><span class="op" id="1797570">]</span>&nbsp;<span class="op" id="1797572">=</span>&nbsp;<span class="ident" id="1797574">c</span><span class="op" id="1797575">.</span><span class="ident" id="1797576">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797579">p</span><span class="op" id="1797580">.</span><span class="ident" id="1797581">Pix</span><span class="op" id="1797584">[</span><span class="ident" id="1797585">i</span><span class="op" id="1797586">+</span><span class="num" id="1797587">3</span><span class="op" id="1797588">]</span>&nbsp;<span class="op" id="1797590">=</span>&nbsp;<span class="ident" id="1797592">c</span><span class="op" id="1797593">.</span><span class="ident" id="1797594">A</span><br>
<span class="lineno"></span><span class="op" id="1797596">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="1797599">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1797676">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1797748">func</span>&nbsp;<span class="op" id="1797753">(</span><span class="ident" id="1797754">p</span>&nbsp;<span class="op" id="1797756">*</span><span class="ident" id="1797757">NRGBA</span><span class="op" id="1797762">)</span>&nbsp;<span class="ident" id="1797764">SubImage</span><span class="op" id="1797772">(</span><span class="ident" id="1797773">r</span>&nbsp;<span class="ident" id="1797775">Rectangle</span><span class="op" id="1797784">)</span>&nbsp;<span class="ident" id="1797786">Image</span>&nbsp;<span class="op" id="1797792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1797795">r</span>&nbsp;<span class="op" id="1797797">=</span>&nbsp;<span class="ident" id="1797799">r</span><span class="op" id="1797800">.</span><span class="ident" id="1797801">Intersect</span><span class="op" id="1797810">(</span><span class="ident" id="1797811">p</span><span class="op" id="1797812">.</span><span class="ident" id="1797813">Rect</span><span class="op" id="1797817">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1797820">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1797901">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1797983">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798033">if</span>&nbsp;<span class="ident" id="1798036">r</span><span class="op" id="1798037">.</span><span class="ident" id="1798038">Empty</span><span class="op" id="1798043">(</span><span class="op" id="1798044">)</span>&nbsp;<span class="op" id="1798046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798050">return</span>&nbsp;<span class="op" id="1798057">&amp;</span><span class="ident" id="1798058">NRGBA</span><span class="op" id="1798063">{</span><span class="op" id="1798064">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798070">i</span>&nbsp;<span class="op" id="1798072">:=</span>&nbsp;<span class="ident" id="1798075">p</span><span class="op" id="1798076">.</span><span class="ident" id="1798077">PixOffset</span><span class="op" id="1798086">(</span><span class="ident" id="1798087">r</span><span class="op" id="1798088">.</span><span class="ident" id="1798089">Min</span><span class="op" id="1798092">.</span><span class="ident" id="1798093">X</span><span class="op" id="1798094">,</span>&nbsp;<span class="ident" id="1798096">r</span><span class="op" id="1798097">.</span><span class="ident" id="1798098">Min</span><span class="op" id="1798101">.</span><span class="ident" id="1798102">Y</span><span class="op" id="1798103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798106">return</span>&nbsp;<span class="op" id="1798113">&amp;</span><span class="ident" id="1798114">NRGBA</span><span class="op" id="1798119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798123">Pix</span><span class="op" id="1798126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798131">p</span><span class="op" id="1798132">.</span><span class="ident" id="1798133">Pix</span><span class="op" id="1798136">[</span><span class="ident" id="1798137">i</span><span class="op" id="1798138">:</span><span class="op" id="1798139">]</span><span class="op" id="1798140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798144">Stride</span><span class="op" id="1798150">:</span>&nbsp;<span class="ident" id="1798152">p</span><span class="op" id="1798153">.</span><span class="ident" id="1798154">Stride</span><span class="op" id="1798160">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798164">Rect</span><span class="op" id="1798168">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1798172">r</span><span class="op" id="1798173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798176">}</span><br>
<span class="lineno"></span><span class="op" id="1798178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798181">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="1798254">func</span>&nbsp;<span class="op" id="1798259">(</span><span class="ident" id="1798260">p</span>&nbsp;<span class="op" id="1798262">*</span><span class="ident" id="1798263">NRGBA</span><span class="op" id="1798268">)</span>&nbsp;<span class="ident" id="1798270">Opaque</span><span class="op" id="1798276">(</span><span class="op" id="1798277">)</span>&nbsp;<span class="builtintype" id="1798279">bool</span>&nbsp;<span class="op" id="1798284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798287">if</span>&nbsp;<span class="ident" id="1798290">p</span><span class="op" id="1798291">.</span><span class="ident" id="1798292">Rect</span><span class="op" id="1798296">.</span><span class="ident" id="1798297">Empty</span><span class="op" id="1798302">(</span><span class="op" id="1798303">)</span>&nbsp;<span class="op" id="1798305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798309">return</span>&nbsp;<span class="builtintype" id="1798316">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798325">i0</span><span class="op" id="1798327">,</span>&nbsp;<span class="ident" id="1798329">i1</span>&nbsp;<span class="op" id="1798332">:=</span>&nbsp;<span class="num" id="1798335">3</span><span class="op" id="1798336">,</span>&nbsp;<span class="ident" id="1798338">p</span><span class="op" id="1798339">.</span><span class="ident" id="1798340">Rect</span><span class="op" id="1798344">.</span><span class="ident" id="1798345">Dx</span><span class="op" id="1798347">(</span><span class="op" id="1798348">)</span><span class="op" id="1798349">*</span><span class="num" id="1798350">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798353">for</span>&nbsp;<span class="ident" id="1798357">y</span>&nbsp;<span class="op" id="1798359">:=</span>&nbsp;<span class="ident" id="1798362">p</span><span class="op" id="1798363">.</span><span class="ident" id="1798364">Rect</span><span class="op" id="1798368">.</span><span class="ident" id="1798369">Min</span><span class="op" id="1798372">.</span><span class="ident" id="1798373">Y</span><span class="op" id="1798374">;</span>&nbsp;<span class="ident" id="1798376">y</span>&nbsp;<span class="op" id="1798378">&lt;</span>&nbsp;<span class="ident" id="1798380">p</span><span class="op" id="1798381">.</span><span class="ident" id="1798382">Rect</span><span class="op" id="1798386">.</span><span class="ident" id="1798387">Max</span><span class="op" id="1798390">.</span><span class="ident" id="1798391">Y</span><span class="op" id="1798392">;</span>&nbsp;<span class="ident" id="1798394">y</span><span class="op" id="1798395">++</span>&nbsp;<span class="op" id="1798398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798402">for</span>&nbsp;<span class="ident" id="1798406">i</span>&nbsp;<span class="op" id="1798408">:=</span>&nbsp;<span class="ident" id="1798411">i0</span><span class="op" id="1798413">;</span>&nbsp;<span class="ident" id="1798415">i</span>&nbsp;<span class="op" id="1798417">&lt;</span>&nbsp;<span class="ident" id="1798419">i1</span><span class="op" id="1798421">;</span>&nbsp;<span class="ident" id="1798423">i</span>&nbsp;<span class="op" id="1798425">+=</span>&nbsp;<span class="num" id="1798428">4</span>&nbsp;<span class="op" id="1798430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798435">if</span>&nbsp;<span class="ident" id="1798438">p</span><span class="op" id="1798439">.</span><span class="ident" id="1798440">Pix</span><span class="op" id="1798443">[</span><span class="ident" id="1798444">i</span><span class="op" id="1798445">]</span>&nbsp;<span class="op" id="1798447">!=</span>&nbsp;<span class="num" id="1798450">0xff</span>&nbsp;<span class="op" id="1798455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798461">return</span>&nbsp;<span class="builtintype" id="1798468">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798477">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798485">i0</span>&nbsp;<span class="op" id="1798488">+=</span>&nbsp;<span class="ident" id="1798491">p</span><span class="op" id="1798492">.</span><span class="ident" id="1798493">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798502">i1</span>&nbsp;<span class="op" id="1798505">+=</span>&nbsp;<span class="ident" id="1798508">p</span><span class="op" id="1798509">.</span><span class="ident" id="1798510">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1798518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798521">return</span>&nbsp;<span class="builtintype" id="1798528">true</span><br>
<span class="lineno">360</span><span class="op" id="1798533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798536">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1798591">func</span>&nbsp;<span class="ident" id="1798596">NewNRGBA</span><span class="op" id="1798604">(</span><span class="ident" id="1798605">r</span>&nbsp;<span class="ident" id="1798607">Rectangle</span><span class="op" id="1798616">)</span>&nbsp;<span class="op" id="1798618">*</span><span class="ident" id="1798619">NRGBA</span>&nbsp;<span class="op" id="1798625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798628">w</span><span class="op" id="1798629">,</span>&nbsp;<span class="ident" id="1798631">h</span>&nbsp;<span class="op" id="1798633">:=</span>&nbsp;<span class="ident" id="1798636">r</span><span class="op" id="1798637">.</span><span class="ident" id="1798638">Dx</span><span class="op" id="1798640">(</span><span class="op" id="1798641">)</span><span class="op" id="1798642">,</span>&nbsp;<span class="ident" id="1798644">r</span><span class="op" id="1798645">.</span><span class="ident" id="1798646">Dy</span><span class="op" id="1798648">(</span><span class="op" id="1798649">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798652">pix</span>&nbsp;<span class="op" id="1798656">:=</span>&nbsp;<span class="builtinfunc" id="1798659">make</span><span class="op" id="1798663">(</span><span class="op" id="1798664">[</span><span class="op" id="1798665">]</span><span class="builtintype" id="1798666">uint8</span><span class="op" id="1798671">,</span>&nbsp;<span class="num" id="1798673">4</span><span class="op" id="1798674">*</span><span class="ident" id="1798675">w</span><span class="op" id="1798676">*</span><span class="ident" id="1798677">h</span><span class="op" id="1798678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1798681">return</span>&nbsp;<span class="op" id="1798688">&amp;</span><span class="ident" id="1798689">NRGBA</span><span class="op" id="1798694">{</span><span class="ident" id="1798695">pix</span><span class="op" id="1798698">,</span>&nbsp;<span class="num" id="1798700">4</span>&nbsp;<span class="op" id="1798702">*</span>&nbsp;<span class="ident" id="1798704">w</span><span class="op" id="1798705">,</span>&nbsp;<span class="ident" id="1798707">r</span><span class="op" id="1798708">}</span><br>
<span class="lineno"></span><span class="op" id="1798710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798713">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="1798792">type</span>&nbsp;<span class="ident" id="1798797">NRGBA64</span>&nbsp;<span class="keyword" id="1798805">struct</span>&nbsp;<span class="op" id="1798812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1798815">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1798905">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1798973">Pix</span>&nbsp;<span class="op" id="1798977">[</span><span class="op" id="1798978">]</span><span class="builtintype" id="1798979">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1798986">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1799062">Stride</span>&nbsp;<span class="builtintype" id="1799069">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1799074">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1799106">Rect</span>&nbsp;<span class="ident" id="1799111">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1799121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="1799124">func</span>&nbsp;<span class="op" id="1799129">(</span><span class="ident" id="1799130">p</span>&nbsp;<span class="op" id="1799132">*</span><span class="ident" id="1799133">NRGBA64</span><span class="op" id="1799140">)</span>&nbsp;<span class="ident" id="1799142">ColorModel</span><span class="op" id="1799152">(</span><span class="op" id="1799153">)</span>&nbsp;<span class="ident" id="1799155">color</span><span class="op" id="1799160">.</span><span class="ident" id="1799161">Model</span>&nbsp;<span class="op" id="1799167">{</span>&nbsp;<span class="keyword" id="1799169">return</span>&nbsp;<span class="ident" id="1799176">color</span><span class="op" id="1799181">.</span><span class="ident" id="1799182">NRGBA64Model</span>&nbsp;<span class="op" id="1799195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1799198">func</span>&nbsp;<span class="op" id="1799203">(</span><span class="ident" id="1799204">p</span>&nbsp;<span class="op" id="1799206">*</span><span class="ident" id="1799207">NRGBA64</span><span class="op" id="1799214">)</span>&nbsp;<span class="ident" id="1799216">Bounds</span><span class="op" id="1799222">(</span><span class="op" id="1799223">)</span>&nbsp;<span class="ident" id="1799225">Rectangle</span>&nbsp;<span class="op" id="1799235">{</span>&nbsp;<span class="keyword" id="1799237">return</span>&nbsp;<span class="ident" id="1799244">p</span><span class="op" id="1799245">.</span><span class="ident" id="1799246">Rect</span>&nbsp;<span class="op" id="1799251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1799254">func</span>&nbsp;<span class="op" id="1799259">(</span><span class="ident" id="1799260">p</span>&nbsp;<span class="op" id="1799262">*</span><span class="ident" id="1799263">NRGBA64</span><span class="op" id="1799270">)</span>&nbsp;<span class="ident" id="1799272">At</span><span class="op" id="1799274">(</span><span class="ident" id="1799275">x</span><span class="op" id="1799276">,</span>&nbsp;<span class="ident" id="1799278">y</span>&nbsp;<span class="builtintype" id="1799280">int</span><span class="op" id="1799283">)</span>&nbsp;<span class="ident" id="1799285">color</span><span class="op" id="1799290">.</span><span class="ident" id="1799291">Color</span>&nbsp;<span class="op" id="1799297">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799300">return</span>&nbsp;<span class="ident" id="1799307">p</span><span class="op" id="1799308">.</span><span class="ident" id="1799309">NRGBA64At</span><span class="op" id="1799318">(</span><span class="ident" id="1799319">x</span><span class="op" id="1799320">,</span>&nbsp;<span class="ident" id="1799322">y</span><span class="op" id="1799323">)</span><br>
<span class="lineno"></span><span class="op" id="1799325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1799328">func</span>&nbsp;<span class="op" id="1799333">(</span><span class="ident" id="1799334">p</span>&nbsp;<span class="op" id="1799336">*</span><span class="ident" id="1799337">NRGBA64</span><span class="op" id="1799344">)</span>&nbsp;<span class="ident" id="1799346">NRGBA64At</span><span class="op" id="1799355">(</span><span class="ident" id="1799356">x</span><span class="op" id="1799357">,</span>&nbsp;<span class="ident" id="1799359">y</span>&nbsp;<span class="builtintype" id="1799361">int</span><span class="op" id="1799364">)</span>&nbsp;<span class="ident" id="1799366">color</span><span class="op" id="1799371">.</span><span class="ident" id="1799372">NRGBA64</span>&nbsp;<span class="op" id="1799380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799383">if</span>&nbsp;<span class="op" id="1799386">!</span><span class="op" id="1799387">(</span><span class="ident" id="1799388">Point</span><span class="op" id="1799393">{</span><span class="ident" id="1799394">x</span><span class="op" id="1799395">,</span>&nbsp;<span class="ident" id="1799397">y</span><span class="op" id="1799398">}</span><span class="op" id="1799399">.</span><span class="ident" id="1799400">In</span><span class="op" id="1799402">(</span><span class="ident" id="1799403">p</span><span class="op" id="1799404">.</span><span class="ident" id="1799405">Rect</span><span class="op" id="1799409">)</span><span class="op" id="1799410">)</span>&nbsp;<span class="op" id="1799412">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799416">return</span>&nbsp;<span class="ident" id="1799423">color</span><span class="op" id="1799428">.</span><span class="ident" id="1799429">NRGBA64</span><span class="op" id="1799436">{</span><span class="op" id="1799437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1799440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1799443">i</span>&nbsp;<span class="op" id="1799445">:=</span>&nbsp;<span class="ident" id="1799448">p</span><span class="op" id="1799449">.</span><span class="ident" id="1799450">PixOffset</span><span class="op" id="1799459">(</span><span class="ident" id="1799460">x</span><span class="op" id="1799461">,</span>&nbsp;<span class="ident" id="1799463">y</span><span class="op" id="1799464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799467">return</span>&nbsp;<span class="ident" id="1799474">color</span><span class="op" id="1799479">.</span><span class="ident" id="1799480">NRGBA64</span><span class="op" id="1799487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1799491">uint16</span><span class="op" id="1799497">(</span><span class="ident" id="1799498">p</span><span class="op" id="1799499">.</span><span class="ident" id="1799500">Pix</span><span class="op" id="1799503">[</span><span class="ident" id="1799504">i</span><span class="op" id="1799505">+</span><span class="num" id="1799506">0</span><span class="op" id="1799507">]</span><span class="op" id="1799508">)</span><span class="op" id="1799509">&lt;&lt;</span><span class="num" id="1799511">8</span>&nbsp;<span class="op" id="1799513">|</span>&nbsp;<span class="builtintype" id="1799515">uint16</span><span class="op" id="1799521">(</span><span class="ident" id="1799522">p</span><span class="op" id="1799523">.</span><span class="ident" id="1799524">Pix</span><span class="op" id="1799527">[</span><span class="ident" id="1799528">i</span><span class="op" id="1799529">+</span><span class="num" id="1799530">1</span><span class="op" id="1799531">]</span><span class="op" id="1799532">)</span><span class="op" id="1799533">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1799537">uint16</span><span class="op" id="1799543">(</span><span class="ident" id="1799544">p</span><span class="op" id="1799545">.</span><span class="ident" id="1799546">Pix</span><span class="op" id="1799549">[</span><span class="ident" id="1799550">i</span><span class="op" id="1799551">+</span><span class="num" id="1799552">2</span><span class="op" id="1799553">]</span><span class="op" id="1799554">)</span><span class="op" id="1799555">&lt;&lt;</span><span class="num" id="1799557">8</span>&nbsp;<span class="op" id="1799559">|</span>&nbsp;<span class="builtintype" id="1799561">uint16</span><span class="op" id="1799567">(</span><span class="ident" id="1799568">p</span><span class="op" id="1799569">.</span><span class="ident" id="1799570">Pix</span><span class="op" id="1799573">[</span><span class="ident" id="1799574">i</span><span class="op" id="1799575">+</span><span class="num" id="1799576">3</span><span class="op" id="1799577">]</span><span class="op" id="1799578">)</span><span class="op" id="1799579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1799583">uint16</span><span class="op" id="1799589">(</span><span class="ident" id="1799590">p</span><span class="op" id="1799591">.</span><span class="ident" id="1799592">Pix</span><span class="op" id="1799595">[</span><span class="ident" id="1799596">i</span><span class="op" id="1799597">+</span><span class="num" id="1799598">4</span><span class="op" id="1799599">]</span><span class="op" id="1799600">)</span><span class="op" id="1799601">&lt;&lt;</span><span class="num" id="1799603">8</span>&nbsp;<span class="op" id="1799605">|</span>&nbsp;<span class="builtintype" id="1799607">uint16</span><span class="op" id="1799613">(</span><span class="ident" id="1799614">p</span><span class="op" id="1799615">.</span><span class="ident" id="1799616">Pix</span><span class="op" id="1799619">[</span><span class="ident" id="1799620">i</span><span class="op" id="1799621">+</span><span class="num" id="1799622">5</span><span class="op" id="1799623">]</span><span class="op" id="1799624">)</span><span class="op" id="1799625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1799629">uint16</span><span class="op" id="1799635">(</span><span class="ident" id="1799636">p</span><span class="op" id="1799637">.</span><span class="ident" id="1799638">Pix</span><span class="op" id="1799641">[</span><span class="ident" id="1799642">i</span><span class="op" id="1799643">+</span><span class="num" id="1799644">6</span><span class="op" id="1799645">]</span><span class="op" id="1799646">)</span><span class="op" id="1799647">&lt;&lt;</span><span class="num" id="1799649">8</span>&nbsp;<span class="op" id="1799651">|</span>&nbsp;<span class="builtintype" id="1799653">uint16</span><span class="op" id="1799659">(</span><span class="ident" id="1799660">p</span><span class="op" id="1799661">.</span><span class="ident" id="1799662">Pix</span><span class="op" id="1799665">[</span><span class="ident" id="1799666">i</span><span class="op" id="1799667">+</span><span class="num" id="1799668">7</span><span class="op" id="1799669">]</span><span class="op" id="1799670">)</span><span class="op" id="1799671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1799674">}</span><br>
<span class="lineno"></span><span class="op" id="1799676">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="1799679">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1799758">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1799782">func</span>&nbsp;<span class="op" id="1799787">(</span><span class="ident" id="1799788">p</span>&nbsp;<span class="op" id="1799790">*</span><span class="ident" id="1799791">NRGBA64</span><span class="op" id="1799798">)</span>&nbsp;<span class="ident" id="1799800">PixOffset</span><span class="op" id="1799809">(</span><span class="ident" id="1799810">x</span><span class="op" id="1799811">,</span>&nbsp;<span class="ident" id="1799813">y</span>&nbsp;<span class="builtintype" id="1799815">int</span><span class="op" id="1799818">)</span>&nbsp;<span class="builtintype" id="1799820">int</span>&nbsp;<span class="op" id="1799824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799827">return</span>&nbsp;<span class="op" id="1799834">(</span><span class="ident" id="1799835">y</span><span class="op" id="1799836">-</span><span class="ident" id="1799837">p</span><span class="op" id="1799838">.</span><span class="ident" id="1799839">Rect</span><span class="op" id="1799843">.</span><span class="ident" id="1799844">Min</span><span class="op" id="1799847">.</span><span class="ident" id="1799848">Y</span><span class="op" id="1799849">)</span><span class="op" id="1799850">*</span><span class="ident" id="1799851">p</span><span class="op" id="1799852">.</span><span class="ident" id="1799853">Stride</span>&nbsp;<span class="op" id="1799860">+</span>&nbsp;<span class="op" id="1799862">(</span><span class="ident" id="1799863">x</span><span class="op" id="1799864">-</span><span class="ident" id="1799865">p</span><span class="op" id="1799866">.</span><span class="ident" id="1799867">Rect</span><span class="op" id="1799871">.</span><span class="ident" id="1799872">Min</span><span class="op" id="1799875">.</span><span class="ident" id="1799876">X</span><span class="op" id="1799877">)</span><span class="op" id="1799878">*</span><span class="num" id="1799879">8</span><br>
<span class="lineno">405</span><span class="op" id="1799881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1799884">func</span>&nbsp;<span class="op" id="1799889">(</span><span class="ident" id="1799890">p</span>&nbsp;<span class="op" id="1799892">*</span><span class="ident" id="1799893">NRGBA64</span><span class="op" id="1799900">)</span>&nbsp;<span class="ident" id="1799902">Set</span><span class="op" id="1799905">(</span><span class="ident" id="1799906">x</span><span class="op" id="1799907">,</span>&nbsp;<span class="ident" id="1799909">y</span>&nbsp;<span class="builtintype" id="1799911">int</span><span class="op" id="1799914">,</span>&nbsp;<span class="ident" id="1799916">c</span>&nbsp;<span class="ident" id="1799918">color</span><span class="op" id="1799923">.</span><span class="ident" id="1799924">Color</span><span class="op" id="1799929">)</span>&nbsp;<span class="op" id="1799931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799934">if</span>&nbsp;<span class="op" id="1799937">!</span><span class="op" id="1799938">(</span><span class="ident" id="1799939">Point</span><span class="op" id="1799944">{</span><span class="ident" id="1799945">x</span><span class="op" id="1799946">,</span>&nbsp;<span class="ident" id="1799948">y</span><span class="op" id="1799949">}</span><span class="op" id="1799950">.</span><span class="ident" id="1799951">In</span><span class="op" id="1799953">(</span><span class="ident" id="1799954">p</span><span class="op" id="1799955">.</span><span class="ident" id="1799956">Rect</span><span class="op" id="1799960">)</span><span class="op" id="1799961">)</span>&nbsp;<span class="op" id="1799963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1799967">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1799975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1799978">i</span>&nbsp;<span class="op" id="1799980">:=</span>&nbsp;<span class="ident" id="1799983">p</span><span class="op" id="1799984">.</span><span class="ident" id="1799985">PixOffset</span><span class="op" id="1799994">(</span><span class="ident" id="1799995">x</span><span class="op" id="1799996">,</span>&nbsp;<span class="ident" id="1799998">y</span><span class="op" id="1799999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800002">c1</span>&nbsp;<span class="op" id="1800005">:=</span>&nbsp;<span class="ident" id="1800008">color</span><span class="op" id="1800013">.</span><span class="ident" id="1800014">NRGBA64Model</span><span class="op" id="1800026">.</span><span class="ident" id="1800027">Convert</span><span class="op" id="1800034">(</span><span class="ident" id="1800035">c</span><span class="op" id="1800036">)</span><span class="op" id="1800037">.</span><span class="op" id="1800038">(</span><span class="ident" id="1800039">color</span><span class="op" id="1800044">.</span><span class="ident" id="1800045">NRGBA64</span><span class="op" id="1800052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800055">p</span><span class="op" id="1800056">.</span><span class="ident" id="1800057">Pix</span><span class="op" id="1800060">[</span><span class="ident" id="1800061">i</span><span class="op" id="1800062">+</span><span class="num" id="1800063">0</span><span class="op" id="1800064">]</span>&nbsp;<span class="op" id="1800066">=</span>&nbsp;<span class="builtintype" id="1800068">uint8</span><span class="op" id="1800073">(</span><span class="ident" id="1800074">c1</span><span class="op" id="1800076">.</span><span class="ident" id="1800077">R</span>&nbsp;<span class="op" id="1800079">&gt;&gt;</span>&nbsp;<span class="num" id="1800082">8</span><span class="op" id="1800083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800086">p</span><span class="op" id="1800087">.</span><span class="ident" id="1800088">Pix</span><span class="op" id="1800091">[</span><span class="ident" id="1800092">i</span><span class="op" id="1800093">+</span><span class="num" id="1800094">1</span><span class="op" id="1800095">]</span>&nbsp;<span class="op" id="1800097">=</span>&nbsp;<span class="builtintype" id="1800099">uint8</span><span class="op" id="1800104">(</span><span class="ident" id="1800105">c1</span><span class="op" id="1800107">.</span><span class="ident" id="1800108">R</span><span class="op" id="1800109">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800112">p</span><span class="op" id="1800113">.</span><span class="ident" id="1800114">Pix</span><span class="op" id="1800117">[</span><span class="ident" id="1800118">i</span><span class="op" id="1800119">+</span><span class="num" id="1800120">2</span><span class="op" id="1800121">]</span>&nbsp;<span class="op" id="1800123">=</span>&nbsp;<span class="builtintype" id="1800125">uint8</span><span class="op" id="1800130">(</span><span class="ident" id="1800131">c1</span><span class="op" id="1800133">.</span><span class="ident" id="1800134">G</span>&nbsp;<span class="op" id="1800136">&gt;&gt;</span>&nbsp;<span class="num" id="1800139">8</span><span class="op" id="1800140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800143">p</span><span class="op" id="1800144">.</span><span class="ident" id="1800145">Pix</span><span class="op" id="1800148">[</span><span class="ident" id="1800149">i</span><span class="op" id="1800150">+</span><span class="num" id="1800151">3</span><span class="op" id="1800152">]</span>&nbsp;<span class="op" id="1800154">=</span>&nbsp;<span class="builtintype" id="1800156">uint8</span><span class="op" id="1800161">(</span><span class="ident" id="1800162">c1</span><span class="op" id="1800164">.</span><span class="ident" id="1800165">G</span><span class="op" id="1800166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800169">p</span><span class="op" id="1800170">.</span><span class="ident" id="1800171">Pix</span><span class="op" id="1800174">[</span><span class="ident" id="1800175">i</span><span class="op" id="1800176">+</span><span class="num" id="1800177">4</span><span class="op" id="1800178">]</span>&nbsp;<span class="op" id="1800180">=</span>&nbsp;<span class="builtintype" id="1800182">uint8</span><span class="op" id="1800187">(</span><span class="ident" id="1800188">c1</span><span class="op" id="1800190">.</span><span class="ident" id="1800191">B</span>&nbsp;<span class="op" id="1800193">&gt;&gt;</span>&nbsp;<span class="num" id="1800196">8</span><span class="op" id="1800197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800200">p</span><span class="op" id="1800201">.</span><span class="ident" id="1800202">Pix</span><span class="op" id="1800205">[</span><span class="ident" id="1800206">i</span><span class="op" id="1800207">+</span><span class="num" id="1800208">5</span><span class="op" id="1800209">]</span>&nbsp;<span class="op" id="1800211">=</span>&nbsp;<span class="builtintype" id="1800213">uint8</span><span class="op" id="1800218">(</span><span class="ident" id="1800219">c1</span><span class="op" id="1800221">.</span><span class="ident" id="1800222">B</span><span class="op" id="1800223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800226">p</span><span class="op" id="1800227">.</span><span class="ident" id="1800228">Pix</span><span class="op" id="1800231">[</span><span class="ident" id="1800232">i</span><span class="op" id="1800233">+</span><span class="num" id="1800234">6</span><span class="op" id="1800235">]</span>&nbsp;<span class="op" id="1800237">=</span>&nbsp;<span class="builtintype" id="1800239">uint8</span><span class="op" id="1800244">(</span><span class="ident" id="1800245">c1</span><span class="op" id="1800247">.</span><span class="ident" id="1800248">A</span>&nbsp;<span class="op" id="1800250">&gt;&gt;</span>&nbsp;<span class="num" id="1800253">8</span><span class="op" id="1800254">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800257">p</span><span class="op" id="1800258">.</span><span class="ident" id="1800259">Pix</span><span class="op" id="1800262">[</span><span class="ident" id="1800263">i</span><span class="op" id="1800264">+</span><span class="num" id="1800265">7</span><span class="op" id="1800266">]</span>&nbsp;<span class="op" id="1800268">=</span>&nbsp;<span class="builtintype" id="1800270">uint8</span><span class="op" id="1800275">(</span><span class="ident" id="1800276">c1</span><span class="op" id="1800278">.</span><span class="ident" id="1800279">A</span><span class="op" id="1800280">)</span><br>
<span class="lineno"></span><span class="op" id="1800282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1800285">func</span>&nbsp;<span class="op" id="1800290">(</span><span class="ident" id="1800291">p</span>&nbsp;<span class="op" id="1800293">*</span><span class="ident" id="1800294">NRGBA64</span><span class="op" id="1800301">)</span>&nbsp;<span class="ident" id="1800303">SetNRGBA64</span><span class="op" id="1800313">(</span><span class="ident" id="1800314">x</span><span class="op" id="1800315">,</span>&nbsp;<span class="ident" id="1800317">y</span>&nbsp;<span class="builtintype" id="1800319">int</span><span class="op" id="1800322">,</span>&nbsp;<span class="ident" id="1800324">c</span>&nbsp;<span class="ident" id="1800326">color</span><span class="op" id="1800331">.</span><span class="ident" id="1800332">NRGBA64</span><span class="op" id="1800339">)</span>&nbsp;<span class="op" id="1800341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1800344">if</span>&nbsp;<span class="op" id="1800347">!</span><span class="op" id="1800348">(</span><span class="ident" id="1800349">Point</span><span class="op" id="1800354">{</span><span class="ident" id="1800355">x</span><span class="op" id="1800356">,</span>&nbsp;<span class="ident" id="1800358">y</span><span class="op" id="1800359">}</span><span class="op" id="1800360">.</span><span class="ident" id="1800361">In</span><span class="op" id="1800363">(</span><span class="ident" id="1800364">p</span><span class="op" id="1800365">.</span><span class="ident" id="1800366">Rect</span><span class="op" id="1800370">)</span><span class="op" id="1800371">)</span>&nbsp;<span class="op" id="1800373">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1800377">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1800385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800388">i</span>&nbsp;<span class="op" id="1800390">:=</span>&nbsp;<span class="ident" id="1800393">p</span><span class="op" id="1800394">.</span><span class="ident" id="1800395">PixOffset</span><span class="op" id="1800404">(</span><span class="ident" id="1800405">x</span><span class="op" id="1800406">,</span>&nbsp;<span class="ident" id="1800408">y</span><span class="op" id="1800409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800412">p</span><span class="op" id="1800413">.</span><span class="ident" id="1800414">Pix</span><span class="op" id="1800417">[</span><span class="ident" id="1800418">i</span><span class="op" id="1800419">+</span><span class="num" id="1800420">0</span><span class="op" id="1800421">]</span>&nbsp;<span class="op" id="1800423">=</span>&nbsp;<span class="builtintype" id="1800425">uint8</span><span class="op" id="1800430">(</span><span class="ident" id="1800431">c</span><span class="op" id="1800432">.</span><span class="ident" id="1800433">R</span>&nbsp;<span class="op" id="1800435">&gt;&gt;</span>&nbsp;<span class="num" id="1800438">8</span><span class="op" id="1800439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800442">p</span><span class="op" id="1800443">.</span><span class="ident" id="1800444">Pix</span><span class="op" id="1800447">[</span><span class="ident" id="1800448">i</span><span class="op" id="1800449">+</span><span class="num" id="1800450">1</span><span class="op" id="1800451">]</span>&nbsp;<span class="op" id="1800453">=</span>&nbsp;<span class="builtintype" id="1800455">uint8</span><span class="op" id="1800460">(</span><span class="ident" id="1800461">c</span><span class="op" id="1800462">.</span><span class="ident" id="1800463">R</span><span class="op" id="1800464">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800467">p</span><span class="op" id="1800468">.</span><span class="ident" id="1800469">Pix</span><span class="op" id="1800472">[</span><span class="ident" id="1800473">i</span><span class="op" id="1800474">+</span><span class="num" id="1800475">2</span><span class="op" id="1800476">]</span>&nbsp;<span class="op" id="1800478">=</span>&nbsp;<span class="builtintype" id="1800480">uint8</span><span class="op" id="1800485">(</span><span class="ident" id="1800486">c</span><span class="op" id="1800487">.</span><span class="ident" id="1800488">G</span>&nbsp;<span class="op" id="1800490">&gt;&gt;</span>&nbsp;<span class="num" id="1800493">8</span><span class="op" id="1800494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800497">p</span><span class="op" id="1800498">.</span><span class="ident" id="1800499">Pix</span><span class="op" id="1800502">[</span><span class="ident" id="1800503">i</span><span class="op" id="1800504">+</span><span class="num" id="1800505">3</span><span class="op" id="1800506">]</span>&nbsp;<span class="op" id="1800508">=</span>&nbsp;<span class="builtintype" id="1800510">uint8</span><span class="op" id="1800515">(</span><span class="ident" id="1800516">c</span><span class="op" id="1800517">.</span><span class="ident" id="1800518">G</span><span class="op" id="1800519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800522">p</span><span class="op" id="1800523">.</span><span class="ident" id="1800524">Pix</span><span class="op" id="1800527">[</span><span class="ident" id="1800528">i</span><span class="op" id="1800529">+</span><span class="num" id="1800530">4</span><span class="op" id="1800531">]</span>&nbsp;<span class="op" id="1800533">=</span>&nbsp;<span class="builtintype" id="1800535">uint8</span><span class="op" id="1800540">(</span><span class="ident" id="1800541">c</span><span class="op" id="1800542">.</span><span class="ident" id="1800543">B</span>&nbsp;<span class="op" id="1800545">&gt;&gt;</span>&nbsp;<span class="num" id="1800548">8</span><span class="op" id="1800549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800552">p</span><span class="op" id="1800553">.</span><span class="ident" id="1800554">Pix</span><span class="op" id="1800557">[</span><span class="ident" id="1800558">i</span><span class="op" id="1800559">+</span><span class="num" id="1800560">5</span><span class="op" id="1800561">]</span>&nbsp;<span class="op" id="1800563">=</span>&nbsp;<span class="builtintype" id="1800565">uint8</span><span class="op" id="1800570">(</span><span class="ident" id="1800571">c</span><span class="op" id="1800572">.</span><span class="ident" id="1800573">B</span><span class="op" id="1800574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800577">p</span><span class="op" id="1800578">.</span><span class="ident" id="1800579">Pix</span><span class="op" id="1800582">[</span><span class="ident" id="1800583">i</span><span class="op" id="1800584">+</span><span class="num" id="1800585">6</span><span class="op" id="1800586">]</span>&nbsp;<span class="op" id="1800588">=</span>&nbsp;<span class="builtintype" id="1800590">uint8</span><span class="op" id="1800595">(</span><span class="ident" id="1800596">c</span><span class="op" id="1800597">.</span><span class="ident" id="1800598">A</span>&nbsp;<span class="op" id="1800600">&gt;&gt;</span>&nbsp;<span class="num" id="1800603">8</span><span class="op" id="1800604">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800607">p</span><span class="op" id="1800608">.</span><span class="ident" id="1800609">Pix</span><span class="op" id="1800612">[</span><span class="ident" id="1800613">i</span><span class="op" id="1800614">+</span><span class="num" id="1800615">7</span><span class="op" id="1800616">]</span>&nbsp;<span class="op" id="1800618">=</span>&nbsp;<span class="builtintype" id="1800620">uint8</span><span class="op" id="1800625">(</span><span class="ident" id="1800626">c</span><span class="op" id="1800627">.</span><span class="ident" id="1800628">A</span><span class="op" id="1800629">)</span><br>
<span class="lineno"></span><span class="op" id="1800631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800634">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1800711">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="1800783">func</span>&nbsp;<span class="op" id="1800788">(</span><span class="ident" id="1800789">p</span>&nbsp;<span class="op" id="1800791">*</span><span class="ident" id="1800792">NRGBA64</span><span class="op" id="1800799">)</span>&nbsp;<span class="ident" id="1800801">SubImage</span><span class="op" id="1800809">(</span><span class="ident" id="1800810">r</span>&nbsp;<span class="ident" id="1800812">Rectangle</span><span class="op" id="1800821">)</span>&nbsp;<span class="ident" id="1800823">Image</span>&nbsp;<span class="op" id="1800829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1800832">r</span>&nbsp;<span class="op" id="1800834">=</span>&nbsp;<span class="ident" id="1800836">r</span><span class="op" id="1800837">.</span><span class="ident" id="1800838">Intersect</span><span class="op" id="1800847">(</span><span class="ident" id="1800848">p</span><span class="op" id="1800849">.</span><span class="ident" id="1800850">Rect</span><span class="op" id="1800854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1800857">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1800938">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1801020">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801070">if</span>&nbsp;<span class="ident" id="1801073">r</span><span class="op" id="1801074">.</span><span class="ident" id="1801075">Empty</span><span class="op" id="1801080">(</span><span class="op" id="1801081">)</span>&nbsp;<span class="op" id="1801083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801087">return</span>&nbsp;<span class="op" id="1801094">&amp;</span><span class="ident" id="1801095">NRGBA64</span><span class="op" id="1801102">{</span><span class="op" id="1801103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801109">i</span>&nbsp;<span class="op" id="1801111">:=</span>&nbsp;<span class="ident" id="1801114">p</span><span class="op" id="1801115">.</span><span class="ident" id="1801116">PixOffset</span><span class="op" id="1801125">(</span><span class="ident" id="1801126">r</span><span class="op" id="1801127">.</span><span class="ident" id="1801128">Min</span><span class="op" id="1801131">.</span><span class="ident" id="1801132">X</span><span class="op" id="1801133">,</span>&nbsp;<span class="ident" id="1801135">r</span><span class="op" id="1801136">.</span><span class="ident" id="1801137">Min</span><span class="op" id="1801140">.</span><span class="ident" id="1801141">Y</span><span class="op" id="1801142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801145">return</span>&nbsp;<span class="op" id="1801152">&amp;</span><span class="ident" id="1801153">NRGBA64</span><span class="op" id="1801160">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801164">Pix</span><span class="op" id="1801167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801172">p</span><span class="op" id="1801173">.</span><span class="ident" id="1801174">Pix</span><span class="op" id="1801177">[</span><span class="ident" id="1801178">i</span><span class="op" id="1801179">:</span><span class="op" id="1801180">]</span><span class="op" id="1801181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801185">Stride</span><span class="op" id="1801191">:</span>&nbsp;<span class="ident" id="1801193">p</span><span class="op" id="1801194">.</span><span class="ident" id="1801195">Stride</span><span class="op" id="1801201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801205">Rect</span><span class="op" id="1801209">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1801213">r</span><span class="op" id="1801214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801217">}</span><br>
<span class="lineno"></span><span class="op" id="1801219">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="1801222">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1801295">func</span>&nbsp;<span class="op" id="1801300">(</span><span class="ident" id="1801301">p</span>&nbsp;<span class="op" id="1801303">*</span><span class="ident" id="1801304">NRGBA64</span><span class="op" id="1801311">)</span>&nbsp;<span class="ident" id="1801313">Opaque</span><span class="op" id="1801319">(</span><span class="op" id="1801320">)</span>&nbsp;<span class="builtintype" id="1801322">bool</span>&nbsp;<span class="op" id="1801327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801330">if</span>&nbsp;<span class="ident" id="1801333">p</span><span class="op" id="1801334">.</span><span class="ident" id="1801335">Rect</span><span class="op" id="1801339">.</span><span class="ident" id="1801340">Empty</span><span class="op" id="1801345">(</span><span class="op" id="1801346">)</span>&nbsp;<span class="op" id="1801348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801352">return</span>&nbsp;<span class="builtintype" id="1801359">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801368">i0</span><span class="op" id="1801370">,</span>&nbsp;<span class="ident" id="1801372">i1</span>&nbsp;<span class="op" id="1801375">:=</span>&nbsp;<span class="num" id="1801378">6</span><span class="op" id="1801379">,</span>&nbsp;<span class="ident" id="1801381">p</span><span class="op" id="1801382">.</span><span class="ident" id="1801383">Rect</span><span class="op" id="1801387">.</span><span class="ident" id="1801388">Dx</span><span class="op" id="1801390">(</span><span class="op" id="1801391">)</span><span class="op" id="1801392">*</span><span class="num" id="1801393">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801396">for</span>&nbsp;<span class="ident" id="1801400">y</span>&nbsp;<span class="op" id="1801402">:=</span>&nbsp;<span class="ident" id="1801405">p</span><span class="op" id="1801406">.</span><span class="ident" id="1801407">Rect</span><span class="op" id="1801411">.</span><span class="ident" id="1801412">Min</span><span class="op" id="1801415">.</span><span class="ident" id="1801416">Y</span><span class="op" id="1801417">;</span>&nbsp;<span class="ident" id="1801419">y</span>&nbsp;<span class="op" id="1801421">&lt;</span>&nbsp;<span class="ident" id="1801423">p</span><span class="op" id="1801424">.</span><span class="ident" id="1801425">Rect</span><span class="op" id="1801429">.</span><span class="ident" id="1801430">Max</span><span class="op" id="1801433">.</span><span class="ident" id="1801434">Y</span><span class="op" id="1801435">;</span>&nbsp;<span class="ident" id="1801437">y</span><span class="op" id="1801438">++</span>&nbsp;<span class="op" id="1801441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801445">for</span>&nbsp;<span class="ident" id="1801449">i</span>&nbsp;<span class="op" id="1801451">:=</span>&nbsp;<span class="ident" id="1801454">i0</span><span class="op" id="1801456">;</span>&nbsp;<span class="ident" id="1801458">i</span>&nbsp;<span class="op" id="1801460">&lt;</span>&nbsp;<span class="ident" id="1801462">i1</span><span class="op" id="1801464">;</span>&nbsp;<span class="ident" id="1801466">i</span>&nbsp;<span class="op" id="1801468">+=</span>&nbsp;<span class="num" id="1801471">8</span>&nbsp;<span class="op" id="1801473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801478">if</span>&nbsp;<span class="ident" id="1801481">p</span><span class="op" id="1801482">.</span><span class="ident" id="1801483">Pix</span><span class="op" id="1801486">[</span><span class="ident" id="1801487">i</span><span class="op" id="1801488">+</span><span class="num" id="1801489">0</span><span class="op" id="1801490">]</span>&nbsp;<span class="op" id="1801492">!=</span>&nbsp;<span class="num" id="1801495">0xff</span>&nbsp;<span class="op" id="1801500">||</span>&nbsp;<span class="ident" id="1801503">p</span><span class="op" id="1801504">.</span><span class="ident" id="1801505">Pix</span><span class="op" id="1801508">[</span><span class="ident" id="1801509">i</span><span class="op" id="1801510">+</span><span class="num" id="1801511">1</span><span class="op" id="1801512">]</span>&nbsp;<span class="op" id="1801514">!=</span>&nbsp;<span class="num" id="1801517">0xff</span>&nbsp;<span class="op" id="1801522">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801528">return</span>&nbsp;<span class="builtintype" id="1801535">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801552">i0</span>&nbsp;<span class="op" id="1801555">+=</span>&nbsp;<span class="ident" id="1801558">p</span><span class="op" id="1801559">.</span><span class="ident" id="1801560">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801569">i1</span>&nbsp;<span class="op" id="1801572">+=</span>&nbsp;<span class="ident" id="1801575">p</span><span class="op" id="1801576">.</span><span class="ident" id="1801577">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1801585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801588">return</span>&nbsp;<span class="builtintype" id="1801595">true</span><br>
<span class="lineno"></span><span class="op" id="1801600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801603">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="1801662">func</span>&nbsp;<span class="ident" id="1801667">NewNRGBA64</span><span class="op" id="1801677">(</span><span class="ident" id="1801678">r</span>&nbsp;<span class="ident" id="1801680">Rectangle</span><span class="op" id="1801689">)</span>&nbsp;<span class="op" id="1801691">*</span><span class="ident" id="1801692">NRGBA64</span>&nbsp;<span class="op" id="1801700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801703">w</span><span class="op" id="1801704">,</span>&nbsp;<span class="ident" id="1801706">h</span>&nbsp;<span class="op" id="1801708">:=</span>&nbsp;<span class="ident" id="1801711">r</span><span class="op" id="1801712">.</span><span class="ident" id="1801713">Dx</span><span class="op" id="1801715">(</span><span class="op" id="1801716">)</span><span class="op" id="1801717">,</span>&nbsp;<span class="ident" id="1801719">r</span><span class="op" id="1801720">.</span><span class="ident" id="1801721">Dy</span><span class="op" id="1801723">(</span><span class="op" id="1801724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1801727">pix</span>&nbsp;<span class="op" id="1801731">:=</span>&nbsp;<span class="builtinfunc" id="1801734">make</span><span class="op" id="1801738">(</span><span class="op" id="1801739">[</span><span class="op" id="1801740">]</span><span class="builtintype" id="1801741">uint8</span><span class="op" id="1801746">,</span>&nbsp;<span class="num" id="1801748">8</span><span class="op" id="1801749">*</span><span class="ident" id="1801750">w</span><span class="op" id="1801751">*</span><span class="ident" id="1801752">h</span><span class="op" id="1801753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1801756">return</span>&nbsp;<span class="op" id="1801763">&amp;</span><span class="ident" id="1801764">NRGBA64</span><span class="op" id="1801771">{</span><span class="ident" id="1801772">pix</span><span class="op" id="1801775">,</span>&nbsp;<span class="num" id="1801777">8</span>&nbsp;<span class="op" id="1801779">*</span>&nbsp;<span class="ident" id="1801781">w</span><span class="op" id="1801782">,</span>&nbsp;<span class="ident" id="1801784">r</span><span class="op" id="1801785">}</span><br>
<span class="lineno"></span><span class="op" id="1801787">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="1801790">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1801865">type</span>&nbsp;<span class="ident" id="1801870">Alpha</span>&nbsp;<span class="keyword" id="1801876">struct</span>&nbsp;<span class="op" id="1801883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1801886">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1801950">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802018">Pix</span>&nbsp;<span class="op" id="1802022">[</span><span class="op" id="1802023">]</span><span class="builtintype" id="1802024">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1802031">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802107">Stride</span>&nbsp;<span class="builtintype" id="1802114">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1802119">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802151">Rect</span>&nbsp;<span class="ident" id="1802156">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="1802166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1802169">func</span>&nbsp;<span class="op" id="1802174">(</span><span class="ident" id="1802175">p</span>&nbsp;<span class="op" id="1802177">*</span><span class="ident" id="1802178">Alpha</span><span class="op" id="1802183">)</span>&nbsp;<span class="ident" id="1802185">ColorModel</span><span class="op" id="1802195">(</span><span class="op" id="1802196">)</span>&nbsp;<span class="ident" id="1802198">color</span><span class="op" id="1802203">.</span><span class="ident" id="1802204">Model</span>&nbsp;<span class="op" id="1802210">{</span>&nbsp;<span class="keyword" id="1802212">return</span>&nbsp;<span class="ident" id="1802219">color</span><span class="op" id="1802224">.</span><span class="ident" id="1802225">AlphaModel</span>&nbsp;<span class="op" id="1802236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1802239">func</span>&nbsp;<span class="op" id="1802244">(</span><span class="ident" id="1802245">p</span>&nbsp;<span class="op" id="1802247">*</span><span class="ident" id="1802248">Alpha</span><span class="op" id="1802253">)</span>&nbsp;<span class="ident" id="1802255">Bounds</span><span class="op" id="1802261">(</span><span class="op" id="1802262">)</span>&nbsp;<span class="ident" id="1802264">Rectangle</span>&nbsp;<span class="op" id="1802274">{</span>&nbsp;<span class="keyword" id="1802276">return</span>&nbsp;<span class="ident" id="1802283">p</span><span class="op" id="1802284">.</span><span class="ident" id="1802285">Rect</span>&nbsp;<span class="op" id="1802290">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="1802293">func</span>&nbsp;<span class="op" id="1802298">(</span><span class="ident" id="1802299">p</span>&nbsp;<span class="op" id="1802301">*</span><span class="ident" id="1802302">Alpha</span><span class="op" id="1802307">)</span>&nbsp;<span class="ident" id="1802309">At</span><span class="op" id="1802311">(</span><span class="ident" id="1802312">x</span><span class="op" id="1802313">,</span>&nbsp;<span class="ident" id="1802315">y</span>&nbsp;<span class="builtintype" id="1802317">int</span><span class="op" id="1802320">)</span>&nbsp;<span class="ident" id="1802322">color</span><span class="op" id="1802327">.</span><span class="ident" id="1802328">Color</span>&nbsp;<span class="op" id="1802334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802337">return</span>&nbsp;<span class="ident" id="1802344">p</span><span class="op" id="1802345">.</span><span class="ident" id="1802346">AlphaAt</span><span class="op" id="1802353">(</span><span class="ident" id="1802354">x</span><span class="op" id="1802355">,</span>&nbsp;<span class="ident" id="1802357">y</span><span class="op" id="1802358">)</span><br>
<span class="lineno"></span><span class="op" id="1802360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="1802363">func</span>&nbsp;<span class="op" id="1802368">(</span><span class="ident" id="1802369">p</span>&nbsp;<span class="op" id="1802371">*</span><span class="ident" id="1802372">Alpha</span><span class="op" id="1802377">)</span>&nbsp;<span class="ident" id="1802379">AlphaAt</span><span class="op" id="1802386">(</span><span class="ident" id="1802387">x</span><span class="op" id="1802388">,</span>&nbsp;<span class="ident" id="1802390">y</span>&nbsp;<span class="builtintype" id="1802392">int</span><span class="op" id="1802395">)</span>&nbsp;<span class="ident" id="1802397">color</span><span class="op" id="1802402">.</span><span class="ident" id="1802403">Alpha</span>&nbsp;<span class="op" id="1802409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802412">if</span>&nbsp;<span class="op" id="1802415">!</span><span class="op" id="1802416">(</span><span class="ident" id="1802417">Point</span><span class="op" id="1802422">{</span><span class="ident" id="1802423">x</span><span class="op" id="1802424">,</span>&nbsp;<span class="ident" id="1802426">y</span><span class="op" id="1802427">}</span><span class="op" id="1802428">.</span><span class="ident" id="1802429">In</span><span class="op" id="1802431">(</span><span class="ident" id="1802432">p</span><span class="op" id="1802433">.</span><span class="ident" id="1802434">Rect</span><span class="op" id="1802438">)</span><span class="op" id="1802439">)</span>&nbsp;<span class="op" id="1802441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802445">return</span>&nbsp;<span class="ident" id="1802452">color</span><span class="op" id="1802457">.</span><span class="ident" id="1802458">Alpha</span><span class="op" id="1802463">{</span><span class="op" id="1802464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1802467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802470">i</span>&nbsp;<span class="op" id="1802472">:=</span>&nbsp;<span class="ident" id="1802475">p</span><span class="op" id="1802476">.</span><span class="ident" id="1802477">PixOffset</span><span class="op" id="1802486">(</span><span class="ident" id="1802487">x</span><span class="op" id="1802488">,</span>&nbsp;<span class="ident" id="1802490">y</span><span class="op" id="1802491">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802494">return</span>&nbsp;<span class="ident" id="1802501">color</span><span class="op" id="1802506">.</span><span class="ident" id="1802507">Alpha</span><span class="op" id="1802512">{</span><span class="ident" id="1802513">p</span><span class="op" id="1802514">.</span><span class="ident" id="1802515">Pix</span><span class="op" id="1802518">[</span><span class="ident" id="1802519">i</span><span class="op" id="1802520">]</span><span class="op" id="1802521">}</span><br>
<span class="lineno"></span><span class="op" id="1802523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1802526">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1802605">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="1802629">func</span>&nbsp;<span class="op" id="1802634">(</span><span class="ident" id="1802635">p</span>&nbsp;<span class="op" id="1802637">*</span><span class="ident" id="1802638">Alpha</span><span class="op" id="1802643">)</span>&nbsp;<span class="ident" id="1802645">PixOffset</span><span class="op" id="1802654">(</span><span class="ident" id="1802655">x</span><span class="op" id="1802656">,</span>&nbsp;<span class="ident" id="1802658">y</span>&nbsp;<span class="builtintype" id="1802660">int</span><span class="op" id="1802663">)</span>&nbsp;<span class="builtintype" id="1802665">int</span>&nbsp;<span class="op" id="1802669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802672">return</span>&nbsp;<span class="op" id="1802679">(</span><span class="ident" id="1802680">y</span><span class="op" id="1802681">-</span><span class="ident" id="1802682">p</span><span class="op" id="1802683">.</span><span class="ident" id="1802684">Rect</span><span class="op" id="1802688">.</span><span class="ident" id="1802689">Min</span><span class="op" id="1802692">.</span><span class="ident" id="1802693">Y</span><span class="op" id="1802694">)</span><span class="op" id="1802695">*</span><span class="ident" id="1802696">p</span><span class="op" id="1802697">.</span><span class="ident" id="1802698">Stride</span>&nbsp;<span class="op" id="1802705">+</span>&nbsp;<span class="op" id="1802707">(</span><span class="ident" id="1802708">x</span><span class="op" id="1802709">-</span><span class="ident" id="1802710">p</span><span class="op" id="1802711">.</span><span class="ident" id="1802712">Rect</span><span class="op" id="1802716">.</span><span class="ident" id="1802717">Min</span><span class="op" id="1802720">.</span><span class="ident" id="1802721">X</span><span class="op" id="1802722">)</span><span class="op" id="1802723">*</span><span class="num" id="1802724">1</span><br>
<span class="lineno"></span><span class="op" id="1802726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1802729">func</span>&nbsp;<span class="op" id="1802734">(</span><span class="ident" id="1802735">p</span>&nbsp;<span class="op" id="1802737">*</span><span class="ident" id="1802738">Alpha</span><span class="op" id="1802743">)</span>&nbsp;<span class="ident" id="1802745">Set</span><span class="op" id="1802748">(</span><span class="ident" id="1802749">x</span><span class="op" id="1802750">,</span>&nbsp;<span class="ident" id="1802752">y</span>&nbsp;<span class="builtintype" id="1802754">int</span><span class="op" id="1802757">,</span>&nbsp;<span class="ident" id="1802759">c</span>&nbsp;<span class="ident" id="1802761">color</span><span class="op" id="1802766">.</span><span class="ident" id="1802767">Color</span><span class="op" id="1802772">)</span>&nbsp;<span class="op" id="1802774">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802777">if</span>&nbsp;<span class="op" id="1802780">!</span><span class="op" id="1802781">(</span><span class="ident" id="1802782">Point</span><span class="op" id="1802787">{</span><span class="ident" id="1802788">x</span><span class="op" id="1802789">,</span>&nbsp;<span class="ident" id="1802791">y</span><span class="op" id="1802792">}</span><span class="op" id="1802793">.</span><span class="ident" id="1802794">In</span><span class="op" id="1802796">(</span><span class="ident" id="1802797">p</span><span class="op" id="1802798">.</span><span class="ident" id="1802799">Rect</span><span class="op" id="1802803">)</span><span class="op" id="1802804">)</span>&nbsp;<span class="op" id="1802806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802810">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1802818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802821">i</span>&nbsp;<span class="op" id="1802823">:=</span>&nbsp;<span class="ident" id="1802826">p</span><span class="op" id="1802827">.</span><span class="ident" id="1802828">PixOffset</span><span class="op" id="1802837">(</span><span class="ident" id="1802838">x</span><span class="op" id="1802839">,</span>&nbsp;<span class="ident" id="1802841">y</span><span class="op" id="1802842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1802845">p</span><span class="op" id="1802846">.</span><span class="ident" id="1802847">Pix</span><span class="op" id="1802850">[</span><span class="ident" id="1802851">i</span><span class="op" id="1802852">]</span>&nbsp;<span class="op" id="1802854">=</span>&nbsp;<span class="ident" id="1802856">color</span><span class="op" id="1802861">.</span><span class="ident" id="1802862">AlphaModel</span><span class="op" id="1802872">.</span><span class="ident" id="1802873">Convert</span><span class="op" id="1802880">(</span><span class="ident" id="1802881">c</span><span class="op" id="1802882">)</span><span class="op" id="1802883">.</span><span class="op" id="1802884">(</span><span class="ident" id="1802885">color</span><span class="op" id="1802890">.</span><span class="ident" id="1802891">Alpha</span><span class="op" id="1802896">)</span><span class="op" id="1802897">.</span><span class="ident" id="1802898">A</span><br>
<span class="lineno">520</span><span class="op" id="1802900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1802903">func</span>&nbsp;<span class="op" id="1802908">(</span><span class="ident" id="1802909">p</span>&nbsp;<span class="op" id="1802911">*</span><span class="ident" id="1802912">Alpha</span><span class="op" id="1802917">)</span>&nbsp;<span class="ident" id="1802919">SetAlpha</span><span class="op" id="1802927">(</span><span class="ident" id="1802928">x</span><span class="op" id="1802929">,</span>&nbsp;<span class="ident" id="1802931">y</span>&nbsp;<span class="builtintype" id="1802933">int</span><span class="op" id="1802936">,</span>&nbsp;<span class="ident" id="1802938">c</span>&nbsp;<span class="ident" id="1802940">color</span><span class="op" id="1802945">.</span><span class="ident" id="1802946">Alpha</span><span class="op" id="1802951">)</span>&nbsp;<span class="op" id="1802953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802956">if</span>&nbsp;<span class="op" id="1802959">!</span><span class="op" id="1802960">(</span><span class="ident" id="1802961">Point</span><span class="op" id="1802966">{</span><span class="ident" id="1802967">x</span><span class="op" id="1802968">,</span>&nbsp;<span class="ident" id="1802970">y</span><span class="op" id="1802971">}</span><span class="op" id="1802972">.</span><span class="ident" id="1802973">In</span><span class="op" id="1802975">(</span><span class="ident" id="1802976">p</span><span class="op" id="1802977">.</span><span class="ident" id="1802978">Rect</span><span class="op" id="1802982">)</span><span class="op" id="1802983">)</span>&nbsp;<span class="op" id="1802985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1802989">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1802997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803000">i</span>&nbsp;<span class="op" id="1803002">:=</span>&nbsp;<span class="ident" id="1803005">p</span><span class="op" id="1803006">.</span><span class="ident" id="1803007">PixOffset</span><span class="op" id="1803016">(</span><span class="ident" id="1803017">x</span><span class="op" id="1803018">,</span>&nbsp;<span class="ident" id="1803020">y</span><span class="op" id="1803021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803024">p</span><span class="op" id="1803025">.</span><span class="ident" id="1803026">Pix</span><span class="op" id="1803029">[</span><span class="ident" id="1803030">i</span><span class="op" id="1803031">]</span>&nbsp;<span class="op" id="1803033">=</span>&nbsp;<span class="ident" id="1803035">c</span><span class="op" id="1803036">.</span><span class="ident" id="1803037">A</span><br>
<span class="lineno"></span><span class="op" id="1803039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="1803042">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1803119">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1803191">func</span>&nbsp;<span class="op" id="1803196">(</span><span class="ident" id="1803197">p</span>&nbsp;<span class="op" id="1803199">*</span><span class="ident" id="1803200">Alpha</span><span class="op" id="1803205">)</span>&nbsp;<span class="ident" id="1803207">SubImage</span><span class="op" id="1803215">(</span><span class="ident" id="1803216">r</span>&nbsp;<span class="ident" id="1803218">Rectangle</span><span class="op" id="1803227">)</span>&nbsp;<span class="ident" id="1803229">Image</span>&nbsp;<span class="op" id="1803235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803238">r</span>&nbsp;<span class="op" id="1803240">=</span>&nbsp;<span class="ident" id="1803242">r</span><span class="op" id="1803243">.</span><span class="ident" id="1803244">Intersect</span><span class="op" id="1803253">(</span><span class="ident" id="1803254">p</span><span class="op" id="1803255">.</span><span class="ident" id="1803256">Rect</span><span class="op" id="1803260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1803263">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1803344">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1803426">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803476">if</span>&nbsp;<span class="ident" id="1803479">r</span><span class="op" id="1803480">.</span><span class="ident" id="1803481">Empty</span><span class="op" id="1803486">(</span><span class="op" id="1803487">)</span>&nbsp;<span class="op" id="1803489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803493">return</span>&nbsp;<span class="op" id="1803500">&amp;</span><span class="ident" id="1803501">Alpha</span><span class="op" id="1803506">{</span><span class="op" id="1803507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803510">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803513">i</span>&nbsp;<span class="op" id="1803515">:=</span>&nbsp;<span class="ident" id="1803518">p</span><span class="op" id="1803519">.</span><span class="ident" id="1803520">PixOffset</span><span class="op" id="1803529">(</span><span class="ident" id="1803530">r</span><span class="op" id="1803531">.</span><span class="ident" id="1803532">Min</span><span class="op" id="1803535">.</span><span class="ident" id="1803536">X</span><span class="op" id="1803537">,</span>&nbsp;<span class="ident" id="1803539">r</span><span class="op" id="1803540">.</span><span class="ident" id="1803541">Min</span><span class="op" id="1803544">.</span><span class="ident" id="1803545">Y</span><span class="op" id="1803546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803549">return</span>&nbsp;<span class="op" id="1803556">&amp;</span><span class="ident" id="1803557">Alpha</span><span class="op" id="1803562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803566">Pix</span><span class="op" id="1803569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803574">p</span><span class="op" id="1803575">.</span><span class="ident" id="1803576">Pix</span><span class="op" id="1803579">[</span><span class="ident" id="1803580">i</span><span class="op" id="1803581">:</span><span class="op" id="1803582">]</span><span class="op" id="1803583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803587">Stride</span><span class="op" id="1803593">:</span>&nbsp;<span class="ident" id="1803595">p</span><span class="op" id="1803596">.</span><span class="ident" id="1803597">Stride</span><span class="op" id="1803603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803607">Rect</span><span class="op" id="1803611">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1803615">r</span><span class="op" id="1803616">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803619">}</span><br>
<span class="lineno"></span><span class="op" id="1803621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1803624">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1803697">func</span>&nbsp;<span class="op" id="1803702">(</span><span class="ident" id="1803703">p</span>&nbsp;<span class="op" id="1803705">*</span><span class="ident" id="1803706">Alpha</span><span class="op" id="1803711">)</span>&nbsp;<span class="ident" id="1803713">Opaque</span><span class="op" id="1803719">(</span><span class="op" id="1803720">)</span>&nbsp;<span class="builtintype" id="1803722">bool</span>&nbsp;<span class="op" id="1803727">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803730">if</span>&nbsp;<span class="ident" id="1803733">p</span><span class="op" id="1803734">.</span><span class="ident" id="1803735">Rect</span><span class="op" id="1803739">.</span><span class="ident" id="1803740">Empty</span><span class="op" id="1803745">(</span><span class="op" id="1803746">)</span>&nbsp;<span class="op" id="1803748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803752">return</span>&nbsp;<span class="builtintype" id="1803759">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803768">i0</span><span class="op" id="1803770">,</span>&nbsp;<span class="ident" id="1803772">i1</span>&nbsp;<span class="op" id="1803775">:=</span>&nbsp;<span class="num" id="1803778">0</span><span class="op" id="1803779">,</span>&nbsp;<span class="ident" id="1803781">p</span><span class="op" id="1803782">.</span><span class="ident" id="1803783">Rect</span><span class="op" id="1803787">.</span><span class="ident" id="1803788">Dx</span><span class="op" id="1803790">(</span><span class="op" id="1803791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803794">for</span>&nbsp;<span class="ident" id="1803798">y</span>&nbsp;<span class="op" id="1803800">:=</span>&nbsp;<span class="ident" id="1803803">p</span><span class="op" id="1803804">.</span><span class="ident" id="1803805">Rect</span><span class="op" id="1803809">.</span><span class="ident" id="1803810">Min</span><span class="op" id="1803813">.</span><span class="ident" id="1803814">Y</span><span class="op" id="1803815">;</span>&nbsp;<span class="ident" id="1803817">y</span>&nbsp;<span class="op" id="1803819">&lt;</span>&nbsp;<span class="ident" id="1803821">p</span><span class="op" id="1803822">.</span><span class="ident" id="1803823">Rect</span><span class="op" id="1803827">.</span><span class="ident" id="1803828">Max</span><span class="op" id="1803831">.</span><span class="ident" id="1803832">Y</span><span class="op" id="1803833">;</span>&nbsp;<span class="ident" id="1803835">y</span><span class="op" id="1803836">++</span>&nbsp;<span class="op" id="1803839">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803843">for</span>&nbsp;<span class="ident" id="1803847">i</span>&nbsp;<span class="op" id="1803849">:=</span>&nbsp;<span class="ident" id="1803852">i0</span><span class="op" id="1803854">;</span>&nbsp;<span class="ident" id="1803856">i</span>&nbsp;<span class="op" id="1803858">&lt;</span>&nbsp;<span class="ident" id="1803860">i1</span><span class="op" id="1803862">;</span>&nbsp;<span class="ident" id="1803864">i</span><span class="op" id="1803865">++</span>&nbsp;<span class="op" id="1803868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803873">if</span>&nbsp;<span class="ident" id="1803876">p</span><span class="op" id="1803877">.</span><span class="ident" id="1803878">Pix</span><span class="op" id="1803881">[</span><span class="ident" id="1803882">i</span><span class="op" id="1803883">]</span>&nbsp;<span class="op" id="1803885">!=</span>&nbsp;<span class="num" id="1803888">0xff</span>&nbsp;<span class="op" id="1803893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803899">return</span>&nbsp;<span class="builtintype" id="1803906">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803919">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803923">i0</span>&nbsp;<span class="op" id="1803926">+=</span>&nbsp;<span class="ident" id="1803929">p</span><span class="op" id="1803930">.</span><span class="ident" id="1803931">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1803940">i1</span>&nbsp;<span class="op" id="1803943">+=</span>&nbsp;<span class="ident" id="1803946">p</span><span class="op" id="1803947">.</span><span class="ident" id="1803948">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1803956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1803959">return</span>&nbsp;<span class="builtintype" id="1803966">true</span><br>
<span class="lineno"></span><span class="op" id="1803971">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="1803974">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1804029">func</span>&nbsp;<span class="ident" id="1804034">NewAlpha</span><span class="op" id="1804042">(</span><span class="ident" id="1804043">r</span>&nbsp;<span class="ident" id="1804045">Rectangle</span><span class="op" id="1804054">)</span>&nbsp;<span class="op" id="1804056">*</span><span class="ident" id="1804057">Alpha</span>&nbsp;<span class="op" id="1804063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804066">w</span><span class="op" id="1804067">,</span>&nbsp;<span class="ident" id="1804069">h</span>&nbsp;<span class="op" id="1804071">:=</span>&nbsp;<span class="ident" id="1804074">r</span><span class="op" id="1804075">.</span><span class="ident" id="1804076">Dx</span><span class="op" id="1804078">(</span><span class="op" id="1804079">)</span><span class="op" id="1804080">,</span>&nbsp;<span class="ident" id="1804082">r</span><span class="op" id="1804083">.</span><span class="ident" id="1804084">Dy</span><span class="op" id="1804086">(</span><span class="op" id="1804087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804090">pix</span>&nbsp;<span class="op" id="1804094">:=</span>&nbsp;<span class="builtinfunc" id="1804097">make</span><span class="op" id="1804101">(</span><span class="op" id="1804102">[</span><span class="op" id="1804103">]</span><span class="builtintype" id="1804104">uint8</span><span class="op" id="1804109">,</span>&nbsp;<span class="num" id="1804111">1</span><span class="op" id="1804112">*</span><span class="ident" id="1804113">w</span><span class="op" id="1804114">*</span><span class="ident" id="1804115">h</span><span class="op" id="1804116">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1804119">return</span>&nbsp;<span class="op" id="1804126">&amp;</span><span class="ident" id="1804127">Alpha</span><span class="op" id="1804132">{</span><span class="ident" id="1804133">pix</span><span class="op" id="1804136">,</span>&nbsp;<span class="num" id="1804138">1</span>&nbsp;<span class="op" id="1804140">*</span>&nbsp;<span class="ident" id="1804142">w</span><span class="op" id="1804143">,</span>&nbsp;<span class="ident" id="1804145">r</span><span class="op" id="1804146">}</span><br>
<span class="lineno"></span><span class="op" id="1804148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1804151">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1804230">type</span>&nbsp;<span class="ident" id="1804235">Alpha16</span>&nbsp;<span class="keyword" id="1804243">struct</span>&nbsp;<span class="op" id="1804250">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1804253">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1804338">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804406">Pix</span>&nbsp;<span class="op" id="1804410">[</span><span class="op" id="1804411">]</span><span class="builtintype" id="1804412">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1804419">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804495">Stride</span>&nbsp;<span class="builtintype" id="1804502">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1804507">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804539">Rect</span>&nbsp;<span class="ident" id="1804544">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1804554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1804557">func</span>&nbsp;<span class="op" id="1804562">(</span><span class="ident" id="1804563">p</span>&nbsp;<span class="op" id="1804565">*</span><span class="ident" id="1804566">Alpha16</span><span class="op" id="1804573">)</span>&nbsp;<span class="ident" id="1804575">ColorModel</span><span class="op" id="1804585">(</span><span class="op" id="1804586">)</span>&nbsp;<span class="ident" id="1804588">color</span><span class="op" id="1804593">.</span><span class="ident" id="1804594">Model</span>&nbsp;<span class="op" id="1804600">{</span>&nbsp;<span class="keyword" id="1804602">return</span>&nbsp;<span class="ident" id="1804609">color</span><span class="op" id="1804614">.</span><span class="ident" id="1804615">Alpha16Model</span>&nbsp;<span class="op" id="1804628">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="1804631">func</span>&nbsp;<span class="op" id="1804636">(</span><span class="ident" id="1804637">p</span>&nbsp;<span class="op" id="1804639">*</span><span class="ident" id="1804640">Alpha16</span><span class="op" id="1804647">)</span>&nbsp;<span class="ident" id="1804649">Bounds</span><span class="op" id="1804655">(</span><span class="op" id="1804656">)</span>&nbsp;<span class="ident" id="1804658">Rectangle</span>&nbsp;<span class="op" id="1804668">{</span>&nbsp;<span class="keyword" id="1804670">return</span>&nbsp;<span class="ident" id="1804677">p</span><span class="op" id="1804678">.</span><span class="ident" id="1804679">Rect</span>&nbsp;<span class="op" id="1804684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1804687">func</span>&nbsp;<span class="op" id="1804692">(</span><span class="ident" id="1804693">p</span>&nbsp;<span class="op" id="1804695">*</span><span class="ident" id="1804696">Alpha16</span><span class="op" id="1804703">)</span>&nbsp;<span class="ident" id="1804705">At</span><span class="op" id="1804707">(</span><span class="ident" id="1804708">x</span><span class="op" id="1804709">,</span>&nbsp;<span class="ident" id="1804711">y</span>&nbsp;<span class="builtintype" id="1804713">int</span><span class="op" id="1804716">)</span>&nbsp;<span class="ident" id="1804718">color</span><span class="op" id="1804723">.</span><span class="ident" id="1804724">Color</span>&nbsp;<span class="op" id="1804730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1804733">return</span>&nbsp;<span class="ident" id="1804740">p</span><span class="op" id="1804741">.</span><span class="ident" id="1804742">Alpha16At</span><span class="op" id="1804751">(</span><span class="ident" id="1804752">x</span><span class="op" id="1804753">,</span>&nbsp;<span class="ident" id="1804755">y</span><span class="op" id="1804756">)</span><br>
<span class="lineno">590</span><span class="op" id="1804758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1804761">func</span>&nbsp;<span class="op" id="1804766">(</span><span class="ident" id="1804767">p</span>&nbsp;<span class="op" id="1804769">*</span><span class="ident" id="1804770">Alpha16</span><span class="op" id="1804777">)</span>&nbsp;<span class="ident" id="1804779">Alpha16At</span><span class="op" id="1804788">(</span><span class="ident" id="1804789">x</span><span class="op" id="1804790">,</span>&nbsp;<span class="ident" id="1804792">y</span>&nbsp;<span class="builtintype" id="1804794">int</span><span class="op" id="1804797">)</span>&nbsp;<span class="ident" id="1804799">color</span><span class="op" id="1804804">.</span><span class="ident" id="1804805">Alpha16</span>&nbsp;<span class="op" id="1804813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1804816">if</span>&nbsp;<span class="op" id="1804819">!</span><span class="op" id="1804820">(</span><span class="ident" id="1804821">Point</span><span class="op" id="1804826">{</span><span class="ident" id="1804827">x</span><span class="op" id="1804828">,</span>&nbsp;<span class="ident" id="1804830">y</span><span class="op" id="1804831">}</span><span class="op" id="1804832">.</span><span class="ident" id="1804833">In</span><span class="op" id="1804835">(</span><span class="ident" id="1804836">p</span><span class="op" id="1804837">.</span><span class="ident" id="1804838">Rect</span><span class="op" id="1804842">)</span><span class="op" id="1804843">)</span>&nbsp;<span class="op" id="1804845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1804849">return</span>&nbsp;<span class="ident" id="1804856">color</span><span class="op" id="1804861">.</span><span class="ident" id="1804862">Alpha16</span><span class="op" id="1804869">{</span><span class="op" id="1804870">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1804873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1804876">i</span>&nbsp;<span class="op" id="1804878">:=</span>&nbsp;<span class="ident" id="1804881">p</span><span class="op" id="1804882">.</span><span class="ident" id="1804883">PixOffset</span><span class="op" id="1804892">(</span><span class="ident" id="1804893">x</span><span class="op" id="1804894">,</span>&nbsp;<span class="ident" id="1804896">y</span><span class="op" id="1804897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1804900">return</span>&nbsp;<span class="ident" id="1804907">color</span><span class="op" id="1804912">.</span><span class="ident" id="1804913">Alpha16</span><span class="op" id="1804920">{</span><span class="builtintype" id="1804921">uint16</span><span class="op" id="1804927">(</span><span class="ident" id="1804928">p</span><span class="op" id="1804929">.</span><span class="ident" id="1804930">Pix</span><span class="op" id="1804933">[</span><span class="ident" id="1804934">i</span><span class="op" id="1804935">+</span><span class="num" id="1804936">0</span><span class="op" id="1804937">]</span><span class="op" id="1804938">)</span><span class="op" id="1804939">&lt;&lt;</span><span class="num" id="1804941">8</span>&nbsp;<span class="op" id="1804943">|</span>&nbsp;<span class="builtintype" id="1804945">uint16</span><span class="op" id="1804951">(</span><span class="ident" id="1804952">p</span><span class="op" id="1804953">.</span><span class="ident" id="1804954">Pix</span><span class="op" id="1804957">[</span><span class="ident" id="1804958">i</span><span class="op" id="1804959">+</span><span class="num" id="1804960">1</span><span class="op" id="1804961">]</span><span class="op" id="1804962">)</span><span class="op" id="1804963">}</span><br>
<span class="lineno"></span><span class="op" id="1804965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="1804968">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1805047">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1805071">func</span>&nbsp;<span class="op" id="1805076">(</span><span class="ident" id="1805077">p</span>&nbsp;<span class="op" id="1805079">*</span><span class="ident" id="1805080">Alpha16</span><span class="op" id="1805087">)</span>&nbsp;<span class="ident" id="1805089">PixOffset</span><span class="op" id="1805098">(</span><span class="ident" id="1805099">x</span><span class="op" id="1805100">,</span>&nbsp;<span class="ident" id="1805102">y</span>&nbsp;<span class="builtintype" id="1805104">int</span><span class="op" id="1805107">)</span>&nbsp;<span class="builtintype" id="1805109">int</span>&nbsp;<span class="op" id="1805113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1805116">return</span>&nbsp;<span class="op" id="1805123">(</span><span class="ident" id="1805124">y</span><span class="op" id="1805125">-</span><span class="ident" id="1805126">p</span><span class="op" id="1805127">.</span><span class="ident" id="1805128">Rect</span><span class="op" id="1805132">.</span><span class="ident" id="1805133">Min</span><span class="op" id="1805136">.</span><span class="ident" id="1805137">Y</span><span class="op" id="1805138">)</span><span class="op" id="1805139">*</span><span class="ident" id="1805140">p</span><span class="op" id="1805141">.</span><span class="ident" id="1805142">Stride</span>&nbsp;<span class="op" id="1805149">+</span>&nbsp;<span class="op" id="1805151">(</span><span class="ident" id="1805152">x</span><span class="op" id="1805153">-</span><span class="ident" id="1805154">p</span><span class="op" id="1805155">.</span><span class="ident" id="1805156">Rect</span><span class="op" id="1805160">.</span><span class="ident" id="1805161">Min</span><span class="op" id="1805164">.</span><span class="ident" id="1805165">X</span><span class="op" id="1805166">)</span><span class="op" id="1805167">*</span><span class="num" id="1805168">2</span><br>
<span class="lineno"></span><span class="op" id="1805170">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="1805173">func</span>&nbsp;<span class="op" id="1805178">(</span><span class="ident" id="1805179">p</span>&nbsp;<span class="op" id="1805181">*</span><span class="ident" id="1805182">Alpha16</span><span class="op" id="1805189">)</span>&nbsp;<span class="ident" id="1805191">Set</span><span class="op" id="1805194">(</span><span class="ident" id="1805195">x</span><span class="op" id="1805196">,</span>&nbsp;<span class="ident" id="1805198">y</span>&nbsp;<span class="builtintype" id="1805200">int</span><span class="op" id="1805203">,</span>&nbsp;<span class="ident" id="1805205">c</span>&nbsp;<span class="ident" id="1805207">color</span><span class="op" id="1805212">.</span><span class="ident" id="1805213">Color</span><span class="op" id="1805218">)</span>&nbsp;<span class="op" id="1805220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1805223">if</span>&nbsp;<span class="op" id="1805226">!</span><span class="op" id="1805227">(</span><span class="ident" id="1805228">Point</span><span class="op" id="1805233">{</span><span class="ident" id="1805234">x</span><span class="op" id="1805235">,</span>&nbsp;<span class="ident" id="1805237">y</span><span class="op" id="1805238">}</span><span class="op" id="1805239">.</span><span class="ident" id="1805240">In</span><span class="op" id="1805242">(</span><span class="ident" id="1805243">p</span><span class="op" id="1805244">.</span><span class="ident" id="1805245">Rect</span><span class="op" id="1805249">)</span><span class="op" id="1805250">)</span>&nbsp;<span class="op" id="1805252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1805256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1805264">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805267">i</span>&nbsp;<span class="op" id="1805269">:=</span>&nbsp;<span class="ident" id="1805272">p</span><span class="op" id="1805273">.</span><span class="ident" id="1805274">PixOffset</span><span class="op" id="1805283">(</span><span class="ident" id="1805284">x</span><span class="op" id="1805285">,</span>&nbsp;<span class="ident" id="1805287">y</span><span class="op" id="1805288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805291">c1</span>&nbsp;<span class="op" id="1805294">:=</span>&nbsp;<span class="ident" id="1805297">color</span><span class="op" id="1805302">.</span><span class="ident" id="1805303">Alpha16Model</span><span class="op" id="1805315">.</span><span class="ident" id="1805316">Convert</span><span class="op" id="1805323">(</span><span class="ident" id="1805324">c</span><span class="op" id="1805325">)</span><span class="op" id="1805326">.</span><span class="op" id="1805327">(</span><span class="ident" id="1805328">color</span><span class="op" id="1805333">.</span><span class="ident" id="1805334">Alpha16</span><span class="op" id="1805341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805344">p</span><span class="op" id="1805345">.</span><span class="ident" id="1805346">Pix</span><span class="op" id="1805349">[</span><span class="ident" id="1805350">i</span><span class="op" id="1805351">+</span><span class="num" id="1805352">0</span><span class="op" id="1805353">]</span>&nbsp;<span class="op" id="1805355">=</span>&nbsp;<span class="builtintype" id="1805357">uint8</span><span class="op" id="1805362">(</span><span class="ident" id="1805363">c1</span><span class="op" id="1805365">.</span><span class="ident" id="1805366">A</span>&nbsp;<span class="op" id="1805368">&gt;&gt;</span>&nbsp;<span class="num" id="1805371">8</span><span class="op" id="1805372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805375">p</span><span class="op" id="1805376">.</span><span class="ident" id="1805377">Pix</span><span class="op" id="1805380">[</span><span class="ident" id="1805381">i</span><span class="op" id="1805382">+</span><span class="num" id="1805383">1</span><span class="op" id="1805384">]</span>&nbsp;<span class="op" id="1805386">=</span>&nbsp;<span class="builtintype" id="1805388">uint8</span><span class="op" id="1805393">(</span><span class="ident" id="1805394">c1</span><span class="op" id="1805396">.</span><span class="ident" id="1805397">A</span><span class="op" id="1805398">)</span><br>
<span class="lineno"></span><span class="op" id="1805400">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="1805403">func</span>&nbsp;<span class="op" id="1805408">(</span><span class="ident" id="1805409">p</span>&nbsp;<span class="op" id="1805411">*</span><span class="ident" id="1805412">Alpha16</span><span class="op" id="1805419">)</span>&nbsp;<span class="ident" id="1805421">SetAlpha16</span><span class="op" id="1805431">(</span><span class="ident" id="1805432">x</span><span class="op" id="1805433">,</span>&nbsp;<span class="ident" id="1805435">y</span>&nbsp;<span class="builtintype" id="1805437">int</span><span class="op" id="1805440">,</span>&nbsp;<span class="ident" id="1805442">c</span>&nbsp;<span class="ident" id="1805444">color</span><span class="op" id="1805449">.</span><span class="ident" id="1805450">Alpha16</span><span class="op" id="1805457">)</span>&nbsp;<span class="op" id="1805459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1805462">if</span>&nbsp;<span class="op" id="1805465">!</span><span class="op" id="1805466">(</span><span class="ident" id="1805467">Point</span><span class="op" id="1805472">{</span><span class="ident" id="1805473">x</span><span class="op" id="1805474">,</span>&nbsp;<span class="ident" id="1805476">y</span><span class="op" id="1805477">}</span><span class="op" id="1805478">.</span><span class="ident" id="1805479">In</span><span class="op" id="1805481">(</span><span class="ident" id="1805482">p</span><span class="op" id="1805483">.</span><span class="ident" id="1805484">Rect</span><span class="op" id="1805488">)</span><span class="op" id="1805489">)</span>&nbsp;<span class="op" id="1805491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1805495">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1805503">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805506">i</span>&nbsp;<span class="op" id="1805508">:=</span>&nbsp;<span class="ident" id="1805511">p</span><span class="op" id="1805512">.</span><span class="ident" id="1805513">PixOffset</span><span class="op" id="1805522">(</span><span class="ident" id="1805523">x</span><span class="op" id="1805524">,</span>&nbsp;<span class="ident" id="1805526">y</span><span class="op" id="1805527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805530">p</span><span class="op" id="1805531">.</span><span class="ident" id="1805532">Pix</span><span class="op" id="1805535">[</span><span class="ident" id="1805536">i</span><span class="op" id="1805537">+</span><span class="num" id="1805538">0</span><span class="op" id="1805539">]</span>&nbsp;<span class="op" id="1805541">=</span>&nbsp;<span class="builtintype" id="1805543">uint8</span><span class="op" id="1805548">(</span><span class="ident" id="1805549">c</span><span class="op" id="1805550">.</span><span class="ident" id="1805551">A</span>&nbsp;<span class="op" id="1805553">&gt;&gt;</span>&nbsp;<span class="num" id="1805556">8</span><span class="op" id="1805557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805560">p</span><span class="op" id="1805561">.</span><span class="ident" id="1805562">Pix</span><span class="op" id="1805565">[</span><span class="ident" id="1805566">i</span><span class="op" id="1805567">+</span><span class="num" id="1805568">1</span><span class="op" id="1805569">]</span>&nbsp;<span class="op" id="1805571">=</span>&nbsp;<span class="builtintype" id="1805573">uint8</span><span class="op" id="1805578">(</span><span class="ident" id="1805579">c</span><span class="op" id="1805580">.</span><span class="ident" id="1805581">A</span><span class="op" id="1805582">)</span><br>
<span class="lineno"></span><span class="op" id="1805584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="1805587">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1805664">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1805736">func</span>&nbsp;<span class="op" id="1805741">(</span><span class="ident" id="1805742">p</span>&nbsp;<span class="op" id="1805744">*</span><span class="ident" id="1805745">Alpha16</span><span class="op" id="1805752">)</span>&nbsp;<span class="ident" id="1805754">SubImage</span><span class="op" id="1805762">(</span><span class="ident" id="1805763">r</span>&nbsp;<span class="ident" id="1805765">Rectangle</span><span class="op" id="1805774">)</span>&nbsp;<span class="ident" id="1805776">Image</span>&nbsp;<span class="op" id="1805782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1805785">r</span>&nbsp;<span class="op" id="1805787">=</span>&nbsp;<span class="ident" id="1805789">r</span><span class="op" id="1805790">.</span><span class="ident" id="1805791">Intersect</span><span class="op" id="1805800">(</span><span class="ident" id="1805801">p</span><span class="op" id="1805802">.</span><span class="ident" id="1805803">Rect</span><span class="op" id="1805807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1805810">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1805891">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1805973">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806023">if</span>&nbsp;<span class="ident" id="1806026">r</span><span class="op" id="1806027">.</span><span class="ident" id="1806028">Empty</span><span class="op" id="1806033">(</span><span class="op" id="1806034">)</span>&nbsp;<span class="op" id="1806036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806040">return</span>&nbsp;<span class="op" id="1806047">&amp;</span><span class="ident" id="1806048">Alpha16</span><span class="op" id="1806055">{</span><span class="op" id="1806056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806059">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806062">i</span>&nbsp;<span class="op" id="1806064">:=</span>&nbsp;<span class="ident" id="1806067">p</span><span class="op" id="1806068">.</span><span class="ident" id="1806069">PixOffset</span><span class="op" id="1806078">(</span><span class="ident" id="1806079">r</span><span class="op" id="1806080">.</span><span class="ident" id="1806081">Min</span><span class="op" id="1806084">.</span><span class="ident" id="1806085">X</span><span class="op" id="1806086">,</span>&nbsp;<span class="ident" id="1806088">r</span><span class="op" id="1806089">.</span><span class="ident" id="1806090">Min</span><span class="op" id="1806093">.</span><span class="ident" id="1806094">Y</span><span class="op" id="1806095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806098">return</span>&nbsp;<span class="op" id="1806105">&amp;</span><span class="ident" id="1806106">Alpha16</span><span class="op" id="1806113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806117">Pix</span><span class="op" id="1806120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806125">p</span><span class="op" id="1806126">.</span><span class="ident" id="1806127">Pix</span><span class="op" id="1806130">[</span><span class="ident" id="1806131">i</span><span class="op" id="1806132">:</span><span class="op" id="1806133">]</span><span class="op" id="1806134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806138">Stride</span><span class="op" id="1806144">:</span>&nbsp;<span class="ident" id="1806146">p</span><span class="op" id="1806147">.</span><span class="ident" id="1806148">Stride</span><span class="op" id="1806154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806158">Rect</span><span class="op" id="1806162">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1806166">r</span><span class="op" id="1806167">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806170">}</span><br>
<span class="lineno"></span><span class="op" id="1806172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1806175">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1806248">func</span>&nbsp;<span class="op" id="1806253">(</span><span class="ident" id="1806254">p</span>&nbsp;<span class="op" id="1806256">*</span><span class="ident" id="1806257">Alpha16</span><span class="op" id="1806264">)</span>&nbsp;<span class="ident" id="1806266">Opaque</span><span class="op" id="1806272">(</span><span class="op" id="1806273">)</span>&nbsp;<span class="builtintype" id="1806275">bool</span>&nbsp;<span class="op" id="1806280">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806283">if</span>&nbsp;<span class="ident" id="1806286">p</span><span class="op" id="1806287">.</span><span class="ident" id="1806288">Rect</span><span class="op" id="1806292">.</span><span class="ident" id="1806293">Empty</span><span class="op" id="1806298">(</span><span class="op" id="1806299">)</span>&nbsp;<span class="op" id="1806301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806305">return</span>&nbsp;<span class="builtintype" id="1806312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806321">i0</span><span class="op" id="1806323">,</span>&nbsp;<span class="ident" id="1806325">i1</span>&nbsp;<span class="op" id="1806328">:=</span>&nbsp;<span class="num" id="1806331">0</span><span class="op" id="1806332">,</span>&nbsp;<span class="ident" id="1806334">p</span><span class="op" id="1806335">.</span><span class="ident" id="1806336">Rect</span><span class="op" id="1806340">.</span><span class="ident" id="1806341">Dx</span><span class="op" id="1806343">(</span><span class="op" id="1806344">)</span><span class="op" id="1806345">*</span><span class="num" id="1806346">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806349">for</span>&nbsp;<span class="ident" id="1806353">y</span>&nbsp;<span class="op" id="1806355">:=</span>&nbsp;<span class="ident" id="1806358">p</span><span class="op" id="1806359">.</span><span class="ident" id="1806360">Rect</span><span class="op" id="1806364">.</span><span class="ident" id="1806365">Min</span><span class="op" id="1806368">.</span><span class="ident" id="1806369">Y</span><span class="op" id="1806370">;</span>&nbsp;<span class="ident" id="1806372">y</span>&nbsp;<span class="op" id="1806374">&lt;</span>&nbsp;<span class="ident" id="1806376">p</span><span class="op" id="1806377">.</span><span class="ident" id="1806378">Rect</span><span class="op" id="1806382">.</span><span class="ident" id="1806383">Max</span><span class="op" id="1806386">.</span><span class="ident" id="1806387">Y</span><span class="op" id="1806388">;</span>&nbsp;<span class="ident" id="1806390">y</span><span class="op" id="1806391">++</span>&nbsp;<span class="op" id="1806394">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806398">for</span>&nbsp;<span class="ident" id="1806402">i</span>&nbsp;<span class="op" id="1806404">:=</span>&nbsp;<span class="ident" id="1806407">i0</span><span class="op" id="1806409">;</span>&nbsp;<span class="ident" id="1806411">i</span>&nbsp;<span class="op" id="1806413">&lt;</span>&nbsp;<span class="ident" id="1806415">i1</span><span class="op" id="1806417">;</span>&nbsp;<span class="ident" id="1806419">i</span>&nbsp;<span class="op" id="1806421">+=</span>&nbsp;<span class="num" id="1806424">2</span>&nbsp;<span class="op" id="1806426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806431">if</span>&nbsp;<span class="ident" id="1806434">p</span><span class="op" id="1806435">.</span><span class="ident" id="1806436">Pix</span><span class="op" id="1806439">[</span><span class="ident" id="1806440">i</span><span class="op" id="1806441">+</span><span class="num" id="1806442">0</span><span class="op" id="1806443">]</span>&nbsp;<span class="op" id="1806445">!=</span>&nbsp;<span class="num" id="1806448">0xff</span>&nbsp;<span class="op" id="1806453">||</span>&nbsp;<span class="ident" id="1806456">p</span><span class="op" id="1806457">.</span><span class="ident" id="1806458">Pix</span><span class="op" id="1806461">[</span><span class="ident" id="1806462">i</span><span class="op" id="1806463">+</span><span class="num" id="1806464">1</span><span class="op" id="1806465">]</span>&nbsp;<span class="op" id="1806467">!=</span>&nbsp;<span class="num" id="1806470">0xff</span>&nbsp;<span class="op" id="1806475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806481">return</span>&nbsp;<span class="builtintype" id="1806488">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806501">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806505">i0</span>&nbsp;<span class="op" id="1806508">+=</span>&nbsp;<span class="ident" id="1806511">p</span><span class="op" id="1806512">.</span><span class="ident" id="1806513">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806522">i1</span>&nbsp;<span class="op" id="1806525">+=</span>&nbsp;<span class="ident" id="1806528">p</span><span class="op" id="1806529">.</span><span class="ident" id="1806530">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1806538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806541">return</span>&nbsp;<span class="builtintype" id="1806548">true</span><br>
<span class="lineno"></span><span class="op" id="1806553">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="1806556">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1806615">func</span>&nbsp;<span class="ident" id="1806620">NewAlpha16</span><span class="op" id="1806630">(</span><span class="ident" id="1806631">r</span>&nbsp;<span class="ident" id="1806633">Rectangle</span><span class="op" id="1806642">)</span>&nbsp;<span class="op" id="1806644">*</span><span class="ident" id="1806645">Alpha16</span>&nbsp;<span class="op" id="1806653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806656">w</span><span class="op" id="1806657">,</span>&nbsp;<span class="ident" id="1806659">h</span>&nbsp;<span class="op" id="1806661">:=</span>&nbsp;<span class="ident" id="1806664">r</span><span class="op" id="1806665">.</span><span class="ident" id="1806666">Dx</span><span class="op" id="1806668">(</span><span class="op" id="1806669">)</span><span class="op" id="1806670">,</span>&nbsp;<span class="ident" id="1806672">r</span><span class="op" id="1806673">.</span><span class="ident" id="1806674">Dy</span><span class="op" id="1806676">(</span><span class="op" id="1806677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806680">pix</span>&nbsp;<span class="op" id="1806684">:=</span>&nbsp;<span class="builtinfunc" id="1806687">make</span><span class="op" id="1806691">(</span><span class="op" id="1806692">[</span><span class="op" id="1806693">]</span><span class="builtintype" id="1806694">uint8</span><span class="op" id="1806699">,</span>&nbsp;<span class="num" id="1806701">2</span><span class="op" id="1806702">*</span><span class="ident" id="1806703">w</span><span class="op" id="1806704">*</span><span class="ident" id="1806705">h</span><span class="op" id="1806706">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1806709">return</span>&nbsp;<span class="op" id="1806716">&amp;</span><span class="ident" id="1806717">Alpha16</span><span class="op" id="1806724">{</span><span class="ident" id="1806725">pix</span><span class="op" id="1806728">,</span>&nbsp;<span class="num" id="1806730">2</span>&nbsp;<span class="op" id="1806732">*</span>&nbsp;<span class="ident" id="1806734">w</span><span class="op" id="1806735">,</span>&nbsp;<span class="ident" id="1806737">r</span><span class="op" id="1806738">}</span><br>
<span class="lineno"></span><span class="op" id="1806740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1806743">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1806816">type</span>&nbsp;<span class="ident" id="1806821">Gray</span>&nbsp;<span class="keyword" id="1806826">struct</span>&nbsp;<span class="op" id="1806833">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1806836">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1806899">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1806967">Pix</span>&nbsp;<span class="op" id="1806971">[</span><span class="op" id="1806972">]</span><span class="builtintype" id="1806973">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1806980">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807056">Stride</span>&nbsp;<span class="builtintype" id="1807063">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1807068">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807100">Rect</span>&nbsp;<span class="ident" id="1807105">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1807115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1807118">func</span>&nbsp;<span class="op" id="1807123">(</span><span class="ident" id="1807124">p</span>&nbsp;<span class="op" id="1807126">*</span><span class="ident" id="1807127">Gray</span><span class="op" id="1807131">)</span>&nbsp;<span class="ident" id="1807133">ColorModel</span><span class="op" id="1807143">(</span><span class="op" id="1807144">)</span>&nbsp;<span class="ident" id="1807146">color</span><span class="op" id="1807151">.</span><span class="ident" id="1807152">Model</span>&nbsp;<span class="op" id="1807158">{</span>&nbsp;<span class="keyword" id="1807160">return</span>&nbsp;<span class="ident" id="1807167">color</span><span class="op" id="1807172">.</span><span class="ident" id="1807173">GrayModel</span>&nbsp;<span class="op" id="1807183">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="1807186">func</span>&nbsp;<span class="op" id="1807191">(</span><span class="ident" id="1807192">p</span>&nbsp;<span class="op" id="1807194">*</span><span class="ident" id="1807195">Gray</span><span class="op" id="1807199">)</span>&nbsp;<span class="ident" id="1807201">Bounds</span><span class="op" id="1807207">(</span><span class="op" id="1807208">)</span>&nbsp;<span class="ident" id="1807210">Rectangle</span>&nbsp;<span class="op" id="1807220">{</span>&nbsp;<span class="keyword" id="1807222">return</span>&nbsp;<span class="ident" id="1807229">p</span><span class="op" id="1807230">.</span><span class="ident" id="1807231">Rect</span>&nbsp;<span class="op" id="1807236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1807239">func</span>&nbsp;<span class="op" id="1807244">(</span><span class="ident" id="1807245">p</span>&nbsp;<span class="op" id="1807247">*</span><span class="ident" id="1807248">Gray</span><span class="op" id="1807252">)</span>&nbsp;<span class="ident" id="1807254">At</span><span class="op" id="1807256">(</span><span class="ident" id="1807257">x</span><span class="op" id="1807258">,</span>&nbsp;<span class="ident" id="1807260">y</span>&nbsp;<span class="builtintype" id="1807262">int</span><span class="op" id="1807265">)</span>&nbsp;<span class="ident" id="1807267">color</span><span class="op" id="1807272">.</span><span class="ident" id="1807273">Color</span>&nbsp;<span class="op" id="1807279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807282">return</span>&nbsp;<span class="ident" id="1807289">p</span><span class="op" id="1807290">.</span><span class="ident" id="1807291">GrayAt</span><span class="op" id="1807297">(</span><span class="ident" id="1807298">x</span><span class="op" id="1807299">,</span>&nbsp;<span class="ident" id="1807301">y</span><span class="op" id="1807302">)</span><br>
<span class="lineno">685</span><span class="op" id="1807304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1807307">func</span>&nbsp;<span class="op" id="1807312">(</span><span class="ident" id="1807313">p</span>&nbsp;<span class="op" id="1807315">*</span><span class="ident" id="1807316">Gray</span><span class="op" id="1807320">)</span>&nbsp;<span class="ident" id="1807322">GrayAt</span><span class="op" id="1807328">(</span><span class="ident" id="1807329">x</span><span class="op" id="1807330">,</span>&nbsp;<span class="ident" id="1807332">y</span>&nbsp;<span class="builtintype" id="1807334">int</span><span class="op" id="1807337">)</span>&nbsp;<span class="ident" id="1807339">color</span><span class="op" id="1807344">.</span><span class="ident" id="1807345">Gray</span>&nbsp;<span class="op" id="1807350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807353">if</span>&nbsp;<span class="op" id="1807356">!</span><span class="op" id="1807357">(</span><span class="ident" id="1807358">Point</span><span class="op" id="1807363">{</span><span class="ident" id="1807364">x</span><span class="op" id="1807365">,</span>&nbsp;<span class="ident" id="1807367">y</span><span class="op" id="1807368">}</span><span class="op" id="1807369">.</span><span class="ident" id="1807370">In</span><span class="op" id="1807372">(</span><span class="ident" id="1807373">p</span><span class="op" id="1807374">.</span><span class="ident" id="1807375">Rect</span><span class="op" id="1807379">)</span><span class="op" id="1807380">)</span>&nbsp;<span class="op" id="1807382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807386">return</span>&nbsp;<span class="ident" id="1807393">color</span><span class="op" id="1807398">.</span><span class="ident" id="1807399">Gray</span><span class="op" id="1807403">{</span><span class="op" id="1807404">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1807407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807410">i</span>&nbsp;<span class="op" id="1807412">:=</span>&nbsp;<span class="ident" id="1807415">p</span><span class="op" id="1807416">.</span><span class="ident" id="1807417">PixOffset</span><span class="op" id="1807426">(</span><span class="ident" id="1807427">x</span><span class="op" id="1807428">,</span>&nbsp;<span class="ident" id="1807430">y</span><span class="op" id="1807431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807434">return</span>&nbsp;<span class="ident" id="1807441">color</span><span class="op" id="1807446">.</span><span class="ident" id="1807447">Gray</span><span class="op" id="1807451">{</span><span class="ident" id="1807452">p</span><span class="op" id="1807453">.</span><span class="ident" id="1807454">Pix</span><span class="op" id="1807457">[</span><span class="ident" id="1807458">i</span><span class="op" id="1807459">]</span><span class="op" id="1807460">}</span><br>
<span class="lineno"></span><span class="op" id="1807462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="1807465">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1807544">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1807568">func</span>&nbsp;<span class="op" id="1807573">(</span><span class="ident" id="1807574">p</span>&nbsp;<span class="op" id="1807576">*</span><span class="ident" id="1807577">Gray</span><span class="op" id="1807581">)</span>&nbsp;<span class="ident" id="1807583">PixOffset</span><span class="op" id="1807592">(</span><span class="ident" id="1807593">x</span><span class="op" id="1807594">,</span>&nbsp;<span class="ident" id="1807596">y</span>&nbsp;<span class="builtintype" id="1807598">int</span><span class="op" id="1807601">)</span>&nbsp;<span class="builtintype" id="1807603">int</span>&nbsp;<span class="op" id="1807607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807610">return</span>&nbsp;<span class="op" id="1807617">(</span><span class="ident" id="1807618">y</span><span class="op" id="1807619">-</span><span class="ident" id="1807620">p</span><span class="op" id="1807621">.</span><span class="ident" id="1807622">Rect</span><span class="op" id="1807626">.</span><span class="ident" id="1807627">Min</span><span class="op" id="1807630">.</span><span class="ident" id="1807631">Y</span><span class="op" id="1807632">)</span><span class="op" id="1807633">*</span><span class="ident" id="1807634">p</span><span class="op" id="1807635">.</span><span class="ident" id="1807636">Stride</span>&nbsp;<span class="op" id="1807643">+</span>&nbsp;<span class="op" id="1807645">(</span><span class="ident" id="1807646">x</span><span class="op" id="1807647">-</span><span class="ident" id="1807648">p</span><span class="op" id="1807649">.</span><span class="ident" id="1807650">Rect</span><span class="op" id="1807654">.</span><span class="ident" id="1807655">Min</span><span class="op" id="1807658">.</span><span class="ident" id="1807659">X</span><span class="op" id="1807660">)</span><span class="op" id="1807661">*</span><span class="num" id="1807662">1</span><br>
<span class="lineno"></span><span class="op" id="1807664">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="1807667">func</span>&nbsp;<span class="op" id="1807672">(</span><span class="ident" id="1807673">p</span>&nbsp;<span class="op" id="1807675">*</span><span class="ident" id="1807676">Gray</span><span class="op" id="1807680">)</span>&nbsp;<span class="ident" id="1807682">Set</span><span class="op" id="1807685">(</span><span class="ident" id="1807686">x</span><span class="op" id="1807687">,</span>&nbsp;<span class="ident" id="1807689">y</span>&nbsp;<span class="builtintype" id="1807691">int</span><span class="op" id="1807694">,</span>&nbsp;<span class="ident" id="1807696">c</span>&nbsp;<span class="ident" id="1807698">color</span><span class="op" id="1807703">.</span><span class="ident" id="1807704">Color</span><span class="op" id="1807709">)</span>&nbsp;<span class="op" id="1807711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807714">if</span>&nbsp;<span class="op" id="1807717">!</span><span class="op" id="1807718">(</span><span class="ident" id="1807719">Point</span><span class="op" id="1807724">{</span><span class="ident" id="1807725">x</span><span class="op" id="1807726">,</span>&nbsp;<span class="ident" id="1807728">y</span><span class="op" id="1807729">}</span><span class="op" id="1807730">.</span><span class="ident" id="1807731">In</span><span class="op" id="1807733">(</span><span class="ident" id="1807734">p</span><span class="op" id="1807735">.</span><span class="ident" id="1807736">Rect</span><span class="op" id="1807740">)</span><span class="op" id="1807741">)</span>&nbsp;<span class="op" id="1807743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1807755">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807758">i</span>&nbsp;<span class="op" id="1807760">:=</span>&nbsp;<span class="ident" id="1807763">p</span><span class="op" id="1807764">.</span><span class="ident" id="1807765">PixOffset</span><span class="op" id="1807774">(</span><span class="ident" id="1807775">x</span><span class="op" id="1807776">,</span>&nbsp;<span class="ident" id="1807778">y</span><span class="op" id="1807779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807782">p</span><span class="op" id="1807783">.</span><span class="ident" id="1807784">Pix</span><span class="op" id="1807787">[</span><span class="ident" id="1807788">i</span><span class="op" id="1807789">]</span>&nbsp;<span class="op" id="1807791">=</span>&nbsp;<span class="ident" id="1807793">color</span><span class="op" id="1807798">.</span><span class="ident" id="1807799">GrayModel</span><span class="op" id="1807808">.</span><span class="ident" id="1807809">Convert</span><span class="op" id="1807816">(</span><span class="ident" id="1807817">c</span><span class="op" id="1807818">)</span><span class="op" id="1807819">.</span><span class="op" id="1807820">(</span><span class="ident" id="1807821">color</span><span class="op" id="1807826">.</span><span class="ident" id="1807827">Gray</span><span class="op" id="1807831">)</span><span class="op" id="1807832">.</span><span class="ident" id="1807833">Y</span><br>
<span class="lineno"></span><span class="op" id="1807835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1807838">func</span>&nbsp;<span class="op" id="1807843">(</span><span class="ident" id="1807844">p</span>&nbsp;<span class="op" id="1807846">*</span><span class="ident" id="1807847">Gray</span><span class="op" id="1807851">)</span>&nbsp;<span class="ident" id="1807853">SetGray</span><span class="op" id="1807860">(</span><span class="ident" id="1807861">x</span><span class="op" id="1807862">,</span>&nbsp;<span class="ident" id="1807864">y</span>&nbsp;<span class="builtintype" id="1807866">int</span><span class="op" id="1807869">,</span>&nbsp;<span class="ident" id="1807871">c</span>&nbsp;<span class="ident" id="1807873">color</span><span class="op" id="1807878">.</span><span class="ident" id="1807879">Gray</span><span class="op" id="1807883">)</span>&nbsp;<span class="op" id="1807885">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807888">if</span>&nbsp;<span class="op" id="1807891">!</span><span class="op" id="1807892">(</span><span class="ident" id="1807893">Point</span><span class="op" id="1807898">{</span><span class="ident" id="1807899">x</span><span class="op" id="1807900">,</span>&nbsp;<span class="ident" id="1807902">y</span><span class="op" id="1807903">}</span><span class="op" id="1807904">.</span><span class="ident" id="1807905">In</span><span class="op" id="1807907">(</span><span class="ident" id="1807908">p</span><span class="op" id="1807909">.</span><span class="ident" id="1807910">Rect</span><span class="op" id="1807914">)</span><span class="op" id="1807915">)</span>&nbsp;<span class="op" id="1807917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1807921">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1807929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807932">i</span>&nbsp;<span class="op" id="1807934">:=</span>&nbsp;<span class="ident" id="1807937">p</span><span class="op" id="1807938">.</span><span class="ident" id="1807939">PixOffset</span><span class="op" id="1807948">(</span><span class="ident" id="1807949">x</span><span class="op" id="1807950">,</span>&nbsp;<span class="ident" id="1807952">y</span><span class="op" id="1807953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1807956">p</span><span class="op" id="1807957">.</span><span class="ident" id="1807958">Pix</span><span class="op" id="1807961">[</span><span class="ident" id="1807962">i</span><span class="op" id="1807963">]</span>&nbsp;<span class="op" id="1807965">=</span>&nbsp;<span class="ident" id="1807967">c</span><span class="op" id="1807968">.</span><span class="ident" id="1807969">Y</span><br>
<span class="lineno">715</span><span class="op" id="1807971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1807974">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1808051">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1808123">func</span>&nbsp;<span class="op" id="1808128">(</span><span class="ident" id="1808129">p</span>&nbsp;<span class="op" id="1808131">*</span><span class="ident" id="1808132">Gray</span><span class="op" id="1808136">)</span>&nbsp;<span class="ident" id="1808138">SubImage</span><span class="op" id="1808146">(</span><span class="ident" id="1808147">r</span>&nbsp;<span class="ident" id="1808149">Rectangle</span><span class="op" id="1808158">)</span>&nbsp;<span class="ident" id="1808160">Image</span>&nbsp;<span class="op" id="1808166">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808169">r</span>&nbsp;<span class="op" id="1808171">=</span>&nbsp;<span class="ident" id="1808173">r</span><span class="op" id="1808174">.</span><span class="ident" id="1808175">Intersect</span><span class="op" id="1808184">(</span><span class="ident" id="1808185">p</span><span class="op" id="1808186">.</span><span class="ident" id="1808187">Rect</span><span class="op" id="1808191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1808194">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1808275">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1808357">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1808407">if</span>&nbsp;<span class="ident" id="1808410">r</span><span class="op" id="1808411">.</span><span class="ident" id="1808412">Empty</span><span class="op" id="1808417">(</span><span class="op" id="1808418">)</span>&nbsp;<span class="op" id="1808420">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1808424">return</span>&nbsp;<span class="op" id="1808431">&amp;</span><span class="ident" id="1808432">Gray</span><span class="op" id="1808436">{</span><span class="op" id="1808437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1808440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808443">i</span>&nbsp;<span class="op" id="1808445">:=</span>&nbsp;<span class="ident" id="1808448">p</span><span class="op" id="1808449">.</span><span class="ident" id="1808450">PixOffset</span><span class="op" id="1808459">(</span><span class="ident" id="1808460">r</span><span class="op" id="1808461">.</span><span class="ident" id="1808462">Min</span><span class="op" id="1808465">.</span><span class="ident" id="1808466">X</span><span class="op" id="1808467">,</span>&nbsp;<span class="ident" id="1808469">r</span><span class="op" id="1808470">.</span><span class="ident" id="1808471">Min</span><span class="op" id="1808474">.</span><span class="ident" id="1808475">Y</span><span class="op" id="1808476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1808479">return</span>&nbsp;<span class="op" id="1808486">&amp;</span><span class="ident" id="1808487">Gray</span><span class="op" id="1808491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808495">Pix</span><span class="op" id="1808498">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808503">p</span><span class="op" id="1808504">.</span><span class="ident" id="1808505">Pix</span><span class="op" id="1808508">[</span><span class="ident" id="1808509">i</span><span class="op" id="1808510">:</span><span class="op" id="1808511">]</span><span class="op" id="1808512">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808516">Stride</span><span class="op" id="1808522">:</span>&nbsp;<span class="ident" id="1808524">p</span><span class="op" id="1808525">.</span><span class="ident" id="1808526">Stride</span><span class="op" id="1808532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808536">Rect</span><span class="op" id="1808540">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1808544">r</span><span class="op" id="1808545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1808548">}</span><br>
<span class="lineno"></span><span class="op" id="1808550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="1808553">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1808626">func</span>&nbsp;<span class="op" id="1808631">(</span><span class="ident" id="1808632">p</span>&nbsp;<span class="op" id="1808634">*</span><span class="ident" id="1808635">Gray</span><span class="op" id="1808639">)</span>&nbsp;<span class="ident" id="1808641">Opaque</span><span class="op" id="1808647">(</span><span class="op" id="1808648">)</span>&nbsp;<span class="builtintype" id="1808650">bool</span>&nbsp;<span class="op" id="1808655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1808658">return</span>&nbsp;<span class="builtintype" id="1808665">true</span><br>
<span class="lineno"></span><span class="op" id="1808670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="1808673">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1808726">func</span>&nbsp;<span class="ident" id="1808731">NewGray</span><span class="op" id="1808738">(</span><span class="ident" id="1808739">r</span>&nbsp;<span class="ident" id="1808741">Rectangle</span><span class="op" id="1808750">)</span>&nbsp;<span class="op" id="1808752">*</span><span class="ident" id="1808753">Gray</span>&nbsp;<span class="op" id="1808758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808761">w</span><span class="op" id="1808762">,</span>&nbsp;<span class="ident" id="1808764">h</span>&nbsp;<span class="op" id="1808766">:=</span>&nbsp;<span class="ident" id="1808769">r</span><span class="op" id="1808770">.</span><span class="ident" id="1808771">Dx</span><span class="op" id="1808773">(</span><span class="op" id="1808774">)</span><span class="op" id="1808775">,</span>&nbsp;<span class="ident" id="1808777">r</span><span class="op" id="1808778">.</span><span class="ident" id="1808779">Dy</span><span class="op" id="1808781">(</span><span class="op" id="1808782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1808785">pix</span>&nbsp;<span class="op" id="1808789">:=</span>&nbsp;<span class="builtinfunc" id="1808792">make</span><span class="op" id="1808796">(</span><span class="op" id="1808797">[</span><span class="op" id="1808798">]</span><span class="builtintype" id="1808799">uint8</span><span class="op" id="1808804">,</span>&nbsp;<span class="num" id="1808806">1</span><span class="op" id="1808807">*</span><span class="ident" id="1808808">w</span><span class="op" id="1808809">*</span><span class="ident" id="1808810">h</span><span class="op" id="1808811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1808814">return</span>&nbsp;<span class="op" id="1808821">&amp;</span><span class="ident" id="1808822">Gray</span><span class="op" id="1808826">{</span><span class="ident" id="1808827">pix</span><span class="op" id="1808830">,</span>&nbsp;<span class="num" id="1808832">1</span>&nbsp;<span class="op" id="1808834">*</span>&nbsp;<span class="ident" id="1808836">w</span><span class="op" id="1808837">,</span>&nbsp;<span class="ident" id="1808839">r</span><span class="op" id="1808840">}</span><br>
<span class="lineno">745</span><span class="op" id="1808842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1808845">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="1808922">type</span>&nbsp;<span class="ident" id="1808927">Gray16</span>&nbsp;<span class="keyword" id="1808934">struct</span>&nbsp;<span class="op" id="1808941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1808944">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1809028">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809096">Pix</span>&nbsp;<span class="op" id="1809100">[</span><span class="op" id="1809101">]</span><span class="builtintype" id="1809102">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1809109">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809185">Stride</span>&nbsp;<span class="builtintype" id="1809192">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1809197">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809229">Rect</span>&nbsp;<span class="ident" id="1809234">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="1809244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1809247">func</span>&nbsp;<span class="op" id="1809252">(</span><span class="ident" id="1809253">p</span>&nbsp;<span class="op" id="1809255">*</span><span class="ident" id="1809256">Gray16</span><span class="op" id="1809262">)</span>&nbsp;<span class="ident" id="1809264">ColorModel</span><span class="op" id="1809274">(</span><span class="op" id="1809275">)</span>&nbsp;<span class="ident" id="1809277">color</span><span class="op" id="1809282">.</span><span class="ident" id="1809283">Model</span>&nbsp;<span class="op" id="1809289">{</span>&nbsp;<span class="keyword" id="1809291">return</span>&nbsp;<span class="ident" id="1809298">color</span><span class="op" id="1809303">.</span><span class="ident" id="1809304">Gray16Model</span>&nbsp;<span class="op" id="1809316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="1809319">func</span>&nbsp;<span class="op" id="1809324">(</span><span class="ident" id="1809325">p</span>&nbsp;<span class="op" id="1809327">*</span><span class="ident" id="1809328">Gray16</span><span class="op" id="1809334">)</span>&nbsp;<span class="ident" id="1809336">Bounds</span><span class="op" id="1809342">(</span><span class="op" id="1809343">)</span>&nbsp;<span class="ident" id="1809345">Rectangle</span>&nbsp;<span class="op" id="1809355">{</span>&nbsp;<span class="keyword" id="1809357">return</span>&nbsp;<span class="ident" id="1809364">p</span><span class="op" id="1809365">.</span><span class="ident" id="1809366">Rect</span>&nbsp;<span class="op" id="1809371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1809374">func</span>&nbsp;<span class="op" id="1809379">(</span><span class="ident" id="1809380">p</span>&nbsp;<span class="op" id="1809382">*</span><span class="ident" id="1809383">Gray16</span><span class="op" id="1809389">)</span>&nbsp;<span class="ident" id="1809391">At</span><span class="op" id="1809393">(</span><span class="ident" id="1809394">x</span><span class="op" id="1809395">,</span>&nbsp;<span class="ident" id="1809397">y</span>&nbsp;<span class="builtintype" id="1809399">int</span><span class="op" id="1809402">)</span>&nbsp;<span class="ident" id="1809404">color</span><span class="op" id="1809409">.</span><span class="ident" id="1809410">Color</span>&nbsp;<span class="op" id="1809416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809419">return</span>&nbsp;<span class="ident" id="1809426">p</span><span class="op" id="1809427">.</span><span class="ident" id="1809428">Gray16At</span><span class="op" id="1809436">(</span><span class="ident" id="1809437">x</span><span class="op" id="1809438">,</span>&nbsp;<span class="ident" id="1809440">y</span><span class="op" id="1809441">)</span><br>
<span class="lineno"></span><span class="op" id="1809443">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="1809446">func</span>&nbsp;<span class="op" id="1809451">(</span><span class="ident" id="1809452">p</span>&nbsp;<span class="op" id="1809454">*</span><span class="ident" id="1809455">Gray16</span><span class="op" id="1809461">)</span>&nbsp;<span class="ident" id="1809463">Gray16At</span><span class="op" id="1809471">(</span><span class="ident" id="1809472">x</span><span class="op" id="1809473">,</span>&nbsp;<span class="ident" id="1809475">y</span>&nbsp;<span class="builtintype" id="1809477">int</span><span class="op" id="1809480">)</span>&nbsp;<span class="ident" id="1809482">color</span><span class="op" id="1809487">.</span><span class="ident" id="1809488">Gray16</span>&nbsp;<span class="op" id="1809495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809498">if</span>&nbsp;<span class="op" id="1809501">!</span><span class="op" id="1809502">(</span><span class="ident" id="1809503">Point</span><span class="op" id="1809508">{</span><span class="ident" id="1809509">x</span><span class="op" id="1809510">,</span>&nbsp;<span class="ident" id="1809512">y</span><span class="op" id="1809513">}</span><span class="op" id="1809514">.</span><span class="ident" id="1809515">In</span><span class="op" id="1809517">(</span><span class="ident" id="1809518">p</span><span class="op" id="1809519">.</span><span class="ident" id="1809520">Rect</span><span class="op" id="1809524">)</span><span class="op" id="1809525">)</span>&nbsp;<span class="op" id="1809527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809531">return</span>&nbsp;<span class="ident" id="1809538">color</span><span class="op" id="1809543">.</span><span class="ident" id="1809544">Gray16</span><span class="op" id="1809550">{</span><span class="op" id="1809551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1809554">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809557">i</span>&nbsp;<span class="op" id="1809559">:=</span>&nbsp;<span class="ident" id="1809562">p</span><span class="op" id="1809563">.</span><span class="ident" id="1809564">PixOffset</span><span class="op" id="1809573">(</span><span class="ident" id="1809574">x</span><span class="op" id="1809575">,</span>&nbsp;<span class="ident" id="1809577">y</span><span class="op" id="1809578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809581">return</span>&nbsp;<span class="ident" id="1809588">color</span><span class="op" id="1809593">.</span><span class="ident" id="1809594">Gray16</span><span class="op" id="1809600">{</span><span class="builtintype" id="1809601">uint16</span><span class="op" id="1809607">(</span><span class="ident" id="1809608">p</span><span class="op" id="1809609">.</span><span class="ident" id="1809610">Pix</span><span class="op" id="1809613">[</span><span class="ident" id="1809614">i</span><span class="op" id="1809615">+</span><span class="num" id="1809616">0</span><span class="op" id="1809617">]</span><span class="op" id="1809618">)</span><span class="op" id="1809619">&lt;&lt;</span><span class="num" id="1809621">8</span>&nbsp;<span class="op" id="1809623">|</span>&nbsp;<span class="builtintype" id="1809625">uint16</span><span class="op" id="1809631">(</span><span class="ident" id="1809632">p</span><span class="op" id="1809633">.</span><span class="ident" id="1809634">Pix</span><span class="op" id="1809637">[</span><span class="ident" id="1809638">i</span><span class="op" id="1809639">+</span><span class="num" id="1809640">1</span><span class="op" id="1809641">]</span><span class="op" id="1809642">)</span><span class="op" id="1809643">}</span><br>
<span class="lineno"></span><span class="op" id="1809645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1809648">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="1809727">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1809751">func</span>&nbsp;<span class="op" id="1809756">(</span><span class="ident" id="1809757">p</span>&nbsp;<span class="op" id="1809759">*</span><span class="ident" id="1809760">Gray16</span><span class="op" id="1809766">)</span>&nbsp;<span class="ident" id="1809768">PixOffset</span><span class="op" id="1809777">(</span><span class="ident" id="1809778">x</span><span class="op" id="1809779">,</span>&nbsp;<span class="ident" id="1809781">y</span>&nbsp;<span class="builtintype" id="1809783">int</span><span class="op" id="1809786">)</span>&nbsp;<span class="builtintype" id="1809788">int</span>&nbsp;<span class="op" id="1809792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809795">return</span>&nbsp;<span class="op" id="1809802">(</span><span class="ident" id="1809803">y</span><span class="op" id="1809804">-</span><span class="ident" id="1809805">p</span><span class="op" id="1809806">.</span><span class="ident" id="1809807">Rect</span><span class="op" id="1809811">.</span><span class="ident" id="1809812">Min</span><span class="op" id="1809815">.</span><span class="ident" id="1809816">Y</span><span class="op" id="1809817">)</span><span class="op" id="1809818">*</span><span class="ident" id="1809819">p</span><span class="op" id="1809820">.</span><span class="ident" id="1809821">Stride</span>&nbsp;<span class="op" id="1809828">+</span>&nbsp;<span class="op" id="1809830">(</span><span class="ident" id="1809831">x</span><span class="op" id="1809832">-</span><span class="ident" id="1809833">p</span><span class="op" id="1809834">.</span><span class="ident" id="1809835">Rect</span><span class="op" id="1809839">.</span><span class="ident" id="1809840">Min</span><span class="op" id="1809843">.</span><span class="ident" id="1809844">X</span><span class="op" id="1809845">)</span><span class="op" id="1809846">*</span><span class="num" id="1809847">2</span><br>
<span class="lineno"></span><span class="op" id="1809849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="1809852">func</span>&nbsp;<span class="op" id="1809857">(</span><span class="ident" id="1809858">p</span>&nbsp;<span class="op" id="1809860">*</span><span class="ident" id="1809861">Gray16</span><span class="op" id="1809867">)</span>&nbsp;<span class="ident" id="1809869">Set</span><span class="op" id="1809872">(</span><span class="ident" id="1809873">x</span><span class="op" id="1809874">,</span>&nbsp;<span class="ident" id="1809876">y</span>&nbsp;<span class="builtintype" id="1809878">int</span><span class="op" id="1809881">,</span>&nbsp;<span class="ident" id="1809883">c</span>&nbsp;<span class="ident" id="1809885">color</span><span class="op" id="1809890">.</span><span class="ident" id="1809891">Color</span><span class="op" id="1809896">)</span>&nbsp;<span class="op" id="1809898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809901">if</span>&nbsp;<span class="op" id="1809904">!</span><span class="op" id="1809905">(</span><span class="ident" id="1809906">Point</span><span class="op" id="1809911">{</span><span class="ident" id="1809912">x</span><span class="op" id="1809913">,</span>&nbsp;<span class="ident" id="1809915">y</span><span class="op" id="1809916">}</span><span class="op" id="1809917">.</span><span class="ident" id="1809918">In</span><span class="op" id="1809920">(</span><span class="ident" id="1809921">p</span><span class="op" id="1809922">.</span><span class="ident" id="1809923">Rect</span><span class="op" id="1809927">)</span><span class="op" id="1809928">)</span>&nbsp;<span class="op" id="1809930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1809934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1809942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809945">i</span>&nbsp;<span class="op" id="1809947">:=</span>&nbsp;<span class="ident" id="1809950">p</span><span class="op" id="1809951">.</span><span class="ident" id="1809952">PixOffset</span><span class="op" id="1809961">(</span><span class="ident" id="1809962">x</span><span class="op" id="1809963">,</span>&nbsp;<span class="ident" id="1809965">y</span><span class="op" id="1809966">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1809969">c1</span>&nbsp;<span class="op" id="1809972">:=</span>&nbsp;<span class="ident" id="1809975">color</span><span class="op" id="1809980">.</span><span class="ident" id="1809981">Gray16Model</span><span class="op" id="1809992">.</span><span class="ident" id="1809993">Convert</span><span class="op" id="1810000">(</span><span class="ident" id="1810001">c</span><span class="op" id="1810002">)</span><span class="op" id="1810003">.</span><span class="op" id="1810004">(</span><span class="ident" id="1810005">color</span><span class="op" id="1810010">.</span><span class="ident" id="1810011">Gray16</span><span class="op" id="1810017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810020">p</span><span class="op" id="1810021">.</span><span class="ident" id="1810022">Pix</span><span class="op" id="1810025">[</span><span class="ident" id="1810026">i</span><span class="op" id="1810027">+</span><span class="num" id="1810028">0</span><span class="op" id="1810029">]</span>&nbsp;<span class="op" id="1810031">=</span>&nbsp;<span class="builtintype" id="1810033">uint8</span><span class="op" id="1810038">(</span><span class="ident" id="1810039">c1</span><span class="op" id="1810041">.</span><span class="ident" id="1810042">Y</span>&nbsp;<span class="op" id="1810044">&gt;&gt;</span>&nbsp;<span class="num" id="1810047">8</span><span class="op" id="1810048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810051">p</span><span class="op" id="1810052">.</span><span class="ident" id="1810053">Pix</span><span class="op" id="1810056">[</span><span class="ident" id="1810057">i</span><span class="op" id="1810058">+</span><span class="num" id="1810059">1</span><span class="op" id="1810060">]</span>&nbsp;<span class="op" id="1810062">=</span>&nbsp;<span class="builtintype" id="1810064">uint8</span><span class="op" id="1810069">(</span><span class="ident" id="1810070">c1</span><span class="op" id="1810072">.</span><span class="ident" id="1810073">Y</span><span class="op" id="1810074">)</span><br>
<span class="lineno"></span><span class="op" id="1810076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="1810079">func</span>&nbsp;<span class="op" id="1810084">(</span><span class="ident" id="1810085">p</span>&nbsp;<span class="op" id="1810087">*</span><span class="ident" id="1810088">Gray16</span><span class="op" id="1810094">)</span>&nbsp;<span class="ident" id="1810096">SetGray16</span><span class="op" id="1810105">(</span><span class="ident" id="1810106">x</span><span class="op" id="1810107">,</span>&nbsp;<span class="ident" id="1810109">y</span>&nbsp;<span class="builtintype" id="1810111">int</span><span class="op" id="1810114">,</span>&nbsp;<span class="ident" id="1810116">c</span>&nbsp;<span class="ident" id="1810118">color</span><span class="op" id="1810123">.</span><span class="ident" id="1810124">Gray16</span><span class="op" id="1810130">)</span>&nbsp;<span class="op" id="1810132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810135">if</span>&nbsp;<span class="op" id="1810138">!</span><span class="op" id="1810139">(</span><span class="ident" id="1810140">Point</span><span class="op" id="1810145">{</span><span class="ident" id="1810146">x</span><span class="op" id="1810147">,</span>&nbsp;<span class="ident" id="1810149">y</span><span class="op" id="1810150">}</span><span class="op" id="1810151">.</span><span class="ident" id="1810152">In</span><span class="op" id="1810154">(</span><span class="ident" id="1810155">p</span><span class="op" id="1810156">.</span><span class="ident" id="1810157">Rect</span><span class="op" id="1810161">)</span><span class="op" id="1810162">)</span>&nbsp;<span class="op" id="1810164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1810176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810179">i</span>&nbsp;<span class="op" id="1810181">:=</span>&nbsp;<span class="ident" id="1810184">p</span><span class="op" id="1810185">.</span><span class="ident" id="1810186">PixOffset</span><span class="op" id="1810195">(</span><span class="ident" id="1810196">x</span><span class="op" id="1810197">,</span>&nbsp;<span class="ident" id="1810199">y</span><span class="op" id="1810200">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810203">p</span><span class="op" id="1810204">.</span><span class="ident" id="1810205">Pix</span><span class="op" id="1810208">[</span><span class="ident" id="1810209">i</span><span class="op" id="1810210">+</span><span class="num" id="1810211">0</span><span class="op" id="1810212">]</span>&nbsp;<span class="op" id="1810214">=</span>&nbsp;<span class="builtintype" id="1810216">uint8</span><span class="op" id="1810221">(</span><span class="ident" id="1810222">c</span><span class="op" id="1810223">.</span><span class="ident" id="1810224">Y</span>&nbsp;<span class="op" id="1810226">&gt;&gt;</span>&nbsp;<span class="num" id="1810229">8</span><span class="op" id="1810230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810233">p</span><span class="op" id="1810234">.</span><span class="ident" id="1810235">Pix</span><span class="op" id="1810238">[</span><span class="ident" id="1810239">i</span><span class="op" id="1810240">+</span><span class="num" id="1810241">1</span><span class="op" id="1810242">]</span>&nbsp;<span class="op" id="1810244">=</span>&nbsp;<span class="builtintype" id="1810246">uint8</span><span class="op" id="1810251">(</span><span class="ident" id="1810252">c</span><span class="op" id="1810253">.</span><span class="ident" id="1810254">Y</span><span class="op" id="1810255">)</span><br>
<span class="lineno"></span><span class="op" id="1810257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1810260">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="1810337">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1810409">func</span>&nbsp;<span class="op" id="1810414">(</span><span class="ident" id="1810415">p</span>&nbsp;<span class="op" id="1810417">*</span><span class="ident" id="1810418">Gray16</span><span class="op" id="1810424">)</span>&nbsp;<span class="ident" id="1810426">SubImage</span><span class="op" id="1810434">(</span><span class="ident" id="1810435">r</span>&nbsp;<span class="ident" id="1810437">Rectangle</span><span class="op" id="1810446">)</span>&nbsp;<span class="ident" id="1810448">Image</span>&nbsp;<span class="op" id="1810454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810457">r</span>&nbsp;<span class="op" id="1810459">=</span>&nbsp;<span class="ident" id="1810461">r</span><span class="op" id="1810462">.</span><span class="ident" id="1810463">Intersect</span><span class="op" id="1810472">(</span><span class="ident" id="1810473">p</span><span class="op" id="1810474">.</span><span class="ident" id="1810475">Rect</span><span class="op" id="1810479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1810482">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1810563">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1810645">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810695">if</span>&nbsp;<span class="ident" id="1810698">r</span><span class="op" id="1810699">.</span><span class="ident" id="1810700">Empty</span><span class="op" id="1810705">(</span><span class="op" id="1810706">)</span>&nbsp;<span class="op" id="1810708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810712">return</span>&nbsp;<span class="op" id="1810719">&amp;</span><span class="ident" id="1810720">Gray16</span><span class="op" id="1810726">{</span><span class="op" id="1810727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1810730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810733">i</span>&nbsp;<span class="op" id="1810735">:=</span>&nbsp;<span class="ident" id="1810738">p</span><span class="op" id="1810739">.</span><span class="ident" id="1810740">PixOffset</span><span class="op" id="1810749">(</span><span class="ident" id="1810750">r</span><span class="op" id="1810751">.</span><span class="ident" id="1810752">Min</span><span class="op" id="1810755">.</span><span class="ident" id="1810756">X</span><span class="op" id="1810757">,</span>&nbsp;<span class="ident" id="1810759">r</span><span class="op" id="1810760">.</span><span class="ident" id="1810761">Min</span><span class="op" id="1810764">.</span><span class="ident" id="1810765">Y</span><span class="op" id="1810766">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810769">return</span>&nbsp;<span class="op" id="1810776">&amp;</span><span class="ident" id="1810777">Gray16</span><span class="op" id="1810783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810787">Pix</span><span class="op" id="1810790">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810795">p</span><span class="op" id="1810796">.</span><span class="ident" id="1810797">Pix</span><span class="op" id="1810800">[</span><span class="ident" id="1810801">i</span><span class="op" id="1810802">:</span><span class="op" id="1810803">]</span><span class="op" id="1810804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810808">Stride</span><span class="op" id="1810814">:</span>&nbsp;<span class="ident" id="1810816">p</span><span class="op" id="1810817">.</span><span class="ident" id="1810818">Stride</span><span class="op" id="1810824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1810828">Rect</span><span class="op" id="1810832">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1810836">r</span><span class="op" id="1810837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1810840">}</span><br>
<span class="lineno">815</span><span class="op" id="1810842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1810845">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1810918">func</span>&nbsp;<span class="op" id="1810923">(</span><span class="ident" id="1810924">p</span>&nbsp;<span class="op" id="1810926">*</span><span class="ident" id="1810927">Gray16</span><span class="op" id="1810933">)</span>&nbsp;<span class="ident" id="1810935">Opaque</span><span class="op" id="1810941">(</span><span class="op" id="1810942">)</span>&nbsp;<span class="builtintype" id="1810944">bool</span>&nbsp;<span class="op" id="1810949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1810952">return</span>&nbsp;<span class="builtintype" id="1810959">true</span><br>
<span class="lineno">820</span><span class="op" id="1810964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1810967">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="1811024">func</span>&nbsp;<span class="ident" id="1811029">NewGray16</span><span class="op" id="1811038">(</span><span class="ident" id="1811039">r</span>&nbsp;<span class="ident" id="1811041">Rectangle</span><span class="op" id="1811050">)</span>&nbsp;<span class="op" id="1811052">*</span><span class="ident" id="1811053">Gray16</span>&nbsp;<span class="op" id="1811060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811063">w</span><span class="op" id="1811064">,</span>&nbsp;<span class="ident" id="1811066">h</span>&nbsp;<span class="op" id="1811068">:=</span>&nbsp;<span class="ident" id="1811071">r</span><span class="op" id="1811072">.</span><span class="ident" id="1811073">Dx</span><span class="op" id="1811075">(</span><span class="op" id="1811076">)</span><span class="op" id="1811077">,</span>&nbsp;<span class="ident" id="1811079">r</span><span class="op" id="1811080">.</span><span class="ident" id="1811081">Dy</span><span class="op" id="1811083">(</span><span class="op" id="1811084">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811087">pix</span>&nbsp;<span class="op" id="1811091">:=</span>&nbsp;<span class="builtinfunc" id="1811094">make</span><span class="op" id="1811098">(</span><span class="op" id="1811099">[</span><span class="op" id="1811100">]</span><span class="builtintype" id="1811101">uint8</span><span class="op" id="1811106">,</span>&nbsp;<span class="num" id="1811108">2</span><span class="op" id="1811109">*</span><span class="ident" id="1811110">w</span><span class="op" id="1811111">*</span><span class="ident" id="1811112">h</span><span class="op" id="1811113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811116">return</span>&nbsp;<span class="op" id="1811123">&amp;</span><span class="ident" id="1811124">Gray16</span><span class="op" id="1811130">{</span><span class="ident" id="1811131">pix</span><span class="op" id="1811134">,</span>&nbsp;<span class="num" id="1811136">2</span>&nbsp;<span class="op" id="1811138">*</span>&nbsp;<span class="ident" id="1811140">w</span><span class="op" id="1811141">,</span>&nbsp;<span class="ident" id="1811143">r</span><span class="op" id="1811144">}</span><br>
<span class="lineno"></span><span class="op" id="1811146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1811149">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="1811222">type</span>&nbsp;<span class="ident" id="1811227">Paletted</span>&nbsp;<span class="keyword" id="1811236">struct</span>&nbsp;<span class="op" id="1811243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1811246">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1811313">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811381">Pix</span>&nbsp;<span class="op" id="1811385">[</span><span class="op" id="1811386">]</span><span class="builtintype" id="1811387">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1811394">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811470">Stride</span>&nbsp;<span class="builtintype" id="1811477">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1811482">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811514">Rect</span>&nbsp;<span class="ident" id="1811519">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1811530">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811566">Palette</span>&nbsp;<span class="ident" id="1811574">color</span><span class="op" id="1811579">.</span><span class="ident" id="1811580">Palette</span><br>
<span class="lineno">840</span><span class="op" id="1811588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1811591">func</span>&nbsp;<span class="op" id="1811596">(</span><span class="ident" id="1811597">p</span>&nbsp;<span class="op" id="1811599">*</span><span class="ident" id="1811600">Paletted</span><span class="op" id="1811608">)</span>&nbsp;<span class="ident" id="1811610">ColorModel</span><span class="op" id="1811620">(</span><span class="op" id="1811621">)</span>&nbsp;<span class="ident" id="1811623">color</span><span class="op" id="1811628">.</span><span class="ident" id="1811629">Model</span>&nbsp;<span class="op" id="1811635">{</span>&nbsp;<span class="keyword" id="1811637">return</span>&nbsp;<span class="ident" id="1811644">p</span><span class="op" id="1811645">.</span><span class="ident" id="1811646">Palette</span>&nbsp;<span class="op" id="1811654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1811657">func</span>&nbsp;<span class="op" id="1811662">(</span><span class="ident" id="1811663">p</span>&nbsp;<span class="op" id="1811665">*</span><span class="ident" id="1811666">Paletted</span><span class="op" id="1811674">)</span>&nbsp;<span class="ident" id="1811676">Bounds</span><span class="op" id="1811682">(</span><span class="op" id="1811683">)</span>&nbsp;<span class="ident" id="1811685">Rectangle</span>&nbsp;<span class="op" id="1811695">{</span>&nbsp;<span class="keyword" id="1811697">return</span>&nbsp;<span class="ident" id="1811704">p</span><span class="op" id="1811705">.</span><span class="ident" id="1811706">Rect</span>&nbsp;<span class="op" id="1811711">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="1811714">func</span>&nbsp;<span class="op" id="1811719">(</span><span class="ident" id="1811720">p</span>&nbsp;<span class="op" id="1811722">*</span><span class="ident" id="1811723">Paletted</span><span class="op" id="1811731">)</span>&nbsp;<span class="ident" id="1811733">At</span><span class="op" id="1811735">(</span><span class="ident" id="1811736">x</span><span class="op" id="1811737">,</span>&nbsp;<span class="ident" id="1811739">y</span>&nbsp;<span class="builtintype" id="1811741">int</span><span class="op" id="1811744">)</span>&nbsp;<span class="ident" id="1811746">color</span><span class="op" id="1811751">.</span><span class="ident" id="1811752">Color</span>&nbsp;<span class="op" id="1811758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811761">if</span>&nbsp;<span class="builtinfunc" id="1811764">len</span><span class="op" id="1811767">(</span><span class="ident" id="1811768">p</span><span class="op" id="1811769">.</span><span class="ident" id="1811770">Palette</span><span class="op" id="1811777">)</span>&nbsp;<span class="op" id="1811779">==</span>&nbsp;<span class="num" id="1811782">0</span>&nbsp;<span class="op" id="1811784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811788">return</span>&nbsp;<span class="builtintype" id="1811795">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1811800">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811803">if</span>&nbsp;<span class="op" id="1811806">!</span><span class="op" id="1811807">(</span><span class="ident" id="1811808">Point</span><span class="op" id="1811813">{</span><span class="ident" id="1811814">x</span><span class="op" id="1811815">,</span>&nbsp;<span class="ident" id="1811817">y</span><span class="op" id="1811818">}</span><span class="op" id="1811819">.</span><span class="ident" id="1811820">In</span><span class="op" id="1811822">(</span><span class="ident" id="1811823">p</span><span class="op" id="1811824">.</span><span class="ident" id="1811825">Rect</span><span class="op" id="1811829">)</span><span class="op" id="1811830">)</span>&nbsp;<span class="op" id="1811832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811836">return</span>&nbsp;<span class="ident" id="1811843">p</span><span class="op" id="1811844">.</span><span class="ident" id="1811845">Palette</span><span class="op" id="1811852">[</span><span class="num" id="1811853">0</span><span class="op" id="1811854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1811857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1811860">i</span>&nbsp;<span class="op" id="1811862">:=</span>&nbsp;<span class="ident" id="1811865">p</span><span class="op" id="1811866">.</span><span class="ident" id="1811867">PixOffset</span><span class="op" id="1811876">(</span><span class="ident" id="1811877">x</span><span class="op" id="1811878">,</span>&nbsp;<span class="ident" id="1811880">y</span><span class="op" id="1811881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1811884">return</span>&nbsp;<span class="ident" id="1811891">p</span><span class="op" id="1811892">.</span><span class="ident" id="1811893">Palette</span><span class="op" id="1811900">[</span><span class="ident" id="1811901">p</span><span class="op" id="1811902">.</span><span class="ident" id="1811903">Pix</span><span class="op" id="1811906">[</span><span class="ident" id="1811907">i</span><span class="op" id="1811908">]</span><span class="op" id="1811909">]</span><br>
<span class="lineno">855</span><span class="op" id="1811911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1811914">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1811993">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="1812017">func</span>&nbsp;<span class="op" id="1812022">(</span><span class="ident" id="1812023">p</span>&nbsp;<span class="op" id="1812025">*</span><span class="ident" id="1812026">Paletted</span><span class="op" id="1812034">)</span>&nbsp;<span class="ident" id="1812036">PixOffset</span><span class="op" id="1812045">(</span><span class="ident" id="1812046">x</span><span class="op" id="1812047">,</span>&nbsp;<span class="ident" id="1812049">y</span>&nbsp;<span class="builtintype" id="1812051">int</span><span class="op" id="1812054">)</span>&nbsp;<span class="builtintype" id="1812056">int</span>&nbsp;<span class="op" id="1812060">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812063">return</span>&nbsp;<span class="op" id="1812070">(</span><span class="ident" id="1812071">y</span><span class="op" id="1812072">-</span><span class="ident" id="1812073">p</span><span class="op" id="1812074">.</span><span class="ident" id="1812075">Rect</span><span class="op" id="1812079">.</span><span class="ident" id="1812080">Min</span><span class="op" id="1812083">.</span><span class="ident" id="1812084">Y</span><span class="op" id="1812085">)</span><span class="op" id="1812086">*</span><span class="ident" id="1812087">p</span><span class="op" id="1812088">.</span><span class="ident" id="1812089">Stride</span>&nbsp;<span class="op" id="1812096">+</span>&nbsp;<span class="op" id="1812098">(</span><span class="ident" id="1812099">x</span><span class="op" id="1812100">-</span><span class="ident" id="1812101">p</span><span class="op" id="1812102">.</span><span class="ident" id="1812103">Rect</span><span class="op" id="1812107">.</span><span class="ident" id="1812108">Min</span><span class="op" id="1812111">.</span><span class="ident" id="1812112">X</span><span class="op" id="1812113">)</span><span class="op" id="1812114">*</span><span class="num" id="1812115">1</span><br>
<span class="lineno"></span><span class="op" id="1812117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1812120">func</span>&nbsp;<span class="op" id="1812125">(</span><span class="ident" id="1812126">p</span>&nbsp;<span class="op" id="1812128">*</span><span class="ident" id="1812129">Paletted</span><span class="op" id="1812137">)</span>&nbsp;<span class="ident" id="1812139">Set</span><span class="op" id="1812142">(</span><span class="ident" id="1812143">x</span><span class="op" id="1812144">,</span>&nbsp;<span class="ident" id="1812146">y</span>&nbsp;<span class="builtintype" id="1812148">int</span><span class="op" id="1812151">,</span>&nbsp;<span class="ident" id="1812153">c</span>&nbsp;<span class="ident" id="1812155">color</span><span class="op" id="1812160">.</span><span class="ident" id="1812161">Color</span><span class="op" id="1812166">)</span>&nbsp;<span class="op" id="1812168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812171">if</span>&nbsp;<span class="op" id="1812174">!</span><span class="op" id="1812175">(</span><span class="ident" id="1812176">Point</span><span class="op" id="1812181">{</span><span class="ident" id="1812182">x</span><span class="op" id="1812183">,</span>&nbsp;<span class="ident" id="1812185">y</span><span class="op" id="1812186">}</span><span class="op" id="1812187">.</span><span class="ident" id="1812188">In</span><span class="op" id="1812190">(</span><span class="ident" id="1812191">p</span><span class="op" id="1812192">.</span><span class="ident" id="1812193">Rect</span><span class="op" id="1812197">)</span><span class="op" id="1812198">)</span>&nbsp;<span class="op" id="1812200">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812204">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1812212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812215">i</span>&nbsp;<span class="op" id="1812217">:=</span>&nbsp;<span class="ident" id="1812220">p</span><span class="op" id="1812221">.</span><span class="ident" id="1812222">PixOffset</span><span class="op" id="1812231">(</span><span class="ident" id="1812232">x</span><span class="op" id="1812233">,</span>&nbsp;<span class="ident" id="1812235">y</span><span class="op" id="1812236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812239">p</span><span class="op" id="1812240">.</span><span class="ident" id="1812241">Pix</span><span class="op" id="1812244">[</span><span class="ident" id="1812245">i</span><span class="op" id="1812246">]</span>&nbsp;<span class="op" id="1812248">=</span>&nbsp;<span class="builtintype" id="1812250">uint8</span><span class="op" id="1812255">(</span><span class="ident" id="1812256">p</span><span class="op" id="1812257">.</span><span class="ident" id="1812258">Palette</span><span class="op" id="1812265">.</span><span class="ident" id="1812266">Index</span><span class="op" id="1812271">(</span><span class="ident" id="1812272">c</span><span class="op" id="1812273">)</span><span class="op" id="1812274">)</span><br>
<span class="lineno"></span><span class="op" id="1812276">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="1812279">func</span>&nbsp;<span class="op" id="1812284">(</span><span class="ident" id="1812285">p</span>&nbsp;<span class="op" id="1812287">*</span><span class="ident" id="1812288">Paletted</span><span class="op" id="1812296">)</span>&nbsp;<span class="ident" id="1812298">ColorIndexAt</span><span class="op" id="1812310">(</span><span class="ident" id="1812311">x</span><span class="op" id="1812312">,</span>&nbsp;<span class="ident" id="1812314">y</span>&nbsp;<span class="builtintype" id="1812316">int</span><span class="op" id="1812319">)</span>&nbsp;<span class="builtintype" id="1812321">uint8</span>&nbsp;<span class="op" id="1812327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812330">if</span>&nbsp;<span class="op" id="1812333">!</span><span class="op" id="1812334">(</span><span class="ident" id="1812335">Point</span><span class="op" id="1812340">{</span><span class="ident" id="1812341">x</span><span class="op" id="1812342">,</span>&nbsp;<span class="ident" id="1812344">y</span><span class="op" id="1812345">}</span><span class="op" id="1812346">.</span><span class="ident" id="1812347">In</span><span class="op" id="1812349">(</span><span class="ident" id="1812350">p</span><span class="op" id="1812351">.</span><span class="ident" id="1812352">Rect</span><span class="op" id="1812356">)</span><span class="op" id="1812357">)</span>&nbsp;<span class="op" id="1812359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812363">return</span>&nbsp;<span class="num" id="1812370">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1812373">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812376">i</span>&nbsp;<span class="op" id="1812378">:=</span>&nbsp;<span class="ident" id="1812381">p</span><span class="op" id="1812382">.</span><span class="ident" id="1812383">PixOffset</span><span class="op" id="1812392">(</span><span class="ident" id="1812393">x</span><span class="op" id="1812394">,</span>&nbsp;<span class="ident" id="1812396">y</span><span class="op" id="1812397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812400">return</span>&nbsp;<span class="ident" id="1812407">p</span><span class="op" id="1812408">.</span><span class="ident" id="1812409">Pix</span><span class="op" id="1812412">[</span><span class="ident" id="1812413">i</span><span class="op" id="1812414">]</span><br>
<span class="lineno"></span><span class="op" id="1812416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1812419">func</span>&nbsp;<span class="op" id="1812424">(</span><span class="ident" id="1812425">p</span>&nbsp;<span class="op" id="1812427">*</span><span class="ident" id="1812428">Paletted</span><span class="op" id="1812436">)</span>&nbsp;<span class="ident" id="1812438">SetColorIndex</span><span class="op" id="1812451">(</span><span class="ident" id="1812452">x</span><span class="op" id="1812453">,</span>&nbsp;<span class="ident" id="1812455">y</span>&nbsp;<span class="builtintype" id="1812457">int</span><span class="op" id="1812460">,</span>&nbsp;<span class="ident" id="1812462">index</span>&nbsp;<span class="builtintype" id="1812468">uint8</span><span class="op" id="1812473">)</span>&nbsp;<span class="op" id="1812475">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812478">if</span>&nbsp;<span class="op" id="1812481">!</span><span class="op" id="1812482">(</span><span class="ident" id="1812483">Point</span><span class="op" id="1812488">{</span><span class="ident" id="1812489">x</span><span class="op" id="1812490">,</span>&nbsp;<span class="ident" id="1812492">y</span><span class="op" id="1812493">}</span><span class="op" id="1812494">.</span><span class="ident" id="1812495">In</span><span class="op" id="1812497">(</span><span class="ident" id="1812498">p</span><span class="op" id="1812499">.</span><span class="ident" id="1812500">Rect</span><span class="op" id="1812504">)</span><span class="op" id="1812505">)</span>&nbsp;<span class="op" id="1812507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1812511">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1812519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812522">i</span>&nbsp;<span class="op" id="1812524">:=</span>&nbsp;<span class="ident" id="1812527">p</span><span class="op" id="1812528">.</span><span class="ident" id="1812529">PixOffset</span><span class="op" id="1812538">(</span><span class="ident" id="1812539">x</span><span class="op" id="1812540">,</span>&nbsp;<span class="ident" id="1812542">y</span><span class="op" id="1812543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812546">p</span><span class="op" id="1812547">.</span><span class="ident" id="1812548">Pix</span><span class="op" id="1812551">[</span><span class="ident" id="1812552">i</span><span class="op" id="1812553">]</span>&nbsp;<span class="op" id="1812555">=</span>&nbsp;<span class="ident" id="1812557">index</span><br>
<span class="lineno">885</span><span class="op" id="1812563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1812566">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="1812643">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1812715">func</span>&nbsp;<span class="op" id="1812720">(</span><span class="ident" id="1812721">p</span>&nbsp;<span class="op" id="1812723">*</span><span class="ident" id="1812724">Paletted</span><span class="op" id="1812732">)</span>&nbsp;<span class="ident" id="1812734">SubImage</span><span class="op" id="1812742">(</span><span class="ident" id="1812743">r</span>&nbsp;<span class="ident" id="1812745">Rectangle</span><span class="op" id="1812754">)</span>&nbsp;<span class="ident" id="1812756">Image</span>&nbsp;<span class="op" id="1812762">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1812765">r</span>&nbsp;<span class="op" id="1812767">=</span>&nbsp;<span class="ident" id="1812769">r</span><span class="op" id="1812770">.</span><span class="ident" id="1812771">Intersect</span><span class="op" id="1812780">(</span><span class="ident" id="1812781">p</span><span class="op" id="1812782">.</span><span class="ident" id="1812783">Rect</span><span class="op" id="1812787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1812790">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1812871">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1812953">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813003">if</span>&nbsp;<span class="ident" id="1813006">r</span><span class="op" id="1813007">.</span><span class="ident" id="1813008">Empty</span><span class="op" id="1813013">(</span><span class="op" id="1813014">)</span>&nbsp;<span class="op" id="1813016">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813020">return</span>&nbsp;<span class="op" id="1813027">&amp;</span><span class="ident" id="1813028">Paletted</span><span class="op" id="1813036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813041">Palette</span><span class="op" id="1813048">:</span>&nbsp;<span class="ident" id="1813050">p</span><span class="op" id="1813051">.</span><span class="ident" id="1813052">Palette</span><span class="op" id="1813059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813069">i</span>&nbsp;<span class="op" id="1813071">:=</span>&nbsp;<span class="ident" id="1813074">p</span><span class="op" id="1813075">.</span><span class="ident" id="1813076">PixOffset</span><span class="op" id="1813085">(</span><span class="ident" id="1813086">r</span><span class="op" id="1813087">.</span><span class="ident" id="1813088">Min</span><span class="op" id="1813091">.</span><span class="ident" id="1813092">X</span><span class="op" id="1813093">,</span>&nbsp;<span class="ident" id="1813095">r</span><span class="op" id="1813096">.</span><span class="ident" id="1813097">Min</span><span class="op" id="1813100">.</span><span class="ident" id="1813101">Y</span><span class="op" id="1813102">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813105">return</span>&nbsp;<span class="op" id="1813112">&amp;</span><span class="ident" id="1813113">Paletted</span><span class="op" id="1813121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813125">Pix</span><span class="op" id="1813128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813134">p</span><span class="op" id="1813135">.</span><span class="ident" id="1813136">Pix</span><span class="op" id="1813139">[</span><span class="ident" id="1813140">i</span><span class="op" id="1813141">:</span><span class="op" id="1813142">]</span><span class="op" id="1813143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813147">Stride</span><span class="op" id="1813153">:</span>&nbsp;&nbsp;<span class="ident" id="1813156">p</span><span class="op" id="1813157">.</span><span class="ident" id="1813158">Stride</span><span class="op" id="1813164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813168">Rect</span><span class="op" id="1813172">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813177">p</span><span class="op" id="1813178">.</span><span class="ident" id="1813179">Rect</span><span class="op" id="1813183">.</span><span class="ident" id="1813184">Intersect</span><span class="op" id="1813193">(</span><span class="ident" id="1813194">r</span><span class="op" id="1813195">)</span><span class="op" id="1813196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813200">Palette</span><span class="op" id="1813207">:</span>&nbsp;<span class="ident" id="1813209">p</span><span class="op" id="1813210">.</span><span class="ident" id="1813211">Palette</span><span class="op" id="1813218">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813221">}</span><br>
<span class="lineno"></span><span class="op" id="1813223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1813226">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="1813299">func</span>&nbsp;<span class="op" id="1813304">(</span><span class="ident" id="1813305">p</span>&nbsp;<span class="op" id="1813307">*</span><span class="ident" id="1813308">Paletted</span><span class="op" id="1813316">)</span>&nbsp;<span class="ident" id="1813318">Opaque</span><span class="op" id="1813324">(</span><span class="op" id="1813325">)</span>&nbsp;<span class="builtintype" id="1813327">bool</span>&nbsp;<span class="op" id="1813332">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813335">var</span>&nbsp;<span class="ident" id="1813339">present</span>&nbsp;<span class="op" id="1813347">[</span><span class="num" id="1813348">256</span><span class="op" id="1813351">]</span><span class="builtintype" id="1813352">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813358">i0</span><span class="op" id="1813360">,</span>&nbsp;<span class="ident" id="1813362">i1</span>&nbsp;<span class="op" id="1813365">:=</span>&nbsp;<span class="num" id="1813368">0</span><span class="op" id="1813369">,</span>&nbsp;<span class="ident" id="1813371">p</span><span class="op" id="1813372">.</span><span class="ident" id="1813373">Rect</span><span class="op" id="1813377">.</span><span class="ident" id="1813378">Dx</span><span class="op" id="1813380">(</span><span class="op" id="1813381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813384">for</span>&nbsp;<span class="ident" id="1813388">y</span>&nbsp;<span class="op" id="1813390">:=</span>&nbsp;<span class="ident" id="1813393">p</span><span class="op" id="1813394">.</span><span class="ident" id="1813395">Rect</span><span class="op" id="1813399">.</span><span class="ident" id="1813400">Min</span><span class="op" id="1813403">.</span><span class="ident" id="1813404">Y</span><span class="op" id="1813405">;</span>&nbsp;<span class="ident" id="1813407">y</span>&nbsp;<span class="op" id="1813409">&lt;</span>&nbsp;<span class="ident" id="1813411">p</span><span class="op" id="1813412">.</span><span class="ident" id="1813413">Rect</span><span class="op" id="1813417">.</span><span class="ident" id="1813418">Max</span><span class="op" id="1813421">.</span><span class="ident" id="1813422">Y</span><span class="op" id="1813423">;</span>&nbsp;<span class="ident" id="1813425">y</span><span class="op" id="1813426">++</span>&nbsp;<span class="op" id="1813429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813433">for</span>&nbsp;<span class="ident" id="1813437">_</span><span class="op" id="1813438">,</span>&nbsp;<span class="ident" id="1813440">c</span>&nbsp;<span class="op" id="1813442">:=</span>&nbsp;<span class="keyword" id="1813445">range</span>&nbsp;<span class="ident" id="1813451">p</span><span class="op" id="1813452">.</span><span class="ident" id="1813453">Pix</span><span class="op" id="1813456">[</span><span class="ident" id="1813457">i0</span><span class="op" id="1813459">:</span><span class="ident" id="1813460">i1</span><span class="op" id="1813462">]</span>&nbsp;<span class="op" id="1813464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813469">present</span><span class="op" id="1813476">[</span><span class="ident" id="1813477">c</span><span class="op" id="1813478">]</span>&nbsp;<span class="op" id="1813480">=</span>&nbsp;<span class="builtintype" id="1813482">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813493">i0</span>&nbsp;<span class="op" id="1813496">+=</span>&nbsp;<span class="ident" id="1813499">p</span><span class="op" id="1813500">.</span><span class="ident" id="1813501">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813510">i1</span>&nbsp;<span class="op" id="1813513">+=</span>&nbsp;<span class="ident" id="1813516">p</span><span class="op" id="1813517">.</span><span class="ident" id="1813518">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813529">for</span>&nbsp;<span class="ident" id="1813533">i</span><span class="op" id="1813534">,</span>&nbsp;<span class="ident" id="1813536">c</span>&nbsp;<span class="op" id="1813538">:=</span>&nbsp;<span class="keyword" id="1813541">range</span>&nbsp;<span class="ident" id="1813547">p</span><span class="op" id="1813548">.</span><span class="ident" id="1813549">Palette</span>&nbsp;<span class="op" id="1813557">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813561">if</span>&nbsp;<span class="op" id="1813564">!</span><span class="ident" id="1813565">present</span><span class="op" id="1813572">[</span><span class="ident" id="1813573">i</span><span class="op" id="1813574">]</span>&nbsp;<span class="op" id="1813576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813581">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813596">_</span><span class="op" id="1813597">,</span>&nbsp;<span class="ident" id="1813599">_</span><span class="op" id="1813600">,</span>&nbsp;<span class="ident" id="1813602">_</span><span class="op" id="1813603">,</span>&nbsp;<span class="ident" id="1813605">a</span>&nbsp;<span class="op" id="1813607">:=</span>&nbsp;<span class="ident" id="1813610">c</span><span class="op" id="1813611">.</span><span class="ident" id="1813612">RGBA</span><span class="op" id="1813616">(</span><span class="op" id="1813617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813621">if</span>&nbsp;<span class="ident" id="1813624">a</span>&nbsp;<span class="op" id="1813626">!=</span>&nbsp;<span class="num" id="1813629">0xffff</span>&nbsp;<span class="op" id="1813636">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813641">return</span>&nbsp;<span class="builtintype" id="1813648">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1813659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813662">return</span>&nbsp;<span class="builtintype" id="1813669">true</span><br>
<span class="lineno"></span><span class="op" id="1813674">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="1813677">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="1813757">func</span>&nbsp;<span class="ident" id="1813762">NewPaletted</span><span class="op" id="1813773">(</span><span class="ident" id="1813774">r</span>&nbsp;<span class="ident" id="1813776">Rectangle</span><span class="op" id="1813785">,</span>&nbsp;<span class="ident" id="1813787">p</span>&nbsp;<span class="ident" id="1813789">color</span><span class="op" id="1813794">.</span><span class="ident" id="1813795">Palette</span><span class="op" id="1813802">)</span>&nbsp;<span class="op" id="1813804">*</span><span class="ident" id="1813805">Paletted</span>&nbsp;<span class="op" id="1813814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813817">w</span><span class="op" id="1813818">,</span>&nbsp;<span class="ident" id="1813820">h</span>&nbsp;<span class="op" id="1813822">:=</span>&nbsp;<span class="ident" id="1813825">r</span><span class="op" id="1813826">.</span><span class="ident" id="1813827">Dx</span><span class="op" id="1813829">(</span><span class="op" id="1813830">)</span><span class="op" id="1813831">,</span>&nbsp;<span class="ident" id="1813833">r</span><span class="op" id="1813834">.</span><span class="ident" id="1813835">Dy</span><span class="op" id="1813837">(</span><span class="op" id="1813838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1813841">pix</span>&nbsp;<span class="op" id="1813845">:=</span>&nbsp;<span class="builtinfunc" id="1813848">make</span><span class="op" id="1813852">(</span><span class="op" id="1813853">[</span><span class="op" id="1813854">]</span><span class="builtintype" id="1813855">uint8</span><span class="op" id="1813860">,</span>&nbsp;<span class="num" id="1813862">1</span><span class="op" id="1813863">*</span><span class="ident" id="1813864">w</span><span class="op" id="1813865">*</span><span class="ident" id="1813866">h</span><span class="op" id="1813867">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1813870">return</span>&nbsp;<span class="op" id="1813877">&amp;</span><span class="ident" id="1813878">Paletted</span><span class="op" id="1813886">{</span><span class="ident" id="1813887">pix</span><span class="op" id="1813890">,</span>&nbsp;<span class="num" id="1813892">1</span>&nbsp;<span class="op" id="1813894">*</span>&nbsp;<span class="ident" id="1813896">w</span><span class="op" id="1813897">,</span>&nbsp;<span class="ident" id="1813899">r</span><span class="op" id="1813900">,</span>&nbsp;<span class="ident" id="1813902">p</span><span class="op" id="1813903">}</span><br>
<span class="lineno"></span><span class="op" id="1813905">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
