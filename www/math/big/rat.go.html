<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1857268">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1857323">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1857377">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1857428">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1857487">package</span>&nbsp;<span class="ident" id="1857495">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1857500">import</span>&nbsp;<span class="op" id="1857507">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857510">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857529">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857539">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857546">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857554">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="1857564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1857567">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="1857626">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1857678">type</span>&nbsp;<span class="ident" id="1857683">Rat</span>&nbsp;<span class="keyword" id="1857687">struct</span>&nbsp;<span class="op" id="1857694">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1857697">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1857754">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1857808">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857868">a</span><span class="op" id="1857869">,</span>&nbsp;<span class="ident" id="1857871">b</span>&nbsp;<span class="ident" id="1857873">Int</span><br>
<span class="lineno"></span><span class="op" id="1857877">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="1857880">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1857944">func</span>&nbsp;<span class="ident" id="1857949">NewRat</span><span class="op" id="1857955">(</span><span class="ident" id="1857956">a</span><span class="op" id="1857957">,</span>&nbsp;<span class="ident" id="1857959">b</span>&nbsp;<span class="ident" id="1857961">int64</span><span class="op" id="1857966">)</span>&nbsp;<span class="op" id="1857968">*</span><span class="ident" id="1857969">Rat</span>&nbsp;<span class="op" id="1857973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857976">return</span>&nbsp;<span class="builtinfunc" id="1857983">new</span><span class="op" id="1857986">(</span><span class="ident" id="1857987">Rat</span><span class="op" id="1857990">)</span><span class="op" id="1857991">.</span><span class="ident" id="1857992">SetFrac64</span><span class="op" id="1858001">(</span><span class="ident" id="1858002">a</span><span class="op" id="1858003">,</span>&nbsp;<span class="ident" id="1858005">b</span><span class="op" id="1858006">)</span><br>
<span class="lineno"></span><span class="op" id="1858008">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="1858011">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="1858060">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1858105">func</span>&nbsp;<span class="op" id="1858110">(</span><span class="ident" id="1858111">z</span>&nbsp;<span class="op" id="1858113">*</span><span class="ident" id="1858114">Rat</span><span class="op" id="1858117">)</span>&nbsp;<span class="ident" id="1858119">SetFloat64</span><span class="op" id="1858129">(</span><span class="ident" id="1858130">f</span>&nbsp;<span class="builtintype" id="1858132">float64</span><span class="op" id="1858139">)</span>&nbsp;<span class="op" id="1858141">*</span><span class="ident" id="1858142">Rat</span>&nbsp;<span class="op" id="1858146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858149">const</span>&nbsp;<span class="ident" id="1858155">expMask</span>&nbsp;<span class="op" id="1858163">=</span>&nbsp;<span class="num" id="1858165">1</span><span class="op" id="1858166">&lt;&lt;</span><span class="num" id="1858168">11</span>&nbsp;<span class="op" id="1858171">-</span>&nbsp;<span class="num" id="1858173">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858176">bits</span>&nbsp;<span class="op" id="1858181">:=</span>&nbsp;<span class="ident" id="1858184">math</span><span class="op" id="1858188">.</span><span class="ident" id="1858189">Float64bits</span><span class="op" id="1858200">(</span><span class="ident" id="1858201">f</span><span class="op" id="1858202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858205">mantissa</span>&nbsp;<span class="op" id="1858214">:=</span>&nbsp;<span class="ident" id="1858217">bits</span>&nbsp;<span class="op" id="1858222">&amp;</span>&nbsp;<span class="op" id="1858224">(</span><span class="num" id="1858225">1</span><span class="op" id="1858226">&lt;&lt;</span><span class="num" id="1858228">52</span>&nbsp;<span class="op" id="1858231">-</span>&nbsp;<span class="num" id="1858233">1</span><span class="op" id="1858234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858237">exp</span>&nbsp;<span class="op" id="1858241">:=</span>&nbsp;<span class="builtintype" id="1858244">int</span><span class="op" id="1858247">(</span><span class="op" id="1858248">(</span><span class="ident" id="1858249">bits</span>&nbsp;<span class="op" id="1858254">&gt;&gt;</span>&nbsp;<span class="num" id="1858257">52</span><span class="op" id="1858259">)</span>&nbsp;<span class="op" id="1858261">&amp;</span>&nbsp;<span class="ident" id="1858263">expMask</span><span class="op" id="1858270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858273">switch</span>&nbsp;<span class="ident" id="1858280">exp</span>&nbsp;<span class="op" id="1858284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858287">case</span>&nbsp;<span class="ident" id="1858292">expMask</span><span class="op" id="1858299">:</span>&nbsp;<span class="comment" id="1858301">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858317">return</span>&nbsp;<span class="ident" id="1858324">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858329">case</span>&nbsp;<span class="num" id="1858334">0</span><span class="op" id="1858335">:</span>&nbsp;<span class="comment" id="1858337">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858351">exp</span>&nbsp;<span class="op" id="1858355">-=</span>&nbsp;<span class="num" id="1858358">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858364">default</span><span class="op" id="1858371">:</span>&nbsp;<span class="comment" id="1858373">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858385">mantissa</span>&nbsp;<span class="op" id="1858394">|=</span>&nbsp;<span class="num" id="1858397">1</span>&nbsp;<span class="op" id="1858399">&lt;&lt;</span>&nbsp;<span class="num" id="1858402">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858407">exp</span>&nbsp;<span class="op" id="1858411">-=</span>&nbsp;<span class="num" id="1858414">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1858420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858424">shift</span>&nbsp;<span class="op" id="1858430">:=</span>&nbsp;<span class="num" id="1858433">52</span>&nbsp;<span class="op" id="1858436">-</span>&nbsp;<span class="ident" id="1858438">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1858444">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858491">for</span>&nbsp;<span class="ident" id="1858495">mantissa</span><span class="op" id="1858503">&amp;</span><span class="num" id="1858504">1</span>&nbsp;<span class="op" id="1858506">==</span>&nbsp;<span class="num" id="1858509">0</span>&nbsp;<span class="op" id="1858511">&amp;&amp;</span>&nbsp;<span class="ident" id="1858514">shift</span>&nbsp;<span class="op" id="1858520">&gt;</span>&nbsp;<span class="num" id="1858522">0</span>&nbsp;<span class="op" id="1858524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858528">mantissa</span>&nbsp;<span class="op" id="1858537">&gt;&gt;=</span>&nbsp;<span class="num" id="1858541">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858545">shift</span><span class="op" id="1858550">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1858554">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858558">z</span><span class="op" id="1858559">.</span><span class="ident" id="1858560">a</span><span class="op" id="1858561">.</span><span class="ident" id="1858562">SetUint64</span><span class="op" id="1858571">(</span><span class="ident" id="1858572">mantissa</span><span class="op" id="1858580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858583">z</span><span class="op" id="1858584">.</span><span class="ident" id="1858585">a</span><span class="op" id="1858586">.</span><span class="ident" id="1858587">neg</span>&nbsp;<span class="op" id="1858591">=</span>&nbsp;<span class="ident" id="1858593">f</span>&nbsp;<span class="op" id="1858595">&lt;</span>&nbsp;<span class="num" id="1858597">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858600">z</span><span class="op" id="1858601">.</span><span class="ident" id="1858602">b</span><span class="op" id="1858603">.</span><span class="ident" id="1858604">Set</span><span class="op" id="1858607">(</span><span class="ident" id="1858608">intOne</span><span class="op" id="1858614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858617">if</span>&nbsp;<span class="ident" id="1858620">shift</span>&nbsp;<span class="op" id="1858626">&gt;</span>&nbsp;<span class="num" id="1858628">0</span>&nbsp;<span class="op" id="1858630">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858634">z</span><span class="op" id="1858635">.</span><span class="ident" id="1858636">b</span><span class="op" id="1858637">.</span><span class="ident" id="1858638">Lsh</span><span class="op" id="1858641">(</span><span class="op" id="1858642">&amp;</span><span class="ident" id="1858643">z</span><span class="op" id="1858644">.</span><span class="ident" id="1858645">b</span><span class="op" id="1858646">,</span>&nbsp;<span class="builtintype" id="1858648">uint</span><span class="op" id="1858652">(</span><span class="ident" id="1858653">shift</span><span class="op" id="1858658">)</span><span class="op" id="1858659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1858662">}</span>&nbsp;<span class="keyword" id="1858664">else</span>&nbsp;<span class="op" id="1858669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858673">z</span><span class="op" id="1858674">.</span><span class="ident" id="1858675">a</span><span class="op" id="1858676">.</span><span class="ident" id="1858677">Lsh</span><span class="op" id="1858680">(</span><span class="op" id="1858681">&amp;</span><span class="ident" id="1858682">z</span><span class="op" id="1858683">.</span><span class="ident" id="1858684">a</span><span class="op" id="1858685">,</span>&nbsp;<span class="builtintype" id="1858687">uint</span><span class="op" id="1858691">(</span><span class="op" id="1858692">-</span><span class="ident" id="1858693">shift</span><span class="op" id="1858698">)</span><span class="op" id="1858699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1858702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1858705">return</span>&nbsp;<span class="ident" id="1858712">z</span><span class="op" id="1858713">.</span><span class="ident" id="1858714">norm</span><span class="op" id="1858718">(</span><span class="op" id="1858719">)</span><br>
<span class="lineno">65</span><span class="op" id="1858721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858724">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="1858780">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1858835">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="1858888">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="1858953">func</span>&nbsp;<span class="ident" id="1858958">quotToFloat32</span><span class="op" id="1858971">(</span><span class="ident" id="1858972">a</span><span class="op" id="1858973">,</span>&nbsp;<span class="ident" id="1858975">b</span>&nbsp;<span class="ident" id="1858977">nat</span><span class="op" id="1858980">)</span>&nbsp;<span class="op" id="1858982">(</span><span class="ident" id="1858983">f</span>&nbsp;<span class="builtintype" id="1858985">float32</span><span class="op" id="1858992">,</span>&nbsp;<span class="ident" id="1858994">exact</span>&nbsp;<span class="builtintype" id="1859000">bool</span><span class="op" id="1859004">)</span>&nbsp;<span class="op" id="1859006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859009">const</span>&nbsp;<span class="op" id="1859015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859019">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859043">Fsize</span>&nbsp;<span class="op" id="1859049">=</span>&nbsp;<span class="num" id="1859051">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859057">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859071">Msize</span>&nbsp;&nbsp;<span class="op" id="1859078">=</span>&nbsp;<span class="num" id="1859080">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859085">Msize1</span>&nbsp;<span class="op" id="1859092">=</span>&nbsp;<span class="ident" id="1859094">Msize</span>&nbsp;<span class="op" id="1859100">+</span>&nbsp;<span class="num" id="1859102">1</span>&nbsp;<span class="comment" id="1859104">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859126">Msize2</span>&nbsp;<span class="op" id="1859133">=</span>&nbsp;<span class="ident" id="1859135">Msize1</span>&nbsp;<span class="op" id="1859142">+</span>&nbsp;<span class="num" id="1859144">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859149">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859163">Esize</span>&nbsp;<span class="op" id="1859169">=</span>&nbsp;<span class="ident" id="1859171">Fsize</span>&nbsp;<span class="op" id="1859177">-</span>&nbsp;<span class="ident" id="1859179">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859188">Ebias</span>&nbsp;<span class="op" id="1859194">=</span>&nbsp;<span class="num" id="1859196">1</span><span class="op" id="1859197">&lt;&lt;</span><span class="op" id="1859199">(</span><span class="ident" id="1859200">Esize</span><span class="op" id="1859205">-</span><span class="num" id="1859206">1</span><span class="op" id="1859207">)</span>&nbsp;<span class="op" id="1859209">-</span>&nbsp;<span class="num" id="1859211">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859215">Emin</span>&nbsp;&nbsp;<span class="op" id="1859221">=</span>&nbsp;<span class="num" id="1859223">1</span>&nbsp;<span class="op" id="1859225">-</span>&nbsp;<span class="ident" id="1859227">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859235">Emax</span>&nbsp;&nbsp;<span class="op" id="1859241">=</span>&nbsp;<span class="ident" id="1859243">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1859250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859254">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859325">alen</span>&nbsp;<span class="op" id="1859330">:=</span>&nbsp;<span class="ident" id="1859333">a</span><span class="op" id="1859334">.</span><span class="ident" id="1859335">bitLen</span><span class="op" id="1859341">(</span><span class="op" id="1859342">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859345">if</span>&nbsp;<span class="ident" id="1859348">alen</span>&nbsp;<span class="op" id="1859353">==</span>&nbsp;<span class="num" id="1859356">0</span>&nbsp;<span class="op" id="1859358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859362">return</span>&nbsp;<span class="num" id="1859369">0</span><span class="op" id="1859370">,</span>&nbsp;<span class="ident" id="1859372">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1859378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859381">blen</span>&nbsp;<span class="op" id="1859386">:=</span>&nbsp;<span class="ident" id="1859389">b</span><span class="op" id="1859390">.</span><span class="ident" id="1859391">bitLen</span><span class="op" id="1859397">(</span><span class="op" id="1859398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859401">if</span>&nbsp;<span class="ident" id="1859404">blen</span>&nbsp;<span class="op" id="1859409">==</span>&nbsp;<span class="num" id="1859412">0</span>&nbsp;<span class="op" id="1859414">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1859418">panic</span><span class="op" id="1859423">(</span><span class="string" id="1859424">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1859442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1859445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859449">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859529">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859609">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859681">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859743">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1859805">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859872">exp</span>&nbsp;<span class="op" id="1859876">:=</span>&nbsp;<span class="ident" id="1859879">alen</span>&nbsp;<span class="op" id="1859884">-</span>&nbsp;<span class="ident" id="1859886">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859892">var</span>&nbsp;<span class="ident" id="1859896">a2</span><span class="op" id="1859898">,</span>&nbsp;<span class="ident" id="1859900">b2</span>&nbsp;<span class="ident" id="1859903">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859908">a2</span>&nbsp;<span class="op" id="1859911">=</span>&nbsp;<span class="ident" id="1859913">a2</span><span class="op" id="1859915">.</span><span class="ident" id="1859916">set</span><span class="op" id="1859919">(</span><span class="ident" id="1859920">a</span><span class="op" id="1859921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859924">b2</span>&nbsp;<span class="op" id="1859927">=</span>&nbsp;<span class="ident" id="1859929">b2</span><span class="op" id="1859931">.</span><span class="ident" id="1859932">set</span><span class="op" id="1859935">(</span><span class="ident" id="1859936">b</span><span class="op" id="1859937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859940">if</span>&nbsp;<span class="ident" id="1859943">shift</span>&nbsp;<span class="op" id="1859949">:=</span>&nbsp;<span class="ident" id="1859952">Msize2</span>&nbsp;<span class="op" id="1859959">-</span>&nbsp;<span class="ident" id="1859961">exp</span><span class="op" id="1859964">;</span>&nbsp;<span class="ident" id="1859966">shift</span>&nbsp;<span class="op" id="1859972">&gt;</span>&nbsp;<span class="num" id="1859974">0</span>&nbsp;<span class="op" id="1859976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1859980">a2</span>&nbsp;<span class="op" id="1859983">=</span>&nbsp;<span class="ident" id="1859985">a2</span><span class="op" id="1859987">.</span><span class="ident" id="1859988">shl</span><span class="op" id="1859991">(</span><span class="ident" id="1859992">a2</span><span class="op" id="1859994">,</span>&nbsp;<span class="builtintype" id="1859996">uint</span><span class="op" id="1860000">(</span><span class="ident" id="1860001">shift</span><span class="op" id="1860006">)</span><span class="op" id="1860007">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860010">}</span>&nbsp;<span class="keyword" id="1860012">else</span>&nbsp;<span class="keyword" id="1860017">if</span>&nbsp;<span class="ident" id="1860020">shift</span>&nbsp;<span class="op" id="1860026">&lt;</span>&nbsp;<span class="num" id="1860028">0</span>&nbsp;<span class="op" id="1860030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860034">b2</span>&nbsp;<span class="op" id="1860037">=</span>&nbsp;<span class="ident" id="1860039">b2</span><span class="op" id="1860041">.</span><span class="ident" id="1860042">shl</span><span class="op" id="1860045">(</span><span class="ident" id="1860046">b2</span><span class="op" id="1860048">,</span>&nbsp;<span class="builtintype" id="1860050">uint</span><span class="op" id="1860054">(</span><span class="op" id="1860055">-</span><span class="ident" id="1860056">shift</span><span class="op" id="1860061">)</span><span class="op" id="1860062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860069">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860131">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860188">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860213">var</span>&nbsp;<span class="ident" id="1860217">q</span>&nbsp;<span class="ident" id="1860219">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860224">q</span><span class="op" id="1860225">,</span>&nbsp;<span class="ident" id="1860227">r</span>&nbsp;<span class="op" id="1860229">:=</span>&nbsp;<span class="ident" id="1860232">q</span><span class="op" id="1860233">.</span><span class="ident" id="1860234">div</span><span class="op" id="1860237">(</span><span class="ident" id="1860238">a2</span><span class="op" id="1860240">,</span>&nbsp;<span class="ident" id="1860242">a2</span><span class="op" id="1860244">,</span>&nbsp;<span class="ident" id="1860246">b2</span><span class="op" id="1860248">)</span>&nbsp;<span class="comment" id="1860250">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860267">mantissa</span>&nbsp;<span class="op" id="1860276">:=</span>&nbsp;<span class="ident" id="1860279">low32</span><span class="op" id="1860284">(</span><span class="ident" id="1860285">q</span><span class="op" id="1860286">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860289">haveRem</span>&nbsp;<span class="op" id="1860297">:=</span>&nbsp;<span class="builtinfunc" id="1860300">len</span><span class="op" id="1860303">(</span><span class="ident" id="1860304">r</span><span class="op" id="1860305">)</span>&nbsp;<span class="op" id="1860307">&gt;</span>&nbsp;<span class="num" id="1860309">0</span>&nbsp;<span class="comment" id="1860311">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860368">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860437">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860489">if</span>&nbsp;<span class="ident" id="1860492">mantissa</span><span class="op" id="1860500">&gt;&gt;</span><span class="ident" id="1860502">Msize2</span>&nbsp;<span class="op" id="1860509">==</span>&nbsp;<span class="num" id="1860512">1</span>&nbsp;<span class="op" id="1860514">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860518">if</span>&nbsp;<span class="ident" id="1860521">mantissa</span><span class="op" id="1860529">&amp;</span><span class="num" id="1860530">1</span>&nbsp;<span class="op" id="1860532">==</span>&nbsp;<span class="num" id="1860535">1</span>&nbsp;<span class="op" id="1860537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860542">haveRem</span>&nbsp;<span class="op" id="1860550">=</span>&nbsp;<span class="ident" id="1860552">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860563">mantissa</span>&nbsp;<span class="op" id="1860572">&gt;&gt;=</span>&nbsp;<span class="num" id="1860576">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860580">exp</span><span class="op" id="1860583">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860590">if</span>&nbsp;<span class="ident" id="1860593">mantissa</span><span class="op" id="1860601">&gt;&gt;</span><span class="ident" id="1860603">Msize1</span>&nbsp;<span class="op" id="1860610">!=</span>&nbsp;<span class="num" id="1860613">1</span>&nbsp;<span class="op" id="1860615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1860619">panic</span><span class="op" id="1860624">(</span><span class="ident" id="1860625">fmt</span><span class="op" id="1860628">.</span><span class="ident" id="1860629">Sprintf</span><span class="op" id="1860636">(</span><span class="string" id="1860637">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="1860673">,</span>&nbsp;<span class="ident" id="1860675">Msize2</span><span class="op" id="1860681">)</span><span class="op" id="1860682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860689">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860706">if</span>&nbsp;<span class="ident" id="1860709">Emin</span><span class="op" id="1860713">-</span><span class="ident" id="1860714">Msize</span>&nbsp;<span class="op" id="1860720">&lt;=</span>&nbsp;<span class="ident" id="1860723">exp</span>&nbsp;<span class="op" id="1860727">&amp;&amp;</span>&nbsp;<span class="ident" id="1860730">exp</span>&nbsp;<span class="op" id="1860734">&lt;=</span>&nbsp;<span class="ident" id="1860737">Emin</span>&nbsp;<span class="op" id="1860742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860746">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860798">shift</span>&nbsp;<span class="op" id="1860804">:=</span>&nbsp;<span class="builtintype" id="1860807">uint</span><span class="op" id="1860811">(</span><span class="ident" id="1860812">Emin</span>&nbsp;<span class="op" id="1860817">-</span>&nbsp;<span class="op" id="1860819">(</span><span class="ident" id="1860820">exp</span>&nbsp;<span class="op" id="1860824">-</span>&nbsp;<span class="num" id="1860826">1</span><span class="op" id="1860827">)</span><span class="op" id="1860828">)</span>&nbsp;<span class="comment" id="1860830">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860847">lostbits</span>&nbsp;<span class="op" id="1860856">:=</span>&nbsp;<span class="ident" id="1860859">mantissa</span>&nbsp;<span class="op" id="1860868">&amp;</span>&nbsp;<span class="op" id="1860870">(</span><span class="num" id="1860871">1</span><span class="op" id="1860872">&lt;&lt;</span><span class="ident" id="1860874">shift</span>&nbsp;<span class="op" id="1860880">-</span>&nbsp;<span class="num" id="1860882">1</span><span class="op" id="1860883">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860887">haveRem</span>&nbsp;<span class="op" id="1860895">=</span>&nbsp;<span class="ident" id="1860897">haveRem</span>&nbsp;<span class="op" id="1860905">||</span>&nbsp;<span class="ident" id="1860908">lostbits</span>&nbsp;<span class="op" id="1860917">!=</span>&nbsp;<span class="num" id="1860920">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860924">mantissa</span>&nbsp;<span class="op" id="1860933">&gt;&gt;=</span>&nbsp;<span class="ident" id="1860937">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860945">exp</span>&nbsp;<span class="op" id="1860949">=</span>&nbsp;<span class="num" id="1860951">2</span>&nbsp;<span class="op" id="1860953">-</span>&nbsp;<span class="ident" id="1860955">Ebias</span>&nbsp;<span class="comment" id="1860961">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860983">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861021">exact</span>&nbsp;<span class="op" id="1861027">=</span>&nbsp;<span class="op" id="1861029">!</span><span class="ident" id="1861030">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861039">if</span>&nbsp;<span class="ident" id="1861042">mantissa</span><span class="op" id="1861050">&amp;</span><span class="num" id="1861051">1</span>&nbsp;<span class="op" id="1861053">!=</span>&nbsp;<span class="num" id="1861056">0</span>&nbsp;<span class="op" id="1861058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861062">exact</span>&nbsp;<span class="op" id="1861068">=</span>&nbsp;<span class="ident" id="1861070">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861078">if</span>&nbsp;<span class="ident" id="1861081">haveRem</span>&nbsp;<span class="op" id="1861089">||</span>&nbsp;<span class="ident" id="1861092">mantissa</span><span class="op" id="1861100">&amp;</span><span class="num" id="1861101">2</span>&nbsp;<span class="op" id="1861103">!=</span>&nbsp;<span class="num" id="1861106">0</span>&nbsp;<span class="op" id="1861108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861113">if</span>&nbsp;<span class="ident" id="1861116">mantissa</span><span class="op" id="1861124">++</span><span class="op" id="1861126">;</span>&nbsp;<span class="ident" id="1861128">mantissa</span>&nbsp;<span class="op" id="1861137">&gt;=</span>&nbsp;<span class="num" id="1861140">1</span><span class="op" id="1861141">&lt;&lt;</span><span class="ident" id="1861143">Msize2</span>&nbsp;<span class="op" id="1861150">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1861156">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861217">mantissa</span>&nbsp;<span class="op" id="1861226">&gt;&gt;=</span>&nbsp;<span class="num" id="1861230">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861236">exp</span><span class="op" id="1861239">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861249">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861255">mantissa</span>&nbsp;<span class="op" id="1861264">&gt;&gt;=</span>&nbsp;<span class="num" id="1861268">1</span>&nbsp;<span class="comment" id="1861270">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861332">f</span>&nbsp;<span class="op" id="1861334">=</span>&nbsp;<span class="builtintype" id="1861336">float32</span><span class="op" id="1861343">(</span><span class="ident" id="1861344">math</span><span class="op" id="1861348">.</span><span class="ident" id="1861349">Ldexp</span><span class="op" id="1861354">(</span><span class="builtintype" id="1861355">float64</span><span class="op" id="1861362">(</span><span class="ident" id="1861363">mantissa</span><span class="op" id="1861371">)</span><span class="op" id="1861372">,</span>&nbsp;<span class="ident" id="1861374">exp</span><span class="op" id="1861377">-</span><span class="ident" id="1861378">Msize1</span><span class="op" id="1861384">)</span><span class="op" id="1861385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861388">if</span>&nbsp;<span class="ident" id="1861391">math</span><span class="op" id="1861395">.</span><span class="ident" id="1861396">IsInf</span><span class="op" id="1861401">(</span><span class="builtintype" id="1861402">float64</span><span class="op" id="1861409">(</span><span class="ident" id="1861410">f</span><span class="op" id="1861411">)</span><span class="op" id="1861412">,</span>&nbsp;<span class="num" id="1861414">0</span><span class="op" id="1861415">)</span>&nbsp;<span class="op" id="1861417">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861421">exact</span>&nbsp;<span class="op" id="1861427">=</span>&nbsp;<span class="ident" id="1861429">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861439">return</span><br>
<span class="lineno"></span><span class="op" id="1861446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="1861449">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="1861505">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1861560">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1861613">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="1861678">func</span>&nbsp;<span class="ident" id="1861683">quotToFloat64</span><span class="op" id="1861696">(</span><span class="ident" id="1861697">a</span><span class="op" id="1861698">,</span>&nbsp;<span class="ident" id="1861700">b</span>&nbsp;<span class="ident" id="1861702">nat</span><span class="op" id="1861705">)</span>&nbsp;<span class="op" id="1861707">(</span><span class="ident" id="1861708">f</span>&nbsp;<span class="builtintype" id="1861710">float64</span><span class="op" id="1861717">,</span>&nbsp;<span class="ident" id="1861719">exact</span>&nbsp;<span class="builtintype" id="1861725">bool</span><span class="op" id="1861729">)</span>&nbsp;<span class="op" id="1861731">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861734">const</span>&nbsp;<span class="op" id="1861740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1861744">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861768">Fsize</span>&nbsp;<span class="op" id="1861774">=</span>&nbsp;<span class="num" id="1861776">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1861782">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861796">Msize</span>&nbsp;&nbsp;<span class="op" id="1861803">=</span>&nbsp;<span class="num" id="1861805">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861810">Msize1</span>&nbsp;<span class="op" id="1861817">=</span>&nbsp;<span class="ident" id="1861819">Msize</span>&nbsp;<span class="op" id="1861825">+</span>&nbsp;<span class="num" id="1861827">1</span>&nbsp;<span class="comment" id="1861829">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861851">Msize2</span>&nbsp;<span class="op" id="1861858">=</span>&nbsp;<span class="ident" id="1861860">Msize1</span>&nbsp;<span class="op" id="1861867">+</span>&nbsp;<span class="num" id="1861869">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1861874">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861888">Esize</span>&nbsp;<span class="op" id="1861894">=</span>&nbsp;<span class="ident" id="1861896">Fsize</span>&nbsp;<span class="op" id="1861902">-</span>&nbsp;<span class="ident" id="1861904">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861913">Ebias</span>&nbsp;<span class="op" id="1861919">=</span>&nbsp;<span class="num" id="1861921">1</span><span class="op" id="1861922">&lt;&lt;</span><span class="op" id="1861924">(</span><span class="ident" id="1861925">Esize</span><span class="op" id="1861930">-</span><span class="num" id="1861931">1</span><span class="op" id="1861932">)</span>&nbsp;<span class="op" id="1861934">-</span>&nbsp;<span class="num" id="1861936">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861940">Emin</span>&nbsp;&nbsp;<span class="op" id="1861946">=</span>&nbsp;<span class="num" id="1861948">1</span>&nbsp;<span class="op" id="1861950">-</span>&nbsp;<span class="ident" id="1861952">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861960">Emax</span>&nbsp;&nbsp;<span class="op" id="1861966">=</span>&nbsp;<span class="ident" id="1861968">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861975">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1861979">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862050">alen</span>&nbsp;<span class="op" id="1862055">:=</span>&nbsp;<span class="ident" id="1862058">a</span><span class="op" id="1862059">.</span><span class="ident" id="1862060">bitLen</span><span class="op" id="1862066">(</span><span class="op" id="1862067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862070">if</span>&nbsp;<span class="ident" id="1862073">alen</span>&nbsp;<span class="op" id="1862078">==</span>&nbsp;<span class="num" id="1862081">0</span>&nbsp;<span class="op" id="1862083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862087">return</span>&nbsp;<span class="num" id="1862094">0</span><span class="op" id="1862095">,</span>&nbsp;<span class="ident" id="1862097">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862106">blen</span>&nbsp;<span class="op" id="1862111">:=</span>&nbsp;<span class="ident" id="1862114">b</span><span class="op" id="1862115">.</span><span class="ident" id="1862116">bitLen</span><span class="op" id="1862122">(</span><span class="op" id="1862123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862126">if</span>&nbsp;<span class="ident" id="1862129">blen</span>&nbsp;<span class="op" id="1862134">==</span>&nbsp;<span class="num" id="1862137">0</span>&nbsp;<span class="op" id="1862139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1862143">panic</span><span class="op" id="1862148">(</span><span class="string" id="1862149">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1862167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862170">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862174">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862254">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862334">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862406">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862468">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862530">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862597">exp</span>&nbsp;<span class="op" id="1862601">:=</span>&nbsp;<span class="ident" id="1862604">alen</span>&nbsp;<span class="op" id="1862609">-</span>&nbsp;<span class="ident" id="1862611">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862617">var</span>&nbsp;<span class="ident" id="1862621">a2</span><span class="op" id="1862623">,</span>&nbsp;<span class="ident" id="1862625">b2</span>&nbsp;<span class="ident" id="1862628">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862633">a2</span>&nbsp;<span class="op" id="1862636">=</span>&nbsp;<span class="ident" id="1862638">a2</span><span class="op" id="1862640">.</span><span class="ident" id="1862641">set</span><span class="op" id="1862644">(</span><span class="ident" id="1862645">a</span><span class="op" id="1862646">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862649">b2</span>&nbsp;<span class="op" id="1862652">=</span>&nbsp;<span class="ident" id="1862654">b2</span><span class="op" id="1862656">.</span><span class="ident" id="1862657">set</span><span class="op" id="1862660">(</span><span class="ident" id="1862661">b</span><span class="op" id="1862662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862665">if</span>&nbsp;<span class="ident" id="1862668">shift</span>&nbsp;<span class="op" id="1862674">:=</span>&nbsp;<span class="ident" id="1862677">Msize2</span>&nbsp;<span class="op" id="1862684">-</span>&nbsp;<span class="ident" id="1862686">exp</span><span class="op" id="1862689">;</span>&nbsp;<span class="ident" id="1862691">shift</span>&nbsp;<span class="op" id="1862697">&gt;</span>&nbsp;<span class="num" id="1862699">0</span>&nbsp;<span class="op" id="1862701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862705">a2</span>&nbsp;<span class="op" id="1862708">=</span>&nbsp;<span class="ident" id="1862710">a2</span><span class="op" id="1862712">.</span><span class="ident" id="1862713">shl</span><span class="op" id="1862716">(</span><span class="ident" id="1862717">a2</span><span class="op" id="1862719">,</span>&nbsp;<span class="builtintype" id="1862721">uint</span><span class="op" id="1862725">(</span><span class="ident" id="1862726">shift</span><span class="op" id="1862731">)</span><span class="op" id="1862732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862735">}</span>&nbsp;<span class="keyword" id="1862737">else</span>&nbsp;<span class="keyword" id="1862742">if</span>&nbsp;<span class="ident" id="1862745">shift</span>&nbsp;<span class="op" id="1862751">&lt;</span>&nbsp;<span class="num" id="1862753">0</span>&nbsp;<span class="op" id="1862755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862759">b2</span>&nbsp;<span class="op" id="1862762">=</span>&nbsp;<span class="ident" id="1862764">b2</span><span class="op" id="1862766">.</span><span class="ident" id="1862767">shl</span><span class="op" id="1862770">(</span><span class="ident" id="1862771">b2</span><span class="op" id="1862773">,</span>&nbsp;<span class="builtintype" id="1862775">uint</span><span class="op" id="1862779">(</span><span class="op" id="1862780">-</span><span class="ident" id="1862781">shift</span><span class="op" id="1862786">)</span><span class="op" id="1862787">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862794">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862856">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1862913">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862938">var</span>&nbsp;<span class="ident" id="1862942">q</span>&nbsp;<span class="ident" id="1862944">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862949">q</span><span class="op" id="1862950">,</span>&nbsp;<span class="ident" id="1862952">r</span>&nbsp;<span class="op" id="1862954">:=</span>&nbsp;<span class="ident" id="1862957">q</span><span class="op" id="1862958">.</span><span class="ident" id="1862959">div</span><span class="op" id="1862962">(</span><span class="ident" id="1862963">a2</span><span class="op" id="1862965">,</span>&nbsp;<span class="ident" id="1862967">a2</span><span class="op" id="1862969">,</span>&nbsp;<span class="ident" id="1862971">b2</span><span class="op" id="1862973">)</span>&nbsp;<span class="comment" id="1862975">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862992">mantissa</span>&nbsp;<span class="op" id="1863001">:=</span>&nbsp;<span class="ident" id="1863004">low64</span><span class="op" id="1863009">(</span><span class="ident" id="1863010">q</span><span class="op" id="1863011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863014">haveRem</span>&nbsp;<span class="op" id="1863022">:=</span>&nbsp;<span class="builtinfunc" id="1863025">len</span><span class="op" id="1863028">(</span><span class="ident" id="1863029">r</span><span class="op" id="1863030">)</span>&nbsp;<span class="op" id="1863032">&gt;</span>&nbsp;<span class="num" id="1863034">0</span>&nbsp;<span class="comment" id="1863036">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863093">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863162">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863214">if</span>&nbsp;<span class="ident" id="1863217">mantissa</span><span class="op" id="1863225">&gt;&gt;</span><span class="ident" id="1863227">Msize2</span>&nbsp;<span class="op" id="1863234">==</span>&nbsp;<span class="num" id="1863237">1</span>&nbsp;<span class="op" id="1863239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863243">if</span>&nbsp;<span class="ident" id="1863246">mantissa</span><span class="op" id="1863254">&amp;</span><span class="num" id="1863255">1</span>&nbsp;<span class="op" id="1863257">==</span>&nbsp;<span class="num" id="1863260">1</span>&nbsp;<span class="op" id="1863262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863267">haveRem</span>&nbsp;<span class="op" id="1863275">=</span>&nbsp;<span class="ident" id="1863277">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863288">mantissa</span>&nbsp;<span class="op" id="1863297">&gt;&gt;=</span>&nbsp;<span class="num" id="1863301">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863305">exp</span><span class="op" id="1863308">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863315">if</span>&nbsp;<span class="ident" id="1863318">mantissa</span><span class="op" id="1863326">&gt;&gt;</span><span class="ident" id="1863328">Msize1</span>&nbsp;<span class="op" id="1863335">!=</span>&nbsp;<span class="num" id="1863338">1</span>&nbsp;<span class="op" id="1863340">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1863344">panic</span><span class="op" id="1863349">(</span><span class="ident" id="1863350">fmt</span><span class="op" id="1863353">.</span><span class="ident" id="1863354">Sprintf</span><span class="op" id="1863361">(</span><span class="string" id="1863362">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="1863398">,</span>&nbsp;<span class="ident" id="1863400">Msize2</span><span class="op" id="1863406">)</span><span class="op" id="1863407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863414">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863431">if</span>&nbsp;<span class="ident" id="1863434">Emin</span><span class="op" id="1863438">-</span><span class="ident" id="1863439">Msize</span>&nbsp;<span class="op" id="1863445">&lt;=</span>&nbsp;<span class="ident" id="1863448">exp</span>&nbsp;<span class="op" id="1863452">&amp;&amp;</span>&nbsp;<span class="ident" id="1863455">exp</span>&nbsp;<span class="op" id="1863459">&lt;=</span>&nbsp;<span class="ident" id="1863462">Emin</span>&nbsp;<span class="op" id="1863467">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863471">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863523">shift</span>&nbsp;<span class="op" id="1863529">:=</span>&nbsp;<span class="builtintype" id="1863532">uint</span><span class="op" id="1863536">(</span><span class="ident" id="1863537">Emin</span>&nbsp;<span class="op" id="1863542">-</span>&nbsp;<span class="op" id="1863544">(</span><span class="ident" id="1863545">exp</span>&nbsp;<span class="op" id="1863549">-</span>&nbsp;<span class="num" id="1863551">1</span><span class="op" id="1863552">)</span><span class="op" id="1863553">)</span>&nbsp;<span class="comment" id="1863555">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863572">lostbits</span>&nbsp;<span class="op" id="1863581">:=</span>&nbsp;<span class="ident" id="1863584">mantissa</span>&nbsp;<span class="op" id="1863593">&amp;</span>&nbsp;<span class="op" id="1863595">(</span><span class="num" id="1863596">1</span><span class="op" id="1863597">&lt;&lt;</span><span class="ident" id="1863599">shift</span>&nbsp;<span class="op" id="1863605">-</span>&nbsp;<span class="num" id="1863607">1</span><span class="op" id="1863608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863612">haveRem</span>&nbsp;<span class="op" id="1863620">=</span>&nbsp;<span class="ident" id="1863622">haveRem</span>&nbsp;<span class="op" id="1863630">||</span>&nbsp;<span class="ident" id="1863633">lostbits</span>&nbsp;<span class="op" id="1863642">!=</span>&nbsp;<span class="num" id="1863645">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863649">mantissa</span>&nbsp;<span class="op" id="1863658">&gt;&gt;=</span>&nbsp;<span class="ident" id="1863662">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863670">exp</span>&nbsp;<span class="op" id="1863674">=</span>&nbsp;<span class="num" id="1863676">2</span>&nbsp;<span class="op" id="1863678">-</span>&nbsp;<span class="ident" id="1863680">Ebias</span>&nbsp;<span class="comment" id="1863686">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863708">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863746">exact</span>&nbsp;<span class="op" id="1863752">=</span>&nbsp;<span class="op" id="1863754">!</span><span class="ident" id="1863755">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863764">if</span>&nbsp;<span class="ident" id="1863767">mantissa</span><span class="op" id="1863775">&amp;</span><span class="num" id="1863776">1</span>&nbsp;<span class="op" id="1863778">!=</span>&nbsp;<span class="num" id="1863781">0</span>&nbsp;<span class="op" id="1863783">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863787">exact</span>&nbsp;<span class="op" id="1863793">=</span>&nbsp;<span class="ident" id="1863795">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863803">if</span>&nbsp;<span class="ident" id="1863806">haveRem</span>&nbsp;<span class="op" id="1863814">||</span>&nbsp;<span class="ident" id="1863817">mantissa</span><span class="op" id="1863825">&amp;</span><span class="num" id="1863826">2</span>&nbsp;<span class="op" id="1863828">!=</span>&nbsp;<span class="num" id="1863831">0</span>&nbsp;<span class="op" id="1863833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863838">if</span>&nbsp;<span class="ident" id="1863841">mantissa</span><span class="op" id="1863849">++</span><span class="op" id="1863851">;</span>&nbsp;<span class="ident" id="1863853">mantissa</span>&nbsp;<span class="op" id="1863862">&gt;=</span>&nbsp;<span class="num" id="1863865">1</span><span class="op" id="1863866">&lt;&lt;</span><span class="ident" id="1863868">Msize2</span>&nbsp;<span class="op" id="1863875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1863881">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863942">mantissa</span>&nbsp;<span class="op" id="1863951">&gt;&gt;=</span>&nbsp;<span class="num" id="1863955">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863961">exp</span><span class="op" id="1863964">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863980">mantissa</span>&nbsp;<span class="op" id="1863989">&gt;&gt;=</span>&nbsp;<span class="num" id="1863993">1</span>&nbsp;<span class="comment" id="1863995">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864057">f</span>&nbsp;<span class="op" id="1864059">=</span>&nbsp;<span class="ident" id="1864061">math</span><span class="op" id="1864065">.</span><span class="ident" id="1864066">Ldexp</span><span class="op" id="1864071">(</span><span class="builtintype" id="1864072">float64</span><span class="op" id="1864079">(</span><span class="ident" id="1864080">mantissa</span><span class="op" id="1864088">)</span><span class="op" id="1864089">,</span>&nbsp;<span class="ident" id="1864091">exp</span><span class="op" id="1864094">-</span><span class="ident" id="1864095">Msize1</span><span class="op" id="1864101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864104">if</span>&nbsp;<span class="ident" id="1864107">math</span><span class="op" id="1864111">.</span><span class="ident" id="1864112">IsInf</span><span class="op" id="1864117">(</span><span class="ident" id="1864118">f</span><span class="op" id="1864119">,</span>&nbsp;<span class="num" id="1864121">0</span><span class="op" id="1864122">)</span>&nbsp;<span class="op" id="1864124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864128">exact</span>&nbsp;<span class="op" id="1864134">=</span>&nbsp;<span class="ident" id="1864136">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864143">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864146">return</span><br>
<span class="lineno"></span><span class="op" id="1864153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1864156">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="1864229">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="1864302">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1864371">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1864434">func</span>&nbsp;<span class="op" id="1864439">(</span><span class="ident" id="1864440">x</span>&nbsp;<span class="op" id="1864442">*</span><span class="ident" id="1864443">Rat</span><span class="op" id="1864446">)</span>&nbsp;<span class="ident" id="1864448">Float32</span><span class="op" id="1864455">(</span><span class="op" id="1864456">)</span>&nbsp;<span class="op" id="1864458">(</span><span class="ident" id="1864459">f</span>&nbsp;<span class="builtintype" id="1864461">float32</span><span class="op" id="1864468">,</span>&nbsp;<span class="ident" id="1864470">exact</span>&nbsp;<span class="builtintype" id="1864476">bool</span><span class="op" id="1864480">)</span>&nbsp;<span class="op" id="1864482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864485">b</span>&nbsp;<span class="op" id="1864487">:=</span>&nbsp;<span class="ident" id="1864490">x</span><span class="op" id="1864491">.</span><span class="ident" id="1864492">b</span><span class="op" id="1864493">.</span><span class="ident" id="1864494">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864499">if</span>&nbsp;<span class="builtinfunc" id="1864502">len</span><span class="op" id="1864505">(</span><span class="ident" id="1864506">b</span><span class="op" id="1864507">)</span>&nbsp;<span class="op" id="1864509">==</span>&nbsp;<span class="num" id="1864512">0</span>&nbsp;<span class="op" id="1864514">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864518">b</span>&nbsp;<span class="op" id="1864520">=</span>&nbsp;<span class="ident" id="1864522">b</span><span class="op" id="1864523">.</span><span class="ident" id="1864524">set</span><span class="op" id="1864527">(</span><span class="ident" id="1864528">natOne</span><span class="op" id="1864534">)</span>&nbsp;<span class="comment" id="1864536">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864567">f</span><span class="op" id="1864568">,</span>&nbsp;<span class="ident" id="1864570">exact</span>&nbsp;<span class="op" id="1864576">=</span>&nbsp;<span class="ident" id="1864578">quotToFloat32</span><span class="op" id="1864591">(</span><span class="ident" id="1864592">x</span><span class="op" id="1864593">.</span><span class="ident" id="1864594">a</span><span class="op" id="1864595">.</span><span class="ident" id="1864596">abs</span><span class="op" id="1864599">,</span>&nbsp;<span class="ident" id="1864601">b</span><span class="op" id="1864602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864605">if</span>&nbsp;<span class="ident" id="1864608">x</span><span class="op" id="1864609">.</span><span class="ident" id="1864610">a</span><span class="op" id="1864611">.</span><span class="ident" id="1864612">neg</span>&nbsp;<span class="op" id="1864616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864620">f</span>&nbsp;<span class="op" id="1864622">=</span>&nbsp;<span class="op" id="1864624">-</span><span class="ident" id="1864625">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864631">return</span><br>
<span class="lineno"></span><span class="op" id="1864638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1864641">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="1864714">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1864787">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1864856">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1864919">func</span>&nbsp;<span class="op" id="1864924">(</span><span class="ident" id="1864925">x</span>&nbsp;<span class="op" id="1864927">*</span><span class="ident" id="1864928">Rat</span><span class="op" id="1864931">)</span>&nbsp;<span class="ident" id="1864933">Float64</span><span class="op" id="1864940">(</span><span class="op" id="1864941">)</span>&nbsp;<span class="op" id="1864943">(</span><span class="ident" id="1864944">f</span>&nbsp;<span class="builtintype" id="1864946">float64</span><span class="op" id="1864953">,</span>&nbsp;<span class="ident" id="1864955">exact</span>&nbsp;<span class="builtintype" id="1864961">bool</span><span class="op" id="1864965">)</span>&nbsp;<span class="op" id="1864967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864970">b</span>&nbsp;<span class="op" id="1864972">:=</span>&nbsp;<span class="ident" id="1864975">x</span><span class="op" id="1864976">.</span><span class="ident" id="1864977">b</span><span class="op" id="1864978">.</span><span class="ident" id="1864979">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864984">if</span>&nbsp;<span class="builtinfunc" id="1864987">len</span><span class="op" id="1864990">(</span><span class="ident" id="1864991">b</span><span class="op" id="1864992">)</span>&nbsp;<span class="op" id="1864994">==</span>&nbsp;<span class="num" id="1864997">0</span>&nbsp;<span class="op" id="1864999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865003">b</span>&nbsp;<span class="op" id="1865005">=</span>&nbsp;<span class="ident" id="1865007">b</span><span class="op" id="1865008">.</span><span class="ident" id="1865009">set</span><span class="op" id="1865012">(</span><span class="ident" id="1865013">natOne</span><span class="op" id="1865019">)</span>&nbsp;<span class="comment" id="1865021">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865052">f</span><span class="op" id="1865053">,</span>&nbsp;<span class="ident" id="1865055">exact</span>&nbsp;<span class="op" id="1865061">=</span>&nbsp;<span class="ident" id="1865063">quotToFloat64</span><span class="op" id="1865076">(</span><span class="ident" id="1865077">x</span><span class="op" id="1865078">.</span><span class="ident" id="1865079">a</span><span class="op" id="1865080">.</span><span class="ident" id="1865081">abs</span><span class="op" id="1865084">,</span>&nbsp;<span class="ident" id="1865086">b</span><span class="op" id="1865087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865090">if</span>&nbsp;<span class="ident" id="1865093">x</span><span class="op" id="1865094">.</span><span class="ident" id="1865095">a</span><span class="op" id="1865096">.</span><span class="ident" id="1865097">neg</span>&nbsp;<span class="op" id="1865101">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865105">f</span>&nbsp;<span class="op" id="1865107">=</span>&nbsp;<span class="op" id="1865109">-</span><span class="ident" id="1865110">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865116">return</span><br>
<span class="lineno"></span><span class="op" id="1865123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="1865126">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1865166">func</span>&nbsp;<span class="op" id="1865171">(</span><span class="ident" id="1865172">z</span>&nbsp;<span class="op" id="1865174">*</span><span class="ident" id="1865175">Rat</span><span class="op" id="1865178">)</span>&nbsp;<span class="ident" id="1865180">SetFrac</span><span class="op" id="1865187">(</span><span class="ident" id="1865188">a</span><span class="op" id="1865189">,</span>&nbsp;<span class="ident" id="1865191">b</span>&nbsp;<span class="op" id="1865193">*</span><span class="ident" id="1865194">Int</span><span class="op" id="1865197">)</span>&nbsp;<span class="op" id="1865199">*</span><span class="ident" id="1865200">Rat</span>&nbsp;<span class="op" id="1865204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865207">z</span><span class="op" id="1865208">.</span><span class="ident" id="1865209">a</span><span class="op" id="1865210">.</span><span class="ident" id="1865211">neg</span>&nbsp;<span class="op" id="1865215">=</span>&nbsp;<span class="ident" id="1865217">a</span><span class="op" id="1865218">.</span><span class="ident" id="1865219">neg</span>&nbsp;<span class="op" id="1865223">!=</span>&nbsp;<span class="ident" id="1865226">b</span><span class="op" id="1865227">.</span><span class="ident" id="1865228">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865233">babs</span>&nbsp;<span class="op" id="1865238">:=</span>&nbsp;<span class="ident" id="1865241">b</span><span class="op" id="1865242">.</span><span class="ident" id="1865243">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865248">if</span>&nbsp;<span class="builtinfunc" id="1865251">len</span><span class="op" id="1865254">(</span><span class="ident" id="1865255">babs</span><span class="op" id="1865259">)</span>&nbsp;<span class="op" id="1865261">==</span>&nbsp;<span class="num" id="1865264">0</span>&nbsp;<span class="op" id="1865266">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1865270">panic</span><span class="op" id="1865275">(</span><span class="string" id="1865276">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1865294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865300">if</span>&nbsp;<span class="op" id="1865303">&amp;</span><span class="ident" id="1865304">z</span><span class="op" id="1865305">.</span><span class="ident" id="1865306">a</span>&nbsp;<span class="op" id="1865308">==</span>&nbsp;<span class="ident" id="1865311">b</span>&nbsp;<span class="op" id="1865313">||</span>&nbsp;<span class="ident" id="1865316">alias</span><span class="op" id="1865321">(</span><span class="ident" id="1865322">z</span><span class="op" id="1865323">.</span><span class="ident" id="1865324">a</span><span class="op" id="1865325">.</span><span class="ident" id="1865326">abs</span><span class="op" id="1865329">,</span>&nbsp;<span class="ident" id="1865331">babs</span><span class="op" id="1865335">)</span>&nbsp;<span class="op" id="1865337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865341">babs</span>&nbsp;<span class="op" id="1865346">=</span>&nbsp;<span class="ident" id="1865348">nat</span><span class="op" id="1865351">(</span><span class="ident" id="1865352">nil</span><span class="op" id="1865355">)</span><span class="op" id="1865356">.</span><span class="ident" id="1865357">set</span><span class="op" id="1865360">(</span><span class="ident" id="1865361">babs</span><span class="op" id="1865365">)</span>&nbsp;<span class="comment" id="1865367">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865383">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865386">z</span><span class="op" id="1865387">.</span><span class="ident" id="1865388">a</span><span class="op" id="1865389">.</span><span class="ident" id="1865390">abs</span>&nbsp;<span class="op" id="1865394">=</span>&nbsp;<span class="ident" id="1865396">z</span><span class="op" id="1865397">.</span><span class="ident" id="1865398">a</span><span class="op" id="1865399">.</span><span class="ident" id="1865400">abs</span><span class="op" id="1865403">.</span><span class="ident" id="1865404">set</span><span class="op" id="1865407">(</span><span class="ident" id="1865408">a</span><span class="op" id="1865409">.</span><span class="ident" id="1865410">abs</span><span class="op" id="1865413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865416">z</span><span class="op" id="1865417">.</span><span class="ident" id="1865418">b</span><span class="op" id="1865419">.</span><span class="ident" id="1865420">abs</span>&nbsp;<span class="op" id="1865424">=</span>&nbsp;<span class="ident" id="1865426">z</span><span class="op" id="1865427">.</span><span class="ident" id="1865428">b</span><span class="op" id="1865429">.</span><span class="ident" id="1865430">abs</span><span class="op" id="1865433">.</span><span class="ident" id="1865434">set</span><span class="op" id="1865437">(</span><span class="ident" id="1865438">babs</span><span class="op" id="1865442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865445">return</span>&nbsp;<span class="ident" id="1865452">z</span><span class="op" id="1865453">.</span><span class="ident" id="1865454">norm</span><span class="op" id="1865458">(</span><span class="op" id="1865459">)</span><br>
<span class="lineno"></span><span class="op" id="1865461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="1865464">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1865506">func</span>&nbsp;<span class="op" id="1865511">(</span><span class="ident" id="1865512">z</span>&nbsp;<span class="op" id="1865514">*</span><span class="ident" id="1865515">Rat</span><span class="op" id="1865518">)</span>&nbsp;<span class="ident" id="1865520">SetFrac64</span><span class="op" id="1865529">(</span><span class="ident" id="1865530">a</span><span class="op" id="1865531">,</span>&nbsp;<span class="ident" id="1865533">b</span>&nbsp;<span class="ident" id="1865535">int64</span><span class="op" id="1865540">)</span>&nbsp;<span class="op" id="1865542">*</span><span class="ident" id="1865543">Rat</span>&nbsp;<span class="op" id="1865547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865550">z</span><span class="op" id="1865551">.</span><span class="ident" id="1865552">a</span><span class="op" id="1865553">.</span><span class="ident" id="1865554">SetInt64</span><span class="op" id="1865562">(</span><span class="ident" id="1865563">a</span><span class="op" id="1865564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865567">if</span>&nbsp;<span class="ident" id="1865570">b</span>&nbsp;<span class="op" id="1865572">==</span>&nbsp;<span class="num" id="1865575">0</span>&nbsp;<span class="op" id="1865577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1865581">panic</span><span class="op" id="1865586">(</span><span class="string" id="1865587">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1865605">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865611">if</span>&nbsp;<span class="ident" id="1865614">b</span>&nbsp;<span class="op" id="1865616">&lt;</span>&nbsp;<span class="num" id="1865618">0</span>&nbsp;<span class="op" id="1865620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865624">b</span>&nbsp;<span class="op" id="1865626">=</span>&nbsp;<span class="op" id="1865628">-</span><span class="ident" id="1865629">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865633">z</span><span class="op" id="1865634">.</span><span class="ident" id="1865635">a</span><span class="op" id="1865636">.</span><span class="ident" id="1865637">neg</span>&nbsp;<span class="op" id="1865641">=</span>&nbsp;<span class="op" id="1865643">!</span><span class="ident" id="1865644">z</span><span class="op" id="1865645">.</span><span class="ident" id="1865646">a</span><span class="op" id="1865647">.</span><span class="ident" id="1865648">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865653">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865656">z</span><span class="op" id="1865657">.</span><span class="ident" id="1865658">b</span><span class="op" id="1865659">.</span><span class="ident" id="1865660">abs</span>&nbsp;<span class="op" id="1865664">=</span>&nbsp;<span class="ident" id="1865666">z</span><span class="op" id="1865667">.</span><span class="ident" id="1865668">b</span><span class="op" id="1865669">.</span><span class="ident" id="1865670">abs</span><span class="op" id="1865673">.</span><span class="ident" id="1865674">setUint64</span><span class="op" id="1865683">(</span><span class="ident" id="1865684">uint64</span><span class="op" id="1865690">(</span><span class="ident" id="1865691">b</span><span class="op" id="1865692">)</span><span class="op" id="1865693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865696">return</span>&nbsp;<span class="ident" id="1865703">z</span><span class="op" id="1865704">.</span><span class="ident" id="1865705">norm</span><span class="op" id="1865709">(</span><span class="op" id="1865710">)</span><br>
<span class="lineno"></span><span class="op" id="1865712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1865715">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="1865776">func</span>&nbsp;<span class="op" id="1865781">(</span><span class="ident" id="1865782">z</span>&nbsp;<span class="op" id="1865784">*</span><span class="ident" id="1865785">Rat</span><span class="op" id="1865788">)</span>&nbsp;<span class="ident" id="1865790">SetInt</span><span class="op" id="1865796">(</span><span class="ident" id="1865797">x</span>&nbsp;<span class="op" id="1865799">*</span><span class="ident" id="1865800">Int</span><span class="op" id="1865803">)</span>&nbsp;<span class="op" id="1865805">*</span><span class="ident" id="1865806">Rat</span>&nbsp;<span class="op" id="1865810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865813">z</span><span class="op" id="1865814">.</span><span class="ident" id="1865815">a</span><span class="op" id="1865816">.</span><span class="ident" id="1865817">Set</span><span class="op" id="1865820">(</span><span class="ident" id="1865821">x</span><span class="op" id="1865822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865825">z</span><span class="op" id="1865826">.</span><span class="ident" id="1865827">b</span><span class="op" id="1865828">.</span><span class="ident" id="1865829">abs</span>&nbsp;<span class="op" id="1865833">=</span>&nbsp;<span class="ident" id="1865835">z</span><span class="op" id="1865836">.</span><span class="ident" id="1865837">b</span><span class="op" id="1865838">.</span><span class="ident" id="1865839">abs</span><span class="op" id="1865842">.</span><span class="builtinfunc" id="1865843">make</span><span class="op" id="1865847">(</span><span class="num" id="1865848">0</span><span class="op" id="1865849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865852">return</span>&nbsp;<span class="ident" id="1865859">z</span><br>
<span class="lineno"></span><span class="op" id="1865861">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="1865864">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1865903">func</span>&nbsp;<span class="op" id="1865908">(</span><span class="ident" id="1865909">z</span>&nbsp;<span class="op" id="1865911">*</span><span class="ident" id="1865912">Rat</span><span class="op" id="1865915">)</span>&nbsp;<span class="ident" id="1865917">SetInt64</span><span class="op" id="1865925">(</span><span class="ident" id="1865926">x</span>&nbsp;<span class="ident" id="1865928">int64</span><span class="op" id="1865933">)</span>&nbsp;<span class="op" id="1865935">*</span><span class="ident" id="1865936">Rat</span>&nbsp;<span class="op" id="1865940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865943">z</span><span class="op" id="1865944">.</span><span class="ident" id="1865945">a</span><span class="op" id="1865946">.</span><span class="ident" id="1865947">SetInt64</span><span class="op" id="1865955">(</span><span class="ident" id="1865956">x</span><span class="op" id="1865957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865960">z</span><span class="op" id="1865961">.</span><span class="ident" id="1865962">b</span><span class="op" id="1865963">.</span><span class="ident" id="1865964">abs</span>&nbsp;<span class="op" id="1865968">=</span>&nbsp;<span class="ident" id="1865970">z</span><span class="op" id="1865971">.</span><span class="ident" id="1865972">b</span><span class="op" id="1865973">.</span><span class="ident" id="1865974">abs</span><span class="op" id="1865977">.</span><span class="builtinfunc" id="1865978">make</span><span class="op" id="1865982">(</span><span class="num" id="1865983">0</span><span class="op" id="1865984">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865987">return</span>&nbsp;<span class="ident" id="1865994">z</span><br>
<span class="lineno"></span><span class="op" id="1865996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1865999">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1866057">func</span>&nbsp;<span class="op" id="1866062">(</span><span class="ident" id="1866063">z</span>&nbsp;<span class="op" id="1866065">*</span><span class="ident" id="1866066">Rat</span><span class="op" id="1866069">)</span>&nbsp;<span class="ident" id="1866071">Set</span><span class="op" id="1866074">(</span><span class="ident" id="1866075">x</span>&nbsp;<span class="op" id="1866077">*</span><span class="ident" id="1866078">Rat</span><span class="op" id="1866081">)</span>&nbsp;<span class="op" id="1866083">*</span><span class="ident" id="1866084">Rat</span>&nbsp;<span class="op" id="1866088">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866091">if</span>&nbsp;<span class="ident" id="1866094">z</span>&nbsp;<span class="op" id="1866096">!=</span>&nbsp;<span class="ident" id="1866099">x</span>&nbsp;<span class="op" id="1866101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866105">z</span><span class="op" id="1866106">.</span><span class="ident" id="1866107">a</span><span class="op" id="1866108">.</span><span class="ident" id="1866109">Set</span><span class="op" id="1866112">(</span><span class="op" id="1866113">&amp;</span><span class="ident" id="1866114">x</span><span class="op" id="1866115">.</span><span class="ident" id="1866116">a</span><span class="op" id="1866117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866121">z</span><span class="op" id="1866122">.</span><span class="ident" id="1866123">b</span><span class="op" id="1866124">.</span><span class="ident" id="1866125">Set</span><span class="op" id="1866128">(</span><span class="op" id="1866129">&amp;</span><span class="ident" id="1866130">x</span><span class="op" id="1866131">.</span><span class="ident" id="1866132">b</span><span class="op" id="1866133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866139">return</span>&nbsp;<span class="ident" id="1866146">z</span><br>
<span class="lineno">345</span><span class="op" id="1866148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1866151">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1866213">func</span>&nbsp;<span class="op" id="1866218">(</span><span class="ident" id="1866219">z</span>&nbsp;<span class="op" id="1866221">*</span><span class="ident" id="1866222">Rat</span><span class="op" id="1866225">)</span>&nbsp;<span class="ident" id="1866227">Abs</span><span class="op" id="1866230">(</span><span class="ident" id="1866231">x</span>&nbsp;<span class="op" id="1866233">*</span><span class="ident" id="1866234">Rat</span><span class="op" id="1866237">)</span>&nbsp;<span class="op" id="1866239">*</span><span class="ident" id="1866240">Rat</span>&nbsp;<span class="op" id="1866244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866247">z</span><span class="op" id="1866248">.</span><span class="ident" id="1866249">Set</span><span class="op" id="1866252">(</span><span class="ident" id="1866253">x</span><span class="op" id="1866254">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866257">z</span><span class="op" id="1866258">.</span><span class="ident" id="1866259">a</span><span class="op" id="1866260">.</span><span class="ident" id="1866261">neg</span>&nbsp;<span class="op" id="1866265">=</span>&nbsp;<span class="ident" id="1866267">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866274">return</span>&nbsp;<span class="ident" id="1866281">z</span><br>
<span class="lineno"></span><span class="op" id="1866283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1866286">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="1866321">func</span>&nbsp;<span class="op" id="1866326">(</span><span class="ident" id="1866327">z</span>&nbsp;<span class="op" id="1866329">*</span><span class="ident" id="1866330">Rat</span><span class="op" id="1866333">)</span>&nbsp;<span class="ident" id="1866335">Neg</span><span class="op" id="1866338">(</span><span class="ident" id="1866339">x</span>&nbsp;<span class="op" id="1866341">*</span><span class="ident" id="1866342">Rat</span><span class="op" id="1866345">)</span>&nbsp;<span class="op" id="1866347">*</span><span class="ident" id="1866348">Rat</span>&nbsp;<span class="op" id="1866352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866355">z</span><span class="op" id="1866356">.</span><span class="ident" id="1866357">Set</span><span class="op" id="1866360">(</span><span class="ident" id="1866361">x</span><span class="op" id="1866362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866365">z</span><span class="op" id="1866366">.</span><span class="ident" id="1866367">a</span><span class="op" id="1866368">.</span><span class="ident" id="1866369">neg</span>&nbsp;<span class="op" id="1866373">=</span>&nbsp;<span class="builtinfunc" id="1866375">len</span><span class="op" id="1866378">(</span><span class="ident" id="1866379">z</span><span class="op" id="1866380">.</span><span class="ident" id="1866381">a</span><span class="op" id="1866382">.</span><span class="ident" id="1866383">abs</span><span class="op" id="1866386">)</span>&nbsp;<span class="op" id="1866388">&gt;</span>&nbsp;<span class="num" id="1866390">0</span>&nbsp;<span class="op" id="1866392">&amp;&amp;</span>&nbsp;<span class="op" id="1866395">!</span><span class="ident" id="1866396">z</span><span class="op" id="1866397">.</span><span class="ident" id="1866398">a</span><span class="op" id="1866399">.</span><span class="ident" id="1866400">neg</span>&nbsp;<span class="comment" id="1866404">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866422">return</span>&nbsp;<span class="ident" id="1866429">z</span><br>
<span class="lineno"></span><span class="op" id="1866431">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="1866434">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1866470">func</span>&nbsp;<span class="op" id="1866475">(</span><span class="ident" id="1866476">z</span>&nbsp;<span class="op" id="1866478">*</span><span class="ident" id="1866479">Rat</span><span class="op" id="1866482">)</span>&nbsp;<span class="ident" id="1866484">Inv</span><span class="op" id="1866487">(</span><span class="ident" id="1866488">x</span>&nbsp;<span class="op" id="1866490">*</span><span class="ident" id="1866491">Rat</span><span class="op" id="1866494">)</span>&nbsp;<span class="op" id="1866496">*</span><span class="ident" id="1866497">Rat</span>&nbsp;<span class="op" id="1866501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866504">if</span>&nbsp;<span class="builtinfunc" id="1866507">len</span><span class="op" id="1866510">(</span><span class="ident" id="1866511">x</span><span class="op" id="1866512">.</span><span class="ident" id="1866513">a</span><span class="op" id="1866514">.</span><span class="ident" id="1866515">abs</span><span class="op" id="1866518">)</span>&nbsp;<span class="op" id="1866520">==</span>&nbsp;<span class="num" id="1866523">0</span>&nbsp;<span class="op" id="1866525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866529">panic</span><span class="op" id="1866534">(</span><span class="string" id="1866535">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1866553">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866559">z</span><span class="op" id="1866560">.</span><span class="ident" id="1866561">Set</span><span class="op" id="1866564">(</span><span class="ident" id="1866565">x</span><span class="op" id="1866566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866569">a</span>&nbsp;<span class="op" id="1866571">:=</span>&nbsp;<span class="ident" id="1866574">z</span><span class="op" id="1866575">.</span><span class="ident" id="1866576">b</span><span class="op" id="1866577">.</span><span class="ident" id="1866578">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866583">if</span>&nbsp;<span class="builtinfunc" id="1866586">len</span><span class="op" id="1866589">(</span><span class="ident" id="1866590">a</span><span class="op" id="1866591">)</span>&nbsp;<span class="op" id="1866593">==</span>&nbsp;<span class="num" id="1866596">0</span>&nbsp;<span class="op" id="1866598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866602">a</span>&nbsp;<span class="op" id="1866604">=</span>&nbsp;<span class="ident" id="1866606">a</span><span class="op" id="1866607">.</span><span class="ident" id="1866608">set</span><span class="op" id="1866611">(</span><span class="ident" id="1866612">natOne</span><span class="op" id="1866618">)</span>&nbsp;<span class="comment" id="1866620">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866649">b</span>&nbsp;<span class="op" id="1866651">:=</span>&nbsp;<span class="ident" id="1866654">z</span><span class="op" id="1866655">.</span><span class="ident" id="1866656">a</span><span class="op" id="1866657">.</span><span class="ident" id="1866658">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866663">if</span>&nbsp;<span class="ident" id="1866666">b</span><span class="op" id="1866667">.</span><span class="ident" id="1866668">cmp</span><span class="op" id="1866671">(</span><span class="ident" id="1866672">natOne</span><span class="op" id="1866678">)</span>&nbsp;<span class="op" id="1866680">==</span>&nbsp;<span class="num" id="1866683">0</span>&nbsp;<span class="op" id="1866685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866689">b</span>&nbsp;<span class="op" id="1866691">=</span>&nbsp;<span class="ident" id="1866693">b</span><span class="op" id="1866694">.</span><span class="builtinfunc" id="1866695">make</span><span class="op" id="1866699">(</span><span class="num" id="1866700">0</span><span class="op" id="1866701">)</span>&nbsp;<span class="comment" id="1866703">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866729">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866732">z</span><span class="op" id="1866733">.</span><span class="ident" id="1866734">a</span><span class="op" id="1866735">.</span><span class="ident" id="1866736">abs</span><span class="op" id="1866739">,</span>&nbsp;<span class="ident" id="1866741">z</span><span class="op" id="1866742">.</span><span class="ident" id="1866743">b</span><span class="op" id="1866744">.</span><span class="ident" id="1866745">abs</span>&nbsp;<span class="op" id="1866749">=</span>&nbsp;<span class="ident" id="1866751">a</span><span class="op" id="1866752">,</span>&nbsp;<span class="ident" id="1866754">b</span>&nbsp;<span class="comment" id="1866756">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866780">return</span>&nbsp;<span class="ident" id="1866787">z</span><br>
<span class="lineno"></span><span class="op" id="1866789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1866792">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="1866809">//</span><br>
<span class="lineno"></span><span class="comment" id="1866812">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="1866828">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="1866844">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="1866860">//</span><br>
<span class="lineno">385</span><span class="keyword" id="1866863">func</span>&nbsp;<span class="op" id="1866868">(</span><span class="ident" id="1866869">x</span>&nbsp;<span class="op" id="1866871">*</span><span class="ident" id="1866872">Rat</span><span class="op" id="1866875">)</span>&nbsp;<span class="ident" id="1866877">Sign</span><span class="op" id="1866881">(</span><span class="op" id="1866882">)</span>&nbsp;<span class="builtintype" id="1866884">int</span>&nbsp;<span class="op" id="1866888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866891">return</span>&nbsp;<span class="ident" id="1866898">x</span><span class="op" id="1866899">.</span><span class="ident" id="1866900">a</span><span class="op" id="1866901">.</span><span class="ident" id="1866902">Sign</span><span class="op" id="1866906">(</span><span class="op" id="1866907">)</span><br>
<span class="lineno"></span><span class="op" id="1866909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1866912">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="1866964">func</span>&nbsp;<span class="op" id="1866969">(</span><span class="ident" id="1866970">x</span>&nbsp;<span class="op" id="1866972">*</span><span class="ident" id="1866973">Rat</span><span class="op" id="1866976">)</span>&nbsp;<span class="ident" id="1866978">IsInt</span><span class="op" id="1866983">(</span><span class="op" id="1866984">)</span>&nbsp;<span class="builtintype" id="1866986">bool</span>&nbsp;<span class="op" id="1866991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1866994">return</span>&nbsp;<span class="builtinfunc" id="1867001">len</span><span class="op" id="1867004">(</span><span class="ident" id="1867005">x</span><span class="op" id="1867006">.</span><span class="ident" id="1867007">b</span><span class="op" id="1867008">.</span><span class="ident" id="1867009">abs</span><span class="op" id="1867012">)</span>&nbsp;<span class="op" id="1867014">==</span>&nbsp;<span class="num" id="1867017">0</span>&nbsp;<span class="op" id="1867019">||</span>&nbsp;<span class="ident" id="1867022">x</span><span class="op" id="1867023">.</span><span class="ident" id="1867024">b</span><span class="op" id="1867025">.</span><span class="ident" id="1867026">abs</span><span class="op" id="1867029">.</span><span class="ident" id="1867030">cmp</span><span class="op" id="1867033">(</span><span class="ident" id="1867034">natOne</span><span class="op" id="1867040">)</span>&nbsp;<span class="op" id="1867042">==</span>&nbsp;<span class="num" id="1867045">0</span><br>
<span class="lineno"></span><span class="op" id="1867047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1867050">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="1867101">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1867151">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="1867214">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="1867273">func</span>&nbsp;<span class="op" id="1867278">(</span><span class="ident" id="1867279">x</span>&nbsp;<span class="op" id="1867281">*</span><span class="ident" id="1867282">Rat</span><span class="op" id="1867285">)</span>&nbsp;<span class="ident" id="1867287">Num</span><span class="op" id="1867290">(</span><span class="op" id="1867291">)</span>&nbsp;<span class="op" id="1867293">*</span><span class="ident" id="1867294">Int</span>&nbsp;<span class="op" id="1867298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867301">return</span>&nbsp;<span class="op" id="1867308">&amp;</span><span class="ident" id="1867309">x</span><span class="op" id="1867310">.</span><span class="ident" id="1867311">a</span><br>
<span class="lineno">400</span><span class="op" id="1867313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1867316">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1867373">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1867425">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="1867488">func</span>&nbsp;<span class="op" id="1867493">(</span><span class="ident" id="1867494">x</span>&nbsp;<span class="op" id="1867496">*</span><span class="ident" id="1867497">Rat</span><span class="op" id="1867500">)</span>&nbsp;<span class="ident" id="1867502">Denom</span><span class="op" id="1867507">(</span><span class="op" id="1867508">)</span>&nbsp;<span class="op" id="1867510">*</span><span class="ident" id="1867511">Int</span>&nbsp;<span class="op" id="1867515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867518">x</span><span class="op" id="1867519">.</span><span class="ident" id="1867520">b</span><span class="op" id="1867521">.</span><span class="ident" id="1867522">neg</span>&nbsp;<span class="op" id="1867526">=</span>&nbsp;<span class="ident" id="1867528">false</span>&nbsp;<span class="comment" id="1867534">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867564">if</span>&nbsp;<span class="builtinfunc" id="1867567">len</span><span class="op" id="1867570">(</span><span class="ident" id="1867571">x</span><span class="op" id="1867572">.</span><span class="ident" id="1867573">b</span><span class="op" id="1867574">.</span><span class="ident" id="1867575">abs</span><span class="op" id="1867578">)</span>&nbsp;<span class="op" id="1867580">==</span>&nbsp;<span class="num" id="1867583">0</span>&nbsp;<span class="op" id="1867585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867589">x</span><span class="op" id="1867590">.</span><span class="ident" id="1867591">b</span><span class="op" id="1867592">.</span><span class="ident" id="1867593">abs</span>&nbsp;<span class="op" id="1867597">=</span>&nbsp;<span class="ident" id="1867599">x</span><span class="op" id="1867600">.</span><span class="ident" id="1867601">b</span><span class="op" id="1867602">.</span><span class="ident" id="1867603">abs</span><span class="op" id="1867606">.</span><span class="ident" id="1867607">set</span><span class="op" id="1867610">(</span><span class="ident" id="1867611">natOne</span><span class="op" id="1867617">)</span>&nbsp;<span class="comment" id="1867619">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1867647">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867650">return</span>&nbsp;<span class="op" id="1867657">&amp;</span><span class="ident" id="1867658">x</span><span class="op" id="1867659">.</span><span class="ident" id="1867660">b</span><br>
<span class="lineno"></span><span class="op" id="1867662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1867665">func</span>&nbsp;<span class="op" id="1867670">(</span><span class="ident" id="1867671">z</span>&nbsp;<span class="op" id="1867673">*</span><span class="ident" id="1867674">Rat</span><span class="op" id="1867677">)</span>&nbsp;<span class="ident" id="1867679">norm</span><span class="op" id="1867683">(</span><span class="op" id="1867684">)</span>&nbsp;<span class="op" id="1867686">*</span><span class="ident" id="1867687">Rat</span>&nbsp;<span class="op" id="1867691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867694">switch</span>&nbsp;<span class="op" id="1867701">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867704">case</span>&nbsp;<span class="builtinfunc" id="1867709">len</span><span class="op" id="1867712">(</span><span class="ident" id="1867713">z</span><span class="op" id="1867714">.</span><span class="ident" id="1867715">a</span><span class="op" id="1867716">.</span><span class="ident" id="1867717">abs</span><span class="op" id="1867720">)</span>&nbsp;<span class="op" id="1867722">==</span>&nbsp;<span class="num" id="1867725">0</span><span class="op" id="1867726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1867730">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867775">z</span><span class="op" id="1867776">.</span><span class="ident" id="1867777">a</span><span class="op" id="1867778">.</span><span class="ident" id="1867779">neg</span>&nbsp;<span class="op" id="1867783">=</span>&nbsp;<span class="ident" id="1867785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867793">z</span><span class="op" id="1867794">.</span><span class="ident" id="1867795">b</span><span class="op" id="1867796">.</span><span class="ident" id="1867797">abs</span>&nbsp;<span class="op" id="1867801">=</span>&nbsp;<span class="ident" id="1867803">z</span><span class="op" id="1867804">.</span><span class="ident" id="1867805">b</span><span class="op" id="1867806">.</span><span class="ident" id="1867807">abs</span><span class="op" id="1867810">.</span><span class="builtinfunc" id="1867811">make</span><span class="op" id="1867815">(</span><span class="num" id="1867816">0</span><span class="op" id="1867817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867820">case</span>&nbsp;<span class="builtinfunc" id="1867825">len</span><span class="op" id="1867828">(</span><span class="ident" id="1867829">z</span><span class="op" id="1867830">.</span><span class="ident" id="1867831">b</span><span class="op" id="1867832">.</span><span class="ident" id="1867833">abs</span><span class="op" id="1867836">)</span>&nbsp;<span class="op" id="1867838">==</span>&nbsp;<span class="num" id="1867841">0</span><span class="op" id="1867842">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1867846">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867886">case</span>&nbsp;<span class="ident" id="1867891">z</span><span class="op" id="1867892">.</span><span class="ident" id="1867893">b</span><span class="op" id="1867894">.</span><span class="ident" id="1867895">abs</span><span class="op" id="1867898">.</span><span class="ident" id="1867899">cmp</span><span class="op" id="1867902">(</span><span class="ident" id="1867903">natOne</span><span class="op" id="1867909">)</span>&nbsp;<span class="op" id="1867911">==</span>&nbsp;<span class="num" id="1867914">0</span><span class="op" id="1867915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1867919">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867957">z</span><span class="op" id="1867958">.</span><span class="ident" id="1867959">b</span><span class="op" id="1867960">.</span><span class="ident" id="1867961">abs</span>&nbsp;<span class="op" id="1867965">=</span>&nbsp;<span class="ident" id="1867967">z</span><span class="op" id="1867968">.</span><span class="ident" id="1867969">b</span><span class="op" id="1867970">.</span><span class="ident" id="1867971">abs</span><span class="op" id="1867974">.</span><span class="builtinfunc" id="1867975">make</span><span class="op" id="1867979">(</span><span class="num" id="1867980">0</span><span class="op" id="1867981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1867984">default</span><span class="op" id="1867991">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1867995">neg</span>&nbsp;<span class="op" id="1867999">:=</span>&nbsp;<span class="ident" id="1868002">z</span><span class="op" id="1868003">.</span><span class="ident" id="1868004">a</span><span class="op" id="1868005">.</span><span class="ident" id="1868006">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868012">z</span><span class="op" id="1868013">.</span><span class="ident" id="1868014">a</span><span class="op" id="1868015">.</span><span class="ident" id="1868016">neg</span>&nbsp;<span class="op" id="1868020">=</span>&nbsp;<span class="ident" id="1868022">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868030">z</span><span class="op" id="1868031">.</span><span class="ident" id="1868032">b</span><span class="op" id="1868033">.</span><span class="ident" id="1868034">neg</span>&nbsp;<span class="op" id="1868038">=</span>&nbsp;<span class="ident" id="1868040">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868048">if</span>&nbsp;<span class="ident" id="1868051">f</span>&nbsp;<span class="op" id="1868053">:=</span>&nbsp;<span class="ident" id="1868056">NewInt</span><span class="op" id="1868062">(</span><span class="num" id="1868063">0</span><span class="op" id="1868064">)</span><span class="op" id="1868065">.</span><span class="ident" id="1868066">binaryGCD</span><span class="op" id="1868075">(</span><span class="op" id="1868076">&amp;</span><span class="ident" id="1868077">z</span><span class="op" id="1868078">.</span><span class="ident" id="1868079">a</span><span class="op" id="1868080">,</span>&nbsp;<span class="op" id="1868082">&amp;</span><span class="ident" id="1868083">z</span><span class="op" id="1868084">.</span><span class="ident" id="1868085">b</span><span class="op" id="1868086">)</span><span class="op" id="1868087">;</span>&nbsp;<span class="ident" id="1868089">f</span><span class="op" id="1868090">.</span><span class="ident" id="1868091">Cmp</span><span class="op" id="1868094">(</span><span class="ident" id="1868095">intOne</span><span class="op" id="1868101">)</span>&nbsp;<span class="op" id="1868103">!=</span>&nbsp;<span class="num" id="1868106">0</span>&nbsp;<span class="op" id="1868108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868113">z</span><span class="op" id="1868114">.</span><span class="ident" id="1868115">a</span><span class="op" id="1868116">.</span><span class="ident" id="1868117">abs</span><span class="op" id="1868120">,</span>&nbsp;<span class="ident" id="1868122">_</span>&nbsp;<span class="op" id="1868124">=</span>&nbsp;<span class="ident" id="1868126">z</span><span class="op" id="1868127">.</span><span class="ident" id="1868128">a</span><span class="op" id="1868129">.</span><span class="ident" id="1868130">abs</span><span class="op" id="1868133">.</span><span class="ident" id="1868134">div</span><span class="op" id="1868137">(</span><span class="ident" id="1868138">nil</span><span class="op" id="1868141">,</span>&nbsp;<span class="ident" id="1868143">z</span><span class="op" id="1868144">.</span><span class="ident" id="1868145">a</span><span class="op" id="1868146">.</span><span class="ident" id="1868147">abs</span><span class="op" id="1868150">,</span>&nbsp;<span class="ident" id="1868152">f</span><span class="op" id="1868153">.</span><span class="ident" id="1868154">abs</span><span class="op" id="1868157">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868162">z</span><span class="op" id="1868163">.</span><span class="ident" id="1868164">b</span><span class="op" id="1868165">.</span><span class="ident" id="1868166">abs</span><span class="op" id="1868169">,</span>&nbsp;<span class="ident" id="1868171">_</span>&nbsp;<span class="op" id="1868173">=</span>&nbsp;<span class="ident" id="1868175">z</span><span class="op" id="1868176">.</span><span class="ident" id="1868177">b</span><span class="op" id="1868178">.</span><span class="ident" id="1868179">abs</span><span class="op" id="1868182">.</span><span class="ident" id="1868183">div</span><span class="op" id="1868186">(</span><span class="ident" id="1868187">nil</span><span class="op" id="1868190">,</span>&nbsp;<span class="ident" id="1868192">z</span><span class="op" id="1868193">.</span><span class="ident" id="1868194">b</span><span class="op" id="1868195">.</span><span class="ident" id="1868196">abs</span><span class="op" id="1868199">,</span>&nbsp;<span class="ident" id="1868201">f</span><span class="op" id="1868202">.</span><span class="ident" id="1868203">abs</span><span class="op" id="1868206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868211">if</span>&nbsp;<span class="ident" id="1868214">z</span><span class="op" id="1868215">.</span><span class="ident" id="1868216">b</span><span class="op" id="1868217">.</span><span class="ident" id="1868218">abs</span><span class="op" id="1868221">.</span><span class="ident" id="1868222">cmp</span><span class="op" id="1868225">(</span><span class="ident" id="1868226">natOne</span><span class="op" id="1868232">)</span>&nbsp;<span class="op" id="1868234">==</span>&nbsp;<span class="num" id="1868237">0</span>&nbsp;<span class="op" id="1868239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868245">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868285">z</span><span class="op" id="1868286">.</span><span class="ident" id="1868287">b</span><span class="op" id="1868288">.</span><span class="ident" id="1868289">abs</span>&nbsp;<span class="op" id="1868293">=</span>&nbsp;<span class="ident" id="1868295">z</span><span class="op" id="1868296">.</span><span class="ident" id="1868297">b</span><span class="op" id="1868298">.</span><span class="ident" id="1868299">abs</span><span class="op" id="1868302">.</span><span class="builtinfunc" id="1868303">make</span><span class="op" id="1868307">(</span><span class="num" id="1868308">0</span><span class="op" id="1868309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1868314">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1868318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868322">z</span><span class="op" id="1868323">.</span><span class="ident" id="1868324">a</span><span class="op" id="1868325">.</span><span class="ident" id="1868326">neg</span>&nbsp;<span class="op" id="1868330">=</span>&nbsp;<span class="ident" id="1868332">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1868337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868340">return</span>&nbsp;<span class="ident" id="1868347">z</span><br>
<span class="lineno"></span><span class="op" id="1868349">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="1868352">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="1868418">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1868484">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1868498">func</span>&nbsp;<span class="ident" id="1868503">mulDenom</span><span class="op" id="1868511">(</span><span class="ident" id="1868512">z</span><span class="op" id="1868513">,</span>&nbsp;<span class="ident" id="1868515">x</span><span class="op" id="1868516">,</span>&nbsp;<span class="ident" id="1868518">y</span>&nbsp;<span class="ident" id="1868520">nat</span><span class="op" id="1868523">)</span>&nbsp;<span class="ident" id="1868525">nat</span>&nbsp;<span class="op" id="1868529">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868532">switch</span>&nbsp;<span class="op" id="1868539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868542">case</span>&nbsp;<span class="builtinfunc" id="1868547">len</span><span class="op" id="1868550">(</span><span class="ident" id="1868551">x</span><span class="op" id="1868552">)</span>&nbsp;<span class="op" id="1868554">==</span>&nbsp;<span class="num" id="1868557">0</span><span class="op" id="1868558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868562">return</span>&nbsp;<span class="ident" id="1868569">z</span><span class="op" id="1868570">.</span><span class="ident" id="1868571">set</span><span class="op" id="1868574">(</span><span class="ident" id="1868575">y</span><span class="op" id="1868576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868579">case</span>&nbsp;<span class="builtinfunc" id="1868584">len</span><span class="op" id="1868587">(</span><span class="ident" id="1868588">y</span><span class="op" id="1868589">)</span>&nbsp;<span class="op" id="1868591">==</span>&nbsp;<span class="num" id="1868594">0</span><span class="op" id="1868595">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868599">return</span>&nbsp;<span class="ident" id="1868606">z</span><span class="op" id="1868607">.</span><span class="ident" id="1868608">set</span><span class="op" id="1868611">(</span><span class="ident" id="1868612">x</span><span class="op" id="1868613">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1868616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868619">return</span>&nbsp;<span class="ident" id="1868626">z</span><span class="op" id="1868627">.</span><span class="ident" id="1868628">mul</span><span class="op" id="1868631">(</span><span class="ident" id="1868632">x</span><span class="op" id="1868633">,</span>&nbsp;<span class="ident" id="1868635">y</span><span class="op" id="1868636">)</span><br>
<span class="lineno"></span><span class="op" id="1868638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1868641">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="1868669">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="1868740">func</span>&nbsp;<span class="ident" id="1868745">scaleDenom</span><span class="op" id="1868755">(</span><span class="ident" id="1868756">x</span>&nbsp;<span class="op" id="1868758">*</span><span class="ident" id="1868759">Int</span><span class="op" id="1868762">,</span>&nbsp;<span class="ident" id="1868764">f</span>&nbsp;<span class="ident" id="1868766">nat</span><span class="op" id="1868769">)</span>&nbsp;<span class="op" id="1868771">*</span><span class="ident" id="1868772">Int</span>&nbsp;<span class="op" id="1868776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868779">var</span>&nbsp;<span class="ident" id="1868783">z</span>&nbsp;<span class="ident" id="1868785">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868790">if</span>&nbsp;<span class="builtinfunc" id="1868793">len</span><span class="op" id="1868796">(</span><span class="ident" id="1868797">f</span><span class="op" id="1868798">)</span>&nbsp;<span class="op" id="1868800">==</span>&nbsp;<span class="num" id="1868803">0</span>&nbsp;<span class="op" id="1868805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868809">return</span>&nbsp;<span class="ident" id="1868816">z</span><span class="op" id="1868817">.</span><span class="ident" id="1868818">Set</span><span class="op" id="1868821">(</span><span class="ident" id="1868822">x</span><span class="op" id="1868823">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1868826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868829">z</span><span class="op" id="1868830">.</span><span class="ident" id="1868831">abs</span>&nbsp;<span class="op" id="1868835">=</span>&nbsp;<span class="ident" id="1868837">z</span><span class="op" id="1868838">.</span><span class="ident" id="1868839">abs</span><span class="op" id="1868842">.</span><span class="ident" id="1868843">mul</span><span class="op" id="1868846">(</span><span class="ident" id="1868847">x</span><span class="op" id="1868848">.</span><span class="ident" id="1868849">abs</span><span class="op" id="1868852">,</span>&nbsp;<span class="ident" id="1868854">f</span><span class="op" id="1868855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868858">z</span><span class="op" id="1868859">.</span><span class="ident" id="1868860">neg</span>&nbsp;<span class="op" id="1868864">=</span>&nbsp;<span class="ident" id="1868866">x</span><span class="op" id="1868867">.</span><span class="ident" id="1868868">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1868873">return</span>&nbsp;<span class="op" id="1868880">&amp;</span><span class="ident" id="1868881">z</span><br>
<span class="lineno"></span><span class="op" id="1868883">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="1868886">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="1868923">//</span><br>
<span class="lineno"></span><span class="comment" id="1868926">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="1868944">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="1868962">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="1868980">//</span><br>
<span class="lineno"></span><span class="keyword" id="1868983">func</span>&nbsp;<span class="op" id="1868988">(</span><span class="ident" id="1868989">x</span>&nbsp;<span class="op" id="1868991">*</span><span class="ident" id="1868992">Rat</span><span class="op" id="1868995">)</span>&nbsp;<span class="ident" id="1868997">Cmp</span><span class="op" id="1869000">(</span><span class="ident" id="1869001">y</span>&nbsp;<span class="op" id="1869003">*</span><span class="ident" id="1869004">Rat</span><span class="op" id="1869007">)</span>&nbsp;<span class="builtintype" id="1869009">int</span>&nbsp;<span class="op" id="1869013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1869016">return</span>&nbsp;<span class="ident" id="1869023">scaleDenom</span><span class="op" id="1869033">(</span><span class="op" id="1869034">&amp;</span><span class="ident" id="1869035">x</span><span class="op" id="1869036">.</span><span class="ident" id="1869037">a</span><span class="op" id="1869038">,</span>&nbsp;<span class="ident" id="1869040">y</span><span class="op" id="1869041">.</span><span class="ident" id="1869042">b</span><span class="op" id="1869043">.</span><span class="ident" id="1869044">abs</span><span class="op" id="1869047">)</span><span class="op" id="1869048">.</span><span class="ident" id="1869049">Cmp</span><span class="op" id="1869052">(</span><span class="ident" id="1869053">scaleDenom</span><span class="op" id="1869063">(</span><span class="op" id="1869064">&amp;</span><span class="ident" id="1869065">y</span><span class="op" id="1869066">.</span><span class="ident" id="1869067">a</span><span class="op" id="1869068">,</span>&nbsp;<span class="ident" id="1869070">x</span><span class="op" id="1869071">.</span><span class="ident" id="1869072">b</span><span class="op" id="1869073">.</span><span class="ident" id="1869074">abs</span><span class="op" id="1869077">)</span><span class="op" id="1869078">)</span><br>
<span class="lineno"></span><span class="op" id="1869080">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="1869083">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1869127">func</span>&nbsp;<span class="op" id="1869132">(</span><span class="ident" id="1869133">z</span>&nbsp;<span class="op" id="1869135">*</span><span class="ident" id="1869136">Rat</span><span class="op" id="1869139">)</span>&nbsp;<span class="ident" id="1869141">Add</span><span class="op" id="1869144">(</span><span class="ident" id="1869145">x</span><span class="op" id="1869146">,</span>&nbsp;<span class="ident" id="1869148">y</span>&nbsp;<span class="op" id="1869150">*</span><span class="ident" id="1869151">Rat</span><span class="op" id="1869154">)</span>&nbsp;<span class="op" id="1869156">*</span><span class="ident" id="1869157">Rat</span>&nbsp;<span class="op" id="1869161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869164">a1</span>&nbsp;<span class="op" id="1869167">:=</span>&nbsp;<span class="ident" id="1869170">scaleDenom</span><span class="op" id="1869180">(</span><span class="op" id="1869181">&amp;</span><span class="ident" id="1869182">x</span><span class="op" id="1869183">.</span><span class="ident" id="1869184">a</span><span class="op" id="1869185">,</span>&nbsp;<span class="ident" id="1869187">y</span><span class="op" id="1869188">.</span><span class="ident" id="1869189">b</span><span class="op" id="1869190">.</span><span class="ident" id="1869191">abs</span><span class="op" id="1869194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869197">a2</span>&nbsp;<span class="op" id="1869200">:=</span>&nbsp;<span class="ident" id="1869203">scaleDenom</span><span class="op" id="1869213">(</span><span class="op" id="1869214">&amp;</span><span class="ident" id="1869215">y</span><span class="op" id="1869216">.</span><span class="ident" id="1869217">a</span><span class="op" id="1869218">,</span>&nbsp;<span class="ident" id="1869220">x</span><span class="op" id="1869221">.</span><span class="ident" id="1869222">b</span><span class="op" id="1869223">.</span><span class="ident" id="1869224">abs</span><span class="op" id="1869227">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869230">z</span><span class="op" id="1869231">.</span><span class="ident" id="1869232">a</span><span class="op" id="1869233">.</span><span class="ident" id="1869234">Add</span><span class="op" id="1869237">(</span><span class="ident" id="1869238">a1</span><span class="op" id="1869240">,</span>&nbsp;<span class="ident" id="1869242">a2</span><span class="op" id="1869244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869247">z</span><span class="op" id="1869248">.</span><span class="ident" id="1869249">b</span><span class="op" id="1869250">.</span><span class="ident" id="1869251">abs</span>&nbsp;<span class="op" id="1869255">=</span>&nbsp;<span class="ident" id="1869257">mulDenom</span><span class="op" id="1869265">(</span><span class="ident" id="1869266">z</span><span class="op" id="1869267">.</span><span class="ident" id="1869268">b</span><span class="op" id="1869269">.</span><span class="ident" id="1869270">abs</span><span class="op" id="1869273">,</span>&nbsp;<span class="ident" id="1869275">x</span><span class="op" id="1869276">.</span><span class="ident" id="1869277">b</span><span class="op" id="1869278">.</span><span class="ident" id="1869279">abs</span><span class="op" id="1869282">,</span>&nbsp;<span class="ident" id="1869284">y</span><span class="op" id="1869285">.</span><span class="ident" id="1869286">b</span><span class="op" id="1869287">.</span><span class="ident" id="1869288">abs</span><span class="op" id="1869291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1869294">return</span>&nbsp;<span class="ident" id="1869301">z</span><span class="op" id="1869302">.</span><span class="ident" id="1869303">norm</span><span class="op" id="1869307">(</span><span class="op" id="1869308">)</span><br>
<span class="lineno"></span><span class="op" id="1869310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="1869313">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1869364">func</span>&nbsp;<span class="op" id="1869369">(</span><span class="ident" id="1869370">z</span>&nbsp;<span class="op" id="1869372">*</span><span class="ident" id="1869373">Rat</span><span class="op" id="1869376">)</span>&nbsp;<span class="ident" id="1869378">Sub</span><span class="op" id="1869381">(</span><span class="ident" id="1869382">x</span><span class="op" id="1869383">,</span>&nbsp;<span class="ident" id="1869385">y</span>&nbsp;<span class="op" id="1869387">*</span><span class="ident" id="1869388">Rat</span><span class="op" id="1869391">)</span>&nbsp;<span class="op" id="1869393">*</span><span class="ident" id="1869394">Rat</span>&nbsp;<span class="op" id="1869398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869401">a1</span>&nbsp;<span class="op" id="1869404">:=</span>&nbsp;<span class="ident" id="1869407">scaleDenom</span><span class="op" id="1869417">(</span><span class="op" id="1869418">&amp;</span><span class="ident" id="1869419">x</span><span class="op" id="1869420">.</span><span class="ident" id="1869421">a</span><span class="op" id="1869422">,</span>&nbsp;<span class="ident" id="1869424">y</span><span class="op" id="1869425">.</span><span class="ident" id="1869426">b</span><span class="op" id="1869427">.</span><span class="ident" id="1869428">abs</span><span class="op" id="1869431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869434">a2</span>&nbsp;<span class="op" id="1869437">:=</span>&nbsp;<span class="ident" id="1869440">scaleDenom</span><span class="op" id="1869450">(</span><span class="op" id="1869451">&amp;</span><span class="ident" id="1869452">y</span><span class="op" id="1869453">.</span><span class="ident" id="1869454">a</span><span class="op" id="1869455">,</span>&nbsp;<span class="ident" id="1869457">x</span><span class="op" id="1869458">.</span><span class="ident" id="1869459">b</span><span class="op" id="1869460">.</span><span class="ident" id="1869461">abs</span><span class="op" id="1869464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869467">z</span><span class="op" id="1869468">.</span><span class="ident" id="1869469">a</span><span class="op" id="1869470">.</span><span class="ident" id="1869471">Sub</span><span class="op" id="1869474">(</span><span class="ident" id="1869475">a1</span><span class="op" id="1869477">,</span>&nbsp;<span class="ident" id="1869479">a2</span><span class="op" id="1869481">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869484">z</span><span class="op" id="1869485">.</span><span class="ident" id="1869486">b</span><span class="op" id="1869487">.</span><span class="ident" id="1869488">abs</span>&nbsp;<span class="op" id="1869492">=</span>&nbsp;<span class="ident" id="1869494">mulDenom</span><span class="op" id="1869502">(</span><span class="ident" id="1869503">z</span><span class="op" id="1869504">.</span><span class="ident" id="1869505">b</span><span class="op" id="1869506">.</span><span class="ident" id="1869507">abs</span><span class="op" id="1869510">,</span>&nbsp;<span class="ident" id="1869512">x</span><span class="op" id="1869513">.</span><span class="ident" id="1869514">b</span><span class="op" id="1869515">.</span><span class="ident" id="1869516">abs</span><span class="op" id="1869519">,</span>&nbsp;<span class="ident" id="1869521">y</span><span class="op" id="1869522">.</span><span class="ident" id="1869523">b</span><span class="op" id="1869524">.</span><span class="ident" id="1869525">abs</span><span class="op" id="1869528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1869531">return</span>&nbsp;<span class="ident" id="1869538">z</span><span class="op" id="1869539">.</span><span class="ident" id="1869540">norm</span><span class="op" id="1869544">(</span><span class="op" id="1869545">)</span><br>
<span class="lineno"></span><span class="op" id="1869547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1869550">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="1869598">func</span>&nbsp;<span class="op" id="1869603">(</span><span class="ident" id="1869604">z</span>&nbsp;<span class="op" id="1869606">*</span><span class="ident" id="1869607">Rat</span><span class="op" id="1869610">)</span>&nbsp;<span class="ident" id="1869612">Mul</span><span class="op" id="1869615">(</span><span class="ident" id="1869616">x</span><span class="op" id="1869617">,</span>&nbsp;<span class="ident" id="1869619">y</span>&nbsp;<span class="op" id="1869621">*</span><span class="ident" id="1869622">Rat</span><span class="op" id="1869625">)</span>&nbsp;<span class="op" id="1869627">*</span><span class="ident" id="1869628">Rat</span>&nbsp;<span class="op" id="1869632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869635">z</span><span class="op" id="1869636">.</span><span class="ident" id="1869637">a</span><span class="op" id="1869638">.</span><span class="ident" id="1869639">Mul</span><span class="op" id="1869642">(</span><span class="op" id="1869643">&amp;</span><span class="ident" id="1869644">x</span><span class="op" id="1869645">.</span><span class="ident" id="1869646">a</span><span class="op" id="1869647">,</span>&nbsp;<span class="op" id="1869649">&amp;</span><span class="ident" id="1869650">y</span><span class="op" id="1869651">.</span><span class="ident" id="1869652">a</span><span class="op" id="1869653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869656">z</span><span class="op" id="1869657">.</span><span class="ident" id="1869658">b</span><span class="op" id="1869659">.</span><span class="ident" id="1869660">abs</span>&nbsp;<span class="op" id="1869664">=</span>&nbsp;<span class="ident" id="1869666">mulDenom</span><span class="op" id="1869674">(</span><span class="ident" id="1869675">z</span><span class="op" id="1869676">.</span><span class="ident" id="1869677">b</span><span class="op" id="1869678">.</span><span class="ident" id="1869679">abs</span><span class="op" id="1869682">,</span>&nbsp;<span class="ident" id="1869684">x</span><span class="op" id="1869685">.</span><span class="ident" id="1869686">b</span><span class="op" id="1869687">.</span><span class="ident" id="1869688">abs</span><span class="op" id="1869691">,</span>&nbsp;<span class="ident" id="1869693">y</span><span class="op" id="1869694">.</span><span class="ident" id="1869695">b</span><span class="op" id="1869696">.</span><span class="ident" id="1869697">abs</span><span class="op" id="1869700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1869703">return</span>&nbsp;<span class="ident" id="1869710">z</span><span class="op" id="1869711">.</span><span class="ident" id="1869712">norm</span><span class="op" id="1869716">(</span><span class="op" id="1869717">)</span><br>
<span class="lineno"></span><span class="op" id="1869719">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="1869722">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="1869771">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="1869827">func</span>&nbsp;<span class="op" id="1869832">(</span><span class="ident" id="1869833">z</span>&nbsp;<span class="op" id="1869835">*</span><span class="ident" id="1869836">Rat</span><span class="op" id="1869839">)</span>&nbsp;<span class="ident" id="1869841">Quo</span><span class="op" id="1869844">(</span><span class="ident" id="1869845">x</span><span class="op" id="1869846">,</span>&nbsp;<span class="ident" id="1869848">y</span>&nbsp;<span class="op" id="1869850">*</span><span class="ident" id="1869851">Rat</span><span class="op" id="1869854">)</span>&nbsp;<span class="op" id="1869856">*</span><span class="ident" id="1869857">Rat</span>&nbsp;<span class="op" id="1869861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1869864">if</span>&nbsp;<span class="builtinfunc" id="1869867">len</span><span class="op" id="1869870">(</span><span class="ident" id="1869871">y</span><span class="op" id="1869872">.</span><span class="ident" id="1869873">a</span><span class="op" id="1869874">.</span><span class="ident" id="1869875">abs</span><span class="op" id="1869878">)</span>&nbsp;<span class="op" id="1869880">==</span>&nbsp;<span class="num" id="1869883">0</span>&nbsp;<span class="op" id="1869885">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1869889">panic</span><span class="op" id="1869894">(</span><span class="string" id="1869895">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1869913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1869916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869919">a</span>&nbsp;<span class="op" id="1869921">:=</span>&nbsp;<span class="ident" id="1869924">scaleDenom</span><span class="op" id="1869934">(</span><span class="op" id="1869935">&amp;</span><span class="ident" id="1869936">x</span><span class="op" id="1869937">.</span><span class="ident" id="1869938">a</span><span class="op" id="1869939">,</span>&nbsp;<span class="ident" id="1869941">y</span><span class="op" id="1869942">.</span><span class="ident" id="1869943">b</span><span class="op" id="1869944">.</span><span class="ident" id="1869945">abs</span><span class="op" id="1869948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869951">b</span>&nbsp;<span class="op" id="1869953">:=</span>&nbsp;<span class="ident" id="1869956">scaleDenom</span><span class="op" id="1869966">(</span><span class="op" id="1869967">&amp;</span><span class="ident" id="1869968">y</span><span class="op" id="1869969">.</span><span class="ident" id="1869970">a</span><span class="op" id="1869971">,</span>&nbsp;<span class="ident" id="1869973">x</span><span class="op" id="1869974">.</span><span class="ident" id="1869975">b</span><span class="op" id="1869976">.</span><span class="ident" id="1869977">abs</span><span class="op" id="1869980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869983">z</span><span class="op" id="1869984">.</span><span class="ident" id="1869985">a</span><span class="op" id="1869986">.</span><span class="ident" id="1869987">abs</span>&nbsp;<span class="op" id="1869991">=</span>&nbsp;<span class="ident" id="1869993">a</span><span class="op" id="1869994">.</span><span class="ident" id="1869995">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870000">z</span><span class="op" id="1870001">.</span><span class="ident" id="1870002">b</span><span class="op" id="1870003">.</span><span class="ident" id="1870004">abs</span>&nbsp;<span class="op" id="1870008">=</span>&nbsp;<span class="ident" id="1870010">b</span><span class="op" id="1870011">.</span><span class="ident" id="1870012">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870017">z</span><span class="op" id="1870018">.</span><span class="ident" id="1870019">a</span><span class="op" id="1870020">.</span><span class="ident" id="1870021">neg</span>&nbsp;<span class="op" id="1870025">=</span>&nbsp;<span class="ident" id="1870027">a</span><span class="op" id="1870028">.</span><span class="ident" id="1870029">neg</span>&nbsp;<span class="op" id="1870033">!=</span>&nbsp;<span class="ident" id="1870036">b</span><span class="op" id="1870037">.</span><span class="ident" id="1870038">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870043">return</span>&nbsp;<span class="ident" id="1870050">z</span><span class="op" id="1870051">.</span><span class="ident" id="1870052">norm</span><span class="op" id="1870056">(</span><span class="op" id="1870057">)</span><br>
<span class="lineno"></span><span class="op" id="1870059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="1870062">func</span>&nbsp;<span class="ident" id="1870067">ratTok</span><span class="op" id="1870073">(</span><span class="ident" id="1870074">ch</span>&nbsp;<span class="builtintype" id="1870077">rune</span><span class="op" id="1870081">)</span>&nbsp;<span class="builtintype" id="1870083">bool</span>&nbsp;<span class="op" id="1870088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870091">return</span>&nbsp;<span class="ident" id="1870098">strings</span><span class="op" id="1870105">.</span><span class="ident" id="1870106">IndexRune</span><span class="op" id="1870115">(</span><span class="string" id="1870116">&#34;+-/0123456789.eE&#34;</span><span class="op" id="1870134">,</span>&nbsp;<span class="ident" id="1870136">ch</span><span class="op" id="1870138">)</span>&nbsp;<span class="op" id="1870140">&gt;=</span>&nbsp;<span class="num" id="1870143">0</span><br>
<span class="lineno"></span><span class="op" id="1870145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1870148">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="1870217">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="1870287">func</span>&nbsp;<span class="op" id="1870292">(</span><span class="ident" id="1870293">z</span>&nbsp;<span class="op" id="1870295">*</span><span class="ident" id="1870296">Rat</span><span class="op" id="1870299">)</span>&nbsp;<span class="ident" id="1870301">Scan</span><span class="op" id="1870305">(</span><span class="ident" id="1870306">s</span>&nbsp;<span class="ident" id="1870308">fmt</span><span class="op" id="1870311">.</span><span class="ident" id="1870312">ScanState</span><span class="op" id="1870321">,</span>&nbsp;<span class="ident" id="1870323">ch</span>&nbsp;<span class="builtintype" id="1870326">rune</span><span class="op" id="1870330">)</span>&nbsp;<span class="builtintype" id="1870332">error</span>&nbsp;<span class="op" id="1870338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870341">tok</span><span class="op" id="1870344">,</span>&nbsp;<span class="ident" id="1870346">err</span>&nbsp;<span class="op" id="1870350">:=</span>&nbsp;<span class="ident" id="1870353">s</span><span class="op" id="1870354">.</span><span class="ident" id="1870355">Token</span><span class="op" id="1870360">(</span><span class="ident" id="1870361">true</span><span class="op" id="1870365">,</span>&nbsp;<span class="ident" id="1870367">ratTok</span><span class="op" id="1870373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870376">if</span>&nbsp;<span class="ident" id="1870379">err</span>&nbsp;<span class="op" id="1870383">!=</span>&nbsp;<span class="ident" id="1870386">nil</span>&nbsp;<span class="op" id="1870390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870394">return</span>&nbsp;<span class="ident" id="1870401">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870409">if</span>&nbsp;<span class="ident" id="1870412">strings</span><span class="op" id="1870419">.</span><span class="ident" id="1870420">IndexRune</span><span class="op" id="1870429">(</span><span class="string" id="1870430">&#34;efgEFGv&#34;</span><span class="op" id="1870439">,</span>&nbsp;<span class="ident" id="1870441">ch</span><span class="op" id="1870443">)</span>&nbsp;<span class="op" id="1870445">&lt;</span>&nbsp;<span class="num" id="1870447">0</span>&nbsp;<span class="op" id="1870449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870453">return</span>&nbsp;<span class="ident" id="1870460">errors</span><span class="op" id="1870466">.</span><span class="ident" id="1870467">New</span><span class="op" id="1870470">(</span><span class="string" id="1870471">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="1870495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870501">if</span>&nbsp;<span class="ident" id="1870504">_</span><span class="op" id="1870505">,</span>&nbsp;<span class="ident" id="1870507">ok</span>&nbsp;<span class="op" id="1870510">:=</span>&nbsp;<span class="ident" id="1870513">z</span><span class="op" id="1870514">.</span><span class="ident" id="1870515">SetString</span><span class="op" id="1870524">(</span><span class="builtintype" id="1870525">string</span><span class="op" id="1870531">(</span><span class="ident" id="1870532">tok</span><span class="op" id="1870535">)</span><span class="op" id="1870536">)</span><span class="op" id="1870537">;</span>&nbsp;<span class="op" id="1870539">!</span><span class="ident" id="1870540">ok</span>&nbsp;<span class="op" id="1870543">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870547">return</span>&nbsp;<span class="ident" id="1870554">errors</span><span class="op" id="1870560">.</span><span class="ident" id="1870561">New</span><span class="op" id="1870564">(</span><span class="string" id="1870565">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="1870591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870597">return</span>&nbsp;<span class="ident" id="1870604">nil</span><br>
<span class="lineno"></span><span class="op" id="1870608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="1870611">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="1870688">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="1870765">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1870842">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1870891">func</span>&nbsp;<span class="op" id="1870896">(</span><span class="ident" id="1870897">z</span>&nbsp;<span class="op" id="1870899">*</span><span class="ident" id="1870900">Rat</span><span class="op" id="1870903">)</span>&nbsp;<span class="ident" id="1870905">SetString</span><span class="op" id="1870914">(</span><span class="ident" id="1870915">s</span>&nbsp;<span class="builtintype" id="1870917">string</span><span class="op" id="1870923">)</span>&nbsp;<span class="op" id="1870925">(</span><span class="op" id="1870926">*</span><span class="ident" id="1870927">Rat</span><span class="op" id="1870930">,</span>&nbsp;<span class="builtintype" id="1870932">bool</span><span class="op" id="1870936">)</span>&nbsp;<span class="op" id="1870938">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870941">if</span>&nbsp;<span class="builtinfunc" id="1870944">len</span><span class="op" id="1870947">(</span><span class="ident" id="1870948">s</span><span class="op" id="1870949">)</span>&nbsp;<span class="op" id="1870951">==</span>&nbsp;<span class="num" id="1870954">0</span>&nbsp;<span class="op" id="1870956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870960">return</span>&nbsp;<span class="ident" id="1870967">nil</span><span class="op" id="1870970">,</span>&nbsp;<span class="ident" id="1870972">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1870983">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871008">sep</span>&nbsp;<span class="op" id="1871012">:=</span>&nbsp;<span class="ident" id="1871015">strings</span><span class="op" id="1871022">.</span><span class="ident" id="1871023">Index</span><span class="op" id="1871028">(</span><span class="ident" id="1871029">s</span><span class="op" id="1871030">,</span>&nbsp;<span class="string" id="1871032">&#34;/&#34;</span><span class="op" id="1871035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871038">if</span>&nbsp;<span class="ident" id="1871041">sep</span>&nbsp;<span class="op" id="1871045">&gt;=</span>&nbsp;<span class="num" id="1871048">0</span>&nbsp;<span class="op" id="1871050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871054">if</span>&nbsp;<span class="ident" id="1871057">_</span><span class="op" id="1871058">,</span>&nbsp;<span class="ident" id="1871060">ok</span>&nbsp;<span class="op" id="1871063">:=</span>&nbsp;<span class="ident" id="1871066">z</span><span class="op" id="1871067">.</span><span class="ident" id="1871068">a</span><span class="op" id="1871069">.</span><span class="ident" id="1871070">SetString</span><span class="op" id="1871079">(</span><span class="ident" id="1871080">s</span><span class="op" id="1871081">[</span><span class="num" id="1871082">0</span><span class="op" id="1871083">:</span><span class="ident" id="1871084">sep</span><span class="op" id="1871087">]</span><span class="op" id="1871088">,</span>&nbsp;<span class="num" id="1871090">10</span><span class="op" id="1871092">)</span><span class="op" id="1871093">;</span>&nbsp;<span class="op" id="1871095">!</span><span class="ident" id="1871096">ok</span>&nbsp;<span class="op" id="1871099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871104">return</span>&nbsp;<span class="ident" id="1871111">nil</span><span class="op" id="1871114">,</span>&nbsp;<span class="ident" id="1871116">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871124">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871128">s</span>&nbsp;<span class="op" id="1871130">=</span>&nbsp;<span class="ident" id="1871132">s</span><span class="op" id="1871133">[</span><span class="ident" id="1871134">sep</span><span class="op" id="1871137">+</span><span class="num" id="1871138">1</span><span class="op" id="1871139">:</span><span class="op" id="1871140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871144">var</span>&nbsp;<span class="ident" id="1871148">err</span>&nbsp;<span class="builtintype" id="1871152">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871160">if</span>&nbsp;<span class="ident" id="1871163">z</span><span class="op" id="1871164">.</span><span class="ident" id="1871165">b</span><span class="op" id="1871166">.</span><span class="ident" id="1871167">abs</span><span class="op" id="1871170">,</span>&nbsp;<span class="ident" id="1871172">_</span><span class="op" id="1871173">,</span>&nbsp;<span class="ident" id="1871175">err</span>&nbsp;<span class="op" id="1871179">=</span>&nbsp;<span class="ident" id="1871181">z</span><span class="op" id="1871182">.</span><span class="ident" id="1871183">b</span><span class="op" id="1871184">.</span><span class="ident" id="1871185">abs</span><span class="op" id="1871188">.</span><span class="ident" id="1871189">scan</span><span class="op" id="1871193">(</span><span class="ident" id="1871194">strings</span><span class="op" id="1871201">.</span><span class="ident" id="1871202">NewReader</span><span class="op" id="1871211">(</span><span class="ident" id="1871212">s</span><span class="op" id="1871213">)</span><span class="op" id="1871214">,</span>&nbsp;<span class="num" id="1871216">10</span><span class="op" id="1871218">)</span><span class="op" id="1871219">;</span>&nbsp;<span class="ident" id="1871221">err</span>&nbsp;<span class="op" id="1871225">!=</span>&nbsp;<span class="ident" id="1871228">nil</span>&nbsp;<span class="op" id="1871232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871237">return</span>&nbsp;<span class="ident" id="1871244">nil</span><span class="op" id="1871247">,</span>&nbsp;<span class="ident" id="1871249">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871257">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871261">if</span>&nbsp;<span class="builtinfunc" id="1871264">len</span><span class="op" id="1871267">(</span><span class="ident" id="1871268">z</span><span class="op" id="1871269">.</span><span class="ident" id="1871270">b</span><span class="op" id="1871271">.</span><span class="ident" id="1871272">abs</span><span class="op" id="1871275">)</span>&nbsp;<span class="op" id="1871277">==</span>&nbsp;<span class="num" id="1871280">0</span>&nbsp;<span class="op" id="1871282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871287">return</span>&nbsp;<span class="ident" id="1871294">nil</span><span class="op" id="1871297">,</span>&nbsp;<span class="ident" id="1871299">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871311">return</span>&nbsp;<span class="ident" id="1871318">z</span><span class="op" id="1871319">.</span><span class="ident" id="1871320">norm</span><span class="op" id="1871324">(</span><span class="op" id="1871325">)</span><span class="op" id="1871326">,</span>&nbsp;<span class="ident" id="1871328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871334">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871338">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871368">sep</span>&nbsp;<span class="op" id="1871372">=</span>&nbsp;<span class="ident" id="1871374">strings</span><span class="op" id="1871381">.</span><span class="ident" id="1871382">Index</span><span class="op" id="1871387">(</span><span class="ident" id="1871388">s</span><span class="op" id="1871389">,</span>&nbsp;<span class="string" id="1871391">&#34;.&#34;</span><span class="op" id="1871394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871397">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871423">e</span>&nbsp;<span class="op" id="1871425">:=</span>&nbsp;<span class="ident" id="1871428">strings</span><span class="op" id="1871435">.</span><span class="ident" id="1871436">IndexAny</span><span class="op" id="1871444">(</span><span class="ident" id="1871445">s</span><span class="op" id="1871446">,</span>&nbsp;<span class="string" id="1871448">&#34;eE&#34;</span><span class="op" id="1871452">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871455">var</span>&nbsp;<span class="ident" id="1871459">exp</span>&nbsp;<span class="ident" id="1871463">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871468">if</span>&nbsp;<span class="ident" id="1871471">e</span>&nbsp;<span class="op" id="1871473">&gt;=</span>&nbsp;<span class="num" id="1871476">0</span>&nbsp;<span class="op" id="1871478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871482">if</span>&nbsp;<span class="ident" id="1871485">e</span>&nbsp;<span class="op" id="1871487">&lt;</span>&nbsp;<span class="ident" id="1871489">sep</span>&nbsp;<span class="op" id="1871493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871498">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871545">return</span>&nbsp;<span class="ident" id="1871552">nil</span><span class="op" id="1871555">,</span>&nbsp;<span class="ident" id="1871557">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871569">if</span>&nbsp;<span class="ident" id="1871572">_</span><span class="op" id="1871573">,</span>&nbsp;<span class="ident" id="1871575">ok</span>&nbsp;<span class="op" id="1871578">:=</span>&nbsp;<span class="ident" id="1871581">exp</span><span class="op" id="1871584">.</span><span class="ident" id="1871585">SetString</span><span class="op" id="1871594">(</span><span class="ident" id="1871595">s</span><span class="op" id="1871596">[</span><span class="ident" id="1871597">e</span><span class="op" id="1871598">+</span><span class="num" id="1871599">1</span><span class="op" id="1871600">:</span><span class="op" id="1871601">]</span><span class="op" id="1871602">,</span>&nbsp;<span class="num" id="1871604">10</span><span class="op" id="1871606">)</span><span class="op" id="1871607">;</span>&nbsp;<span class="op" id="1871609">!</span><span class="ident" id="1871610">ok</span>&nbsp;<span class="op" id="1871613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871618">return</span>&nbsp;<span class="ident" id="1871625">nil</span><span class="op" id="1871628">,</span>&nbsp;<span class="ident" id="1871630">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871642">s</span>&nbsp;<span class="op" id="1871644">=</span>&nbsp;<span class="ident" id="1871646">s</span><span class="op" id="1871647">[</span><span class="num" id="1871648">0</span><span class="op" id="1871649">:</span><span class="ident" id="1871650">e</span><span class="op" id="1871651">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871657">if</span>&nbsp;<span class="ident" id="1871660">sep</span>&nbsp;<span class="op" id="1871664">&gt;=</span>&nbsp;<span class="num" id="1871667">0</span>&nbsp;<span class="op" id="1871669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871673">s</span>&nbsp;<span class="op" id="1871675">=</span>&nbsp;<span class="ident" id="1871677">s</span><span class="op" id="1871678">[</span><span class="num" id="1871679">0</span><span class="op" id="1871680">:</span><span class="ident" id="1871681">sep</span><span class="op" id="1871684">]</span>&nbsp;<span class="op" id="1871686">+</span>&nbsp;<span class="ident" id="1871688">s</span><span class="op" id="1871689">[</span><span class="ident" id="1871690">sep</span><span class="op" id="1871693">+</span><span class="num" id="1871694">1</span><span class="op" id="1871695">:</span><span class="op" id="1871696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871700">exp</span><span class="op" id="1871703">.</span><span class="ident" id="1871704">Sub</span><span class="op" id="1871707">(</span><span class="op" id="1871708">&amp;</span><span class="ident" id="1871709">exp</span><span class="op" id="1871712">,</span>&nbsp;<span class="ident" id="1871714">NewInt</span><span class="op" id="1871720">(</span><span class="ident" id="1871721">int64</span><span class="op" id="1871726">(</span><span class="builtinfunc" id="1871727">len</span><span class="op" id="1871730">(</span><span class="ident" id="1871731">s</span><span class="op" id="1871732">)</span><span class="op" id="1871733">-</span><span class="ident" id="1871734">sep</span><span class="op" id="1871737">)</span><span class="op" id="1871738">)</span><span class="op" id="1871739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871742">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871746">if</span>&nbsp;<span class="ident" id="1871749">_</span><span class="op" id="1871750">,</span>&nbsp;<span class="ident" id="1871752">ok</span>&nbsp;<span class="op" id="1871755">:=</span>&nbsp;<span class="ident" id="1871758">z</span><span class="op" id="1871759">.</span><span class="ident" id="1871760">a</span><span class="op" id="1871761">.</span><span class="ident" id="1871762">SetString</span><span class="op" id="1871771">(</span><span class="ident" id="1871772">s</span><span class="op" id="1871773">,</span>&nbsp;<span class="num" id="1871775">10</span><span class="op" id="1871777">)</span><span class="op" id="1871778">;</span>&nbsp;<span class="op" id="1871780">!</span><span class="ident" id="1871781">ok</span>&nbsp;<span class="op" id="1871784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871788">return</span>&nbsp;<span class="ident" id="1871795">nil</span><span class="op" id="1871798">,</span>&nbsp;<span class="ident" id="1871800">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871810">powTen</span>&nbsp;<span class="op" id="1871817">:=</span>&nbsp;<span class="ident" id="1871820">nat</span><span class="op" id="1871823">(</span><span class="ident" id="1871824">nil</span><span class="op" id="1871827">)</span><span class="op" id="1871828">.</span><span class="ident" id="1871829">expNN</span><span class="op" id="1871834">(</span><span class="ident" id="1871835">natTen</span><span class="op" id="1871841">,</span>&nbsp;<span class="ident" id="1871843">exp</span><span class="op" id="1871846">.</span><span class="ident" id="1871847">abs</span><span class="op" id="1871850">,</span>&nbsp;<span class="ident" id="1871852">nil</span><span class="op" id="1871855">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871858">if</span>&nbsp;<span class="ident" id="1871861">exp</span><span class="op" id="1871864">.</span><span class="ident" id="1871865">neg</span>&nbsp;<span class="op" id="1871869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871873">z</span><span class="op" id="1871874">.</span><span class="ident" id="1871875">b</span><span class="op" id="1871876">.</span><span class="ident" id="1871877">abs</span>&nbsp;<span class="op" id="1871881">=</span>&nbsp;<span class="ident" id="1871883">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871892">z</span><span class="op" id="1871893">.</span><span class="ident" id="1871894">norm</span><span class="op" id="1871898">(</span><span class="op" id="1871899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871902">}</span>&nbsp;<span class="keyword" id="1871904">else</span>&nbsp;<span class="op" id="1871909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871913">z</span><span class="op" id="1871914">.</span><span class="ident" id="1871915">a</span><span class="op" id="1871916">.</span><span class="ident" id="1871917">abs</span>&nbsp;<span class="op" id="1871921">=</span>&nbsp;<span class="ident" id="1871923">z</span><span class="op" id="1871924">.</span><span class="ident" id="1871925">a</span><span class="op" id="1871926">.</span><span class="ident" id="1871927">abs</span><span class="op" id="1871930">.</span><span class="ident" id="1871931">mul</span><span class="op" id="1871934">(</span><span class="ident" id="1871935">z</span><span class="op" id="1871936">.</span><span class="ident" id="1871937">a</span><span class="op" id="1871938">.</span><span class="ident" id="1871939">abs</span><span class="op" id="1871942">,</span>&nbsp;<span class="ident" id="1871944">powTen</span><span class="op" id="1871950">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871954">z</span><span class="op" id="1871955">.</span><span class="ident" id="1871956">b</span><span class="op" id="1871957">.</span><span class="ident" id="1871958">abs</span>&nbsp;<span class="op" id="1871962">=</span>&nbsp;<span class="ident" id="1871964">z</span><span class="op" id="1871965">.</span><span class="ident" id="1871966">b</span><span class="op" id="1871967">.</span><span class="ident" id="1871968">abs</span><span class="op" id="1871971">.</span><span class="builtinfunc" id="1871972">make</span><span class="op" id="1871976">(</span><span class="num" id="1871977">0</span><span class="op" id="1871978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871985">return</span>&nbsp;<span class="ident" id="1871992">z</span><span class="op" id="1871993">,</span>&nbsp;<span class="ident" id="1871995">true</span><br>
<span class="lineno"></span><span class="op" id="1872000">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="1872003">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="1872086">func</span>&nbsp;<span class="op" id="1872091">(</span><span class="ident" id="1872092">x</span>&nbsp;<span class="op" id="1872094">*</span><span class="ident" id="1872095">Rat</span><span class="op" id="1872098">)</span>&nbsp;<span class="ident" id="1872100">String</span><span class="op" id="1872106">(</span><span class="op" id="1872107">)</span>&nbsp;<span class="builtintype" id="1872109">string</span>&nbsp;<span class="op" id="1872116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872119">s</span>&nbsp;<span class="op" id="1872121">:=</span>&nbsp;<span class="string" id="1872124">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872130">if</span>&nbsp;<span class="builtinfunc" id="1872133">len</span><span class="op" id="1872136">(</span><span class="ident" id="1872137">x</span><span class="op" id="1872138">.</span><span class="ident" id="1872139">b</span><span class="op" id="1872140">.</span><span class="ident" id="1872141">abs</span><span class="op" id="1872144">)</span>&nbsp;<span class="op" id="1872146">!=</span>&nbsp;<span class="num" id="1872149">0</span>&nbsp;<span class="op" id="1872151">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872155">s</span>&nbsp;<span class="op" id="1872157">=</span>&nbsp;<span class="string" id="1872159">&#34;/&#34;</span>&nbsp;<span class="op" id="1872163">+</span>&nbsp;<span class="ident" id="1872165">x</span><span class="op" id="1872166">.</span><span class="ident" id="1872167">b</span><span class="op" id="1872168">.</span><span class="ident" id="1872169">abs</span><span class="op" id="1872172">.</span><span class="ident" id="1872173">decimalString</span><span class="op" id="1872186">(</span><span class="op" id="1872187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872193">return</span>&nbsp;<span class="ident" id="1872200">x</span><span class="op" id="1872201">.</span><span class="ident" id="1872202">a</span><span class="op" id="1872203">.</span><span class="ident" id="1872204">String</span><span class="op" id="1872210">(</span><span class="op" id="1872211">)</span>&nbsp;<span class="op" id="1872213">+</span>&nbsp;<span class="ident" id="1872215">s</span><br>
<span class="lineno"></span><span class="op" id="1872217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="1872220">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="1872299">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1872333">func</span>&nbsp;<span class="op" id="1872338">(</span><span class="ident" id="1872339">x</span>&nbsp;<span class="op" id="1872341">*</span><span class="ident" id="1872342">Rat</span><span class="op" id="1872345">)</span>&nbsp;<span class="ident" id="1872347">RatString</span><span class="op" id="1872356">(</span><span class="op" id="1872357">)</span>&nbsp;<span class="builtintype" id="1872359">string</span>&nbsp;<span class="op" id="1872366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872369">if</span>&nbsp;<span class="ident" id="1872372">x</span><span class="op" id="1872373">.</span><span class="ident" id="1872374">IsInt</span><span class="op" id="1872379">(</span><span class="op" id="1872380">)</span>&nbsp;<span class="op" id="1872382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872386">return</span>&nbsp;<span class="ident" id="1872393">x</span><span class="op" id="1872394">.</span><span class="ident" id="1872395">a</span><span class="op" id="1872396">.</span><span class="ident" id="1872397">String</span><span class="op" id="1872403">(</span><span class="op" id="1872404">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872410">return</span>&nbsp;<span class="ident" id="1872417">x</span><span class="op" id="1872418">.</span><span class="ident" id="1872419">String</span><span class="op" id="1872425">(</span><span class="op" id="1872426">)</span><br>
<span class="lineno"></span><span class="op" id="1872428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1872431">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="1872509">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="1872584">func</span>&nbsp;<span class="op" id="1872589">(</span><span class="ident" id="1872590">x</span>&nbsp;<span class="op" id="1872592">*</span><span class="ident" id="1872593">Rat</span><span class="op" id="1872596">)</span>&nbsp;<span class="ident" id="1872598">FloatString</span><span class="op" id="1872609">(</span><span class="ident" id="1872610">prec</span>&nbsp;<span class="builtintype" id="1872615">int</span><span class="op" id="1872618">)</span>&nbsp;<span class="builtintype" id="1872620">string</span>&nbsp;<span class="op" id="1872627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872630">if</span>&nbsp;<span class="ident" id="1872633">x</span><span class="op" id="1872634">.</span><span class="ident" id="1872635">IsInt</span><span class="op" id="1872640">(</span><span class="op" id="1872641">)</span>&nbsp;<span class="op" id="1872643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872647">s</span>&nbsp;<span class="op" id="1872649">:=</span>&nbsp;<span class="ident" id="1872652">x</span><span class="op" id="1872653">.</span><span class="ident" id="1872654">a</span><span class="op" id="1872655">.</span><span class="ident" id="1872656">String</span><span class="op" id="1872662">(</span><span class="op" id="1872663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872667">if</span>&nbsp;<span class="ident" id="1872670">prec</span>&nbsp;<span class="op" id="1872675">&gt;</span>&nbsp;<span class="num" id="1872677">0</span>&nbsp;<span class="op" id="1872679">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872684">s</span>&nbsp;<span class="op" id="1872686">+=</span>&nbsp;<span class="string" id="1872689">&#34;.&#34;</span>&nbsp;<span class="op" id="1872693">+</span>&nbsp;<span class="ident" id="1872695">strings</span><span class="op" id="1872702">.</span><span class="ident" id="1872703">Repeat</span><span class="op" id="1872709">(</span><span class="string" id="1872710">&#34;0&#34;</span><span class="op" id="1872713">,</span>&nbsp;<span class="ident" id="1872715">prec</span><span class="op" id="1872719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872727">return</span>&nbsp;<span class="ident" id="1872734">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872740">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872758">q</span><span class="op" id="1872759">,</span>&nbsp;<span class="ident" id="1872761">r</span>&nbsp;<span class="op" id="1872763">:=</span>&nbsp;<span class="ident" id="1872766">nat</span><span class="op" id="1872769">(</span><span class="ident" id="1872770">nil</span><span class="op" id="1872773">)</span><span class="op" id="1872774">.</span><span class="ident" id="1872775">div</span><span class="op" id="1872778">(</span><span class="ident" id="1872779">nat</span><span class="op" id="1872782">(</span><span class="ident" id="1872783">nil</span><span class="op" id="1872786">)</span><span class="op" id="1872787">,</span>&nbsp;<span class="ident" id="1872789">x</span><span class="op" id="1872790">.</span><span class="ident" id="1872791">a</span><span class="op" id="1872792">.</span><span class="ident" id="1872793">abs</span><span class="op" id="1872796">,</span>&nbsp;<span class="ident" id="1872798">x</span><span class="op" id="1872799">.</span><span class="ident" id="1872800">b</span><span class="op" id="1872801">.</span><span class="ident" id="1872802">abs</span><span class="op" id="1872805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872809">p</span>&nbsp;<span class="op" id="1872811">:=</span>&nbsp;<span class="ident" id="1872814">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872822">if</span>&nbsp;<span class="ident" id="1872825">prec</span>&nbsp;<span class="op" id="1872830">&gt;</span>&nbsp;<span class="num" id="1872832">0</span>&nbsp;<span class="op" id="1872834">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872838">p</span>&nbsp;<span class="op" id="1872840">=</span>&nbsp;<span class="ident" id="1872842">nat</span><span class="op" id="1872845">(</span><span class="ident" id="1872846">nil</span><span class="op" id="1872849">)</span><span class="op" id="1872850">.</span><span class="ident" id="1872851">expNN</span><span class="op" id="1872856">(</span><span class="ident" id="1872857">natTen</span><span class="op" id="1872863">,</span>&nbsp;<span class="ident" id="1872865">nat</span><span class="op" id="1872868">(</span><span class="ident" id="1872869">nil</span><span class="op" id="1872872">)</span><span class="op" id="1872873">.</span><span class="ident" id="1872874">setUint64</span><span class="op" id="1872883">(</span><span class="ident" id="1872884">uint64</span><span class="op" id="1872890">(</span><span class="ident" id="1872891">prec</span><span class="op" id="1872895">)</span><span class="op" id="1872896">)</span><span class="op" id="1872897">,</span>&nbsp;<span class="ident" id="1872899">nil</span><span class="op" id="1872902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872909">r</span>&nbsp;<span class="op" id="1872911">=</span>&nbsp;<span class="ident" id="1872913">r</span><span class="op" id="1872914">.</span><span class="ident" id="1872915">mul</span><span class="op" id="1872918">(</span><span class="ident" id="1872919">r</span><span class="op" id="1872920">,</span>&nbsp;<span class="ident" id="1872922">p</span><span class="op" id="1872923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872926">r</span><span class="op" id="1872927">,</span>&nbsp;<span class="ident" id="1872929">r2</span>&nbsp;<span class="op" id="1872932">:=</span>&nbsp;<span class="ident" id="1872935">r</span><span class="op" id="1872936">.</span><span class="ident" id="1872937">div</span><span class="op" id="1872940">(</span><span class="ident" id="1872941">nat</span><span class="op" id="1872944">(</span><span class="ident" id="1872945">nil</span><span class="op" id="1872948">)</span><span class="op" id="1872949">,</span>&nbsp;<span class="ident" id="1872951">r</span><span class="op" id="1872952">,</span>&nbsp;<span class="ident" id="1872954">x</span><span class="op" id="1872955">.</span><span class="ident" id="1872956">b</span><span class="op" id="1872957">.</span><span class="ident" id="1872958">abs</span><span class="op" id="1872961">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872965">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872996">r2</span>&nbsp;<span class="op" id="1872999">=</span>&nbsp;<span class="ident" id="1873001">r2</span><span class="op" id="1873003">.</span><span class="ident" id="1873004">add</span><span class="op" id="1873007">(</span><span class="ident" id="1873008">r2</span><span class="op" id="1873010">,</span>&nbsp;<span class="ident" id="1873012">r2</span><span class="op" id="1873014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873017">if</span>&nbsp;<span class="ident" id="1873020">x</span><span class="op" id="1873021">.</span><span class="ident" id="1873022">b</span><span class="op" id="1873023">.</span><span class="ident" id="1873024">abs</span><span class="op" id="1873027">.</span><span class="ident" id="1873028">cmp</span><span class="op" id="1873031">(</span><span class="ident" id="1873032">r2</span><span class="op" id="1873034">)</span>&nbsp;<span class="op" id="1873036">&lt;=</span>&nbsp;<span class="num" id="1873039">0</span>&nbsp;<span class="op" id="1873041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873045">r</span>&nbsp;<span class="op" id="1873047">=</span>&nbsp;<span class="ident" id="1873049">r</span><span class="op" id="1873050">.</span><span class="ident" id="1873051">add</span><span class="op" id="1873054">(</span><span class="ident" id="1873055">r</span><span class="op" id="1873056">,</span>&nbsp;<span class="ident" id="1873058">natOne</span><span class="op" id="1873064">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873068">if</span>&nbsp;<span class="ident" id="1873071">r</span><span class="op" id="1873072">.</span><span class="ident" id="1873073">cmp</span><span class="op" id="1873076">(</span><span class="ident" id="1873077">p</span><span class="op" id="1873078">)</span>&nbsp;<span class="op" id="1873080">&gt;=</span>&nbsp;<span class="num" id="1873083">0</span>&nbsp;<span class="op" id="1873085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873090">q</span>&nbsp;<span class="op" id="1873092">=</span>&nbsp;<span class="ident" id="1873094">nat</span><span class="op" id="1873097">(</span><span class="ident" id="1873098">nil</span><span class="op" id="1873101">)</span><span class="op" id="1873102">.</span><span class="ident" id="1873103">add</span><span class="op" id="1873106">(</span><span class="ident" id="1873107">q</span><span class="op" id="1873108">,</span>&nbsp;<span class="ident" id="1873110">natOne</span><span class="op" id="1873116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873121">r</span>&nbsp;<span class="op" id="1873123">=</span>&nbsp;<span class="ident" id="1873125">nat</span><span class="op" id="1873128">(</span><span class="ident" id="1873129">nil</span><span class="op" id="1873132">)</span><span class="op" id="1873133">.</span><span class="ident" id="1873134">sub</span><span class="op" id="1873137">(</span><span class="ident" id="1873138">r</span><span class="op" id="1873139">,</span>&nbsp;<span class="ident" id="1873141">p</span><span class="op" id="1873142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873149">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873153">s</span>&nbsp;<span class="op" id="1873155">:=</span>&nbsp;<span class="ident" id="1873158">q</span><span class="op" id="1873159">.</span><span class="ident" id="1873160">decimalString</span><span class="op" id="1873173">(</span><span class="op" id="1873174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873177">if</span>&nbsp;<span class="ident" id="1873180">x</span><span class="op" id="1873181">.</span><span class="ident" id="1873182">a</span><span class="op" id="1873183">.</span><span class="ident" id="1873184">neg</span>&nbsp;<span class="op" id="1873188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873192">s</span>&nbsp;<span class="op" id="1873194">=</span>&nbsp;<span class="string" id="1873196">&#34;-&#34;</span>&nbsp;<span class="op" id="1873200">+</span>&nbsp;<span class="ident" id="1873202">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873205">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873209">if</span>&nbsp;<span class="ident" id="1873212">prec</span>&nbsp;<span class="op" id="1873217">&gt;</span>&nbsp;<span class="num" id="1873219">0</span>&nbsp;<span class="op" id="1873221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873225">rs</span>&nbsp;<span class="op" id="1873228">:=</span>&nbsp;<span class="ident" id="1873231">r</span><span class="op" id="1873232">.</span><span class="ident" id="1873233">decimalString</span><span class="op" id="1873246">(</span><span class="op" id="1873247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873251">leadingZeros</span>&nbsp;<span class="op" id="1873264">:=</span>&nbsp;<span class="ident" id="1873267">prec</span>&nbsp;<span class="op" id="1873272">-</span>&nbsp;<span class="builtinfunc" id="1873274">len</span><span class="op" id="1873277">(</span><span class="ident" id="1873278">rs</span><span class="op" id="1873280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873284">s</span>&nbsp;<span class="op" id="1873286">+=</span>&nbsp;<span class="string" id="1873289">&#34;.&#34;</span>&nbsp;<span class="op" id="1873293">+</span>&nbsp;<span class="ident" id="1873295">strings</span><span class="op" id="1873302">.</span><span class="ident" id="1873303">Repeat</span><span class="op" id="1873309">(</span><span class="string" id="1873310">&#34;0&#34;</span><span class="op" id="1873313">,</span>&nbsp;<span class="ident" id="1873315">leadingZeros</span><span class="op" id="1873327">)</span>&nbsp;<span class="op" id="1873329">+</span>&nbsp;<span class="ident" id="1873331">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873339">return</span>&nbsp;<span class="ident" id="1873346">s</span><br>
<span class="lineno"></span><span class="op" id="1873348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="1873351">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1873426">const</span>&nbsp;<span class="ident" id="1873432">ratGobVersion</span>&nbsp;<span class="builtintype" id="1873446">byte</span>&nbsp;<span class="op" id="1873451">=</span>&nbsp;<span class="num" id="1873453">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1873456">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="1873510">func</span>&nbsp;<span class="op" id="1873515">(</span><span class="ident" id="1873516">x</span>&nbsp;<span class="op" id="1873518">*</span><span class="ident" id="1873519">Rat</span><span class="op" id="1873522">)</span>&nbsp;<span class="ident" id="1873524">GobEncode</span><span class="op" id="1873533">(</span><span class="op" id="1873534">)</span>&nbsp;<span class="op" id="1873536">(</span><span class="op" id="1873537">[</span><span class="op" id="1873538">]</span><span class="builtintype" id="1873539">byte</span><span class="op" id="1873543">,</span>&nbsp;<span class="builtintype" id="1873545">error</span><span class="op" id="1873550">)</span>&nbsp;<span class="op" id="1873552">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873555">if</span>&nbsp;<span class="ident" id="1873558">x</span>&nbsp;<span class="op" id="1873560">==</span>&nbsp;<span class="ident" id="1873563">nil</span>&nbsp;<span class="op" id="1873567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873571">return</span>&nbsp;<span class="ident" id="1873578">nil</span><span class="op" id="1873581">,</span>&nbsp;<span class="ident" id="1873583">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873591">buf</span>&nbsp;<span class="op" id="1873595">:=</span>&nbsp;<span class="builtinfunc" id="1873598">make</span><span class="op" id="1873602">(</span><span class="op" id="1873603">[</span><span class="op" id="1873604">]</span><span class="builtintype" id="1873605">byte</span><span class="op" id="1873609">,</span>&nbsp;<span class="num" id="1873611">1</span><span class="op" id="1873612">+</span><span class="num" id="1873613">4</span><span class="op" id="1873614">+</span><span class="op" id="1873615">(</span><span class="builtinfunc" id="1873616">len</span><span class="op" id="1873619">(</span><span class="ident" id="1873620">x</span><span class="op" id="1873621">.</span><span class="ident" id="1873622">a</span><span class="op" id="1873623">.</span><span class="ident" id="1873624">abs</span><span class="op" id="1873627">)</span><span class="op" id="1873628">+</span><span class="builtinfunc" id="1873629">len</span><span class="op" id="1873632">(</span><span class="ident" id="1873633">x</span><span class="op" id="1873634">.</span><span class="ident" id="1873635">b</span><span class="op" id="1873636">.</span><span class="ident" id="1873637">abs</span><span class="op" id="1873640">)</span><span class="op" id="1873641">)</span><span class="op" id="1873642">*</span><span class="ident" id="1873643">_S</span><span class="op" id="1873645">)</span>&nbsp;<span class="comment" id="1873647">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873718">i</span>&nbsp;<span class="op" id="1873720">:=</span>&nbsp;<span class="ident" id="1873723">x</span><span class="op" id="1873724">.</span><span class="ident" id="1873725">b</span><span class="op" id="1873726">.</span><span class="ident" id="1873727">abs</span><span class="op" id="1873730">.</span><span class="ident" id="1873731">bytes</span><span class="op" id="1873736">(</span><span class="ident" id="1873737">buf</span><span class="op" id="1873740">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873743">j</span>&nbsp;<span class="op" id="1873745">:=</span>&nbsp;<span class="ident" id="1873748">x</span><span class="op" id="1873749">.</span><span class="ident" id="1873750">a</span><span class="op" id="1873751">.</span><span class="ident" id="1873752">abs</span><span class="op" id="1873755">.</span><span class="ident" id="1873756">bytes</span><span class="op" id="1873761">(</span><span class="ident" id="1873762">buf</span><span class="op" id="1873765">[</span><span class="num" id="1873766">0</span><span class="op" id="1873767">:</span><span class="ident" id="1873768">i</span><span class="op" id="1873769">]</span><span class="op" id="1873770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873773">n</span>&nbsp;<span class="op" id="1873775">:=</span>&nbsp;<span class="ident" id="1873778">i</span>&nbsp;<span class="op" id="1873780">-</span>&nbsp;<span class="ident" id="1873782">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873785">if</span>&nbsp;<span class="builtintype" id="1873788">int</span><span class="op" id="1873791">(</span><span class="builtintype" id="1873792">uint32</span><span class="op" id="1873798">(</span><span class="ident" id="1873799">n</span><span class="op" id="1873800">)</span><span class="op" id="1873801">)</span>&nbsp;<span class="op" id="1873803">!=</span>&nbsp;<span class="ident" id="1873806">n</span>&nbsp;<span class="op" id="1873808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1873812">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873842">return</span>&nbsp;<span class="ident" id="1873849">nil</span><span class="op" id="1873852">,</span>&nbsp;<span class="ident" id="1873854">errors</span><span class="op" id="1873860">.</span><span class="ident" id="1873861">New</span><span class="op" id="1873864">(</span><span class="string" id="1873865">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="1873901">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873907">binary</span><span class="op" id="1873913">.</span><span class="ident" id="1873914">BigEndian</span><span class="op" id="1873923">.</span><span class="ident" id="1873924">PutUint32</span><span class="op" id="1873933">(</span><span class="ident" id="1873934">buf</span><span class="op" id="1873937">[</span><span class="ident" id="1873938">j</span><span class="op" id="1873939">-</span><span class="num" id="1873940">4</span><span class="op" id="1873941">:</span><span class="ident" id="1873942">j</span><span class="op" id="1873943">]</span><span class="op" id="1873944">,</span>&nbsp;<span class="builtintype" id="1873946">uint32</span><span class="op" id="1873952">(</span><span class="ident" id="1873953">n</span><span class="op" id="1873954">)</span><span class="op" id="1873955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873958">j</span>&nbsp;<span class="op" id="1873960">-=</span>&nbsp;<span class="num" id="1873963">1</span>&nbsp;<span class="op" id="1873965">+</span>&nbsp;<span class="num" id="1873967">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873970">b</span>&nbsp;<span class="op" id="1873972">:=</span>&nbsp;<span class="ident" id="1873975">ratGobVersion</span>&nbsp;<span class="op" id="1873989">&lt;&lt;</span>&nbsp;<span class="num" id="1873992">1</span>&nbsp;<span class="comment" id="1873994">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874022">if</span>&nbsp;<span class="ident" id="1874025">x</span><span class="op" id="1874026">.</span><span class="ident" id="1874027">a</span><span class="op" id="1874028">.</span><span class="ident" id="1874029">neg</span>&nbsp;<span class="op" id="1874033">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874037">b</span>&nbsp;<span class="op" id="1874039">|=</span>&nbsp;<span class="num" id="1874042">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874048">buf</span><span class="op" id="1874051">[</span><span class="ident" id="1874052">j</span><span class="op" id="1874053">]</span>&nbsp;<span class="op" id="1874055">=</span>&nbsp;<span class="ident" id="1874057">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874060">return</span>&nbsp;<span class="ident" id="1874067">buf</span><span class="op" id="1874070">[</span><span class="ident" id="1874071">j</span><span class="op" id="1874072">:</span><span class="op" id="1874073">]</span><span class="op" id="1874074">,</span>&nbsp;<span class="ident" id="1874076">nil</span><br>
<span class="lineno"></span><span class="op" id="1874080">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="1874083">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="1874137">func</span>&nbsp;<span class="op" id="1874142">(</span><span class="ident" id="1874143">z</span>&nbsp;<span class="op" id="1874145">*</span><span class="ident" id="1874146">Rat</span><span class="op" id="1874149">)</span>&nbsp;<span class="ident" id="1874151">GobDecode</span><span class="op" id="1874160">(</span><span class="ident" id="1874161">buf</span>&nbsp;<span class="op" id="1874165">[</span><span class="op" id="1874166">]</span><span class="builtintype" id="1874167">byte</span><span class="op" id="1874171">)</span>&nbsp;<span class="builtintype" id="1874173">error</span>&nbsp;<span class="op" id="1874179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874182">if</span>&nbsp;<span class="builtinfunc" id="1874185">len</span><span class="op" id="1874188">(</span><span class="ident" id="1874189">buf</span><span class="op" id="1874192">)</span>&nbsp;<span class="op" id="1874194">==</span>&nbsp;<span class="num" id="1874197">0</span>&nbsp;<span class="op" id="1874199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1874203">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874248">*</span><span class="ident" id="1874249">z</span>&nbsp;<span class="op" id="1874251">=</span>&nbsp;<span class="ident" id="1874253">Rat</span><span class="op" id="1874256">{</span><span class="op" id="1874257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874261">return</span>&nbsp;<span class="ident" id="1874268">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874276">b</span>&nbsp;<span class="op" id="1874278">:=</span>&nbsp;<span class="ident" id="1874281">buf</span><span class="op" id="1874284">[</span><span class="num" id="1874285">0</span><span class="op" id="1874286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874289">if</span>&nbsp;<span class="ident" id="1874292">b</span><span class="op" id="1874293">&gt;&gt;</span><span class="num" id="1874295">1</span>&nbsp;<span class="op" id="1874297">!=</span>&nbsp;<span class="ident" id="1874300">ratGobVersion</span>&nbsp;<span class="op" id="1874314">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874318">return</span>&nbsp;<span class="ident" id="1874325">errors</span><span class="op" id="1874331">.</span><span class="ident" id="1874332">New</span><span class="op" id="1874335">(</span><span class="ident" id="1874336">fmt</span><span class="op" id="1874339">.</span><span class="ident" id="1874340">Sprintf</span><span class="op" id="1874347">(</span><span class="string" id="1874348">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="1874398">,</span>&nbsp;<span class="ident" id="1874400">b</span><span class="op" id="1874401">&gt;&gt;</span><span class="num" id="1874403">1</span><span class="op" id="1874404">)</span><span class="op" id="1874405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874411">const</span>&nbsp;<span class="ident" id="1874417">j</span>&nbsp;<span class="op" id="1874419">=</span>&nbsp;<span class="num" id="1874421">1</span>&nbsp;<span class="op" id="1874423">+</span>&nbsp;<span class="num" id="1874425">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874428">i</span>&nbsp;<span class="op" id="1874430">:=</span>&nbsp;<span class="ident" id="1874433">j</span>&nbsp;<span class="op" id="1874435">+</span>&nbsp;<span class="ident" id="1874437">binary</span><span class="op" id="1874443">.</span><span class="ident" id="1874444">BigEndian</span><span class="op" id="1874453">.</span><span class="ident" id="1874454">Uint32</span><span class="op" id="1874460">(</span><span class="ident" id="1874461">buf</span><span class="op" id="1874464">[</span><span class="ident" id="1874465">j</span><span class="op" id="1874466">-</span><span class="num" id="1874467">4</span><span class="op" id="1874468">:</span><span class="ident" id="1874469">j</span><span class="op" id="1874470">]</span><span class="op" id="1874471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874474">z</span><span class="op" id="1874475">.</span><span class="ident" id="1874476">a</span><span class="op" id="1874477">.</span><span class="ident" id="1874478">neg</span>&nbsp;<span class="op" id="1874482">=</span>&nbsp;<span class="ident" id="1874484">b</span><span class="op" id="1874485">&amp;</span><span class="num" id="1874486">1</span>&nbsp;<span class="op" id="1874488">!=</span>&nbsp;<span class="num" id="1874491">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874494">z</span><span class="op" id="1874495">.</span><span class="ident" id="1874496">a</span><span class="op" id="1874497">.</span><span class="ident" id="1874498">abs</span>&nbsp;<span class="op" id="1874502">=</span>&nbsp;<span class="ident" id="1874504">z</span><span class="op" id="1874505">.</span><span class="ident" id="1874506">a</span><span class="op" id="1874507">.</span><span class="ident" id="1874508">abs</span><span class="op" id="1874511">.</span><span class="ident" id="1874512">setBytes</span><span class="op" id="1874520">(</span><span class="ident" id="1874521">buf</span><span class="op" id="1874524">[</span><span class="ident" id="1874525">j</span><span class="op" id="1874526">:</span><span class="ident" id="1874527">i</span><span class="op" id="1874528">]</span><span class="op" id="1874529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874532">z</span><span class="op" id="1874533">.</span><span class="ident" id="1874534">b</span><span class="op" id="1874535">.</span><span class="ident" id="1874536">abs</span>&nbsp;<span class="op" id="1874540">=</span>&nbsp;<span class="ident" id="1874542">z</span><span class="op" id="1874543">.</span><span class="ident" id="1874544">b</span><span class="op" id="1874545">.</span><span class="ident" id="1874546">abs</span><span class="op" id="1874549">.</span><span class="ident" id="1874550">setBytes</span><span class="op" id="1874558">(</span><span class="ident" id="1874559">buf</span><span class="op" id="1874562">[</span><span class="ident" id="1874563">i</span><span class="op" id="1874564">:</span><span class="op" id="1874565">]</span><span class="op" id="1874566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874569">return</span>&nbsp;<span class="ident" id="1874576">nil</span><br>
<span class="lineno"></span><span class="op" id="1874580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="1874583">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="1874647">func</span>&nbsp;<span class="op" id="1874652">(</span><span class="ident" id="1874653">r</span>&nbsp;<span class="op" id="1874655">*</span><span class="ident" id="1874656">Rat</span><span class="op" id="1874659">)</span>&nbsp;<span class="ident" id="1874661">MarshalText</span><span class="op" id="1874672">(</span><span class="op" id="1874673">)</span>&nbsp;<span class="op" id="1874675">(</span><span class="ident" id="1874676">text</span>&nbsp;<span class="op" id="1874681">[</span><span class="op" id="1874682">]</span><span class="builtintype" id="1874683">byte</span><span class="op" id="1874687">,</span>&nbsp;<span class="ident" id="1874689">err</span>&nbsp;<span class="builtintype" id="1874693">error</span><span class="op" id="1874698">)</span>&nbsp;<span class="op" id="1874700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874703">return</span>&nbsp;<span class="op" id="1874710">[</span><span class="op" id="1874711">]</span><span class="builtintype" id="1874712">byte</span><span class="op" id="1874716">(</span><span class="ident" id="1874717">r</span><span class="op" id="1874718">.</span><span class="ident" id="1874719">RatString</span><span class="op" id="1874728">(</span><span class="op" id="1874729">)</span><span class="op" id="1874730">)</span><span class="op" id="1874731">,</span>&nbsp;<span class="ident" id="1874733">nil</span><br>
<span class="lineno"></span><span class="op" id="1874737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="1874740">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="1874808">func</span>&nbsp;<span class="op" id="1874813">(</span><span class="ident" id="1874814">r</span>&nbsp;<span class="op" id="1874816">*</span><span class="ident" id="1874817">Rat</span><span class="op" id="1874820">)</span>&nbsp;<span class="ident" id="1874822">UnmarshalText</span><span class="op" id="1874835">(</span><span class="ident" id="1874836">text</span>&nbsp;<span class="op" id="1874841">[</span><span class="op" id="1874842">]</span><span class="builtintype" id="1874843">byte</span><span class="op" id="1874847">)</span>&nbsp;<span class="builtintype" id="1874849">error</span>&nbsp;<span class="op" id="1874855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874858">if</span>&nbsp;<span class="ident" id="1874861">_</span><span class="op" id="1874862">,</span>&nbsp;<span class="ident" id="1874864">ok</span>&nbsp;<span class="op" id="1874867">:=</span>&nbsp;<span class="ident" id="1874870">r</span><span class="op" id="1874871">.</span><span class="ident" id="1874872">SetString</span><span class="op" id="1874881">(</span><span class="builtintype" id="1874882">string</span><span class="op" id="1874888">(</span><span class="ident" id="1874889">text</span><span class="op" id="1874893">)</span><span class="op" id="1874894">)</span><span class="op" id="1874895">;</span>&nbsp;<span class="op" id="1874897">!</span><span class="ident" id="1874898">ok</span>&nbsp;<span class="op" id="1874901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874905">return</span>&nbsp;<span class="ident" id="1874912">fmt</span><span class="op" id="1874915">.</span><span class="ident" id="1874916">Errorf</span><span class="op" id="1874922">(</span><span class="string" id="1874923">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="1874970">,</span>&nbsp;<span class="ident" id="1874972">text</span><span class="op" id="1874976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874979">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874982">return</span>&nbsp;<span class="ident" id="1874989">nil</span><br>
<span class="lineno"></span><span class="op" id="1874993">}</span>
</div>
</body>
</html>
