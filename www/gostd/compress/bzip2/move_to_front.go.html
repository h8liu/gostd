<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5907249">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5907304">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5907358">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5907409">package</span>&nbsp;<span class="ident" id="5907417">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907424">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5907497">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5907574">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5907653">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5907732">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5907810">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5907889">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5907963">type</span>&nbsp;<span class="ident" id="5907968">moveToFrontDecoder</span>&nbsp;<span class="op" id="5907987">[</span><span class="op" id="5907988">]</span><span class="builtintype" id="5907989">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5907995">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5908074">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5908089">func</span>&nbsp;<span class="ident" id="5908094">newMTFDecoder</span><span class="op" id="5908107">(</span><span class="ident" id="5908108">symbols</span>&nbsp;<span class="op" id="5908116">[</span><span class="op" id="5908117">]</span><span class="builtintype" id="5908118">byte</span><span class="op" id="5908122">)</span>&nbsp;<span class="ident" id="5908124">moveToFrontDecoder</span>&nbsp;<span class="op" id="5908143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908146">if</span>&nbsp;<span class="builtinfunc" id="5908149">len</span><span class="op" id="5908152">(</span><span class="ident" id="5908153">symbols</span><span class="op" id="5908160">)</span>&nbsp;<span class="op" id="5908162">&gt;</span>&nbsp;<span class="num" id="5908164">256</span>&nbsp;<span class="op" id="5908168">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5908172">panic</span><span class="op" id="5908177">(</span><span class="string" id="5908178">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5908196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908202">return</span>&nbsp;<span class="ident" id="5908209">moveToFrontDecoder</span><span class="op" id="5908227">(</span><span class="ident" id="5908228">symbols</span><span class="op" id="5908235">)</span><br>
<span class="lineno"></span><span class="op" id="5908237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5908240">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5908314">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5908341">func</span>&nbsp;<span class="ident" id="5908346">newMTFDecoderWithRange</span><span class="op" id="5908368">(</span><span class="ident" id="5908369">n</span>&nbsp;<span class="builtintype" id="5908371">int</span><span class="op" id="5908374">)</span>&nbsp;<span class="ident" id="5908376">moveToFrontDecoder</span>&nbsp;<span class="op" id="5908395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908398">if</span>&nbsp;<span class="ident" id="5908401">n</span>&nbsp;<span class="op" id="5908403">&gt;</span>&nbsp;<span class="num" id="5908405">256</span>&nbsp;<span class="op" id="5908409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5908413">panic</span><span class="op" id="5908418">(</span><span class="string" id="5908419">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5908470">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908477">m</span>&nbsp;<span class="op" id="5908479">:=</span>&nbsp;<span class="builtinfunc" id="5908482">make</span><span class="op" id="5908486">(</span><span class="op" id="5908487">[</span><span class="op" id="5908488">]</span><span class="builtintype" id="5908489">byte</span><span class="op" id="5908493">,</span>&nbsp;<span class="ident" id="5908495">n</span><span class="op" id="5908496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908499">for</span>&nbsp;<span class="ident" id="5908503">i</span>&nbsp;<span class="op" id="5908505">:=</span>&nbsp;<span class="num" id="5908508">0</span><span class="op" id="5908509">;</span>&nbsp;<span class="ident" id="5908511">i</span>&nbsp;<span class="op" id="5908513">&lt;</span>&nbsp;<span class="ident" id="5908515">n</span><span class="op" id="5908516">;</span>&nbsp;<span class="ident" id="5908518">i</span><span class="op" id="5908519">++</span>&nbsp;<span class="op" id="5908522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908526">m</span><span class="op" id="5908527">[</span><span class="ident" id="5908528">i</span><span class="op" id="5908529">]</span>&nbsp;<span class="op" id="5908531">=</span>&nbsp;<span class="builtintype" id="5908533">byte</span><span class="op" id="5908537">(</span><span class="ident" id="5908538">i</span><span class="op" id="5908539">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908545">return</span>&nbsp;<span class="ident" id="5908552">moveToFrontDecoder</span><span class="op" id="5908570">(</span><span class="ident" id="5908571">m</span><span class="op" id="5908572">)</span><br>
<span class="lineno"></span><span class="op" id="5908574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5908577">func</span>&nbsp;<span class="op" id="5908582">(</span><span class="ident" id="5908583">m</span>&nbsp;<span class="ident" id="5908585">moveToFrontDecoder</span><span class="op" id="5908603">)</span>&nbsp;<span class="ident" id="5908605">Decode</span><span class="op" id="5908611">(</span><span class="ident" id="5908612">n</span>&nbsp;<span class="builtintype" id="5908614">int</span><span class="op" id="5908617">)</span>&nbsp;<span class="op" id="5908619">(</span><span class="ident" id="5908620">b</span>&nbsp;<span class="builtintype" id="5908622">byte</span><span class="op" id="5908626">)</span>&nbsp;<span class="op" id="5908628">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908631">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908693">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908759">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908817">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908884">b</span>&nbsp;<span class="op" id="5908886">=</span>&nbsp;<span class="ident" id="5908888">m</span><span class="op" id="5908889">[</span><span class="ident" id="5908890">n</span><span class="op" id="5908891">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5908894">copy</span><span class="op" id="5908898">(</span><span class="ident" id="5908899">m</span><span class="op" id="5908900">[</span><span class="num" id="5908901">1</span><span class="op" id="5908902">:</span><span class="op" id="5908903">]</span><span class="op" id="5908904">,</span>&nbsp;<span class="ident" id="5908906">m</span><span class="op" id="5908907">[</span><span class="op" id="5908908">:</span><span class="ident" id="5908909">n</span><span class="op" id="5908910">]</span><span class="op" id="5908911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908914">m</span><span class="op" id="5908915">[</span><span class="num" id="5908916">0</span><span class="op" id="5908917">]</span>&nbsp;<span class="op" id="5908919">=</span>&nbsp;<span class="ident" id="5908921">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908924">return</span><br>
<span class="lineno"></span><span class="op" id="5908931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5908934">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5908988">func</span>&nbsp;<span class="op" id="5908993">(</span><span class="ident" id="5908994">m</span>&nbsp;<span class="ident" id="5908996">moveToFrontDecoder</span><span class="op" id="5909014">)</span>&nbsp;<span class="ident" id="5909016">First</span><span class="op" id="5909021">(</span><span class="op" id="5909022">)</span>&nbsp;<span class="builtintype" id="5909024">byte</span>&nbsp;<span class="op" id="5909029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909032">return</span>&nbsp;<span class="ident" id="5909039">m</span><span class="op" id="5909040">[</span><span class="num" id="5909041">0</span><span class="op" id="5909042">]</span><br>
<span class="lineno"></span><span class="op" id="5909044">}</span>
</div>
</body>
</html>
