<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3365208">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3365263">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3365317">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3365368">package</span>&nbsp;<span class="ident" id="3365376">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3365384">import</span>&nbsp;<span class="op" id="3365391">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3365394">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3365400">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3365416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365419">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="3365488">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="3365573">type</span>&nbsp;<span class="ident" id="3365578">queue</span>&nbsp;<span class="keyword" id="3365584">struct</span>&nbsp;<span class="op" id="3365591">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365594">sparse</span>&nbsp;<span class="op" id="3365601">[</span><span class="op" id="3365602">]</span><span class="builtintype" id="3365603">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365611">dense</span>&nbsp;&nbsp;<span class="op" id="3365618">[</span><span class="op" id="3365619">]</span><span class="ident" id="3365620">entry</span><br>
<span class="lineno"></span><span class="op" id="3365626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365629">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="3365664">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="3365723">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="3365788">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3365853">type</span>&nbsp;<span class="ident" id="3365858">entry</span>&nbsp;<span class="keyword" id="3365864">struct</span>&nbsp;<span class="op" id="3365871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365874">pc</span>&nbsp;<span class="builtintype" id="3365877">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365885">t</span>&nbsp;&nbsp;<span class="op" id="3365888">*</span><span class="ident" id="3365889">thread</span><br>
<span class="lineno"></span><span class="op" id="3365896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365899">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="3365962">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="3366015">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="3366064">type</span>&nbsp;<span class="ident" id="3366069">thread</span>&nbsp;<span class="keyword" id="3366076">struct</span>&nbsp;<span class="op" id="3366083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366086">inst</span>&nbsp;<span class="op" id="3366091">*</span><span class="ident" id="3366092">syntax</span><span class="op" id="3366098">.</span><span class="ident" id="3366099">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3366105">cap</span>&nbsp;&nbsp;<span class="op" id="3366110">[</span><span class="op" id="3366111">]</span><span class="builtintype" id="3366112">int</span><br>
<span class="lineno"></span><span class="op" id="3366116">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3366119">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3366184">type</span>&nbsp;<span class="ident" id="3366189">machine</span>&nbsp;<span class="keyword" id="3366197">struct</span>&nbsp;<span class="op" id="3366204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366207">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3366216">*</span><span class="ident" id="3366217">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3366229">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366254">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3366263">*</span><span class="ident" id="3366264">syntax</span><span class="op" id="3366270">.</span><span class="ident" id="3366271">Prog</span>&nbsp;<span class="comment" id="3366276">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366297">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3366306">*</span><span class="ident" id="3366307">onePassProg</span>&nbsp;<span class="comment" id="3366319">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366363">q0</span><span class="op" id="3366365">,</span>&nbsp;<span class="ident" id="3366367">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3366372">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3366385">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366416">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3366425">[</span><span class="op" id="3366426">]</span><span class="op" id="3366427">*</span><span class="ident" id="3366428">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3366438">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366468">matched</span>&nbsp;&nbsp;<span class="builtintype" id="3366477">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3366490">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366520">matchcap</span>&nbsp;<span class="op" id="3366529">[</span><span class="op" id="3366530">]</span><span class="builtintype" id="3366531">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3366542">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366581">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366620">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="3366632">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366644">inputString</span>&nbsp;<span class="ident" id="3366656">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366669">inputReader</span>&nbsp;<span class="ident" id="3366681">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="3366693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366696">func</span>&nbsp;<span class="op" id="3366701">(</span><span class="ident" id="3366702">m</span>&nbsp;<span class="op" id="3366704">*</span><span class="ident" id="3366705">machine</span><span class="op" id="3366712">)</span>&nbsp;<span class="ident" id="3366714">newInputBytes</span><span class="op" id="3366727">(</span><span class="ident" id="3366728">b</span>&nbsp;<span class="op" id="3366730">[</span><span class="op" id="3366731">]</span><span class="builtintype" id="3366732">byte</span><span class="op" id="3366736">)</span>&nbsp;<span class="ident" id="3366738">input</span>&nbsp;<span class="op" id="3366744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366747">m</span><span class="op" id="3366748">.</span><span class="ident" id="3366749">inputBytes</span><span class="op" id="3366759">.</span><span class="ident" id="3366760">str</span>&nbsp;<span class="op" id="3366764">=</span>&nbsp;<span class="ident" id="3366766">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366769">return</span>&nbsp;<span class="op" id="3366776">&amp;</span><span class="ident" id="3366777">m</span><span class="op" id="3366778">.</span><span class="ident" id="3366779">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="3366790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366793">func</span>&nbsp;<span class="op" id="3366798">(</span><span class="ident" id="3366799">m</span>&nbsp;<span class="op" id="3366801">*</span><span class="ident" id="3366802">machine</span><span class="op" id="3366809">)</span>&nbsp;<span class="ident" id="3366811">newInputString</span><span class="op" id="3366825">(</span><span class="ident" id="3366826">s</span>&nbsp;<span class="builtintype" id="3366828">string</span><span class="op" id="3366834">)</span>&nbsp;<span class="ident" id="3366836">input</span>&nbsp;<span class="op" id="3366842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366845">m</span><span class="op" id="3366846">.</span><span class="ident" id="3366847">inputString</span><span class="op" id="3366858">.</span><span class="ident" id="3366859">str</span>&nbsp;<span class="op" id="3366863">=</span>&nbsp;<span class="ident" id="3366865">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366868">return</span>&nbsp;<span class="op" id="3366875">&amp;</span><span class="ident" id="3366876">m</span><span class="op" id="3366877">.</span><span class="ident" id="3366878">inputString</span><br>
<span class="lineno">60</span><span class="op" id="3366890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366893">func</span>&nbsp;<span class="op" id="3366898">(</span><span class="ident" id="3366899">m</span>&nbsp;<span class="op" id="3366901">*</span><span class="ident" id="3366902">machine</span><span class="op" id="3366909">)</span>&nbsp;<span class="ident" id="3366911">newInputReader</span><span class="op" id="3366925">(</span><span class="ident" id="3366926">r</span>&nbsp;<span class="ident" id="3366928">io</span><span class="op" id="3366930">.</span><span class="ident" id="3366931">RuneReader</span><span class="op" id="3366941">)</span>&nbsp;<span class="ident" id="3366943">input</span>&nbsp;<span class="op" id="3366949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366952">m</span><span class="op" id="3366953">.</span><span class="ident" id="3366954">inputReader</span><span class="op" id="3366965">.</span><span class="ident" id="3366966">r</span>&nbsp;<span class="op" id="3366968">=</span>&nbsp;<span class="ident" id="3366970">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366973">m</span><span class="op" id="3366974">.</span><span class="ident" id="3366975">inputReader</span><span class="op" id="3366986">.</span><span class="ident" id="3366987">atEOT</span>&nbsp;<span class="op" id="3366993">=</span>&nbsp;<span class="builtintype" id="3366995">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367002">m</span><span class="op" id="3367003">.</span><span class="ident" id="3367004">inputReader</span><span class="op" id="3367015">.</span><span class="ident" id="3367016">pos</span>&nbsp;<span class="op" id="3367020">=</span>&nbsp;<span class="num" id="3367022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367025">return</span>&nbsp;<span class="op" id="3367032">&amp;</span><span class="ident" id="3367033">m</span><span class="op" id="3367034">.</span><span class="ident" id="3367035">inputReader</span><br>
<span class="lineno"></span><span class="op" id="3367047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3367050">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="3367107">func</span>&nbsp;<span class="ident" id="3367112">progMachine</span><span class="op" id="3367123">(</span><span class="ident" id="3367124">p</span>&nbsp;<span class="op" id="3367126">*</span><span class="ident" id="3367127">syntax</span><span class="op" id="3367133">.</span><span class="ident" id="3367134">Prog</span><span class="op" id="3367138">,</span>&nbsp;<span class="ident" id="3367140">op</span>&nbsp;<span class="op" id="3367143">*</span><span class="ident" id="3367144">onePassProg</span><span class="op" id="3367155">)</span>&nbsp;<span class="op" id="3367157">*</span><span class="ident" id="3367158">machine</span>&nbsp;<span class="op" id="3367166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367169">m</span>&nbsp;<span class="op" id="3367171">:=</span>&nbsp;<span class="op" id="3367174">&amp;</span><span class="ident" id="3367175">machine</span><span class="op" id="3367182">{</span><span class="ident" id="3367183">p</span><span class="op" id="3367184">:</span>&nbsp;<span class="ident" id="3367186">p</span><span class="op" id="3367187">,</span>&nbsp;<span class="ident" id="3367189">op</span><span class="op" id="3367191">:</span>&nbsp;<span class="ident" id="3367193">op</span><span class="op" id="3367195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367198">n</span>&nbsp;<span class="op" id="3367200">:=</span>&nbsp;<span class="builtinfunc" id="3367203">len</span><span class="op" id="3367206">(</span><span class="ident" id="3367207">m</span><span class="op" id="3367208">.</span><span class="ident" id="3367209">p</span><span class="op" id="3367210">.</span><span class="ident" id="3367211">Inst</span><span class="op" id="3367215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367218">m</span><span class="op" id="3367219">.</span><span class="ident" id="3367220">q0</span>&nbsp;<span class="op" id="3367223">=</span>&nbsp;<span class="ident" id="3367225">queue</span><span class="op" id="3367230">{</span><span class="builtinfunc" id="3367231">make</span><span class="op" id="3367235">(</span><span class="op" id="3367236">[</span><span class="op" id="3367237">]</span><span class="builtintype" id="3367238">uint32</span><span class="op" id="3367244">,</span>&nbsp;<span class="ident" id="3367246">n</span><span class="op" id="3367247">)</span><span class="op" id="3367248">,</span>&nbsp;<span class="builtinfunc" id="3367250">make</span><span class="op" id="3367254">(</span><span class="op" id="3367255">[</span><span class="op" id="3367256">]</span><span class="ident" id="3367257">entry</span><span class="op" id="3367262">,</span>&nbsp;<span class="num" id="3367264">0</span><span class="op" id="3367265">,</span>&nbsp;<span class="ident" id="3367267">n</span><span class="op" id="3367268">)</span><span class="op" id="3367269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367272">m</span><span class="op" id="3367273">.</span><span class="ident" id="3367274">q1</span>&nbsp;<span class="op" id="3367277">=</span>&nbsp;<span class="ident" id="3367279">queue</span><span class="op" id="3367284">{</span><span class="builtinfunc" id="3367285">make</span><span class="op" id="3367289">(</span><span class="op" id="3367290">[</span><span class="op" id="3367291">]</span><span class="builtintype" id="3367292">uint32</span><span class="op" id="3367298">,</span>&nbsp;<span class="ident" id="3367300">n</span><span class="op" id="3367301">)</span><span class="op" id="3367302">,</span>&nbsp;<span class="builtinfunc" id="3367304">make</span><span class="op" id="3367308">(</span><span class="op" id="3367309">[</span><span class="op" id="3367310">]</span><span class="ident" id="3367311">entry</span><span class="op" id="3367316">,</span>&nbsp;<span class="num" id="3367318">0</span><span class="op" id="3367319">,</span>&nbsp;<span class="ident" id="3367321">n</span><span class="op" id="3367322">)</span><span class="op" id="3367323">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367326">ncap</span>&nbsp;<span class="op" id="3367331">:=</span>&nbsp;<span class="ident" id="3367334">p</span><span class="op" id="3367335">.</span><span class="ident" id="3367336">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367344">if</span>&nbsp;<span class="ident" id="3367347">ncap</span>&nbsp;<span class="op" id="3367352">&lt;</span>&nbsp;<span class="num" id="3367354">2</span>&nbsp;<span class="op" id="3367356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367360">ncap</span>&nbsp;<span class="op" id="3367365">=</span>&nbsp;<span class="num" id="3367367">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367373">m</span><span class="op" id="3367374">.</span><span class="ident" id="3367375">matchcap</span>&nbsp;<span class="op" id="3367384">=</span>&nbsp;<span class="builtinfunc" id="3367386">make</span><span class="op" id="3367390">(</span><span class="op" id="3367391">[</span><span class="op" id="3367392">]</span><span class="builtintype" id="3367393">int</span><span class="op" id="3367396">,</span>&nbsp;<span class="ident" id="3367398">ncap</span><span class="op" id="3367402">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367405">return</span>&nbsp;<span class="ident" id="3367412">m</span><br>
<span class="lineno"></span><span class="op" id="3367414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3367417">func</span>&nbsp;<span class="op" id="3367422">(</span><span class="ident" id="3367423">m</span>&nbsp;<span class="op" id="3367425">*</span><span class="ident" id="3367426">machine</span><span class="op" id="3367433">)</span>&nbsp;<span class="ident" id="3367435">init</span><span class="op" id="3367439">(</span><span class="ident" id="3367440">ncap</span>&nbsp;<span class="builtintype" id="3367445">int</span><span class="op" id="3367448">)</span>&nbsp;<span class="op" id="3367450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367453">for</span>&nbsp;<span class="ident" id="3367457">_</span><span class="op" id="3367458">,</span>&nbsp;<span class="ident" id="3367460">t</span>&nbsp;<span class="op" id="3367462">:=</span>&nbsp;<span class="keyword" id="3367465">range</span>&nbsp;<span class="ident" id="3367471">m</span><span class="op" id="3367472">.</span><span class="ident" id="3367473">pool</span>&nbsp;<span class="op" id="3367478">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367482">t</span><span class="op" id="3367483">.</span><span class="builtinfunc" id="3367484">cap</span>&nbsp;<span class="op" id="3367488">=</span>&nbsp;<span class="ident" id="3367490">t</span><span class="op" id="3367491">.</span><span class="builtinfunc" id="3367492">cap</span><span class="op" id="3367495">[</span><span class="op" id="3367496">:</span><span class="ident" id="3367497">ncap</span><span class="op" id="3367501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367507">m</span><span class="op" id="3367508">.</span><span class="ident" id="3367509">matchcap</span>&nbsp;<span class="op" id="3367518">=</span>&nbsp;<span class="ident" id="3367520">m</span><span class="op" id="3367521">.</span><span class="ident" id="3367522">matchcap</span><span class="op" id="3367530">[</span><span class="op" id="3367531">:</span><span class="ident" id="3367532">ncap</span><span class="op" id="3367536">]</span><br>
<span class="lineno"></span><span class="op" id="3367538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3367541">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3367601">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3367639">func</span>&nbsp;<span class="op" id="3367644">(</span><span class="ident" id="3367645">m</span>&nbsp;<span class="op" id="3367647">*</span><span class="ident" id="3367648">machine</span><span class="op" id="3367655">)</span>&nbsp;<span class="ident" id="3367657">alloc</span><span class="op" id="3367662">(</span><span class="ident" id="3367663">i</span>&nbsp;<span class="op" id="3367665">*</span><span class="ident" id="3367666">syntax</span><span class="op" id="3367672">.</span><span class="ident" id="3367673">Inst</span><span class="op" id="3367677">)</span>&nbsp;<span class="op" id="3367679">*</span><span class="ident" id="3367680">thread</span>&nbsp;<span class="op" id="3367687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367690">var</span>&nbsp;<span class="ident" id="3367694">t</span>&nbsp;<span class="op" id="3367696">*</span><span class="ident" id="3367697">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367705">if</span>&nbsp;<span class="ident" id="3367708">n</span>&nbsp;<span class="op" id="3367710">:=</span>&nbsp;<span class="builtinfunc" id="3367713">len</span><span class="op" id="3367716">(</span><span class="ident" id="3367717">m</span><span class="op" id="3367718">.</span><span class="ident" id="3367719">pool</span><span class="op" id="3367723">)</span><span class="op" id="3367724">;</span>&nbsp;<span class="ident" id="3367726">n</span>&nbsp;<span class="op" id="3367728">&gt;</span>&nbsp;<span class="num" id="3367730">0</span>&nbsp;<span class="op" id="3367732">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367736">t</span>&nbsp;<span class="op" id="3367738">=</span>&nbsp;<span class="ident" id="3367740">m</span><span class="op" id="3367741">.</span><span class="ident" id="3367742">pool</span><span class="op" id="3367746">[</span><span class="ident" id="3367747">n</span><span class="op" id="3367748">-</span><span class="num" id="3367749">1</span><span class="op" id="3367750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367754">m</span><span class="op" id="3367755">.</span><span class="ident" id="3367756">pool</span>&nbsp;<span class="op" id="3367761">=</span>&nbsp;<span class="ident" id="3367763">m</span><span class="op" id="3367764">.</span><span class="ident" id="3367765">pool</span><span class="op" id="3367769">[</span><span class="op" id="3367770">:</span><span class="ident" id="3367771">n</span><span class="op" id="3367772">-</span><span class="num" id="3367773">1</span><span class="op" id="3367774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367777">}</span>&nbsp;<span class="keyword" id="3367779">else</span>&nbsp;<span class="op" id="3367784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367788">t</span>&nbsp;<span class="op" id="3367790">=</span>&nbsp;<span class="builtinfunc" id="3367792">new</span><span class="op" id="3367795">(</span><span class="ident" id="3367796">thread</span><span class="op" id="3367802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367806">t</span><span class="op" id="3367807">.</span><span class="builtinfunc" id="3367808">cap</span>&nbsp;<span class="op" id="3367812">=</span>&nbsp;<span class="builtinfunc" id="3367814">make</span><span class="op" id="3367818">(</span><span class="op" id="3367819">[</span><span class="op" id="3367820">]</span><span class="builtintype" id="3367821">int</span><span class="op" id="3367824">,</span>&nbsp;<span class="builtinfunc" id="3367826">len</span><span class="op" id="3367829">(</span><span class="ident" id="3367830">m</span><span class="op" id="3367831">.</span><span class="ident" id="3367832">matchcap</span><span class="op" id="3367840">)</span><span class="op" id="3367841">,</span>&nbsp;<span class="builtinfunc" id="3367843">cap</span><span class="op" id="3367846">(</span><span class="ident" id="3367847">m</span><span class="op" id="3367848">.</span><span class="ident" id="3367849">matchcap</span><span class="op" id="3367857">)</span><span class="op" id="3367858">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367864">t</span><span class="op" id="3367865">.</span><span class="ident" id="3367866">inst</span>&nbsp;<span class="op" id="3367871">=</span>&nbsp;<span class="ident" id="3367873">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367876">return</span>&nbsp;<span class="ident" id="3367883">t</span><br>
<span class="lineno"></span><span class="op" id="3367885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3367888">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3367924">func</span>&nbsp;<span class="op" id="3367929">(</span><span class="ident" id="3367930">m</span>&nbsp;<span class="op" id="3367932">*</span><span class="ident" id="3367933">machine</span><span class="op" id="3367940">)</span>&nbsp;<span class="ident" id="3367942">free</span><span class="op" id="3367946">(</span><span class="ident" id="3367947">t</span>&nbsp;<span class="op" id="3367949">*</span><span class="ident" id="3367950">thread</span><span class="op" id="3367956">)</span>&nbsp;<span class="op" id="3367958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367961">m</span><span class="op" id="3367962">.</span><span class="ident" id="3367963">inputBytes</span><span class="op" id="3367973">.</span><span class="ident" id="3367974">str</span>&nbsp;<span class="op" id="3367978">=</span>&nbsp;<span class="ident" id="3367980">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367985">m</span><span class="op" id="3367986">.</span><span class="ident" id="3367987">inputString</span><span class="op" id="3367998">.</span><span class="ident" id="3367999">str</span>&nbsp;<span class="op" id="3368003">=</span>&nbsp;<span class="string" id="3368005">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368009">m</span><span class="op" id="3368010">.</span><span class="ident" id="3368011">inputReader</span><span class="op" id="3368022">.</span><span class="ident" id="3368023">r</span>&nbsp;<span class="op" id="3368025">=</span>&nbsp;<span class="ident" id="3368027">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368032">m</span><span class="op" id="3368033">.</span><span class="ident" id="3368034">pool</span>&nbsp;<span class="op" id="3368039">=</span>&nbsp;<span class="builtinfunc" id="3368041">append</span><span class="op" id="3368047">(</span><span class="ident" id="3368048">m</span><span class="op" id="3368049">.</span><span class="ident" id="3368050">pool</span><span class="op" id="3368054">,</span>&nbsp;<span class="ident" id="3368056">t</span><span class="op" id="3368057">)</span><br>
<span class="lineno"></span><span class="op" id="3368059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3368062">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3368120">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="3368161">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3368214">func</span>&nbsp;<span class="op" id="3368219">(</span><span class="ident" id="3368220">m</span>&nbsp;<span class="op" id="3368222">*</span><span class="ident" id="3368223">machine</span><span class="op" id="3368230">)</span>&nbsp;<span class="ident" id="3368232">match</span><span class="op" id="3368237">(</span><span class="ident" id="3368238">i</span>&nbsp;<span class="ident" id="3368240">input</span><span class="op" id="3368245">,</span>&nbsp;<span class="ident" id="3368247">pos</span>&nbsp;<span class="builtintype" id="3368251">int</span><span class="op" id="3368254">)</span>&nbsp;<span class="builtintype" id="3368256">bool</span>&nbsp;<span class="op" id="3368261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368264">startCond</span>&nbsp;<span class="op" id="3368274">:=</span>&nbsp;<span class="ident" id="3368277">m</span><span class="op" id="3368278">.</span><span class="ident" id="3368279">re</span><span class="op" id="3368281">.</span><span class="ident" id="3368282">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368288">if</span>&nbsp;<span class="ident" id="3368291">startCond</span>&nbsp;<span class="op" id="3368301">==</span>&nbsp;<span class="op" id="3368304">^</span><span class="ident" id="3368305">syntax</span><span class="op" id="3368311">.</span><span class="ident" id="3368312">EmptyOp</span><span class="op" id="3368319">(</span><span class="num" id="3368320">0</span><span class="op" id="3368321">)</span>&nbsp;<span class="op" id="3368323">{</span>&nbsp;<span class="comment" id="3368325">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368341">return</span>&nbsp;<span class="builtintype" id="3368348">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368358">m</span><span class="op" id="3368359">.</span><span class="ident" id="3368360">matched</span>&nbsp;<span class="op" id="3368368">=</span>&nbsp;<span class="builtintype" id="3368370">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368377">for</span>&nbsp;<span class="ident" id="3368381">i</span>&nbsp;<span class="op" id="3368383">:=</span>&nbsp;<span class="keyword" id="3368386">range</span>&nbsp;<span class="ident" id="3368392">m</span><span class="op" id="3368393">.</span><span class="ident" id="3368394">matchcap</span>&nbsp;<span class="op" id="3368403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368407">m</span><span class="op" id="3368408">.</span><span class="ident" id="3368409">matchcap</span><span class="op" id="3368417">[</span><span class="ident" id="3368418">i</span><span class="op" id="3368419">]</span>&nbsp;<span class="op" id="3368421">=</span>&nbsp;<span class="op" id="3368423">-</span><span class="num" id="3368424">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368427">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368430">runq</span><span class="op" id="3368434">,</span>&nbsp;<span class="ident" id="3368436">nextq</span>&nbsp;<span class="op" id="3368442">:=</span>&nbsp;<span class="op" id="3368445">&amp;</span><span class="ident" id="3368446">m</span><span class="op" id="3368447">.</span><span class="ident" id="3368448">q0</span><span class="op" id="3368450">,</span>&nbsp;<span class="op" id="3368452">&amp;</span><span class="ident" id="3368453">m</span><span class="op" id="3368454">.</span><span class="ident" id="3368455">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368459">r</span><span class="op" id="3368460">,</span>&nbsp;<span class="ident" id="3368462">r1</span>&nbsp;<span class="op" id="3368465">:=</span>&nbsp;<span class="ident" id="3368468">endOfText</span><span class="op" id="3368477">,</span>&nbsp;<span class="ident" id="3368479">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368490">width</span><span class="op" id="3368495">,</span>&nbsp;<span class="ident" id="3368497">width1</span>&nbsp;<span class="op" id="3368504">:=</span>&nbsp;<span class="num" id="3368507">0</span><span class="op" id="3368508">,</span>&nbsp;<span class="num" id="3368510">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368513">r</span><span class="op" id="3368514">,</span>&nbsp;<span class="ident" id="3368516">width</span>&nbsp;<span class="op" id="3368522">=</span>&nbsp;<span class="ident" id="3368524">i</span><span class="op" id="3368525">.</span><span class="ident" id="3368526">step</span><span class="op" id="3368530">(</span><span class="ident" id="3368531">pos</span><span class="op" id="3368534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368537">if</span>&nbsp;<span class="ident" id="3368540">r</span>&nbsp;<span class="op" id="3368542">!=</span>&nbsp;<span class="ident" id="3368545">endOfText</span>&nbsp;<span class="op" id="3368555">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368559">r1</span><span class="op" id="3368561">,</span>&nbsp;<span class="ident" id="3368563">width1</span>&nbsp;<span class="op" id="3368570">=</span>&nbsp;<span class="ident" id="3368572">i</span><span class="op" id="3368573">.</span><span class="ident" id="3368574">step</span><span class="op" id="3368578">(</span><span class="ident" id="3368579">pos</span>&nbsp;<span class="op" id="3368583">+</span>&nbsp;<span class="ident" id="3368585">width</span><span class="op" id="3368590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368596">var</span>&nbsp;<span class="ident" id="3368600">flag</span>&nbsp;<span class="ident" id="3368605">syntax</span><span class="op" id="3368611">.</span><span class="ident" id="3368612">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368621">if</span>&nbsp;<span class="ident" id="3368624">pos</span>&nbsp;<span class="op" id="3368628">==</span>&nbsp;<span class="num" id="3368631">0</span>&nbsp;<span class="op" id="3368633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368637">flag</span>&nbsp;<span class="op" id="3368642">=</span>&nbsp;<span class="ident" id="3368644">syntax</span><span class="op" id="3368650">.</span><span class="ident" id="3368651">EmptyOpContext</span><span class="op" id="3368665">(</span><span class="op" id="3368666">-</span><span class="num" id="3368667">1</span><span class="op" id="3368668">,</span>&nbsp;<span class="ident" id="3368670">r</span><span class="op" id="3368671">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368674">}</span>&nbsp;<span class="keyword" id="3368676">else</span>&nbsp;<span class="op" id="3368681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368685">flag</span>&nbsp;<span class="op" id="3368690">=</span>&nbsp;<span class="ident" id="3368692">i</span><span class="op" id="3368693">.</span><span class="ident" id="3368694">context</span><span class="op" id="3368701">(</span><span class="ident" id="3368702">pos</span><span class="op" id="3368705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368711">for</span>&nbsp;<span class="op" id="3368715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368719">if</span>&nbsp;<span class="builtinfunc" id="3368722">len</span><span class="op" id="3368725">(</span><span class="ident" id="3368726">runq</span><span class="op" id="3368730">.</span><span class="ident" id="3368731">dense</span><span class="op" id="3368736">)</span>&nbsp;<span class="op" id="3368738">==</span>&nbsp;<span class="num" id="3368741">0</span>&nbsp;<span class="op" id="3368743">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368748">if</span>&nbsp;<span class="ident" id="3368751">startCond</span><span class="op" id="3368760">&amp;</span><span class="ident" id="3368761">syntax</span><span class="op" id="3368767">.</span><span class="ident" id="3368768">EmptyBeginText</span>&nbsp;<span class="op" id="3368783">!=</span>&nbsp;<span class="num" id="3368786">0</span>&nbsp;<span class="op" id="3368788">&amp;&amp;</span>&nbsp;<span class="ident" id="3368791">pos</span>&nbsp;<span class="op" id="3368795">!=</span>&nbsp;<span class="num" id="3368798">0</span>&nbsp;<span class="op" id="3368800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368806">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368853">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368867">if</span>&nbsp;<span class="ident" id="3368870">m</span><span class="op" id="3368871">.</span><span class="ident" id="3368872">matched</span>&nbsp;<span class="op" id="3368880">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368886">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368938">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368952">if</span>&nbsp;<span class="builtinfunc" id="3368955">len</span><span class="op" id="3368958">(</span><span class="ident" id="3368959">m</span><span class="op" id="3368960">.</span><span class="ident" id="3368961">re</span><span class="op" id="3368963">.</span><span class="ident" id="3368964">prefix</span><span class="op" id="3368970">)</span>&nbsp;<span class="op" id="3368972">&gt;</span>&nbsp;<span class="num" id="3368974">0</span>&nbsp;<span class="op" id="3368976">&amp;&amp;</span>&nbsp;<span class="ident" id="3368979">r1</span>&nbsp;<span class="op" id="3368982">!=</span>&nbsp;<span class="ident" id="3368985">m</span><span class="op" id="3368986">.</span><span class="ident" id="3368987">re</span><span class="op" id="3368989">.</span><span class="ident" id="3368990">prefixRune</span>&nbsp;<span class="op" id="3369001">&amp;&amp;</span>&nbsp;<span class="ident" id="3369004">i</span><span class="op" id="3369005">.</span><span class="ident" id="3369006">canCheckPrefix</span><span class="op" id="3369020">(</span><span class="op" id="3369021">)</span>&nbsp;<span class="op" id="3369023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369029">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369087">advance</span>&nbsp;<span class="op" id="3369095">:=</span>&nbsp;<span class="ident" id="3369098">i</span><span class="op" id="3369099">.</span><span class="ident" id="3369100">index</span><span class="op" id="3369105">(</span><span class="ident" id="3369106">m</span><span class="op" id="3369107">.</span><span class="ident" id="3369108">re</span><span class="op" id="3369110">,</span>&nbsp;<span class="ident" id="3369112">pos</span><span class="op" id="3369115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369121">if</span>&nbsp;<span class="ident" id="3369124">advance</span>&nbsp;<span class="op" id="3369132">&lt;</span>&nbsp;<span class="num" id="3369134">0</span>&nbsp;<span class="op" id="3369136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369143">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369159">pos</span>&nbsp;<span class="op" id="3369163">+=</span>&nbsp;<span class="ident" id="3369166">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369178">r</span><span class="op" id="3369179">,</span>&nbsp;<span class="ident" id="3369181">width</span>&nbsp;<span class="op" id="3369187">=</span>&nbsp;<span class="ident" id="3369189">i</span><span class="op" id="3369190">.</span><span class="ident" id="3369191">step</span><span class="op" id="3369195">(</span><span class="ident" id="3369196">pos</span><span class="op" id="3369199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369205">r1</span><span class="op" id="3369207">,</span>&nbsp;<span class="ident" id="3369209">width1</span>&nbsp;<span class="op" id="3369216">=</span>&nbsp;<span class="ident" id="3369218">i</span><span class="op" id="3369219">.</span><span class="ident" id="3369220">step</span><span class="op" id="3369224">(</span><span class="ident" id="3369225">pos</span>&nbsp;<span class="op" id="3369229">+</span>&nbsp;<span class="ident" id="3369231">width</span><span class="op" id="3369236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369249">if</span>&nbsp;<span class="op" id="3369252">!</span><span class="ident" id="3369253">m</span><span class="op" id="3369254">.</span><span class="ident" id="3369255">matched</span>&nbsp;<span class="op" id="3369263">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369268">if</span>&nbsp;<span class="builtinfunc" id="3369271">len</span><span class="op" id="3369274">(</span><span class="ident" id="3369275">m</span><span class="op" id="3369276">.</span><span class="ident" id="3369277">matchcap</span><span class="op" id="3369285">)</span>&nbsp;<span class="op" id="3369287">&gt;</span>&nbsp;<span class="num" id="3369289">0</span>&nbsp;<span class="op" id="3369291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369297">m</span><span class="op" id="3369298">.</span><span class="ident" id="3369299">matchcap</span><span class="op" id="3369307">[</span><span class="num" id="3369308">0</span><span class="op" id="3369309">]</span>&nbsp;<span class="op" id="3369311">=</span>&nbsp;<span class="ident" id="3369313">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369325">m</span><span class="op" id="3369326">.</span><span class="ident" id="3369327">add</span><span class="op" id="3369330">(</span><span class="ident" id="3369331">runq</span><span class="op" id="3369335">,</span>&nbsp;<span class="builtintype" id="3369337">uint32</span><span class="op" id="3369343">(</span><span class="ident" id="3369344">m</span><span class="op" id="3369345">.</span><span class="ident" id="3369346">p</span><span class="op" id="3369347">.</span><span class="ident" id="3369348">Start</span><span class="op" id="3369353">)</span><span class="op" id="3369354">,</span>&nbsp;<span class="ident" id="3369356">pos</span><span class="op" id="3369359">,</span>&nbsp;<span class="ident" id="3369361">m</span><span class="op" id="3369362">.</span><span class="ident" id="3369363">matchcap</span><span class="op" id="3369371">,</span>&nbsp;<span class="ident" id="3369373">flag</span><span class="op" id="3369377">,</span>&nbsp;<span class="ident" id="3369379">nil</span><span class="op" id="3369382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369386">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369390">flag</span>&nbsp;<span class="op" id="3369395">=</span>&nbsp;<span class="ident" id="3369397">syntax</span><span class="op" id="3369403">.</span><span class="ident" id="3369404">EmptyOpContext</span><span class="op" id="3369418">(</span><span class="ident" id="3369419">r</span><span class="op" id="3369420">,</span>&nbsp;<span class="ident" id="3369422">r1</span><span class="op" id="3369424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369428">m</span><span class="op" id="3369429">.</span><span class="ident" id="3369430">step</span><span class="op" id="3369434">(</span><span class="ident" id="3369435">runq</span><span class="op" id="3369439">,</span>&nbsp;<span class="ident" id="3369441">nextq</span><span class="op" id="3369446">,</span>&nbsp;<span class="ident" id="3369448">pos</span><span class="op" id="3369451">,</span>&nbsp;<span class="ident" id="3369453">pos</span><span class="op" id="3369456">+</span><span class="ident" id="3369457">width</span><span class="op" id="3369462">,</span>&nbsp;<span class="ident" id="3369464">r</span><span class="op" id="3369465">,</span>&nbsp;<span class="ident" id="3369467">flag</span><span class="op" id="3369471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369475">if</span>&nbsp;<span class="ident" id="3369478">width</span>&nbsp;<span class="op" id="3369484">==</span>&nbsp;<span class="num" id="3369487">0</span>&nbsp;<span class="op" id="3369489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369494">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369502">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369506">if</span>&nbsp;<span class="builtinfunc" id="3369509">len</span><span class="op" id="3369512">(</span><span class="ident" id="3369513">m</span><span class="op" id="3369514">.</span><span class="ident" id="3369515">matchcap</span><span class="op" id="3369523">)</span>&nbsp;<span class="op" id="3369525">==</span>&nbsp;<span class="num" id="3369528">0</span>&nbsp;<span class="op" id="3369530">&amp;&amp;</span>&nbsp;<span class="ident" id="3369533">m</span><span class="op" id="3369534">.</span><span class="ident" id="3369535">matched</span>&nbsp;<span class="op" id="3369543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369548">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369593">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369637">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369645">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369649">pos</span>&nbsp;<span class="op" id="3369653">+=</span>&nbsp;<span class="ident" id="3369656">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369664">r</span><span class="op" id="3369665">,</span>&nbsp;<span class="ident" id="3369667">width</span>&nbsp;<span class="op" id="3369673">=</span>&nbsp;<span class="ident" id="3369675">r1</span><span class="op" id="3369677">,</span>&nbsp;<span class="ident" id="3369679">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369688">if</span>&nbsp;<span class="ident" id="3369691">r</span>&nbsp;<span class="op" id="3369693">!=</span>&nbsp;<span class="ident" id="3369696">endOfText</span>&nbsp;<span class="op" id="3369706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369711">r1</span><span class="op" id="3369713">,</span>&nbsp;<span class="ident" id="3369715">width1</span>&nbsp;<span class="op" id="3369722">=</span>&nbsp;<span class="ident" id="3369724">i</span><span class="op" id="3369725">.</span><span class="ident" id="3369726">step</span><span class="op" id="3369730">(</span><span class="ident" id="3369731">pos</span>&nbsp;<span class="op" id="3369735">+</span>&nbsp;<span class="ident" id="3369737">width</span><span class="op" id="3369742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369746">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369750">runq</span><span class="op" id="3369754">,</span>&nbsp;<span class="ident" id="3369756">nextq</span>&nbsp;<span class="op" id="3369762">=</span>&nbsp;<span class="ident" id="3369764">nextq</span><span class="op" id="3369769">,</span>&nbsp;<span class="ident" id="3369771">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369780">m</span><span class="op" id="3369781">.</span><span class="ident" id="3369782">clear</span><span class="op" id="3369787">(</span><span class="ident" id="3369788">nextq</span><span class="op" id="3369793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369796">return</span>&nbsp;<span class="ident" id="3369803">m</span><span class="op" id="3369804">.</span><span class="ident" id="3369805">matched</span><br>
<span class="lineno"></span><span class="op" id="3369813">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="3369816">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="3369864">func</span>&nbsp;<span class="op" id="3369869">(</span><span class="ident" id="3369870">m</span>&nbsp;<span class="op" id="3369872">*</span><span class="ident" id="3369873">machine</span><span class="op" id="3369880">)</span>&nbsp;<span class="ident" id="3369882">clear</span><span class="op" id="3369887">(</span><span class="ident" id="3369888">q</span>&nbsp;<span class="op" id="3369890">*</span><span class="ident" id="3369891">queue</span><span class="op" id="3369896">)</span>&nbsp;<span class="op" id="3369898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369901">for</span>&nbsp;<span class="ident" id="3369905">_</span><span class="op" id="3369906">,</span>&nbsp;<span class="ident" id="3369908">d</span>&nbsp;<span class="op" id="3369910">:=</span>&nbsp;<span class="keyword" id="3369913">range</span>&nbsp;<span class="ident" id="3369919">q</span><span class="op" id="3369920">.</span><span class="ident" id="3369921">dense</span>&nbsp;<span class="op" id="3369927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369931">if</span>&nbsp;<span class="ident" id="3369934">d</span><span class="op" id="3369935">.</span><span class="ident" id="3369936">t</span>&nbsp;<span class="op" id="3369938">!=</span>&nbsp;<span class="ident" id="3369941">nil</span>&nbsp;<span class="op" id="3369945">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369950">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369968">m</span><span class="op" id="3369969">.</span><span class="ident" id="3369970">pool</span>&nbsp;<span class="op" id="3369975">=</span>&nbsp;<span class="builtinfunc" id="3369977">append</span><span class="op" id="3369983">(</span><span class="ident" id="3369984">m</span><span class="op" id="3369985">.</span><span class="ident" id="3369986">pool</span><span class="op" id="3369990">,</span>&nbsp;<span class="ident" id="3369992">d</span><span class="op" id="3369993">.</span><span class="ident" id="3369994">t</span><span class="op" id="3369995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370005">q</span><span class="op" id="3370006">.</span><span class="ident" id="3370007">dense</span>&nbsp;<span class="op" id="3370013">=</span>&nbsp;<span class="ident" id="3370015">q</span><span class="op" id="3370016">.</span><span class="ident" id="3370017">dense</span><span class="op" id="3370022">[</span><span class="op" id="3370023">:</span><span class="num" id="3370024">0</span><span class="op" id="3370025">]</span><br>
<span class="lineno">195</span><span class="op" id="3370027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370030">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="3370100">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="3370147">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="3370206">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="3370259">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3370324">func</span>&nbsp;<span class="op" id="3370329">(</span><span class="ident" id="3370330">m</span>&nbsp;<span class="op" id="3370332">*</span><span class="ident" id="3370333">machine</span><span class="op" id="3370340">)</span>&nbsp;<span class="ident" id="3370342">step</span><span class="op" id="3370346">(</span><span class="ident" id="3370347">runq</span><span class="op" id="3370351">,</span>&nbsp;<span class="ident" id="3370353">nextq</span>&nbsp;<span class="op" id="3370359">*</span><span class="ident" id="3370360">queue</span><span class="op" id="3370365">,</span>&nbsp;<span class="ident" id="3370367">pos</span><span class="op" id="3370370">,</span>&nbsp;<span class="ident" id="3370372">nextPos</span>&nbsp;<span class="builtintype" id="3370380">int</span><span class="op" id="3370383">,</span>&nbsp;<span class="ident" id="3370385">c</span>&nbsp;<span class="builtintype" id="3370387">rune</span><span class="op" id="3370391">,</span>&nbsp;<span class="ident" id="3370393">nextCond</span>&nbsp;<span class="ident" id="3370402">syntax</span><span class="op" id="3370408">.</span><span class="ident" id="3370409">EmptyOp</span><span class="op" id="3370416">)</span>&nbsp;<span class="op" id="3370418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370421">longest</span>&nbsp;<span class="op" id="3370429">:=</span>&nbsp;<span class="ident" id="3370432">m</span><span class="op" id="3370433">.</span><span class="ident" id="3370434">re</span><span class="op" id="3370436">.</span><span class="ident" id="3370437">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370446">for</span>&nbsp;<span class="ident" id="3370450">j</span>&nbsp;<span class="op" id="3370452">:=</span>&nbsp;<span class="num" id="3370455">0</span><span class="op" id="3370456">;</span>&nbsp;<span class="ident" id="3370458">j</span>&nbsp;<span class="op" id="3370460">&lt;</span>&nbsp;<span class="builtinfunc" id="3370462">len</span><span class="op" id="3370465">(</span><span class="ident" id="3370466">runq</span><span class="op" id="3370470">.</span><span class="ident" id="3370471">dense</span><span class="op" id="3370476">)</span><span class="op" id="3370477">;</span>&nbsp;<span class="ident" id="3370479">j</span><span class="op" id="3370480">++</span>&nbsp;<span class="op" id="3370483">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370487">d</span>&nbsp;<span class="op" id="3370489">:=</span>&nbsp;<span class="op" id="3370492">&amp;</span><span class="ident" id="3370493">runq</span><span class="op" id="3370497">.</span><span class="ident" id="3370498">dense</span><span class="op" id="3370503">[</span><span class="ident" id="3370504">j</span><span class="op" id="3370505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370509">t</span>&nbsp;<span class="op" id="3370511">:=</span>&nbsp;<span class="ident" id="3370514">d</span><span class="op" id="3370515">.</span><span class="ident" id="3370516">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370520">if</span>&nbsp;<span class="ident" id="3370523">t</span>&nbsp;<span class="op" id="3370525">==</span>&nbsp;<span class="ident" id="3370528">nil</span>&nbsp;<span class="op" id="3370532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370537">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370548">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370552">if</span>&nbsp;<span class="ident" id="3370555">longest</span>&nbsp;<span class="op" id="3370563">&amp;&amp;</span>&nbsp;<span class="ident" id="3370566">m</span><span class="op" id="3370567">.</span><span class="ident" id="3370568">matched</span>&nbsp;<span class="op" id="3370576">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3370579">len</span><span class="op" id="3370582">(</span><span class="ident" id="3370583">t</span><span class="op" id="3370584">.</span><span class="builtinfunc" id="3370585">cap</span><span class="op" id="3370588">)</span>&nbsp;<span class="op" id="3370590">&gt;</span>&nbsp;<span class="num" id="3370592">0</span>&nbsp;<span class="op" id="3370594">&amp;&amp;</span>&nbsp;<span class="ident" id="3370597">m</span><span class="op" id="3370598">.</span><span class="ident" id="3370599">matchcap</span><span class="op" id="3370607">[</span><span class="num" id="3370608">0</span><span class="op" id="3370609">]</span>&nbsp;<span class="op" id="3370611">&lt;</span>&nbsp;<span class="ident" id="3370613">t</span><span class="op" id="3370614">.</span><span class="builtinfunc" id="3370615">cap</span><span class="op" id="3370618">[</span><span class="num" id="3370619">0</span><span class="op" id="3370620">]</span>&nbsp;<span class="op" id="3370622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3370627">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370643">m</span><span class="op" id="3370644">.</span><span class="ident" id="3370645">pool</span>&nbsp;<span class="op" id="3370650">=</span>&nbsp;<span class="builtinfunc" id="3370652">append</span><span class="op" id="3370658">(</span><span class="ident" id="3370659">m</span><span class="op" id="3370660">.</span><span class="ident" id="3370661">pool</span><span class="op" id="3370665">,</span>&nbsp;<span class="ident" id="3370667">t</span><span class="op" id="3370668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370673">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370684">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370688">i</span>&nbsp;<span class="op" id="3370690">:=</span>&nbsp;<span class="ident" id="3370693">t</span><span class="op" id="3370694">.</span><span class="ident" id="3370695">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370702">add</span>&nbsp;<span class="op" id="3370706">:=</span>&nbsp;<span class="builtintype" id="3370709">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370717">switch</span>&nbsp;<span class="ident" id="3370724">i</span><span class="op" id="3370725">.</span><span class="ident" id="3370726">Op</span>&nbsp;<span class="op" id="3370729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370733">default</span><span class="op" id="3370740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3370745">panic</span><span class="op" id="3370750">(</span><span class="string" id="3370751">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3370761">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370766">case</span>&nbsp;<span class="ident" id="3370771">syntax</span><span class="op" id="3370777">.</span><span class="ident" id="3370778">InstMatch</span><span class="op" id="3370787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370792">if</span>&nbsp;<span class="builtinfunc" id="3370795">len</span><span class="op" id="3370798">(</span><span class="ident" id="3370799">t</span><span class="op" id="3370800">.</span><span class="builtinfunc" id="3370801">cap</span><span class="op" id="3370804">)</span>&nbsp;<span class="op" id="3370806">&gt;</span>&nbsp;<span class="num" id="3370808">0</span>&nbsp;<span class="op" id="3370810">&amp;&amp;</span>&nbsp;<span class="op" id="3370813">(</span><span class="op" id="3370814">!</span><span class="ident" id="3370815">longest</span>&nbsp;<span class="op" id="3370823">||</span>&nbsp;<span class="op" id="3370826">!</span><span class="ident" id="3370827">m</span><span class="op" id="3370828">.</span><span class="ident" id="3370829">matched</span>&nbsp;<span class="op" id="3370837">||</span>&nbsp;<span class="ident" id="3370840">m</span><span class="op" id="3370841">.</span><span class="ident" id="3370842">matchcap</span><span class="op" id="3370850">[</span><span class="num" id="3370851">1</span><span class="op" id="3370852">]</span>&nbsp;<span class="op" id="3370854">&lt;</span>&nbsp;<span class="ident" id="3370856">pos</span><span class="op" id="3370859">)</span>&nbsp;<span class="op" id="3370861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370867">t</span><span class="op" id="3370868">.</span><span class="builtinfunc" id="3370869">cap</span><span class="op" id="3370872">[</span><span class="num" id="3370873">1</span><span class="op" id="3370874">]</span>&nbsp;<span class="op" id="3370876">=</span>&nbsp;<span class="ident" id="3370878">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3370886">copy</span><span class="op" id="3370890">(</span><span class="ident" id="3370891">m</span><span class="op" id="3370892">.</span><span class="ident" id="3370893">matchcap</span><span class="op" id="3370901">,</span>&nbsp;<span class="ident" id="3370903">t</span><span class="op" id="3370904">.</span><span class="builtinfunc" id="3370905">cap</span><span class="op" id="3370908">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370918">if</span>&nbsp;<span class="op" id="3370921">!</span><span class="ident" id="3370922">longest</span>&nbsp;<span class="op" id="3370930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3370936">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370997">for</span>&nbsp;<span class="ident" id="3371001">_</span><span class="op" id="3371002">,</span>&nbsp;<span class="ident" id="3371004">d</span>&nbsp;<span class="op" id="3371006">:=</span>&nbsp;<span class="keyword" id="3371009">range</span>&nbsp;<span class="ident" id="3371015">runq</span><span class="op" id="3371019">.</span><span class="ident" id="3371020">dense</span><span class="op" id="3371025">[</span><span class="ident" id="3371026">j</span><span class="op" id="3371027">+</span><span class="num" id="3371028">1</span><span class="op" id="3371029">:</span><span class="op" id="3371030">]</span>&nbsp;<span class="op" id="3371032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371039">if</span>&nbsp;<span class="ident" id="3371042">d</span><span class="op" id="3371043">.</span><span class="ident" id="3371044">t</span>&nbsp;<span class="op" id="3371046">!=</span>&nbsp;<span class="ident" id="3371049">nil</span>&nbsp;<span class="op" id="3371053">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3371061">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371082">m</span><span class="op" id="3371083">.</span><span class="ident" id="3371084">pool</span>&nbsp;<span class="op" id="3371089">=</span>&nbsp;<span class="builtinfunc" id="3371091">append</span><span class="op" id="3371097">(</span><span class="ident" id="3371098">m</span><span class="op" id="3371099">.</span><span class="ident" id="3371100">pool</span><span class="op" id="3371104">,</span>&nbsp;<span class="ident" id="3371106">d</span><span class="op" id="3371107">.</span><span class="ident" id="3371108">t</span><span class="op" id="3371109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371128">runq</span><span class="op" id="3371132">.</span><span class="ident" id="3371133">dense</span>&nbsp;<span class="op" id="3371139">=</span>&nbsp;<span class="ident" id="3371141">runq</span><span class="op" id="3371145">.</span><span class="ident" id="3371146">dense</span><span class="op" id="3371151">[</span><span class="op" id="3371152">:</span><span class="num" id="3371153">0</span><span class="op" id="3371154">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371164">m</span><span class="op" id="3371165">.</span><span class="ident" id="3371166">matched</span>&nbsp;<span class="op" id="3371174">=</span>&nbsp;<span class="builtintype" id="3371176">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371184">case</span>&nbsp;<span class="ident" id="3371189">syntax</span><span class="op" id="3371195">.</span><span class="ident" id="3371196">InstRune</span><span class="op" id="3371204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371209">add</span>&nbsp;<span class="op" id="3371213">=</span>&nbsp;<span class="ident" id="3371215">i</span><span class="op" id="3371216">.</span><span class="ident" id="3371217">MatchRune</span><span class="op" id="3371226">(</span><span class="ident" id="3371227">c</span><span class="op" id="3371228">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371232">case</span>&nbsp;<span class="ident" id="3371237">syntax</span><span class="op" id="3371243">.</span><span class="ident" id="3371244">InstRune1</span><span class="op" id="3371253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371258">add</span>&nbsp;<span class="op" id="3371262">=</span>&nbsp;<span class="ident" id="3371264">c</span>&nbsp;<span class="op" id="3371266">==</span>&nbsp;<span class="ident" id="3371269">i</span><span class="op" id="3371270">.</span><span class="ident" id="3371271">Rune</span><span class="op" id="3371275">[</span><span class="num" id="3371276">0</span><span class="op" id="3371277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371281">case</span>&nbsp;<span class="ident" id="3371286">syntax</span><span class="op" id="3371292">.</span><span class="ident" id="3371293">InstRuneAny</span><span class="op" id="3371304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371309">add</span>&nbsp;<span class="op" id="3371313">=</span>&nbsp;<span class="builtintype" id="3371315">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371322">case</span>&nbsp;<span class="ident" id="3371327">syntax</span><span class="op" id="3371333">.</span><span class="ident" id="3371334">InstRuneAnyNotNL</span><span class="op" id="3371350">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371355">add</span>&nbsp;<span class="op" id="3371359">=</span>&nbsp;<span class="ident" id="3371361">c</span>&nbsp;<span class="op" id="3371363">!=</span>&nbsp;<span class="string" id="3371366">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371377">if</span>&nbsp;<span class="ident" id="3371380">add</span>&nbsp;<span class="op" id="3371384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371389">t</span>&nbsp;<span class="op" id="3371391">=</span>&nbsp;<span class="ident" id="3371393">m</span><span class="op" id="3371394">.</span><span class="ident" id="3371395">add</span><span class="op" id="3371398">(</span><span class="ident" id="3371399">nextq</span><span class="op" id="3371404">,</span>&nbsp;<span class="ident" id="3371406">i</span><span class="op" id="3371407">.</span><span class="ident" id="3371408">Out</span><span class="op" id="3371411">,</span>&nbsp;<span class="ident" id="3371413">nextPos</span><span class="op" id="3371420">,</span>&nbsp;<span class="ident" id="3371422">t</span><span class="op" id="3371423">.</span><span class="builtinfunc" id="3371424">cap</span><span class="op" id="3371427">,</span>&nbsp;<span class="ident" id="3371429">nextCond</span><span class="op" id="3371437">,</span>&nbsp;<span class="ident" id="3371439">t</span><span class="op" id="3371440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371444">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371448">if</span>&nbsp;<span class="ident" id="3371451">t</span>&nbsp;<span class="op" id="3371453">!=</span>&nbsp;<span class="ident" id="3371456">nil</span>&nbsp;<span class="op" id="3371460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3371465">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371481">m</span><span class="op" id="3371482">.</span><span class="ident" id="3371483">pool</span>&nbsp;<span class="op" id="3371488">=</span>&nbsp;<span class="builtinfunc" id="3371490">append</span><span class="op" id="3371496">(</span><span class="ident" id="3371497">m</span><span class="op" id="3371498">.</span><span class="ident" id="3371499">pool</span><span class="op" id="3371503">,</span>&nbsp;<span class="ident" id="3371505">t</span><span class="op" id="3371506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371513">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371516">runq</span><span class="op" id="3371520">.</span><span class="ident" id="3371521">dense</span>&nbsp;<span class="op" id="3371527">=</span>&nbsp;<span class="ident" id="3371529">runq</span><span class="op" id="3371533">.</span><span class="ident" id="3371534">dense</span><span class="op" id="3371539">[</span><span class="op" id="3371540">:</span><span class="num" id="3371541">0</span><span class="op" id="3371542">]</span><br>
<span class="lineno"></span><span class="op" id="3371544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371547">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="3371621">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3371710">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3371787">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3371804">func</span>&nbsp;<span class="op" id="3371809">(</span><span class="ident" id="3371810">m</span>&nbsp;<span class="op" id="3371812">*</span><span class="ident" id="3371813">machine</span><span class="op" id="3371820">)</span>&nbsp;<span class="ident" id="3371822">add</span><span class="op" id="3371825">(</span><span class="ident" id="3371826">q</span>&nbsp;<span class="op" id="3371828">*</span><span class="ident" id="3371829">queue</span><span class="op" id="3371834">,</span>&nbsp;<span class="ident" id="3371836">pc</span>&nbsp;<span class="builtintype" id="3371839">uint32</span><span class="op" id="3371845">,</span>&nbsp;<span class="ident" id="3371847">pos</span>&nbsp;<span class="builtintype" id="3371851">int</span><span class="op" id="3371854">,</span>&nbsp;<span class="builtinfunc" id="3371856">cap</span>&nbsp;<span class="op" id="3371860">[</span><span class="op" id="3371861">]</span><span class="builtintype" id="3371862">int</span><span class="op" id="3371865">,</span>&nbsp;<span class="ident" id="3371867">cond</span>&nbsp;<span class="ident" id="3371872">syntax</span><span class="op" id="3371878">.</span><span class="ident" id="3371879">EmptyOp</span><span class="op" id="3371886">,</span>&nbsp;<span class="ident" id="3371888">t</span>&nbsp;<span class="op" id="3371890">*</span><span class="ident" id="3371891">thread</span><span class="op" id="3371897">)</span>&nbsp;<span class="op" id="3371899">*</span><span class="ident" id="3371900">thread</span>&nbsp;<span class="op" id="3371907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371910">if</span>&nbsp;<span class="ident" id="3371913">pc</span>&nbsp;<span class="op" id="3371916">==</span>&nbsp;<span class="num" id="3371919">0</span>&nbsp;<span class="op" id="3371921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371925">return</span>&nbsp;<span class="ident" id="3371932">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371938">if</span>&nbsp;<span class="ident" id="3371941">j</span>&nbsp;<span class="op" id="3371943">:=</span>&nbsp;<span class="ident" id="3371946">q</span><span class="op" id="3371947">.</span><span class="ident" id="3371948">sparse</span><span class="op" id="3371954">[</span><span class="ident" id="3371955">pc</span><span class="op" id="3371957">]</span><span class="op" id="3371958">;</span>&nbsp;<span class="ident" id="3371960">j</span>&nbsp;<span class="op" id="3371962">&lt;</span>&nbsp;<span class="builtintype" id="3371964">uint32</span><span class="op" id="3371970">(</span><span class="builtinfunc" id="3371971">len</span><span class="op" id="3371974">(</span><span class="ident" id="3371975">q</span><span class="op" id="3371976">.</span><span class="ident" id="3371977">dense</span><span class="op" id="3371982">)</span><span class="op" id="3371983">)</span>&nbsp;<span class="op" id="3371985">&amp;&amp;</span>&nbsp;<span class="ident" id="3371988">q</span><span class="op" id="3371989">.</span><span class="ident" id="3371990">dense</span><span class="op" id="3371995">[</span><span class="ident" id="3371996">j</span><span class="op" id="3371997">]</span><span class="op" id="3371998">.</span><span class="ident" id="3371999">pc</span>&nbsp;<span class="op" id="3372002">==</span>&nbsp;<span class="ident" id="3372005">pc</span>&nbsp;<span class="op" id="3372008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372012">return</span>&nbsp;<span class="ident" id="3372019">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372026">j</span>&nbsp;<span class="op" id="3372028">:=</span>&nbsp;<span class="builtinfunc" id="3372031">len</span><span class="op" id="3372034">(</span><span class="ident" id="3372035">q</span><span class="op" id="3372036">.</span><span class="ident" id="3372037">dense</span><span class="op" id="3372042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372045">q</span><span class="op" id="3372046">.</span><span class="ident" id="3372047">dense</span>&nbsp;<span class="op" id="3372053">=</span>&nbsp;<span class="ident" id="3372055">q</span><span class="op" id="3372056">.</span><span class="ident" id="3372057">dense</span><span class="op" id="3372062">[</span><span class="op" id="3372063">:</span><span class="ident" id="3372064">j</span><span class="op" id="3372065">+</span><span class="num" id="3372066">1</span><span class="op" id="3372067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372070">d</span>&nbsp;<span class="op" id="3372072">:=</span>&nbsp;<span class="op" id="3372075">&amp;</span><span class="ident" id="3372076">q</span><span class="op" id="3372077">.</span><span class="ident" id="3372078">dense</span><span class="op" id="3372083">[</span><span class="ident" id="3372084">j</span><span class="op" id="3372085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372088">d</span><span class="op" id="3372089">.</span><span class="ident" id="3372090">t</span>&nbsp;<span class="op" id="3372092">=</span>&nbsp;<span class="ident" id="3372094">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372099">d</span><span class="op" id="3372100">.</span><span class="ident" id="3372101">pc</span>&nbsp;<span class="op" id="3372104">=</span>&nbsp;<span class="ident" id="3372106">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372110">q</span><span class="op" id="3372111">.</span><span class="ident" id="3372112">sparse</span><span class="op" id="3372118">[</span><span class="ident" id="3372119">pc</span><span class="op" id="3372121">]</span>&nbsp;<span class="op" id="3372123">=</span>&nbsp;<span class="builtintype" id="3372125">uint32</span><span class="op" id="3372131">(</span><span class="ident" id="3372132">j</span><span class="op" id="3372133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372137">i</span>&nbsp;<span class="op" id="3372139">:=</span>&nbsp;<span class="op" id="3372142">&amp;</span><span class="ident" id="3372143">m</span><span class="op" id="3372144">.</span><span class="ident" id="3372145">p</span><span class="op" id="3372146">.</span><span class="ident" id="3372147">Inst</span><span class="op" id="3372151">[</span><span class="ident" id="3372152">pc</span><span class="op" id="3372154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372157">switch</span>&nbsp;<span class="ident" id="3372164">i</span><span class="op" id="3372165">.</span><span class="ident" id="3372166">Op</span>&nbsp;<span class="op" id="3372169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372172">default</span><span class="op" id="3372179">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3372183">panic</span><span class="op" id="3372188">(</span><span class="string" id="3372189">&#34;unhandled&#34;</span><span class="op" id="3372200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372203">case</span>&nbsp;<span class="ident" id="3372208">syntax</span><span class="op" id="3372214">.</span><span class="ident" id="3372215">InstFail</span><span class="op" id="3372223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372227">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372239">case</span>&nbsp;<span class="ident" id="3372244">syntax</span><span class="op" id="3372250">.</span><span class="ident" id="3372251">InstAlt</span><span class="op" id="3372258">,</span>&nbsp;<span class="ident" id="3372260">syntax</span><span class="op" id="3372266">.</span><span class="ident" id="3372267">InstAltMatch</span><span class="op" id="3372279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372283">t</span>&nbsp;<span class="op" id="3372285">=</span>&nbsp;<span class="ident" id="3372287">m</span><span class="op" id="3372288">.</span><span class="ident" id="3372289">add</span><span class="op" id="3372292">(</span><span class="ident" id="3372293">q</span><span class="op" id="3372294">,</span>&nbsp;<span class="ident" id="3372296">i</span><span class="op" id="3372297">.</span><span class="ident" id="3372298">Out</span><span class="op" id="3372301">,</span>&nbsp;<span class="ident" id="3372303">pos</span><span class="op" id="3372306">,</span>&nbsp;<span class="builtinfunc" id="3372308">cap</span><span class="op" id="3372311">,</span>&nbsp;<span class="ident" id="3372313">cond</span><span class="op" id="3372317">,</span>&nbsp;<span class="ident" id="3372319">t</span><span class="op" id="3372320">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372324">t</span>&nbsp;<span class="op" id="3372326">=</span>&nbsp;<span class="ident" id="3372328">m</span><span class="op" id="3372329">.</span><span class="ident" id="3372330">add</span><span class="op" id="3372333">(</span><span class="ident" id="3372334">q</span><span class="op" id="3372335">,</span>&nbsp;<span class="ident" id="3372337">i</span><span class="op" id="3372338">.</span><span class="ident" id="3372339">Arg</span><span class="op" id="3372342">,</span>&nbsp;<span class="ident" id="3372344">pos</span><span class="op" id="3372347">,</span>&nbsp;<span class="builtinfunc" id="3372349">cap</span><span class="op" id="3372352">,</span>&nbsp;<span class="ident" id="3372354">cond</span><span class="op" id="3372358">,</span>&nbsp;<span class="ident" id="3372360">t</span><span class="op" id="3372361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372364">case</span>&nbsp;<span class="ident" id="3372369">syntax</span><span class="op" id="3372375">.</span><span class="ident" id="3372376">InstEmptyWidth</span><span class="op" id="3372390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372394">if</span>&nbsp;<span class="ident" id="3372397">syntax</span><span class="op" id="3372403">.</span><span class="ident" id="3372404">EmptyOp</span><span class="op" id="3372411">(</span><span class="ident" id="3372412">i</span><span class="op" id="3372413">.</span><span class="ident" id="3372414">Arg</span><span class="op" id="3372417">)</span><span class="op" id="3372418">&amp;^</span><span class="ident" id="3372420">cond</span>&nbsp;<span class="op" id="3372425">==</span>&nbsp;<span class="num" id="3372428">0</span>&nbsp;<span class="op" id="3372430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372435">t</span>&nbsp;<span class="op" id="3372437">=</span>&nbsp;<span class="ident" id="3372439">m</span><span class="op" id="3372440">.</span><span class="ident" id="3372441">add</span><span class="op" id="3372444">(</span><span class="ident" id="3372445">q</span><span class="op" id="3372446">,</span>&nbsp;<span class="ident" id="3372448">i</span><span class="op" id="3372449">.</span><span class="ident" id="3372450">Out</span><span class="op" id="3372453">,</span>&nbsp;<span class="ident" id="3372455">pos</span><span class="op" id="3372458">,</span>&nbsp;<span class="builtinfunc" id="3372460">cap</span><span class="op" id="3372463">,</span>&nbsp;<span class="ident" id="3372465">cond</span><span class="op" id="3372469">,</span>&nbsp;<span class="ident" id="3372471">t</span><span class="op" id="3372472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372476">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372479">case</span>&nbsp;<span class="ident" id="3372484">syntax</span><span class="op" id="3372490">.</span><span class="ident" id="3372491">InstNop</span><span class="op" id="3372498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372502">t</span>&nbsp;<span class="op" id="3372504">=</span>&nbsp;<span class="ident" id="3372506">m</span><span class="op" id="3372507">.</span><span class="ident" id="3372508">add</span><span class="op" id="3372511">(</span><span class="ident" id="3372512">q</span><span class="op" id="3372513">,</span>&nbsp;<span class="ident" id="3372515">i</span><span class="op" id="3372516">.</span><span class="ident" id="3372517">Out</span><span class="op" id="3372520">,</span>&nbsp;<span class="ident" id="3372522">pos</span><span class="op" id="3372525">,</span>&nbsp;<span class="builtinfunc" id="3372527">cap</span><span class="op" id="3372530">,</span>&nbsp;<span class="ident" id="3372532">cond</span><span class="op" id="3372536">,</span>&nbsp;<span class="ident" id="3372538">t</span><span class="op" id="3372539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372542">case</span>&nbsp;<span class="ident" id="3372547">syntax</span><span class="op" id="3372553">.</span><span class="ident" id="3372554">InstCapture</span><span class="op" id="3372565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372569">if</span>&nbsp;<span class="builtintype" id="3372572">int</span><span class="op" id="3372575">(</span><span class="ident" id="3372576">i</span><span class="op" id="3372577">.</span><span class="ident" id="3372578">Arg</span><span class="op" id="3372581">)</span>&nbsp;<span class="op" id="3372583">&lt;</span>&nbsp;<span class="builtinfunc" id="3372585">len</span><span class="op" id="3372588">(</span><span class="builtinfunc" id="3372589">cap</span><span class="op" id="3372592">)</span>&nbsp;<span class="op" id="3372594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372599">opos</span>&nbsp;<span class="op" id="3372604">:=</span>&nbsp;<span class="builtinfunc" id="3372607">cap</span><span class="op" id="3372610">[</span><span class="ident" id="3372611">i</span><span class="op" id="3372612">.</span><span class="ident" id="3372613">Arg</span><span class="op" id="3372616">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3372621">cap</span><span class="op" id="3372624">[</span><span class="ident" id="3372625">i</span><span class="op" id="3372626">.</span><span class="ident" id="3372627">Arg</span><span class="op" id="3372630">]</span>&nbsp;<span class="op" id="3372632">=</span>&nbsp;<span class="ident" id="3372634">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372641">m</span><span class="op" id="3372642">.</span><span class="ident" id="3372643">add</span><span class="op" id="3372646">(</span><span class="ident" id="3372647">q</span><span class="op" id="3372648">,</span>&nbsp;<span class="ident" id="3372650">i</span><span class="op" id="3372651">.</span><span class="ident" id="3372652">Out</span><span class="op" id="3372655">,</span>&nbsp;<span class="ident" id="3372657">pos</span><span class="op" id="3372660">,</span>&nbsp;<span class="builtinfunc" id="3372662">cap</span><span class="op" id="3372665">,</span>&nbsp;<span class="ident" id="3372667">cond</span><span class="op" id="3372671">,</span>&nbsp;<span class="ident" id="3372673">nil</span><span class="op" id="3372676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3372681">cap</span><span class="op" id="3372684">[</span><span class="ident" id="3372685">i</span><span class="op" id="3372686">.</span><span class="ident" id="3372687">Arg</span><span class="op" id="3372690">]</span>&nbsp;<span class="op" id="3372692">=</span>&nbsp;<span class="ident" id="3372694">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372701">}</span>&nbsp;<span class="keyword" id="3372703">else</span>&nbsp;<span class="op" id="3372708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372713">t</span>&nbsp;<span class="op" id="3372715">=</span>&nbsp;<span class="ident" id="3372717">m</span><span class="op" id="3372718">.</span><span class="ident" id="3372719">add</span><span class="op" id="3372722">(</span><span class="ident" id="3372723">q</span><span class="op" id="3372724">,</span>&nbsp;<span class="ident" id="3372726">i</span><span class="op" id="3372727">.</span><span class="ident" id="3372728">Out</span><span class="op" id="3372731">,</span>&nbsp;<span class="ident" id="3372733">pos</span><span class="op" id="3372736">,</span>&nbsp;<span class="builtinfunc" id="3372738">cap</span><span class="op" id="3372741">,</span>&nbsp;<span class="ident" id="3372743">cond</span><span class="op" id="3372747">,</span>&nbsp;<span class="ident" id="3372749">t</span><span class="op" id="3372750">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372757">case</span>&nbsp;<span class="ident" id="3372762">syntax</span><span class="op" id="3372768">.</span><span class="ident" id="3372769">InstMatch</span><span class="op" id="3372778">,</span>&nbsp;<span class="ident" id="3372780">syntax</span><span class="op" id="3372786">.</span><span class="ident" id="3372787">InstRune</span><span class="op" id="3372795">,</span>&nbsp;<span class="ident" id="3372797">syntax</span><span class="op" id="3372803">.</span><span class="ident" id="3372804">InstRune1</span><span class="op" id="3372813">,</span>&nbsp;<span class="ident" id="3372815">syntax</span><span class="op" id="3372821">.</span><span class="ident" id="3372822">InstRuneAny</span><span class="op" id="3372833">,</span>&nbsp;<span class="ident" id="3372835">syntax</span><span class="op" id="3372841">.</span><span class="ident" id="3372842">InstRuneAnyNotNL</span><span class="op" id="3372858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372862">if</span>&nbsp;<span class="ident" id="3372865">t</span>&nbsp;<span class="op" id="3372867">==</span>&nbsp;<span class="ident" id="3372870">nil</span>&nbsp;<span class="op" id="3372874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372879">t</span>&nbsp;<span class="op" id="3372881">=</span>&nbsp;<span class="ident" id="3372883">m</span><span class="op" id="3372884">.</span><span class="ident" id="3372885">alloc</span><span class="op" id="3372890">(</span><span class="ident" id="3372891">i</span><span class="op" id="3372892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372896">}</span>&nbsp;<span class="keyword" id="3372898">else</span>&nbsp;<span class="op" id="3372903">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372908">t</span><span class="op" id="3372909">.</span><span class="ident" id="3372910">inst</span>&nbsp;<span class="op" id="3372915">=</span>&nbsp;<span class="ident" id="3372917">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372925">if</span>&nbsp;<span class="builtinfunc" id="3372928">len</span><span class="op" id="3372931">(</span><span class="builtinfunc" id="3372932">cap</span><span class="op" id="3372935">)</span>&nbsp;<span class="op" id="3372937">&gt;</span>&nbsp;<span class="num" id="3372939">0</span>&nbsp;<span class="op" id="3372941">&amp;&amp;</span>&nbsp;<span class="op" id="3372944">&amp;</span><span class="ident" id="3372945">t</span><span class="op" id="3372946">.</span><span class="builtinfunc" id="3372947">cap</span><span class="op" id="3372950">[</span><span class="num" id="3372951">0</span><span class="op" id="3372952">]</span>&nbsp;<span class="op" id="3372954">!=</span>&nbsp;<span class="op" id="3372957">&amp;</span><span class="builtinfunc" id="3372958">cap</span><span class="op" id="3372961">[</span><span class="num" id="3372962">0</span><span class="op" id="3372963">]</span>&nbsp;<span class="op" id="3372965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3372970">copy</span><span class="op" id="3372974">(</span><span class="ident" id="3372975">t</span><span class="op" id="3372976">.</span><span class="builtinfunc" id="3372977">cap</span><span class="op" id="3372980">,</span>&nbsp;<span class="builtinfunc" id="3372982">cap</span><span class="op" id="3372985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372989">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372993">d</span><span class="op" id="3372994">.</span><span class="ident" id="3372995">t</span>&nbsp;<span class="op" id="3372997">=</span>&nbsp;<span class="ident" id="3372999">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373003">t</span>&nbsp;<span class="op" id="3373005">=</span>&nbsp;<span class="ident" id="3373007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373015">return</span>&nbsp;<span class="ident" id="3373022">t</span><br>
<span class="lineno"></span><span class="op" id="3373024">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3373027">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3373087">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="3373128">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3373181">func</span>&nbsp;<span class="op" id="3373186">(</span><span class="ident" id="3373187">m</span>&nbsp;<span class="op" id="3373189">*</span><span class="ident" id="3373190">machine</span><span class="op" id="3373197">)</span>&nbsp;<span class="ident" id="3373199">onepass</span><span class="op" id="3373206">(</span><span class="ident" id="3373207">i</span>&nbsp;<span class="ident" id="3373209">input</span><span class="op" id="3373214">,</span>&nbsp;<span class="ident" id="3373216">pos</span>&nbsp;<span class="builtintype" id="3373220">int</span><span class="op" id="3373223">)</span>&nbsp;<span class="builtintype" id="3373225">bool</span>&nbsp;<span class="op" id="3373230">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373233">startCond</span>&nbsp;<span class="op" id="3373243">:=</span>&nbsp;<span class="ident" id="3373246">m</span><span class="op" id="3373247">.</span><span class="ident" id="3373248">re</span><span class="op" id="3373250">.</span><span class="ident" id="3373251">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373257">if</span>&nbsp;<span class="ident" id="3373260">startCond</span>&nbsp;<span class="op" id="3373270">==</span>&nbsp;<span class="op" id="3373273">^</span><span class="ident" id="3373274">syntax</span><span class="op" id="3373280">.</span><span class="ident" id="3373281">EmptyOp</span><span class="op" id="3373288">(</span><span class="num" id="3373289">0</span><span class="op" id="3373290">)</span>&nbsp;<span class="op" id="3373292">{</span>&nbsp;<span class="comment" id="3373294">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373310">return</span>&nbsp;<span class="builtintype" id="3373317">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373327">m</span><span class="op" id="3373328">.</span><span class="ident" id="3373329">matched</span>&nbsp;<span class="op" id="3373337">=</span>&nbsp;<span class="builtintype" id="3373339">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373346">for</span>&nbsp;<span class="ident" id="3373350">i</span>&nbsp;<span class="op" id="3373352">:=</span>&nbsp;<span class="keyword" id="3373355">range</span>&nbsp;<span class="ident" id="3373361">m</span><span class="op" id="3373362">.</span><span class="ident" id="3373363">matchcap</span>&nbsp;<span class="op" id="3373372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373376">m</span><span class="op" id="3373377">.</span><span class="ident" id="3373378">matchcap</span><span class="op" id="3373386">[</span><span class="ident" id="3373387">i</span><span class="op" id="3373388">]</span>&nbsp;<span class="op" id="3373390">=</span>&nbsp;<span class="op" id="3373392">-</span><span class="num" id="3373393">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373399">r</span><span class="op" id="3373400">,</span>&nbsp;<span class="ident" id="3373402">r1</span>&nbsp;<span class="op" id="3373405">:=</span>&nbsp;<span class="ident" id="3373408">endOfText</span><span class="op" id="3373417">,</span>&nbsp;<span class="ident" id="3373419">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373430">width</span><span class="op" id="3373435">,</span>&nbsp;<span class="ident" id="3373437">width1</span>&nbsp;<span class="op" id="3373444">:=</span>&nbsp;<span class="num" id="3373447">0</span><span class="op" id="3373448">,</span>&nbsp;<span class="num" id="3373450">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373453">r</span><span class="op" id="3373454">,</span>&nbsp;<span class="ident" id="3373456">width</span>&nbsp;<span class="op" id="3373462">=</span>&nbsp;<span class="ident" id="3373464">i</span><span class="op" id="3373465">.</span><span class="ident" id="3373466">step</span><span class="op" id="3373470">(</span><span class="ident" id="3373471">pos</span><span class="op" id="3373474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373477">if</span>&nbsp;<span class="ident" id="3373480">r</span>&nbsp;<span class="op" id="3373482">!=</span>&nbsp;<span class="ident" id="3373485">endOfText</span>&nbsp;<span class="op" id="3373495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373499">r1</span><span class="op" id="3373501">,</span>&nbsp;<span class="ident" id="3373503">width1</span>&nbsp;<span class="op" id="3373510">=</span>&nbsp;<span class="ident" id="3373512">i</span><span class="op" id="3373513">.</span><span class="ident" id="3373514">step</span><span class="op" id="3373518">(</span><span class="ident" id="3373519">pos</span>&nbsp;<span class="op" id="3373523">+</span>&nbsp;<span class="ident" id="3373525">width</span><span class="op" id="3373530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373536">var</span>&nbsp;<span class="ident" id="3373540">flag</span>&nbsp;<span class="ident" id="3373545">syntax</span><span class="op" id="3373551">.</span><span class="ident" id="3373552">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373561">if</span>&nbsp;<span class="ident" id="3373564">pos</span>&nbsp;<span class="op" id="3373568">==</span>&nbsp;<span class="num" id="3373571">0</span>&nbsp;<span class="op" id="3373573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373577">flag</span>&nbsp;<span class="op" id="3373582">=</span>&nbsp;<span class="ident" id="3373584">syntax</span><span class="op" id="3373590">.</span><span class="ident" id="3373591">EmptyOpContext</span><span class="op" id="3373605">(</span><span class="op" id="3373606">-</span><span class="num" id="3373607">1</span><span class="op" id="3373608">,</span>&nbsp;<span class="ident" id="3373610">r</span><span class="op" id="3373611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373614">}</span>&nbsp;<span class="keyword" id="3373616">else</span>&nbsp;<span class="op" id="3373621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373625">flag</span>&nbsp;<span class="op" id="3373630">=</span>&nbsp;<span class="ident" id="3373632">i</span><span class="op" id="3373633">.</span><span class="ident" id="3373634">context</span><span class="op" id="3373641">(</span><span class="ident" id="3373642">pos</span><span class="op" id="3373645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373648">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373651">pc</span>&nbsp;<span class="op" id="3373654">:=</span>&nbsp;<span class="ident" id="3373657">m</span><span class="op" id="3373658">.</span><span class="ident" id="3373659">op</span><span class="op" id="3373661">.</span><span class="ident" id="3373662">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373669">inst</span>&nbsp;<span class="op" id="3373674">:=</span>&nbsp;<span class="ident" id="3373677">m</span><span class="op" id="3373678">.</span><span class="ident" id="3373679">op</span><span class="op" id="3373681">.</span><span class="ident" id="3373682">Inst</span><span class="op" id="3373686">[</span><span class="ident" id="3373687">pc</span><span class="op" id="3373689">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373692">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373747">if</span>&nbsp;<span class="ident" id="3373750">pos</span>&nbsp;<span class="op" id="3373754">==</span>&nbsp;<span class="num" id="3373757">0</span>&nbsp;<span class="op" id="3373759">&amp;&amp;</span>&nbsp;<span class="ident" id="3373762">syntax</span><span class="op" id="3373768">.</span><span class="ident" id="3373769">EmptyOp</span><span class="op" id="3373776">(</span><span class="ident" id="3373777">inst</span><span class="op" id="3373781">.</span><span class="ident" id="3373782">Arg</span><span class="op" id="3373785">)</span><span class="op" id="3373786">&amp;^</span><span class="ident" id="3373788">flag</span>&nbsp;<span class="op" id="3373793">==</span>&nbsp;<span class="num" id="3373796">0</span>&nbsp;<span class="op" id="3373798">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3373803">len</span><span class="op" id="3373806">(</span><span class="ident" id="3373807">m</span><span class="op" id="3373808">.</span><span class="ident" id="3373809">re</span><span class="op" id="3373811">.</span><span class="ident" id="3373812">prefix</span><span class="op" id="3373818">)</span>&nbsp;<span class="op" id="3373820">&gt;</span>&nbsp;<span class="num" id="3373822">0</span>&nbsp;<span class="op" id="3373824">&amp;&amp;</span>&nbsp;<span class="ident" id="3373827">i</span><span class="op" id="3373828">.</span><span class="ident" id="3373829">canCheckPrefix</span><span class="op" id="3373843">(</span><span class="op" id="3373844">)</span>&nbsp;<span class="op" id="3373846">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373850">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373906">if</span>&nbsp;<span class="ident" id="3373909">i</span><span class="op" id="3373910">.</span><span class="ident" id="3373911">hasPrefix</span><span class="op" id="3373920">(</span><span class="ident" id="3373921">m</span><span class="op" id="3373922">.</span><span class="ident" id="3373923">re</span><span class="op" id="3373925">)</span>&nbsp;<span class="op" id="3373927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373932">pos</span>&nbsp;<span class="op" id="3373936">+=</span>&nbsp;<span class="builtinfunc" id="3373939">len</span><span class="op" id="3373942">(</span><span class="ident" id="3373943">m</span><span class="op" id="3373944">.</span><span class="ident" id="3373945">re</span><span class="op" id="3373947">.</span><span class="ident" id="3373948">prefix</span><span class="op" id="3373954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373959">r</span><span class="op" id="3373960">,</span>&nbsp;<span class="ident" id="3373962">width</span>&nbsp;<span class="op" id="3373968">=</span>&nbsp;<span class="ident" id="3373970">i</span><span class="op" id="3373971">.</span><span class="ident" id="3373972">step</span><span class="op" id="3373976">(</span><span class="ident" id="3373977">pos</span><span class="op" id="3373980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373985">r1</span><span class="op" id="3373987">,</span>&nbsp;<span class="ident" id="3373989">width1</span>&nbsp;<span class="op" id="3373996">=</span>&nbsp;<span class="ident" id="3373998">i</span><span class="op" id="3373999">.</span><span class="ident" id="3374000">step</span><span class="op" id="3374004">(</span><span class="ident" id="3374005">pos</span>&nbsp;<span class="op" id="3374009">+</span>&nbsp;<span class="ident" id="3374011">width</span><span class="op" id="3374016">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374021">flag</span>&nbsp;<span class="op" id="3374026">=</span>&nbsp;<span class="ident" id="3374028">i</span><span class="op" id="3374029">.</span><span class="ident" id="3374030">context</span><span class="op" id="3374037">(</span><span class="ident" id="3374038">pos</span><span class="op" id="3374041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374046">pc</span>&nbsp;<span class="op" id="3374049">=</span>&nbsp;<span class="builtintype" id="3374051">int</span><span class="op" id="3374054">(</span><span class="ident" id="3374055">m</span><span class="op" id="3374056">.</span><span class="ident" id="3374057">re</span><span class="op" id="3374059">.</span><span class="ident" id="3374060">prefixEnd</span><span class="op" id="3374069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374073">}</span>&nbsp;<span class="keyword" id="3374075">else</span>&nbsp;<span class="op" id="3374080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374085">return</span>&nbsp;<span class="ident" id="3374092">m</span><span class="op" id="3374093">.</span><span class="ident" id="3374094">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374104">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374110">for</span>&nbsp;<span class="op" id="3374114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374118">inst</span>&nbsp;<span class="op" id="3374123">=</span>&nbsp;<span class="ident" id="3374125">m</span><span class="op" id="3374126">.</span><span class="ident" id="3374127">op</span><span class="op" id="3374129">.</span><span class="ident" id="3374130">Inst</span><span class="op" id="3374134">[</span><span class="ident" id="3374135">pc</span><span class="op" id="3374137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374141">pc</span>&nbsp;<span class="op" id="3374144">=</span>&nbsp;<span class="builtintype" id="3374146">int</span><span class="op" id="3374149">(</span><span class="ident" id="3374150">inst</span><span class="op" id="3374154">.</span><span class="ident" id="3374155">Out</span><span class="op" id="3374158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374162">switch</span>&nbsp;<span class="ident" id="3374169">inst</span><span class="op" id="3374173">.</span><span class="ident" id="3374174">Op</span>&nbsp;<span class="op" id="3374177">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374181">default</span><span class="op" id="3374188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3374193">panic</span><span class="op" id="3374198">(</span><span class="string" id="3374199">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3374209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374213">case</span>&nbsp;<span class="ident" id="3374218">syntax</span><span class="op" id="3374224">.</span><span class="ident" id="3374225">InstMatch</span><span class="op" id="3374234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374239">m</span><span class="op" id="3374240">.</span><span class="ident" id="3374241">matched</span>&nbsp;<span class="op" id="3374249">=</span>&nbsp;<span class="builtintype" id="3374251">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374259">if</span>&nbsp;<span class="builtinfunc" id="3374262">len</span><span class="op" id="3374265">(</span><span class="ident" id="3374266">m</span><span class="op" id="3374267">.</span><span class="ident" id="3374268">matchcap</span><span class="op" id="3374276">)</span>&nbsp;<span class="op" id="3374278">&gt;</span>&nbsp;<span class="num" id="3374280">0</span>&nbsp;<span class="op" id="3374282">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374288">m</span><span class="op" id="3374289">.</span><span class="ident" id="3374290">matchcap</span><span class="op" id="3374298">[</span><span class="num" id="3374299">0</span><span class="op" id="3374300">]</span>&nbsp;<span class="op" id="3374302">=</span>&nbsp;<span class="num" id="3374304">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374310">m</span><span class="op" id="3374311">.</span><span class="ident" id="3374312">matchcap</span><span class="op" id="3374320">[</span><span class="num" id="3374321">1</span><span class="op" id="3374322">]</span>&nbsp;<span class="op" id="3374324">=</span>&nbsp;<span class="ident" id="3374326">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374338">return</span>&nbsp;<span class="ident" id="3374345">m</span><span class="op" id="3374346">.</span><span class="ident" id="3374347">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374357">case</span>&nbsp;<span class="ident" id="3374362">syntax</span><span class="op" id="3374368">.</span><span class="ident" id="3374369">InstRune</span><span class="op" id="3374377">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374382">if</span>&nbsp;<span class="op" id="3374385">!</span><span class="ident" id="3374386">inst</span><span class="op" id="3374390">.</span><span class="ident" id="3374391">MatchRune</span><span class="op" id="3374400">(</span><span class="ident" id="3374401">r</span><span class="op" id="3374402">)</span>&nbsp;<span class="op" id="3374404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374410">return</span>&nbsp;<span class="ident" id="3374417">m</span><span class="op" id="3374418">.</span><span class="ident" id="3374419">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374434">case</span>&nbsp;<span class="ident" id="3374439">syntax</span><span class="op" id="3374445">.</span><span class="ident" id="3374446">InstRune1</span><span class="op" id="3374455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374460">if</span>&nbsp;<span class="ident" id="3374463">r</span>&nbsp;<span class="op" id="3374465">!=</span>&nbsp;<span class="ident" id="3374468">inst</span><span class="op" id="3374472">.</span><span class="ident" id="3374473">Rune</span><span class="op" id="3374477">[</span><span class="num" id="3374478">0</span><span class="op" id="3374479">]</span>&nbsp;<span class="op" id="3374481">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374487">return</span>&nbsp;<span class="ident" id="3374494">m</span><span class="op" id="3374495">.</span><span class="ident" id="3374496">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374511">case</span>&nbsp;<span class="ident" id="3374516">syntax</span><span class="op" id="3374522">.</span><span class="ident" id="3374523">InstRuneAny</span><span class="op" id="3374534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374539">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374552">case</span>&nbsp;<span class="ident" id="3374557">syntax</span><span class="op" id="3374563">.</span><span class="ident" id="3374564">InstRuneAnyNotNL</span><span class="op" id="3374580">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374585">if</span>&nbsp;<span class="ident" id="3374588">r</span>&nbsp;<span class="op" id="3374590">==</span>&nbsp;<span class="string" id="3374593">&#39;\n&#39;</span>&nbsp;<span class="op" id="3374598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374604">return</span>&nbsp;<span class="ident" id="3374611">m</span><span class="op" id="3374612">.</span><span class="ident" id="3374613">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374628">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374695">case</span>&nbsp;<span class="ident" id="3374700">syntax</span><span class="op" id="3374706">.</span><span class="ident" id="3374707">InstAlt</span><span class="op" id="3374714">,</span>&nbsp;<span class="ident" id="3374716">syntax</span><span class="op" id="3374722">.</span><span class="ident" id="3374723">InstAltMatch</span><span class="op" id="3374735">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374740">pc</span>&nbsp;<span class="op" id="3374743">=</span>&nbsp;<span class="builtintype" id="3374745">int</span><span class="op" id="3374748">(</span><span class="ident" id="3374749">onePassNext</span><span class="op" id="3374760">(</span><span class="op" id="3374761">&amp;</span><span class="ident" id="3374762">inst</span><span class="op" id="3374766">,</span>&nbsp;<span class="ident" id="3374768">r</span><span class="op" id="3374769">)</span><span class="op" id="3374770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374775">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374786">case</span>&nbsp;<span class="ident" id="3374791">syntax</span><span class="op" id="3374797">.</span><span class="ident" id="3374798">InstFail</span><span class="op" id="3374806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374811">return</span>&nbsp;<span class="ident" id="3374818">m</span><span class="op" id="3374819">.</span><span class="ident" id="3374820">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374830">case</span>&nbsp;<span class="ident" id="3374835">syntax</span><span class="op" id="3374841">.</span><span class="ident" id="3374842">InstNop</span><span class="op" id="3374849">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374854">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374865">case</span>&nbsp;<span class="ident" id="3374870">syntax</span><span class="op" id="3374876">.</span><span class="ident" id="3374877">InstEmptyWidth</span><span class="op" id="3374891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374896">if</span>&nbsp;<span class="ident" id="3374899">syntax</span><span class="op" id="3374905">.</span><span class="ident" id="3374906">EmptyOp</span><span class="op" id="3374913">(</span><span class="ident" id="3374914">inst</span><span class="op" id="3374918">.</span><span class="ident" id="3374919">Arg</span><span class="op" id="3374922">)</span><span class="op" id="3374923">&amp;^</span><span class="ident" id="3374925">flag</span>&nbsp;<span class="op" id="3374930">!=</span>&nbsp;<span class="num" id="3374933">0</span>&nbsp;<span class="op" id="3374935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374941">return</span>&nbsp;<span class="ident" id="3374948">m</span><span class="op" id="3374949">.</span><span class="ident" id="3374950">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374961">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374977">case</span>&nbsp;<span class="ident" id="3374982">syntax</span><span class="op" id="3374988">.</span><span class="ident" id="3374989">InstCapture</span><span class="op" id="3375000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375005">if</span>&nbsp;<span class="builtintype" id="3375008">int</span><span class="op" id="3375011">(</span><span class="ident" id="3375012">inst</span><span class="op" id="3375016">.</span><span class="ident" id="3375017">Arg</span><span class="op" id="3375020">)</span>&nbsp;<span class="op" id="3375022">&lt;</span>&nbsp;<span class="builtinfunc" id="3375024">len</span><span class="op" id="3375027">(</span><span class="ident" id="3375028">m</span><span class="op" id="3375029">.</span><span class="ident" id="3375030">matchcap</span><span class="op" id="3375038">)</span>&nbsp;<span class="op" id="3375040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375046">m</span><span class="op" id="3375047">.</span><span class="ident" id="3375048">matchcap</span><span class="op" id="3375056">[</span><span class="ident" id="3375057">inst</span><span class="op" id="3375061">.</span><span class="ident" id="3375062">Arg</span><span class="op" id="3375065">]</span>&nbsp;<span class="op" id="3375067">=</span>&nbsp;<span class="ident" id="3375069">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375076">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375081">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375096">if</span>&nbsp;<span class="ident" id="3375099">width</span>&nbsp;<span class="op" id="3375105">==</span>&nbsp;<span class="num" id="3375108">0</span>&nbsp;<span class="op" id="3375110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375115">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375123">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375127">flag</span>&nbsp;<span class="op" id="3375132">=</span>&nbsp;<span class="ident" id="3375134">syntax</span><span class="op" id="3375140">.</span><span class="ident" id="3375141">EmptyOpContext</span><span class="op" id="3375155">(</span><span class="ident" id="3375156">r</span><span class="op" id="3375157">,</span>&nbsp;<span class="ident" id="3375159">r1</span><span class="op" id="3375161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375165">pos</span>&nbsp;<span class="op" id="3375169">+=</span>&nbsp;<span class="ident" id="3375172">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375180">r</span><span class="op" id="3375181">,</span>&nbsp;<span class="ident" id="3375183">width</span>&nbsp;<span class="op" id="3375189">=</span>&nbsp;<span class="ident" id="3375191">r1</span><span class="op" id="3375193">,</span>&nbsp;<span class="ident" id="3375195">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375204">if</span>&nbsp;<span class="ident" id="3375207">r</span>&nbsp;<span class="op" id="3375209">!=</span>&nbsp;<span class="ident" id="3375212">endOfText</span>&nbsp;<span class="op" id="3375222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375227">r1</span><span class="op" id="3375229">,</span>&nbsp;<span class="ident" id="3375231">width1</span>&nbsp;<span class="op" id="3375238">=</span>&nbsp;<span class="ident" id="3375240">i</span><span class="op" id="3375241">.</span><span class="ident" id="3375242">step</span><span class="op" id="3375246">(</span><span class="ident" id="3375247">pos</span>&nbsp;<span class="op" id="3375251">+</span>&nbsp;<span class="ident" id="3375253">width</span><span class="op" id="3375258">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375268">return</span>&nbsp;<span class="ident" id="3375275">m</span><span class="op" id="3375276">.</span><span class="ident" id="3375277">matched</span><br>
<span class="lineno"></span><span class="op" id="3375285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3375288">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="3375327">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="3375367">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3375425">var</span>&nbsp;<span class="ident" id="3375429">empty</span>&nbsp;<span class="op" id="3375435">=</span>&nbsp;<span class="builtinfunc" id="3375437">make</span><span class="op" id="3375441">(</span><span class="op" id="3375442">[</span><span class="op" id="3375443">]</span><span class="builtintype" id="3375444">int</span><span class="op" id="3375447">,</span>&nbsp;<span class="num" id="3375449">0</span><span class="op" id="3375450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3375453">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3375516">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3375555">func</span>&nbsp;<span class="op" id="3375560">(</span><span class="ident" id="3375561">re</span>&nbsp;<span class="op" id="3375564">*</span><span class="ident" id="3375565">Regexp</span><span class="op" id="3375571">)</span>&nbsp;<span class="ident" id="3375573">doExecute</span><span class="op" id="3375582">(</span><span class="ident" id="3375583">r</span>&nbsp;<span class="ident" id="3375585">io</span><span class="op" id="3375587">.</span><span class="ident" id="3375588">RuneReader</span><span class="op" id="3375598">,</span>&nbsp;<span class="ident" id="3375600">b</span>&nbsp;<span class="op" id="3375602">[</span><span class="op" id="3375603">]</span><span class="builtintype" id="3375604">byte</span><span class="op" id="3375608">,</span>&nbsp;<span class="ident" id="3375610">s</span>&nbsp;<span class="builtintype" id="3375612">string</span><span class="op" id="3375618">,</span>&nbsp;<span class="ident" id="3375620">pos</span>&nbsp;<span class="builtintype" id="3375624">int</span><span class="op" id="3375627">,</span>&nbsp;<span class="ident" id="3375629">ncap</span>&nbsp;<span class="builtintype" id="3375634">int</span><span class="op" id="3375637">)</span>&nbsp;<span class="op" id="3375639">[</span><span class="op" id="3375640">]</span><span class="builtintype" id="3375641">int</span>&nbsp;<span class="op" id="3375645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375648">m</span>&nbsp;<span class="op" id="3375650">:=</span>&nbsp;<span class="ident" id="3375653">re</span><span class="op" id="3375655">.</span><span class="ident" id="3375656">get</span><span class="op" id="3375659">(</span><span class="op" id="3375660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375663">var</span>&nbsp;<span class="ident" id="3375667">i</span>&nbsp;<span class="ident" id="3375669">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375676">if</span>&nbsp;<span class="ident" id="3375679">r</span>&nbsp;<span class="op" id="3375681">!=</span>&nbsp;<span class="ident" id="3375684">nil</span>&nbsp;<span class="op" id="3375688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375692">i</span>&nbsp;<span class="op" id="3375694">=</span>&nbsp;<span class="ident" id="3375696">m</span><span class="op" id="3375697">.</span><span class="ident" id="3375698">newInputReader</span><span class="op" id="3375712">(</span><span class="ident" id="3375713">r</span><span class="op" id="3375714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375717">}</span>&nbsp;<span class="keyword" id="3375719">else</span>&nbsp;<span class="keyword" id="3375724">if</span>&nbsp;<span class="ident" id="3375727">b</span>&nbsp;<span class="op" id="3375729">!=</span>&nbsp;<span class="ident" id="3375732">nil</span>&nbsp;<span class="op" id="3375736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375740">i</span>&nbsp;<span class="op" id="3375742">=</span>&nbsp;<span class="ident" id="3375744">m</span><span class="op" id="3375745">.</span><span class="ident" id="3375746">newInputBytes</span><span class="op" id="3375759">(</span><span class="ident" id="3375760">b</span><span class="op" id="3375761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375764">}</span>&nbsp;<span class="keyword" id="3375766">else</span>&nbsp;<span class="op" id="3375771">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375775">i</span>&nbsp;<span class="op" id="3375777">=</span>&nbsp;<span class="ident" id="3375779">m</span><span class="op" id="3375780">.</span><span class="ident" id="3375781">newInputString</span><span class="op" id="3375795">(</span><span class="ident" id="3375796">s</span><span class="op" id="3375797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375803">if</span>&nbsp;<span class="ident" id="3375806">m</span><span class="op" id="3375807">.</span><span class="ident" id="3375808">op</span>&nbsp;<span class="op" id="3375811">!=</span>&nbsp;<span class="ident" id="3375814">notOnePass</span>&nbsp;<span class="op" id="3375825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375829">if</span>&nbsp;<span class="op" id="3375832">!</span><span class="ident" id="3375833">m</span><span class="op" id="3375834">.</span><span class="ident" id="3375835">onepass</span><span class="op" id="3375842">(</span><span class="ident" id="3375843">i</span><span class="op" id="3375844">,</span>&nbsp;<span class="ident" id="3375846">pos</span><span class="op" id="3375849">)</span>&nbsp;<span class="op" id="3375851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375856">re</span><span class="op" id="3375858">.</span><span class="ident" id="3375859">put</span><span class="op" id="3375862">(</span><span class="ident" id="3375863">m</span><span class="op" id="3375864">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375869">return</span>&nbsp;<span class="ident" id="3375876">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375885">}</span>&nbsp;<span class="keyword" id="3375887">else</span>&nbsp;<span class="op" id="3375892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375896">m</span><span class="op" id="3375897">.</span><span class="ident" id="3375898">init</span><span class="op" id="3375902">(</span><span class="ident" id="3375903">ncap</span><span class="op" id="3375907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375911">if</span>&nbsp;<span class="op" id="3375914">!</span><span class="ident" id="3375915">m</span><span class="op" id="3375916">.</span><span class="ident" id="3375917">match</span><span class="op" id="3375922">(</span><span class="ident" id="3375923">i</span><span class="op" id="3375924">,</span>&nbsp;<span class="ident" id="3375926">pos</span><span class="op" id="3375929">)</span>&nbsp;<span class="op" id="3375931">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375936">re</span><span class="op" id="3375938">.</span><span class="ident" id="3375939">put</span><span class="op" id="3375942">(</span><span class="ident" id="3375943">m</span><span class="op" id="3375944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375949">return</span>&nbsp;<span class="ident" id="3375956">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375968">if</span>&nbsp;<span class="ident" id="3375971">ncap</span>&nbsp;<span class="op" id="3375976">==</span>&nbsp;<span class="num" id="3375979">0</span>&nbsp;<span class="op" id="3375981">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375985">re</span><span class="op" id="3375987">.</span><span class="ident" id="3375988">put</span><span class="op" id="3375991">(</span><span class="ident" id="3375992">m</span><span class="op" id="3375993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375997">return</span>&nbsp;<span class="ident" id="3376004">empty</span>&nbsp;<span class="comment" id="3376010">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3376035">cap</span>&nbsp;<span class="op" id="3376039">:=</span>&nbsp;<span class="builtinfunc" id="3376042">make</span><span class="op" id="3376046">(</span><span class="op" id="3376047">[</span><span class="op" id="3376048">]</span><span class="builtintype" id="3376049">int</span><span class="op" id="3376052">,</span>&nbsp;<span class="builtinfunc" id="3376054">len</span><span class="op" id="3376057">(</span><span class="ident" id="3376058">m</span><span class="op" id="3376059">.</span><span class="ident" id="3376060">matchcap</span><span class="op" id="3376068">)</span><span class="op" id="3376069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3376072">copy</span><span class="op" id="3376076">(</span><span class="builtinfunc" id="3376077">cap</span><span class="op" id="3376080">,</span>&nbsp;<span class="ident" id="3376082">m</span><span class="op" id="3376083">.</span><span class="ident" id="3376084">matchcap</span><span class="op" id="3376092">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376095">re</span><span class="op" id="3376097">.</span><span class="ident" id="3376098">put</span><span class="op" id="3376101">(</span><span class="ident" id="3376102">m</span><span class="op" id="3376103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376106">return</span>&nbsp;<span class="builtinfunc" id="3376113">cap</span><br>
<span class="lineno"></span><span class="op" id="3376117">}</span>
</div>
</body>
</html>
