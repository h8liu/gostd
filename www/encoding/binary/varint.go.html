<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2964315">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2964371">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2964425">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2964476">package</span>&nbsp;<span class="ident" id="2964484">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2964492">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="2964554">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="2964574">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="2964648">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="2964676">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2964751">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="2964789">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2964858">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="2964931">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="2965006">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2965058">//</span><br>
<span class="lineno"></span><span class="comment" id="2965061">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="2965077">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="2965146">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="2965225">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="2965304">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2965380">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2965459">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="2965537">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2965618">import</span>&nbsp;<span class="op" id="2965625">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965628">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965638">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="2965643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2965646">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="2965720">const</span>&nbsp;<span class="op" id="2965726">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965729">MaxVarintLen16</span>&nbsp;<span class="op" id="2965744">=</span>&nbsp;<span class="num" id="2965746">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965749">MaxVarintLen32</span>&nbsp;<span class="op" id="2965764">=</span>&nbsp;<span class="num" id="2965766">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965769">MaxVarintLen64</span>&nbsp;<span class="op" id="2965784">=</span>&nbsp;<span class="num" id="2965786">10</span><br>
<span class="lineno"></span><span class="op" id="2965789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2965792">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="2965873">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2965927">func</span>&nbsp;<span class="ident" id="2965932">PutUvarint</span><span class="op" id="2965942">(</span><span class="ident" id="2965943">buf</span>&nbsp;<span class="op" id="2965947">[</span><span class="op" id="2965948">]</span><span class="builtintype" id="2965949">byte</span><span class="op" id="2965953">,</span>&nbsp;<span class="ident" id="2965955">x</span>&nbsp;<span class="ident" id="2965957">uint64</span><span class="op" id="2965963">)</span>&nbsp;<span class="builtintype" id="2965965">int</span>&nbsp;<span class="op" id="2965969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965972">i</span>&nbsp;<span class="op" id="2965974">:=</span>&nbsp;<span class="num" id="2965977">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2965980">for</span>&nbsp;<span class="ident" id="2965984">x</span>&nbsp;<span class="op" id="2965986">&gt;=</span>&nbsp;<span class="num" id="2965989">0x80</span>&nbsp;<span class="op" id="2965994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965998">buf</span><span class="op" id="2966001">[</span><span class="ident" id="2966002">i</span><span class="op" id="2966003">]</span>&nbsp;<span class="op" id="2966005">=</span>&nbsp;<span class="builtintype" id="2966007">byte</span><span class="op" id="2966011">(</span><span class="ident" id="2966012">x</span><span class="op" id="2966013">)</span>&nbsp;<span class="op" id="2966015">|</span>&nbsp;<span class="num" id="2966017">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966024">x</span>&nbsp;<span class="op" id="2966026">&gt;&gt;=</span>&nbsp;<span class="num" id="2966030">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966034">i</span><span class="op" id="2966035">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2966039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966042">buf</span><span class="op" id="2966045">[</span><span class="ident" id="2966046">i</span><span class="op" id="2966047">]</span>&nbsp;<span class="op" id="2966049">=</span>&nbsp;<span class="builtintype" id="2966051">byte</span><span class="op" id="2966055">(</span><span class="ident" id="2966056">x</span><span class="op" id="2966057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966060">return</span>&nbsp;<span class="ident" id="2966067">i</span>&nbsp;<span class="op" id="2966069">+</span>&nbsp;<span class="num" id="2966071">1</span><br>
<span class="lineno">50</span><span class="op" id="2966073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2966076">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2966144">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2966212">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="2966258">//</span><br>
<span class="lineno"></span><span class="comment" id="2966261">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2966286">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2966334">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2966385">//</span><br>
<span class="lineno">60</span><span class="keyword" id="2966388">func</span>&nbsp;<span class="ident" id="2966393">Uvarint</span><span class="op" id="2966400">(</span><span class="ident" id="2966401">buf</span>&nbsp;<span class="op" id="2966405">[</span><span class="op" id="2966406">]</span><span class="builtintype" id="2966407">byte</span><span class="op" id="2966411">)</span>&nbsp;<span class="op" id="2966413">(</span><span class="ident" id="2966414">uint64</span><span class="op" id="2966420">,</span>&nbsp;<span class="builtintype" id="2966422">int</span><span class="op" id="2966425">)</span>&nbsp;<span class="op" id="2966427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966430">var</span>&nbsp;<span class="ident" id="2966434">x</span>&nbsp;<span class="ident" id="2966436">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966444">var</span>&nbsp;<span class="ident" id="2966448">s</span>&nbsp;<span class="builtintype" id="2966450">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966456">for</span>&nbsp;<span class="ident" id="2966460">i</span><span class="op" id="2966461">,</span>&nbsp;<span class="ident" id="2966463">b</span>&nbsp;<span class="op" id="2966465">:=</span>&nbsp;<span class="keyword" id="2966468">range</span>&nbsp;<span class="ident" id="2966474">buf</span>&nbsp;<span class="op" id="2966478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966482">if</span>&nbsp;<span class="ident" id="2966485">b</span>&nbsp;<span class="op" id="2966487">&lt;</span>&nbsp;<span class="num" id="2966489">0x80</span>&nbsp;<span class="op" id="2966494">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966499">if</span>&nbsp;<span class="ident" id="2966502">i</span>&nbsp;<span class="op" id="2966504">&gt;</span>&nbsp;<span class="num" id="2966506">9</span>&nbsp;<span class="op" id="2966508">||</span>&nbsp;<span class="ident" id="2966511">i</span>&nbsp;<span class="op" id="2966513">==</span>&nbsp;<span class="num" id="2966516">9</span>&nbsp;<span class="op" id="2966518">&amp;&amp;</span>&nbsp;<span class="ident" id="2966521">b</span>&nbsp;<span class="op" id="2966523">&gt;</span>&nbsp;<span class="num" id="2966525">1</span>&nbsp;<span class="op" id="2966527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966533">return</span>&nbsp;<span class="num" id="2966540">0</span><span class="op" id="2966541">,</span>&nbsp;<span class="op" id="2966543">-</span><span class="op" id="2966544">(</span><span class="ident" id="2966545">i</span>&nbsp;<span class="op" id="2966547">+</span>&nbsp;<span class="num" id="2966549">1</span><span class="op" id="2966550">)</span>&nbsp;<span class="comment" id="2966552">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2966567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966572">return</span>&nbsp;<span class="ident" id="2966579">x</span>&nbsp;<span class="op" id="2966581">|</span>&nbsp;<span class="ident" id="2966583">uint64</span><span class="op" id="2966589">(</span><span class="ident" id="2966590">b</span><span class="op" id="2966591">)</span><span class="op" id="2966592">&lt;&lt;</span><span class="ident" id="2966594">s</span><span class="op" id="2966595">,</span>&nbsp;<span class="ident" id="2966597">i</span>&nbsp;<span class="op" id="2966599">+</span>&nbsp;<span class="num" id="2966601">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2966605">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966609">x</span>&nbsp;<span class="op" id="2966611">|=</span>&nbsp;<span class="ident" id="2966614">uint64</span><span class="op" id="2966620">(</span><span class="ident" id="2966621">b</span><span class="op" id="2966622">&amp;</span><span class="num" id="2966623">0x7f</span><span class="op" id="2966627">)</span>&nbsp;<span class="op" id="2966629">&lt;&lt;</span>&nbsp;<span class="ident" id="2966632">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966636">s</span>&nbsp;<span class="op" id="2966638">+=</span>&nbsp;<span class="num" id="2966641">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2966644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966647">return</span>&nbsp;<span class="num" id="2966654">0</span><span class="op" id="2966655">,</span>&nbsp;<span class="num" id="2966657">0</span><br>
<span class="lineno"></span><span class="op" id="2966659">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="2966662">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2966742">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2966795">func</span>&nbsp;<span class="ident" id="2966800">PutVarint</span><span class="op" id="2966809">(</span><span class="ident" id="2966810">buf</span>&nbsp;<span class="op" id="2966814">[</span><span class="op" id="2966815">]</span><span class="builtintype" id="2966816">byte</span><span class="op" id="2966820">,</span>&nbsp;<span class="ident" id="2966822">x</span>&nbsp;<span class="ident" id="2966824">int64</span><span class="op" id="2966829">)</span>&nbsp;<span class="builtintype" id="2966831">int</span>&nbsp;<span class="op" id="2966835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966838">ux</span>&nbsp;<span class="op" id="2966841">:=</span>&nbsp;<span class="ident" id="2966844">uint64</span><span class="op" id="2966850">(</span><span class="ident" id="2966851">x</span><span class="op" id="2966852">)</span>&nbsp;<span class="op" id="2966854">&lt;&lt;</span>&nbsp;<span class="num" id="2966857">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966860">if</span>&nbsp;<span class="ident" id="2966863">x</span>&nbsp;<span class="op" id="2966865">&lt;</span>&nbsp;<span class="num" id="2966867">0</span>&nbsp;<span class="op" id="2966869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966873">ux</span>&nbsp;<span class="op" id="2966876">=</span>&nbsp;<span class="op" id="2966878">^</span><span class="ident" id="2966879">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2966883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2966886">return</span>&nbsp;<span class="ident" id="2966893">PutUvarint</span><span class="op" id="2966903">(</span><span class="ident" id="2966904">buf</span><span class="op" id="2966907">,</span>&nbsp;<span class="ident" id="2966909">ux</span><span class="op" id="2966911">)</span><br>
<span class="lineno"></span><span class="op" id="2966913">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="2966916">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2966983">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2967051">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="2967116">//</span><br>
<span class="lineno">90</span><span class="comment" id="2967119">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2967144">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2967192">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2967243">//</span><br>
<span class="lineno"></span><span class="keyword" id="2967246">func</span>&nbsp;<span class="ident" id="2967251">Varint</span><span class="op" id="2967257">(</span><span class="ident" id="2967258">buf</span>&nbsp;<span class="op" id="2967262">[</span><span class="op" id="2967263">]</span><span class="builtintype" id="2967264">byte</span><span class="op" id="2967268">)</span>&nbsp;<span class="op" id="2967270">(</span><span class="ident" id="2967271">int64</span><span class="op" id="2967276">,</span>&nbsp;<span class="builtintype" id="2967278">int</span><span class="op" id="2967281">)</span>&nbsp;<span class="op" id="2967283">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967286">ux</span><span class="op" id="2967288">,</span>&nbsp;<span class="ident" id="2967290">n</span>&nbsp;<span class="op" id="2967292">:=</span>&nbsp;<span class="ident" id="2967295">Uvarint</span><span class="op" id="2967302">(</span><span class="ident" id="2967303">buf</span><span class="op" id="2967306">)</span>&nbsp;<span class="comment" id="2967308">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967348">x</span>&nbsp;<span class="op" id="2967350">:=</span>&nbsp;<span class="ident" id="2967353">int64</span><span class="op" id="2967358">(</span><span class="ident" id="2967359">ux</span>&nbsp;<span class="op" id="2967362">&gt;&gt;</span>&nbsp;<span class="num" id="2967365">1</span><span class="op" id="2967366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967369">if</span>&nbsp;<span class="ident" id="2967372">ux</span><span class="op" id="2967374">&amp;</span><span class="num" id="2967375">1</span>&nbsp;<span class="op" id="2967377">!=</span>&nbsp;<span class="num" id="2967380">0</span>&nbsp;<span class="op" id="2967382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967386">x</span>&nbsp;<span class="op" id="2967388">=</span>&nbsp;<span class="op" id="2967390">^</span><span class="ident" id="2967391">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2967394">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967397">return</span>&nbsp;<span class="ident" id="2967404">x</span><span class="op" id="2967405">,</span>&nbsp;<span class="ident" id="2967407">n</span><br>
<span class="lineno"></span><span class="op" id="2967409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2967412">var</span>&nbsp;<span class="ident" id="2967416">overflow</span>&nbsp;<span class="op" id="2967425">=</span>&nbsp;<span class="ident" id="2967427">errors</span><span class="op" id="2967433">.</span><span class="ident" id="2967434">New</span><span class="op" id="2967437">(</span><span class="string" id="2967438">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="2967481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2967484">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="2967568">func</span>&nbsp;<span class="ident" id="2967573">ReadUvarint</span><span class="op" id="2967584">(</span><span class="ident" id="2967585">r</span>&nbsp;<span class="ident" id="2967587">io</span><span class="op" id="2967589">.</span><span class="ident" id="2967590">ByteReader</span><span class="op" id="2967600">)</span>&nbsp;<span class="op" id="2967602">(</span><span class="ident" id="2967603">uint64</span><span class="op" id="2967609">,</span>&nbsp;<span class="builtintype" id="2967611">error</span><span class="op" id="2967616">)</span>&nbsp;<span class="op" id="2967618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967621">var</span>&nbsp;<span class="ident" id="2967625">x</span>&nbsp;<span class="ident" id="2967627">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967635">var</span>&nbsp;<span class="ident" id="2967639">s</span>&nbsp;<span class="builtintype" id="2967641">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967647">for</span>&nbsp;<span class="ident" id="2967651">i</span>&nbsp;<span class="op" id="2967653">:=</span>&nbsp;<span class="num" id="2967656">0</span><span class="op" id="2967657">;</span>&nbsp;<span class="op" id="2967659">;</span>&nbsp;<span class="ident" id="2967661">i</span><span class="op" id="2967662">++</span>&nbsp;<span class="op" id="2967665">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967669">b</span><span class="op" id="2967670">,</span>&nbsp;<span class="ident" id="2967672">err</span>&nbsp;<span class="op" id="2967676">:=</span>&nbsp;<span class="ident" id="2967679">r</span><span class="op" id="2967680">.</span><span class="ident" id="2967681">ReadByte</span><span class="op" id="2967689">(</span><span class="op" id="2967690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967694">if</span>&nbsp;<span class="ident" id="2967697">err</span>&nbsp;<span class="op" id="2967701">!=</span>&nbsp;<span class="ident" id="2967704">nil</span>&nbsp;<span class="op" id="2967708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967713">return</span>&nbsp;<span class="ident" id="2967720">x</span><span class="op" id="2967721">,</span>&nbsp;<span class="ident" id="2967723">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2967729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967733">if</span>&nbsp;<span class="ident" id="2967736">b</span>&nbsp;<span class="op" id="2967738">&lt;</span>&nbsp;<span class="num" id="2967740">0x80</span>&nbsp;<span class="op" id="2967745">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967750">if</span>&nbsp;<span class="ident" id="2967753">i</span>&nbsp;<span class="op" id="2967755">&gt;</span>&nbsp;<span class="num" id="2967757">9</span>&nbsp;<span class="op" id="2967759">||</span>&nbsp;<span class="ident" id="2967762">i</span>&nbsp;<span class="op" id="2967764">==</span>&nbsp;<span class="num" id="2967767">9</span>&nbsp;<span class="op" id="2967769">&amp;&amp;</span>&nbsp;<span class="ident" id="2967772">b</span>&nbsp;<span class="op" id="2967774">&gt;</span>&nbsp;<span class="num" id="2967776">1</span>&nbsp;<span class="op" id="2967778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967784">return</span>&nbsp;<span class="ident" id="2967791">x</span><span class="op" id="2967792">,</span>&nbsp;<span class="ident" id="2967794">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2967806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2967811">return</span>&nbsp;<span class="ident" id="2967818">x</span>&nbsp;<span class="op" id="2967820">|</span>&nbsp;<span class="ident" id="2967822">uint64</span><span class="op" id="2967828">(</span><span class="ident" id="2967829">b</span><span class="op" id="2967830">)</span><span class="op" id="2967831">&lt;&lt;</span><span class="ident" id="2967833">s</span><span class="op" id="2967834">,</span>&nbsp;<span class="ident" id="2967836">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2967842">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967846">x</span>&nbsp;<span class="op" id="2967848">|=</span>&nbsp;<span class="ident" id="2967851">uint64</span><span class="op" id="2967857">(</span><span class="ident" id="2967858">b</span><span class="op" id="2967859">&amp;</span><span class="num" id="2967860">0x7f</span><span class="op" id="2967864">)</span>&nbsp;<span class="op" id="2967866">&lt;&lt;</span>&nbsp;<span class="ident" id="2967869">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967873">s</span>&nbsp;<span class="op" id="2967875">+=</span>&nbsp;<span class="num" id="2967878">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2967881">}</span><br>
<span class="lineno"></span><span class="op" id="2967883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2967886">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="2967967">func</span>&nbsp;<span class="ident" id="2967972">ReadVarint</span><span class="op" id="2967982">(</span><span class="ident" id="2967983">r</span>&nbsp;<span class="ident" id="2967985">io</span><span class="op" id="2967987">.</span><span class="ident" id="2967988">ByteReader</span><span class="op" id="2967998">)</span>&nbsp;<span class="op" id="2968000">(</span><span class="ident" id="2968001">int64</span><span class="op" id="2968006">,</span>&nbsp;<span class="builtintype" id="2968008">error</span><span class="op" id="2968013">)</span>&nbsp;<span class="op" id="2968015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2968018">ux</span><span class="op" id="2968020">,</span>&nbsp;<span class="ident" id="2968022">err</span>&nbsp;<span class="op" id="2968026">:=</span>&nbsp;<span class="ident" id="2968029">ReadUvarint</span><span class="op" id="2968040">(</span><span class="ident" id="2968041">r</span><span class="op" id="2968042">)</span>&nbsp;<span class="comment" id="2968044">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2968084">x</span>&nbsp;<span class="op" id="2968086">:=</span>&nbsp;<span class="ident" id="2968089">int64</span><span class="op" id="2968094">(</span><span class="ident" id="2968095">ux</span>&nbsp;<span class="op" id="2968098">&gt;&gt;</span>&nbsp;<span class="num" id="2968101">1</span><span class="op" id="2968102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2968105">if</span>&nbsp;<span class="ident" id="2968108">ux</span><span class="op" id="2968110">&amp;</span><span class="num" id="2968111">1</span>&nbsp;<span class="op" id="2968113">!=</span>&nbsp;<span class="num" id="2968116">0</span>&nbsp;<span class="op" id="2968118">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2968122">x</span>&nbsp;<span class="op" id="2968124">=</span>&nbsp;<span class="op" id="2968126">^</span><span class="ident" id="2968127">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2968130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2968133">return</span>&nbsp;<span class="ident" id="2968140">x</span><span class="op" id="2968141">,</span>&nbsp;<span class="ident" id="2968143">err</span><br>
<span class="lineno"></span><span class="op" id="2968147">}</span>
</div>
</body>
</html>
