<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7722435">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7722490">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7722544">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7722595">package</span>&nbsp;<span class="ident" id="7722603">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7722608">import</span>&nbsp;<span class="op" id="7722615">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722618">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722628">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722635">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722641">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722648">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722655">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722676">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722687">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722698">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722706">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722721">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7722732">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7722739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7722742">var</span>&nbsp;<span class="op" id="7722746">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722749">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722775">*</span><span class="ident" id="7722776">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722784">serverAddr</span><span class="op" id="7722794">,</span>&nbsp;<span class="ident" id="7722796">newServerAddr</span>&nbsp;<span class="builtintype" id="7722810">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722818">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7722844">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722852">once</span><span class="op" id="7722856">,</span>&nbsp;<span class="ident" id="7722858">newOnce</span><span class="op" id="7722865">,</span>&nbsp;<span class="ident" id="7722867">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7722878">sync</span><span class="op" id="7722882">.</span><span class="ident" id="7722883">Once</span><br>
<span class="lineno"></span><span class="op" id="7722888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7722891">const</span>&nbsp;<span class="op" id="7722897">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722900">newHttpPath</span>&nbsp;<span class="op" id="7722912">=</span>&nbsp;<span class="string" id="7722914">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="7722921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7722924">type</span>&nbsp;<span class="ident" id="7722929">Args</span>&nbsp;<span class="keyword" id="7722934">struct</span>&nbsp;<span class="op" id="7722941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722944">A</span><span class="op" id="7722945">,</span>&nbsp;<span class="ident" id="7722947">B</span>&nbsp;<span class="builtintype" id="7722949">int</span><br>
<span class="lineno">35</span><span class="op" id="7722953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7722956">type</span>&nbsp;<span class="ident" id="7722961">Reply</span>&nbsp;<span class="keyword" id="7722967">struct</span>&nbsp;<span class="op" id="7722974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722977">C</span>&nbsp;<span class="builtintype" id="7722979">int</span><br>
<span class="lineno"></span><span class="op" id="7722983">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7722986">type</span>&nbsp;<span class="ident" id="7722991">Arith</span>&nbsp;<span class="builtintype" id="7722997">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7723002">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7723090">func</span>&nbsp;<span class="op" id="7723095">(</span><span class="ident" id="7723096">t</span>&nbsp;<span class="op" id="7723098">*</span><span class="ident" id="7723099">Arith</span><span class="op" id="7723104">)</span>&nbsp;<span class="ident" id="7723106">Add</span><span class="op" id="7723109">(</span><span class="ident" id="7723110">args</span>&nbsp;<span class="ident" id="7723115">Args</span><span class="op" id="7723119">,</span>&nbsp;<span class="ident" id="7723121">reply</span>&nbsp;<span class="op" id="7723127">*</span><span class="ident" id="7723128">Reply</span><span class="op" id="7723133">)</span>&nbsp;<span class="builtintype" id="7723135">error</span>&nbsp;<span class="op" id="7723141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723144">reply</span><span class="op" id="7723149">.</span><span class="ident" id="7723150">C</span>&nbsp;<span class="op" id="7723152">=</span>&nbsp;<span class="ident" id="7723154">args</span><span class="op" id="7723158">.</span><span class="ident" id="7723159">A</span>&nbsp;<span class="op" id="7723161">+</span>&nbsp;<span class="ident" id="7723163">args</span><span class="op" id="7723167">.</span><span class="ident" id="7723168">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723171">return</span>&nbsp;<span class="ident" id="7723178">nil</span><br>
<span class="lineno"></span><span class="op" id="7723182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7723185">func</span>&nbsp;<span class="op" id="7723190">(</span><span class="ident" id="7723191">t</span>&nbsp;<span class="op" id="7723193">*</span><span class="ident" id="7723194">Arith</span><span class="op" id="7723199">)</span>&nbsp;<span class="ident" id="7723201">Mul</span><span class="op" id="7723204">(</span><span class="ident" id="7723205">args</span>&nbsp;<span class="op" id="7723210">*</span><span class="ident" id="7723211">Args</span><span class="op" id="7723215">,</span>&nbsp;<span class="ident" id="7723217">reply</span>&nbsp;<span class="op" id="7723223">*</span><span class="ident" id="7723224">Reply</span><span class="op" id="7723229">)</span>&nbsp;<span class="builtintype" id="7723231">error</span>&nbsp;<span class="op" id="7723237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723240">reply</span><span class="op" id="7723245">.</span><span class="ident" id="7723246">C</span>&nbsp;<span class="op" id="7723248">=</span>&nbsp;<span class="ident" id="7723250">args</span><span class="op" id="7723254">.</span><span class="ident" id="7723255">A</span>&nbsp;<span class="op" id="7723257">*</span>&nbsp;<span class="ident" id="7723259">args</span><span class="op" id="7723263">.</span><span class="ident" id="7723264">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723267">return</span>&nbsp;<span class="ident" id="7723274">nil</span><br>
<span class="lineno"></span><span class="op" id="7723278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7723281">func</span>&nbsp;<span class="op" id="7723286">(</span><span class="ident" id="7723287">t</span>&nbsp;<span class="op" id="7723289">*</span><span class="ident" id="7723290">Arith</span><span class="op" id="7723295">)</span>&nbsp;<span class="ident" id="7723297">Div</span><span class="op" id="7723300">(</span><span class="ident" id="7723301">args</span>&nbsp;<span class="ident" id="7723306">Args</span><span class="op" id="7723310">,</span>&nbsp;<span class="ident" id="7723312">reply</span>&nbsp;<span class="op" id="7723318">*</span><span class="ident" id="7723319">Reply</span><span class="op" id="7723324">)</span>&nbsp;<span class="builtintype" id="7723326">error</span>&nbsp;<span class="op" id="7723332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723335">if</span>&nbsp;<span class="ident" id="7723338">args</span><span class="op" id="7723342">.</span><span class="ident" id="7723343">B</span>&nbsp;<span class="op" id="7723345">==</span>&nbsp;<span class="num" id="7723348">0</span>&nbsp;<span class="op" id="7723350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723354">return</span>&nbsp;<span class="ident" id="7723361">errors</span><span class="op" id="7723367">.</span><span class="ident" id="7723368">New</span><span class="op" id="7723371">(</span><span class="string" id="7723372">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7723388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723394">reply</span><span class="op" id="7723399">.</span><span class="ident" id="7723400">C</span>&nbsp;<span class="op" id="7723402">=</span>&nbsp;<span class="ident" id="7723404">args</span><span class="op" id="7723408">.</span><span class="ident" id="7723409">A</span>&nbsp;<span class="op" id="7723411">/</span>&nbsp;<span class="ident" id="7723413">args</span><span class="op" id="7723417">.</span><span class="ident" id="7723418">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723421">return</span>&nbsp;<span class="ident" id="7723428">nil</span><br>
<span class="lineno"></span><span class="op" id="7723432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7723435">func</span>&nbsp;<span class="op" id="7723440">(</span><span class="ident" id="7723441">t</span>&nbsp;<span class="op" id="7723443">*</span><span class="ident" id="7723444">Arith</span><span class="op" id="7723449">)</span>&nbsp;<span class="ident" id="7723451">String</span><span class="op" id="7723457">(</span><span class="ident" id="7723458">args</span>&nbsp;<span class="op" id="7723463">*</span><span class="ident" id="7723464">Args</span><span class="op" id="7723468">,</span>&nbsp;<span class="ident" id="7723470">reply</span>&nbsp;<span class="op" id="7723476">*</span><span class="builtintype" id="7723477">string</span><span class="op" id="7723483">)</span>&nbsp;<span class="builtintype" id="7723485">error</span>&nbsp;<span class="op" id="7723491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723494">*</span><span class="ident" id="7723495">reply</span>&nbsp;<span class="op" id="7723501">=</span>&nbsp;<span class="ident" id="7723503">fmt</span><span class="op" id="7723506">.</span><span class="ident" id="7723507">Sprintf</span><span class="op" id="7723514">(</span><span class="string" id="7723515">&#34;%d+%d=%d&#34;</span><span class="op" id="7723525">,</span>&nbsp;<span class="ident" id="7723527">args</span><span class="op" id="7723531">.</span><span class="ident" id="7723532">A</span><span class="op" id="7723533">,</span>&nbsp;<span class="ident" id="7723535">args</span><span class="op" id="7723539">.</span><span class="ident" id="7723540">B</span><span class="op" id="7723541">,</span>&nbsp;<span class="ident" id="7723543">args</span><span class="op" id="7723547">.</span><span class="ident" id="7723548">A</span><span class="op" id="7723549">+</span><span class="ident" id="7723550">args</span><span class="op" id="7723554">.</span><span class="ident" id="7723555">B</span><span class="op" id="7723556">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723559">return</span>&nbsp;<span class="ident" id="7723566">nil</span><br>
<span class="lineno"></span><span class="op" id="7723570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7723573">func</span>&nbsp;<span class="op" id="7723578">(</span><span class="ident" id="7723579">t</span>&nbsp;<span class="op" id="7723581">*</span><span class="ident" id="7723582">Arith</span><span class="op" id="7723587">)</span>&nbsp;<span class="ident" id="7723589">Scan</span><span class="op" id="7723593">(</span><span class="ident" id="7723594">args</span>&nbsp;<span class="builtintype" id="7723599">string</span><span class="op" id="7723605">,</span>&nbsp;<span class="ident" id="7723607">reply</span>&nbsp;<span class="op" id="7723613">*</span><span class="ident" id="7723614">Reply</span><span class="op" id="7723619">)</span>&nbsp;<span class="op" id="7723621">(</span><span class="ident" id="7723622">err</span>&nbsp;<span class="builtintype" id="7723626">error</span><span class="op" id="7723631">)</span>&nbsp;<span class="op" id="7723633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723636">_</span><span class="op" id="7723637">,</span>&nbsp;<span class="ident" id="7723639">err</span>&nbsp;<span class="op" id="7723643">=</span>&nbsp;<span class="ident" id="7723645">fmt</span><span class="op" id="7723648">.</span><span class="ident" id="7723649">Sscan</span><span class="op" id="7723654">(</span><span class="ident" id="7723655">args</span><span class="op" id="7723659">,</span>&nbsp;<span class="op" id="7723661">&amp;</span><span class="ident" id="7723662">reply</span><span class="op" id="7723667">.</span><span class="ident" id="7723668">C</span><span class="op" id="7723669">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723672">return</span><br>
<span class="lineno"></span><span class="op" id="7723679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7723682">func</span>&nbsp;<span class="op" id="7723687">(</span><span class="ident" id="7723688">t</span>&nbsp;<span class="op" id="7723690">*</span><span class="ident" id="7723691">Arith</span><span class="op" id="7723696">)</span>&nbsp;<span class="ident" id="7723698">Error</span><span class="op" id="7723703">(</span><span class="ident" id="7723704">args</span>&nbsp;<span class="op" id="7723709">*</span><span class="ident" id="7723710">Args</span><span class="op" id="7723714">,</span>&nbsp;<span class="ident" id="7723716">reply</span>&nbsp;<span class="op" id="7723722">*</span><span class="ident" id="7723723">Reply</span><span class="op" id="7723728">)</span>&nbsp;<span class="builtintype" id="7723730">error</span>&nbsp;<span class="op" id="7723736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7723739">panic</span><span class="op" id="7723744">(</span><span class="string" id="7723745">&#34;ERROR&#34;</span><span class="op" id="7723752">)</span><br>
<span class="lineno">75</span><span class="op" id="7723754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7723757">func</span>&nbsp;<span class="ident" id="7723762">listenTCP</span><span class="op" id="7723771">(</span><span class="op" id="7723772">)</span>&nbsp;<span class="op" id="7723774">(</span><span class="ident" id="7723775">net</span><span class="op" id="7723778">.</span><span class="ident" id="7723779">Listener</span><span class="op" id="7723787">,</span>&nbsp;<span class="builtintype" id="7723789">string</span><span class="op" id="7723795">)</span>&nbsp;<span class="op" id="7723797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723800">l</span><span class="op" id="7723801">,</span>&nbsp;<span class="ident" id="7723803">e</span>&nbsp;<span class="op" id="7723805">:=</span>&nbsp;<span class="ident" id="7723808">net</span><span class="op" id="7723811">.</span><span class="ident" id="7723812">Listen</span><span class="op" id="7723818">(</span><span class="string" id="7723819">&#34;tcp&#34;</span><span class="op" id="7723824">,</span>&nbsp;<span class="string" id="7723826">&#34;127.0.0.1:0&#34;</span><span class="op" id="7723839">)</span>&nbsp;<span class="comment" id="7723841">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723867">if</span>&nbsp;<span class="ident" id="7723870">e</span>&nbsp;<span class="op" id="7723872">!=</span>&nbsp;<span class="ident" id="7723875">nil</span>&nbsp;<span class="op" id="7723879">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723883">log</span><span class="op" id="7723886">.</span><span class="ident" id="7723887">Fatalf</span><span class="op" id="7723893">(</span><span class="string" id="7723894">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7723917">,</span>&nbsp;<span class="ident" id="7723919">e</span><span class="op" id="7723920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723926">return</span>&nbsp;<span class="ident" id="7723933">l</span><span class="op" id="7723934">,</span>&nbsp;<span class="ident" id="7723936">l</span><span class="op" id="7723937">.</span><span class="ident" id="7723938">Addr</span><span class="op" id="7723942">(</span><span class="op" id="7723943">)</span><span class="op" id="7723944">.</span><span class="ident" id="7723945">String</span><span class="op" id="7723951">(</span><span class="op" id="7723952">)</span><br>
<span class="lineno"></span><span class="op" id="7723954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="7723957">func</span>&nbsp;<span class="ident" id="7723962">startServer</span><span class="op" id="7723973">(</span><span class="op" id="7723974">)</span>&nbsp;<span class="op" id="7723976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723979">Register</span><span class="op" id="7723987">(</span><span class="builtinfunc" id="7723988">new</span><span class="op" id="7723991">(</span><span class="ident" id="7723992">Arith</span><span class="op" id="7723997">)</span><span class="op" id="7723998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724001">RegisterName</span><span class="op" id="7724013">(</span><span class="string" id="7724014">&#34;net.rpc.Arith&#34;</span><span class="op" id="7724029">,</span>&nbsp;<span class="builtinfunc" id="7724031">new</span><span class="op" id="7724034">(</span><span class="ident" id="7724035">Arith</span><span class="op" id="7724040">)</span><span class="op" id="7724041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724045">var</span>&nbsp;<span class="ident" id="7724049">l</span>&nbsp;<span class="ident" id="7724051">net</span><span class="op" id="7724054">.</span><span class="ident" id="7724055">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724065">l</span><span class="op" id="7724066">,</span>&nbsp;<span class="ident" id="7724068">serverAddr</span>&nbsp;<span class="op" id="7724079">=</span>&nbsp;<span class="ident" id="7724081">listenTCP</span><span class="op" id="7724090">(</span><span class="op" id="7724091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724094">log</span><span class="op" id="7724097">.</span><span class="ident" id="7724098">Println</span><span class="op" id="7724105">(</span><span class="string" id="7724106">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7724136">,</span>&nbsp;<span class="ident" id="7724138">serverAddr</span><span class="op" id="7724148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724151">go</span>&nbsp;<span class="ident" id="7724154">Accept</span><span class="op" id="7724160">(</span><span class="ident" id="7724161">l</span><span class="op" id="7724162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724166">HandleHTTP</span><span class="op" id="7724176">(</span><span class="op" id="7724177">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724180">httpOnce</span><span class="op" id="7724188">.</span><span class="ident" id="7724189">Do</span><span class="op" id="7724191">(</span><span class="ident" id="7724192">startHttpServer</span><span class="op" id="7724207">)</span><br>
<span class="lineno"></span><span class="op" id="7724209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7724212">func</span>&nbsp;<span class="ident" id="7724217">startNewServer</span><span class="op" id="7724231">(</span><span class="op" id="7724232">)</span>&nbsp;<span class="op" id="7724234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724237">newServer</span>&nbsp;<span class="op" id="7724247">=</span>&nbsp;<span class="ident" id="7724249">NewServer</span><span class="op" id="7724258">(</span><span class="op" id="7724259">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724262">newServer</span><span class="op" id="7724271">.</span><span class="ident" id="7724272">Register</span><span class="op" id="7724280">(</span><span class="builtinfunc" id="7724281">new</span><span class="op" id="7724284">(</span><span class="ident" id="7724285">Arith</span><span class="op" id="7724290">)</span><span class="op" id="7724291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724294">newServer</span><span class="op" id="7724303">.</span><span class="ident" id="7724304">RegisterName</span><span class="op" id="7724316">(</span><span class="string" id="7724317">&#34;net.rpc.Arith&#34;</span><span class="op" id="7724332">,</span>&nbsp;<span class="builtinfunc" id="7724334">new</span><span class="op" id="7724337">(</span><span class="ident" id="7724338">Arith</span><span class="op" id="7724343">)</span><span class="op" id="7724344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724347">newServer</span><span class="op" id="7724356">.</span><span class="ident" id="7724357">RegisterName</span><span class="op" id="7724369">(</span><span class="string" id="7724370">&#34;newServer.Arith&#34;</span><span class="op" id="7724387">,</span>&nbsp;<span class="builtinfunc" id="7724389">new</span><span class="op" id="7724392">(</span><span class="ident" id="7724393">Arith</span><span class="op" id="7724398">)</span><span class="op" id="7724399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724403">var</span>&nbsp;<span class="ident" id="7724407">l</span>&nbsp;<span class="ident" id="7724409">net</span><span class="op" id="7724412">.</span><span class="ident" id="7724413">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724423">l</span><span class="op" id="7724424">,</span>&nbsp;<span class="ident" id="7724426">newServerAddr</span>&nbsp;<span class="op" id="7724440">=</span>&nbsp;<span class="ident" id="7724442">listenTCP</span><span class="op" id="7724451">(</span><span class="op" id="7724452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724455">log</span><span class="op" id="7724458">.</span><span class="ident" id="7724459">Println</span><span class="op" id="7724466">(</span><span class="string" id="7724467">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7724507">,</span>&nbsp;<span class="ident" id="7724509">newServerAddr</span><span class="op" id="7724522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724525">go</span>&nbsp;<span class="ident" id="7724528">newServer</span><span class="op" id="7724537">.</span><span class="ident" id="7724538">Accept</span><span class="op" id="7724544">(</span><span class="ident" id="7724545">l</span><span class="op" id="7724546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724550">newServer</span><span class="op" id="7724559">.</span><span class="ident" id="7724560">HandleHTTP</span><span class="op" id="7724570">(</span><span class="ident" id="7724571">newHttpPath</span><span class="op" id="7724582">,</span>&nbsp;<span class="string" id="7724584">&#34;/bar&#34;</span><span class="op" id="7724590">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724593">httpOnce</span><span class="op" id="7724601">.</span><span class="ident" id="7724602">Do</span><span class="op" id="7724604">(</span><span class="ident" id="7724605">startHttpServer</span><span class="op" id="7724620">)</span><br>
<span class="lineno"></span><span class="op" id="7724622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7724625">func</span>&nbsp;<span class="ident" id="7724630">startHttpServer</span><span class="op" id="7724645">(</span><span class="op" id="7724646">)</span>&nbsp;<span class="op" id="7724648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724651">server</span>&nbsp;<span class="op" id="7724658">:=</span>&nbsp;<span class="ident" id="7724661">httptest</span><span class="op" id="7724669">.</span><span class="ident" id="7724670">NewServer</span><span class="op" id="7724679">(</span><span class="ident" id="7724680">nil</span><span class="op" id="7724683">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724686">httpServerAddr</span>&nbsp;<span class="op" id="7724701">=</span>&nbsp;<span class="ident" id="7724703">server</span><span class="op" id="7724709">.</span><span class="ident" id="7724710">Listener</span><span class="op" id="7724718">.</span><span class="ident" id="7724719">Addr</span><span class="op" id="7724723">(</span><span class="op" id="7724724">)</span><span class="op" id="7724725">.</span><span class="ident" id="7724726">String</span><span class="op" id="7724732">(</span><span class="op" id="7724733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724736">log</span><span class="op" id="7724739">.</span><span class="ident" id="7724740">Println</span><span class="op" id="7724747">(</span><span class="string" id="7724748">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7724783">,</span>&nbsp;<span class="ident" id="7724785">httpServerAddr</span><span class="op" id="7724799">)</span><br>
<span class="lineno"></span><span class="op" id="7724801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7724804">func</span>&nbsp;<span class="ident" id="7724809">TestRPC</span><span class="op" id="7724816">(</span><span class="ident" id="7724817">t</span>&nbsp;<span class="op" id="7724819">*</span><span class="ident" id="7724820">testing</span><span class="op" id="7724827">.</span><span class="ident" id="7724828">T</span><span class="op" id="7724829">)</span>&nbsp;<span class="op" id="7724831">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724834">once</span><span class="op" id="7724838">.</span><span class="ident" id="7724839">Do</span><span class="op" id="7724841">(</span><span class="ident" id="7724842">startServer</span><span class="op" id="7724853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724856">testRPC</span><span class="op" id="7724863">(</span><span class="ident" id="7724864">t</span><span class="op" id="7724865">,</span>&nbsp;<span class="ident" id="7724867">serverAddr</span><span class="op" id="7724877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724880">newOnce</span><span class="op" id="7724887">.</span><span class="ident" id="7724888">Do</span><span class="op" id="7724890">(</span><span class="ident" id="7724891">startNewServer</span><span class="op" id="7724905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724908">testRPC</span><span class="op" id="7724915">(</span><span class="ident" id="7724916">t</span><span class="op" id="7724917">,</span>&nbsp;<span class="ident" id="7724919">newServerAddr</span><span class="op" id="7724932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724935">testNewServerRPC</span><span class="op" id="7724951">(</span><span class="ident" id="7724952">t</span><span class="op" id="7724953">,</span>&nbsp;<span class="ident" id="7724955">newServerAddr</span><span class="op" id="7724968">)</span><br>
<span class="lineno">125</span><span class="op" id="7724970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7724973">func</span>&nbsp;<span class="ident" id="7724978">testRPC</span><span class="op" id="7724985">(</span><span class="ident" id="7724986">t</span>&nbsp;<span class="op" id="7724988">*</span><span class="ident" id="7724989">testing</span><span class="op" id="7724996">.</span><span class="ident" id="7724997">T</span><span class="op" id="7724998">,</span>&nbsp;<span class="ident" id="7725000">addr</span>&nbsp;<span class="builtintype" id="7725005">string</span><span class="op" id="7725011">)</span>&nbsp;<span class="op" id="7725013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725016">client</span><span class="op" id="7725022">,</span>&nbsp;<span class="ident" id="7725024">err</span>&nbsp;<span class="op" id="7725028">:=</span>&nbsp;<span class="ident" id="7725031">Dial</span><span class="op" id="7725035">(</span><span class="string" id="7725036">&#34;tcp&#34;</span><span class="op" id="7725041">,</span>&nbsp;<span class="ident" id="7725043">addr</span><span class="op" id="7725047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725050">if</span>&nbsp;<span class="ident" id="7725053">err</span>&nbsp;<span class="op" id="7725057">!=</span>&nbsp;<span class="ident" id="7725060">nil</span>&nbsp;<span class="op" id="7725064">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725068">t</span><span class="op" id="7725069">.</span><span class="ident" id="7725070">Fatal</span><span class="op" id="7725075">(</span><span class="string" id="7725076">&#34;dialing&#34;</span><span class="op" id="7725085">,</span>&nbsp;<span class="ident" id="7725087">err</span><span class="op" id="7725090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725096">defer</span>&nbsp;<span class="ident" id="7725102">client</span><span class="op" id="7725108">.</span><span class="ident" id="7725109">Close</span><span class="op" id="7725114">(</span><span class="op" id="7725115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725119">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725141">args</span>&nbsp;<span class="op" id="7725146">:=</span>&nbsp;<span class="op" id="7725149">&amp;</span><span class="ident" id="7725150">Args</span><span class="op" id="7725154">{</span><span class="num" id="7725155">7</span><span class="op" id="7725156">,</span>&nbsp;<span class="num" id="7725158">8</span><span class="op" id="7725159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725162">reply</span>&nbsp;<span class="op" id="7725168">:=</span>&nbsp;<span class="builtinfunc" id="7725171">new</span><span class="op" id="7725174">(</span><span class="ident" id="7725175">Reply</span><span class="op" id="7725180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725183">err</span>&nbsp;<span class="op" id="7725187">=</span>&nbsp;<span class="ident" id="7725189">client</span><span class="op" id="7725195">.</span><span class="ident" id="7725196">Call</span><span class="op" id="7725200">(</span><span class="string" id="7725201">&#34;Arith.Add&#34;</span><span class="op" id="7725212">,</span>&nbsp;<span class="ident" id="7725214">args</span><span class="op" id="7725218">,</span>&nbsp;<span class="ident" id="7725220">reply</span><span class="op" id="7725225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725228">if</span>&nbsp;<span class="ident" id="7725231">err</span>&nbsp;<span class="op" id="7725235">!=</span>&nbsp;<span class="ident" id="7725238">nil</span>&nbsp;<span class="op" id="7725242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725246">t</span><span class="op" id="7725247">.</span><span class="ident" id="7725248">Errorf</span><span class="op" id="7725254">(</span><span class="string" id="7725255">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7725297">,</span>&nbsp;<span class="ident" id="7725299">err</span><span class="op" id="7725302">.</span><span class="ident" id="7725303">Error</span><span class="op" id="7725308">(</span><span class="op" id="7725309">)</span><span class="op" id="7725310">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725316">if</span>&nbsp;<span class="ident" id="7725319">reply</span><span class="op" id="7725324">.</span><span class="ident" id="7725325">C</span>&nbsp;<span class="op" id="7725327">!=</span>&nbsp;<span class="ident" id="7725330">args</span><span class="op" id="7725334">.</span><span class="ident" id="7725335">A</span><span class="op" id="7725336">+</span><span class="ident" id="7725337">args</span><span class="op" id="7725341">.</span><span class="ident" id="7725342">B</span>&nbsp;<span class="op" id="7725344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725348">t</span><span class="op" id="7725349">.</span><span class="ident" id="7725350">Errorf</span><span class="op" id="7725356">(</span><span class="string" id="7725357">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7725382">,</span>&nbsp;<span class="ident" id="7725384">reply</span><span class="op" id="7725389">.</span><span class="ident" id="7725390">C</span><span class="op" id="7725391">,</span>&nbsp;<span class="ident" id="7725393">args</span><span class="op" id="7725397">.</span><span class="ident" id="7725398">A</span><span class="op" id="7725399">+</span><span class="ident" id="7725400">args</span><span class="op" id="7725404">.</span><span class="ident" id="7725405">B</span><span class="op" id="7725406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725413">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725436">args</span>&nbsp;<span class="op" id="7725441">=</span>&nbsp;<span class="op" id="7725443">&amp;</span><span class="ident" id="7725444">Args</span><span class="op" id="7725448">{</span><span class="num" id="7725449">7</span><span class="op" id="7725450">,</span>&nbsp;<span class="num" id="7725452">0</span><span class="op" id="7725453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725456">reply</span>&nbsp;<span class="op" id="7725462">=</span>&nbsp;<span class="builtinfunc" id="7725464">new</span><span class="op" id="7725467">(</span><span class="ident" id="7725468">Reply</span><span class="op" id="7725473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725476">err</span>&nbsp;<span class="op" id="7725480">=</span>&nbsp;<span class="ident" id="7725482">client</span><span class="op" id="7725488">.</span><span class="ident" id="7725489">Call</span><span class="op" id="7725493">(</span><span class="string" id="7725494">&#34;Arith.BadOperation&#34;</span><span class="op" id="7725514">,</span>&nbsp;<span class="ident" id="7725516">args</span><span class="op" id="7725520">,</span>&nbsp;<span class="ident" id="7725522">reply</span><span class="op" id="7725527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725530">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725550">if</span>&nbsp;<span class="ident" id="7725553">err</span>&nbsp;<span class="op" id="7725557">==</span>&nbsp;<span class="ident" id="7725560">nil</span>&nbsp;<span class="op" id="7725564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725568">t</span><span class="op" id="7725569">.</span><span class="ident" id="7725570">Error</span><span class="op" id="7725575">(</span><span class="string" id="7725576">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7725606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725609">}</span>&nbsp;<span class="keyword" id="7725611">else</span>&nbsp;<span class="keyword" id="7725616">if</span>&nbsp;<span class="op" id="7725619">!</span><span class="ident" id="7725620">strings</span><span class="op" id="7725627">.</span><span class="ident" id="7725628">HasPrefix</span><span class="op" id="7725637">(</span><span class="ident" id="7725638">err</span><span class="op" id="7725641">.</span><span class="ident" id="7725642">Error</span><span class="op" id="7725647">(</span><span class="op" id="7725648">)</span><span class="op" id="7725649">,</span>&nbsp;<span class="string" id="7725651">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="7725676">)</span>&nbsp;<span class="op" id="7725678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725682">t</span><span class="op" id="7725683">.</span><span class="ident" id="7725684">Errorf</span><span class="op" id="7725690">(</span><span class="string" id="7725691">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7725747">,</span>&nbsp;<span class="ident" id="7725749">err</span><span class="op" id="7725752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725755">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725759">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725779">args</span>&nbsp;<span class="op" id="7725784">=</span>&nbsp;<span class="op" id="7725786">&amp;</span><span class="ident" id="7725787">Args</span><span class="op" id="7725791">{</span><span class="num" id="7725792">7</span><span class="op" id="7725793">,</span>&nbsp;<span class="num" id="7725795">8</span><span class="op" id="7725796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725799">reply</span>&nbsp;<span class="op" id="7725805">=</span>&nbsp;<span class="builtinfunc" id="7725807">new</span><span class="op" id="7725810">(</span><span class="ident" id="7725811">Reply</span><span class="op" id="7725816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725819">err</span>&nbsp;<span class="op" id="7725823">=</span>&nbsp;<span class="ident" id="7725825">client</span><span class="op" id="7725831">.</span><span class="ident" id="7725832">Call</span><span class="op" id="7725836">(</span><span class="string" id="7725837">&#34;Arith.Unknown&#34;</span><span class="op" id="7725852">,</span>&nbsp;<span class="ident" id="7725854">args</span><span class="op" id="7725858">,</span>&nbsp;<span class="ident" id="7725860">reply</span><span class="op" id="7725865">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725868">if</span>&nbsp;<span class="ident" id="7725871">err</span>&nbsp;<span class="op" id="7725875">==</span>&nbsp;<span class="ident" id="7725878">nil</span>&nbsp;<span class="op" id="7725882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725886">t</span><span class="op" id="7725887">.</span><span class="ident" id="7725888">Error</span><span class="op" id="7725893">(</span><span class="string" id="7725894">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="7725934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725937">}</span>&nbsp;<span class="keyword" id="7725939">else</span>&nbsp;<span class="keyword" id="7725944">if</span>&nbsp;<span class="ident" id="7725947">strings</span><span class="op" id="7725954">.</span><span class="ident" id="7725955">Index</span><span class="op" id="7725960">(</span><span class="ident" id="7725961">err</span><span class="op" id="7725964">.</span><span class="ident" id="7725965">Error</span><span class="op" id="7725970">(</span><span class="op" id="7725971">)</span><span class="op" id="7725972">,</span>&nbsp;<span class="string" id="7725974">&#34;method&#34;</span><span class="op" id="7725982">)</span>&nbsp;<span class="op" id="7725984">&lt;</span>&nbsp;<span class="num" id="7725986">0</span>&nbsp;<span class="op" id="7725988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725992">t</span><span class="op" id="7725993">.</span><span class="ident" id="7725994">Error</span><span class="op" id="7725999">(</span><span class="string" id="7726000">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="7726034">,</span>&nbsp;<span class="ident" id="7726036">err</span><span class="op" id="7726039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726042">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726046">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726064">args</span>&nbsp;<span class="op" id="7726069">=</span>&nbsp;<span class="op" id="7726071">&amp;</span><span class="ident" id="7726072">Args</span><span class="op" id="7726076">{</span><span class="num" id="7726077">7</span><span class="op" id="7726078">,</span>&nbsp;<span class="num" id="7726080">8</span><span class="op" id="7726081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726084">mulReply</span>&nbsp;<span class="op" id="7726093">:=</span>&nbsp;<span class="builtinfunc" id="7726096">new</span><span class="op" id="7726099">(</span><span class="ident" id="7726100">Reply</span><span class="op" id="7726105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726108">mulCall</span>&nbsp;<span class="op" id="7726116">:=</span>&nbsp;<span class="ident" id="7726119">client</span><span class="op" id="7726125">.</span><span class="ident" id="7726126">Go</span><span class="op" id="7726128">(</span><span class="string" id="7726129">&#34;Arith.Mul&#34;</span><span class="op" id="7726140">,</span>&nbsp;<span class="ident" id="7726142">args</span><span class="op" id="7726146">,</span>&nbsp;<span class="ident" id="7726148">mulReply</span><span class="op" id="7726156">,</span>&nbsp;<span class="ident" id="7726158">nil</span><span class="op" id="7726161">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726164">addReply</span>&nbsp;<span class="op" id="7726173">:=</span>&nbsp;<span class="builtinfunc" id="7726176">new</span><span class="op" id="7726179">(</span><span class="ident" id="7726180">Reply</span><span class="op" id="7726185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726188">addCall</span>&nbsp;<span class="op" id="7726196">:=</span>&nbsp;<span class="ident" id="7726199">client</span><span class="op" id="7726205">.</span><span class="ident" id="7726206">Go</span><span class="op" id="7726208">(</span><span class="string" id="7726209">&#34;Arith.Add&#34;</span><span class="op" id="7726220">,</span>&nbsp;<span class="ident" id="7726222">args</span><span class="op" id="7726226">,</span>&nbsp;<span class="ident" id="7726228">addReply</span><span class="op" id="7726236">,</span>&nbsp;<span class="ident" id="7726238">nil</span><span class="op" id="7726241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726245">addCall</span>&nbsp;<span class="op" id="7726253">=</span>&nbsp;<span class="op" id="7726255">&lt;-</span><span class="ident" id="7726257">addCall</span><span class="op" id="7726264">.</span><span class="ident" id="7726265">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726271">if</span>&nbsp;<span class="ident" id="7726274">addCall</span><span class="op" id="7726281">.</span><span class="ident" id="7726282">Error</span>&nbsp;<span class="op" id="7726288">!=</span>&nbsp;<span class="ident" id="7726291">nil</span>&nbsp;<span class="op" id="7726295">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726299">t</span><span class="op" id="7726300">.</span><span class="ident" id="7726301">Errorf</span><span class="op" id="7726307">(</span><span class="string" id="7726308">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7726350">,</span>&nbsp;<span class="ident" id="7726352">addCall</span><span class="op" id="7726359">.</span><span class="ident" id="7726360">Error</span><span class="op" id="7726365">.</span><span class="ident" id="7726366">Error</span><span class="op" id="7726371">(</span><span class="op" id="7726372">)</span><span class="op" id="7726373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726379">if</span>&nbsp;<span class="ident" id="7726382">addReply</span><span class="op" id="7726390">.</span><span class="ident" id="7726391">C</span>&nbsp;<span class="op" id="7726393">!=</span>&nbsp;<span class="ident" id="7726396">args</span><span class="op" id="7726400">.</span><span class="ident" id="7726401">A</span><span class="op" id="7726402">+</span><span class="ident" id="7726403">args</span><span class="op" id="7726407">.</span><span class="ident" id="7726408">B</span>&nbsp;<span class="op" id="7726410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726414">t</span><span class="op" id="7726415">.</span><span class="ident" id="7726416">Errorf</span><span class="op" id="7726422">(</span><span class="string" id="7726423">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7726448">,</span>&nbsp;<span class="ident" id="7726450">addReply</span><span class="op" id="7726458">.</span><span class="ident" id="7726459">C</span><span class="op" id="7726460">,</span>&nbsp;<span class="ident" id="7726462">args</span><span class="op" id="7726466">.</span><span class="ident" id="7726467">A</span><span class="op" id="7726468">+</span><span class="ident" id="7726469">args</span><span class="op" id="7726473">.</span><span class="ident" id="7726474">B</span><span class="op" id="7726475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726478">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726482">mulCall</span>&nbsp;<span class="op" id="7726490">=</span>&nbsp;<span class="op" id="7726492">&lt;-</span><span class="ident" id="7726494">mulCall</span><span class="op" id="7726501">.</span><span class="ident" id="7726502">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726508">if</span>&nbsp;<span class="ident" id="7726511">mulCall</span><span class="op" id="7726518">.</span><span class="ident" id="7726519">Error</span>&nbsp;<span class="op" id="7726525">!=</span>&nbsp;<span class="ident" id="7726528">nil</span>&nbsp;<span class="op" id="7726532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726536">t</span><span class="op" id="7726537">.</span><span class="ident" id="7726538">Errorf</span><span class="op" id="7726544">(</span><span class="string" id="7726545">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7726587">,</span>&nbsp;<span class="ident" id="7726589">mulCall</span><span class="op" id="7726596">.</span><span class="ident" id="7726597">Error</span><span class="op" id="7726602">.</span><span class="ident" id="7726603">Error</span><span class="op" id="7726608">(</span><span class="op" id="7726609">)</span><span class="op" id="7726610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726613">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726616">if</span>&nbsp;<span class="ident" id="7726619">mulReply</span><span class="op" id="7726627">.</span><span class="ident" id="7726628">C</span>&nbsp;<span class="op" id="7726630">!=</span>&nbsp;<span class="ident" id="7726633">args</span><span class="op" id="7726637">.</span><span class="ident" id="7726638">A</span><span class="op" id="7726639">*</span><span class="ident" id="7726640">args</span><span class="op" id="7726644">.</span><span class="ident" id="7726645">B</span>&nbsp;<span class="op" id="7726647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726651">t</span><span class="op" id="7726652">.</span><span class="ident" id="7726653">Errorf</span><span class="op" id="7726659">(</span><span class="string" id="7726660">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7726685">,</span>&nbsp;<span class="ident" id="7726687">mulReply</span><span class="op" id="7726695">.</span><span class="ident" id="7726696">C</span><span class="op" id="7726697">,</span>&nbsp;<span class="ident" id="7726699">args</span><span class="op" id="7726703">.</span><span class="ident" id="7726704">A</span><span class="op" id="7726705">*</span><span class="ident" id="7726706">args</span><span class="op" id="7726710">.</span><span class="ident" id="7726711">B</span><span class="op" id="7726712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726719">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726734">args</span>&nbsp;<span class="op" id="7726739">=</span>&nbsp;<span class="op" id="7726741">&amp;</span><span class="ident" id="7726742">Args</span><span class="op" id="7726746">{</span><span class="num" id="7726747">7</span><span class="op" id="7726748">,</span>&nbsp;<span class="num" id="7726750">0</span><span class="op" id="7726751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726754">reply</span>&nbsp;<span class="op" id="7726760">=</span>&nbsp;<span class="builtinfunc" id="7726762">new</span><span class="op" id="7726765">(</span><span class="ident" id="7726766">Reply</span><span class="op" id="7726771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726774">err</span>&nbsp;<span class="op" id="7726778">=</span>&nbsp;<span class="ident" id="7726780">client</span><span class="op" id="7726786">.</span><span class="ident" id="7726787">Call</span><span class="op" id="7726791">(</span><span class="string" id="7726792">&#34;Arith.Div&#34;</span><span class="op" id="7726803">,</span>&nbsp;<span class="ident" id="7726805">args</span><span class="op" id="7726809">,</span>&nbsp;<span class="ident" id="7726811">reply</span><span class="op" id="7726816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726819">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726852">if</span>&nbsp;<span class="ident" id="7726855">err</span>&nbsp;<span class="op" id="7726859">==</span>&nbsp;<span class="ident" id="7726862">nil</span>&nbsp;<span class="op" id="7726866">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726870">t</span><span class="op" id="7726871">.</span><span class="ident" id="7726872">Error</span><span class="op" id="7726877">(</span><span class="string" id="7726878">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7726899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726902">}</span>&nbsp;<span class="keyword" id="7726904">else</span>&nbsp;<span class="keyword" id="7726909">if</span>&nbsp;<span class="ident" id="7726912">err</span><span class="op" id="7726915">.</span><span class="ident" id="7726916">Error</span><span class="op" id="7726921">(</span><span class="op" id="7726922">)</span>&nbsp;<span class="op" id="7726924">!=</span>&nbsp;<span class="string" id="7726927">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7726944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726948">t</span><span class="op" id="7726949">.</span><span class="ident" id="7726950">Error</span><span class="op" id="7726955">(</span><span class="string" id="7726956">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7726997">,</span>&nbsp;<span class="ident" id="7726999">err</span><span class="op" id="7727002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7727009">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727023">reply</span>&nbsp;<span class="op" id="7727029">=</span>&nbsp;<span class="builtinfunc" id="7727031">new</span><span class="op" id="7727034">(</span><span class="ident" id="7727035">Reply</span><span class="op" id="7727040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727043">err</span>&nbsp;<span class="op" id="7727047">=</span>&nbsp;<span class="ident" id="7727049">client</span><span class="op" id="7727055">.</span><span class="ident" id="7727056">Call</span><span class="op" id="7727060">(</span><span class="string" id="7727061">&#34;Arith.Add&#34;</span><span class="op" id="7727072">,</span>&nbsp;<span class="ident" id="7727074">reply</span><span class="op" id="7727079">,</span>&nbsp;<span class="ident" id="7727081">reply</span><span class="op" id="7727086">)</span>&nbsp;<span class="comment" id="7727088">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727138">if</span>&nbsp;<span class="ident" id="7727141">err</span>&nbsp;<span class="op" id="7727145">==</span>&nbsp;<span class="ident" id="7727148">nil</span>&nbsp;<span class="op" id="7727152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727156">t</span><span class="op" id="7727157">.</span><span class="ident" id="7727158">Error</span><span class="op" id="7727163">(</span><span class="string" id="7727164">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="7727218">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727221">}</span>&nbsp;<span class="keyword" id="7727223">else</span>&nbsp;<span class="keyword" id="7727228">if</span>&nbsp;<span class="ident" id="7727231">strings</span><span class="op" id="7727238">.</span><span class="ident" id="7727239">Index</span><span class="op" id="7727244">(</span><span class="ident" id="7727245">err</span><span class="op" id="7727248">.</span><span class="ident" id="7727249">Error</span><span class="op" id="7727254">(</span><span class="op" id="7727255">)</span><span class="op" id="7727256">,</span>&nbsp;<span class="string" id="7727258">&#34;type&#34;</span><span class="op" id="7727264">)</span>&nbsp;<span class="op" id="7727266">&lt;</span>&nbsp;<span class="num" id="7727268">0</span>&nbsp;<span class="op" id="7727270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727274">t</span><span class="op" id="7727275">.</span><span class="ident" id="7727276">Error</span><span class="op" id="7727281">(</span><span class="string" id="7727282">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="7727314">,</span>&nbsp;<span class="ident" id="7727316">err</span><span class="op" id="7727319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7727326">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727350">const</span>&nbsp;<span class="ident" id="7727356">Val</span>&nbsp;<span class="op" id="7727360">=</span>&nbsp;<span class="num" id="7727362">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727369">str</span>&nbsp;<span class="op" id="7727373">:=</span>&nbsp;<span class="ident" id="7727376">fmt</span><span class="op" id="7727379">.</span><span class="ident" id="7727380">Sprint</span><span class="op" id="7727386">(</span><span class="ident" id="7727387">Val</span><span class="op" id="7727390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727393">reply</span>&nbsp;<span class="op" id="7727399">=</span>&nbsp;<span class="builtinfunc" id="7727401">new</span><span class="op" id="7727404">(</span><span class="ident" id="7727405">Reply</span><span class="op" id="7727410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727413">err</span>&nbsp;<span class="op" id="7727417">=</span>&nbsp;<span class="ident" id="7727419">client</span><span class="op" id="7727425">.</span><span class="ident" id="7727426">Call</span><span class="op" id="7727430">(</span><span class="string" id="7727431">&#34;Arith.Scan&#34;</span><span class="op" id="7727443">,</span>&nbsp;<span class="op" id="7727445">&amp;</span><span class="ident" id="7727446">str</span><span class="op" id="7727449">,</span>&nbsp;<span class="ident" id="7727451">reply</span><span class="op" id="7727456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727459">if</span>&nbsp;<span class="ident" id="7727462">err</span>&nbsp;<span class="op" id="7727466">!=</span>&nbsp;<span class="ident" id="7727469">nil</span>&nbsp;<span class="op" id="7727473">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727477">t</span><span class="op" id="7727478">.</span><span class="ident" id="7727479">Errorf</span><span class="op" id="7727485">(</span><span class="string" id="7727486">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7727529">,</span>&nbsp;<span class="ident" id="7727531">err</span><span class="op" id="7727534">.</span><span class="ident" id="7727535">Error</span><span class="op" id="7727540">(</span><span class="op" id="7727541">)</span><span class="op" id="7727542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727545">}</span>&nbsp;<span class="keyword" id="7727547">else</span>&nbsp;<span class="keyword" id="7727552">if</span>&nbsp;<span class="ident" id="7727555">reply</span><span class="op" id="7727560">.</span><span class="ident" id="7727561">C</span>&nbsp;<span class="op" id="7727563">!=</span>&nbsp;<span class="ident" id="7727566">Val</span>&nbsp;<span class="op" id="7727570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727574">t</span><span class="op" id="7727575">.</span><span class="ident" id="7727576">Errorf</span><span class="op" id="7727582">(</span><span class="string" id="7727583">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7727609">,</span>&nbsp;<span class="ident" id="7727611">Val</span><span class="op" id="7727614">,</span>&nbsp;<span class="ident" id="7727616">reply</span><span class="op" id="7727621">.</span><span class="ident" id="7727622">C</span><span class="op" id="7727623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7727630">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727651">args</span>&nbsp;<span class="op" id="7727656">=</span>&nbsp;<span class="op" id="7727658">&amp;</span><span class="ident" id="7727659">Args</span><span class="op" id="7727663">{</span><span class="num" id="7727664">27</span><span class="op" id="7727666">,</span>&nbsp;<span class="num" id="7727668">35</span><span class="op" id="7727670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727673">str</span>&nbsp;<span class="op" id="7727677">=</span>&nbsp;<span class="string" id="7727679">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727683">err</span>&nbsp;<span class="op" id="7727687">=</span>&nbsp;<span class="ident" id="7727689">client</span><span class="op" id="7727695">.</span><span class="ident" id="7727696">Call</span><span class="op" id="7727700">(</span><span class="string" id="7727701">&#34;Arith.String&#34;</span><span class="op" id="7727715">,</span>&nbsp;<span class="ident" id="7727717">args</span><span class="op" id="7727721">,</span>&nbsp;<span class="op" id="7727723">&amp;</span><span class="ident" id="7727724">str</span><span class="op" id="7727727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727730">if</span>&nbsp;<span class="ident" id="7727733">err</span>&nbsp;<span class="op" id="7727737">!=</span>&nbsp;<span class="ident" id="7727740">nil</span>&nbsp;<span class="op" id="7727744">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727748">t</span><span class="op" id="7727749">.</span><span class="ident" id="7727750">Errorf</span><span class="op" id="7727756">(</span><span class="string" id="7727757">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7727802">,</span>&nbsp;<span class="ident" id="7727804">err</span><span class="op" id="7727807">.</span><span class="ident" id="7727808">Error</span><span class="op" id="7727813">(</span><span class="op" id="7727814">)</span><span class="op" id="7727815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727821">expect</span>&nbsp;<span class="op" id="7727828">:=</span>&nbsp;<span class="ident" id="7727831">fmt</span><span class="op" id="7727834">.</span><span class="ident" id="7727835">Sprintf</span><span class="op" id="7727842">(</span><span class="string" id="7727843">&#34;%d+%d=%d&#34;</span><span class="op" id="7727853">,</span>&nbsp;<span class="ident" id="7727855">args</span><span class="op" id="7727859">.</span><span class="ident" id="7727860">A</span><span class="op" id="7727861">,</span>&nbsp;<span class="ident" id="7727863">args</span><span class="op" id="7727867">.</span><span class="ident" id="7727868">B</span><span class="op" id="7727869">,</span>&nbsp;<span class="ident" id="7727871">args</span><span class="op" id="7727875">.</span><span class="ident" id="7727876">A</span><span class="op" id="7727877">+</span><span class="ident" id="7727878">args</span><span class="op" id="7727882">.</span><span class="ident" id="7727883">B</span><span class="op" id="7727884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727887">if</span>&nbsp;<span class="ident" id="7727890">str</span>&nbsp;<span class="op" id="7727894">!=</span>&nbsp;<span class="ident" id="7727897">expect</span>&nbsp;<span class="op" id="7727904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727908">t</span><span class="op" id="7727909">.</span><span class="ident" id="7727910">Errorf</span><span class="op" id="7727916">(</span><span class="string" id="7727917">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7727945">,</span>&nbsp;<span class="ident" id="7727947">expect</span><span class="op" id="7727953">,</span>&nbsp;<span class="ident" id="7727955">str</span><span class="op" id="7727958">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727965">args</span>&nbsp;<span class="op" id="7727970">=</span>&nbsp;<span class="op" id="7727972">&amp;</span><span class="ident" id="7727973">Args</span><span class="op" id="7727977">{</span><span class="num" id="7727978">7</span><span class="op" id="7727979">,</span>&nbsp;<span class="num" id="7727981">8</span><span class="op" id="7727982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727985">reply</span>&nbsp;<span class="op" id="7727991">=</span>&nbsp;<span class="builtinfunc" id="7727993">new</span><span class="op" id="7727996">(</span><span class="ident" id="7727997">Reply</span><span class="op" id="7728002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728005">err</span>&nbsp;<span class="op" id="7728009">=</span>&nbsp;<span class="ident" id="7728011">client</span><span class="op" id="7728017">.</span><span class="ident" id="7728018">Call</span><span class="op" id="7728022">(</span><span class="string" id="7728023">&#34;Arith.Mul&#34;</span><span class="op" id="7728034">,</span>&nbsp;<span class="ident" id="7728036">args</span><span class="op" id="7728040">,</span>&nbsp;<span class="ident" id="7728042">reply</span><span class="op" id="7728047">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728050">if</span>&nbsp;<span class="ident" id="7728053">err</span>&nbsp;<span class="op" id="7728057">!=</span>&nbsp;<span class="ident" id="7728060">nil</span>&nbsp;<span class="op" id="7728064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728068">t</span><span class="op" id="7728069">.</span><span class="ident" id="7728070">Errorf</span><span class="op" id="7728076">(</span><span class="string" id="7728077">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7728119">,</span>&nbsp;<span class="ident" id="7728121">err</span><span class="op" id="7728124">.</span><span class="ident" id="7728125">Error</span><span class="op" id="7728130">(</span><span class="op" id="7728131">)</span><span class="op" id="7728132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728138">if</span>&nbsp;<span class="ident" id="7728141">reply</span><span class="op" id="7728146">.</span><span class="ident" id="7728147">C</span>&nbsp;<span class="op" id="7728149">!=</span>&nbsp;<span class="ident" id="7728152">args</span><span class="op" id="7728156">.</span><span class="ident" id="7728157">A</span><span class="op" id="7728158">*</span><span class="ident" id="7728159">args</span><span class="op" id="7728163">.</span><span class="ident" id="7728164">B</span>&nbsp;<span class="op" id="7728166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728170">t</span><span class="op" id="7728171">.</span><span class="ident" id="7728172">Errorf</span><span class="op" id="7728178">(</span><span class="string" id="7728179">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7728204">,</span>&nbsp;<span class="ident" id="7728206">reply</span><span class="op" id="7728211">.</span><span class="ident" id="7728212">C</span><span class="op" id="7728213">,</span>&nbsp;<span class="ident" id="7728215">args</span><span class="op" id="7728219">.</span><span class="ident" id="7728220">A</span><span class="op" id="7728221">*</span><span class="ident" id="7728222">args</span><span class="op" id="7728226">.</span><span class="ident" id="7728227">B</span><span class="op" id="7728228">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7728235">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728273">args</span>&nbsp;<span class="op" id="7728278">=</span>&nbsp;<span class="op" id="7728280">&amp;</span><span class="ident" id="7728281">Args</span><span class="op" id="7728285">{</span><span class="num" id="7728286">7</span><span class="op" id="7728287">,</span>&nbsp;<span class="num" id="7728289">8</span><span class="op" id="7728290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728293">reply</span>&nbsp;<span class="op" id="7728299">=</span>&nbsp;<span class="builtinfunc" id="7728301">new</span><span class="op" id="7728304">(</span><span class="ident" id="7728305">Reply</span><span class="op" id="7728310">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728313">err</span>&nbsp;<span class="op" id="7728317">=</span>&nbsp;<span class="ident" id="7728319">client</span><span class="op" id="7728325">.</span><span class="ident" id="7728326">Call</span><span class="op" id="7728330">(</span><span class="string" id="7728331">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="7728350">,</span>&nbsp;<span class="ident" id="7728352">args</span><span class="op" id="7728356">,</span>&nbsp;<span class="ident" id="7728358">reply</span><span class="op" id="7728363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728366">if</span>&nbsp;<span class="ident" id="7728369">err</span>&nbsp;<span class="op" id="7728373">!=</span>&nbsp;<span class="ident" id="7728376">nil</span>&nbsp;<span class="op" id="7728380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728384">t</span><span class="op" id="7728385">.</span><span class="ident" id="7728386">Errorf</span><span class="op" id="7728392">(</span><span class="string" id="7728393">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7728435">,</span>&nbsp;<span class="ident" id="7728437">err</span><span class="op" id="7728440">.</span><span class="ident" id="7728441">Error</span><span class="op" id="7728446">(</span><span class="op" id="7728447">)</span><span class="op" id="7728448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728454">if</span>&nbsp;<span class="ident" id="7728457">reply</span><span class="op" id="7728462">.</span><span class="ident" id="7728463">C</span>&nbsp;<span class="op" id="7728465">!=</span>&nbsp;<span class="ident" id="7728468">args</span><span class="op" id="7728472">.</span><span class="ident" id="7728473">A</span><span class="op" id="7728474">+</span><span class="ident" id="7728475">args</span><span class="op" id="7728479">.</span><span class="ident" id="7728480">B</span>&nbsp;<span class="op" id="7728482">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728486">t</span><span class="op" id="7728487">.</span><span class="ident" id="7728488">Errorf</span><span class="op" id="7728494">(</span><span class="string" id="7728495">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7728520">,</span>&nbsp;<span class="ident" id="7728522">reply</span><span class="op" id="7728527">.</span><span class="ident" id="7728528">C</span><span class="op" id="7728529">,</span>&nbsp;<span class="ident" id="7728531">args</span><span class="op" id="7728535">.</span><span class="ident" id="7728536">A</span><span class="op" id="7728537">+</span><span class="ident" id="7728538">args</span><span class="op" id="7728542">.</span><span class="ident" id="7728543">B</span><span class="op" id="7728544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728547">}</span><br>
<span class="lineno"></span><span class="op" id="7728549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7728552">func</span>&nbsp;<span class="ident" id="7728557">testNewServerRPC</span><span class="op" id="7728573">(</span><span class="ident" id="7728574">t</span>&nbsp;<span class="op" id="7728576">*</span><span class="ident" id="7728577">testing</span><span class="op" id="7728584">.</span><span class="ident" id="7728585">T</span><span class="op" id="7728586">,</span>&nbsp;<span class="ident" id="7728588">addr</span>&nbsp;<span class="builtintype" id="7728593">string</span><span class="op" id="7728599">)</span>&nbsp;<span class="op" id="7728601">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728604">client</span><span class="op" id="7728610">,</span>&nbsp;<span class="ident" id="7728612">err</span>&nbsp;<span class="op" id="7728616">:=</span>&nbsp;<span class="ident" id="7728619">Dial</span><span class="op" id="7728623">(</span><span class="string" id="7728624">&#34;tcp&#34;</span><span class="op" id="7728629">,</span>&nbsp;<span class="ident" id="7728631">addr</span><span class="op" id="7728635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728638">if</span>&nbsp;<span class="ident" id="7728641">err</span>&nbsp;<span class="op" id="7728645">!=</span>&nbsp;<span class="ident" id="7728648">nil</span>&nbsp;<span class="op" id="7728652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728656">t</span><span class="op" id="7728657">.</span><span class="ident" id="7728658">Fatal</span><span class="op" id="7728663">(</span><span class="string" id="7728664">&#34;dialing&#34;</span><span class="op" id="7728673">,</span>&nbsp;<span class="ident" id="7728675">err</span><span class="op" id="7728678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728684">defer</span>&nbsp;<span class="ident" id="7728690">client</span><span class="op" id="7728696">.</span><span class="ident" id="7728697">Close</span><span class="op" id="7728702">(</span><span class="op" id="7728703">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7728707">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728729">args</span>&nbsp;<span class="op" id="7728734">:=</span>&nbsp;<span class="op" id="7728737">&amp;</span><span class="ident" id="7728738">Args</span><span class="op" id="7728742">{</span><span class="num" id="7728743">7</span><span class="op" id="7728744">,</span>&nbsp;<span class="num" id="7728746">8</span><span class="op" id="7728747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728750">reply</span>&nbsp;<span class="op" id="7728756">:=</span>&nbsp;<span class="builtinfunc" id="7728759">new</span><span class="op" id="7728762">(</span><span class="ident" id="7728763">Reply</span><span class="op" id="7728768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728771">err</span>&nbsp;<span class="op" id="7728775">=</span>&nbsp;<span class="ident" id="7728777">client</span><span class="op" id="7728783">.</span><span class="ident" id="7728784">Call</span><span class="op" id="7728788">(</span><span class="string" id="7728789">&#34;newServer.Arith.Add&#34;</span><span class="op" id="7728810">,</span>&nbsp;<span class="ident" id="7728812">args</span><span class="op" id="7728816">,</span>&nbsp;<span class="ident" id="7728818">reply</span><span class="op" id="7728823">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728826">if</span>&nbsp;<span class="ident" id="7728829">err</span>&nbsp;<span class="op" id="7728833">!=</span>&nbsp;<span class="ident" id="7728836">nil</span>&nbsp;<span class="op" id="7728840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728844">t</span><span class="op" id="7728845">.</span><span class="ident" id="7728846">Errorf</span><span class="op" id="7728852">(</span><span class="string" id="7728853">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7728895">,</span>&nbsp;<span class="ident" id="7728897">err</span><span class="op" id="7728900">.</span><span class="ident" id="7728901">Error</span><span class="op" id="7728906">(</span><span class="op" id="7728907">)</span><span class="op" id="7728908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728914">if</span>&nbsp;<span class="ident" id="7728917">reply</span><span class="op" id="7728922">.</span><span class="ident" id="7728923">C</span>&nbsp;<span class="op" id="7728925">!=</span>&nbsp;<span class="ident" id="7728928">args</span><span class="op" id="7728932">.</span><span class="ident" id="7728933">A</span><span class="op" id="7728934">+</span><span class="ident" id="7728935">args</span><span class="op" id="7728939">.</span><span class="ident" id="7728940">B</span>&nbsp;<span class="op" id="7728942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728946">t</span><span class="op" id="7728947">.</span><span class="ident" id="7728948">Errorf</span><span class="op" id="7728954">(</span><span class="string" id="7728955">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7728980">,</span>&nbsp;<span class="ident" id="7728982">reply</span><span class="op" id="7728987">.</span><span class="ident" id="7728988">C</span><span class="op" id="7728989">,</span>&nbsp;<span class="ident" id="7728991">args</span><span class="op" id="7728995">.</span><span class="ident" id="7728996">A</span><span class="op" id="7728997">+</span><span class="ident" id="7728998">args</span><span class="op" id="7729002">.</span><span class="ident" id="7729003">B</span><span class="op" id="7729004">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729007">}</span><br>
<span class="lineno"></span><span class="op" id="7729009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7729012">func</span>&nbsp;<span class="ident" id="7729017">TestHTTP</span><span class="op" id="7729025">(</span><span class="ident" id="7729026">t</span>&nbsp;<span class="op" id="7729028">*</span><span class="ident" id="7729029">testing</span><span class="op" id="7729036">.</span><span class="ident" id="7729037">T</span><span class="op" id="7729038">)</span>&nbsp;<span class="op" id="7729040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729043">once</span><span class="op" id="7729047">.</span><span class="ident" id="7729048">Do</span><span class="op" id="7729050">(</span><span class="ident" id="7729051">startServer</span><span class="op" id="7729062">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729065">testHTTPRPC</span><span class="op" id="7729076">(</span><span class="ident" id="7729077">t</span><span class="op" id="7729078">,</span>&nbsp;<span class="string" id="7729080">&#34;&#34;</span><span class="op" id="7729082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729085">newOnce</span><span class="op" id="7729092">.</span><span class="ident" id="7729093">Do</span><span class="op" id="7729095">(</span><span class="ident" id="7729096">startNewServer</span><span class="op" id="7729110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729113">testHTTPRPC</span><span class="op" id="7729124">(</span><span class="ident" id="7729125">t</span><span class="op" id="7729126">,</span>&nbsp;<span class="ident" id="7729128">newHttpPath</span><span class="op" id="7729139">)</span><br>
<span class="lineno"></span><span class="op" id="7729141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7729144">func</span>&nbsp;<span class="ident" id="7729149">testHTTPRPC</span><span class="op" id="7729160">(</span><span class="ident" id="7729161">t</span>&nbsp;<span class="op" id="7729163">*</span><span class="ident" id="7729164">testing</span><span class="op" id="7729171">.</span><span class="ident" id="7729172">T</span><span class="op" id="7729173">,</span>&nbsp;<span class="ident" id="7729175">path</span>&nbsp;<span class="builtintype" id="7729180">string</span><span class="op" id="7729186">)</span>&nbsp;<span class="op" id="7729188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729191">var</span>&nbsp;<span class="ident" id="7729195">client</span>&nbsp;<span class="op" id="7729202">*</span><span class="ident" id="7729203">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729211">var</span>&nbsp;<span class="ident" id="7729215">err</span>&nbsp;<span class="builtintype" id="7729219">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729226">if</span>&nbsp;<span class="ident" id="7729229">path</span>&nbsp;<span class="op" id="7729234">==</span>&nbsp;<span class="string" id="7729237">&#34;&#34;</span>&nbsp;<span class="op" id="7729240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729244">client</span><span class="op" id="7729250">,</span>&nbsp;<span class="ident" id="7729252">err</span>&nbsp;<span class="op" id="7729256">=</span>&nbsp;<span class="ident" id="7729258">DialHTTP</span><span class="op" id="7729266">(</span><span class="string" id="7729267">&#34;tcp&#34;</span><span class="op" id="7729272">,</span>&nbsp;<span class="ident" id="7729274">httpServerAddr</span><span class="op" id="7729288">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729291">}</span>&nbsp;<span class="keyword" id="7729293">else</span>&nbsp;<span class="op" id="7729298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729302">client</span><span class="op" id="7729308">,</span>&nbsp;<span class="ident" id="7729310">err</span>&nbsp;<span class="op" id="7729314">=</span>&nbsp;<span class="ident" id="7729316">DialHTTPPath</span><span class="op" id="7729328">(</span><span class="string" id="7729329">&#34;tcp&#34;</span><span class="op" id="7729334">,</span>&nbsp;<span class="ident" id="7729336">httpServerAddr</span><span class="op" id="7729350">,</span>&nbsp;<span class="ident" id="7729352">path</span><span class="op" id="7729356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729362">if</span>&nbsp;<span class="ident" id="7729365">err</span>&nbsp;<span class="op" id="7729369">!=</span>&nbsp;<span class="ident" id="7729372">nil</span>&nbsp;<span class="op" id="7729376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729380">t</span><span class="op" id="7729381">.</span><span class="ident" id="7729382">Fatal</span><span class="op" id="7729387">(</span><span class="string" id="7729388">&#34;dialing&#34;</span><span class="op" id="7729397">,</span>&nbsp;<span class="ident" id="7729399">err</span><span class="op" id="7729402">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729408">defer</span>&nbsp;<span class="ident" id="7729414">client</span><span class="op" id="7729420">.</span><span class="ident" id="7729421">Close</span><span class="op" id="7729426">(</span><span class="op" id="7729427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729431">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729453">args</span>&nbsp;<span class="op" id="7729458">:=</span>&nbsp;<span class="op" id="7729461">&amp;</span><span class="ident" id="7729462">Args</span><span class="op" id="7729466">{</span><span class="num" id="7729467">7</span><span class="op" id="7729468">,</span>&nbsp;<span class="num" id="7729470">8</span><span class="op" id="7729471">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729474">reply</span>&nbsp;<span class="op" id="7729480">:=</span>&nbsp;<span class="builtinfunc" id="7729483">new</span><span class="op" id="7729486">(</span><span class="ident" id="7729487">Reply</span><span class="op" id="7729492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729495">err</span>&nbsp;<span class="op" id="7729499">=</span>&nbsp;<span class="ident" id="7729501">client</span><span class="op" id="7729507">.</span><span class="ident" id="7729508">Call</span><span class="op" id="7729512">(</span><span class="string" id="7729513">&#34;Arith.Add&#34;</span><span class="op" id="7729524">,</span>&nbsp;<span class="ident" id="7729526">args</span><span class="op" id="7729530">,</span>&nbsp;<span class="ident" id="7729532">reply</span><span class="op" id="7729537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729540">if</span>&nbsp;<span class="ident" id="7729543">err</span>&nbsp;<span class="op" id="7729547">!=</span>&nbsp;<span class="ident" id="7729550">nil</span>&nbsp;<span class="op" id="7729554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729558">t</span><span class="op" id="7729559">.</span><span class="ident" id="7729560">Errorf</span><span class="op" id="7729566">(</span><span class="string" id="7729567">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7729609">,</span>&nbsp;<span class="ident" id="7729611">err</span><span class="op" id="7729614">.</span><span class="ident" id="7729615">Error</span><span class="op" id="7729620">(</span><span class="op" id="7729621">)</span><span class="op" id="7729622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729625">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729628">if</span>&nbsp;<span class="ident" id="7729631">reply</span><span class="op" id="7729636">.</span><span class="ident" id="7729637">C</span>&nbsp;<span class="op" id="7729639">!=</span>&nbsp;<span class="ident" id="7729642">args</span><span class="op" id="7729646">.</span><span class="ident" id="7729647">A</span><span class="op" id="7729648">+</span><span class="ident" id="7729649">args</span><span class="op" id="7729653">.</span><span class="ident" id="7729654">B</span>&nbsp;<span class="op" id="7729656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729660">t</span><span class="op" id="7729661">.</span><span class="ident" id="7729662">Errorf</span><span class="op" id="7729668">(</span><span class="string" id="7729669">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7729694">,</span>&nbsp;<span class="ident" id="7729696">reply</span><span class="op" id="7729701">.</span><span class="ident" id="7729702">C</span><span class="op" id="7729703">,</span>&nbsp;<span class="ident" id="7729705">args</span><span class="op" id="7729709">.</span><span class="ident" id="7729710">A</span><span class="op" id="7729711">+</span><span class="ident" id="7729712">args</span><span class="op" id="7729716">.</span><span class="ident" id="7729717">B</span><span class="op" id="7729718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729721">}</span><br>
<span class="lineno"></span><span class="op" id="7729723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="7729726">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="7729799">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="7729836">type</span>&nbsp;<span class="ident" id="7729841">CodecEmulator</span>&nbsp;<span class="keyword" id="7729855">struct</span>&nbsp;<span class="op" id="7729862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729865">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729879">*</span><span class="ident" id="7729880">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729888">serviceMethod</span>&nbsp;<span class="builtintype" id="7729902">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729910">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729924">*</span><span class="ident" id="7729925">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729931">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729945">*</span><span class="ident" id="7729946">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729953">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7729967">error</span><br>
<span class="lineno"></span><span class="op" id="7729973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7729976">func</span>&nbsp;<span class="op" id="7729981">(</span><span class="ident" id="7729982">codec</span>&nbsp;<span class="op" id="7729988">*</span><span class="ident" id="7729989">CodecEmulator</span><span class="op" id="7730002">)</span>&nbsp;<span class="ident" id="7730004">Call</span><span class="op" id="7730008">(</span><span class="ident" id="7730009">serviceMethod</span>&nbsp;<span class="builtintype" id="7730023">string</span><span class="op" id="7730029">,</span>&nbsp;<span class="ident" id="7730031">args</span>&nbsp;<span class="op" id="7730036">*</span><span class="ident" id="7730037">Args</span><span class="op" id="7730041">,</span>&nbsp;<span class="ident" id="7730043">reply</span>&nbsp;<span class="op" id="7730049">*</span><span class="ident" id="7730050">Reply</span><span class="op" id="7730055">)</span>&nbsp;<span class="builtintype" id="7730057">error</span>&nbsp;<span class="op" id="7730063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730066">codec</span><span class="op" id="7730071">.</span><span class="ident" id="7730072">serviceMethod</span>&nbsp;<span class="op" id="7730086">=</span>&nbsp;<span class="ident" id="7730088">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730103">codec</span><span class="op" id="7730108">.</span><span class="ident" id="7730109">args</span>&nbsp;<span class="op" id="7730114">=</span>&nbsp;<span class="ident" id="7730116">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730122">codec</span><span class="op" id="7730127">.</span><span class="ident" id="7730128">reply</span>&nbsp;<span class="op" id="7730134">=</span>&nbsp;<span class="ident" id="7730136">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730143">codec</span><span class="op" id="7730148">.</span><span class="ident" id="7730149">err</span>&nbsp;<span class="op" id="7730153">=</span>&nbsp;<span class="ident" id="7730155">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730160">var</span>&nbsp;<span class="ident" id="7730164">serverError</span>&nbsp;<span class="builtintype" id="7730176">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730183">if</span>&nbsp;<span class="ident" id="7730186">codec</span><span class="op" id="7730191">.</span><span class="ident" id="7730192">server</span>&nbsp;<span class="op" id="7730199">==</span>&nbsp;<span class="ident" id="7730202">nil</span>&nbsp;<span class="op" id="7730206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730210">serverError</span>&nbsp;<span class="op" id="7730222">=</span>&nbsp;<span class="ident" id="7730224">ServeRequest</span><span class="op" id="7730236">(</span><span class="ident" id="7730237">codec</span><span class="op" id="7730242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730245">}</span>&nbsp;<span class="keyword" id="7730247">else</span>&nbsp;<span class="op" id="7730252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730256">serverError</span>&nbsp;<span class="op" id="7730268">=</span>&nbsp;<span class="ident" id="7730270">codec</span><span class="op" id="7730275">.</span><span class="ident" id="7730276">server</span><span class="op" id="7730282">.</span><span class="ident" id="7730283">ServeRequest</span><span class="op" id="7730295">(</span><span class="ident" id="7730296">codec</span><span class="op" id="7730301">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730307">if</span>&nbsp;<span class="ident" id="7730310">codec</span><span class="op" id="7730315">.</span><span class="ident" id="7730316">err</span>&nbsp;<span class="op" id="7730320">==</span>&nbsp;<span class="ident" id="7730323">nil</span>&nbsp;<span class="op" id="7730327">&amp;&amp;</span>&nbsp;<span class="ident" id="7730330">serverError</span>&nbsp;<span class="op" id="7730342">!=</span>&nbsp;<span class="ident" id="7730345">nil</span>&nbsp;<span class="op" id="7730349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730353">codec</span><span class="op" id="7730358">.</span><span class="ident" id="7730359">err</span>&nbsp;<span class="op" id="7730363">=</span>&nbsp;<span class="ident" id="7730365">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730381">return</span>&nbsp;<span class="ident" id="7730388">codec</span><span class="op" id="7730393">.</span><span class="ident" id="7730394">err</span><br>
<span class="lineno">330</span><span class="op" id="7730398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7730401">func</span>&nbsp;<span class="op" id="7730406">(</span><span class="ident" id="7730407">codec</span>&nbsp;<span class="op" id="7730413">*</span><span class="ident" id="7730414">CodecEmulator</span><span class="op" id="7730427">)</span>&nbsp;<span class="ident" id="7730429">ReadRequestHeader</span><span class="op" id="7730446">(</span><span class="ident" id="7730447">req</span>&nbsp;<span class="op" id="7730451">*</span><span class="ident" id="7730452">Request</span><span class="op" id="7730459">)</span>&nbsp;<span class="builtintype" id="7730461">error</span>&nbsp;<span class="op" id="7730467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730470">req</span><span class="op" id="7730473">.</span><span class="ident" id="7730474">ServiceMethod</span>&nbsp;<span class="op" id="7730488">=</span>&nbsp;<span class="ident" id="7730490">codec</span><span class="op" id="7730495">.</span><span class="ident" id="7730496">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730511">req</span><span class="op" id="7730514">.</span><span class="ident" id="7730515">Seq</span>&nbsp;<span class="op" id="7730519">=</span>&nbsp;<span class="num" id="7730521">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730524">return</span>&nbsp;<span class="ident" id="7730531">nil</span><br>
<span class="lineno"></span><span class="op" id="7730535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7730538">func</span>&nbsp;<span class="op" id="7730543">(</span><span class="ident" id="7730544">codec</span>&nbsp;<span class="op" id="7730550">*</span><span class="ident" id="7730551">CodecEmulator</span><span class="op" id="7730564">)</span>&nbsp;<span class="ident" id="7730566">ReadRequestBody</span><span class="op" id="7730581">(</span><span class="ident" id="7730582">argv</span>&nbsp;<span class="keyword" id="7730587">interface</span><span class="op" id="7730596">{</span><span class="op" id="7730597">}</span><span class="op" id="7730598">)</span>&nbsp;<span class="builtintype" id="7730600">error</span>&nbsp;<span class="op" id="7730606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730609">if</span>&nbsp;<span class="ident" id="7730612">codec</span><span class="op" id="7730617">.</span><span class="ident" id="7730618">args</span>&nbsp;<span class="op" id="7730623">==</span>&nbsp;<span class="ident" id="7730626">nil</span>&nbsp;<span class="op" id="7730630">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730634">return</span>&nbsp;<span class="ident" id="7730641">io</span><span class="op" id="7730643">.</span><span class="ident" id="7730644">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730665">*</span><span class="op" id="7730666">(</span><span class="ident" id="7730667">argv</span><span class="op" id="7730671">.</span><span class="op" id="7730672">(</span><span class="op" id="7730673">*</span><span class="ident" id="7730674">Args</span><span class="op" id="7730678">)</span><span class="op" id="7730679">)</span>&nbsp;<span class="op" id="7730681">=</span>&nbsp;<span class="op" id="7730683">*</span><span class="ident" id="7730684">codec</span><span class="op" id="7730689">.</span><span class="ident" id="7730690">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730696">return</span>&nbsp;<span class="ident" id="7730703">nil</span><br>
<span class="lineno"></span><span class="op" id="7730707">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7730710">func</span>&nbsp;<span class="op" id="7730715">(</span><span class="ident" id="7730716">codec</span>&nbsp;<span class="op" id="7730722">*</span><span class="ident" id="7730723">CodecEmulator</span><span class="op" id="7730736">)</span>&nbsp;<span class="ident" id="7730738">WriteResponse</span><span class="op" id="7730751">(</span><span class="ident" id="7730752">resp</span>&nbsp;<span class="op" id="7730757">*</span><span class="ident" id="7730758">Response</span><span class="op" id="7730766">,</span>&nbsp;<span class="ident" id="7730768">reply</span>&nbsp;<span class="keyword" id="7730774">interface</span><span class="op" id="7730783">{</span><span class="op" id="7730784">}</span><span class="op" id="7730785">)</span>&nbsp;<span class="builtintype" id="7730787">error</span>&nbsp;<span class="op" id="7730793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730796">if</span>&nbsp;<span class="ident" id="7730799">resp</span><span class="op" id="7730803">.</span><span class="ident" id="7730804">Error</span>&nbsp;<span class="op" id="7730810">!=</span>&nbsp;<span class="string" id="7730813">&#34;&#34;</span>&nbsp;<span class="op" id="7730816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730820">codec</span><span class="op" id="7730825">.</span><span class="ident" id="7730826">err</span>&nbsp;<span class="op" id="7730830">=</span>&nbsp;<span class="ident" id="7730832">errors</span><span class="op" id="7730838">.</span><span class="ident" id="7730839">New</span><span class="op" id="7730842">(</span><span class="ident" id="7730843">resp</span><span class="op" id="7730847">.</span><span class="ident" id="7730848">Error</span><span class="op" id="7730853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730856">}</span>&nbsp;<span class="keyword" id="7730858">else</span>&nbsp;<span class="op" id="7730863">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730867">*</span><span class="ident" id="7730868">codec</span><span class="op" id="7730873">.</span><span class="ident" id="7730874">reply</span>&nbsp;<span class="op" id="7730880">=</span>&nbsp;<span class="op" id="7730882">*</span><span class="op" id="7730883">(</span><span class="ident" id="7730884">reply</span><span class="op" id="7730889">.</span><span class="op" id="7730890">(</span><span class="op" id="7730891">*</span><span class="ident" id="7730892">Reply</span><span class="op" id="7730897">)</span><span class="op" id="7730898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730904">return</span>&nbsp;<span class="ident" id="7730911">nil</span><br>
<span class="lineno"></span><span class="op" id="7730915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="7730918">func</span>&nbsp;<span class="op" id="7730923">(</span><span class="ident" id="7730924">codec</span>&nbsp;<span class="op" id="7730930">*</span><span class="ident" id="7730931">CodecEmulator</span><span class="op" id="7730944">)</span>&nbsp;<span class="ident" id="7730946">Close</span><span class="op" id="7730951">(</span><span class="op" id="7730952">)</span>&nbsp;<span class="builtintype" id="7730954">error</span>&nbsp;<span class="op" id="7730960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730963">return</span>&nbsp;<span class="ident" id="7730970">nil</span><br>
<span class="lineno"></span><span class="op" id="7730974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7730977">func</span>&nbsp;<span class="ident" id="7730982">TestServeRequest</span><span class="op" id="7730998">(</span><span class="ident" id="7730999">t</span>&nbsp;<span class="op" id="7731001">*</span><span class="ident" id="7731002">testing</span><span class="op" id="7731009">.</span><span class="ident" id="7731010">T</span><span class="op" id="7731011">)</span>&nbsp;<span class="op" id="7731013">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731016">once</span><span class="op" id="7731020">.</span><span class="ident" id="7731021">Do</span><span class="op" id="7731023">(</span><span class="ident" id="7731024">startServer</span><span class="op" id="7731035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731038">testServeRequest</span><span class="op" id="7731054">(</span><span class="ident" id="7731055">t</span><span class="op" id="7731056">,</span>&nbsp;<span class="ident" id="7731058">nil</span><span class="op" id="7731061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731064">newOnce</span><span class="op" id="7731071">.</span><span class="ident" id="7731072">Do</span><span class="op" id="7731074">(</span><span class="ident" id="7731075">startNewServer</span><span class="op" id="7731089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731092">testServeRequest</span><span class="op" id="7731108">(</span><span class="ident" id="7731109">t</span><span class="op" id="7731110">,</span>&nbsp;<span class="ident" id="7731112">newServer</span><span class="op" id="7731121">)</span><br>
<span class="lineno"></span><span class="op" id="7731123">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7731126">func</span>&nbsp;<span class="ident" id="7731131">testServeRequest</span><span class="op" id="7731147">(</span><span class="ident" id="7731148">t</span>&nbsp;<span class="op" id="7731150">*</span><span class="ident" id="7731151">testing</span><span class="op" id="7731158">.</span><span class="ident" id="7731159">T</span><span class="op" id="7731160">,</span>&nbsp;<span class="ident" id="7731162">server</span>&nbsp;<span class="op" id="7731169">*</span><span class="ident" id="7731170">Server</span><span class="op" id="7731176">)</span>&nbsp;<span class="op" id="7731178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731181">client</span>&nbsp;<span class="op" id="7731188">:=</span>&nbsp;<span class="ident" id="7731191">CodecEmulator</span><span class="op" id="7731204">{</span><span class="ident" id="7731205">server</span><span class="op" id="7731211">:</span>&nbsp;<span class="ident" id="7731213">server</span><span class="op" id="7731219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731222">defer</span>&nbsp;<span class="ident" id="7731228">client</span><span class="op" id="7731234">.</span><span class="ident" id="7731235">Close</span><span class="op" id="7731240">(</span><span class="op" id="7731241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731245">args</span>&nbsp;<span class="op" id="7731250">:=</span>&nbsp;<span class="op" id="7731253">&amp;</span><span class="ident" id="7731254">Args</span><span class="op" id="7731258">{</span><span class="num" id="7731259">7</span><span class="op" id="7731260">,</span>&nbsp;<span class="num" id="7731262">8</span><span class="op" id="7731263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731266">reply</span>&nbsp;<span class="op" id="7731272">:=</span>&nbsp;<span class="builtinfunc" id="7731275">new</span><span class="op" id="7731278">(</span><span class="ident" id="7731279">Reply</span><span class="op" id="7731284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731287">err</span>&nbsp;<span class="op" id="7731291">:=</span>&nbsp;<span class="ident" id="7731294">client</span><span class="op" id="7731300">.</span><span class="ident" id="7731301">Call</span><span class="op" id="7731305">(</span><span class="string" id="7731306">&#34;Arith.Add&#34;</span><span class="op" id="7731317">,</span>&nbsp;<span class="ident" id="7731319">args</span><span class="op" id="7731323">,</span>&nbsp;<span class="ident" id="7731325">reply</span><span class="op" id="7731330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731333">if</span>&nbsp;<span class="ident" id="7731336">err</span>&nbsp;<span class="op" id="7731340">!=</span>&nbsp;<span class="ident" id="7731343">nil</span>&nbsp;<span class="op" id="7731347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731351">t</span><span class="op" id="7731352">.</span><span class="ident" id="7731353">Errorf</span><span class="op" id="7731359">(</span><span class="string" id="7731360">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7731402">,</span>&nbsp;<span class="ident" id="7731404">err</span><span class="op" id="7731407">.</span><span class="ident" id="7731408">Error</span><span class="op" id="7731413">(</span><span class="op" id="7731414">)</span><span class="op" id="7731415">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731421">if</span>&nbsp;<span class="ident" id="7731424">reply</span><span class="op" id="7731429">.</span><span class="ident" id="7731430">C</span>&nbsp;<span class="op" id="7731432">!=</span>&nbsp;<span class="ident" id="7731435">args</span><span class="op" id="7731439">.</span><span class="ident" id="7731440">A</span><span class="op" id="7731441">+</span><span class="ident" id="7731442">args</span><span class="op" id="7731446">.</span><span class="ident" id="7731447">B</span>&nbsp;<span class="op" id="7731449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731453">t</span><span class="op" id="7731454">.</span><span class="ident" id="7731455">Errorf</span><span class="op" id="7731461">(</span><span class="string" id="7731462">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7731487">,</span>&nbsp;<span class="ident" id="7731489">reply</span><span class="op" id="7731494">.</span><span class="ident" id="7731495">C</span><span class="op" id="7731496">,</span>&nbsp;<span class="ident" id="7731498">args</span><span class="op" id="7731502">.</span><span class="ident" id="7731503">A</span><span class="op" id="7731504">+</span><span class="ident" id="7731505">args</span><span class="op" id="7731509">.</span><span class="ident" id="7731510">B</span><span class="op" id="7731511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731518">err</span>&nbsp;<span class="op" id="7731522">=</span>&nbsp;<span class="ident" id="7731524">client</span><span class="op" id="7731530">.</span><span class="ident" id="7731531">Call</span><span class="op" id="7731535">(</span><span class="string" id="7731536">&#34;Arith.Add&#34;</span><span class="op" id="7731547">,</span>&nbsp;<span class="ident" id="7731549">nil</span><span class="op" id="7731552">,</span>&nbsp;<span class="ident" id="7731554">reply</span><span class="op" id="7731559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731562">if</span>&nbsp;<span class="ident" id="7731565">err</span>&nbsp;<span class="op" id="7731569">==</span>&nbsp;<span class="ident" id="7731572">nil</span>&nbsp;<span class="op" id="7731576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731580">t</span><span class="op" id="7731581">.</span><span class="ident" id="7731582">Errorf</span><span class="op" id="7731588">(</span><span class="string" id="7731589">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="7731636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731639">}</span><br>
<span class="lineno"></span><span class="op" id="7731641">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="7731644">type</span>&nbsp;<span class="ident" id="7731649">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="7731665">int</span><br>
<span class="lineno"></span><span class="keyword" id="7731669">type</span>&nbsp;<span class="ident" id="7731674">ArgNotPublic</span>&nbsp;<span class="builtintype" id="7731687">int</span><br>
<span class="lineno"></span><span class="keyword" id="7731691">type</span>&nbsp;<span class="ident" id="7731696">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="7731711">int</span><br>
<span class="lineno"></span><span class="keyword" id="7731715">type</span>&nbsp;<span class="ident" id="7731720">NeedsPtrType</span>&nbsp;<span class="builtintype" id="7731733">int</span><br>
<span class="lineno">390</span><span class="keyword" id="7731737">type</span>&nbsp;<span class="ident" id="7731742">local</span>&nbsp;<span class="keyword" id="7731748">struct</span><span class="op" id="7731754">{</span><span class="op" id="7731755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7731758">func</span>&nbsp;<span class="op" id="7731763">(</span><span class="ident" id="7731764">t</span>&nbsp;<span class="op" id="7731766">*</span><span class="ident" id="7731767">ReplyNotPointer</span><span class="op" id="7731782">)</span>&nbsp;<span class="ident" id="7731784">ReplyNotPointer</span><span class="op" id="7731799">(</span><span class="ident" id="7731800">args</span>&nbsp;<span class="op" id="7731805">*</span><span class="ident" id="7731806">Args</span><span class="op" id="7731810">,</span>&nbsp;<span class="ident" id="7731812">reply</span>&nbsp;<span class="ident" id="7731818">Reply</span><span class="op" id="7731823">)</span>&nbsp;<span class="builtintype" id="7731825">error</span>&nbsp;<span class="op" id="7731831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731834">return</span>&nbsp;<span class="ident" id="7731841">nil</span><br>
<span class="lineno"></span><span class="op" id="7731845">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="7731848">func</span>&nbsp;<span class="op" id="7731853">(</span><span class="ident" id="7731854">t</span>&nbsp;<span class="op" id="7731856">*</span><span class="ident" id="7731857">ArgNotPublic</span><span class="op" id="7731869">)</span>&nbsp;<span class="ident" id="7731871">ArgNotPublic</span><span class="op" id="7731883">(</span><span class="ident" id="7731884">args</span>&nbsp;<span class="op" id="7731889">*</span><span class="ident" id="7731890">local</span><span class="op" id="7731895">,</span>&nbsp;<span class="ident" id="7731897">reply</span>&nbsp;<span class="op" id="7731903">*</span><span class="ident" id="7731904">Reply</span><span class="op" id="7731909">)</span>&nbsp;<span class="builtintype" id="7731911">error</span>&nbsp;<span class="op" id="7731917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731920">return</span>&nbsp;<span class="ident" id="7731927">nil</span><br>
<span class="lineno"></span><span class="op" id="7731931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="7731934">func</span>&nbsp;<span class="op" id="7731939">(</span><span class="ident" id="7731940">t</span>&nbsp;<span class="op" id="7731942">*</span><span class="ident" id="7731943">ReplyNotPublic</span><span class="op" id="7731957">)</span>&nbsp;<span class="ident" id="7731959">ReplyNotPublic</span><span class="op" id="7731973">(</span><span class="ident" id="7731974">args</span>&nbsp;<span class="op" id="7731979">*</span><span class="ident" id="7731980">Args</span><span class="op" id="7731984">,</span>&nbsp;<span class="ident" id="7731986">reply</span>&nbsp;<span class="op" id="7731992">*</span><span class="ident" id="7731993">local</span><span class="op" id="7731998">)</span>&nbsp;<span class="builtintype" id="7732000">error</span>&nbsp;<span class="op" id="7732006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732009">return</span>&nbsp;<span class="ident" id="7732016">nil</span><br>
<span class="lineno"></span><span class="op" id="7732020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732023">func</span>&nbsp;<span class="op" id="7732028">(</span><span class="ident" id="7732029">t</span>&nbsp;<span class="op" id="7732031">*</span><span class="ident" id="7732032">NeedsPtrType</span><span class="op" id="7732044">)</span>&nbsp;<span class="ident" id="7732046">NeedsPtrType</span><span class="op" id="7732058">(</span><span class="ident" id="7732059">args</span>&nbsp;<span class="op" id="7732064">*</span><span class="ident" id="7732065">Args</span><span class="op" id="7732069">,</span>&nbsp;<span class="ident" id="7732071">reply</span>&nbsp;<span class="op" id="7732077">*</span><span class="ident" id="7732078">Reply</span><span class="op" id="7732083">)</span>&nbsp;<span class="builtintype" id="7732085">error</span>&nbsp;<span class="op" id="7732091">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732094">return</span>&nbsp;<span class="ident" id="7732101">nil</span><br>
<span class="lineno"></span><span class="op" id="7732105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7732108">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="7732200">func</span>&nbsp;<span class="ident" id="7732205">TestRegistrationError</span><span class="op" id="7732226">(</span><span class="ident" id="7732227">t</span>&nbsp;<span class="op" id="7732229">*</span><span class="ident" id="7732230">testing</span><span class="op" id="7732237">.</span><span class="ident" id="7732238">T</span><span class="op" id="7732239">)</span>&nbsp;<span class="op" id="7732241">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732244">err</span>&nbsp;<span class="op" id="7732248">:=</span>&nbsp;<span class="ident" id="7732251">Register</span><span class="op" id="7732259">(</span><span class="builtinfunc" id="7732260">new</span><span class="op" id="7732263">(</span><span class="ident" id="7732264">ReplyNotPointer</span><span class="op" id="7732279">)</span><span class="op" id="7732280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732283">if</span>&nbsp;<span class="ident" id="7732286">err</span>&nbsp;<span class="op" id="7732290">==</span>&nbsp;<span class="ident" id="7732293">nil</span>&nbsp;<span class="op" id="7732297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732301">t</span><span class="op" id="7732302">.</span><span class="ident" id="7732303">Error</span><span class="op" id="7732308">(</span><span class="string" id="7732309">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="7732353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732359">err</span>&nbsp;<span class="op" id="7732363">=</span>&nbsp;<span class="ident" id="7732365">Register</span><span class="op" id="7732373">(</span><span class="builtinfunc" id="7732374">new</span><span class="op" id="7732377">(</span><span class="ident" id="7732378">ArgNotPublic</span><span class="op" id="7732390">)</span><span class="op" id="7732391">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732394">if</span>&nbsp;<span class="ident" id="7732397">err</span>&nbsp;<span class="op" id="7732401">==</span>&nbsp;<span class="ident" id="7732404">nil</span>&nbsp;<span class="op" id="7732408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732412">t</span><span class="op" id="7732413">.</span><span class="ident" id="7732414">Error</span><span class="op" id="7732419">(</span><span class="string" id="7732420">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="7732461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732467">err</span>&nbsp;<span class="op" id="7732471">=</span>&nbsp;<span class="ident" id="7732473">Register</span><span class="op" id="7732481">(</span><span class="builtinfunc" id="7732482">new</span><span class="op" id="7732485">(</span><span class="ident" id="7732486">ReplyNotPublic</span><span class="op" id="7732500">)</span><span class="op" id="7732501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732504">if</span>&nbsp;<span class="ident" id="7732507">err</span>&nbsp;<span class="op" id="7732511">==</span>&nbsp;<span class="ident" id="7732514">nil</span>&nbsp;<span class="op" id="7732518">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732522">t</span><span class="op" id="7732523">.</span><span class="ident" id="7732524">Error</span><span class="op" id="7732529">(</span><span class="string" id="7732530">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="7732573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732579">err</span>&nbsp;<span class="op" id="7732583">=</span>&nbsp;<span class="ident" id="7732585">Register</span><span class="op" id="7732593">(</span><span class="ident" id="7732594">NeedsPtrType</span><span class="op" id="7732606">(</span><span class="num" id="7732607">0</span><span class="op" id="7732608">)</span><span class="op" id="7732609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732612">if</span>&nbsp;<span class="ident" id="7732615">err</span>&nbsp;<span class="op" id="7732619">==</span>&nbsp;<span class="ident" id="7732622">nil</span>&nbsp;<span class="op" id="7732626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732630">t</span><span class="op" id="7732631">.</span><span class="ident" id="7732632">Error</span><span class="op" id="7732637">(</span><span class="string" id="7732638">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7732679">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732682">}</span>&nbsp;<span class="keyword" id="7732684">else</span>&nbsp;<span class="keyword" id="7732689">if</span>&nbsp;<span class="op" id="7732692">!</span><span class="ident" id="7732693">strings</span><span class="op" id="7732700">.</span><span class="ident" id="7732701">Contains</span><span class="op" id="7732709">(</span><span class="ident" id="7732710">err</span><span class="op" id="7732713">.</span><span class="ident" id="7732714">Error</span><span class="op" id="7732719">(</span><span class="op" id="7732720">)</span><span class="op" id="7732721">,</span>&nbsp;<span class="string" id="7732723">&#34;pointer&#34;</span><span class="op" id="7732732">)</span>&nbsp;<span class="op" id="7732734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732738">t</span><span class="op" id="7732739">.</span><span class="ident" id="7732740">Error</span><span class="op" id="7732745">(</span><span class="string" id="7732746">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7732791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732794">}</span><br>
<span class="lineno"></span><span class="op" id="7732796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7732799">type</span>&nbsp;<span class="ident" id="7732804">WriteFailCodec</span>&nbsp;<span class="builtintype" id="7732819">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732824">func</span>&nbsp;<span class="op" id="7732829">(</span><span class="ident" id="7732830">WriteFailCodec</span><span class="op" id="7732844">)</span>&nbsp;<span class="ident" id="7732846">WriteRequest</span><span class="op" id="7732858">(</span><span class="op" id="7732859">*</span><span class="ident" id="7732860">Request</span><span class="op" id="7732867">,</span>&nbsp;<span class="keyword" id="7732869">interface</span><span class="op" id="7732878">{</span><span class="op" id="7732879">}</span><span class="op" id="7732880">)</span>&nbsp;<span class="builtintype" id="7732882">error</span>&nbsp;<span class="op" id="7732888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7732891">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732953">return</span>&nbsp;<span class="ident" id="7732960">errors</span><span class="op" id="7732966">.</span><span class="ident" id="7732967">New</span><span class="op" id="7732970">(</span><span class="string" id="7732971">&#34;fail&#34;</span><span class="op" id="7732977">)</span><br>
<span class="lineno">435</span><span class="op" id="7732979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732982">func</span>&nbsp;<span class="op" id="7732987">(</span><span class="ident" id="7732988">WriteFailCodec</span><span class="op" id="7733002">)</span>&nbsp;<span class="ident" id="7733004">ReadResponseHeader</span><span class="op" id="7733022">(</span><span class="op" id="7733023">*</span><span class="ident" id="7733024">Response</span><span class="op" id="7733032">)</span>&nbsp;<span class="builtintype" id="7733034">error</span>&nbsp;<span class="op" id="7733040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733043">select</span>&nbsp;<span class="op" id="7733050">{</span><span class="op" id="7733051">}</span><br>
<span class="lineno"></span><span class="op" id="7733053">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="7733056">func</span>&nbsp;<span class="op" id="7733061">(</span><span class="ident" id="7733062">WriteFailCodec</span><span class="op" id="7733076">)</span>&nbsp;<span class="ident" id="7733078">ReadResponseBody</span><span class="op" id="7733094">(</span><span class="keyword" id="7733095">interface</span><span class="op" id="7733104">{</span><span class="op" id="7733105">}</span><span class="op" id="7733106">)</span>&nbsp;<span class="builtintype" id="7733108">error</span>&nbsp;<span class="op" id="7733114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733117">select</span>&nbsp;<span class="op" id="7733124">{</span><span class="op" id="7733125">}</span><br>
<span class="lineno"></span><span class="op" id="7733127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="7733130">func</span>&nbsp;<span class="op" id="7733135">(</span><span class="ident" id="7733136">WriteFailCodec</span><span class="op" id="7733150">)</span>&nbsp;<span class="ident" id="7733152">Close</span><span class="op" id="7733157">(</span><span class="op" id="7733158">)</span>&nbsp;<span class="builtintype" id="7733160">error</span>&nbsp;<span class="op" id="7733166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733169">return</span>&nbsp;<span class="ident" id="7733176">nil</span><br>
<span class="lineno"></span><span class="op" id="7733180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7733183">func</span>&nbsp;<span class="ident" id="7733188">TestSendDeadlock</span><span class="op" id="7733204">(</span><span class="ident" id="7733205">t</span>&nbsp;<span class="op" id="7733207">*</span><span class="ident" id="7733208">testing</span><span class="op" id="7733215">.</span><span class="ident" id="7733216">T</span><span class="op" id="7733217">)</span>&nbsp;<span class="op" id="7733219">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733222">client</span>&nbsp;<span class="op" id="7733229">:=</span>&nbsp;<span class="ident" id="7733232">NewClientWithCodec</span><span class="op" id="7733250">(</span><span class="ident" id="7733251">WriteFailCodec</span><span class="op" id="7733265">(</span><span class="num" id="7733266">0</span><span class="op" id="7733267">)</span><span class="op" id="7733268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733271">defer</span>&nbsp;<span class="ident" id="7733277">client</span><span class="op" id="7733283">.</span><span class="ident" id="7733284">Close</span><span class="op" id="7733289">(</span><span class="op" id="7733290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733294">done</span>&nbsp;<span class="op" id="7733299">:=</span>&nbsp;<span class="builtinfunc" id="7733302">make</span><span class="op" id="7733306">(</span><span class="keyword" id="7733307">chan</span>&nbsp;<span class="builtintype" id="7733312">bool</span><span class="op" id="7733316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733319">go</span>&nbsp;<span class="keyword" id="7733322">func</span><span class="op" id="7733326">(</span><span class="op" id="7733327">)</span>&nbsp;<span class="op" id="7733329">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733333">testSendDeadlock</span><span class="op" id="7733349">(</span><span class="ident" id="7733350">client</span><span class="op" id="7733356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733360">testSendDeadlock</span><span class="op" id="7733376">(</span><span class="ident" id="7733377">client</span><span class="op" id="7733383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733387">done</span>&nbsp;<span class="op" id="7733392">&lt;-</span>&nbsp;<span class="builtintype" id="7733395">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733401">}</span><span class="op" id="7733402">(</span><span class="op" id="7733403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733406">select</span>&nbsp;<span class="op" id="7733413">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733416">case</span>&nbsp;<span class="op" id="7733421">&lt;-</span><span class="ident" id="7733423">done</span><span class="op" id="7733427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733431">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733439">case</span>&nbsp;<span class="op" id="7733444">&lt;-</span><span class="ident" id="7733446">time</span><span class="op" id="7733450">.</span><span class="ident" id="7733451">After</span><span class="op" id="7733456">(</span><span class="num" id="7733457">5</span>&nbsp;<span class="op" id="7733459">*</span>&nbsp;<span class="ident" id="7733461">time</span><span class="op" id="7733465">.</span><span class="ident" id="7733466">Second</span><span class="op" id="7733472">)</span><span class="op" id="7733473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733477">t</span><span class="op" id="7733478">.</span><span class="ident" id="7733479">Fatal</span><span class="op" id="7733484">(</span><span class="string" id="7733485">&#34;deadlock&#34;</span><span class="op" id="7733495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733498">}</span><br>
<span class="lineno">465</span><span class="op" id="7733500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7733503">func</span>&nbsp;<span class="ident" id="7733508">testSendDeadlock</span><span class="op" id="7733524">(</span><span class="ident" id="7733525">client</span>&nbsp;<span class="op" id="7733532">*</span><span class="ident" id="7733533">Client</span><span class="op" id="7733539">)</span>&nbsp;<span class="op" id="7733541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733544">defer</span>&nbsp;<span class="keyword" id="7733550">func</span><span class="op" id="7733554">(</span><span class="op" id="7733555">)</span>&nbsp;<span class="op" id="7733557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7733561">recover</span><span class="op" id="7733568">(</span><span class="op" id="7733569">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733572">}</span><span class="op" id="7733573">(</span><span class="op" id="7733574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733577">args</span>&nbsp;<span class="op" id="7733582">:=</span>&nbsp;<span class="op" id="7733585">&amp;</span><span class="ident" id="7733586">Args</span><span class="op" id="7733590">{</span><span class="num" id="7733591">7</span><span class="op" id="7733592">,</span>&nbsp;<span class="num" id="7733594">8</span><span class="op" id="7733595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733598">reply</span>&nbsp;<span class="op" id="7733604">:=</span>&nbsp;<span class="builtinfunc" id="7733607">new</span><span class="op" id="7733610">(</span><span class="ident" id="7733611">Reply</span><span class="op" id="7733616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733619">client</span><span class="op" id="7733625">.</span><span class="ident" id="7733626">Call</span><span class="op" id="7733630">(</span><span class="string" id="7733631">&#34;Arith.Add&#34;</span><span class="op" id="7733642">,</span>&nbsp;<span class="ident" id="7733644">args</span><span class="op" id="7733648">,</span>&nbsp;<span class="ident" id="7733650">reply</span><span class="op" id="7733655">)</span><br>
<span class="lineno"></span><span class="op" id="7733657">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7733660">func</span>&nbsp;<span class="ident" id="7733665">dialDirect</span><span class="op" id="7733675">(</span><span class="op" id="7733676">)</span>&nbsp;<span class="op" id="7733678">(</span><span class="op" id="7733679">*</span><span class="ident" id="7733680">Client</span><span class="op" id="7733686">,</span>&nbsp;<span class="builtintype" id="7733688">error</span><span class="op" id="7733693">)</span>&nbsp;<span class="op" id="7733695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733698">return</span>&nbsp;<span class="ident" id="7733705">Dial</span><span class="op" id="7733709">(</span><span class="string" id="7733710">&#34;tcp&#34;</span><span class="op" id="7733715">,</span>&nbsp;<span class="ident" id="7733717">serverAddr</span><span class="op" id="7733727">)</span><br>
<span class="lineno"></span><span class="op" id="7733729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7733732">func</span>&nbsp;<span class="ident" id="7733737">dialHTTP</span><span class="op" id="7733745">(</span><span class="op" id="7733746">)</span>&nbsp;<span class="op" id="7733748">(</span><span class="op" id="7733749">*</span><span class="ident" id="7733750">Client</span><span class="op" id="7733756">,</span>&nbsp;<span class="builtintype" id="7733758">error</span><span class="op" id="7733763">)</span>&nbsp;<span class="op" id="7733765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733768">return</span>&nbsp;<span class="ident" id="7733775">DialHTTP</span><span class="op" id="7733783">(</span><span class="string" id="7733784">&#34;tcp&#34;</span><span class="op" id="7733789">,</span>&nbsp;<span class="ident" id="7733791">httpServerAddr</span><span class="op" id="7733805">)</span><br>
<span class="lineno"></span><span class="op" id="7733807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7733810">func</span>&nbsp;<span class="ident" id="7733815">countMallocs</span><span class="op" id="7733827">(</span><span class="ident" id="7733828">dial</span>&nbsp;<span class="keyword" id="7733833">func</span><span class="op" id="7733837">(</span><span class="op" id="7733838">)</span>&nbsp;<span class="op" id="7733840">(</span><span class="op" id="7733841">*</span><span class="ident" id="7733842">Client</span><span class="op" id="7733848">,</span>&nbsp;<span class="builtintype" id="7733850">error</span><span class="op" id="7733855">)</span><span class="op" id="7733856">,</span>&nbsp;<span class="ident" id="7733858">t</span>&nbsp;<span class="op" id="7733860">*</span><span class="ident" id="7733861">testing</span><span class="op" id="7733868">.</span><span class="ident" id="7733869">T</span><span class="op" id="7733870">)</span>&nbsp;<span class="builtintype" id="7733872">float64</span>&nbsp;<span class="op" id="7733880">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733883">once</span><span class="op" id="7733887">.</span><span class="ident" id="7733888">Do</span><span class="op" id="7733890">(</span><span class="ident" id="7733891">startServer</span><span class="op" id="7733902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733905">client</span><span class="op" id="7733911">,</span>&nbsp;<span class="ident" id="7733913">err</span>&nbsp;<span class="op" id="7733917">:=</span>&nbsp;<span class="ident" id="7733920">dial</span><span class="op" id="7733924">(</span><span class="op" id="7733925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733928">if</span>&nbsp;<span class="ident" id="7733931">err</span>&nbsp;<span class="op" id="7733935">!=</span>&nbsp;<span class="ident" id="7733938">nil</span>&nbsp;<span class="op" id="7733942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733946">t</span><span class="op" id="7733947">.</span><span class="ident" id="7733948">Fatal</span><span class="op" id="7733953">(</span><span class="string" id="7733954">&#34;error&nbsp;dialing&#34;</span><span class="op" id="7733969">,</span>&nbsp;<span class="ident" id="7733971">err</span><span class="op" id="7733974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733977">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733980">defer</span>&nbsp;<span class="ident" id="7733986">client</span><span class="op" id="7733992">.</span><span class="ident" id="7733993">Close</span><span class="op" id="7733998">(</span><span class="op" id="7733999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734003">args</span>&nbsp;<span class="op" id="7734008">:=</span>&nbsp;<span class="op" id="7734011">&amp;</span><span class="ident" id="7734012">Args</span><span class="op" id="7734016">{</span><span class="num" id="7734017">7</span><span class="op" id="7734018">,</span>&nbsp;<span class="num" id="7734020">8</span><span class="op" id="7734021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734024">reply</span>&nbsp;<span class="op" id="7734030">:=</span>&nbsp;<span class="builtinfunc" id="7734033">new</span><span class="op" id="7734036">(</span><span class="ident" id="7734037">Reply</span><span class="op" id="7734042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734045">return</span>&nbsp;<span class="ident" id="7734052">testing</span><span class="op" id="7734059">.</span><span class="ident" id="7734060">AllocsPerRun</span><span class="op" id="7734072">(</span><span class="num" id="7734073">100</span><span class="op" id="7734076">,</span>&nbsp;<span class="keyword" id="7734078">func</span><span class="op" id="7734082">(</span><span class="op" id="7734083">)</span>&nbsp;<span class="op" id="7734085">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734089">err</span>&nbsp;<span class="op" id="7734093">:=</span>&nbsp;<span class="ident" id="7734096">client</span><span class="op" id="7734102">.</span><span class="ident" id="7734103">Call</span><span class="op" id="7734107">(</span><span class="string" id="7734108">&#34;Arith.Add&#34;</span><span class="op" id="7734119">,</span>&nbsp;<span class="ident" id="7734121">args</span><span class="op" id="7734125">,</span>&nbsp;<span class="ident" id="7734127">reply</span><span class="op" id="7734132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734136">if</span>&nbsp;<span class="ident" id="7734139">err</span>&nbsp;<span class="op" id="7734143">!=</span>&nbsp;<span class="ident" id="7734146">nil</span>&nbsp;<span class="op" id="7734150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734155">t</span><span class="op" id="7734156">.</span><span class="ident" id="7734157">Errorf</span><span class="op" id="7734163">(</span><span class="string" id="7734164">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7734206">,</span>&nbsp;<span class="ident" id="7734208">err</span><span class="op" id="7734211">.</span><span class="ident" id="7734212">Error</span><span class="op" id="7734217">(</span><span class="op" id="7734218">)</span><span class="op" id="7734219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734227">if</span>&nbsp;<span class="ident" id="7734230">reply</span><span class="op" id="7734235">.</span><span class="ident" id="7734236">C</span>&nbsp;<span class="op" id="7734238">!=</span>&nbsp;<span class="ident" id="7734241">args</span><span class="op" id="7734245">.</span><span class="ident" id="7734246">A</span><span class="op" id="7734247">+</span><span class="ident" id="7734248">args</span><span class="op" id="7734252">.</span><span class="ident" id="7734253">B</span>&nbsp;<span class="op" id="7734255">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734260">t</span><span class="op" id="7734261">.</span><span class="ident" id="7734262">Errorf</span><span class="op" id="7734268">(</span><span class="string" id="7734269">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7734294">,</span>&nbsp;<span class="ident" id="7734296">reply</span><span class="op" id="7734301">.</span><span class="ident" id="7734302">C</span><span class="op" id="7734303">,</span>&nbsp;<span class="ident" id="7734305">args</span><span class="op" id="7734309">.</span><span class="ident" id="7734310">A</span><span class="op" id="7734311">+</span><span class="ident" id="7734312">args</span><span class="op" id="7734316">.</span><span class="ident" id="7734317">B</span><span class="op" id="7734318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734325">}</span><span class="op" id="7734326">)</span><br>
<span class="lineno"></span><span class="op" id="7734328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="7734331">func</span>&nbsp;<span class="ident" id="7734336">TestCountMallocs</span><span class="op" id="7734352">(</span><span class="ident" id="7734353">t</span>&nbsp;<span class="op" id="7734355">*</span><span class="ident" id="7734356">testing</span><span class="op" id="7734363">.</span><span class="ident" id="7734364">T</span><span class="op" id="7734365">)</span>&nbsp;<span class="op" id="7734367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734370">if</span>&nbsp;<span class="ident" id="7734373">testing</span><span class="op" id="7734380">.</span><span class="ident" id="7734381">Short</span><span class="op" id="7734386">(</span><span class="op" id="7734387">)</span>&nbsp;<span class="op" id="7734389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734393">t</span><span class="op" id="7734394">.</span><span class="ident" id="7734395">Skip</span><span class="op" id="7734399">(</span><span class="string" id="7734400">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7734437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734443">if</span>&nbsp;<span class="ident" id="7734446">runtime</span><span class="op" id="7734453">.</span><span class="ident" id="7734454">GOMAXPROCS</span><span class="op" id="7734464">(</span><span class="num" id="7734465">0</span><span class="op" id="7734466">)</span>&nbsp;<span class="op" id="7734468">&gt;</span>&nbsp;<span class="num" id="7734470">1</span>&nbsp;<span class="op" id="7734472">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734476">t</span><span class="op" id="7734477">.</span><span class="ident" id="7734478">Skip</span><span class="op" id="7734482">(</span><span class="string" id="7734483">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7734507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734513">fmt</span><span class="op" id="7734516">.</span><span class="ident" id="7734517">Printf</span><span class="op" id="7734523">(</span><span class="string" id="7734524">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7734558">,</span>&nbsp;<span class="ident" id="7734560">countMallocs</span><span class="op" id="7734572">(</span><span class="ident" id="7734573">dialDirect</span><span class="op" id="7734583">,</span>&nbsp;<span class="ident" id="7734585">t</span><span class="op" id="7734586">)</span><span class="op" id="7734587">)</span><br>
<span class="lineno"></span><span class="op" id="7734589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7734592">func</span>&nbsp;<span class="ident" id="7734597">TestCountMallocsOverHTTP</span><span class="op" id="7734621">(</span><span class="ident" id="7734622">t</span>&nbsp;<span class="op" id="7734624">*</span><span class="ident" id="7734625">testing</span><span class="op" id="7734632">.</span><span class="ident" id="7734633">T</span><span class="op" id="7734634">)</span>&nbsp;<span class="op" id="7734636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734639">if</span>&nbsp;<span class="ident" id="7734642">testing</span><span class="op" id="7734649">.</span><span class="ident" id="7734650">Short</span><span class="op" id="7734655">(</span><span class="op" id="7734656">)</span>&nbsp;<span class="op" id="7734658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734662">t</span><span class="op" id="7734663">.</span><span class="ident" id="7734664">Skip</span><span class="op" id="7734668">(</span><span class="string" id="7734669">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7734706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734712">if</span>&nbsp;<span class="ident" id="7734715">runtime</span><span class="op" id="7734722">.</span><span class="ident" id="7734723">GOMAXPROCS</span><span class="op" id="7734733">(</span><span class="num" id="7734734">0</span><span class="op" id="7734735">)</span>&nbsp;<span class="op" id="7734737">&gt;</span>&nbsp;<span class="num" id="7734739">1</span>&nbsp;<span class="op" id="7734741">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734745">t</span><span class="op" id="7734746">.</span><span class="ident" id="7734747">Skip</span><span class="op" id="7734751">(</span><span class="string" id="7734752">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7734776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734782">fmt</span><span class="op" id="7734785">.</span><span class="ident" id="7734786">Printf</span><span class="op" id="7734792">(</span><span class="string" id="7734793">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7734832">,</span>&nbsp;<span class="ident" id="7734834">countMallocs</span><span class="op" id="7734846">(</span><span class="ident" id="7734847">dialHTTP</span><span class="op" id="7734855">,</span>&nbsp;<span class="ident" id="7734857">t</span><span class="op" id="7734858">)</span><span class="op" id="7734859">)</span><br>
<span class="lineno"></span><span class="op" id="7734861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="7734864">type</span>&nbsp;<span class="ident" id="7734869">writeCrasher</span>&nbsp;<span class="keyword" id="7734882">struct</span>&nbsp;<span class="op" id="7734889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734892">done</span>&nbsp;<span class="keyword" id="7734897">chan</span>&nbsp;<span class="builtintype" id="7734902">bool</span><br>
<span class="lineno"></span><span class="op" id="7734907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734910">func</span>&nbsp;<span class="op" id="7734915">(</span><span class="ident" id="7734916">writeCrasher</span><span class="op" id="7734928">)</span>&nbsp;<span class="ident" id="7734930">Close</span><span class="op" id="7734935">(</span><span class="op" id="7734936">)</span>&nbsp;<span class="builtintype" id="7734938">error</span>&nbsp;<span class="op" id="7734944">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734947">return</span>&nbsp;<span class="ident" id="7734954">nil</span><br>
<span class="lineno"></span><span class="op" id="7734958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734961">func</span>&nbsp;<span class="op" id="7734966">(</span><span class="ident" id="7734967">w</span>&nbsp;<span class="op" id="7734969">*</span><span class="ident" id="7734970">writeCrasher</span><span class="op" id="7734982">)</span>&nbsp;<span class="ident" id="7734984">Read</span><span class="op" id="7734988">(</span><span class="ident" id="7734989">p</span>&nbsp;<span class="op" id="7734991">[</span><span class="op" id="7734992">]</span><span class="builtintype" id="7734993">byte</span><span class="op" id="7734997">)</span>&nbsp;<span class="op" id="7734999">(</span><span class="builtintype" id="7735000">int</span><span class="op" id="7735003">,</span>&nbsp;<span class="builtintype" id="7735005">error</span><span class="op" id="7735010">)</span>&nbsp;<span class="op" id="7735012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735015">&lt;-</span><span class="ident" id="7735017">w</span><span class="op" id="7735018">.</span><span class="ident" id="7735019">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735025">return</span>&nbsp;<span class="num" id="7735032">0</span><span class="op" id="7735033">,</span>&nbsp;<span class="ident" id="7735035">io</span><span class="op" id="7735037">.</span><span class="ident" id="7735038">EOF</span><br>
<span class="lineno"></span><span class="op" id="7735042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735045">func</span>&nbsp;<span class="op" id="7735050">(</span><span class="ident" id="7735051">writeCrasher</span><span class="op" id="7735063">)</span>&nbsp;<span class="ident" id="7735065">Write</span><span class="op" id="7735070">(</span><span class="ident" id="7735071">p</span>&nbsp;<span class="op" id="7735073">[</span><span class="op" id="7735074">]</span><span class="builtintype" id="7735075">byte</span><span class="op" id="7735079">)</span>&nbsp;<span class="op" id="7735081">(</span><span class="builtintype" id="7735082">int</span><span class="op" id="7735085">,</span>&nbsp;<span class="builtintype" id="7735087">error</span><span class="op" id="7735092">)</span>&nbsp;<span class="op" id="7735094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735097">return</span>&nbsp;<span class="num" id="7735104">0</span><span class="op" id="7735105">,</span>&nbsp;<span class="ident" id="7735107">errors</span><span class="op" id="7735113">.</span><span class="ident" id="7735114">New</span><span class="op" id="7735117">(</span><span class="string" id="7735118">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="7735138">)</span><br>
<span class="lineno">540</span><span class="op" id="7735140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735143">func</span>&nbsp;<span class="ident" id="7735148">TestClientWriteError</span><span class="op" id="7735168">(</span><span class="ident" id="7735169">t</span>&nbsp;<span class="op" id="7735171">*</span><span class="ident" id="7735172">testing</span><span class="op" id="7735179">.</span><span class="ident" id="7735180">T</span><span class="op" id="7735181">)</span>&nbsp;<span class="op" id="7735183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735186">w</span>&nbsp;<span class="op" id="7735188">:=</span>&nbsp;<span class="op" id="7735191">&amp;</span><span class="ident" id="7735192">writeCrasher</span><span class="op" id="7735204">{</span><span class="ident" id="7735205">done</span><span class="op" id="7735209">:</span>&nbsp;<span class="builtinfunc" id="7735211">make</span><span class="op" id="7735215">(</span><span class="keyword" id="7735216">chan</span>&nbsp;<span class="builtintype" id="7735221">bool</span><span class="op" id="7735225">)</span><span class="op" id="7735226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735229">c</span>&nbsp;<span class="op" id="7735231">:=</span>&nbsp;<span class="ident" id="7735234">NewClient</span><span class="op" id="7735243">(</span><span class="ident" id="7735244">w</span><span class="op" id="7735245">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735248">defer</span>&nbsp;<span class="ident" id="7735254">c</span><span class="op" id="7735255">.</span><span class="ident" id="7735256">Close</span><span class="op" id="7735261">(</span><span class="op" id="7735262">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735266">res</span>&nbsp;<span class="op" id="7735270">:=</span>&nbsp;<span class="builtintype" id="7735273">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735280">err</span>&nbsp;<span class="op" id="7735284">:=</span>&nbsp;<span class="ident" id="7735287">c</span><span class="op" id="7735288">.</span><span class="ident" id="7735289">Call</span><span class="op" id="7735293">(</span><span class="string" id="7735294">&#34;foo&#34;</span><span class="op" id="7735299">,</span>&nbsp;<span class="num" id="7735301">1</span><span class="op" id="7735302">,</span>&nbsp;<span class="op" id="7735304">&amp;</span><span class="ident" id="7735305">res</span><span class="op" id="7735308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735311">if</span>&nbsp;<span class="ident" id="7735314">err</span>&nbsp;<span class="op" id="7735318">==</span>&nbsp;<span class="ident" id="7735321">nil</span>&nbsp;<span class="op" id="7735325">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735329">t</span><span class="op" id="7735330">.</span><span class="ident" id="7735331">Fatal</span><span class="op" id="7735336">(</span><span class="string" id="7735337">&#34;expected&nbsp;error&#34;</span><span class="op" id="7735353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735359">if</span>&nbsp;<span class="ident" id="7735362">err</span><span class="op" id="7735365">.</span><span class="ident" id="7735366">Error</span><span class="op" id="7735371">(</span><span class="op" id="7735372">)</span>&nbsp;<span class="op" id="7735374">!=</span>&nbsp;<span class="string" id="7735377">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="7735398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735402">t</span><span class="op" id="7735403">.</span><span class="ident" id="7735404">Error</span><span class="op" id="7735409">(</span><span class="string" id="7735410">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="7735438">,</span>&nbsp;<span class="ident" id="7735440">err</span><span class="op" id="7735443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735446">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735449">w</span><span class="op" id="7735450">.</span><span class="ident" id="7735451">done</span>&nbsp;<span class="op" id="7735456">&lt;-</span>&nbsp;<span class="builtintype" id="7735459">true</span><br>
<span class="lineno"></span><span class="op" id="7735464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735467">func</span>&nbsp;<span class="ident" id="7735472">TestTCPClose</span><span class="op" id="7735484">(</span><span class="ident" id="7735485">t</span>&nbsp;<span class="op" id="7735487">*</span><span class="ident" id="7735488">testing</span><span class="op" id="7735495">.</span><span class="ident" id="7735496">T</span><span class="op" id="7735497">)</span>&nbsp;<span class="op" id="7735499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735502">once</span><span class="op" id="7735506">.</span><span class="ident" id="7735507">Do</span><span class="op" id="7735509">(</span><span class="ident" id="7735510">startServer</span><span class="op" id="7735521">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735525">client</span><span class="op" id="7735531">,</span>&nbsp;<span class="ident" id="7735533">err</span>&nbsp;<span class="op" id="7735537">:=</span>&nbsp;<span class="ident" id="7735540">dialHTTP</span><span class="op" id="7735548">(</span><span class="op" id="7735549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735552">if</span>&nbsp;<span class="ident" id="7735555">err</span>&nbsp;<span class="op" id="7735559">!=</span>&nbsp;<span class="ident" id="7735562">nil</span>&nbsp;<span class="op" id="7735566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735570">t</span><span class="op" id="7735571">.</span><span class="ident" id="7735572">Fatalf</span><span class="op" id="7735578">(</span><span class="string" id="7735579">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7735592">,</span>&nbsp;<span class="ident" id="7735594">err</span><span class="op" id="7735597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735600">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735603">defer</span>&nbsp;<span class="ident" id="7735609">client</span><span class="op" id="7735615">.</span><span class="ident" id="7735616">Close</span><span class="op" id="7735621">(</span><span class="op" id="7735622">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735626">args</span>&nbsp;<span class="op" id="7735631">:=</span>&nbsp;<span class="ident" id="7735634">Args</span><span class="op" id="7735638">{</span><span class="num" id="7735639">17</span><span class="op" id="7735641">,</span>&nbsp;<span class="num" id="7735643">8</span><span class="op" id="7735644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735647">var</span>&nbsp;<span class="ident" id="7735651">reply</span>&nbsp;<span class="ident" id="7735657">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735664">err</span>&nbsp;<span class="op" id="7735668">=</span>&nbsp;<span class="ident" id="7735670">client</span><span class="op" id="7735676">.</span><span class="ident" id="7735677">Call</span><span class="op" id="7735681">(</span><span class="string" id="7735682">&#34;Arith.Mul&#34;</span><span class="op" id="7735693">,</span>&nbsp;<span class="ident" id="7735695">args</span><span class="op" id="7735699">,</span>&nbsp;<span class="op" id="7735701">&amp;</span><span class="ident" id="7735702">reply</span><span class="op" id="7735707">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735710">if</span>&nbsp;<span class="ident" id="7735713">err</span>&nbsp;<span class="op" id="7735717">!=</span>&nbsp;<span class="ident" id="7735720">nil</span>&nbsp;<span class="op" id="7735724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735728">t</span><span class="op" id="7735729">.</span><span class="ident" id="7735730">Fatal</span><span class="op" id="7735735">(</span><span class="string" id="7735736">&#34;arith&nbsp;error:&#34;</span><span class="op" id="7735750">,</span>&nbsp;<span class="ident" id="7735752">err</span><span class="op" id="7735755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735761">t</span><span class="op" id="7735762">.</span><span class="ident" id="7735763">Logf</span><span class="op" id="7735767">(</span><span class="string" id="7735768">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="7735787">,</span>&nbsp;<span class="ident" id="7735789">args</span><span class="op" id="7735793">.</span><span class="ident" id="7735794">A</span><span class="op" id="7735795">,</span>&nbsp;<span class="ident" id="7735797">args</span><span class="op" id="7735801">.</span><span class="ident" id="7735802">B</span><span class="op" id="7735803">,</span>&nbsp;<span class="ident" id="7735805">reply</span><span class="op" id="7735810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735813">if</span>&nbsp;<span class="ident" id="7735816">reply</span><span class="op" id="7735821">.</span><span class="ident" id="7735822">C</span>&nbsp;<span class="op" id="7735824">!=</span>&nbsp;<span class="ident" id="7735827">args</span><span class="op" id="7735831">.</span><span class="ident" id="7735832">A</span><span class="op" id="7735833">*</span><span class="ident" id="7735834">args</span><span class="op" id="7735838">.</span><span class="ident" id="7735839">B</span>&nbsp;<span class="op" id="7735841">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735845">t</span><span class="op" id="7735846">.</span><span class="ident" id="7735847">Errorf</span><span class="op" id="7735853">(</span><span class="string" id="7735854">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7735879">,</span>&nbsp;<span class="ident" id="7735881">reply</span><span class="op" id="7735886">.</span><span class="ident" id="7735887">C</span><span class="op" id="7735888">,</span>&nbsp;<span class="ident" id="7735890">args</span><span class="op" id="7735894">.</span><span class="ident" id="7735895">A</span><span class="op" id="7735896">*</span><span class="ident" id="7735897">args</span><span class="op" id="7735901">.</span><span class="ident" id="7735902">B</span><span class="op" id="7735903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735906">}</span><br>
<span class="lineno"></span><span class="op" id="7735908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735911">func</span>&nbsp;<span class="ident" id="7735916">TestErrorAfterClientClose</span><span class="op" id="7735941">(</span><span class="ident" id="7735942">t</span>&nbsp;<span class="op" id="7735944">*</span><span class="ident" id="7735945">testing</span><span class="op" id="7735952">.</span><span class="ident" id="7735953">T</span><span class="op" id="7735954">)</span>&nbsp;<span class="op" id="7735956">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735959">once</span><span class="op" id="7735963">.</span><span class="ident" id="7735964">Do</span><span class="op" id="7735966">(</span><span class="ident" id="7735967">startServer</span><span class="op" id="7735978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735982">client</span><span class="op" id="7735988">,</span>&nbsp;<span class="ident" id="7735990">err</span>&nbsp;<span class="op" id="7735994">:=</span>&nbsp;<span class="ident" id="7735997">dialHTTP</span><span class="op" id="7736005">(</span><span class="op" id="7736006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736009">if</span>&nbsp;<span class="ident" id="7736012">err</span>&nbsp;<span class="op" id="7736016">!=</span>&nbsp;<span class="ident" id="7736019">nil</span>&nbsp;<span class="op" id="7736023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736027">t</span><span class="op" id="7736028">.</span><span class="ident" id="7736029">Fatalf</span><span class="op" id="7736035">(</span><span class="string" id="7736036">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7736049">,</span>&nbsp;<span class="ident" id="7736051">err</span><span class="op" id="7736054">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736060">err</span>&nbsp;<span class="op" id="7736064">=</span>&nbsp;<span class="ident" id="7736066">client</span><span class="op" id="7736072">.</span><span class="ident" id="7736073">Close</span><span class="op" id="7736078">(</span><span class="op" id="7736079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736082">if</span>&nbsp;<span class="ident" id="7736085">err</span>&nbsp;<span class="op" id="7736089">!=</span>&nbsp;<span class="ident" id="7736092">nil</span>&nbsp;<span class="op" id="7736096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736100">t</span><span class="op" id="7736101">.</span><span class="ident" id="7736102">Fatal</span><span class="op" id="7736107">(</span><span class="string" id="7736108">&#34;close&nbsp;error:&#34;</span><span class="op" id="7736122">,</span>&nbsp;<span class="ident" id="7736124">err</span><span class="op" id="7736127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736130">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736133">err</span>&nbsp;<span class="op" id="7736137">=</span>&nbsp;<span class="ident" id="7736139">client</span><span class="op" id="7736145">.</span><span class="ident" id="7736146">Call</span><span class="op" id="7736150">(</span><span class="string" id="7736151">&#34;Arith.Add&#34;</span><span class="op" id="7736162">,</span>&nbsp;<span class="op" id="7736164">&amp;</span><span class="ident" id="7736165">Args</span><span class="op" id="7736169">{</span><span class="num" id="7736170">7</span><span class="op" id="7736171">,</span>&nbsp;<span class="num" id="7736173">9</span><span class="op" id="7736174">}</span><span class="op" id="7736175">,</span>&nbsp;<span class="builtinfunc" id="7736177">new</span><span class="op" id="7736180">(</span><span class="ident" id="7736181">Reply</span><span class="op" id="7736186">)</span><span class="op" id="7736187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736190">if</span>&nbsp;<span class="ident" id="7736193">err</span>&nbsp;<span class="op" id="7736197">!=</span>&nbsp;<span class="ident" id="7736200">ErrShutdown</span>&nbsp;<span class="op" id="7736212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736216">t</span><span class="op" id="7736217">.</span><span class="ident" id="7736218">Errorf</span><span class="op" id="7736224">(</span><span class="string" id="7736225">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7736263">,</span>&nbsp;<span class="ident" id="7736265">err</span><span class="op" id="7736268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736271">}</span><br>
<span class="lineno"></span><span class="op" id="7736273">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="7736276">func</span>&nbsp;<span class="ident" id="7736281">benchmarkEndToEnd</span><span class="op" id="7736298">(</span><span class="ident" id="7736299">dial</span>&nbsp;<span class="keyword" id="7736304">func</span><span class="op" id="7736308">(</span><span class="op" id="7736309">)</span>&nbsp;<span class="op" id="7736311">(</span><span class="op" id="7736312">*</span><span class="ident" id="7736313">Client</span><span class="op" id="7736319">,</span>&nbsp;<span class="builtintype" id="7736321">error</span><span class="op" id="7736326">)</span><span class="op" id="7736327">,</span>&nbsp;<span class="ident" id="7736329">b</span>&nbsp;<span class="op" id="7736331">*</span><span class="ident" id="7736332">testing</span><span class="op" id="7736339">.</span><span class="ident" id="7736340">B</span><span class="op" id="7736341">)</span>&nbsp;<span class="op" id="7736343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736346">once</span><span class="op" id="7736350">.</span><span class="ident" id="7736351">Do</span><span class="op" id="7736353">(</span><span class="ident" id="7736354">startServer</span><span class="op" id="7736365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736368">client</span><span class="op" id="7736374">,</span>&nbsp;<span class="ident" id="7736376">err</span>&nbsp;<span class="op" id="7736380">:=</span>&nbsp;<span class="ident" id="7736383">dial</span><span class="op" id="7736387">(</span><span class="op" id="7736388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736391">if</span>&nbsp;<span class="ident" id="7736394">err</span>&nbsp;<span class="op" id="7736398">!=</span>&nbsp;<span class="ident" id="7736401">nil</span>&nbsp;<span class="op" id="7736405">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736409">b</span><span class="op" id="7736410">.</span><span class="ident" id="7736411">Fatal</span><span class="op" id="7736416">(</span><span class="string" id="7736417">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7736433">,</span>&nbsp;<span class="ident" id="7736435">err</span><span class="op" id="7736438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736444">defer</span>&nbsp;<span class="ident" id="7736450">client</span><span class="op" id="7736456">.</span><span class="ident" id="7736457">Close</span><span class="op" id="7736462">(</span><span class="op" id="7736463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7736467">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736489">args</span>&nbsp;<span class="op" id="7736494">:=</span>&nbsp;<span class="op" id="7736497">&amp;</span><span class="ident" id="7736498">Args</span><span class="op" id="7736502">{</span><span class="num" id="7736503">7</span><span class="op" id="7736504">,</span>&nbsp;<span class="num" id="7736506">8</span><span class="op" id="7736507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736510">b</span><span class="op" id="7736511">.</span><span class="ident" id="7736512">ResetTimer</span><span class="op" id="7736522">(</span><span class="op" id="7736523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736527">b</span><span class="op" id="7736528">.</span><span class="ident" id="7736529">RunParallel</span><span class="op" id="7736540">(</span><span class="keyword" id="7736541">func</span><span class="op" id="7736545">(</span><span class="ident" id="7736546">pb</span>&nbsp;<span class="op" id="7736549">*</span><span class="ident" id="7736550">testing</span><span class="op" id="7736557">.</span><span class="ident" id="7736558">PB</span><span class="op" id="7736560">)</span>&nbsp;<span class="op" id="7736562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736566">reply</span>&nbsp;<span class="op" id="7736572">:=</span>&nbsp;<span class="builtinfunc" id="7736575">new</span><span class="op" id="7736578">(</span><span class="ident" id="7736579">Reply</span><span class="op" id="7736584">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736588">for</span>&nbsp;<span class="ident" id="7736592">pb</span><span class="op" id="7736594">.</span><span class="ident" id="7736595">Next</span><span class="op" id="7736599">(</span><span class="op" id="7736600">)</span>&nbsp;<span class="op" id="7736602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736607">err</span>&nbsp;<span class="op" id="7736611">:=</span>&nbsp;<span class="ident" id="7736614">client</span><span class="op" id="7736620">.</span><span class="ident" id="7736621">Call</span><span class="op" id="7736625">(</span><span class="string" id="7736626">&#34;Arith.Add&#34;</span><span class="op" id="7736637">,</span>&nbsp;<span class="ident" id="7736639">args</span><span class="op" id="7736643">,</span>&nbsp;<span class="ident" id="7736645">reply</span><span class="op" id="7736650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736655">if</span>&nbsp;<span class="ident" id="7736658">err</span>&nbsp;<span class="op" id="7736662">!=</span>&nbsp;<span class="ident" id="7736665">nil</span>&nbsp;<span class="op" id="7736669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736675">b</span><span class="op" id="7736676">.</span><span class="ident" id="7736677">Fatalf</span><span class="op" id="7736683">(</span><span class="string" id="7736684">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7736737">,</span>&nbsp;<span class="ident" id="7736739">err</span><span class="op" id="7736742">.</span><span class="ident" id="7736743">Error</span><span class="op" id="7736748">(</span><span class="op" id="7736749">)</span><span class="op" id="7736750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736755">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736760">if</span>&nbsp;<span class="ident" id="7736763">reply</span><span class="op" id="7736768">.</span><span class="ident" id="7736769">C</span>&nbsp;<span class="op" id="7736771">!=</span>&nbsp;<span class="ident" id="7736774">args</span><span class="op" id="7736778">.</span><span class="ident" id="7736779">A</span><span class="op" id="7736780">+</span><span class="ident" id="7736781">args</span><span class="op" id="7736785">.</span><span class="ident" id="7736786">B</span>&nbsp;<span class="op" id="7736788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736794">b</span><span class="op" id="7736795">.</span><span class="ident" id="7736796">Fatalf</span><span class="op" id="7736802">(</span><span class="string" id="7736803">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7736839">,</span>&nbsp;<span class="ident" id="7736841">reply</span><span class="op" id="7736846">.</span><span class="ident" id="7736847">C</span><span class="op" id="7736848">,</span>&nbsp;<span class="ident" id="7736850">args</span><span class="op" id="7736854">.</span><span class="ident" id="7736855">A</span><span class="op" id="7736856">+</span><span class="ident" id="7736857">args</span><span class="op" id="7736861">.</span><span class="ident" id="7736862">B</span><span class="op" id="7736863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736875">}</span><span class="op" id="7736876">)</span><br>
<span class="lineno">620</span><span class="op" id="7736878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7736881">func</span>&nbsp;<span class="ident" id="7736886">benchmarkEndToEndAsync</span><span class="op" id="7736908">(</span><span class="ident" id="7736909">dial</span>&nbsp;<span class="keyword" id="7736914">func</span><span class="op" id="7736918">(</span><span class="op" id="7736919">)</span>&nbsp;<span class="op" id="7736921">(</span><span class="op" id="7736922">*</span><span class="ident" id="7736923">Client</span><span class="op" id="7736929">,</span>&nbsp;<span class="builtintype" id="7736931">error</span><span class="op" id="7736936">)</span><span class="op" id="7736937">,</span>&nbsp;<span class="ident" id="7736939">b</span>&nbsp;<span class="op" id="7736941">*</span><span class="ident" id="7736942">testing</span><span class="op" id="7736949">.</span><span class="ident" id="7736950">B</span><span class="op" id="7736951">)</span>&nbsp;<span class="op" id="7736953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736956">const</span>&nbsp;<span class="ident" id="7736962">MaxConcurrentCalls</span>&nbsp;<span class="op" id="7736981">=</span>&nbsp;<span class="num" id="7736983">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736988">once</span><span class="op" id="7736992">.</span><span class="ident" id="7736993">Do</span><span class="op" id="7736995">(</span><span class="ident" id="7736996">startServer</span><span class="op" id="7737007">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737010">client</span><span class="op" id="7737016">,</span>&nbsp;<span class="ident" id="7737018">err</span>&nbsp;<span class="op" id="7737022">:=</span>&nbsp;<span class="ident" id="7737025">dial</span><span class="op" id="7737029">(</span><span class="op" id="7737030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737033">if</span>&nbsp;<span class="ident" id="7737036">err</span>&nbsp;<span class="op" id="7737040">!=</span>&nbsp;<span class="ident" id="7737043">nil</span>&nbsp;<span class="op" id="7737047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737051">b</span><span class="op" id="7737052">.</span><span class="ident" id="7737053">Fatal</span><span class="op" id="7737058">(</span><span class="string" id="7737059">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7737075">,</span>&nbsp;<span class="ident" id="7737077">err</span><span class="op" id="7737080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737086">defer</span>&nbsp;<span class="ident" id="7737092">client</span><span class="op" id="7737098">.</span><span class="ident" id="7737099">Close</span><span class="op" id="7737104">(</span><span class="op" id="7737105">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737109">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737132">args</span>&nbsp;<span class="op" id="7737137">:=</span>&nbsp;<span class="op" id="7737140">&amp;</span><span class="ident" id="7737141">Args</span><span class="op" id="7737145">{</span><span class="num" id="7737146">7</span><span class="op" id="7737147">,</span>&nbsp;<span class="num" id="7737149">8</span><span class="op" id="7737150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737153">procs</span>&nbsp;<span class="op" id="7737159">:=</span>&nbsp;<span class="num" id="7737162">4</span>&nbsp;<span class="op" id="7737164">*</span>&nbsp;<span class="ident" id="7737166">runtime</span><span class="op" id="7737173">.</span><span class="ident" id="7737174">GOMAXPROCS</span><span class="op" id="7737184">(</span><span class="op" id="7737185">-</span><span class="num" id="7737186">1</span><span class="op" id="7737187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737190">send</span>&nbsp;<span class="op" id="7737195">:=</span>&nbsp;<span class="builtintype" id="7737198">int32</span><span class="op" id="7737203">(</span><span class="ident" id="7737204">b</span><span class="op" id="7737205">.</span><span class="ident" id="7737206">N</span><span class="op" id="7737207">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737210">recv</span>&nbsp;<span class="op" id="7737215">:=</span>&nbsp;<span class="builtintype" id="7737218">int32</span><span class="op" id="7737223">(</span><span class="ident" id="7737224">b</span><span class="op" id="7737225">.</span><span class="ident" id="7737226">N</span><span class="op" id="7737227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737230">var</span>&nbsp;<span class="ident" id="7737234">wg</span>&nbsp;<span class="ident" id="7737237">sync</span><span class="op" id="7737241">.</span><span class="ident" id="7737242">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737253">wg</span><span class="op" id="7737255">.</span><span class="ident" id="7737256">Add</span><span class="op" id="7737259">(</span><span class="ident" id="7737260">procs</span><span class="op" id="7737265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737268">gate</span>&nbsp;<span class="op" id="7737273">:=</span>&nbsp;<span class="builtinfunc" id="7737276">make</span><span class="op" id="7737280">(</span><span class="keyword" id="7737281">chan</span>&nbsp;<span class="builtintype" id="7737286">bool</span><span class="op" id="7737290">,</span>&nbsp;<span class="ident" id="7737292">MaxConcurrentCalls</span><span class="op" id="7737310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737313">res</span>&nbsp;<span class="op" id="7737317">:=</span>&nbsp;<span class="builtinfunc" id="7737320">make</span><span class="op" id="7737324">(</span><span class="keyword" id="7737325">chan</span>&nbsp;<span class="op" id="7737330">*</span><span class="ident" id="7737331">Call</span><span class="op" id="7737335">,</span>&nbsp;<span class="ident" id="7737337">MaxConcurrentCalls</span><span class="op" id="7737355">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737358">b</span><span class="op" id="7737359">.</span><span class="ident" id="7737360">ResetTimer</span><span class="op" id="7737370">(</span><span class="op" id="7737371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737375">for</span>&nbsp;<span class="ident" id="7737379">p</span>&nbsp;<span class="op" id="7737381">:=</span>&nbsp;<span class="num" id="7737384">0</span><span class="op" id="7737385">;</span>&nbsp;<span class="ident" id="7737387">p</span>&nbsp;<span class="op" id="7737389">&lt;</span>&nbsp;<span class="ident" id="7737391">procs</span><span class="op" id="7737396">;</span>&nbsp;<span class="ident" id="7737398">p</span><span class="op" id="7737399">++</span>&nbsp;<span class="op" id="7737402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737406">go</span>&nbsp;<span class="keyword" id="7737409">func</span><span class="op" id="7737413">(</span><span class="op" id="7737414">)</span>&nbsp;<span class="op" id="7737416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737421">for</span>&nbsp;<span class="ident" id="7737425">atomic</span><span class="op" id="7737431">.</span><span class="ident" id="7737432">AddInt32</span><span class="op" id="7737440">(</span><span class="op" id="7737441">&amp;</span><span class="ident" id="7737442">send</span><span class="op" id="7737446">,</span>&nbsp;<span class="op" id="7737448">-</span><span class="num" id="7737449">1</span><span class="op" id="7737450">)</span>&nbsp;<span class="op" id="7737452">&gt;=</span>&nbsp;<span class="num" id="7737455">0</span>&nbsp;<span class="op" id="7737457">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737463">gate</span>&nbsp;<span class="op" id="7737468">&lt;-</span>&nbsp;<span class="builtintype" id="7737471">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737480">reply</span>&nbsp;<span class="op" id="7737486">:=</span>&nbsp;<span class="builtinfunc" id="7737489">new</span><span class="op" id="7737492">(</span><span class="ident" id="7737493">Reply</span><span class="op" id="7737498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737504">client</span><span class="op" id="7737510">.</span><span class="ident" id="7737511">Go</span><span class="op" id="7737513">(</span><span class="string" id="7737514">&#34;Arith.Add&#34;</span><span class="op" id="7737525">,</span>&nbsp;<span class="ident" id="7737527">args</span><span class="op" id="7737531">,</span>&nbsp;<span class="ident" id="7737533">reply</span><span class="op" id="7737538">,</span>&nbsp;<span class="ident" id="7737540">res</span><span class="op" id="7737543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737552">}</span><span class="op" id="7737553">(</span><span class="op" id="7737554">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737558">go</span>&nbsp;<span class="keyword" id="7737561">func</span><span class="op" id="7737565">(</span><span class="op" id="7737566">)</span>&nbsp;<span class="op" id="7737568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737573">for</span>&nbsp;<span class="ident" id="7737577">call</span>&nbsp;<span class="op" id="7737582">:=</span>&nbsp;<span class="keyword" id="7737585">range</span>&nbsp;<span class="ident" id="7737591">res</span>&nbsp;<span class="op" id="7737595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737601">A</span>&nbsp;<span class="op" id="7737603">:=</span>&nbsp;<span class="ident" id="7737606">call</span><span class="op" id="7737610">.</span><span class="ident" id="7737611">Args</span><span class="op" id="7737615">.</span><span class="op" id="7737616">(</span><span class="op" id="7737617">*</span><span class="ident" id="7737618">Args</span><span class="op" id="7737622">)</span><span class="op" id="7737623">.</span><span class="ident" id="7737624">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737630">B</span>&nbsp;<span class="op" id="7737632">:=</span>&nbsp;<span class="ident" id="7737635">call</span><span class="op" id="7737639">.</span><span class="ident" id="7737640">Args</span><span class="op" id="7737644">.</span><span class="op" id="7737645">(</span><span class="op" id="7737646">*</span><span class="ident" id="7737647">Args</span><span class="op" id="7737651">)</span><span class="op" id="7737652">.</span><span class="ident" id="7737653">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737659">C</span>&nbsp;<span class="op" id="7737661">:=</span>&nbsp;<span class="ident" id="7737664">call</span><span class="op" id="7737668">.</span><span class="ident" id="7737669">Reply</span><span class="op" id="7737674">.</span><span class="op" id="7737675">(</span><span class="op" id="7737676">*</span><span class="ident" id="7737677">Reply</span><span class="op" id="7737682">)</span><span class="op" id="7737683">.</span><span class="ident" id="7737684">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737690">if</span>&nbsp;<span class="ident" id="7737693">A</span><span class="op" id="7737694">+</span><span class="ident" id="7737695">B</span>&nbsp;<span class="op" id="7737697">!=</span>&nbsp;<span class="ident" id="7737700">C</span>&nbsp;<span class="op" id="7737702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737709">b</span><span class="op" id="7737710">.</span><span class="ident" id="7737711">Fatalf</span><span class="op" id="7737717">(</span><span class="string" id="7737718">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7737760">,</span>&nbsp;<span class="ident" id="7737762">A</span><span class="op" id="7737763">+</span><span class="ident" id="7737764">B</span><span class="op" id="7737765">,</span>&nbsp;<span class="ident" id="7737767">C</span><span class="op" id="7737768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737780">&lt;-</span><span class="ident" id="7737782">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737791">if</span>&nbsp;<span class="ident" id="7737794">atomic</span><span class="op" id="7737800">.</span><span class="ident" id="7737801">AddInt32</span><span class="op" id="7737809">(</span><span class="op" id="7737810">&amp;</span><span class="ident" id="7737811">recv</span><span class="op" id="7737815">,</span>&nbsp;<span class="op" id="7737817">-</span><span class="num" id="7737818">1</span><span class="op" id="7737819">)</span>&nbsp;<span class="op" id="7737821">==</span>&nbsp;<span class="num" id="7737824">0</span>&nbsp;<span class="op" id="7737826">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7737833">close</span><span class="op" id="7737838">(</span><span class="ident" id="7737839">res</span><span class="op" id="7737842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737858">wg</span><span class="op" id="7737860">.</span><span class="ident" id="7737861">Done</span><span class="op" id="7737865">(</span><span class="op" id="7737866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737870">}</span><span class="op" id="7737871">(</span><span class="op" id="7737872">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737878">wg</span><span class="op" id="7737880">.</span><span class="ident" id="7737881">Wait</span><span class="op" id="7737885">(</span><span class="op" id="7737886">)</span><br>
<span class="lineno"></span><span class="op" id="7737888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7737891">func</span>&nbsp;<span class="ident" id="7737896">BenchmarkEndToEnd</span><span class="op" id="7737913">(</span><span class="ident" id="7737914">b</span>&nbsp;<span class="op" id="7737916">*</span><span class="ident" id="7737917">testing</span><span class="op" id="7737924">.</span><span class="ident" id="7737925">B</span><span class="op" id="7737926">)</span>&nbsp;<span class="op" id="7737928">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737931">benchmarkEndToEnd</span><span class="op" id="7737948">(</span><span class="ident" id="7737949">dialDirect</span><span class="op" id="7737959">,</span>&nbsp;<span class="ident" id="7737961">b</span><span class="op" id="7737962">)</span><br>
<span class="lineno"></span><span class="op" id="7737964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7737967">func</span>&nbsp;<span class="ident" id="7737972">BenchmarkEndToEndHTTP</span><span class="op" id="7737993">(</span><span class="ident" id="7737994">b</span>&nbsp;<span class="op" id="7737996">*</span><span class="ident" id="7737997">testing</span><span class="op" id="7738004">.</span><span class="ident" id="7738005">B</span><span class="op" id="7738006">)</span>&nbsp;<span class="op" id="7738008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738011">benchmarkEndToEnd</span><span class="op" id="7738028">(</span><span class="ident" id="7738029">dialHTTP</span><span class="op" id="7738037">,</span>&nbsp;<span class="ident" id="7738039">b</span><span class="op" id="7738040">)</span><br>
<span class="lineno">675</span><span class="op" id="7738042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7738045">func</span>&nbsp;<span class="ident" id="7738050">BenchmarkEndToEndAsync</span><span class="op" id="7738072">(</span><span class="ident" id="7738073">b</span>&nbsp;<span class="op" id="7738075">*</span><span class="ident" id="7738076">testing</span><span class="op" id="7738083">.</span><span class="ident" id="7738084">B</span><span class="op" id="7738085">)</span>&nbsp;<span class="op" id="7738087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738090">benchmarkEndToEndAsync</span><span class="op" id="7738112">(</span><span class="ident" id="7738113">dialDirect</span><span class="op" id="7738123">,</span>&nbsp;<span class="ident" id="7738125">b</span><span class="op" id="7738126">)</span><br>
<span class="lineno"></span><span class="op" id="7738128">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7738131">func</span>&nbsp;<span class="ident" id="7738136">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="7738162">(</span><span class="ident" id="7738163">b</span>&nbsp;<span class="op" id="7738165">*</span><span class="ident" id="7738166">testing</span><span class="op" id="7738173">.</span><span class="ident" id="7738174">B</span><span class="op" id="7738175">)</span>&nbsp;<span class="op" id="7738177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738180">benchmarkEndToEndAsync</span><span class="op" id="7738202">(</span><span class="ident" id="7738203">dialHTTP</span><span class="op" id="7738211">,</span>&nbsp;<span class="ident" id="7738213">b</span><span class="op" id="7738214">)</span><br>
<span class="lineno"></span><span class="op" id="7738216">}</span>
</div>
</body>
</html>
