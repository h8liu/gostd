<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html" class="current">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4350194">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4350249">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4350303">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4350354">package</span>&nbsp;<span class="ident" id="4350362">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4350368">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4350442">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4350516">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4350536">import</span>&nbsp;<span class="op" id="4350543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350546">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350560">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350577">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350591">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350605">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350621">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350637">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350647">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350653">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4350663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4350666">type</span>&nbsp;<span class="ident" id="4350671">PEMCipher</span>&nbsp;<span class="builtintype" id="4350681">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4350686">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4350751">const</span>&nbsp;<span class="op" id="4350757">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350760">_</span>&nbsp;<span class="ident" id="4350762">PEMCipher</span>&nbsp;<span class="op" id="4350772">=</span>&nbsp;<span class="ident" id="4350774">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350780">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350794">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350809">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350826">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350843">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4350859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4350862">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4350921">type</span>&nbsp;<span class="ident" id="4350926">rfc1423Algo</span>&nbsp;<span class="keyword" id="4350938">struct</span>&nbsp;<span class="op" id="4350945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350948">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350959">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350970">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4350981">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350989">cipherFunc</span>&nbsp;<span class="keyword" id="4351000">func</span><span class="op" id="4351004">(</span><span class="ident" id="4351005">key</span>&nbsp;<span class="op" id="4351009">[</span><span class="op" id="4351010">]</span><span class="builtintype" id="4351011">byte</span><span class="op" id="4351015">)</span>&nbsp;<span class="op" id="4351017">(</span><span class="ident" id="4351018">cipher</span><span class="op" id="4351024">.</span><span class="ident" id="4351025">Block</span><span class="op" id="4351030">,</span>&nbsp;<span class="builtintype" id="4351032">error</span><span class="op" id="4351037">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351040">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4351051">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351056">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4351067">int</span><br>
<span class="lineno"></span><span class="op" id="4351071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4351074">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4351142">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4351208">var</span>&nbsp;<span class="ident" id="4351212">rfc1423Algos</span>&nbsp;<span class="op" id="4351225">=</span>&nbsp;<span class="op" id="4351227">[</span><span class="op" id="4351228">]</span><span class="ident" id="4351229">rfc1423Algo</span><span class="op" id="4351240">{</span><span class="op" id="4351241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351244">cipher</span><span class="op" id="4351250">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351256">PEMCipherDES</span><span class="op" id="4351268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351271">name</span><span class="op" id="4351275">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351283">&#34;DES-CBC&#34;</span><span class="op" id="4351292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351295">cipherFunc</span><span class="op" id="4351305">:</span>&nbsp;<span class="ident" id="4351307">des</span><span class="op" id="4351310">.</span><span class="ident" id="4351311">NewCipher</span><span class="op" id="4351320">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351323">keySize</span><span class="op" id="4351330">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4351335">8</span><span class="op" id="4351336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351339">blockSize</span><span class="op" id="4351348">:</span>&nbsp;&nbsp;<span class="ident" id="4351351">des</span><span class="op" id="4351354">.</span><span class="ident" id="4351355">BlockSize</span><span class="op" id="4351364">,</span><br>
<span class="lineno"></span><span class="op" id="4351366">}</span><span class="op" id="4351367">,</span>&nbsp;<span class="op" id="4351369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351372">cipher</span><span class="op" id="4351378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351384">PEMCipher3DES</span><span class="op" id="4351397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351400">name</span><span class="op" id="4351404">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351412">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4351426">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351429">cipherFunc</span><span class="op" id="4351439">:</span>&nbsp;<span class="ident" id="4351441">des</span><span class="op" id="4351444">.</span><span class="ident" id="4351445">NewTripleDESCipher</span><span class="op" id="4351463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351466">keySize</span><span class="op" id="4351473">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4351478">24</span><span class="op" id="4351480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351483">blockSize</span><span class="op" id="4351492">:</span>&nbsp;&nbsp;<span class="ident" id="4351495">des</span><span class="op" id="4351498">.</span><span class="ident" id="4351499">BlockSize</span><span class="op" id="4351508">,</span><br>
<span class="lineno"></span><span class="op" id="4351510">}</span><span class="op" id="4351511">,</span>&nbsp;<span class="op" id="4351513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351516">cipher</span><span class="op" id="4351522">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351528">PEMCipherAES128</span><span class="op" id="4351543">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351546">name</span><span class="op" id="4351550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351558">&#34;AES-128-CBC&#34;</span><span class="op" id="4351571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351574">cipherFunc</span><span class="op" id="4351584">:</span>&nbsp;<span class="ident" id="4351586">aes</span><span class="op" id="4351589">.</span><span class="ident" id="4351590">NewCipher</span><span class="op" id="4351599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351602">keySize</span><span class="op" id="4351609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4351614">16</span><span class="op" id="4351616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351619">blockSize</span><span class="op" id="4351628">:</span>&nbsp;&nbsp;<span class="ident" id="4351631">aes</span><span class="op" id="4351634">.</span><span class="ident" id="4351635">BlockSize</span><span class="op" id="4351644">,</span><br>
<span class="lineno"></span><span class="op" id="4351646">}</span><span class="op" id="4351647">,</span>&nbsp;<span class="op" id="4351649">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351652">cipher</span><span class="op" id="4351658">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351664">PEMCipherAES192</span><span class="op" id="4351679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351682">name</span><span class="op" id="4351686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351694">&#34;AES-192-CBC&#34;</span><span class="op" id="4351707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351710">cipherFunc</span><span class="op" id="4351720">:</span>&nbsp;<span class="ident" id="4351722">aes</span><span class="op" id="4351725">.</span><span class="ident" id="4351726">NewCipher</span><span class="op" id="4351735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351738">keySize</span><span class="op" id="4351745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4351750">24</span><span class="op" id="4351752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351755">blockSize</span><span class="op" id="4351764">:</span>&nbsp;&nbsp;<span class="ident" id="4351767">aes</span><span class="op" id="4351770">.</span><span class="ident" id="4351771">BlockSize</span><span class="op" id="4351780">,</span><br>
<span class="lineno">70</span><span class="op" id="4351782">}</span><span class="op" id="4351783">,</span>&nbsp;<span class="op" id="4351785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351788">cipher</span><span class="op" id="4351794">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351800">PEMCipherAES256</span><span class="op" id="4351815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351818">name</span><span class="op" id="4351822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351830">&#34;AES-256-CBC&#34;</span><span class="op" id="4351843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351846">cipherFunc</span><span class="op" id="4351856">:</span>&nbsp;<span class="ident" id="4351858">aes</span><span class="op" id="4351861">.</span><span class="ident" id="4351862">NewCipher</span><span class="op" id="4351871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351874">keySize</span><span class="op" id="4351881">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4351886">32</span><span class="op" id="4351888">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351891">blockSize</span><span class="op" id="4351900">:</span>&nbsp;&nbsp;<span class="ident" id="4351903">aes</span><span class="op" id="4351906">.</span><span class="ident" id="4351907">BlockSize</span><span class="op" id="4351916">,</span><br>
<span class="lineno"></span><span class="op" id="4351918">}</span><span class="op" id="4351919">,</span><br>
<span class="lineno"></span><span class="op" id="4351921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4351924">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4352003">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4352083">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4352106">func</span>&nbsp;<span class="op" id="4352111">(</span><span class="ident" id="4352112">c</span>&nbsp;<span class="ident" id="4352114">rfc1423Algo</span><span class="op" id="4352125">)</span>&nbsp;<span class="ident" id="4352127">deriveKey</span><span class="op" id="4352136">(</span><span class="ident" id="4352137">password</span><span class="op" id="4352145">,</span>&nbsp;<span class="ident" id="4352147">salt</span>&nbsp;<span class="op" id="4352152">[</span><span class="op" id="4352153">]</span><span class="builtintype" id="4352154">byte</span><span class="op" id="4352158">)</span>&nbsp;<span class="op" id="4352160">[</span><span class="op" id="4352161">]</span><span class="builtintype" id="4352162">byte</span>&nbsp;<span class="op" id="4352167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352170">hash</span>&nbsp;<span class="op" id="4352175">:=</span>&nbsp;<span class="ident" id="4352178">md5</span><span class="op" id="4352181">.</span><span class="ident" id="4352182">New</span><span class="op" id="4352185">(</span><span class="op" id="4352186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352189">out</span>&nbsp;<span class="op" id="4352193">:=</span>&nbsp;<span class="builtinfunc" id="4352196">make</span><span class="op" id="4352200">(</span><span class="op" id="4352201">[</span><span class="op" id="4352202">]</span><span class="builtintype" id="4352203">byte</span><span class="op" id="4352207">,</span>&nbsp;<span class="ident" id="4352209">c</span><span class="op" id="4352210">.</span><span class="ident" id="4352211">keySize</span><span class="op" id="4352218">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352221">var</span>&nbsp;<span class="ident" id="4352225">digest</span>&nbsp;<span class="op" id="4352232">[</span><span class="op" id="4352233">]</span><span class="builtintype" id="4352234">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352241">for</span>&nbsp;<span class="ident" id="4352245">i</span>&nbsp;<span class="op" id="4352247">:=</span>&nbsp;<span class="num" id="4352250">0</span><span class="op" id="4352251">;</span>&nbsp;<span class="ident" id="4352253">i</span>&nbsp;<span class="op" id="4352255">&lt;</span>&nbsp;<span class="builtinfunc" id="4352257">len</span><span class="op" id="4352260">(</span><span class="ident" id="4352261">out</span><span class="op" id="4352264">)</span><span class="op" id="4352265">;</span>&nbsp;<span class="ident" id="4352267">i</span>&nbsp;<span class="op" id="4352269">+=</span>&nbsp;<span class="builtinfunc" id="4352272">len</span><span class="op" id="4352275">(</span><span class="ident" id="4352276">digest</span><span class="op" id="4352282">)</span>&nbsp;<span class="op" id="4352284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352288">hash</span><span class="op" id="4352292">.</span><span class="ident" id="4352293">Reset</span><span class="op" id="4352298">(</span><span class="op" id="4352299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352303">hash</span><span class="op" id="4352307">.</span><span class="ident" id="4352308">Write</span><span class="op" id="4352313">(</span><span class="ident" id="4352314">digest</span><span class="op" id="4352320">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352324">hash</span><span class="op" id="4352328">.</span><span class="ident" id="4352329">Write</span><span class="op" id="4352334">(</span><span class="ident" id="4352335">password</span><span class="op" id="4352343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352347">hash</span><span class="op" id="4352351">.</span><span class="ident" id="4352352">Write</span><span class="op" id="4352357">(</span><span class="ident" id="4352358">salt</span><span class="op" id="4352362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352366">digest</span>&nbsp;<span class="op" id="4352373">=</span>&nbsp;<span class="ident" id="4352375">hash</span><span class="op" id="4352379">.</span><span class="ident" id="4352380">Sum</span><span class="op" id="4352383">(</span><span class="ident" id="4352384">digest</span><span class="op" id="4352390">[</span><span class="op" id="4352391">:</span><span class="num" id="4352392">0</span><span class="op" id="4352393">]</span><span class="op" id="4352394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4352398">copy</span><span class="op" id="4352402">(</span><span class="ident" id="4352403">out</span><span class="op" id="4352406">[</span><span class="ident" id="4352407">i</span><span class="op" id="4352408">:</span><span class="op" id="4352409">]</span><span class="op" id="4352410">,</span>&nbsp;<span class="ident" id="4352412">digest</span><span class="op" id="4352418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4352421">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352424">return</span>&nbsp;<span class="ident" id="4352431">out</span><br>
<span class="lineno"></span><span class="op" id="4352435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4352438">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4352509">func</span>&nbsp;<span class="ident" id="4352514">IsEncryptedPEMBlock</span><span class="op" id="4352533">(</span><span class="ident" id="4352534">b</span>&nbsp;<span class="op" id="4352536">*</span><span class="ident" id="4352537">pem</span><span class="op" id="4352540">.</span><span class="ident" id="4352541">Block</span><span class="op" id="4352546">)</span>&nbsp;<span class="builtintype" id="4352548">bool</span>&nbsp;<span class="op" id="4352553">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352556">_</span><span class="op" id="4352557">,</span>&nbsp;<span class="ident" id="4352559">ok</span>&nbsp;<span class="op" id="4352562">:=</span>&nbsp;<span class="ident" id="4352565">b</span><span class="op" id="4352566">.</span><span class="ident" id="4352567">Headers</span><span class="op" id="4352574">[</span><span class="string" id="4352575">&#34;DEK-Info&#34;</span><span class="op" id="4352585">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352588">return</span>&nbsp;<span class="ident" id="4352595">ok</span><br>
<span class="lineno"></span><span class="op" id="4352598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4352601">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4352679">var</span>&nbsp;<span class="ident" id="4352683">IncorrectPasswordError</span>&nbsp;<span class="op" id="4352706">=</span>&nbsp;<span class="ident" id="4352708">errors</span><span class="op" id="4352714">.</span><span class="ident" id="4352715">New</span><span class="op" id="4352718">(</span><span class="string" id="4352719">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4352756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4352759">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4352840">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4352918">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4352995">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4353073">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4353127">func</span>&nbsp;<span class="ident" id="4353132">DecryptPEMBlock</span><span class="op" id="4353147">(</span><span class="ident" id="4353148">b</span>&nbsp;<span class="op" id="4353150">*</span><span class="ident" id="4353151">pem</span><span class="op" id="4353154">.</span><span class="ident" id="4353155">Block</span><span class="op" id="4353160">,</span>&nbsp;<span class="ident" id="4353162">password</span>&nbsp;<span class="op" id="4353171">[</span><span class="op" id="4353172">]</span><span class="builtintype" id="4353173">byte</span><span class="op" id="4353177">)</span>&nbsp;<span class="op" id="4353179">(</span><span class="op" id="4353180">[</span><span class="op" id="4353181">]</span><span class="builtintype" id="4353182">byte</span><span class="op" id="4353186">,</span>&nbsp;<span class="builtintype" id="4353188">error</span><span class="op" id="4353193">)</span>&nbsp;<span class="op" id="4353195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353198">dek</span><span class="op" id="4353201">,</span>&nbsp;<span class="ident" id="4353203">ok</span>&nbsp;<span class="op" id="4353206">:=</span>&nbsp;<span class="ident" id="4353209">b</span><span class="op" id="4353210">.</span><span class="ident" id="4353211">Headers</span><span class="op" id="4353218">[</span><span class="string" id="4353219">&#34;DEK-Info&#34;</span><span class="op" id="4353229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353232">if</span>&nbsp;<span class="op" id="4353235">!</span><span class="ident" id="4353236">ok</span>&nbsp;<span class="op" id="4353239">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353243">return</span>&nbsp;<span class="builtintype" id="4353250">nil</span><span class="op" id="4353253">,</span>&nbsp;<span class="ident" id="4353255">errors</span><span class="op" id="4353261">.</span><span class="ident" id="4353262">New</span><span class="op" id="4353265">(</span><span class="string" id="4353266">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4353301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353308">idx</span>&nbsp;<span class="op" id="4353312">:=</span>&nbsp;<span class="ident" id="4353315">strings</span><span class="op" id="4353322">.</span><span class="ident" id="4353323">Index</span><span class="op" id="4353328">(</span><span class="ident" id="4353329">dek</span><span class="op" id="4353332">,</span>&nbsp;<span class="string" id="4353334">&#34;,&#34;</span><span class="op" id="4353337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353340">if</span>&nbsp;<span class="ident" id="4353343">idx</span>&nbsp;<span class="op" id="4353347">==</span>&nbsp;<span class="op" id="4353350">-</span><span class="num" id="4353351">1</span>&nbsp;<span class="op" id="4353353">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353357">return</span>&nbsp;<span class="builtintype" id="4353364">nil</span><span class="op" id="4353367">,</span>&nbsp;<span class="ident" id="4353369">errors</span><span class="op" id="4353375">.</span><span class="ident" id="4353376">New</span><span class="op" id="4353379">(</span><span class="string" id="4353380">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4353413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353420">mode</span><span class="op" id="4353424">,</span>&nbsp;<span class="ident" id="4353426">hexIV</span>&nbsp;<span class="op" id="4353432">:=</span>&nbsp;<span class="ident" id="4353435">dek</span><span class="op" id="4353438">[</span><span class="op" id="4353439">:</span><span class="ident" id="4353440">idx</span><span class="op" id="4353443">]</span><span class="op" id="4353444">,</span>&nbsp;<span class="ident" id="4353446">dek</span><span class="op" id="4353449">[</span><span class="ident" id="4353450">idx</span><span class="op" id="4353453">+</span><span class="num" id="4353454">1</span><span class="op" id="4353455">:</span><span class="op" id="4353456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353459">ciph</span>&nbsp;<span class="op" id="4353464">:=</span>&nbsp;<span class="ident" id="4353467">cipherByName</span><span class="op" id="4353479">(</span><span class="ident" id="4353480">mode</span><span class="op" id="4353484">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353487">if</span>&nbsp;<span class="ident" id="4353490">ciph</span>&nbsp;<span class="op" id="4353495">==</span>&nbsp;<span class="builtintype" id="4353498">nil</span>&nbsp;<span class="op" id="4353502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353506">return</span>&nbsp;<span class="builtintype" id="4353513">nil</span><span class="op" id="4353516">,</span>&nbsp;<span class="ident" id="4353518">errors</span><span class="op" id="4353524">.</span><span class="ident" id="4353525">New</span><span class="op" id="4353528">(</span><span class="string" id="4353529">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4353560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353566">iv</span><span class="op" id="4353568">,</span>&nbsp;<span class="ident" id="4353570">err</span>&nbsp;<span class="op" id="4353574">:=</span>&nbsp;<span class="ident" id="4353577">hex</span><span class="op" id="4353580">.</span><span class="ident" id="4353581">DecodeString</span><span class="op" id="4353593">(</span><span class="ident" id="4353594">hexIV</span><span class="op" id="4353599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353602">if</span>&nbsp;<span class="ident" id="4353605">err</span>&nbsp;<span class="op" id="4353609">!=</span>&nbsp;<span class="builtintype" id="4353612">nil</span>&nbsp;<span class="op" id="4353616">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353620">return</span>&nbsp;<span class="builtintype" id="4353627">nil</span><span class="op" id="4353630">,</span>&nbsp;<span class="ident" id="4353632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353640">if</span>&nbsp;<span class="builtinfunc" id="4353643">len</span><span class="op" id="4353646">(</span><span class="ident" id="4353647">iv</span><span class="op" id="4353649">)</span>&nbsp;<span class="op" id="4353651">!=</span>&nbsp;<span class="ident" id="4353654">ciph</span><span class="op" id="4353658">.</span><span class="ident" id="4353659">blockSize</span>&nbsp;<span class="op" id="4353669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353673">return</span>&nbsp;<span class="builtintype" id="4353680">nil</span><span class="op" id="4353683">,</span>&nbsp;<span class="ident" id="4353685">errors</span><span class="op" id="4353691">.</span><span class="ident" id="4353692">New</span><span class="op" id="4353695">(</span><span class="string" id="4353696">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4353721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353724">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4353728">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4353799">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353833">key</span>&nbsp;<span class="op" id="4353837">:=</span>&nbsp;<span class="ident" id="4353840">ciph</span><span class="op" id="4353844">.</span><span class="ident" id="4353845">deriveKey</span><span class="op" id="4353854">(</span><span class="ident" id="4353855">password</span><span class="op" id="4353863">,</span>&nbsp;<span class="ident" id="4353865">iv</span><span class="op" id="4353867">[</span><span class="op" id="4353868">:</span><span class="num" id="4353869">8</span><span class="op" id="4353870">]</span><span class="op" id="4353871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353874">block</span><span class="op" id="4353879">,</span>&nbsp;<span class="ident" id="4353881">err</span>&nbsp;<span class="op" id="4353885">:=</span>&nbsp;<span class="ident" id="4353888">ciph</span><span class="op" id="4353892">.</span><span class="ident" id="4353893">cipherFunc</span><span class="op" id="4353903">(</span><span class="ident" id="4353904">key</span><span class="op" id="4353907">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353910">if</span>&nbsp;<span class="ident" id="4353913">err</span>&nbsp;<span class="op" id="4353917">!=</span>&nbsp;<span class="builtintype" id="4353920">nil</span>&nbsp;<span class="op" id="4353924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4353928">return</span>&nbsp;<span class="builtintype" id="4353935">nil</span><span class="op" id="4353938">,</span>&nbsp;<span class="ident" id="4353940">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4353945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353949">data</span>&nbsp;<span class="op" id="4353954">:=</span>&nbsp;<span class="builtinfunc" id="4353957">make</span><span class="op" id="4353961">(</span><span class="op" id="4353962">[</span><span class="op" id="4353963">]</span><span class="builtintype" id="4353964">byte</span><span class="op" id="4353968">,</span>&nbsp;<span class="builtinfunc" id="4353970">len</span><span class="op" id="4353973">(</span><span class="ident" id="4353974">b</span><span class="op" id="4353975">.</span><span class="ident" id="4353976">Bytes</span><span class="op" id="4353981">)</span><span class="op" id="4353982">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4353985">dec</span>&nbsp;<span class="op" id="4353989">:=</span>&nbsp;<span class="ident" id="4353992">cipher</span><span class="op" id="4353998">.</span><span class="ident" id="4353999">NewCBCDecrypter</span><span class="op" id="4354014">(</span><span class="ident" id="4354015">block</span><span class="op" id="4354020">,</span>&nbsp;<span class="ident" id="4354022">iv</span><span class="op" id="4354024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354027">dec</span><span class="op" id="4354030">.</span><span class="ident" id="4354031">CryptBlocks</span><span class="op" id="4354042">(</span><span class="ident" id="4354043">data</span><span class="op" id="4354047">,</span>&nbsp;<span class="ident" id="4354049">b</span><span class="op" id="4354050">.</span><span class="ident" id="4354051">Bytes</span><span class="op" id="4354056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354060">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354139">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354217">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354234">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354250">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354274">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354343">dlen</span>&nbsp;<span class="op" id="4354348">:=</span>&nbsp;<span class="builtinfunc" id="4354351">len</span><span class="op" id="4354354">(</span><span class="ident" id="4354355">data</span><span class="op" id="4354359">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354362">if</span>&nbsp;<span class="ident" id="4354365">dlen</span>&nbsp;<span class="op" id="4354370">==</span>&nbsp;<span class="num" id="4354373">0</span>&nbsp;<span class="op" id="4354375">||</span>&nbsp;<span class="ident" id="4354378">dlen</span><span class="op" id="4354382">%</span><span class="ident" id="4354383">ciph</span><span class="op" id="4354387">.</span><span class="ident" id="4354388">blockSize</span>&nbsp;<span class="op" id="4354398">!=</span>&nbsp;<span class="num" id="4354401">0</span>&nbsp;<span class="op" id="4354403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354407">return</span>&nbsp;<span class="builtintype" id="4354414">nil</span><span class="op" id="4354417">,</span>&nbsp;<span class="ident" id="4354419">errors</span><span class="op" id="4354425">.</span><span class="ident" id="4354426">New</span><span class="op" id="4354429">(</span><span class="string" id="4354430">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4354453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354459">last</span>&nbsp;<span class="op" id="4354464">:=</span>&nbsp;<span class="builtintype" id="4354467">int</span><span class="op" id="4354470">(</span><span class="ident" id="4354471">data</span><span class="op" id="4354475">[</span><span class="ident" id="4354476">dlen</span><span class="op" id="4354480">-</span><span class="num" id="4354481">1</span><span class="op" id="4354482">]</span><span class="op" id="4354483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354486">if</span>&nbsp;<span class="ident" id="4354489">dlen</span>&nbsp;<span class="op" id="4354494">&lt;</span>&nbsp;<span class="ident" id="4354496">last</span>&nbsp;<span class="op" id="4354501">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354505">return</span>&nbsp;<span class="builtintype" id="4354512">nil</span><span class="op" id="4354515">,</span>&nbsp;<span class="ident" id="4354517">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354544">if</span>&nbsp;<span class="ident" id="4354547">last</span>&nbsp;<span class="op" id="4354552">==</span>&nbsp;<span class="num" id="4354555">0</span>&nbsp;<span class="op" id="4354557">||</span>&nbsp;<span class="ident" id="4354560">last</span>&nbsp;<span class="op" id="4354565">&gt;</span>&nbsp;<span class="ident" id="4354567">ciph</span><span class="op" id="4354571">.</span><span class="ident" id="4354572">blockSize</span>&nbsp;<span class="op" id="4354582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354586">return</span>&nbsp;<span class="builtintype" id="4354593">nil</span><span class="op" id="4354596">,</span>&nbsp;<span class="ident" id="4354598">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354622">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354625">for</span>&nbsp;<span class="ident" id="4354629">_</span><span class="op" id="4354630">,</span>&nbsp;<span class="ident" id="4354632">val</span>&nbsp;<span class="op" id="4354636">:=</span>&nbsp;<span class="keyword" id="4354639">range</span>&nbsp;<span class="ident" id="4354645">data</span><span class="op" id="4354649">[</span><span class="ident" id="4354650">dlen</span><span class="op" id="4354654">-</span><span class="ident" id="4354655">last</span><span class="op" id="4354659">:</span><span class="op" id="4354660">]</span>&nbsp;<span class="op" id="4354662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354666">if</span>&nbsp;<span class="builtintype" id="4354669">int</span><span class="op" id="4354672">(</span><span class="ident" id="4354673">val</span><span class="op" id="4354676">)</span>&nbsp;<span class="op" id="4354678">!=</span>&nbsp;<span class="ident" id="4354681">last</span>&nbsp;<span class="op" id="4354686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354691">return</span>&nbsp;<span class="builtintype" id="4354698">nil</span><span class="op" id="4354701">,</span>&nbsp;<span class="ident" id="4354703">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354731">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354734">return</span>&nbsp;<span class="ident" id="4354741">data</span><span class="op" id="4354745">[</span><span class="op" id="4354746">:</span><span class="ident" id="4354747">dlen</span><span class="op" id="4354751">-</span><span class="ident" id="4354752">last</span><span class="op" id="4354756">]</span><span class="op" id="4354757">,</span>&nbsp;<span class="builtintype" id="4354759">nil</span><br>
<span class="lineno"></span><span class="op" id="4354763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4354766">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4354839">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4354908">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4354921">func</span>&nbsp;<span class="ident" id="4354926">EncryptPEMBlock</span><span class="op" id="4354941">(</span><span class="ident" id="4354942">rand</span>&nbsp;<span class="ident" id="4354947">io</span><span class="op" id="4354949">.</span><span class="ident" id="4354950">Reader</span><span class="op" id="4354956">,</span>&nbsp;<span class="ident" id="4354958">blockType</span>&nbsp;<span class="builtintype" id="4354968">string</span><span class="op" id="4354974">,</span>&nbsp;<span class="ident" id="4354976">data</span><span class="op" id="4354980">,</span>&nbsp;<span class="ident" id="4354982">password</span>&nbsp;<span class="op" id="4354991">[</span><span class="op" id="4354992">]</span><span class="builtintype" id="4354993">byte</span><span class="op" id="4354997">,</span>&nbsp;<span class="ident" id="4354999">alg</span>&nbsp;<span class="ident" id="4355003">PEMCipher</span><span class="op" id="4355012">)</span>&nbsp;<span class="op" id="4355014">(</span><span class="op" id="4355015">*</span><span class="ident" id="4355016">pem</span><span class="op" id="4355019">.</span><span class="ident" id="4355020">Block</span><span class="op" id="4355025">,</span>&nbsp;<span class="builtintype" id="4355027">error</span><span class="op" id="4355032">)</span>&nbsp;<span class="op" id="4355034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355037">ciph</span>&nbsp;<span class="op" id="4355042">:=</span>&nbsp;<span class="ident" id="4355045">cipherByKey</span><span class="op" id="4355056">(</span><span class="ident" id="4355057">alg</span><span class="op" id="4355060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355063">if</span>&nbsp;<span class="ident" id="4355066">ciph</span>&nbsp;<span class="op" id="4355071">==</span>&nbsp;<span class="builtintype" id="4355074">nil</span>&nbsp;<span class="op" id="4355078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355082">return</span>&nbsp;<span class="builtintype" id="4355089">nil</span><span class="op" id="4355092">,</span>&nbsp;<span class="ident" id="4355094">errors</span><span class="op" id="4355100">.</span><span class="ident" id="4355101">New</span><span class="op" id="4355104">(</span><span class="string" id="4355105">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4355136">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355142">iv</span>&nbsp;<span class="op" id="4355145">:=</span>&nbsp;<span class="builtinfunc" id="4355148">make</span><span class="op" id="4355152">(</span><span class="op" id="4355153">[</span><span class="op" id="4355154">]</span><span class="builtintype" id="4355155">byte</span><span class="op" id="4355159">,</span>&nbsp;<span class="ident" id="4355161">ciph</span><span class="op" id="4355165">.</span><span class="ident" id="4355166">blockSize</span><span class="op" id="4355175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355178">if</span>&nbsp;<span class="ident" id="4355181">_</span><span class="op" id="4355182">,</span>&nbsp;<span class="ident" id="4355184">err</span>&nbsp;<span class="op" id="4355188">:=</span>&nbsp;<span class="ident" id="4355191">io</span><span class="op" id="4355193">.</span><span class="ident" id="4355194">ReadFull</span><span class="op" id="4355202">(</span><span class="ident" id="4355203">rand</span><span class="op" id="4355207">,</span>&nbsp;<span class="ident" id="4355209">iv</span><span class="op" id="4355211">)</span><span class="op" id="4355212">;</span>&nbsp;<span class="ident" id="4355214">err</span>&nbsp;<span class="op" id="4355218">!=</span>&nbsp;<span class="builtintype" id="4355221">nil</span>&nbsp;<span class="op" id="4355225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355229">return</span>&nbsp;<span class="builtintype" id="4355236">nil</span><span class="op" id="4355239">,</span>&nbsp;<span class="ident" id="4355241">errors</span><span class="op" id="4355247">.</span><span class="ident" id="4355248">New</span><span class="op" id="4355251">(</span><span class="string" id="4355252">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4355281">+</span>&nbsp;<span class="ident" id="4355283">err</span><span class="op" id="4355286">.</span><span class="ident" id="4355287">Error</span><span class="op" id="4355292">(</span><span class="op" id="4355293">)</span><span class="op" id="4355294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355297">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355300">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355364">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355416">key</span>&nbsp;<span class="op" id="4355420">:=</span>&nbsp;<span class="ident" id="4355423">ciph</span><span class="op" id="4355427">.</span><span class="ident" id="4355428">deriveKey</span><span class="op" id="4355437">(</span><span class="ident" id="4355438">password</span><span class="op" id="4355446">,</span>&nbsp;<span class="ident" id="4355448">iv</span><span class="op" id="4355450">[</span><span class="op" id="4355451">:</span><span class="num" id="4355452">8</span><span class="op" id="4355453">]</span><span class="op" id="4355454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355457">block</span><span class="op" id="4355462">,</span>&nbsp;<span class="ident" id="4355464">err</span>&nbsp;<span class="op" id="4355468">:=</span>&nbsp;<span class="ident" id="4355471">ciph</span><span class="op" id="4355475">.</span><span class="ident" id="4355476">cipherFunc</span><span class="op" id="4355486">(</span><span class="ident" id="4355487">key</span><span class="op" id="4355490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355493">if</span>&nbsp;<span class="ident" id="4355496">err</span>&nbsp;<span class="op" id="4355500">!=</span>&nbsp;<span class="builtintype" id="4355503">nil</span>&nbsp;<span class="op" id="4355507">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355511">return</span>&nbsp;<span class="builtintype" id="4355518">nil</span><span class="op" id="4355521">,</span>&nbsp;<span class="ident" id="4355523">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355531">enc</span>&nbsp;<span class="op" id="4355535">:=</span>&nbsp;<span class="ident" id="4355538">cipher</span><span class="op" id="4355544">.</span><span class="ident" id="4355545">NewCBCEncrypter</span><span class="op" id="4355560">(</span><span class="ident" id="4355561">block</span><span class="op" id="4355566">,</span>&nbsp;<span class="ident" id="4355568">iv</span><span class="op" id="4355570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355573">pad</span>&nbsp;<span class="op" id="4355577">:=</span>&nbsp;<span class="ident" id="4355580">ciph</span><span class="op" id="4355584">.</span><span class="ident" id="4355585">blockSize</span>&nbsp;<span class="op" id="4355595">-</span>&nbsp;<span class="builtinfunc" id="4355597">len</span><span class="op" id="4355600">(</span><span class="ident" id="4355601">data</span><span class="op" id="4355605">)</span><span class="op" id="4355606">%</span><span class="ident" id="4355607">ciph</span><span class="op" id="4355611">.</span><span class="ident" id="4355612">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355623">encrypted</span>&nbsp;<span class="op" id="4355633">:=</span>&nbsp;<span class="builtinfunc" id="4355636">make</span><span class="op" id="4355640">(</span><span class="op" id="4355641">[</span><span class="op" id="4355642">]</span><span class="builtintype" id="4355643">byte</span><span class="op" id="4355647">,</span>&nbsp;<span class="builtinfunc" id="4355649">len</span><span class="op" id="4355652">(</span><span class="ident" id="4355653">data</span><span class="op" id="4355657">)</span><span class="op" id="4355658">,</span>&nbsp;<span class="builtinfunc" id="4355660">len</span><span class="op" id="4355663">(</span><span class="ident" id="4355664">data</span><span class="op" id="4355668">)</span><span class="op" id="4355669">+</span><span class="ident" id="4355670">pad</span><span class="op" id="4355673">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355676">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355742">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355808">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4355818">copy</span><span class="op" id="4355822">(</span><span class="ident" id="4355823">encrypted</span><span class="op" id="4355832">,</span>&nbsp;<span class="ident" id="4355834">data</span><span class="op" id="4355838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355841">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355871">for</span>&nbsp;<span class="ident" id="4355875">i</span>&nbsp;<span class="op" id="4355877">:=</span>&nbsp;<span class="num" id="4355880">0</span><span class="op" id="4355881">;</span>&nbsp;<span class="ident" id="4355883">i</span>&nbsp;<span class="op" id="4355885">&lt;</span>&nbsp;<span class="ident" id="4355887">pad</span><span class="op" id="4355890">;</span>&nbsp;<span class="ident" id="4355892">i</span><span class="op" id="4355893">++</span>&nbsp;<span class="op" id="4355896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355900">encrypted</span>&nbsp;<span class="op" id="4355910">=</span>&nbsp;<span class="builtinfunc" id="4355912">append</span><span class="op" id="4355918">(</span><span class="ident" id="4355919">encrypted</span><span class="op" id="4355928">,</span>&nbsp;<span class="builtintype" id="4355930">byte</span><span class="op" id="4355934">(</span><span class="ident" id="4355935">pad</span><span class="op" id="4355938">)</span><span class="op" id="4355939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355945">enc</span><span class="op" id="4355948">.</span><span class="ident" id="4355949">CryptBlocks</span><span class="op" id="4355960">(</span><span class="ident" id="4355961">encrypted</span><span class="op" id="4355970">,</span>&nbsp;<span class="ident" id="4355972">encrypted</span><span class="op" id="4355981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355985">return</span>&nbsp;<span class="op" id="4355992">&amp;</span><span class="ident" id="4355993">pem</span><span class="op" id="4355996">.</span><span class="ident" id="4355997">Block</span><span class="op" id="4356002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356006">Type</span><span class="op" id="4356010">:</span>&nbsp;<span class="ident" id="4356012">blockType</span><span class="op" id="4356021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356025">Headers</span><span class="op" id="4356032">:</span>&nbsp;<span class="keyword" id="4356034">map</span><span class="op" id="4356037">[</span><span class="builtintype" id="4356038">string</span><span class="op" id="4356044">]</span><span class="builtintype" id="4356045">string</span><span class="op" id="4356051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4356056">&#34;Proc-Type&#34;</span><span class="op" id="4356067">:</span>&nbsp;<span class="string" id="4356069">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4356082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4356087">&#34;DEK-Info&#34;</span><span class="op" id="4356097">:</span>&nbsp;&nbsp;<span class="ident" id="4356100">ciph</span><span class="op" id="4356104">.</span><span class="ident" id="4356105">name</span>&nbsp;<span class="op" id="4356110">+</span>&nbsp;<span class="string" id="4356112">&#34;,&#34;</span>&nbsp;<span class="op" id="4356116">+</span>&nbsp;<span class="ident" id="4356118">hex</span><span class="op" id="4356121">.</span><span class="ident" id="4356122">EncodeToString</span><span class="op" id="4356136">(</span><span class="ident" id="4356137">iv</span><span class="op" id="4356139">)</span><span class="op" id="4356140">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356144">}</span><span class="op" id="4356145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356149">Bytes</span><span class="op" id="4356154">:</span>&nbsp;<span class="ident" id="4356156">encrypted</span><span class="op" id="4356165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356168">}</span><span class="op" id="4356169">,</span>&nbsp;<span class="builtintype" id="4356171">nil</span><br>
<span class="lineno"></span><span class="op" id="4356175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4356178">func</span>&nbsp;<span class="ident" id="4356183">cipherByName</span><span class="op" id="4356195">(</span><span class="ident" id="4356196">name</span>&nbsp;<span class="builtintype" id="4356201">string</span><span class="op" id="4356207">)</span>&nbsp;<span class="op" id="4356209">*</span><span class="ident" id="4356210">rfc1423Algo</span>&nbsp;<span class="op" id="4356222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356225">for</span>&nbsp;<span class="ident" id="4356229">i</span>&nbsp;<span class="op" id="4356231">:=</span>&nbsp;<span class="keyword" id="4356234">range</span>&nbsp;<span class="ident" id="4356240">rfc1423Algos</span>&nbsp;<span class="op" id="4356253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356257">alg</span>&nbsp;<span class="op" id="4356261">:=</span>&nbsp;<span class="op" id="4356264">&amp;</span><span class="ident" id="4356265">rfc1423Algos</span><span class="op" id="4356277">[</span><span class="ident" id="4356278">i</span><span class="op" id="4356279">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356283">if</span>&nbsp;<span class="ident" id="4356286">alg</span><span class="op" id="4356289">.</span><span class="ident" id="4356290">name</span>&nbsp;<span class="op" id="4356295">==</span>&nbsp;<span class="ident" id="4356298">name</span>&nbsp;<span class="op" id="4356303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356308">return</span>&nbsp;<span class="ident" id="4356315">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356327">return</span>&nbsp;<span class="builtintype" id="4356334">nil</span><br>
<span class="lineno"></span><span class="op" id="4356338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4356341">func</span>&nbsp;<span class="ident" id="4356346">cipherByKey</span><span class="op" id="4356357">(</span><span class="ident" id="4356358">key</span>&nbsp;<span class="ident" id="4356362">PEMCipher</span><span class="op" id="4356371">)</span>&nbsp;<span class="op" id="4356373">*</span><span class="ident" id="4356374">rfc1423Algo</span>&nbsp;<span class="op" id="4356386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356389">for</span>&nbsp;<span class="ident" id="4356393">i</span>&nbsp;<span class="op" id="4356395">:=</span>&nbsp;<span class="keyword" id="4356398">range</span>&nbsp;<span class="ident" id="4356404">rfc1423Algos</span>&nbsp;<span class="op" id="4356417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356421">alg</span>&nbsp;<span class="op" id="4356425">:=</span>&nbsp;<span class="op" id="4356428">&amp;</span><span class="ident" id="4356429">rfc1423Algos</span><span class="op" id="4356441">[</span><span class="ident" id="4356442">i</span><span class="op" id="4356443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356447">if</span>&nbsp;<span class="ident" id="4356450">alg</span><span class="op" id="4356453">.</span><span class="ident" id="4356454">cipher</span>&nbsp;<span class="op" id="4356461">==</span>&nbsp;<span class="ident" id="4356464">key</span>&nbsp;<span class="op" id="4356468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356473">return</span>&nbsp;<span class="ident" id="4356480">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356492">return</span>&nbsp;<span class="builtintype" id="4356499">nil</span><br>
<span class="lineno"></span><span class="op" id="4356503">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
