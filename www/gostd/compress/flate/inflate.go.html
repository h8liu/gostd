<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4702193">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4702248">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4702302">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4702353">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702403">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4702480">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4702560">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4702572">package</span>&nbsp;<span class="ident" id="4702580">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702587">import</span>&nbsp;<span class="op" id="4702594">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4702597">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4702606">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4702612">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4702622">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702625">const</span>&nbsp;<span class="op" id="4702631">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702634">maxCodeLen</span>&nbsp;<span class="op" id="4702645">=</span>&nbsp;<span class="num" id="4702647">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4702653">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702684">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4702695">=</span>&nbsp;<span class="num" id="4702697">32768</span>&nbsp;<span class="comment" id="4702703">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4702728">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702789">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4702798">=</span>&nbsp;<span class="num" id="4702800">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702805">maxDist</span>&nbsp;&nbsp;<span class="op" id="4702814">=</span>&nbsp;<span class="num" id="4702816">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702820">numCodes</span>&nbsp;<span class="op" id="4702829">=</span>&nbsp;<span class="num" id="4702831">19</span>&nbsp;<span class="comment" id="4702834">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4702874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702877">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4702957">type</span>&nbsp;<span class="ident" id="4702962">CorruptInputError</span>&nbsp;<span class="builtintype" id="4702980">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4702987">func</span>&nbsp;<span class="op" id="4702992">(</span><span class="ident" id="4702993">e</span>&nbsp;<span class="ident" id="4702995">CorruptInputError</span><span class="op" id="4703012">)</span>&nbsp;<span class="ident" id="4703014">Error</span><span class="op" id="4703019">(</span><span class="op" id="4703020">)</span>&nbsp;<span class="builtintype" id="4703022">string</span>&nbsp;<span class="op" id="4703029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4703032">return</span>&nbsp;<span class="string" id="4703039">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4703077">+</span>&nbsp;<span class="ident" id="4703079">strconv</span><span class="op" id="4703086">.</span><span class="ident" id="4703087">FormatInt</span><span class="op" id="4703096">(</span><span class="builtintype" id="4703097">int64</span><span class="op" id="4703102">(</span><span class="ident" id="4703103">e</span><span class="op" id="4703104">)</span><span class="op" id="4703105">,</span>&nbsp;<span class="num" id="4703107">10</span><span class="op" id="4703109">)</span><br>
<span class="lineno"></span><span class="op" id="4703111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703114">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4703177">type</span>&nbsp;<span class="ident" id="4703182">InternalError</span>&nbsp;<span class="builtintype" id="4703196">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4703204">func</span>&nbsp;<span class="op" id="4703209">(</span><span class="ident" id="4703210">e</span>&nbsp;<span class="ident" id="4703212">InternalError</span><span class="op" id="4703225">)</span>&nbsp;<span class="ident" id="4703227">Error</span><span class="op" id="4703232">(</span><span class="op" id="4703233">)</span>&nbsp;<span class="builtintype" id="4703235">string</span>&nbsp;<span class="op" id="4703242">{</span>&nbsp;<span class="keyword" id="4703244">return</span>&nbsp;<span class="string" id="4703251">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4703277">+</span>&nbsp;<span class="builtintype" id="4703279">string</span><span class="op" id="4703285">(</span><span class="ident" id="4703286">e</span><span class="op" id="4703287">)</span>&nbsp;<span class="op" id="4703289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703292">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4703357">type</span>&nbsp;<span class="ident" id="4703362">ReadError</span>&nbsp;<span class="keyword" id="4703372">struct</span>&nbsp;<span class="op" id="4703379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703382">Offset</span>&nbsp;<span class="builtintype" id="4703389">int64</span>&nbsp;<span class="comment" id="4703395">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703432">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4703439">error</span>&nbsp;<span class="comment" id="4703445">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4703482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4703485">func</span>&nbsp;<span class="op" id="4703490">(</span><span class="ident" id="4703491">e</span>&nbsp;<span class="op" id="4703493">*</span><span class="ident" id="4703494">ReadError</span><span class="op" id="4703503">)</span>&nbsp;<span class="ident" id="4703505">Error</span><span class="op" id="4703510">(</span><span class="op" id="4703511">)</span>&nbsp;<span class="builtintype" id="4703513">string</span>&nbsp;<span class="op" id="4703520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4703523">return</span>&nbsp;<span class="string" id="4703530">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4703561">+</span>&nbsp;<span class="ident" id="4703563">strconv</span><span class="op" id="4703570">.</span><span class="ident" id="4703571">FormatInt</span><span class="op" id="4703580">(</span><span class="ident" id="4703581">e</span><span class="op" id="4703582">.</span><span class="ident" id="4703583">Offset</span><span class="op" id="4703589">,</span>&nbsp;<span class="num" id="4703591">10</span><span class="op" id="4703593">)</span>&nbsp;<span class="op" id="4703595">+</span>&nbsp;<span class="string" id="4703597">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4703602">+</span>&nbsp;<span class="ident" id="4703604">e</span><span class="op" id="4703605">.</span><span class="ident" id="4703606">Err</span><span class="op" id="4703609">.</span><span class="ident" id="4703610">Error</span><span class="op" id="4703615">(</span><span class="op" id="4703616">)</span><br>
<span class="lineno"></span><span class="op" id="4703618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703621">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4703688">type</span>&nbsp;<span class="ident" id="4703693">WriteError</span>&nbsp;<span class="keyword" id="4703704">struct</span>&nbsp;<span class="op" id="4703711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703714">Offset</span>&nbsp;<span class="builtintype" id="4703721">int64</span>&nbsp;<span class="comment" id="4703727">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703764">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4703771">error</span>&nbsp;<span class="comment" id="4703777">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4703815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4703818">func</span>&nbsp;<span class="op" id="4703823">(</span><span class="ident" id="4703824">e</span>&nbsp;<span class="op" id="4703826">*</span><span class="ident" id="4703827">WriteError</span><span class="op" id="4703837">)</span>&nbsp;<span class="ident" id="4703839">Error</span><span class="op" id="4703844">(</span><span class="op" id="4703845">)</span>&nbsp;<span class="builtintype" id="4703847">string</span>&nbsp;<span class="op" id="4703854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4703857">return</span>&nbsp;<span class="string" id="4703864">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4703896">+</span>&nbsp;<span class="ident" id="4703898">strconv</span><span class="op" id="4703905">.</span><span class="ident" id="4703906">FormatInt</span><span class="op" id="4703915">(</span><span class="ident" id="4703916">e</span><span class="op" id="4703917">.</span><span class="ident" id="4703918">Offset</span><span class="op" id="4703924">,</span>&nbsp;<span class="num" id="4703926">10</span><span class="op" id="4703928">)</span>&nbsp;<span class="op" id="4703930">+</span>&nbsp;<span class="string" id="4703932">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4703937">+</span>&nbsp;<span class="ident" id="4703939">e</span><span class="op" id="4703940">.</span><span class="ident" id="4703941">Err</span><span class="op" id="4703944">.</span><span class="ident" id="4703945">Error</span><span class="op" id="4703950">(</span><span class="op" id="4703951">)</span><br>
<span class="lineno"></span><span class="op" id="4703953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703956">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4704030">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4704105">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4704141">type</span>&nbsp;<span class="ident" id="4704146">Resetter</span>&nbsp;<span class="keyword" id="4704155">interface</span>&nbsp;<span class="op" id="4704165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4704168">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4704242">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4704287">Reset</span><span class="op" id="4704292">(</span><span class="ident" id="4704293">r</span>&nbsp;<span class="ident" id="4704295">io</span><span class="op" id="4704297">.</span><span class="ident" id="4704298">Reader</span><span class="op" id="4704304">,</span>&nbsp;<span class="ident" id="4704306">dict</span>&nbsp;<span class="op" id="4704311">[</span><span class="op" id="4704312">]</span><span class="builtintype" id="4704313">byte</span><span class="op" id="4704317">)</span>&nbsp;<span class="builtintype" id="4704319">error</span><br>
<span class="lineno"></span><span class="op" id="4704325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4704328">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4704401">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4704470">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4704531">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4704601">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4704675">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4704745">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4704814">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4704887">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4704959">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4704991">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4705059">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4705131">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4705200">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4705268">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4705288">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4705320">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4705366">const</span>&nbsp;<span class="op" id="4705372">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705375">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4705393">=</span>&nbsp;<span class="num" id="4705395">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705398">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4705416">=</span>&nbsp;<span class="num" id="4705418">1</span>&nbsp;<span class="op" id="4705420">&lt;&lt;</span>&nbsp;<span class="ident" id="4705423">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705441">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4705459">=</span>&nbsp;<span class="num" id="4705461">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705465">huffmanValueShift</span>&nbsp;<span class="op" id="4705483">=</span>&nbsp;<span class="num" id="4705485">4</span><br>
<span class="lineno"></span><span class="op" id="4705487">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4705490">type</span>&nbsp;<span class="ident" id="4705495">huffmanDecoder</span>&nbsp;<span class="keyword" id="4705510">struct</span>&nbsp;<span class="op" id="4705517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705520">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4705529">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705554">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705582">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4705591">[</span><span class="ident" id="4705592">huffmanNumChunks</span><span class="op" id="4705608">]</span><span class="builtintype" id="4705609">uint32</span>&nbsp;<span class="comment" id="4705616">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705646">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4705655">[</span><span class="op" id="4705656">]</span><span class="op" id="4705657">[</span><span class="op" id="4705658">]</span><span class="builtintype" id="4705659">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705680">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4705699">linkMask</span>&nbsp;<span class="builtintype" id="4705708">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705733">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4705769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4705772">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4705838">func</span>&nbsp;<span class="op" id="4705843">(</span><span class="ident" id="4705844">h</span>&nbsp;<span class="op" id="4705846">*</span><span class="ident" id="4705847">huffmanDecoder</span><span class="op" id="4705861">)</span>&nbsp;<span class="ident" id="4705863">init</span><span class="op" id="4705867">(</span><span class="ident" id="4705868">bits</span>&nbsp;<span class="op" id="4705873">[</span><span class="op" id="4705874">]</span><span class="builtintype" id="4705875">int</span><span class="op" id="4705878">)</span>&nbsp;<span class="builtintype" id="4705880">bool</span>&nbsp;<span class="op" id="4705885">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4705888">if</span>&nbsp;<span class="ident" id="4705891">h</span><span class="op" id="4705892">.</span><span class="ident" id="4705893">min</span>&nbsp;<span class="op" id="4705897">!=</span>&nbsp;<span class="num" id="4705900">0</span>&nbsp;<span class="op" id="4705902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4705906">*</span><span class="ident" id="4705907">h</span>&nbsp;<span class="op" id="4705909">=</span>&nbsp;<span class="ident" id="4705911">huffmanDecoder</span><span class="op" id="4705925">{</span><span class="op" id="4705926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4705929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705933">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705975">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706007">var</span>&nbsp;<span class="ident" id="4706011">count</span>&nbsp;<span class="op" id="4706017">[</span><span class="ident" id="4706018">maxCodeLen</span><span class="op" id="4706028">]</span><span class="builtintype" id="4706029">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706034">var</span>&nbsp;<span class="ident" id="4706038">min</span><span class="op" id="4706041">,</span>&nbsp;<span class="ident" id="4706043">max</span>&nbsp;<span class="builtintype" id="4706047">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706052">for</span>&nbsp;<span class="ident" id="4706056">_</span><span class="op" id="4706057">,</span>&nbsp;<span class="ident" id="4706059">n</span>&nbsp;<span class="op" id="4706061">:=</span>&nbsp;<span class="keyword" id="4706064">range</span>&nbsp;<span class="ident" id="4706070">bits</span>&nbsp;<span class="op" id="4706075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706079">if</span>&nbsp;<span class="ident" id="4706082">n</span>&nbsp;<span class="op" id="4706084">==</span>&nbsp;<span class="num" id="4706087">0</span>&nbsp;<span class="op" id="4706089">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706094">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706109">if</span>&nbsp;<span class="ident" id="4706112">min</span>&nbsp;<span class="op" id="4706116">==</span>&nbsp;<span class="num" id="4706119">0</span>&nbsp;<span class="op" id="4706121">||</span>&nbsp;<span class="ident" id="4706124">n</span>&nbsp;<span class="op" id="4706126">&lt;</span>&nbsp;<span class="ident" id="4706128">min</span>&nbsp;<span class="op" id="4706132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706137">min</span>&nbsp;<span class="op" id="4706141">=</span>&nbsp;<span class="ident" id="4706143">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706147">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706151">if</span>&nbsp;<span class="ident" id="4706154">n</span>&nbsp;<span class="op" id="4706156">&gt;</span>&nbsp;<span class="ident" id="4706158">max</span>&nbsp;<span class="op" id="4706162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706167">max</span>&nbsp;<span class="op" id="4706171">=</span>&nbsp;<span class="ident" id="4706173">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706181">count</span><span class="op" id="4706186">[</span><span class="ident" id="4706187">n</span><span class="op" id="4706188">]</span><span class="op" id="4706189">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706193">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706196">if</span>&nbsp;<span class="ident" id="4706199">max</span>&nbsp;<span class="op" id="4706203">==</span>&nbsp;<span class="num" id="4706206">0</span>&nbsp;<span class="op" id="4706208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706212">return</span>&nbsp;<span class="builtintype" id="4706219">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706230">h</span><span class="op" id="4706231">.</span><span class="ident" id="4706232">min</span>&nbsp;<span class="op" id="4706236">=</span>&nbsp;<span class="ident" id="4706238">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706243">var</span>&nbsp;<span class="ident" id="4706247">linkBits</span>&nbsp;<span class="builtintype" id="4706256">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706262">var</span>&nbsp;<span class="ident" id="4706266">numLinks</span>&nbsp;<span class="builtintype" id="4706275">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706280">if</span>&nbsp;<span class="ident" id="4706283">max</span>&nbsp;<span class="op" id="4706287">&gt;</span>&nbsp;<span class="ident" id="4706289">huffmanChunkBits</span>&nbsp;<span class="op" id="4706306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706310">linkBits</span>&nbsp;<span class="op" id="4706319">=</span>&nbsp;<span class="builtintype" id="4706321">uint</span><span class="op" id="4706325">(</span><span class="ident" id="4706326">max</span><span class="op" id="4706329">)</span>&nbsp;<span class="op" id="4706331">-</span>&nbsp;<span class="ident" id="4706333">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706352">numLinks</span>&nbsp;<span class="op" id="4706361">=</span>&nbsp;<span class="num" id="4706363">1</span>&nbsp;<span class="op" id="4706365">&lt;&lt;</span>&nbsp;<span class="ident" id="4706368">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706379">h</span><span class="op" id="4706380">.</span><span class="ident" id="4706381">linkMask</span>&nbsp;<span class="op" id="4706390">=</span>&nbsp;<span class="builtintype" id="4706392">uint32</span><span class="op" id="4706398">(</span><span class="ident" id="4706399">numLinks</span>&nbsp;<span class="op" id="4706408">-</span>&nbsp;<span class="num" id="4706410">1</span><span class="op" id="4706411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706417">code</span>&nbsp;<span class="op" id="4706422">:=</span>&nbsp;<span class="num" id="4706425">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706428">var</span>&nbsp;<span class="ident" id="4706432">nextcode</span>&nbsp;<span class="op" id="4706441">[</span><span class="ident" id="4706442">maxCodeLen</span><span class="op" id="4706452">]</span><span class="builtintype" id="4706453">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706458">for</span>&nbsp;<span class="ident" id="4706462">i</span>&nbsp;<span class="op" id="4706464">:=</span>&nbsp;<span class="ident" id="4706467">min</span><span class="op" id="4706470">;</span>&nbsp;<span class="ident" id="4706472">i</span>&nbsp;<span class="op" id="4706474">&lt;=</span>&nbsp;<span class="ident" id="4706477">max</span><span class="op" id="4706480">;</span>&nbsp;<span class="ident" id="4706482">i</span><span class="op" id="4706483">++</span>&nbsp;<span class="op" id="4706486">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706490">if</span>&nbsp;<span class="ident" id="4706493">i</span>&nbsp;<span class="op" id="4706495">==</span>&nbsp;<span class="ident" id="4706498">huffmanChunkBits</span><span class="op" id="4706514">+</span><span class="num" id="4706515">1</span>&nbsp;<span class="op" id="4706517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4706522">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706547">link</span>&nbsp;<span class="op" id="4706552">:=</span>&nbsp;<span class="ident" id="4706555">code</span>&nbsp;<span class="op" id="4706560">&gt;&gt;</span>&nbsp;<span class="num" id="4706563">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706568">if</span>&nbsp;<span class="ident" id="4706571">huffmanNumChunks</span>&nbsp;<span class="op" id="4706588">&lt;</span>&nbsp;<span class="ident" id="4706590">link</span>&nbsp;<span class="op" id="4706595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706601">return</span>&nbsp;<span class="builtintype" id="4706608">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706622">h</span><span class="op" id="4706623">.</span><span class="ident" id="4706624">links</span>&nbsp;<span class="op" id="4706630">=</span>&nbsp;<span class="builtinfunc" id="4706632">make</span><span class="op" id="4706636">(</span><span class="op" id="4706637">[</span><span class="op" id="4706638">]</span><span class="op" id="4706639">[</span><span class="op" id="4706640">]</span><span class="builtintype" id="4706641">uint32</span><span class="op" id="4706647">,</span>&nbsp;<span class="ident" id="4706649">huffmanNumChunks</span><span class="op" id="4706665">-</span><span class="ident" id="4706666">link</span><span class="op" id="4706670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4706675">for</span>&nbsp;<span class="ident" id="4706679">j</span>&nbsp;<span class="op" id="4706681">:=</span>&nbsp;<span class="builtintype" id="4706684">uint</span><span class="op" id="4706688">(</span><span class="ident" id="4706689">link</span><span class="op" id="4706693">)</span><span class="op" id="4706694">;</span>&nbsp;<span class="ident" id="4706696">j</span>&nbsp;<span class="op" id="4706698">&lt;</span>&nbsp;<span class="ident" id="4706700">huffmanNumChunks</span><span class="op" id="4706716">;</span>&nbsp;<span class="ident" id="4706718">j</span><span class="op" id="4706719">++</span>&nbsp;<span class="op" id="4706722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706728">reverse</span>&nbsp;<span class="op" id="4706736">:=</span>&nbsp;<span class="builtintype" id="4706739">int</span><span class="op" id="4706742">(</span><span class="ident" id="4706743">reverseByte</span><span class="op" id="4706754">[</span><span class="ident" id="4706755">j</span><span class="op" id="4706756">&gt;&gt;</span><span class="num" id="4706758">8</span><span class="op" id="4706759">]</span><span class="op" id="4706760">)</span>&nbsp;<span class="op" id="4706762">|</span>&nbsp;<span class="builtintype" id="4706764">int</span><span class="op" id="4706767">(</span><span class="ident" id="4706768">reverseByte</span><span class="op" id="4706779">[</span><span class="ident" id="4706780">j</span><span class="op" id="4706781">&amp;</span><span class="num" id="4706782">0xff</span><span class="op" id="4706786">]</span><span class="op" id="4706787">)</span><span class="op" id="4706788">&lt;&lt;</span><span class="num" id="4706790">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706796">reverse</span>&nbsp;<span class="op" id="4706804">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4706808">uint</span><span class="op" id="4706812">(</span><span class="num" id="4706813">16</span>&nbsp;<span class="op" id="4706816">-</span>&nbsp;<span class="ident" id="4706818">huffmanChunkBits</span><span class="op" id="4706834">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706840">off</span>&nbsp;<span class="op" id="4706844">:=</span>&nbsp;<span class="ident" id="4706847">j</span>&nbsp;<span class="op" id="4706849">-</span>&nbsp;<span class="builtintype" id="4706851">uint</span><span class="op" id="4706855">(</span><span class="ident" id="4706856">link</span><span class="op" id="4706860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706866">h</span><span class="op" id="4706867">.</span><span class="ident" id="4706868">chunks</span><span class="op" id="4706874">[</span><span class="ident" id="4706875">reverse</span><span class="op" id="4706882">]</span>&nbsp;<span class="op" id="4706884">=</span>&nbsp;<span class="builtintype" id="4706886">uint32</span><span class="op" id="4706892">(</span><span class="ident" id="4706893">off</span><span class="op" id="4706896">&lt;&lt;</span><span class="ident" id="4706898">huffmanValueShift</span>&nbsp;<span class="op" id="4706916">+</span>&nbsp;<span class="builtintype" id="4706918">uint</span><span class="op" id="4706922">(</span><span class="ident" id="4706923">i</span><span class="op" id="4706924">)</span><span class="op" id="4706925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706931">h</span><span class="op" id="4706932">.</span><span class="ident" id="4706933">links</span><span class="op" id="4706938">[</span><span class="ident" id="4706939">off</span><span class="op" id="4706942">]</span>&nbsp;<span class="op" id="4706944">=</span>&nbsp;<span class="builtinfunc" id="4706946">make</span><span class="op" id="4706950">(</span><span class="op" id="4706951">[</span><span class="op" id="4706952">]</span><span class="builtintype" id="4706953">uint32</span><span class="op" id="4706959">,</span>&nbsp;<span class="num" id="4706961">1</span><span class="op" id="4706962">&lt;&lt;</span><span class="ident" id="4706964">linkBits</span><span class="op" id="4706972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4706981">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4706985">n</span>&nbsp;<span class="op" id="4706987">:=</span>&nbsp;<span class="ident" id="4706990">count</span><span class="op" id="4706995">[</span><span class="ident" id="4706996">i</span><span class="op" id="4706997">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707001">nextcode</span><span class="op" id="4707009">[</span><span class="ident" id="4707010">i</span><span class="op" id="4707011">]</span>&nbsp;<span class="op" id="4707013">=</span>&nbsp;<span class="ident" id="4707015">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707022">code</span>&nbsp;<span class="op" id="4707027">+=</span>&nbsp;<span class="ident" id="4707030">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707034">code</span>&nbsp;<span class="op" id="4707039">&lt;&lt;=</span>&nbsp;<span class="num" id="4707043">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707046">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707050">for</span>&nbsp;<span class="ident" id="4707054">i</span><span class="op" id="4707055">,</span>&nbsp;<span class="ident" id="4707057">n</span>&nbsp;<span class="op" id="4707059">:=</span>&nbsp;<span class="keyword" id="4707062">range</span>&nbsp;<span class="ident" id="4707068">bits</span>&nbsp;<span class="op" id="4707073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707077">if</span>&nbsp;<span class="ident" id="4707080">n</span>&nbsp;<span class="op" id="4707082">==</span>&nbsp;<span class="num" id="4707085">0</span>&nbsp;<span class="op" id="4707087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707103">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707107">code</span>&nbsp;<span class="op" id="4707112">:=</span>&nbsp;<span class="ident" id="4707115">nextcode</span><span class="op" id="4707123">[</span><span class="ident" id="4707124">n</span><span class="op" id="4707125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707129">nextcode</span><span class="op" id="4707137">[</span><span class="ident" id="4707138">n</span><span class="op" id="4707139">]</span><span class="op" id="4707140">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707145">chunk</span>&nbsp;<span class="op" id="4707151">:=</span>&nbsp;<span class="builtintype" id="4707154">uint32</span><span class="op" id="4707160">(</span><span class="ident" id="4707161">i</span><span class="op" id="4707162">&lt;&lt;</span><span class="ident" id="4707164">huffmanValueShift</span>&nbsp;<span class="op" id="4707182">|</span>&nbsp;<span class="ident" id="4707184">n</span><span class="op" id="4707185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707189">reverse</span>&nbsp;<span class="op" id="4707197">:=</span>&nbsp;<span class="builtintype" id="4707200">int</span><span class="op" id="4707203">(</span><span class="ident" id="4707204">reverseByte</span><span class="op" id="4707215">[</span><span class="ident" id="4707216">code</span><span class="op" id="4707220">&gt;&gt;</span><span class="num" id="4707222">8</span><span class="op" id="4707223">]</span><span class="op" id="4707224">)</span>&nbsp;<span class="op" id="4707226">|</span>&nbsp;<span class="builtintype" id="4707228">int</span><span class="op" id="4707231">(</span><span class="ident" id="4707232">reverseByte</span><span class="op" id="4707243">[</span><span class="ident" id="4707244">code</span><span class="op" id="4707248">&amp;</span><span class="num" id="4707249">0xff</span><span class="op" id="4707253">]</span><span class="op" id="4707254">)</span><span class="op" id="4707255">&lt;&lt;</span><span class="num" id="4707257">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707261">reverse</span>&nbsp;<span class="op" id="4707269">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4707273">uint</span><span class="op" id="4707277">(</span><span class="num" id="4707278">16</span>&nbsp;<span class="op" id="4707281">-</span>&nbsp;<span class="ident" id="4707283">n</span><span class="op" id="4707284">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707288">if</span>&nbsp;<span class="ident" id="4707291">n</span>&nbsp;<span class="op" id="4707293">&lt;=</span>&nbsp;<span class="ident" id="4707296">huffmanChunkBits</span>&nbsp;<span class="op" id="4707313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707318">for</span>&nbsp;<span class="ident" id="4707322">off</span>&nbsp;<span class="op" id="4707326">:=</span>&nbsp;<span class="ident" id="4707329">reverse</span><span class="op" id="4707336">;</span>&nbsp;<span class="ident" id="4707338">off</span>&nbsp;<span class="op" id="4707342">&lt;</span>&nbsp;<span class="ident" id="4707344">huffmanNumChunks</span><span class="op" id="4707360">;</span>&nbsp;<span class="ident" id="4707362">off</span>&nbsp;<span class="op" id="4707366">+=</span>&nbsp;<span class="num" id="4707369">1</span>&nbsp;<span class="op" id="4707371">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4707374">uint</span><span class="op" id="4707378">(</span><span class="ident" id="4707379">n</span><span class="op" id="4707380">)</span>&nbsp;<span class="op" id="4707382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707388">h</span><span class="op" id="4707389">.</span><span class="ident" id="4707390">chunks</span><span class="op" id="4707396">[</span><span class="ident" id="4707397">off</span><span class="op" id="4707400">]</span>&nbsp;<span class="op" id="4707402">=</span>&nbsp;<span class="ident" id="4707404">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707417">}</span>&nbsp;<span class="keyword" id="4707419">else</span>&nbsp;<span class="op" id="4707424">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707429">value</span>&nbsp;<span class="op" id="4707435">:=</span>&nbsp;<span class="ident" id="4707438">h</span><span class="op" id="4707439">.</span><span class="ident" id="4707440">chunks</span><span class="op" id="4707446">[</span><span class="ident" id="4707447">reverse</span><span class="op" id="4707454">&amp;</span><span class="op" id="4707455">(</span><span class="ident" id="4707456">huffmanNumChunks</span><span class="op" id="4707472">-</span><span class="num" id="4707473">1</span><span class="op" id="4707474">)</span><span class="op" id="4707475">]</span>&nbsp;<span class="op" id="4707477">&gt;&gt;</span>&nbsp;<span class="ident" id="4707480">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707501">if</span>&nbsp;<span class="ident" id="4707504">value</span>&nbsp;<span class="op" id="4707510">&gt;=</span>&nbsp;<span class="builtintype" id="4707513">uint32</span><span class="op" id="4707519">(</span><span class="builtinfunc" id="4707520">len</span><span class="op" id="4707523">(</span><span class="ident" id="4707524">h</span><span class="op" id="4707525">.</span><span class="ident" id="4707526">links</span><span class="op" id="4707531">)</span><span class="op" id="4707532">)</span>&nbsp;<span class="op" id="4707534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707540">return</span>&nbsp;<span class="builtintype" id="4707547">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707561">linktab</span>&nbsp;<span class="op" id="4707569">:=</span>&nbsp;<span class="ident" id="4707572">h</span><span class="op" id="4707573">.</span><span class="ident" id="4707574">links</span><span class="op" id="4707579">[</span><span class="ident" id="4707580">value</span><span class="op" id="4707585">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707590">reverse</span>&nbsp;<span class="op" id="4707598">&gt;&gt;=</span>&nbsp;<span class="ident" id="4707602">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707622">for</span>&nbsp;<span class="ident" id="4707626">off</span>&nbsp;<span class="op" id="4707630">:=</span>&nbsp;<span class="ident" id="4707633">reverse</span><span class="op" id="4707640">;</span>&nbsp;<span class="ident" id="4707642">off</span>&nbsp;<span class="op" id="4707646">&lt;</span>&nbsp;<span class="ident" id="4707648">numLinks</span><span class="op" id="4707656">;</span>&nbsp;<span class="ident" id="4707658">off</span>&nbsp;<span class="op" id="4707662">+=</span>&nbsp;<span class="num" id="4707665">1</span>&nbsp;<span class="op" id="4707667">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4707670">uint</span><span class="op" id="4707674">(</span><span class="ident" id="4707675">n</span><span class="op" id="4707676">-</span><span class="ident" id="4707677">huffmanChunkBits</span><span class="op" id="4707693">)</span>&nbsp;<span class="op" id="4707695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707701">linktab</span><span class="op" id="4707708">[</span><span class="ident" id="4707709">off</span><span class="op" id="4707712">]</span>&nbsp;<span class="op" id="4707714">=</span>&nbsp;<span class="ident" id="4707716">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707729">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4707732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4707735">return</span>&nbsp;<span class="builtintype" id="4707742">true</span><br>
<span class="lineno"></span><span class="op" id="4707747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4707750">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4707800">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4707859">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4707910">type</span>&nbsp;<span class="ident" id="4707915">Reader</span>&nbsp;<span class="keyword" id="4707922">interface</span>&nbsp;<span class="op" id="4707932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707935">io</span><span class="op" id="4707937">.</span><span class="ident" id="4707938">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4707946">io</span><span class="op" id="4707948">.</span><span class="ident" id="4707949">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4707960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4707963">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4707984">type</span>&nbsp;<span class="ident" id="4707989">decompressor</span>&nbsp;<span class="keyword" id="4708002">struct</span>&nbsp;<span class="op" id="4708009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708012">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708030">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708038">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708046">roffset</span>&nbsp;<span class="builtintype" id="4708054">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708061">woffset</span>&nbsp;<span class="builtintype" id="4708069">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708077">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708106">b</span>&nbsp;&nbsp;<span class="builtintype" id="4708109">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708117">nb</span>&nbsp;<span class="builtintype" id="4708120">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708127">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708178">h1</span><span class="op" id="4708180">,</span>&nbsp;<span class="ident" id="4708182">h2</span>&nbsp;<span class="ident" id="4708185">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708202">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708250">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4708259">*</span><span class="op" id="4708260">[</span><span class="ident" id="4708261">maxLit</span>&nbsp;<span class="op" id="4708268">+</span>&nbsp;<span class="ident" id="4708270">maxDist</span><span class="op" id="4708277">]</span><span class="builtintype" id="4708278">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708283">codebits</span>&nbsp;<span class="op" id="4708292">*</span><span class="op" id="4708293">[</span><span class="ident" id="4708294">numCodes</span><span class="op" id="4708302">]</span><span class="builtintype" id="4708303">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708309">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708337">hist</span>&nbsp;&nbsp;<span class="op" id="4708343">*</span><span class="op" id="4708344">[</span><span class="ident" id="4708345">maxHist</span><span class="op" id="4708352">]</span><span class="builtintype" id="4708353">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708359">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4708365">int</span>&nbsp;&nbsp;<span class="comment" id="4708370">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708408">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4708414">int</span>&nbsp;&nbsp;<span class="comment" id="4708419">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708455">hfull</span>&nbsp;<span class="builtintype" id="4708461">bool</span>&nbsp;<span class="comment" id="4708466">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708503">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708554">buf</span>&nbsp;<span class="op" id="4708558">[</span><span class="num" id="4708559">4</span><span class="op" id="4708560">]</span><span class="builtintype" id="4708561">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708568">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4708604">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708633">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708642">func</span><span class="op" id="4708646">(</span><span class="op" id="4708647">*</span><span class="ident" id="4708648">decompressor</span><span class="op" id="4708660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708663">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4708672">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708678">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4708687">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708694">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4708703">[</span><span class="op" id="4708704">]</span><span class="builtintype" id="4708705">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708711">hl</span><span class="op" id="4708713">,</span>&nbsp;<span class="ident" id="4708715">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4708720">*</span><span class="ident" id="4708721">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708737">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4708746">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708751">copyDist</span>&nbsp;<span class="builtintype" id="4708760">int</span><br>
<span class="lineno"></span><span class="op" id="4708764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4708767">func</span>&nbsp;<span class="op" id="4708772">(</span><span class="ident" id="4708773">f</span>&nbsp;<span class="op" id="4708775">*</span><span class="ident" id="4708776">decompressor</span><span class="op" id="4708788">)</span>&nbsp;<span class="ident" id="4708790">nextBlock</span><span class="op" id="4708799">(</span><span class="op" id="4708800">)</span>&nbsp;<span class="op" id="4708802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708805">if</span>&nbsp;<span class="ident" id="4708808">f</span><span class="op" id="4708809">.</span><span class="ident" id="4708810">final</span>&nbsp;<span class="op" id="4708816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708820">if</span>&nbsp;<span class="ident" id="4708823">f</span><span class="op" id="4708824">.</span><span class="ident" id="4708825">hw</span>&nbsp;<span class="op" id="4708828">!=</span>&nbsp;<span class="ident" id="4708831">f</span><span class="op" id="4708832">.</span><span class="ident" id="4708833">hp</span>&nbsp;<span class="op" id="4708836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708841">f</span><span class="op" id="4708842">.</span><span class="ident" id="4708843">flush</span><span class="op" id="4708848">(</span><span class="op" id="4708849">(</span><span class="op" id="4708850">*</span><span class="ident" id="4708851">decompressor</span><span class="op" id="4708863">)</span><span class="op" id="4708864">.</span><span class="ident" id="4708865">nextBlock</span><span class="op" id="4708874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708879">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4708888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708892">f</span><span class="op" id="4708893">.</span><span class="ident" id="4708894">err</span>&nbsp;<span class="op" id="4708898">=</span>&nbsp;<span class="ident" id="4708900">io</span><span class="op" id="4708902">.</span><span class="ident" id="4708903">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708909">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4708917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708920">for</span>&nbsp;<span class="ident" id="4708924">f</span><span class="op" id="4708925">.</span><span class="ident" id="4708926">nb</span>&nbsp;<span class="op" id="4708929">&lt;</span>&nbsp;<span class="num" id="4708931">1</span><span class="op" id="4708932">+</span><span class="num" id="4708933">2</span>&nbsp;<span class="op" id="4708935">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708939">if</span>&nbsp;<span class="ident" id="4708942">f</span><span class="op" id="4708943">.</span><span class="ident" id="4708944">err</span>&nbsp;<span class="op" id="4708948">=</span>&nbsp;<span class="ident" id="4708950">f</span><span class="op" id="4708951">.</span><span class="ident" id="4708952">moreBits</span><span class="op" id="4708960">(</span><span class="op" id="4708961">)</span><span class="op" id="4708962">;</span>&nbsp;<span class="ident" id="4708964">f</span><span class="op" id="4708965">.</span><span class="ident" id="4708966">err</span>&nbsp;<span class="op" id="4708970">!=</span>&nbsp;<span class="builtintype" id="4708973">nil</span>&nbsp;<span class="op" id="4708977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4708982">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4708991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4708994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4708997">f</span><span class="op" id="4708998">.</span><span class="ident" id="4708999">final</span>&nbsp;<span class="op" id="4709005">=</span>&nbsp;<span class="ident" id="4709007">f</span><span class="op" id="4709008">.</span><span class="ident" id="4709009">b</span><span class="op" id="4709010">&amp;</span><span class="num" id="4709011">1</span>&nbsp;<span class="op" id="4709013">==</span>&nbsp;<span class="num" id="4709016">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709019">f</span><span class="op" id="4709020">.</span><span class="ident" id="4709021">b</span>&nbsp;<span class="op" id="4709023">&gt;&gt;=</span>&nbsp;<span class="num" id="4709027">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709030">typ</span>&nbsp;<span class="op" id="4709034">:=</span>&nbsp;<span class="ident" id="4709037">f</span><span class="op" id="4709038">.</span><span class="ident" id="4709039">b</span>&nbsp;<span class="op" id="4709041">&amp;</span>&nbsp;<span class="num" id="4709043">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709046">f</span><span class="op" id="4709047">.</span><span class="ident" id="4709048">b</span>&nbsp;<span class="op" id="4709050">&gt;&gt;=</span>&nbsp;<span class="num" id="4709054">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709057">f</span><span class="op" id="4709058">.</span><span class="ident" id="4709059">nb</span>&nbsp;<span class="op" id="4709062">-=</span>&nbsp;<span class="num" id="4709065">1</span>&nbsp;<span class="op" id="4709067">+</span>&nbsp;<span class="num" id="4709069">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709072">switch</span>&nbsp;<span class="ident" id="4709079">typ</span>&nbsp;<span class="op" id="4709083">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709086">case</span>&nbsp;<span class="num" id="4709091">0</span><span class="op" id="4709092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709096">f</span><span class="op" id="4709097">.</span><span class="ident" id="4709098">dataBlock</span><span class="op" id="4709107">(</span><span class="op" id="4709108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709111">case</span>&nbsp;<span class="num" id="4709116">1</span><span class="op" id="4709117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4709121">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709159">f</span><span class="op" id="4709160">.</span><span class="ident" id="4709161">hl</span>&nbsp;<span class="op" id="4709164">=</span>&nbsp;<span class="op" id="4709166">&amp;</span><span class="ident" id="4709167">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709189">f</span><span class="op" id="4709190">.</span><span class="ident" id="4709191">hd</span>&nbsp;<span class="op" id="4709194">=</span>&nbsp;<span class="builtintype" id="4709196">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709202">f</span><span class="op" id="4709203">.</span><span class="ident" id="4709204">huffmanBlock</span><span class="op" id="4709216">(</span><span class="op" id="4709217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709220">case</span>&nbsp;<span class="num" id="4709225">2</span><span class="op" id="4709226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4709230">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709270">if</span>&nbsp;<span class="ident" id="4709273">f</span><span class="op" id="4709274">.</span><span class="ident" id="4709275">err</span>&nbsp;<span class="op" id="4709279">=</span>&nbsp;<span class="ident" id="4709281">f</span><span class="op" id="4709282">.</span><span class="ident" id="4709283">readHuffman</span><span class="op" id="4709294">(</span><span class="op" id="4709295">)</span><span class="op" id="4709296">;</span>&nbsp;<span class="ident" id="4709298">f</span><span class="op" id="4709299">.</span><span class="ident" id="4709300">err</span>&nbsp;<span class="op" id="4709304">!=</span>&nbsp;<span class="builtintype" id="4709307">nil</span>&nbsp;<span class="op" id="4709311">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709316">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709328">f</span><span class="op" id="4709329">.</span><span class="ident" id="4709330">hl</span>&nbsp;<span class="op" id="4709333">=</span>&nbsp;<span class="op" id="4709335">&amp;</span><span class="ident" id="4709336">f</span><span class="op" id="4709337">.</span><span class="ident" id="4709338">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709343">f</span><span class="op" id="4709344">.</span><span class="ident" id="4709345">hd</span>&nbsp;<span class="op" id="4709348">=</span>&nbsp;<span class="op" id="4709350">&amp;</span><span class="ident" id="4709351">f</span><span class="op" id="4709352">.</span><span class="ident" id="4709353">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709358">f</span><span class="op" id="4709359">.</span><span class="ident" id="4709360">huffmanBlock</span><span class="op" id="4709372">(</span><span class="op" id="4709373">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709376">default</span><span class="op" id="4709383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4709387">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709407">f</span><span class="op" id="4709408">.</span><span class="ident" id="4709409">err</span>&nbsp;<span class="op" id="4709413">=</span>&nbsp;<span class="ident" id="4709415">CorruptInputError</span><span class="op" id="4709432">(</span><span class="ident" id="4709433">f</span><span class="op" id="4709434">.</span><span class="ident" id="4709435">roffset</span><span class="op" id="4709442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709445">}</span><br>
<span class="lineno"></span><span class="op" id="4709447">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4709450">func</span>&nbsp;<span class="op" id="4709455">(</span><span class="ident" id="4709456">f</span>&nbsp;<span class="op" id="4709458">*</span><span class="ident" id="4709459">decompressor</span><span class="op" id="4709471">)</span>&nbsp;<span class="ident" id="4709473">Read</span><span class="op" id="4709477">(</span><span class="ident" id="4709478">b</span>&nbsp;<span class="op" id="4709480">[</span><span class="op" id="4709481">]</span><span class="builtintype" id="4709482">byte</span><span class="op" id="4709486">)</span>&nbsp;<span class="op" id="4709488">(</span><span class="builtintype" id="4709489">int</span><span class="op" id="4709492">,</span>&nbsp;<span class="builtintype" id="4709494">error</span><span class="op" id="4709499">)</span>&nbsp;<span class="op" id="4709501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709504">for</span>&nbsp;<span class="op" id="4709508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709512">if</span>&nbsp;<span class="builtinfunc" id="4709515">len</span><span class="op" id="4709518">(</span><span class="ident" id="4709519">f</span><span class="op" id="4709520">.</span><span class="ident" id="4709521">toRead</span><span class="op" id="4709527">)</span>&nbsp;<span class="op" id="4709529">&gt;</span>&nbsp;<span class="num" id="4709531">0</span>&nbsp;<span class="op" id="4709533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709538">n</span>&nbsp;<span class="op" id="4709540">:=</span>&nbsp;<span class="builtinfunc" id="4709543">copy</span><span class="op" id="4709547">(</span><span class="ident" id="4709548">b</span><span class="op" id="4709549">,</span>&nbsp;<span class="ident" id="4709551">f</span><span class="op" id="4709552">.</span><span class="ident" id="4709553">toRead</span><span class="op" id="4709559">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709564">f</span><span class="op" id="4709565">.</span><span class="ident" id="4709566">toRead</span>&nbsp;<span class="op" id="4709573">=</span>&nbsp;<span class="ident" id="4709575">f</span><span class="op" id="4709576">.</span><span class="ident" id="4709577">toRead</span><span class="op" id="4709583">[</span><span class="ident" id="4709584">n</span><span class="op" id="4709585">:</span><span class="op" id="4709586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709591">return</span>&nbsp;<span class="ident" id="4709598">n</span><span class="op" id="4709599">,</span>&nbsp;<span class="builtintype" id="4709601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709611">if</span>&nbsp;<span class="ident" id="4709614">f</span><span class="op" id="4709615">.</span><span class="ident" id="4709616">err</span>&nbsp;<span class="op" id="4709620">!=</span>&nbsp;<span class="builtintype" id="4709623">nil</span>&nbsp;<span class="op" id="4709627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709632">return</span>&nbsp;<span class="num" id="4709639">0</span><span class="op" id="4709640">,</span>&nbsp;<span class="ident" id="4709642">f</span><span class="op" id="4709643">.</span><span class="ident" id="4709644">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4709654">f</span><span class="op" id="4709655">.</span><span class="ident" id="4709656">step</span><span class="op" id="4709660">(</span><span class="ident" id="4709661">f</span><span class="op" id="4709662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709665">}</span><br>
<span class="lineno"></span><span class="op" id="4709667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4709670">func</span>&nbsp;<span class="op" id="4709675">(</span><span class="ident" id="4709676">f</span>&nbsp;<span class="op" id="4709678">*</span><span class="ident" id="4709679">decompressor</span><span class="op" id="4709691">)</span>&nbsp;<span class="ident" id="4709693">Close</span><span class="op" id="4709698">(</span><span class="op" id="4709699">)</span>&nbsp;<span class="builtintype" id="4709701">error</span>&nbsp;<span class="op" id="4709707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709710">if</span>&nbsp;<span class="ident" id="4709713">f</span><span class="op" id="4709714">.</span><span class="ident" id="4709715">err</span>&nbsp;<span class="op" id="4709719">==</span>&nbsp;<span class="ident" id="4709722">io</span><span class="op" id="4709724">.</span><span class="ident" id="4709725">EOF</span>&nbsp;<span class="op" id="4709729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709733">return</span>&nbsp;<span class="builtintype" id="4709740">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4709745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4709748">return</span>&nbsp;<span class="ident" id="4709755">f</span><span class="op" id="4709756">.</span><span class="ident" id="4709757">err</span><br>
<span class="lineno">295</span><span class="op" id="4709761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4709764">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4709791">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4709834">var</span>&nbsp;<span class="ident" id="4709838">codeOrder</span>&nbsp;<span class="op" id="4709848">=</span>&nbsp;<span class="op" id="4709850">[</span><span class="op" id="4709851">...</span><span class="op" id="4709854">]</span><span class="builtintype" id="4709855">int</span><span class="op" id="4709858">{</span><span class="num" id="4709859">16</span><span class="op" id="4709861">,</span>&nbsp;<span class="num" id="4709863">17</span><span class="op" id="4709865">,</span>&nbsp;<span class="num" id="4709867">18</span><span class="op" id="4709869">,</span>&nbsp;<span class="num" id="4709871">0</span><span class="op" id="4709872">,</span>&nbsp;<span class="num" id="4709874">8</span><span class="op" id="4709875">,</span>&nbsp;<span class="num" id="4709877">7</span><span class="op" id="4709878">,</span>&nbsp;<span class="num" id="4709880">9</span><span class="op" id="4709881">,</span>&nbsp;<span class="num" id="4709883">6</span><span class="op" id="4709884">,</span>&nbsp;<span class="num" id="4709886">10</span><span class="op" id="4709888">,</span>&nbsp;<span class="num" id="4709890">5</span><span class="op" id="4709891">,</span>&nbsp;<span class="num" id="4709893">11</span><span class="op" id="4709895">,</span>&nbsp;<span class="num" id="4709897">4</span><span class="op" id="4709898">,</span>&nbsp;<span class="num" id="4709900">12</span><span class="op" id="4709902">,</span>&nbsp;<span class="num" id="4709904">3</span><span class="op" id="4709905">,</span>&nbsp;<span class="num" id="4709907">13</span><span class="op" id="4709909">,</span>&nbsp;<span class="num" id="4709911">2</span><span class="op" id="4709912">,</span>&nbsp;<span class="num" id="4709914">14</span><span class="op" id="4709916">,</span>&nbsp;<span class="num" id="4709918">1</span><span class="op" id="4709919">,</span>&nbsp;<span class="num" id="4709921">15</span><span class="op" id="4709923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4709926">func</span>&nbsp;<span class="op" id="4709931">(</span><span class="ident" id="4709932">f</span>&nbsp;<span class="op" id="4709934">*</span><span class="ident" id="4709935">decompressor</span><span class="op" id="4709947">)</span>&nbsp;<span class="ident" id="4709949">readHuffman</span><span class="op" id="4709960">(</span><span class="op" id="4709961">)</span>&nbsp;<span class="builtintype" id="4709963">error</span>&nbsp;<span class="op" id="4709969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4709972">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710005">for</span>&nbsp;<span class="ident" id="4710009">f</span><span class="op" id="4710010">.</span><span class="ident" id="4710011">nb</span>&nbsp;<span class="op" id="4710014">&lt;</span>&nbsp;<span class="num" id="4710016">5</span><span class="op" id="4710017">+</span><span class="num" id="4710018">5</span><span class="op" id="4710019">+</span><span class="num" id="4710020">4</span>&nbsp;<span class="op" id="4710022">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710026">if</span>&nbsp;<span class="ident" id="4710029">err</span>&nbsp;<span class="op" id="4710033">:=</span>&nbsp;<span class="ident" id="4710036">f</span><span class="op" id="4710037">.</span><span class="ident" id="4710038">moreBits</span><span class="op" id="4710046">(</span><span class="op" id="4710047">)</span><span class="op" id="4710048">;</span>&nbsp;<span class="ident" id="4710050">err</span>&nbsp;<span class="op" id="4710054">!=</span>&nbsp;<span class="builtintype" id="4710057">nil</span>&nbsp;<span class="op" id="4710061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710066">return</span>&nbsp;<span class="ident" id="4710073">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710085">nlit</span>&nbsp;<span class="op" id="4710090">:=</span>&nbsp;<span class="builtintype" id="4710093">int</span><span class="op" id="4710096">(</span><span class="ident" id="4710097">f</span><span class="op" id="4710098">.</span><span class="ident" id="4710099">b</span><span class="op" id="4710100">&amp;</span><span class="num" id="4710101">0x1F</span><span class="op" id="4710105">)</span>&nbsp;<span class="op" id="4710107">+</span>&nbsp;<span class="num" id="4710109">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710114">if</span>&nbsp;<span class="ident" id="4710117">nlit</span>&nbsp;<span class="op" id="4710122">&gt;</span>&nbsp;<span class="ident" id="4710124">maxLit</span>&nbsp;<span class="op" id="4710131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710135">return</span>&nbsp;<span class="ident" id="4710142">CorruptInputError</span><span class="op" id="4710159">(</span><span class="ident" id="4710160">f</span><span class="op" id="4710161">.</span><span class="ident" id="4710162">roffset</span><span class="op" id="4710169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710175">f</span><span class="op" id="4710176">.</span><span class="ident" id="4710177">b</span>&nbsp;<span class="op" id="4710179">&gt;&gt;=</span>&nbsp;<span class="num" id="4710183">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710186">ndist</span>&nbsp;<span class="op" id="4710192">:=</span>&nbsp;<span class="builtintype" id="4710195">int</span><span class="op" id="4710198">(</span><span class="ident" id="4710199">f</span><span class="op" id="4710200">.</span><span class="ident" id="4710201">b</span><span class="op" id="4710202">&amp;</span><span class="num" id="4710203">0x1F</span><span class="op" id="4710207">)</span>&nbsp;<span class="op" id="4710209">+</span>&nbsp;<span class="num" id="4710211">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710214">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710259">f</span><span class="op" id="4710260">.</span><span class="ident" id="4710261">b</span>&nbsp;<span class="op" id="4710263">&gt;&gt;=</span>&nbsp;<span class="num" id="4710267">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710270">nclen</span>&nbsp;<span class="op" id="4710276">:=</span>&nbsp;<span class="builtintype" id="4710279">int</span><span class="op" id="4710282">(</span><span class="ident" id="4710283">f</span><span class="op" id="4710284">.</span><span class="ident" id="4710285">b</span><span class="op" id="4710286">&amp;</span><span class="num" id="4710287">0xF</span><span class="op" id="4710290">)</span>&nbsp;<span class="op" id="4710292">+</span>&nbsp;<span class="num" id="4710294">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710297">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710343">f</span><span class="op" id="4710344">.</span><span class="ident" id="4710345">b</span>&nbsp;<span class="op" id="4710347">&gt;&gt;=</span>&nbsp;<span class="num" id="4710351">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710354">f</span><span class="op" id="4710355">.</span><span class="ident" id="4710356">nb</span>&nbsp;<span class="op" id="4710359">-=</span>&nbsp;<span class="num" id="4710362">5</span>&nbsp;<span class="op" id="4710364">+</span>&nbsp;<span class="num" id="4710366">5</span>&nbsp;<span class="op" id="4710368">+</span>&nbsp;<span class="num" id="4710370">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710374">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710439">for</span>&nbsp;<span class="ident" id="4710443">i</span>&nbsp;<span class="op" id="4710445">:=</span>&nbsp;<span class="num" id="4710448">0</span><span class="op" id="4710449">;</span>&nbsp;<span class="ident" id="4710451">i</span>&nbsp;<span class="op" id="4710453">&lt;</span>&nbsp;<span class="ident" id="4710455">nclen</span><span class="op" id="4710460">;</span>&nbsp;<span class="ident" id="4710462">i</span><span class="op" id="4710463">++</span>&nbsp;<span class="op" id="4710466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710470">for</span>&nbsp;<span class="ident" id="4710474">f</span><span class="op" id="4710475">.</span><span class="ident" id="4710476">nb</span>&nbsp;<span class="op" id="4710479">&lt;</span>&nbsp;<span class="num" id="4710481">3</span>&nbsp;<span class="op" id="4710483">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710488">if</span>&nbsp;<span class="ident" id="4710491">err</span>&nbsp;<span class="op" id="4710495">:=</span>&nbsp;<span class="ident" id="4710498">f</span><span class="op" id="4710499">.</span><span class="ident" id="4710500">moreBits</span><span class="op" id="4710508">(</span><span class="op" id="4710509">)</span><span class="op" id="4710510">;</span>&nbsp;<span class="ident" id="4710512">err</span>&nbsp;<span class="op" id="4710516">!=</span>&nbsp;<span class="builtintype" id="4710519">nil</span>&nbsp;<span class="op" id="4710523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710529">return</span>&nbsp;<span class="ident" id="4710536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710551">f</span><span class="op" id="4710552">.</span><span class="ident" id="4710553">codebits</span><span class="op" id="4710561">[</span><span class="ident" id="4710562">codeOrder</span><span class="op" id="4710571">[</span><span class="ident" id="4710572">i</span><span class="op" id="4710573">]</span><span class="op" id="4710574">]</span>&nbsp;<span class="op" id="4710576">=</span>&nbsp;<span class="builtintype" id="4710578">int</span><span class="op" id="4710581">(</span><span class="ident" id="4710582">f</span><span class="op" id="4710583">.</span><span class="ident" id="4710584">b</span>&nbsp;<span class="op" id="4710586">&amp;</span>&nbsp;<span class="num" id="4710588">0x7</span><span class="op" id="4710591">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710595">f</span><span class="op" id="4710596">.</span><span class="ident" id="4710597">b</span>&nbsp;<span class="op" id="4710599">&gt;&gt;=</span>&nbsp;<span class="num" id="4710603">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710607">f</span><span class="op" id="4710608">.</span><span class="ident" id="4710609">nb</span>&nbsp;<span class="op" id="4710612">-=</span>&nbsp;<span class="num" id="4710615">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710621">for</span>&nbsp;<span class="ident" id="4710625">i</span>&nbsp;<span class="op" id="4710627">:=</span>&nbsp;<span class="ident" id="4710630">nclen</span><span class="op" id="4710635">;</span>&nbsp;<span class="ident" id="4710637">i</span>&nbsp;<span class="op" id="4710639">&lt;</span>&nbsp;<span class="builtinfunc" id="4710641">len</span><span class="op" id="4710644">(</span><span class="ident" id="4710645">codeOrder</span><span class="op" id="4710654">)</span><span class="op" id="4710655">;</span>&nbsp;<span class="ident" id="4710657">i</span><span class="op" id="4710658">++</span>&nbsp;<span class="op" id="4710661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710665">f</span><span class="op" id="4710666">.</span><span class="ident" id="4710667">codebits</span><span class="op" id="4710675">[</span><span class="ident" id="4710676">codeOrder</span><span class="op" id="4710685">[</span><span class="ident" id="4710686">i</span><span class="op" id="4710687">]</span><span class="op" id="4710688">]</span>&nbsp;<span class="op" id="4710690">=</span>&nbsp;<span class="num" id="4710692">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710698">if</span>&nbsp;<span class="op" id="4710701">!</span><span class="ident" id="4710702">f</span><span class="op" id="4710703">.</span><span class="ident" id="4710704">h1</span><span class="op" id="4710706">.</span><span class="ident" id="4710707">init</span><span class="op" id="4710711">(</span><span class="ident" id="4710712">f</span><span class="op" id="4710713">.</span><span class="ident" id="4710714">codebits</span><span class="op" id="4710722">[</span><span class="num" id="4710723">0</span><span class="op" id="4710724">:</span><span class="op" id="4710725">]</span><span class="op" id="4710726">)</span>&nbsp;<span class="op" id="4710728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710732">return</span>&nbsp;<span class="ident" id="4710739">CorruptInputError</span><span class="op" id="4710756">(</span><span class="ident" id="4710757">f</span><span class="op" id="4710758">.</span><span class="ident" id="4710759">roffset</span><span class="op" id="4710766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710773">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710826">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710866">for</span>&nbsp;<span class="ident" id="4710870">i</span><span class="op" id="4710871">,</span>&nbsp;<span class="ident" id="4710873">n</span>&nbsp;<span class="op" id="4710875">:=</span>&nbsp;<span class="num" id="4710878">0</span><span class="op" id="4710879">,</span>&nbsp;<span class="ident" id="4710881">nlit</span><span class="op" id="4710885">+</span><span class="ident" id="4710886">ndist</span><span class="op" id="4710891">;</span>&nbsp;<span class="ident" id="4710893">i</span>&nbsp;<span class="op" id="4710895">&lt;</span>&nbsp;<span class="ident" id="4710897">n</span><span class="op" id="4710898">;</span>&nbsp;<span class="op" id="4710900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4710904">x</span><span class="op" id="4710905">,</span>&nbsp;<span class="ident" id="4710907">err</span>&nbsp;<span class="op" id="4710911">:=</span>&nbsp;<span class="ident" id="4710914">f</span><span class="op" id="4710915">.</span><span class="ident" id="4710916">huffSym</span><span class="op" id="4710923">(</span><span class="op" id="4710924">&amp;</span><span class="ident" id="4710925">f</span><span class="op" id="4710926">.</span><span class="ident" id="4710927">h1</span><span class="op" id="4710929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710933">if</span>&nbsp;<span class="ident" id="4710936">err</span>&nbsp;<span class="op" id="4710940">!=</span>&nbsp;<span class="builtintype" id="4710943">nil</span>&nbsp;<span class="op" id="4710947">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710952">return</span>&nbsp;<span class="ident" id="4710959">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4710965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4710969">if</span>&nbsp;<span class="ident" id="4710972">x</span>&nbsp;<span class="op" id="4710974">&lt;</span>&nbsp;<span class="num" id="4710976">16</span>&nbsp;<span class="op" id="4710979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4710984">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711005">f</span><span class="op" id="4711006">.</span><span class="ident" id="4711007">bits</span><span class="op" id="4711011">[</span><span class="ident" id="4711012">i</span><span class="op" id="4711013">]</span>&nbsp;<span class="op" id="4711015">=</span>&nbsp;<span class="ident" id="4711017">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711022">i</span><span class="op" id="4711023">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4711044">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711081">var</span>&nbsp;<span class="ident" id="4711085">rep</span>&nbsp;<span class="builtintype" id="4711089">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711095">var</span>&nbsp;<span class="ident" id="4711099">nb</span>&nbsp;<span class="builtintype" id="4711102">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711109">var</span>&nbsp;<span class="ident" id="4711113">b</span>&nbsp;<span class="builtintype" id="4711115">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711121">switch</span>&nbsp;<span class="ident" id="4711128">x</span>&nbsp;<span class="op" id="4711130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711134">default</span><span class="op" id="4711141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711146">return</span>&nbsp;<span class="ident" id="4711153">InternalError</span><span class="op" id="4711166">(</span><span class="string" id="4711167">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4711191">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711195">case</span>&nbsp;<span class="num" id="4711200">16</span><span class="op" id="4711202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711207">rep</span>&nbsp;<span class="op" id="4711211">=</span>&nbsp;<span class="num" id="4711213">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711218">nb</span>&nbsp;<span class="op" id="4711221">=</span>&nbsp;<span class="num" id="4711223">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711228">if</span>&nbsp;<span class="ident" id="4711231">i</span>&nbsp;<span class="op" id="4711233">==</span>&nbsp;<span class="num" id="4711236">0</span>&nbsp;<span class="op" id="4711238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711244">return</span>&nbsp;<span class="ident" id="4711251">CorruptInputError</span><span class="op" id="4711268">(</span><span class="ident" id="4711269">f</span><span class="op" id="4711270">.</span><span class="ident" id="4711271">roffset</span><span class="op" id="4711278">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711288">b</span>&nbsp;<span class="op" id="4711290">=</span>&nbsp;<span class="ident" id="4711292">f</span><span class="op" id="4711293">.</span><span class="ident" id="4711294">bits</span><span class="op" id="4711298">[</span><span class="ident" id="4711299">i</span><span class="op" id="4711300">-</span><span class="num" id="4711301">1</span><span class="op" id="4711302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711306">case</span>&nbsp;<span class="num" id="4711311">17</span><span class="op" id="4711313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711318">rep</span>&nbsp;<span class="op" id="4711322">=</span>&nbsp;<span class="num" id="4711324">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711329">nb</span>&nbsp;<span class="op" id="4711332">=</span>&nbsp;<span class="num" id="4711334">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711339">b</span>&nbsp;<span class="op" id="4711341">=</span>&nbsp;<span class="num" id="4711343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711347">case</span>&nbsp;<span class="num" id="4711352">18</span><span class="op" id="4711354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711359">rep</span>&nbsp;<span class="op" id="4711363">=</span>&nbsp;<span class="num" id="4711365">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711371">nb</span>&nbsp;<span class="op" id="4711374">=</span>&nbsp;<span class="num" id="4711376">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711381">b</span>&nbsp;<span class="op" id="4711383">=</span>&nbsp;<span class="num" id="4711385">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711393">for</span>&nbsp;<span class="ident" id="4711397">f</span><span class="op" id="4711398">.</span><span class="ident" id="4711399">nb</span>&nbsp;<span class="op" id="4711402">&lt;</span>&nbsp;<span class="ident" id="4711404">nb</span>&nbsp;<span class="op" id="4711407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711412">if</span>&nbsp;<span class="ident" id="4711415">err</span>&nbsp;<span class="op" id="4711419">:=</span>&nbsp;<span class="ident" id="4711422">f</span><span class="op" id="4711423">.</span><span class="ident" id="4711424">moreBits</span><span class="op" id="4711432">(</span><span class="op" id="4711433">)</span><span class="op" id="4711434">;</span>&nbsp;<span class="ident" id="4711436">err</span>&nbsp;<span class="op" id="4711440">!=</span>&nbsp;<span class="builtintype" id="4711443">nil</span>&nbsp;<span class="op" id="4711447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711453">return</span>&nbsp;<span class="ident" id="4711460">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711467">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711475">rep</span>&nbsp;<span class="op" id="4711479">+=</span>&nbsp;<span class="builtintype" id="4711482">int</span><span class="op" id="4711485">(</span><span class="ident" id="4711486">f</span><span class="op" id="4711487">.</span><span class="ident" id="4711488">b</span>&nbsp;<span class="op" id="4711490">&amp;</span>&nbsp;<span class="builtintype" id="4711492">uint32</span><span class="op" id="4711498">(</span><span class="num" id="4711499">1</span><span class="op" id="4711500">&lt;&lt;</span><span class="ident" id="4711502">nb</span><span class="op" id="4711504">-</span><span class="num" id="4711505">1</span><span class="op" id="4711506">)</span><span class="op" id="4711507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711511">f</span><span class="op" id="4711512">.</span><span class="ident" id="4711513">b</span>&nbsp;<span class="op" id="4711515">&gt;&gt;=</span>&nbsp;<span class="ident" id="4711519">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711524">f</span><span class="op" id="4711525">.</span><span class="ident" id="4711526">nb</span>&nbsp;<span class="op" id="4711529">-=</span>&nbsp;<span class="ident" id="4711532">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711537">if</span>&nbsp;<span class="ident" id="4711540">i</span><span class="op" id="4711541">+</span><span class="ident" id="4711542">rep</span>&nbsp;<span class="op" id="4711546">&gt;</span>&nbsp;<span class="ident" id="4711548">n</span>&nbsp;<span class="op" id="4711550">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711555">return</span>&nbsp;<span class="ident" id="4711562">CorruptInputError</span><span class="op" id="4711579">(</span><span class="ident" id="4711580">f</span><span class="op" id="4711581">.</span><span class="ident" id="4711582">roffset</span><span class="op" id="4711589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711597">for</span>&nbsp;<span class="ident" id="4711601">j</span>&nbsp;<span class="op" id="4711603">:=</span>&nbsp;<span class="num" id="4711606">0</span><span class="op" id="4711607">;</span>&nbsp;<span class="ident" id="4711609">j</span>&nbsp;<span class="op" id="4711611">&lt;</span>&nbsp;<span class="ident" id="4711613">rep</span><span class="op" id="4711616">;</span>&nbsp;<span class="ident" id="4711618">j</span><span class="op" id="4711619">++</span>&nbsp;<span class="op" id="4711622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711627">f</span><span class="op" id="4711628">.</span><span class="ident" id="4711629">bits</span><span class="op" id="4711633">[</span><span class="ident" id="4711634">i</span><span class="op" id="4711635">]</span>&nbsp;<span class="op" id="4711637">=</span>&nbsp;<span class="ident" id="4711639">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4711644">i</span><span class="op" id="4711645">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711657">if</span>&nbsp;<span class="op" id="4711660">!</span><span class="ident" id="4711661">f</span><span class="op" id="4711662">.</span><span class="ident" id="4711663">h1</span><span class="op" id="4711665">.</span><span class="ident" id="4711666">init</span><span class="op" id="4711670">(</span><span class="ident" id="4711671">f</span><span class="op" id="4711672">.</span><span class="ident" id="4711673">bits</span><span class="op" id="4711677">[</span><span class="num" id="4711678">0</span><span class="op" id="4711679">:</span><span class="ident" id="4711680">nlit</span><span class="op" id="4711684">]</span><span class="op" id="4711685">)</span>&nbsp;<span class="op" id="4711687">||</span>&nbsp;<span class="op" id="4711690">!</span><span class="ident" id="4711691">f</span><span class="op" id="4711692">.</span><span class="ident" id="4711693">h2</span><span class="op" id="4711695">.</span><span class="ident" id="4711696">init</span><span class="op" id="4711700">(</span><span class="ident" id="4711701">f</span><span class="op" id="4711702">.</span><span class="ident" id="4711703">bits</span><span class="op" id="4711707">[</span><span class="ident" id="4711708">nlit</span><span class="op" id="4711712">:</span><span class="ident" id="4711713">nlit</span><span class="op" id="4711717">+</span><span class="ident" id="4711718">ndist</span><span class="op" id="4711723">]</span><span class="op" id="4711724">)</span>&nbsp;<span class="op" id="4711726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711730">return</span>&nbsp;<span class="ident" id="4711737">CorruptInputError</span><span class="op" id="4711754">(</span><span class="ident" id="4711755">f</span><span class="op" id="4711756">.</span><span class="ident" id="4711757">roffset</span><span class="op" id="4711764">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4711767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4711771">return</span>&nbsp;<span class="builtintype" id="4711778">nil</span><br>
<span class="lineno"></span><span class="op" id="4711782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4711785">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4711826">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4711888">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4711955">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4712020">func</span>&nbsp;<span class="op" id="4712025">(</span><span class="ident" id="4712026">f</span>&nbsp;<span class="op" id="4712028">*</span><span class="ident" id="4712029">decompressor</span><span class="op" id="4712041">)</span>&nbsp;<span class="ident" id="4712043">huffmanBlock</span><span class="op" id="4712055">(</span><span class="op" id="4712056">)</span>&nbsp;<span class="op" id="4712058">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712061">for</span>&nbsp;<span class="op" id="4712065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712069">v</span><span class="op" id="4712070">,</span>&nbsp;<span class="ident" id="4712072">err</span>&nbsp;<span class="op" id="4712076">:=</span>&nbsp;<span class="ident" id="4712079">f</span><span class="op" id="4712080">.</span><span class="ident" id="4712081">huffSym</span><span class="op" id="4712088">(</span><span class="ident" id="4712089">f</span><span class="op" id="4712090">.</span><span class="ident" id="4712091">hl</span><span class="op" id="4712093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712097">if</span>&nbsp;<span class="ident" id="4712100">err</span>&nbsp;<span class="op" id="4712104">!=</span>&nbsp;<span class="builtintype" id="4712107">nil</span>&nbsp;<span class="op" id="4712111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712116">f</span><span class="op" id="4712117">.</span><span class="ident" id="4712118">err</span>&nbsp;<span class="op" id="4712122">=</span>&nbsp;<span class="ident" id="4712124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712131">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4712140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712144">var</span>&nbsp;<span class="ident" id="4712148">n</span>&nbsp;<span class="builtintype" id="4712150">uint</span>&nbsp;<span class="comment" id="4712155">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712181">var</span>&nbsp;<span class="ident" id="4712185">length</span>&nbsp;<span class="builtintype" id="4712192">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712198">switch</span>&nbsp;<span class="op" id="4712205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712209">case</span>&nbsp;<span class="ident" id="4712214">v</span>&nbsp;<span class="op" id="4712216">&lt;</span>&nbsp;<span class="num" id="4712218">256</span><span class="op" id="4712221">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712226">f</span><span class="op" id="4712227">.</span><span class="ident" id="4712228">hist</span><span class="op" id="4712232">[</span><span class="ident" id="4712233">f</span><span class="op" id="4712234">.</span><span class="ident" id="4712235">hp</span><span class="op" id="4712237">]</span>&nbsp;<span class="op" id="4712239">=</span>&nbsp;<span class="builtintype" id="4712241">byte</span><span class="op" id="4712245">(</span><span class="ident" id="4712246">v</span><span class="op" id="4712247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712252">f</span><span class="op" id="4712253">.</span><span class="ident" id="4712254">hp</span><span class="op" id="4712256">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712262">if</span>&nbsp;<span class="ident" id="4712265">f</span><span class="op" id="4712266">.</span><span class="ident" id="4712267">hp</span>&nbsp;<span class="op" id="4712270">==</span>&nbsp;<span class="builtinfunc" id="4712273">len</span><span class="op" id="4712276">(</span><span class="ident" id="4712277">f</span><span class="op" id="4712278">.</span><span class="ident" id="4712279">hist</span><span class="op" id="4712283">)</span>&nbsp;<span class="op" id="4712285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4712291">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712335">f</span><span class="op" id="4712336">.</span><span class="ident" id="4712337">flush</span><span class="op" id="4712342">(</span><span class="op" id="4712343">(</span><span class="op" id="4712344">*</span><span class="ident" id="4712345">decompressor</span><span class="op" id="4712357">)</span><span class="op" id="4712358">.</span><span class="ident" id="4712359">huffmanBlock</span><span class="op" id="4712371">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712377">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4712387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712392">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712403">case</span>&nbsp;<span class="ident" id="4712408">v</span>&nbsp;<span class="op" id="4712410">==</span>&nbsp;<span class="num" id="4712413">256</span><span class="op" id="4712416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4712421">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712469">f</span><span class="op" id="4712470">.</span><span class="ident" id="4712471">step</span>&nbsp;<span class="op" id="4712476">=</span>&nbsp;<span class="op" id="4712478">(</span><span class="op" id="4712479">*</span><span class="ident" id="4712480">decompressor</span><span class="op" id="4712492">)</span><span class="op" id="4712493">.</span><span class="ident" id="4712494">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4712516">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712556">case</span>&nbsp;<span class="ident" id="4712561">v</span>&nbsp;<span class="op" id="4712563">&lt;</span>&nbsp;<span class="num" id="4712565">265</span><span class="op" id="4712568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712573">length</span>&nbsp;<span class="op" id="4712580">=</span>&nbsp;<span class="ident" id="4712582">v</span>&nbsp;<span class="op" id="4712584">-</span>&nbsp;<span class="op" id="4712586">(</span><span class="num" id="4712587">257</span>&nbsp;<span class="op" id="4712591">-</span>&nbsp;<span class="num" id="4712593">3</span><span class="op" id="4712594">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712599">n</span>&nbsp;<span class="op" id="4712601">=</span>&nbsp;<span class="num" id="4712603">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712607">case</span>&nbsp;<span class="ident" id="4712612">v</span>&nbsp;<span class="op" id="4712614">&lt;</span>&nbsp;<span class="num" id="4712616">269</span><span class="op" id="4712619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712624">length</span>&nbsp;<span class="op" id="4712631">=</span>&nbsp;<span class="ident" id="4712633">v</span><span class="op" id="4712634">*</span><span class="num" id="4712635">2</span>&nbsp;<span class="op" id="4712637">-</span>&nbsp;<span class="op" id="4712639">(</span><span class="num" id="4712640">265</span><span class="op" id="4712643">*</span><span class="num" id="4712644">2</span>&nbsp;<span class="op" id="4712646">-</span>&nbsp;<span class="num" id="4712648">11</span><span class="op" id="4712650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712655">n</span>&nbsp;<span class="op" id="4712657">=</span>&nbsp;<span class="num" id="4712659">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712663">case</span>&nbsp;<span class="ident" id="4712668">v</span>&nbsp;<span class="op" id="4712670">&lt;</span>&nbsp;<span class="num" id="4712672">273</span><span class="op" id="4712675">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712680">length</span>&nbsp;<span class="op" id="4712687">=</span>&nbsp;<span class="ident" id="4712689">v</span><span class="op" id="4712690">*</span><span class="num" id="4712691">4</span>&nbsp;<span class="op" id="4712693">-</span>&nbsp;<span class="op" id="4712695">(</span><span class="num" id="4712696">269</span><span class="op" id="4712699">*</span><span class="num" id="4712700">4</span>&nbsp;<span class="op" id="4712702">-</span>&nbsp;<span class="num" id="4712704">19</span><span class="op" id="4712706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712711">n</span>&nbsp;<span class="op" id="4712713">=</span>&nbsp;<span class="num" id="4712715">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712719">case</span>&nbsp;<span class="ident" id="4712724">v</span>&nbsp;<span class="op" id="4712726">&lt;</span>&nbsp;<span class="num" id="4712728">277</span><span class="op" id="4712731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712736">length</span>&nbsp;<span class="op" id="4712743">=</span>&nbsp;<span class="ident" id="4712745">v</span><span class="op" id="4712746">*</span><span class="num" id="4712747">8</span>&nbsp;<span class="op" id="4712749">-</span>&nbsp;<span class="op" id="4712751">(</span><span class="num" id="4712752">273</span><span class="op" id="4712755">*</span><span class="num" id="4712756">8</span>&nbsp;<span class="op" id="4712758">-</span>&nbsp;<span class="num" id="4712760">35</span><span class="op" id="4712762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712767">n</span>&nbsp;<span class="op" id="4712769">=</span>&nbsp;<span class="num" id="4712771">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712775">case</span>&nbsp;<span class="ident" id="4712780">v</span>&nbsp;<span class="op" id="4712782">&lt;</span>&nbsp;<span class="num" id="4712784">281</span><span class="op" id="4712787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712792">length</span>&nbsp;<span class="op" id="4712799">=</span>&nbsp;<span class="ident" id="4712801">v</span><span class="op" id="4712802">*</span><span class="num" id="4712803">16</span>&nbsp;<span class="op" id="4712806">-</span>&nbsp;<span class="op" id="4712808">(</span><span class="num" id="4712809">277</span><span class="op" id="4712812">*</span><span class="num" id="4712813">16</span>&nbsp;<span class="op" id="4712816">-</span>&nbsp;<span class="num" id="4712818">67</span><span class="op" id="4712820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712825">n</span>&nbsp;<span class="op" id="4712827">=</span>&nbsp;<span class="num" id="4712829">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712833">case</span>&nbsp;<span class="ident" id="4712838">v</span>&nbsp;<span class="op" id="4712840">&lt;</span>&nbsp;<span class="num" id="4712842">285</span><span class="op" id="4712845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712850">length</span>&nbsp;<span class="op" id="4712857">=</span>&nbsp;<span class="ident" id="4712859">v</span><span class="op" id="4712860">*</span><span class="num" id="4712861">32</span>&nbsp;<span class="op" id="4712864">-</span>&nbsp;<span class="op" id="4712866">(</span><span class="num" id="4712867">281</span><span class="op" id="4712870">*</span><span class="num" id="4712871">32</span>&nbsp;<span class="op" id="4712874">-</span>&nbsp;<span class="num" id="4712876">131</span><span class="op" id="4712879">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712884">n</span>&nbsp;<span class="op" id="4712886">=</span>&nbsp;<span class="num" id="4712888">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712892">default</span><span class="op" id="4712899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712904">length</span>&nbsp;<span class="op" id="4712911">=</span>&nbsp;<span class="num" id="4712913">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4712920">n</span>&nbsp;<span class="op" id="4712922">=</span>&nbsp;<span class="num" id="4712924">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4712928">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712932">if</span>&nbsp;<span class="ident" id="4712935">n</span>&nbsp;<span class="op" id="4712937">&gt;</span>&nbsp;<span class="num" id="4712939">0</span>&nbsp;<span class="op" id="4712941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712946">for</span>&nbsp;<span class="ident" id="4712950">f</span><span class="op" id="4712951">.</span><span class="ident" id="4712952">nb</span>&nbsp;<span class="op" id="4712955">&lt;</span>&nbsp;<span class="ident" id="4712957">n</span>&nbsp;<span class="op" id="4712959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4712965">if</span>&nbsp;<span class="ident" id="4712968">err</span>&nbsp;<span class="op" id="4712972">=</span>&nbsp;<span class="ident" id="4712974">f</span><span class="op" id="4712975">.</span><span class="ident" id="4712976">moreBits</span><span class="op" id="4712984">(</span><span class="op" id="4712985">)</span><span class="op" id="4712986">;</span>&nbsp;<span class="ident" id="4712988">err</span>&nbsp;<span class="op" id="4712992">!=</span>&nbsp;<span class="builtintype" id="4712995">nil</span>&nbsp;<span class="op" id="4712999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713006">f</span><span class="op" id="4713007">.</span><span class="ident" id="4713008">err</span>&nbsp;<span class="op" id="4713012">=</span>&nbsp;<span class="ident" id="4713014">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713023">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713044">length</span>&nbsp;<span class="op" id="4713051">+=</span>&nbsp;<span class="builtintype" id="4713054">int</span><span class="op" id="4713057">(</span><span class="ident" id="4713058">f</span><span class="op" id="4713059">.</span><span class="ident" id="4713060">b</span>&nbsp;<span class="op" id="4713062">&amp;</span>&nbsp;<span class="builtintype" id="4713064">uint32</span><span class="op" id="4713070">(</span><span class="num" id="4713071">1</span><span class="op" id="4713072">&lt;&lt;</span><span class="ident" id="4713074">n</span><span class="op" id="4713075">-</span><span class="num" id="4713076">1</span><span class="op" id="4713077">)</span><span class="op" id="4713078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713083">f</span><span class="op" id="4713084">.</span><span class="ident" id="4713085">b</span>&nbsp;<span class="op" id="4713087">&gt;&gt;=</span>&nbsp;<span class="ident" id="4713091">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713096">f</span><span class="op" id="4713097">.</span><span class="ident" id="4713098">nb</span>&nbsp;<span class="op" id="4713101">-=</span>&nbsp;<span class="ident" id="4713104">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713113">var</span>&nbsp;<span class="ident" id="4713117">dist</span>&nbsp;<span class="builtintype" id="4713122">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713128">if</span>&nbsp;<span class="ident" id="4713131">f</span><span class="op" id="4713132">.</span><span class="ident" id="4713133">hd</span>&nbsp;<span class="op" id="4713136">==</span>&nbsp;<span class="builtintype" id="4713139">nil</span>&nbsp;<span class="op" id="4713143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713148">for</span>&nbsp;<span class="ident" id="4713152">f</span><span class="op" id="4713153">.</span><span class="ident" id="4713154">nb</span>&nbsp;<span class="op" id="4713157">&lt;</span>&nbsp;<span class="num" id="4713159">5</span>&nbsp;<span class="op" id="4713161">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713167">if</span>&nbsp;<span class="ident" id="4713170">err</span>&nbsp;<span class="op" id="4713174">=</span>&nbsp;<span class="ident" id="4713176">f</span><span class="op" id="4713177">.</span><span class="ident" id="4713178">moreBits</span><span class="op" id="4713186">(</span><span class="op" id="4713187">)</span><span class="op" id="4713188">;</span>&nbsp;<span class="ident" id="4713190">err</span>&nbsp;<span class="op" id="4713194">!=</span>&nbsp;<span class="builtintype" id="4713197">nil</span>&nbsp;<span class="op" id="4713201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713208">f</span><span class="op" id="4713209">.</span><span class="ident" id="4713210">err</span>&nbsp;<span class="op" id="4713214">=</span>&nbsp;<span class="ident" id="4713216">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713225">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713241">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713246">dist</span>&nbsp;<span class="op" id="4713251">=</span>&nbsp;<span class="builtintype" id="4713253">int</span><span class="op" id="4713256">(</span><span class="ident" id="4713257">reverseByte</span><span class="op" id="4713268">[</span><span class="op" id="4713269">(</span><span class="ident" id="4713270">f</span><span class="op" id="4713271">.</span><span class="ident" id="4713272">b</span><span class="op" id="4713273">&amp;</span><span class="num" id="4713274">0x1F</span><span class="op" id="4713278">)</span><span class="op" id="4713279">&lt;&lt;</span><span class="num" id="4713281">3</span><span class="op" id="4713282">]</span><span class="op" id="4713283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713288">f</span><span class="op" id="4713289">.</span><span class="ident" id="4713290">b</span>&nbsp;<span class="op" id="4713292">&gt;&gt;=</span>&nbsp;<span class="num" id="4713296">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713301">f</span><span class="op" id="4713302">.</span><span class="ident" id="4713303">nb</span>&nbsp;<span class="op" id="4713306">-=</span>&nbsp;<span class="num" id="4713309">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713313">}</span>&nbsp;<span class="keyword" id="4713315">else</span>&nbsp;<span class="op" id="4713320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713325">if</span>&nbsp;<span class="ident" id="4713328">dist</span><span class="op" id="4713332">,</span>&nbsp;<span class="ident" id="4713334">err</span>&nbsp;<span class="op" id="4713338">=</span>&nbsp;<span class="ident" id="4713340">f</span><span class="op" id="4713341">.</span><span class="ident" id="4713342">huffSym</span><span class="op" id="4713349">(</span><span class="ident" id="4713350">f</span><span class="op" id="4713351">.</span><span class="ident" id="4713352">hd</span><span class="op" id="4713354">)</span><span class="op" id="4713355">;</span>&nbsp;<span class="ident" id="4713357">err</span>&nbsp;<span class="op" id="4713361">!=</span>&nbsp;<span class="builtintype" id="4713364">nil</span>&nbsp;<span class="op" id="4713368">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713374">f</span><span class="op" id="4713375">.</span><span class="ident" id="4713376">err</span>&nbsp;<span class="op" id="4713380">=</span>&nbsp;<span class="ident" id="4713382">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713390">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713409">switch</span>&nbsp;<span class="op" id="4713416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713420">case</span>&nbsp;<span class="ident" id="4713425">dist</span>&nbsp;<span class="op" id="4713430">&lt;</span>&nbsp;<span class="num" id="4713432">4</span><span class="op" id="4713433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713438">dist</span><span class="op" id="4713442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713447">case</span>&nbsp;<span class="ident" id="4713452">dist</span>&nbsp;<span class="op" id="4713457">&gt;=</span>&nbsp;<span class="num" id="4713460">30</span><span class="op" id="4713462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713467">f</span><span class="op" id="4713468">.</span><span class="ident" id="4713469">err</span>&nbsp;<span class="op" id="4713473">=</span>&nbsp;<span class="ident" id="4713475">CorruptInputError</span><span class="op" id="4713492">(</span><span class="ident" id="4713493">f</span><span class="op" id="4713494">.</span><span class="ident" id="4713495">roffset</span><span class="op" id="4713502">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713516">default</span><span class="op" id="4713523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713528">nb</span>&nbsp;<span class="op" id="4713531">:=</span>&nbsp;<span class="builtintype" id="4713534">uint</span><span class="op" id="4713538">(</span><span class="ident" id="4713539">dist</span><span class="op" id="4713543">-</span><span class="num" id="4713544">2</span><span class="op" id="4713545">)</span>&nbsp;<span class="op" id="4713547">&gt;&gt;</span>&nbsp;<span class="num" id="4713550">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4713555">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713605">extra</span>&nbsp;<span class="op" id="4713611">:=</span>&nbsp;<span class="op" id="4713614">(</span><span class="ident" id="4713615">dist</span>&nbsp;<span class="op" id="4713620">&amp;</span>&nbsp;<span class="num" id="4713622">1</span><span class="op" id="4713623">)</span>&nbsp;<span class="op" id="4713625">&lt;&lt;</span>&nbsp;<span class="ident" id="4713628">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713634">for</span>&nbsp;<span class="ident" id="4713638">f</span><span class="op" id="4713639">.</span><span class="ident" id="4713640">nb</span>&nbsp;<span class="op" id="4713643">&lt;</span>&nbsp;<span class="ident" id="4713645">nb</span>&nbsp;<span class="op" id="4713648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713654">if</span>&nbsp;<span class="ident" id="4713657">err</span>&nbsp;<span class="op" id="4713661">=</span>&nbsp;<span class="ident" id="4713663">f</span><span class="op" id="4713664">.</span><span class="ident" id="4713665">moreBits</span><span class="op" id="4713673">(</span><span class="op" id="4713674">)</span><span class="op" id="4713675">;</span>&nbsp;<span class="ident" id="4713677">err</span>&nbsp;<span class="op" id="4713681">!=</span>&nbsp;<span class="builtintype" id="4713684">nil</span>&nbsp;<span class="op" id="4713688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713695">f</span><span class="op" id="4713696">.</span><span class="ident" id="4713697">err</span>&nbsp;<span class="op" id="4713701">=</span>&nbsp;<span class="ident" id="4713703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713723">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713733">extra</span>&nbsp;<span class="op" id="4713739">|=</span>&nbsp;<span class="builtintype" id="4713742">int</span><span class="op" id="4713745">(</span><span class="ident" id="4713746">f</span><span class="op" id="4713747">.</span><span class="ident" id="4713748">b</span>&nbsp;<span class="op" id="4713750">&amp;</span>&nbsp;<span class="builtintype" id="4713752">uint32</span><span class="op" id="4713758">(</span><span class="num" id="4713759">1</span><span class="op" id="4713760">&lt;&lt;</span><span class="ident" id="4713762">nb</span><span class="op" id="4713764">-</span><span class="num" id="4713765">1</span><span class="op" id="4713766">)</span><span class="op" id="4713767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713772">f</span><span class="op" id="4713773">.</span><span class="ident" id="4713774">b</span>&nbsp;<span class="op" id="4713776">&gt;&gt;=</span>&nbsp;<span class="ident" id="4713780">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713786">f</span><span class="op" id="4713787">.</span><span class="ident" id="4713788">nb</span>&nbsp;<span class="op" id="4713791">-=</span>&nbsp;<span class="ident" id="4713794">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713800">dist</span>&nbsp;<span class="op" id="4713805">=</span>&nbsp;<span class="num" id="4713807">1</span><span class="op" id="4713808">&lt;&lt;</span><span class="op" id="4713810">(</span><span class="ident" id="4713811">nb</span><span class="op" id="4713813">+</span><span class="num" id="4713814">1</span><span class="op" id="4713815">)</span>&nbsp;<span class="op" id="4713817">+</span>&nbsp;<span class="num" id="4713819">1</span>&nbsp;<span class="op" id="4713821">+</span>&nbsp;<span class="ident" id="4713823">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4713836">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713887">if</span>&nbsp;<span class="ident" id="4713890">dist</span>&nbsp;<span class="op" id="4713895">&gt;</span>&nbsp;<span class="builtinfunc" id="4713897">len</span><span class="op" id="4713900">(</span><span class="ident" id="4713901">f</span><span class="op" id="4713902">.</span><span class="ident" id="4713903">hist</span><span class="op" id="4713907">)</span>&nbsp;<span class="op" id="4713909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4713914">f</span><span class="op" id="4713915">.</span><span class="ident" id="4713916">err</span>&nbsp;<span class="op" id="4713920">=</span>&nbsp;<span class="ident" id="4713922">InternalError</span><span class="op" id="4713935">(</span><span class="string" id="4713936">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4713958">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4713963">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4713972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4713977">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714029">if</span>&nbsp;<span class="op" id="4714032">!</span><span class="ident" id="4714033">f</span><span class="op" id="4714034">.</span><span class="ident" id="4714035">hfull</span>&nbsp;<span class="op" id="4714041">&amp;&amp;</span>&nbsp;<span class="ident" id="4714044">dist</span>&nbsp;<span class="op" id="4714049">&gt;</span>&nbsp;<span class="ident" id="4714051">f</span><span class="op" id="4714052">.</span><span class="ident" id="4714053">hp</span>&nbsp;<span class="op" id="4714056">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714061">f</span><span class="op" id="4714062">.</span><span class="ident" id="4714063">err</span>&nbsp;<span class="op" id="4714067">=</span>&nbsp;<span class="ident" id="4714069">CorruptInputError</span><span class="op" id="4714086">(</span><span class="ident" id="4714087">f</span><span class="op" id="4714088">.</span><span class="ident" id="4714089">roffset</span><span class="op" id="4714096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714101">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714115">f</span><span class="op" id="4714116">.</span><span class="ident" id="4714117">copyLen</span><span class="op" id="4714124">,</span>&nbsp;<span class="ident" id="4714126">f</span><span class="op" id="4714127">.</span><span class="ident" id="4714128">copyDist</span>&nbsp;<span class="op" id="4714137">=</span>&nbsp;<span class="ident" id="4714139">length</span><span class="op" id="4714145">,</span>&nbsp;<span class="ident" id="4714147">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714154">if</span>&nbsp;<span class="ident" id="4714157">f</span><span class="op" id="4714158">.</span><span class="ident" id="4714159">copyHist</span><span class="op" id="4714167">(</span><span class="op" id="4714168">)</span>&nbsp;<span class="op" id="4714170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714175">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714187">}</span><br>
<span class="lineno"></span><span class="op" id="4714189">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4714192">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4714273">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4714322">func</span>&nbsp;<span class="op" id="4714327">(</span><span class="ident" id="4714328">f</span>&nbsp;<span class="op" id="4714330">*</span><span class="ident" id="4714331">decompressor</span><span class="op" id="4714343">)</span>&nbsp;<span class="ident" id="4714345">copyHist</span><span class="op" id="4714353">(</span><span class="op" id="4714354">)</span>&nbsp;<span class="builtintype" id="4714356">bool</span>&nbsp;<span class="op" id="4714361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714364">p</span>&nbsp;<span class="op" id="4714366">:=</span>&nbsp;<span class="ident" id="4714369">f</span><span class="op" id="4714370">.</span><span class="ident" id="4714371">hp</span>&nbsp;<span class="op" id="4714374">-</span>&nbsp;<span class="ident" id="4714376">f</span><span class="op" id="4714377">.</span><span class="ident" id="4714378">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714388">if</span>&nbsp;<span class="ident" id="4714391">p</span>&nbsp;<span class="op" id="4714393">&lt;</span>&nbsp;<span class="num" id="4714395">0</span>&nbsp;<span class="op" id="4714397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714401">p</span>&nbsp;<span class="op" id="4714403">+=</span>&nbsp;<span class="builtinfunc" id="4714406">len</span><span class="op" id="4714409">(</span><span class="ident" id="4714410">f</span><span class="op" id="4714411">.</span><span class="ident" id="4714412">hist</span><span class="op" id="4714416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714422">for</span>&nbsp;<span class="ident" id="4714426">f</span><span class="op" id="4714427">.</span><span class="ident" id="4714428">copyLen</span>&nbsp;<span class="op" id="4714436">&gt;</span>&nbsp;<span class="num" id="4714438">0</span>&nbsp;<span class="op" id="4714440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714444">n</span>&nbsp;<span class="op" id="4714446">:=</span>&nbsp;<span class="ident" id="4714449">f</span><span class="op" id="4714450">.</span><span class="ident" id="4714451">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714461">if</span>&nbsp;<span class="ident" id="4714464">x</span>&nbsp;<span class="op" id="4714466">:=</span>&nbsp;<span class="builtinfunc" id="4714469">len</span><span class="op" id="4714472">(</span><span class="ident" id="4714473">f</span><span class="op" id="4714474">.</span><span class="ident" id="4714475">hist</span><span class="op" id="4714479">)</span>&nbsp;<span class="op" id="4714481">-</span>&nbsp;<span class="ident" id="4714483">f</span><span class="op" id="4714484">.</span><span class="ident" id="4714485">hp</span><span class="op" id="4714487">;</span>&nbsp;<span class="ident" id="4714489">n</span>&nbsp;<span class="op" id="4714491">&gt;</span>&nbsp;<span class="ident" id="4714493">x</span>&nbsp;<span class="op" id="4714495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714500">n</span>&nbsp;<span class="op" id="4714502">=</span>&nbsp;<span class="ident" id="4714504">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714512">if</span>&nbsp;<span class="ident" id="4714515">x</span>&nbsp;<span class="op" id="4714517">:=</span>&nbsp;<span class="builtinfunc" id="4714520">len</span><span class="op" id="4714523">(</span><span class="ident" id="4714524">f</span><span class="op" id="4714525">.</span><span class="ident" id="4714526">hist</span><span class="op" id="4714530">)</span>&nbsp;<span class="op" id="4714532">-</span>&nbsp;<span class="ident" id="4714534">p</span><span class="op" id="4714535">;</span>&nbsp;<span class="ident" id="4714537">n</span>&nbsp;<span class="op" id="4714539">&gt;</span>&nbsp;<span class="ident" id="4714541">x</span>&nbsp;<span class="op" id="4714543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714548">n</span>&nbsp;<span class="op" id="4714550">=</span>&nbsp;<span class="ident" id="4714552">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714560">forwardCopy</span><span class="op" id="4714571">(</span><span class="ident" id="4714572">f</span><span class="op" id="4714573">.</span><span class="ident" id="4714574">hist</span><span class="op" id="4714578">[</span><span class="op" id="4714579">:</span><span class="op" id="4714580">]</span><span class="op" id="4714581">,</span>&nbsp;<span class="ident" id="4714583">f</span><span class="op" id="4714584">.</span><span class="ident" id="4714585">hp</span><span class="op" id="4714587">,</span>&nbsp;<span class="ident" id="4714589">p</span><span class="op" id="4714590">,</span>&nbsp;<span class="ident" id="4714592">n</span><span class="op" id="4714593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714597">p</span>&nbsp;<span class="op" id="4714599">+=</span>&nbsp;<span class="ident" id="4714602">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714606">f</span><span class="op" id="4714607">.</span><span class="ident" id="4714608">hp</span>&nbsp;<span class="op" id="4714611">+=</span>&nbsp;<span class="ident" id="4714614">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714618">f</span><span class="op" id="4714619">.</span><span class="ident" id="4714620">copyLen</span>&nbsp;<span class="op" id="4714628">-=</span>&nbsp;<span class="ident" id="4714631">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714635">if</span>&nbsp;<span class="ident" id="4714638">f</span><span class="op" id="4714639">.</span><span class="ident" id="4714640">hp</span>&nbsp;<span class="op" id="4714643">==</span>&nbsp;<span class="builtinfunc" id="4714646">len</span><span class="op" id="4714649">(</span><span class="ident" id="4714650">f</span><span class="op" id="4714651">.</span><span class="ident" id="4714652">hist</span><span class="op" id="4714656">)</span>&nbsp;<span class="op" id="4714658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4714663">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714714">f</span><span class="op" id="4714715">.</span><span class="ident" id="4714716">flush</span><span class="op" id="4714721">(</span><span class="op" id="4714722">(</span><span class="op" id="4714723">*</span><span class="ident" id="4714724">decompressor</span><span class="op" id="4714736">)</span><span class="op" id="4714737">.</span><span class="ident" id="4714738">copyHuff</span><span class="op" id="4714746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714751">return</span>&nbsp;<span class="builtintype" id="4714758">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714765">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714769">if</span>&nbsp;<span class="ident" id="4714772">p</span>&nbsp;<span class="op" id="4714774">==</span>&nbsp;<span class="builtinfunc" id="4714777">len</span><span class="op" id="4714780">(</span><span class="ident" id="4714781">f</span><span class="op" id="4714782">.</span><span class="ident" id="4714783">hist</span><span class="op" id="4714787">)</span>&nbsp;<span class="op" id="4714789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714794">p</span>&nbsp;<span class="op" id="4714796">=</span>&nbsp;<span class="num" id="4714798">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714808">return</span>&nbsp;<span class="builtintype" id="4714815">false</span><br>
<span class="lineno">550</span><span class="op" id="4714821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4714824">func</span>&nbsp;<span class="op" id="4714829">(</span><span class="ident" id="4714830">f</span>&nbsp;<span class="op" id="4714832">*</span><span class="ident" id="4714833">decompressor</span><span class="op" id="4714845">)</span>&nbsp;<span class="ident" id="4714847">copyHuff</span><span class="op" id="4714855">(</span><span class="op" id="4714856">)</span>&nbsp;<span class="op" id="4714858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714861">if</span>&nbsp;<span class="ident" id="4714864">f</span><span class="op" id="4714865">.</span><span class="ident" id="4714866">copyHist</span><span class="op" id="4714874">(</span><span class="op" id="4714875">)</span>&nbsp;<span class="op" id="4714877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4714881">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4714889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4714892">f</span><span class="op" id="4714893">.</span><span class="ident" id="4714894">huffmanBlock</span><span class="op" id="4714906">(</span><span class="op" id="4714907">)</span><br>
<span class="lineno"></span><span class="op" id="4714909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4714912">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4714975">func</span>&nbsp;<span class="op" id="4714980">(</span><span class="ident" id="4714981">f</span>&nbsp;<span class="op" id="4714983">*</span><span class="ident" id="4714984">decompressor</span><span class="op" id="4714996">)</span>&nbsp;<span class="ident" id="4714998">dataBlock</span><span class="op" id="4715007">(</span><span class="op" id="4715008">)</span>&nbsp;<span class="op" id="4715010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4715013">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4715031">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715062">f</span><span class="op" id="4715063">.</span><span class="ident" id="4715064">nb</span>&nbsp;<span class="op" id="4715067">=</span>&nbsp;<span class="num" id="4715069">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715072">f</span><span class="op" id="4715073">.</span><span class="ident" id="4715074">b</span>&nbsp;<span class="op" id="4715076">=</span>&nbsp;<span class="num" id="4715078">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4715082">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715125">nr</span><span class="op" id="4715127">,</span>&nbsp;<span class="ident" id="4715129">err</span>&nbsp;<span class="op" id="4715133">:=</span>&nbsp;<span class="ident" id="4715136">io</span><span class="op" id="4715138">.</span><span class="ident" id="4715139">ReadFull</span><span class="op" id="4715147">(</span><span class="ident" id="4715148">f</span><span class="op" id="4715149">.</span><span class="ident" id="4715150">r</span><span class="op" id="4715151">,</span>&nbsp;<span class="ident" id="4715153">f</span><span class="op" id="4715154">.</span><span class="ident" id="4715155">buf</span><span class="op" id="4715158">[</span><span class="num" id="4715159">0</span><span class="op" id="4715160">:</span><span class="num" id="4715161">4</span><span class="op" id="4715162">]</span><span class="op" id="4715163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715166">f</span><span class="op" id="4715167">.</span><span class="ident" id="4715168">roffset</span>&nbsp;<span class="op" id="4715176">+=</span>&nbsp;<span class="builtintype" id="4715179">int64</span><span class="op" id="4715184">(</span><span class="ident" id="4715185">nr</span><span class="op" id="4715187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715190">if</span>&nbsp;<span class="ident" id="4715193">err</span>&nbsp;<span class="op" id="4715197">!=</span>&nbsp;<span class="builtintype" id="4715200">nil</span>&nbsp;<span class="op" id="4715204">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715208">f</span><span class="op" id="4715209">.</span><span class="ident" id="4715210">err</span>&nbsp;<span class="op" id="4715214">=</span>&nbsp;<span class="op" id="4715216">&amp;</span><span class="ident" id="4715217">ReadError</span><span class="op" id="4715226">{</span><span class="ident" id="4715227">f</span><span class="op" id="4715228">.</span><span class="ident" id="4715229">roffset</span><span class="op" id="4715236">,</span>&nbsp;<span class="ident" id="4715238">err</span><span class="op" id="4715241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715245">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4715253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715256">n</span>&nbsp;<span class="op" id="4715258">:=</span>&nbsp;<span class="builtintype" id="4715261">int</span><span class="op" id="4715264">(</span><span class="ident" id="4715265">f</span><span class="op" id="4715266">.</span><span class="ident" id="4715267">buf</span><span class="op" id="4715270">[</span><span class="num" id="4715271">0</span><span class="op" id="4715272">]</span><span class="op" id="4715273">)</span>&nbsp;<span class="op" id="4715275">|</span>&nbsp;<span class="builtintype" id="4715277">int</span><span class="op" id="4715280">(</span><span class="ident" id="4715281">f</span><span class="op" id="4715282">.</span><span class="ident" id="4715283">buf</span><span class="op" id="4715286">[</span><span class="num" id="4715287">1</span><span class="op" id="4715288">]</span><span class="op" id="4715289">)</span><span class="op" id="4715290">&lt;&lt;</span><span class="num" id="4715292">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715295">nn</span>&nbsp;<span class="op" id="4715298">:=</span>&nbsp;<span class="builtintype" id="4715301">int</span><span class="op" id="4715304">(</span><span class="ident" id="4715305">f</span><span class="op" id="4715306">.</span><span class="ident" id="4715307">buf</span><span class="op" id="4715310">[</span><span class="num" id="4715311">2</span><span class="op" id="4715312">]</span><span class="op" id="4715313">)</span>&nbsp;<span class="op" id="4715315">|</span>&nbsp;<span class="builtintype" id="4715317">int</span><span class="op" id="4715320">(</span><span class="ident" id="4715321">f</span><span class="op" id="4715322">.</span><span class="ident" id="4715323">buf</span><span class="op" id="4715326">[</span><span class="num" id="4715327">3</span><span class="op" id="4715328">]</span><span class="op" id="4715329">)</span><span class="op" id="4715330">&lt;&lt;</span><span class="num" id="4715332">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715335">if</span>&nbsp;<span class="builtintype" id="4715338">uint16</span><span class="op" id="4715344">(</span><span class="ident" id="4715345">nn</span><span class="op" id="4715347">)</span>&nbsp;<span class="op" id="4715349">!=</span>&nbsp;<span class="builtintype" id="4715352">uint16</span><span class="op" id="4715358">(</span><span class="op" id="4715359">^</span><span class="ident" id="4715360">n</span><span class="op" id="4715361">)</span>&nbsp;<span class="op" id="4715363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715367">f</span><span class="op" id="4715368">.</span><span class="ident" id="4715369">err</span>&nbsp;<span class="op" id="4715373">=</span>&nbsp;<span class="ident" id="4715375">CorruptInputError</span><span class="op" id="4715392">(</span><span class="ident" id="4715393">f</span><span class="op" id="4715394">.</span><span class="ident" id="4715395">roffset</span><span class="op" id="4715402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715406">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4715414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715418">if</span>&nbsp;<span class="ident" id="4715421">n</span>&nbsp;<span class="op" id="4715423">==</span>&nbsp;<span class="num" id="4715426">0</span>&nbsp;<span class="op" id="4715428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4715432">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715463">f</span><span class="op" id="4715464">.</span><span class="ident" id="4715465">flush</span><span class="op" id="4715470">(</span><span class="op" id="4715471">(</span><span class="op" id="4715472">*</span><span class="ident" id="4715473">decompressor</span><span class="op" id="4715485">)</span><span class="op" id="4715486">.</span><span class="ident" id="4715487">nextBlock</span><span class="op" id="4715496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4715508">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715512">f</span><span class="op" id="4715513">.</span><span class="ident" id="4715514">copyLen</span>&nbsp;<span class="op" id="4715522">=</span>&nbsp;<span class="ident" id="4715524">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715527">f</span><span class="op" id="4715528">.</span><span class="ident" id="4715529">copyData</span><span class="op" id="4715537">(</span><span class="op" id="4715538">)</span><br>
<span class="lineno"></span><span class="op" id="4715540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4715543">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4715618">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4715662">func</span>&nbsp;<span class="op" id="4715667">(</span><span class="ident" id="4715668">f</span>&nbsp;<span class="op" id="4715670">*</span><span class="ident" id="4715671">decompressor</span><span class="op" id="4715683">)</span>&nbsp;<span class="ident" id="4715685">copyData</span><span class="op" id="4715693">(</span><span class="op" id="4715694">)</span>&nbsp;<span class="op" id="4715696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715699">n</span>&nbsp;<span class="op" id="4715701">:=</span>&nbsp;<span class="ident" id="4715704">f</span><span class="op" id="4715705">.</span><span class="ident" id="4715706">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715715">for</span>&nbsp;<span class="ident" id="4715719">n</span>&nbsp;<span class="op" id="4715721">&gt;</span>&nbsp;<span class="num" id="4715723">0</span>&nbsp;<span class="op" id="4715725">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715729">m</span>&nbsp;<span class="op" id="4715731">:=</span>&nbsp;<span class="builtinfunc" id="4715734">len</span><span class="op" id="4715737">(</span><span class="ident" id="4715738">f</span><span class="op" id="4715739">.</span><span class="ident" id="4715740">hist</span><span class="op" id="4715744">)</span>&nbsp;<span class="op" id="4715746">-</span>&nbsp;<span class="ident" id="4715748">f</span><span class="op" id="4715749">.</span><span class="ident" id="4715750">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715755">if</span>&nbsp;<span class="ident" id="4715758">m</span>&nbsp;<span class="op" id="4715760">&gt;</span>&nbsp;<span class="ident" id="4715762">n</span>&nbsp;<span class="op" id="4715764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715769">m</span>&nbsp;<span class="op" id="4715771">=</span>&nbsp;<span class="ident" id="4715773">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4715777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715781">m</span><span class="op" id="4715782">,</span>&nbsp;<span class="ident" id="4715784">err</span>&nbsp;<span class="op" id="4715788">:=</span>&nbsp;<span class="ident" id="4715791">io</span><span class="op" id="4715793">.</span><span class="ident" id="4715794">ReadFull</span><span class="op" id="4715802">(</span><span class="ident" id="4715803">f</span><span class="op" id="4715804">.</span><span class="ident" id="4715805">r</span><span class="op" id="4715806">,</span>&nbsp;<span class="ident" id="4715808">f</span><span class="op" id="4715809">.</span><span class="ident" id="4715810">hist</span><span class="op" id="4715814">[</span><span class="ident" id="4715815">f</span><span class="op" id="4715816">.</span><span class="ident" id="4715817">hp</span><span class="op" id="4715819">:</span><span class="ident" id="4715820">f</span><span class="op" id="4715821">.</span><span class="ident" id="4715822">hp</span><span class="op" id="4715824">+</span><span class="ident" id="4715825">m</span><span class="op" id="4715826">]</span><span class="op" id="4715827">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715831">f</span><span class="op" id="4715832">.</span><span class="ident" id="4715833">roffset</span>&nbsp;<span class="op" id="4715841">+=</span>&nbsp;<span class="builtintype" id="4715844">int64</span><span class="op" id="4715849">(</span><span class="ident" id="4715850">m</span><span class="op" id="4715851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715855">if</span>&nbsp;<span class="ident" id="4715858">err</span>&nbsp;<span class="op" id="4715862">!=</span>&nbsp;<span class="builtintype" id="4715865">nil</span>&nbsp;<span class="op" id="4715869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715874">f</span><span class="op" id="4715875">.</span><span class="ident" id="4715876">err</span>&nbsp;<span class="op" id="4715880">=</span>&nbsp;<span class="op" id="4715882">&amp;</span><span class="ident" id="4715883">ReadError</span><span class="op" id="4715892">{</span><span class="ident" id="4715893">f</span><span class="op" id="4715894">.</span><span class="ident" id="4715895">roffset</span><span class="op" id="4715902">,</span>&nbsp;<span class="ident" id="4715904">err</span><span class="op" id="4715907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715912">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4715921">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715925">n</span>&nbsp;<span class="op" id="4715927">-=</span>&nbsp;<span class="ident" id="4715930">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715934">f</span><span class="op" id="4715935">.</span><span class="ident" id="4715936">hp</span>&nbsp;<span class="op" id="4715939">+=</span>&nbsp;<span class="ident" id="4715942">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4715946">if</span>&nbsp;<span class="ident" id="4715949">f</span><span class="op" id="4715950">.</span><span class="ident" id="4715951">hp</span>&nbsp;<span class="op" id="4715954">==</span>&nbsp;<span class="builtinfunc" id="4715957">len</span><span class="op" id="4715960">(</span><span class="ident" id="4715961">f</span><span class="op" id="4715962">.</span><span class="ident" id="4715963">hist</span><span class="op" id="4715967">)</span>&nbsp;<span class="op" id="4715969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715974">f</span><span class="op" id="4715975">.</span><span class="ident" id="4715976">copyLen</span>&nbsp;<span class="op" id="4715984">=</span>&nbsp;<span class="ident" id="4715986">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4715991">f</span><span class="op" id="4715992">.</span><span class="ident" id="4715993">flush</span><span class="op" id="4715998">(</span><span class="op" id="4715999">(</span><span class="op" id="4716000">*</span><span class="ident" id="4716001">decompressor</span><span class="op" id="4716013">)</span><span class="op" id="4716014">.</span><span class="ident" id="4716015">copyData</span><span class="op" id="4716023">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716043">f</span><span class="op" id="4716044">.</span><span class="ident" id="4716045">step</span>&nbsp;<span class="op" id="4716050">=</span>&nbsp;<span class="op" id="4716052">(</span><span class="op" id="4716053">*</span><span class="ident" id="4716054">decompressor</span><span class="op" id="4716066">)</span><span class="op" id="4716067">.</span><span class="ident" id="4716068">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4716078">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4716081">func</span>&nbsp;<span class="op" id="4716086">(</span><span class="ident" id="4716087">f</span>&nbsp;<span class="op" id="4716089">*</span><span class="ident" id="4716090">decompressor</span><span class="op" id="4716102">)</span>&nbsp;<span class="ident" id="4716104">setDict</span><span class="op" id="4716111">(</span><span class="ident" id="4716112">dict</span>&nbsp;<span class="op" id="4716117">[</span><span class="op" id="4716118">]</span><span class="builtintype" id="4716119">byte</span><span class="op" id="4716123">)</span>&nbsp;<span class="op" id="4716125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716128">if</span>&nbsp;<span class="builtinfunc" id="4716131">len</span><span class="op" id="4716134">(</span><span class="ident" id="4716135">dict</span><span class="op" id="4716139">)</span>&nbsp;<span class="op" id="4716141">&gt;</span>&nbsp;<span class="builtinfunc" id="4716143">len</span><span class="op" id="4716146">(</span><span class="ident" id="4716147">f</span><span class="op" id="4716148">.</span><span class="ident" id="4716149">hist</span><span class="op" id="4716153">)</span>&nbsp;<span class="op" id="4716155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4716159">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716193">dict</span>&nbsp;<span class="op" id="4716198">=</span>&nbsp;<span class="ident" id="4716200">dict</span><span class="op" id="4716204">[</span><span class="builtinfunc" id="4716205">len</span><span class="op" id="4716208">(</span><span class="ident" id="4716209">dict</span><span class="op" id="4716213">)</span><span class="op" id="4716214">-</span><span class="builtinfunc" id="4716215">len</span><span class="op" id="4716218">(</span><span class="ident" id="4716219">f</span><span class="op" id="4716220">.</span><span class="ident" id="4716221">hist</span><span class="op" id="4716225">)</span><span class="op" id="4716226">:</span><span class="op" id="4716227">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716234">f</span><span class="op" id="4716235">.</span><span class="ident" id="4716236">hp</span>&nbsp;<span class="op" id="4716239">=</span>&nbsp;<span class="builtinfunc" id="4716241">copy</span><span class="op" id="4716245">(</span><span class="ident" id="4716246">f</span><span class="op" id="4716247">.</span><span class="ident" id="4716248">hist</span><span class="op" id="4716252">[</span><span class="op" id="4716253">:</span><span class="op" id="4716254">]</span><span class="op" id="4716255">,</span>&nbsp;<span class="ident" id="4716257">dict</span><span class="op" id="4716261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716264">if</span>&nbsp;<span class="ident" id="4716267">f</span><span class="op" id="4716268">.</span><span class="ident" id="4716269">hp</span>&nbsp;<span class="op" id="4716272">==</span>&nbsp;<span class="builtinfunc" id="4716275">len</span><span class="op" id="4716278">(</span><span class="ident" id="4716279">f</span><span class="op" id="4716280">.</span><span class="ident" id="4716281">hist</span><span class="op" id="4716285">)</span>&nbsp;<span class="op" id="4716287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716291">f</span><span class="op" id="4716292">.</span><span class="ident" id="4716293">hp</span>&nbsp;<span class="op" id="4716296">=</span>&nbsp;<span class="num" id="4716298">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716302">f</span><span class="op" id="4716303">.</span><span class="ident" id="4716304">hfull</span>&nbsp;<span class="op" id="4716310">=</span>&nbsp;<span class="builtintype" id="4716312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716321">f</span><span class="op" id="4716322">.</span><span class="ident" id="4716323">hw</span>&nbsp;<span class="op" id="4716326">=</span>&nbsp;<span class="ident" id="4716328">f</span><span class="op" id="4716329">.</span><span class="ident" id="4716330">hp</span><br>
<span class="lineno"></span><span class="op" id="4716333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4716336">func</span>&nbsp;<span class="op" id="4716341">(</span><span class="ident" id="4716342">f</span>&nbsp;<span class="op" id="4716344">*</span><span class="ident" id="4716345">decompressor</span><span class="op" id="4716357">)</span>&nbsp;<span class="ident" id="4716359">moreBits</span><span class="op" id="4716367">(</span><span class="op" id="4716368">)</span>&nbsp;<span class="builtintype" id="4716370">error</span>&nbsp;<span class="op" id="4716376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716379">c</span><span class="op" id="4716380">,</span>&nbsp;<span class="ident" id="4716382">err</span>&nbsp;<span class="op" id="4716386">:=</span>&nbsp;<span class="ident" id="4716389">f</span><span class="op" id="4716390">.</span><span class="ident" id="4716391">r</span><span class="op" id="4716392">.</span><span class="ident" id="4716393">ReadByte</span><span class="op" id="4716401">(</span><span class="op" id="4716402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716405">if</span>&nbsp;<span class="ident" id="4716408">err</span>&nbsp;<span class="op" id="4716412">!=</span>&nbsp;<span class="builtintype" id="4716415">nil</span>&nbsp;<span class="op" id="4716419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716423">if</span>&nbsp;<span class="ident" id="4716426">err</span>&nbsp;<span class="op" id="4716430">==</span>&nbsp;<span class="ident" id="4716433">io</span><span class="op" id="4716435">.</span><span class="ident" id="4716436">EOF</span>&nbsp;<span class="op" id="4716440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716445">err</span>&nbsp;<span class="op" id="4716449">=</span>&nbsp;<span class="ident" id="4716451">io</span><span class="op" id="4716453">.</span><span class="ident" id="4716454">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716477">return</span>&nbsp;<span class="ident" id="4716484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716492">f</span><span class="op" id="4716493">.</span><span class="ident" id="4716494">roffset</span><span class="op" id="4716501">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716505">f</span><span class="op" id="4716506">.</span><span class="ident" id="4716507">b</span>&nbsp;<span class="op" id="4716509">|=</span>&nbsp;<span class="builtintype" id="4716512">uint32</span><span class="op" id="4716518">(</span><span class="ident" id="4716519">c</span><span class="op" id="4716520">)</span>&nbsp;<span class="op" id="4716522">&lt;&lt;</span>&nbsp;<span class="ident" id="4716525">f</span><span class="op" id="4716526">.</span><span class="ident" id="4716527">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716531">f</span><span class="op" id="4716532">.</span><span class="ident" id="4716533">nb</span>&nbsp;<span class="op" id="4716536">+=</span>&nbsp;<span class="num" id="4716539">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716542">return</span>&nbsp;<span class="builtintype" id="4716549">nil</span><br>
<span class="lineno"></span><span class="op" id="4716553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4716556">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4716619">func</span>&nbsp;<span class="op" id="4716624">(</span><span class="ident" id="4716625">f</span>&nbsp;<span class="op" id="4716627">*</span><span class="ident" id="4716628">decompressor</span><span class="op" id="4716640">)</span>&nbsp;<span class="ident" id="4716642">huffSym</span><span class="op" id="4716649">(</span><span class="ident" id="4716650">h</span>&nbsp;<span class="op" id="4716652">*</span><span class="ident" id="4716653">huffmanDecoder</span><span class="op" id="4716667">)</span>&nbsp;<span class="op" id="4716669">(</span><span class="builtintype" id="4716670">int</span><span class="op" id="4716673">,</span>&nbsp;<span class="builtintype" id="4716675">error</span><span class="op" id="4716680">)</span>&nbsp;<span class="op" id="4716682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716685">n</span>&nbsp;<span class="op" id="4716687">:=</span>&nbsp;<span class="builtintype" id="4716690">uint</span><span class="op" id="4716694">(</span><span class="ident" id="4716695">h</span><span class="op" id="4716696">.</span><span class="ident" id="4716697">min</span><span class="op" id="4716700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716703">for</span>&nbsp;<span class="op" id="4716707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716711">for</span>&nbsp;<span class="ident" id="4716715">f</span><span class="op" id="4716716">.</span><span class="ident" id="4716717">nb</span>&nbsp;<span class="op" id="4716720">&lt;</span>&nbsp;<span class="ident" id="4716722">n</span>&nbsp;<span class="op" id="4716724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716729">if</span>&nbsp;<span class="ident" id="4716732">err</span>&nbsp;<span class="op" id="4716736">:=</span>&nbsp;<span class="ident" id="4716739">f</span><span class="op" id="4716740">.</span><span class="ident" id="4716741">moreBits</span><span class="op" id="4716749">(</span><span class="op" id="4716750">)</span><span class="op" id="4716751">;</span>&nbsp;<span class="ident" id="4716753">err</span>&nbsp;<span class="op" id="4716757">!=</span>&nbsp;<span class="builtintype" id="4716760">nil</span>&nbsp;<span class="op" id="4716764">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716770">return</span>&nbsp;<span class="num" id="4716777">0</span><span class="op" id="4716778">,</span>&nbsp;<span class="ident" id="4716780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4716791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716795">chunk</span>&nbsp;<span class="op" id="4716801">:=</span>&nbsp;<span class="ident" id="4716804">h</span><span class="op" id="4716805">.</span><span class="ident" id="4716806">chunks</span><span class="op" id="4716812">[</span><span class="ident" id="4716813">f</span><span class="op" id="4716814">.</span><span class="ident" id="4716815">b</span><span class="op" id="4716816">&amp;</span><span class="op" id="4716817">(</span><span class="ident" id="4716818">huffmanNumChunks</span><span class="op" id="4716834">-</span><span class="num" id="4716835">1</span><span class="op" id="4716836">)</span><span class="op" id="4716837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716841">n</span>&nbsp;<span class="op" id="4716843">=</span>&nbsp;<span class="builtintype" id="4716845">uint</span><span class="op" id="4716849">(</span><span class="ident" id="4716850">chunk</span>&nbsp;<span class="op" id="4716856">&amp;</span>&nbsp;<span class="ident" id="4716858">huffmanCountMask</span><span class="op" id="4716874">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4716878">if</span>&nbsp;<span class="ident" id="4716881">n</span>&nbsp;<span class="op" id="4716883">&gt;</span>&nbsp;<span class="ident" id="4716885">huffmanChunkBits</span>&nbsp;<span class="op" id="4716902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716907">chunk</span>&nbsp;<span class="op" id="4716913">=</span>&nbsp;<span class="ident" id="4716915">h</span><span class="op" id="4716916">.</span><span class="ident" id="4716917">links</span><span class="op" id="4716922">[</span><span class="ident" id="4716923">chunk</span><span class="op" id="4716928">&gt;&gt;</span><span class="ident" id="4716930">huffmanValueShift</span><span class="op" id="4716947">]</span><span class="op" id="4716948">[</span><span class="op" id="4716949">(</span><span class="ident" id="4716950">f</span><span class="op" id="4716951">.</span><span class="ident" id="4716952">b</span><span class="op" id="4716953">&gt;&gt;</span><span class="ident" id="4716955">huffmanChunkBits</span><span class="op" id="4716971">)</span><span class="op" id="4716972">&amp;</span><span class="ident" id="4716973">h</span><span class="op" id="4716974">.</span><span class="ident" id="4716975">linkMask</span><span class="op" id="4716983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4716988">n</span>&nbsp;<span class="op" id="4716990">=</span>&nbsp;<span class="builtintype" id="4716992">uint</span><span class="op" id="4716996">(</span><span class="ident" id="4716997">chunk</span>&nbsp;<span class="op" id="4717003">&amp;</span>&nbsp;<span class="ident" id="4717005">huffmanCountMask</span><span class="op" id="4717021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717026">if</span>&nbsp;<span class="ident" id="4717029">n</span>&nbsp;<span class="op" id="4717031">==</span>&nbsp;<span class="num" id="4717034">0</span>&nbsp;<span class="op" id="4717036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717042">f</span><span class="op" id="4717043">.</span><span class="ident" id="4717044">err</span>&nbsp;<span class="op" id="4717048">=</span>&nbsp;<span class="ident" id="4717050">CorruptInputError</span><span class="op" id="4717067">(</span><span class="ident" id="4717068">f</span><span class="op" id="4717069">.</span><span class="ident" id="4717070">roffset</span><span class="op" id="4717077">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717083">return</span>&nbsp;<span class="num" id="4717090">0</span><span class="op" id="4717091">,</span>&nbsp;<span class="ident" id="4717093">f</span><span class="op" id="4717094">.</span><span class="ident" id="4717095">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717110">if</span>&nbsp;<span class="ident" id="4717113">n</span>&nbsp;<span class="op" id="4717115">&lt;=</span>&nbsp;<span class="ident" id="4717118">f</span><span class="op" id="4717119">.</span><span class="ident" id="4717120">nb</span>&nbsp;<span class="op" id="4717123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717128">f</span><span class="op" id="4717129">.</span><span class="ident" id="4717130">b</span>&nbsp;<span class="op" id="4717132">&gt;&gt;=</span>&nbsp;<span class="ident" id="4717136">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717141">f</span><span class="op" id="4717142">.</span><span class="ident" id="4717143">nb</span>&nbsp;<span class="op" id="4717146">-=</span>&nbsp;<span class="ident" id="4717149">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717154">return</span>&nbsp;<span class="builtintype" id="4717161">int</span><span class="op" id="4717164">(</span><span class="ident" id="4717165">chunk</span>&nbsp;<span class="op" id="4717171">&gt;&gt;</span>&nbsp;<span class="ident" id="4717174">huffmanValueShift</span><span class="op" id="4717191">)</span><span class="op" id="4717192">,</span>&nbsp;<span class="builtintype" id="4717194">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717203">}</span><br>
<span class="lineno"></span><span class="op" id="4717205">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4717208">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4717263">func</span>&nbsp;<span class="op" id="4717268">(</span><span class="ident" id="4717269">f</span>&nbsp;<span class="op" id="4717271">*</span><span class="ident" id="4717272">decompressor</span><span class="op" id="4717284">)</span>&nbsp;<span class="ident" id="4717286">flush</span><span class="op" id="4717291">(</span><span class="ident" id="4717292">step</span>&nbsp;<span class="keyword" id="4717297">func</span><span class="op" id="4717301">(</span><span class="op" id="4717302">*</span><span class="ident" id="4717303">decompressor</span><span class="op" id="4717315">)</span><span class="op" id="4717316">)</span>&nbsp;<span class="op" id="4717318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717321">f</span><span class="op" id="4717322">.</span><span class="ident" id="4717323">toRead</span>&nbsp;<span class="op" id="4717330">=</span>&nbsp;<span class="ident" id="4717332">f</span><span class="op" id="4717333">.</span><span class="ident" id="4717334">hist</span><span class="op" id="4717338">[</span><span class="ident" id="4717339">f</span><span class="op" id="4717340">.</span><span class="ident" id="4717341">hw</span><span class="op" id="4717343">:</span><span class="ident" id="4717344">f</span><span class="op" id="4717345">.</span><span class="ident" id="4717346">hp</span><span class="op" id="4717348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717351">f</span><span class="op" id="4717352">.</span><span class="ident" id="4717353">woffset</span>&nbsp;<span class="op" id="4717361">+=</span>&nbsp;<span class="builtintype" id="4717364">int64</span><span class="op" id="4717369">(</span><span class="ident" id="4717370">f</span><span class="op" id="4717371">.</span><span class="ident" id="4717372">hp</span>&nbsp;<span class="op" id="4717375">-</span>&nbsp;<span class="ident" id="4717377">f</span><span class="op" id="4717378">.</span><span class="ident" id="4717379">hw</span><span class="op" id="4717381">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717384">f</span><span class="op" id="4717385">.</span><span class="ident" id="4717386">hw</span>&nbsp;<span class="op" id="4717389">=</span>&nbsp;<span class="ident" id="4717391">f</span><span class="op" id="4717392">.</span><span class="ident" id="4717393">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717397">if</span>&nbsp;<span class="ident" id="4717400">f</span><span class="op" id="4717401">.</span><span class="ident" id="4717402">hp</span>&nbsp;<span class="op" id="4717405">==</span>&nbsp;<span class="builtinfunc" id="4717408">len</span><span class="op" id="4717411">(</span><span class="ident" id="4717412">f</span><span class="op" id="4717413">.</span><span class="ident" id="4717414">hist</span><span class="op" id="4717418">)</span>&nbsp;<span class="op" id="4717420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717424">f</span><span class="op" id="4717425">.</span><span class="ident" id="4717426">hp</span>&nbsp;<span class="op" id="4717429">=</span>&nbsp;<span class="num" id="4717431">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717435">f</span><span class="op" id="4717436">.</span><span class="ident" id="4717437">hw</span>&nbsp;<span class="op" id="4717440">=</span>&nbsp;<span class="num" id="4717442">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717446">f</span><span class="op" id="4717447">.</span><span class="ident" id="4717448">hfull</span>&nbsp;<span class="op" id="4717454">=</span>&nbsp;<span class="builtintype" id="4717456">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717465">f</span><span class="op" id="4717466">.</span><span class="ident" id="4717467">step</span>&nbsp;<span class="op" id="4717472">=</span>&nbsp;<span class="ident" id="4717474">step</span><br>
<span class="lineno"></span><span class="op" id="4717479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4717482">func</span>&nbsp;<span class="ident" id="4717487">makeReader</span><span class="op" id="4717497">(</span><span class="ident" id="4717498">r</span>&nbsp;<span class="ident" id="4717500">io</span><span class="op" id="4717502">.</span><span class="ident" id="4717503">Reader</span><span class="op" id="4717509">)</span>&nbsp;<span class="ident" id="4717511">Reader</span>&nbsp;<span class="op" id="4717518">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717521">if</span>&nbsp;<span class="ident" id="4717524">rr</span><span class="op" id="4717526">,</span>&nbsp;<span class="ident" id="4717528">ok</span>&nbsp;<span class="op" id="4717531">:=</span>&nbsp;<span class="ident" id="4717534">r</span><span class="op" id="4717535">.</span><span class="op" id="4717536">(</span><span class="ident" id="4717537">Reader</span><span class="op" id="4717543">)</span><span class="op" id="4717544">;</span>&nbsp;<span class="ident" id="4717546">ok</span>&nbsp;<span class="op" id="4717549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717553">return</span>&nbsp;<span class="ident" id="4717560">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717567">return</span>&nbsp;<span class="ident" id="4717574">bufio</span><span class="op" id="4717579">.</span><span class="ident" id="4717580">NewReader</span><span class="op" id="4717589">(</span><span class="ident" id="4717590">r</span><span class="op" id="4717591">)</span><br>
<span class="lineno"></span><span class="op" id="4717593">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4717596">func</span>&nbsp;<span class="op" id="4717601">(</span><span class="ident" id="4717602">f</span>&nbsp;<span class="op" id="4717604">*</span><span class="ident" id="4717605">decompressor</span><span class="op" id="4717617">)</span>&nbsp;<span class="ident" id="4717619">Reset</span><span class="op" id="4717624">(</span><span class="ident" id="4717625">r</span>&nbsp;<span class="ident" id="4717627">io</span><span class="op" id="4717629">.</span><span class="ident" id="4717630">Reader</span><span class="op" id="4717636">,</span>&nbsp;<span class="ident" id="4717638">dict</span>&nbsp;<span class="op" id="4717643">[</span><span class="op" id="4717644">]</span><span class="builtintype" id="4717645">byte</span><span class="op" id="4717649">)</span>&nbsp;<span class="builtintype" id="4717651">error</span>&nbsp;<span class="op" id="4717657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717660">*</span><span class="ident" id="4717661">f</span>&nbsp;<span class="op" id="4717663">=</span>&nbsp;<span class="ident" id="4717665">decompressor</span><span class="op" id="4717677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717681">r</span><span class="op" id="4717682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717691">makeReader</span><span class="op" id="4717701">(</span><span class="ident" id="4717702">r</span><span class="op" id="4717703">)</span><span class="op" id="4717704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717708">bits</span><span class="op" id="4717712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717718">f</span><span class="op" id="4717719">.</span><span class="ident" id="4717720">bits</span><span class="op" id="4717724">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717728">codebits</span><span class="op" id="4717736">:</span>&nbsp;<span class="ident" id="4717738">f</span><span class="op" id="4717739">.</span><span class="ident" id="4717740">codebits</span><span class="op" id="4717748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717752">hist</span><span class="op" id="4717756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717762">f</span><span class="op" id="4717763">.</span><span class="ident" id="4717764">hist</span><span class="op" id="4717768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717772">step</span><span class="op" id="4717776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717782">(</span><span class="op" id="4717783">*</span><span class="ident" id="4717784">decompressor</span><span class="op" id="4717796">)</span><span class="op" id="4717797">.</span><span class="ident" id="4717798">nextBlock</span><span class="op" id="4717807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717813">if</span>&nbsp;<span class="ident" id="4717816">dict</span>&nbsp;<span class="op" id="4717821">!=</span>&nbsp;<span class="builtintype" id="4717824">nil</span>&nbsp;<span class="op" id="4717828">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4717832">f</span><span class="op" id="4717833">.</span><span class="ident" id="4717834">setDict</span><span class="op" id="4717841">(</span><span class="ident" id="4717842">dict</span><span class="op" id="4717846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4717849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4717852">return</span>&nbsp;<span class="builtintype" id="4717859">nil</span><br>
<span class="lineno"></span><span class="op" id="4717863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4717866">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4717921">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4717963">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4718010">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4718072">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4718141">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4718167">//</span><br>
<span class="lineno"></span><span class="comment" id="4718170">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4718236">func</span>&nbsp;<span class="ident" id="4718241">NewReader</span><span class="op" id="4718250">(</span><span class="ident" id="4718251">r</span>&nbsp;<span class="ident" id="4718253">io</span><span class="op" id="4718255">.</span><span class="ident" id="4718256">Reader</span><span class="op" id="4718262">)</span>&nbsp;<span class="ident" id="4718264">io</span><span class="op" id="4718266">.</span><span class="ident" id="4718267">ReadCloser</span>&nbsp;<span class="op" id="4718278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4718281">var</span>&nbsp;<span class="ident" id="4718285">f</span>&nbsp;<span class="ident" id="4718287">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718301">f</span><span class="op" id="4718302">.</span><span class="ident" id="4718303">bits</span>&nbsp;<span class="op" id="4718308">=</span>&nbsp;<span class="builtinfunc" id="4718310">new</span><span class="op" id="4718313">(</span><span class="op" id="4718314">[</span><span class="ident" id="4718315">maxLit</span>&nbsp;<span class="op" id="4718322">+</span>&nbsp;<span class="ident" id="4718324">maxDist</span><span class="op" id="4718331">]</span><span class="builtintype" id="4718332">int</span><span class="op" id="4718335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718338">f</span><span class="op" id="4718339">.</span><span class="ident" id="4718340">codebits</span>&nbsp;<span class="op" id="4718349">=</span>&nbsp;<span class="builtinfunc" id="4718351">new</span><span class="op" id="4718354">(</span><span class="op" id="4718355">[</span><span class="ident" id="4718356">numCodes</span><span class="op" id="4718364">]</span><span class="builtintype" id="4718365">int</span><span class="op" id="4718368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718371">f</span><span class="op" id="4718372">.</span><span class="ident" id="4718373">r</span>&nbsp;<span class="op" id="4718375">=</span>&nbsp;<span class="ident" id="4718377">makeReader</span><span class="op" id="4718387">(</span><span class="ident" id="4718388">r</span><span class="op" id="4718389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718392">f</span><span class="op" id="4718393">.</span><span class="ident" id="4718394">hist</span>&nbsp;<span class="op" id="4718399">=</span>&nbsp;<span class="builtinfunc" id="4718401">new</span><span class="op" id="4718404">(</span><span class="op" id="4718405">[</span><span class="ident" id="4718406">maxHist</span><span class="op" id="4718413">]</span><span class="builtintype" id="4718414">byte</span><span class="op" id="4718418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718421">f</span><span class="op" id="4718422">.</span><span class="ident" id="4718423">step</span>&nbsp;<span class="op" id="4718428">=</span>&nbsp;<span class="op" id="4718430">(</span><span class="op" id="4718431">*</span><span class="ident" id="4718432">decompressor</span><span class="op" id="4718444">)</span><span class="op" id="4718445">.</span><span class="ident" id="4718446">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4718457">return</span>&nbsp;<span class="op" id="4718464">&amp;</span><span class="ident" id="4718465">f</span><br>
<span class="lineno"></span><span class="op" id="4718467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4718470">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4718532">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4718596">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4718663">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4718728">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4718773">//</span><br>
<span class="lineno"></span><span class="comment" id="4718776">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4718842">func</span>&nbsp;<span class="ident" id="4718847">NewReaderDict</span><span class="op" id="4718860">(</span><span class="ident" id="4718861">r</span>&nbsp;<span class="ident" id="4718863">io</span><span class="op" id="4718865">.</span><span class="ident" id="4718866">Reader</span><span class="op" id="4718872">,</span>&nbsp;<span class="ident" id="4718874">dict</span>&nbsp;<span class="op" id="4718879">[</span><span class="op" id="4718880">]</span><span class="builtintype" id="4718881">byte</span><span class="op" id="4718885">)</span>&nbsp;<span class="ident" id="4718887">io</span><span class="op" id="4718889">.</span><span class="ident" id="4718890">ReadCloser</span>&nbsp;<span class="op" id="4718901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4718904">var</span>&nbsp;<span class="ident" id="4718908">f</span>&nbsp;<span class="ident" id="4718910">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718924">f</span><span class="op" id="4718925">.</span><span class="ident" id="4718926">r</span>&nbsp;<span class="op" id="4718928">=</span>&nbsp;<span class="ident" id="4718930">makeReader</span><span class="op" id="4718940">(</span><span class="ident" id="4718941">r</span><span class="op" id="4718942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718945">f</span><span class="op" id="4718946">.</span><span class="ident" id="4718947">hist</span>&nbsp;<span class="op" id="4718952">=</span>&nbsp;<span class="builtinfunc" id="4718954">new</span><span class="op" id="4718957">(</span><span class="op" id="4718958">[</span><span class="ident" id="4718959">maxHist</span><span class="op" id="4718966">]</span><span class="builtintype" id="4718967">byte</span><span class="op" id="4718971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4718974">f</span><span class="op" id="4718975">.</span><span class="ident" id="4718976">bits</span>&nbsp;<span class="op" id="4718981">=</span>&nbsp;<span class="builtinfunc" id="4718983">new</span><span class="op" id="4718986">(</span><span class="op" id="4718987">[</span><span class="ident" id="4718988">maxLit</span>&nbsp;<span class="op" id="4718995">+</span>&nbsp;<span class="ident" id="4718997">maxDist</span><span class="op" id="4719004">]</span><span class="builtintype" id="4719005">int</span><span class="op" id="4719008">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4719011">f</span><span class="op" id="4719012">.</span><span class="ident" id="4719013">codebits</span>&nbsp;<span class="op" id="4719022">=</span>&nbsp;<span class="builtinfunc" id="4719024">new</span><span class="op" id="4719027">(</span><span class="op" id="4719028">[</span><span class="ident" id="4719029">numCodes</span><span class="op" id="4719037">]</span><span class="builtintype" id="4719038">int</span><span class="op" id="4719041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4719044">f</span><span class="op" id="4719045">.</span><span class="ident" id="4719046">step</span>&nbsp;<span class="op" id="4719051">=</span>&nbsp;<span class="op" id="4719053">(</span><span class="op" id="4719054">*</span><span class="ident" id="4719055">decompressor</span><span class="op" id="4719067">)</span><span class="op" id="4719068">.</span><span class="ident" id="4719069">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4719080">f</span><span class="op" id="4719081">.</span><span class="ident" id="4719082">setDict</span><span class="op" id="4719089">(</span><span class="ident" id="4719090">dict</span><span class="op" id="4719094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4719097">return</span>&nbsp;<span class="op" id="4719104">&amp;</span><span class="ident" id="4719105">f</span><br>
<span class="lineno"></span><span class="op" id="4719107">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
