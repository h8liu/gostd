<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3938637">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3938692">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3938746">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3938797">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3938870">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3938885">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3938957">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3939031">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3939080">package</span>&nbsp;<span class="ident" id="3939088">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939099">import</span>&nbsp;<span class="op" id="3939106">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3939109">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3939118">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3939127">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3939134">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3939139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3939142">type</span>&nbsp;<span class="ident" id="3939147">qpReader</span>&nbsp;<span class="keyword" id="3939156">struct</span>&nbsp;<span class="op" id="3939163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3939166">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3939171">*</span><span class="ident" id="3939172">bufio</span><span class="op" id="3939177">.</span><span class="ident" id="3939178">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3939186">rerr</span>&nbsp;<span class="builtintype" id="3939191">error</span>&nbsp;&nbsp;<span class="comment" id="3939198">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3939218">line</span>&nbsp;<span class="op" id="3939223">[</span><span class="op" id="3939224">]</span><span class="builtintype" id="3939225">byte</span>&nbsp;<span class="comment" id="3939230">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3939266">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3939269">func</span>&nbsp;<span class="ident" id="3939274">newQuotedPrintableReader</span><span class="op" id="3939298">(</span><span class="ident" id="3939299">r</span>&nbsp;<span class="ident" id="3939301">io</span><span class="op" id="3939303">.</span><span class="ident" id="3939304">Reader</span><span class="op" id="3939310">)</span>&nbsp;<span class="ident" id="3939312">io</span><span class="op" id="3939314">.</span><span class="ident" id="3939315">Reader</span>&nbsp;<span class="op" id="3939322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939325">return</span>&nbsp;<span class="op" id="3939332">&amp;</span><span class="ident" id="3939333">qpReader</span><span class="op" id="3939341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3939345">br</span><span class="op" id="3939347">:</span>&nbsp;<span class="ident" id="3939349">bufio</span><span class="op" id="3939354">.</span><span class="ident" id="3939355">NewReader</span><span class="op" id="3939364">(</span><span class="ident" id="3939365">r</span><span class="op" id="3939366">)</span><span class="op" id="3939367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939370">}</span><br>
<span class="lineno">30</span><span class="op" id="3939372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939375">func</span>&nbsp;<span class="ident" id="3939380">fromHex</span><span class="op" id="3939387">(</span><span class="ident" id="3939388">b</span>&nbsp;<span class="builtintype" id="3939390">byte</span><span class="op" id="3939394">)</span>&nbsp;<span class="op" id="3939396">(</span><span class="builtintype" id="3939397">byte</span><span class="op" id="3939401">,</span>&nbsp;<span class="builtintype" id="3939403">error</span><span class="op" id="3939408">)</span>&nbsp;<span class="op" id="3939410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939413">switch</span>&nbsp;<span class="op" id="3939420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939423">case</span>&nbsp;<span class="ident" id="3939428">b</span>&nbsp;<span class="op" id="3939430">&gt;=</span>&nbsp;<span class="string" id="3939433">&#39;0&#39;</span>&nbsp;<span class="op" id="3939437">&amp;&amp;</span>&nbsp;<span class="ident" id="3939440">b</span>&nbsp;<span class="op" id="3939442">&lt;=</span>&nbsp;<span class="string" id="3939445">&#39;9&#39;</span><span class="op" id="3939448">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939452">return</span>&nbsp;<span class="ident" id="3939459">b</span>&nbsp;<span class="op" id="3939461">-</span>&nbsp;<span class="string" id="3939463">&#39;0&#39;</span><span class="op" id="3939466">,</span>&nbsp;<span class="builtintype" id="3939468">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939473">case</span>&nbsp;<span class="ident" id="3939478">b</span>&nbsp;<span class="op" id="3939480">&gt;=</span>&nbsp;<span class="string" id="3939483">&#39;A&#39;</span>&nbsp;<span class="op" id="3939487">&amp;&amp;</span>&nbsp;<span class="ident" id="3939490">b</span>&nbsp;<span class="op" id="3939492">&lt;=</span>&nbsp;<span class="string" id="3939495">&#39;F&#39;</span><span class="op" id="3939498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939502">return</span>&nbsp;<span class="ident" id="3939509">b</span>&nbsp;<span class="op" id="3939511">-</span>&nbsp;<span class="string" id="3939513">&#39;A&#39;</span>&nbsp;<span class="op" id="3939517">+</span>&nbsp;<span class="num" id="3939519">10</span><span class="op" id="3939521">,</span>&nbsp;<span class="builtintype" id="3939523">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939531">return</span>&nbsp;<span class="num" id="3939538">0</span><span class="op" id="3939539">,</span>&nbsp;<span class="ident" id="3939541">fmt</span><span class="op" id="3939544">.</span><span class="ident" id="3939545">Errorf</span><span class="op" id="3939551">(</span><span class="string" id="3939552">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3939605">,</span>&nbsp;<span class="ident" id="3939607">b</span><span class="op" id="3939608">)</span><br>
<span class="lineno">40</span><span class="op" id="3939610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939613">func</span>&nbsp;<span class="op" id="3939618">(</span><span class="ident" id="3939619">q</span>&nbsp;<span class="op" id="3939621">*</span><span class="ident" id="3939622">qpReader</span><span class="op" id="3939630">)</span>&nbsp;<span class="ident" id="3939632">readHexByte</span><span class="op" id="3939643">(</span><span class="ident" id="3939644">v</span>&nbsp;<span class="op" id="3939646">[</span><span class="op" id="3939647">]</span><span class="builtintype" id="3939648">byte</span><span class="op" id="3939652">)</span>&nbsp;<span class="op" id="3939654">(</span><span class="ident" id="3939655">b</span>&nbsp;<span class="builtintype" id="3939657">byte</span><span class="op" id="3939661">,</span>&nbsp;<span class="ident" id="3939663">err</span>&nbsp;<span class="builtintype" id="3939667">error</span><span class="op" id="3939672">)</span>&nbsp;<span class="op" id="3939674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939677">if</span>&nbsp;<span class="builtinfunc" id="3939680">len</span><span class="op" id="3939683">(</span><span class="ident" id="3939684">v</span><span class="op" id="3939685">)</span>&nbsp;<span class="op" id="3939687">&lt;</span>&nbsp;<span class="num" id="3939689">2</span>&nbsp;<span class="op" id="3939691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939695">return</span>&nbsp;<span class="num" id="3939702">0</span><span class="op" id="3939703">,</span>&nbsp;<span class="ident" id="3939705">io</span><span class="op" id="3939707">.</span><span class="ident" id="3939708">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939729">var</span>&nbsp;<span class="ident" id="3939733">hb</span><span class="op" id="3939735">,</span>&nbsp;<span class="ident" id="3939737">lb</span>&nbsp;<span class="builtintype" id="3939740">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939746">if</span>&nbsp;<span class="ident" id="3939749">hb</span><span class="op" id="3939751">,</span>&nbsp;<span class="ident" id="3939753">err</span>&nbsp;<span class="op" id="3939757">=</span>&nbsp;<span class="ident" id="3939759">fromHex</span><span class="op" id="3939766">(</span><span class="ident" id="3939767">v</span><span class="op" id="3939768">[</span><span class="num" id="3939769">0</span><span class="op" id="3939770">]</span><span class="op" id="3939771">)</span><span class="op" id="3939772">;</span>&nbsp;<span class="ident" id="3939774">err</span>&nbsp;<span class="op" id="3939778">!=</span>&nbsp;<span class="builtintype" id="3939781">nil</span>&nbsp;<span class="op" id="3939785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939789">return</span>&nbsp;<span class="num" id="3939796">0</span><span class="op" id="3939797">,</span>&nbsp;<span class="ident" id="3939799">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939804">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939807">if</span>&nbsp;<span class="ident" id="3939810">lb</span><span class="op" id="3939812">,</span>&nbsp;<span class="ident" id="3939814">err</span>&nbsp;<span class="op" id="3939818">=</span>&nbsp;<span class="ident" id="3939820">fromHex</span><span class="op" id="3939827">(</span><span class="ident" id="3939828">v</span><span class="op" id="3939829">[</span><span class="num" id="3939830">1</span><span class="op" id="3939831">]</span><span class="op" id="3939832">)</span><span class="op" id="3939833">;</span>&nbsp;<span class="ident" id="3939835">err</span>&nbsp;<span class="op" id="3939839">!=</span>&nbsp;<span class="builtintype" id="3939842">nil</span>&nbsp;<span class="op" id="3939846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939850">return</span>&nbsp;<span class="num" id="3939857">0</span><span class="op" id="3939858">,</span>&nbsp;<span class="ident" id="3939860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939868">return</span>&nbsp;<span class="ident" id="3939875">hb</span><span class="op" id="3939877">&lt;&lt;</span><span class="num" id="3939879">4</span>&nbsp;<span class="op" id="3939881">|</span>&nbsp;<span class="ident" id="3939883">lb</span><span class="op" id="3939885">,</span>&nbsp;<span class="builtintype" id="3939887">nil</span><br>
<span class="lineno"></span><span class="op" id="3939891">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3939894">func</span>&nbsp;<span class="ident" id="3939899">isQPDiscardWhitespace</span><span class="op" id="3939920">(</span><span class="ident" id="3939921">r</span>&nbsp;<span class="builtintype" id="3939923">rune</span><span class="op" id="3939927">)</span>&nbsp;<span class="builtintype" id="3939929">bool</span>&nbsp;<span class="op" id="3939934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939937">switch</span>&nbsp;<span class="ident" id="3939944">r</span>&nbsp;<span class="op" id="3939946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939949">case</span>&nbsp;<span class="string" id="3939954">&#39;\n&#39;</span><span class="op" id="3939958">,</span>&nbsp;<span class="string" id="3939960">&#39;\r&#39;</span><span class="op" id="3939964">,</span>&nbsp;<span class="string" id="3939966">&#39;&nbsp;&#39;</span><span class="op" id="3939969">,</span>&nbsp;<span class="string" id="3939971">&#39;\t&#39;</span><span class="op" id="3939975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939979">return</span>&nbsp;<span class="builtintype" id="3939986">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939995">return</span>&nbsp;<span class="builtintype" id="3940002">false</span><br>
<span class="lineno"></span><span class="op" id="3940008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3940011">var</span>&nbsp;<span class="op" id="3940015">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940018">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940029">=</span>&nbsp;<span class="op" id="3940031">[</span><span class="op" id="3940032">]</span><span class="builtintype" id="3940033">byte</span><span class="op" id="3940037">(</span><span class="string" id="3940038">&#34;\r\n&#34;</span><span class="op" id="3940044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940047">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940058">=</span>&nbsp;<span class="op" id="3940060">[</span><span class="op" id="3940061">]</span><span class="builtintype" id="3940062">byte</span><span class="op" id="3940066">(</span><span class="string" id="3940067">&#34;\n&#34;</span><span class="op" id="3940071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940074">softSuffix</span>&nbsp;<span class="op" id="3940085">=</span>&nbsp;<span class="op" id="3940087">[</span><span class="op" id="3940088">]</span><span class="builtintype" id="3940089">byte</span><span class="op" id="3940093">(</span><span class="string" id="3940094">&#34;=&#34;</span><span class="op" id="3940097">)</span><br>
<span class="lineno"></span><span class="op" id="3940099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3940102">func</span>&nbsp;<span class="op" id="3940107">(</span><span class="ident" id="3940108">q</span>&nbsp;<span class="op" id="3940110">*</span><span class="ident" id="3940111">qpReader</span><span class="op" id="3940119">)</span>&nbsp;<span class="ident" id="3940121">Read</span><span class="op" id="3940125">(</span><span class="ident" id="3940126">p</span>&nbsp;<span class="op" id="3940128">[</span><span class="op" id="3940129">]</span><span class="builtintype" id="3940130">byte</span><span class="op" id="3940134">)</span>&nbsp;<span class="op" id="3940136">(</span><span class="ident" id="3940137">n</span>&nbsp;<span class="builtintype" id="3940139">int</span><span class="op" id="3940142">,</span>&nbsp;<span class="ident" id="3940144">err</span>&nbsp;<span class="builtintype" id="3940148">error</span><span class="op" id="3940153">)</span>&nbsp;<span class="op" id="3940155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940158">for</span>&nbsp;<span class="builtinfunc" id="3940162">len</span><span class="op" id="3940165">(</span><span class="ident" id="3940166">p</span><span class="op" id="3940167">)</span>&nbsp;<span class="op" id="3940169">&gt;</span>&nbsp;<span class="num" id="3940171">0</span>&nbsp;<span class="op" id="3940173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940177">if</span>&nbsp;<span class="builtinfunc" id="3940180">len</span><span class="op" id="3940183">(</span><span class="ident" id="3940184">q</span><span class="op" id="3940185">.</span><span class="ident" id="3940186">line</span><span class="op" id="3940190">)</span>&nbsp;<span class="op" id="3940192">==</span>&nbsp;<span class="num" id="3940195">0</span>&nbsp;<span class="op" id="3940197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940202">if</span>&nbsp;<span class="ident" id="3940205">q</span><span class="op" id="3940206">.</span><span class="ident" id="3940207">rerr</span>&nbsp;<span class="op" id="3940212">!=</span>&nbsp;<span class="builtintype" id="3940215">nil</span>&nbsp;<span class="op" id="3940219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940225">return</span>&nbsp;<span class="ident" id="3940232">n</span><span class="op" id="3940233">,</span>&nbsp;<span class="ident" id="3940235">q</span><span class="op" id="3940236">.</span><span class="ident" id="3940237">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940250">q</span><span class="op" id="3940251">.</span><span class="ident" id="3940252">line</span><span class="op" id="3940256">,</span>&nbsp;<span class="ident" id="3940258">q</span><span class="op" id="3940259">.</span><span class="ident" id="3940260">rerr</span>&nbsp;<span class="op" id="3940265">=</span>&nbsp;<span class="ident" id="3940267">q</span><span class="op" id="3940268">.</span><span class="ident" id="3940269">br</span><span class="op" id="3940271">.</span><span class="ident" id="3940272">ReadSlice</span><span class="op" id="3940281">(</span><span class="string" id="3940282">&#39;\n&#39;</span><span class="op" id="3940286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3940292">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940344">hasLF</span>&nbsp;<span class="op" id="3940350">:=</span>&nbsp;<span class="ident" id="3940353">bytes</span><span class="op" id="3940358">.</span><span class="ident" id="3940359">HasSuffix</span><span class="op" id="3940368">(</span><span class="ident" id="3940369">q</span><span class="op" id="3940370">.</span><span class="ident" id="3940371">line</span><span class="op" id="3940375">,</span>&nbsp;<span class="ident" id="3940377">lf</span><span class="op" id="3940379">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940384">hasCR</span>&nbsp;<span class="op" id="3940390">:=</span>&nbsp;<span class="ident" id="3940393">bytes</span><span class="op" id="3940398">.</span><span class="ident" id="3940399">HasSuffix</span><span class="op" id="3940408">(</span><span class="ident" id="3940409">q</span><span class="op" id="3940410">.</span><span class="ident" id="3940411">line</span><span class="op" id="3940415">,</span>&nbsp;<span class="ident" id="3940417">crlf</span><span class="op" id="3940421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940426">wholeLine</span>&nbsp;<span class="op" id="3940436">:=</span>&nbsp;<span class="ident" id="3940439">q</span><span class="op" id="3940440">.</span><span class="ident" id="3940441">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940449">q</span><span class="op" id="3940450">.</span><span class="ident" id="3940451">line</span>&nbsp;<span class="op" id="3940456">=</span>&nbsp;<span class="ident" id="3940458">bytes</span><span class="op" id="3940463">.</span><span class="ident" id="3940464">TrimRightFunc</span><span class="op" id="3940477">(</span><span class="ident" id="3940478">wholeLine</span><span class="op" id="3940487">,</span>&nbsp;<span class="ident" id="3940489">isQPDiscardWhitespace</span><span class="op" id="3940510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940515">if</span>&nbsp;<span class="ident" id="3940518">bytes</span><span class="op" id="3940523">.</span><span class="ident" id="3940524">HasSuffix</span><span class="op" id="3940533">(</span><span class="ident" id="3940534">q</span><span class="op" id="3940535">.</span><span class="ident" id="3940536">line</span><span class="op" id="3940540">,</span>&nbsp;<span class="ident" id="3940542">softSuffix</span><span class="op" id="3940552">)</span>&nbsp;<span class="op" id="3940554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940560">rightStripped</span>&nbsp;<span class="op" id="3940574">:=</span>&nbsp;<span class="ident" id="3940577">wholeLine</span><span class="op" id="3940586">[</span><span class="builtinfunc" id="3940587">len</span><span class="op" id="3940590">(</span><span class="ident" id="3940591">q</span><span class="op" id="3940592">.</span><span class="ident" id="3940593">line</span><span class="op" id="3940597">)</span><span class="op" id="3940598">:</span><span class="op" id="3940599">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940605">q</span><span class="op" id="3940606">.</span><span class="ident" id="3940607">line</span>&nbsp;<span class="op" id="3940612">=</span>&nbsp;<span class="ident" id="3940614">q</span><span class="op" id="3940615">.</span><span class="ident" id="3940616">line</span><span class="op" id="3940620">[</span><span class="op" id="3940621">:</span><span class="builtinfunc" id="3940622">len</span><span class="op" id="3940625">(</span><span class="ident" id="3940626">q</span><span class="op" id="3940627">.</span><span class="ident" id="3940628">line</span><span class="op" id="3940632">)</span><span class="op" id="3940633">-</span><span class="num" id="3940634">1</span><span class="op" id="3940635">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940641">if</span>&nbsp;<span class="op" id="3940644">!</span><span class="ident" id="3940645">bytes</span><span class="op" id="3940650">.</span><span class="ident" id="3940651">HasPrefix</span><span class="op" id="3940660">(</span><span class="ident" id="3940661">rightStripped</span><span class="op" id="3940674">,</span>&nbsp;<span class="ident" id="3940676">lf</span><span class="op" id="3940678">)</span>&nbsp;<span class="op" id="3940680">&amp;&amp;</span>&nbsp;<span class="op" id="3940683">!</span><span class="ident" id="3940684">bytes</span><span class="op" id="3940689">.</span><span class="ident" id="3940690">HasPrefix</span><span class="op" id="3940699">(</span><span class="ident" id="3940700">rightStripped</span><span class="op" id="3940713">,</span>&nbsp;<span class="ident" id="3940715">crlf</span><span class="op" id="3940719">)</span>&nbsp;<span class="op" id="3940721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940728">q</span><span class="op" id="3940729">.</span><span class="ident" id="3940730">rerr</span>&nbsp;<span class="op" id="3940735">=</span>&nbsp;<span class="ident" id="3940737">fmt</span><span class="op" id="3940740">.</span><span class="ident" id="3940741">Errorf</span><span class="op" id="3940747">(</span><span class="string" id="3940748">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3940786">,</span>&nbsp;<span class="ident" id="3940788">rightStripped</span><span class="op" id="3940801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940812">}</span>&nbsp;<span class="keyword" id="3940814">else</span>&nbsp;<span class="keyword" id="3940819">if</span>&nbsp;<span class="ident" id="3940822">hasLF</span>&nbsp;<span class="op" id="3940828">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940834">if</span>&nbsp;<span class="ident" id="3940837">hasCR</span>&nbsp;<span class="op" id="3940843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940850">q</span><span class="op" id="3940851">.</span><span class="ident" id="3940852">line</span>&nbsp;<span class="op" id="3940857">=</span>&nbsp;<span class="builtinfunc" id="3940859">append</span><span class="op" id="3940865">(</span><span class="ident" id="3940866">q</span><span class="op" id="3940867">.</span><span class="ident" id="3940868">line</span><span class="op" id="3940872">,</span>&nbsp;<span class="string" id="3940874">&#39;\r&#39;</span><span class="op" id="3940878">,</span>&nbsp;<span class="string" id="3940880">&#39;\n&#39;</span><span class="op" id="3940884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940890">}</span>&nbsp;<span class="keyword" id="3940892">else</span>&nbsp;<span class="op" id="3940897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940904">q</span><span class="op" id="3940905">.</span><span class="ident" id="3940906">line</span>&nbsp;<span class="op" id="3940911">=</span>&nbsp;<span class="builtinfunc" id="3940913">append</span><span class="op" id="3940919">(</span><span class="ident" id="3940920">q</span><span class="op" id="3940921">.</span><span class="ident" id="3940922">line</span><span class="op" id="3940926">,</span>&nbsp;<span class="string" id="3940928">&#39;\n&#39;</span><span class="op" id="3940932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940938">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940948">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3940959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940963">b</span>&nbsp;<span class="op" id="3940965">:=</span>&nbsp;<span class="ident" id="3940968">q</span><span class="op" id="3940969">.</span><span class="ident" id="3940970">line</span><span class="op" id="3940974">[</span><span class="num" id="3940975">0</span><span class="op" id="3940976">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940981">switch</span>&nbsp;<span class="op" id="3940988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3940992">case</span>&nbsp;<span class="ident" id="3940997">b</span>&nbsp;<span class="op" id="3940999">==</span>&nbsp;<span class="string" id="3941002">&#39;=&#39;</span><span class="op" id="3941005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941010">b</span><span class="op" id="3941011">,</span>&nbsp;<span class="ident" id="3941013">err</span>&nbsp;<span class="op" id="3941017">=</span>&nbsp;<span class="ident" id="3941019">q</span><span class="op" id="3941020">.</span><span class="ident" id="3941021">readHexByte</span><span class="op" id="3941032">(</span><span class="ident" id="3941033">q</span><span class="op" id="3941034">.</span><span class="ident" id="3941035">line</span><span class="op" id="3941039">[</span><span class="num" id="3941040">1</span><span class="op" id="3941041">:</span><span class="op" id="3941042">]</span><span class="op" id="3941043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941048">if</span>&nbsp;<span class="ident" id="3941051">err</span>&nbsp;<span class="op" id="3941055">!=</span>&nbsp;<span class="builtintype" id="3941058">nil</span>&nbsp;<span class="op" id="3941062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941068">return</span>&nbsp;<span class="ident" id="3941075">n</span><span class="op" id="3941076">,</span>&nbsp;<span class="ident" id="3941078">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3941085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941090">q</span><span class="op" id="3941091">.</span><span class="ident" id="3941092">line</span>&nbsp;<span class="op" id="3941097">=</span>&nbsp;<span class="ident" id="3941099">q</span><span class="op" id="3941100">.</span><span class="ident" id="3941101">line</span><span class="op" id="3941105">[</span><span class="num" id="3941106">2</span><span class="op" id="3941107">:</span><span class="op" id="3941108">]</span>&nbsp;<span class="comment" id="3941110">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941149">case</span>&nbsp;<span class="ident" id="3941154">b</span>&nbsp;<span class="op" id="3941156">==</span>&nbsp;<span class="string" id="3941159">&#39;\t&#39;</span>&nbsp;<span class="op" id="3941164">||</span>&nbsp;<span class="ident" id="3941167">b</span>&nbsp;<span class="op" id="3941169">==</span>&nbsp;<span class="string" id="3941172">&#39;\r&#39;</span>&nbsp;<span class="op" id="3941177">||</span>&nbsp;<span class="ident" id="3941180">b</span>&nbsp;<span class="op" id="3941182">==</span>&nbsp;<span class="string" id="3941185">&#39;\n&#39;</span><span class="op" id="3941189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941194">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941202">case</span>&nbsp;<span class="ident" id="3941207">b</span>&nbsp;<span class="op" id="3941209">&lt;</span>&nbsp;<span class="string" id="3941211">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3941215">||</span>&nbsp;<span class="ident" id="3941218">b</span>&nbsp;<span class="op" id="3941220">&gt;</span>&nbsp;<span class="string" id="3941222">&#39;~&#39;</span><span class="op" id="3941225">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941230">return</span>&nbsp;<span class="ident" id="3941237">n</span><span class="op" id="3941238">,</span>&nbsp;<span class="ident" id="3941240">fmt</span><span class="op" id="3941243">.</span><span class="ident" id="3941244">Errorf</span><span class="op" id="3941250">(</span><span class="string" id="3941251">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3941318">,</span>&nbsp;<span class="ident" id="3941320">b</span><span class="op" id="3941321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3941325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941329">p</span><span class="op" id="3941330">[</span><span class="num" id="3941331">0</span><span class="op" id="3941332">]</span>&nbsp;<span class="op" id="3941334">=</span>&nbsp;<span class="ident" id="3941336">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941340">p</span>&nbsp;<span class="op" id="3941342">=</span>&nbsp;<span class="ident" id="3941344">p</span><span class="op" id="3941345">[</span><span class="num" id="3941346">1</span><span class="op" id="3941347">:</span><span class="op" id="3941348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941352">q</span><span class="op" id="3941353">.</span><span class="ident" id="3941354">line</span>&nbsp;<span class="op" id="3941359">=</span>&nbsp;<span class="ident" id="3941361">q</span><span class="op" id="3941362">.</span><span class="ident" id="3941363">line</span><span class="op" id="3941367">[</span><span class="num" id="3941368">1</span><span class="op" id="3941369">:</span><span class="op" id="3941370">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3941374">n</span><span class="op" id="3941375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3941379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3941382">return</span>&nbsp;<span class="ident" id="3941389">n</span><span class="op" id="3941390">,</span>&nbsp;<span class="builtintype" id="3941392">nil</span><br>
<span class="lineno"></span><span class="op" id="3941396">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
