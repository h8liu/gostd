<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4821689">package</span>&nbsp;<span class="ident" id="4821697">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4821704">import</span>&nbsp;<span class="op" id="4821711">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821714">&#34;bytes&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4821724">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="4821742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4821745">type</span>&nbsp;<span class="ident" id="4821750">writer</span>&nbsp;<span class="keyword" id="4821757">struct</span>&nbsp;<span class="op" id="4821764">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821767">buf</span>&nbsp;<span class="op" id="4821771">*</span><span class="ident" id="4821772">bytes</span><span class="op" id="4821777">.</span><span class="ident" id="4821778">Buffer</span><br>
<span class="lineno"></span><span class="op" id="4821785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4821788">func</span>&nbsp;<span class="ident" id="4821793">newWriter</span><span class="op" id="4821802">(</span><span class="op" id="4821803">)</span>&nbsp;<span class="op" id="4821805">*</span><span class="ident" id="4821806">writer</span>&nbsp;<span class="op" id="4821813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821816">ret</span>&nbsp;<span class="op" id="4821820">:=</span>&nbsp;<span class="builtinfunc" id="4821823">new</span><span class="op" id="4821826">(</span><span class="ident" id="4821827">writer</span><span class="op" id="4821833">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821836">ret</span><span class="op" id="4821839">.</span><span class="ident" id="4821840">buf</span>&nbsp;<span class="op" id="4821844">=</span>&nbsp;<span class="builtinfunc" id="4821846">new</span><span class="op" id="4821849">(</span><span class="ident" id="4821850">bytes</span><span class="op" id="4821855">.</span><span class="ident" id="4821856">Buffer</span><span class="op" id="4821862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821865">return</span>&nbsp;<span class="ident" id="4821872">ret</span><br>
<span class="lineno"></span><span class="op" id="4821876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4821879">func</span>&nbsp;<span class="op" id="4821884">(</span><span class="ident" id="4821885">w</span>&nbsp;<span class="op" id="4821887">*</span><span class="ident" id="4821888">writer</span><span class="op" id="4821894">)</span>&nbsp;<span class="ident" id="4821896">writeU32</span><span class="op" id="4821904">(</span><span class="ident" id="4821905">u</span>&nbsp;<span class="builtintype" id="4821907">uint32</span><span class="op" id="4821913">)</span>&nbsp;<span class="op" id="4821915">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821918">var</span>&nbsp;<span class="ident" id="4821922">b</span>&nbsp;<span class="op" id="4821924">[</span><span class="num" id="4821925">4</span><span class="op" id="4821926">]</span><span class="builtintype" id="4821927">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821933">binary</span><span class="op" id="4821939">.</span><span class="ident" id="4821940">LittleEndian</span><span class="op" id="4821952">.</span><span class="ident" id="4821953">PutUint32</span><span class="op" id="4821962">(</span><span class="ident" id="4821963">b</span><span class="op" id="4821964">[</span><span class="op" id="4821965">:</span><span class="op" id="4821966">]</span><span class="op" id="4821967">,</span>&nbsp;<span class="ident" id="4821969">u</span><span class="op" id="4821970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821973">_</span><span class="op" id="4821974">,</span>&nbsp;<span class="ident" id="4821976">e</span>&nbsp;<span class="op" id="4821978">:=</span>&nbsp;<span class="ident" id="4821981">w</span><span class="op" id="4821982">.</span><span class="ident" id="4821983">buf</span><span class="op" id="4821986">.</span><span class="ident" id="4821987">Write</span><span class="op" id="4821992">(</span><span class="ident" id="4821993">b</span><span class="op" id="4821994">[</span><span class="op" id="4821995">:</span><span class="op" id="4821996">]</span><span class="op" id="4821997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822000">if</span>&nbsp;<span class="ident" id="4822003">e</span>&nbsp;<span class="op" id="4822005">!=</span>&nbsp;<span class="ident" id="4822008">nil</span>&nbsp;<span class="op" id="4822012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4822016">panic</span><span class="op" id="4822021">(</span><span class="string" id="4822022">&#34;buf&nbsp;write&#34;</span><span class="op" id="4822033">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822036">}</span><br>
<span class="lineno"></span><span class="op" id="4822038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4822041">func</span>&nbsp;<span class="op" id="4822046">(</span><span class="ident" id="4822047">w</span>&nbsp;<span class="op" id="4822049">*</span><span class="ident" id="4822050">writer</span><span class="op" id="4822056">)</span>&nbsp;<span class="ident" id="4822058">writeBareFunc</span><span class="op" id="4822071">(</span><span class="ident" id="4822072">f</span>&nbsp;<span class="op" id="4822074">*</span><span class="ident" id="4822075">Func</span><span class="op" id="4822079">)</span>&nbsp;<span class="op" id="4822081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822084">if</span>&nbsp;<span class="builtinfunc" id="4822087">len</span><span class="op" id="4822090">(</span><span class="ident" id="4822091">f</span><span class="op" id="4822092">.</span><span class="ident" id="4822093">links</span><span class="op" id="4822098">)</span>&nbsp;<span class="op" id="4822100">!=</span>&nbsp;<span class="num" id="4822103">0</span>&nbsp;<span class="op" id="4822105">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4822109">panic</span><span class="op" id="4822114">(</span><span class="string" id="4822115">&#34;not&nbsp;a&nbsp;bare&nbsp;function&#34;</span><span class="op" id="4822136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822143">for</span>&nbsp;<span class="ident" id="4822147">_</span><span class="op" id="4822148">,</span>&nbsp;<span class="ident" id="4822150">i</span>&nbsp;<span class="op" id="4822152">:=</span>&nbsp;<span class="keyword" id="4822155">range</span>&nbsp;<span class="ident" id="4822161">f</span><span class="op" id="4822162">.</span><span class="ident" id="4822163">insts</span>&nbsp;<span class="op" id="4822169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822173">w</span><span class="op" id="4822174">.</span><span class="ident" id="4822175">writeU32</span><span class="op" id="4822183">(</span><span class="ident" id="4822184">i</span><span class="op" id="4822185">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822188">}</span><br>
<span class="lineno"></span><span class="op" id="4822190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4822193">func</span>&nbsp;<span class="op" id="4822198">(</span><span class="ident" id="4822199">w</span>&nbsp;<span class="op" id="4822201">*</span><span class="ident" id="4822202">writer</span><span class="op" id="4822208">)</span>&nbsp;<span class="ident" id="4822210">bytes</span><span class="op" id="4822215">(</span><span class="op" id="4822216">)</span>&nbsp;<span class="op" id="4822218">[</span><span class="op" id="4822219">]</span><span class="builtintype" id="4822220">byte</span>&nbsp;<span class="op" id="4822225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822228">return</span>&nbsp;<span class="ident" id="4822235">w</span><span class="op" id="4822236">.</span><span class="ident" id="4822237">buf</span><span class="op" id="4822240">.</span><span class="ident" id="4822241">Bytes</span><span class="op" id="4822246">(</span><span class="op" id="4822247">)</span><br>
<span class="lineno">40</span><span class="op" id="4822249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4822252">func</span>&nbsp;<span class="ident" id="4822257">writeVar</span><span class="op" id="4822265">(</span><span class="ident" id="4822266">w</span>&nbsp;<span class="op" id="4822268">*</span><span class="ident" id="4822269">writer</span><span class="op" id="4822275">,</span>&nbsp;<span class="ident" id="4822277">v</span>&nbsp;<span class="op" id="4822279">*</span><span class="ident" id="4822280">Var</span><span class="op" id="4822283">)</span>&nbsp;<span class="op" id="4822285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822288">w</span><span class="op" id="4822289">.</span><span class="ident" id="4822290">buf</span><span class="op" id="4822293">.</span><span class="ident" id="4822294">Write</span><span class="op" id="4822299">(</span><span class="builtinfunc" id="4822300">make</span><span class="op" id="4822304">(</span><span class="op" id="4822305">[</span><span class="op" id="4822306">]</span><span class="builtintype" id="4822307">byte</span><span class="op" id="4822311">,</span>&nbsp;<span class="ident" id="4822313">v</span><span class="op" id="4822314">.</span><span class="ident" id="4822315">prePad</span><span class="op" id="4822321">)</span><span class="op" id="4822322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822325">w</span><span class="op" id="4822326">.</span><span class="ident" id="4822327">buf</span><span class="op" id="4822330">.</span><span class="ident" id="4822331">Write</span><span class="op" id="4822336">(</span><span class="ident" id="4822337">v</span><span class="op" id="4822338">.</span><span class="ident" id="4822339">buf</span><span class="op" id="4822342">.</span><span class="ident" id="4822343">Bytes</span><span class="op" id="4822348">(</span><span class="op" id="4822349">)</span><span class="op" id="4822350">)</span><br>
<span class="lineno">45</span><span class="op" id="4822352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4822355">func</span>&nbsp;<span class="ident" id="4822360">writeFunc</span><span class="op" id="4822369">(</span><span class="ident" id="4822370">w</span>&nbsp;<span class="op" id="4822372">*</span><span class="ident" id="4822373">writer</span><span class="op" id="4822379">,</span>&nbsp;<span class="ident" id="4822381">p</span>&nbsp;<span class="op" id="4822383">*</span><span class="ident" id="4822384">Package</span><span class="op" id="4822391">,</span>&nbsp;<span class="ident" id="4822393">f</span>&nbsp;<span class="op" id="4822395">*</span><span class="ident" id="4822396">Func</span><span class="op" id="4822400">)</span>&nbsp;<span class="op" id="4822402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822405">cur</span>&nbsp;<span class="op" id="4822409">:=</span>&nbsp;<span class="num" id="4822412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822415">var</span>&nbsp;<span class="ident" id="4822419">curLink</span>&nbsp;<span class="op" id="4822427">*</span><span class="ident" id="4822428">link</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822434">var</span>&nbsp;<span class="ident" id="4822438">curIndex</span>&nbsp;<span class="builtintype" id="4822447">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822452">updateCur</span>&nbsp;<span class="op" id="4822462">:=</span>&nbsp;<span class="keyword" id="4822465">func</span><span class="op" id="4822469">(</span><span class="op" id="4822470">)</span>&nbsp;<span class="op" id="4822472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822476">if</span>&nbsp;<span class="ident" id="4822479">cur</span>&nbsp;<span class="op" id="4822483">&lt;</span>&nbsp;<span class="builtinfunc" id="4822485">len</span><span class="op" id="4822488">(</span><span class="ident" id="4822489">f</span><span class="op" id="4822490">.</span><span class="ident" id="4822491">links</span><span class="op" id="4822496">)</span>&nbsp;<span class="op" id="4822498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822503">curLink</span>&nbsp;<span class="op" id="4822511">=</span>&nbsp;<span class="ident" id="4822513">f</span><span class="op" id="4822514">.</span><span class="ident" id="4822515">links</span><span class="op" id="4822520">[</span><span class="ident" id="4822521">cur</span><span class="op" id="4822524">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822529">curIndex</span>&nbsp;<span class="op" id="4822538">=</span>&nbsp;<span class="builtintype" id="4822540">int</span><span class="op" id="4822543">(</span><span class="ident" id="4822544">curLink</span><span class="op" id="4822551">.</span><span class="ident" id="4822552">offset</span>&nbsp;<span class="op" id="4822559">&gt;&gt;</span>&nbsp;<span class="num" id="4822562">2</span><span class="op" id="4822563">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822574">updateCur</span><span class="op" id="4822583">(</span><span class="op" id="4822584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822587">for</span>&nbsp;<span class="ident" id="4822591">i</span><span class="op" id="4822592">,</span>&nbsp;<span class="ident" id="4822594">inst</span>&nbsp;<span class="op" id="4822599">:=</span>&nbsp;<span class="keyword" id="4822602">range</span>&nbsp;<span class="ident" id="4822608">f</span><span class="op" id="4822609">.</span><span class="ident" id="4822610">insts</span>&nbsp;<span class="op" id="4822616">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822620">if</span>&nbsp;<span class="ident" id="4822623">curLink</span>&nbsp;<span class="op" id="4822631">!=</span>&nbsp;<span class="ident" id="4822634">nil</span>&nbsp;<span class="op" id="4822638">&amp;&amp;</span>&nbsp;<span class="ident" id="4822641">i</span>&nbsp;<span class="op" id="4822643">==</span>&nbsp;<span class="ident" id="4822646">curIndex</span>&nbsp;<span class="op" id="4822655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822660">fill</span>&nbsp;<span class="op" id="4822665">:=</span>&nbsp;<span class="ident" id="4822668">curLink</span><span class="op" id="4822675">.</span><span class="ident" id="4822676">offset</span>&nbsp;<span class="op" id="4822683">&amp;</span>&nbsp;<span class="num" id="4822685">0x3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822692">if</span>&nbsp;<span class="ident" id="4822695">fill</span>&nbsp;<span class="op" id="4822700">==</span>&nbsp;<span class="ident" id="4822703">FillLink</span>&nbsp;<span class="op" id="4822712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822718">if</span>&nbsp;<span class="op" id="4822721">(</span><span class="ident" id="4822722">inst</span>&nbsp;<span class="op" id="4822727">&gt;&gt;</span>&nbsp;<span class="num" id="4822730">31</span><span class="op" id="4822732">)</span>&nbsp;<span class="op" id="4822734">!=</span>&nbsp;<span class="num" id="4822737">0x1</span>&nbsp;<span class="op" id="4822741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4822748">panic</span><span class="op" id="4822753">(</span><span class="string" id="4822754">&#34;not&nbsp;a&nbsp;jump&#34;</span><span class="op" id="4822766">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822778">if</span>&nbsp;<span class="op" id="4822781">(</span><span class="ident" id="4822782">inst</span>&nbsp;<span class="op" id="4822787">&amp;</span>&nbsp;<span class="num" id="4822789">0x3fffffff</span><span class="op" id="4822799">)</span>&nbsp;<span class="op" id="4822801">!=</span>&nbsp;<span class="num" id="4822804">0</span>&nbsp;<span class="op" id="4822806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4822813">panic</span><span class="op" id="4822818">(</span><span class="string" id="4822819">&#34;already&nbsp;filled&#34;</span><span class="op" id="4822835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822848">pc</span>&nbsp;<span class="op" id="4822851">:=</span>&nbsp;<span class="ident" id="4822854">f</span><span class="op" id="4822855">.</span><span class="ident" id="4822856">addr</span>&nbsp;<span class="op" id="4822861">+</span>&nbsp;<span class="builtintype" id="4822863">uint32</span><span class="op" id="4822869">(</span><span class="ident" id="4822870">i</span><span class="op" id="4822871">)</span><span class="op" id="4822872">*</span><span class="num" id="4822873">4</span>&nbsp;<span class="op" id="4822875">+</span>&nbsp;<span class="num" id="4822877">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822883">target</span>&nbsp;<span class="op" id="4822890">:=</span>&nbsp;<span class="ident" id="4822893">p</span><span class="op" id="4822894">.</span><span class="ident" id="4822895">requires</span><span class="op" id="4822903">[</span><span class="ident" id="4822904">curLink</span><span class="op" id="4822911">.</span><span class="ident" id="4822912">pkg</span><span class="op" id="4822915">]</span><span class="op" id="4822916">.</span><span class="ident" id="4822917">Func</span><span class="op" id="4822921">(</span><span class="ident" id="4822922">curLink</span><span class="op" id="4822929">.</span><span class="ident" id="4822930">sym</span><span class="op" id="4822933">)</span><span class="op" id="4822934">.</span><span class="ident" id="4822935">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822944">inst</span>&nbsp;<span class="op" id="4822949">|=</span>&nbsp;<span class="op" id="4822952">(</span><span class="ident" id="4822953">target</span>&nbsp;<span class="op" id="4822960">-</span>&nbsp;<span class="ident" id="4822962">pc</span><span class="op" id="4822964">)</span>&nbsp;<span class="op" id="4822966">&gt;&gt;</span>&nbsp;<span class="num" id="4822969">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4822974">}</span>&nbsp;<span class="keyword" id="4822976">else</span>&nbsp;<span class="keyword" id="4822981">if</span>&nbsp;<span class="ident" id="4822984">fill</span>&nbsp;<span class="op" id="4822989">==</span>&nbsp;<span class="ident" id="4822992">FillHigh</span>&nbsp;<span class="op" id="4823001">||</span>&nbsp;<span class="ident" id="4823004">fill</span>&nbsp;<span class="op" id="4823009">==</span>&nbsp;<span class="ident" id="4823012">FillLow</span>&nbsp;<span class="op" id="4823020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823026">if</span>&nbsp;<span class="op" id="4823029">(</span><span class="ident" id="4823030">inst</span>&nbsp;<span class="op" id="4823035">&amp;</span>&nbsp;<span class="num" id="4823037">0xffff</span><span class="op" id="4823043">)</span>&nbsp;<span class="op" id="4823045">!=</span>&nbsp;<span class="num" id="4823048">0</span>&nbsp;<span class="op" id="4823050">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4823057">panic</span><span class="op" id="4823062">(</span><span class="string" id="4823063">&#34;already&nbsp;filled&#34;</span><span class="op" id="4823079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823092">pkg</span>&nbsp;<span class="op" id="4823096">:=</span>&nbsp;<span class="ident" id="4823099">p</span><span class="op" id="4823100">.</span><span class="ident" id="4823101">requires</span><span class="op" id="4823109">[</span><span class="ident" id="4823110">curLink</span><span class="op" id="4823117">.</span><span class="ident" id="4823118">pkg</span><span class="op" id="4823121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823127">sym</span>&nbsp;<span class="op" id="4823131">:=</span>&nbsp;<span class="ident" id="4823134">pkg</span><span class="op" id="4823137">.</span><span class="ident" id="4823138">symbols</span><span class="op" id="4823145">[</span><span class="ident" id="4823146">curLink</span><span class="op" id="4823153">.</span><span class="ident" id="4823154">sym</span><span class="op" id="4823157">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823163">var</span>&nbsp;<span class="ident" id="4823167">v</span>&nbsp;<span class="builtintype" id="4823169">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823180">switch</span>&nbsp;<span class="ident" id="4823187">sym</span><span class="op" id="4823190">.</span><span class="ident" id="4823191">Type</span>&nbsp;<span class="op" id="4823196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823202">case</span>&nbsp;<span class="ident" id="4823207">SymFunc</span><span class="op" id="4823214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823221">v</span>&nbsp;<span class="op" id="4823223">=</span>&nbsp;<span class="ident" id="4823225">pkg</span><span class="op" id="4823228">.</span><span class="ident" id="4823229">Func</span><span class="op" id="4823233">(</span><span class="ident" id="4823234">curLink</span><span class="op" id="4823241">.</span><span class="ident" id="4823242">sym</span><span class="op" id="4823245">)</span><span class="op" id="4823246">.</span><span class="ident" id="4823247">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823256">case</span>&nbsp;<span class="ident" id="4823261">SymVar</span><span class="op" id="4823267">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823274">v</span>&nbsp;<span class="op" id="4823276">=</span>&nbsp;<span class="ident" id="4823278">pkg</span><span class="op" id="4823281">.</span><span class="ident" id="4823282">Var</span><span class="op" id="4823285">(</span><span class="ident" id="4823286">curLink</span><span class="op" id="4823293">.</span><span class="ident" id="4823294">sym</span><span class="op" id="4823297">)</span><span class="op" id="4823298">.</span><span class="ident" id="4823299">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823308">default</span><span class="op" id="4823315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4823322">panic</span><span class="op" id="4823327">(</span><span class="string" id="4823328">&#34;bug&#34;</span><span class="op" id="4823333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823346">if</span>&nbsp;<span class="ident" id="4823349">fill</span>&nbsp;<span class="op" id="4823354">==</span>&nbsp;<span class="ident" id="4823357">FillHigh</span>&nbsp;<span class="op" id="4823366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823373">inst</span>&nbsp;<span class="op" id="4823378">|=</span>&nbsp;<span class="ident" id="4823381">v</span>&nbsp;<span class="op" id="4823383">&gt;&gt;</span>&nbsp;<span class="num" id="4823386">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823393">}</span>&nbsp;<span class="keyword" id="4823395">else</span>&nbsp;<span class="op" id="4823400">{</span>&nbsp;<span class="comment" id="4823402">//&nbsp;fillLow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823418">inst</span>&nbsp;<span class="op" id="4823423">|=</span>&nbsp;<span class="ident" id="4823426">v</span>&nbsp;<span class="op" id="4823428">&amp;</span>&nbsp;<span class="num" id="4823430">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823441">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823446">}</span>&nbsp;<span class="keyword" id="4823448">else</span>&nbsp;<span class="op" id="4823453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4823459">panic</span><span class="op" id="4823464">(</span><span class="string" id="4823465">&#34;invalid&nbsp;fill&#34;</span><span class="op" id="4823479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823490">cur</span><span class="op" id="4823493">++</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823499">updateCur</span><span class="op" id="4823508">(</span><span class="op" id="4823509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823518">w</span><span class="op" id="4823519">.</span><span class="ident" id="4823520">writeU32</span><span class="op" id="4823528">(</span><span class="ident" id="4823529">inst</span><span class="op" id="4823533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823536">}</span><br>
<span class="lineno">105</span><span class="op" id="4823538">}</span>
</div>
</body>
</html>
