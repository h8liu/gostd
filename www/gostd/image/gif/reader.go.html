<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6187130">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6187185">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6187239">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6187290">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6187349">//</span><br>
<span class="lineno"></span><span class="comment" id="6187352">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6187431">package</span>&nbsp;<span class="ident" id="6187439">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6187444">import</span>&nbsp;<span class="op" id="6187451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187454">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187463">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187479">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187489">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187496">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187505">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6187520">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6187525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6187528">var</span>&nbsp;<span class="op" id="6187532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187535">errNotEnough</span>&nbsp;<span class="op" id="6187548">=</span>&nbsp;<span class="ident" id="6187550">errors</span><span class="op" id="6187556">.</span><span class="ident" id="6187557">New</span><span class="op" id="6187560">(</span><span class="string" id="6187561">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6187589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187592">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6187605">=</span>&nbsp;<span class="ident" id="6187607">errors</span><span class="op" id="6187613">.</span><span class="ident" id="6187614">New</span><span class="op" id="6187617">(</span><span class="string" id="6187618">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6187644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187647">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6187660">=</span>&nbsp;<span class="ident" id="6187662">errors</span><span class="op" id="6187668">.</span><span class="ident" id="6187669">New</span><span class="op" id="6187672">(</span><span class="string" id="6187673">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6187699">)</span><br>
<span class="lineno"></span><span class="op" id="6187701">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6187704">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6187799">type</span>&nbsp;<span class="ident" id="6187804">reader</span>&nbsp;<span class="keyword" id="6187811">interface</span>&nbsp;<span class="op" id="6187821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187824">io</span><span class="op" id="6187826">.</span><span class="ident" id="6187827">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187835">io</span><span class="op" id="6187837">.</span><span class="ident" id="6187838">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6187849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6187852">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6187866">const</span>&nbsp;<span class="op" id="6187872">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187875">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187887">fColorMapFollows</span>&nbsp;<span class="op" id="6187904">=</span>&nbsp;<span class="num" id="6187906">1</span>&nbsp;<span class="op" id="6187908">&lt;&lt;</span>&nbsp;<span class="num" id="6187911">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187915">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187933">ifLocalColorTable</span>&nbsp;<span class="op" id="6187951">=</span>&nbsp;<span class="num" id="6187953">1</span>&nbsp;<span class="op" id="6187955">&lt;&lt;</span>&nbsp;<span class="num" id="6187958">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187961">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6187979">=</span>&nbsp;<span class="num" id="6187981">1</span>&nbsp;<span class="op" id="6187983">&lt;&lt;</span>&nbsp;<span class="num" id="6187986">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187989">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6188007">=</span>&nbsp;<span class="num" id="6188009">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188013">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188040">gcTransparentColorSet</span>&nbsp;<span class="op" id="6188062">=</span>&nbsp;<span class="num" id="6188064">1</span>&nbsp;<span class="op" id="6188066">&lt;&lt;</span>&nbsp;<span class="num" id="6188069">0</span><br>
<span class="lineno"></span><span class="op" id="6188071">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6188074">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6188097">const</span>&nbsp;<span class="op" id="6188103">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188106">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188123">=</span>&nbsp;<span class="num" id="6188125">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188131">sImageDescriptor</span>&nbsp;<span class="op" id="6188148">=</span>&nbsp;<span class="num" id="6188150">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188156">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188173">=</span>&nbsp;<span class="num" id="6188175">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6188180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6188183">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6188198">const</span>&nbsp;<span class="op" id="6188204">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188207">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188223">=</span>&nbsp;<span class="num" id="6188225">0x01</span>&nbsp;<span class="comment" id="6188230">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188245">eGraphicControl</span>&nbsp;<span class="op" id="6188261">=</span>&nbsp;<span class="num" id="6188263">0xF9</span>&nbsp;<span class="comment" id="6188268">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188288">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188304">=</span>&nbsp;<span class="num" id="6188306">0xFE</span>&nbsp;<span class="comment" id="6188311">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188323">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188339">=</span>&nbsp;<span class="num" id="6188341">0xFF</span>&nbsp;<span class="comment" id="6188346">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6188361">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6188364">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6188414">type</span>&nbsp;<span class="ident" id="6188419">decoder</span>&nbsp;<span class="keyword" id="6188427">struct</span>&nbsp;<span class="op" id="6188434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188437">r</span>&nbsp;<span class="ident" id="6188439">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188448">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188465">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188481">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188489">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188505">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188510">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188526">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188531">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188547">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188553">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188569">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188575">backgroundIndex</span>&nbsp;<span class="builtintype" id="6188591">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188597">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188613">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188618">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188634">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188640">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188664">aspect</span>&nbsp;<span class="builtintype" id="6188671">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188678">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188705">imageFields</span>&nbsp;<span class="builtintype" id="6188717">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188724">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188751">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188771">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188777">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6188797">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188804">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188818">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6188833">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188839">globalColorMap</span>&nbsp;<span class="ident" id="6188854">color</span><span class="op" id="6188859">.</span><span class="ident" id="6188860">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188870">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188894">delay</span>&nbsp;<span class="op" id="6188900">[</span><span class="op" id="6188901">]</span><span class="builtintype" id="6188902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188907">image</span>&nbsp;<span class="op" id="6188913">[</span><span class="op" id="6188914">]</span><span class="op" id="6188915">*</span><span class="ident" id="6188916">image</span><span class="op" id="6188921">.</span><span class="ident" id="6188922">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188932">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6188938">[</span><span class="num" id="6188939">1024</span><span class="op" id="6188943">]</span><span class="builtintype" id="6188944">byte</span>&nbsp;<span class="comment" id="6188949">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6188998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6189001">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6189068">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6189135">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6189199">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6189269">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6189338">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6189367">type</span>&nbsp;<span class="ident" id="6189372">blockReader</span>&nbsp;<span class="keyword" id="6189384">struct</span>&nbsp;<span class="op" id="6189391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189394">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189400">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189408">slice</span>&nbsp;<span class="op" id="6189414">[</span><span class="op" id="6189415">]</span><span class="builtintype" id="6189416">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189422">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6189428">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189435">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6189441">[</span><span class="num" id="6189442">256</span><span class="op" id="6189445">]</span><span class="builtintype" id="6189446">byte</span><br>
<span class="lineno"></span><span class="op" id="6189451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6189454">func</span>&nbsp;<span class="op" id="6189459">(</span><span class="ident" id="6189460">b</span>&nbsp;<span class="op" id="6189462">*</span><span class="ident" id="6189463">blockReader</span><span class="op" id="6189474">)</span>&nbsp;<span class="ident" id="6189476">Read</span><span class="op" id="6189480">(</span><span class="ident" id="6189481">p</span>&nbsp;<span class="op" id="6189483">[</span><span class="op" id="6189484">]</span><span class="builtintype" id="6189485">byte</span><span class="op" id="6189489">)</span>&nbsp;<span class="op" id="6189491">(</span><span class="builtintype" id="6189492">int</span><span class="op" id="6189495">,</span>&nbsp;<span class="builtintype" id="6189497">error</span><span class="op" id="6189502">)</span>&nbsp;<span class="op" id="6189504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189507">if</span>&nbsp;<span class="ident" id="6189510">b</span><span class="op" id="6189511">.</span><span class="ident" id="6189512">err</span>&nbsp;<span class="op" id="6189516">!=</span>&nbsp;<span class="ident" id="6189519">nil</span>&nbsp;<span class="op" id="6189523">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189527">return</span>&nbsp;<span class="num" id="6189534">0</span><span class="op" id="6189535">,</span>&nbsp;<span class="ident" id="6189537">b</span><span class="op" id="6189538">.</span><span class="ident" id="6189539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189547">if</span>&nbsp;<span class="builtinfunc" id="6189550">len</span><span class="op" id="6189553">(</span><span class="ident" id="6189554">p</span><span class="op" id="6189555">)</span>&nbsp;<span class="op" id="6189557">==</span>&nbsp;<span class="num" id="6189560">0</span>&nbsp;<span class="op" id="6189562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189566">return</span>&nbsp;<span class="num" id="6189573">0</span><span class="op" id="6189574">,</span>&nbsp;<span class="ident" id="6189576">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189581">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189584">if</span>&nbsp;<span class="builtinfunc" id="6189587">len</span><span class="op" id="6189590">(</span><span class="ident" id="6189591">b</span><span class="op" id="6189592">.</span><span class="ident" id="6189593">slice</span><span class="op" id="6189598">)</span>&nbsp;<span class="op" id="6189600">==</span>&nbsp;<span class="num" id="6189603">0</span>&nbsp;<span class="op" id="6189605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189609">var</span>&nbsp;<span class="ident" id="6189613">blockLen</span>&nbsp;<span class="builtintype" id="6189622">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189630">blockLen</span><span class="op" id="6189638">,</span>&nbsp;<span class="ident" id="6189640">b</span><span class="op" id="6189641">.</span><span class="ident" id="6189642">err</span>&nbsp;<span class="op" id="6189646">=</span>&nbsp;<span class="ident" id="6189648">b</span><span class="op" id="6189649">.</span><span class="ident" id="6189650">r</span><span class="op" id="6189651">.</span><span class="ident" id="6189652">ReadByte</span><span class="op" id="6189660">(</span><span class="op" id="6189661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189665">if</span>&nbsp;<span class="ident" id="6189668">b</span><span class="op" id="6189669">.</span><span class="ident" id="6189670">err</span>&nbsp;<span class="op" id="6189674">!=</span>&nbsp;<span class="ident" id="6189677">nil</span>&nbsp;<span class="op" id="6189681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189686">return</span>&nbsp;<span class="num" id="6189693">0</span><span class="op" id="6189694">,</span>&nbsp;<span class="ident" id="6189696">b</span><span class="op" id="6189697">.</span><span class="ident" id="6189698">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189708">if</span>&nbsp;<span class="ident" id="6189711">blockLen</span>&nbsp;<span class="op" id="6189720">==</span>&nbsp;<span class="num" id="6189723">0</span>&nbsp;<span class="op" id="6189725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189730">b</span><span class="op" id="6189731">.</span><span class="ident" id="6189732">err</span>&nbsp;<span class="op" id="6189736">=</span>&nbsp;<span class="ident" id="6189738">io</span><span class="op" id="6189740">.</span><span class="ident" id="6189741">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189748">return</span>&nbsp;<span class="num" id="6189755">0</span><span class="op" id="6189756">,</span>&nbsp;<span class="ident" id="6189758">b</span><span class="op" id="6189759">.</span><span class="ident" id="6189760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189766">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189770">b</span><span class="op" id="6189771">.</span><span class="ident" id="6189772">slice</span>&nbsp;<span class="op" id="6189778">=</span>&nbsp;<span class="ident" id="6189780">b</span><span class="op" id="6189781">.</span><span class="ident" id="6189782">tmp</span><span class="op" id="6189785">[</span><span class="num" id="6189786">0</span><span class="op" id="6189787">:</span><span class="ident" id="6189788">blockLen</span><span class="op" id="6189796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189800">if</span>&nbsp;<span class="ident" id="6189803">_</span><span class="op" id="6189804">,</span>&nbsp;<span class="ident" id="6189806">b</span><span class="op" id="6189807">.</span><span class="ident" id="6189808">err</span>&nbsp;<span class="op" id="6189812">=</span>&nbsp;<span class="ident" id="6189814">io</span><span class="op" id="6189816">.</span><span class="ident" id="6189817">ReadFull</span><span class="op" id="6189825">(</span><span class="ident" id="6189826">b</span><span class="op" id="6189827">.</span><span class="ident" id="6189828">r</span><span class="op" id="6189829">,</span>&nbsp;<span class="ident" id="6189831">b</span><span class="op" id="6189832">.</span><span class="ident" id="6189833">slice</span><span class="op" id="6189838">)</span><span class="op" id="6189839">;</span>&nbsp;<span class="ident" id="6189841">b</span><span class="op" id="6189842">.</span><span class="ident" id="6189843">err</span>&nbsp;<span class="op" id="6189847">!=</span>&nbsp;<span class="ident" id="6189850">nil</span>&nbsp;<span class="op" id="6189854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189859">return</span>&nbsp;<span class="num" id="6189866">0</span><span class="op" id="6189867">,</span>&nbsp;<span class="ident" id="6189869">b</span><span class="op" id="6189870">.</span><span class="ident" id="6189871">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189880">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189883">n</span>&nbsp;<span class="op" id="6189885">:=</span>&nbsp;<span class="builtinfunc" id="6189888">copy</span><span class="op" id="6189892">(</span><span class="ident" id="6189893">p</span><span class="op" id="6189894">,</span>&nbsp;<span class="ident" id="6189896">b</span><span class="op" id="6189897">.</span><span class="ident" id="6189898">slice</span><span class="op" id="6189903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189906">b</span><span class="op" id="6189907">.</span><span class="ident" id="6189908">slice</span>&nbsp;<span class="op" id="6189914">=</span>&nbsp;<span class="ident" id="6189916">b</span><span class="op" id="6189917">.</span><span class="ident" id="6189918">slice</span><span class="op" id="6189923">[</span><span class="ident" id="6189924">n</span><span class="op" id="6189925">:</span><span class="op" id="6189926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189929">return</span>&nbsp;<span class="ident" id="6189936">n</span><span class="op" id="6189937">,</span>&nbsp;<span class="ident" id="6189939">nil</span><br>
<span class="lineno"></span><span class="op" id="6189943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6189946">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6190009">func</span>&nbsp;<span class="op" id="6190014">(</span><span class="ident" id="6190015">d</span>&nbsp;<span class="op" id="6190017">*</span><span class="ident" id="6190018">decoder</span><span class="op" id="6190025">)</span>&nbsp;<span class="ident" id="6190027">decode</span><span class="op" id="6190033">(</span><span class="ident" id="6190034">r</span>&nbsp;<span class="ident" id="6190036">io</span><span class="op" id="6190038">.</span><span class="ident" id="6190039">Reader</span><span class="op" id="6190045">,</span>&nbsp;<span class="ident" id="6190047">configOnly</span>&nbsp;<span class="builtintype" id="6190058">bool</span><span class="op" id="6190062">)</span>&nbsp;<span class="builtintype" id="6190064">error</span>&nbsp;<span class="op" id="6190070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190073">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190123">if</span>&nbsp;<span class="ident" id="6190126">rr</span><span class="op" id="6190128">,</span>&nbsp;<span class="ident" id="6190130">ok</span>&nbsp;<span class="op" id="6190133">:=</span>&nbsp;<span class="ident" id="6190136">r</span><span class="op" id="6190137">.</span><span class="op" id="6190138">(</span><span class="ident" id="6190139">reader</span><span class="op" id="6190145">)</span><span class="op" id="6190146">;</span>&nbsp;<span class="ident" id="6190148">ok</span>&nbsp;<span class="op" id="6190151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190155">d</span><span class="op" id="6190156">.</span><span class="ident" id="6190157">r</span>&nbsp;<span class="op" id="6190159">=</span>&nbsp;<span class="ident" id="6190161">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190165">}</span>&nbsp;<span class="keyword" id="6190167">else</span>&nbsp;<span class="op" id="6190172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190176">d</span><span class="op" id="6190177">.</span><span class="ident" id="6190178">r</span>&nbsp;<span class="op" id="6190180">=</span>&nbsp;<span class="ident" id="6190182">bufio</span><span class="op" id="6190187">.</span><span class="ident" id="6190188">NewReader</span><span class="op" id="6190197">(</span><span class="ident" id="6190198">r</span><span class="op" id="6190199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190206">err</span>&nbsp;<span class="op" id="6190210">:=</span>&nbsp;<span class="ident" id="6190213">d</span><span class="op" id="6190214">.</span><span class="ident" id="6190215">readHeaderAndScreenDescriptor</span><span class="op" id="6190244">(</span><span class="op" id="6190245">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190248">if</span>&nbsp;<span class="ident" id="6190251">err</span>&nbsp;<span class="op" id="6190255">!=</span>&nbsp;<span class="ident" id="6190258">nil</span>&nbsp;<span class="op" id="6190262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190266">return</span>&nbsp;<span class="ident" id="6190273">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190281">if</span>&nbsp;<span class="ident" id="6190284">configOnly</span>&nbsp;<span class="op" id="6190295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190299">return</span>&nbsp;<span class="ident" id="6190306">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190315">if</span>&nbsp;<span class="ident" id="6190318">d</span><span class="op" id="6190319">.</span><span class="ident" id="6190320">headerFields</span><span class="op" id="6190332">&amp;</span><span class="ident" id="6190333">fColorMapFollows</span>&nbsp;<span class="op" id="6190350">!=</span>&nbsp;<span class="num" id="6190353">0</span>&nbsp;<span class="op" id="6190355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190359">if</span>&nbsp;<span class="ident" id="6190362">d</span><span class="op" id="6190363">.</span><span class="ident" id="6190364">globalColorMap</span><span class="op" id="6190378">,</span>&nbsp;<span class="ident" id="6190380">err</span>&nbsp;<span class="op" id="6190384">=</span>&nbsp;<span class="ident" id="6190386">d</span><span class="op" id="6190387">.</span><span class="ident" id="6190388">readColorMap</span><span class="op" id="6190400">(</span><span class="op" id="6190401">)</span><span class="op" id="6190402">;</span>&nbsp;<span class="ident" id="6190404">err</span>&nbsp;<span class="op" id="6190408">!=</span>&nbsp;<span class="ident" id="6190411">nil</span>&nbsp;<span class="op" id="6190415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190420">return</span>&nbsp;<span class="ident" id="6190427">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190440">for</span>&nbsp;<span class="op" id="6190444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190448">c</span><span class="op" id="6190449">,</span>&nbsp;<span class="ident" id="6190451">err</span>&nbsp;<span class="op" id="6190455">:=</span>&nbsp;<span class="ident" id="6190458">d</span><span class="op" id="6190459">.</span><span class="ident" id="6190460">r</span><span class="op" id="6190461">.</span><span class="ident" id="6190462">ReadByte</span><span class="op" id="6190470">(</span><span class="op" id="6190471">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190475">if</span>&nbsp;<span class="ident" id="6190478">err</span>&nbsp;<span class="op" id="6190482">!=</span>&nbsp;<span class="ident" id="6190485">nil</span>&nbsp;<span class="op" id="6190489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190494">return</span>&nbsp;<span class="ident" id="6190501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190511">switch</span>&nbsp;<span class="ident" id="6190518">c</span>&nbsp;<span class="op" id="6190520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190524">case</span>&nbsp;<span class="ident" id="6190529">sExtension</span><span class="op" id="6190539">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190544">if</span>&nbsp;<span class="ident" id="6190547">err</span>&nbsp;<span class="op" id="6190551">=</span>&nbsp;<span class="ident" id="6190553">d</span><span class="op" id="6190554">.</span><span class="ident" id="6190555">readExtension</span><span class="op" id="6190568">(</span><span class="op" id="6190569">)</span><span class="op" id="6190570">;</span>&nbsp;<span class="ident" id="6190572">err</span>&nbsp;<span class="op" id="6190576">!=</span>&nbsp;<span class="ident" id="6190579">nil</span>&nbsp;<span class="op" id="6190583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190589">return</span>&nbsp;<span class="ident" id="6190596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190608">case</span>&nbsp;<span class="ident" id="6190613">sImageDescriptor</span><span class="op" id="6190629">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190634">m</span><span class="op" id="6190635">,</span>&nbsp;<span class="ident" id="6190637">err</span>&nbsp;<span class="op" id="6190641">:=</span>&nbsp;<span class="ident" id="6190644">d</span><span class="op" id="6190645">.</span><span class="ident" id="6190646">newImageFromDescriptor</span><span class="op" id="6190668">(</span><span class="op" id="6190669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190674">if</span>&nbsp;<span class="ident" id="6190677">err</span>&nbsp;<span class="op" id="6190681">!=</span>&nbsp;<span class="ident" id="6190684">nil</span>&nbsp;<span class="op" id="6190688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190694">return</span>&nbsp;<span class="ident" id="6190701">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190713">useLocalColorMap</span>&nbsp;<span class="op" id="6190730">:=</span>&nbsp;<span class="ident" id="6190733">d</span><span class="op" id="6190734">.</span><span class="ident" id="6190735">imageFields</span><span class="op" id="6190746">&amp;</span><span class="ident" id="6190747">fColorMapFollows</span>&nbsp;<span class="op" id="6190764">!=</span>&nbsp;<span class="num" id="6190767">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190772">if</span>&nbsp;<span class="ident" id="6190775">useLocalColorMap</span>&nbsp;<span class="op" id="6190792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190798">m</span><span class="op" id="6190799">.</span><span class="ident" id="6190800">Palette</span><span class="op" id="6190807">,</span>&nbsp;<span class="ident" id="6190809">err</span>&nbsp;<span class="op" id="6190813">=</span>&nbsp;<span class="ident" id="6190815">d</span><span class="op" id="6190816">.</span><span class="ident" id="6190817">readColorMap</span><span class="op" id="6190829">(</span><span class="op" id="6190830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190836">if</span>&nbsp;<span class="ident" id="6190839">err</span>&nbsp;<span class="op" id="6190843">!=</span>&nbsp;<span class="ident" id="6190846">nil</span>&nbsp;<span class="op" id="6190850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190857">return</span>&nbsp;<span class="ident" id="6190864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190872">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190877">}</span>&nbsp;<span class="keyword" id="6190879">else</span>&nbsp;<span class="op" id="6190884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190890">m</span><span class="op" id="6190891">.</span><span class="ident" id="6190892">Palette</span>&nbsp;<span class="op" id="6190900">=</span>&nbsp;<span class="ident" id="6190902">d</span><span class="op" id="6190903">.</span><span class="ident" id="6190904">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190927">if</span>&nbsp;<span class="ident" id="6190930">d</span><span class="op" id="6190931">.</span><span class="ident" id="6190932">hasTransparentIndex</span>&nbsp;<span class="op" id="6190952">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6190955">int</span><span class="op" id="6190958">(</span><span class="ident" id="6190959">d</span><span class="op" id="6190960">.</span><span class="ident" id="6190961">transparentIndex</span><span class="op" id="6190977">)</span>&nbsp;<span class="op" id="6190979">&lt;</span>&nbsp;<span class="builtinfunc" id="6190981">len</span><span class="op" id="6190984">(</span><span class="ident" id="6190985">m</span><span class="op" id="6190986">.</span><span class="ident" id="6190987">Palette</span><span class="op" id="6190994">)</span>&nbsp;<span class="op" id="6190996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191002">if</span>&nbsp;<span class="op" id="6191005">!</span><span class="ident" id="6191006">useLocalColorMap</span>&nbsp;<span class="op" id="6191023">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6191030">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191066">m</span><span class="op" id="6191067">.</span><span class="ident" id="6191068">Palette</span>&nbsp;<span class="op" id="6191076">=</span>&nbsp;<span class="builtinfunc" id="6191078">append</span><span class="op" id="6191084">(</span><span class="ident" id="6191085">color</span><span class="op" id="6191090">.</span><span class="ident" id="6191091">Palette</span><span class="op" id="6191098">(</span><span class="ident" id="6191099">nil</span><span class="op" id="6191102">)</span><span class="op" id="6191103">,</span>&nbsp;<span class="ident" id="6191105">d</span><span class="op" id="6191106">.</span><span class="ident" id="6191107">globalColorMap</span><span class="op" id="6191121">...</span><span class="op" id="6191124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191136">m</span><span class="op" id="6191137">.</span><span class="ident" id="6191138">Palette</span><span class="op" id="6191145">[</span><span class="ident" id="6191146">d</span><span class="op" id="6191147">.</span><span class="ident" id="6191148">transparentIndex</span><span class="op" id="6191164">]</span>&nbsp;<span class="op" id="6191166">=</span>&nbsp;<span class="ident" id="6191168">color</span><span class="op" id="6191173">.</span><span class="ident" id="6191174">RGBA</span><span class="op" id="6191178">{</span><span class="op" id="6191179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191184">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191189">litWidth</span><span class="op" id="6191197">,</span>&nbsp;<span class="ident" id="6191199">err</span>&nbsp;<span class="op" id="6191203">:=</span>&nbsp;<span class="ident" id="6191206">d</span><span class="op" id="6191207">.</span><span class="ident" id="6191208">r</span><span class="op" id="6191209">.</span><span class="ident" id="6191210">ReadByte</span><span class="op" id="6191218">(</span><span class="op" id="6191219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191224">if</span>&nbsp;<span class="ident" id="6191227">err</span>&nbsp;<span class="op" id="6191231">!=</span>&nbsp;<span class="ident" id="6191234">nil</span>&nbsp;<span class="op" id="6191238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191244">return</span>&nbsp;<span class="ident" id="6191251">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191263">if</span>&nbsp;<span class="ident" id="6191266">litWidth</span>&nbsp;<span class="op" id="6191275">&lt;</span>&nbsp;<span class="num" id="6191277">2</span>&nbsp;<span class="op" id="6191279">||</span>&nbsp;<span class="ident" id="6191282">litWidth</span>&nbsp;<span class="op" id="6191291">&gt;</span>&nbsp;<span class="num" id="6191293">8</span>&nbsp;<span class="op" id="6191295">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191301">return</span>&nbsp;<span class="ident" id="6191308">fmt</span><span class="op" id="6191311">.</span><span class="ident" id="6191312">Errorf</span><span class="op" id="6191318">(</span><span class="string" id="6191319">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6191363">,</span>&nbsp;<span class="ident" id="6191365">litWidth</span><span class="op" id="6191373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6191383">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191427">br</span>&nbsp;<span class="op" id="6191430">:=</span>&nbsp;<span class="op" id="6191433">&amp;</span><span class="ident" id="6191434">blockReader</span><span class="op" id="6191445">{</span><span class="ident" id="6191446">r</span><span class="op" id="6191447">:</span>&nbsp;<span class="ident" id="6191449">d</span><span class="op" id="6191450">.</span><span class="ident" id="6191451">r</span><span class="op" id="6191452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191457">lzwr</span>&nbsp;<span class="op" id="6191462">:=</span>&nbsp;<span class="ident" id="6191465">lzw</span><span class="op" id="6191468">.</span><span class="ident" id="6191469">NewReader</span><span class="op" id="6191478">(</span><span class="ident" id="6191479">br</span><span class="op" id="6191481">,</span>&nbsp;<span class="ident" id="6191483">lzw</span><span class="op" id="6191486">.</span><span class="ident" id="6191487">LSB</span><span class="op" id="6191490">,</span>&nbsp;<span class="builtintype" id="6191492">int</span><span class="op" id="6191495">(</span><span class="ident" id="6191496">litWidth</span><span class="op" id="6191504">)</span><span class="op" id="6191505">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191510">defer</span>&nbsp;<span class="ident" id="6191516">lzwr</span><span class="op" id="6191520">.</span><span class="ident" id="6191521">Close</span><span class="op" id="6191526">(</span><span class="op" id="6191527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191532">if</span>&nbsp;<span class="ident" id="6191535">_</span><span class="op" id="6191536">,</span>&nbsp;<span class="ident" id="6191538">err</span>&nbsp;<span class="op" id="6191542">=</span>&nbsp;<span class="ident" id="6191544">io</span><span class="op" id="6191546">.</span><span class="ident" id="6191547">ReadFull</span><span class="op" id="6191555">(</span><span class="ident" id="6191556">lzwr</span><span class="op" id="6191560">,</span>&nbsp;<span class="ident" id="6191562">m</span><span class="op" id="6191563">.</span><span class="ident" id="6191564">Pix</span><span class="op" id="6191567">)</span><span class="op" id="6191568">;</span>&nbsp;<span class="ident" id="6191570">err</span>&nbsp;<span class="op" id="6191574">!=</span>&nbsp;<span class="ident" id="6191577">nil</span>&nbsp;<span class="op" id="6191581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191587">if</span>&nbsp;<span class="ident" id="6191590">err</span>&nbsp;<span class="op" id="6191594">!=</span>&nbsp;<span class="ident" id="6191597">io</span><span class="op" id="6191599">.</span><span class="ident" id="6191600">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6191617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191624">return</span>&nbsp;<span class="ident" id="6191631">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191639">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191645">return</span>&nbsp;<span class="ident" id="6191652">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6191673">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6191735">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191767">if</span>&nbsp;<span class="ident" id="6191770">n</span><span class="op" id="6191771">,</span>&nbsp;<span class="ident" id="6191773">err</span>&nbsp;<span class="op" id="6191777">:=</span>&nbsp;<span class="ident" id="6191780">lzwr</span><span class="op" id="6191784">.</span><span class="ident" id="6191785">Read</span><span class="op" id="6191789">(</span><span class="ident" id="6191790">d</span><span class="op" id="6191791">.</span><span class="ident" id="6191792">tmp</span><span class="op" id="6191795">[</span><span class="op" id="6191796">:</span><span class="num" id="6191797">1</span><span class="op" id="6191798">]</span><span class="op" id="6191799">)</span><span class="op" id="6191800">;</span>&nbsp;<span class="ident" id="6191802">n</span>&nbsp;<span class="op" id="6191804">!=</span>&nbsp;<span class="num" id="6191807">0</span>&nbsp;<span class="op" id="6191809">||</span>&nbsp;<span class="ident" id="6191812">err</span>&nbsp;<span class="op" id="6191816">!=</span>&nbsp;<span class="ident" id="6191819">io</span><span class="op" id="6191821">.</span><span class="ident" id="6191822">EOF</span>&nbsp;<span class="op" id="6191826">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191832">if</span>&nbsp;<span class="ident" id="6191835">err</span>&nbsp;<span class="op" id="6191839">!=</span>&nbsp;<span class="ident" id="6191842">nil</span>&nbsp;<span class="op" id="6191846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191853">return</span>&nbsp;<span class="ident" id="6191860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191874">return</span>&nbsp;<span class="ident" id="6191881">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191895">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191900">if</span>&nbsp;<span class="ident" id="6191903">n</span><span class="op" id="6191904">,</span>&nbsp;<span class="ident" id="6191906">err</span>&nbsp;<span class="op" id="6191910">:=</span>&nbsp;<span class="ident" id="6191913">br</span><span class="op" id="6191915">.</span><span class="ident" id="6191916">Read</span><span class="op" id="6191920">(</span><span class="ident" id="6191921">d</span><span class="op" id="6191922">.</span><span class="ident" id="6191923">tmp</span><span class="op" id="6191926">[</span><span class="op" id="6191927">:</span><span class="num" id="6191928">1</span><span class="op" id="6191929">]</span><span class="op" id="6191930">)</span><span class="op" id="6191931">;</span>&nbsp;<span class="ident" id="6191933">n</span>&nbsp;<span class="op" id="6191935">!=</span>&nbsp;<span class="num" id="6191938">0</span>&nbsp;<span class="op" id="6191940">||</span>&nbsp;<span class="ident" id="6191943">err</span>&nbsp;<span class="op" id="6191947">!=</span>&nbsp;<span class="ident" id="6191950">io</span><span class="op" id="6191952">.</span><span class="ident" id="6191953">EOF</span>&nbsp;<span class="op" id="6191957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191963">if</span>&nbsp;<span class="ident" id="6191966">err</span>&nbsp;<span class="op" id="6191970">!=</span>&nbsp;<span class="ident" id="6191973">nil</span>&nbsp;<span class="op" id="6191977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191984">return</span>&nbsp;<span class="ident" id="6191991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192005">return</span>&nbsp;<span class="ident" id="6192012">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192032">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192091">if</span>&nbsp;<span class="builtinfunc" id="6192094">len</span><span class="op" id="6192097">(</span><span class="ident" id="6192098">m</span><span class="op" id="6192099">.</span><span class="ident" id="6192100">Palette</span><span class="op" id="6192107">)</span>&nbsp;<span class="op" id="6192109">&lt;</span>&nbsp;<span class="num" id="6192111">256</span>&nbsp;<span class="op" id="6192115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192121">for</span>&nbsp;<span class="ident" id="6192125">_</span><span class="op" id="6192126">,</span>&nbsp;<span class="ident" id="6192128">pixel</span>&nbsp;<span class="op" id="6192134">:=</span>&nbsp;<span class="keyword" id="6192137">range</span>&nbsp;<span class="ident" id="6192143">m</span><span class="op" id="6192144">.</span><span class="ident" id="6192145">Pix</span>&nbsp;<span class="op" id="6192149">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192156">if</span>&nbsp;<span class="builtintype" id="6192159">int</span><span class="op" id="6192162">(</span><span class="ident" id="6192163">pixel</span><span class="op" id="6192168">)</span>&nbsp;<span class="op" id="6192170">&gt;=</span>&nbsp;<span class="builtinfunc" id="6192173">len</span><span class="op" id="6192176">(</span><span class="ident" id="6192177">m</span><span class="op" id="6192178">.</span><span class="ident" id="6192179">Palette</span><span class="op" id="6192186">)</span>&nbsp;<span class="op" id="6192188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192196">return</span>&nbsp;<span class="ident" id="6192203">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192231">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192237">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192278">if</span>&nbsp;<span class="ident" id="6192281">d</span><span class="op" id="6192282">.</span><span class="ident" id="6192283">imageFields</span><span class="op" id="6192294">&amp;</span><span class="ident" id="6192295">ifInterlace</span>&nbsp;<span class="op" id="6192307">!=</span>&nbsp;<span class="num" id="6192310">0</span>&nbsp;<span class="op" id="6192312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192318">uninterlace</span><span class="op" id="6192329">(</span><span class="ident" id="6192330">m</span><span class="op" id="6192331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192336">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192342">d</span><span class="op" id="6192343">.</span><span class="ident" id="6192344">image</span>&nbsp;<span class="op" id="6192350">=</span>&nbsp;<span class="builtinfunc" id="6192352">append</span><span class="op" id="6192358">(</span><span class="ident" id="6192359">d</span><span class="op" id="6192360">.</span><span class="ident" id="6192361">image</span><span class="op" id="6192366">,</span>&nbsp;<span class="ident" id="6192368">m</span><span class="op" id="6192369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192374">d</span><span class="op" id="6192375">.</span><span class="ident" id="6192376">delay</span>&nbsp;<span class="op" id="6192382">=</span>&nbsp;<span class="builtinfunc" id="6192384">append</span><span class="op" id="6192390">(</span><span class="ident" id="6192391">d</span><span class="op" id="6192392">.</span><span class="ident" id="6192393">delay</span><span class="op" id="6192398">,</span>&nbsp;<span class="ident" id="6192400">d</span><span class="op" id="6192401">.</span><span class="ident" id="6192402">delayTime</span><span class="op" id="6192411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192416">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192484">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192556">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192617">d</span><span class="op" id="6192618">.</span><span class="ident" id="6192619">delayTime</span>&nbsp;<span class="op" id="6192629">=</span>&nbsp;<span class="num" id="6192631">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192636">d</span><span class="op" id="6192637">.</span><span class="ident" id="6192638">hasTransparentIndex</span>&nbsp;<span class="op" id="6192658">=</span>&nbsp;<span class="builtintype" id="6192660">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192669">case</span>&nbsp;<span class="ident" id="6192674">sTrailer</span><span class="op" id="6192682">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192687">if</span>&nbsp;<span class="builtinfunc" id="6192690">len</span><span class="op" id="6192693">(</span><span class="ident" id="6192694">d</span><span class="op" id="6192695">.</span><span class="ident" id="6192696">image</span><span class="op" id="6192701">)</span>&nbsp;<span class="op" id="6192703">==</span>&nbsp;<span class="num" id="6192706">0</span>&nbsp;<span class="op" id="6192708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192714">return</span>&nbsp;<span class="ident" id="6192721">io</span><span class="op" id="6192723">.</span><span class="ident" id="6192724">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192749">return</span>&nbsp;<span class="ident" id="6192756">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192763">default</span><span class="op" id="6192770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192775">return</span>&nbsp;<span class="ident" id="6192782">fmt</span><span class="op" id="6192785">.</span><span class="ident" id="6192786">Errorf</span><span class="op" id="6192792">(</span><span class="string" id="6192793">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6192826">,</span>&nbsp;<span class="ident" id="6192828">c</span><span class="op" id="6192829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192836">}</span><br>
<span class="lineno"></span><span class="op" id="6192838">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6192841">func</span>&nbsp;<span class="op" id="6192846">(</span><span class="ident" id="6192847">d</span>&nbsp;<span class="op" id="6192849">*</span><span class="ident" id="6192850">decoder</span><span class="op" id="6192857">)</span>&nbsp;<span class="ident" id="6192859">readHeaderAndScreenDescriptor</span><span class="op" id="6192888">(</span><span class="op" id="6192889">)</span>&nbsp;<span class="builtintype" id="6192891">error</span>&nbsp;<span class="op" id="6192897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192900">_</span><span class="op" id="6192901">,</span>&nbsp;<span class="ident" id="6192903">err</span>&nbsp;<span class="op" id="6192907">:=</span>&nbsp;<span class="ident" id="6192910">io</span><span class="op" id="6192912">.</span><span class="ident" id="6192913">ReadFull</span><span class="op" id="6192921">(</span><span class="ident" id="6192922">d</span><span class="op" id="6192923">.</span><span class="ident" id="6192924">r</span><span class="op" id="6192925">,</span>&nbsp;<span class="ident" id="6192927">d</span><span class="op" id="6192928">.</span><span class="ident" id="6192929">tmp</span><span class="op" id="6192932">[</span><span class="num" id="6192933">0</span><span class="op" id="6192934">:</span><span class="num" id="6192935">13</span><span class="op" id="6192937">]</span><span class="op" id="6192938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192941">if</span>&nbsp;<span class="ident" id="6192944">err</span>&nbsp;<span class="op" id="6192948">!=</span>&nbsp;<span class="ident" id="6192951">nil</span>&nbsp;<span class="op" id="6192955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192959">return</span>&nbsp;<span class="ident" id="6192966">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192974">d</span><span class="op" id="6192975">.</span><span class="ident" id="6192976">vers</span>&nbsp;<span class="op" id="6192981">=</span>&nbsp;<span class="builtintype" id="6192983">string</span><span class="op" id="6192989">(</span><span class="ident" id="6192990">d</span><span class="op" id="6192991">.</span><span class="ident" id="6192992">tmp</span><span class="op" id="6192995">[</span><span class="num" id="6192996">0</span><span class="op" id="6192997">:</span><span class="num" id="6192998">6</span><span class="op" id="6192999">]</span><span class="op" id="6193000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193003">if</span>&nbsp;<span class="ident" id="6193006">d</span><span class="op" id="6193007">.</span><span class="ident" id="6193008">vers</span>&nbsp;<span class="op" id="6193013">!=</span>&nbsp;<span class="string" id="6193016">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6193025">&amp;&amp;</span>&nbsp;<span class="ident" id="6193028">d</span><span class="op" id="6193029">.</span><span class="ident" id="6193030">vers</span>&nbsp;<span class="op" id="6193035">!=</span>&nbsp;<span class="string" id="6193038">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6193047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193051">return</span>&nbsp;<span class="ident" id="6193058">fmt</span><span class="op" id="6193061">.</span><span class="ident" id="6193062">Errorf</span><span class="op" id="6193068">(</span><span class="string" id="6193069">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6193101">,</span>&nbsp;<span class="ident" id="6193103">d</span><span class="op" id="6193104">.</span><span class="ident" id="6193105">vers</span><span class="op" id="6193109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193112">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193115">d</span><span class="op" id="6193116">.</span><span class="ident" id="6193117">width</span>&nbsp;<span class="op" id="6193123">=</span>&nbsp;<span class="builtintype" id="6193125">int</span><span class="op" id="6193128">(</span><span class="ident" id="6193129">d</span><span class="op" id="6193130">.</span><span class="ident" id="6193131">tmp</span><span class="op" id="6193134">[</span><span class="num" id="6193135">6</span><span class="op" id="6193136">]</span><span class="op" id="6193137">)</span>&nbsp;<span class="op" id="6193139">+</span>&nbsp;<span class="builtintype" id="6193141">int</span><span class="op" id="6193144">(</span><span class="ident" id="6193145">d</span><span class="op" id="6193146">.</span><span class="ident" id="6193147">tmp</span><span class="op" id="6193150">[</span><span class="num" id="6193151">7</span><span class="op" id="6193152">]</span><span class="op" id="6193153">)</span><span class="op" id="6193154">&lt;&lt;</span><span class="num" id="6193156">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193159">d</span><span class="op" id="6193160">.</span><span class="ident" id="6193161">height</span>&nbsp;<span class="op" id="6193168">=</span>&nbsp;<span class="builtintype" id="6193170">int</span><span class="op" id="6193173">(</span><span class="ident" id="6193174">d</span><span class="op" id="6193175">.</span><span class="ident" id="6193176">tmp</span><span class="op" id="6193179">[</span><span class="num" id="6193180">8</span><span class="op" id="6193181">]</span><span class="op" id="6193182">)</span>&nbsp;<span class="op" id="6193184">+</span>&nbsp;<span class="builtintype" id="6193186">int</span><span class="op" id="6193189">(</span><span class="ident" id="6193190">d</span><span class="op" id="6193191">.</span><span class="ident" id="6193192">tmp</span><span class="op" id="6193195">[</span><span class="num" id="6193196">9</span><span class="op" id="6193197">]</span><span class="op" id="6193198">)</span><span class="op" id="6193199">&lt;&lt;</span><span class="num" id="6193201">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193204">d</span><span class="op" id="6193205">.</span><span class="ident" id="6193206">headerFields</span>&nbsp;<span class="op" id="6193219">=</span>&nbsp;<span class="ident" id="6193221">d</span><span class="op" id="6193222">.</span><span class="ident" id="6193223">tmp</span><span class="op" id="6193226">[</span><span class="num" id="6193227">10</span><span class="op" id="6193229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193232">d</span><span class="op" id="6193233">.</span><span class="ident" id="6193234">backgroundIndex</span>&nbsp;<span class="op" id="6193250">=</span>&nbsp;<span class="ident" id="6193252">d</span><span class="op" id="6193253">.</span><span class="ident" id="6193254">tmp</span><span class="op" id="6193257">[</span><span class="num" id="6193258">11</span><span class="op" id="6193260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193263">d</span><span class="op" id="6193264">.</span><span class="ident" id="6193265">aspect</span>&nbsp;<span class="op" id="6193272">=</span>&nbsp;<span class="ident" id="6193274">d</span><span class="op" id="6193275">.</span><span class="ident" id="6193276">tmp</span><span class="op" id="6193279">[</span><span class="num" id="6193280">12</span><span class="op" id="6193282">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193285">d</span><span class="op" id="6193286">.</span><span class="ident" id="6193287">loopCount</span>&nbsp;<span class="op" id="6193297">=</span>&nbsp;<span class="op" id="6193299">-</span><span class="num" id="6193300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193303">d</span><span class="op" id="6193304">.</span><span class="ident" id="6193305">pixelSize</span>&nbsp;<span class="op" id="6193315">=</span>&nbsp;<span class="builtintype" id="6193317">uint</span><span class="op" id="6193321">(</span><span class="ident" id="6193322">d</span><span class="op" id="6193323">.</span><span class="ident" id="6193324">headerFields</span><span class="op" id="6193336">&amp;</span><span class="num" id="6193337">7</span><span class="op" id="6193338">)</span>&nbsp;<span class="op" id="6193340">+</span>&nbsp;<span class="num" id="6193342">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193345">return</span>&nbsp;<span class="ident" id="6193352">nil</span><br>
<span class="lineno"></span><span class="op" id="6193356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6193359">func</span>&nbsp;<span class="op" id="6193364">(</span><span class="ident" id="6193365">d</span>&nbsp;<span class="op" id="6193367">*</span><span class="ident" id="6193368">decoder</span><span class="op" id="6193375">)</span>&nbsp;<span class="ident" id="6193377">readColorMap</span><span class="op" id="6193389">(</span><span class="op" id="6193390">)</span>&nbsp;<span class="op" id="6193392">(</span><span class="ident" id="6193393">color</span><span class="op" id="6193398">.</span><span class="ident" id="6193399">Palette</span><span class="op" id="6193406">,</span>&nbsp;<span class="builtintype" id="6193408">error</span><span class="op" id="6193413">)</span>&nbsp;<span class="op" id="6193415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193418">if</span>&nbsp;<span class="ident" id="6193421">d</span><span class="op" id="6193422">.</span><span class="ident" id="6193423">pixelSize</span>&nbsp;<span class="op" id="6193433">&gt;</span>&nbsp;<span class="num" id="6193435">8</span>&nbsp;<span class="op" id="6193437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193441">return</span>&nbsp;<span class="ident" id="6193448">nil</span><span class="op" id="6193451">,</span>&nbsp;<span class="ident" id="6193453">fmt</span><span class="op" id="6193456">.</span><span class="ident" id="6193457">Errorf</span><span class="op" id="6193463">(</span><span class="string" id="6193464">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6193501">,</span>&nbsp;<span class="ident" id="6193503">d</span><span class="op" id="6193504">.</span><span class="ident" id="6193505">pixelSize</span><span class="op" id="6193514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193520">numColors</span>&nbsp;<span class="op" id="6193530">:=</span>&nbsp;<span class="num" id="6193533">1</span>&nbsp;<span class="op" id="6193535">&lt;&lt;</span>&nbsp;<span class="ident" id="6193538">d</span><span class="op" id="6193539">.</span><span class="ident" id="6193540">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193551">if</span>&nbsp;<span class="ident" id="6193554">d</span><span class="op" id="6193555">.</span><span class="ident" id="6193556">imageFields</span><span class="op" id="6193567">&amp;</span><span class="ident" id="6193568">ifLocalColorTable</span>&nbsp;<span class="op" id="6193586">!=</span>&nbsp;<span class="num" id="6193589">0</span>&nbsp;<span class="op" id="6193591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193595">numColors</span>&nbsp;<span class="op" id="6193605">=</span>&nbsp;<span class="num" id="6193607">1</span>&nbsp;<span class="op" id="6193609">&lt;&lt;</span>&nbsp;<span class="op" id="6193612">(</span><span class="op" id="6193613">(</span><span class="ident" id="6193614">d</span><span class="op" id="6193615">.</span><span class="ident" id="6193616">imageFields</span>&nbsp;<span class="op" id="6193628">&amp;</span>&nbsp;<span class="ident" id="6193630">ifPixelSizeMask</span><span class="op" id="6193645">)</span>&nbsp;<span class="op" id="6193647">+</span>&nbsp;<span class="num" id="6193649">1</span><span class="op" id="6193650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193656">numValues</span>&nbsp;<span class="op" id="6193666">:=</span>&nbsp;<span class="num" id="6193669">3</span>&nbsp;<span class="op" id="6193671">*</span>&nbsp;<span class="ident" id="6193673">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193684">_</span><span class="op" id="6193685">,</span>&nbsp;<span class="ident" id="6193687">err</span>&nbsp;<span class="op" id="6193691">:=</span>&nbsp;<span class="ident" id="6193694">io</span><span class="op" id="6193696">.</span><span class="ident" id="6193697">ReadFull</span><span class="op" id="6193705">(</span><span class="ident" id="6193706">d</span><span class="op" id="6193707">.</span><span class="ident" id="6193708">r</span><span class="op" id="6193709">,</span>&nbsp;<span class="ident" id="6193711">d</span><span class="op" id="6193712">.</span><span class="ident" id="6193713">tmp</span><span class="op" id="6193716">[</span><span class="num" id="6193717">0</span><span class="op" id="6193718">:</span><span class="ident" id="6193719">numValues</span><span class="op" id="6193728">]</span><span class="op" id="6193729">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193732">if</span>&nbsp;<span class="ident" id="6193735">err</span>&nbsp;<span class="op" id="6193739">!=</span>&nbsp;<span class="ident" id="6193742">nil</span>&nbsp;<span class="op" id="6193746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193750">return</span>&nbsp;<span class="ident" id="6193757">nil</span><span class="op" id="6193760">,</span>&nbsp;<span class="ident" id="6193762">fmt</span><span class="op" id="6193765">.</span><span class="ident" id="6193766">Errorf</span><span class="op" id="6193772">(</span><span class="string" id="6193773">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6193807">,</span>&nbsp;<span class="ident" id="6193809">err</span><span class="op" id="6193812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193818">colorMap</span>&nbsp;<span class="op" id="6193827">:=</span>&nbsp;<span class="builtinfunc" id="6193830">make</span><span class="op" id="6193834">(</span><span class="ident" id="6193835">color</span><span class="op" id="6193840">.</span><span class="ident" id="6193841">Palette</span><span class="op" id="6193848">,</span>&nbsp;<span class="ident" id="6193850">numColors</span><span class="op" id="6193859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193862">j</span>&nbsp;<span class="op" id="6193864">:=</span>&nbsp;<span class="num" id="6193867">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193870">for</span>&nbsp;<span class="ident" id="6193874">i</span>&nbsp;<span class="op" id="6193876">:=</span>&nbsp;<span class="keyword" id="6193879">range</span>&nbsp;<span class="ident" id="6193885">colorMap</span>&nbsp;<span class="op" id="6193894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193898">colorMap</span><span class="op" id="6193906">[</span><span class="ident" id="6193907">i</span><span class="op" id="6193908">]</span>&nbsp;<span class="op" id="6193910">=</span>&nbsp;<span class="ident" id="6193912">color</span><span class="op" id="6193917">.</span><span class="ident" id="6193918">RGBA</span><span class="op" id="6193922">{</span><span class="ident" id="6193923">d</span><span class="op" id="6193924">.</span><span class="ident" id="6193925">tmp</span><span class="op" id="6193928">[</span><span class="ident" id="6193929">j</span><span class="op" id="6193930">+</span><span class="num" id="6193931">0</span><span class="op" id="6193932">]</span><span class="op" id="6193933">,</span>&nbsp;<span class="ident" id="6193935">d</span><span class="op" id="6193936">.</span><span class="ident" id="6193937">tmp</span><span class="op" id="6193940">[</span><span class="ident" id="6193941">j</span><span class="op" id="6193942">+</span><span class="num" id="6193943">1</span><span class="op" id="6193944">]</span><span class="op" id="6193945">,</span>&nbsp;<span class="ident" id="6193947">d</span><span class="op" id="6193948">.</span><span class="ident" id="6193949">tmp</span><span class="op" id="6193952">[</span><span class="ident" id="6193953">j</span><span class="op" id="6193954">+</span><span class="num" id="6193955">2</span><span class="op" id="6193956">]</span><span class="op" id="6193957">,</span>&nbsp;<span class="num" id="6193959">0xFF</span><span class="op" id="6193963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193967">j</span>&nbsp;<span class="op" id="6193969">+=</span>&nbsp;<span class="num" id="6193972">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193978">return</span>&nbsp;<span class="ident" id="6193985">colorMap</span><span class="op" id="6193993">,</span>&nbsp;<span class="ident" id="6193995">nil</span><br>
<span class="lineno">295</span><span class="op" id="6193999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6194002">func</span>&nbsp;<span class="op" id="6194007">(</span><span class="ident" id="6194008">d</span>&nbsp;<span class="op" id="6194010">*</span><span class="ident" id="6194011">decoder</span><span class="op" id="6194018">)</span>&nbsp;<span class="ident" id="6194020">readExtension</span><span class="op" id="6194033">(</span><span class="op" id="6194034">)</span>&nbsp;<span class="builtintype" id="6194036">error</span>&nbsp;<span class="op" id="6194042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194045">extension</span><span class="op" id="6194054">,</span>&nbsp;<span class="ident" id="6194056">err</span>&nbsp;<span class="op" id="6194060">:=</span>&nbsp;<span class="ident" id="6194063">d</span><span class="op" id="6194064">.</span><span class="ident" id="6194065">r</span><span class="op" id="6194066">.</span><span class="ident" id="6194067">ReadByte</span><span class="op" id="6194075">(</span><span class="op" id="6194076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194079">if</span>&nbsp;<span class="ident" id="6194082">err</span>&nbsp;<span class="op" id="6194086">!=</span>&nbsp;<span class="ident" id="6194089">nil</span>&nbsp;<span class="op" id="6194093">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194097">return</span>&nbsp;<span class="ident" id="6194104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194112">size</span>&nbsp;<span class="op" id="6194117">:=</span>&nbsp;<span class="num" id="6194120">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194123">switch</span>&nbsp;<span class="ident" id="6194130">extension</span>&nbsp;<span class="op" id="6194140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194143">case</span>&nbsp;<span class="ident" id="6194148">eText</span><span class="op" id="6194153">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194157">size</span>&nbsp;<span class="op" id="6194162">=</span>&nbsp;<span class="num" id="6194164">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194168">case</span>&nbsp;<span class="ident" id="6194173">eGraphicControl</span><span class="op" id="6194188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194192">return</span>&nbsp;<span class="ident" id="6194199">d</span><span class="op" id="6194200">.</span><span class="ident" id="6194201">readGraphicControl</span><span class="op" id="6194219">(</span><span class="op" id="6194220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194223">case</span>&nbsp;<span class="ident" id="6194228">eComment</span><span class="op" id="6194236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6194240">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194277">case</span>&nbsp;<span class="ident" id="6194282">eApplication</span><span class="op" id="6194294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194298">b</span><span class="op" id="6194299">,</span>&nbsp;<span class="ident" id="6194301">err</span>&nbsp;<span class="op" id="6194305">:=</span>&nbsp;<span class="ident" id="6194308">d</span><span class="op" id="6194309">.</span><span class="ident" id="6194310">r</span><span class="op" id="6194311">.</span><span class="ident" id="6194312">ReadByte</span><span class="op" id="6194320">(</span><span class="op" id="6194321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194325">if</span>&nbsp;<span class="ident" id="6194328">err</span>&nbsp;<span class="op" id="6194332">!=</span>&nbsp;<span class="ident" id="6194335">nil</span>&nbsp;<span class="op" id="6194339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194344">return</span>&nbsp;<span class="ident" id="6194351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194357">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6194361">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194425">size</span>&nbsp;<span class="op" id="6194430">=</span>&nbsp;<span class="builtintype" id="6194432">int</span><span class="op" id="6194435">(</span><span class="ident" id="6194436">b</span><span class="op" id="6194437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194440">default</span><span class="op" id="6194447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194451">return</span>&nbsp;<span class="ident" id="6194458">fmt</span><span class="op" id="6194461">.</span><span class="ident" id="6194462">Errorf</span><span class="op" id="6194468">(</span><span class="string" id="6194469">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6194500">,</span>&nbsp;<span class="ident" id="6194502">extension</span><span class="op" id="6194511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194514">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194517">if</span>&nbsp;<span class="ident" id="6194520">size</span>&nbsp;<span class="op" id="6194525">&gt;</span>&nbsp;<span class="num" id="6194527">0</span>&nbsp;<span class="op" id="6194529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194533">if</span>&nbsp;<span class="ident" id="6194536">_</span><span class="op" id="6194537">,</span>&nbsp;<span class="ident" id="6194539">err</span>&nbsp;<span class="op" id="6194543">:=</span>&nbsp;<span class="ident" id="6194546">io</span><span class="op" id="6194548">.</span><span class="ident" id="6194549">ReadFull</span><span class="op" id="6194557">(</span><span class="ident" id="6194558">d</span><span class="op" id="6194559">.</span><span class="ident" id="6194560">r</span><span class="op" id="6194561">,</span>&nbsp;<span class="ident" id="6194563">d</span><span class="op" id="6194564">.</span><span class="ident" id="6194565">tmp</span><span class="op" id="6194568">[</span><span class="num" id="6194569">0</span><span class="op" id="6194570">:</span><span class="ident" id="6194571">size</span><span class="op" id="6194575">]</span><span class="op" id="6194576">)</span><span class="op" id="6194577">;</span>&nbsp;<span class="ident" id="6194579">err</span>&nbsp;<span class="op" id="6194583">!=</span>&nbsp;<span class="ident" id="6194586">nil</span>&nbsp;<span class="op" id="6194590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194595">return</span>&nbsp;<span class="ident" id="6194602">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194611">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6194615">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6194690">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194731">if</span>&nbsp;<span class="ident" id="6194734">extension</span>&nbsp;<span class="op" id="6194744">==</span>&nbsp;<span class="ident" id="6194747">eApplication</span>&nbsp;<span class="op" id="6194760">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6194763">string</span><span class="op" id="6194769">(</span><span class="ident" id="6194770">d</span><span class="op" id="6194771">.</span><span class="ident" id="6194772">tmp</span><span class="op" id="6194775">[</span><span class="op" id="6194776">:</span><span class="ident" id="6194777">size</span><span class="op" id="6194781">]</span><span class="op" id="6194782">)</span>&nbsp;<span class="op" id="6194784">==</span>&nbsp;<span class="string" id="6194787">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6194801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194805">n</span><span class="op" id="6194806">,</span>&nbsp;<span class="ident" id="6194808">err</span>&nbsp;<span class="op" id="6194812">:=</span>&nbsp;<span class="ident" id="6194815">d</span><span class="op" id="6194816">.</span><span class="ident" id="6194817">readBlock</span><span class="op" id="6194826">(</span><span class="op" id="6194827">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194831">if</span>&nbsp;<span class="ident" id="6194834">n</span>&nbsp;<span class="op" id="6194836">==</span>&nbsp;<span class="num" id="6194839">0</span>&nbsp;<span class="op" id="6194841">||</span>&nbsp;<span class="ident" id="6194844">err</span>&nbsp;<span class="op" id="6194848">!=</span>&nbsp;<span class="ident" id="6194851">nil</span>&nbsp;<span class="op" id="6194855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194860">return</span>&nbsp;<span class="ident" id="6194867">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194877">if</span>&nbsp;<span class="ident" id="6194880">n</span>&nbsp;<span class="op" id="6194882">==</span>&nbsp;<span class="num" id="6194885">3</span>&nbsp;<span class="op" id="6194887">&amp;&amp;</span>&nbsp;<span class="ident" id="6194890">d</span><span class="op" id="6194891">.</span><span class="ident" id="6194892">tmp</span><span class="op" id="6194895">[</span><span class="num" id="6194896">0</span><span class="op" id="6194897">]</span>&nbsp;<span class="op" id="6194899">==</span>&nbsp;<span class="num" id="6194902">1</span>&nbsp;<span class="op" id="6194904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194909">d</span><span class="op" id="6194910">.</span><span class="ident" id="6194911">loopCount</span>&nbsp;<span class="op" id="6194921">=</span>&nbsp;<span class="builtintype" id="6194923">int</span><span class="op" id="6194926">(</span><span class="ident" id="6194927">d</span><span class="op" id="6194928">.</span><span class="ident" id="6194929">tmp</span><span class="op" id="6194932">[</span><span class="num" id="6194933">1</span><span class="op" id="6194934">]</span><span class="op" id="6194935">)</span>&nbsp;<span class="op" id="6194937">|</span>&nbsp;<span class="builtintype" id="6194939">int</span><span class="op" id="6194942">(</span><span class="ident" id="6194943">d</span><span class="op" id="6194944">.</span><span class="ident" id="6194945">tmp</span><span class="op" id="6194948">[</span><span class="num" id="6194949">2</span><span class="op" id="6194950">]</span><span class="op" id="6194951">)</span><span class="op" id="6194952">&lt;&lt;</span><span class="num" id="6194954">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194964">for</span>&nbsp;<span class="op" id="6194968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194972">n</span><span class="op" id="6194973">,</span>&nbsp;<span class="ident" id="6194975">err</span>&nbsp;<span class="op" id="6194979">:=</span>&nbsp;<span class="ident" id="6194982">d</span><span class="op" id="6194983">.</span><span class="ident" id="6194984">readBlock</span><span class="op" id="6194993">(</span><span class="op" id="6194994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194998">if</span>&nbsp;<span class="ident" id="6195001">n</span>&nbsp;<span class="op" id="6195003">==</span>&nbsp;<span class="num" id="6195006">0</span>&nbsp;<span class="op" id="6195008">||</span>&nbsp;<span class="ident" id="6195011">err</span>&nbsp;<span class="op" id="6195015">!=</span>&nbsp;<span class="ident" id="6195018">nil</span>&nbsp;<span class="op" id="6195022">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195027">return</span>&nbsp;<span class="ident" id="6195034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6195040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6195043">}</span><br>
<span class="lineno"></span><span class="op" id="6195045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6195048">func</span>&nbsp;<span class="op" id="6195053">(</span><span class="ident" id="6195054">d</span>&nbsp;<span class="op" id="6195056">*</span><span class="ident" id="6195057">decoder</span><span class="op" id="6195064">)</span>&nbsp;<span class="ident" id="6195066">readGraphicControl</span><span class="op" id="6195084">(</span><span class="op" id="6195085">)</span>&nbsp;<span class="builtintype" id="6195087">error</span>&nbsp;<span class="op" id="6195093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195096">if</span>&nbsp;<span class="ident" id="6195099">_</span><span class="op" id="6195100">,</span>&nbsp;<span class="ident" id="6195102">err</span>&nbsp;<span class="op" id="6195106">:=</span>&nbsp;<span class="ident" id="6195109">io</span><span class="op" id="6195111">.</span><span class="ident" id="6195112">ReadFull</span><span class="op" id="6195120">(</span><span class="ident" id="6195121">d</span><span class="op" id="6195122">.</span><span class="ident" id="6195123">r</span><span class="op" id="6195124">,</span>&nbsp;<span class="ident" id="6195126">d</span><span class="op" id="6195127">.</span><span class="ident" id="6195128">tmp</span><span class="op" id="6195131">[</span><span class="num" id="6195132">0</span><span class="op" id="6195133">:</span><span class="num" id="6195134">6</span><span class="op" id="6195135">]</span><span class="op" id="6195136">)</span><span class="op" id="6195137">;</span>&nbsp;<span class="ident" id="6195139">err</span>&nbsp;<span class="op" id="6195143">!=</span>&nbsp;<span class="ident" id="6195146">nil</span>&nbsp;<span class="op" id="6195150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195154">return</span>&nbsp;<span class="ident" id="6195161">fmt</span><span class="op" id="6195164">.</span><span class="ident" id="6195165">Errorf</span><span class="op" id="6195171">(</span><span class="string" id="6195172">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6195209">,</span>&nbsp;<span class="ident" id="6195211">err</span><span class="op" id="6195214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6195217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195220">d</span><span class="op" id="6195221">.</span><span class="ident" id="6195222">flags</span>&nbsp;<span class="op" id="6195228">=</span>&nbsp;<span class="ident" id="6195230">d</span><span class="op" id="6195231">.</span><span class="ident" id="6195232">tmp</span><span class="op" id="6195235">[</span><span class="num" id="6195236">1</span><span class="op" id="6195237">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195240">d</span><span class="op" id="6195241">.</span><span class="ident" id="6195242">delayTime</span>&nbsp;<span class="op" id="6195252">=</span>&nbsp;<span class="builtintype" id="6195254">int</span><span class="op" id="6195257">(</span><span class="ident" id="6195258">d</span><span class="op" id="6195259">.</span><span class="ident" id="6195260">tmp</span><span class="op" id="6195263">[</span><span class="num" id="6195264">2</span><span class="op" id="6195265">]</span><span class="op" id="6195266">)</span>&nbsp;<span class="op" id="6195268">|</span>&nbsp;<span class="builtintype" id="6195270">int</span><span class="op" id="6195273">(</span><span class="ident" id="6195274">d</span><span class="op" id="6195275">.</span><span class="ident" id="6195276">tmp</span><span class="op" id="6195279">[</span><span class="num" id="6195280">3</span><span class="op" id="6195281">]</span><span class="op" id="6195282">)</span><span class="op" id="6195283">&lt;&lt;</span><span class="num" id="6195285">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195288">if</span>&nbsp;<span class="ident" id="6195291">d</span><span class="op" id="6195292">.</span><span class="ident" id="6195293">flags</span><span class="op" id="6195298">&amp;</span><span class="ident" id="6195299">gcTransparentColorSet</span>&nbsp;<span class="op" id="6195321">!=</span>&nbsp;<span class="num" id="6195324">0</span>&nbsp;<span class="op" id="6195326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195330">d</span><span class="op" id="6195331">.</span><span class="ident" id="6195332">transparentIndex</span>&nbsp;<span class="op" id="6195349">=</span>&nbsp;<span class="ident" id="6195351">d</span><span class="op" id="6195352">.</span><span class="ident" id="6195353">tmp</span><span class="op" id="6195356">[</span><span class="num" id="6195357">4</span><span class="op" id="6195358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195362">d</span><span class="op" id="6195363">.</span><span class="ident" id="6195364">hasTransparentIndex</span>&nbsp;<span class="op" id="6195384">=</span>&nbsp;<span class="builtintype" id="6195386">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6195392">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195395">return</span>&nbsp;<span class="ident" id="6195402">nil</span><br>
<span class="lineno"></span><span class="op" id="6195406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6195409">func</span>&nbsp;<span class="op" id="6195414">(</span><span class="ident" id="6195415">d</span>&nbsp;<span class="op" id="6195417">*</span><span class="ident" id="6195418">decoder</span><span class="op" id="6195425">)</span>&nbsp;<span class="ident" id="6195427">newImageFromDescriptor</span><span class="op" id="6195449">(</span><span class="op" id="6195450">)</span>&nbsp;<span class="op" id="6195452">(</span><span class="op" id="6195453">*</span><span class="ident" id="6195454">image</span><span class="op" id="6195459">.</span><span class="ident" id="6195460">Paletted</span><span class="op" id="6195468">,</span>&nbsp;<span class="builtintype" id="6195470">error</span><span class="op" id="6195475">)</span>&nbsp;<span class="op" id="6195477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195480">if</span>&nbsp;<span class="ident" id="6195483">_</span><span class="op" id="6195484">,</span>&nbsp;<span class="ident" id="6195486">err</span>&nbsp;<span class="op" id="6195490">:=</span>&nbsp;<span class="ident" id="6195493">io</span><span class="op" id="6195495">.</span><span class="ident" id="6195496">ReadFull</span><span class="op" id="6195504">(</span><span class="ident" id="6195505">d</span><span class="op" id="6195506">.</span><span class="ident" id="6195507">r</span><span class="op" id="6195508">,</span>&nbsp;<span class="ident" id="6195510">d</span><span class="op" id="6195511">.</span><span class="ident" id="6195512">tmp</span><span class="op" id="6195515">[</span><span class="num" id="6195516">0</span><span class="op" id="6195517">:</span><span class="num" id="6195518">9</span><span class="op" id="6195519">]</span><span class="op" id="6195520">)</span><span class="op" id="6195521">;</span>&nbsp;<span class="ident" id="6195523">err</span>&nbsp;<span class="op" id="6195527">!=</span>&nbsp;<span class="ident" id="6195530">nil</span>&nbsp;<span class="op" id="6195534">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6195538">return</span>&nbsp;<span class="ident" id="6195545">nil</span><span class="op" id="6195548">,</span>&nbsp;<span class="ident" id="6195550">fmt</span><span class="op" id="6195553">.</span><span class="ident" id="6195554">Errorf</span><span class="op" id="6195560">(</span><span class="string" id="6195561">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6195599">,</span>&nbsp;<span class="ident" id="6195601">err</span><span class="op" id="6195604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6195607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195610">left</span>&nbsp;<span class="op" id="6195615">:=</span>&nbsp;<span class="builtintype" id="6195618">int</span><span class="op" id="6195621">(</span><span class="ident" id="6195622">d</span><span class="op" id="6195623">.</span><span class="ident" id="6195624">tmp</span><span class="op" id="6195627">[</span><span class="num" id="6195628">0</span><span class="op" id="6195629">]</span><span class="op" id="6195630">)</span>&nbsp;<span class="op" id="6195632">+</span>&nbsp;<span class="builtintype" id="6195634">int</span><span class="op" id="6195637">(</span><span class="ident" id="6195638">d</span><span class="op" id="6195639">.</span><span class="ident" id="6195640">tmp</span><span class="op" id="6195643">[</span><span class="num" id="6195644">1</span><span class="op" id="6195645">]</span><span class="op" id="6195646">)</span><span class="op" id="6195647">&lt;&lt;</span><span class="num" id="6195649">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195652">top</span>&nbsp;<span class="op" id="6195656">:=</span>&nbsp;<span class="builtintype" id="6195659">int</span><span class="op" id="6195662">(</span><span class="ident" id="6195663">d</span><span class="op" id="6195664">.</span><span class="ident" id="6195665">tmp</span><span class="op" id="6195668">[</span><span class="num" id="6195669">2</span><span class="op" id="6195670">]</span><span class="op" id="6195671">)</span>&nbsp;<span class="op" id="6195673">+</span>&nbsp;<span class="builtintype" id="6195675">int</span><span class="op" id="6195678">(</span><span class="ident" id="6195679">d</span><span class="op" id="6195680">.</span><span class="ident" id="6195681">tmp</span><span class="op" id="6195684">[</span><span class="num" id="6195685">3</span><span class="op" id="6195686">]</span><span class="op" id="6195687">)</span><span class="op" id="6195688">&lt;&lt;</span><span class="num" id="6195690">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195693">width</span>&nbsp;<span class="op" id="6195699">:=</span>&nbsp;<span class="builtintype" id="6195702">int</span><span class="op" id="6195705">(</span><span class="ident" id="6195706">d</span><span class="op" id="6195707">.</span><span class="ident" id="6195708">tmp</span><span class="op" id="6195711">[</span><span class="num" id="6195712">4</span><span class="op" id="6195713">]</span><span class="op" id="6195714">)</span>&nbsp;<span class="op" id="6195716">+</span>&nbsp;<span class="builtintype" id="6195718">int</span><span class="op" id="6195721">(</span><span class="ident" id="6195722">d</span><span class="op" id="6195723">.</span><span class="ident" id="6195724">tmp</span><span class="op" id="6195727">[</span><span class="num" id="6195728">5</span><span class="op" id="6195729">]</span><span class="op" id="6195730">)</span><span class="op" id="6195731">&lt;&lt;</span><span class="num" id="6195733">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195736">height</span>&nbsp;<span class="op" id="6195743">:=</span>&nbsp;<span class="builtintype" id="6195746">int</span><span class="op" id="6195749">(</span><span class="ident" id="6195750">d</span><span class="op" id="6195751">.</span><span class="ident" id="6195752">tmp</span><span class="op" id="6195755">[</span><span class="num" id="6195756">6</span><span class="op" id="6195757">]</span><span class="op" id="6195758">)</span>&nbsp;<span class="op" id="6195760">+</span>&nbsp;<span class="builtintype" id="6195762">int</span><span class="op" id="6195765">(</span><span class="ident" id="6195766">d</span><span class="op" id="6195767">.</span><span class="ident" id="6195768">tmp</span><span class="op" id="6195771">[</span><span class="num" id="6195772">7</span><span class="op" id="6195773">]</span><span class="op" id="6195774">)</span><span class="op" id="6195775">&lt;&lt;</span><span class="num" id="6195777">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195780">d</span><span class="op" id="6195781">.</span><span class="ident" id="6195782">imageFields</span>&nbsp;<span class="op" id="6195794">=</span>&nbsp;<span class="ident" id="6195796">d</span><span class="op" id="6195797">.</span><span class="ident" id="6195798">tmp</span><span class="op" id="6195801">[</span><span class="num" id="6195802">8</span><span class="op" id="6195803">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6195807">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6195864">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6195926">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6195984">bounds</span>&nbsp;<span class="op" id="6195991">:=</span>&nbsp;<span class="ident" id="6195994">image</span><span class="op" id="6195999">.</span><span class="ident" id="6196000">Rect</span><span class="op" id="6196004">(</span><span class="ident" id="6196005">left</span><span class="op" id="6196009">,</span>&nbsp;<span class="ident" id="6196011">top</span><span class="op" id="6196014">,</span>&nbsp;<span class="ident" id="6196016">left</span><span class="op" id="6196020">+</span><span class="ident" id="6196021">width</span><span class="op" id="6196026">,</span>&nbsp;<span class="ident" id="6196028">top</span><span class="op" id="6196031">+</span><span class="ident" id="6196032">height</span><span class="op" id="6196038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196041">if</span>&nbsp;<span class="ident" id="6196044">bounds</span>&nbsp;<span class="op" id="6196051">!=</span>&nbsp;<span class="ident" id="6196054">bounds</span><span class="op" id="6196060">.</span><span class="ident" id="6196061">Intersect</span><span class="op" id="6196070">(</span><span class="ident" id="6196071">image</span><span class="op" id="6196076">.</span><span class="ident" id="6196077">Rect</span><span class="op" id="6196081">(</span><span class="num" id="6196082">0</span><span class="op" id="6196083">,</span>&nbsp;<span class="num" id="6196085">0</span><span class="op" id="6196086">,</span>&nbsp;<span class="ident" id="6196088">d</span><span class="op" id="6196089">.</span><span class="ident" id="6196090">width</span><span class="op" id="6196095">,</span>&nbsp;<span class="ident" id="6196097">d</span><span class="op" id="6196098">.</span><span class="ident" id="6196099">height</span><span class="op" id="6196105">)</span><span class="op" id="6196106">)</span>&nbsp;<span class="op" id="6196108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196112">return</span>&nbsp;<span class="ident" id="6196119">nil</span><span class="op" id="6196122">,</span>&nbsp;<span class="ident" id="6196124">errors</span><span class="op" id="6196130">.</span><span class="ident" id="6196131">New</span><span class="op" id="6196134">(</span><span class="string" id="6196135">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6196179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196182">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196185">return</span>&nbsp;<span class="ident" id="6196192">image</span><span class="op" id="6196197">.</span><span class="ident" id="6196198">NewPaletted</span><span class="op" id="6196209">(</span><span class="ident" id="6196210">bounds</span><span class="op" id="6196216">,</span>&nbsp;<span class="ident" id="6196218">nil</span><span class="op" id="6196221">)</span><span class="op" id="6196222">,</span>&nbsp;<span class="ident" id="6196224">nil</span><br>
<span class="lineno"></span><span class="op" id="6196228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6196231">func</span>&nbsp;<span class="op" id="6196236">(</span><span class="ident" id="6196237">d</span>&nbsp;<span class="op" id="6196239">*</span><span class="ident" id="6196240">decoder</span><span class="op" id="6196247">)</span>&nbsp;<span class="ident" id="6196249">readBlock</span><span class="op" id="6196258">(</span><span class="op" id="6196259">)</span>&nbsp;<span class="op" id="6196261">(</span><span class="builtintype" id="6196262">int</span><span class="op" id="6196265">,</span>&nbsp;<span class="builtintype" id="6196267">error</span><span class="op" id="6196272">)</span>&nbsp;<span class="op" id="6196274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6196277">n</span><span class="op" id="6196278">,</span>&nbsp;<span class="ident" id="6196280">err</span>&nbsp;<span class="op" id="6196284">:=</span>&nbsp;<span class="ident" id="6196287">d</span><span class="op" id="6196288">.</span><span class="ident" id="6196289">r</span><span class="op" id="6196290">.</span><span class="ident" id="6196291">ReadByte</span><span class="op" id="6196299">(</span><span class="op" id="6196300">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196303">if</span>&nbsp;<span class="ident" id="6196306">n</span>&nbsp;<span class="op" id="6196308">==</span>&nbsp;<span class="num" id="6196311">0</span>&nbsp;<span class="op" id="6196313">||</span>&nbsp;<span class="ident" id="6196316">err</span>&nbsp;<span class="op" id="6196320">!=</span>&nbsp;<span class="ident" id="6196323">nil</span>&nbsp;<span class="op" id="6196327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196331">return</span>&nbsp;<span class="num" id="6196338">0</span><span class="op" id="6196339">,</span>&nbsp;<span class="ident" id="6196341">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196349">return</span>&nbsp;<span class="ident" id="6196356">io</span><span class="op" id="6196358">.</span><span class="ident" id="6196359">ReadFull</span><span class="op" id="6196367">(</span><span class="ident" id="6196368">d</span><span class="op" id="6196369">.</span><span class="ident" id="6196370">r</span><span class="op" id="6196371">,</span>&nbsp;<span class="ident" id="6196373">d</span><span class="op" id="6196374">.</span><span class="ident" id="6196375">tmp</span><span class="op" id="6196378">[</span><span class="num" id="6196379">0</span><span class="op" id="6196380">:</span><span class="ident" id="6196381">n</span><span class="op" id="6196382">]</span><span class="op" id="6196383">)</span><br>
<span class="lineno"></span><span class="op" id="6196385">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6196388">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6196465">type</span>&nbsp;<span class="ident" id="6196470">interlaceScan</span>&nbsp;<span class="keyword" id="6196484">struct</span>&nbsp;<span class="op" id="6196491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6196494">skip</span><span class="op" id="6196498">,</span>&nbsp;<span class="ident" id="6196500">start</span>&nbsp;<span class="builtintype" id="6196506">int</span><br>
<span class="lineno"></span><span class="op" id="6196510">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6196513">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6196584">var</span>&nbsp;<span class="ident" id="6196588">interlacing</span>&nbsp;<span class="op" id="6196600">=</span>&nbsp;<span class="op" id="6196602">[</span><span class="op" id="6196603">]</span><span class="ident" id="6196604">interlaceScan</span><span class="op" id="6196617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196620">{</span><span class="num" id="6196621">8</span><span class="op" id="6196622">,</span>&nbsp;<span class="num" id="6196624">0</span><span class="op" id="6196625">}</span><span class="op" id="6196626">,</span>&nbsp;<span class="comment" id="6196628">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196679">{</span><span class="num" id="6196680">8</span><span class="op" id="6196681">,</span>&nbsp;<span class="num" id="6196683">4</span><span class="op" id="6196684">}</span><span class="op" id="6196685">,</span>&nbsp;<span class="comment" id="6196687">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196738">{</span><span class="num" id="6196739">4</span><span class="op" id="6196740">,</span>&nbsp;<span class="num" id="6196742">2</span><span class="op" id="6196743">}</span><span class="op" id="6196744">,</span>&nbsp;<span class="comment" id="6196746">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6196797">{</span><span class="num" id="6196798">2</span><span class="op" id="6196799">,</span>&nbsp;<span class="num" id="6196801">1</span><span class="op" id="6196802">}</span><span class="op" id="6196803">,</span>&nbsp;<span class="comment" id="6196805">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6196855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6196858">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6196933">func</span>&nbsp;<span class="ident" id="6196938">uninterlace</span><span class="op" id="6196949">(</span><span class="ident" id="6196950">m</span>&nbsp;<span class="op" id="6196952">*</span><span class="ident" id="6196953">image</span><span class="op" id="6196958">.</span><span class="ident" id="6196959">Paletted</span><span class="op" id="6196967">)</span>&nbsp;<span class="op" id="6196969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6196972">var</span>&nbsp;<span class="ident" id="6196976">nPix</span>&nbsp;<span class="op" id="6196981">[</span><span class="op" id="6196982">]</span><span class="builtintype" id="6196983">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6196990">dx</span>&nbsp;<span class="op" id="6196993">:=</span>&nbsp;<span class="ident" id="6196996">m</span><span class="op" id="6196997">.</span><span class="ident" id="6196998">Bounds</span><span class="op" id="6197004">(</span><span class="op" id="6197005">)</span><span class="op" id="6197006">.</span><span class="ident" id="6197007">Dx</span><span class="op" id="6197009">(</span><span class="op" id="6197010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197013">dy</span>&nbsp;<span class="op" id="6197016">:=</span>&nbsp;<span class="ident" id="6197019">m</span><span class="op" id="6197020">.</span><span class="ident" id="6197021">Bounds</span><span class="op" id="6197027">(</span><span class="op" id="6197028">)</span><span class="op" id="6197029">.</span><span class="ident" id="6197030">Dy</span><span class="op" id="6197032">(</span><span class="op" id="6197033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197036">nPix</span>&nbsp;<span class="op" id="6197041">=</span>&nbsp;<span class="builtinfunc" id="6197043">make</span><span class="op" id="6197047">(</span><span class="op" id="6197048">[</span><span class="op" id="6197049">]</span><span class="builtintype" id="6197050">uint8</span><span class="op" id="6197055">,</span>&nbsp;<span class="ident" id="6197057">dx</span><span class="op" id="6197059">*</span><span class="ident" id="6197060">dy</span><span class="op" id="6197062">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197065">offset</span>&nbsp;<span class="op" id="6197072">:=</span>&nbsp;<span class="num" id="6197075">0</span>&nbsp;<span class="comment" id="6197077">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197131">for</span>&nbsp;<span class="ident" id="6197135">_</span><span class="op" id="6197136">,</span>&nbsp;<span class="ident" id="6197138">pass</span>&nbsp;<span class="op" id="6197143">:=</span>&nbsp;<span class="keyword" id="6197146">range</span>&nbsp;<span class="ident" id="6197152">interlacing</span>&nbsp;<span class="op" id="6197164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197168">nOffset</span>&nbsp;<span class="op" id="6197176">:=</span>&nbsp;<span class="ident" id="6197179">pass</span><span class="op" id="6197183">.</span><span class="ident" id="6197184">start</span>&nbsp;<span class="op" id="6197190">*</span>&nbsp;<span class="ident" id="6197192">dx</span>&nbsp;<span class="comment" id="6197195">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197245">for</span>&nbsp;<span class="ident" id="6197249">y</span>&nbsp;<span class="op" id="6197251">:=</span>&nbsp;<span class="ident" id="6197254">pass</span><span class="op" id="6197258">.</span><span class="ident" id="6197259">start</span><span class="op" id="6197264">;</span>&nbsp;<span class="ident" id="6197266">y</span>&nbsp;<span class="op" id="6197268">&lt;</span>&nbsp;<span class="ident" id="6197270">dy</span><span class="op" id="6197272">;</span>&nbsp;<span class="ident" id="6197274">y</span>&nbsp;<span class="op" id="6197276">+=</span>&nbsp;<span class="ident" id="6197279">pass</span><span class="op" id="6197283">.</span><span class="ident" id="6197284">skip</span>&nbsp;<span class="op" id="6197289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6197294">copy</span><span class="op" id="6197298">(</span><span class="ident" id="6197299">nPix</span><span class="op" id="6197303">[</span><span class="ident" id="6197304">nOffset</span><span class="op" id="6197311">:</span><span class="ident" id="6197312">nOffset</span><span class="op" id="6197319">+</span><span class="ident" id="6197320">dx</span><span class="op" id="6197322">]</span><span class="op" id="6197323">,</span>&nbsp;<span class="ident" id="6197325">m</span><span class="op" id="6197326">.</span><span class="ident" id="6197327">Pix</span><span class="op" id="6197330">[</span><span class="ident" id="6197331">offset</span><span class="op" id="6197337">:</span><span class="ident" id="6197338">offset</span><span class="op" id="6197344">+</span><span class="ident" id="6197345">dx</span><span class="op" id="6197347">]</span><span class="op" id="6197348">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197353">offset</span>&nbsp;<span class="op" id="6197360">+=</span>&nbsp;<span class="ident" id="6197363">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197369">nOffset</span>&nbsp;<span class="op" id="6197377">+=</span>&nbsp;<span class="ident" id="6197380">dx</span>&nbsp;<span class="op" id="6197383">*</span>&nbsp;<span class="ident" id="6197385">pass</span><span class="op" id="6197389">.</span><span class="ident" id="6197390">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6197397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6197400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197403">m</span><span class="op" id="6197404">.</span><span class="ident" id="6197405">Pix</span>&nbsp;<span class="op" id="6197409">=</span>&nbsp;<span class="ident" id="6197411">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6197416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6197419">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6197485">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6197513">func</span>&nbsp;<span class="ident" id="6197518">Decode</span><span class="op" id="6197524">(</span><span class="ident" id="6197525">r</span>&nbsp;<span class="ident" id="6197527">io</span><span class="op" id="6197529">.</span><span class="ident" id="6197530">Reader</span><span class="op" id="6197536">)</span>&nbsp;<span class="op" id="6197538">(</span><span class="ident" id="6197539">image</span><span class="op" id="6197544">.</span><span class="ident" id="6197545">Image</span><span class="op" id="6197550">,</span>&nbsp;<span class="builtintype" id="6197552">error</span><span class="op" id="6197557">)</span>&nbsp;<span class="op" id="6197559">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197562">var</span>&nbsp;<span class="ident" id="6197566">d</span>&nbsp;<span class="ident" id="6197568">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197577">if</span>&nbsp;<span class="ident" id="6197580">err</span>&nbsp;<span class="op" id="6197584">:=</span>&nbsp;<span class="ident" id="6197587">d</span><span class="op" id="6197588">.</span><span class="ident" id="6197589">decode</span><span class="op" id="6197595">(</span><span class="ident" id="6197596">r</span><span class="op" id="6197597">,</span>&nbsp;<span class="builtintype" id="6197599">false</span><span class="op" id="6197604">)</span><span class="op" id="6197605">;</span>&nbsp;<span class="ident" id="6197607">err</span>&nbsp;<span class="op" id="6197611">!=</span>&nbsp;<span class="ident" id="6197614">nil</span>&nbsp;<span class="op" id="6197618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197622">return</span>&nbsp;<span class="ident" id="6197629">nil</span><span class="op" id="6197632">,</span>&nbsp;<span class="ident" id="6197634">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6197639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6197642">return</span>&nbsp;<span class="ident" id="6197649">d</span><span class="op" id="6197650">.</span><span class="ident" id="6197651">image</span><span class="op" id="6197656">[</span><span class="num" id="6197657">0</span><span class="op" id="6197658">]</span><span class="op" id="6197659">,</span>&nbsp;<span class="ident" id="6197661">nil</span><br>
<span class="lineno">425</span><span class="op" id="6197665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6197668">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6197737">type</span>&nbsp;<span class="ident" id="6197742">GIF</span>&nbsp;<span class="keyword" id="6197746">struct</span>&nbsp;<span class="op" id="6197753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197756">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197766">[</span><span class="op" id="6197767">]</span><span class="op" id="6197768">*</span><span class="ident" id="6197769">image</span><span class="op" id="6197774">.</span><span class="ident" id="6197775">Paletted</span>&nbsp;<span class="comment" id="6197784">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197811">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197821">[</span><span class="op" id="6197822">]</span><span class="builtintype" id="6197823">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6197839">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6197909">LoopCount</span>&nbsp;<span class="builtintype" id="6197919">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6197937">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6197956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6197959">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6198031">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6198058">func</span>&nbsp;<span class="ident" id="6198063">DecodeAll</span><span class="op" id="6198072">(</span><span class="ident" id="6198073">r</span>&nbsp;<span class="ident" id="6198075">io</span><span class="op" id="6198077">.</span><span class="ident" id="6198078">Reader</span><span class="op" id="6198084">)</span>&nbsp;<span class="op" id="6198086">(</span><span class="op" id="6198087">*</span><span class="ident" id="6198088">GIF</span><span class="op" id="6198091">,</span>&nbsp;<span class="builtintype" id="6198093">error</span><span class="op" id="6198098">)</span>&nbsp;<span class="op" id="6198100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198103">var</span>&nbsp;<span class="ident" id="6198107">d</span>&nbsp;<span class="ident" id="6198109">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198118">if</span>&nbsp;<span class="ident" id="6198121">err</span>&nbsp;<span class="op" id="6198125">:=</span>&nbsp;<span class="ident" id="6198128">d</span><span class="op" id="6198129">.</span><span class="ident" id="6198130">decode</span><span class="op" id="6198136">(</span><span class="ident" id="6198137">r</span><span class="op" id="6198138">,</span>&nbsp;<span class="builtintype" id="6198140">false</span><span class="op" id="6198145">)</span><span class="op" id="6198146">;</span>&nbsp;<span class="ident" id="6198148">err</span>&nbsp;<span class="op" id="6198152">!=</span>&nbsp;<span class="ident" id="6198155">nil</span>&nbsp;<span class="op" id="6198159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198163">return</span>&nbsp;<span class="ident" id="6198170">nil</span><span class="op" id="6198173">,</span>&nbsp;<span class="ident" id="6198175">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6198180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198183">gif</span>&nbsp;<span class="op" id="6198187">:=</span>&nbsp;<span class="op" id="6198190">&amp;</span><span class="ident" id="6198191">GIF</span><span class="op" id="6198194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198198">Image</span><span class="op" id="6198203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198209">d</span><span class="op" id="6198210">.</span><span class="ident" id="6198211">image</span><span class="op" id="6198216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198220">LoopCount</span><span class="op" id="6198229">:</span>&nbsp;<span class="ident" id="6198231">d</span><span class="op" id="6198232">.</span><span class="ident" id="6198233">loopCount</span><span class="op" id="6198242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198246">Delay</span><span class="op" id="6198251">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198257">d</span><span class="op" id="6198258">.</span><span class="ident" id="6198259">delay</span><span class="op" id="6198264">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6198267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198270">return</span>&nbsp;<span class="ident" id="6198277">gif</span><span class="op" id="6198280">,</span>&nbsp;<span class="ident" id="6198282">nil</span><br>
<span class="lineno"></span><span class="op" id="6198286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6198289">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6198366">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6198404">func</span>&nbsp;<span class="ident" id="6198409">DecodeConfig</span><span class="op" id="6198421">(</span><span class="ident" id="6198422">r</span>&nbsp;<span class="ident" id="6198424">io</span><span class="op" id="6198426">.</span><span class="ident" id="6198427">Reader</span><span class="op" id="6198433">)</span>&nbsp;<span class="op" id="6198435">(</span><span class="ident" id="6198436">image</span><span class="op" id="6198441">.</span><span class="ident" id="6198442">Config</span><span class="op" id="6198448">,</span>&nbsp;<span class="builtintype" id="6198450">error</span><span class="op" id="6198455">)</span>&nbsp;<span class="op" id="6198457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198460">var</span>&nbsp;<span class="ident" id="6198464">d</span>&nbsp;<span class="ident" id="6198466">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198475">if</span>&nbsp;<span class="ident" id="6198478">err</span>&nbsp;<span class="op" id="6198482">:=</span>&nbsp;<span class="ident" id="6198485">d</span><span class="op" id="6198486">.</span><span class="ident" id="6198487">decode</span><span class="op" id="6198493">(</span><span class="ident" id="6198494">r</span><span class="op" id="6198495">,</span>&nbsp;<span class="builtintype" id="6198497">true</span><span class="op" id="6198501">)</span><span class="op" id="6198502">;</span>&nbsp;<span class="ident" id="6198504">err</span>&nbsp;<span class="op" id="6198508">!=</span>&nbsp;<span class="ident" id="6198511">nil</span>&nbsp;<span class="op" id="6198515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198519">return</span>&nbsp;<span class="ident" id="6198526">image</span><span class="op" id="6198531">.</span><span class="ident" id="6198532">Config</span><span class="op" id="6198538">{</span><span class="op" id="6198539">}</span><span class="op" id="6198540">,</span>&nbsp;<span class="ident" id="6198542">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6198547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6198550">return</span>&nbsp;<span class="ident" id="6198557">image</span><span class="op" id="6198562">.</span><span class="ident" id="6198563">Config</span><span class="op" id="6198569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198573">ColorModel</span><span class="op" id="6198583">:</span>&nbsp;<span class="ident" id="6198585">d</span><span class="op" id="6198586">.</span><span class="ident" id="6198587">globalColorMap</span><span class="op" id="6198601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198605">Width</span><span class="op" id="6198610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198617">d</span><span class="op" id="6198618">.</span><span class="ident" id="6198619">width</span><span class="op" id="6198624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198628">Height</span><span class="op" id="6198634">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198640">d</span><span class="op" id="6198641">.</span><span class="ident" id="6198642">height</span><span class="op" id="6198648">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6198651">}</span><span class="op" id="6198652">,</span>&nbsp;<span class="ident" id="6198654">nil</span><br>
<span class="lineno"></span><span class="op" id="6198658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6198661">func</span>&nbsp;<span class="ident" id="6198666">init</span><span class="op" id="6198670">(</span><span class="op" id="6198671">)</span>&nbsp;<span class="op" id="6198673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6198676">image</span><span class="op" id="6198681">.</span><span class="ident" id="6198682">RegisterFormat</span><span class="op" id="6198696">(</span><span class="string" id="6198697">&#34;gif&#34;</span><span class="op" id="6198702">,</span>&nbsp;<span class="string" id="6198704">&#34;GIF8?a&#34;</span><span class="op" id="6198712">,</span>&nbsp;<span class="ident" id="6198714">Decode</span><span class="op" id="6198720">,</span>&nbsp;<span class="ident" id="6198722">DecodeConfig</span><span class="op" id="6198734">)</span><br>
<span class="lineno">465</span><span class="op" id="6198736">}</span>
</div>
</body>
</html>
