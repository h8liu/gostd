<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5399064">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5399119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5399173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5399224">package</span>&nbsp;<span class="ident" id="5399232">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399239">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5399312">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5399389">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5399468">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5399547">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5399625">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5399704">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5399778">type</span>&nbsp;<span class="ident" id="5399783">moveToFrontDecoder</span>&nbsp;<span class="op" id="5399802">[</span><span class="op" id="5399803">]</span><span class="builtintype" id="5399804">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5399810">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5399889">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5399904">func</span>&nbsp;<span class="ident" id="5399909">newMTFDecoder</span><span class="op" id="5399922">(</span><span class="ident" id="5399923">symbols</span>&nbsp;<span class="op" id="5399931">[</span><span class="op" id="5399932">]</span><span class="builtintype" id="5399933">byte</span><span class="op" id="5399937">)</span>&nbsp;<span class="ident" id="5399939">moveToFrontDecoder</span>&nbsp;<span class="op" id="5399958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399961">if</span>&nbsp;<span class="builtinfunc" id="5399964">len</span><span class="op" id="5399967">(</span><span class="ident" id="5399968">symbols</span><span class="op" id="5399975">)</span>&nbsp;<span class="op" id="5399977">&gt;</span>&nbsp;<span class="num" id="5399979">256</span>&nbsp;<span class="op" id="5399983">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5399987">panic</span><span class="op" id="5399992">(</span><span class="string" id="5399993">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5400011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400017">return</span>&nbsp;<span class="ident" id="5400024">moveToFrontDecoder</span><span class="op" id="5400042">(</span><span class="ident" id="5400043">symbols</span><span class="op" id="5400050">)</span><br>
<span class="lineno"></span><span class="op" id="5400052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5400055">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5400129">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5400156">func</span>&nbsp;<span class="ident" id="5400161">newMTFDecoderWithRange</span><span class="op" id="5400183">(</span><span class="ident" id="5400184">n</span>&nbsp;<span class="builtintype" id="5400186">int</span><span class="op" id="5400189">)</span>&nbsp;<span class="ident" id="5400191">moveToFrontDecoder</span>&nbsp;<span class="op" id="5400210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400213">if</span>&nbsp;<span class="ident" id="5400216">n</span>&nbsp;<span class="op" id="5400218">&gt;</span>&nbsp;<span class="num" id="5400220">256</span>&nbsp;<span class="op" id="5400224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5400228">panic</span><span class="op" id="5400233">(</span><span class="string" id="5400234">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5400285">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400292">m</span>&nbsp;<span class="op" id="5400294">:=</span>&nbsp;<span class="builtinfunc" id="5400297">make</span><span class="op" id="5400301">(</span><span class="op" id="5400302">[</span><span class="op" id="5400303">]</span><span class="builtintype" id="5400304">byte</span><span class="op" id="5400308">,</span>&nbsp;<span class="ident" id="5400310">n</span><span class="op" id="5400311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400314">for</span>&nbsp;<span class="ident" id="5400318">i</span>&nbsp;<span class="op" id="5400320">:=</span>&nbsp;<span class="num" id="5400323">0</span><span class="op" id="5400324">;</span>&nbsp;<span class="ident" id="5400326">i</span>&nbsp;<span class="op" id="5400328">&lt;</span>&nbsp;<span class="ident" id="5400330">n</span><span class="op" id="5400331">;</span>&nbsp;<span class="ident" id="5400333">i</span><span class="op" id="5400334">++</span>&nbsp;<span class="op" id="5400337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400341">m</span><span class="op" id="5400342">[</span><span class="ident" id="5400343">i</span><span class="op" id="5400344">]</span>&nbsp;<span class="op" id="5400346">=</span>&nbsp;<span class="builtintype" id="5400348">byte</span><span class="op" id="5400352">(</span><span class="ident" id="5400353">i</span><span class="op" id="5400354">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400360">return</span>&nbsp;<span class="ident" id="5400367">moveToFrontDecoder</span><span class="op" id="5400385">(</span><span class="ident" id="5400386">m</span><span class="op" id="5400387">)</span><br>
<span class="lineno"></span><span class="op" id="5400389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5400392">func</span>&nbsp;<span class="op" id="5400397">(</span><span class="ident" id="5400398">m</span>&nbsp;<span class="ident" id="5400400">moveToFrontDecoder</span><span class="op" id="5400418">)</span>&nbsp;<span class="ident" id="5400420">Decode</span><span class="op" id="5400426">(</span><span class="ident" id="5400427">n</span>&nbsp;<span class="builtintype" id="5400429">int</span><span class="op" id="5400432">)</span>&nbsp;<span class="op" id="5400434">(</span><span class="ident" id="5400435">b</span>&nbsp;<span class="builtintype" id="5400437">byte</span><span class="op" id="5400441">)</span>&nbsp;<span class="op" id="5400443">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400446">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400508">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400574">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400632">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400699">b</span>&nbsp;<span class="op" id="5400701">=</span>&nbsp;<span class="ident" id="5400703">m</span><span class="op" id="5400704">[</span><span class="ident" id="5400705">n</span><span class="op" id="5400706">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5400709">copy</span><span class="op" id="5400713">(</span><span class="ident" id="5400714">m</span><span class="op" id="5400715">[</span><span class="num" id="5400716">1</span><span class="op" id="5400717">:</span><span class="op" id="5400718">]</span><span class="op" id="5400719">,</span>&nbsp;<span class="ident" id="5400721">m</span><span class="op" id="5400722">[</span><span class="op" id="5400723">:</span><span class="ident" id="5400724">n</span><span class="op" id="5400725">]</span><span class="op" id="5400726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400729">m</span><span class="op" id="5400730">[</span><span class="num" id="5400731">0</span><span class="op" id="5400732">]</span>&nbsp;<span class="op" id="5400734">=</span>&nbsp;<span class="ident" id="5400736">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400739">return</span><br>
<span class="lineno"></span><span class="op" id="5400746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5400749">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5400803">func</span>&nbsp;<span class="op" id="5400808">(</span><span class="ident" id="5400809">m</span>&nbsp;<span class="ident" id="5400811">moveToFrontDecoder</span><span class="op" id="5400829">)</span>&nbsp;<span class="ident" id="5400831">First</span><span class="op" id="5400836">(</span><span class="op" id="5400837">)</span>&nbsp;<span class="builtintype" id="5400839">byte</span>&nbsp;<span class="op" id="5400844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400847">return</span>&nbsp;<span class="ident" id="5400854">m</span><span class="op" id="5400855">[</span><span class="num" id="5400856">0</span><span class="op" id="5400857">]</span><br>
<span class="lineno"></span><span class="op" id="5400859">}</span>
</div>
</body>
</html>
