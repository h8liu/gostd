<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6224890">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6224945">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6224999">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6225050">package</span>&nbsp;<span class="ident" id="6225058">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6225066">import</span>&nbsp;<span class="string" id="6225073">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6225079">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="6225131">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6225168">func</span>&nbsp;<span class="ident" id="6225173">TruncateWriter</span><span class="op" id="6225187">(</span><span class="ident" id="6225188">w</span>&nbsp;<span class="ident" id="6225190">io</span><span class="op" id="6225192">.</span><span class="ident" id="6225193">Writer</span><span class="op" id="6225199">,</span>&nbsp;<span class="ident" id="6225201">n</span>&nbsp;<span class="ident" id="6225203">int64</span><span class="op" id="6225208">)</span>&nbsp;<span class="ident" id="6225210">io</span><span class="op" id="6225212">.</span><span class="ident" id="6225213">Writer</span>&nbsp;<span class="op" id="6225220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225223">return</span>&nbsp;<span class="op" id="6225230">&amp;</span><span class="ident" id="6225231">truncateWriter</span><span class="op" id="6225245">{</span><span class="ident" id="6225246">w</span><span class="op" id="6225247">,</span>&nbsp;<span class="ident" id="6225249">n</span><span class="op" id="6225250">}</span><br>
<span class="lineno"></span><span class="op" id="6225252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6225255">type</span>&nbsp;<span class="ident" id="6225260">truncateWriter</span>&nbsp;<span class="keyword" id="6225275">struct</span>&nbsp;<span class="op" id="6225282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225285">w</span>&nbsp;<span class="ident" id="6225287">io</span><span class="op" id="6225289">.</span><span class="ident" id="6225290">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225298">n</span>&nbsp;<span class="ident" id="6225300">int64</span><br>
<span class="lineno"></span><span class="op" id="6225306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6225309">func</span>&nbsp;<span class="op" id="6225314">(</span><span class="ident" id="6225315">t</span>&nbsp;<span class="op" id="6225317">*</span><span class="ident" id="6225318">truncateWriter</span><span class="op" id="6225332">)</span>&nbsp;<span class="ident" id="6225334">Write</span><span class="op" id="6225339">(</span><span class="ident" id="6225340">p</span>&nbsp;<span class="op" id="6225342">[</span><span class="op" id="6225343">]</span><span class="builtintype" id="6225344">byte</span><span class="op" id="6225348">)</span>&nbsp;<span class="op" id="6225350">(</span><span class="ident" id="6225351">n</span>&nbsp;<span class="builtintype" id="6225353">int</span><span class="op" id="6225356">,</span>&nbsp;<span class="ident" id="6225358">err</span>&nbsp;<span class="builtintype" id="6225362">error</span><span class="op" id="6225367">)</span>&nbsp;<span class="op" id="6225369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225372">if</span>&nbsp;<span class="ident" id="6225375">t</span><span class="op" id="6225376">.</span><span class="ident" id="6225377">n</span>&nbsp;<span class="op" id="6225379">&lt;=</span>&nbsp;<span class="num" id="6225382">0</span>&nbsp;<span class="op" id="6225384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225388">return</span>&nbsp;<span class="builtinfunc" id="6225395">len</span><span class="op" id="6225398">(</span><span class="ident" id="6225399">p</span><span class="op" id="6225400">)</span><span class="op" id="6225401">,</span>&nbsp;<span class="ident" id="6225403">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6225411">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225426">n</span>&nbsp;<span class="op" id="6225428">=</span>&nbsp;<span class="builtinfunc" id="6225430">len</span><span class="op" id="6225433">(</span><span class="ident" id="6225434">p</span><span class="op" id="6225435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225438">if</span>&nbsp;<span class="ident" id="6225441">int64</span><span class="op" id="6225446">(</span><span class="ident" id="6225447">n</span><span class="op" id="6225448">)</span>&nbsp;<span class="op" id="6225450">&gt;</span>&nbsp;<span class="ident" id="6225452">t</span><span class="op" id="6225453">.</span><span class="ident" id="6225454">n</span>&nbsp;<span class="op" id="6225456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225460">n</span>&nbsp;<span class="op" id="6225462">=</span>&nbsp;<span class="builtintype" id="6225464">int</span><span class="op" id="6225467">(</span><span class="ident" id="6225468">t</span><span class="op" id="6225469">.</span><span class="ident" id="6225470">n</span><span class="op" id="6225471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225477">n</span><span class="op" id="6225478">,</span>&nbsp;<span class="ident" id="6225480">err</span>&nbsp;<span class="op" id="6225484">=</span>&nbsp;<span class="ident" id="6225486">t</span><span class="op" id="6225487">.</span><span class="ident" id="6225488">w</span><span class="op" id="6225489">.</span><span class="ident" id="6225490">Write</span><span class="op" id="6225495">(</span><span class="ident" id="6225496">p</span><span class="op" id="6225497">[</span><span class="num" id="6225498">0</span><span class="op" id="6225499">:</span><span class="ident" id="6225500">n</span><span class="op" id="6225501">]</span><span class="op" id="6225502">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225505">t</span><span class="op" id="6225506">.</span><span class="ident" id="6225507">n</span>&nbsp;<span class="op" id="6225509">-=</span>&nbsp;<span class="ident" id="6225512">int64</span><span class="op" id="6225517">(</span><span class="ident" id="6225518">n</span><span class="op" id="6225519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225522">if</span>&nbsp;<span class="ident" id="6225525">err</span>&nbsp;<span class="op" id="6225529">==</span>&nbsp;<span class="ident" id="6225532">nil</span>&nbsp;<span class="op" id="6225536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225540">n</span>&nbsp;<span class="op" id="6225542">=</span>&nbsp;<span class="builtinfunc" id="6225544">len</span><span class="op" id="6225547">(</span><span class="ident" id="6225548">p</span><span class="op" id="6225549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225555">return</span><br>
<span class="lineno">35</span><span class="op" id="6225562">}</span>
</div>
</body>
</html>
