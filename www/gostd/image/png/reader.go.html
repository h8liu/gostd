<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5439810">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5439865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5439919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5439970">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5440029">//</span><br>
<span class="lineno"></span><span class="comment" id="5440032">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5440090">package</span>&nbsp;<span class="ident" id="5440098">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5440103">import</span>&nbsp;<span class="op" id="5440110">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440113">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440130">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440149">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440156">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440164">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440178">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440187">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5440202">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5440207">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5440210">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5440246">const</span>&nbsp;<span class="op" id="5440252">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440255">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440272">=</span>&nbsp;<span class="num" id="5440274">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440277">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440294">=</span>&nbsp;<span class="num" id="5440296">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440299">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440316">=</span>&nbsp;<span class="num" id="5440318">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440321">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5440338">=</span>&nbsp;<span class="num" id="5440340">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440343">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5440360">=</span>&nbsp;<span class="num" id="5440362">6</span><br>
<span class="lineno"></span><span class="op" id="5440364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5440367">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5440421">const</span>&nbsp;<span class="op" id="5440427">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440430">cbInvalid</span>&nbsp;<span class="op" id="5440440">=</span>&nbsp;<span class="ident" id="5440442">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440448">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440454">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440460">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440466">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440472">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440479">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440486">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440492">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440498">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440504">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440510">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440518">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440525">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440533">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440541">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5440549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5440552">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5440589">const</span>&nbsp;<span class="op" id="5440595">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440598">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440608">=</span>&nbsp;<span class="num" id="5440610">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440613">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440623">=</span>&nbsp;<span class="num" id="5440625">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440628">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440638">=</span>&nbsp;<span class="num" id="5440640">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440643">ftAverage</span>&nbsp;<span class="op" id="5440653">=</span>&nbsp;<span class="num" id="5440655">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440658">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5440668">=</span>&nbsp;<span class="num" id="5440670">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440673">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5440683">=</span>&nbsp;<span class="num" id="5440685">5</span><br>
<span class="lineno"></span><span class="op" id="5440687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5440690">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5440709">const</span>&nbsp;<span class="op" id="5440715">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440718">itNone</span>&nbsp;&nbsp;<span class="op" id="5440726">=</span>&nbsp;<span class="num" id="5440728">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440731">itAdam7</span>&nbsp;<span class="op" id="5440739">=</span>&nbsp;<span class="num" id="5440741">1</span><br>
<span class="lineno"></span><span class="op" id="5440743">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5440746">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5440827">type</span>&nbsp;<span class="ident" id="5440832">interlaceScan</span>&nbsp;<span class="keyword" id="5440846">struct</span>&nbsp;<span class="op" id="5440853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440856">xFactor</span><span class="op" id="5440863">,</span>&nbsp;<span class="ident" id="5440865">yFactor</span><span class="op" id="5440872">,</span>&nbsp;<span class="ident" id="5440874">xOffset</span><span class="op" id="5440881">,</span>&nbsp;<span class="ident" id="5440883">yOffset</span>&nbsp;<span class="builtintype" id="5440891">int</span><br>
<span class="lineno"></span><span class="op" id="5440895">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5440898">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5440973">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5441017">var</span>&nbsp;<span class="ident" id="5441021">interlacing</span>&nbsp;<span class="op" id="5441033">=</span>&nbsp;<span class="op" id="5441035">[</span><span class="op" id="5441036">]</span><span class="ident" id="5441037">interlaceScan</span><span class="op" id="5441050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441053">{</span><span class="num" id="5441054">8</span><span class="op" id="5441055">,</span>&nbsp;<span class="num" id="5441057">8</span><span class="op" id="5441058">,</span>&nbsp;<span class="num" id="5441060">0</span><span class="op" id="5441061">,</span>&nbsp;<span class="num" id="5441063">0</span><span class="op" id="5441064">}</span><span class="op" id="5441065">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441068">{</span><span class="num" id="5441069">8</span><span class="op" id="5441070">,</span>&nbsp;<span class="num" id="5441072">8</span><span class="op" id="5441073">,</span>&nbsp;<span class="num" id="5441075">4</span><span class="op" id="5441076">,</span>&nbsp;<span class="num" id="5441078">0</span><span class="op" id="5441079">}</span><span class="op" id="5441080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441083">{</span><span class="num" id="5441084">4</span><span class="op" id="5441085">,</span>&nbsp;<span class="num" id="5441087">8</span><span class="op" id="5441088">,</span>&nbsp;<span class="num" id="5441090">0</span><span class="op" id="5441091">,</span>&nbsp;<span class="num" id="5441093">4</span><span class="op" id="5441094">}</span><span class="op" id="5441095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441098">{</span><span class="num" id="5441099">4</span><span class="op" id="5441100">,</span>&nbsp;<span class="num" id="5441102">4</span><span class="op" id="5441103">,</span>&nbsp;<span class="num" id="5441105">2</span><span class="op" id="5441106">,</span>&nbsp;<span class="num" id="5441108">0</span><span class="op" id="5441109">}</span><span class="op" id="5441110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441113">{</span><span class="num" id="5441114">2</span><span class="op" id="5441115">,</span>&nbsp;<span class="num" id="5441117">4</span><span class="op" id="5441118">,</span>&nbsp;<span class="num" id="5441120">0</span><span class="op" id="5441121">,</span>&nbsp;<span class="num" id="5441123">2</span><span class="op" id="5441124">}</span><span class="op" id="5441125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441128">{</span><span class="num" id="5441129">2</span><span class="op" id="5441130">,</span>&nbsp;<span class="num" id="5441132">2</span><span class="op" id="5441133">,</span>&nbsp;<span class="num" id="5441135">1</span><span class="op" id="5441136">,</span>&nbsp;<span class="num" id="5441138">0</span><span class="op" id="5441139">}</span><span class="op" id="5441140">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441143">{</span><span class="num" id="5441144">1</span><span class="op" id="5441145">,</span>&nbsp;<span class="num" id="5441147">2</span><span class="op" id="5441148">,</span>&nbsp;<span class="num" id="5441150">0</span><span class="op" id="5441151">,</span>&nbsp;<span class="num" id="5441153">1</span><span class="op" id="5441154">}</span><span class="op" id="5441155">,</span><br>
<span class="lineno"></span><span class="op" id="5441157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441160">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5441179">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5441257">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5441333">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5441408">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5441426">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5441470">const</span>&nbsp;<span class="op" id="5441476">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441479">dsStart</span>&nbsp;<span class="op" id="5441487">=</span>&nbsp;<span class="ident" id="5441489">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441495">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441507">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441519">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441531">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5441542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5441545">const</span>&nbsp;<span class="ident" id="5441551">pngHeader</span>&nbsp;<span class="op" id="5441561">=</span>&nbsp;<span class="string" id="5441563">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5441584">type</span>&nbsp;<span class="ident" id="5441589">decoder</span>&nbsp;<span class="keyword" id="5441597">struct</span>&nbsp;<span class="op" id="5441604">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441607">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441621">io</span><span class="op" id="5441623">.</span><span class="ident" id="5441624">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441632">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441646">image</span><span class="op" id="5441651">.</span><span class="ident" id="5441652">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441659">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441673">hash</span><span class="op" id="5441677">.</span><span class="ident" id="5441678">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441686">width</span><span class="op" id="5441691">,</span>&nbsp;<span class="ident" id="5441693">height</span>&nbsp;<span class="builtintype" id="5441700">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441705">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5441719">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441724">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441738">color</span><span class="op" id="5441743">.</span><span class="ident" id="5441744">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441753">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5441767">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441772">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5441786">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441791">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5441805">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441813">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441827">[</span><span class="num" id="5441828">3</span>&nbsp;<span class="op" id="5441830">*</span>&nbsp;<span class="num" id="5441832">256</span><span class="op" id="5441835">]</span><span class="builtintype" id="5441836">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441842">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5441856">int</span><br>
<span class="lineno"></span><span class="op" id="5441860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441863">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5441923">type</span>&nbsp;<span class="ident" id="5441928">FormatError</span>&nbsp;<span class="builtintype" id="5441940">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5441948">func</span>&nbsp;<span class="op" id="5441953">(</span><span class="ident" id="5441954">e</span>&nbsp;<span class="ident" id="5441956">FormatError</span><span class="op" id="5441967">)</span>&nbsp;<span class="ident" id="5441969">Error</span><span class="op" id="5441974">(</span><span class="op" id="5441975">)</span>&nbsp;<span class="builtintype" id="5441977">string</span>&nbsp;<span class="op" id="5441984">{</span>&nbsp;<span class="keyword" id="5441986">return</span>&nbsp;<span class="string" id="5441993">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5442017">+</span>&nbsp;<span class="builtintype" id="5442019">string</span><span class="op" id="5442025">(</span><span class="ident" id="5442026">e</span><span class="op" id="5442027">)</span>&nbsp;<span class="op" id="5442029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442032">var</span>&nbsp;<span class="ident" id="5442036">chunkOrderError</span>&nbsp;<span class="op" id="5442052">=</span>&nbsp;<span class="ident" id="5442054">FormatError</span><span class="op" id="5442065">(</span><span class="string" id="5442066">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5442086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5442089">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5442179">type</span>&nbsp;<span class="ident" id="5442184">UnsupportedError</span>&nbsp;<span class="builtintype" id="5442201">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442209">func</span>&nbsp;<span class="op" id="5442214">(</span><span class="ident" id="5442215">e</span>&nbsp;<span class="ident" id="5442217">UnsupportedError</span><span class="op" id="5442233">)</span>&nbsp;<span class="ident" id="5442235">Error</span><span class="op" id="5442240">(</span><span class="op" id="5442241">)</span>&nbsp;<span class="builtintype" id="5442243">string</span>&nbsp;<span class="op" id="5442250">{</span>&nbsp;<span class="keyword" id="5442252">return</span>&nbsp;<span class="string" id="5442259">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5442288">+</span>&nbsp;<span class="builtintype" id="5442290">string</span><span class="op" id="5442296">(</span><span class="ident" id="5442297">e</span><span class="op" id="5442298">)</span>&nbsp;<span class="op" id="5442300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5442303">func</span>&nbsp;<span class="ident" id="5442308">min</span><span class="op" id="5442311">(</span><span class="ident" id="5442312">a</span><span class="op" id="5442313">,</span>&nbsp;<span class="ident" id="5442315">b</span>&nbsp;<span class="builtintype" id="5442317">int</span><span class="op" id="5442320">)</span>&nbsp;<span class="builtintype" id="5442322">int</span>&nbsp;<span class="op" id="5442326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442329">if</span>&nbsp;<span class="ident" id="5442332">a</span>&nbsp;<span class="op" id="5442334">&lt;</span>&nbsp;<span class="ident" id="5442336">b</span>&nbsp;<span class="op" id="5442338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442342">return</span>&nbsp;<span class="ident" id="5442349">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442355">return</span>&nbsp;<span class="ident" id="5442362">b</span><br>
<span class="lineno">130</span><span class="op" id="5442364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442367">func</span>&nbsp;<span class="op" id="5442372">(</span><span class="ident" id="5442373">d</span>&nbsp;<span class="op" id="5442375">*</span><span class="ident" id="5442376">decoder</span><span class="op" id="5442383">)</span>&nbsp;<span class="ident" id="5442385">parseIHDR</span><span class="op" id="5442394">(</span><span class="ident" id="5442395">length</span>&nbsp;<span class="builtintype" id="5442402">uint32</span><span class="op" id="5442408">)</span>&nbsp;<span class="builtintype" id="5442410">error</span>&nbsp;<span class="op" id="5442416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442419">if</span>&nbsp;<span class="ident" id="5442422">length</span>&nbsp;<span class="op" id="5442429">!=</span>&nbsp;<span class="num" id="5442432">13</span>&nbsp;<span class="op" id="5442435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442439">return</span>&nbsp;<span class="ident" id="5442446">FormatError</span><span class="op" id="5442457">(</span><span class="string" id="5442458">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5442475">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442481">if</span>&nbsp;<span class="ident" id="5442484">_</span><span class="op" id="5442485">,</span>&nbsp;<span class="ident" id="5442487">err</span>&nbsp;<span class="op" id="5442491">:=</span>&nbsp;<span class="ident" id="5442494">io</span><span class="op" id="5442496">.</span><span class="ident" id="5442497">ReadFull</span><span class="op" id="5442505">(</span><span class="ident" id="5442506">d</span><span class="op" id="5442507">.</span><span class="ident" id="5442508">r</span><span class="op" id="5442509">,</span>&nbsp;<span class="ident" id="5442511">d</span><span class="op" id="5442512">.</span><span class="ident" id="5442513">tmp</span><span class="op" id="5442516">[</span><span class="op" id="5442517">:</span><span class="num" id="5442518">13</span><span class="op" id="5442520">]</span><span class="op" id="5442521">)</span><span class="op" id="5442522">;</span>&nbsp;<span class="ident" id="5442524">err</span>&nbsp;<span class="op" id="5442528">!=</span>&nbsp;<span class="ident" id="5442531">nil</span>&nbsp;<span class="op" id="5442535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442539">return</span>&nbsp;<span class="ident" id="5442546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442554">d</span><span class="op" id="5442555">.</span><span class="ident" id="5442556">crc</span><span class="op" id="5442559">.</span><span class="ident" id="5442560">Write</span><span class="op" id="5442565">(</span><span class="ident" id="5442566">d</span><span class="op" id="5442567">.</span><span class="ident" id="5442568">tmp</span><span class="op" id="5442571">[</span><span class="op" id="5442572">:</span><span class="num" id="5442573">13</span><span class="op" id="5442575">]</span><span class="op" id="5442576">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442579">if</span>&nbsp;<span class="ident" id="5442582">d</span><span class="op" id="5442583">.</span><span class="ident" id="5442584">tmp</span><span class="op" id="5442587">[</span><span class="num" id="5442588">10</span><span class="op" id="5442590">]</span>&nbsp;<span class="op" id="5442592">!=</span>&nbsp;<span class="num" id="5442595">0</span>&nbsp;<span class="op" id="5442597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442601">return</span>&nbsp;<span class="ident" id="5442608">UnsupportedError</span><span class="op" id="5442624">(</span><span class="string" id="5442625">&#34;compression&nbsp;method&#34;</span><span class="op" id="5442645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442651">if</span>&nbsp;<span class="ident" id="5442654">d</span><span class="op" id="5442655">.</span><span class="ident" id="5442656">tmp</span><span class="op" id="5442659">[</span><span class="num" id="5442660">11</span><span class="op" id="5442662">]</span>&nbsp;<span class="op" id="5442664">!=</span>&nbsp;<span class="num" id="5442667">0</span>&nbsp;<span class="op" id="5442669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442673">return</span>&nbsp;<span class="ident" id="5442680">UnsupportedError</span><span class="op" id="5442696">(</span><span class="string" id="5442697">&#34;filter&nbsp;method&#34;</span><span class="op" id="5442712">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442718">if</span>&nbsp;<span class="ident" id="5442721">d</span><span class="op" id="5442722">.</span><span class="ident" id="5442723">tmp</span><span class="op" id="5442726">[</span><span class="num" id="5442727">12</span><span class="op" id="5442729">]</span>&nbsp;<span class="op" id="5442731">!=</span>&nbsp;<span class="ident" id="5442734">itNone</span>&nbsp;<span class="op" id="5442741">&amp;&amp;</span>&nbsp;<span class="ident" id="5442744">d</span><span class="op" id="5442745">.</span><span class="ident" id="5442746">tmp</span><span class="op" id="5442749">[</span><span class="num" id="5442750">12</span><span class="op" id="5442752">]</span>&nbsp;<span class="op" id="5442754">!=</span>&nbsp;<span class="ident" id="5442757">itAdam7</span>&nbsp;<span class="op" id="5442765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442769">return</span>&nbsp;<span class="ident" id="5442776">FormatError</span><span class="op" id="5442787">(</span><span class="string" id="5442788">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5442814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442820">d</span><span class="op" id="5442821">.</span><span class="ident" id="5442822">interlace</span>&nbsp;<span class="op" id="5442832">=</span>&nbsp;<span class="builtintype" id="5442834">int</span><span class="op" id="5442837">(</span><span class="ident" id="5442838">d</span><span class="op" id="5442839">.</span><span class="ident" id="5442840">tmp</span><span class="op" id="5442843">[</span><span class="num" id="5442844">12</span><span class="op" id="5442846">]</span><span class="op" id="5442847">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442850">w</span>&nbsp;<span class="op" id="5442852">:=</span>&nbsp;<span class="builtintype" id="5442855">int32</span><span class="op" id="5442860">(</span><span class="ident" id="5442861">binary</span><span class="op" id="5442867">.</span><span class="ident" id="5442868">BigEndian</span><span class="op" id="5442877">.</span><span class="ident" id="5442878">Uint32</span><span class="op" id="5442884">(</span><span class="ident" id="5442885">d</span><span class="op" id="5442886">.</span><span class="ident" id="5442887">tmp</span><span class="op" id="5442890">[</span><span class="num" id="5442891">0</span><span class="op" id="5442892">:</span><span class="num" id="5442893">4</span><span class="op" id="5442894">]</span><span class="op" id="5442895">)</span><span class="op" id="5442896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442899">h</span>&nbsp;<span class="op" id="5442901">:=</span>&nbsp;<span class="builtintype" id="5442904">int32</span><span class="op" id="5442909">(</span><span class="ident" id="5442910">binary</span><span class="op" id="5442916">.</span><span class="ident" id="5442917">BigEndian</span><span class="op" id="5442926">.</span><span class="ident" id="5442927">Uint32</span><span class="op" id="5442933">(</span><span class="ident" id="5442934">d</span><span class="op" id="5442935">.</span><span class="ident" id="5442936">tmp</span><span class="op" id="5442939">[</span><span class="num" id="5442940">4</span><span class="op" id="5442941">:</span><span class="num" id="5442942">8</span><span class="op" id="5442943">]</span><span class="op" id="5442944">)</span><span class="op" id="5442945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442948">if</span>&nbsp;<span class="ident" id="5442951">w</span>&nbsp;<span class="op" id="5442953">&lt;</span>&nbsp;<span class="num" id="5442955">0</span>&nbsp;<span class="op" id="5442957">||</span>&nbsp;<span class="ident" id="5442960">h</span>&nbsp;<span class="op" id="5442962">&lt;</span>&nbsp;<span class="num" id="5442964">0</span>&nbsp;<span class="op" id="5442966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442970">return</span>&nbsp;<span class="ident" id="5442977">FormatError</span><span class="op" id="5442988">(</span><span class="string" id="5442989">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5443009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443012">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443015">nPixels</span>&nbsp;<span class="op" id="5443023">:=</span>&nbsp;<span class="ident" id="5443026">int64</span><span class="op" id="5443031">(</span><span class="ident" id="5443032">w</span><span class="op" id="5443033">)</span>&nbsp;<span class="op" id="5443035">*</span>&nbsp;<span class="ident" id="5443037">int64</span><span class="op" id="5443042">(</span><span class="ident" id="5443043">h</span><span class="op" id="5443044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443047">if</span>&nbsp;<span class="ident" id="5443050">nPixels</span>&nbsp;<span class="op" id="5443058">!=</span>&nbsp;<span class="ident" id="5443061">int64</span><span class="op" id="5443066">(</span><span class="builtintype" id="5443067">int</span><span class="op" id="5443070">(</span><span class="ident" id="5443071">nPixels</span><span class="op" id="5443078">)</span><span class="op" id="5443079">)</span>&nbsp;<span class="op" id="5443081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443085">return</span>&nbsp;<span class="ident" id="5443092">UnsupportedError</span><span class="op" id="5443108">(</span><span class="string" id="5443109">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5443129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443135">d</span><span class="op" id="5443136">.</span><span class="ident" id="5443137">cb</span>&nbsp;<span class="op" id="5443140">=</span>&nbsp;<span class="ident" id="5443142">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443153">d</span><span class="op" id="5443154">.</span><span class="ident" id="5443155">depth</span>&nbsp;<span class="op" id="5443161">=</span>&nbsp;<span class="builtintype" id="5443163">int</span><span class="op" id="5443166">(</span><span class="ident" id="5443167">d</span><span class="op" id="5443168">.</span><span class="ident" id="5443169">tmp</span><span class="op" id="5443172">[</span><span class="num" id="5443173">8</span><span class="op" id="5443174">]</span><span class="op" id="5443175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443178">switch</span>&nbsp;<span class="ident" id="5443185">d</span><span class="op" id="5443186">.</span><span class="ident" id="5443187">depth</span>&nbsp;<span class="op" id="5443193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443196">case</span>&nbsp;<span class="num" id="5443201">1</span><span class="op" id="5443202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443206">switch</span>&nbsp;<span class="ident" id="5443213">d</span><span class="op" id="5443214">.</span><span class="ident" id="5443215">tmp</span><span class="op" id="5443218">[</span><span class="num" id="5443219">9</span><span class="op" id="5443220">]</span>&nbsp;<span class="op" id="5443222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443226">case</span>&nbsp;<span class="ident" id="5443231">ctGrayscale</span><span class="op" id="5443242">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443247">d</span><span class="op" id="5443248">.</span><span class="ident" id="5443249">cb</span>&nbsp;<span class="op" id="5443252">=</span>&nbsp;<span class="ident" id="5443254">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443261">case</span>&nbsp;<span class="ident" id="5443266">ctPaletted</span><span class="op" id="5443276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443281">d</span><span class="op" id="5443282">.</span><span class="ident" id="5443283">cb</span>&nbsp;<span class="op" id="5443286">=</span>&nbsp;<span class="ident" id="5443288">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443298">case</span>&nbsp;<span class="num" id="5443303">2</span><span class="op" id="5443304">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443308">switch</span>&nbsp;<span class="ident" id="5443315">d</span><span class="op" id="5443316">.</span><span class="ident" id="5443317">tmp</span><span class="op" id="5443320">[</span><span class="num" id="5443321">9</span><span class="op" id="5443322">]</span>&nbsp;<span class="op" id="5443324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443328">case</span>&nbsp;<span class="ident" id="5443333">ctGrayscale</span><span class="op" id="5443344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443349">d</span><span class="op" id="5443350">.</span><span class="ident" id="5443351">cb</span>&nbsp;<span class="op" id="5443354">=</span>&nbsp;<span class="ident" id="5443356">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443363">case</span>&nbsp;<span class="ident" id="5443368">ctPaletted</span><span class="op" id="5443378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443383">d</span><span class="op" id="5443384">.</span><span class="ident" id="5443385">cb</span>&nbsp;<span class="op" id="5443388">=</span>&nbsp;<span class="ident" id="5443390">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443400">case</span>&nbsp;<span class="num" id="5443405">4</span><span class="op" id="5443406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443410">switch</span>&nbsp;<span class="ident" id="5443417">d</span><span class="op" id="5443418">.</span><span class="ident" id="5443419">tmp</span><span class="op" id="5443422">[</span><span class="num" id="5443423">9</span><span class="op" id="5443424">]</span>&nbsp;<span class="op" id="5443426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443430">case</span>&nbsp;<span class="ident" id="5443435">ctGrayscale</span><span class="op" id="5443446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443451">d</span><span class="op" id="5443452">.</span><span class="ident" id="5443453">cb</span>&nbsp;<span class="op" id="5443456">=</span>&nbsp;<span class="ident" id="5443458">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443465">case</span>&nbsp;<span class="ident" id="5443470">ctPaletted</span><span class="op" id="5443480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443485">d</span><span class="op" id="5443486">.</span><span class="ident" id="5443487">cb</span>&nbsp;<span class="op" id="5443490">=</span>&nbsp;<span class="ident" id="5443492">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443502">case</span>&nbsp;<span class="num" id="5443507">8</span><span class="op" id="5443508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443512">switch</span>&nbsp;<span class="ident" id="5443519">d</span><span class="op" id="5443520">.</span><span class="ident" id="5443521">tmp</span><span class="op" id="5443524">[</span><span class="num" id="5443525">9</span><span class="op" id="5443526">]</span>&nbsp;<span class="op" id="5443528">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443532">case</span>&nbsp;<span class="ident" id="5443537">ctGrayscale</span><span class="op" id="5443548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443553">d</span><span class="op" id="5443554">.</span><span class="ident" id="5443555">cb</span>&nbsp;<span class="op" id="5443558">=</span>&nbsp;<span class="ident" id="5443560">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443567">case</span>&nbsp;<span class="ident" id="5443572">ctTrueColor</span><span class="op" id="5443583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443588">d</span><span class="op" id="5443589">.</span><span class="ident" id="5443590">cb</span>&nbsp;<span class="op" id="5443593">=</span>&nbsp;<span class="ident" id="5443595">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443603">case</span>&nbsp;<span class="ident" id="5443608">ctPaletted</span><span class="op" id="5443618">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443623">d</span><span class="op" id="5443624">.</span><span class="ident" id="5443625">cb</span>&nbsp;<span class="op" id="5443628">=</span>&nbsp;<span class="ident" id="5443630">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443637">case</span>&nbsp;<span class="ident" id="5443642">ctGrayscaleAlpha</span><span class="op" id="5443658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443663">d</span><span class="op" id="5443664">.</span><span class="ident" id="5443665">cb</span>&nbsp;<span class="op" id="5443668">=</span>&nbsp;<span class="ident" id="5443670">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443678">case</span>&nbsp;<span class="ident" id="5443683">ctTrueColorAlpha</span><span class="op" id="5443699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443704">d</span><span class="op" id="5443705">.</span><span class="ident" id="5443706">cb</span>&nbsp;<span class="op" id="5443709">=</span>&nbsp;<span class="ident" id="5443711">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443723">case</span>&nbsp;<span class="num" id="5443728">16</span><span class="op" id="5443730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443734">switch</span>&nbsp;<span class="ident" id="5443741">d</span><span class="op" id="5443742">.</span><span class="ident" id="5443743">tmp</span><span class="op" id="5443746">[</span><span class="num" id="5443747">9</span><span class="op" id="5443748">]</span>&nbsp;<span class="op" id="5443750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443754">case</span>&nbsp;<span class="ident" id="5443759">ctGrayscale</span><span class="op" id="5443770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443775">d</span><span class="op" id="5443776">.</span><span class="ident" id="5443777">cb</span>&nbsp;<span class="op" id="5443780">=</span>&nbsp;<span class="ident" id="5443782">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443790">case</span>&nbsp;<span class="ident" id="5443795">ctTrueColor</span><span class="op" id="5443806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443811">d</span><span class="op" id="5443812">.</span><span class="ident" id="5443813">cb</span>&nbsp;<span class="op" id="5443816">=</span>&nbsp;<span class="ident" id="5443818">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443827">case</span>&nbsp;<span class="ident" id="5443832">ctGrayscaleAlpha</span><span class="op" id="5443848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443853">d</span><span class="op" id="5443854">.</span><span class="ident" id="5443855">cb</span>&nbsp;<span class="op" id="5443858">=</span>&nbsp;<span class="ident" id="5443860">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443869">case</span>&nbsp;<span class="ident" id="5443874">ctTrueColorAlpha</span><span class="op" id="5443890">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443895">d</span><span class="op" id="5443896">.</span><span class="ident" id="5443897">cb</span>&nbsp;<span class="op" id="5443900">=</span>&nbsp;<span class="ident" id="5443902">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443918">if</span>&nbsp;<span class="ident" id="5443921">d</span><span class="op" id="5443922">.</span><span class="ident" id="5443923">cb</span>&nbsp;<span class="op" id="5443926">==</span>&nbsp;<span class="ident" id="5443929">cbInvalid</span>&nbsp;<span class="op" id="5443939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443943">return</span>&nbsp;<span class="ident" id="5443950">UnsupportedError</span><span class="op" id="5443966">(</span><span class="ident" id="5443967">fmt</span><span class="op" id="5443970">.</span><span class="ident" id="5443971">Sprintf</span><span class="op" id="5443978">(</span><span class="string" id="5443979">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5444008">,</span>&nbsp;<span class="ident" id="5444010">d</span><span class="op" id="5444011">.</span><span class="ident" id="5444012">tmp</span><span class="op" id="5444015">[</span><span class="num" id="5444016">8</span><span class="op" id="5444017">]</span><span class="op" id="5444018">,</span>&nbsp;<span class="ident" id="5444020">d</span><span class="op" id="5444021">.</span><span class="ident" id="5444022">tmp</span><span class="op" id="5444025">[</span><span class="num" id="5444026">9</span><span class="op" id="5444027">]</span><span class="op" id="5444028">)</span><span class="op" id="5444029">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444035">d</span><span class="op" id="5444036">.</span><span class="ident" id="5444037">width</span><span class="op" id="5444042">,</span>&nbsp;<span class="ident" id="5444044">d</span><span class="op" id="5444045">.</span><span class="ident" id="5444046">height</span>&nbsp;<span class="op" id="5444053">=</span>&nbsp;<span class="builtintype" id="5444055">int</span><span class="op" id="5444058">(</span><span class="ident" id="5444059">w</span><span class="op" id="5444060">)</span><span class="op" id="5444061">,</span>&nbsp;<span class="builtintype" id="5444063">int</span><span class="op" id="5444066">(</span><span class="ident" id="5444067">h</span><span class="op" id="5444068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444071">return</span>&nbsp;<span class="ident" id="5444078">d</span><span class="op" id="5444079">.</span><span class="ident" id="5444080">verifyChecksum</span><span class="op" id="5444094">(</span><span class="op" id="5444095">)</span><br>
<span class="lineno"></span><span class="op" id="5444097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5444100">func</span>&nbsp;<span class="op" id="5444105">(</span><span class="ident" id="5444106">d</span>&nbsp;<span class="op" id="5444108">*</span><span class="ident" id="5444109">decoder</span><span class="op" id="5444116">)</span>&nbsp;<span class="ident" id="5444118">parsePLTE</span><span class="op" id="5444127">(</span><span class="ident" id="5444128">length</span>&nbsp;<span class="builtintype" id="5444135">uint32</span><span class="op" id="5444141">)</span>&nbsp;<span class="builtintype" id="5444143">error</span>&nbsp;<span class="op" id="5444149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444152">np</span>&nbsp;<span class="op" id="5444155">:=</span>&nbsp;<span class="builtintype" id="5444158">int</span><span class="op" id="5444161">(</span><span class="ident" id="5444162">length</span>&nbsp;<span class="op" id="5444169">/</span>&nbsp;<span class="num" id="5444171">3</span><span class="op" id="5444172">)</span>&nbsp;<span class="comment" id="5444174">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444209">if</span>&nbsp;<span class="ident" id="5444212">length</span><span class="op" id="5444218">%</span><span class="num" id="5444219">3</span>&nbsp;<span class="op" id="5444221">!=</span>&nbsp;<span class="num" id="5444224">0</span>&nbsp;<span class="op" id="5444226">||</span>&nbsp;<span class="ident" id="5444229">np</span>&nbsp;<span class="op" id="5444232">&lt;=</span>&nbsp;<span class="num" id="5444235">0</span>&nbsp;<span class="op" id="5444237">||</span>&nbsp;<span class="ident" id="5444240">np</span>&nbsp;<span class="op" id="5444243">&gt;</span>&nbsp;<span class="num" id="5444245">256</span>&nbsp;<span class="op" id="5444249">||</span>&nbsp;<span class="ident" id="5444252">np</span>&nbsp;<span class="op" id="5444255">&gt;</span>&nbsp;<span class="num" id="5444257">1</span><span class="op" id="5444258">&lt;&lt;</span><span class="builtintype" id="5444260">uint</span><span class="op" id="5444264">(</span><span class="ident" id="5444265">d</span><span class="op" id="5444266">.</span><span class="ident" id="5444267">depth</span><span class="op" id="5444272">)</span>&nbsp;<span class="op" id="5444274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444278">return</span>&nbsp;<span class="ident" id="5444285">FormatError</span><span class="op" id="5444296">(</span><span class="string" id="5444297">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5444314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444317">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444320">n</span><span class="op" id="5444321">,</span>&nbsp;<span class="ident" id="5444323">err</span>&nbsp;<span class="op" id="5444327">:=</span>&nbsp;<span class="ident" id="5444330">io</span><span class="op" id="5444332">.</span><span class="ident" id="5444333">ReadFull</span><span class="op" id="5444341">(</span><span class="ident" id="5444342">d</span><span class="op" id="5444343">.</span><span class="ident" id="5444344">r</span><span class="op" id="5444345">,</span>&nbsp;<span class="ident" id="5444347">d</span><span class="op" id="5444348">.</span><span class="ident" id="5444349">tmp</span><span class="op" id="5444352">[</span><span class="op" id="5444353">:</span><span class="num" id="5444354">3</span><span class="op" id="5444355">*</span><span class="ident" id="5444356">np</span><span class="op" id="5444358">]</span><span class="op" id="5444359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444362">if</span>&nbsp;<span class="ident" id="5444365">err</span>&nbsp;<span class="op" id="5444369">!=</span>&nbsp;<span class="ident" id="5444372">nil</span>&nbsp;<span class="op" id="5444376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444380">return</span>&nbsp;<span class="ident" id="5444387">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444395">d</span><span class="op" id="5444396">.</span><span class="ident" id="5444397">crc</span><span class="op" id="5444400">.</span><span class="ident" id="5444401">Write</span><span class="op" id="5444406">(</span><span class="ident" id="5444407">d</span><span class="op" id="5444408">.</span><span class="ident" id="5444409">tmp</span><span class="op" id="5444412">[</span><span class="op" id="5444413">:</span><span class="ident" id="5444414">n</span><span class="op" id="5444415">]</span><span class="op" id="5444416">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444419">switch</span>&nbsp;<span class="ident" id="5444426">d</span><span class="op" id="5444427">.</span><span class="ident" id="5444428">cb</span>&nbsp;<span class="op" id="5444431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444434">case</span>&nbsp;<span class="ident" id="5444439">cbP1</span><span class="op" id="5444443">,</span>&nbsp;<span class="ident" id="5444445">cbP2</span><span class="op" id="5444449">,</span>&nbsp;<span class="ident" id="5444451">cbP4</span><span class="op" id="5444455">,</span>&nbsp;<span class="ident" id="5444457">cbP8</span><span class="op" id="5444461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444465">d</span><span class="op" id="5444466">.</span><span class="ident" id="5444467">palette</span>&nbsp;<span class="op" id="5444475">=</span>&nbsp;<span class="builtinfunc" id="5444477">make</span><span class="op" id="5444481">(</span><span class="ident" id="5444482">color</span><span class="op" id="5444487">.</span><span class="ident" id="5444488">Palette</span><span class="op" id="5444495">,</span>&nbsp;<span class="num" id="5444497">256</span><span class="op" id="5444500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444504">for</span>&nbsp;<span class="ident" id="5444508">i</span>&nbsp;<span class="op" id="5444510">:=</span>&nbsp;<span class="num" id="5444513">0</span><span class="op" id="5444514">;</span>&nbsp;<span class="ident" id="5444516">i</span>&nbsp;<span class="op" id="5444518">&lt;</span>&nbsp;<span class="ident" id="5444520">np</span><span class="op" id="5444522">;</span>&nbsp;<span class="ident" id="5444524">i</span><span class="op" id="5444525">++</span>&nbsp;<span class="op" id="5444528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444533">d</span><span class="op" id="5444534">.</span><span class="ident" id="5444535">palette</span><span class="op" id="5444542">[</span><span class="ident" id="5444543">i</span><span class="op" id="5444544">]</span>&nbsp;<span class="op" id="5444546">=</span>&nbsp;<span class="ident" id="5444548">color</span><span class="op" id="5444553">.</span><span class="ident" id="5444554">RGBA</span><span class="op" id="5444558">{</span><span class="ident" id="5444559">d</span><span class="op" id="5444560">.</span><span class="ident" id="5444561">tmp</span><span class="op" id="5444564">[</span><span class="num" id="5444565">3</span><span class="op" id="5444566">*</span><span class="ident" id="5444567">i</span><span class="op" id="5444568">+</span><span class="num" id="5444569">0</span><span class="op" id="5444570">]</span><span class="op" id="5444571">,</span>&nbsp;<span class="ident" id="5444573">d</span><span class="op" id="5444574">.</span><span class="ident" id="5444575">tmp</span><span class="op" id="5444578">[</span><span class="num" id="5444579">3</span><span class="op" id="5444580">*</span><span class="ident" id="5444581">i</span><span class="op" id="5444582">+</span><span class="num" id="5444583">1</span><span class="op" id="5444584">]</span><span class="op" id="5444585">,</span>&nbsp;<span class="ident" id="5444587">d</span><span class="op" id="5444588">.</span><span class="ident" id="5444589">tmp</span><span class="op" id="5444592">[</span><span class="num" id="5444593">3</span><span class="op" id="5444594">*</span><span class="ident" id="5444595">i</span><span class="op" id="5444596">+</span><span class="num" id="5444597">2</span><span class="op" id="5444598">]</span><span class="op" id="5444599">,</span>&nbsp;<span class="num" id="5444601">0xff</span><span class="op" id="5444605">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444613">for</span>&nbsp;<span class="ident" id="5444617">i</span>&nbsp;<span class="op" id="5444619">:=</span>&nbsp;<span class="ident" id="5444622">np</span><span class="op" id="5444624">;</span>&nbsp;<span class="ident" id="5444626">i</span>&nbsp;<span class="op" id="5444628">&lt;</span>&nbsp;<span class="num" id="5444630">256</span><span class="op" id="5444633">;</span>&nbsp;<span class="ident" id="5444635">i</span><span class="op" id="5444636">++</span>&nbsp;<span class="op" id="5444639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444644">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444720">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444798">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444872">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444943">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444985">d</span><span class="op" id="5444986">.</span><span class="ident" id="5444987">palette</span><span class="op" id="5444994">[</span><span class="ident" id="5444995">i</span><span class="op" id="5444996">]</span>&nbsp;<span class="op" id="5444998">=</span>&nbsp;<span class="ident" id="5445000">color</span><span class="op" id="5445005">.</span><span class="ident" id="5445006">RGBA</span><span class="op" id="5445010">{</span><span class="num" id="5445011">0x00</span><span class="op" id="5445015">,</span>&nbsp;<span class="num" id="5445017">0x00</span><span class="op" id="5445021">,</span>&nbsp;<span class="num" id="5445023">0x00</span><span class="op" id="5445027">,</span>&nbsp;<span class="num" id="5445029">0xff</span><span class="op" id="5445033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445041">d</span><span class="op" id="5445042">.</span><span class="ident" id="5445043">palette</span>&nbsp;<span class="op" id="5445051">=</span>&nbsp;<span class="ident" id="5445053">d</span><span class="op" id="5445054">.</span><span class="ident" id="5445055">palette</span><span class="op" id="5445062">[</span><span class="op" id="5445063">:</span><span class="ident" id="5445064">np</span><span class="op" id="5445066">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445069">case</span>&nbsp;<span class="ident" id="5445074">cbTC8</span><span class="op" id="5445079">,</span>&nbsp;<span class="ident" id="5445081">cbTCA8</span><span class="op" id="5445087">,</span>&nbsp;<span class="ident" id="5445089">cbTC16</span><span class="op" id="5445095">,</span>&nbsp;<span class="ident" id="5445097">cbTCA16</span><span class="op" id="5445104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445108">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445188">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445273">default</span><span class="op" id="5445280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445284">return</span>&nbsp;<span class="ident" id="5445291">FormatError</span><span class="op" id="5445302">(</span><span class="string" id="5445303">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5445330">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445336">return</span>&nbsp;<span class="ident" id="5445343">d</span><span class="op" id="5445344">.</span><span class="ident" id="5445345">verifyChecksum</span><span class="op" id="5445359">(</span><span class="op" id="5445360">)</span><br>
<span class="lineno"></span><span class="op" id="5445362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5445365">func</span>&nbsp;<span class="op" id="5445370">(</span><span class="ident" id="5445371">d</span>&nbsp;<span class="op" id="5445373">*</span><span class="ident" id="5445374">decoder</span><span class="op" id="5445381">)</span>&nbsp;<span class="ident" id="5445383">parsetRNS</span><span class="op" id="5445392">(</span><span class="ident" id="5445393">length</span>&nbsp;<span class="builtintype" id="5445400">uint32</span><span class="op" id="5445406">)</span>&nbsp;<span class="builtintype" id="5445408">error</span>&nbsp;<span class="op" id="5445414">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445417">if</span>&nbsp;<span class="ident" id="5445420">length</span>&nbsp;<span class="op" id="5445427">&gt;</span>&nbsp;<span class="num" id="5445429">256</span>&nbsp;<span class="op" id="5445433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445437">return</span>&nbsp;<span class="ident" id="5445444">FormatError</span><span class="op" id="5445455">(</span><span class="string" id="5445456">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5445473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445479">n</span><span class="op" id="5445480">,</span>&nbsp;<span class="ident" id="5445482">err</span>&nbsp;<span class="op" id="5445486">:=</span>&nbsp;<span class="ident" id="5445489">io</span><span class="op" id="5445491">.</span><span class="ident" id="5445492">ReadFull</span><span class="op" id="5445500">(</span><span class="ident" id="5445501">d</span><span class="op" id="5445502">.</span><span class="ident" id="5445503">r</span><span class="op" id="5445504">,</span>&nbsp;<span class="ident" id="5445506">d</span><span class="op" id="5445507">.</span><span class="ident" id="5445508">tmp</span><span class="op" id="5445511">[</span><span class="op" id="5445512">:</span><span class="ident" id="5445513">length</span><span class="op" id="5445519">]</span><span class="op" id="5445520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445523">if</span>&nbsp;<span class="ident" id="5445526">err</span>&nbsp;<span class="op" id="5445530">!=</span>&nbsp;<span class="ident" id="5445533">nil</span>&nbsp;<span class="op" id="5445537">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445541">return</span>&nbsp;<span class="ident" id="5445548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445556">d</span><span class="op" id="5445557">.</span><span class="ident" id="5445558">crc</span><span class="op" id="5445561">.</span><span class="ident" id="5445562">Write</span><span class="op" id="5445567">(</span><span class="ident" id="5445568">d</span><span class="op" id="5445569">.</span><span class="ident" id="5445570">tmp</span><span class="op" id="5445573">[</span><span class="op" id="5445574">:</span><span class="ident" id="5445575">n</span><span class="op" id="5445576">]</span><span class="op" id="5445577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445580">switch</span>&nbsp;<span class="ident" id="5445587">d</span><span class="op" id="5445588">.</span><span class="ident" id="5445589">cb</span>&nbsp;<span class="op" id="5445592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445595">case</span>&nbsp;<span class="ident" id="5445600">cbG8</span><span class="op" id="5445604">,</span>&nbsp;<span class="ident" id="5445606">cbG16</span><span class="op" id="5445611">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445615">return</span>&nbsp;<span class="ident" id="5445622">UnsupportedError</span><span class="op" id="5445638">(</span><span class="string" id="5445639">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5445663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445666">case</span>&nbsp;<span class="ident" id="5445671">cbTC8</span><span class="op" id="5445676">,</span>&nbsp;<span class="ident" id="5445678">cbTC16</span><span class="op" id="5445684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445688">return</span>&nbsp;<span class="ident" id="5445695">UnsupportedError</span><span class="op" id="5445711">(</span><span class="string" id="5445712">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5445736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445739">case</span>&nbsp;<span class="ident" id="5445744">cbP1</span><span class="op" id="5445748">,</span>&nbsp;<span class="ident" id="5445750">cbP2</span><span class="op" id="5445754">,</span>&nbsp;<span class="ident" id="5445756">cbP4</span><span class="op" id="5445760">,</span>&nbsp;<span class="ident" id="5445762">cbP8</span><span class="op" id="5445766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445770">if</span>&nbsp;<span class="builtinfunc" id="5445773">len</span><span class="op" id="5445776">(</span><span class="ident" id="5445777">d</span><span class="op" id="5445778">.</span><span class="ident" id="5445779">palette</span><span class="op" id="5445786">)</span>&nbsp;<span class="op" id="5445788">&lt;</span>&nbsp;<span class="ident" id="5445790">n</span>&nbsp;<span class="op" id="5445792">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445797">d</span><span class="op" id="5445798">.</span><span class="ident" id="5445799">palette</span>&nbsp;<span class="op" id="5445807">=</span>&nbsp;<span class="ident" id="5445809">d</span><span class="op" id="5445810">.</span><span class="ident" id="5445811">palette</span><span class="op" id="5445818">[</span><span class="op" id="5445819">:</span><span class="ident" id="5445820">n</span><span class="op" id="5445821">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445829">for</span>&nbsp;<span class="ident" id="5445833">i</span>&nbsp;<span class="op" id="5445835">:=</span>&nbsp;<span class="num" id="5445838">0</span><span class="op" id="5445839">;</span>&nbsp;<span class="ident" id="5445841">i</span>&nbsp;<span class="op" id="5445843">&lt;</span>&nbsp;<span class="ident" id="5445845">n</span><span class="op" id="5445846">;</span>&nbsp;<span class="ident" id="5445848">i</span><span class="op" id="5445849">++</span>&nbsp;<span class="op" id="5445852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445857">rgba</span>&nbsp;<span class="op" id="5445862">:=</span>&nbsp;<span class="ident" id="5445865">d</span><span class="op" id="5445866">.</span><span class="ident" id="5445867">palette</span><span class="op" id="5445874">[</span><span class="ident" id="5445875">i</span><span class="op" id="5445876">]</span><span class="op" id="5445877">.</span><span class="op" id="5445878">(</span><span class="ident" id="5445879">color</span><span class="op" id="5445884">.</span><span class="ident" id="5445885">RGBA</span><span class="op" id="5445889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445894">d</span><span class="op" id="5445895">.</span><span class="ident" id="5445896">palette</span><span class="op" id="5445903">[</span><span class="ident" id="5445904">i</span><span class="op" id="5445905">]</span>&nbsp;<span class="op" id="5445907">=</span>&nbsp;<span class="ident" id="5445909">color</span><span class="op" id="5445914">.</span><span class="ident" id="5445915">NRGBA</span><span class="op" id="5445920">{</span><span class="ident" id="5445921">rgba</span><span class="op" id="5445925">.</span><span class="ident" id="5445926">R</span><span class="op" id="5445927">,</span>&nbsp;<span class="ident" id="5445929">rgba</span><span class="op" id="5445933">.</span><span class="ident" id="5445934">G</span><span class="op" id="5445935">,</span>&nbsp;<span class="ident" id="5445937">rgba</span><span class="op" id="5445941">.</span><span class="ident" id="5445942">B</span><span class="op" id="5445943">,</span>&nbsp;<span class="ident" id="5445945">d</span><span class="op" id="5445946">.</span><span class="ident" id="5445947">tmp</span><span class="op" id="5445950">[</span><span class="ident" id="5445951">i</span><span class="op" id="5445952">]</span><span class="op" id="5445953">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445960">case</span>&nbsp;<span class="ident" id="5445965">cbGA8</span><span class="op" id="5445970">,</span>&nbsp;<span class="ident" id="5445972">cbGA16</span><span class="op" id="5445978">,</span>&nbsp;<span class="ident" id="5445980">cbTCA8</span><span class="op" id="5445986">,</span>&nbsp;<span class="ident" id="5445988">cbTCA16</span><span class="op" id="5445995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445999">return</span>&nbsp;<span class="ident" id="5446006">FormatError</span><span class="op" id="5446017">(</span><span class="string" id="5446018">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5446045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446051">return</span>&nbsp;<span class="ident" id="5446058">d</span><span class="op" id="5446059">.</span><span class="ident" id="5446060">verifyChecksum</span><span class="op" id="5446074">(</span><span class="op" id="5446075">)</span><br>
<span class="lineno">275</span><span class="op" id="5446077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446080">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5446157">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5446230">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5446291">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5446371">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5446451">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5446528">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5446583">func</span>&nbsp;<span class="op" id="5446588">(</span><span class="ident" id="5446589">d</span>&nbsp;<span class="op" id="5446591">*</span><span class="ident" id="5446592">decoder</span><span class="op" id="5446599">)</span>&nbsp;<span class="ident" id="5446601">Read</span><span class="op" id="5446605">(</span><span class="ident" id="5446606">p</span>&nbsp;<span class="op" id="5446608">[</span><span class="op" id="5446609">]</span><span class="builtintype" id="5446610">byte</span><span class="op" id="5446614">)</span>&nbsp;<span class="op" id="5446616">(</span><span class="builtintype" id="5446617">int</span><span class="op" id="5446620">,</span>&nbsp;<span class="builtintype" id="5446622">error</span><span class="op" id="5446627">)</span>&nbsp;<span class="op" id="5446629">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446632">if</span>&nbsp;<span class="builtinfunc" id="5446635">len</span><span class="op" id="5446638">(</span><span class="ident" id="5446639">p</span><span class="op" id="5446640">)</span>&nbsp;<span class="op" id="5446642">==</span>&nbsp;<span class="num" id="5446645">0</span>&nbsp;<span class="op" id="5446647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446651">return</span>&nbsp;<span class="num" id="5446658">0</span><span class="op" id="5446659">,</span>&nbsp;<span class="ident" id="5446661">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446669">for</span>&nbsp;<span class="ident" id="5446673">d</span><span class="op" id="5446674">.</span><span class="ident" id="5446675">idatLength</span>&nbsp;<span class="op" id="5446686">==</span>&nbsp;<span class="num" id="5446689">0</span>&nbsp;<span class="op" id="5446691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446695">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446768">if</span>&nbsp;<span class="ident" id="5446771">err</span>&nbsp;<span class="op" id="5446775">:=</span>&nbsp;<span class="ident" id="5446778">d</span><span class="op" id="5446779">.</span><span class="ident" id="5446780">verifyChecksum</span><span class="op" id="5446794">(</span><span class="op" id="5446795">)</span><span class="op" id="5446796">;</span>&nbsp;<span class="ident" id="5446798">err</span>&nbsp;<span class="op" id="5446802">!=</span>&nbsp;<span class="ident" id="5446805">nil</span>&nbsp;<span class="op" id="5446809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446814">return</span>&nbsp;<span class="num" id="5446821">0</span><span class="op" id="5446822">,</span>&nbsp;<span class="ident" id="5446824">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446834">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5446904">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446930">if</span>&nbsp;<span class="ident" id="5446933">_</span><span class="op" id="5446934">,</span>&nbsp;<span class="ident" id="5446936">err</span>&nbsp;<span class="op" id="5446940">:=</span>&nbsp;<span class="ident" id="5446943">io</span><span class="op" id="5446945">.</span><span class="ident" id="5446946">ReadFull</span><span class="op" id="5446954">(</span><span class="ident" id="5446955">d</span><span class="op" id="5446956">.</span><span class="ident" id="5446957">r</span><span class="op" id="5446958">,</span>&nbsp;<span class="ident" id="5446960">d</span><span class="op" id="5446961">.</span><span class="ident" id="5446962">tmp</span><span class="op" id="5446965">[</span><span class="op" id="5446966">:</span><span class="num" id="5446967">8</span><span class="op" id="5446968">]</span><span class="op" id="5446969">)</span><span class="op" id="5446970">;</span>&nbsp;<span class="ident" id="5446972">err</span>&nbsp;<span class="op" id="5446976">!=</span>&nbsp;<span class="ident" id="5446979">nil</span>&nbsp;<span class="op" id="5446983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446988">return</span>&nbsp;<span class="num" id="5446995">0</span><span class="op" id="5446996">,</span>&nbsp;<span class="ident" id="5446998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447008">d</span><span class="op" id="5447009">.</span><span class="ident" id="5447010">idatLength</span>&nbsp;<span class="op" id="5447021">=</span>&nbsp;<span class="ident" id="5447023">binary</span><span class="op" id="5447029">.</span><span class="ident" id="5447030">BigEndian</span><span class="op" id="5447039">.</span><span class="ident" id="5447040">Uint32</span><span class="op" id="5447046">(</span><span class="ident" id="5447047">d</span><span class="op" id="5447048">.</span><span class="ident" id="5447049">tmp</span><span class="op" id="5447052">[</span><span class="op" id="5447053">:</span><span class="num" id="5447054">4</span><span class="op" id="5447055">]</span><span class="op" id="5447056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447060">if</span>&nbsp;<span class="builtintype" id="5447063">string</span><span class="op" id="5447069">(</span><span class="ident" id="5447070">d</span><span class="op" id="5447071">.</span><span class="ident" id="5447072">tmp</span><span class="op" id="5447075">[</span><span class="num" id="5447076">4</span><span class="op" id="5447077">:</span><span class="num" id="5447078">8</span><span class="op" id="5447079">]</span><span class="op" id="5447080">)</span>&nbsp;<span class="op" id="5447082">!=</span>&nbsp;<span class="string" id="5447085">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5447092">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447097">return</span>&nbsp;<span class="num" id="5447104">0</span><span class="op" id="5447105">,</span>&nbsp;<span class="ident" id="5447107">FormatError</span><span class="op" id="5447118">(</span><span class="string" id="5447119">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5447142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447150">d</span><span class="op" id="5447151">.</span><span class="ident" id="5447152">crc</span><span class="op" id="5447155">.</span><span class="ident" id="5447156">Reset</span><span class="op" id="5447161">(</span><span class="op" id="5447162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447166">d</span><span class="op" id="5447167">.</span><span class="ident" id="5447168">crc</span><span class="op" id="5447171">.</span><span class="ident" id="5447172">Write</span><span class="op" id="5447177">(</span><span class="ident" id="5447178">d</span><span class="op" id="5447179">.</span><span class="ident" id="5447180">tmp</span><span class="op" id="5447183">[</span><span class="num" id="5447184">4</span><span class="op" id="5447185">:</span><span class="num" id="5447186">8</span><span class="op" id="5447187">]</span><span class="op" id="5447188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447191">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447194">if</span>&nbsp;<span class="builtintype" id="5447197">int</span><span class="op" id="5447200">(</span><span class="ident" id="5447201">d</span><span class="op" id="5447202">.</span><span class="ident" id="5447203">idatLength</span><span class="op" id="5447213">)</span>&nbsp;<span class="op" id="5447215">&lt;</span>&nbsp;<span class="num" id="5447217">0</span>&nbsp;<span class="op" id="5447219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447223">return</span>&nbsp;<span class="num" id="5447230">0</span><span class="op" id="5447231">,</span>&nbsp;<span class="ident" id="5447233">UnsupportedError</span><span class="op" id="5447249">(</span><span class="string" id="5447250">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5447278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447284">n</span><span class="op" id="5447285">,</span>&nbsp;<span class="ident" id="5447287">err</span>&nbsp;<span class="op" id="5447291">:=</span>&nbsp;<span class="ident" id="5447294">d</span><span class="op" id="5447295">.</span><span class="ident" id="5447296">r</span><span class="op" id="5447297">.</span><span class="ident" id="5447298">Read</span><span class="op" id="5447302">(</span><span class="ident" id="5447303">p</span><span class="op" id="5447304">[</span><span class="op" id="5447305">:</span><span class="ident" id="5447306">min</span><span class="op" id="5447309">(</span><span class="builtinfunc" id="5447310">len</span><span class="op" id="5447313">(</span><span class="ident" id="5447314">p</span><span class="op" id="5447315">)</span><span class="op" id="5447316">,</span>&nbsp;<span class="builtintype" id="5447318">int</span><span class="op" id="5447321">(</span><span class="ident" id="5447322">d</span><span class="op" id="5447323">.</span><span class="ident" id="5447324">idatLength</span><span class="op" id="5447334">)</span><span class="op" id="5447335">)</span><span class="op" id="5447336">]</span><span class="op" id="5447337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447340">d</span><span class="op" id="5447341">.</span><span class="ident" id="5447342">crc</span><span class="op" id="5447345">.</span><span class="ident" id="5447346">Write</span><span class="op" id="5447351">(</span><span class="ident" id="5447352">p</span><span class="op" id="5447353">[</span><span class="op" id="5447354">:</span><span class="ident" id="5447355">n</span><span class="op" id="5447356">]</span><span class="op" id="5447357">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447360">d</span><span class="op" id="5447361">.</span><span class="ident" id="5447362">idatLength</span>&nbsp;<span class="op" id="5447373">-=</span>&nbsp;<span class="builtintype" id="5447376">uint32</span><span class="op" id="5447382">(</span><span class="ident" id="5447383">n</span><span class="op" id="5447384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447387">return</span>&nbsp;<span class="ident" id="5447394">n</span><span class="op" id="5447395">,</span>&nbsp;<span class="ident" id="5447397">err</span><br>
<span class="lineno"></span><span class="op" id="5447401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5447404">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5447451">func</span>&nbsp;<span class="op" id="5447456">(</span><span class="ident" id="5447457">d</span>&nbsp;<span class="op" id="5447459">*</span><span class="ident" id="5447460">decoder</span><span class="op" id="5447467">)</span>&nbsp;<span class="ident" id="5447469">decode</span><span class="op" id="5447475">(</span><span class="op" id="5447476">)</span>&nbsp;<span class="op" id="5447478">(</span><span class="ident" id="5447479">image</span><span class="op" id="5447484">.</span><span class="ident" id="5447485">Image</span><span class="op" id="5447490">,</span>&nbsp;<span class="builtintype" id="5447492">error</span><span class="op" id="5447497">)</span>&nbsp;<span class="op" id="5447499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447502">r</span><span class="op" id="5447503">,</span>&nbsp;<span class="ident" id="5447505">err</span>&nbsp;<span class="op" id="5447509">:=</span>&nbsp;<span class="ident" id="5447512">zlib</span><span class="op" id="5447516">.</span><span class="ident" id="5447517">NewReader</span><span class="op" id="5447526">(</span><span class="ident" id="5447527">d</span><span class="op" id="5447528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447531">if</span>&nbsp;<span class="ident" id="5447534">err</span>&nbsp;<span class="op" id="5447538">!=</span>&nbsp;<span class="ident" id="5447541">nil</span>&nbsp;<span class="op" id="5447545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447549">return</span>&nbsp;<span class="ident" id="5447556">nil</span><span class="op" id="5447559">,</span>&nbsp;<span class="ident" id="5447561">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447566">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447569">defer</span>&nbsp;<span class="ident" id="5447575">r</span><span class="op" id="5447576">.</span><span class="ident" id="5447577">Close</span><span class="op" id="5447582">(</span><span class="op" id="5447583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447586">var</span>&nbsp;<span class="ident" id="5447590">img</span>&nbsp;<span class="ident" id="5447594">image</span><span class="op" id="5447599">.</span><span class="ident" id="5447600">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447607">if</span>&nbsp;<span class="ident" id="5447610">d</span><span class="op" id="5447611">.</span><span class="ident" id="5447612">interlace</span>&nbsp;<span class="op" id="5447622">==</span>&nbsp;<span class="ident" id="5447625">itNone</span>&nbsp;<span class="op" id="5447632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447636">img</span><span class="op" id="5447639">,</span>&nbsp;<span class="ident" id="5447641">err</span>&nbsp;<span class="op" id="5447645">=</span>&nbsp;<span class="ident" id="5447647">d</span><span class="op" id="5447648">.</span><span class="ident" id="5447649">readImagePass</span><span class="op" id="5447662">(</span><span class="ident" id="5447663">r</span><span class="op" id="5447664">,</span>&nbsp;<span class="num" id="5447666">0</span><span class="op" id="5447667">,</span>&nbsp;<span class="builtintype" id="5447669">false</span><span class="op" id="5447674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447677">}</span>&nbsp;<span class="keyword" id="5447679">else</span>&nbsp;<span class="keyword" id="5447684">if</span>&nbsp;<span class="ident" id="5447687">d</span><span class="op" id="5447688">.</span><span class="ident" id="5447689">interlace</span>&nbsp;<span class="op" id="5447699">==</span>&nbsp;<span class="ident" id="5447702">itAdam7</span>&nbsp;<span class="op" id="5447710">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447714">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447760">img</span><span class="op" id="5447763">,</span>&nbsp;<span class="ident" id="5447765">err</span>&nbsp;<span class="op" id="5447769">=</span>&nbsp;<span class="ident" id="5447771">d</span><span class="op" id="5447772">.</span><span class="ident" id="5447773">readImagePass</span><span class="op" id="5447786">(</span><span class="ident" id="5447787">nil</span><span class="op" id="5447790">,</span>&nbsp;<span class="num" id="5447792">0</span><span class="op" id="5447793">,</span>&nbsp;<span class="builtintype" id="5447795">true</span><span class="op" id="5447799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447803">for</span>&nbsp;<span class="ident" id="5447807">pass</span>&nbsp;<span class="op" id="5447812">:=</span>&nbsp;<span class="num" id="5447815">0</span><span class="op" id="5447816">;</span>&nbsp;<span class="ident" id="5447818">pass</span>&nbsp;<span class="op" id="5447823">&lt;</span>&nbsp;<span class="num" id="5447825">7</span><span class="op" id="5447826">;</span>&nbsp;<span class="ident" id="5447828">pass</span><span class="op" id="5447832">++</span>&nbsp;<span class="op" id="5447835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447840">imagePass</span><span class="op" id="5447849">,</span>&nbsp;<span class="ident" id="5447851">err</span>&nbsp;<span class="op" id="5447855">:=</span>&nbsp;<span class="ident" id="5447858">d</span><span class="op" id="5447859">.</span><span class="ident" id="5447860">readImagePass</span><span class="op" id="5447873">(</span><span class="ident" id="5447874">r</span><span class="op" id="5447875">,</span>&nbsp;<span class="ident" id="5447877">pass</span><span class="op" id="5447881">,</span>&nbsp;<span class="builtintype" id="5447883">false</span><span class="op" id="5447888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447893">if</span>&nbsp;<span class="ident" id="5447896">err</span>&nbsp;<span class="op" id="5447900">!=</span>&nbsp;<span class="ident" id="5447903">nil</span>&nbsp;<span class="op" id="5447907">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447913">return</span>&nbsp;<span class="ident" id="5447920">nil</span><span class="op" id="5447923">,</span>&nbsp;<span class="ident" id="5447925">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447937">d</span><span class="op" id="5447938">.</span><span class="ident" id="5447939">mergePassInto</span><span class="op" id="5447952">(</span><span class="ident" id="5447953">img</span><span class="op" id="5447956">,</span>&nbsp;<span class="ident" id="5447958">imagePass</span><span class="op" id="5447967">,</span>&nbsp;<span class="ident" id="5447969">pass</span><span class="op" id="5447973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447980">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447984">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448032">n</span>&nbsp;<span class="op" id="5448034">:=</span>&nbsp;<span class="num" id="5448037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448040">for</span>&nbsp;<span class="ident" id="5448044">i</span>&nbsp;<span class="op" id="5448046">:=</span>&nbsp;<span class="num" id="5448049">0</span><span class="op" id="5448050">;</span>&nbsp;<span class="ident" id="5448052">n</span>&nbsp;<span class="op" id="5448054">==</span>&nbsp;<span class="num" id="5448057">0</span>&nbsp;<span class="op" id="5448059">&amp;&amp;</span>&nbsp;<span class="ident" id="5448062">err</span>&nbsp;<span class="op" id="5448066">==</span>&nbsp;<span class="ident" id="5448069">nil</span><span class="op" id="5448072">;</span>&nbsp;<span class="ident" id="5448074">i</span><span class="op" id="5448075">++</span>&nbsp;<span class="op" id="5448078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448082">if</span>&nbsp;<span class="ident" id="5448085">i</span>&nbsp;<span class="op" id="5448087">==</span>&nbsp;<span class="num" id="5448090">100</span>&nbsp;<span class="op" id="5448094">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448099">return</span>&nbsp;<span class="ident" id="5448106">nil</span><span class="op" id="5448109">,</span>&nbsp;<span class="ident" id="5448111">io</span><span class="op" id="5448113">.</span><span class="ident" id="5448114">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448134">n</span><span class="op" id="5448135">,</span>&nbsp;<span class="ident" id="5448137">err</span>&nbsp;<span class="op" id="5448141">=</span>&nbsp;<span class="ident" id="5448143">r</span><span class="op" id="5448144">.</span><span class="ident" id="5448145">Read</span><span class="op" id="5448149">(</span><span class="ident" id="5448150">d</span><span class="op" id="5448151">.</span><span class="ident" id="5448152">tmp</span><span class="op" id="5448155">[</span><span class="op" id="5448156">:</span><span class="num" id="5448157">1</span><span class="op" id="5448158">]</span><span class="op" id="5448159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448165">if</span>&nbsp;<span class="ident" id="5448168">err</span>&nbsp;<span class="op" id="5448172">!=</span>&nbsp;<span class="ident" id="5448175">nil</span>&nbsp;<span class="op" id="5448179">&amp;&amp;</span>&nbsp;<span class="ident" id="5448182">err</span>&nbsp;<span class="op" id="5448186">!=</span>&nbsp;<span class="ident" id="5448189">io</span><span class="op" id="5448191">.</span><span class="ident" id="5448192">EOF</span>&nbsp;<span class="op" id="5448196">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448200">return</span>&nbsp;<span class="ident" id="5448207">nil</span><span class="op" id="5448210">,</span>&nbsp;<span class="ident" id="5448212">FormatError</span><span class="op" id="5448223">(</span><span class="ident" id="5448224">err</span><span class="op" id="5448227">.</span><span class="ident" id="5448228">Error</span><span class="op" id="5448233">(</span><span class="op" id="5448234">)</span><span class="op" id="5448235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448241">if</span>&nbsp;<span class="ident" id="5448244">n</span>&nbsp;<span class="op" id="5448246">!=</span>&nbsp;<span class="num" id="5448249">0</span>&nbsp;<span class="op" id="5448251">||</span>&nbsp;<span class="ident" id="5448254">d</span><span class="op" id="5448255">.</span><span class="ident" id="5448256">idatLength</span>&nbsp;<span class="op" id="5448267">!=</span>&nbsp;<span class="num" id="5448270">0</span>&nbsp;<span class="op" id="5448272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448276">return</span>&nbsp;<span class="ident" id="5448283">nil</span><span class="op" id="5448286">,</span>&nbsp;<span class="ident" id="5448288">FormatError</span><span class="op" id="5448299">(</span><span class="string" id="5448300">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5448321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448324">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448328">return</span>&nbsp;<span class="ident" id="5448335">img</span><span class="op" id="5448338">,</span>&nbsp;<span class="ident" id="5448340">nil</span><br>
<span class="lineno"></span><span class="op" id="5448344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5448347">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5448427">func</span>&nbsp;<span class="op" id="5448432">(</span><span class="ident" id="5448433">d</span>&nbsp;<span class="op" id="5448435">*</span><span class="ident" id="5448436">decoder</span><span class="op" id="5448443">)</span>&nbsp;<span class="ident" id="5448445">readImagePass</span><span class="op" id="5448458">(</span><span class="ident" id="5448459">r</span>&nbsp;<span class="ident" id="5448461">io</span><span class="op" id="5448463">.</span><span class="ident" id="5448464">Reader</span><span class="op" id="5448470">,</span>&nbsp;<span class="ident" id="5448472">pass</span>&nbsp;<span class="builtintype" id="5448477">int</span><span class="op" id="5448480">,</span>&nbsp;<span class="ident" id="5448482">allocateOnly</span>&nbsp;<span class="builtintype" id="5448495">bool</span><span class="op" id="5448499">)</span>&nbsp;<span class="op" id="5448501">(</span><span class="ident" id="5448502">image</span><span class="op" id="5448507">.</span><span class="ident" id="5448508">Image</span><span class="op" id="5448513">,</span>&nbsp;<span class="builtintype" id="5448515">error</span><span class="op" id="5448520">)</span>&nbsp;<span class="op" id="5448522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448525">var</span>&nbsp;<span class="ident" id="5448529">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5448542">int</span>&nbsp;<span class="op" id="5448546">=</span>&nbsp;<span class="num" id="5448548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448551">pixOffset</span>&nbsp;<span class="op" id="5448561">:=</span>&nbsp;<span class="num" id="5448564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448567">var</span>&nbsp;<span class="op" id="5448571">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448575">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448584">*</span><span class="ident" id="5448585">image</span><span class="op" id="5448590">.</span><span class="ident" id="5448591">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448598">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448607">*</span><span class="ident" id="5448608">image</span><span class="op" id="5448613">.</span><span class="ident" id="5448614">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448621">paletted</span>&nbsp;<span class="op" id="5448630">*</span><span class="ident" id="5448631">image</span><span class="op" id="5448636">.</span><span class="ident" id="5448637">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448648">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448657">*</span><span class="ident" id="5448658">image</span><span class="op" id="5448663">.</span><span class="ident" id="5448664">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448672">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5448681">*</span><span class="ident" id="5448682">image</span><span class="op" id="5448687">.</span><span class="ident" id="5448688">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448697">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5448706">*</span><span class="ident" id="5448707">image</span><span class="op" id="5448712">.</span><span class="ident" id="5448713">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448722">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5448731">*</span><span class="ident" id="5448732">image</span><span class="op" id="5448737">.</span><span class="ident" id="5448738">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448748">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448757">image</span><span class="op" id="5448762">.</span><span class="ident" id="5448763">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448773">width</span><span class="op" id="5448778">,</span>&nbsp;<span class="ident" id="5448780">height</span>&nbsp;<span class="op" id="5448787">:=</span>&nbsp;<span class="ident" id="5448790">d</span><span class="op" id="5448791">.</span><span class="ident" id="5448792">width</span><span class="op" id="5448797">,</span>&nbsp;<span class="ident" id="5448799">d</span><span class="op" id="5448800">.</span><span class="ident" id="5448801">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448809">if</span>&nbsp;<span class="ident" id="5448812">d</span><span class="op" id="5448813">.</span><span class="ident" id="5448814">interlace</span>&nbsp;<span class="op" id="5448824">==</span>&nbsp;<span class="ident" id="5448827">itAdam7</span>&nbsp;<span class="op" id="5448835">&amp;&amp;</span>&nbsp;<span class="op" id="5448838">!</span><span class="ident" id="5448839">allocateOnly</span>&nbsp;<span class="op" id="5448852">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448856">p</span>&nbsp;<span class="op" id="5448858">:=</span>&nbsp;<span class="ident" id="5448861">interlacing</span><span class="op" id="5448872">[</span><span class="ident" id="5448873">pass</span><span class="op" id="5448877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448881">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448959">width</span>&nbsp;<span class="op" id="5448965">=</span>&nbsp;<span class="op" id="5448967">(</span><span class="ident" id="5448968">width</span>&nbsp;<span class="op" id="5448974">-</span>&nbsp;<span class="ident" id="5448976">p</span><span class="op" id="5448977">.</span><span class="ident" id="5448978">xOffset</span>&nbsp;<span class="op" id="5448986">+</span>&nbsp;<span class="ident" id="5448988">p</span><span class="op" id="5448989">.</span><span class="ident" id="5448990">xFactor</span>&nbsp;<span class="op" id="5448998">-</span>&nbsp;<span class="num" id="5449000">1</span><span class="op" id="5449001">)</span>&nbsp;<span class="op" id="5449003">/</span>&nbsp;<span class="ident" id="5449005">p</span><span class="op" id="5449006">.</span><span class="ident" id="5449007">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449017">height</span>&nbsp;<span class="op" id="5449024">=</span>&nbsp;<span class="op" id="5449026">(</span><span class="ident" id="5449027">height</span>&nbsp;<span class="op" id="5449034">-</span>&nbsp;<span class="ident" id="5449036">p</span><span class="op" id="5449037">.</span><span class="ident" id="5449038">yOffset</span>&nbsp;<span class="op" id="5449046">+</span>&nbsp;<span class="ident" id="5449048">p</span><span class="op" id="5449049">.</span><span class="ident" id="5449050">yFactor</span>&nbsp;<span class="op" id="5449058">-</span>&nbsp;<span class="num" id="5449060">1</span><span class="op" id="5449061">)</span>&nbsp;<span class="op" id="5449063">/</span>&nbsp;<span class="ident" id="5449065">p</span><span class="op" id="5449066">.</span><span class="ident" id="5449067">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449076">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449079">switch</span>&nbsp;<span class="ident" id="5449086">d</span><span class="op" id="5449087">.</span><span class="ident" id="5449088">cb</span>&nbsp;<span class="op" id="5449091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449094">case</span>&nbsp;<span class="ident" id="5449099">cbG1</span><span class="op" id="5449103">,</span>&nbsp;<span class="ident" id="5449105">cbG2</span><span class="op" id="5449109">,</span>&nbsp;<span class="ident" id="5449111">cbG4</span><span class="op" id="5449115">,</span>&nbsp;<span class="ident" id="5449117">cbG8</span><span class="op" id="5449121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449125">bitsPerPixel</span>&nbsp;<span class="op" id="5449138">=</span>&nbsp;<span class="ident" id="5449140">d</span><span class="op" id="5449141">.</span><span class="ident" id="5449142">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449150">gray</span>&nbsp;<span class="op" id="5449155">=</span>&nbsp;<span class="ident" id="5449157">image</span><span class="op" id="5449162">.</span><span class="ident" id="5449163">NewGray</span><span class="op" id="5449170">(</span><span class="ident" id="5449171">image</span><span class="op" id="5449176">.</span><span class="ident" id="5449177">Rect</span><span class="op" id="5449181">(</span><span class="num" id="5449182">0</span><span class="op" id="5449183">,</span>&nbsp;<span class="num" id="5449185">0</span><span class="op" id="5449186">,</span>&nbsp;<span class="ident" id="5449188">width</span><span class="op" id="5449193">,</span>&nbsp;<span class="ident" id="5449195">height</span><span class="op" id="5449201">)</span><span class="op" id="5449202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449206">img</span>&nbsp;<span class="op" id="5449210">=</span>&nbsp;<span class="ident" id="5449212">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449218">case</span>&nbsp;<span class="ident" id="5449223">cbGA8</span><span class="op" id="5449228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449232">bitsPerPixel</span>&nbsp;<span class="op" id="5449245">=</span>&nbsp;<span class="num" id="5449247">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449252">nrgba</span>&nbsp;<span class="op" id="5449258">=</span>&nbsp;<span class="ident" id="5449260">image</span><span class="op" id="5449265">.</span><span class="ident" id="5449266">NewNRGBA</span><span class="op" id="5449274">(</span><span class="ident" id="5449275">image</span><span class="op" id="5449280">.</span><span class="ident" id="5449281">Rect</span><span class="op" id="5449285">(</span><span class="num" id="5449286">0</span><span class="op" id="5449287">,</span>&nbsp;<span class="num" id="5449289">0</span><span class="op" id="5449290">,</span>&nbsp;<span class="ident" id="5449292">width</span><span class="op" id="5449297">,</span>&nbsp;<span class="ident" id="5449299">height</span><span class="op" id="5449305">)</span><span class="op" id="5449306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449310">img</span>&nbsp;<span class="op" id="5449314">=</span>&nbsp;<span class="ident" id="5449316">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449323">case</span>&nbsp;<span class="ident" id="5449328">cbTC8</span><span class="op" id="5449333">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449337">bitsPerPixel</span>&nbsp;<span class="op" id="5449350">=</span>&nbsp;<span class="num" id="5449352">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449357">rgba</span>&nbsp;<span class="op" id="5449362">=</span>&nbsp;<span class="ident" id="5449364">image</span><span class="op" id="5449369">.</span><span class="ident" id="5449370">NewRGBA</span><span class="op" id="5449377">(</span><span class="ident" id="5449378">image</span><span class="op" id="5449383">.</span><span class="ident" id="5449384">Rect</span><span class="op" id="5449388">(</span><span class="num" id="5449389">0</span><span class="op" id="5449390">,</span>&nbsp;<span class="num" id="5449392">0</span><span class="op" id="5449393">,</span>&nbsp;<span class="ident" id="5449395">width</span><span class="op" id="5449400">,</span>&nbsp;<span class="ident" id="5449402">height</span><span class="op" id="5449408">)</span><span class="op" id="5449409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449413">img</span>&nbsp;<span class="op" id="5449417">=</span>&nbsp;<span class="ident" id="5449419">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449425">case</span>&nbsp;<span class="ident" id="5449430">cbP1</span><span class="op" id="5449434">,</span>&nbsp;<span class="ident" id="5449436">cbP2</span><span class="op" id="5449440">,</span>&nbsp;<span class="ident" id="5449442">cbP4</span><span class="op" id="5449446">,</span>&nbsp;<span class="ident" id="5449448">cbP8</span><span class="op" id="5449452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449456">bitsPerPixel</span>&nbsp;<span class="op" id="5449469">=</span>&nbsp;<span class="ident" id="5449471">d</span><span class="op" id="5449472">.</span><span class="ident" id="5449473">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449481">paletted</span>&nbsp;<span class="op" id="5449490">=</span>&nbsp;<span class="ident" id="5449492">image</span><span class="op" id="5449497">.</span><span class="ident" id="5449498">NewPaletted</span><span class="op" id="5449509">(</span><span class="ident" id="5449510">image</span><span class="op" id="5449515">.</span><span class="ident" id="5449516">Rect</span><span class="op" id="5449520">(</span><span class="num" id="5449521">0</span><span class="op" id="5449522">,</span>&nbsp;<span class="num" id="5449524">0</span><span class="op" id="5449525">,</span>&nbsp;<span class="ident" id="5449527">width</span><span class="op" id="5449532">,</span>&nbsp;<span class="ident" id="5449534">height</span><span class="op" id="5449540">)</span><span class="op" id="5449541">,</span>&nbsp;<span class="ident" id="5449543">d</span><span class="op" id="5449544">.</span><span class="ident" id="5449545">palette</span><span class="op" id="5449552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449556">img</span>&nbsp;<span class="op" id="5449560">=</span>&nbsp;<span class="ident" id="5449562">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449572">case</span>&nbsp;<span class="ident" id="5449577">cbTCA8</span><span class="op" id="5449583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449587">bitsPerPixel</span>&nbsp;<span class="op" id="5449600">=</span>&nbsp;<span class="num" id="5449602">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449607">nrgba</span>&nbsp;<span class="op" id="5449613">=</span>&nbsp;<span class="ident" id="5449615">image</span><span class="op" id="5449620">.</span><span class="ident" id="5449621">NewNRGBA</span><span class="op" id="5449629">(</span><span class="ident" id="5449630">image</span><span class="op" id="5449635">.</span><span class="ident" id="5449636">Rect</span><span class="op" id="5449640">(</span><span class="num" id="5449641">0</span><span class="op" id="5449642">,</span>&nbsp;<span class="num" id="5449644">0</span><span class="op" id="5449645">,</span>&nbsp;<span class="ident" id="5449647">width</span><span class="op" id="5449652">,</span>&nbsp;<span class="ident" id="5449654">height</span><span class="op" id="5449660">)</span><span class="op" id="5449661">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449665">img</span>&nbsp;<span class="op" id="5449669">=</span>&nbsp;<span class="ident" id="5449671">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449678">case</span>&nbsp;<span class="ident" id="5449683">cbG16</span><span class="op" id="5449688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449692">bitsPerPixel</span>&nbsp;<span class="op" id="5449705">=</span>&nbsp;<span class="num" id="5449707">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449712">gray16</span>&nbsp;<span class="op" id="5449719">=</span>&nbsp;<span class="ident" id="5449721">image</span><span class="op" id="5449726">.</span><span class="ident" id="5449727">NewGray16</span><span class="op" id="5449736">(</span><span class="ident" id="5449737">image</span><span class="op" id="5449742">.</span><span class="ident" id="5449743">Rect</span><span class="op" id="5449747">(</span><span class="num" id="5449748">0</span><span class="op" id="5449749">,</span>&nbsp;<span class="num" id="5449751">0</span><span class="op" id="5449752">,</span>&nbsp;<span class="ident" id="5449754">width</span><span class="op" id="5449759">,</span>&nbsp;<span class="ident" id="5449761">height</span><span class="op" id="5449767">)</span><span class="op" id="5449768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449772">img</span>&nbsp;<span class="op" id="5449776">=</span>&nbsp;<span class="ident" id="5449778">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449786">case</span>&nbsp;<span class="ident" id="5449791">cbGA16</span><span class="op" id="5449797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449801">bitsPerPixel</span>&nbsp;<span class="op" id="5449814">=</span>&nbsp;<span class="num" id="5449816">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449821">nrgba64</span>&nbsp;<span class="op" id="5449829">=</span>&nbsp;<span class="ident" id="5449831">image</span><span class="op" id="5449836">.</span><span class="ident" id="5449837">NewNRGBA64</span><span class="op" id="5449847">(</span><span class="ident" id="5449848">image</span><span class="op" id="5449853">.</span><span class="ident" id="5449854">Rect</span><span class="op" id="5449858">(</span><span class="num" id="5449859">0</span><span class="op" id="5449860">,</span>&nbsp;<span class="num" id="5449862">0</span><span class="op" id="5449863">,</span>&nbsp;<span class="ident" id="5449865">width</span><span class="op" id="5449870">,</span>&nbsp;<span class="ident" id="5449872">height</span><span class="op" id="5449878">)</span><span class="op" id="5449879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449883">img</span>&nbsp;<span class="op" id="5449887">=</span>&nbsp;<span class="ident" id="5449889">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449898">case</span>&nbsp;<span class="ident" id="5449903">cbTC16</span><span class="op" id="5449909">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449913">bitsPerPixel</span>&nbsp;<span class="op" id="5449926">=</span>&nbsp;<span class="num" id="5449928">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449933">rgba64</span>&nbsp;<span class="op" id="5449940">=</span>&nbsp;<span class="ident" id="5449942">image</span><span class="op" id="5449947">.</span><span class="ident" id="5449948">NewRGBA64</span><span class="op" id="5449957">(</span><span class="ident" id="5449958">image</span><span class="op" id="5449963">.</span><span class="ident" id="5449964">Rect</span><span class="op" id="5449968">(</span><span class="num" id="5449969">0</span><span class="op" id="5449970">,</span>&nbsp;<span class="num" id="5449972">0</span><span class="op" id="5449973">,</span>&nbsp;<span class="ident" id="5449975">width</span><span class="op" id="5449980">,</span>&nbsp;<span class="ident" id="5449982">height</span><span class="op" id="5449988">)</span><span class="op" id="5449989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449993">img</span>&nbsp;<span class="op" id="5449997">=</span>&nbsp;<span class="ident" id="5449999">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450007">case</span>&nbsp;<span class="ident" id="5450012">cbTCA16</span><span class="op" id="5450019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450023">bitsPerPixel</span>&nbsp;<span class="op" id="5450036">=</span>&nbsp;<span class="num" id="5450038">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450043">nrgba64</span>&nbsp;<span class="op" id="5450051">=</span>&nbsp;<span class="ident" id="5450053">image</span><span class="op" id="5450058">.</span><span class="ident" id="5450059">NewNRGBA64</span><span class="op" id="5450069">(</span><span class="ident" id="5450070">image</span><span class="op" id="5450075">.</span><span class="ident" id="5450076">Rect</span><span class="op" id="5450080">(</span><span class="num" id="5450081">0</span><span class="op" id="5450082">,</span>&nbsp;<span class="num" id="5450084">0</span><span class="op" id="5450085">,</span>&nbsp;<span class="ident" id="5450087">width</span><span class="op" id="5450092">,</span>&nbsp;<span class="ident" id="5450094">height</span><span class="op" id="5450100">)</span><span class="op" id="5450101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450105">img</span>&nbsp;<span class="op" id="5450109">=</span>&nbsp;<span class="ident" id="5450111">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450123">if</span>&nbsp;<span class="ident" id="5450126">allocateOnly</span>&nbsp;<span class="op" id="5450139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450143">return</span>&nbsp;<span class="ident" id="5450150">img</span><span class="op" id="5450153">,</span>&nbsp;<span class="ident" id="5450155">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450163">bytesPerPixel</span>&nbsp;<span class="op" id="5450177">:=</span>&nbsp;<span class="op" id="5450180">(</span><span class="ident" id="5450181">bitsPerPixel</span>&nbsp;<span class="op" id="5450194">+</span>&nbsp;<span class="num" id="5450196">7</span><span class="op" id="5450197">)</span>&nbsp;<span class="op" id="5450199">/</span>&nbsp;<span class="num" id="5450201">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450205">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450267">rowSize</span>&nbsp;<span class="op" id="5450275">:=</span>&nbsp;<span class="num" id="5450278">1</span>&nbsp;<span class="op" id="5450280">+</span>&nbsp;<span class="op" id="5450282">(</span><span class="ident" id="5450283">bitsPerPixel</span><span class="op" id="5450295">*</span><span class="ident" id="5450296">width</span><span class="op" id="5450301">+</span><span class="num" id="5450302">7</span><span class="op" id="5450303">)</span><span class="op" id="5450304">/</span><span class="num" id="5450305">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450308">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450370">cr</span>&nbsp;<span class="op" id="5450373">:=</span>&nbsp;<span class="builtinfunc" id="5450376">make</span><span class="op" id="5450380">(</span><span class="op" id="5450381">[</span><span class="op" id="5450382">]</span><span class="builtintype" id="5450383">uint8</span><span class="op" id="5450388">,</span>&nbsp;<span class="ident" id="5450390">rowSize</span><span class="op" id="5450397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450400">pr</span>&nbsp;<span class="op" id="5450403">:=</span>&nbsp;<span class="builtinfunc" id="5450406">make</span><span class="op" id="5450410">(</span><span class="op" id="5450411">[</span><span class="op" id="5450412">]</span><span class="builtintype" id="5450413">uint8</span><span class="op" id="5450418">,</span>&nbsp;<span class="ident" id="5450420">rowSize</span><span class="op" id="5450427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450431">for</span>&nbsp;<span class="ident" id="5450435">y</span>&nbsp;<span class="op" id="5450437">:=</span>&nbsp;<span class="num" id="5450440">0</span><span class="op" id="5450441">;</span>&nbsp;<span class="ident" id="5450443">y</span>&nbsp;<span class="op" id="5450445">&lt;</span>&nbsp;<span class="ident" id="5450447">height</span><span class="op" id="5450453">;</span>&nbsp;<span class="ident" id="5450455">y</span><span class="op" id="5450456">++</span>&nbsp;<span class="op" id="5450459">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450463">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450497">_</span><span class="op" id="5450498">,</span>&nbsp;<span class="ident" id="5450500">err</span>&nbsp;<span class="op" id="5450504">:=</span>&nbsp;<span class="ident" id="5450507">io</span><span class="op" id="5450509">.</span><span class="ident" id="5450510">ReadFull</span><span class="op" id="5450518">(</span><span class="ident" id="5450519">r</span><span class="op" id="5450520">,</span>&nbsp;<span class="ident" id="5450522">cr</span><span class="op" id="5450524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450528">if</span>&nbsp;<span class="ident" id="5450531">err</span>&nbsp;<span class="op" id="5450535">!=</span>&nbsp;<span class="ident" id="5450538">nil</span>&nbsp;<span class="op" id="5450542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450547">return</span>&nbsp;<span class="ident" id="5450554">nil</span><span class="op" id="5450557">,</span>&nbsp;<span class="ident" id="5450559">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450565">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450570">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450593">cdat</span>&nbsp;<span class="op" id="5450598">:=</span>&nbsp;<span class="ident" id="5450601">cr</span><span class="op" id="5450603">[</span><span class="num" id="5450604">1</span><span class="op" id="5450605">:</span><span class="op" id="5450606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450610">pdat</span>&nbsp;<span class="op" id="5450615">:=</span>&nbsp;<span class="ident" id="5450618">pr</span><span class="op" id="5450620">[</span><span class="num" id="5450621">1</span><span class="op" id="5450622">:</span><span class="op" id="5450623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450627">switch</span>&nbsp;<span class="ident" id="5450634">cr</span><span class="op" id="5450636">[</span><span class="num" id="5450637">0</span><span class="op" id="5450638">]</span>&nbsp;<span class="op" id="5450640">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450644">case</span>&nbsp;<span class="ident" id="5450649">ftNone</span><span class="op" id="5450655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450660">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450672">case</span>&nbsp;<span class="ident" id="5450677">ftSub</span><span class="op" id="5450682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450687">for</span>&nbsp;<span class="ident" id="5450691">i</span>&nbsp;<span class="op" id="5450693">:=</span>&nbsp;<span class="ident" id="5450696">bytesPerPixel</span><span class="op" id="5450709">;</span>&nbsp;<span class="ident" id="5450711">i</span>&nbsp;<span class="op" id="5450713">&lt;</span>&nbsp;<span class="builtinfunc" id="5450715">len</span><span class="op" id="5450718">(</span><span class="ident" id="5450719">cdat</span><span class="op" id="5450723">)</span><span class="op" id="5450724">;</span>&nbsp;<span class="ident" id="5450726">i</span><span class="op" id="5450727">++</span>&nbsp;<span class="op" id="5450730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450736">cdat</span><span class="op" id="5450740">[</span><span class="ident" id="5450741">i</span><span class="op" id="5450742">]</span>&nbsp;<span class="op" id="5450744">+=</span>&nbsp;<span class="ident" id="5450747">cdat</span><span class="op" id="5450751">[</span><span class="ident" id="5450752">i</span><span class="op" id="5450753">-</span><span class="ident" id="5450754">bytesPerPixel</span><span class="op" id="5450767">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450776">case</span>&nbsp;<span class="ident" id="5450781">ftUp</span><span class="op" id="5450785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450790">for</span>&nbsp;<span class="ident" id="5450794">i</span><span class="op" id="5450795">,</span>&nbsp;<span class="ident" id="5450797">p</span>&nbsp;<span class="op" id="5450799">:=</span>&nbsp;<span class="keyword" id="5450802">range</span>&nbsp;<span class="ident" id="5450808">pdat</span>&nbsp;<span class="op" id="5450813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450819">cdat</span><span class="op" id="5450823">[</span><span class="ident" id="5450824">i</span><span class="op" id="5450825">]</span>&nbsp;<span class="op" id="5450827">+=</span>&nbsp;<span class="ident" id="5450830">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450835">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450839">case</span>&nbsp;<span class="ident" id="5450844">ftAverage</span><span class="op" id="5450853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450858">for</span>&nbsp;<span class="ident" id="5450862">i</span>&nbsp;<span class="op" id="5450864">:=</span>&nbsp;<span class="num" id="5450867">0</span><span class="op" id="5450868">;</span>&nbsp;<span class="ident" id="5450870">i</span>&nbsp;<span class="op" id="5450872">&lt;</span>&nbsp;<span class="ident" id="5450874">bytesPerPixel</span><span class="op" id="5450887">;</span>&nbsp;<span class="ident" id="5450889">i</span><span class="op" id="5450890">++</span>&nbsp;<span class="op" id="5450893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450899">cdat</span><span class="op" id="5450903">[</span><span class="ident" id="5450904">i</span><span class="op" id="5450905">]</span>&nbsp;<span class="op" id="5450907">+=</span>&nbsp;<span class="ident" id="5450910">pdat</span><span class="op" id="5450914">[</span><span class="ident" id="5450915">i</span><span class="op" id="5450916">]</span>&nbsp;<span class="op" id="5450918">/</span>&nbsp;<span class="num" id="5450920">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450930">for</span>&nbsp;<span class="ident" id="5450934">i</span>&nbsp;<span class="op" id="5450936">:=</span>&nbsp;<span class="ident" id="5450939">bytesPerPixel</span><span class="op" id="5450952">;</span>&nbsp;<span class="ident" id="5450954">i</span>&nbsp;<span class="op" id="5450956">&lt;</span>&nbsp;<span class="builtinfunc" id="5450958">len</span><span class="op" id="5450961">(</span><span class="ident" id="5450962">cdat</span><span class="op" id="5450966">)</span><span class="op" id="5450967">;</span>&nbsp;<span class="ident" id="5450969">i</span><span class="op" id="5450970">++</span>&nbsp;<span class="op" id="5450973">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450979">cdat</span><span class="op" id="5450983">[</span><span class="ident" id="5450984">i</span><span class="op" id="5450985">]</span>&nbsp;<span class="op" id="5450987">+=</span>&nbsp;<span class="builtintype" id="5450990">uint8</span><span class="op" id="5450995">(</span><span class="op" id="5450996">(</span><span class="builtintype" id="5450997">int</span><span class="op" id="5451000">(</span><span class="ident" id="5451001">cdat</span><span class="op" id="5451005">[</span><span class="ident" id="5451006">i</span><span class="op" id="5451007">-</span><span class="ident" id="5451008">bytesPerPixel</span><span class="op" id="5451021">]</span><span class="op" id="5451022">)</span>&nbsp;<span class="op" id="5451024">+</span>&nbsp;<span class="builtintype" id="5451026">int</span><span class="op" id="5451029">(</span><span class="ident" id="5451030">pdat</span><span class="op" id="5451034">[</span><span class="ident" id="5451035">i</span><span class="op" id="5451036">]</span><span class="op" id="5451037">)</span><span class="op" id="5451038">)</span>&nbsp;<span class="op" id="5451040">/</span>&nbsp;<span class="num" id="5451042">2</span><span class="op" id="5451043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451052">case</span>&nbsp;<span class="ident" id="5451057">ftPaeth</span><span class="op" id="5451064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451069">filterPaeth</span><span class="op" id="5451080">(</span><span class="ident" id="5451081">cdat</span><span class="op" id="5451085">,</span>&nbsp;<span class="ident" id="5451087">pdat</span><span class="op" id="5451091">,</span>&nbsp;<span class="ident" id="5451093">bytesPerPixel</span><span class="op" id="5451106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451110">default</span><span class="op" id="5451117">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451122">return</span>&nbsp;<span class="ident" id="5451129">nil</span><span class="op" id="5451132">,</span>&nbsp;<span class="ident" id="5451134">FormatError</span><span class="op" id="5451145">(</span><span class="string" id="5451146">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5451163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451172">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451207">switch</span>&nbsp;<span class="ident" id="5451214">d</span><span class="op" id="5451215">.</span><span class="ident" id="5451216">cb</span>&nbsp;<span class="op" id="5451219">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451223">case</span>&nbsp;<span class="ident" id="5451228">cbG1</span><span class="op" id="5451232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451237">for</span>&nbsp;<span class="ident" id="5451241">x</span>&nbsp;<span class="op" id="5451243">:=</span>&nbsp;<span class="num" id="5451246">0</span><span class="op" id="5451247">;</span>&nbsp;<span class="ident" id="5451249">x</span>&nbsp;<span class="op" id="5451251">&lt;</span>&nbsp;<span class="ident" id="5451253">width</span><span class="op" id="5451258">;</span>&nbsp;<span class="ident" id="5451260">x</span>&nbsp;<span class="op" id="5451262">+=</span>&nbsp;<span class="num" id="5451265">8</span>&nbsp;<span class="op" id="5451267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451273">b</span>&nbsp;<span class="op" id="5451275">:=</span>&nbsp;<span class="ident" id="5451278">cdat</span><span class="op" id="5451282">[</span><span class="ident" id="5451283">x</span><span class="op" id="5451284">/</span><span class="num" id="5451285">8</span><span class="op" id="5451286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451292">for</span>&nbsp;<span class="ident" id="5451296">x2</span>&nbsp;<span class="op" id="5451299">:=</span>&nbsp;<span class="num" id="5451302">0</span><span class="op" id="5451303">;</span>&nbsp;<span class="ident" id="5451305">x2</span>&nbsp;<span class="op" id="5451308">&lt;</span>&nbsp;<span class="num" id="5451310">8</span>&nbsp;<span class="op" id="5451312">&amp;&amp;</span>&nbsp;<span class="ident" id="5451315">x</span><span class="op" id="5451316">+</span><span class="ident" id="5451317">x2</span>&nbsp;<span class="op" id="5451320">&lt;</span>&nbsp;<span class="ident" id="5451322">width</span><span class="op" id="5451327">;</span>&nbsp;<span class="ident" id="5451329">x2</span><span class="op" id="5451331">++</span>&nbsp;<span class="op" id="5451334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451341">gray</span><span class="op" id="5451345">.</span><span class="ident" id="5451346">SetGray</span><span class="op" id="5451353">(</span><span class="ident" id="5451354">x</span><span class="op" id="5451355">+</span><span class="ident" id="5451356">x2</span><span class="op" id="5451358">,</span>&nbsp;<span class="ident" id="5451360">y</span><span class="op" id="5451361">,</span>&nbsp;<span class="ident" id="5451363">color</span><span class="op" id="5451368">.</span><span class="ident" id="5451369">Gray</span><span class="op" id="5451373">{</span><span class="op" id="5451374">(</span><span class="ident" id="5451375">b</span>&nbsp;<span class="op" id="5451377">&gt;&gt;</span>&nbsp;<span class="num" id="5451380">7</span><span class="op" id="5451381">)</span>&nbsp;<span class="op" id="5451383">*</span>&nbsp;<span class="num" id="5451385">0xff</span><span class="op" id="5451389">}</span><span class="op" id="5451390">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451397">b</span>&nbsp;<span class="op" id="5451399">&lt;&lt;=</span>&nbsp;<span class="num" id="5451403">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451418">case</span>&nbsp;<span class="ident" id="5451423">cbG2</span><span class="op" id="5451427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451432">for</span>&nbsp;<span class="ident" id="5451436">x</span>&nbsp;<span class="op" id="5451438">:=</span>&nbsp;<span class="num" id="5451441">0</span><span class="op" id="5451442">;</span>&nbsp;<span class="ident" id="5451444">x</span>&nbsp;<span class="op" id="5451446">&lt;</span>&nbsp;<span class="ident" id="5451448">width</span><span class="op" id="5451453">;</span>&nbsp;<span class="ident" id="5451455">x</span>&nbsp;<span class="op" id="5451457">+=</span>&nbsp;<span class="num" id="5451460">4</span>&nbsp;<span class="op" id="5451462">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451468">b</span>&nbsp;<span class="op" id="5451470">:=</span>&nbsp;<span class="ident" id="5451473">cdat</span><span class="op" id="5451477">[</span><span class="ident" id="5451478">x</span><span class="op" id="5451479">/</span><span class="num" id="5451480">4</span><span class="op" id="5451481">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451487">for</span>&nbsp;<span class="ident" id="5451491">x2</span>&nbsp;<span class="op" id="5451494">:=</span>&nbsp;<span class="num" id="5451497">0</span><span class="op" id="5451498">;</span>&nbsp;<span class="ident" id="5451500">x2</span>&nbsp;<span class="op" id="5451503">&lt;</span>&nbsp;<span class="num" id="5451505">4</span>&nbsp;<span class="op" id="5451507">&amp;&amp;</span>&nbsp;<span class="ident" id="5451510">x</span><span class="op" id="5451511">+</span><span class="ident" id="5451512">x2</span>&nbsp;<span class="op" id="5451515">&lt;</span>&nbsp;<span class="ident" id="5451517">width</span><span class="op" id="5451522">;</span>&nbsp;<span class="ident" id="5451524">x2</span><span class="op" id="5451526">++</span>&nbsp;<span class="op" id="5451529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451536">gray</span><span class="op" id="5451540">.</span><span class="ident" id="5451541">SetGray</span><span class="op" id="5451548">(</span><span class="ident" id="5451549">x</span><span class="op" id="5451550">+</span><span class="ident" id="5451551">x2</span><span class="op" id="5451553">,</span>&nbsp;<span class="ident" id="5451555">y</span><span class="op" id="5451556">,</span>&nbsp;<span class="ident" id="5451558">color</span><span class="op" id="5451563">.</span><span class="ident" id="5451564">Gray</span><span class="op" id="5451568">{</span><span class="op" id="5451569">(</span><span class="ident" id="5451570">b</span>&nbsp;<span class="op" id="5451572">&gt;&gt;</span>&nbsp;<span class="num" id="5451575">6</span><span class="op" id="5451576">)</span>&nbsp;<span class="op" id="5451578">*</span>&nbsp;<span class="num" id="5451580">0x55</span><span class="op" id="5451584">}</span><span class="op" id="5451585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451592">b</span>&nbsp;<span class="op" id="5451594">&lt;&lt;=</span>&nbsp;<span class="num" id="5451598">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451604">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451613">case</span>&nbsp;<span class="ident" id="5451618">cbG4</span><span class="op" id="5451622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451627">for</span>&nbsp;<span class="ident" id="5451631">x</span>&nbsp;<span class="op" id="5451633">:=</span>&nbsp;<span class="num" id="5451636">0</span><span class="op" id="5451637">;</span>&nbsp;<span class="ident" id="5451639">x</span>&nbsp;<span class="op" id="5451641">&lt;</span>&nbsp;<span class="ident" id="5451643">width</span><span class="op" id="5451648">;</span>&nbsp;<span class="ident" id="5451650">x</span>&nbsp;<span class="op" id="5451652">+=</span>&nbsp;<span class="num" id="5451655">2</span>&nbsp;<span class="op" id="5451657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451663">b</span>&nbsp;<span class="op" id="5451665">:=</span>&nbsp;<span class="ident" id="5451668">cdat</span><span class="op" id="5451672">[</span><span class="ident" id="5451673">x</span><span class="op" id="5451674">/</span><span class="num" id="5451675">2</span><span class="op" id="5451676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451682">for</span>&nbsp;<span class="ident" id="5451686">x2</span>&nbsp;<span class="op" id="5451689">:=</span>&nbsp;<span class="num" id="5451692">0</span><span class="op" id="5451693">;</span>&nbsp;<span class="ident" id="5451695">x2</span>&nbsp;<span class="op" id="5451698">&lt;</span>&nbsp;<span class="num" id="5451700">2</span>&nbsp;<span class="op" id="5451702">&amp;&amp;</span>&nbsp;<span class="ident" id="5451705">x</span><span class="op" id="5451706">+</span><span class="ident" id="5451707">x2</span>&nbsp;<span class="op" id="5451710">&lt;</span>&nbsp;<span class="ident" id="5451712">width</span><span class="op" id="5451717">;</span>&nbsp;<span class="ident" id="5451719">x2</span><span class="op" id="5451721">++</span>&nbsp;<span class="op" id="5451724">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451731">gray</span><span class="op" id="5451735">.</span><span class="ident" id="5451736">SetGray</span><span class="op" id="5451743">(</span><span class="ident" id="5451744">x</span><span class="op" id="5451745">+</span><span class="ident" id="5451746">x2</span><span class="op" id="5451748">,</span>&nbsp;<span class="ident" id="5451750">y</span><span class="op" id="5451751">,</span>&nbsp;<span class="ident" id="5451753">color</span><span class="op" id="5451758">.</span><span class="ident" id="5451759">Gray</span><span class="op" id="5451763">{</span><span class="op" id="5451764">(</span><span class="ident" id="5451765">b</span>&nbsp;<span class="op" id="5451767">&gt;&gt;</span>&nbsp;<span class="num" id="5451770">4</span><span class="op" id="5451771">)</span>&nbsp;<span class="op" id="5451773">*</span>&nbsp;<span class="num" id="5451775">0x11</span><span class="op" id="5451779">}</span><span class="op" id="5451780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451787">b</span>&nbsp;<span class="op" id="5451789">&lt;&lt;=</span>&nbsp;<span class="num" id="5451793">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451808">case</span>&nbsp;<span class="ident" id="5451813">cbG8</span><span class="op" id="5451817">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5451822">copy</span><span class="op" id="5451826">(</span><span class="ident" id="5451827">gray</span><span class="op" id="5451831">.</span><span class="ident" id="5451832">Pix</span><span class="op" id="5451835">[</span><span class="ident" id="5451836">pixOffset</span><span class="op" id="5451845">:</span><span class="op" id="5451846">]</span><span class="op" id="5451847">,</span>&nbsp;<span class="ident" id="5451849">cdat</span><span class="op" id="5451853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451858">pixOffset</span>&nbsp;<span class="op" id="5451868">+=</span>&nbsp;<span class="ident" id="5451871">gray</span><span class="op" id="5451875">.</span><span class="ident" id="5451876">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451885">case</span>&nbsp;<span class="ident" id="5451890">cbGA8</span><span class="op" id="5451895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451900">for</span>&nbsp;<span class="ident" id="5451904">x</span>&nbsp;<span class="op" id="5451906">:=</span>&nbsp;<span class="num" id="5451909">0</span><span class="op" id="5451910">;</span>&nbsp;<span class="ident" id="5451912">x</span>&nbsp;<span class="op" id="5451914">&lt;</span>&nbsp;<span class="ident" id="5451916">width</span><span class="op" id="5451921">;</span>&nbsp;<span class="ident" id="5451923">x</span><span class="op" id="5451924">++</span>&nbsp;<span class="op" id="5451927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451933">ycol</span>&nbsp;<span class="op" id="5451938">:=</span>&nbsp;<span class="ident" id="5451941">cdat</span><span class="op" id="5451945">[</span><span class="num" id="5451946">2</span><span class="op" id="5451947">*</span><span class="ident" id="5451948">x</span><span class="op" id="5451949">+</span><span class="num" id="5451950">0</span><span class="op" id="5451951">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451957">nrgba</span><span class="op" id="5451962">.</span><span class="ident" id="5451963">SetNRGBA</span><span class="op" id="5451971">(</span><span class="ident" id="5451972">x</span><span class="op" id="5451973">,</span>&nbsp;<span class="ident" id="5451975">y</span><span class="op" id="5451976">,</span>&nbsp;<span class="ident" id="5451978">color</span><span class="op" id="5451983">.</span><span class="ident" id="5451984">NRGBA</span><span class="op" id="5451989">{</span><span class="ident" id="5451990">ycol</span><span class="op" id="5451994">,</span>&nbsp;<span class="ident" id="5451996">ycol</span><span class="op" id="5452000">,</span>&nbsp;<span class="ident" id="5452002">ycol</span><span class="op" id="5452006">,</span>&nbsp;<span class="ident" id="5452008">cdat</span><span class="op" id="5452012">[</span><span class="num" id="5452013">2</span><span class="op" id="5452014">*</span><span class="ident" id="5452015">x</span><span class="op" id="5452016">+</span><span class="num" id="5452017">1</span><span class="op" id="5452018">]</span><span class="op" id="5452019">}</span><span class="op" id="5452020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452029">case</span>&nbsp;<span class="ident" id="5452034">cbTC8</span><span class="op" id="5452039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452044">pix</span><span class="op" id="5452047">,</span>&nbsp;<span class="ident" id="5452049">i</span><span class="op" id="5452050">,</span>&nbsp;<span class="ident" id="5452052">j</span>&nbsp;<span class="op" id="5452054">:=</span>&nbsp;<span class="ident" id="5452057">rgba</span><span class="op" id="5452061">.</span><span class="ident" id="5452062">Pix</span><span class="op" id="5452065">,</span>&nbsp;<span class="ident" id="5452067">pixOffset</span><span class="op" id="5452076">,</span>&nbsp;<span class="num" id="5452078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452083">for</span>&nbsp;<span class="ident" id="5452087">x</span>&nbsp;<span class="op" id="5452089">:=</span>&nbsp;<span class="num" id="5452092">0</span><span class="op" id="5452093">;</span>&nbsp;<span class="ident" id="5452095">x</span>&nbsp;<span class="op" id="5452097">&lt;</span>&nbsp;<span class="ident" id="5452099">width</span><span class="op" id="5452104">;</span>&nbsp;<span class="ident" id="5452106">x</span><span class="op" id="5452107">++</span>&nbsp;<span class="op" id="5452110">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452116">pix</span><span class="op" id="5452119">[</span><span class="ident" id="5452120">i</span><span class="op" id="5452121">+</span><span class="num" id="5452122">0</span><span class="op" id="5452123">]</span>&nbsp;<span class="op" id="5452125">=</span>&nbsp;<span class="ident" id="5452127">cdat</span><span class="op" id="5452131">[</span><span class="ident" id="5452132">j</span><span class="op" id="5452133">+</span><span class="num" id="5452134">0</span><span class="op" id="5452135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452141">pix</span><span class="op" id="5452144">[</span><span class="ident" id="5452145">i</span><span class="op" id="5452146">+</span><span class="num" id="5452147">1</span><span class="op" id="5452148">]</span>&nbsp;<span class="op" id="5452150">=</span>&nbsp;<span class="ident" id="5452152">cdat</span><span class="op" id="5452156">[</span><span class="ident" id="5452157">j</span><span class="op" id="5452158">+</span><span class="num" id="5452159">1</span><span class="op" id="5452160">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452166">pix</span><span class="op" id="5452169">[</span><span class="ident" id="5452170">i</span><span class="op" id="5452171">+</span><span class="num" id="5452172">2</span><span class="op" id="5452173">]</span>&nbsp;<span class="op" id="5452175">=</span>&nbsp;<span class="ident" id="5452177">cdat</span><span class="op" id="5452181">[</span><span class="ident" id="5452182">j</span><span class="op" id="5452183">+</span><span class="num" id="5452184">2</span><span class="op" id="5452185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452191">pix</span><span class="op" id="5452194">[</span><span class="ident" id="5452195">i</span><span class="op" id="5452196">+</span><span class="num" id="5452197">3</span><span class="op" id="5452198">]</span>&nbsp;<span class="op" id="5452200">=</span>&nbsp;<span class="num" id="5452202">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452211">i</span>&nbsp;<span class="op" id="5452213">+=</span>&nbsp;<span class="num" id="5452216">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452222">j</span>&nbsp;<span class="op" id="5452224">+=</span>&nbsp;<span class="num" id="5452227">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452237">pixOffset</span>&nbsp;<span class="op" id="5452247">+=</span>&nbsp;<span class="ident" id="5452250">rgba</span><span class="op" id="5452254">.</span><span class="ident" id="5452255">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452264">case</span>&nbsp;<span class="ident" id="5452269">cbP1</span><span class="op" id="5452273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452278">for</span>&nbsp;<span class="ident" id="5452282">x</span>&nbsp;<span class="op" id="5452284">:=</span>&nbsp;<span class="num" id="5452287">0</span><span class="op" id="5452288">;</span>&nbsp;<span class="ident" id="5452290">x</span>&nbsp;<span class="op" id="5452292">&lt;</span>&nbsp;<span class="ident" id="5452294">width</span><span class="op" id="5452299">;</span>&nbsp;<span class="ident" id="5452301">x</span>&nbsp;<span class="op" id="5452303">+=</span>&nbsp;<span class="num" id="5452306">8</span>&nbsp;<span class="op" id="5452308">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452314">b</span>&nbsp;<span class="op" id="5452316">:=</span>&nbsp;<span class="ident" id="5452319">cdat</span><span class="op" id="5452323">[</span><span class="ident" id="5452324">x</span><span class="op" id="5452325">/</span><span class="num" id="5452326">8</span><span class="op" id="5452327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452333">for</span>&nbsp;<span class="ident" id="5452337">x2</span>&nbsp;<span class="op" id="5452340">:=</span>&nbsp;<span class="num" id="5452343">0</span><span class="op" id="5452344">;</span>&nbsp;<span class="ident" id="5452346">x2</span>&nbsp;<span class="op" id="5452349">&lt;</span>&nbsp;<span class="num" id="5452351">8</span>&nbsp;<span class="op" id="5452353">&amp;&amp;</span>&nbsp;<span class="ident" id="5452356">x</span><span class="op" id="5452357">+</span><span class="ident" id="5452358">x2</span>&nbsp;<span class="op" id="5452361">&lt;</span>&nbsp;<span class="ident" id="5452363">width</span><span class="op" id="5452368">;</span>&nbsp;<span class="ident" id="5452370">x2</span><span class="op" id="5452372">++</span>&nbsp;<span class="op" id="5452375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452382">idx</span>&nbsp;<span class="op" id="5452386">:=</span>&nbsp;<span class="ident" id="5452389">b</span>&nbsp;<span class="op" id="5452391">&gt;&gt;</span>&nbsp;<span class="num" id="5452394">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452401">if</span>&nbsp;<span class="builtinfunc" id="5452404">len</span><span class="op" id="5452407">(</span><span class="ident" id="5452408">paletted</span><span class="op" id="5452416">.</span><span class="ident" id="5452417">Palette</span><span class="op" id="5452424">)</span>&nbsp;<span class="op" id="5452426">&lt;=</span>&nbsp;<span class="builtintype" id="5452429">int</span><span class="op" id="5452432">(</span><span class="ident" id="5452433">idx</span><span class="op" id="5452436">)</span>&nbsp;<span class="op" id="5452438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452446">paletted</span><span class="op" id="5452454">.</span><span class="ident" id="5452455">Palette</span>&nbsp;<span class="op" id="5452463">=</span>&nbsp;<span class="ident" id="5452465">paletted</span><span class="op" id="5452473">.</span><span class="ident" id="5452474">Palette</span><span class="op" id="5452481">[</span><span class="op" id="5452482">:</span><span class="builtintype" id="5452483">int</span><span class="op" id="5452486">(</span><span class="ident" id="5452487">idx</span><span class="op" id="5452490">)</span><span class="op" id="5452491">+</span><span class="num" id="5452492">1</span><span class="op" id="5452493">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452507">paletted</span><span class="op" id="5452515">.</span><span class="ident" id="5452516">SetColorIndex</span><span class="op" id="5452529">(</span><span class="ident" id="5452530">x</span><span class="op" id="5452531">+</span><span class="ident" id="5452532">x2</span><span class="op" id="5452534">,</span>&nbsp;<span class="ident" id="5452536">y</span><span class="op" id="5452537">,</span>&nbsp;<span class="ident" id="5452539">idx</span><span class="op" id="5452542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452549">b</span>&nbsp;<span class="op" id="5452551">&lt;&lt;=</span>&nbsp;<span class="num" id="5452555">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452566">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452570">case</span>&nbsp;<span class="ident" id="5452575">cbP2</span><span class="op" id="5452579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452584">for</span>&nbsp;<span class="ident" id="5452588">x</span>&nbsp;<span class="op" id="5452590">:=</span>&nbsp;<span class="num" id="5452593">0</span><span class="op" id="5452594">;</span>&nbsp;<span class="ident" id="5452596">x</span>&nbsp;<span class="op" id="5452598">&lt;</span>&nbsp;<span class="ident" id="5452600">width</span><span class="op" id="5452605">;</span>&nbsp;<span class="ident" id="5452607">x</span>&nbsp;<span class="op" id="5452609">+=</span>&nbsp;<span class="num" id="5452612">4</span>&nbsp;<span class="op" id="5452614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452620">b</span>&nbsp;<span class="op" id="5452622">:=</span>&nbsp;<span class="ident" id="5452625">cdat</span><span class="op" id="5452629">[</span><span class="ident" id="5452630">x</span><span class="op" id="5452631">/</span><span class="num" id="5452632">4</span><span class="op" id="5452633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452639">for</span>&nbsp;<span class="ident" id="5452643">x2</span>&nbsp;<span class="op" id="5452646">:=</span>&nbsp;<span class="num" id="5452649">0</span><span class="op" id="5452650">;</span>&nbsp;<span class="ident" id="5452652">x2</span>&nbsp;<span class="op" id="5452655">&lt;</span>&nbsp;<span class="num" id="5452657">4</span>&nbsp;<span class="op" id="5452659">&amp;&amp;</span>&nbsp;<span class="ident" id="5452662">x</span><span class="op" id="5452663">+</span><span class="ident" id="5452664">x2</span>&nbsp;<span class="op" id="5452667">&lt;</span>&nbsp;<span class="ident" id="5452669">width</span><span class="op" id="5452674">;</span>&nbsp;<span class="ident" id="5452676">x2</span><span class="op" id="5452678">++</span>&nbsp;<span class="op" id="5452681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452688">idx</span>&nbsp;<span class="op" id="5452692">:=</span>&nbsp;<span class="ident" id="5452695">b</span>&nbsp;<span class="op" id="5452697">&gt;&gt;</span>&nbsp;<span class="num" id="5452700">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452707">if</span>&nbsp;<span class="builtinfunc" id="5452710">len</span><span class="op" id="5452713">(</span><span class="ident" id="5452714">paletted</span><span class="op" id="5452722">.</span><span class="ident" id="5452723">Palette</span><span class="op" id="5452730">)</span>&nbsp;<span class="op" id="5452732">&lt;=</span>&nbsp;<span class="builtintype" id="5452735">int</span><span class="op" id="5452738">(</span><span class="ident" id="5452739">idx</span><span class="op" id="5452742">)</span>&nbsp;<span class="op" id="5452744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452752">paletted</span><span class="op" id="5452760">.</span><span class="ident" id="5452761">Palette</span>&nbsp;<span class="op" id="5452769">=</span>&nbsp;<span class="ident" id="5452771">paletted</span><span class="op" id="5452779">.</span><span class="ident" id="5452780">Palette</span><span class="op" id="5452787">[</span><span class="op" id="5452788">:</span><span class="builtintype" id="5452789">int</span><span class="op" id="5452792">(</span><span class="ident" id="5452793">idx</span><span class="op" id="5452796">)</span><span class="op" id="5452797">+</span><span class="num" id="5452798">1</span><span class="op" id="5452799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452813">paletted</span><span class="op" id="5452821">.</span><span class="ident" id="5452822">SetColorIndex</span><span class="op" id="5452835">(</span><span class="ident" id="5452836">x</span><span class="op" id="5452837">+</span><span class="ident" id="5452838">x2</span><span class="op" id="5452840">,</span>&nbsp;<span class="ident" id="5452842">y</span><span class="op" id="5452843">,</span>&nbsp;<span class="ident" id="5452845">idx</span><span class="op" id="5452848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452855">b</span>&nbsp;<span class="op" id="5452857">&lt;&lt;=</span>&nbsp;<span class="num" id="5452861">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452876">case</span>&nbsp;<span class="ident" id="5452881">cbP4</span><span class="op" id="5452885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452890">for</span>&nbsp;<span class="ident" id="5452894">x</span>&nbsp;<span class="op" id="5452896">:=</span>&nbsp;<span class="num" id="5452899">0</span><span class="op" id="5452900">;</span>&nbsp;<span class="ident" id="5452902">x</span>&nbsp;<span class="op" id="5452904">&lt;</span>&nbsp;<span class="ident" id="5452906">width</span><span class="op" id="5452911">;</span>&nbsp;<span class="ident" id="5452913">x</span>&nbsp;<span class="op" id="5452915">+=</span>&nbsp;<span class="num" id="5452918">2</span>&nbsp;<span class="op" id="5452920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452926">b</span>&nbsp;<span class="op" id="5452928">:=</span>&nbsp;<span class="ident" id="5452931">cdat</span><span class="op" id="5452935">[</span><span class="ident" id="5452936">x</span><span class="op" id="5452937">/</span><span class="num" id="5452938">2</span><span class="op" id="5452939">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452945">for</span>&nbsp;<span class="ident" id="5452949">x2</span>&nbsp;<span class="op" id="5452952">:=</span>&nbsp;<span class="num" id="5452955">0</span><span class="op" id="5452956">;</span>&nbsp;<span class="ident" id="5452958">x2</span>&nbsp;<span class="op" id="5452961">&lt;</span>&nbsp;<span class="num" id="5452963">2</span>&nbsp;<span class="op" id="5452965">&amp;&amp;</span>&nbsp;<span class="ident" id="5452968">x</span><span class="op" id="5452969">+</span><span class="ident" id="5452970">x2</span>&nbsp;<span class="op" id="5452973">&lt;</span>&nbsp;<span class="ident" id="5452975">width</span><span class="op" id="5452980">;</span>&nbsp;<span class="ident" id="5452982">x2</span><span class="op" id="5452984">++</span>&nbsp;<span class="op" id="5452987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452994">idx</span>&nbsp;<span class="op" id="5452998">:=</span>&nbsp;<span class="ident" id="5453001">b</span>&nbsp;<span class="op" id="5453003">&gt;&gt;</span>&nbsp;<span class="num" id="5453006">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453013">if</span>&nbsp;<span class="builtinfunc" id="5453016">len</span><span class="op" id="5453019">(</span><span class="ident" id="5453020">paletted</span><span class="op" id="5453028">.</span><span class="ident" id="5453029">Palette</span><span class="op" id="5453036">)</span>&nbsp;<span class="op" id="5453038">&lt;=</span>&nbsp;<span class="builtintype" id="5453041">int</span><span class="op" id="5453044">(</span><span class="ident" id="5453045">idx</span><span class="op" id="5453048">)</span>&nbsp;<span class="op" id="5453050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453058">paletted</span><span class="op" id="5453066">.</span><span class="ident" id="5453067">Palette</span>&nbsp;<span class="op" id="5453075">=</span>&nbsp;<span class="ident" id="5453077">paletted</span><span class="op" id="5453085">.</span><span class="ident" id="5453086">Palette</span><span class="op" id="5453093">[</span><span class="op" id="5453094">:</span><span class="builtintype" id="5453095">int</span><span class="op" id="5453098">(</span><span class="ident" id="5453099">idx</span><span class="op" id="5453102">)</span><span class="op" id="5453103">+</span><span class="num" id="5453104">1</span><span class="op" id="5453105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453112">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453119">paletted</span><span class="op" id="5453127">.</span><span class="ident" id="5453128">SetColorIndex</span><span class="op" id="5453141">(</span><span class="ident" id="5453142">x</span><span class="op" id="5453143">+</span><span class="ident" id="5453144">x2</span><span class="op" id="5453146">,</span>&nbsp;<span class="ident" id="5453148">y</span><span class="op" id="5453149">,</span>&nbsp;<span class="ident" id="5453151">idx</span><span class="op" id="5453154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453161">b</span>&nbsp;<span class="op" id="5453163">&lt;&lt;=</span>&nbsp;<span class="num" id="5453167">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453182">case</span>&nbsp;<span class="ident" id="5453187">cbP8</span><span class="op" id="5453191">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453196">if</span>&nbsp;<span class="builtinfunc" id="5453199">len</span><span class="op" id="5453202">(</span><span class="ident" id="5453203">paletted</span><span class="op" id="5453211">.</span><span class="ident" id="5453212">Palette</span><span class="op" id="5453219">)</span>&nbsp;<span class="op" id="5453221">!=</span>&nbsp;<span class="num" id="5453224">255</span>&nbsp;<span class="op" id="5453228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453234">for</span>&nbsp;<span class="ident" id="5453238">x</span>&nbsp;<span class="op" id="5453240">:=</span>&nbsp;<span class="num" id="5453243">0</span><span class="op" id="5453244">;</span>&nbsp;<span class="ident" id="5453246">x</span>&nbsp;<span class="op" id="5453248">&lt;</span>&nbsp;<span class="ident" id="5453250">width</span><span class="op" id="5453255">;</span>&nbsp;<span class="ident" id="5453257">x</span><span class="op" id="5453258">++</span>&nbsp;<span class="op" id="5453261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453268">if</span>&nbsp;<span class="builtinfunc" id="5453271">len</span><span class="op" id="5453274">(</span><span class="ident" id="5453275">paletted</span><span class="op" id="5453283">.</span><span class="ident" id="5453284">Palette</span><span class="op" id="5453291">)</span>&nbsp;<span class="op" id="5453293">&lt;=</span>&nbsp;<span class="builtintype" id="5453296">int</span><span class="op" id="5453299">(</span><span class="ident" id="5453300">cdat</span><span class="op" id="5453304">[</span><span class="ident" id="5453305">x</span><span class="op" id="5453306">]</span><span class="op" id="5453307">)</span>&nbsp;<span class="op" id="5453309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453317">paletted</span><span class="op" id="5453325">.</span><span class="ident" id="5453326">Palette</span>&nbsp;<span class="op" id="5453334">=</span>&nbsp;<span class="ident" id="5453336">paletted</span><span class="op" id="5453344">.</span><span class="ident" id="5453345">Palette</span><span class="op" id="5453352">[</span><span class="op" id="5453353">:</span><span class="builtintype" id="5453354">int</span><span class="op" id="5453357">(</span><span class="ident" id="5453358">cdat</span><span class="op" id="5453362">[</span><span class="ident" id="5453363">x</span><span class="op" id="5453364">]</span><span class="op" id="5453365">)</span><span class="op" id="5453366">+</span><span class="num" id="5453367">1</span><span class="op" id="5453368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453375">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5453391">copy</span><span class="op" id="5453395">(</span><span class="ident" id="5453396">paletted</span><span class="op" id="5453404">.</span><span class="ident" id="5453405">Pix</span><span class="op" id="5453408">[</span><span class="ident" id="5453409">pixOffset</span><span class="op" id="5453418">:</span><span class="op" id="5453419">]</span><span class="op" id="5453420">,</span>&nbsp;<span class="ident" id="5453422">cdat</span><span class="op" id="5453426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453431">pixOffset</span>&nbsp;<span class="op" id="5453441">+=</span>&nbsp;<span class="ident" id="5453444">paletted</span><span class="op" id="5453452">.</span><span class="ident" id="5453453">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453462">case</span>&nbsp;<span class="ident" id="5453467">cbTCA8</span><span class="op" id="5453473">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5453478">copy</span><span class="op" id="5453482">(</span><span class="ident" id="5453483">nrgba</span><span class="op" id="5453488">.</span><span class="ident" id="5453489">Pix</span><span class="op" id="5453492">[</span><span class="ident" id="5453493">pixOffset</span><span class="op" id="5453502">:</span><span class="op" id="5453503">]</span><span class="op" id="5453504">,</span>&nbsp;<span class="ident" id="5453506">cdat</span><span class="op" id="5453510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453515">pixOffset</span>&nbsp;<span class="op" id="5453525">+=</span>&nbsp;<span class="ident" id="5453528">nrgba</span><span class="op" id="5453533">.</span><span class="ident" id="5453534">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453543">case</span>&nbsp;<span class="ident" id="5453548">cbG16</span><span class="op" id="5453553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453558">for</span>&nbsp;<span class="ident" id="5453562">x</span>&nbsp;<span class="op" id="5453564">:=</span>&nbsp;<span class="num" id="5453567">0</span><span class="op" id="5453568">;</span>&nbsp;<span class="ident" id="5453570">x</span>&nbsp;<span class="op" id="5453572">&lt;</span>&nbsp;<span class="ident" id="5453574">width</span><span class="op" id="5453579">;</span>&nbsp;<span class="ident" id="5453581">x</span><span class="op" id="5453582">++</span>&nbsp;<span class="op" id="5453585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453591">ycol</span>&nbsp;<span class="op" id="5453596">:=</span>&nbsp;<span class="builtintype" id="5453599">uint16</span><span class="op" id="5453605">(</span><span class="ident" id="5453606">cdat</span><span class="op" id="5453610">[</span><span class="num" id="5453611">2</span><span class="op" id="5453612">*</span><span class="ident" id="5453613">x</span><span class="op" id="5453614">+</span><span class="num" id="5453615">0</span><span class="op" id="5453616">]</span><span class="op" id="5453617">)</span><span class="op" id="5453618">&lt;&lt;</span><span class="num" id="5453620">8</span>&nbsp;<span class="op" id="5453622">|</span>&nbsp;<span class="builtintype" id="5453624">uint16</span><span class="op" id="5453630">(</span><span class="ident" id="5453631">cdat</span><span class="op" id="5453635">[</span><span class="num" id="5453636">2</span><span class="op" id="5453637">*</span><span class="ident" id="5453638">x</span><span class="op" id="5453639">+</span><span class="num" id="5453640">1</span><span class="op" id="5453641">]</span><span class="op" id="5453642">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453648">gray16</span><span class="op" id="5453654">.</span><span class="ident" id="5453655">SetGray16</span><span class="op" id="5453664">(</span><span class="ident" id="5453665">x</span><span class="op" id="5453666">,</span>&nbsp;<span class="ident" id="5453668">y</span><span class="op" id="5453669">,</span>&nbsp;<span class="ident" id="5453671">color</span><span class="op" id="5453676">.</span><span class="ident" id="5453677">Gray16</span><span class="op" id="5453683">{</span><span class="ident" id="5453684">ycol</span><span class="op" id="5453688">}</span><span class="op" id="5453689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453698">case</span>&nbsp;<span class="ident" id="5453703">cbGA16</span><span class="op" id="5453709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453714">for</span>&nbsp;<span class="ident" id="5453718">x</span>&nbsp;<span class="op" id="5453720">:=</span>&nbsp;<span class="num" id="5453723">0</span><span class="op" id="5453724">;</span>&nbsp;<span class="ident" id="5453726">x</span>&nbsp;<span class="op" id="5453728">&lt;</span>&nbsp;<span class="ident" id="5453730">width</span><span class="op" id="5453735">;</span>&nbsp;<span class="ident" id="5453737">x</span><span class="op" id="5453738">++</span>&nbsp;<span class="op" id="5453741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453747">ycol</span>&nbsp;<span class="op" id="5453752">:=</span>&nbsp;<span class="builtintype" id="5453755">uint16</span><span class="op" id="5453761">(</span><span class="ident" id="5453762">cdat</span><span class="op" id="5453766">[</span><span class="num" id="5453767">4</span><span class="op" id="5453768">*</span><span class="ident" id="5453769">x</span><span class="op" id="5453770">+</span><span class="num" id="5453771">0</span><span class="op" id="5453772">]</span><span class="op" id="5453773">)</span><span class="op" id="5453774">&lt;&lt;</span><span class="num" id="5453776">8</span>&nbsp;<span class="op" id="5453778">|</span>&nbsp;<span class="builtintype" id="5453780">uint16</span><span class="op" id="5453786">(</span><span class="ident" id="5453787">cdat</span><span class="op" id="5453791">[</span><span class="num" id="5453792">4</span><span class="op" id="5453793">*</span><span class="ident" id="5453794">x</span><span class="op" id="5453795">+</span><span class="num" id="5453796">1</span><span class="op" id="5453797">]</span><span class="op" id="5453798">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453804">acol</span>&nbsp;<span class="op" id="5453809">:=</span>&nbsp;<span class="builtintype" id="5453812">uint16</span><span class="op" id="5453818">(</span><span class="ident" id="5453819">cdat</span><span class="op" id="5453823">[</span><span class="num" id="5453824">4</span><span class="op" id="5453825">*</span><span class="ident" id="5453826">x</span><span class="op" id="5453827">+</span><span class="num" id="5453828">2</span><span class="op" id="5453829">]</span><span class="op" id="5453830">)</span><span class="op" id="5453831">&lt;&lt;</span><span class="num" id="5453833">8</span>&nbsp;<span class="op" id="5453835">|</span>&nbsp;<span class="builtintype" id="5453837">uint16</span><span class="op" id="5453843">(</span><span class="ident" id="5453844">cdat</span><span class="op" id="5453848">[</span><span class="num" id="5453849">4</span><span class="op" id="5453850">*</span><span class="ident" id="5453851">x</span><span class="op" id="5453852">+</span><span class="num" id="5453853">3</span><span class="op" id="5453854">]</span><span class="op" id="5453855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453861">nrgba64</span><span class="op" id="5453868">.</span><span class="ident" id="5453869">SetNRGBA64</span><span class="op" id="5453879">(</span><span class="ident" id="5453880">x</span><span class="op" id="5453881">,</span>&nbsp;<span class="ident" id="5453883">y</span><span class="op" id="5453884">,</span>&nbsp;<span class="ident" id="5453886">color</span><span class="op" id="5453891">.</span><span class="ident" id="5453892">NRGBA64</span><span class="op" id="5453899">{</span><span class="ident" id="5453900">ycol</span><span class="op" id="5453904">,</span>&nbsp;<span class="ident" id="5453906">ycol</span><span class="op" id="5453910">,</span>&nbsp;<span class="ident" id="5453912">ycol</span><span class="op" id="5453916">,</span>&nbsp;<span class="ident" id="5453918">acol</span><span class="op" id="5453922">}</span><span class="op" id="5453923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453932">case</span>&nbsp;<span class="ident" id="5453937">cbTC16</span><span class="op" id="5453943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453948">for</span>&nbsp;<span class="ident" id="5453952">x</span>&nbsp;<span class="op" id="5453954">:=</span>&nbsp;<span class="num" id="5453957">0</span><span class="op" id="5453958">;</span>&nbsp;<span class="ident" id="5453960">x</span>&nbsp;<span class="op" id="5453962">&lt;</span>&nbsp;<span class="ident" id="5453964">width</span><span class="op" id="5453969">;</span>&nbsp;<span class="ident" id="5453971">x</span><span class="op" id="5453972">++</span>&nbsp;<span class="op" id="5453975">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453981">rcol</span>&nbsp;<span class="op" id="5453986">:=</span>&nbsp;<span class="builtintype" id="5453989">uint16</span><span class="op" id="5453995">(</span><span class="ident" id="5453996">cdat</span><span class="op" id="5454000">[</span><span class="num" id="5454001">6</span><span class="op" id="5454002">*</span><span class="ident" id="5454003">x</span><span class="op" id="5454004">+</span><span class="num" id="5454005">0</span><span class="op" id="5454006">]</span><span class="op" id="5454007">)</span><span class="op" id="5454008">&lt;&lt;</span><span class="num" id="5454010">8</span>&nbsp;<span class="op" id="5454012">|</span>&nbsp;<span class="builtintype" id="5454014">uint16</span><span class="op" id="5454020">(</span><span class="ident" id="5454021">cdat</span><span class="op" id="5454025">[</span><span class="num" id="5454026">6</span><span class="op" id="5454027">*</span><span class="ident" id="5454028">x</span><span class="op" id="5454029">+</span><span class="num" id="5454030">1</span><span class="op" id="5454031">]</span><span class="op" id="5454032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454038">gcol</span>&nbsp;<span class="op" id="5454043">:=</span>&nbsp;<span class="builtintype" id="5454046">uint16</span><span class="op" id="5454052">(</span><span class="ident" id="5454053">cdat</span><span class="op" id="5454057">[</span><span class="num" id="5454058">6</span><span class="op" id="5454059">*</span><span class="ident" id="5454060">x</span><span class="op" id="5454061">+</span><span class="num" id="5454062">2</span><span class="op" id="5454063">]</span><span class="op" id="5454064">)</span><span class="op" id="5454065">&lt;&lt;</span><span class="num" id="5454067">8</span>&nbsp;<span class="op" id="5454069">|</span>&nbsp;<span class="builtintype" id="5454071">uint16</span><span class="op" id="5454077">(</span><span class="ident" id="5454078">cdat</span><span class="op" id="5454082">[</span><span class="num" id="5454083">6</span><span class="op" id="5454084">*</span><span class="ident" id="5454085">x</span><span class="op" id="5454086">+</span><span class="num" id="5454087">3</span><span class="op" id="5454088">]</span><span class="op" id="5454089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454095">bcol</span>&nbsp;<span class="op" id="5454100">:=</span>&nbsp;<span class="builtintype" id="5454103">uint16</span><span class="op" id="5454109">(</span><span class="ident" id="5454110">cdat</span><span class="op" id="5454114">[</span><span class="num" id="5454115">6</span><span class="op" id="5454116">*</span><span class="ident" id="5454117">x</span><span class="op" id="5454118">+</span><span class="num" id="5454119">4</span><span class="op" id="5454120">]</span><span class="op" id="5454121">)</span><span class="op" id="5454122">&lt;&lt;</span><span class="num" id="5454124">8</span>&nbsp;<span class="op" id="5454126">|</span>&nbsp;<span class="builtintype" id="5454128">uint16</span><span class="op" id="5454134">(</span><span class="ident" id="5454135">cdat</span><span class="op" id="5454139">[</span><span class="num" id="5454140">6</span><span class="op" id="5454141">*</span><span class="ident" id="5454142">x</span><span class="op" id="5454143">+</span><span class="num" id="5454144">5</span><span class="op" id="5454145">]</span><span class="op" id="5454146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454152">rgba64</span><span class="op" id="5454158">.</span><span class="ident" id="5454159">SetRGBA64</span><span class="op" id="5454168">(</span><span class="ident" id="5454169">x</span><span class="op" id="5454170">,</span>&nbsp;<span class="ident" id="5454172">y</span><span class="op" id="5454173">,</span>&nbsp;<span class="ident" id="5454175">color</span><span class="op" id="5454180">.</span><span class="ident" id="5454181">RGBA64</span><span class="op" id="5454187">{</span><span class="ident" id="5454188">rcol</span><span class="op" id="5454192">,</span>&nbsp;<span class="ident" id="5454194">gcol</span><span class="op" id="5454198">,</span>&nbsp;<span class="ident" id="5454200">bcol</span><span class="op" id="5454204">,</span>&nbsp;<span class="num" id="5454206">0xffff</span><span class="op" id="5454212">}</span><span class="op" id="5454213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454218">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454222">case</span>&nbsp;<span class="ident" id="5454227">cbTCA16</span><span class="op" id="5454234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454239">for</span>&nbsp;<span class="ident" id="5454243">x</span>&nbsp;<span class="op" id="5454245">:=</span>&nbsp;<span class="num" id="5454248">0</span><span class="op" id="5454249">;</span>&nbsp;<span class="ident" id="5454251">x</span>&nbsp;<span class="op" id="5454253">&lt;</span>&nbsp;<span class="ident" id="5454255">width</span><span class="op" id="5454260">;</span>&nbsp;<span class="ident" id="5454262">x</span><span class="op" id="5454263">++</span>&nbsp;<span class="op" id="5454266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454272">rcol</span>&nbsp;<span class="op" id="5454277">:=</span>&nbsp;<span class="builtintype" id="5454280">uint16</span><span class="op" id="5454286">(</span><span class="ident" id="5454287">cdat</span><span class="op" id="5454291">[</span><span class="num" id="5454292">8</span><span class="op" id="5454293">*</span><span class="ident" id="5454294">x</span><span class="op" id="5454295">+</span><span class="num" id="5454296">0</span><span class="op" id="5454297">]</span><span class="op" id="5454298">)</span><span class="op" id="5454299">&lt;&lt;</span><span class="num" id="5454301">8</span>&nbsp;<span class="op" id="5454303">|</span>&nbsp;<span class="builtintype" id="5454305">uint16</span><span class="op" id="5454311">(</span><span class="ident" id="5454312">cdat</span><span class="op" id="5454316">[</span><span class="num" id="5454317">8</span><span class="op" id="5454318">*</span><span class="ident" id="5454319">x</span><span class="op" id="5454320">+</span><span class="num" id="5454321">1</span><span class="op" id="5454322">]</span><span class="op" id="5454323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454329">gcol</span>&nbsp;<span class="op" id="5454334">:=</span>&nbsp;<span class="builtintype" id="5454337">uint16</span><span class="op" id="5454343">(</span><span class="ident" id="5454344">cdat</span><span class="op" id="5454348">[</span><span class="num" id="5454349">8</span><span class="op" id="5454350">*</span><span class="ident" id="5454351">x</span><span class="op" id="5454352">+</span><span class="num" id="5454353">2</span><span class="op" id="5454354">]</span><span class="op" id="5454355">)</span><span class="op" id="5454356">&lt;&lt;</span><span class="num" id="5454358">8</span>&nbsp;<span class="op" id="5454360">|</span>&nbsp;<span class="builtintype" id="5454362">uint16</span><span class="op" id="5454368">(</span><span class="ident" id="5454369">cdat</span><span class="op" id="5454373">[</span><span class="num" id="5454374">8</span><span class="op" id="5454375">*</span><span class="ident" id="5454376">x</span><span class="op" id="5454377">+</span><span class="num" id="5454378">3</span><span class="op" id="5454379">]</span><span class="op" id="5454380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454386">bcol</span>&nbsp;<span class="op" id="5454391">:=</span>&nbsp;<span class="builtintype" id="5454394">uint16</span><span class="op" id="5454400">(</span><span class="ident" id="5454401">cdat</span><span class="op" id="5454405">[</span><span class="num" id="5454406">8</span><span class="op" id="5454407">*</span><span class="ident" id="5454408">x</span><span class="op" id="5454409">+</span><span class="num" id="5454410">4</span><span class="op" id="5454411">]</span><span class="op" id="5454412">)</span><span class="op" id="5454413">&lt;&lt;</span><span class="num" id="5454415">8</span>&nbsp;<span class="op" id="5454417">|</span>&nbsp;<span class="builtintype" id="5454419">uint16</span><span class="op" id="5454425">(</span><span class="ident" id="5454426">cdat</span><span class="op" id="5454430">[</span><span class="num" id="5454431">8</span><span class="op" id="5454432">*</span><span class="ident" id="5454433">x</span><span class="op" id="5454434">+</span><span class="num" id="5454435">5</span><span class="op" id="5454436">]</span><span class="op" id="5454437">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454443">acol</span>&nbsp;<span class="op" id="5454448">:=</span>&nbsp;<span class="builtintype" id="5454451">uint16</span><span class="op" id="5454457">(</span><span class="ident" id="5454458">cdat</span><span class="op" id="5454462">[</span><span class="num" id="5454463">8</span><span class="op" id="5454464">*</span><span class="ident" id="5454465">x</span><span class="op" id="5454466">+</span><span class="num" id="5454467">6</span><span class="op" id="5454468">]</span><span class="op" id="5454469">)</span><span class="op" id="5454470">&lt;&lt;</span><span class="num" id="5454472">8</span>&nbsp;<span class="op" id="5454474">|</span>&nbsp;<span class="builtintype" id="5454476">uint16</span><span class="op" id="5454482">(</span><span class="ident" id="5454483">cdat</span><span class="op" id="5454487">[</span><span class="num" id="5454488">8</span><span class="op" id="5454489">*</span><span class="ident" id="5454490">x</span><span class="op" id="5454491">+</span><span class="num" id="5454492">7</span><span class="op" id="5454493">]</span><span class="op" id="5454494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454500">nrgba64</span><span class="op" id="5454507">.</span><span class="ident" id="5454508">SetNRGBA64</span><span class="op" id="5454518">(</span><span class="ident" id="5454519">x</span><span class="op" id="5454520">,</span>&nbsp;<span class="ident" id="5454522">y</span><span class="op" id="5454523">,</span>&nbsp;<span class="ident" id="5454525">color</span><span class="op" id="5454530">.</span><span class="ident" id="5454531">NRGBA64</span><span class="op" id="5454538">{</span><span class="ident" id="5454539">rcol</span><span class="op" id="5454543">,</span>&nbsp;<span class="ident" id="5454545">gcol</span><span class="op" id="5454549">,</span>&nbsp;<span class="ident" id="5454551">bcol</span><span class="op" id="5454555">,</span>&nbsp;<span class="ident" id="5454557">acol</span><span class="op" id="5454561">}</span><span class="op" id="5454562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454576">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454632">pr</span><span class="op" id="5454634">,</span>&nbsp;<span class="ident" id="5454636">cr</span>&nbsp;<span class="op" id="5454639">=</span>&nbsp;<span class="ident" id="5454641">cr</span><span class="op" id="5454643">,</span>&nbsp;<span class="ident" id="5454645">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454653">return</span>&nbsp;<span class="ident" id="5454660">img</span><span class="op" id="5454663">,</span>&nbsp;<span class="ident" id="5454665">nil</span><br>
<span class="lineno">585</span><span class="op" id="5454669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454672">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5454735">func</span>&nbsp;<span class="op" id="5454740">(</span><span class="ident" id="5454741">d</span>&nbsp;<span class="op" id="5454743">*</span><span class="ident" id="5454744">decoder</span><span class="op" id="5454751">)</span>&nbsp;<span class="ident" id="5454753">mergePassInto</span><span class="op" id="5454766">(</span><span class="ident" id="5454767">dst</span>&nbsp;<span class="ident" id="5454771">image</span><span class="op" id="5454776">.</span><span class="ident" id="5454777">Image</span><span class="op" id="5454782">,</span>&nbsp;<span class="ident" id="5454784">src</span>&nbsp;<span class="ident" id="5454788">image</span><span class="op" id="5454793">.</span><span class="ident" id="5454794">Image</span><span class="op" id="5454799">,</span>&nbsp;<span class="ident" id="5454801">pass</span>&nbsp;<span class="builtintype" id="5454806">int</span><span class="op" id="5454809">)</span>&nbsp;<span class="op" id="5454811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454814">p</span>&nbsp;<span class="op" id="5454816">:=</span>&nbsp;<span class="ident" id="5454819">interlacing</span><span class="op" id="5454830">[</span><span class="ident" id="5454831">pass</span><span class="op" id="5454835">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454838">var</span>&nbsp;<span class="op" id="5454842">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454846">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454860">[</span><span class="op" id="5454861">]</span><span class="builtintype" id="5454862">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454870">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454884">[</span><span class="op" id="5454885">]</span><span class="builtintype" id="5454886">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454894">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5454908">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454914">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454928">image</span><span class="op" id="5454933">.</span><span class="ident" id="5454934">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454946">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5454960">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454968">switch</span>&nbsp;<span class="ident" id="5454975">target</span>&nbsp;<span class="op" id="5454982">:=</span>&nbsp;<span class="ident" id="5454985">dst</span><span class="op" id="5454988">.</span><span class="op" id="5454989">(</span><span class="keyword" id="5454990">type</span><span class="op" id="5454994">)</span>&nbsp;<span class="op" id="5454996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454999">case</span>&nbsp;<span class="op" id="5455004">*</span><span class="ident" id="5455005">image</span><span class="op" id="5455010">.</span><span class="ident" id="5455011">Alpha</span><span class="op" id="5455016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455020">srcPix</span>&nbsp;<span class="op" id="5455027">=</span>&nbsp;<span class="ident" id="5455029">src</span><span class="op" id="5455032">.</span><span class="op" id="5455033">(</span><span class="op" id="5455034">*</span><span class="ident" id="5455035">image</span><span class="op" id="5455040">.</span><span class="ident" id="5455041">Alpha</span><span class="op" id="5455046">)</span><span class="op" id="5455047">.</span><span class="ident" id="5455048">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455054">dstPix</span><span class="op" id="5455060">,</span>&nbsp;<span class="ident" id="5455062">stride</span><span class="op" id="5455068">,</span>&nbsp;<span class="ident" id="5455070">rect</span>&nbsp;<span class="op" id="5455075">=</span>&nbsp;<span class="ident" id="5455077">target</span><span class="op" id="5455083">.</span><span class="ident" id="5455084">Pix</span><span class="op" id="5455087">,</span>&nbsp;<span class="ident" id="5455089">target</span><span class="op" id="5455095">.</span><span class="ident" id="5455096">Stride</span><span class="op" id="5455102">,</span>&nbsp;<span class="ident" id="5455104">target</span><span class="op" id="5455110">.</span><span class="ident" id="5455111">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455118">bytesPerPixel</span>&nbsp;<span class="op" id="5455132">=</span>&nbsp;<span class="num" id="5455134">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455137">case</span>&nbsp;<span class="op" id="5455142">*</span><span class="ident" id="5455143">image</span><span class="op" id="5455148">.</span><span class="ident" id="5455149">Alpha16</span><span class="op" id="5455156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455160">srcPix</span>&nbsp;<span class="op" id="5455167">=</span>&nbsp;<span class="ident" id="5455169">src</span><span class="op" id="5455172">.</span><span class="op" id="5455173">(</span><span class="op" id="5455174">*</span><span class="ident" id="5455175">image</span><span class="op" id="5455180">.</span><span class="ident" id="5455181">Alpha16</span><span class="op" id="5455188">)</span><span class="op" id="5455189">.</span><span class="ident" id="5455190">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455196">dstPix</span><span class="op" id="5455202">,</span>&nbsp;<span class="ident" id="5455204">stride</span><span class="op" id="5455210">,</span>&nbsp;<span class="ident" id="5455212">rect</span>&nbsp;<span class="op" id="5455217">=</span>&nbsp;<span class="ident" id="5455219">target</span><span class="op" id="5455225">.</span><span class="ident" id="5455226">Pix</span><span class="op" id="5455229">,</span>&nbsp;<span class="ident" id="5455231">target</span><span class="op" id="5455237">.</span><span class="ident" id="5455238">Stride</span><span class="op" id="5455244">,</span>&nbsp;<span class="ident" id="5455246">target</span><span class="op" id="5455252">.</span><span class="ident" id="5455253">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455260">bytesPerPixel</span>&nbsp;<span class="op" id="5455274">=</span>&nbsp;<span class="num" id="5455276">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455279">case</span>&nbsp;<span class="op" id="5455284">*</span><span class="ident" id="5455285">image</span><span class="op" id="5455290">.</span><span class="ident" id="5455291">Gray</span><span class="op" id="5455295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455299">srcPix</span>&nbsp;<span class="op" id="5455306">=</span>&nbsp;<span class="ident" id="5455308">src</span><span class="op" id="5455311">.</span><span class="op" id="5455312">(</span><span class="op" id="5455313">*</span><span class="ident" id="5455314">image</span><span class="op" id="5455319">.</span><span class="ident" id="5455320">Gray</span><span class="op" id="5455324">)</span><span class="op" id="5455325">.</span><span class="ident" id="5455326">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455332">dstPix</span><span class="op" id="5455338">,</span>&nbsp;<span class="ident" id="5455340">stride</span><span class="op" id="5455346">,</span>&nbsp;<span class="ident" id="5455348">rect</span>&nbsp;<span class="op" id="5455353">=</span>&nbsp;<span class="ident" id="5455355">target</span><span class="op" id="5455361">.</span><span class="ident" id="5455362">Pix</span><span class="op" id="5455365">,</span>&nbsp;<span class="ident" id="5455367">target</span><span class="op" id="5455373">.</span><span class="ident" id="5455374">Stride</span><span class="op" id="5455380">,</span>&nbsp;<span class="ident" id="5455382">target</span><span class="op" id="5455388">.</span><span class="ident" id="5455389">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455396">bytesPerPixel</span>&nbsp;<span class="op" id="5455410">=</span>&nbsp;<span class="num" id="5455412">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455415">case</span>&nbsp;<span class="op" id="5455420">*</span><span class="ident" id="5455421">image</span><span class="op" id="5455426">.</span><span class="ident" id="5455427">Gray16</span><span class="op" id="5455433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455437">srcPix</span>&nbsp;<span class="op" id="5455444">=</span>&nbsp;<span class="ident" id="5455446">src</span><span class="op" id="5455449">.</span><span class="op" id="5455450">(</span><span class="op" id="5455451">*</span><span class="ident" id="5455452">image</span><span class="op" id="5455457">.</span><span class="ident" id="5455458">Gray16</span><span class="op" id="5455464">)</span><span class="op" id="5455465">.</span><span class="ident" id="5455466">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455472">dstPix</span><span class="op" id="5455478">,</span>&nbsp;<span class="ident" id="5455480">stride</span><span class="op" id="5455486">,</span>&nbsp;<span class="ident" id="5455488">rect</span>&nbsp;<span class="op" id="5455493">=</span>&nbsp;<span class="ident" id="5455495">target</span><span class="op" id="5455501">.</span><span class="ident" id="5455502">Pix</span><span class="op" id="5455505">,</span>&nbsp;<span class="ident" id="5455507">target</span><span class="op" id="5455513">.</span><span class="ident" id="5455514">Stride</span><span class="op" id="5455520">,</span>&nbsp;<span class="ident" id="5455522">target</span><span class="op" id="5455528">.</span><span class="ident" id="5455529">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455536">bytesPerPixel</span>&nbsp;<span class="op" id="5455550">=</span>&nbsp;<span class="num" id="5455552">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455555">case</span>&nbsp;<span class="op" id="5455560">*</span><span class="ident" id="5455561">image</span><span class="op" id="5455566">.</span><span class="ident" id="5455567">NRGBA</span><span class="op" id="5455572">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455576">srcPix</span>&nbsp;<span class="op" id="5455583">=</span>&nbsp;<span class="ident" id="5455585">src</span><span class="op" id="5455588">.</span><span class="op" id="5455589">(</span><span class="op" id="5455590">*</span><span class="ident" id="5455591">image</span><span class="op" id="5455596">.</span><span class="ident" id="5455597">NRGBA</span><span class="op" id="5455602">)</span><span class="op" id="5455603">.</span><span class="ident" id="5455604">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455610">dstPix</span><span class="op" id="5455616">,</span>&nbsp;<span class="ident" id="5455618">stride</span><span class="op" id="5455624">,</span>&nbsp;<span class="ident" id="5455626">rect</span>&nbsp;<span class="op" id="5455631">=</span>&nbsp;<span class="ident" id="5455633">target</span><span class="op" id="5455639">.</span><span class="ident" id="5455640">Pix</span><span class="op" id="5455643">,</span>&nbsp;<span class="ident" id="5455645">target</span><span class="op" id="5455651">.</span><span class="ident" id="5455652">Stride</span><span class="op" id="5455658">,</span>&nbsp;<span class="ident" id="5455660">target</span><span class="op" id="5455666">.</span><span class="ident" id="5455667">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455674">bytesPerPixel</span>&nbsp;<span class="op" id="5455688">=</span>&nbsp;<span class="num" id="5455690">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455693">case</span>&nbsp;<span class="op" id="5455698">*</span><span class="ident" id="5455699">image</span><span class="op" id="5455704">.</span><span class="ident" id="5455705">NRGBA64</span><span class="op" id="5455712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455716">srcPix</span>&nbsp;<span class="op" id="5455723">=</span>&nbsp;<span class="ident" id="5455725">src</span><span class="op" id="5455728">.</span><span class="op" id="5455729">(</span><span class="op" id="5455730">*</span><span class="ident" id="5455731">image</span><span class="op" id="5455736">.</span><span class="ident" id="5455737">NRGBA64</span><span class="op" id="5455744">)</span><span class="op" id="5455745">.</span><span class="ident" id="5455746">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455752">dstPix</span><span class="op" id="5455758">,</span>&nbsp;<span class="ident" id="5455760">stride</span><span class="op" id="5455766">,</span>&nbsp;<span class="ident" id="5455768">rect</span>&nbsp;<span class="op" id="5455773">=</span>&nbsp;<span class="ident" id="5455775">target</span><span class="op" id="5455781">.</span><span class="ident" id="5455782">Pix</span><span class="op" id="5455785">,</span>&nbsp;<span class="ident" id="5455787">target</span><span class="op" id="5455793">.</span><span class="ident" id="5455794">Stride</span><span class="op" id="5455800">,</span>&nbsp;<span class="ident" id="5455802">target</span><span class="op" id="5455808">.</span><span class="ident" id="5455809">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455816">bytesPerPixel</span>&nbsp;<span class="op" id="5455830">=</span>&nbsp;<span class="num" id="5455832">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455835">case</span>&nbsp;<span class="op" id="5455840">*</span><span class="ident" id="5455841">image</span><span class="op" id="5455846">.</span><span class="ident" id="5455847">Paletted</span><span class="op" id="5455855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455859">srcPix</span>&nbsp;<span class="op" id="5455866">=</span>&nbsp;<span class="ident" id="5455868">src</span><span class="op" id="5455871">.</span><span class="op" id="5455872">(</span><span class="op" id="5455873">*</span><span class="ident" id="5455874">image</span><span class="op" id="5455879">.</span><span class="ident" id="5455880">Paletted</span><span class="op" id="5455888">)</span><span class="op" id="5455889">.</span><span class="ident" id="5455890">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455896">dstPix</span><span class="op" id="5455902">,</span>&nbsp;<span class="ident" id="5455904">stride</span><span class="op" id="5455910">,</span>&nbsp;<span class="ident" id="5455912">rect</span>&nbsp;<span class="op" id="5455917">=</span>&nbsp;<span class="ident" id="5455919">target</span><span class="op" id="5455925">.</span><span class="ident" id="5455926">Pix</span><span class="op" id="5455929">,</span>&nbsp;<span class="ident" id="5455931">target</span><span class="op" id="5455937">.</span><span class="ident" id="5455938">Stride</span><span class="op" id="5455944">,</span>&nbsp;<span class="ident" id="5455946">target</span><span class="op" id="5455952">.</span><span class="ident" id="5455953">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455960">bytesPerPixel</span>&nbsp;<span class="op" id="5455974">=</span>&nbsp;<span class="num" id="5455976">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455979">case</span>&nbsp;<span class="op" id="5455984">*</span><span class="ident" id="5455985">image</span><span class="op" id="5455990">.</span><span class="ident" id="5455991">RGBA</span><span class="op" id="5455995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455999">srcPix</span>&nbsp;<span class="op" id="5456006">=</span>&nbsp;<span class="ident" id="5456008">src</span><span class="op" id="5456011">.</span><span class="op" id="5456012">(</span><span class="op" id="5456013">*</span><span class="ident" id="5456014">image</span><span class="op" id="5456019">.</span><span class="ident" id="5456020">RGBA</span><span class="op" id="5456024">)</span><span class="op" id="5456025">.</span><span class="ident" id="5456026">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456032">dstPix</span><span class="op" id="5456038">,</span>&nbsp;<span class="ident" id="5456040">stride</span><span class="op" id="5456046">,</span>&nbsp;<span class="ident" id="5456048">rect</span>&nbsp;<span class="op" id="5456053">=</span>&nbsp;<span class="ident" id="5456055">target</span><span class="op" id="5456061">.</span><span class="ident" id="5456062">Pix</span><span class="op" id="5456065">,</span>&nbsp;<span class="ident" id="5456067">target</span><span class="op" id="5456073">.</span><span class="ident" id="5456074">Stride</span><span class="op" id="5456080">,</span>&nbsp;<span class="ident" id="5456082">target</span><span class="op" id="5456088">.</span><span class="ident" id="5456089">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456096">bytesPerPixel</span>&nbsp;<span class="op" id="5456110">=</span>&nbsp;<span class="num" id="5456112">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456115">case</span>&nbsp;<span class="op" id="5456120">*</span><span class="ident" id="5456121">image</span><span class="op" id="5456126">.</span><span class="ident" id="5456127">RGBA64</span><span class="op" id="5456133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456137">srcPix</span>&nbsp;<span class="op" id="5456144">=</span>&nbsp;<span class="ident" id="5456146">src</span><span class="op" id="5456149">.</span><span class="op" id="5456150">(</span><span class="op" id="5456151">*</span><span class="ident" id="5456152">image</span><span class="op" id="5456157">.</span><span class="ident" id="5456158">RGBA64</span><span class="op" id="5456164">)</span><span class="op" id="5456165">.</span><span class="ident" id="5456166">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456172">dstPix</span><span class="op" id="5456178">,</span>&nbsp;<span class="ident" id="5456180">stride</span><span class="op" id="5456186">,</span>&nbsp;<span class="ident" id="5456188">rect</span>&nbsp;<span class="op" id="5456193">=</span>&nbsp;<span class="ident" id="5456195">target</span><span class="op" id="5456201">.</span><span class="ident" id="5456202">Pix</span><span class="op" id="5456205">,</span>&nbsp;<span class="ident" id="5456207">target</span><span class="op" id="5456213">.</span><span class="ident" id="5456214">Stride</span><span class="op" id="5456220">,</span>&nbsp;<span class="ident" id="5456222">target</span><span class="op" id="5456228">.</span><span class="ident" id="5456229">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456236">bytesPerPixel</span>&nbsp;<span class="op" id="5456250">=</span>&nbsp;<span class="num" id="5456252">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456255">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456258">s</span><span class="op" id="5456259">,</span>&nbsp;<span class="ident" id="5456261">bounds</span>&nbsp;<span class="op" id="5456268">:=</span>&nbsp;<span class="num" id="5456271">0</span><span class="op" id="5456272">,</span>&nbsp;<span class="ident" id="5456274">src</span><span class="op" id="5456277">.</span><span class="ident" id="5456278">Bounds</span><span class="op" id="5456284">(</span><span class="op" id="5456285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456288">for</span>&nbsp;<span class="ident" id="5456292">y</span>&nbsp;<span class="op" id="5456294">:=</span>&nbsp;<span class="ident" id="5456297">bounds</span><span class="op" id="5456303">.</span><span class="ident" id="5456304">Min</span><span class="op" id="5456307">.</span><span class="ident" id="5456308">Y</span><span class="op" id="5456309">;</span>&nbsp;<span class="ident" id="5456311">y</span>&nbsp;<span class="op" id="5456313">&lt;</span>&nbsp;<span class="ident" id="5456315">bounds</span><span class="op" id="5456321">.</span><span class="ident" id="5456322">Max</span><span class="op" id="5456325">.</span><span class="ident" id="5456326">Y</span><span class="op" id="5456327">;</span>&nbsp;<span class="ident" id="5456329">y</span><span class="op" id="5456330">++</span>&nbsp;<span class="op" id="5456333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456337">dBase</span>&nbsp;<span class="op" id="5456343">:=</span>&nbsp;<span class="op" id="5456346">(</span><span class="ident" id="5456347">y</span><span class="op" id="5456348">*</span><span class="ident" id="5456349">p</span><span class="op" id="5456350">.</span><span class="ident" id="5456351">yFactor</span><span class="op" id="5456358">+</span><span class="ident" id="5456359">p</span><span class="op" id="5456360">.</span><span class="ident" id="5456361">yOffset</span><span class="op" id="5456368">-</span><span class="ident" id="5456369">rect</span><span class="op" id="5456373">.</span><span class="ident" id="5456374">Min</span><span class="op" id="5456377">.</span><span class="ident" id="5456378">Y</span><span class="op" id="5456379">)</span><span class="op" id="5456380">*</span><span class="ident" id="5456381">stride</span>&nbsp;<span class="op" id="5456388">+</span>&nbsp;<span class="op" id="5456390">(</span><span class="ident" id="5456391">p</span><span class="op" id="5456392">.</span><span class="ident" id="5456393">xOffset</span><span class="op" id="5456400">-</span><span class="ident" id="5456401">rect</span><span class="op" id="5456405">.</span><span class="ident" id="5456406">Min</span><span class="op" id="5456409">.</span><span class="ident" id="5456410">X</span><span class="op" id="5456411">)</span><span class="op" id="5456412">*</span><span class="ident" id="5456413">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456429">for</span>&nbsp;<span class="ident" id="5456433">x</span>&nbsp;<span class="op" id="5456435">:=</span>&nbsp;<span class="ident" id="5456438">bounds</span><span class="op" id="5456444">.</span><span class="ident" id="5456445">Min</span><span class="op" id="5456448">.</span><span class="ident" id="5456449">X</span><span class="op" id="5456450">;</span>&nbsp;<span class="ident" id="5456452">x</span>&nbsp;<span class="op" id="5456454">&lt;</span>&nbsp;<span class="ident" id="5456456">bounds</span><span class="op" id="5456462">.</span><span class="ident" id="5456463">Max</span><span class="op" id="5456466">.</span><span class="ident" id="5456467">X</span><span class="op" id="5456468">;</span>&nbsp;<span class="ident" id="5456470">x</span><span class="op" id="5456471">++</span>&nbsp;<span class="op" id="5456474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456479">d</span>&nbsp;<span class="op" id="5456481">:=</span>&nbsp;<span class="ident" id="5456484">dBase</span>&nbsp;<span class="op" id="5456490">+</span>&nbsp;<span class="ident" id="5456492">x</span><span class="op" id="5456493">*</span><span class="ident" id="5456494">p</span><span class="op" id="5456495">.</span><span class="ident" id="5456496">xFactor</span><span class="op" id="5456503">*</span><span class="ident" id="5456504">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5456521">copy</span><span class="op" id="5456525">(</span><span class="ident" id="5456526">dstPix</span><span class="op" id="5456532">[</span><span class="ident" id="5456533">d</span><span class="op" id="5456534">:</span><span class="op" id="5456535">]</span><span class="op" id="5456536">,</span>&nbsp;<span class="ident" id="5456538">srcPix</span><span class="op" id="5456544">[</span><span class="ident" id="5456545">s</span><span class="op" id="5456546">:</span><span class="ident" id="5456547">s</span><span class="op" id="5456548">+</span><span class="ident" id="5456549">bytesPerPixel</span><span class="op" id="5456562">]</span><span class="op" id="5456563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456568">s</span>&nbsp;<span class="op" id="5456570">+=</span>&nbsp;<span class="ident" id="5456573">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456592">}</span><br>
<span class="lineno"></span><span class="op" id="5456594">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5456597">func</span>&nbsp;<span class="op" id="5456602">(</span><span class="ident" id="5456603">d</span>&nbsp;<span class="op" id="5456605">*</span><span class="ident" id="5456606">decoder</span><span class="op" id="5456613">)</span>&nbsp;<span class="ident" id="5456615">parseIDAT</span><span class="op" id="5456624">(</span><span class="ident" id="5456625">length</span>&nbsp;<span class="builtintype" id="5456632">uint32</span><span class="op" id="5456638">)</span>&nbsp;<span class="op" id="5456640">(</span><span class="ident" id="5456641">err</span>&nbsp;<span class="builtintype" id="5456645">error</span><span class="op" id="5456650">)</span>&nbsp;<span class="op" id="5456652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456655">d</span><span class="op" id="5456656">.</span><span class="ident" id="5456657">idatLength</span>&nbsp;<span class="op" id="5456668">=</span>&nbsp;<span class="ident" id="5456670">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456678">d</span><span class="op" id="5456679">.</span><span class="ident" id="5456680">img</span><span class="op" id="5456683">,</span>&nbsp;<span class="ident" id="5456685">err</span>&nbsp;<span class="op" id="5456689">=</span>&nbsp;<span class="ident" id="5456691">d</span><span class="op" id="5456692">.</span><span class="ident" id="5456693">decode</span><span class="op" id="5456699">(</span><span class="op" id="5456700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456703">if</span>&nbsp;<span class="ident" id="5456706">err</span>&nbsp;<span class="op" id="5456710">!=</span>&nbsp;<span class="ident" id="5456713">nil</span>&nbsp;<span class="op" id="5456717">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456721">return</span>&nbsp;<span class="ident" id="5456728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456736">return</span>&nbsp;<span class="ident" id="5456743">d</span><span class="op" id="5456744">.</span><span class="ident" id="5456745">verifyChecksum</span><span class="op" id="5456759">(</span><span class="op" id="5456760">)</span><br>
<span class="lineno"></span><span class="op" id="5456762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5456765">func</span>&nbsp;<span class="op" id="5456770">(</span><span class="ident" id="5456771">d</span>&nbsp;<span class="op" id="5456773">*</span><span class="ident" id="5456774">decoder</span><span class="op" id="5456781">)</span>&nbsp;<span class="ident" id="5456783">parseIEND</span><span class="op" id="5456792">(</span><span class="ident" id="5456793">length</span>&nbsp;<span class="builtintype" id="5456800">uint32</span><span class="op" id="5456806">)</span>&nbsp;<span class="builtintype" id="5456808">error</span>&nbsp;<span class="op" id="5456814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456817">if</span>&nbsp;<span class="ident" id="5456820">length</span>&nbsp;<span class="op" id="5456827">!=</span>&nbsp;<span class="num" id="5456830">0</span>&nbsp;<span class="op" id="5456832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456836">return</span>&nbsp;<span class="ident" id="5456843">FormatError</span><span class="op" id="5456854">(</span><span class="string" id="5456855">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5456872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456878">return</span>&nbsp;<span class="ident" id="5456885">d</span><span class="op" id="5456886">.</span><span class="ident" id="5456887">verifyChecksum</span><span class="op" id="5456901">(</span><span class="op" id="5456902">)</span><br>
<span class="lineno">660</span><span class="op" id="5456904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456907">func</span>&nbsp;<span class="op" id="5456912">(</span><span class="ident" id="5456913">d</span>&nbsp;<span class="op" id="5456915">*</span><span class="ident" id="5456916">decoder</span><span class="op" id="5456923">)</span>&nbsp;<span class="ident" id="5456925">parseChunk</span><span class="op" id="5456935">(</span><span class="op" id="5456936">)</span>&nbsp;<span class="builtintype" id="5456938">error</span>&nbsp;<span class="op" id="5456944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456947">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456983">n</span><span class="op" id="5456984">,</span>&nbsp;<span class="ident" id="5456986">err</span>&nbsp;<span class="op" id="5456990">:=</span>&nbsp;<span class="ident" id="5456993">io</span><span class="op" id="5456995">.</span><span class="ident" id="5456996">ReadFull</span><span class="op" id="5457004">(</span><span class="ident" id="5457005">d</span><span class="op" id="5457006">.</span><span class="ident" id="5457007">r</span><span class="op" id="5457008">,</span>&nbsp;<span class="ident" id="5457010">d</span><span class="op" id="5457011">.</span><span class="ident" id="5457012">tmp</span><span class="op" id="5457015">[</span><span class="op" id="5457016">:</span><span class="num" id="5457017">8</span><span class="op" id="5457018">]</span><span class="op" id="5457019">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457022">if</span>&nbsp;<span class="ident" id="5457025">err</span>&nbsp;<span class="op" id="5457029">!=</span>&nbsp;<span class="ident" id="5457032">nil</span>&nbsp;<span class="op" id="5457036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457040">return</span>&nbsp;<span class="ident" id="5457047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457055">length</span>&nbsp;<span class="op" id="5457062">:=</span>&nbsp;<span class="ident" id="5457065">binary</span><span class="op" id="5457071">.</span><span class="ident" id="5457072">BigEndian</span><span class="op" id="5457081">.</span><span class="ident" id="5457082">Uint32</span><span class="op" id="5457088">(</span><span class="ident" id="5457089">d</span><span class="op" id="5457090">.</span><span class="ident" id="5457091">tmp</span><span class="op" id="5457094">[</span><span class="op" id="5457095">:</span><span class="num" id="5457096">4</span><span class="op" id="5457097">]</span><span class="op" id="5457098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457101">d</span><span class="op" id="5457102">.</span><span class="ident" id="5457103">crc</span><span class="op" id="5457106">.</span><span class="ident" id="5457107">Reset</span><span class="op" id="5457112">(</span><span class="op" id="5457113">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457116">d</span><span class="op" id="5457117">.</span><span class="ident" id="5457118">crc</span><span class="op" id="5457121">.</span><span class="ident" id="5457122">Write</span><span class="op" id="5457127">(</span><span class="ident" id="5457128">d</span><span class="op" id="5457129">.</span><span class="ident" id="5457130">tmp</span><span class="op" id="5457133">[</span><span class="num" id="5457134">4</span><span class="op" id="5457135">:</span><span class="num" id="5457136">8</span><span class="op" id="5457137">]</span><span class="op" id="5457138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457142">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457167">switch</span>&nbsp;<span class="builtintype" id="5457174">string</span><span class="op" id="5457180">(</span><span class="ident" id="5457181">d</span><span class="op" id="5457182">.</span><span class="ident" id="5457183">tmp</span><span class="op" id="5457186">[</span><span class="num" id="5457187">4</span><span class="op" id="5457188">:</span><span class="num" id="5457189">8</span><span class="op" id="5457190">]</span><span class="op" id="5457191">)</span>&nbsp;<span class="op" id="5457193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457196">case</span>&nbsp;<span class="string" id="5457201">&#34;IHDR&#34;</span><span class="op" id="5457207">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457211">if</span>&nbsp;<span class="ident" id="5457214">d</span><span class="op" id="5457215">.</span><span class="ident" id="5457216">stage</span>&nbsp;<span class="op" id="5457222">!=</span>&nbsp;<span class="ident" id="5457225">dsStart</span>&nbsp;<span class="op" id="5457233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457238">return</span>&nbsp;<span class="ident" id="5457245">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457267">d</span><span class="op" id="5457268">.</span><span class="ident" id="5457269">stage</span>&nbsp;<span class="op" id="5457275">=</span>&nbsp;<span class="ident" id="5457277">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457290">return</span>&nbsp;<span class="ident" id="5457297">d</span><span class="op" id="5457298">.</span><span class="ident" id="5457299">parseIHDR</span><span class="op" id="5457308">(</span><span class="ident" id="5457309">length</span><span class="op" id="5457315">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457318">case</span>&nbsp;<span class="string" id="5457323">&#34;PLTE&#34;</span><span class="op" id="5457329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457333">if</span>&nbsp;<span class="ident" id="5457336">d</span><span class="op" id="5457337">.</span><span class="ident" id="5457338">stage</span>&nbsp;<span class="op" id="5457344">!=</span>&nbsp;<span class="ident" id="5457347">dsSeenIHDR</span>&nbsp;<span class="op" id="5457358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457363">return</span>&nbsp;<span class="ident" id="5457370">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457392">d</span><span class="op" id="5457393">.</span><span class="ident" id="5457394">stage</span>&nbsp;<span class="op" id="5457400">=</span>&nbsp;<span class="ident" id="5457402">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457415">return</span>&nbsp;<span class="ident" id="5457422">d</span><span class="op" id="5457423">.</span><span class="ident" id="5457424">parsePLTE</span><span class="op" id="5457433">(</span><span class="ident" id="5457434">length</span><span class="op" id="5457440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457443">case</span>&nbsp;<span class="string" id="5457448">&#34;tRNS&#34;</span><span class="op" id="5457454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457458">if</span>&nbsp;<span class="ident" id="5457461">d</span><span class="op" id="5457462">.</span><span class="ident" id="5457463">stage</span>&nbsp;<span class="op" id="5457469">!=</span>&nbsp;<span class="ident" id="5457472">dsSeenPLTE</span>&nbsp;<span class="op" id="5457483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457488">return</span>&nbsp;<span class="ident" id="5457495">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457513">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457517">return</span>&nbsp;<span class="ident" id="5457524">d</span><span class="op" id="5457525">.</span><span class="ident" id="5457526">parsetRNS</span><span class="op" id="5457535">(</span><span class="ident" id="5457536">length</span><span class="op" id="5457542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457545">case</span>&nbsp;<span class="string" id="5457550">&#34;IDAT&#34;</span><span class="op" id="5457556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457560">if</span>&nbsp;<span class="ident" id="5457563">d</span><span class="op" id="5457564">.</span><span class="ident" id="5457565">stage</span>&nbsp;<span class="op" id="5457571">&lt;</span>&nbsp;<span class="ident" id="5457573">dsSeenIHDR</span>&nbsp;<span class="op" id="5457584">||</span>&nbsp;<span class="ident" id="5457587">d</span><span class="op" id="5457588">.</span><span class="ident" id="5457589">stage</span>&nbsp;<span class="op" id="5457595">&gt;</span>&nbsp;<span class="ident" id="5457597">dsSeenIDAT</span>&nbsp;<span class="op" id="5457608">||</span>&nbsp;<span class="op" id="5457611">(</span><span class="ident" id="5457612">d</span><span class="op" id="5457613">.</span><span class="ident" id="5457614">cb</span>&nbsp;<span class="op" id="5457617">==</span>&nbsp;<span class="ident" id="5457620">cbP8</span>&nbsp;<span class="op" id="5457625">&amp;&amp;</span>&nbsp;<span class="ident" id="5457628">d</span><span class="op" id="5457629">.</span><span class="ident" id="5457630">stage</span>&nbsp;<span class="op" id="5457636">==</span>&nbsp;<span class="ident" id="5457639">dsSeenIHDR</span><span class="op" id="5457649">)</span>&nbsp;<span class="op" id="5457651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457656">return</span>&nbsp;<span class="ident" id="5457663">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457681">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457685">d</span><span class="op" id="5457686">.</span><span class="ident" id="5457687">stage</span>&nbsp;<span class="op" id="5457693">=</span>&nbsp;<span class="ident" id="5457695">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457708">return</span>&nbsp;<span class="ident" id="5457715">d</span><span class="op" id="5457716">.</span><span class="ident" id="5457717">parseIDAT</span><span class="op" id="5457726">(</span><span class="ident" id="5457727">length</span><span class="op" id="5457733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457736">case</span>&nbsp;<span class="string" id="5457741">&#34;IEND&#34;</span><span class="op" id="5457747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457751">if</span>&nbsp;<span class="ident" id="5457754">d</span><span class="op" id="5457755">.</span><span class="ident" id="5457756">stage</span>&nbsp;<span class="op" id="5457762">!=</span>&nbsp;<span class="ident" id="5457765">dsSeenIDAT</span>&nbsp;<span class="op" id="5457776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457781">return</span>&nbsp;<span class="ident" id="5457788">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457810">d</span><span class="op" id="5457811">.</span><span class="ident" id="5457812">stage</span>&nbsp;<span class="op" id="5457818">=</span>&nbsp;<span class="ident" id="5457820">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457833">return</span>&nbsp;<span class="ident" id="5457840">d</span><span class="op" id="5457841">.</span><span class="ident" id="5457842">parseIEND</span><span class="op" id="5457851">(</span><span class="ident" id="5457852">length</span><span class="op" id="5457858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457864">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457907">var</span>&nbsp;<span class="ident" id="5457911">ignored</span>&nbsp;<span class="op" id="5457919">[</span><span class="num" id="5457920">4096</span><span class="op" id="5457924">]</span><span class="builtintype" id="5457925">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457931">for</span>&nbsp;<span class="ident" id="5457935">length</span>&nbsp;<span class="op" id="5457942">&gt;</span>&nbsp;<span class="num" id="5457944">0</span>&nbsp;<span class="op" id="5457946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457950">n</span><span class="op" id="5457951">,</span>&nbsp;<span class="ident" id="5457953">err</span>&nbsp;<span class="op" id="5457957">=</span>&nbsp;<span class="ident" id="5457959">io</span><span class="op" id="5457961">.</span><span class="ident" id="5457962">ReadFull</span><span class="op" id="5457970">(</span><span class="ident" id="5457971">d</span><span class="op" id="5457972">.</span><span class="ident" id="5457973">r</span><span class="op" id="5457974">,</span>&nbsp;<span class="ident" id="5457976">ignored</span><span class="op" id="5457983">[</span><span class="op" id="5457984">:</span><span class="ident" id="5457985">min</span><span class="op" id="5457988">(</span><span class="builtinfunc" id="5457989">len</span><span class="op" id="5457992">(</span><span class="ident" id="5457993">ignored</span><span class="op" id="5458000">)</span><span class="op" id="5458001">,</span>&nbsp;<span class="builtintype" id="5458003">int</span><span class="op" id="5458006">(</span><span class="ident" id="5458007">length</span><span class="op" id="5458013">)</span><span class="op" id="5458014">)</span><span class="op" id="5458015">]</span><span class="op" id="5458016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458020">if</span>&nbsp;<span class="ident" id="5458023">err</span>&nbsp;<span class="op" id="5458027">!=</span>&nbsp;<span class="ident" id="5458030">nil</span>&nbsp;<span class="op" id="5458034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458039">return</span>&nbsp;<span class="ident" id="5458046">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458056">d</span><span class="op" id="5458057">.</span><span class="ident" id="5458058">crc</span><span class="op" id="5458061">.</span><span class="ident" id="5458062">Write</span><span class="op" id="5458067">(</span><span class="ident" id="5458068">ignored</span><span class="op" id="5458075">[</span><span class="op" id="5458076">:</span><span class="ident" id="5458077">n</span><span class="op" id="5458078">]</span><span class="op" id="5458079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458083">length</span>&nbsp;<span class="op" id="5458090">-=</span>&nbsp;<span class="builtintype" id="5458093">uint32</span><span class="op" id="5458099">(</span><span class="ident" id="5458100">n</span><span class="op" id="5458101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458107">return</span>&nbsp;<span class="ident" id="5458114">d</span><span class="op" id="5458115">.</span><span class="ident" id="5458116">verifyChecksum</span><span class="op" id="5458130">(</span><span class="op" id="5458131">)</span><br>
<span class="lineno">715</span><span class="op" id="5458133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458136">func</span>&nbsp;<span class="op" id="5458141">(</span><span class="ident" id="5458142">d</span>&nbsp;<span class="op" id="5458144">*</span><span class="ident" id="5458145">decoder</span><span class="op" id="5458152">)</span>&nbsp;<span class="ident" id="5458154">verifyChecksum</span><span class="op" id="5458168">(</span><span class="op" id="5458169">)</span>&nbsp;<span class="builtintype" id="5458171">error</span>&nbsp;<span class="op" id="5458177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458180">if</span>&nbsp;<span class="ident" id="5458183">_</span><span class="op" id="5458184">,</span>&nbsp;<span class="ident" id="5458186">err</span>&nbsp;<span class="op" id="5458190">:=</span>&nbsp;<span class="ident" id="5458193">io</span><span class="op" id="5458195">.</span><span class="ident" id="5458196">ReadFull</span><span class="op" id="5458204">(</span><span class="ident" id="5458205">d</span><span class="op" id="5458206">.</span><span class="ident" id="5458207">r</span><span class="op" id="5458208">,</span>&nbsp;<span class="ident" id="5458210">d</span><span class="op" id="5458211">.</span><span class="ident" id="5458212">tmp</span><span class="op" id="5458215">[</span><span class="op" id="5458216">:</span><span class="num" id="5458217">4</span><span class="op" id="5458218">]</span><span class="op" id="5458219">)</span><span class="op" id="5458220">;</span>&nbsp;<span class="ident" id="5458222">err</span>&nbsp;<span class="op" id="5458226">!=</span>&nbsp;<span class="ident" id="5458229">nil</span>&nbsp;<span class="op" id="5458233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458237">return</span>&nbsp;<span class="ident" id="5458244">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458252">if</span>&nbsp;<span class="ident" id="5458255">binary</span><span class="op" id="5458261">.</span><span class="ident" id="5458262">BigEndian</span><span class="op" id="5458271">.</span><span class="ident" id="5458272">Uint32</span><span class="op" id="5458278">(</span><span class="ident" id="5458279">d</span><span class="op" id="5458280">.</span><span class="ident" id="5458281">tmp</span><span class="op" id="5458284">[</span><span class="op" id="5458285">:</span><span class="num" id="5458286">4</span><span class="op" id="5458287">]</span><span class="op" id="5458288">)</span>&nbsp;<span class="op" id="5458290">!=</span>&nbsp;<span class="ident" id="5458293">d</span><span class="op" id="5458294">.</span><span class="ident" id="5458295">crc</span><span class="op" id="5458298">.</span><span class="ident" id="5458299">Sum32</span><span class="op" id="5458304">(</span><span class="op" id="5458305">)</span>&nbsp;<span class="op" id="5458307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458311">return</span>&nbsp;<span class="ident" id="5458318">FormatError</span><span class="op" id="5458329">(</span><span class="string" id="5458330">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5458348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458354">return</span>&nbsp;<span class="ident" id="5458361">nil</span><br>
<span class="lineno">725</span><span class="op" id="5458365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458368">func</span>&nbsp;<span class="op" id="5458373">(</span><span class="ident" id="5458374">d</span>&nbsp;<span class="op" id="5458376">*</span><span class="ident" id="5458377">decoder</span><span class="op" id="5458384">)</span>&nbsp;<span class="ident" id="5458386">checkHeader</span><span class="op" id="5458397">(</span><span class="op" id="5458398">)</span>&nbsp;<span class="builtintype" id="5458400">error</span>&nbsp;<span class="op" id="5458406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458409">_</span><span class="op" id="5458410">,</span>&nbsp;<span class="ident" id="5458412">err</span>&nbsp;<span class="op" id="5458416">:=</span>&nbsp;<span class="ident" id="5458419">io</span><span class="op" id="5458421">.</span><span class="ident" id="5458422">ReadFull</span><span class="op" id="5458430">(</span><span class="ident" id="5458431">d</span><span class="op" id="5458432">.</span><span class="ident" id="5458433">r</span><span class="op" id="5458434">,</span>&nbsp;<span class="ident" id="5458436">d</span><span class="op" id="5458437">.</span><span class="ident" id="5458438">tmp</span><span class="op" id="5458441">[</span><span class="op" id="5458442">:</span><span class="builtinfunc" id="5458443">len</span><span class="op" id="5458446">(</span><span class="ident" id="5458447">pngHeader</span><span class="op" id="5458456">)</span><span class="op" id="5458457">]</span><span class="op" id="5458458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458461">if</span>&nbsp;<span class="ident" id="5458464">err</span>&nbsp;<span class="op" id="5458468">!=</span>&nbsp;<span class="ident" id="5458471">nil</span>&nbsp;<span class="op" id="5458475">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458479">return</span>&nbsp;<span class="ident" id="5458486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458494">if</span>&nbsp;<span class="builtintype" id="5458497">string</span><span class="op" id="5458503">(</span><span class="ident" id="5458504">d</span><span class="op" id="5458505">.</span><span class="ident" id="5458506">tmp</span><span class="op" id="5458509">[</span><span class="op" id="5458510">:</span><span class="builtinfunc" id="5458511">len</span><span class="op" id="5458514">(</span><span class="ident" id="5458515">pngHeader</span><span class="op" id="5458524">)</span><span class="op" id="5458525">]</span><span class="op" id="5458526">)</span>&nbsp;<span class="op" id="5458528">!=</span>&nbsp;<span class="ident" id="5458531">pngHeader</span>&nbsp;<span class="op" id="5458541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458545">return</span>&nbsp;<span class="ident" id="5458552">FormatError</span><span class="op" id="5458563">(</span><span class="string" id="5458564">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5458580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458583">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458586">return</span>&nbsp;<span class="ident" id="5458593">nil</span><br>
<span class="lineno"></span><span class="op" id="5458597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5458600">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5458669">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5458728">func</span>&nbsp;<span class="ident" id="5458733">Decode</span><span class="op" id="5458739">(</span><span class="ident" id="5458740">r</span>&nbsp;<span class="ident" id="5458742">io</span><span class="op" id="5458744">.</span><span class="ident" id="5458745">Reader</span><span class="op" id="5458751">)</span>&nbsp;<span class="op" id="5458753">(</span><span class="ident" id="5458754">image</span><span class="op" id="5458759">.</span><span class="ident" id="5458760">Image</span><span class="op" id="5458765">,</span>&nbsp;<span class="builtintype" id="5458767">error</span><span class="op" id="5458772">)</span>&nbsp;<span class="op" id="5458774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458777">d</span>&nbsp;<span class="op" id="5458779">:=</span>&nbsp;<span class="op" id="5458782">&amp;</span><span class="ident" id="5458783">decoder</span><span class="op" id="5458790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458794">r</span><span class="op" id="5458795">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5458799">r</span><span class="op" id="5458800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458804">crc</span><span class="op" id="5458807">:</span>&nbsp;<span class="ident" id="5458809">crc32</span><span class="op" id="5458814">.</span><span class="ident" id="5458815">NewIEEE</span><span class="op" id="5458822">(</span><span class="op" id="5458823">)</span><span class="op" id="5458824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458827">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458830">if</span>&nbsp;<span class="ident" id="5458833">err</span>&nbsp;<span class="op" id="5458837">:=</span>&nbsp;<span class="ident" id="5458840">d</span><span class="op" id="5458841">.</span><span class="ident" id="5458842">checkHeader</span><span class="op" id="5458853">(</span><span class="op" id="5458854">)</span><span class="op" id="5458855">;</span>&nbsp;<span class="ident" id="5458857">err</span>&nbsp;<span class="op" id="5458861">!=</span>&nbsp;<span class="ident" id="5458864">nil</span>&nbsp;<span class="op" id="5458868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458872">if</span>&nbsp;<span class="ident" id="5458875">err</span>&nbsp;<span class="op" id="5458879">==</span>&nbsp;<span class="ident" id="5458882">io</span><span class="op" id="5458884">.</span><span class="ident" id="5458885">EOF</span>&nbsp;<span class="op" id="5458889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458894">err</span>&nbsp;<span class="op" id="5458898">=</span>&nbsp;<span class="ident" id="5458900">io</span><span class="op" id="5458902">.</span><span class="ident" id="5458903">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458926">return</span>&nbsp;<span class="ident" id="5458933">nil</span><span class="op" id="5458936">,</span>&nbsp;<span class="ident" id="5458938">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458946">for</span>&nbsp;<span class="ident" id="5458950">d</span><span class="op" id="5458951">.</span><span class="ident" id="5458952">stage</span>&nbsp;<span class="op" id="5458958">!=</span>&nbsp;<span class="ident" id="5458961">dsSeenIEND</span>&nbsp;<span class="op" id="5458972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458976">if</span>&nbsp;<span class="ident" id="5458979">err</span>&nbsp;<span class="op" id="5458983">:=</span>&nbsp;<span class="ident" id="5458986">d</span><span class="op" id="5458987">.</span><span class="ident" id="5458988">parseChunk</span><span class="op" id="5458998">(</span><span class="op" id="5458999">)</span><span class="op" id="5459000">;</span>&nbsp;<span class="ident" id="5459002">err</span>&nbsp;<span class="op" id="5459006">!=</span>&nbsp;<span class="ident" id="5459009">nil</span>&nbsp;<span class="op" id="5459013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459018">if</span>&nbsp;<span class="ident" id="5459021">err</span>&nbsp;<span class="op" id="5459025">==</span>&nbsp;<span class="ident" id="5459028">io</span><span class="op" id="5459030">.</span><span class="ident" id="5459031">EOF</span>&nbsp;<span class="op" id="5459035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459041">err</span>&nbsp;<span class="op" id="5459045">=</span>&nbsp;<span class="ident" id="5459047">io</span><span class="op" id="5459049">.</span><span class="ident" id="5459050">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459075">return</span>&nbsp;<span class="ident" id="5459082">nil</span><span class="op" id="5459085">,</span>&nbsp;<span class="ident" id="5459087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459099">return</span>&nbsp;<span class="ident" id="5459106">d</span><span class="op" id="5459107">.</span><span class="ident" id="5459108">img</span><span class="op" id="5459111">,</span>&nbsp;<span class="ident" id="5459113">nil</span><br>
<span class="lineno">760</span><span class="op" id="5459117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5459120">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5459198">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5459228">func</span>&nbsp;<span class="ident" id="5459233">DecodeConfig</span><span class="op" id="5459245">(</span><span class="ident" id="5459246">r</span>&nbsp;<span class="ident" id="5459248">io</span><span class="op" id="5459250">.</span><span class="ident" id="5459251">Reader</span><span class="op" id="5459257">)</span>&nbsp;<span class="op" id="5459259">(</span><span class="ident" id="5459260">image</span><span class="op" id="5459265">.</span><span class="ident" id="5459266">Config</span><span class="op" id="5459272">,</span>&nbsp;<span class="builtintype" id="5459274">error</span><span class="op" id="5459279">)</span>&nbsp;<span class="op" id="5459281">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459284">d</span>&nbsp;<span class="op" id="5459286">:=</span>&nbsp;<span class="op" id="5459289">&amp;</span><span class="ident" id="5459290">decoder</span><span class="op" id="5459297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459301">r</span><span class="op" id="5459302">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5459306">r</span><span class="op" id="5459307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459311">crc</span><span class="op" id="5459314">:</span>&nbsp;<span class="ident" id="5459316">crc32</span><span class="op" id="5459321">.</span><span class="ident" id="5459322">NewIEEE</span><span class="op" id="5459329">(</span><span class="op" id="5459330">)</span><span class="op" id="5459331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459337">if</span>&nbsp;<span class="ident" id="5459340">err</span>&nbsp;<span class="op" id="5459344">:=</span>&nbsp;<span class="ident" id="5459347">d</span><span class="op" id="5459348">.</span><span class="ident" id="5459349">checkHeader</span><span class="op" id="5459360">(</span><span class="op" id="5459361">)</span><span class="op" id="5459362">;</span>&nbsp;<span class="ident" id="5459364">err</span>&nbsp;<span class="op" id="5459368">!=</span>&nbsp;<span class="ident" id="5459371">nil</span>&nbsp;<span class="op" id="5459375">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459379">if</span>&nbsp;<span class="ident" id="5459382">err</span>&nbsp;<span class="op" id="5459386">==</span>&nbsp;<span class="ident" id="5459389">io</span><span class="op" id="5459391">.</span><span class="ident" id="5459392">EOF</span>&nbsp;<span class="op" id="5459396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459401">err</span>&nbsp;<span class="op" id="5459405">=</span>&nbsp;<span class="ident" id="5459407">io</span><span class="op" id="5459409">.</span><span class="ident" id="5459410">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459433">return</span>&nbsp;<span class="ident" id="5459440">image</span><span class="op" id="5459445">.</span><span class="ident" id="5459446">Config</span><span class="op" id="5459452">{</span><span class="op" id="5459453">}</span><span class="op" id="5459454">,</span>&nbsp;<span class="ident" id="5459456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459461">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459464">for</span>&nbsp;<span class="op" id="5459468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459472">if</span>&nbsp;<span class="ident" id="5459475">err</span>&nbsp;<span class="op" id="5459479">:=</span>&nbsp;<span class="ident" id="5459482">d</span><span class="op" id="5459483">.</span><span class="ident" id="5459484">parseChunk</span><span class="op" id="5459494">(</span><span class="op" id="5459495">)</span><span class="op" id="5459496">;</span>&nbsp;<span class="ident" id="5459498">err</span>&nbsp;<span class="op" id="5459502">!=</span>&nbsp;<span class="ident" id="5459505">nil</span>&nbsp;<span class="op" id="5459509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459514">if</span>&nbsp;<span class="ident" id="5459517">err</span>&nbsp;<span class="op" id="5459521">==</span>&nbsp;<span class="ident" id="5459524">io</span><span class="op" id="5459526">.</span><span class="ident" id="5459527">EOF</span>&nbsp;<span class="op" id="5459531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459537">err</span>&nbsp;<span class="op" id="5459541">=</span>&nbsp;<span class="ident" id="5459543">io</span><span class="op" id="5459545">.</span><span class="ident" id="5459546">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459566">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459571">return</span>&nbsp;<span class="ident" id="5459578">image</span><span class="op" id="5459583">.</span><span class="ident" id="5459584">Config</span><span class="op" id="5459590">{</span><span class="op" id="5459591">}</span><span class="op" id="5459592">,</span>&nbsp;<span class="ident" id="5459594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459604">paletted</span>&nbsp;<span class="op" id="5459613">:=</span>&nbsp;<span class="ident" id="5459616">d</span><span class="op" id="5459617">.</span><span class="ident" id="5459618">cb</span>&nbsp;<span class="op" id="5459621">==</span>&nbsp;<span class="ident" id="5459624">cbP8</span>&nbsp;<span class="op" id="5459629">||</span>&nbsp;<span class="ident" id="5459632">d</span><span class="op" id="5459633">.</span><span class="ident" id="5459634">cb</span>&nbsp;<span class="op" id="5459637">==</span>&nbsp;<span class="ident" id="5459640">cbP4</span>&nbsp;<span class="op" id="5459645">||</span>&nbsp;<span class="ident" id="5459648">d</span><span class="op" id="5459649">.</span><span class="ident" id="5459650">cb</span>&nbsp;<span class="op" id="5459653">==</span>&nbsp;<span class="ident" id="5459656">cbP2</span>&nbsp;<span class="op" id="5459661">||</span>&nbsp;<span class="ident" id="5459664">d</span><span class="op" id="5459665">.</span><span class="ident" id="5459666">cb</span>&nbsp;<span class="op" id="5459669">==</span>&nbsp;<span class="ident" id="5459672">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459679">if</span>&nbsp;<span class="ident" id="5459682">d</span><span class="op" id="5459683">.</span><span class="ident" id="5459684">stage</span>&nbsp;<span class="op" id="5459690">==</span>&nbsp;<span class="ident" id="5459693">dsSeenIHDR</span>&nbsp;<span class="op" id="5459704">&amp;&amp;</span>&nbsp;<span class="op" id="5459707">!</span><span class="ident" id="5459708">paletted</span>&nbsp;<span class="op" id="5459717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459722">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459734">if</span>&nbsp;<span class="ident" id="5459737">d</span><span class="op" id="5459738">.</span><span class="ident" id="5459739">stage</span>&nbsp;<span class="op" id="5459745">==</span>&nbsp;<span class="ident" id="5459748">dsSeenPLTE</span>&nbsp;<span class="op" id="5459759">&amp;&amp;</span>&nbsp;<span class="ident" id="5459762">paletted</span>&nbsp;<span class="op" id="5459771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459776">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459787">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459790">var</span>&nbsp;<span class="ident" id="5459794">cm</span>&nbsp;<span class="ident" id="5459797">color</span><span class="op" id="5459802">.</span><span class="ident" id="5459803">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459810">switch</span>&nbsp;<span class="ident" id="5459817">d</span><span class="op" id="5459818">.</span><span class="ident" id="5459819">cb</span>&nbsp;<span class="op" id="5459822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459825">case</span>&nbsp;<span class="ident" id="5459830">cbG1</span><span class="op" id="5459834">,</span>&nbsp;<span class="ident" id="5459836">cbG2</span><span class="op" id="5459840">,</span>&nbsp;<span class="ident" id="5459842">cbG4</span><span class="op" id="5459846">,</span>&nbsp;<span class="ident" id="5459848">cbG8</span><span class="op" id="5459852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459856">cm</span>&nbsp;<span class="op" id="5459859">=</span>&nbsp;<span class="ident" id="5459861">color</span><span class="op" id="5459866">.</span><span class="ident" id="5459867">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459878">case</span>&nbsp;<span class="ident" id="5459883">cbGA8</span><span class="op" id="5459888">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459892">cm</span>&nbsp;<span class="op" id="5459895">=</span>&nbsp;<span class="ident" id="5459897">color</span><span class="op" id="5459902">.</span><span class="ident" id="5459903">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459915">case</span>&nbsp;<span class="ident" id="5459920">cbTC8</span><span class="op" id="5459925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459929">cm</span>&nbsp;<span class="op" id="5459932">=</span>&nbsp;<span class="ident" id="5459934">color</span><span class="op" id="5459939">.</span><span class="ident" id="5459940">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459951">case</span>&nbsp;<span class="ident" id="5459956">cbP1</span><span class="op" id="5459960">,</span>&nbsp;<span class="ident" id="5459962">cbP2</span><span class="op" id="5459966">,</span>&nbsp;<span class="ident" id="5459968">cbP4</span><span class="op" id="5459972">,</span>&nbsp;<span class="ident" id="5459974">cbP8</span><span class="op" id="5459978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459982">cm</span>&nbsp;<span class="op" id="5459985">=</span>&nbsp;<span class="ident" id="5459987">d</span><span class="op" id="5459988">.</span><span class="ident" id="5459989">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459998">case</span>&nbsp;<span class="ident" id="5460003">cbTCA8</span><span class="op" id="5460009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460013">cm</span>&nbsp;<span class="op" id="5460016">=</span>&nbsp;<span class="ident" id="5460018">color</span><span class="op" id="5460023">.</span><span class="ident" id="5460024">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460036">case</span>&nbsp;<span class="ident" id="5460041">cbG16</span><span class="op" id="5460046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460050">cm</span>&nbsp;<span class="op" id="5460053">=</span>&nbsp;<span class="ident" id="5460055">color</span><span class="op" id="5460060">.</span><span class="ident" id="5460061">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460074">case</span>&nbsp;<span class="ident" id="5460079">cbGA16</span><span class="op" id="5460085">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460089">cm</span>&nbsp;<span class="op" id="5460092">=</span>&nbsp;<span class="ident" id="5460094">color</span><span class="op" id="5460099">.</span><span class="ident" id="5460100">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460114">case</span>&nbsp;<span class="ident" id="5460119">cbTC16</span><span class="op" id="5460125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460129">cm</span>&nbsp;<span class="op" id="5460132">=</span>&nbsp;<span class="ident" id="5460134">color</span><span class="op" id="5460139">.</span><span class="ident" id="5460140">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460153">case</span>&nbsp;<span class="ident" id="5460158">cbTCA16</span><span class="op" id="5460165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460169">cm</span>&nbsp;<span class="op" id="5460172">=</span>&nbsp;<span class="ident" id="5460174">color</span><span class="op" id="5460179">.</span><span class="ident" id="5460180">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460197">return</span>&nbsp;<span class="ident" id="5460204">image</span><span class="op" id="5460209">.</span><span class="ident" id="5460210">Config</span><span class="op" id="5460216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460220">ColorModel</span><span class="op" id="5460230">:</span>&nbsp;<span class="ident" id="5460232">cm</span><span class="op" id="5460234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460238">Width</span><span class="op" id="5460243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460250">d</span><span class="op" id="5460251">.</span><span class="ident" id="5460252">width</span><span class="op" id="5460257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460261">Height</span><span class="op" id="5460267">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460273">d</span><span class="op" id="5460274">.</span><span class="ident" id="5460275">height</span><span class="op" id="5460281">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460284">}</span><span class="op" id="5460285">,</span>&nbsp;<span class="ident" id="5460287">nil</span><br>
<span class="lineno"></span><span class="op" id="5460291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5460294">func</span>&nbsp;<span class="ident" id="5460299">init</span><span class="op" id="5460303">(</span><span class="op" id="5460304">)</span>&nbsp;<span class="op" id="5460306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460309">image</span><span class="op" id="5460314">.</span><span class="ident" id="5460315">RegisterFormat</span><span class="op" id="5460329">(</span><span class="string" id="5460330">&#34;png&#34;</span><span class="op" id="5460335">,</span>&nbsp;<span class="ident" id="5460337">pngHeader</span><span class="op" id="5460346">,</span>&nbsp;<span class="ident" id="5460348">Decode</span><span class="op" id="5460354">,</span>&nbsp;<span class="ident" id="5460356">DecodeConfig</span><span class="op" id="5460368">)</span><br>
<span class="lineno">820</span><span class="op" id="5460370">}</span>
</div>
</body>
</html>
