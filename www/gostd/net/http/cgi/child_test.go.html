<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7914240">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7914295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7914349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7914400">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7914450">package</span>&nbsp;<span class="ident" id="7914458">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7914463">import</span>&nbsp;<span class="op" id="7914470">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914473">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7914483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7914486">func</span>&nbsp;<span class="ident" id="7914491">TestRequest</span><span class="op" id="7914502">(</span><span class="ident" id="7914503">t</span>&nbsp;<span class="op" id="7914505">*</span><span class="ident" id="7914506">testing</span><span class="op" id="7914513">.</span><span class="ident" id="7914514">T</span><span class="op" id="7914515">)</span>&nbsp;<span class="op" id="7914517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914520">env</span>&nbsp;<span class="op" id="7914524">:=</span>&nbsp;<span class="keyword" id="7914527">map</span><span class="op" id="7914530">[</span><span class="builtintype" id="7914531">string</span><span class="op" id="7914537">]</span><span class="builtintype" id="7914538">string</span><span class="op" id="7914544">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914548">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7914565">:</span>&nbsp;<span class="string" id="7914567">&#34;HTTP/1.1&#34;</span><span class="op" id="7914577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914581">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7914597">:</span>&nbsp;&nbsp;<span class="string" id="7914600">&#34;GET&#34;</span><span class="op" id="7914605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914609">&#34;HTTP_HOST&#34;</span><span class="op" id="7914620">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914628">&#34;example.com&#34;</span><span class="op" id="7914641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914645">&#34;HTTP_REFERER&#34;</span><span class="op" id="7914659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914664">&#34;elsewhere&#34;</span><span class="op" id="7914675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914679">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="7914696">:</span>&nbsp;<span class="string" id="7914698">&#34;goclient&#34;</span><span class="op" id="7914708">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914712">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="7914726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914731">&#34;baz&#34;</span><span class="op" id="7914736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914740">&#34;REQUEST_URI&#34;</span><span class="op" id="7914753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914759">&#34;/path?a=b&#34;</span><span class="op" id="7914770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914774">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7914790">:</span>&nbsp;&nbsp;<span class="string" id="7914793">&#34;123&#34;</span><span class="op" id="7914798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914802">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7914816">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914821">&#34;text/xml&#34;</span><span class="op" id="7914831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914835">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7914848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914854">&#34;5.6.7.8&#34;</span><span class="op" id="7914863">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914869">req</span><span class="op" id="7914872">,</span>&nbsp;<span class="ident" id="7914874">err</span>&nbsp;<span class="op" id="7914878">:=</span>&nbsp;<span class="ident" id="7914881">RequestFromMap</span><span class="op" id="7914895">(</span><span class="ident" id="7914896">env</span><span class="op" id="7914899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914902">if</span>&nbsp;<span class="ident" id="7914905">err</span>&nbsp;<span class="op" id="7914909">!=</span>&nbsp;<span class="builtintype" id="7914912">nil</span>&nbsp;<span class="op" id="7914916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914920">t</span><span class="op" id="7914921">.</span><span class="ident" id="7914922">Fatalf</span><span class="op" id="7914928">(</span><span class="string" id="7914929">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7914949">,</span>&nbsp;<span class="ident" id="7914951">err</span><span class="op" id="7914954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914957">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7914960">if</span>&nbsp;<span class="ident" id="7914963">g</span><span class="op" id="7914964">,</span>&nbsp;<span class="ident" id="7914966">e</span>&nbsp;<span class="op" id="7914968">:=</span>&nbsp;<span class="ident" id="7914971">req</span><span class="op" id="7914974">.</span><span class="ident" id="7914975">UserAgent</span><span class="op" id="7914984">(</span><span class="op" id="7914985">)</span><span class="op" id="7914986">,</span>&nbsp;<span class="string" id="7914988">&#34;goclient&#34;</span><span class="op" id="7914998">;</span>&nbsp;<span class="ident" id="7915000">e</span>&nbsp;<span class="op" id="7915002">!=</span>&nbsp;<span class="ident" id="7915005">g</span>&nbsp;<span class="op" id="7915007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915011">t</span><span class="op" id="7915012">.</span><span class="ident" id="7915013">Errorf</span><span class="op" id="7915019">(</span><span class="string" id="7915020">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915051">,</span>&nbsp;<span class="ident" id="7915053">e</span><span class="op" id="7915054">,</span>&nbsp;<span class="ident" id="7915056">g</span><span class="op" id="7915057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915063">if</span>&nbsp;<span class="ident" id="7915066">g</span><span class="op" id="7915067">,</span>&nbsp;<span class="ident" id="7915069">e</span>&nbsp;<span class="op" id="7915071">:=</span>&nbsp;<span class="ident" id="7915074">req</span><span class="op" id="7915077">.</span><span class="ident" id="7915078">Method</span><span class="op" id="7915084">,</span>&nbsp;<span class="string" id="7915086">&#34;GET&#34;</span><span class="op" id="7915091">;</span>&nbsp;<span class="ident" id="7915093">e</span>&nbsp;<span class="op" id="7915095">!=</span>&nbsp;<span class="ident" id="7915098">g</span>&nbsp;<span class="op" id="7915100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915104">t</span><span class="op" id="7915105">.</span><span class="ident" id="7915106">Errorf</span><span class="op" id="7915112">(</span><span class="string" id="7915113">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915141">,</span>&nbsp;<span class="ident" id="7915143">e</span><span class="op" id="7915144">,</span>&nbsp;<span class="ident" id="7915146">g</span><span class="op" id="7915147">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915153">if</span>&nbsp;<span class="ident" id="7915156">g</span><span class="op" id="7915157">,</span>&nbsp;<span class="ident" id="7915159">e</span>&nbsp;<span class="op" id="7915161">:=</span>&nbsp;<span class="ident" id="7915164">req</span><span class="op" id="7915167">.</span><span class="ident" id="7915168">Header</span><span class="op" id="7915174">.</span><span class="ident" id="7915175">Get</span><span class="op" id="7915178">(</span><span class="string" id="7915179">&#34;Content-Type&#34;</span><span class="op" id="7915193">)</span><span class="op" id="7915194">,</span>&nbsp;<span class="string" id="7915196">&#34;text/xml&#34;</span><span class="op" id="7915206">;</span>&nbsp;<span class="ident" id="7915208">e</span>&nbsp;<span class="op" id="7915210">!=</span>&nbsp;<span class="ident" id="7915213">g</span>&nbsp;<span class="op" id="7915215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915219">t</span><span class="op" id="7915220">.</span><span class="ident" id="7915221">Errorf</span><span class="op" id="7915227">(</span><span class="string" id="7915228">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915262">,</span>&nbsp;<span class="ident" id="7915264">e</span><span class="op" id="7915265">,</span>&nbsp;<span class="ident" id="7915267">g</span><span class="op" id="7915268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915274">if</span>&nbsp;<span class="ident" id="7915277">g</span><span class="op" id="7915278">,</span>&nbsp;<span class="ident" id="7915280">e</span>&nbsp;<span class="op" id="7915282">:=</span>&nbsp;<span class="ident" id="7915285">req</span><span class="op" id="7915288">.</span><span class="ident" id="7915289">ContentLength</span><span class="op" id="7915302">,</span>&nbsp;<span class="ident" id="7915304">int64</span><span class="op" id="7915309">(</span><span class="num" id="7915310">123</span><span class="op" id="7915313">)</span><span class="op" id="7915314">;</span>&nbsp;<span class="ident" id="7915316">e</span>&nbsp;<span class="op" id="7915318">!=</span>&nbsp;<span class="ident" id="7915321">g</span>&nbsp;<span class="op" id="7915323">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915327">t</span><span class="op" id="7915328">.</span><span class="ident" id="7915329">Errorf</span><span class="op" id="7915335">(</span><span class="string" id="7915336">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7915371">,</span>&nbsp;<span class="ident" id="7915373">e</span><span class="op" id="7915374">,</span>&nbsp;<span class="ident" id="7915376">g</span><span class="op" id="7915377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915383">if</span>&nbsp;<span class="ident" id="7915386">g</span><span class="op" id="7915387">,</span>&nbsp;<span class="ident" id="7915389">e</span>&nbsp;<span class="op" id="7915391">:=</span>&nbsp;<span class="ident" id="7915394">req</span><span class="op" id="7915397">.</span><span class="ident" id="7915398">Referer</span><span class="op" id="7915405">(</span><span class="op" id="7915406">)</span><span class="op" id="7915407">,</span>&nbsp;<span class="string" id="7915409">&#34;elsewhere&#34;</span><span class="op" id="7915420">;</span>&nbsp;<span class="ident" id="7915422">e</span>&nbsp;<span class="op" id="7915424">!=</span>&nbsp;<span class="ident" id="7915427">g</span>&nbsp;<span class="op" id="7915429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915433">t</span><span class="op" id="7915434">.</span><span class="ident" id="7915435">Errorf</span><span class="op" id="7915441">(</span><span class="string" id="7915442">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915471">,</span>&nbsp;<span class="ident" id="7915473">e</span><span class="op" id="7915474">,</span>&nbsp;<span class="ident" id="7915476">g</span><span class="op" id="7915477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915480">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915483">if</span>&nbsp;<span class="ident" id="7915486">req</span><span class="op" id="7915489">.</span><span class="ident" id="7915490">Header</span>&nbsp;<span class="op" id="7915497">==</span>&nbsp;<span class="builtintype" id="7915500">nil</span>&nbsp;<span class="op" id="7915504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915508">t</span><span class="op" id="7915509">.</span><span class="ident" id="7915510">Fatalf</span><span class="op" id="7915516">(</span><span class="string" id="7915517">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="7915540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915546">if</span>&nbsp;<span class="ident" id="7915549">g</span><span class="op" id="7915550">,</span>&nbsp;<span class="ident" id="7915552">e</span>&nbsp;<span class="op" id="7915554">:=</span>&nbsp;<span class="ident" id="7915557">req</span><span class="op" id="7915560">.</span><span class="ident" id="7915561">Header</span><span class="op" id="7915567">.</span><span class="ident" id="7915568">Get</span><span class="op" id="7915571">(</span><span class="string" id="7915572">&#34;Foo-Bar&#34;</span><span class="op" id="7915581">)</span><span class="op" id="7915582">,</span>&nbsp;<span class="string" id="7915584">&#34;baz&#34;</span><span class="op" id="7915589">;</span>&nbsp;<span class="ident" id="7915591">e</span>&nbsp;<span class="op" id="7915593">!=</span>&nbsp;<span class="ident" id="7915596">g</span>&nbsp;<span class="op" id="7915598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915602">t</span><span class="op" id="7915603">.</span><span class="ident" id="7915604">Errorf</span><span class="op" id="7915610">(</span><span class="string" id="7915611">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915640">,</span>&nbsp;<span class="ident" id="7915642">e</span><span class="op" id="7915643">,</span>&nbsp;<span class="ident" id="7915645">g</span><span class="op" id="7915646">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915652">if</span>&nbsp;<span class="ident" id="7915655">g</span><span class="op" id="7915656">,</span>&nbsp;<span class="ident" id="7915658">e</span>&nbsp;<span class="op" id="7915660">:=</span>&nbsp;<span class="ident" id="7915663">req</span><span class="op" id="7915666">.</span><span class="ident" id="7915667">URL</span><span class="op" id="7915670">.</span><span class="ident" id="7915671">String</span><span class="op" id="7915677">(</span><span class="op" id="7915678">)</span><span class="op" id="7915679">,</span>&nbsp;<span class="string" id="7915681">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="7915710">;</span>&nbsp;<span class="ident" id="7915712">e</span>&nbsp;<span class="op" id="7915714">!=</span>&nbsp;<span class="ident" id="7915717">g</span>&nbsp;<span class="op" id="7915719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915723">t</span><span class="op" id="7915724">.</span><span class="ident" id="7915725">Errorf</span><span class="op" id="7915731">(</span><span class="string" id="7915732">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915757">,</span>&nbsp;<span class="ident" id="7915759">e</span><span class="op" id="7915760">,</span>&nbsp;<span class="ident" id="7915762">g</span><span class="op" id="7915763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915769">if</span>&nbsp;<span class="ident" id="7915772">g</span><span class="op" id="7915773">,</span>&nbsp;<span class="ident" id="7915775">e</span>&nbsp;<span class="op" id="7915777">:=</span>&nbsp;<span class="ident" id="7915780">req</span><span class="op" id="7915783">.</span><span class="ident" id="7915784">FormValue</span><span class="op" id="7915793">(</span><span class="string" id="7915794">&#34;a&#34;</span><span class="op" id="7915797">)</span><span class="op" id="7915798">,</span>&nbsp;<span class="string" id="7915800">&#34;b&#34;</span><span class="op" id="7915803">;</span>&nbsp;<span class="ident" id="7915805">e</span>&nbsp;<span class="op" id="7915807">!=</span>&nbsp;<span class="ident" id="7915810">g</span>&nbsp;<span class="op" id="7915812">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915816">t</span><span class="op" id="7915817">.</span><span class="ident" id="7915818">Errorf</span><span class="op" id="7915824">(</span><span class="string" id="7915825">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7915859">,</span>&nbsp;<span class="ident" id="7915861">e</span><span class="op" id="7915862">,</span>&nbsp;<span class="ident" id="7915864">g</span><span class="op" id="7915865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915871">if</span>&nbsp;<span class="ident" id="7915874">req</span><span class="op" id="7915877">.</span><span class="ident" id="7915878">Trailer</span>&nbsp;<span class="op" id="7915886">==</span>&nbsp;<span class="builtintype" id="7915889">nil</span>&nbsp;<span class="op" id="7915893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915897">t</span><span class="op" id="7915898">.</span><span class="ident" id="7915899">Errorf</span><span class="op" id="7915905">(</span><span class="string" id="7915906">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="7915930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915933">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915936">if</span>&nbsp;<span class="ident" id="7915939">req</span><span class="op" id="7915942">.</span><span class="ident" id="7915943">TLS</span>&nbsp;<span class="op" id="7915947">!=</span>&nbsp;<span class="builtintype" id="7915950">nil</span>&nbsp;<span class="op" id="7915954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7915958">t</span><span class="op" id="7915959">.</span><span class="ident" id="7915960">Errorf</span><span class="op" id="7915966">(</span><span class="string" id="7915967">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="7915985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7915988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7915991">if</span>&nbsp;<span class="ident" id="7915994">e</span><span class="op" id="7915995">,</span>&nbsp;<span class="ident" id="7915997">g</span>&nbsp;<span class="op" id="7915999">:=</span>&nbsp;<span class="string" id="7916002">&#34;5.6.7.8:0&#34;</span><span class="op" id="7916013">,</span>&nbsp;<span class="ident" id="7916015">req</span><span class="op" id="7916018">.</span><span class="ident" id="7916019">RemoteAddr</span><span class="op" id="7916029">;</span>&nbsp;<span class="ident" id="7916031">e</span>&nbsp;<span class="op" id="7916033">!=</span>&nbsp;<span class="ident" id="7916036">g</span>&nbsp;<span class="op" id="7916038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916042">t</span><span class="op" id="7916043">.</span><span class="ident" id="7916044">Errorf</span><span class="op" id="7916050">(</span><span class="string" id="7916051">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7916080">,</span>&nbsp;<span class="ident" id="7916082">g</span><span class="op" id="7916083">,</span>&nbsp;<span class="ident" id="7916085">e</span><span class="op" id="7916086">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916089">}</span><br>
<span class="lineno"></span><span class="op" id="7916091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7916094">func</span>&nbsp;<span class="ident" id="7916099">TestRequestWithTLS</span><span class="op" id="7916117">(</span><span class="ident" id="7916118">t</span>&nbsp;<span class="op" id="7916120">*</span><span class="ident" id="7916121">testing</span><span class="op" id="7916128">.</span><span class="ident" id="7916129">T</span><span class="op" id="7916130">)</span>&nbsp;<span class="op" id="7916132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916135">env</span>&nbsp;<span class="op" id="7916139">:=</span>&nbsp;<span class="keyword" id="7916142">map</span><span class="op" id="7916145">[</span><span class="builtintype" id="7916146">string</span><span class="op" id="7916152">]</span><span class="builtintype" id="7916153">string</span><span class="op" id="7916159">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916163">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7916180">:</span>&nbsp;<span class="string" id="7916182">&#34;HTTP/1.1&#34;</span><span class="op" id="7916192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916196">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7916212">:</span>&nbsp;&nbsp;<span class="string" id="7916215">&#34;GET&#34;</span><span class="op" id="7916220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916224">&#34;HTTP_HOST&#34;</span><span class="op" id="7916235">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916243">&#34;example.com&#34;</span><span class="op" id="7916256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916260">&#34;HTTP_REFERER&#34;</span><span class="op" id="7916274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916279">&#34;elsewhere&#34;</span><span class="op" id="7916290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916294">&#34;REQUEST_URI&#34;</span><span class="op" id="7916307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916313">&#34;/path?a=b&#34;</span><span class="op" id="7916324">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916328">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7916342">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916347">&#34;text/xml&#34;</span><span class="op" id="7916357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916361">&#34;HTTPS&#34;</span><span class="op" id="7916368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916380">&#34;1&#34;</span><span class="op" id="7916383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916387">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7916400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916406">&#34;5.6.7.8&#34;</span><span class="op" id="7916415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916421">req</span><span class="op" id="7916424">,</span>&nbsp;<span class="ident" id="7916426">err</span>&nbsp;<span class="op" id="7916430">:=</span>&nbsp;<span class="ident" id="7916433">RequestFromMap</span><span class="op" id="7916447">(</span><span class="ident" id="7916448">env</span><span class="op" id="7916451">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916454">if</span>&nbsp;<span class="ident" id="7916457">err</span>&nbsp;<span class="op" id="7916461">!=</span>&nbsp;<span class="builtintype" id="7916464">nil</span>&nbsp;<span class="op" id="7916468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916472">t</span><span class="op" id="7916473">.</span><span class="ident" id="7916474">Fatalf</span><span class="op" id="7916480">(</span><span class="string" id="7916481">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7916501">,</span>&nbsp;<span class="ident" id="7916503">err</span><span class="op" id="7916506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916512">if</span>&nbsp;<span class="ident" id="7916515">g</span><span class="op" id="7916516">,</span>&nbsp;<span class="ident" id="7916518">e</span>&nbsp;<span class="op" id="7916520">:=</span>&nbsp;<span class="ident" id="7916523">req</span><span class="op" id="7916526">.</span><span class="ident" id="7916527">URL</span><span class="op" id="7916530">.</span><span class="ident" id="7916531">String</span><span class="op" id="7916537">(</span><span class="op" id="7916538">)</span><span class="op" id="7916539">,</span>&nbsp;<span class="string" id="7916541">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="7916571">;</span>&nbsp;<span class="ident" id="7916573">e</span>&nbsp;<span class="op" id="7916575">!=</span>&nbsp;<span class="ident" id="7916578">g</span>&nbsp;<span class="op" id="7916580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916584">t</span><span class="op" id="7916585">.</span><span class="ident" id="7916586">Errorf</span><span class="op" id="7916592">(</span><span class="string" id="7916593">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7916618">,</span>&nbsp;<span class="ident" id="7916620">e</span><span class="op" id="7916621">,</span>&nbsp;<span class="ident" id="7916623">g</span><span class="op" id="7916624">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916630">if</span>&nbsp;<span class="ident" id="7916633">req</span><span class="op" id="7916636">.</span><span class="ident" id="7916637">TLS</span>&nbsp;<span class="op" id="7916641">==</span>&nbsp;<span class="builtintype" id="7916644">nil</span>&nbsp;<span class="op" id="7916648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916652">t</span><span class="op" id="7916653">.</span><span class="ident" id="7916654">Errorf</span><span class="op" id="7916660">(</span><span class="string" id="7916661">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="7916683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916686">}</span><br>
<span class="lineno"></span><span class="op" id="7916688">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7916691">func</span>&nbsp;<span class="ident" id="7916696">TestRequestWithoutHost</span><span class="op" id="7916718">(</span><span class="ident" id="7916719">t</span>&nbsp;<span class="op" id="7916721">*</span><span class="ident" id="7916722">testing</span><span class="op" id="7916729">.</span><span class="ident" id="7916730">T</span><span class="op" id="7916731">)</span>&nbsp;<span class="op" id="7916733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916736">env</span>&nbsp;<span class="op" id="7916740">:=</span>&nbsp;<span class="keyword" id="7916743">map</span><span class="op" id="7916746">[</span><span class="builtintype" id="7916747">string</span><span class="op" id="7916753">]</span><span class="builtintype" id="7916754">string</span><span class="op" id="7916760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916764">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7916781">:</span>&nbsp;<span class="string" id="7916783">&#34;HTTP/1.1&#34;</span><span class="op" id="7916793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916797">&#34;HTTP_HOST&#34;</span><span class="op" id="7916808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916816">&#34;&#34;</span><span class="op" id="7916818">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916822">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7916838">:</span>&nbsp;&nbsp;<span class="string" id="7916841">&#34;GET&#34;</span><span class="op" id="7916846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916850">&#34;REQUEST_URI&#34;</span><span class="op" id="7916863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916869">&#34;/path?a=b&#34;</span><span class="op" id="7916880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7916884">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7916900">:</span>&nbsp;&nbsp;<span class="string" id="7916903">&#34;123&#34;</span><span class="op" id="7916908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7916911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916914">req</span><span class="op" id="7916917">,</span>&nbsp;<span class="ident" id="7916919">err</span>&nbsp;<span class="op" id="7916923">:=</span>&nbsp;<span class="ident" id="7916926">RequestFromMap</span><span class="op" id="7916940">(</span><span class="ident" id="7916941">env</span><span class="op" id="7916944">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7916947">if</span>&nbsp;<span class="ident" id="7916950">err</span>&nbsp;<span class="op" id="7916954">!=</span>&nbsp;<span class="builtintype" id="7916957">nil</span>&nbsp;<span class="op" id="7916961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7916965">t</span><span class="op" id="7916966">.</span><span class="ident" id="7916967">Fatalf</span><span class="op" id="7916973">(</span><span class="string" id="7916974">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7916994">,</span>&nbsp;<span class="ident" id="7916996">err</span><span class="op" id="7916999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917005">if</span>&nbsp;<span class="ident" id="7917008">req</span><span class="op" id="7917011">.</span><span class="ident" id="7917012">URL</span>&nbsp;<span class="op" id="7917016">==</span>&nbsp;<span class="builtintype" id="7917019">nil</span>&nbsp;<span class="op" id="7917023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917027">t</span><span class="op" id="7917028">.</span><span class="ident" id="7917029">Fatalf</span><span class="op" id="7917035">(</span><span class="string" id="7917036">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7917056">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917062">if</span>&nbsp;<span class="ident" id="7917065">g</span><span class="op" id="7917066">,</span>&nbsp;<span class="ident" id="7917068">e</span>&nbsp;<span class="op" id="7917070">:=</span>&nbsp;<span class="ident" id="7917073">req</span><span class="op" id="7917076">.</span><span class="ident" id="7917077">URL</span><span class="op" id="7917080">.</span><span class="ident" id="7917081">String</span><span class="op" id="7917087">(</span><span class="op" id="7917088">)</span><span class="op" id="7917089">,</span>&nbsp;<span class="string" id="7917091">&#34;/path?a=b&#34;</span><span class="op" id="7917102">;</span>&nbsp;<span class="ident" id="7917104">e</span>&nbsp;<span class="op" id="7917106">!=</span>&nbsp;<span class="ident" id="7917109">g</span>&nbsp;<span class="op" id="7917111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917115">t</span><span class="op" id="7917116">.</span><span class="ident" id="7917117">Errorf</span><span class="op" id="7917123">(</span><span class="string" id="7917124">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7917143">,</span>&nbsp;<span class="ident" id="7917145">g</span><span class="op" id="7917146">,</span>&nbsp;<span class="ident" id="7917148">e</span><span class="op" id="7917149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917152">}</span><br>
<span class="lineno"></span><span class="op" id="7917154">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="7917157">func</span>&nbsp;<span class="ident" id="7917162">TestRequestWithoutRequestURI</span><span class="op" id="7917190">(</span><span class="ident" id="7917191">t</span>&nbsp;<span class="op" id="7917193">*</span><span class="ident" id="7917194">testing</span><span class="op" id="7917201">.</span><span class="ident" id="7917202">T</span><span class="op" id="7917203">)</span>&nbsp;<span class="op" id="7917205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917208">env</span>&nbsp;<span class="op" id="7917212">:=</span>&nbsp;<span class="keyword" id="7917215">map</span><span class="op" id="7917218">[</span><span class="builtintype" id="7917219">string</span><span class="op" id="7917225">]</span><span class="builtintype" id="7917226">string</span><span class="op" id="7917232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917236">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7917253">:</span>&nbsp;<span class="string" id="7917255">&#34;HTTP/1.1&#34;</span><span class="op" id="7917265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917269">&#34;HTTP_HOST&#34;</span><span class="op" id="7917280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917288">&#34;example.com&#34;</span><span class="op" id="7917301">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917305">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7917321">:</span>&nbsp;&nbsp;<span class="string" id="7917324">&#34;GET&#34;</span><span class="op" id="7917329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917333">&#34;SCRIPT_NAME&#34;</span><span class="op" id="7917346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917352">&#34;/dir/scriptname&#34;</span><span class="op" id="7917369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917373">&#34;PATH_INFO&#34;</span><span class="op" id="7917384">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917392">&#34;/p1/p2&#34;</span><span class="op" id="7917400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917404">&#34;QUERY_STRING&#34;</span><span class="op" id="7917418">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917423">&#34;a=1&amp;b=2&#34;</span><span class="op" id="7917432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7917436">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7917452">:</span>&nbsp;&nbsp;<span class="string" id="7917455">&#34;123&#34;</span><span class="op" id="7917460">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917466">req</span><span class="op" id="7917469">,</span>&nbsp;<span class="ident" id="7917471">err</span>&nbsp;<span class="op" id="7917475">:=</span>&nbsp;<span class="ident" id="7917478">RequestFromMap</span><span class="op" id="7917492">(</span><span class="ident" id="7917493">env</span><span class="op" id="7917496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917499">if</span>&nbsp;<span class="ident" id="7917502">err</span>&nbsp;<span class="op" id="7917506">!=</span>&nbsp;<span class="builtintype" id="7917509">nil</span>&nbsp;<span class="op" id="7917513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917517">t</span><span class="op" id="7917518">.</span><span class="ident" id="7917519">Fatalf</span><span class="op" id="7917525">(</span><span class="string" id="7917526">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7917546">,</span>&nbsp;<span class="ident" id="7917548">err</span><span class="op" id="7917551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917554">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917557">if</span>&nbsp;<span class="ident" id="7917560">req</span><span class="op" id="7917563">.</span><span class="ident" id="7917564">URL</span>&nbsp;<span class="op" id="7917568">==</span>&nbsp;<span class="builtintype" id="7917571">nil</span>&nbsp;<span class="op" id="7917575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917579">t</span><span class="op" id="7917580">.</span><span class="ident" id="7917581">Fatalf</span><span class="op" id="7917587">(</span><span class="string" id="7917588">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7917608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7917614">if</span>&nbsp;<span class="ident" id="7917617">g</span><span class="op" id="7917618">,</span>&nbsp;<span class="ident" id="7917620">e</span>&nbsp;<span class="op" id="7917622">:=</span>&nbsp;<span class="ident" id="7917625">req</span><span class="op" id="7917628">.</span><span class="ident" id="7917629">URL</span><span class="op" id="7917632">.</span><span class="ident" id="7917633">String</span><span class="op" id="7917639">(</span><span class="op" id="7917640">)</span><span class="op" id="7917641">,</span>&nbsp;<span class="string" id="7917643">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="7917692">;</span>&nbsp;<span class="ident" id="7917694">e</span>&nbsp;<span class="op" id="7917696">!=</span>&nbsp;<span class="ident" id="7917699">g</span>&nbsp;<span class="op" id="7917701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7917705">t</span><span class="op" id="7917706">.</span><span class="ident" id="7917707">Errorf</span><span class="op" id="7917713">(</span><span class="string" id="7917714">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7917733">,</span>&nbsp;<span class="ident" id="7917735">g</span><span class="op" id="7917736">,</span>&nbsp;<span class="ident" id="7917738">e</span><span class="op" id="7917739">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7917742">}</span><br>
<span class="lineno"></span><span class="op" id="7917744">}</span>
</div>
</body>
</html>
