<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html" class="current">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5482275">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5482330">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5482384">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5482435">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes;&nbsp;specifically</span><br>
<span class="lineno"></span><span class="comment" id="5482495">//&nbsp;expressions,&nbsp;statements,&nbsp;declarations,&nbsp;and&nbsp;files.&nbsp;It&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="5482556">//&nbsp;the&nbsp;print&nbsp;functionality&nbsp;implemented&nbsp;in&nbsp;printer.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5482611">package</span>&nbsp;<span class="ident" id="5482619">printer</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5482628">import</span>&nbsp;<span class="op" id="5482635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5482638">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5482647">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5482657">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5482669">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5482684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482687">//&nbsp;Formatting&nbsp;issues:</span><br>
<span class="lineno"></span><span class="comment" id="5482709">//&nbsp;-&nbsp;better&nbsp;comment&nbsp;formatting&nbsp;for&nbsp;/*-style&nbsp;comments&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;(e.g.&nbsp;a&nbsp;declaration)</span><br>
<span class="lineno">20</span><span class="comment" id="5482804">//&nbsp;&nbsp;&nbsp;when&nbsp;the&nbsp;comment&nbsp;spans&nbsp;multiple&nbsp;lines;&nbsp;if&nbsp;such&nbsp;a&nbsp;comment&nbsp;is&nbsp;just&nbsp;two&nbsp;lines,&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5482899">//&nbsp;&nbsp;&nbsp;not&nbsp;idempotent</span><br>
<span class="lineno"></span><span class="comment" id="5482919">//&nbsp;-&nbsp;formatting&nbsp;of&nbsp;expression&nbsp;lists</span><br>
<span class="lineno"></span><span class="comment" id="5482955">//&nbsp;-&nbsp;should&nbsp;use&nbsp;blank&nbsp;instead&nbsp;of&nbsp;tab&nbsp;to&nbsp;separate&nbsp;one-line&nbsp;function&nbsp;bodies&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5483034">//&nbsp;&nbsp;&nbsp;the&nbsp;function&nbsp;header&nbsp;unless&nbsp;there&nbsp;is&nbsp;a&nbsp;group&nbsp;of&nbsp;consecutive&nbsp;one-liners</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5483110">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5483190">//&nbsp;Common&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483212">//&nbsp;Print&nbsp;as&nbsp;many&nbsp;newlines&nbsp;as&nbsp;necessary&nbsp;(but&nbsp;at&nbsp;least&nbsp;min&nbsp;newlines)&nbsp;to&nbsp;get&nbsp;to</span><br>
<span class="lineno">30</span><span class="comment" id="5483289">//&nbsp;the&nbsp;current&nbsp;line.&nbsp;ws&nbsp;is&nbsp;printed&nbsp;before&nbsp;the&nbsp;first&nbsp;line&nbsp;break.&nbsp;If&nbsp;newSection</span><br>
<span class="lineno"></span><span class="comment" id="5483367">//&nbsp;is&nbsp;set,&nbsp;the&nbsp;first&nbsp;line&nbsp;break&nbsp;is&nbsp;printed&nbsp;as&nbsp;formfeed.&nbsp;Returns&nbsp;true&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5483443">//&nbsp;line&nbsp;break&nbsp;was&nbsp;printed;&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5483495">//</span><br>
<span class="lineno"></span><span class="comment" id="5483498">//&nbsp;TODO(gri):&nbsp;linebreak&nbsp;may&nbsp;add&nbsp;too&nbsp;many&nbsp;lines&nbsp;if&nbsp;the&nbsp;next&nbsp;statement&nbsp;at&nbsp;&#34;line&#34;</span><br>
<span class="lineno">35</span><span class="comment" id="5483577">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;preceded&nbsp;by&nbsp;comments&nbsp;because&nbsp;the&nbsp;computation&nbsp;of&nbsp;n&nbsp;assumes</span><br>
<span class="lineno"></span><span class="comment" id="5483652">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;position&nbsp;before&nbsp;the&nbsp;comment&nbsp;and&nbsp;the&nbsp;target&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5483730">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;the&nbsp;comment.&nbsp;Thus,&nbsp;after&nbsp;interspersing&nbsp;such&nbsp;comments,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5483808">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;space&nbsp;taken&nbsp;up&nbsp;by&nbsp;them&nbsp;is&nbsp;not&nbsp;considered&nbsp;to&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5483887">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linebreaks.&nbsp;At&nbsp;the&nbsp;moment&nbsp;there&nbsp;is&nbsp;no&nbsp;easy&nbsp;way&nbsp;to&nbsp;know&nbsp;about</span><br>
<span class="lineno">40</span><span class="comment" id="5483962">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;(not&nbsp;yet&nbsp;interspersed)&nbsp;comments&nbsp;in&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5484033">//</span><br>
<span class="lineno"></span><span class="keyword" id="5484036">func</span>&nbsp;<span class="op" id="5484041">(</span><span class="ident" id="5484042">p</span>&nbsp;<span class="op" id="5484044">*</span><span class="ident" id="5484045">printer</span><span class="op" id="5484052">)</span>&nbsp;<span class="ident" id="5484054">linebreak</span><span class="op" id="5484063">(</span><span class="ident" id="5484064">line</span><span class="op" id="5484068">,</span>&nbsp;<span class="ident" id="5484070">min</span>&nbsp;<span class="builtintype" id="5484074">int</span><span class="op" id="5484077">,</span>&nbsp;<span class="ident" id="5484079">ws</span>&nbsp;<span class="ident" id="5484082">whiteSpace</span><span class="op" id="5484092">,</span>&nbsp;<span class="ident" id="5484094">newSection</span>&nbsp;<span class="builtintype" id="5484105">bool</span><span class="op" id="5484109">)</span>&nbsp;<span class="op" id="5484111">(</span><span class="ident" id="5484112">printedBreak</span>&nbsp;<span class="builtintype" id="5484125">bool</span><span class="op" id="5484129">)</span>&nbsp;<span class="op" id="5484131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484134">n</span>&nbsp;<span class="op" id="5484136">:=</span>&nbsp;<span class="ident" id="5484139">nlimit</span><span class="op" id="5484145">(</span><span class="ident" id="5484146">line</span>&nbsp;<span class="op" id="5484151">-</span>&nbsp;<span class="ident" id="5484153">p</span><span class="op" id="5484154">.</span><span class="ident" id="5484155">pos</span><span class="op" id="5484158">.</span><span class="ident" id="5484159">Line</span><span class="op" id="5484163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484166">if</span>&nbsp;<span class="ident" id="5484169">n</span>&nbsp;<span class="op" id="5484171">&lt;</span>&nbsp;<span class="ident" id="5484173">min</span>&nbsp;<span class="op" id="5484177">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484181">n</span>&nbsp;<span class="op" id="5484183">=</span>&nbsp;<span class="ident" id="5484185">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484193">if</span>&nbsp;<span class="ident" id="5484196">n</span>&nbsp;<span class="op" id="5484198">&gt;</span>&nbsp;<span class="num" id="5484200">0</span>&nbsp;<span class="op" id="5484202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484206">p</span><span class="op" id="5484207">.</span><span class="builtinfunc" id="5484208">print</span><span class="op" id="5484213">(</span><span class="ident" id="5484214">ws</span><span class="op" id="5484216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484220">if</span>&nbsp;<span class="ident" id="5484223">newSection</span>&nbsp;<span class="op" id="5484234">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484239">p</span><span class="op" id="5484240">.</span><span class="builtinfunc" id="5484241">print</span><span class="op" id="5484246">(</span><span class="ident" id="5484247">formfeed</span><span class="op" id="5484255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484260">n</span><span class="op" id="5484261">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484270">for</span>&nbsp;<span class="op" id="5484274">;</span>&nbsp;<span class="ident" id="5484276">n</span>&nbsp;<span class="op" id="5484278">&gt;</span>&nbsp;<span class="num" id="5484280">0</span><span class="op" id="5484281">;</span>&nbsp;<span class="ident" id="5484283">n</span><span class="op" id="5484284">--</span>&nbsp;<span class="op" id="5484287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484292">p</span><span class="op" id="5484293">.</span><span class="builtinfunc" id="5484294">print</span><span class="op" id="5484299">(</span><span class="ident" id="5484300">newline</span><span class="op" id="5484307">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484315">printedBreak</span>&nbsp;<span class="op" id="5484328">=</span>&nbsp;<span class="builtintype" id="5484330">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484339">return</span><br>
<span class="lineno"></span><span class="op" id="5484346">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5484349">//&nbsp;setComment&nbsp;sets&nbsp;g&nbsp;as&nbsp;the&nbsp;next&nbsp;comment&nbsp;if&nbsp;g&nbsp;!=&nbsp;nil&nbsp;and&nbsp;if&nbsp;node&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5484423">//&nbsp;are&nbsp;enabled&nbsp;-&nbsp;this&nbsp;mode&nbsp;is&nbsp;used&nbsp;when&nbsp;printing&nbsp;source&nbsp;code&nbsp;fragments&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5484499">//&nbsp;as&nbsp;exports&nbsp;only.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;pending&nbsp;comment&nbsp;in&nbsp;p.comments</span><br>
<span class="lineno"></span><span class="comment" id="5484577">//&nbsp;and&nbsp;at&nbsp;most&nbsp;one&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache.</span><br>
<span class="lineno">65</span><span class="keyword" id="5484636">func</span>&nbsp;<span class="op" id="5484641">(</span><span class="ident" id="5484642">p</span>&nbsp;<span class="op" id="5484644">*</span><span class="ident" id="5484645">printer</span><span class="op" id="5484652">)</span>&nbsp;<span class="ident" id="5484654">setComment</span><span class="op" id="5484664">(</span><span class="ident" id="5484665">g</span>&nbsp;<span class="op" id="5484667">*</span><span class="ident" id="5484668">ast</span><span class="op" id="5484671">.</span><span class="ident" id="5484672">CommentGroup</span><span class="op" id="5484684">)</span>&nbsp;<span class="op" id="5484686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484689">if</span>&nbsp;<span class="ident" id="5484692">g</span>&nbsp;<span class="op" id="5484694">==</span>&nbsp;<span class="builtintype" id="5484697">nil</span>&nbsp;<span class="op" id="5484701">||</span>&nbsp;<span class="op" id="5484704">!</span><span class="ident" id="5484705">p</span><span class="op" id="5484706">.</span><span class="ident" id="5484707">useNodeComments</span>&nbsp;<span class="op" id="5484723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484738">if</span>&nbsp;<span class="ident" id="5484741">p</span><span class="op" id="5484742">.</span><span class="ident" id="5484743">comments</span>&nbsp;<span class="op" id="5484752">==</span>&nbsp;<span class="builtintype" id="5484755">nil</span>&nbsp;<span class="op" id="5484759">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5484763">//&nbsp;initialize&nbsp;p.comments&nbsp;lazily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484797">p</span><span class="op" id="5484798">.</span><span class="ident" id="5484799">comments</span>&nbsp;<span class="op" id="5484808">=</span>&nbsp;<span class="builtinfunc" id="5484810">make</span><span class="op" id="5484814">(</span><span class="op" id="5484815">[</span><span class="op" id="5484816">]</span><span class="op" id="5484817">*</span><span class="ident" id="5484818">ast</span><span class="op" id="5484821">.</span><span class="ident" id="5484822">CommentGroup</span><span class="op" id="5484834">,</span>&nbsp;<span class="num" id="5484836">1</span><span class="op" id="5484837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484840">}</span>&nbsp;<span class="keyword" id="5484842">else</span>&nbsp;<span class="keyword" id="5484847">if</span>&nbsp;<span class="ident" id="5484850">p</span><span class="op" id="5484851">.</span><span class="ident" id="5484852">cindex</span>&nbsp;<span class="op" id="5484859">&lt;</span>&nbsp;<span class="builtinfunc" id="5484861">len</span><span class="op" id="5484864">(</span><span class="ident" id="5484865">p</span><span class="op" id="5484866">.</span><span class="ident" id="5484867">comments</span><span class="op" id="5484875">)</span>&nbsp;<span class="op" id="5484877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5484881">//&nbsp;for&nbsp;some&nbsp;reason&nbsp;there&nbsp;are&nbsp;pending&nbsp;comments;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5484935">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;-&nbsp;handle&nbsp;gracefully&nbsp;and&nbsp;flush</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5484990">//&nbsp;all&nbsp;comments&nbsp;up&nbsp;to&nbsp;g,&nbsp;ignore&nbsp;anything&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485044">p</span><span class="op" id="5485045">.</span><span class="ident" id="5485046">flush</span><span class="op" id="5485051">(</span><span class="ident" id="5485052">p</span><span class="op" id="5485053">.</span><span class="ident" id="5485054">posFor</span><span class="op" id="5485060">(</span><span class="ident" id="5485061">g</span><span class="op" id="5485062">.</span><span class="ident" id="5485063">List</span><span class="op" id="5485067">[</span><span class="num" id="5485068">0</span><span class="op" id="5485069">]</span><span class="op" id="5485070">.</span><span class="ident" id="5485071">Pos</span><span class="op" id="5485074">(</span><span class="op" id="5485075">)</span><span class="op" id="5485076">)</span><span class="op" id="5485077">,</span>&nbsp;<span class="ident" id="5485079">token</span><span class="op" id="5485084">.</span><span class="ident" id="5485085">ILLEGAL</span><span class="op" id="5485092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485096">p</span><span class="op" id="5485097">.</span><span class="ident" id="5485098">comments</span>&nbsp;<span class="op" id="5485107">=</span>&nbsp;<span class="ident" id="5485109">p</span><span class="op" id="5485110">.</span><span class="ident" id="5485111">comments</span><span class="op" id="5485119">[</span><span class="num" id="5485120">0</span><span class="op" id="5485121">:</span><span class="num" id="5485122">1</span><span class="op" id="5485123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485127">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;report&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485160">p</span><span class="op" id="5485161">.</span><span class="ident" id="5485162">internalError</span><span class="op" id="5485175">(</span><span class="string" id="5485176">&#34;setComment&nbsp;found&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5485211">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5485214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485217">p</span><span class="op" id="5485218">.</span><span class="ident" id="5485219">comments</span><span class="op" id="5485227">[</span><span class="num" id="5485228">0</span><span class="op" id="5485229">]</span>&nbsp;<span class="op" id="5485231">=</span>&nbsp;<span class="ident" id="5485233">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485236">p</span><span class="op" id="5485237">.</span><span class="ident" id="5485238">cindex</span>&nbsp;<span class="op" id="5485245">=</span>&nbsp;<span class="num" id="5485247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485250">//&nbsp;don&#39;t&nbsp;overwrite&nbsp;any&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485313">//&nbsp;(there&nbsp;may&nbsp;be&nbsp;a&nbsp;pending&nbsp;comment&nbsp;when&nbsp;a&nbsp;line&nbsp;comment&nbsp;is</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485372">//&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;lead&nbsp;comment&nbsp;with&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485429">//&nbsp;tokens&nbsp;between)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5485449">if</span>&nbsp;<span class="ident" id="5485452">p</span><span class="op" id="5485453">.</span><span class="ident" id="5485454">commentOffset</span>&nbsp;<span class="op" id="5485468">==</span>&nbsp;<span class="ident" id="5485471">infinity</span>&nbsp;<span class="op" id="5485480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485484">p</span><span class="op" id="5485485">.</span><span class="ident" id="5485486">nextComment</span><span class="op" id="5485497">(</span><span class="op" id="5485498">)</span>&nbsp;<span class="comment" id="5485500">//&nbsp;get&nbsp;comment&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5485530">}</span><br>
<span class="lineno">90</span><span class="op" id="5485532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5485535">type</span>&nbsp;<span class="ident" id="5485540">exprListMode</span>&nbsp;<span class="builtintype" id="5485553">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5485559">const</span>&nbsp;<span class="op" id="5485565">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485568">commaTerm</span>&nbsp;<span class="ident" id="5485578">exprListMode</span>&nbsp;<span class="op" id="5485591">=</span>&nbsp;<span class="num" id="5485593">1</span>&nbsp;<span class="op" id="5485595">&lt;&lt;</span>&nbsp;<span class="ident" id="5485598">iota</span>&nbsp;<span class="comment" id="5485603">//&nbsp;list&nbsp;is&nbsp;optionally&nbsp;terminated&nbsp;by&nbsp;a&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485648">noIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485683">//&nbsp;no&nbsp;extra&nbsp;indentation&nbsp;in&nbsp;multi-line&nbsp;lists</span><br>
<span class="lineno"></span><span class="op" id="5485727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485730">//&nbsp;If&nbsp;indent&nbsp;is&nbsp;set,&nbsp;a&nbsp;multi-line&nbsp;identifier&nbsp;list&nbsp;is&nbsp;indented&nbsp;after&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5485802">//&nbsp;first&nbsp;linebreak&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="5485834">func</span>&nbsp;<span class="op" id="5485839">(</span><span class="ident" id="5485840">p</span>&nbsp;<span class="op" id="5485842">*</span><span class="ident" id="5485843">printer</span><span class="op" id="5485850">)</span>&nbsp;<span class="ident" id="5485852">identList</span><span class="op" id="5485861">(</span><span class="ident" id="5485862">list</span>&nbsp;<span class="op" id="5485867">[</span><span class="op" id="5485868">]</span><span class="op" id="5485869">*</span><span class="ident" id="5485870">ast</span><span class="op" id="5485873">.</span><span class="ident" id="5485874">Ident</span><span class="op" id="5485879">,</span>&nbsp;<span class="ident" id="5485881">indent</span>&nbsp;<span class="builtintype" id="5485888">bool</span><span class="op" id="5485892">)</span>&nbsp;<span class="op" id="5485894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5485897">//&nbsp;convert&nbsp;into&nbsp;an&nbsp;expression&nbsp;list&nbsp;so&nbsp;we&nbsp;can&nbsp;re-use&nbsp;exprList&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485970">xlist</span>&nbsp;<span class="op" id="5485976">:=</span>&nbsp;<span class="builtinfunc" id="5485979">make</span><span class="op" id="5485983">(</span><span class="op" id="5485984">[</span><span class="op" id="5485985">]</span><span class="ident" id="5485986">ast</span><span class="op" id="5485989">.</span><span class="ident" id="5485990">Expr</span><span class="op" id="5485994">,</span>&nbsp;<span class="builtinfunc" id="5485996">len</span><span class="op" id="5485999">(</span><span class="ident" id="5486000">list</span><span class="op" id="5486004">)</span><span class="op" id="5486005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486008">for</span>&nbsp;<span class="ident" id="5486012">i</span><span class="op" id="5486013">,</span>&nbsp;<span class="ident" id="5486015">x</span>&nbsp;<span class="op" id="5486017">:=</span>&nbsp;<span class="keyword" id="5486020">range</span>&nbsp;<span class="ident" id="5486026">list</span>&nbsp;<span class="op" id="5486031">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486035">xlist</span><span class="op" id="5486040">[</span><span class="ident" id="5486041">i</span><span class="op" id="5486042">]</span>&nbsp;<span class="op" id="5486044">=</span>&nbsp;<span class="ident" id="5486046">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486052">var</span>&nbsp;<span class="ident" id="5486056">mode</span>&nbsp;<span class="ident" id="5486061">exprListMode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486075">if</span>&nbsp;<span class="op" id="5486078">!</span><span class="ident" id="5486079">indent</span>&nbsp;<span class="op" id="5486086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486090">mode</span>&nbsp;<span class="op" id="5486095">=</span>&nbsp;<span class="ident" id="5486097">noIndent</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486110">p</span><span class="op" id="5486111">.</span><span class="ident" id="5486112">exprList</span><span class="op" id="5486120">(</span><span class="ident" id="5486121">token</span><span class="op" id="5486126">.</span><span class="ident" id="5486127">NoPos</span><span class="op" id="5486132">,</span>&nbsp;<span class="ident" id="5486134">xlist</span><span class="op" id="5486139">,</span>&nbsp;<span class="num" id="5486141">1</span><span class="op" id="5486142">,</span>&nbsp;<span class="ident" id="5486144">mode</span><span class="op" id="5486148">,</span>&nbsp;<span class="ident" id="5486150">token</span><span class="op" id="5486155">.</span><span class="ident" id="5486156">NoPos</span><span class="op" id="5486161">)</span><br>
<span class="lineno"></span><span class="op" id="5486163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5486166">//&nbsp;Print&nbsp;a&nbsp;list&nbsp;of&nbsp;expressions.&nbsp;If&nbsp;the&nbsp;list&nbsp;spans&nbsp;multiple</span><br>
<span class="lineno">115</span><span class="comment" id="5486225">//&nbsp;source&nbsp;lines,&nbsp;the&nbsp;original&nbsp;line&nbsp;breaks&nbsp;are&nbsp;respected&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5486289">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5486305">//</span><br>
<span class="lineno"></span><span class="comment" id="5486308">//&nbsp;TODO(gri)&nbsp;Consider&nbsp;rewriting&nbsp;this&nbsp;to&nbsp;be&nbsp;independent&nbsp;of&nbsp;[]ast.Expr</span><br>
<span class="lineno"></span><span class="comment" id="5486377">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;algorithm&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;list</span><br>
<span class="lineno">120</span><span class="comment" id="5486444">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.,&nbsp;pass&nbsp;list&nbsp;via&nbsp;a&nbsp;channel&nbsp;over&nbsp;which&nbsp;to&nbsp;range).</span><br>
<span class="lineno"></span><span class="keyword" id="5486510">func</span>&nbsp;<span class="op" id="5486515">(</span><span class="ident" id="5486516">p</span>&nbsp;<span class="op" id="5486518">*</span><span class="ident" id="5486519">printer</span><span class="op" id="5486526">)</span>&nbsp;<span class="ident" id="5486528">exprList</span><span class="op" id="5486536">(</span><span class="ident" id="5486537">prev0</span>&nbsp;<span class="ident" id="5486543">token</span><span class="op" id="5486548">.</span><span class="ident" id="5486549">Pos</span><span class="op" id="5486552">,</span>&nbsp;<span class="ident" id="5486554">list</span>&nbsp;<span class="op" id="5486559">[</span><span class="op" id="5486560">]</span><span class="ident" id="5486561">ast</span><span class="op" id="5486564">.</span><span class="ident" id="5486565">Expr</span><span class="op" id="5486569">,</span>&nbsp;<span class="ident" id="5486571">depth</span>&nbsp;<span class="builtintype" id="5486577">int</span><span class="op" id="5486580">,</span>&nbsp;<span class="ident" id="5486582">mode</span>&nbsp;<span class="ident" id="5486587">exprListMode</span><span class="op" id="5486599">,</span>&nbsp;<span class="ident" id="5486601">next0</span>&nbsp;<span class="ident" id="5486607">token</span><span class="op" id="5486612">.</span><span class="ident" id="5486613">Pos</span><span class="op" id="5486616">)</span>&nbsp;<span class="op" id="5486618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486621">if</span>&nbsp;<span class="builtinfunc" id="5486624">len</span><span class="op" id="5486627">(</span><span class="ident" id="5486628">list</span><span class="op" id="5486632">)</span>&nbsp;<span class="op" id="5486634">==</span>&nbsp;<span class="num" id="5486637">0</span>&nbsp;<span class="op" id="5486639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486643">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486651">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486655">prev</span>&nbsp;<span class="op" id="5486660">:=</span>&nbsp;<span class="ident" id="5486663">p</span><span class="op" id="5486664">.</span><span class="ident" id="5486665">posFor</span><span class="op" id="5486671">(</span><span class="ident" id="5486672">prev0</span><span class="op" id="5486677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486680">next</span>&nbsp;<span class="op" id="5486685">:=</span>&nbsp;<span class="ident" id="5486688">p</span><span class="op" id="5486689">.</span><span class="ident" id="5486690">posFor</span><span class="op" id="5486696">(</span><span class="ident" id="5486697">next0</span><span class="op" id="5486702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486705">line</span>&nbsp;<span class="op" id="5486710">:=</span>&nbsp;<span class="ident" id="5486713">p</span><span class="op" id="5486714">.</span><span class="ident" id="5486715">lineFor</span><span class="op" id="5486722">(</span><span class="ident" id="5486723">list</span><span class="op" id="5486727">[</span><span class="num" id="5486728">0</span><span class="op" id="5486729">]</span><span class="op" id="5486730">.</span><span class="ident" id="5486731">Pos</span><span class="op" id="5486734">(</span><span class="op" id="5486735">)</span><span class="op" id="5486736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486739">endLine</span>&nbsp;<span class="op" id="5486747">:=</span>&nbsp;<span class="ident" id="5486750">p</span><span class="op" id="5486751">.</span><span class="ident" id="5486752">lineFor</span><span class="op" id="5486759">(</span><span class="ident" id="5486760">list</span><span class="op" id="5486764">[</span><span class="builtinfunc" id="5486765">len</span><span class="op" id="5486768">(</span><span class="ident" id="5486769">list</span><span class="op" id="5486773">)</span><span class="op" id="5486774">-</span><span class="num" id="5486775">1</span><span class="op" id="5486776">]</span><span class="op" id="5486777">.</span><span class="ident" id="5486778">End</span><span class="op" id="5486781">(</span><span class="op" id="5486782">)</span><span class="op" id="5486783">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486787">if</span>&nbsp;<span class="ident" id="5486790">prev</span><span class="op" id="5486794">.</span><span class="ident" id="5486795">IsValid</span><span class="op" id="5486802">(</span><span class="op" id="5486803">)</span>&nbsp;<span class="op" id="5486805">&amp;&amp;</span>&nbsp;<span class="ident" id="5486808">prev</span><span class="op" id="5486812">.</span><span class="ident" id="5486813">Line</span>&nbsp;<span class="op" id="5486818">==</span>&nbsp;<span class="ident" id="5486821">line</span>&nbsp;<span class="op" id="5486826">&amp;&amp;</span>&nbsp;<span class="ident" id="5486829">line</span>&nbsp;<span class="op" id="5486834">==</span>&nbsp;<span class="ident" id="5486837">endLine</span>&nbsp;<span class="op" id="5486845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486849">//&nbsp;all&nbsp;list&nbsp;entries&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486888">for</span>&nbsp;<span class="ident" id="5486892">i</span><span class="op" id="5486893">,</span>&nbsp;<span class="ident" id="5486895">x</span>&nbsp;<span class="op" id="5486897">:=</span>&nbsp;<span class="keyword" id="5486900">range</span>&nbsp;<span class="ident" id="5486906">list</span>&nbsp;<span class="op" id="5486911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486916">if</span>&nbsp;<span class="ident" id="5486919">i</span>&nbsp;<span class="op" id="5486921">&gt;</span>&nbsp;<span class="num" id="5486923">0</span>&nbsp;<span class="op" id="5486925">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486931">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486988">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487040">p</span><span class="op" id="5487041">.</span><span class="builtinfunc" id="5487042">print</span><span class="op" id="5487047">(</span><span class="ident" id="5487048">x</span><span class="op" id="5487049">.</span><span class="ident" id="5487050">Pos</span><span class="op" id="5487053">(</span><span class="op" id="5487054">)</span><span class="op" id="5487055">,</span>&nbsp;<span class="ident" id="5487057">token</span><span class="op" id="5487062">.</span><span class="ident" id="5487063">COMMA</span><span class="op" id="5487068">,</span>&nbsp;<span class="ident" id="5487070">blank</span><span class="op" id="5487075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487085">p</span><span class="op" id="5487086">.</span><span class="ident" id="5487087">expr0</span><span class="op" id="5487092">(</span><span class="ident" id="5487093">x</span><span class="op" id="5487094">,</span>&nbsp;<span class="ident" id="5487096">depth</span><span class="op" id="5487101">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487109">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487121">//&nbsp;list&nbsp;entries&nbsp;span&nbsp;multiple&nbsp;lines;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487159">//&nbsp;use&nbsp;source&nbsp;code&nbsp;positions&nbsp;to&nbsp;guide&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487211">//&nbsp;don&#39;t&nbsp;add&nbsp;extra&nbsp;indentation&nbsp;if&nbsp;noIndent&nbsp;is&nbsp;set;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487263">//&nbsp;i.e.,&nbsp;pretend&nbsp;that&nbsp;the&nbsp;first&nbsp;line&nbsp;is&nbsp;already&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487321">ws</span>&nbsp;<span class="op" id="5487324">:=</span>&nbsp;<span class="ident" id="5487327">ignore</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487335">if</span>&nbsp;<span class="ident" id="5487338">mode</span><span class="op" id="5487342">&amp;</span><span class="ident" id="5487343">noIndent</span>&nbsp;<span class="op" id="5487352">==</span>&nbsp;<span class="num" id="5487355">0</span>&nbsp;<span class="op" id="5487357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487361">ws</span>&nbsp;<span class="op" id="5487364">=</span>&nbsp;<span class="ident" id="5487366">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487378">//&nbsp;the&nbsp;first&nbsp;linebreak&nbsp;is&nbsp;always&nbsp;a&nbsp;formfeed&nbsp;since&nbsp;this&nbsp;section&nbsp;must&nbsp;not</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487451">//&nbsp;depend&nbsp;on&nbsp;any&nbsp;previous&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487489">prevBreak</span>&nbsp;<span class="op" id="5487499">:=</span>&nbsp;<span class="op" id="5487502">-</span><span class="num" id="5487503">1</span>&nbsp;<span class="comment" id="5487505">//&nbsp;index&nbsp;of&nbsp;last&nbsp;expression&nbsp;that&nbsp;was&nbsp;followed&nbsp;by&nbsp;a&nbsp;linebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487567">if</span>&nbsp;<span class="ident" id="5487570">prev</span><span class="op" id="5487574">.</span><span class="ident" id="5487575">IsValid</span><span class="op" id="5487582">(</span><span class="op" id="5487583">)</span>&nbsp;<span class="op" id="5487585">&amp;&amp;</span>&nbsp;<span class="ident" id="5487588">prev</span><span class="op" id="5487592">.</span><span class="ident" id="5487593">Line</span>&nbsp;<span class="op" id="5487598">&lt;</span>&nbsp;<span class="ident" id="5487600">line</span>&nbsp;<span class="op" id="5487605">&amp;&amp;</span>&nbsp;<span class="ident" id="5487608">p</span><span class="op" id="5487609">.</span><span class="ident" id="5487610">linebreak</span><span class="op" id="5487619">(</span><span class="ident" id="5487620">line</span><span class="op" id="5487624">,</span>&nbsp;<span class="num" id="5487626">0</span><span class="op" id="5487627">,</span>&nbsp;<span class="ident" id="5487629">ws</span><span class="op" id="5487631">,</span>&nbsp;<span class="builtintype" id="5487633">true</span><span class="op" id="5487637">)</span>&nbsp;<span class="op" id="5487639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487643">ws</span>&nbsp;<span class="op" id="5487646">=</span>&nbsp;<span class="ident" id="5487648">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487657">prevBreak</span>&nbsp;<span class="op" id="5487667">=</span>&nbsp;<span class="num" id="5487669">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487676">//&nbsp;initialize&nbsp;expression/key&nbsp;size:&nbsp;a&nbsp;zero&nbsp;value&nbsp;indicates&nbsp;expr/key&nbsp;doesn&#39;t&nbsp;fit&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487773">size</span>&nbsp;<span class="op" id="5487778">:=</span>&nbsp;<span class="num" id="5487781">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487785">//&nbsp;print&nbsp;all&nbsp;list&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487813">prevLine</span>&nbsp;<span class="op" id="5487822">:=</span>&nbsp;<span class="ident" id="5487825">prev</span><span class="op" id="5487829">.</span><span class="ident" id="5487830">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487836">for</span>&nbsp;<span class="ident" id="5487840">i</span><span class="op" id="5487841">,</span>&nbsp;<span class="ident" id="5487843">x</span>&nbsp;<span class="op" id="5487845">:=</span>&nbsp;<span class="keyword" id="5487848">range</span>&nbsp;<span class="ident" id="5487854">list</span>&nbsp;<span class="op" id="5487859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487863">line</span>&nbsp;<span class="op" id="5487868">=</span>&nbsp;<span class="ident" id="5487870">p</span><span class="op" id="5487871">.</span><span class="ident" id="5487872">lineFor</span><span class="op" id="5487879">(</span><span class="ident" id="5487880">x</span><span class="op" id="5487881">.</span><span class="ident" id="5487882">Pos</span><span class="op" id="5487885">(</span><span class="op" id="5487886">)</span><span class="op" id="5487887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487892">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;next&nbsp;linebreak,&nbsp;if&nbsp;any,&nbsp;needs&nbsp;to&nbsp;use&nbsp;formfeed:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487961">//&nbsp;in&nbsp;general,&nbsp;use&nbsp;the&nbsp;entire&nbsp;node&nbsp;size&nbsp;to&nbsp;make&nbsp;the&nbsp;decision;&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488029">//&nbsp;key:value&nbsp;expressions,&nbsp;use&nbsp;the&nbsp;key&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488074">//&nbsp;TODO(gri)&nbsp;for&nbsp;a&nbsp;better&nbsp;result,&nbsp;should&nbsp;probably&nbsp;incorporate&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488143">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;key&nbsp;and&nbsp;the&nbsp;node&nbsp;size&nbsp;into&nbsp;the&nbsp;decision&nbsp;process</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488210">useFF</span>&nbsp;<span class="op" id="5488216">:=</span>&nbsp;<span class="builtintype" id="5488219">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488227">//&nbsp;determine&nbsp;element&nbsp;size:&nbsp;all&nbsp;bets&nbsp;are&nbsp;off&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488290">//&nbsp;position&nbsp;information&nbsp;for&nbsp;the&nbsp;previous&nbsp;and&nbsp;next&nbsp;token&nbsp;(likely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488356">//&nbsp;generated&nbsp;code&nbsp;-&nbsp;simply&nbsp;ignore&nbsp;the&nbsp;size&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;setting</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488425">//&nbsp;it&nbsp;to&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488439">prevSize</span>&nbsp;<span class="op" id="5488448">:=</span>&nbsp;<span class="ident" id="5488451">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488458">const</span>&nbsp;<span class="ident" id="5488464">infinity</span>&nbsp;<span class="op" id="5488473">=</span>&nbsp;<span class="num" id="5488475">1e6</span>&nbsp;<span class="comment" id="5488479">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;source&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488512">size</span>&nbsp;<span class="op" id="5488517">=</span>&nbsp;<span class="ident" id="5488519">p</span><span class="op" id="5488520">.</span><span class="ident" id="5488521">nodeSize</span><span class="op" id="5488529">(</span><span class="ident" id="5488530">x</span><span class="op" id="5488531">,</span>&nbsp;<span class="ident" id="5488533">infinity</span><span class="op" id="5488541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488545">pair</span><span class="op" id="5488549">,</span>&nbsp;<span class="ident" id="5488551">isPair</span>&nbsp;<span class="op" id="5488558">:=</span>&nbsp;<span class="ident" id="5488561">x</span><span class="op" id="5488562">.</span><span class="op" id="5488563">(</span><span class="op" id="5488564">*</span><span class="ident" id="5488565">ast</span><span class="op" id="5488568">.</span><span class="ident" id="5488569">KeyValueExpr</span><span class="op" id="5488581">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488585">if</span>&nbsp;<span class="ident" id="5488588">size</span>&nbsp;<span class="op" id="5488593">&lt;=</span>&nbsp;<span class="ident" id="5488596">infinity</span>&nbsp;<span class="op" id="5488605">&amp;&amp;</span>&nbsp;<span class="ident" id="5488608">prev</span><span class="op" id="5488612">.</span><span class="ident" id="5488613">IsValid</span><span class="op" id="5488620">(</span><span class="op" id="5488621">)</span>&nbsp;<span class="op" id="5488623">&amp;&amp;</span>&nbsp;<span class="ident" id="5488626">next</span><span class="op" id="5488630">.</span><span class="ident" id="5488631">IsValid</span><span class="op" id="5488638">(</span><span class="op" id="5488639">)</span>&nbsp;<span class="op" id="5488641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488646">//&nbsp;x&nbsp;fits&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488676">if</span>&nbsp;<span class="ident" id="5488679">isPair</span>&nbsp;<span class="op" id="5488686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488692">size</span>&nbsp;<span class="op" id="5488697">=</span>&nbsp;<span class="ident" id="5488699">p</span><span class="op" id="5488700">.</span><span class="ident" id="5488701">nodeSize</span><span class="op" id="5488709">(</span><span class="ident" id="5488710">pair</span><span class="op" id="5488714">.</span><span class="ident" id="5488715">Key</span><span class="op" id="5488718">,</span>&nbsp;<span class="ident" id="5488720">infinity</span><span class="op" id="5488728">)</span>&nbsp;<span class="comment" id="5488730">//&nbsp;size&nbsp;&lt;=&nbsp;infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488753">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488757">}</span>&nbsp;<span class="keyword" id="5488759">else</span>&nbsp;<span class="op" id="5488764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488769">//&nbsp;size&nbsp;too&nbsp;large&nbsp;or&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;good&nbsp;layout&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488831">size</span>&nbsp;<span class="op" id="5488836">=</span>&nbsp;<span class="num" id="5488838">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488847">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;line&nbsp;and&nbsp;the&nbsp;current&nbsp;line&nbsp;had&nbsp;single-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488906">//&nbsp;line-expressions&nbsp;and&nbsp;the&nbsp;key&nbsp;sizes&nbsp;are&nbsp;small&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5488963">//&nbsp;the&nbsp;ratio&nbsp;between&nbsp;the&nbsp;key&nbsp;sizes&nbsp;does&nbsp;not&nbsp;exceed&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489018">//&nbsp;threshold,&nbsp;align&nbsp;columns&nbsp;and&nbsp;do&nbsp;not&nbsp;use&nbsp;formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489072">if</span>&nbsp;<span class="ident" id="5489075">prevSize</span>&nbsp;<span class="op" id="5489084">&gt;</span>&nbsp;<span class="num" id="5489086">0</span>&nbsp;<span class="op" id="5489088">&amp;&amp;</span>&nbsp;<span class="ident" id="5489091">size</span>&nbsp;<span class="op" id="5489096">&gt;</span>&nbsp;<span class="num" id="5489098">0</span>&nbsp;<span class="op" id="5489100">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489105">const</span>&nbsp;<span class="ident" id="5489111">smallSize</span>&nbsp;<span class="op" id="5489121">=</span>&nbsp;<span class="num" id="5489123">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489129">if</span>&nbsp;<span class="ident" id="5489132">prevSize</span>&nbsp;<span class="op" id="5489141">&lt;=</span>&nbsp;<span class="ident" id="5489144">smallSize</span>&nbsp;<span class="op" id="5489154">&amp;&amp;</span>&nbsp;<span class="ident" id="5489157">size</span>&nbsp;<span class="op" id="5489162">&lt;=</span>&nbsp;<span class="ident" id="5489165">smallSize</span>&nbsp;<span class="op" id="5489175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489181">useFF</span>&nbsp;<span class="op" id="5489187">=</span>&nbsp;<span class="builtintype" id="5489189">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489198">}</span>&nbsp;<span class="keyword" id="5489200">else</span>&nbsp;<span class="op" id="5489205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489211">const</span>&nbsp;<span class="ident" id="5489217">r</span>&nbsp;<span class="op" id="5489219">=</span>&nbsp;<span class="num" id="5489221">4</span>&nbsp;<span class="comment" id="5489223">//&nbsp;threshold</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489240">ratio</span>&nbsp;<span class="op" id="5489246">:=</span>&nbsp;<span class="builtintype" id="5489249">float64</span><span class="op" id="5489256">(</span><span class="ident" id="5489257">size</span><span class="op" id="5489261">)</span>&nbsp;<span class="op" id="5489263">/</span>&nbsp;<span class="builtintype" id="5489265">float64</span><span class="op" id="5489272">(</span><span class="ident" id="5489273">prevSize</span><span class="op" id="5489281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489287">useFF</span>&nbsp;<span class="op" id="5489293">=</span>&nbsp;<span class="ident" id="5489295">ratio</span>&nbsp;<span class="op" id="5489301">&lt;=</span>&nbsp;<span class="num" id="5489304">1.0</span><span class="op" id="5489307">/</span><span class="ident" id="5489308">r</span>&nbsp;<span class="op" id="5489310">||</span>&nbsp;<span class="ident" id="5489313">r</span>&nbsp;<span class="op" id="5489315">&lt;=</span>&nbsp;<span class="ident" id="5489318">ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489336">needsLinebreak</span>&nbsp;<span class="op" id="5489351">:=</span>&nbsp;<span class="num" id="5489354">0</span>&nbsp;<span class="op" id="5489356">&lt;</span>&nbsp;<span class="ident" id="5489358">prevLine</span>&nbsp;<span class="op" id="5489367">&amp;&amp;</span>&nbsp;<span class="ident" id="5489370">prevLine</span>&nbsp;<span class="op" id="5489379">&lt;</span>&nbsp;<span class="ident" id="5489381">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489388">if</span>&nbsp;<span class="ident" id="5489391">i</span>&nbsp;<span class="op" id="5489393">&gt;</span>&nbsp;<span class="num" id="5489395">0</span>&nbsp;<span class="op" id="5489397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489402">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489458">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489514">//&nbsp;only&nbsp;if&nbsp;the&nbsp;expression&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489563">if</span>&nbsp;<span class="op" id="5489566">!</span><span class="ident" id="5489567">needsLinebreak</span>&nbsp;<span class="op" id="5489582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489588">p</span><span class="op" id="5489589">.</span><span class="builtinfunc" id="5489590">print</span><span class="op" id="5489595">(</span><span class="ident" id="5489596">x</span><span class="op" id="5489597">.</span><span class="ident" id="5489598">Pos</span><span class="op" id="5489601">(</span><span class="op" id="5489602">)</span><span class="op" id="5489603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489613">p</span><span class="op" id="5489614">.</span><span class="builtinfunc" id="5489615">print</span><span class="op" id="5489620">(</span><span class="ident" id="5489621">token</span><span class="op" id="5489626">.</span><span class="ident" id="5489627">COMMA</span><span class="op" id="5489632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489637">needsBlank</span>&nbsp;<span class="op" id="5489648">:=</span>&nbsp;<span class="builtintype" id="5489651">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489659">if</span>&nbsp;<span class="ident" id="5489662">needsLinebreak</span>&nbsp;<span class="op" id="5489677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489683">//&nbsp;lines&nbsp;are&nbsp;broken&nbsp;using&nbsp;newlines&nbsp;so&nbsp;comments&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489749">//&nbsp;unless&nbsp;forceFF&nbsp;is&nbsp;set&nbsp;or&nbsp;there&nbsp;are&nbsp;multiple&nbsp;expressions&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5489815">//&nbsp;the&nbsp;same&nbsp;line&nbsp;in&nbsp;which&nbsp;case&nbsp;formfeed&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489867">if</span>&nbsp;<span class="ident" id="5489870">p</span><span class="op" id="5489871">.</span><span class="ident" id="5489872">linebreak</span><span class="op" id="5489881">(</span><span class="ident" id="5489882">line</span><span class="op" id="5489886">,</span>&nbsp;<span class="num" id="5489888">0</span><span class="op" id="5489889">,</span>&nbsp;<span class="ident" id="5489891">ws</span><span class="op" id="5489893">,</span>&nbsp;<span class="ident" id="5489895">useFF</span>&nbsp;<span class="op" id="5489901">||</span>&nbsp;<span class="ident" id="5489904">prevBreak</span><span class="op" id="5489913">+</span><span class="num" id="5489914">1</span>&nbsp;<span class="op" id="5489916">&lt;</span>&nbsp;<span class="ident" id="5489918">i</span><span class="op" id="5489919">)</span>&nbsp;<span class="op" id="5489921">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489928">ws</span>&nbsp;<span class="op" id="5489931">=</span>&nbsp;<span class="ident" id="5489933">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489945">prevBreak</span>&nbsp;<span class="op" id="5489955">=</span>&nbsp;<span class="ident" id="5489957">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489964">needsBlank</span>&nbsp;<span class="op" id="5489975">=</span>&nbsp;<span class="builtintype" id="5489977">false</span>&nbsp;<span class="comment" id="5489983">//&nbsp;we&nbsp;got&nbsp;a&nbsp;line&nbsp;break&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490023">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490028">if</span>&nbsp;<span class="ident" id="5490031">needsBlank</span>&nbsp;<span class="op" id="5490042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490048">p</span><span class="op" id="5490049">.</span><span class="builtinfunc" id="5490050">print</span><span class="op" id="5490055">(</span><span class="ident" id="5490056">blank</span><span class="op" id="5490061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490075">if</span>&nbsp;<span class="builtinfunc" id="5490078">len</span><span class="op" id="5490081">(</span><span class="ident" id="5490082">list</span><span class="op" id="5490086">)</span>&nbsp;<span class="op" id="5490088">&gt;</span>&nbsp;<span class="num" id="5490090">1</span>&nbsp;<span class="op" id="5490092">&amp;&amp;</span>&nbsp;<span class="ident" id="5490095">isPair</span>&nbsp;<span class="op" id="5490102">&amp;&amp;</span>&nbsp;<span class="ident" id="5490105">size</span>&nbsp;<span class="op" id="5490110">&gt;</span>&nbsp;<span class="num" id="5490112">0</span>&nbsp;<span class="op" id="5490114">&amp;&amp;</span>&nbsp;<span class="ident" id="5490117">needsLinebreak</span>&nbsp;<span class="op" id="5490132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490137">//&nbsp;we&nbsp;have&nbsp;a&nbsp;key:value&nbsp;expression&nbsp;that&nbsp;fits&nbsp;onto&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490198">//&nbsp;and&nbsp;it&#39;s&nbsp;not&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;prior&nbsp;expression:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490259">//&nbsp;use&nbsp;a&nbsp;column&nbsp;for&nbsp;the&nbsp;key&nbsp;such&nbsp;that&nbsp;consecutive&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490320">//&nbsp;can&nbsp;align&nbsp;if&nbsp;possible</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490348">//&nbsp;(needsLinebreak&nbsp;is&nbsp;set&nbsp;if&nbsp;we&nbsp;started&nbsp;a&nbsp;new&nbsp;line&nbsp;before)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490410">p</span><span class="op" id="5490411">.</span><span class="ident" id="5490412">expr</span><span class="op" id="5490416">(</span><span class="ident" id="5490417">pair</span><span class="op" id="5490421">.</span><span class="ident" id="5490422">Key</span><span class="op" id="5490425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490430">p</span><span class="op" id="5490431">.</span><span class="builtinfunc" id="5490432">print</span><span class="op" id="5490437">(</span><span class="ident" id="5490438">pair</span><span class="op" id="5490442">.</span><span class="ident" id="5490443">Colon</span><span class="op" id="5490448">,</span>&nbsp;<span class="ident" id="5490450">token</span><span class="op" id="5490455">.</span><span class="ident" id="5490456">COLON</span><span class="op" id="5490461">,</span>&nbsp;<span class="ident" id="5490463">vtab</span><span class="op" id="5490467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490472">p</span><span class="op" id="5490473">.</span><span class="ident" id="5490474">expr</span><span class="op" id="5490478">(</span><span class="ident" id="5490479">pair</span><span class="op" id="5490483">.</span><span class="ident" id="5490484">Value</span><span class="op" id="5490489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490493">}</span>&nbsp;<span class="keyword" id="5490495">else</span>&nbsp;<span class="op" id="5490500">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490505">p</span><span class="op" id="5490506">.</span><span class="ident" id="5490507">expr0</span><span class="op" id="5490512">(</span><span class="ident" id="5490513">x</span><span class="op" id="5490514">,</span>&nbsp;<span class="ident" id="5490516">depth</span><span class="op" id="5490521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490530">prevLine</span>&nbsp;<span class="op" id="5490539">=</span>&nbsp;<span class="ident" id="5490541">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490547">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490551">if</span>&nbsp;<span class="ident" id="5490554">mode</span><span class="op" id="5490558">&amp;</span><span class="ident" id="5490559">commaTerm</span>&nbsp;<span class="op" id="5490569">!=</span>&nbsp;<span class="num" id="5490572">0</span>&nbsp;<span class="op" id="5490574">&amp;&amp;</span>&nbsp;<span class="ident" id="5490577">next</span><span class="op" id="5490581">.</span><span class="ident" id="5490582">IsValid</span><span class="op" id="5490589">(</span><span class="op" id="5490590">)</span>&nbsp;<span class="op" id="5490592">&amp;&amp;</span>&nbsp;<span class="ident" id="5490595">p</span><span class="op" id="5490596">.</span><span class="ident" id="5490597">pos</span><span class="op" id="5490600">.</span><span class="ident" id="5490601">Line</span>&nbsp;<span class="op" id="5490606">&lt;</span>&nbsp;<span class="ident" id="5490608">next</span><span class="op" id="5490612">.</span><span class="ident" id="5490613">Line</span>&nbsp;<span class="op" id="5490618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490622">//&nbsp;print&nbsp;a&nbsp;terminating&nbsp;comma&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490688">p</span><span class="op" id="5490689">.</span><span class="builtinfunc" id="5490690">print</span><span class="op" id="5490695">(</span><span class="ident" id="5490696">token</span><span class="op" id="5490701">.</span><span class="ident" id="5490702">COMMA</span><span class="op" id="5490707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490711">if</span>&nbsp;<span class="ident" id="5490714">ws</span>&nbsp;<span class="op" id="5490717">==</span>&nbsp;<span class="ident" id="5490720">ignore</span>&nbsp;<span class="op" id="5490727">&amp;&amp;</span>&nbsp;<span class="ident" id="5490730">mode</span><span class="op" id="5490734">&amp;</span><span class="ident" id="5490735">noIndent</span>&nbsp;<span class="op" id="5490744">==</span>&nbsp;<span class="num" id="5490747">0</span>&nbsp;<span class="op" id="5490749">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490754">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490784">p</span><span class="op" id="5490785">.</span><span class="builtinfunc" id="5490786">print</span><span class="op" id="5490791">(</span><span class="ident" id="5490792">unindent</span><span class="op" id="5490800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490808">p</span><span class="op" id="5490809">.</span><span class="builtinfunc" id="5490810">print</span><span class="op" id="5490815">(</span><span class="ident" id="5490816">formfeed</span><span class="op" id="5490824">)</span>&nbsp;<span class="comment" id="5490826">//&nbsp;terminating&nbsp;comma&nbsp;needs&nbsp;a&nbsp;line&nbsp;break&nbsp;to&nbsp;look&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490881">return</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490893">if</span>&nbsp;<span class="ident" id="5490896">ws</span>&nbsp;<span class="op" id="5490899">==</span>&nbsp;<span class="ident" id="5490902">ignore</span>&nbsp;<span class="op" id="5490909">&amp;&amp;</span>&nbsp;<span class="ident" id="5490912">mode</span><span class="op" id="5490916">&amp;</span><span class="ident" id="5490917">noIndent</span>&nbsp;<span class="op" id="5490926">==</span>&nbsp;<span class="num" id="5490929">0</span>&nbsp;<span class="op" id="5490931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490935">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490964">p</span><span class="op" id="5490965">.</span><span class="builtinfunc" id="5490966">print</span><span class="op" id="5490971">(</span><span class="ident" id="5490972">unindent</span><span class="op" id="5490980">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490983">}</span><br>
<span class="lineno"></span><span class="op" id="5490985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5490988">func</span>&nbsp;<span class="op" id="5490993">(</span><span class="ident" id="5490994">p</span>&nbsp;<span class="op" id="5490996">*</span><span class="ident" id="5490997">printer</span><span class="op" id="5491004">)</span>&nbsp;<span class="ident" id="5491006">parameters</span><span class="op" id="5491016">(</span><span class="ident" id="5491017">fields</span>&nbsp;<span class="op" id="5491024">*</span><span class="ident" id="5491025">ast</span><span class="op" id="5491028">.</span><span class="ident" id="5491029">FieldList</span><span class="op" id="5491038">)</span>&nbsp;<span class="op" id="5491040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491043">p</span><span class="op" id="5491044">.</span><span class="builtinfunc" id="5491045">print</span><span class="op" id="5491050">(</span><span class="ident" id="5491051">fields</span><span class="op" id="5491057">.</span><span class="ident" id="5491058">Opening</span><span class="op" id="5491065">,</span>&nbsp;<span class="ident" id="5491067">token</span><span class="op" id="5491072">.</span><span class="ident" id="5491073">LPAREN</span><span class="op" id="5491079">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491082">if</span>&nbsp;<span class="builtinfunc" id="5491085">len</span><span class="op" id="5491088">(</span><span class="ident" id="5491089">fields</span><span class="op" id="5491095">.</span><span class="ident" id="5491096">List</span><span class="op" id="5491100">)</span>&nbsp;<span class="op" id="5491102">&gt;</span>&nbsp;<span class="num" id="5491104">0</span>&nbsp;<span class="op" id="5491106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491110">prevLine</span>&nbsp;<span class="op" id="5491119">:=</span>&nbsp;<span class="ident" id="5491122">p</span><span class="op" id="5491123">.</span><span class="ident" id="5491124">lineFor</span><span class="op" id="5491131">(</span><span class="ident" id="5491132">fields</span><span class="op" id="5491138">.</span><span class="ident" id="5491139">Opening</span><span class="op" id="5491146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491150">ws</span>&nbsp;<span class="op" id="5491153">:=</span>&nbsp;<span class="ident" id="5491156">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491165">for</span>&nbsp;<span class="ident" id="5491169">i</span><span class="op" id="5491170">,</span>&nbsp;<span class="ident" id="5491172">par</span>&nbsp;<span class="op" id="5491176">:=</span>&nbsp;<span class="keyword" id="5491179">range</span>&nbsp;<span class="ident" id="5491185">fields</span><span class="op" id="5491191">.</span><span class="ident" id="5491192">List</span>&nbsp;<span class="op" id="5491197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491202">//&nbsp;determine&nbsp;par&nbsp;begin&nbsp;and&nbsp;end&nbsp;line&nbsp;(may&nbsp;be&nbsp;different</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491259">//&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;parameter&nbsp;names&nbsp;for&nbsp;this&nbsp;par</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491316">//&nbsp;or&nbsp;the&nbsp;type&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491357">var</span>&nbsp;<span class="ident" id="5491361">parLineBeg</span>&nbsp;<span class="builtintype" id="5491372">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491379">if</span>&nbsp;<span class="builtinfunc" id="5491382">len</span><span class="op" id="5491385">(</span><span class="ident" id="5491386">par</span><span class="op" id="5491389">.</span><span class="ident" id="5491390">Names</span><span class="op" id="5491395">)</span>&nbsp;<span class="op" id="5491397">&gt;</span>&nbsp;<span class="num" id="5491399">0</span>&nbsp;<span class="op" id="5491401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491407">parLineBeg</span>&nbsp;<span class="op" id="5491418">=</span>&nbsp;<span class="ident" id="5491420">p</span><span class="op" id="5491421">.</span><span class="ident" id="5491422">lineFor</span><span class="op" id="5491429">(</span><span class="ident" id="5491430">par</span><span class="op" id="5491433">.</span><span class="ident" id="5491434">Names</span><span class="op" id="5491439">[</span><span class="num" id="5491440">0</span><span class="op" id="5491441">]</span><span class="op" id="5491442">.</span><span class="ident" id="5491443">Pos</span><span class="op" id="5491446">(</span><span class="op" id="5491447">)</span><span class="op" id="5491448">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491453">}</span>&nbsp;<span class="keyword" id="5491455">else</span>&nbsp;<span class="op" id="5491460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491466">parLineBeg</span>&nbsp;<span class="op" id="5491477">=</span>&nbsp;<span class="ident" id="5491479">p</span><span class="op" id="5491480">.</span><span class="ident" id="5491481">lineFor</span><span class="op" id="5491488">(</span><span class="ident" id="5491489">par</span><span class="op" id="5491492">.</span><span class="ident" id="5491493">Type</span><span class="op" id="5491497">.</span><span class="ident" id="5491498">Pos</span><span class="op" id="5491501">(</span><span class="op" id="5491502">)</span><span class="op" id="5491503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491513">var</span>&nbsp;<span class="ident" id="5491517">parLineEnd</span>&nbsp;<span class="op" id="5491528">=</span>&nbsp;<span class="ident" id="5491530">p</span><span class="op" id="5491531">.</span><span class="ident" id="5491532">lineFor</span><span class="op" id="5491539">(</span><span class="ident" id="5491540">par</span><span class="op" id="5491543">.</span><span class="ident" id="5491544">Type</span><span class="op" id="5491548">.</span><span class="ident" id="5491549">End</span><span class="op" id="5491552">(</span><span class="op" id="5491553">)</span><span class="op" id="5491554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491559">//&nbsp;separating&nbsp;&#34;,&#34;&nbsp;if&nbsp;needed</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491590">needsLinebreak</span>&nbsp;<span class="op" id="5491605">:=</span>&nbsp;<span class="num" id="5491608">0</span>&nbsp;<span class="op" id="5491610">&lt;</span>&nbsp;<span class="ident" id="5491612">prevLine</span>&nbsp;<span class="op" id="5491621">&amp;&amp;</span>&nbsp;<span class="ident" id="5491624">prevLine</span>&nbsp;<span class="op" id="5491633">&lt;</span>&nbsp;<span class="ident" id="5491635">parLineBeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491649">if</span>&nbsp;<span class="ident" id="5491652">i</span>&nbsp;<span class="op" id="5491654">&gt;</span>&nbsp;<span class="num" id="5491656">0</span>&nbsp;<span class="op" id="5491658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491664">//&nbsp;use&nbsp;position&nbsp;of&nbsp;parameter&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491720">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comma&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491775">//&nbsp;only&nbsp;if&nbsp;the&nbsp;next&nbsp;parameter&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491829">if</span>&nbsp;<span class="op" id="5491832">!</span><span class="ident" id="5491833">needsLinebreak</span>&nbsp;<span class="op" id="5491848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491855">p</span><span class="op" id="5491856">.</span><span class="builtinfunc" id="5491857">print</span><span class="op" id="5491862">(</span><span class="ident" id="5491863">par</span><span class="op" id="5491866">.</span><span class="ident" id="5491867">Pos</span><span class="op" id="5491870">(</span><span class="op" id="5491871">)</span><span class="op" id="5491872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491884">p</span><span class="op" id="5491885">.</span><span class="builtinfunc" id="5491886">print</span><span class="op" id="5491891">(</span><span class="ident" id="5491892">token</span><span class="op" id="5491897">.</span><span class="ident" id="5491898">COMMA</span><span class="op" id="5491903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491908">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5491913">//&nbsp;separator&nbsp;if&nbsp;needed&nbsp;(linebreak&nbsp;or&nbsp;blank)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491960">if</span>&nbsp;<span class="ident" id="5491963">needsLinebreak</span>&nbsp;<span class="op" id="5491978">&amp;&amp;</span>&nbsp;<span class="ident" id="5491981">p</span><span class="op" id="5491982">.</span><span class="ident" id="5491983">linebreak</span><span class="op" id="5491992">(</span><span class="ident" id="5491993">parLineBeg</span><span class="op" id="5492003">,</span>&nbsp;<span class="num" id="5492005">0</span><span class="op" id="5492006">,</span>&nbsp;<span class="ident" id="5492008">ws</span><span class="op" id="5492010">,</span>&nbsp;<span class="builtintype" id="5492012">true</span><span class="op" id="5492016">)</span>&nbsp;<span class="op" id="5492018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492024">//&nbsp;break&nbsp;line&nbsp;if&nbsp;the&nbsp;opening&nbsp;&#34;(&#34;&nbsp;or&nbsp;previous&nbsp;parameter&nbsp;ended&nbsp;on&nbsp;a&nbsp;different&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492109">ws</span>&nbsp;<span class="op" id="5492112">=</span>&nbsp;<span class="ident" id="5492114">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492124">}</span>&nbsp;<span class="keyword" id="5492126">else</span>&nbsp;<span class="keyword" id="5492131">if</span>&nbsp;<span class="ident" id="5492134">i</span>&nbsp;<span class="op" id="5492136">&gt;</span>&nbsp;<span class="num" id="5492138">0</span>&nbsp;<span class="op" id="5492140">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492146">p</span><span class="op" id="5492147">.</span><span class="builtinfunc" id="5492148">print</span><span class="op" id="5492153">(</span><span class="ident" id="5492154">blank</span><span class="op" id="5492159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492169">//&nbsp;parameter&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5492191">if</span>&nbsp;<span class="builtinfunc" id="5492194">len</span><span class="op" id="5492197">(</span><span class="ident" id="5492198">par</span><span class="op" id="5492201">.</span><span class="ident" id="5492202">Names</span><span class="op" id="5492207">)</span>&nbsp;<span class="op" id="5492209">&gt;</span>&nbsp;<span class="num" id="5492211">0</span>&nbsp;<span class="op" id="5492213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492219">//&nbsp;Very&nbsp;subtle:&nbsp;If&nbsp;we&nbsp;indented&nbsp;before&nbsp;(ws&nbsp;==&nbsp;ignore),&nbsp;identList</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492287">//&nbsp;won&#39;t&nbsp;indent&nbsp;again.&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;(ws&nbsp;==&nbsp;indent),&nbsp;identList&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492358">//&nbsp;indent&nbsp;if&nbsp;the&nbsp;identList&nbsp;spans&nbsp;multiple&nbsp;lines,&nbsp;and&nbsp;it&nbsp;will&nbsp;outdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492431">//&nbsp;again&nbsp;at&nbsp;the&nbsp;end&nbsp;(and&nbsp;still&nbsp;ws&nbsp;==&nbsp;indent).&nbsp;Thus,&nbsp;a&nbsp;subsequent&nbsp;indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492507">//&nbsp;by&nbsp;a&nbsp;linebreak&nbsp;call&nbsp;after&nbsp;a&nbsp;type,&nbsp;or&nbsp;in&nbsp;the&nbsp;next&nbsp;multi-line&nbsp;identList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492584">//&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492616">p</span><span class="op" id="5492617">.</span><span class="ident" id="5492618">identList</span><span class="op" id="5492627">(</span><span class="ident" id="5492628">par</span><span class="op" id="5492631">.</span><span class="ident" id="5492632">Names</span><span class="op" id="5492637">,</span>&nbsp;<span class="ident" id="5492639">ws</span>&nbsp;<span class="op" id="5492642">==</span>&nbsp;<span class="ident" id="5492645">indent</span><span class="op" id="5492651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492657">p</span><span class="op" id="5492658">.</span><span class="builtinfunc" id="5492659">print</span><span class="op" id="5492664">(</span><span class="ident" id="5492665">blank</span><span class="op" id="5492670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492680">//&nbsp;parameter&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492701">p</span><span class="op" id="5492702">.</span><span class="ident" id="5492703">expr</span><span class="op" id="5492707">(</span><span class="ident" id="5492708">stripParensAlways</span><span class="op" id="5492725">(</span><span class="ident" id="5492726">par</span><span class="op" id="5492729">.</span><span class="ident" id="5492730">Type</span><span class="op" id="5492734">)</span><span class="op" id="5492735">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492740">prevLine</span>&nbsp;<span class="op" id="5492749">=</span>&nbsp;<span class="ident" id="5492751">parLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492768">//&nbsp;if&nbsp;the&nbsp;closing&nbsp;&#34;)&#34;&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line&nbsp;from&nbsp;the&nbsp;last&nbsp;parameter,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492839">//&nbsp;print&nbsp;an&nbsp;additional&nbsp;&#34;,&#34;&nbsp;and&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5492883">if</span>&nbsp;<span class="ident" id="5492886">closing</span>&nbsp;<span class="op" id="5492894">:=</span>&nbsp;<span class="ident" id="5492897">p</span><span class="op" id="5492898">.</span><span class="ident" id="5492899">lineFor</span><span class="op" id="5492906">(</span><span class="ident" id="5492907">fields</span><span class="op" id="5492913">.</span><span class="ident" id="5492914">Closing</span><span class="op" id="5492921">)</span><span class="op" id="5492922">;</span>&nbsp;<span class="num" id="5492924">0</span>&nbsp;<span class="op" id="5492926">&lt;</span>&nbsp;<span class="ident" id="5492928">prevLine</span>&nbsp;<span class="op" id="5492937">&amp;&amp;</span>&nbsp;<span class="ident" id="5492940">prevLine</span>&nbsp;<span class="op" id="5492949">&lt;</span>&nbsp;<span class="ident" id="5492951">closing</span>&nbsp;<span class="op" id="5492959">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492964">p</span><span class="op" id="5492965">.</span><span class="builtinfunc" id="5492966">print</span><span class="op" id="5492971">(</span><span class="ident" id="5492972">token</span><span class="op" id="5492977">.</span><span class="ident" id="5492978">COMMA</span><span class="op" id="5492983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492988">p</span><span class="op" id="5492989">.</span><span class="ident" id="5492990">linebreak</span><span class="op" id="5492999">(</span><span class="ident" id="5493000">closing</span><span class="op" id="5493007">,</span>&nbsp;<span class="num" id="5493009">0</span><span class="op" id="5493010">,</span>&nbsp;<span class="ident" id="5493012">ignore</span><span class="op" id="5493018">,</span>&nbsp;<span class="builtintype" id="5493020">true</span><span class="op" id="5493024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493032">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493061">if</span>&nbsp;<span class="ident" id="5493064">ws</span>&nbsp;<span class="op" id="5493067">==</span>&nbsp;<span class="ident" id="5493070">ignore</span>&nbsp;<span class="op" id="5493077">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493082">p</span><span class="op" id="5493083">.</span><span class="builtinfunc" id="5493084">print</span><span class="op" id="5493089">(</span><span class="ident" id="5493090">unindent</span><span class="op" id="5493098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493108">p</span><span class="op" id="5493109">.</span><span class="builtinfunc" id="5493110">print</span><span class="op" id="5493115">(</span><span class="ident" id="5493116">fields</span><span class="op" id="5493122">.</span><span class="ident" id="5493123">Closing</span><span class="op" id="5493130">,</span>&nbsp;<span class="ident" id="5493132">token</span><span class="op" id="5493137">.</span><span class="ident" id="5493138">RPAREN</span><span class="op" id="5493144">)</span><br>
<span class="lineno"></span><span class="op" id="5493146">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5493149">func</span>&nbsp;<span class="op" id="5493154">(</span><span class="ident" id="5493155">p</span>&nbsp;<span class="op" id="5493157">*</span><span class="ident" id="5493158">printer</span><span class="op" id="5493165">)</span>&nbsp;<span class="ident" id="5493167">signature</span><span class="op" id="5493176">(</span><span class="ident" id="5493177">params</span><span class="op" id="5493183">,</span>&nbsp;<span class="ident" id="5493185">result</span>&nbsp;<span class="op" id="5493192">*</span><span class="ident" id="5493193">ast</span><span class="op" id="5493196">.</span><span class="ident" id="5493197">FieldList</span><span class="op" id="5493206">)</span>&nbsp;<span class="op" id="5493208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493211">if</span>&nbsp;<span class="ident" id="5493214">params</span>&nbsp;<span class="op" id="5493221">!=</span>&nbsp;<span class="builtintype" id="5493224">nil</span>&nbsp;<span class="op" id="5493228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493232">p</span><span class="op" id="5493233">.</span><span class="ident" id="5493234">parameters</span><span class="op" id="5493244">(</span><span class="ident" id="5493245">params</span><span class="op" id="5493251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493254">}</span>&nbsp;<span class="keyword" id="5493256">else</span>&nbsp;<span class="op" id="5493261">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493265">p</span><span class="op" id="5493266">.</span><span class="builtinfunc" id="5493267">print</span><span class="op" id="5493272">(</span><span class="ident" id="5493273">token</span><span class="op" id="5493278">.</span><span class="ident" id="5493279">LPAREN</span><span class="op" id="5493285">,</span>&nbsp;<span class="ident" id="5493287">token</span><span class="op" id="5493292">.</span><span class="ident" id="5493293">RPAREN</span><span class="op" id="5493299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493305">n</span>&nbsp;<span class="op" id="5493307">:=</span>&nbsp;<span class="ident" id="5493310">result</span><span class="op" id="5493316">.</span><span class="ident" id="5493317">NumFields</span><span class="op" id="5493326">(</span><span class="op" id="5493327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493330">if</span>&nbsp;<span class="ident" id="5493333">n</span>&nbsp;<span class="op" id="5493335">&gt;</span>&nbsp;<span class="num" id="5493337">0</span>&nbsp;<span class="op" id="5493339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493343">//&nbsp;result&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493362">p</span><span class="op" id="5493363">.</span><span class="builtinfunc" id="5493364">print</span><span class="op" id="5493369">(</span><span class="ident" id="5493370">blank</span><span class="op" id="5493375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493379">if</span>&nbsp;<span class="ident" id="5493382">n</span>&nbsp;<span class="op" id="5493384">==</span>&nbsp;<span class="num" id="5493387">1</span>&nbsp;<span class="op" id="5493389">&amp;&amp;</span>&nbsp;<span class="ident" id="5493392">result</span><span class="op" id="5493398">.</span><span class="ident" id="5493399">List</span><span class="op" id="5493403">[</span><span class="num" id="5493404">0</span><span class="op" id="5493405">]</span><span class="op" id="5493406">.</span><span class="ident" id="5493407">Names</span>&nbsp;<span class="op" id="5493413">==</span>&nbsp;<span class="builtintype" id="5493416">nil</span>&nbsp;<span class="op" id="5493420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493425">//&nbsp;single&nbsp;anonymous&nbsp;result;&nbsp;no&nbsp;()&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493464">p</span><span class="op" id="5493465">.</span><span class="ident" id="5493466">expr</span><span class="op" id="5493470">(</span><span class="ident" id="5493471">stripParensAlways</span><span class="op" id="5493488">(</span><span class="ident" id="5493489">result</span><span class="op" id="5493495">.</span><span class="ident" id="5493496">List</span><span class="op" id="5493500">[</span><span class="num" id="5493501">0</span><span class="op" id="5493502">]</span><span class="op" id="5493503">.</span><span class="ident" id="5493504">Type</span><span class="op" id="5493508">)</span><span class="op" id="5493509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493514">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493527">p</span><span class="op" id="5493528">.</span><span class="ident" id="5493529">parameters</span><span class="op" id="5493539">(</span><span class="ident" id="5493540">result</span><span class="op" id="5493546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493549">}</span><br>
<span class="lineno"></span><span class="op" id="5493551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5493554">func</span>&nbsp;<span class="ident" id="5493559">identListSize</span><span class="op" id="5493572">(</span><span class="ident" id="5493573">list</span>&nbsp;<span class="op" id="5493578">[</span><span class="op" id="5493579">]</span><span class="op" id="5493580">*</span><span class="ident" id="5493581">ast</span><span class="op" id="5493584">.</span><span class="ident" id="5493585">Ident</span><span class="op" id="5493590">,</span>&nbsp;<span class="ident" id="5493592">maxSize</span>&nbsp;<span class="builtintype" id="5493600">int</span><span class="op" id="5493603">)</span>&nbsp;<span class="op" id="5493605">(</span><span class="ident" id="5493606">size</span>&nbsp;<span class="builtintype" id="5493611">int</span><span class="op" id="5493614">)</span>&nbsp;<span class="op" id="5493616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493619">for</span>&nbsp;<span class="ident" id="5493623">i</span><span class="op" id="5493624">,</span>&nbsp;<span class="ident" id="5493626">x</span>&nbsp;<span class="op" id="5493628">:=</span>&nbsp;<span class="keyword" id="5493631">range</span>&nbsp;<span class="ident" id="5493637">list</span>&nbsp;<span class="op" id="5493642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493646">if</span>&nbsp;<span class="ident" id="5493649">i</span>&nbsp;<span class="op" id="5493651">&gt;</span>&nbsp;<span class="num" id="5493653">0</span>&nbsp;<span class="op" id="5493655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493660">size</span>&nbsp;<span class="op" id="5493665">+=</span>&nbsp;<span class="builtinfunc" id="5493668">len</span><span class="op" id="5493671">(</span><span class="string" id="5493672">&#34;,&nbsp;&#34;</span><span class="op" id="5493676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493680">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493684">size</span>&nbsp;<span class="op" id="5493689">+=</span>&nbsp;<span class="ident" id="5493692">utf8</span><span class="op" id="5493696">.</span><span class="ident" id="5493697">RuneCountInString</span><span class="op" id="5493714">(</span><span class="ident" id="5493715">x</span><span class="op" id="5493716">.</span><span class="ident" id="5493717">Name</span><span class="op" id="5493721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493725">if</span>&nbsp;<span class="ident" id="5493728">size</span>&nbsp;<span class="op" id="5493733">&gt;=</span>&nbsp;<span class="ident" id="5493736">maxSize</span>&nbsp;<span class="op" id="5493744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493749">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493760">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493763">return</span><br>
<span class="lineno"></span><span class="op" id="5493770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5493773">func</span>&nbsp;<span class="op" id="5493778">(</span><span class="ident" id="5493779">p</span>&nbsp;<span class="op" id="5493781">*</span><span class="ident" id="5493782">printer</span><span class="op" id="5493789">)</span>&nbsp;<span class="ident" id="5493791">isOneLineFieldList</span><span class="op" id="5493809">(</span><span class="ident" id="5493810">list</span>&nbsp;<span class="op" id="5493815">[</span><span class="op" id="5493816">]</span><span class="op" id="5493817">*</span><span class="ident" id="5493818">ast</span><span class="op" id="5493821">.</span><span class="ident" id="5493822">Field</span><span class="op" id="5493827">)</span>&nbsp;<span class="builtintype" id="5493829">bool</span>&nbsp;<span class="op" id="5493834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493837">if</span>&nbsp;<span class="builtinfunc" id="5493840">len</span><span class="op" id="5493843">(</span><span class="ident" id="5493844">list</span><span class="op" id="5493848">)</span>&nbsp;<span class="op" id="5493850">!=</span>&nbsp;<span class="num" id="5493853">1</span>&nbsp;<span class="op" id="5493855">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493859">return</span>&nbsp;<span class="builtintype" id="5493866">false</span>&nbsp;<span class="comment" id="5493872">//&nbsp;allow&nbsp;only&nbsp;one&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493900">f</span>&nbsp;<span class="op" id="5493902">:=</span>&nbsp;<span class="ident" id="5493905">list</span><span class="op" id="5493909">[</span><span class="num" id="5493910">0</span><span class="op" id="5493911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493914">if</span>&nbsp;<span class="ident" id="5493917">f</span><span class="op" id="5493918">.</span><span class="ident" id="5493919">Tag</span>&nbsp;<span class="op" id="5493923">!=</span>&nbsp;<span class="builtintype" id="5493926">nil</span>&nbsp;<span class="op" id="5493930">||</span>&nbsp;<span class="ident" id="5493933">f</span><span class="op" id="5493934">.</span><span class="ident" id="5493935">Comment</span>&nbsp;<span class="op" id="5493943">!=</span>&nbsp;<span class="builtintype" id="5493946">nil</span>&nbsp;<span class="op" id="5493950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493954">return</span>&nbsp;<span class="builtintype" id="5493961">false</span>&nbsp;<span class="comment" id="5493967">//&nbsp;don&#39;t&nbsp;allow&nbsp;tags&nbsp;or&nbsp;comments</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494003">//&nbsp;only&nbsp;name(s)&nbsp;and&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494029">const</span>&nbsp;<span class="ident" id="5494035">maxSize</span>&nbsp;<span class="op" id="5494043">=</span>&nbsp;<span class="num" id="5494045">30</span>&nbsp;<span class="comment" id="5494048">//&nbsp;adjust&nbsp;as&nbsp;appropriate,&nbsp;this&nbsp;is&nbsp;an&nbsp;approximate&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494104">namesSize</span>&nbsp;<span class="op" id="5494114">:=</span>&nbsp;<span class="ident" id="5494117">identListSize</span><span class="op" id="5494130">(</span><span class="ident" id="5494131">f</span><span class="op" id="5494132">.</span><span class="ident" id="5494133">Names</span><span class="op" id="5494138">,</span>&nbsp;<span class="ident" id="5494140">maxSize</span><span class="op" id="5494147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494150">if</span>&nbsp;<span class="ident" id="5494153">namesSize</span>&nbsp;<span class="op" id="5494163">&gt;</span>&nbsp;<span class="num" id="5494165">0</span>&nbsp;<span class="op" id="5494167">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494171">namesSize</span>&nbsp;<span class="op" id="5494181">=</span>&nbsp;<span class="num" id="5494183">1</span>&nbsp;<span class="comment" id="5494185">//&nbsp;blank&nbsp;between&nbsp;names&nbsp;and&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494222">typeSize</span>&nbsp;<span class="op" id="5494231">:=</span>&nbsp;<span class="ident" id="5494234">p</span><span class="op" id="5494235">.</span><span class="ident" id="5494236">nodeSize</span><span class="op" id="5494244">(</span><span class="ident" id="5494245">f</span><span class="op" id="5494246">.</span><span class="ident" id="5494247">Type</span><span class="op" id="5494251">,</span>&nbsp;<span class="ident" id="5494253">maxSize</span><span class="op" id="5494260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494263">return</span>&nbsp;<span class="ident" id="5494270">namesSize</span><span class="op" id="5494279">+</span><span class="ident" id="5494280">typeSize</span>&nbsp;<span class="op" id="5494289">&lt;=</span>&nbsp;<span class="ident" id="5494292">maxSize</span><br>
<span class="lineno"></span><span class="op" id="5494300">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5494303">func</span>&nbsp;<span class="op" id="5494308">(</span><span class="ident" id="5494309">p</span>&nbsp;<span class="op" id="5494311">*</span><span class="ident" id="5494312">printer</span><span class="op" id="5494319">)</span>&nbsp;<span class="ident" id="5494321">setLineComment</span><span class="op" id="5494335">(</span><span class="ident" id="5494336">text</span>&nbsp;<span class="builtintype" id="5494341">string</span><span class="op" id="5494347">)</span>&nbsp;<span class="op" id="5494349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494352">p</span><span class="op" id="5494353">.</span><span class="ident" id="5494354">setComment</span><span class="op" id="5494364">(</span><span class="op" id="5494365">&amp;</span><span class="ident" id="5494366">ast</span><span class="op" id="5494369">.</span><span class="ident" id="5494370">CommentGroup</span><span class="op" id="5494382">{</span><span class="ident" id="5494383">List</span><span class="op" id="5494387">:</span>&nbsp;<span class="op" id="5494389">[</span><span class="op" id="5494390">]</span><span class="op" id="5494391">*</span><span class="ident" id="5494392">ast</span><span class="op" id="5494395">.</span><span class="ident" id="5494396">Comment</span><span class="op" id="5494403">{</span><span class="op" id="5494404">{</span><span class="ident" id="5494405">Slash</span><span class="op" id="5494410">:</span>&nbsp;<span class="ident" id="5494412">token</span><span class="op" id="5494417">.</span><span class="ident" id="5494418">NoPos</span><span class="op" id="5494423">,</span>&nbsp;<span class="ident" id="5494425">Text</span><span class="op" id="5494429">:</span>&nbsp;<span class="ident" id="5494431">text</span><span class="op" id="5494435">}</span><span class="op" id="5494436">}</span><span class="op" id="5494437">}</span><span class="op" id="5494438">)</span><br>
<span class="lineno"></span><span class="op" id="5494440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5494443">func</span>&nbsp;<span class="op" id="5494448">(</span><span class="ident" id="5494449">p</span>&nbsp;<span class="op" id="5494451">*</span><span class="ident" id="5494452">printer</span><span class="op" id="5494459">)</span>&nbsp;<span class="ident" id="5494461">fieldList</span><span class="op" id="5494470">(</span><span class="ident" id="5494471">fields</span>&nbsp;<span class="op" id="5494478">*</span><span class="ident" id="5494479">ast</span><span class="op" id="5494482">.</span><span class="ident" id="5494483">FieldList</span><span class="op" id="5494492">,</span>&nbsp;<span class="ident" id="5494494">isStruct</span><span class="op" id="5494502">,</span>&nbsp;<span class="ident" id="5494504">isIncomplete</span>&nbsp;<span class="builtintype" id="5494517">bool</span><span class="op" id="5494521">)</span>&nbsp;<span class="op" id="5494523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494526">lbrace</span>&nbsp;<span class="op" id="5494533">:=</span>&nbsp;<span class="ident" id="5494536">fields</span><span class="op" id="5494542">.</span><span class="ident" id="5494543">Opening</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494552">list</span>&nbsp;<span class="op" id="5494557">:=</span>&nbsp;<span class="ident" id="5494560">fields</span><span class="op" id="5494566">.</span><span class="ident" id="5494567">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494573">rbrace</span>&nbsp;<span class="op" id="5494580">:=</span>&nbsp;<span class="ident" id="5494583">fields</span><span class="op" id="5494589">.</span><span class="ident" id="5494590">Closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494599">hasComments</span>&nbsp;<span class="op" id="5494611">:=</span>&nbsp;<span class="ident" id="5494614">isIncomplete</span>&nbsp;<span class="op" id="5494627">||</span>&nbsp;<span class="ident" id="5494630">p</span><span class="op" id="5494631">.</span><span class="ident" id="5494632">commentBefore</span><span class="op" id="5494645">(</span><span class="ident" id="5494646">p</span><span class="op" id="5494647">.</span><span class="ident" id="5494648">posFor</span><span class="op" id="5494654">(</span><span class="ident" id="5494655">rbrace</span><span class="op" id="5494661">)</span><span class="op" id="5494662">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494665">srcIsOneLine</span>&nbsp;<span class="op" id="5494678">:=</span>&nbsp;<span class="ident" id="5494681">lbrace</span><span class="op" id="5494687">.</span><span class="ident" id="5494688">IsValid</span><span class="op" id="5494695">(</span><span class="op" id="5494696">)</span>&nbsp;<span class="op" id="5494698">&amp;&amp;</span>&nbsp;<span class="ident" id="5494701">rbrace</span><span class="op" id="5494707">.</span><span class="ident" id="5494708">IsValid</span><span class="op" id="5494715">(</span><span class="op" id="5494716">)</span>&nbsp;<span class="op" id="5494718">&amp;&amp;</span>&nbsp;<span class="ident" id="5494721">p</span><span class="op" id="5494722">.</span><span class="ident" id="5494723">lineFor</span><span class="op" id="5494730">(</span><span class="ident" id="5494731">lbrace</span><span class="op" id="5494737">)</span>&nbsp;<span class="op" id="5494739">==</span>&nbsp;<span class="ident" id="5494742">p</span><span class="op" id="5494743">.</span><span class="ident" id="5494744">lineFor</span><span class="op" id="5494751">(</span><span class="ident" id="5494752">rbrace</span><span class="op" id="5494758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494762">if</span>&nbsp;<span class="op" id="5494765">!</span><span class="ident" id="5494766">hasComments</span>&nbsp;<span class="op" id="5494778">&amp;&amp;</span>&nbsp;<span class="ident" id="5494781">srcIsOneLine</span>&nbsp;<span class="op" id="5494794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494798">//&nbsp;possibly&nbsp;a&nbsp;one-line&nbsp;struct/interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494840">if</span>&nbsp;<span class="builtinfunc" id="5494843">len</span><span class="op" id="5494846">(</span><span class="ident" id="5494847">list</span><span class="op" id="5494851">)</span>&nbsp;<span class="op" id="5494853">==</span>&nbsp;<span class="num" id="5494856">0</span>&nbsp;<span class="op" id="5494858">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494863">//&nbsp;no&nbsp;blank&nbsp;between&nbsp;keyword&nbsp;and&nbsp;{}&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494914">p</span><span class="op" id="5494915">.</span><span class="builtinfunc" id="5494916">print</span><span class="op" id="5494921">(</span><span class="ident" id="5494922">lbrace</span><span class="op" id="5494928">,</span>&nbsp;<span class="ident" id="5494930">token</span><span class="op" id="5494935">.</span><span class="ident" id="5494936">LBRACE</span><span class="op" id="5494942">,</span>&nbsp;<span class="ident" id="5494944">rbrace</span><span class="op" id="5494950">,</span>&nbsp;<span class="ident" id="5494952">token</span><span class="op" id="5494957">.</span><span class="ident" id="5494958">RBRACE</span><span class="op" id="5494964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494978">}</span>&nbsp;<span class="keyword" id="5494980">else</span>&nbsp;<span class="keyword" id="5494985">if</span>&nbsp;<span class="ident" id="5494988">isStruct</span>&nbsp;<span class="op" id="5494997">&amp;&amp;</span>&nbsp;<span class="ident" id="5495000">p</span><span class="op" id="5495001">.</span><span class="ident" id="5495002">isOneLineFieldList</span><span class="op" id="5495020">(</span><span class="ident" id="5495021">list</span><span class="op" id="5495025">)</span>&nbsp;<span class="op" id="5495027">{</span>&nbsp;<span class="comment" id="5495029">//&nbsp;for&nbsp;now&nbsp;ignore&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495061">//&nbsp;small&nbsp;enough&nbsp;-&nbsp;print&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495100">//&nbsp;(don&#39;t&nbsp;use&nbsp;identList&nbsp;and&nbsp;ignore&nbsp;source&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495158">p</span><span class="op" id="5495159">.</span><span class="builtinfunc" id="5495160">print</span><span class="op" id="5495165">(</span><span class="ident" id="5495166">lbrace</span><span class="op" id="5495172">,</span>&nbsp;<span class="ident" id="5495174">token</span><span class="op" id="5495179">.</span><span class="ident" id="5495180">LBRACE</span><span class="op" id="5495186">,</span>&nbsp;<span class="ident" id="5495188">blank</span><span class="op" id="5495193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495198">f</span>&nbsp;<span class="op" id="5495200">:=</span>&nbsp;<span class="ident" id="5495203">list</span><span class="op" id="5495207">[</span><span class="num" id="5495208">0</span><span class="op" id="5495209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495214">for</span>&nbsp;<span class="ident" id="5495218">i</span><span class="op" id="5495219">,</span>&nbsp;<span class="ident" id="5495221">x</span>&nbsp;<span class="op" id="5495223">:=</span>&nbsp;<span class="keyword" id="5495226">range</span>&nbsp;<span class="ident" id="5495232">f</span><span class="op" id="5495233">.</span><span class="ident" id="5495234">Names</span>&nbsp;<span class="op" id="5495240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495246">if</span>&nbsp;<span class="ident" id="5495249">i</span>&nbsp;<span class="op" id="5495251">&gt;</span>&nbsp;<span class="num" id="5495253">0</span>&nbsp;<span class="op" id="5495255">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495262">//&nbsp;no&nbsp;comments&nbsp;so&nbsp;no&nbsp;need&nbsp;for&nbsp;comma&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495312">p</span><span class="op" id="5495313">.</span><span class="builtinfunc" id="5495314">print</span><span class="op" id="5495319">(</span><span class="ident" id="5495320">token</span><span class="op" id="5495325">.</span><span class="ident" id="5495326">COMMA</span><span class="op" id="5495331">,</span>&nbsp;<span class="ident" id="5495333">blank</span><span class="op" id="5495338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495350">p</span><span class="op" id="5495351">.</span><span class="ident" id="5495352">expr</span><span class="op" id="5495356">(</span><span class="ident" id="5495357">x</span><span class="op" id="5495358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495363">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495368">if</span>&nbsp;<span class="builtinfunc" id="5495371">len</span><span class="op" id="5495374">(</span><span class="ident" id="5495375">f</span><span class="op" id="5495376">.</span><span class="ident" id="5495377">Names</span><span class="op" id="5495382">)</span>&nbsp;<span class="op" id="5495384">&gt;</span>&nbsp;<span class="num" id="5495386">0</span>&nbsp;<span class="op" id="5495388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495394">p</span><span class="op" id="5495395">.</span><span class="builtinfunc" id="5495396">print</span><span class="op" id="5495401">(</span><span class="ident" id="5495402">blank</span><span class="op" id="5495407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495417">p</span><span class="op" id="5495418">.</span><span class="ident" id="5495419">expr</span><span class="op" id="5495423">(</span><span class="ident" id="5495424">f</span><span class="op" id="5495425">.</span><span class="ident" id="5495426">Type</span><span class="op" id="5495430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495435">p</span><span class="op" id="5495436">.</span><span class="builtinfunc" id="5495437">print</span><span class="op" id="5495442">(</span><span class="ident" id="5495443">blank</span><span class="op" id="5495448">,</span>&nbsp;<span class="ident" id="5495450">rbrace</span><span class="op" id="5495456">,</span>&nbsp;<span class="ident" id="5495458">token</span><span class="op" id="5495463">.</span><span class="ident" id="5495464">RBRACE</span><span class="op" id="5495470">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495475">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495490">//&nbsp;hasComments&nbsp;||&nbsp;!srcIsOneLine</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495524">p</span><span class="op" id="5495525">.</span><span class="builtinfunc" id="5495526">print</span><span class="op" id="5495531">(</span><span class="ident" id="5495532">blank</span><span class="op" id="5495537">,</span>&nbsp;<span class="ident" id="5495539">lbrace</span><span class="op" id="5495545">,</span>&nbsp;<span class="ident" id="5495547">token</span><span class="op" id="5495552">.</span><span class="ident" id="5495553">LBRACE</span><span class="op" id="5495559">,</span>&nbsp;<span class="ident" id="5495561">indent</span><span class="op" id="5495567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495570">if</span>&nbsp;<span class="ident" id="5495573">hasComments</span>&nbsp;<span class="op" id="5495585">||</span>&nbsp;<span class="builtinfunc" id="5495588">len</span><span class="op" id="5495591">(</span><span class="ident" id="5495592">list</span><span class="op" id="5495596">)</span>&nbsp;<span class="op" id="5495598">&gt;</span>&nbsp;<span class="num" id="5495600">0</span>&nbsp;<span class="op" id="5495602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495606">p</span><span class="op" id="5495607">.</span><span class="builtinfunc" id="5495608">print</span><span class="op" id="5495613">(</span><span class="ident" id="5495614">formfeed</span><span class="op" id="5495622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495629">if</span>&nbsp;<span class="ident" id="5495632">isStruct</span>&nbsp;<span class="op" id="5495641">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495646">sep</span>&nbsp;<span class="op" id="5495650">:=</span>&nbsp;<span class="ident" id="5495653">vtab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495660">if</span>&nbsp;<span class="builtinfunc" id="5495663">len</span><span class="op" id="5495666">(</span><span class="ident" id="5495667">list</span><span class="op" id="5495671">)</span>&nbsp;<span class="op" id="5495673">==</span>&nbsp;<span class="num" id="5495676">1</span>&nbsp;<span class="op" id="5495678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495683">sep</span>&nbsp;<span class="op" id="5495687">=</span>&nbsp;<span class="ident" id="5495689">blank</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495701">var</span>&nbsp;<span class="ident" id="5495705">line</span>&nbsp;<span class="builtintype" id="5495710">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495716">for</span>&nbsp;<span class="ident" id="5495720">i</span><span class="op" id="5495721">,</span>&nbsp;<span class="ident" id="5495723">f</span>&nbsp;<span class="op" id="5495725">:=</span>&nbsp;<span class="keyword" id="5495728">range</span>&nbsp;<span class="ident" id="5495734">list</span>&nbsp;<span class="op" id="5495739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495744">if</span>&nbsp;<span class="ident" id="5495747">i</span>&nbsp;<span class="op" id="5495749">&gt;</span>&nbsp;<span class="num" id="5495751">0</span>&nbsp;<span class="op" id="5495753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495759">p</span><span class="op" id="5495760">.</span><span class="ident" id="5495761">linebreak</span><span class="op" id="5495770">(</span><span class="ident" id="5495771">p</span><span class="op" id="5495772">.</span><span class="ident" id="5495773">lineFor</span><span class="op" id="5495780">(</span><span class="ident" id="5495781">f</span><span class="op" id="5495782">.</span><span class="ident" id="5495783">Pos</span><span class="op" id="5495786">(</span><span class="op" id="5495787">)</span><span class="op" id="5495788">)</span><span class="op" id="5495789">,</span>&nbsp;<span class="num" id="5495791">1</span><span class="op" id="5495792">,</span>&nbsp;<span class="ident" id="5495794">ignore</span><span class="op" id="5495800">,</span>&nbsp;<span class="ident" id="5495802">p</span><span class="op" id="5495803">.</span><span class="ident" id="5495804">linesFrom</span><span class="op" id="5495813">(</span><span class="ident" id="5495814">line</span><span class="op" id="5495818">)</span>&nbsp;<span class="op" id="5495820">&gt;</span>&nbsp;<span class="num" id="5495822">0</span><span class="op" id="5495823">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495833">extraTabs</span>&nbsp;<span class="op" id="5495843">:=</span>&nbsp;<span class="num" id="5495846">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495851">p</span><span class="op" id="5495852">.</span><span class="ident" id="5495853">setComment</span><span class="op" id="5495863">(</span><span class="ident" id="5495864">f</span><span class="op" id="5495865">.</span><span class="ident" id="5495866">Doc</span><span class="op" id="5495869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495874">p</span><span class="op" id="5495875">.</span><span class="ident" id="5495876">recordLine</span><span class="op" id="5495886">(</span><span class="op" id="5495887">&amp;</span><span class="ident" id="5495888">line</span><span class="op" id="5495892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495897">if</span>&nbsp;<span class="builtinfunc" id="5495900">len</span><span class="op" id="5495903">(</span><span class="ident" id="5495904">f</span><span class="op" id="5495905">.</span><span class="ident" id="5495906">Names</span><span class="op" id="5495911">)</span>&nbsp;<span class="op" id="5495913">&gt;</span>&nbsp;<span class="num" id="5495915">0</span>&nbsp;<span class="op" id="5495917">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495923">//&nbsp;named&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495943">p</span><span class="op" id="5495944">.</span><span class="ident" id="5495945">identList</span><span class="op" id="5495954">(</span><span class="ident" id="5495955">f</span><span class="op" id="5495956">.</span><span class="ident" id="5495957">Names</span><span class="op" id="5495962">,</span>&nbsp;<span class="builtintype" id="5495964">false</span><span class="op" id="5495969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495975">p</span><span class="op" id="5495976">.</span><span class="builtinfunc" id="5495977">print</span><span class="op" id="5495982">(</span><span class="ident" id="5495983">sep</span><span class="op" id="5495986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495992">p</span><span class="op" id="5495993">.</span><span class="ident" id="5495994">expr</span><span class="op" id="5495998">(</span><span class="ident" id="5495999">f</span><span class="op" id="5496000">.</span><span class="ident" id="5496001">Type</span><span class="op" id="5496005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496011">extraTabs</span>&nbsp;<span class="op" id="5496021">=</span>&nbsp;<span class="num" id="5496023">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496028">}</span>&nbsp;<span class="keyword" id="5496030">else</span>&nbsp;<span class="op" id="5496035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496041">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496064">p</span><span class="op" id="5496065">.</span><span class="ident" id="5496066">expr</span><span class="op" id="5496070">(</span><span class="ident" id="5496071">f</span><span class="op" id="5496072">.</span><span class="ident" id="5496073">Type</span><span class="op" id="5496077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496083">extraTabs</span>&nbsp;<span class="op" id="5496093">=</span>&nbsp;<span class="num" id="5496095">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496100">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496105">if</span>&nbsp;<span class="ident" id="5496108">f</span><span class="op" id="5496109">.</span><span class="ident" id="5496110">Tag</span>&nbsp;<span class="op" id="5496114">!=</span>&nbsp;<span class="builtintype" id="5496117">nil</span>&nbsp;<span class="op" id="5496121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496127">if</span>&nbsp;<span class="builtinfunc" id="5496130">len</span><span class="op" id="5496133">(</span><span class="ident" id="5496134">f</span><span class="op" id="5496135">.</span><span class="ident" id="5496136">Names</span><span class="op" id="5496141">)</span>&nbsp;<span class="op" id="5496143">&gt;</span>&nbsp;<span class="num" id="5496145">0</span>&nbsp;<span class="op" id="5496147">&amp;&amp;</span>&nbsp;<span class="ident" id="5496150">sep</span>&nbsp;<span class="op" id="5496154">==</span>&nbsp;<span class="ident" id="5496157">vtab</span>&nbsp;<span class="op" id="5496162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496169">p</span><span class="op" id="5496170">.</span><span class="builtinfunc" id="5496171">print</span><span class="op" id="5496176">(</span><span class="ident" id="5496177">sep</span><span class="op" id="5496180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496192">p</span><span class="op" id="5496193">.</span><span class="builtinfunc" id="5496194">print</span><span class="op" id="5496199">(</span><span class="ident" id="5496200">sep</span><span class="op" id="5496203">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496209">p</span><span class="op" id="5496210">.</span><span class="ident" id="5496211">expr</span><span class="op" id="5496215">(</span><span class="ident" id="5496216">f</span><span class="op" id="5496217">.</span><span class="ident" id="5496218">Tag</span><span class="op" id="5496221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496227">extraTabs</span>&nbsp;<span class="op" id="5496237">=</span>&nbsp;<span class="num" id="5496239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496249">if</span>&nbsp;<span class="ident" id="5496252">f</span><span class="op" id="5496253">.</span><span class="ident" id="5496254">Comment</span>&nbsp;<span class="op" id="5496262">!=</span>&nbsp;<span class="builtintype" id="5496265">nil</span>&nbsp;<span class="op" id="5496269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496275">for</span>&nbsp;<span class="op" id="5496279">;</span>&nbsp;<span class="ident" id="5496281">extraTabs</span>&nbsp;<span class="op" id="5496291">&gt;</span>&nbsp;<span class="num" id="5496293">0</span><span class="op" id="5496294">;</span>&nbsp;<span class="ident" id="5496296">extraTabs</span><span class="op" id="5496305">--</span>&nbsp;<span class="op" id="5496308">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496315">p</span><span class="op" id="5496316">.</span><span class="builtinfunc" id="5496317">print</span><span class="op" id="5496322">(</span><span class="ident" id="5496323">sep</span><span class="op" id="5496326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496338">p</span><span class="op" id="5496339">.</span><span class="ident" id="5496340">setComment</span><span class="op" id="5496350">(</span><span class="ident" id="5496351">f</span><span class="op" id="5496352">.</span><span class="ident" id="5496353">Comment</span><span class="op" id="5496360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496369">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496373">if</span>&nbsp;<span class="ident" id="5496376">isIncomplete</span>&nbsp;<span class="op" id="5496389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496394">if</span>&nbsp;<span class="builtinfunc" id="5496397">len</span><span class="op" id="5496400">(</span><span class="ident" id="5496401">list</span><span class="op" id="5496405">)</span>&nbsp;<span class="op" id="5496407">&gt;</span>&nbsp;<span class="num" id="5496409">0</span>&nbsp;<span class="op" id="5496411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496417">p</span><span class="op" id="5496418">.</span><span class="builtinfunc" id="5496419">print</span><span class="op" id="5496424">(</span><span class="ident" id="5496425">formfeed</span><span class="op" id="5496433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496443">p</span><span class="op" id="5496444">.</span><span class="ident" id="5496445">flush</span><span class="op" id="5496450">(</span><span class="ident" id="5496451">p</span><span class="op" id="5496452">.</span><span class="ident" id="5496453">posFor</span><span class="op" id="5496459">(</span><span class="ident" id="5496460">rbrace</span><span class="op" id="5496466">)</span><span class="op" id="5496467">,</span>&nbsp;<span class="ident" id="5496469">token</span><span class="op" id="5496474">.</span><span class="ident" id="5496475">RBRACE</span><span class="op" id="5496481">)</span>&nbsp;<span class="comment" id="5496483">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496535">p</span><span class="op" id="5496536">.</span><span class="ident" id="5496537">setLineComment</span><span class="op" id="5496551">(</span><span class="string" id="5496552">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;fields&#34;</span><span class="op" id="5496595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496603">}</span>&nbsp;<span class="keyword" id="5496605">else</span>&nbsp;<span class="op" id="5496610">{</span>&nbsp;<span class="comment" id="5496612">//&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496628">var</span>&nbsp;<span class="ident" id="5496632">line</span>&nbsp;<span class="builtintype" id="5496637">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496643">for</span>&nbsp;<span class="ident" id="5496647">i</span><span class="op" id="5496648">,</span>&nbsp;<span class="ident" id="5496650">f</span>&nbsp;<span class="op" id="5496652">:=</span>&nbsp;<span class="keyword" id="5496655">range</span>&nbsp;<span class="ident" id="5496661">list</span>&nbsp;<span class="op" id="5496666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496671">if</span>&nbsp;<span class="ident" id="5496674">i</span>&nbsp;<span class="op" id="5496676">&gt;</span>&nbsp;<span class="num" id="5496678">0</span>&nbsp;<span class="op" id="5496680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496686">p</span><span class="op" id="5496687">.</span><span class="ident" id="5496688">linebreak</span><span class="op" id="5496697">(</span><span class="ident" id="5496698">p</span><span class="op" id="5496699">.</span><span class="ident" id="5496700">lineFor</span><span class="op" id="5496707">(</span><span class="ident" id="5496708">f</span><span class="op" id="5496709">.</span><span class="ident" id="5496710">Pos</span><span class="op" id="5496713">(</span><span class="op" id="5496714">)</span><span class="op" id="5496715">)</span><span class="op" id="5496716">,</span>&nbsp;<span class="num" id="5496718">1</span><span class="op" id="5496719">,</span>&nbsp;<span class="ident" id="5496721">ignore</span><span class="op" id="5496727">,</span>&nbsp;<span class="ident" id="5496729">p</span><span class="op" id="5496730">.</span><span class="ident" id="5496731">linesFrom</span><span class="op" id="5496740">(</span><span class="ident" id="5496741">line</span><span class="op" id="5496745">)</span>&nbsp;<span class="op" id="5496747">&gt;</span>&nbsp;<span class="num" id="5496749">0</span><span class="op" id="5496750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496755">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496760">p</span><span class="op" id="5496761">.</span><span class="ident" id="5496762">setComment</span><span class="op" id="5496772">(</span><span class="ident" id="5496773">f</span><span class="op" id="5496774">.</span><span class="ident" id="5496775">Doc</span><span class="op" id="5496778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496783">p</span><span class="op" id="5496784">.</span><span class="ident" id="5496785">recordLine</span><span class="op" id="5496795">(</span><span class="op" id="5496796">&amp;</span><span class="ident" id="5496797">line</span><span class="op" id="5496801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496806">if</span>&nbsp;<span class="ident" id="5496809">ftyp</span><span class="op" id="5496813">,</span>&nbsp;<span class="ident" id="5496815">isFtyp</span>&nbsp;<span class="op" id="5496822">:=</span>&nbsp;<span class="ident" id="5496825">f</span><span class="op" id="5496826">.</span><span class="ident" id="5496827">Type</span><span class="op" id="5496831">.</span><span class="op" id="5496832">(</span><span class="op" id="5496833">*</span><span class="ident" id="5496834">ast</span><span class="op" id="5496837">.</span><span class="ident" id="5496838">FuncType</span><span class="op" id="5496846">)</span><span class="op" id="5496847">;</span>&nbsp;<span class="ident" id="5496849">isFtyp</span>&nbsp;<span class="op" id="5496856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496862">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496876">p</span><span class="op" id="5496877">.</span><span class="ident" id="5496878">expr</span><span class="op" id="5496882">(</span><span class="ident" id="5496883">f</span><span class="op" id="5496884">.</span><span class="ident" id="5496885">Names</span><span class="op" id="5496890">[</span><span class="num" id="5496891">0</span><span class="op" id="5496892">]</span><span class="op" id="5496893">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496899">p</span><span class="op" id="5496900">.</span><span class="ident" id="5496901">signature</span><span class="op" id="5496910">(</span><span class="ident" id="5496911">ftyp</span><span class="op" id="5496915">.</span><span class="ident" id="5496916">Params</span><span class="op" id="5496922">,</span>&nbsp;<span class="ident" id="5496924">ftyp</span><span class="op" id="5496928">.</span><span class="ident" id="5496929">Results</span><span class="op" id="5496936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496941">}</span>&nbsp;<span class="keyword" id="5496943">else</span>&nbsp;<span class="op" id="5496948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496954">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496980">p</span><span class="op" id="5496981">.</span><span class="ident" id="5496982">expr</span><span class="op" id="5496986">(</span><span class="ident" id="5496987">f</span><span class="op" id="5496988">.</span><span class="ident" id="5496989">Type</span><span class="op" id="5496993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496998">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497003">p</span><span class="op" id="5497004">.</span><span class="ident" id="5497005">setComment</span><span class="op" id="5497015">(</span><span class="ident" id="5497016">f</span><span class="op" id="5497017">.</span><span class="ident" id="5497018">Comment</span><span class="op" id="5497025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497033">if</span>&nbsp;<span class="ident" id="5497036">isIncomplete</span>&nbsp;<span class="op" id="5497049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497054">if</span>&nbsp;<span class="builtinfunc" id="5497057">len</span><span class="op" id="5497060">(</span><span class="ident" id="5497061">list</span><span class="op" id="5497065">)</span>&nbsp;<span class="op" id="5497067">&gt;</span>&nbsp;<span class="num" id="5497069">0</span>&nbsp;<span class="op" id="5497071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497077">p</span><span class="op" id="5497078">.</span><span class="builtinfunc" id="5497079">print</span><span class="op" id="5497084">(</span><span class="ident" id="5497085">formfeed</span><span class="op" id="5497093">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497103">p</span><span class="op" id="5497104">.</span><span class="ident" id="5497105">flush</span><span class="op" id="5497110">(</span><span class="ident" id="5497111">p</span><span class="op" id="5497112">.</span><span class="ident" id="5497113">posFor</span><span class="op" id="5497119">(</span><span class="ident" id="5497120">rbrace</span><span class="op" id="5497126">)</span><span class="op" id="5497127">,</span>&nbsp;<span class="ident" id="5497129">token</span><span class="op" id="5497134">.</span><span class="ident" id="5497135">RBRACE</span><span class="op" id="5497141">)</span>&nbsp;<span class="comment" id="5497143">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497195">p</span><span class="op" id="5497196">.</span><span class="ident" id="5497197">setLineComment</span><span class="op" id="5497211">(</span><span class="string" id="5497212">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;methods&#34;</span><span class="op" id="5497256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497267">p</span><span class="op" id="5497268">.</span><span class="builtinfunc" id="5497269">print</span><span class="op" id="5497274">(</span><span class="ident" id="5497275">unindent</span><span class="op" id="5497283">,</span>&nbsp;<span class="ident" id="5497285">formfeed</span><span class="op" id="5497293">,</span>&nbsp;<span class="ident" id="5497295">rbrace</span><span class="op" id="5497301">,</span>&nbsp;<span class="ident" id="5497303">token</span><span class="op" id="5497308">.</span><span class="ident" id="5497309">RBRACE</span><span class="op" id="5497315">)</span><br>
<span class="lineno"></span><span class="op" id="5497317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5497320">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">505</span><span class="comment" id="5497400">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497416">func</span>&nbsp;<span class="ident" id="5497421">walkBinary</span><span class="op" id="5497431">(</span><span class="ident" id="5497432">e</span>&nbsp;<span class="op" id="5497434">*</span><span class="ident" id="5497435">ast</span><span class="op" id="5497438">.</span><span class="ident" id="5497439">BinaryExpr</span><span class="op" id="5497449">)</span>&nbsp;<span class="op" id="5497451">(</span><span class="ident" id="5497452">has4</span><span class="op" id="5497456">,</span>&nbsp;<span class="ident" id="5497458">has5</span>&nbsp;<span class="builtintype" id="5497463">bool</span><span class="op" id="5497467">,</span>&nbsp;<span class="ident" id="5497469">maxProblem</span>&nbsp;<span class="builtintype" id="5497480">int</span><span class="op" id="5497483">)</span>&nbsp;<span class="op" id="5497485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497488">switch</span>&nbsp;<span class="ident" id="5497495">e</span><span class="op" id="5497496">.</span><span class="ident" id="5497497">Op</span><span class="op" id="5497499">.</span><span class="ident" id="5497500">Precedence</span><span class="op" id="5497510">(</span><span class="op" id="5497511">)</span>&nbsp;<span class="op" id="5497513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497516">case</span>&nbsp;<span class="num" id="5497521">4</span><span class="op" id="5497522">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497526">has4</span>&nbsp;<span class="op" id="5497531">=</span>&nbsp;<span class="builtintype" id="5497533">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497539">case</span>&nbsp;<span class="num" id="5497544">5</span><span class="op" id="5497545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497549">has5</span>&nbsp;<span class="op" id="5497554">=</span>&nbsp;<span class="builtintype" id="5497556">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497566">switch</span>&nbsp;<span class="ident" id="5497573">l</span>&nbsp;<span class="op" id="5497575">:=</span>&nbsp;<span class="ident" id="5497578">e</span><span class="op" id="5497579">.</span><span class="ident" id="5497580">X</span><span class="op" id="5497581">.</span><span class="op" id="5497582">(</span><span class="keyword" id="5497583">type</span><span class="op" id="5497587">)</span>&nbsp;<span class="op" id="5497589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497592">case</span>&nbsp;<span class="op" id="5497597">*</span><span class="ident" id="5497598">ast</span><span class="op" id="5497601">.</span><span class="ident" id="5497602">BinaryExpr</span><span class="op" id="5497612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497616">if</span>&nbsp;<span class="ident" id="5497619">l</span><span class="op" id="5497620">.</span><span class="ident" id="5497621">Op</span><span class="op" id="5497623">.</span><span class="ident" id="5497624">Precedence</span><span class="op" id="5497634">(</span><span class="op" id="5497635">)</span>&nbsp;<span class="op" id="5497637">&lt;</span>&nbsp;<span class="ident" id="5497639">e</span><span class="op" id="5497640">.</span><span class="ident" id="5497641">Op</span><span class="op" id="5497643">.</span><span class="ident" id="5497644">Precedence</span><span class="op" id="5497654">(</span><span class="op" id="5497655">)</span>&nbsp;<span class="op" id="5497657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497662">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497693">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497749">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497761">h4</span><span class="op" id="5497763">,</span>&nbsp;<span class="ident" id="5497765">h5</span><span class="op" id="5497767">,</span>&nbsp;<span class="ident" id="5497769">mp</span>&nbsp;<span class="op" id="5497772">:=</span>&nbsp;<span class="ident" id="5497775">walkBinary</span><span class="op" id="5497785">(</span><span class="ident" id="5497786">l</span><span class="op" id="5497787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497791">has4</span>&nbsp;<span class="op" id="5497796">=</span>&nbsp;<span class="ident" id="5497798">has4</span>&nbsp;<span class="op" id="5497803">||</span>&nbsp;<span class="ident" id="5497806">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497811">has5</span>&nbsp;<span class="op" id="5497816">=</span>&nbsp;<span class="ident" id="5497818">has5</span>&nbsp;<span class="op" id="5497823">||</span>&nbsp;<span class="ident" id="5497826">h5</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497831">if</span>&nbsp;<span class="ident" id="5497834">maxProblem</span>&nbsp;<span class="op" id="5497845">&lt;</span>&nbsp;<span class="ident" id="5497847">mp</span>&nbsp;<span class="op" id="5497850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497855">maxProblem</span>&nbsp;<span class="op" id="5497866">=</span>&nbsp;<span class="ident" id="5497868">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497880">switch</span>&nbsp;<span class="ident" id="5497887">r</span>&nbsp;<span class="op" id="5497889">:=</span>&nbsp;<span class="ident" id="5497892">e</span><span class="op" id="5497893">.</span><span class="ident" id="5497894">Y</span><span class="op" id="5497895">.</span><span class="op" id="5497896">(</span><span class="keyword" id="5497897">type</span><span class="op" id="5497901">)</span>&nbsp;<span class="op" id="5497903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497906">case</span>&nbsp;<span class="op" id="5497911">*</span><span class="ident" id="5497912">ast</span><span class="op" id="5497915">.</span><span class="ident" id="5497916">BinaryExpr</span><span class="op" id="5497926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497930">if</span>&nbsp;<span class="ident" id="5497933">r</span><span class="op" id="5497934">.</span><span class="ident" id="5497935">Op</span><span class="op" id="5497937">.</span><span class="ident" id="5497938">Precedence</span><span class="op" id="5497948">(</span><span class="op" id="5497949">)</span>&nbsp;<span class="op" id="5497951">&lt;=</span>&nbsp;<span class="ident" id="5497954">e</span><span class="op" id="5497955">.</span><span class="ident" id="5497956">Op</span><span class="op" id="5497958">.</span><span class="ident" id="5497959">Precedence</span><span class="op" id="5497969">(</span><span class="op" id="5497970">)</span>&nbsp;<span class="op" id="5497972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497977">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5498008">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498064">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498076">h4</span><span class="op" id="5498078">,</span>&nbsp;<span class="ident" id="5498080">h5</span><span class="op" id="5498082">,</span>&nbsp;<span class="ident" id="5498084">mp</span>&nbsp;<span class="op" id="5498087">:=</span>&nbsp;<span class="ident" id="5498090">walkBinary</span><span class="op" id="5498100">(</span><span class="ident" id="5498101">r</span><span class="op" id="5498102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498106">has4</span>&nbsp;<span class="op" id="5498111">=</span>&nbsp;<span class="ident" id="5498113">has4</span>&nbsp;<span class="op" id="5498118">||</span>&nbsp;<span class="ident" id="5498121">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498126">has5</span>&nbsp;<span class="op" id="5498131">=</span>&nbsp;<span class="ident" id="5498133">has5</span>&nbsp;<span class="op" id="5498138">||</span>&nbsp;<span class="ident" id="5498141">h5</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498146">if</span>&nbsp;<span class="ident" id="5498149">maxProblem</span>&nbsp;<span class="op" id="5498160">&lt;</span>&nbsp;<span class="ident" id="5498162">mp</span>&nbsp;<span class="op" id="5498165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498170">maxProblem</span>&nbsp;<span class="op" id="5498181">=</span>&nbsp;<span class="ident" id="5498183">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498192">case</span>&nbsp;<span class="op" id="5498197">*</span><span class="ident" id="5498198">ast</span><span class="op" id="5498201">.</span><span class="ident" id="5498202">StarExpr</span><span class="op" id="5498210">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498214">if</span>&nbsp;<span class="ident" id="5498217">e</span><span class="op" id="5498218">.</span><span class="ident" id="5498219">Op</span>&nbsp;<span class="op" id="5498222">==</span>&nbsp;<span class="ident" id="5498225">token</span><span class="op" id="5498230">.</span><span class="ident" id="5498231">QUO</span>&nbsp;<span class="op" id="5498235">{</span>&nbsp;<span class="comment" id="5498237">//&nbsp;`*/`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498248">maxProblem</span>&nbsp;<span class="op" id="5498259">=</span>&nbsp;<span class="num" id="5498261">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498269">case</span>&nbsp;<span class="op" id="5498274">*</span><span class="ident" id="5498275">ast</span><span class="op" id="5498278">.</span><span class="ident" id="5498279">UnaryExpr</span><span class="op" id="5498288">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498292">switch</span>&nbsp;<span class="ident" id="5498299">e</span><span class="op" id="5498300">.</span><span class="ident" id="5498301">Op</span><span class="op" id="5498303">.</span><span class="ident" id="5498304">String</span><span class="op" id="5498310">(</span><span class="op" id="5498311">)</span>&nbsp;<span class="op" id="5498313">+</span>&nbsp;<span class="ident" id="5498315">r</span><span class="op" id="5498316">.</span><span class="ident" id="5498317">Op</span><span class="op" id="5498319">.</span><span class="ident" id="5498320">String</span><span class="op" id="5498326">(</span><span class="op" id="5498327">)</span>&nbsp;<span class="op" id="5498329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498333">case</span>&nbsp;<span class="string" id="5498338">&#34;/*&#34;</span><span class="op" id="5498342">,</span>&nbsp;<span class="string" id="5498344">&#34;&amp;&amp;&#34;</span><span class="op" id="5498348">,</span>&nbsp;<span class="string" id="5498350">&#34;&amp;^&#34;</span><span class="op" id="5498354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498359">maxProblem</span>&nbsp;<span class="op" id="5498370">=</span>&nbsp;<span class="num" id="5498372">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498376">case</span>&nbsp;<span class="string" id="5498381">&#34;++&#34;</span><span class="op" id="5498385">,</span>&nbsp;<span class="string" id="5498387">&#34;--&#34;</span><span class="op" id="5498391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498396">if</span>&nbsp;<span class="ident" id="5498399">maxProblem</span>&nbsp;<span class="op" id="5498410">&lt;</span>&nbsp;<span class="num" id="5498412">4</span>&nbsp;<span class="op" id="5498414">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498420">maxProblem</span>&nbsp;<span class="op" id="5498431">=</span>&nbsp;<span class="num" id="5498433">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498448">return</span><br>
<span class="lineno">560</span><span class="op" id="5498455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5498458">func</span>&nbsp;<span class="ident" id="5498463">cutoff</span><span class="op" id="5498469">(</span><span class="ident" id="5498470">e</span>&nbsp;<span class="op" id="5498472">*</span><span class="ident" id="5498473">ast</span><span class="op" id="5498476">.</span><span class="ident" id="5498477">BinaryExpr</span><span class="op" id="5498487">,</span>&nbsp;<span class="ident" id="5498489">depth</span>&nbsp;<span class="builtintype" id="5498495">int</span><span class="op" id="5498498">)</span>&nbsp;<span class="builtintype" id="5498500">int</span>&nbsp;<span class="op" id="5498504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498507">has4</span><span class="op" id="5498511">,</span>&nbsp;<span class="ident" id="5498513">has5</span><span class="op" id="5498517">,</span>&nbsp;<span class="ident" id="5498519">maxProblem</span>&nbsp;<span class="op" id="5498530">:=</span>&nbsp;<span class="ident" id="5498533">walkBinary</span><span class="op" id="5498543">(</span><span class="ident" id="5498544">e</span><span class="op" id="5498545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498548">if</span>&nbsp;<span class="ident" id="5498551">maxProblem</span>&nbsp;<span class="op" id="5498562">&gt;</span>&nbsp;<span class="num" id="5498564">0</span>&nbsp;<span class="op" id="5498566">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498570">return</span>&nbsp;<span class="ident" id="5498577">maxProblem</span>&nbsp;<span class="op" id="5498588">+</span>&nbsp;<span class="num" id="5498590">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498596">if</span>&nbsp;<span class="ident" id="5498599">has4</span>&nbsp;<span class="op" id="5498604">&amp;&amp;</span>&nbsp;<span class="ident" id="5498607">has5</span>&nbsp;<span class="op" id="5498612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498616">if</span>&nbsp;<span class="ident" id="5498619">depth</span>&nbsp;<span class="op" id="5498625">==</span>&nbsp;<span class="num" id="5498628">1</span>&nbsp;<span class="op" id="5498630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498635">return</span>&nbsp;<span class="num" id="5498642">5</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498650">return</span>&nbsp;<span class="num" id="5498657">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498663">if</span>&nbsp;<span class="ident" id="5498666">depth</span>&nbsp;<span class="op" id="5498672">==</span>&nbsp;<span class="num" id="5498675">1</span>&nbsp;<span class="op" id="5498677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498681">return</span>&nbsp;<span class="num" id="5498688">6</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498694">return</span>&nbsp;<span class="num" id="5498701">4</span><br>
<span class="lineno"></span><span class="op" id="5498703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5498706">func</span>&nbsp;<span class="ident" id="5498711">diffPrec</span><span class="op" id="5498719">(</span><span class="ident" id="5498720">expr</span>&nbsp;<span class="ident" id="5498725">ast</span><span class="op" id="5498728">.</span><span class="ident" id="5498729">Expr</span><span class="op" id="5498733">,</span>&nbsp;<span class="ident" id="5498735">prec</span>&nbsp;<span class="builtintype" id="5498740">int</span><span class="op" id="5498743">)</span>&nbsp;<span class="builtintype" id="5498745">int</span>&nbsp;<span class="op" id="5498749">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498752">x</span><span class="op" id="5498753">,</span>&nbsp;<span class="ident" id="5498755">ok</span>&nbsp;<span class="op" id="5498758">:=</span>&nbsp;<span class="ident" id="5498761">expr</span><span class="op" id="5498765">.</span><span class="op" id="5498766">(</span><span class="op" id="5498767">*</span><span class="ident" id="5498768">ast</span><span class="op" id="5498771">.</span><span class="ident" id="5498772">BinaryExpr</span><span class="op" id="5498782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498785">if</span>&nbsp;<span class="op" id="5498788">!</span><span class="ident" id="5498789">ok</span>&nbsp;<span class="op" id="5498792">||</span>&nbsp;<span class="ident" id="5498795">prec</span>&nbsp;<span class="op" id="5498800">!=</span>&nbsp;<span class="ident" id="5498803">x</span><span class="op" id="5498804">.</span><span class="ident" id="5498805">Op</span><span class="op" id="5498807">.</span><span class="ident" id="5498808">Precedence</span><span class="op" id="5498818">(</span><span class="op" id="5498819">)</span>&nbsp;<span class="op" id="5498821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498825">return</span>&nbsp;<span class="num" id="5498832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498838">return</span>&nbsp;<span class="num" id="5498845">0</span><br>
<span class="lineno">585</span><span class="op" id="5498847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5498850">func</span>&nbsp;<span class="ident" id="5498855">reduceDepth</span><span class="op" id="5498866">(</span><span class="ident" id="5498867">depth</span>&nbsp;<span class="builtintype" id="5498873">int</span><span class="op" id="5498876">)</span>&nbsp;<span class="builtintype" id="5498878">int</span>&nbsp;<span class="op" id="5498882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498885">depth</span><span class="op" id="5498890">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498894">if</span>&nbsp;<span class="ident" id="5498897">depth</span>&nbsp;<span class="op" id="5498903">&lt;</span>&nbsp;<span class="num" id="5498905">1</span>&nbsp;<span class="op" id="5498907">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498911">depth</span>&nbsp;<span class="op" id="5498917">=</span>&nbsp;<span class="num" id="5498919">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498925">return</span>&nbsp;<span class="ident" id="5498932">depth</span><br>
<span class="lineno"></span><span class="op" id="5498938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5498941">//&nbsp;Format&nbsp;the&nbsp;binary&nbsp;expression:&nbsp;decide&nbsp;the&nbsp;cutoff&nbsp;and&nbsp;then&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5499009">//&nbsp;Let&#39;s&nbsp;call&nbsp;depth&nbsp;==&nbsp;1&nbsp;Normal&nbsp;mode,&nbsp;and&nbsp;depth&nbsp;&gt;&nbsp;1&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5499075">//&nbsp;(Algorithm&nbsp;suggestion&nbsp;by&nbsp;Russ&nbsp;Cox.)</span><br>
<span class="lineno"></span><span class="comment" id="5499114">//</span><br>
<span class="lineno"></span><span class="comment" id="5499117">//&nbsp;The&nbsp;precedences&nbsp;are:</span><br>
<span class="lineno">600</span><span class="comment" id="5499141">//&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;/&nbsp;&nbsp;%&nbsp;&nbsp;&lt;&lt;&nbsp;&nbsp;&gt;&gt;&nbsp;&nbsp;&amp;&nbsp;&nbsp;&amp;^</span><br>
<span class="lineno"></span><span class="comment" id="5499181">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;-&nbsp;&nbsp;|&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5499209">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==&nbsp;&nbsp;!=&nbsp;&nbsp;&lt;&nbsp;&nbsp;&lt;=&nbsp;&nbsp;&gt;&nbsp;&nbsp;&gt;=</span><br>
<span class="lineno"></span><span class="comment" id="5499247">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;</span><br>
<span class="lineno"></span><span class="comment" id="5499267">//&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="lineno">605</span><span class="comment" id="5499287">//</span><br>
<span class="lineno"></span><span class="comment" id="5499290">//&nbsp;The&nbsp;only&nbsp;decision&nbsp;is&nbsp;whether&nbsp;there&nbsp;will&nbsp;be&nbsp;spaces&nbsp;around&nbsp;levels&nbsp;4&nbsp;and&nbsp;5.</span><br>
<span class="lineno"></span><span class="comment" id="5499366">//&nbsp;There&nbsp;are&nbsp;never&nbsp;spaces&nbsp;at&nbsp;level&nbsp;6&nbsp;(unary),&nbsp;and&nbsp;always&nbsp;spaces&nbsp;at&nbsp;levels&nbsp;3&nbsp;and&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="5499453">//</span><br>
<span class="lineno"></span><span class="comment" id="5499456">//&nbsp;To&nbsp;choose&nbsp;the&nbsp;cutoff,&nbsp;look&nbsp;at&nbsp;the&nbsp;whole&nbsp;expression&nbsp;but&nbsp;excluding&nbsp;primary</span><br>
<span class="lineno">610</span><span class="comment" id="5499532">//&nbsp;expressions&nbsp;(function&nbsp;calls,&nbsp;parenthesized&nbsp;exprs),&nbsp;and&nbsp;apply&nbsp;these&nbsp;rules:</span><br>
<span class="lineno"></span><span class="comment" id="5499609">//</span><br>
<span class="lineno"></span><span class="comment" id="5499612">//&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;binary&nbsp;operator&nbsp;with&nbsp;a&nbsp;right&nbsp;side&nbsp;unary&nbsp;operand</span><br>
<span class="lineno"></span><span class="comment" id="5499680">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;would&nbsp;clash&nbsp;without&nbsp;a&nbsp;space,&nbsp;the&nbsp;cutoff&nbsp;must&nbsp;be&nbsp;(in&nbsp;order):</span><br>
<span class="lineno"></span><span class="comment" id="5499751">//</span><br>
<span class="lineno">615</span><span class="comment" id="5499754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="5499763">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="5499772">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;^&nbsp;&nbsp;&nbsp;&nbsp;6</span><br>
<span class="lineno"></span><span class="comment" id="5499781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++&nbsp;&nbsp;&nbsp;&nbsp;5</span><br>
<span class="lineno"></span><span class="comment" id="5499790">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;&nbsp;&nbsp;5</span><br>
<span class="lineno">620</span><span class="comment" id="5499799">//</span><br>
<span class="lineno"></span><span class="comment" id="5499802">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Comparison&nbsp;operators&nbsp;always&nbsp;have&nbsp;spaces&nbsp;around&nbsp;them.)</span><br>
<span class="lineno"></span><span class="comment" id="5499868">//</span><br>
<span class="lineno"></span><span class="comment" id="5499871">//&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;mix&nbsp;of&nbsp;level&nbsp;5&nbsp;and&nbsp;level&nbsp;4&nbsp;operators,&nbsp;then&nbsp;the&nbsp;cutoff</span><br>
<span class="lineno"></span><span class="comment" id="5499945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;5&nbsp;(use&nbsp;spaces&nbsp;to&nbsp;distinguish&nbsp;precedence)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno">625</span><span class="comment" id="5500010">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5500058">//</span><br>
<span class="lineno"></span><span class="comment" id="5500061">//&nbsp;&nbsp;&nbsp;&nbsp;3)&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;level&nbsp;4&nbsp;operators&nbsp;or&nbsp;no&nbsp;level&nbsp;5&nbsp;operators,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5500135">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cutoff&nbsp;is&nbsp;6&nbsp;(always&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno"></span><span class="comment" id="5500188">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno">630</span><span class="comment" id="5500236">//</span><br>
<span class="lineno"></span><span class="keyword" id="5500239">func</span>&nbsp;<span class="op" id="5500244">(</span><span class="ident" id="5500245">p</span>&nbsp;<span class="op" id="5500247">*</span><span class="ident" id="5500248">printer</span><span class="op" id="5500255">)</span>&nbsp;<span class="ident" id="5500257">binaryExpr</span><span class="op" id="5500267">(</span><span class="ident" id="5500268">x</span>&nbsp;<span class="op" id="5500270">*</span><span class="ident" id="5500271">ast</span><span class="op" id="5500274">.</span><span class="ident" id="5500275">BinaryExpr</span><span class="op" id="5500285">,</span>&nbsp;<span class="ident" id="5500287">prec1</span><span class="op" id="5500292">,</span>&nbsp;<span class="ident" id="5500294">cutoff</span><span class="op" id="5500300">,</span>&nbsp;<span class="ident" id="5500302">depth</span>&nbsp;<span class="builtintype" id="5500308">int</span><span class="op" id="5500311">)</span>&nbsp;<span class="op" id="5500313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500316">prec</span>&nbsp;<span class="op" id="5500321">:=</span>&nbsp;<span class="ident" id="5500324">x</span><span class="op" id="5500325">.</span><span class="ident" id="5500326">Op</span><span class="op" id="5500328">.</span><span class="ident" id="5500329">Precedence</span><span class="op" id="5500339">(</span><span class="op" id="5500340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500343">if</span>&nbsp;<span class="ident" id="5500346">prec</span>&nbsp;<span class="op" id="5500351">&lt;</span>&nbsp;<span class="ident" id="5500353">prec1</span>&nbsp;<span class="op" id="5500359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500363">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500387">//&nbsp;Note:&nbsp;The&nbsp;parser&nbsp;inserts&nbsp;an&nbsp;ast.ParenExpr&nbsp;node;&nbsp;thus&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500455">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;occur&nbsp;if&nbsp;the&nbsp;AST&nbsp;is&nbsp;created&nbsp;in&nbsp;a&nbsp;different&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500523">p</span><span class="op" id="5500524">.</span><span class="builtinfunc" id="5500525">print</span><span class="op" id="5500530">(</span><span class="ident" id="5500531">token</span><span class="op" id="5500536">.</span><span class="ident" id="5500537">LPAREN</span><span class="op" id="5500543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500547">p</span><span class="op" id="5500548">.</span><span class="ident" id="5500549">expr0</span><span class="op" id="5500554">(</span><span class="ident" id="5500555">x</span><span class="op" id="5500556">,</span>&nbsp;<span class="ident" id="5500558">reduceDepth</span><span class="op" id="5500569">(</span><span class="ident" id="5500570">depth</span><span class="op" id="5500575">)</span><span class="op" id="5500576">)</span>&nbsp;<span class="comment" id="5500578">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500619">p</span><span class="op" id="5500620">.</span><span class="builtinfunc" id="5500621">print</span><span class="op" id="5500626">(</span><span class="ident" id="5500627">token</span><span class="op" id="5500632">.</span><span class="ident" id="5500633">RPAREN</span><span class="op" id="5500639">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500643">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500655">printBlank</span>&nbsp;<span class="op" id="5500666">:=</span>&nbsp;<span class="ident" id="5500669">prec</span>&nbsp;<span class="op" id="5500674">&lt;</span>&nbsp;<span class="ident" id="5500676">cutoff</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500685">ws</span>&nbsp;<span class="op" id="5500688">:=</span>&nbsp;<span class="ident" id="5500691">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500699">p</span><span class="op" id="5500700">.</span><span class="ident" id="5500701">expr1</span><span class="op" id="5500706">(</span><span class="ident" id="5500707">x</span><span class="op" id="5500708">.</span><span class="ident" id="5500709">X</span><span class="op" id="5500710">,</span>&nbsp;<span class="ident" id="5500712">prec</span><span class="op" id="5500716">,</span>&nbsp;<span class="ident" id="5500718">depth</span><span class="op" id="5500723">+</span><span class="ident" id="5500724">diffPrec</span><span class="op" id="5500732">(</span><span class="ident" id="5500733">x</span><span class="op" id="5500734">.</span><span class="ident" id="5500735">X</span><span class="op" id="5500736">,</span>&nbsp;<span class="ident" id="5500738">prec</span><span class="op" id="5500742">)</span><span class="op" id="5500743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500746">if</span>&nbsp;<span class="ident" id="5500749">printBlank</span>&nbsp;<span class="op" id="5500760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500764">p</span><span class="op" id="5500765">.</span><span class="builtinfunc" id="5500766">print</span><span class="op" id="5500771">(</span><span class="ident" id="5500772">blank</span><span class="op" id="5500777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500780">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500783">xline</span>&nbsp;<span class="op" id="5500789">:=</span>&nbsp;<span class="ident" id="5500792">p</span><span class="op" id="5500793">.</span><span class="ident" id="5500794">pos</span><span class="op" id="5500797">.</span><span class="ident" id="5500798">Line</span>&nbsp;<span class="comment" id="5500803">//&nbsp;before&nbsp;the&nbsp;operator&nbsp;(it&nbsp;may&nbsp;be&nbsp;on&nbsp;the&nbsp;next&nbsp;line!)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500857">yline</span>&nbsp;<span class="op" id="5500863">:=</span>&nbsp;<span class="ident" id="5500866">p</span><span class="op" id="5500867">.</span><span class="ident" id="5500868">lineFor</span><span class="op" id="5500875">(</span><span class="ident" id="5500876">x</span><span class="op" id="5500877">.</span><span class="ident" id="5500878">Y</span><span class="op" id="5500879">.</span><span class="ident" id="5500880">Pos</span><span class="op" id="5500883">(</span><span class="op" id="5500884">)</span><span class="op" id="5500885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500888">p</span><span class="op" id="5500889">.</span><span class="builtinfunc" id="5500890">print</span><span class="op" id="5500895">(</span><span class="ident" id="5500896">x</span><span class="op" id="5500897">.</span><span class="ident" id="5500898">OpPos</span><span class="op" id="5500903">,</span>&nbsp;<span class="ident" id="5500905">x</span><span class="op" id="5500906">.</span><span class="ident" id="5500907">Op</span><span class="op" id="5500909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500912">if</span>&nbsp;<span class="ident" id="5500915">xline</span>&nbsp;<span class="op" id="5500921">!=</span>&nbsp;<span class="ident" id="5500924">yline</span>&nbsp;<span class="op" id="5500930">&amp;&amp;</span>&nbsp;<span class="ident" id="5500933">xline</span>&nbsp;<span class="op" id="5500939">&gt;</span>&nbsp;<span class="num" id="5500941">0</span>&nbsp;<span class="op" id="5500943">&amp;&amp;</span>&nbsp;<span class="ident" id="5500946">yline</span>&nbsp;<span class="op" id="5500952">&gt;</span>&nbsp;<span class="num" id="5500954">0</span>&nbsp;<span class="op" id="5500956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500960">//&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break,&nbsp;but&nbsp;respect&nbsp;an&nbsp;extra&nbsp;empty&nbsp;line</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5501022">//&nbsp;in&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501041">if</span>&nbsp;<span class="ident" id="5501044">p</span><span class="op" id="5501045">.</span><span class="ident" id="5501046">linebreak</span><span class="op" id="5501055">(</span><span class="ident" id="5501056">yline</span><span class="op" id="5501061">,</span>&nbsp;<span class="num" id="5501063">1</span><span class="op" id="5501064">,</span>&nbsp;<span class="ident" id="5501066">ws</span><span class="op" id="5501068">,</span>&nbsp;<span class="builtintype" id="5501070">true</span><span class="op" id="5501074">)</span>&nbsp;<span class="op" id="5501076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501081">ws</span>&nbsp;<span class="op" id="5501084">=</span>&nbsp;<span class="ident" id="5501086">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501096">printBlank</span>&nbsp;<span class="op" id="5501107">=</span>&nbsp;<span class="builtintype" id="5501109">false</span>&nbsp;<span class="comment" id="5501115">//&nbsp;no&nbsp;blank&nbsp;after&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501146">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501152">if</span>&nbsp;<span class="ident" id="5501155">printBlank</span>&nbsp;<span class="op" id="5501166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501170">p</span><span class="op" id="5501171">.</span><span class="builtinfunc" id="5501172">print</span><span class="op" id="5501177">(</span><span class="ident" id="5501178">blank</span><span class="op" id="5501183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501189">p</span><span class="op" id="5501190">.</span><span class="ident" id="5501191">expr1</span><span class="op" id="5501196">(</span><span class="ident" id="5501197">x</span><span class="op" id="5501198">.</span><span class="ident" id="5501199">Y</span><span class="op" id="5501200">,</span>&nbsp;<span class="ident" id="5501202">prec</span><span class="op" id="5501206">+</span><span class="num" id="5501207">1</span><span class="op" id="5501208">,</span>&nbsp;<span class="ident" id="5501210">depth</span><span class="op" id="5501215">+</span><span class="num" id="5501216">1</span><span class="op" id="5501217">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501220">if</span>&nbsp;<span class="ident" id="5501223">ws</span>&nbsp;<span class="op" id="5501226">==</span>&nbsp;<span class="ident" id="5501229">ignore</span>&nbsp;<span class="op" id="5501236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501240">p</span><span class="op" id="5501241">.</span><span class="builtinfunc" id="5501242">print</span><span class="op" id="5501247">(</span><span class="ident" id="5501248">unindent</span><span class="op" id="5501256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501259">}</span><br>
<span class="lineno"></span><span class="op" id="5501261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">670</span><span class="keyword" id="5501264">func</span>&nbsp;<span class="ident" id="5501269">isBinary</span><span class="op" id="5501277">(</span><span class="ident" id="5501278">expr</span>&nbsp;<span class="ident" id="5501283">ast</span><span class="op" id="5501286">.</span><span class="ident" id="5501287">Expr</span><span class="op" id="5501291">)</span>&nbsp;<span class="builtintype" id="5501293">bool</span>&nbsp;<span class="op" id="5501298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501301">_</span><span class="op" id="5501302">,</span>&nbsp;<span class="ident" id="5501304">ok</span>&nbsp;<span class="op" id="5501307">:=</span>&nbsp;<span class="ident" id="5501310">expr</span><span class="op" id="5501314">.</span><span class="op" id="5501315">(</span><span class="op" id="5501316">*</span><span class="ident" id="5501317">ast</span><span class="op" id="5501320">.</span><span class="ident" id="5501321">BinaryExpr</span><span class="op" id="5501331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501334">return</span>&nbsp;<span class="ident" id="5501341">ok</span><br>
<span class="lineno"></span><span class="op" id="5501344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5501347">func</span>&nbsp;<span class="op" id="5501352">(</span><span class="ident" id="5501353">p</span>&nbsp;<span class="op" id="5501355">*</span><span class="ident" id="5501356">printer</span><span class="op" id="5501363">)</span>&nbsp;<span class="ident" id="5501365">expr1</span><span class="op" id="5501370">(</span><span class="ident" id="5501371">expr</span>&nbsp;<span class="ident" id="5501376">ast</span><span class="op" id="5501379">.</span><span class="ident" id="5501380">Expr</span><span class="op" id="5501384">,</span>&nbsp;<span class="ident" id="5501386">prec1</span><span class="op" id="5501391">,</span>&nbsp;<span class="ident" id="5501393">depth</span>&nbsp;<span class="builtintype" id="5501399">int</span><span class="op" id="5501402">)</span>&nbsp;<span class="op" id="5501404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501407">p</span><span class="op" id="5501408">.</span><span class="builtinfunc" id="5501409">print</span><span class="op" id="5501414">(</span><span class="ident" id="5501415">expr</span><span class="op" id="5501419">.</span><span class="ident" id="5501420">Pos</span><span class="op" id="5501423">(</span><span class="op" id="5501424">)</span><span class="op" id="5501425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501429">switch</span>&nbsp;<span class="ident" id="5501436">x</span>&nbsp;<span class="op" id="5501438">:=</span>&nbsp;<span class="ident" id="5501441">expr</span><span class="op" id="5501445">.</span><span class="op" id="5501446">(</span><span class="keyword" id="5501447">type</span><span class="op" id="5501451">)</span>&nbsp;<span class="op" id="5501453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501456">case</span>&nbsp;<span class="op" id="5501461">*</span><span class="ident" id="5501462">ast</span><span class="op" id="5501465">.</span><span class="ident" id="5501466">BadExpr</span><span class="op" id="5501473">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501477">p</span><span class="op" id="5501478">.</span><span class="builtinfunc" id="5501479">print</span><span class="op" id="5501484">(</span><span class="string" id="5501485">&#34;BadExpr&#34;</span><span class="op" id="5501494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501498">case</span>&nbsp;<span class="op" id="5501503">*</span><span class="ident" id="5501504">ast</span><span class="op" id="5501507">.</span><span class="ident" id="5501508">Ident</span><span class="op" id="5501513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501517">p</span><span class="op" id="5501518">.</span><span class="builtinfunc" id="5501519">print</span><span class="op" id="5501524">(</span><span class="ident" id="5501525">x</span><span class="op" id="5501526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501530">case</span>&nbsp;<span class="op" id="5501535">*</span><span class="ident" id="5501536">ast</span><span class="op" id="5501539">.</span><span class="ident" id="5501540">BinaryExpr</span><span class="op" id="5501550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501554">if</span>&nbsp;<span class="ident" id="5501557">depth</span>&nbsp;<span class="op" id="5501563">&lt;</span>&nbsp;<span class="num" id="5501565">1</span>&nbsp;<span class="op" id="5501567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501572">p</span><span class="op" id="5501573">.</span><span class="ident" id="5501574">internalError</span><span class="op" id="5501587">(</span><span class="string" id="5501588">&#34;depth&nbsp;&lt;&nbsp;1:&#34;</span><span class="op" id="5501600">,</span>&nbsp;<span class="ident" id="5501602">depth</span><span class="op" id="5501607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501612">depth</span>&nbsp;<span class="op" id="5501618">=</span>&nbsp;<span class="num" id="5501620">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501624">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501628">p</span><span class="op" id="5501629">.</span><span class="ident" id="5501630">binaryExpr</span><span class="op" id="5501640">(</span><span class="ident" id="5501641">x</span><span class="op" id="5501642">,</span>&nbsp;<span class="ident" id="5501644">prec1</span><span class="op" id="5501649">,</span>&nbsp;<span class="ident" id="5501651">cutoff</span><span class="op" id="5501657">(</span><span class="ident" id="5501658">x</span><span class="op" id="5501659">,</span>&nbsp;<span class="ident" id="5501661">depth</span><span class="op" id="5501666">)</span><span class="op" id="5501667">,</span>&nbsp;<span class="ident" id="5501669">depth</span><span class="op" id="5501674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501678">case</span>&nbsp;<span class="op" id="5501683">*</span><span class="ident" id="5501684">ast</span><span class="op" id="5501687">.</span><span class="ident" id="5501688">KeyValueExpr</span><span class="op" id="5501700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501704">p</span><span class="op" id="5501705">.</span><span class="ident" id="5501706">expr</span><span class="op" id="5501710">(</span><span class="ident" id="5501711">x</span><span class="op" id="5501712">.</span><span class="ident" id="5501713">Key</span><span class="op" id="5501716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501720">p</span><span class="op" id="5501721">.</span><span class="builtinfunc" id="5501722">print</span><span class="op" id="5501727">(</span><span class="ident" id="5501728">x</span><span class="op" id="5501729">.</span><span class="ident" id="5501730">Colon</span><span class="op" id="5501735">,</span>&nbsp;<span class="ident" id="5501737">token</span><span class="op" id="5501742">.</span><span class="ident" id="5501743">COLON</span><span class="op" id="5501748">,</span>&nbsp;<span class="ident" id="5501750">blank</span><span class="op" id="5501755">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501759">p</span><span class="op" id="5501760">.</span><span class="ident" id="5501761">expr</span><span class="op" id="5501765">(</span><span class="ident" id="5501766">x</span><span class="op" id="5501767">.</span><span class="ident" id="5501768">Value</span><span class="op" id="5501773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501777">case</span>&nbsp;<span class="op" id="5501782">*</span><span class="ident" id="5501783">ast</span><span class="op" id="5501786">.</span><span class="ident" id="5501787">StarExpr</span><span class="op" id="5501795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501799">const</span>&nbsp;<span class="ident" id="5501805">prec</span>&nbsp;<span class="op" id="5501810">=</span>&nbsp;<span class="ident" id="5501812">token</span><span class="op" id="5501817">.</span><span class="ident" id="5501818">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501830">if</span>&nbsp;<span class="ident" id="5501833">prec</span>&nbsp;<span class="op" id="5501838">&lt;</span>&nbsp;<span class="ident" id="5501840">prec1</span>&nbsp;<span class="op" id="5501846">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5501851">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501876">p</span><span class="op" id="5501877">.</span><span class="builtinfunc" id="5501878">print</span><span class="op" id="5501883">(</span><span class="ident" id="5501884">token</span><span class="op" id="5501889">.</span><span class="ident" id="5501890">LPAREN</span><span class="op" id="5501896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501901">p</span><span class="op" id="5501902">.</span><span class="builtinfunc" id="5501903">print</span><span class="op" id="5501908">(</span><span class="ident" id="5501909">token</span><span class="op" id="5501914">.</span><span class="ident" id="5501915">MUL</span><span class="op" id="5501918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501923">p</span><span class="op" id="5501924">.</span><span class="ident" id="5501925">expr</span><span class="op" id="5501929">(</span><span class="ident" id="5501930">x</span><span class="op" id="5501931">.</span><span class="ident" id="5501932">X</span><span class="op" id="5501933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501938">p</span><span class="op" id="5501939">.</span><span class="builtinfunc" id="5501940">print</span><span class="op" id="5501945">(</span><span class="ident" id="5501946">token</span><span class="op" id="5501951">.</span><span class="ident" id="5501952">RPAREN</span><span class="op" id="5501958">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501962">}</span>&nbsp;<span class="keyword" id="5501964">else</span>&nbsp;<span class="op" id="5501969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5501974">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502002">p</span><span class="op" id="5502003">.</span><span class="builtinfunc" id="5502004">print</span><span class="op" id="5502009">(</span><span class="ident" id="5502010">token</span><span class="op" id="5502015">.</span><span class="ident" id="5502016">MUL</span><span class="op" id="5502019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502024">p</span><span class="op" id="5502025">.</span><span class="ident" id="5502026">expr</span><span class="op" id="5502030">(</span><span class="ident" id="5502031">x</span><span class="op" id="5502032">.</span><span class="ident" id="5502033">X</span><span class="op" id="5502034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502038">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502042">case</span>&nbsp;<span class="op" id="5502047">*</span><span class="ident" id="5502048">ast</span><span class="op" id="5502051">.</span><span class="ident" id="5502052">UnaryExpr</span><span class="op" id="5502061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502065">const</span>&nbsp;<span class="ident" id="5502071">prec</span>&nbsp;<span class="op" id="5502076">=</span>&nbsp;<span class="ident" id="5502078">token</span><span class="op" id="5502083">.</span><span class="ident" id="5502084">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502096">if</span>&nbsp;<span class="ident" id="5502099">prec</span>&nbsp;<span class="op" id="5502104">&lt;</span>&nbsp;<span class="ident" id="5502106">prec1</span>&nbsp;<span class="op" id="5502112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502117">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502142">p</span><span class="op" id="5502143">.</span><span class="builtinfunc" id="5502144">print</span><span class="op" id="5502149">(</span><span class="ident" id="5502150">token</span><span class="op" id="5502155">.</span><span class="ident" id="5502156">LPAREN</span><span class="op" id="5502162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502167">p</span><span class="op" id="5502168">.</span><span class="ident" id="5502169">expr</span><span class="op" id="5502173">(</span><span class="ident" id="5502174">x</span><span class="op" id="5502175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502180">p</span><span class="op" id="5502181">.</span><span class="builtinfunc" id="5502182">print</span><span class="op" id="5502187">(</span><span class="ident" id="5502188">token</span><span class="op" id="5502193">.</span><span class="ident" id="5502194">RPAREN</span><span class="op" id="5502200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502204">}</span>&nbsp;<span class="keyword" id="5502206">else</span>&nbsp;<span class="op" id="5502211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502216">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502244">p</span><span class="op" id="5502245">.</span><span class="builtinfunc" id="5502246">print</span><span class="op" id="5502251">(</span><span class="ident" id="5502252">x</span><span class="op" id="5502253">.</span><span class="ident" id="5502254">Op</span><span class="op" id="5502256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502261">if</span>&nbsp;<span class="ident" id="5502264">x</span><span class="op" id="5502265">.</span><span class="ident" id="5502266">Op</span>&nbsp;<span class="op" id="5502269">==</span>&nbsp;<span class="ident" id="5502272">token</span><span class="op" id="5502277">.</span><span class="ident" id="5502278">RANGE</span>&nbsp;<span class="op" id="5502284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502290">//&nbsp;TODO(gri)&nbsp;Remove&nbsp;this&nbsp;code&nbsp;if&nbsp;it&nbsp;cannot&nbsp;be&nbsp;reached.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502349">p</span><span class="op" id="5502350">.</span><span class="builtinfunc" id="5502351">print</span><span class="op" id="5502356">(</span><span class="ident" id="5502357">blank</span><span class="op" id="5502362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502367">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502372">p</span><span class="op" id="5502373">.</span><span class="ident" id="5502374">expr1</span><span class="op" id="5502379">(</span><span class="ident" id="5502380">x</span><span class="op" id="5502381">.</span><span class="ident" id="5502382">X</span><span class="op" id="5502383">,</span>&nbsp;<span class="ident" id="5502385">prec</span><span class="op" id="5502389">,</span>&nbsp;<span class="ident" id="5502391">depth</span><span class="op" id="5502396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502404">case</span>&nbsp;<span class="op" id="5502409">*</span><span class="ident" id="5502410">ast</span><span class="op" id="5502413">.</span><span class="ident" id="5502414">BasicLit</span><span class="op" id="5502422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502426">p</span><span class="op" id="5502427">.</span><span class="builtinfunc" id="5502428">print</span><span class="op" id="5502433">(</span><span class="ident" id="5502434">x</span><span class="op" id="5502435">)</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502439">case</span>&nbsp;<span class="op" id="5502444">*</span><span class="ident" id="5502445">ast</span><span class="op" id="5502448">.</span><span class="ident" id="5502449">FuncLit</span><span class="op" id="5502456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502460">p</span><span class="op" id="5502461">.</span><span class="ident" id="5502462">expr</span><span class="op" id="5502466">(</span><span class="ident" id="5502467">x</span><span class="op" id="5502468">.</span><span class="ident" id="5502469">Type</span><span class="op" id="5502473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502477">p</span><span class="op" id="5502478">.</span><span class="ident" id="5502479">adjBlock</span><span class="op" id="5502487">(</span><span class="ident" id="5502488">p</span><span class="op" id="5502489">.</span><span class="ident" id="5502490">distanceFrom</span><span class="op" id="5502502">(</span><span class="ident" id="5502503">x</span><span class="op" id="5502504">.</span><span class="ident" id="5502505">Type</span><span class="op" id="5502509">.</span><span class="ident" id="5502510">Pos</span><span class="op" id="5502513">(</span><span class="op" id="5502514">)</span><span class="op" id="5502515">)</span><span class="op" id="5502516">,</span>&nbsp;<span class="ident" id="5502518">blank</span><span class="op" id="5502523">,</span>&nbsp;<span class="ident" id="5502525">x</span><span class="op" id="5502526">.</span><span class="ident" id="5502527">Body</span><span class="op" id="5502531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502535">case</span>&nbsp;<span class="op" id="5502540">*</span><span class="ident" id="5502541">ast</span><span class="op" id="5502544">.</span><span class="ident" id="5502545">ParenExpr</span><span class="op" id="5502554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502558">if</span>&nbsp;<span class="ident" id="5502561">_</span><span class="op" id="5502562">,</span>&nbsp;<span class="ident" id="5502564">hasParens</span>&nbsp;<span class="op" id="5502574">:=</span>&nbsp;<span class="ident" id="5502577">x</span><span class="op" id="5502578">.</span><span class="ident" id="5502579">X</span><span class="op" id="5502580">.</span><span class="op" id="5502581">(</span><span class="op" id="5502582">*</span><span class="ident" id="5502583">ast</span><span class="op" id="5502586">.</span><span class="ident" id="5502587">ParenExpr</span><span class="op" id="5502596">)</span><span class="op" id="5502597">;</span>&nbsp;<span class="ident" id="5502599">hasParens</span>&nbsp;<span class="op" id="5502609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502614">//&nbsp;don&#39;t&nbsp;print&nbsp;parentheses&nbsp;around&nbsp;an&nbsp;already&nbsp;parenthesized&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502687">//&nbsp;TODO(gri)&nbsp;consider&nbsp;making&nbsp;this&nbsp;more&nbsp;general&nbsp;and&nbsp;incorporate&nbsp;precedence&nbsp;levels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502771">p</span><span class="op" id="5502772">.</span><span class="ident" id="5502773">expr0</span><span class="op" id="5502778">(</span><span class="ident" id="5502779">x</span><span class="op" id="5502780">.</span><span class="ident" id="5502781">X</span><span class="op" id="5502782">,</span>&nbsp;<span class="ident" id="5502784">depth</span><span class="op" id="5502789">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502793">}</span>&nbsp;<span class="keyword" id="5502795">else</span>&nbsp;<span class="op" id="5502800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502805">p</span><span class="op" id="5502806">.</span><span class="builtinfunc" id="5502807">print</span><span class="op" id="5502812">(</span><span class="ident" id="5502813">token</span><span class="op" id="5502818">.</span><span class="ident" id="5502819">LPAREN</span><span class="op" id="5502825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502830">p</span><span class="op" id="5502831">.</span><span class="ident" id="5502832">expr0</span><span class="op" id="5502837">(</span><span class="ident" id="5502838">x</span><span class="op" id="5502839">.</span><span class="ident" id="5502840">X</span><span class="op" id="5502841">,</span>&nbsp;<span class="ident" id="5502843">reduceDepth</span><span class="op" id="5502854">(</span><span class="ident" id="5502855">depth</span><span class="op" id="5502860">)</span><span class="op" id="5502861">)</span>&nbsp;<span class="comment" id="5502863">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502905">p</span><span class="op" id="5502906">.</span><span class="builtinfunc" id="5502907">print</span><span class="op" id="5502912">(</span><span class="ident" id="5502913">x</span><span class="op" id="5502914">.</span><span class="ident" id="5502915">Rparen</span><span class="op" id="5502921">,</span>&nbsp;<span class="ident" id="5502923">token</span><span class="op" id="5502928">.</span><span class="ident" id="5502929">RPAREN</span><span class="op" id="5502935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502939">}</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502943">case</span>&nbsp;<span class="op" id="5502948">*</span><span class="ident" id="5502949">ast</span><span class="op" id="5502952">.</span><span class="ident" id="5502953">SelectorExpr</span><span class="op" id="5502965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502969">p</span><span class="op" id="5502970">.</span><span class="ident" id="5502971">expr1</span><span class="op" id="5502976">(</span><span class="ident" id="5502977">x</span><span class="op" id="5502978">.</span><span class="ident" id="5502979">X</span><span class="op" id="5502980">,</span>&nbsp;<span class="ident" id="5502982">token</span><span class="op" id="5502987">.</span><span class="ident" id="5502988">HighestPrec</span><span class="op" id="5502999">,</span>&nbsp;<span class="ident" id="5503001">depth</span><span class="op" id="5503006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503010">p</span><span class="op" id="5503011">.</span><span class="builtinfunc" id="5503012">print</span><span class="op" id="5503017">(</span><span class="ident" id="5503018">token</span><span class="op" id="5503023">.</span><span class="ident" id="5503024">PERIOD</span><span class="op" id="5503030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503034">if</span>&nbsp;<span class="ident" id="5503037">line</span>&nbsp;<span class="op" id="5503042">:=</span>&nbsp;<span class="ident" id="5503045">p</span><span class="op" id="5503046">.</span><span class="ident" id="5503047">lineFor</span><span class="op" id="5503054">(</span><span class="ident" id="5503055">x</span><span class="op" id="5503056">.</span><span class="ident" id="5503057">Sel</span><span class="op" id="5503060">.</span><span class="ident" id="5503061">Pos</span><span class="op" id="5503064">(</span><span class="op" id="5503065">)</span><span class="op" id="5503066">)</span><span class="op" id="5503067">;</span>&nbsp;<span class="ident" id="5503069">p</span><span class="op" id="5503070">.</span><span class="ident" id="5503071">pos</span><span class="op" id="5503074">.</span><span class="ident" id="5503075">IsValid</span><span class="op" id="5503082">(</span><span class="op" id="5503083">)</span>&nbsp;<span class="op" id="5503085">&amp;&amp;</span>&nbsp;<span class="ident" id="5503088">p</span><span class="op" id="5503089">.</span><span class="ident" id="5503090">pos</span><span class="op" id="5503093">.</span><span class="ident" id="5503094">Line</span>&nbsp;<span class="op" id="5503099">&lt;</span>&nbsp;<span class="ident" id="5503101">line</span>&nbsp;<span class="op" id="5503106">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503111">p</span><span class="op" id="5503112">.</span><span class="builtinfunc" id="5503113">print</span><span class="op" id="5503118">(</span><span class="ident" id="5503119">indent</span><span class="op" id="5503125">,</span>&nbsp;<span class="ident" id="5503127">newline</span><span class="op" id="5503134">,</span>&nbsp;<span class="ident" id="5503136">x</span><span class="op" id="5503137">.</span><span class="ident" id="5503138">Sel</span><span class="op" id="5503141">.</span><span class="ident" id="5503142">Pos</span><span class="op" id="5503145">(</span><span class="op" id="5503146">)</span><span class="op" id="5503147">,</span>&nbsp;<span class="ident" id="5503149">x</span><span class="op" id="5503150">.</span><span class="ident" id="5503151">Sel</span><span class="op" id="5503154">,</span>&nbsp;<span class="ident" id="5503156">unindent</span><span class="op" id="5503164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503168">}</span>&nbsp;<span class="keyword" id="5503170">else</span>&nbsp;<span class="op" id="5503175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503180">p</span><span class="op" id="5503181">.</span><span class="builtinfunc" id="5503182">print</span><span class="op" id="5503187">(</span><span class="ident" id="5503188">x</span><span class="op" id="5503189">.</span><span class="ident" id="5503190">Sel</span><span class="op" id="5503193">.</span><span class="ident" id="5503194">Pos</span><span class="op" id="5503197">(</span><span class="op" id="5503198">)</span><span class="op" id="5503199">,</span>&nbsp;<span class="ident" id="5503201">x</span><span class="op" id="5503202">.</span><span class="ident" id="5503203">Sel</span><span class="op" id="5503206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503214">case</span>&nbsp;<span class="op" id="5503219">*</span><span class="ident" id="5503220">ast</span><span class="op" id="5503223">.</span><span class="ident" id="5503224">TypeAssertExpr</span><span class="op" id="5503238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503242">p</span><span class="op" id="5503243">.</span><span class="ident" id="5503244">expr1</span><span class="op" id="5503249">(</span><span class="ident" id="5503250">x</span><span class="op" id="5503251">.</span><span class="ident" id="5503252">X</span><span class="op" id="5503253">,</span>&nbsp;<span class="ident" id="5503255">token</span><span class="op" id="5503260">.</span><span class="ident" id="5503261">HighestPrec</span><span class="op" id="5503272">,</span>&nbsp;<span class="ident" id="5503274">depth</span><span class="op" id="5503279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503283">p</span><span class="op" id="5503284">.</span><span class="builtinfunc" id="5503285">print</span><span class="op" id="5503290">(</span><span class="ident" id="5503291">token</span><span class="op" id="5503296">.</span><span class="ident" id="5503297">PERIOD</span><span class="op" id="5503303">,</span>&nbsp;<span class="ident" id="5503305">x</span><span class="op" id="5503306">.</span><span class="ident" id="5503307">Lparen</span><span class="op" id="5503313">,</span>&nbsp;<span class="ident" id="5503315">token</span><span class="op" id="5503320">.</span><span class="ident" id="5503321">LPAREN</span><span class="op" id="5503327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503331">if</span>&nbsp;<span class="ident" id="5503334">x</span><span class="op" id="5503335">.</span><span class="ident" id="5503336">Type</span>&nbsp;<span class="op" id="5503341">!=</span>&nbsp;<span class="builtintype" id="5503344">nil</span>&nbsp;<span class="op" id="5503348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503353">p</span><span class="op" id="5503354">.</span><span class="ident" id="5503355">expr</span><span class="op" id="5503359">(</span><span class="ident" id="5503360">x</span><span class="op" id="5503361">.</span><span class="ident" id="5503362">Type</span><span class="op" id="5503366">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503370">}</span>&nbsp;<span class="keyword" id="5503372">else</span>&nbsp;<span class="op" id="5503377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503382">p</span><span class="op" id="5503383">.</span><span class="builtinfunc" id="5503384">print</span><span class="op" id="5503389">(</span><span class="ident" id="5503390">token</span><span class="op" id="5503395">.</span><span class="ident" id="5503396">TYPE</span><span class="op" id="5503400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503408">p</span><span class="op" id="5503409">.</span><span class="builtinfunc" id="5503410">print</span><span class="op" id="5503415">(</span><span class="ident" id="5503416">x</span><span class="op" id="5503417">.</span><span class="ident" id="5503418">Rparen</span><span class="op" id="5503424">,</span>&nbsp;<span class="ident" id="5503426">token</span><span class="op" id="5503431">.</span><span class="ident" id="5503432">RPAREN</span><span class="op" id="5503438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503442">case</span>&nbsp;<span class="op" id="5503447">*</span><span class="ident" id="5503448">ast</span><span class="op" id="5503451">.</span><span class="ident" id="5503452">IndexExpr</span><span class="op" id="5503461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503465">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503541">p</span><span class="op" id="5503542">.</span><span class="ident" id="5503543">expr1</span><span class="op" id="5503548">(</span><span class="ident" id="5503549">x</span><span class="op" id="5503550">.</span><span class="ident" id="5503551">X</span><span class="op" id="5503552">,</span>&nbsp;<span class="ident" id="5503554">token</span><span class="op" id="5503559">.</span><span class="ident" id="5503560">HighestPrec</span><span class="op" id="5503571">,</span>&nbsp;<span class="num" id="5503573">1</span><span class="op" id="5503574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503578">p</span><span class="op" id="5503579">.</span><span class="builtinfunc" id="5503580">print</span><span class="op" id="5503585">(</span><span class="ident" id="5503586">x</span><span class="op" id="5503587">.</span><span class="ident" id="5503588">Lbrack</span><span class="op" id="5503594">,</span>&nbsp;<span class="ident" id="5503596">token</span><span class="op" id="5503601">.</span><span class="ident" id="5503602">LBRACK</span><span class="op" id="5503608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503612">p</span><span class="op" id="5503613">.</span><span class="ident" id="5503614">expr0</span><span class="op" id="5503619">(</span><span class="ident" id="5503620">x</span><span class="op" id="5503621">.</span><span class="ident" id="5503622">Index</span><span class="op" id="5503627">,</span>&nbsp;<span class="ident" id="5503629">depth</span><span class="op" id="5503634">+</span><span class="num" id="5503635">1</span><span class="op" id="5503636">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503640">p</span><span class="op" id="5503641">.</span><span class="builtinfunc" id="5503642">print</span><span class="op" id="5503647">(</span><span class="ident" id="5503648">x</span><span class="op" id="5503649">.</span><span class="ident" id="5503650">Rbrack</span><span class="op" id="5503656">,</span>&nbsp;<span class="ident" id="5503658">token</span><span class="op" id="5503663">.</span><span class="ident" id="5503664">RBRACK</span><span class="op" id="5503670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503674">case</span>&nbsp;<span class="op" id="5503679">*</span><span class="ident" id="5503680">ast</span><span class="op" id="5503683">.</span><span class="ident" id="5503684">SliceExpr</span><span class="op" id="5503693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503697">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503773">p</span><span class="op" id="5503774">.</span><span class="ident" id="5503775">expr1</span><span class="op" id="5503780">(</span><span class="ident" id="5503781">x</span><span class="op" id="5503782">.</span><span class="ident" id="5503783">X</span><span class="op" id="5503784">,</span>&nbsp;<span class="ident" id="5503786">token</span><span class="op" id="5503791">.</span><span class="ident" id="5503792">HighestPrec</span><span class="op" id="5503803">,</span>&nbsp;<span class="num" id="5503805">1</span><span class="op" id="5503806">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503810">p</span><span class="op" id="5503811">.</span><span class="builtinfunc" id="5503812">print</span><span class="op" id="5503817">(</span><span class="ident" id="5503818">x</span><span class="op" id="5503819">.</span><span class="ident" id="5503820">Lbrack</span><span class="op" id="5503826">,</span>&nbsp;<span class="ident" id="5503828">token</span><span class="op" id="5503833">.</span><span class="ident" id="5503834">LBRACK</span><span class="op" id="5503840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503844">indices</span>&nbsp;<span class="op" id="5503852">:=</span>&nbsp;<span class="op" id="5503855">[</span><span class="op" id="5503856">]</span><span class="ident" id="5503857">ast</span><span class="op" id="5503860">.</span><span class="ident" id="5503861">Expr</span><span class="op" id="5503865">{</span><span class="ident" id="5503866">x</span><span class="op" id="5503867">.</span><span class="ident" id="5503868">Low</span><span class="op" id="5503871">,</span>&nbsp;<span class="ident" id="5503873">x</span><span class="op" id="5503874">.</span><span class="ident" id="5503875">High</span><span class="op" id="5503879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503883">if</span>&nbsp;<span class="ident" id="5503886">x</span><span class="op" id="5503887">.</span><span class="ident" id="5503888">Max</span>&nbsp;<span class="op" id="5503892">!=</span>&nbsp;<span class="builtintype" id="5503895">nil</span>&nbsp;<span class="op" id="5503899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5503904">indices</span>&nbsp;<span class="op" id="5503912">=</span>&nbsp;<span class="builtinfunc" id="5503914">append</span><span class="op" id="5503920">(</span><span class="ident" id="5503921">indices</span><span class="op" id="5503928">,</span>&nbsp;<span class="ident" id="5503930">x</span><span class="op" id="5503931">.</span><span class="ident" id="5503932">Max</span><span class="op" id="5503935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503939">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503943">for</span>&nbsp;<span class="ident" id="5503947">i</span><span class="op" id="5503948">,</span>&nbsp;<span class="ident" id="5503950">y</span>&nbsp;<span class="op" id="5503952">:=</span>&nbsp;<span class="keyword" id="5503955">range</span>&nbsp;<span class="ident" id="5503961">indices</span>&nbsp;<span class="op" id="5503969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503974">if</span>&nbsp;<span class="ident" id="5503977">i</span>&nbsp;<span class="op" id="5503979">&gt;</span>&nbsp;<span class="num" id="5503981">0</span>&nbsp;<span class="op" id="5503983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503989">//&nbsp;blanks&nbsp;around&nbsp;&#34;:&#34;&nbsp;if&nbsp;both&nbsp;sides&nbsp;exist&nbsp;and&nbsp;either&nbsp;side&nbsp;is&nbsp;a&nbsp;binary&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5504073">//&nbsp;TODO(gri)&nbsp;once&nbsp;we&nbsp;have&nbsp;committed&nbsp;a&nbsp;variant&nbsp;of&nbsp;a[i:j:k]&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;fine-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5504156">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tune&nbsp;the&nbsp;formatting&nbsp;here</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504198">x</span>&nbsp;<span class="op" id="5504200">:=</span>&nbsp;<span class="ident" id="5504203">indices</span><span class="op" id="5504210">[</span><span class="ident" id="5504211">i</span><span class="op" id="5504212">-</span><span class="num" id="5504213">1</span><span class="op" id="5504214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504220">if</span>&nbsp;<span class="ident" id="5504223">depth</span>&nbsp;<span class="op" id="5504229">&lt;=</span>&nbsp;<span class="num" id="5504232">1</span>&nbsp;<span class="op" id="5504234">&amp;&amp;</span>&nbsp;<span class="ident" id="5504237">x</span>&nbsp;<span class="op" id="5504239">!=</span>&nbsp;<span class="builtintype" id="5504242">nil</span>&nbsp;<span class="op" id="5504246">&amp;&amp;</span>&nbsp;<span class="ident" id="5504249">y</span>&nbsp;<span class="op" id="5504251">!=</span>&nbsp;<span class="builtintype" id="5504254">nil</span>&nbsp;<span class="op" id="5504258">&amp;&amp;</span>&nbsp;<span class="op" id="5504261">(</span><span class="ident" id="5504262">isBinary</span><span class="op" id="5504270">(</span><span class="ident" id="5504271">x</span><span class="op" id="5504272">)</span>&nbsp;<span class="op" id="5504274">||</span>&nbsp;<span class="ident" id="5504277">isBinary</span><span class="op" id="5504285">(</span><span class="ident" id="5504286">y</span><span class="op" id="5504287">)</span><span class="op" id="5504288">)</span>&nbsp;<span class="op" id="5504290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504297">p</span><span class="op" id="5504298">.</span><span class="builtinfunc" id="5504299">print</span><span class="op" id="5504304">(</span><span class="ident" id="5504305">blank</span><span class="op" id="5504310">,</span>&nbsp;<span class="ident" id="5504312">token</span><span class="op" id="5504317">.</span><span class="ident" id="5504318">COLON</span><span class="op" id="5504323">,</span>&nbsp;<span class="ident" id="5504325">blank</span><span class="op" id="5504330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504336">}</span>&nbsp;<span class="keyword" id="5504338">else</span>&nbsp;<span class="op" id="5504343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504350">p</span><span class="op" id="5504351">.</span><span class="builtinfunc" id="5504352">print</span><span class="op" id="5504357">(</span><span class="ident" id="5504358">token</span><span class="op" id="5504363">.</span><span class="ident" id="5504364">COLON</span><span class="op" id="5504369">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504385">if</span>&nbsp;<span class="ident" id="5504388">y</span>&nbsp;<span class="op" id="5504390">!=</span>&nbsp;<span class="builtintype" id="5504393">nil</span>&nbsp;<span class="op" id="5504397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504403">p</span><span class="op" id="5504404">.</span><span class="ident" id="5504405">expr0</span><span class="op" id="5504410">(</span><span class="ident" id="5504411">y</span><span class="op" id="5504412">,</span>&nbsp;<span class="ident" id="5504414">depth</span><span class="op" id="5504419">+</span><span class="num" id="5504420">1</span><span class="op" id="5504421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504426">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504434">p</span><span class="op" id="5504435">.</span><span class="builtinfunc" id="5504436">print</span><span class="op" id="5504441">(</span><span class="ident" id="5504442">x</span><span class="op" id="5504443">.</span><span class="ident" id="5504444">Rbrack</span><span class="op" id="5504450">,</span>&nbsp;<span class="ident" id="5504452">token</span><span class="op" id="5504457">.</span><span class="ident" id="5504458">RBRACK</span><span class="op" id="5504464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504468">case</span>&nbsp;<span class="op" id="5504473">*</span><span class="ident" id="5504474">ast</span><span class="op" id="5504477">.</span><span class="ident" id="5504478">CallExpr</span><span class="op" id="5504486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504490">if</span>&nbsp;<span class="builtinfunc" id="5504493">len</span><span class="op" id="5504496">(</span><span class="ident" id="5504497">x</span><span class="op" id="5504498">.</span><span class="ident" id="5504499">Args</span><span class="op" id="5504503">)</span>&nbsp;<span class="op" id="5504505">&gt;</span>&nbsp;<span class="num" id="5504507">1</span>&nbsp;<span class="op" id="5504509">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504514">depth</span><span class="op" id="5504519">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504528">if</span>&nbsp;<span class="ident" id="5504531">_</span><span class="op" id="5504532">,</span>&nbsp;<span class="ident" id="5504534">ok</span>&nbsp;<span class="op" id="5504537">:=</span>&nbsp;<span class="ident" id="5504540">x</span><span class="op" id="5504541">.</span><span class="ident" id="5504542">Fun</span><span class="op" id="5504545">.</span><span class="op" id="5504546">(</span><span class="op" id="5504547">*</span><span class="ident" id="5504548">ast</span><span class="op" id="5504551">.</span><span class="ident" id="5504552">FuncType</span><span class="op" id="5504560">)</span><span class="op" id="5504561">;</span>&nbsp;<span class="ident" id="5504563">ok</span>&nbsp;<span class="op" id="5504566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5504571">//&nbsp;conversions&nbsp;to&nbsp;literal&nbsp;function&nbsp;types&nbsp;require&nbsp;parentheses&nbsp;around&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504651">p</span><span class="op" id="5504652">.</span><span class="builtinfunc" id="5504653">print</span><span class="op" id="5504658">(</span><span class="ident" id="5504659">token</span><span class="op" id="5504664">.</span><span class="ident" id="5504665">LPAREN</span><span class="op" id="5504671">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504676">p</span><span class="op" id="5504677">.</span><span class="ident" id="5504678">expr1</span><span class="op" id="5504683">(</span><span class="ident" id="5504684">x</span><span class="op" id="5504685">.</span><span class="ident" id="5504686">Fun</span><span class="op" id="5504689">,</span>&nbsp;<span class="ident" id="5504691">token</span><span class="op" id="5504696">.</span><span class="ident" id="5504697">HighestPrec</span><span class="op" id="5504708">,</span>&nbsp;<span class="ident" id="5504710">depth</span><span class="op" id="5504715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504720">p</span><span class="op" id="5504721">.</span><span class="builtinfunc" id="5504722">print</span><span class="op" id="5504727">(</span><span class="ident" id="5504728">token</span><span class="op" id="5504733">.</span><span class="ident" id="5504734">RPAREN</span><span class="op" id="5504740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504744">}</span>&nbsp;<span class="keyword" id="5504746">else</span>&nbsp;<span class="op" id="5504751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504756">p</span><span class="op" id="5504757">.</span><span class="ident" id="5504758">expr1</span><span class="op" id="5504763">(</span><span class="ident" id="5504764">x</span><span class="op" id="5504765">.</span><span class="ident" id="5504766">Fun</span><span class="op" id="5504769">,</span>&nbsp;<span class="ident" id="5504771">token</span><span class="op" id="5504776">.</span><span class="ident" id="5504777">HighestPrec</span><span class="op" id="5504788">,</span>&nbsp;<span class="ident" id="5504790">depth</span><span class="op" id="5504795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504799">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504803">p</span><span class="op" id="5504804">.</span><span class="builtinfunc" id="5504805">print</span><span class="op" id="5504810">(</span><span class="ident" id="5504811">x</span><span class="op" id="5504812">.</span><span class="ident" id="5504813">Lparen</span><span class="op" id="5504819">,</span>&nbsp;<span class="ident" id="5504821">token</span><span class="op" id="5504826">.</span><span class="ident" id="5504827">LPAREN</span><span class="op" id="5504833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504837">if</span>&nbsp;<span class="ident" id="5504840">x</span><span class="op" id="5504841">.</span><span class="ident" id="5504842">Ellipsis</span><span class="op" id="5504850">.</span><span class="ident" id="5504851">IsValid</span><span class="op" id="5504858">(</span><span class="op" id="5504859">)</span>&nbsp;<span class="op" id="5504861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504866">p</span><span class="op" id="5504867">.</span><span class="ident" id="5504868">exprList</span><span class="op" id="5504876">(</span><span class="ident" id="5504877">x</span><span class="op" id="5504878">.</span><span class="ident" id="5504879">Lparen</span><span class="op" id="5504885">,</span>&nbsp;<span class="ident" id="5504887">x</span><span class="op" id="5504888">.</span><span class="ident" id="5504889">Args</span><span class="op" id="5504893">,</span>&nbsp;<span class="ident" id="5504895">depth</span><span class="op" id="5504900">,</span>&nbsp;<span class="num" id="5504902">0</span><span class="op" id="5504903">,</span>&nbsp;<span class="ident" id="5504905">x</span><span class="op" id="5504906">.</span><span class="ident" id="5504907">Ellipsis</span><span class="op" id="5504915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504920">p</span><span class="op" id="5504921">.</span><span class="builtinfunc" id="5504922">print</span><span class="op" id="5504927">(</span><span class="ident" id="5504928">x</span><span class="op" id="5504929">.</span><span class="ident" id="5504930">Ellipsis</span><span class="op" id="5504938">,</span>&nbsp;<span class="ident" id="5504940">token</span><span class="op" id="5504945">.</span><span class="ident" id="5504946">ELLIPSIS</span><span class="op" id="5504954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504959">if</span>&nbsp;<span class="ident" id="5504962">x</span><span class="op" id="5504963">.</span><span class="ident" id="5504964">Rparen</span><span class="op" id="5504970">.</span><span class="ident" id="5504971">IsValid</span><span class="op" id="5504978">(</span><span class="op" id="5504979">)</span>&nbsp;<span class="op" id="5504981">&amp;&amp;</span>&nbsp;<span class="ident" id="5504984">p</span><span class="op" id="5504985">.</span><span class="ident" id="5504986">lineFor</span><span class="op" id="5504993">(</span><span class="ident" id="5504994">x</span><span class="op" id="5504995">.</span><span class="ident" id="5504996">Ellipsis</span><span class="op" id="5505004">)</span>&nbsp;<span class="op" id="5505006">&lt;</span>&nbsp;<span class="ident" id="5505008">p</span><span class="op" id="5505009">.</span><span class="ident" id="5505010">lineFor</span><span class="op" id="5505017">(</span><span class="ident" id="5505018">x</span><span class="op" id="5505019">.</span><span class="ident" id="5505020">Rparen</span><span class="op" id="5505026">)</span>&nbsp;<span class="op" id="5505028">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505034">p</span><span class="op" id="5505035">.</span><span class="builtinfunc" id="5505036">print</span><span class="op" id="5505041">(</span><span class="ident" id="5505042">token</span><span class="op" id="5505047">.</span><span class="ident" id="5505048">COMMA</span><span class="op" id="5505053">,</span>&nbsp;<span class="ident" id="5505055">formfeed</span><span class="op" id="5505063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505072">}</span>&nbsp;<span class="keyword" id="5505074">else</span>&nbsp;<span class="op" id="5505079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505084">p</span><span class="op" id="5505085">.</span><span class="ident" id="5505086">exprList</span><span class="op" id="5505094">(</span><span class="ident" id="5505095">x</span><span class="op" id="5505096">.</span><span class="ident" id="5505097">Lparen</span><span class="op" id="5505103">,</span>&nbsp;<span class="ident" id="5505105">x</span><span class="op" id="5505106">.</span><span class="ident" id="5505107">Args</span><span class="op" id="5505111">,</span>&nbsp;<span class="ident" id="5505113">depth</span><span class="op" id="5505118">,</span>&nbsp;<span class="ident" id="5505120">commaTerm</span><span class="op" id="5505129">,</span>&nbsp;<span class="ident" id="5505131">x</span><span class="op" id="5505132">.</span><span class="ident" id="5505133">Rparen</span><span class="op" id="5505139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505143">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505147">p</span><span class="op" id="5505148">.</span><span class="builtinfunc" id="5505149">print</span><span class="op" id="5505154">(</span><span class="ident" id="5505155">x</span><span class="op" id="5505156">.</span><span class="ident" id="5505157">Rparen</span><span class="op" id="5505163">,</span>&nbsp;<span class="ident" id="5505165">token</span><span class="op" id="5505170">.</span><span class="ident" id="5505171">RPAREN</span><span class="op" id="5505177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505181">case</span>&nbsp;<span class="op" id="5505186">*</span><span class="ident" id="5505187">ast</span><span class="op" id="5505190">.</span><span class="ident" id="5505191">CompositeLit</span><span class="op" id="5505203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505207">//&nbsp;composite&nbsp;literal&nbsp;elements&nbsp;that&nbsp;are&nbsp;composite&nbsp;literals&nbsp;themselves&nbsp;may&nbsp;have&nbsp;the&nbsp;type&nbsp;omitted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505304">if</span>&nbsp;<span class="ident" id="5505307">x</span><span class="op" id="5505308">.</span><span class="ident" id="5505309">Type</span>&nbsp;<span class="op" id="5505314">!=</span>&nbsp;<span class="builtintype" id="5505317">nil</span>&nbsp;<span class="op" id="5505321">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505326">p</span><span class="op" id="5505327">.</span><span class="ident" id="5505328">expr1</span><span class="op" id="5505333">(</span><span class="ident" id="5505334">x</span><span class="op" id="5505335">.</span><span class="ident" id="5505336">Type</span><span class="op" id="5505340">,</span>&nbsp;<span class="ident" id="5505342">token</span><span class="op" id="5505347">.</span><span class="ident" id="5505348">HighestPrec</span><span class="op" id="5505359">,</span>&nbsp;<span class="ident" id="5505361">depth</span><span class="op" id="5505366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505374">p</span><span class="op" id="5505375">.</span><span class="builtinfunc" id="5505376">print</span><span class="op" id="5505381">(</span><span class="ident" id="5505382">x</span><span class="op" id="5505383">.</span><span class="ident" id="5505384">Lbrace</span><span class="op" id="5505390">,</span>&nbsp;<span class="ident" id="5505392">token</span><span class="op" id="5505397">.</span><span class="ident" id="5505398">LBRACE</span><span class="op" id="5505404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505408">p</span><span class="op" id="5505409">.</span><span class="ident" id="5505410">exprList</span><span class="op" id="5505418">(</span><span class="ident" id="5505419">x</span><span class="op" id="5505420">.</span><span class="ident" id="5505421">Lbrace</span><span class="op" id="5505427">,</span>&nbsp;<span class="ident" id="5505429">x</span><span class="op" id="5505430">.</span><span class="ident" id="5505431">Elts</span><span class="op" id="5505435">,</span>&nbsp;<span class="num" id="5505437">1</span><span class="op" id="5505438">,</span>&nbsp;<span class="ident" id="5505440">commaTerm</span><span class="op" id="5505449">,</span>&nbsp;<span class="ident" id="5505451">x</span><span class="op" id="5505452">.</span><span class="ident" id="5505453">Rbrace</span><span class="op" id="5505459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505463">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;line&nbsp;break&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505528">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;as&nbsp;it&nbsp;might&nbsp;break&nbsp;the&nbsp;code&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505592">//&nbsp;is&nbsp;no&nbsp;trailing&nbsp;&#39;,&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505616">mode</span>&nbsp;<span class="op" id="5505621">:=</span>&nbsp;<span class="ident" id="5505624">noExtraLinebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505643">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;blank&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505703">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;the&nbsp;literal&nbsp;is&nbsp;empty</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505759">if</span>&nbsp;<span class="builtinfunc" id="5505762">len</span><span class="op" id="5505765">(</span><span class="ident" id="5505766">x</span><span class="op" id="5505767">.</span><span class="ident" id="5505768">Elts</span><span class="op" id="5505772">)</span>&nbsp;<span class="op" id="5505774">&gt;</span>&nbsp;<span class="num" id="5505776">0</span>&nbsp;<span class="op" id="5505778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505783">mode</span>&nbsp;<span class="op" id="5505788">|=</span>&nbsp;<span class="ident" id="5505791">noExtraBlank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505810">p</span><span class="op" id="5505811">.</span><span class="builtinfunc" id="5505812">print</span><span class="op" id="5505817">(</span><span class="ident" id="5505818">mode</span><span class="op" id="5505822">,</span>&nbsp;<span class="ident" id="5505824">x</span><span class="op" id="5505825">.</span><span class="ident" id="5505826">Rbrace</span><span class="op" id="5505832">,</span>&nbsp;<span class="ident" id="5505834">token</span><span class="op" id="5505839">.</span><span class="ident" id="5505840">RBRACE</span><span class="op" id="5505846">,</span>&nbsp;<span class="ident" id="5505848">mode</span><span class="op" id="5505852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505856">case</span>&nbsp;<span class="op" id="5505861">*</span><span class="ident" id="5505862">ast</span><span class="op" id="5505865">.</span><span class="ident" id="5505866">Ellipsis</span><span class="op" id="5505874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505878">p</span><span class="op" id="5505879">.</span><span class="builtinfunc" id="5505880">print</span><span class="op" id="5505885">(</span><span class="ident" id="5505886">token</span><span class="op" id="5505891">.</span><span class="ident" id="5505892">ELLIPSIS</span><span class="op" id="5505900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505904">if</span>&nbsp;<span class="ident" id="5505907">x</span><span class="op" id="5505908">.</span><span class="ident" id="5505909">Elt</span>&nbsp;<span class="op" id="5505913">!=</span>&nbsp;<span class="builtintype" id="5505916">nil</span>&nbsp;<span class="op" id="5505920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505925">p</span><span class="op" id="5505926">.</span><span class="ident" id="5505927">expr</span><span class="op" id="5505931">(</span><span class="ident" id="5505932">x</span><span class="op" id="5505933">.</span><span class="ident" id="5505934">Elt</span><span class="op" id="5505937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505941">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505945">case</span>&nbsp;<span class="op" id="5505950">*</span><span class="ident" id="5505951">ast</span><span class="op" id="5505954">.</span><span class="ident" id="5505955">ArrayType</span><span class="op" id="5505964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505968">p</span><span class="op" id="5505969">.</span><span class="builtinfunc" id="5505970">print</span><span class="op" id="5505975">(</span><span class="ident" id="5505976">token</span><span class="op" id="5505981">.</span><span class="ident" id="5505982">LBRACK</span><span class="op" id="5505988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505992">if</span>&nbsp;<span class="ident" id="5505995">x</span><span class="op" id="5505996">.</span><span class="ident" id="5505997">Len</span>&nbsp;<span class="op" id="5506001">!=</span>&nbsp;<span class="builtintype" id="5506004">nil</span>&nbsp;<span class="op" id="5506008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506013">p</span><span class="op" id="5506014">.</span><span class="ident" id="5506015">expr</span><span class="op" id="5506019">(</span><span class="ident" id="5506020">x</span><span class="op" id="5506021">.</span><span class="ident" id="5506022">Len</span><span class="op" id="5506025">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5506029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506033">p</span><span class="op" id="5506034">.</span><span class="builtinfunc" id="5506035">print</span><span class="op" id="5506040">(</span><span class="ident" id="5506041">token</span><span class="op" id="5506046">.</span><span class="ident" id="5506047">RBRACK</span><span class="op" id="5506053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506057">p</span><span class="op" id="5506058">.</span><span class="ident" id="5506059">expr</span><span class="op" id="5506063">(</span><span class="ident" id="5506064">x</span><span class="op" id="5506065">.</span><span class="ident" id="5506066">Elt</span><span class="op" id="5506069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506073">case</span>&nbsp;<span class="op" id="5506078">*</span><span class="ident" id="5506079">ast</span><span class="op" id="5506082">.</span><span class="ident" id="5506083">StructType</span><span class="op" id="5506093">:</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506097">p</span><span class="op" id="5506098">.</span><span class="builtinfunc" id="5506099">print</span><span class="op" id="5506104">(</span><span class="ident" id="5506105">token</span><span class="op" id="5506110">.</span><span class="ident" id="5506111">STRUCT</span><span class="op" id="5506117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506121">p</span><span class="op" id="5506122">.</span><span class="ident" id="5506123">fieldList</span><span class="op" id="5506132">(</span><span class="ident" id="5506133">x</span><span class="op" id="5506134">.</span><span class="ident" id="5506135">Fields</span><span class="op" id="5506141">,</span>&nbsp;<span class="builtintype" id="5506143">true</span><span class="op" id="5506147">,</span>&nbsp;<span class="ident" id="5506149">x</span><span class="op" id="5506150">.</span><span class="ident" id="5506151">Incomplete</span><span class="op" id="5506161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506165">case</span>&nbsp;<span class="op" id="5506170">*</span><span class="ident" id="5506171">ast</span><span class="op" id="5506174">.</span><span class="ident" id="5506175">FuncType</span><span class="op" id="5506183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506187">p</span><span class="op" id="5506188">.</span><span class="builtinfunc" id="5506189">print</span><span class="op" id="5506194">(</span><span class="ident" id="5506195">token</span><span class="op" id="5506200">.</span><span class="ident" id="5506201">FUNC</span><span class="op" id="5506205">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506209">p</span><span class="op" id="5506210">.</span><span class="ident" id="5506211">signature</span><span class="op" id="5506220">(</span><span class="ident" id="5506221">x</span><span class="op" id="5506222">.</span><span class="ident" id="5506223">Params</span><span class="op" id="5506229">,</span>&nbsp;<span class="ident" id="5506231">x</span><span class="op" id="5506232">.</span><span class="ident" id="5506233">Results</span><span class="op" id="5506240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506244">case</span>&nbsp;<span class="op" id="5506249">*</span><span class="ident" id="5506250">ast</span><span class="op" id="5506253">.</span><span class="ident" id="5506254">InterfaceType</span><span class="op" id="5506267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506271">p</span><span class="op" id="5506272">.</span><span class="builtinfunc" id="5506273">print</span><span class="op" id="5506278">(</span><span class="ident" id="5506279">token</span><span class="op" id="5506284">.</span><span class="ident" id="5506285">INTERFACE</span><span class="op" id="5506294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506298">p</span><span class="op" id="5506299">.</span><span class="ident" id="5506300">fieldList</span><span class="op" id="5506309">(</span><span class="ident" id="5506310">x</span><span class="op" id="5506311">.</span><span class="ident" id="5506312">Methods</span><span class="op" id="5506319">,</span>&nbsp;<span class="builtintype" id="5506321">false</span><span class="op" id="5506326">,</span>&nbsp;<span class="ident" id="5506328">x</span><span class="op" id="5506329">.</span><span class="ident" id="5506330">Incomplete</span><span class="op" id="5506340">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506344">case</span>&nbsp;<span class="op" id="5506349">*</span><span class="ident" id="5506350">ast</span><span class="op" id="5506353">.</span><span class="ident" id="5506354">MapType</span><span class="op" id="5506361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506365">p</span><span class="op" id="5506366">.</span><span class="builtinfunc" id="5506367">print</span><span class="op" id="5506372">(</span><span class="ident" id="5506373">token</span><span class="op" id="5506378">.</span><span class="ident" id="5506379">MAP</span><span class="op" id="5506382">,</span>&nbsp;<span class="ident" id="5506384">token</span><span class="op" id="5506389">.</span><span class="ident" id="5506390">LBRACK</span><span class="op" id="5506396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506400">p</span><span class="op" id="5506401">.</span><span class="ident" id="5506402">expr</span><span class="op" id="5506406">(</span><span class="ident" id="5506407">x</span><span class="op" id="5506408">.</span><span class="ident" id="5506409">Key</span><span class="op" id="5506412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506416">p</span><span class="op" id="5506417">.</span><span class="builtinfunc" id="5506418">print</span><span class="op" id="5506423">(</span><span class="ident" id="5506424">token</span><span class="op" id="5506429">.</span><span class="ident" id="5506430">RBRACK</span><span class="op" id="5506436">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506440">p</span><span class="op" id="5506441">.</span><span class="ident" id="5506442">expr</span><span class="op" id="5506446">(</span><span class="ident" id="5506447">x</span><span class="op" id="5506448">.</span><span class="ident" id="5506449">Value</span><span class="op" id="5506454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506458">case</span>&nbsp;<span class="op" id="5506463">*</span><span class="ident" id="5506464">ast</span><span class="op" id="5506467">.</span><span class="ident" id="5506468">ChanType</span><span class="op" id="5506476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506480">switch</span>&nbsp;<span class="ident" id="5506487">x</span><span class="op" id="5506488">.</span><span class="ident" id="5506489">Dir</span>&nbsp;<span class="op" id="5506493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506497">case</span>&nbsp;<span class="ident" id="5506502">ast</span><span class="op" id="5506505">.</span><span class="ident" id="5506506">SEND</span>&nbsp;<span class="op" id="5506511">|</span>&nbsp;<span class="ident" id="5506513">ast</span><span class="op" id="5506516">.</span><span class="ident" id="5506517">RECV</span><span class="op" id="5506521">:</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506526">p</span><span class="op" id="5506527">.</span><span class="builtinfunc" id="5506528">print</span><span class="op" id="5506533">(</span><span class="ident" id="5506534">token</span><span class="op" id="5506539">.</span><span class="ident" id="5506540">CHAN</span><span class="op" id="5506544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506548">case</span>&nbsp;<span class="ident" id="5506553">ast</span><span class="op" id="5506556">.</span><span class="ident" id="5506557">RECV</span><span class="op" id="5506561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506566">p</span><span class="op" id="5506567">.</span><span class="builtinfunc" id="5506568">print</span><span class="op" id="5506573">(</span><span class="ident" id="5506574">token</span><span class="op" id="5506579">.</span><span class="ident" id="5506580">ARROW</span><span class="op" id="5506585">,</span>&nbsp;<span class="ident" id="5506587">token</span><span class="op" id="5506592">.</span><span class="ident" id="5506593">CHAN</span><span class="op" id="5506597">)</span>&nbsp;<span class="comment" id="5506599">//&nbsp;x.Arrow&nbsp;and&nbsp;x.Pos()&nbsp;are&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506637">case</span>&nbsp;<span class="ident" id="5506642">ast</span><span class="op" id="5506645">.</span><span class="ident" id="5506646">SEND</span><span class="op" id="5506650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506655">p</span><span class="op" id="5506656">.</span><span class="builtinfunc" id="5506657">print</span><span class="op" id="5506662">(</span><span class="ident" id="5506663">token</span><span class="op" id="5506668">.</span><span class="ident" id="5506669">CHAN</span><span class="op" id="5506673">,</span>&nbsp;<span class="ident" id="5506675">x</span><span class="op" id="5506676">.</span><span class="ident" id="5506677">Arrow</span><span class="op" id="5506682">,</span>&nbsp;<span class="ident" id="5506684">token</span><span class="op" id="5506689">.</span><span class="ident" id="5506690">ARROW</span><span class="op" id="5506695">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5506699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506703">p</span><span class="op" id="5506704">.</span><span class="builtinfunc" id="5506705">print</span><span class="op" id="5506710">(</span><span class="ident" id="5506711">blank</span><span class="op" id="5506716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506720">p</span><span class="op" id="5506721">.</span><span class="ident" id="5506722">expr</span><span class="op" id="5506726">(</span><span class="ident" id="5506727">x</span><span class="op" id="5506728">.</span><span class="ident" id="5506729">Value</span><span class="op" id="5506734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506738">default</span><span class="op" id="5506745">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5506749">panic</span><span class="op" id="5506754">(</span><span class="string" id="5506755">&#34;unreachable&#34;</span><span class="op" id="5506768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5506771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506775">return</span><br>
<span class="lineno"></span><span class="op" id="5506782">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="keyword" id="5506785">func</span>&nbsp;<span class="op" id="5506790">(</span><span class="ident" id="5506791">p</span>&nbsp;<span class="op" id="5506793">*</span><span class="ident" id="5506794">printer</span><span class="op" id="5506801">)</span>&nbsp;<span class="ident" id="5506803">expr0</span><span class="op" id="5506808">(</span><span class="ident" id="5506809">x</span>&nbsp;<span class="ident" id="5506811">ast</span><span class="op" id="5506814">.</span><span class="ident" id="5506815">Expr</span><span class="op" id="5506819">,</span>&nbsp;<span class="ident" id="5506821">depth</span>&nbsp;<span class="builtintype" id="5506827">int</span><span class="op" id="5506830">)</span>&nbsp;<span class="op" id="5506832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506835">p</span><span class="op" id="5506836">.</span><span class="ident" id="5506837">expr1</span><span class="op" id="5506842">(</span><span class="ident" id="5506843">x</span><span class="op" id="5506844">,</span>&nbsp;<span class="ident" id="5506846">token</span><span class="op" id="5506851">.</span><span class="ident" id="5506852">LowestPrec</span><span class="op" id="5506862">,</span>&nbsp;<span class="ident" id="5506864">depth</span><span class="op" id="5506869">)</span><br>
<span class="lineno"></span><span class="op" id="5506871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">895</span><span class="keyword" id="5506874">func</span>&nbsp;<span class="op" id="5506879">(</span><span class="ident" id="5506880">p</span>&nbsp;<span class="op" id="5506882">*</span><span class="ident" id="5506883">printer</span><span class="op" id="5506890">)</span>&nbsp;<span class="ident" id="5506892">expr</span><span class="op" id="5506896">(</span><span class="ident" id="5506897">x</span>&nbsp;<span class="ident" id="5506899">ast</span><span class="op" id="5506902">.</span><span class="ident" id="5506903">Expr</span><span class="op" id="5506907">)</span>&nbsp;<span class="op" id="5506909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506912">const</span>&nbsp;<span class="ident" id="5506918">depth</span>&nbsp;<span class="op" id="5506924">=</span>&nbsp;<span class="num" id="5506926">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506929">p</span><span class="op" id="5506930">.</span><span class="ident" id="5506931">expr1</span><span class="op" id="5506936">(</span><span class="ident" id="5506937">x</span><span class="op" id="5506938">,</span>&nbsp;<span class="ident" id="5506940">token</span><span class="op" id="5506945">.</span><span class="ident" id="5506946">LowestPrec</span><span class="op" id="5506956">,</span>&nbsp;<span class="ident" id="5506958">depth</span><span class="op" id="5506963">)</span><br>
<span class="lineno"></span><span class="op" id="5506965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span><span class="comment" id="5506968">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5507048">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5507063">//&nbsp;Print&nbsp;the&nbsp;statement&nbsp;list&nbsp;indented,&nbsp;but&nbsp;without&nbsp;a&nbsp;newline&nbsp;after&nbsp;the&nbsp;last&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5507149">//&nbsp;Extra&nbsp;line&nbsp;breaks&nbsp;between&nbsp;statements&nbsp;in&nbsp;the&nbsp;source&nbsp;are&nbsp;respected&nbsp;but&nbsp;at&nbsp;most&nbsp;one</span><br>
<span class="lineno">905</span><span class="comment" id="5507233">//&nbsp;empty&nbsp;line&nbsp;is&nbsp;printed&nbsp;between&nbsp;statements.</span><br>
<span class="lineno"></span><span class="keyword" id="5507278">func</span>&nbsp;<span class="op" id="5507283">(</span><span class="ident" id="5507284">p</span>&nbsp;<span class="op" id="5507286">*</span><span class="ident" id="5507287">printer</span><span class="op" id="5507294">)</span>&nbsp;<span class="ident" id="5507296">stmtList</span><span class="op" id="5507304">(</span><span class="ident" id="5507305">list</span>&nbsp;<span class="op" id="5507310">[</span><span class="op" id="5507311">]</span><span class="ident" id="5507312">ast</span><span class="op" id="5507315">.</span><span class="ident" id="5507316">Stmt</span><span class="op" id="5507320">,</span>&nbsp;<span class="ident" id="5507322">nindent</span>&nbsp;<span class="builtintype" id="5507330">int</span><span class="op" id="5507333">,</span>&nbsp;<span class="ident" id="5507335">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5507348">bool</span><span class="op" id="5507352">)</span>&nbsp;<span class="op" id="5507354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507357">if</span>&nbsp;<span class="ident" id="5507360">nindent</span>&nbsp;<span class="op" id="5507368">&gt;</span>&nbsp;<span class="num" id="5507370">0</span>&nbsp;<span class="op" id="5507372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507376">p</span><span class="op" id="5507377">.</span><span class="builtinfunc" id="5507378">print</span><span class="op" id="5507383">(</span><span class="ident" id="5507384">indent</span><span class="op" id="5507390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507393">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507396">var</span>&nbsp;<span class="ident" id="5507400">line</span>&nbsp;<span class="builtintype" id="5507405">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507410">i</span>&nbsp;<span class="op" id="5507412">:=</span>&nbsp;<span class="num" id="5507415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507418">for</span>&nbsp;<span class="ident" id="5507422">_</span><span class="op" id="5507423">,</span>&nbsp;<span class="ident" id="5507425">s</span>&nbsp;<span class="op" id="5507427">:=</span>&nbsp;<span class="keyword" id="5507430">range</span>&nbsp;<span class="ident" id="5507436">list</span>&nbsp;<span class="op" id="5507441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507445">//&nbsp;ignore&nbsp;empty&nbsp;statements&nbsp;(was&nbsp;issue&nbsp;3466)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507491">if</span>&nbsp;<span class="ident" id="5507494">_</span><span class="op" id="5507495">,</span>&nbsp;<span class="ident" id="5507497">isEmpty</span>&nbsp;<span class="op" id="5507505">:=</span>&nbsp;<span class="ident" id="5507508">s</span><span class="op" id="5507509">.</span><span class="op" id="5507510">(</span><span class="op" id="5507511">*</span><span class="ident" id="5507512">ast</span><span class="op" id="5507515">.</span><span class="ident" id="5507516">EmptyStmt</span><span class="op" id="5507525">)</span><span class="op" id="5507526">;</span>&nbsp;<span class="op" id="5507528">!</span><span class="ident" id="5507529">isEmpty</span>&nbsp;<span class="op" id="5507537">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507542">//&nbsp;nindent&nbsp;==&nbsp;0&nbsp;only&nbsp;for&nbsp;lists&nbsp;of&nbsp;switch/select&nbsp;case&nbsp;clauses;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507607">//&nbsp;in&nbsp;those&nbsp;cases&nbsp;each&nbsp;clause&nbsp;is&nbsp;a&nbsp;new&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507657">if</span>&nbsp;<span class="builtinfunc" id="5507660">len</span><span class="op" id="5507663">(</span><span class="ident" id="5507664">p</span><span class="op" id="5507665">.</span><span class="ident" id="5507666">output</span><span class="op" id="5507672">)</span>&nbsp;<span class="op" id="5507674">&gt;</span>&nbsp;<span class="num" id="5507676">0</span>&nbsp;<span class="op" id="5507678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507684">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507758">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507816">p</span><span class="op" id="5507817">.</span><span class="ident" id="5507818">linebreak</span><span class="op" id="5507827">(</span><span class="ident" id="5507828">p</span><span class="op" id="5507829">.</span><span class="ident" id="5507830">lineFor</span><span class="op" id="5507837">(</span><span class="ident" id="5507838">s</span><span class="op" id="5507839">.</span><span class="ident" id="5507840">Pos</span><span class="op" id="5507843">(</span><span class="op" id="5507844">)</span><span class="op" id="5507845">)</span><span class="op" id="5507846">,</span>&nbsp;<span class="num" id="5507848">1</span><span class="op" id="5507849">,</span>&nbsp;<span class="ident" id="5507851">ignore</span><span class="op" id="5507857">,</span>&nbsp;<span class="ident" id="5507859">i</span>&nbsp;<span class="op" id="5507861">==</span>&nbsp;<span class="num" id="5507864">0</span>&nbsp;<span class="op" id="5507866">||</span>&nbsp;<span class="ident" id="5507869">nindent</span>&nbsp;<span class="op" id="5507877">==</span>&nbsp;<span class="num" id="5507880">0</span>&nbsp;<span class="op" id="5507882">||</span>&nbsp;<span class="ident" id="5507885">p</span><span class="op" id="5507886">.</span><span class="ident" id="5507887">linesFrom</span><span class="op" id="5507896">(</span><span class="ident" id="5507897">line</span><span class="op" id="5507901">)</span>&nbsp;<span class="op" id="5507903">&gt;</span>&nbsp;<span class="num" id="5507905">0</span><span class="op" id="5507906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507916">p</span><span class="op" id="5507917">.</span><span class="ident" id="5507918">recordLine</span><span class="op" id="5507928">(</span><span class="op" id="5507929">&amp;</span><span class="ident" id="5507930">line</span><span class="op" id="5507934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507939">p</span><span class="op" id="5507940">.</span><span class="ident" id="5507941">stmt</span><span class="op" id="5507945">(</span><span class="ident" id="5507946">s</span><span class="op" id="5507947">,</span>&nbsp;<span class="ident" id="5507949">nextIsRBrace</span>&nbsp;<span class="op" id="5507962">&amp;&amp;</span>&nbsp;<span class="ident" id="5507965">i</span>&nbsp;<span class="op" id="5507967">==</span>&nbsp;<span class="builtinfunc" id="5507970">len</span><span class="op" id="5507973">(</span><span class="ident" id="5507974">list</span><span class="op" id="5507978">)</span><span class="op" id="5507979">-</span><span class="num" id="5507980">1</span><span class="op" id="5507981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507986">//&nbsp;labeled&nbsp;statements&nbsp;put&nbsp;labels&nbsp;on&nbsp;a&nbsp;separate&nbsp;line,&nbsp;but&nbsp;here</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508051">//&nbsp;we&nbsp;only&nbsp;care&nbsp;about&nbsp;the&nbsp;start&nbsp;line&nbsp;of&nbsp;the&nbsp;actual&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508115">//&nbsp;without&nbsp;label&nbsp;-&nbsp;correct&nbsp;line&nbsp;for&nbsp;each&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508165">for</span>&nbsp;<span class="ident" id="5508169">t</span>&nbsp;<span class="op" id="5508171">:=</span>&nbsp;<span class="ident" id="5508174">s</span><span class="op" id="5508175">;</span>&nbsp;<span class="op" id="5508177">;</span>&nbsp;<span class="op" id="5508179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508185">lt</span><span class="op" id="5508187">,</span>&nbsp;<span class="ident" id="5508189">_</span>&nbsp;<span class="op" id="5508191">:=</span>&nbsp;<span class="ident" id="5508194">t</span><span class="op" id="5508195">.</span><span class="op" id="5508196">(</span><span class="op" id="5508197">*</span><span class="ident" id="5508198">ast</span><span class="op" id="5508201">.</span><span class="ident" id="5508202">LabeledStmt</span><span class="op" id="5508213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508219">if</span>&nbsp;<span class="ident" id="5508222">lt</span>&nbsp;<span class="op" id="5508225">==</span>&nbsp;<span class="builtintype" id="5508228">nil</span>&nbsp;<span class="op" id="5508232">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508239">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508255">line</span><span class="op" id="5508259">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508266">t</span>&nbsp;<span class="op" id="5508268">=</span>&nbsp;<span class="ident" id="5508270">lt</span><span class="op" id="5508272">.</span><span class="ident" id="5508273">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508281">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508286">i</span><span class="op" id="5508287">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508298">if</span>&nbsp;<span class="ident" id="5508301">nindent</span>&nbsp;<span class="op" id="5508309">&gt;</span>&nbsp;<span class="num" id="5508311">0</span>&nbsp;<span class="op" id="5508313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508317">p</span><span class="op" id="5508318">.</span><span class="builtinfunc" id="5508319">print</span><span class="op" id="5508324">(</span><span class="ident" id="5508325">unindent</span><span class="op" id="5508333">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508336">}</span><br>
<span class="lineno"></span><span class="op" id="5508338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5508341">//&nbsp;block&nbsp;prints&nbsp;an&nbsp;*ast.BlockStmt;&nbsp;it&nbsp;always&nbsp;spans&nbsp;at&nbsp;least&nbsp;two&nbsp;lines.</span><br>
<span class="lineno"></span><span class="keyword" id="5508412">func</span>&nbsp;<span class="op" id="5508417">(</span><span class="ident" id="5508418">p</span>&nbsp;<span class="op" id="5508420">*</span><span class="ident" id="5508421">printer</span><span class="op" id="5508428">)</span>&nbsp;<span class="ident" id="5508430">block</span><span class="op" id="5508435">(</span><span class="ident" id="5508436">b</span>&nbsp;<span class="op" id="5508438">*</span><span class="ident" id="5508439">ast</span><span class="op" id="5508442">.</span><span class="ident" id="5508443">BlockStmt</span><span class="op" id="5508452">,</span>&nbsp;<span class="ident" id="5508454">nindent</span>&nbsp;<span class="builtintype" id="5508462">int</span><span class="op" id="5508465">)</span>&nbsp;<span class="op" id="5508467">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508470">p</span><span class="op" id="5508471">.</span><span class="builtinfunc" id="5508472">print</span><span class="op" id="5508477">(</span><span class="ident" id="5508478">b</span><span class="op" id="5508479">.</span><span class="ident" id="5508480">Lbrace</span><span class="op" id="5508486">,</span>&nbsp;<span class="ident" id="5508488">token</span><span class="op" id="5508493">.</span><span class="ident" id="5508494">LBRACE</span><span class="op" id="5508500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508503">p</span><span class="op" id="5508504">.</span><span class="ident" id="5508505">stmtList</span><span class="op" id="5508513">(</span><span class="ident" id="5508514">b</span><span class="op" id="5508515">.</span><span class="ident" id="5508516">List</span><span class="op" id="5508520">,</span>&nbsp;<span class="ident" id="5508522">nindent</span><span class="op" id="5508529">,</span>&nbsp;<span class="builtintype" id="5508531">true</span><span class="op" id="5508535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508538">p</span><span class="op" id="5508539">.</span><span class="ident" id="5508540">linebreak</span><span class="op" id="5508549">(</span><span class="ident" id="5508550">p</span><span class="op" id="5508551">.</span><span class="ident" id="5508552">lineFor</span><span class="op" id="5508559">(</span><span class="ident" id="5508560">b</span><span class="op" id="5508561">.</span><span class="ident" id="5508562">Rbrace</span><span class="op" id="5508568">)</span><span class="op" id="5508569">,</span>&nbsp;<span class="num" id="5508571">1</span><span class="op" id="5508572">,</span>&nbsp;<span class="ident" id="5508574">ignore</span><span class="op" id="5508580">,</span>&nbsp;<span class="builtintype" id="5508582">true</span><span class="op" id="5508586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508589">p</span><span class="op" id="5508590">.</span><span class="builtinfunc" id="5508591">print</span><span class="op" id="5508596">(</span><span class="ident" id="5508597">b</span><span class="op" id="5508598">.</span><span class="ident" id="5508599">Rbrace</span><span class="op" id="5508605">,</span>&nbsp;<span class="ident" id="5508607">token</span><span class="op" id="5508612">.</span><span class="ident" id="5508613">RBRACE</span><span class="op" id="5508619">)</span><br>
<span class="lineno"></span><span class="op" id="5508621">}</span><br>
<span class="lineno">950</span><br>
<span class="lineno"></span><span class="keyword" id="5508624">func</span>&nbsp;<span class="ident" id="5508629">isTypeName</span><span class="op" id="5508639">(</span><span class="ident" id="5508640">x</span>&nbsp;<span class="ident" id="5508642">ast</span><span class="op" id="5508645">.</span><span class="ident" id="5508646">Expr</span><span class="op" id="5508650">)</span>&nbsp;<span class="builtintype" id="5508652">bool</span>&nbsp;<span class="op" id="5508657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508660">switch</span>&nbsp;<span class="ident" id="5508667">t</span>&nbsp;<span class="op" id="5508669">:=</span>&nbsp;<span class="ident" id="5508672">x</span><span class="op" id="5508673">.</span><span class="op" id="5508674">(</span><span class="keyword" id="5508675">type</span><span class="op" id="5508679">)</span>&nbsp;<span class="op" id="5508681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508684">case</span>&nbsp;<span class="op" id="5508689">*</span><span class="ident" id="5508690">ast</span><span class="op" id="5508693">.</span><span class="ident" id="5508694">Ident</span><span class="op" id="5508699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508703">return</span>&nbsp;<span class="builtintype" id="5508710">true</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508716">case</span>&nbsp;<span class="op" id="5508721">*</span><span class="ident" id="5508722">ast</span><span class="op" id="5508725">.</span><span class="ident" id="5508726">SelectorExpr</span><span class="op" id="5508738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508742">return</span>&nbsp;<span class="ident" id="5508749">isTypeName</span><span class="op" id="5508759">(</span><span class="ident" id="5508760">t</span><span class="op" id="5508761">.</span><span class="ident" id="5508762">X</span><span class="op" id="5508763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508769">return</span>&nbsp;<span class="builtintype" id="5508776">false</span><br>
<span class="lineno"></span><span class="op" id="5508782">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span><span class="keyword" id="5508785">func</span>&nbsp;<span class="ident" id="5508790">stripParens</span><span class="op" id="5508801">(</span><span class="ident" id="5508802">x</span>&nbsp;<span class="ident" id="5508804">ast</span><span class="op" id="5508807">.</span><span class="ident" id="5508808">Expr</span><span class="op" id="5508812">)</span>&nbsp;<span class="ident" id="5508814">ast</span><span class="op" id="5508817">.</span><span class="ident" id="5508818">Expr</span>&nbsp;<span class="op" id="5508823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508826">if</span>&nbsp;<span class="ident" id="5508829">px</span><span class="op" id="5508831">,</span>&nbsp;<span class="ident" id="5508833">strip</span>&nbsp;<span class="op" id="5508839">:=</span>&nbsp;<span class="ident" id="5508842">x</span><span class="op" id="5508843">.</span><span class="op" id="5508844">(</span><span class="op" id="5508845">*</span><span class="ident" id="5508846">ast</span><span class="op" id="5508849">.</span><span class="ident" id="5508850">ParenExpr</span><span class="op" id="5508859">)</span><span class="op" id="5508860">;</span>&nbsp;<span class="ident" id="5508862">strip</span>&nbsp;<span class="op" id="5508868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508872">//&nbsp;parentheses&nbsp;must&nbsp;not&nbsp;be&nbsp;stripped&nbsp;if&nbsp;there&nbsp;are&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508927">//&nbsp;unparenthesized&nbsp;composite&nbsp;literals&nbsp;starting&nbsp;with</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508981">//&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508998">ast</span><span class="op" id="5509001">.</span><span class="ident" id="5509002">Inspect</span><span class="op" id="5509009">(</span><span class="ident" id="5509010">px</span><span class="op" id="5509012">.</span><span class="ident" id="5509013">X</span><span class="op" id="5509014">,</span>&nbsp;<span class="keyword" id="5509016">func</span><span class="op" id="5509020">(</span><span class="ident" id="5509021">node</span>&nbsp;<span class="ident" id="5509026">ast</span><span class="op" id="5509029">.</span><span class="ident" id="5509030">Node</span><span class="op" id="5509034">)</span>&nbsp;<span class="builtintype" id="5509036">bool</span>&nbsp;<span class="op" id="5509041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509046">switch</span>&nbsp;<span class="ident" id="5509053">x</span>&nbsp;<span class="op" id="5509055">:=</span>&nbsp;<span class="ident" id="5509058">node</span><span class="op" id="5509062">.</span><span class="op" id="5509063">(</span><span class="keyword" id="5509064">type</span><span class="op" id="5509068">)</span>&nbsp;<span class="op" id="5509070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509075">case</span>&nbsp;<span class="op" id="5509080">*</span><span class="ident" id="5509081">ast</span><span class="op" id="5509084">.</span><span class="ident" id="5509085">ParenExpr</span><span class="op" id="5509094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509100">//&nbsp;parentheses&nbsp;protect&nbsp;enclosed&nbsp;composite&nbsp;literals</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509155">return</span>&nbsp;<span class="builtintype" id="5509162">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509171">case</span>&nbsp;<span class="op" id="5509176">*</span><span class="ident" id="5509177">ast</span><span class="op" id="5509180">.</span><span class="ident" id="5509181">CompositeLit</span><span class="op" id="5509193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509199">if</span>&nbsp;<span class="ident" id="5509202">isTypeName</span><span class="op" id="5509212">(</span><span class="ident" id="5509213">x</span><span class="op" id="5509214">.</span><span class="ident" id="5509215">Type</span><span class="op" id="5509219">)</span>&nbsp;<span class="op" id="5509221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509228">strip</span>&nbsp;<span class="op" id="5509234">=</span>&nbsp;<span class="builtintype" id="5509236">false</span>&nbsp;<span class="comment" id="5509242">//&nbsp;do&nbsp;not&nbsp;strip&nbsp;parentheses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509274">}</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509280">return</span>&nbsp;<span class="builtintype" id="5509287">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509301">//&nbsp;in&nbsp;all&nbsp;other&nbsp;cases,&nbsp;keep&nbsp;inspecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509343">return</span>&nbsp;<span class="builtintype" id="5509350">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509357">}</span><span class="op" id="5509358">)</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509362">if</span>&nbsp;<span class="ident" id="5509365">strip</span>&nbsp;<span class="op" id="5509371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509376">return</span>&nbsp;<span class="ident" id="5509383">stripParens</span><span class="op" id="5509394">(</span><span class="ident" id="5509395">px</span><span class="op" id="5509397">.</span><span class="ident" id="5509398">X</span><span class="op" id="5509399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509409">return</span>&nbsp;<span class="ident" id="5509416">x</span><br>
<span class="lineno">985</span><span class="op" id="5509418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5509421">func</span>&nbsp;<span class="ident" id="5509426">stripParensAlways</span><span class="op" id="5509443">(</span><span class="ident" id="5509444">x</span>&nbsp;<span class="ident" id="5509446">ast</span><span class="op" id="5509449">.</span><span class="ident" id="5509450">Expr</span><span class="op" id="5509454">)</span>&nbsp;<span class="ident" id="5509456">ast</span><span class="op" id="5509459">.</span><span class="ident" id="5509460">Expr</span>&nbsp;<span class="op" id="5509465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509468">if</span>&nbsp;<span class="ident" id="5509471">x</span><span class="op" id="5509472">,</span>&nbsp;<span class="ident" id="5509474">ok</span>&nbsp;<span class="op" id="5509477">:=</span>&nbsp;<span class="ident" id="5509480">x</span><span class="op" id="5509481">.</span><span class="op" id="5509482">(</span><span class="op" id="5509483">*</span><span class="ident" id="5509484">ast</span><span class="op" id="5509487">.</span><span class="ident" id="5509488">ParenExpr</span><span class="op" id="5509497">)</span><span class="op" id="5509498">;</span>&nbsp;<span class="ident" id="5509500">ok</span>&nbsp;<span class="op" id="5509503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509507">return</span>&nbsp;<span class="ident" id="5509514">stripParensAlways</span><span class="op" id="5509531">(</span><span class="ident" id="5509532">x</span><span class="op" id="5509533">.</span><span class="ident" id="5509534">X</span><span class="op" id="5509535">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509541">return</span>&nbsp;<span class="ident" id="5509548">x</span><br>
<span class="lineno"></span><span class="op" id="5509550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5509553">func</span>&nbsp;<span class="op" id="5509558">(</span><span class="ident" id="5509559">p</span>&nbsp;<span class="op" id="5509561">*</span><span class="ident" id="5509562">printer</span><span class="op" id="5509569">)</span>&nbsp;<span class="ident" id="5509571">controlClause</span><span class="op" id="5509584">(</span><span class="ident" id="5509585">isForStmt</span>&nbsp;<span class="builtintype" id="5509595">bool</span><span class="op" id="5509599">,</span>&nbsp;<span class="ident" id="5509601">init</span>&nbsp;<span class="ident" id="5509606">ast</span><span class="op" id="5509609">.</span><span class="ident" id="5509610">Stmt</span><span class="op" id="5509614">,</span>&nbsp;<span class="ident" id="5509616">expr</span>&nbsp;<span class="ident" id="5509621">ast</span><span class="op" id="5509624">.</span><span class="ident" id="5509625">Expr</span><span class="op" id="5509629">,</span>&nbsp;<span class="ident" id="5509631">post</span>&nbsp;<span class="ident" id="5509636">ast</span><span class="op" id="5509639">.</span><span class="ident" id="5509640">Stmt</span><span class="op" id="5509644">)</span>&nbsp;<span class="op" id="5509646">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509649">p</span><span class="op" id="5509650">.</span><span class="builtinfunc" id="5509651">print</span><span class="op" id="5509656">(</span><span class="ident" id="5509657">blank</span><span class="op" id="5509662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509665">needsBlank</span>&nbsp;<span class="op" id="5509676">:=</span>&nbsp;<span class="builtintype" id="5509679">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509686">if</span>&nbsp;<span class="ident" id="5509689">init</span>&nbsp;<span class="op" id="5509694">==</span>&nbsp;<span class="builtintype" id="5509697">nil</span>&nbsp;<span class="op" id="5509701">&amp;&amp;</span>&nbsp;<span class="ident" id="5509704">post</span>&nbsp;<span class="op" id="5509709">==</span>&nbsp;<span class="builtintype" id="5509712">nil</span>&nbsp;<span class="op" id="5509716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509720">//&nbsp;no&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509748">if</span>&nbsp;<span class="ident" id="5509751">expr</span>&nbsp;<span class="op" id="5509756">!=</span>&nbsp;<span class="builtintype" id="5509759">nil</span>&nbsp;<span class="op" id="5509763">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509768">p</span><span class="op" id="5509769">.</span><span class="ident" id="5509770">expr</span><span class="op" id="5509774">(</span><span class="ident" id="5509775">stripParens</span><span class="op" id="5509786">(</span><span class="ident" id="5509787">expr</span><span class="op" id="5509791">)</span><span class="op" id="5509792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509797">needsBlank</span>&nbsp;<span class="op" id="5509808">=</span>&nbsp;<span class="builtintype" id="5509810">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509820">}</span>&nbsp;<span class="keyword" id="5509822">else</span>&nbsp;<span class="op" id="5509827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509831">//&nbsp;all&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509860">//&nbsp;(they&nbsp;are&nbsp;not&nbsp;separators,&nbsp;print&nbsp;them&nbsp;explicitly)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509914">if</span>&nbsp;<span class="ident" id="5509917">init</span>&nbsp;<span class="op" id="5509922">!=</span>&nbsp;<span class="builtintype" id="5509925">nil</span>&nbsp;<span class="op" id="5509929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509934">p</span><span class="op" id="5509935">.</span><span class="ident" id="5509936">stmt</span><span class="op" id="5509940">(</span><span class="ident" id="5509941">init</span><span class="op" id="5509945">,</span>&nbsp;<span class="builtintype" id="5509947">false</span><span class="op" id="5509952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509960">p</span><span class="op" id="5509961">.</span><span class="builtinfunc" id="5509962">print</span><span class="op" id="5509967">(</span><span class="ident" id="5509968">token</span><span class="op" id="5509973">.</span><span class="ident" id="5509974">SEMICOLON</span><span class="op" id="5509983">,</span>&nbsp;<span class="ident" id="5509985">blank</span><span class="op" id="5509990">)</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509994">if</span>&nbsp;<span class="ident" id="5509997">expr</span>&nbsp;<span class="op" id="5510002">!=</span>&nbsp;<span class="builtintype" id="5510005">nil</span>&nbsp;<span class="op" id="5510009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510014">p</span><span class="op" id="5510015">.</span><span class="ident" id="5510016">expr</span><span class="op" id="5510020">(</span><span class="ident" id="5510021">stripParens</span><span class="op" id="5510032">(</span><span class="ident" id="5510033">expr</span><span class="op" id="5510037">)</span><span class="op" id="5510038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510043">needsBlank</span>&nbsp;<span class="op" id="5510054">=</span>&nbsp;<span class="builtintype" id="5510056">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510067">if</span>&nbsp;<span class="ident" id="5510070">isForStmt</span>&nbsp;<span class="op" id="5510080">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510085">p</span><span class="op" id="5510086">.</span><span class="builtinfunc" id="5510087">print</span><span class="op" id="5510092">(</span><span class="ident" id="5510093">token</span><span class="op" id="5510098">.</span><span class="ident" id="5510099">SEMICOLON</span><span class="op" id="5510108">,</span>&nbsp;<span class="ident" id="5510110">blank</span><span class="op" id="5510115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510120">needsBlank</span>&nbsp;<span class="op" id="5510131">=</span>&nbsp;<span class="builtintype" id="5510133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510142">if</span>&nbsp;<span class="ident" id="5510145">post</span>&nbsp;<span class="op" id="5510150">!=</span>&nbsp;<span class="builtintype" id="5510153">nil</span>&nbsp;<span class="op" id="5510157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510163">p</span><span class="op" id="5510164">.</span><span class="ident" id="5510165">stmt</span><span class="op" id="5510169">(</span><span class="ident" id="5510170">post</span><span class="op" id="5510174">,</span>&nbsp;<span class="builtintype" id="5510176">false</span><span class="op" id="5510181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510187">needsBlank</span>&nbsp;<span class="op" id="5510198">=</span>&nbsp;<span class="builtintype" id="5510200">true</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510218">if</span>&nbsp;<span class="ident" id="5510221">needsBlank</span>&nbsp;<span class="op" id="5510232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510236">p</span><span class="op" id="5510237">.</span><span class="builtinfunc" id="5510238">print</span><span class="op" id="5510243">(</span><span class="ident" id="5510244">blank</span><span class="op" id="5510249">)</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510252">}</span><br>
<span class="lineno"></span><span class="op" id="5510254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5510257">//&nbsp;indentList&nbsp;reports&nbsp;whether&nbsp;an&nbsp;expression&nbsp;list&nbsp;would&nbsp;look&nbsp;better&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5510330">//&nbsp;were&nbsp;indented&nbsp;wholesale&nbsp;(starting&nbsp;with&nbsp;the&nbsp;very&nbsp;first&nbsp;element,&nbsp;rather</span><br>
<span class="lineno">1030</span><span class="comment" id="5510403">//&nbsp;than&nbsp;starting&nbsp;at&nbsp;the&nbsp;first&nbsp;line&nbsp;break).</span><br>
<span class="lineno"></span><span class="comment" id="5510446">//</span><br>
<span class="lineno"></span><span class="keyword" id="5510449">func</span>&nbsp;<span class="op" id="5510454">(</span><span class="ident" id="5510455">p</span>&nbsp;<span class="op" id="5510457">*</span><span class="ident" id="5510458">printer</span><span class="op" id="5510465">)</span>&nbsp;<span class="ident" id="5510467">indentList</span><span class="op" id="5510477">(</span><span class="ident" id="5510478">list</span>&nbsp;<span class="op" id="5510483">[</span><span class="op" id="5510484">]</span><span class="ident" id="5510485">ast</span><span class="op" id="5510488">.</span><span class="ident" id="5510489">Expr</span><span class="op" id="5510493">)</span>&nbsp;<span class="builtintype" id="5510495">bool</span>&nbsp;<span class="op" id="5510500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510503">//&nbsp;Heuristic:&nbsp;indentList&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;one&nbsp;multi-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510576">//&nbsp;line&nbsp;element&nbsp;in&nbsp;the&nbsp;list,&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;element&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510645">//&nbsp;starting&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ends.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510701">if</span>&nbsp;<span class="builtinfunc" id="5510704">len</span><span class="op" id="5510707">(</span><span class="ident" id="5510708">list</span><span class="op" id="5510712">)</span>&nbsp;<span class="op" id="5510714">&gt;=</span>&nbsp;<span class="num" id="5510717">2</span>&nbsp;<span class="op" id="5510719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510723">var</span>&nbsp;<span class="ident" id="5510727">b</span>&nbsp;<span class="op" id="5510729">=</span>&nbsp;<span class="ident" id="5510731">p</span><span class="op" id="5510732">.</span><span class="ident" id="5510733">lineFor</span><span class="op" id="5510740">(</span><span class="ident" id="5510741">list</span><span class="op" id="5510745">[</span><span class="num" id="5510746">0</span><span class="op" id="5510747">]</span><span class="op" id="5510748">.</span><span class="ident" id="5510749">Pos</span><span class="op" id="5510752">(</span><span class="op" id="5510753">)</span><span class="op" id="5510754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510758">var</span>&nbsp;<span class="ident" id="5510762">e</span>&nbsp;<span class="op" id="5510764">=</span>&nbsp;<span class="ident" id="5510766">p</span><span class="op" id="5510767">.</span><span class="ident" id="5510768">lineFor</span><span class="op" id="5510775">(</span><span class="ident" id="5510776">list</span><span class="op" id="5510780">[</span><span class="builtinfunc" id="5510781">len</span><span class="op" id="5510784">(</span><span class="ident" id="5510785">list</span><span class="op" id="5510789">)</span><span class="op" id="5510790">-</span><span class="num" id="5510791">1</span><span class="op" id="5510792">]</span><span class="op" id="5510793">.</span><span class="ident" id="5510794">End</span><span class="op" id="5510797">(</span><span class="op" id="5510798">)</span><span class="op" id="5510799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510803">if</span>&nbsp;<span class="num" id="5510806">0</span>&nbsp;<span class="op" id="5510808">&lt;</span>&nbsp;<span class="ident" id="5510810">b</span>&nbsp;<span class="op" id="5510812">&amp;&amp;</span>&nbsp;<span class="ident" id="5510815">b</span>&nbsp;<span class="op" id="5510817">&lt;</span>&nbsp;<span class="ident" id="5510819">e</span>&nbsp;<span class="op" id="5510821">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510826">//&nbsp;list&nbsp;spans&nbsp;multiple&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510858">n</span>&nbsp;<span class="op" id="5510860">:=</span>&nbsp;<span class="num" id="5510863">0</span>&nbsp;<span class="comment" id="5510865">//&nbsp;multi-line&nbsp;element&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510896">line</span>&nbsp;<span class="op" id="5510901">:=</span>&nbsp;<span class="ident" id="5510904">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510909">for</span>&nbsp;<span class="ident" id="5510913">_</span><span class="op" id="5510914">,</span>&nbsp;<span class="ident" id="5510916">x</span>&nbsp;<span class="op" id="5510918">:=</span>&nbsp;<span class="keyword" id="5510921">range</span>&nbsp;<span class="ident" id="5510927">list</span>&nbsp;<span class="op" id="5510932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510938">xb</span>&nbsp;<span class="op" id="5510941">:=</span>&nbsp;<span class="ident" id="5510944">p</span><span class="op" id="5510945">.</span><span class="ident" id="5510946">lineFor</span><span class="op" id="5510953">(</span><span class="ident" id="5510954">x</span><span class="op" id="5510955">.</span><span class="ident" id="5510956">Pos</span><span class="op" id="5510959">(</span><span class="op" id="5510960">)</span><span class="op" id="5510961">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510967">xe</span>&nbsp;<span class="op" id="5510970">:=</span>&nbsp;<span class="ident" id="5510973">p</span><span class="op" id="5510974">.</span><span class="ident" id="5510975">lineFor</span><span class="op" id="5510982">(</span><span class="ident" id="5510983">x</span><span class="op" id="5510984">.</span><span class="ident" id="5510985">End</span><span class="op" id="5510988">(</span><span class="op" id="5510989">)</span><span class="op" id="5510990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510996">if</span>&nbsp;<span class="ident" id="5510999">line</span>&nbsp;<span class="op" id="5511004">&lt;</span>&nbsp;<span class="ident" id="5511006">xb</span>&nbsp;<span class="op" id="5511009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511016">//&nbsp;x&nbsp;is&nbsp;not&nbsp;starting&nbsp;on&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511054">//&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ended</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511093">return</span>&nbsp;<span class="builtintype" id="5511100">true</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511115">if</span>&nbsp;<span class="ident" id="5511118">xb</span>&nbsp;<span class="op" id="5511121">&lt;</span>&nbsp;<span class="ident" id="5511123">xe</span>&nbsp;<span class="op" id="5511126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511133">//&nbsp;x&nbsp;is&nbsp;a&nbsp;multi-line&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511167">n</span><span class="op" id="5511168">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511175">}</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511181">line</span>&nbsp;<span class="op" id="5511186">=</span>&nbsp;<span class="ident" id="5511188">xe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511199">return</span>&nbsp;<span class="ident" id="5511206">n</span>&nbsp;<span class="op" id="5511208">&gt;</span>&nbsp;<span class="num" id="5511210">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511217">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511220">return</span>&nbsp;<span class="builtintype" id="5511227">false</span><br>
<span class="lineno"></span><span class="op" id="5511233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511236">func</span>&nbsp;<span class="op" id="5511241">(</span><span class="ident" id="5511242">p</span>&nbsp;<span class="op" id="5511244">*</span><span class="ident" id="5511245">printer</span><span class="op" id="5511252">)</span>&nbsp;<span class="ident" id="5511254">stmt</span><span class="op" id="5511258">(</span><span class="ident" id="5511259">stmt</span>&nbsp;<span class="ident" id="5511264">ast</span><span class="op" id="5511267">.</span><span class="ident" id="5511268">Stmt</span><span class="op" id="5511272">,</span>&nbsp;<span class="ident" id="5511274">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5511287">bool</span><span class="op" id="5511291">)</span>&nbsp;<span class="op" id="5511293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511296">p</span><span class="op" id="5511297">.</span><span class="builtinfunc" id="5511298">print</span><span class="op" id="5511303">(</span><span class="ident" id="5511304">stmt</span><span class="op" id="5511308">.</span><span class="ident" id="5511309">Pos</span><span class="op" id="5511312">(</span><span class="op" id="5511313">)</span><span class="op" id="5511314">)</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511318">switch</span>&nbsp;<span class="ident" id="5511325">s</span>&nbsp;<span class="op" id="5511327">:=</span>&nbsp;<span class="ident" id="5511330">stmt</span><span class="op" id="5511334">.</span><span class="op" id="5511335">(</span><span class="keyword" id="5511336">type</span><span class="op" id="5511340">)</span>&nbsp;<span class="op" id="5511342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511345">case</span>&nbsp;<span class="op" id="5511350">*</span><span class="ident" id="5511351">ast</span><span class="op" id="5511354">.</span><span class="ident" id="5511355">BadStmt</span><span class="op" id="5511362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511366">p</span><span class="op" id="5511367">.</span><span class="builtinfunc" id="5511368">print</span><span class="op" id="5511373">(</span><span class="string" id="5511374">&#34;BadStmt&#34;</span><span class="op" id="5511383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511387">case</span>&nbsp;<span class="op" id="5511392">*</span><span class="ident" id="5511393">ast</span><span class="op" id="5511396">.</span><span class="ident" id="5511397">DeclStmt</span><span class="op" id="5511405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511409">p</span><span class="op" id="5511410">.</span><span class="ident" id="5511411">decl</span><span class="op" id="5511415">(</span><span class="ident" id="5511416">s</span><span class="op" id="5511417">.</span><span class="ident" id="5511418">Decl</span><span class="op" id="5511422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511426">case</span>&nbsp;<span class="op" id="5511431">*</span><span class="ident" id="5511432">ast</span><span class="op" id="5511435">.</span><span class="ident" id="5511436">EmptyStmt</span><span class="op" id="5511445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511449">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511468">case</span>&nbsp;<span class="op" id="5511473">*</span><span class="ident" id="5511474">ast</span><span class="op" id="5511477">.</span><span class="ident" id="5511478">LabeledStmt</span><span class="op" id="5511489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511493">//&nbsp;a&nbsp;&#34;correcting&#34;&nbsp;unindent&nbsp;immediately&nbsp;following&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511557">//&nbsp;is&nbsp;applied&nbsp;before&nbsp;the&nbsp;line&nbsp;break&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511618">//&nbsp;between&nbsp;(see&nbsp;writeWhitespace)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511653">p</span><span class="op" id="5511654">.</span><span class="builtinfunc" id="5511655">print</span><span class="op" id="5511660">(</span><span class="ident" id="5511661">unindent</span><span class="op" id="5511669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511673">p</span><span class="op" id="5511674">.</span><span class="ident" id="5511675">expr</span><span class="op" id="5511679">(</span><span class="ident" id="5511680">s</span><span class="op" id="5511681">.</span><span class="ident" id="5511682">Label</span><span class="op" id="5511687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511691">p</span><span class="op" id="5511692">.</span><span class="builtinfunc" id="5511693">print</span><span class="op" id="5511698">(</span><span class="ident" id="5511699">s</span><span class="op" id="5511700">.</span><span class="ident" id="5511701">Colon</span><span class="op" id="5511706">,</span>&nbsp;<span class="ident" id="5511708">token</span><span class="op" id="5511713">.</span><span class="ident" id="5511714">COLON</span><span class="op" id="5511719">,</span>&nbsp;<span class="ident" id="5511721">indent</span><span class="op" id="5511727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511731">if</span>&nbsp;<span class="ident" id="5511734">e</span><span class="op" id="5511735">,</span>&nbsp;<span class="ident" id="5511737">isEmpty</span>&nbsp;<span class="op" id="5511745">:=</span>&nbsp;<span class="ident" id="5511748">s</span><span class="op" id="5511749">.</span><span class="ident" id="5511750">Stmt</span><span class="op" id="5511754">.</span><span class="op" id="5511755">(</span><span class="op" id="5511756">*</span><span class="ident" id="5511757">ast</span><span class="op" id="5511760">.</span><span class="ident" id="5511761">EmptyStmt</span><span class="op" id="5511770">)</span><span class="op" id="5511771">;</span>&nbsp;<span class="ident" id="5511773">isEmpty</span>&nbsp;<span class="op" id="5511781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511786">if</span>&nbsp;<span class="op" id="5511789">!</span><span class="ident" id="5511790">nextIsRBrace</span>&nbsp;<span class="op" id="5511803">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511809">p</span><span class="op" id="5511810">.</span><span class="builtinfunc" id="5511811">print</span><span class="op" id="5511816">(</span><span class="ident" id="5511817">newline</span><span class="op" id="5511824">,</span>&nbsp;<span class="ident" id="5511826">e</span><span class="op" id="5511827">.</span><span class="ident" id="5511828">Pos</span><span class="op" id="5511831">(</span><span class="op" id="5511832">)</span><span class="op" id="5511833">,</span>&nbsp;<span class="ident" id="5511835">token</span><span class="op" id="5511840">.</span><span class="ident" id="5511841">SEMICOLON</span><span class="op" id="5511850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511856">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511869">}</span>&nbsp;<span class="keyword" id="5511871">else</span>&nbsp;<span class="op" id="5511876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511881">p</span><span class="op" id="5511882">.</span><span class="ident" id="5511883">linebreak</span><span class="op" id="5511892">(</span><span class="ident" id="5511893">p</span><span class="op" id="5511894">.</span><span class="ident" id="5511895">lineFor</span><span class="op" id="5511902">(</span><span class="ident" id="5511903">s</span><span class="op" id="5511904">.</span><span class="ident" id="5511905">Stmt</span><span class="op" id="5511909">.</span><span class="ident" id="5511910">Pos</span><span class="op" id="5511913">(</span><span class="op" id="5511914">)</span><span class="op" id="5511915">)</span><span class="op" id="5511916">,</span>&nbsp;<span class="num" id="5511918">1</span><span class="op" id="5511919">,</span>&nbsp;<span class="ident" id="5511921">ignore</span><span class="op" id="5511927">,</span>&nbsp;<span class="builtintype" id="5511929">true</span><span class="op" id="5511933">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511941">p</span><span class="op" id="5511942">.</span><span class="ident" id="5511943">stmt</span><span class="op" id="5511947">(</span><span class="ident" id="5511948">s</span><span class="op" id="5511949">.</span><span class="ident" id="5511950">Stmt</span><span class="op" id="5511954">,</span>&nbsp;<span class="ident" id="5511956">nextIsRBrace</span><span class="op" id="5511968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511972">case</span>&nbsp;<span class="op" id="5511977">*</span><span class="ident" id="5511978">ast</span><span class="op" id="5511981">.</span><span class="ident" id="5511982">ExprStmt</span><span class="op" id="5511990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511994">const</span>&nbsp;<span class="ident" id="5512000">depth</span>&nbsp;<span class="op" id="5512006">=</span>&nbsp;<span class="num" id="5512008">1</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512012">p</span><span class="op" id="5512013">.</span><span class="ident" id="5512014">expr0</span><span class="op" id="5512019">(</span><span class="ident" id="5512020">s</span><span class="op" id="5512021">.</span><span class="ident" id="5512022">X</span><span class="op" id="5512023">,</span>&nbsp;<span class="ident" id="5512025">depth</span><span class="op" id="5512030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512034">case</span>&nbsp;<span class="op" id="5512039">*</span><span class="ident" id="5512040">ast</span><span class="op" id="5512043">.</span><span class="ident" id="5512044">SendStmt</span><span class="op" id="5512052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512056">const</span>&nbsp;<span class="ident" id="5512062">depth</span>&nbsp;<span class="op" id="5512068">=</span>&nbsp;<span class="num" id="5512070">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512074">p</span><span class="op" id="5512075">.</span><span class="ident" id="5512076">expr0</span><span class="op" id="5512081">(</span><span class="ident" id="5512082">s</span><span class="op" id="5512083">.</span><span class="ident" id="5512084">Chan</span><span class="op" id="5512088">,</span>&nbsp;<span class="ident" id="5512090">depth</span><span class="op" id="5512095">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512099">p</span><span class="op" id="5512100">.</span><span class="builtinfunc" id="5512101">print</span><span class="op" id="5512106">(</span><span class="ident" id="5512107">blank</span><span class="op" id="5512112">,</span>&nbsp;<span class="ident" id="5512114">s</span><span class="op" id="5512115">.</span><span class="ident" id="5512116">Arrow</span><span class="op" id="5512121">,</span>&nbsp;<span class="ident" id="5512123">token</span><span class="op" id="5512128">.</span><span class="ident" id="5512129">ARROW</span><span class="op" id="5512134">,</span>&nbsp;<span class="ident" id="5512136">blank</span><span class="op" id="5512141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512145">p</span><span class="op" id="5512146">.</span><span class="ident" id="5512147">expr0</span><span class="op" id="5512152">(</span><span class="ident" id="5512153">s</span><span class="op" id="5512154">.</span><span class="ident" id="5512155">Value</span><span class="op" id="5512160">,</span>&nbsp;<span class="ident" id="5512162">depth</span><span class="op" id="5512167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512171">case</span>&nbsp;<span class="op" id="5512176">*</span><span class="ident" id="5512177">ast</span><span class="op" id="5512180">.</span><span class="ident" id="5512181">IncDecStmt</span><span class="op" id="5512191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512195">const</span>&nbsp;<span class="ident" id="5512201">depth</span>&nbsp;<span class="op" id="5512207">=</span>&nbsp;<span class="num" id="5512209">1</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512213">p</span><span class="op" id="5512214">.</span><span class="ident" id="5512215">expr0</span><span class="op" id="5512220">(</span><span class="ident" id="5512221">s</span><span class="op" id="5512222">.</span><span class="ident" id="5512223">X</span><span class="op" id="5512224">,</span>&nbsp;<span class="ident" id="5512226">depth</span><span class="op" id="5512231">+</span><span class="num" id="5512232">1</span><span class="op" id="5512233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512237">p</span><span class="op" id="5512238">.</span><span class="builtinfunc" id="5512239">print</span><span class="op" id="5512244">(</span><span class="ident" id="5512245">s</span><span class="op" id="5512246">.</span><span class="ident" id="5512247">TokPos</span><span class="op" id="5512253">,</span>&nbsp;<span class="ident" id="5512255">s</span><span class="op" id="5512256">.</span><span class="ident" id="5512257">Tok</span><span class="op" id="5512260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512264">case</span>&nbsp;<span class="op" id="5512269">*</span><span class="ident" id="5512270">ast</span><span class="op" id="5512273">.</span><span class="ident" id="5512274">AssignStmt</span><span class="op" id="5512284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512288">var</span>&nbsp;<span class="ident" id="5512292">depth</span>&nbsp;<span class="op" id="5512298">=</span>&nbsp;<span class="num" id="5512300">1</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512304">if</span>&nbsp;<span class="builtinfunc" id="5512307">len</span><span class="op" id="5512310">(</span><span class="ident" id="5512311">s</span><span class="op" id="5512312">.</span><span class="ident" id="5512313">Lhs</span><span class="op" id="5512316">)</span>&nbsp;<span class="op" id="5512318">&gt;</span>&nbsp;<span class="num" id="5512320">1</span>&nbsp;<span class="op" id="5512322">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5512325">len</span><span class="op" id="5512328">(</span><span class="ident" id="5512329">s</span><span class="op" id="5512330">.</span><span class="ident" id="5512331">Rhs</span><span class="op" id="5512334">)</span>&nbsp;<span class="op" id="5512336">&gt;</span>&nbsp;<span class="num" id="5512338">1</span>&nbsp;<span class="op" id="5512340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512345">depth</span><span class="op" id="5512350">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5512355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512359">p</span><span class="op" id="5512360">.</span><span class="ident" id="5512361">exprList</span><span class="op" id="5512369">(</span><span class="ident" id="5512370">s</span><span class="op" id="5512371">.</span><span class="ident" id="5512372">Pos</span><span class="op" id="5512375">(</span><span class="op" id="5512376">)</span><span class="op" id="5512377">,</span>&nbsp;<span class="ident" id="5512379">s</span><span class="op" id="5512380">.</span><span class="ident" id="5512381">Lhs</span><span class="op" id="5512384">,</span>&nbsp;<span class="ident" id="5512386">depth</span><span class="op" id="5512391">,</span>&nbsp;<span class="num" id="5512393">0</span><span class="op" id="5512394">,</span>&nbsp;<span class="ident" id="5512396">s</span><span class="op" id="5512397">.</span><span class="ident" id="5512398">TokPos</span><span class="op" id="5512404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512408">p</span><span class="op" id="5512409">.</span><span class="builtinfunc" id="5512410">print</span><span class="op" id="5512415">(</span><span class="ident" id="5512416">blank</span><span class="op" id="5512421">,</span>&nbsp;<span class="ident" id="5512423">s</span><span class="op" id="5512424">.</span><span class="ident" id="5512425">TokPos</span><span class="op" id="5512431">,</span>&nbsp;<span class="ident" id="5512433">s</span><span class="op" id="5512434">.</span><span class="ident" id="5512435">Tok</span><span class="op" id="5512438">,</span>&nbsp;<span class="ident" id="5512440">blank</span><span class="op" id="5512445">)</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512449">p</span><span class="op" id="5512450">.</span><span class="ident" id="5512451">exprList</span><span class="op" id="5512459">(</span><span class="ident" id="5512460">s</span><span class="op" id="5512461">.</span><span class="ident" id="5512462">TokPos</span><span class="op" id="5512468">,</span>&nbsp;<span class="ident" id="5512470">s</span><span class="op" id="5512471">.</span><span class="ident" id="5512472">Rhs</span><span class="op" id="5512475">,</span>&nbsp;<span class="ident" id="5512477">depth</span><span class="op" id="5512482">,</span>&nbsp;<span class="num" id="5512484">0</span><span class="op" id="5512485">,</span>&nbsp;<span class="ident" id="5512487">token</span><span class="op" id="5512492">.</span><span class="ident" id="5512493">NoPos</span><span class="op" id="5512498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512502">case</span>&nbsp;<span class="op" id="5512507">*</span><span class="ident" id="5512508">ast</span><span class="op" id="5512511">.</span><span class="ident" id="5512512">GoStmt</span><span class="op" id="5512518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512522">p</span><span class="op" id="5512523">.</span><span class="builtinfunc" id="5512524">print</span><span class="op" id="5512529">(</span><span class="ident" id="5512530">token</span><span class="op" id="5512535">.</span><span class="ident" id="5512536">GO</span><span class="op" id="5512538">,</span>&nbsp;<span class="ident" id="5512540">blank</span><span class="op" id="5512545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512549">p</span><span class="op" id="5512550">.</span><span class="ident" id="5512551">expr</span><span class="op" id="5512555">(</span><span class="ident" id="5512556">s</span><span class="op" id="5512557">.</span><span class="ident" id="5512558">Call</span><span class="op" id="5512562">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512566">case</span>&nbsp;<span class="op" id="5512571">*</span><span class="ident" id="5512572">ast</span><span class="op" id="5512575">.</span><span class="ident" id="5512576">DeferStmt</span><span class="op" id="5512585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512589">p</span><span class="op" id="5512590">.</span><span class="builtinfunc" id="5512591">print</span><span class="op" id="5512596">(</span><span class="ident" id="5512597">token</span><span class="op" id="5512602">.</span><span class="ident" id="5512603">DEFER</span><span class="op" id="5512608">,</span>&nbsp;<span class="ident" id="5512610">blank</span><span class="op" id="5512615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512619">p</span><span class="op" id="5512620">.</span><span class="ident" id="5512621">expr</span><span class="op" id="5512625">(</span><span class="ident" id="5512626">s</span><span class="op" id="5512627">.</span><span class="ident" id="5512628">Call</span><span class="op" id="5512632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512636">case</span>&nbsp;<span class="op" id="5512641">*</span><span class="ident" id="5512642">ast</span><span class="op" id="5512645">.</span><span class="ident" id="5512646">ReturnStmt</span><span class="op" id="5512656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512660">p</span><span class="op" id="5512661">.</span><span class="builtinfunc" id="5512662">print</span><span class="op" id="5512667">(</span><span class="ident" id="5512668">token</span><span class="op" id="5512673">.</span><span class="ident" id="5512674">RETURN</span><span class="op" id="5512680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512684">if</span>&nbsp;<span class="ident" id="5512687">s</span><span class="op" id="5512688">.</span><span class="ident" id="5512689">Results</span>&nbsp;<span class="op" id="5512697">!=</span>&nbsp;<span class="builtintype" id="5512700">nil</span>&nbsp;<span class="op" id="5512704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512709">p</span><span class="op" id="5512710">.</span><span class="builtinfunc" id="5512711">print</span><span class="op" id="5512716">(</span><span class="ident" id="5512717">blank</span><span class="op" id="5512722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512727">//&nbsp;Use&nbsp;indentList&nbsp;heuristic&nbsp;to&nbsp;make&nbsp;corner&nbsp;cases&nbsp;look</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512784">//&nbsp;better&nbsp;(issue&nbsp;1207).&nbsp;A&nbsp;more&nbsp;systematic&nbsp;approach&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512844">//&nbsp;always&nbsp;indent,&nbsp;but&nbsp;this&nbsp;would&nbsp;cause&nbsp;significant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512898">//&nbsp;reformatting&nbsp;of&nbsp;the&nbsp;code&nbsp;base&nbsp;and&nbsp;not&nbsp;necessarily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512954">//&nbsp;lead&nbsp;to&nbsp;more&nbsp;nicely&nbsp;formatted&nbsp;code&nbsp;in&nbsp;general.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513007">if</span>&nbsp;<span class="ident" id="5513010">p</span><span class="op" id="5513011">.</span><span class="ident" id="5513012">indentList</span><span class="op" id="5513022">(</span><span class="ident" id="5513023">s</span><span class="op" id="5513024">.</span><span class="ident" id="5513025">Results</span><span class="op" id="5513032">)</span>&nbsp;<span class="op" id="5513034">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513040">p</span><span class="op" id="5513041">.</span><span class="builtinfunc" id="5513042">print</span><span class="op" id="5513047">(</span><span class="ident" id="5513048">indent</span><span class="op" id="5513054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513060">p</span><span class="op" id="5513061">.</span><span class="ident" id="5513062">exprList</span><span class="op" id="5513070">(</span><span class="ident" id="5513071">s</span><span class="op" id="5513072">.</span><span class="ident" id="5513073">Pos</span><span class="op" id="5513076">(</span><span class="op" id="5513077">)</span><span class="op" id="5513078">,</span>&nbsp;<span class="ident" id="5513080">s</span><span class="op" id="5513081">.</span><span class="ident" id="5513082">Results</span><span class="op" id="5513089">,</span>&nbsp;<span class="num" id="5513091">1</span><span class="op" id="5513092">,</span>&nbsp;<span class="ident" id="5513094">noIndent</span><span class="op" id="5513102">,</span>&nbsp;<span class="ident" id="5513104">token</span><span class="op" id="5513109">.</span><span class="ident" id="5513110">NoPos</span><span class="op" id="5513115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513121">p</span><span class="op" id="5513122">.</span><span class="builtinfunc" id="5513123">print</span><span class="op" id="5513128">(</span><span class="ident" id="5513129">unindent</span><span class="op" id="5513137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513142">}</span>&nbsp;<span class="keyword" id="5513144">else</span>&nbsp;<span class="op" id="5513149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513155">p</span><span class="op" id="5513156">.</span><span class="ident" id="5513157">exprList</span><span class="op" id="5513165">(</span><span class="ident" id="5513166">s</span><span class="op" id="5513167">.</span><span class="ident" id="5513168">Pos</span><span class="op" id="5513171">(</span><span class="op" id="5513172">)</span><span class="op" id="5513173">,</span>&nbsp;<span class="ident" id="5513175">s</span><span class="op" id="5513176">.</span><span class="ident" id="5513177">Results</span><span class="op" id="5513184">,</span>&nbsp;<span class="num" id="5513186">1</span><span class="op" id="5513187">,</span>&nbsp;<span class="num" id="5513189">0</span><span class="op" id="5513190">,</span>&nbsp;<span class="ident" id="5513192">token</span><span class="op" id="5513197">.</span><span class="ident" id="5513198">NoPos</span><span class="op" id="5513203">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513216">case</span>&nbsp;<span class="op" id="5513221">*</span><span class="ident" id="5513222">ast</span><span class="op" id="5513225">.</span><span class="ident" id="5513226">BranchStmt</span><span class="op" id="5513236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513240">p</span><span class="op" id="5513241">.</span><span class="builtinfunc" id="5513242">print</span><span class="op" id="5513247">(</span><span class="ident" id="5513248">s</span><span class="op" id="5513249">.</span><span class="ident" id="5513250">Tok</span><span class="op" id="5513253">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513257">if</span>&nbsp;<span class="ident" id="5513260">s</span><span class="op" id="5513261">.</span><span class="ident" id="5513262">Label</span>&nbsp;<span class="op" id="5513268">!=</span>&nbsp;<span class="builtintype" id="5513271">nil</span>&nbsp;<span class="op" id="5513275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513280">p</span><span class="op" id="5513281">.</span><span class="builtinfunc" id="5513282">print</span><span class="op" id="5513287">(</span><span class="ident" id="5513288">blank</span><span class="op" id="5513293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513298">p</span><span class="op" id="5513299">.</span><span class="ident" id="5513300">expr</span><span class="op" id="5513304">(</span><span class="ident" id="5513305">s</span><span class="op" id="5513306">.</span><span class="ident" id="5513307">Label</span><span class="op" id="5513312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513320">case</span>&nbsp;<span class="op" id="5513325">*</span><span class="ident" id="5513326">ast</span><span class="op" id="5513329">.</span><span class="ident" id="5513330">BlockStmt</span><span class="op" id="5513339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513343">p</span><span class="op" id="5513344">.</span><span class="ident" id="5513345">block</span><span class="op" id="5513350">(</span><span class="ident" id="5513351">s</span><span class="op" id="5513352">,</span>&nbsp;<span class="num" id="5513354">1</span><span class="op" id="5513355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513359">case</span>&nbsp;<span class="op" id="5513364">*</span><span class="ident" id="5513365">ast</span><span class="op" id="5513368">.</span><span class="ident" id="5513369">IfStmt</span><span class="op" id="5513375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513379">p</span><span class="op" id="5513380">.</span><span class="builtinfunc" id="5513381">print</span><span class="op" id="5513386">(</span><span class="ident" id="5513387">token</span><span class="op" id="5513392">.</span><span class="ident" id="5513393">IF</span><span class="op" id="5513395">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513399">p</span><span class="op" id="5513400">.</span><span class="ident" id="5513401">controlClause</span><span class="op" id="5513414">(</span><span class="builtintype" id="5513415">false</span><span class="op" id="5513420">,</span>&nbsp;<span class="ident" id="5513422">s</span><span class="op" id="5513423">.</span><span class="ident" id="5513424">Init</span><span class="op" id="5513428">,</span>&nbsp;<span class="ident" id="5513430">s</span><span class="op" id="5513431">.</span><span class="ident" id="5513432">Cond</span><span class="op" id="5513436">,</span>&nbsp;<span class="builtintype" id="5513438">nil</span><span class="op" id="5513441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513445">p</span><span class="op" id="5513446">.</span><span class="ident" id="5513447">block</span><span class="op" id="5513452">(</span><span class="ident" id="5513453">s</span><span class="op" id="5513454">.</span><span class="ident" id="5513455">Body</span><span class="op" id="5513459">,</span>&nbsp;<span class="num" id="5513461">1</span><span class="op" id="5513462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513466">if</span>&nbsp;<span class="ident" id="5513469">s</span><span class="op" id="5513470">.</span><span class="ident" id="5513471">Else</span>&nbsp;<span class="op" id="5513476">!=</span>&nbsp;<span class="builtintype" id="5513479">nil</span>&nbsp;<span class="op" id="5513483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513488">p</span><span class="op" id="5513489">.</span><span class="builtinfunc" id="5513490">print</span><span class="op" id="5513495">(</span><span class="ident" id="5513496">blank</span><span class="op" id="5513501">,</span>&nbsp;<span class="ident" id="5513503">token</span><span class="op" id="5513508">.</span><span class="ident" id="5513509">ELSE</span><span class="op" id="5513513">,</span>&nbsp;<span class="ident" id="5513515">blank</span><span class="op" id="5513520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513525">switch</span>&nbsp;<span class="ident" id="5513532">s</span><span class="op" id="5513533">.</span><span class="ident" id="5513534">Else</span><span class="op" id="5513538">.</span><span class="op" id="5513539">(</span><span class="keyword" id="5513540">type</span><span class="op" id="5513544">)</span>&nbsp;<span class="op" id="5513546">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513551">case</span>&nbsp;<span class="op" id="5513556">*</span><span class="ident" id="5513557">ast</span><span class="op" id="5513560">.</span><span class="ident" id="5513561">BlockStmt</span><span class="op" id="5513570">,</span>&nbsp;<span class="op" id="5513572">*</span><span class="ident" id="5513573">ast</span><span class="op" id="5513576">.</span><span class="ident" id="5513577">IfStmt</span><span class="op" id="5513583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513589">p</span><span class="op" id="5513590">.</span><span class="ident" id="5513591">stmt</span><span class="op" id="5513595">(</span><span class="ident" id="5513596">s</span><span class="op" id="5513597">.</span><span class="ident" id="5513598">Else</span><span class="op" id="5513602">,</span>&nbsp;<span class="ident" id="5513604">nextIsRBrace</span><span class="op" id="5513616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513621">default</span><span class="op" id="5513628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513634">p</span><span class="op" id="5513635">.</span><span class="builtinfunc" id="5513636">print</span><span class="op" id="5513641">(</span><span class="ident" id="5513642">token</span><span class="op" id="5513647">.</span><span class="ident" id="5513648">LBRACE</span><span class="op" id="5513654">,</span>&nbsp;<span class="ident" id="5513656">indent</span><span class="op" id="5513662">,</span>&nbsp;<span class="ident" id="5513664">formfeed</span><span class="op" id="5513672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513678">p</span><span class="op" id="5513679">.</span><span class="ident" id="5513680">stmt</span><span class="op" id="5513684">(</span><span class="ident" id="5513685">s</span><span class="op" id="5513686">.</span><span class="ident" id="5513687">Else</span><span class="op" id="5513691">,</span>&nbsp;<span class="builtintype" id="5513693">true</span><span class="op" id="5513697">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513703">p</span><span class="op" id="5513704">.</span><span class="builtinfunc" id="5513705">print</span><span class="op" id="5513710">(</span><span class="ident" id="5513711">unindent</span><span class="op" id="5513719">,</span>&nbsp;<span class="ident" id="5513721">formfeed</span><span class="op" id="5513729">,</span>&nbsp;<span class="ident" id="5513731">token</span><span class="op" id="5513736">.</span><span class="ident" id="5513737">RBRACE</span><span class="op" id="5513743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513756">case</span>&nbsp;<span class="op" id="5513761">*</span><span class="ident" id="5513762">ast</span><span class="op" id="5513765">.</span><span class="ident" id="5513766">CaseClause</span><span class="op" id="5513776">:</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513780">if</span>&nbsp;<span class="ident" id="5513783">s</span><span class="op" id="5513784">.</span><span class="ident" id="5513785">List</span>&nbsp;<span class="op" id="5513790">!=</span>&nbsp;<span class="builtintype" id="5513793">nil</span>&nbsp;<span class="op" id="5513797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513802">p</span><span class="op" id="5513803">.</span><span class="builtinfunc" id="5513804">print</span><span class="op" id="5513809">(</span><span class="ident" id="5513810">token</span><span class="op" id="5513815">.</span><span class="ident" id="5513816">CASE</span><span class="op" id="5513820">,</span>&nbsp;<span class="ident" id="5513822">blank</span><span class="op" id="5513827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513832">p</span><span class="op" id="5513833">.</span><span class="ident" id="5513834">exprList</span><span class="op" id="5513842">(</span><span class="ident" id="5513843">s</span><span class="op" id="5513844">.</span><span class="ident" id="5513845">Pos</span><span class="op" id="5513848">(</span><span class="op" id="5513849">)</span><span class="op" id="5513850">,</span>&nbsp;<span class="ident" id="5513852">s</span><span class="op" id="5513853">.</span><span class="ident" id="5513854">List</span><span class="op" id="5513858">,</span>&nbsp;<span class="num" id="5513860">1</span><span class="op" id="5513861">,</span>&nbsp;<span class="num" id="5513863">0</span><span class="op" id="5513864">,</span>&nbsp;<span class="ident" id="5513866">s</span><span class="op" id="5513867">.</span><span class="ident" id="5513868">Colon</span><span class="op" id="5513873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513877">}</span>&nbsp;<span class="keyword" id="5513879">else</span>&nbsp;<span class="op" id="5513884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513889">p</span><span class="op" id="5513890">.</span><span class="builtinfunc" id="5513891">print</span><span class="op" id="5513896">(</span><span class="ident" id="5513897">token</span><span class="op" id="5513902">.</span><span class="ident" id="5513903">DEFAULT</span><span class="op" id="5513910">)</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513918">p</span><span class="op" id="5513919">.</span><span class="builtinfunc" id="5513920">print</span><span class="op" id="5513925">(</span><span class="ident" id="5513926">s</span><span class="op" id="5513927">.</span><span class="ident" id="5513928">Colon</span><span class="op" id="5513933">,</span>&nbsp;<span class="ident" id="5513935">token</span><span class="op" id="5513940">.</span><span class="ident" id="5513941">COLON</span><span class="op" id="5513946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513950">p</span><span class="op" id="5513951">.</span><span class="ident" id="5513952">stmtList</span><span class="op" id="5513960">(</span><span class="ident" id="5513961">s</span><span class="op" id="5513962">.</span><span class="ident" id="5513963">Body</span><span class="op" id="5513967">,</span>&nbsp;<span class="num" id="5513969">1</span><span class="op" id="5513970">,</span>&nbsp;<span class="ident" id="5513972">nextIsRBrace</span><span class="op" id="5513984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513988">case</span>&nbsp;<span class="op" id="5513993">*</span><span class="ident" id="5513994">ast</span><span class="op" id="5513997">.</span><span class="ident" id="5513998">SwitchStmt</span><span class="op" id="5514008">:</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514012">p</span><span class="op" id="5514013">.</span><span class="builtinfunc" id="5514014">print</span><span class="op" id="5514019">(</span><span class="ident" id="5514020">token</span><span class="op" id="5514025">.</span><span class="ident" id="5514026">SWITCH</span><span class="op" id="5514032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514036">p</span><span class="op" id="5514037">.</span><span class="ident" id="5514038">controlClause</span><span class="op" id="5514051">(</span><span class="builtintype" id="5514052">false</span><span class="op" id="5514057">,</span>&nbsp;<span class="ident" id="5514059">s</span><span class="op" id="5514060">.</span><span class="ident" id="5514061">Init</span><span class="op" id="5514065">,</span>&nbsp;<span class="ident" id="5514067">s</span><span class="op" id="5514068">.</span><span class="ident" id="5514069">Tag</span><span class="op" id="5514072">,</span>&nbsp;<span class="builtintype" id="5514074">nil</span><span class="op" id="5514077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514081">p</span><span class="op" id="5514082">.</span><span class="ident" id="5514083">block</span><span class="op" id="5514088">(</span><span class="ident" id="5514089">s</span><span class="op" id="5514090">.</span><span class="ident" id="5514091">Body</span><span class="op" id="5514095">,</span>&nbsp;<span class="num" id="5514097">0</span><span class="op" id="5514098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514102">case</span>&nbsp;<span class="op" id="5514107">*</span><span class="ident" id="5514108">ast</span><span class="op" id="5514111">.</span><span class="ident" id="5514112">TypeSwitchStmt</span><span class="op" id="5514126">:</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514130">p</span><span class="op" id="5514131">.</span><span class="builtinfunc" id="5514132">print</span><span class="op" id="5514137">(</span><span class="ident" id="5514138">token</span><span class="op" id="5514143">.</span><span class="ident" id="5514144">SWITCH</span><span class="op" id="5514150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514154">if</span>&nbsp;<span class="ident" id="5514157">s</span><span class="op" id="5514158">.</span><span class="ident" id="5514159">Init</span>&nbsp;<span class="op" id="5514164">!=</span>&nbsp;<span class="builtintype" id="5514167">nil</span>&nbsp;<span class="op" id="5514171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514176">p</span><span class="op" id="5514177">.</span><span class="builtinfunc" id="5514178">print</span><span class="op" id="5514183">(</span><span class="ident" id="5514184">blank</span><span class="op" id="5514189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514194">p</span><span class="op" id="5514195">.</span><span class="ident" id="5514196">stmt</span><span class="op" id="5514200">(</span><span class="ident" id="5514201">s</span><span class="op" id="5514202">.</span><span class="ident" id="5514203">Init</span><span class="op" id="5514207">,</span>&nbsp;<span class="builtintype" id="5514209">false</span><span class="op" id="5514214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514219">p</span><span class="op" id="5514220">.</span><span class="builtinfunc" id="5514221">print</span><span class="op" id="5514226">(</span><span class="ident" id="5514227">token</span><span class="op" id="5514232">.</span><span class="ident" id="5514233">SEMICOLON</span><span class="op" id="5514242">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514250">p</span><span class="op" id="5514251">.</span><span class="builtinfunc" id="5514252">print</span><span class="op" id="5514257">(</span><span class="ident" id="5514258">blank</span><span class="op" id="5514263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514267">p</span><span class="op" id="5514268">.</span><span class="ident" id="5514269">stmt</span><span class="op" id="5514273">(</span><span class="ident" id="5514274">s</span><span class="op" id="5514275">.</span><span class="ident" id="5514276">Assign</span><span class="op" id="5514282">,</span>&nbsp;<span class="builtintype" id="5514284">false</span><span class="op" id="5514289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514293">p</span><span class="op" id="5514294">.</span><span class="builtinfunc" id="5514295">print</span><span class="op" id="5514300">(</span><span class="ident" id="5514301">blank</span><span class="op" id="5514306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514310">p</span><span class="op" id="5514311">.</span><span class="ident" id="5514312">block</span><span class="op" id="5514317">(</span><span class="ident" id="5514318">s</span><span class="op" id="5514319">.</span><span class="ident" id="5514320">Body</span><span class="op" id="5514324">,</span>&nbsp;<span class="num" id="5514326">0</span><span class="op" id="5514327">)</span><br>
<span class="lineno">1195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514331">case</span>&nbsp;<span class="op" id="5514336">*</span><span class="ident" id="5514337">ast</span><span class="op" id="5514340">.</span><span class="ident" id="5514341">CommClause</span><span class="op" id="5514351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514355">if</span>&nbsp;<span class="ident" id="5514358">s</span><span class="op" id="5514359">.</span><span class="ident" id="5514360">Comm</span>&nbsp;<span class="op" id="5514365">!=</span>&nbsp;<span class="builtintype" id="5514368">nil</span>&nbsp;<span class="op" id="5514372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514377">p</span><span class="op" id="5514378">.</span><span class="builtinfunc" id="5514379">print</span><span class="op" id="5514384">(</span><span class="ident" id="5514385">token</span><span class="op" id="5514390">.</span><span class="ident" id="5514391">CASE</span><span class="op" id="5514395">,</span>&nbsp;<span class="ident" id="5514397">blank</span><span class="op" id="5514402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514407">p</span><span class="op" id="5514408">.</span><span class="ident" id="5514409">stmt</span><span class="op" id="5514413">(</span><span class="ident" id="5514414">s</span><span class="op" id="5514415">.</span><span class="ident" id="5514416">Comm</span><span class="op" id="5514420">,</span>&nbsp;<span class="builtintype" id="5514422">false</span><span class="op" id="5514427">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514431">}</span>&nbsp;<span class="keyword" id="5514433">else</span>&nbsp;<span class="op" id="5514438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514443">p</span><span class="op" id="5514444">.</span><span class="builtinfunc" id="5514445">print</span><span class="op" id="5514450">(</span><span class="ident" id="5514451">token</span><span class="op" id="5514456">.</span><span class="ident" id="5514457">DEFAULT</span><span class="op" id="5514464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514472">p</span><span class="op" id="5514473">.</span><span class="builtinfunc" id="5514474">print</span><span class="op" id="5514479">(</span><span class="ident" id="5514480">s</span><span class="op" id="5514481">.</span><span class="ident" id="5514482">Colon</span><span class="op" id="5514487">,</span>&nbsp;<span class="ident" id="5514489">token</span><span class="op" id="5514494">.</span><span class="ident" id="5514495">COLON</span><span class="op" id="5514500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514504">p</span><span class="op" id="5514505">.</span><span class="ident" id="5514506">stmtList</span><span class="op" id="5514514">(</span><span class="ident" id="5514515">s</span><span class="op" id="5514516">.</span><span class="ident" id="5514517">Body</span><span class="op" id="5514521">,</span>&nbsp;<span class="num" id="5514523">1</span><span class="op" id="5514524">,</span>&nbsp;<span class="ident" id="5514526">nextIsRBrace</span><span class="op" id="5514538">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514542">case</span>&nbsp;<span class="op" id="5514547">*</span><span class="ident" id="5514548">ast</span><span class="op" id="5514551">.</span><span class="ident" id="5514552">SelectStmt</span><span class="op" id="5514562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514566">p</span><span class="op" id="5514567">.</span><span class="builtinfunc" id="5514568">print</span><span class="op" id="5514573">(</span><span class="ident" id="5514574">token</span><span class="op" id="5514579">.</span><span class="ident" id="5514580">SELECT</span><span class="op" id="5514586">,</span>&nbsp;<span class="ident" id="5514588">blank</span><span class="op" id="5514593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514597">body</span>&nbsp;<span class="op" id="5514602">:=</span>&nbsp;<span class="ident" id="5514605">s</span><span class="op" id="5514606">.</span><span class="ident" id="5514607">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514614">if</span>&nbsp;<span class="builtinfunc" id="5514617">len</span><span class="op" id="5514620">(</span><span class="ident" id="5514621">body</span><span class="op" id="5514625">.</span><span class="ident" id="5514626">List</span><span class="op" id="5514630">)</span>&nbsp;<span class="op" id="5514632">==</span>&nbsp;<span class="num" id="5514635">0</span>&nbsp;<span class="op" id="5514637">&amp;&amp;</span>&nbsp;<span class="op" id="5514640">!</span><span class="ident" id="5514641">p</span><span class="op" id="5514642">.</span><span class="ident" id="5514643">commentBefore</span><span class="op" id="5514656">(</span><span class="ident" id="5514657">p</span><span class="op" id="5514658">.</span><span class="ident" id="5514659">posFor</span><span class="op" id="5514665">(</span><span class="ident" id="5514666">body</span><span class="op" id="5514670">.</span><span class="ident" id="5514671">Rbrace</span><span class="op" id="5514677">)</span><span class="op" id="5514678">)</span>&nbsp;<span class="op" id="5514680">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514685">//&nbsp;print&nbsp;empty&nbsp;select&nbsp;statement&nbsp;w/o&nbsp;comments&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514745">p</span><span class="op" id="5514746">.</span><span class="builtinfunc" id="5514747">print</span><span class="op" id="5514752">(</span><span class="ident" id="5514753">body</span><span class="op" id="5514757">.</span><span class="ident" id="5514758">Lbrace</span><span class="op" id="5514764">,</span>&nbsp;<span class="ident" id="5514766">token</span><span class="op" id="5514771">.</span><span class="ident" id="5514772">LBRACE</span><span class="op" id="5514778">,</span>&nbsp;<span class="ident" id="5514780">body</span><span class="op" id="5514784">.</span><span class="ident" id="5514785">Rbrace</span><span class="op" id="5514791">,</span>&nbsp;<span class="ident" id="5514793">token</span><span class="op" id="5514798">.</span><span class="ident" id="5514799">RBRACE</span><span class="op" id="5514805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514809">}</span>&nbsp;<span class="keyword" id="5514811">else</span>&nbsp;<span class="op" id="5514816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514821">p</span><span class="op" id="5514822">.</span><span class="ident" id="5514823">block</span><span class="op" id="5514828">(</span><span class="ident" id="5514829">body</span><span class="op" id="5514833">,</span>&nbsp;<span class="num" id="5514835">0</span><span class="op" id="5514836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514840">}</span><br>
<span class="lineno">1215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514844">case</span>&nbsp;<span class="op" id="5514849">*</span><span class="ident" id="5514850">ast</span><span class="op" id="5514853">.</span><span class="ident" id="5514854">ForStmt</span><span class="op" id="5514861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514865">p</span><span class="op" id="5514866">.</span><span class="builtinfunc" id="5514867">print</span><span class="op" id="5514872">(</span><span class="ident" id="5514873">token</span><span class="op" id="5514878">.</span><span class="ident" id="5514879">FOR</span><span class="op" id="5514882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514886">p</span><span class="op" id="5514887">.</span><span class="ident" id="5514888">controlClause</span><span class="op" id="5514901">(</span><span class="builtintype" id="5514902">true</span><span class="op" id="5514906">,</span>&nbsp;<span class="ident" id="5514908">s</span><span class="op" id="5514909">.</span><span class="ident" id="5514910">Init</span><span class="op" id="5514914">,</span>&nbsp;<span class="ident" id="5514916">s</span><span class="op" id="5514917">.</span><span class="ident" id="5514918">Cond</span><span class="op" id="5514922">,</span>&nbsp;<span class="ident" id="5514924">s</span><span class="op" id="5514925">.</span><span class="ident" id="5514926">Post</span><span class="op" id="5514930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514934">p</span><span class="op" id="5514935">.</span><span class="ident" id="5514936">block</span><span class="op" id="5514941">(</span><span class="ident" id="5514942">s</span><span class="op" id="5514943">.</span><span class="ident" id="5514944">Body</span><span class="op" id="5514948">,</span>&nbsp;<span class="num" id="5514950">1</span><span class="op" id="5514951">)</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514955">case</span>&nbsp;<span class="op" id="5514960">*</span><span class="ident" id="5514961">ast</span><span class="op" id="5514964">.</span><span class="ident" id="5514965">RangeStmt</span><span class="op" id="5514974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514978">p</span><span class="op" id="5514979">.</span><span class="builtinfunc" id="5514980">print</span><span class="op" id="5514985">(</span><span class="ident" id="5514986">token</span><span class="op" id="5514991">.</span><span class="ident" id="5514992">FOR</span><span class="op" id="5514995">,</span>&nbsp;<span class="ident" id="5514997">blank</span><span class="op" id="5515002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515006">if</span>&nbsp;<span class="ident" id="5515009">s</span><span class="op" id="5515010">.</span><span class="ident" id="5515011">Key</span>&nbsp;<span class="op" id="5515015">!=</span>&nbsp;<span class="builtintype" id="5515018">nil</span>&nbsp;<span class="op" id="5515022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515027">p</span><span class="op" id="5515028">.</span><span class="ident" id="5515029">expr</span><span class="op" id="5515033">(</span><span class="ident" id="5515034">s</span><span class="op" id="5515035">.</span><span class="ident" id="5515036">Key</span><span class="op" id="5515039">)</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515044">if</span>&nbsp;<span class="ident" id="5515047">s</span><span class="op" id="5515048">.</span><span class="ident" id="5515049">Value</span>&nbsp;<span class="op" id="5515055">!=</span>&nbsp;<span class="builtintype" id="5515058">nil</span>&nbsp;<span class="op" id="5515062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515068">//&nbsp;use&nbsp;position&nbsp;of&nbsp;value&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515120">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515172">p</span><span class="op" id="5515173">.</span><span class="builtinfunc" id="5515174">print</span><span class="op" id="5515179">(</span><span class="ident" id="5515180">s</span><span class="op" id="5515181">.</span><span class="ident" id="5515182">Value</span><span class="op" id="5515187">.</span><span class="ident" id="5515188">Pos</span><span class="op" id="5515191">(</span><span class="op" id="5515192">)</span><span class="op" id="5515193">,</span>&nbsp;<span class="ident" id="5515195">token</span><span class="op" id="5515200">.</span><span class="ident" id="5515201">COMMA</span><span class="op" id="5515206">,</span>&nbsp;<span class="ident" id="5515208">blank</span><span class="op" id="5515213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515219">p</span><span class="op" id="5515220">.</span><span class="ident" id="5515221">expr</span><span class="op" id="5515225">(</span><span class="ident" id="5515226">s</span><span class="op" id="5515227">.</span><span class="ident" id="5515228">Value</span><span class="op" id="5515233">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515243">p</span><span class="op" id="5515244">.</span><span class="builtinfunc" id="5515245">print</span><span class="op" id="5515250">(</span><span class="ident" id="5515251">blank</span><span class="op" id="5515256">,</span>&nbsp;<span class="ident" id="5515258">s</span><span class="op" id="5515259">.</span><span class="ident" id="5515260">TokPos</span><span class="op" id="5515266">,</span>&nbsp;<span class="ident" id="5515268">s</span><span class="op" id="5515269">.</span><span class="ident" id="5515270">Tok</span><span class="op" id="5515273">,</span>&nbsp;<span class="ident" id="5515275">blank</span><span class="op" id="5515280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515288">p</span><span class="op" id="5515289">.</span><span class="builtinfunc" id="5515290">print</span><span class="op" id="5515295">(</span><span class="ident" id="5515296">token</span><span class="op" id="5515301">.</span><span class="ident" id="5515302">RANGE</span><span class="op" id="5515307">,</span>&nbsp;<span class="ident" id="5515309">blank</span><span class="op" id="5515314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515318">p</span><span class="op" id="5515319">.</span><span class="ident" id="5515320">expr</span><span class="op" id="5515324">(</span><span class="ident" id="5515325">stripParens</span><span class="op" id="5515336">(</span><span class="ident" id="5515337">s</span><span class="op" id="5515338">.</span><span class="ident" id="5515339">X</span><span class="op" id="5515340">)</span><span class="op" id="5515341">)</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515345">p</span><span class="op" id="5515346">.</span><span class="builtinfunc" id="5515347">print</span><span class="op" id="5515352">(</span><span class="ident" id="5515353">blank</span><span class="op" id="5515358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515362">p</span><span class="op" id="5515363">.</span><span class="ident" id="5515364">block</span><span class="op" id="5515369">(</span><span class="ident" id="5515370">s</span><span class="op" id="5515371">.</span><span class="ident" id="5515372">Body</span><span class="op" id="5515376">,</span>&nbsp;<span class="num" id="5515378">1</span><span class="op" id="5515379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515383">default</span><span class="op" id="5515390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5515394">panic</span><span class="op" id="5515399">(</span><span class="string" id="5515400">&#34;unreachable&#34;</span><span class="op" id="5515413">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515420">return</span><br>
<span class="lineno"></span><span class="op" id="5515427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1245</span><span class="comment" id="5515430">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5515510">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5515527">//&nbsp;The&nbsp;keepTypeColumn&nbsp;function&nbsp;determines&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;of&nbsp;a&nbsp;series&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5515603">//&nbsp;consecutive&nbsp;const&nbsp;or&nbsp;var&nbsp;declarations&nbsp;must&nbsp;be&nbsp;kept,&nbsp;or&nbsp;if&nbsp;initialization</span><br>
<span class="lineno">1250</span><span class="comment" id="5515679">//&nbsp;values&nbsp;(V)&nbsp;can&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;type&nbsp;column&nbsp;(T)&nbsp;instead.&nbsp;The&nbsp;i&#39;th&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5515754">//&nbsp;in&nbsp;the&nbsp;result&nbsp;slice&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;in&nbsp;spec[i]&nbsp;must&nbsp;be&nbsp;kept.</span><br>
<span class="lineno"></span><span class="comment" id="5515829">//</span><br>
<span class="lineno"></span><span class="comment" id="5515832">//&nbsp;For&nbsp;example,&nbsp;the&nbsp;declaration:</span><br>
<span class="lineno"></span><span class="comment" id="5515865">//</span><br>
<span class="lineno">1255</span><span class="comment" id="5515868">//&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;(</span><br>
<span class="lineno"></span><span class="comment" id="5515879">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foobar&nbsp;int&nbsp;=&nbsp;42&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5515910">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7&nbsp;&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5515941">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="5515949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;991</span><br>
<span class="lineno">1260</span><span class="comment" id="5515975">//&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="5515980">//</span><br>
<span class="lineno"></span><span class="comment" id="5515983">//&nbsp;leads&nbsp;to&nbsp;the&nbsp;type/values&nbsp;matrix&nbsp;below.&nbsp;A&nbsp;run&nbsp;of&nbsp;value&nbsp;columns&nbsp;(V)&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5516056">//&nbsp;be&nbsp;moved&nbsp;into&nbsp;the&nbsp;type&nbsp;column&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;type&nbsp;for&nbsp;any&nbsp;of&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5516131">//&nbsp;in&nbsp;that&nbsp;column&nbsp;(we&nbsp;only&nbsp;move&nbsp;entire&nbsp;columns&nbsp;so&nbsp;that&nbsp;they&nbsp;align&nbsp;properly).</span><br>
<span class="lineno">1265</span><span class="comment" id="5516208">//</span><br>
<span class="lineno"></span><span class="comment" id="5516211">//&nbsp;&nbsp;&nbsp;&nbsp;matrix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatted&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="5516249">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix</span><br>
<span class="lineno"></span><span class="comment" id="5516278">//&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;a&nbsp;T&nbsp;and&nbsp;so&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5516348">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno">1270</span><span class="comment" id="5516409">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="5516446">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;is&nbsp;moved&nbsp;into&nbsp;T&nbsp;column</span><br>
<span class="lineno"></span><span class="comment" id="5516512">//</span><br>
<span class="lineno"></span><span class="keyword" id="5516515">func</span>&nbsp;<span class="ident" id="5516520">keepTypeColumn</span><span class="op" id="5516534">(</span><span class="ident" id="5516535">specs</span>&nbsp;<span class="op" id="5516541">[</span><span class="op" id="5516542">]</span><span class="ident" id="5516543">ast</span><span class="op" id="5516546">.</span><span class="ident" id="5516547">Spec</span><span class="op" id="5516551">)</span>&nbsp;<span class="op" id="5516553">[</span><span class="op" id="5516554">]</span><span class="builtintype" id="5516555">bool</span>&nbsp;<span class="op" id="5516560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516563">m</span>&nbsp;<span class="op" id="5516565">:=</span>&nbsp;<span class="builtinfunc" id="5516568">make</span><span class="op" id="5516572">(</span><span class="op" id="5516573">[</span><span class="op" id="5516574">]</span><span class="builtintype" id="5516575">bool</span><span class="op" id="5516579">,</span>&nbsp;<span class="builtinfunc" id="5516581">len</span><span class="op" id="5516584">(</span><span class="ident" id="5516585">specs</span><span class="op" id="5516590">)</span><span class="op" id="5516591">)</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516595">populate</span>&nbsp;<span class="op" id="5516604">:=</span>&nbsp;<span class="keyword" id="5516607">func</span><span class="op" id="5516611">(</span><span class="ident" id="5516612">i</span><span class="op" id="5516613">,</span>&nbsp;<span class="ident" id="5516615">j</span>&nbsp;<span class="builtintype" id="5516617">int</span><span class="op" id="5516620">,</span>&nbsp;<span class="ident" id="5516622">keepType</span>&nbsp;<span class="builtintype" id="5516631">bool</span><span class="op" id="5516635">)</span>&nbsp;<span class="op" id="5516637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516641">if</span>&nbsp;<span class="ident" id="5516644">keepType</span>&nbsp;<span class="op" id="5516653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516658">for</span>&nbsp;<span class="op" id="5516662">;</span>&nbsp;<span class="ident" id="5516664">i</span>&nbsp;<span class="op" id="5516666">&lt;</span>&nbsp;<span class="ident" id="5516668">j</span><span class="op" id="5516669">;</span>&nbsp;<span class="ident" id="5516671">i</span><span class="op" id="5516672">++</span>&nbsp;<span class="op" id="5516675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516681">m</span><span class="op" id="5516682">[</span><span class="ident" id="5516683">i</span><span class="op" id="5516684">]</span>&nbsp;<span class="op" id="5516686">=</span>&nbsp;<span class="builtintype" id="5516688">true</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516707">i0</span>&nbsp;<span class="op" id="5516710">:=</span>&nbsp;<span class="op" id="5516713">-</span><span class="num" id="5516714">1</span>&nbsp;<span class="comment" id="5516716">//&nbsp;if&nbsp;i0&nbsp;&gt;=&nbsp;0&nbsp;we&nbsp;are&nbsp;in&nbsp;a&nbsp;run&nbsp;and&nbsp;i0&nbsp;is&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;run</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516778">var</span>&nbsp;<span class="ident" id="5516782">keepType</span>&nbsp;<span class="builtintype" id="5516791">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516797">for</span>&nbsp;<span class="ident" id="5516801">i</span><span class="op" id="5516802">,</span>&nbsp;<span class="ident" id="5516804">s</span>&nbsp;<span class="op" id="5516806">:=</span>&nbsp;<span class="keyword" id="5516809">range</span>&nbsp;<span class="ident" id="5516815">specs</span>&nbsp;<span class="op" id="5516821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516825">t</span>&nbsp;<span class="op" id="5516827">:=</span>&nbsp;<span class="ident" id="5516830">s</span><span class="op" id="5516831">.</span><span class="op" id="5516832">(</span><span class="op" id="5516833">*</span><span class="ident" id="5516834">ast</span><span class="op" id="5516837">.</span><span class="ident" id="5516838">ValueSpec</span><span class="op" id="5516847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516851">if</span>&nbsp;<span class="ident" id="5516854">t</span><span class="op" id="5516855">.</span><span class="ident" id="5516856">Values</span>&nbsp;<span class="op" id="5516863">!=</span>&nbsp;<span class="builtintype" id="5516866">nil</span>&nbsp;<span class="op" id="5516870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516875">if</span>&nbsp;<span class="ident" id="5516878">i0</span>&nbsp;<span class="op" id="5516881">&lt;</span>&nbsp;<span class="num" id="5516883">0</span>&nbsp;<span class="op" id="5516885">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5516891">//&nbsp;start&nbsp;of&nbsp;a&nbsp;run&nbsp;of&nbsp;ValueSpecs&nbsp;with&nbsp;non-nil&nbsp;Values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516947">i0</span>&nbsp;<span class="op" id="5516950">=</span>&nbsp;<span class="ident" id="5516952">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516958">keepType</span>&nbsp;<span class="op" id="5516967">=</span>&nbsp;<span class="builtintype" id="5516969">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516982">}</span>&nbsp;<span class="keyword" id="5516984">else</span>&nbsp;<span class="op" id="5516989">{</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516994">if</span>&nbsp;<span class="ident" id="5516997">i0</span>&nbsp;<span class="op" id="5517000">&gt;=</span>&nbsp;<span class="num" id="5517003">0</span>&nbsp;<span class="op" id="5517005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517011">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517031">populate</span><span class="op" id="5517039">(</span><span class="ident" id="5517040">i0</span><span class="op" id="5517042">,</span>&nbsp;<span class="ident" id="5517044">i</span><span class="op" id="5517045">,</span>&nbsp;<span class="ident" id="5517047">keepType</span><span class="op" id="5517055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517061">i0</span>&nbsp;<span class="op" id="5517064">=</span>&nbsp;<span class="op" id="5517066">-</span><span class="num" id="5517067">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517072">}</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517080">if</span>&nbsp;<span class="ident" id="5517083">t</span><span class="op" id="5517084">.</span><span class="ident" id="5517085">Type</span>&nbsp;<span class="op" id="5517090">!=</span>&nbsp;<span class="builtintype" id="5517093">nil</span>&nbsp;<span class="op" id="5517097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517102">keepType</span>&nbsp;<span class="op" id="5517111">=</span>&nbsp;<span class="builtintype" id="5517113">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517123">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517126">if</span>&nbsp;<span class="ident" id="5517129">i0</span>&nbsp;<span class="op" id="5517132">&gt;=</span>&nbsp;<span class="num" id="5517135">0</span>&nbsp;<span class="op" id="5517137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517141">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517159">populate</span><span class="op" id="5517167">(</span><span class="ident" id="5517168">i0</span><span class="op" id="5517170">,</span>&nbsp;<span class="builtinfunc" id="5517172">len</span><span class="op" id="5517175">(</span><span class="ident" id="5517176">specs</span><span class="op" id="5517181">)</span><span class="op" id="5517182">,</span>&nbsp;<span class="ident" id="5517184">keepType</span><span class="op" id="5517192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517199">return</span>&nbsp;<span class="ident" id="5517206">m</span><br>
<span class="lineno"></span><span class="op" id="5517208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517211">func</span>&nbsp;<span class="op" id="5517216">(</span><span class="ident" id="5517217">p</span>&nbsp;<span class="op" id="5517219">*</span><span class="ident" id="5517220">printer</span><span class="op" id="5517227">)</span>&nbsp;<span class="ident" id="5517229">valueSpec</span><span class="op" id="5517238">(</span><span class="ident" id="5517239">s</span>&nbsp;<span class="op" id="5517241">*</span><span class="ident" id="5517242">ast</span><span class="op" id="5517245">.</span><span class="ident" id="5517246">ValueSpec</span><span class="op" id="5517255">,</span>&nbsp;<span class="ident" id="5517257">keepType</span>&nbsp;<span class="builtintype" id="5517266">bool</span><span class="op" id="5517270">)</span>&nbsp;<span class="op" id="5517272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517275">p</span><span class="op" id="5517276">.</span><span class="ident" id="5517277">setComment</span><span class="op" id="5517287">(</span><span class="ident" id="5517288">s</span><span class="op" id="5517289">.</span><span class="ident" id="5517290">Doc</span><span class="op" id="5517293">)</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517296">p</span><span class="op" id="5517297">.</span><span class="ident" id="5517298">identList</span><span class="op" id="5517307">(</span><span class="ident" id="5517308">s</span><span class="op" id="5517309">.</span><span class="ident" id="5517310">Names</span><span class="op" id="5517315">,</span>&nbsp;<span class="builtintype" id="5517317">false</span><span class="op" id="5517322">)</span>&nbsp;<span class="comment" id="5517324">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517343">extraTabs</span>&nbsp;<span class="op" id="5517353">:=</span>&nbsp;<span class="num" id="5517356">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517359">if</span>&nbsp;<span class="ident" id="5517362">s</span><span class="op" id="5517363">.</span><span class="ident" id="5517364">Type</span>&nbsp;<span class="op" id="5517369">!=</span>&nbsp;<span class="builtintype" id="5517372">nil</span>&nbsp;<span class="op" id="5517376">||</span>&nbsp;<span class="ident" id="5517379">keepType</span>&nbsp;<span class="op" id="5517388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517392">p</span><span class="op" id="5517393">.</span><span class="builtinfunc" id="5517394">print</span><span class="op" id="5517399">(</span><span class="ident" id="5517400">vtab</span><span class="op" id="5517404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517408">extraTabs</span><span class="op" id="5517417">--</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517424">if</span>&nbsp;<span class="ident" id="5517427">s</span><span class="op" id="5517428">.</span><span class="ident" id="5517429">Type</span>&nbsp;<span class="op" id="5517434">!=</span>&nbsp;<span class="builtintype" id="5517437">nil</span>&nbsp;<span class="op" id="5517441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517445">p</span><span class="op" id="5517446">.</span><span class="ident" id="5517447">expr</span><span class="op" id="5517451">(</span><span class="ident" id="5517452">s</span><span class="op" id="5517453">.</span><span class="ident" id="5517454">Type</span><span class="op" id="5517458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517464">if</span>&nbsp;<span class="ident" id="5517467">s</span><span class="op" id="5517468">.</span><span class="ident" id="5517469">Values</span>&nbsp;<span class="op" id="5517476">!=</span>&nbsp;<span class="builtintype" id="5517479">nil</span>&nbsp;<span class="op" id="5517483">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517487">p</span><span class="op" id="5517488">.</span><span class="builtinfunc" id="5517489">print</span><span class="op" id="5517494">(</span><span class="ident" id="5517495">vtab</span><span class="op" id="5517499">,</span>&nbsp;<span class="ident" id="5517501">token</span><span class="op" id="5517506">.</span><span class="ident" id="5517507">ASSIGN</span><span class="op" id="5517513">,</span>&nbsp;<span class="ident" id="5517515">blank</span><span class="op" id="5517520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517524">p</span><span class="op" id="5517525">.</span><span class="ident" id="5517526">exprList</span><span class="op" id="5517534">(</span><span class="ident" id="5517535">token</span><span class="op" id="5517540">.</span><span class="ident" id="5517541">NoPos</span><span class="op" id="5517546">,</span>&nbsp;<span class="ident" id="5517548">s</span><span class="op" id="5517549">.</span><span class="ident" id="5517550">Values</span><span class="op" id="5517556">,</span>&nbsp;<span class="num" id="5517558">1</span><span class="op" id="5517559">,</span>&nbsp;<span class="num" id="5517561">0</span><span class="op" id="5517562">,</span>&nbsp;<span class="ident" id="5517564">token</span><span class="op" id="5517569">.</span><span class="ident" id="5517570">NoPos</span><span class="op" id="5517575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517579">extraTabs</span><span class="op" id="5517588">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517595">if</span>&nbsp;<span class="ident" id="5517598">s</span><span class="op" id="5517599">.</span><span class="ident" id="5517600">Comment</span>&nbsp;<span class="op" id="5517608">!=</span>&nbsp;<span class="builtintype" id="5517611">nil</span>&nbsp;<span class="op" id="5517615">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517619">for</span>&nbsp;<span class="op" id="5517623">;</span>&nbsp;<span class="ident" id="5517625">extraTabs</span>&nbsp;<span class="op" id="5517635">&gt;</span>&nbsp;<span class="num" id="5517637">0</span><span class="op" id="5517638">;</span>&nbsp;<span class="ident" id="5517640">extraTabs</span><span class="op" id="5517649">--</span>&nbsp;<span class="op" id="5517652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517657">p</span><span class="op" id="5517658">.</span><span class="builtinfunc" id="5517659">print</span><span class="op" id="5517664">(</span><span class="ident" id="5517665">vtab</span><span class="op" id="5517669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517677">p</span><span class="op" id="5517678">.</span><span class="ident" id="5517679">setComment</span><span class="op" id="5517689">(</span><span class="ident" id="5517690">s</span><span class="op" id="5517691">.</span><span class="ident" id="5517692">Comment</span><span class="op" id="5517699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517702">}</span><br>
<span class="lineno">1335</span><span class="op" id="5517704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5517707">//&nbsp;The&nbsp;parameter&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;specs&nbsp;in&nbsp;the&nbsp;group.&nbsp;If&nbsp;doIndent&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5517783">//&nbsp;multi-line&nbsp;identifier&nbsp;lists&nbsp;in&nbsp;the&nbsp;spec&nbsp;are&nbsp;indented&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5517854">//&nbsp;linebreak&nbsp;is&nbsp;encountered.</span><br>
<span class="lineno">1340</span><span class="comment" id="5517883">//</span><br>
<span class="lineno"></span><span class="keyword" id="5517886">func</span>&nbsp;<span class="op" id="5517891">(</span><span class="ident" id="5517892">p</span>&nbsp;<span class="op" id="5517894">*</span><span class="ident" id="5517895">printer</span><span class="op" id="5517902">)</span>&nbsp;<span class="ident" id="5517904">spec</span><span class="op" id="5517908">(</span><span class="ident" id="5517909">spec</span>&nbsp;<span class="ident" id="5517914">ast</span><span class="op" id="5517917">.</span><span class="ident" id="5517918">Spec</span><span class="op" id="5517922">,</span>&nbsp;<span class="ident" id="5517924">n</span>&nbsp;<span class="builtintype" id="5517926">int</span><span class="op" id="5517929">,</span>&nbsp;<span class="ident" id="5517931">doIndent</span>&nbsp;<span class="builtintype" id="5517940">bool</span><span class="op" id="5517944">)</span>&nbsp;<span class="op" id="5517946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517949">switch</span>&nbsp;<span class="ident" id="5517956">s</span>&nbsp;<span class="op" id="5517958">:=</span>&nbsp;<span class="ident" id="5517961">spec</span><span class="op" id="5517965">.</span><span class="op" id="5517966">(</span><span class="keyword" id="5517967">type</span><span class="op" id="5517971">)</span>&nbsp;<span class="op" id="5517973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517976">case</span>&nbsp;<span class="op" id="5517981">*</span><span class="ident" id="5517982">ast</span><span class="op" id="5517985">.</span><span class="ident" id="5517986">ImportSpec</span><span class="op" id="5517996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518000">p</span><span class="op" id="5518001">.</span><span class="ident" id="5518002">setComment</span><span class="op" id="5518012">(</span><span class="ident" id="5518013">s</span><span class="op" id="5518014">.</span><span class="ident" id="5518015">Doc</span><span class="op" id="5518018">)</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518022">if</span>&nbsp;<span class="ident" id="5518025">s</span><span class="op" id="5518026">.</span><span class="ident" id="5518027">Name</span>&nbsp;<span class="op" id="5518032">!=</span>&nbsp;<span class="builtintype" id="5518035">nil</span>&nbsp;<span class="op" id="5518039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518044">p</span><span class="op" id="5518045">.</span><span class="ident" id="5518046">expr</span><span class="op" id="5518050">(</span><span class="ident" id="5518051">s</span><span class="op" id="5518052">.</span><span class="ident" id="5518053">Name</span><span class="op" id="5518057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518062">p</span><span class="op" id="5518063">.</span><span class="builtinfunc" id="5518064">print</span><span class="op" id="5518069">(</span><span class="ident" id="5518070">blank</span><span class="op" id="5518075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518083">p</span><span class="op" id="5518084">.</span><span class="ident" id="5518085">expr</span><span class="op" id="5518089">(</span><span class="ident" id="5518090">s</span><span class="op" id="5518091">.</span><span class="ident" id="5518092">Path</span><span class="op" id="5518096">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518100">p</span><span class="op" id="5518101">.</span><span class="ident" id="5518102">setComment</span><span class="op" id="5518112">(</span><span class="ident" id="5518113">s</span><span class="op" id="5518114">.</span><span class="ident" id="5518115">Comment</span><span class="op" id="5518122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518126">p</span><span class="op" id="5518127">.</span><span class="builtinfunc" id="5518128">print</span><span class="op" id="5518133">(</span><span class="ident" id="5518134">s</span><span class="op" id="5518135">.</span><span class="ident" id="5518136">EndPos</span><span class="op" id="5518142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518146">case</span>&nbsp;<span class="op" id="5518151">*</span><span class="ident" id="5518152">ast</span><span class="op" id="5518155">.</span><span class="ident" id="5518156">ValueSpec</span><span class="op" id="5518165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518169">if</span>&nbsp;<span class="ident" id="5518172">n</span>&nbsp;<span class="op" id="5518174">!=</span>&nbsp;<span class="num" id="5518177">1</span>&nbsp;<span class="op" id="5518179">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518184">p</span><span class="op" id="5518185">.</span><span class="ident" id="5518186">internalError</span><span class="op" id="5518199">(</span><span class="string" id="5518200">&#34;expected&nbsp;n&nbsp;=&nbsp;1;&nbsp;got&#34;</span><span class="op" id="5518221">,</span>&nbsp;<span class="ident" id="5518223">n</span><span class="op" id="5518224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518232">p</span><span class="op" id="5518233">.</span><span class="ident" id="5518234">setComment</span><span class="op" id="5518244">(</span><span class="ident" id="5518245">s</span><span class="op" id="5518246">.</span><span class="ident" id="5518247">Doc</span><span class="op" id="5518250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518254">p</span><span class="op" id="5518255">.</span><span class="ident" id="5518256">identList</span><span class="op" id="5518265">(</span><span class="ident" id="5518266">s</span><span class="op" id="5518267">.</span><span class="ident" id="5518268">Names</span><span class="op" id="5518273">,</span>&nbsp;<span class="ident" id="5518275">doIndent</span><span class="op" id="5518283">)</span>&nbsp;<span class="comment" id="5518285">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518305">if</span>&nbsp;<span class="ident" id="5518308">s</span><span class="op" id="5518309">.</span><span class="ident" id="5518310">Type</span>&nbsp;<span class="op" id="5518315">!=</span>&nbsp;<span class="builtintype" id="5518318">nil</span>&nbsp;<span class="op" id="5518322">{</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518327">p</span><span class="op" id="5518328">.</span><span class="builtinfunc" id="5518329">print</span><span class="op" id="5518334">(</span><span class="ident" id="5518335">blank</span><span class="op" id="5518340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518345">p</span><span class="op" id="5518346">.</span><span class="ident" id="5518347">expr</span><span class="op" id="5518351">(</span><span class="ident" id="5518352">s</span><span class="op" id="5518353">.</span><span class="ident" id="5518354">Type</span><span class="op" id="5518358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518366">if</span>&nbsp;<span class="ident" id="5518369">s</span><span class="op" id="5518370">.</span><span class="ident" id="5518371">Values</span>&nbsp;<span class="op" id="5518378">!=</span>&nbsp;<span class="builtintype" id="5518381">nil</span>&nbsp;<span class="op" id="5518385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518390">p</span><span class="op" id="5518391">.</span><span class="builtinfunc" id="5518392">print</span><span class="op" id="5518397">(</span><span class="ident" id="5518398">blank</span><span class="op" id="5518403">,</span>&nbsp;<span class="ident" id="5518405">token</span><span class="op" id="5518410">.</span><span class="ident" id="5518411">ASSIGN</span><span class="op" id="5518417">,</span>&nbsp;<span class="ident" id="5518419">blank</span><span class="op" id="5518424">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518429">p</span><span class="op" id="5518430">.</span><span class="ident" id="5518431">exprList</span><span class="op" id="5518439">(</span><span class="ident" id="5518440">token</span><span class="op" id="5518445">.</span><span class="ident" id="5518446">NoPos</span><span class="op" id="5518451">,</span>&nbsp;<span class="ident" id="5518453">s</span><span class="op" id="5518454">.</span><span class="ident" id="5518455">Values</span><span class="op" id="5518461">,</span>&nbsp;<span class="num" id="5518463">1</span><span class="op" id="5518464">,</span>&nbsp;<span class="num" id="5518466">0</span><span class="op" id="5518467">,</span>&nbsp;<span class="ident" id="5518469">token</span><span class="op" id="5518474">.</span><span class="ident" id="5518475">NoPos</span><span class="op" id="5518480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518488">p</span><span class="op" id="5518489">.</span><span class="ident" id="5518490">setComment</span><span class="op" id="5518500">(</span><span class="ident" id="5518501">s</span><span class="op" id="5518502">.</span><span class="ident" id="5518503">Comment</span><span class="op" id="5518510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518514">case</span>&nbsp;<span class="op" id="5518519">*</span><span class="ident" id="5518520">ast</span><span class="op" id="5518523">.</span><span class="ident" id="5518524">TypeSpec</span><span class="op" id="5518532">:</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518536">p</span><span class="op" id="5518537">.</span><span class="ident" id="5518538">setComment</span><span class="op" id="5518548">(</span><span class="ident" id="5518549">s</span><span class="op" id="5518550">.</span><span class="ident" id="5518551">Doc</span><span class="op" id="5518554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518558">p</span><span class="op" id="5518559">.</span><span class="ident" id="5518560">expr</span><span class="op" id="5518564">(</span><span class="ident" id="5518565">s</span><span class="op" id="5518566">.</span><span class="ident" id="5518567">Name</span><span class="op" id="5518571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518575">if</span>&nbsp;<span class="ident" id="5518578">n</span>&nbsp;<span class="op" id="5518580">==</span>&nbsp;<span class="num" id="5518583">1</span>&nbsp;<span class="op" id="5518585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518590">p</span><span class="op" id="5518591">.</span><span class="builtinfunc" id="5518592">print</span><span class="op" id="5518597">(</span><span class="ident" id="5518598">blank</span><span class="op" id="5518603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518607">}</span>&nbsp;<span class="keyword" id="5518609">else</span>&nbsp;<span class="op" id="5518614">{</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518619">p</span><span class="op" id="5518620">.</span><span class="builtinfunc" id="5518621">print</span><span class="op" id="5518626">(</span><span class="ident" id="5518627">vtab</span><span class="op" id="5518631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518639">p</span><span class="op" id="5518640">.</span><span class="ident" id="5518641">expr</span><span class="op" id="5518645">(</span><span class="ident" id="5518646">s</span><span class="op" id="5518647">.</span><span class="ident" id="5518648">Type</span><span class="op" id="5518652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518656">p</span><span class="op" id="5518657">.</span><span class="ident" id="5518658">setComment</span><span class="op" id="5518668">(</span><span class="ident" id="5518669">s</span><span class="op" id="5518670">.</span><span class="ident" id="5518671">Comment</span><span class="op" id="5518678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518682">default</span><span class="op" id="5518689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5518693">panic</span><span class="op" id="5518698">(</span><span class="string" id="5518699">&#34;unreachable&#34;</span><span class="op" id="5518712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518715">}</span><br>
<span class="lineno"></span><span class="op" id="5518717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1385</span><span class="keyword" id="5518720">func</span>&nbsp;<span class="op" id="5518725">(</span><span class="ident" id="5518726">p</span>&nbsp;<span class="op" id="5518728">*</span><span class="ident" id="5518729">printer</span><span class="op" id="5518736">)</span>&nbsp;<span class="ident" id="5518738">genDecl</span><span class="op" id="5518745">(</span><span class="ident" id="5518746">d</span>&nbsp;<span class="op" id="5518748">*</span><span class="ident" id="5518749">ast</span><span class="op" id="5518752">.</span><span class="ident" id="5518753">GenDecl</span><span class="op" id="5518760">)</span>&nbsp;<span class="op" id="5518762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518765">p</span><span class="op" id="5518766">.</span><span class="ident" id="5518767">setComment</span><span class="op" id="5518777">(</span><span class="ident" id="5518778">d</span><span class="op" id="5518779">.</span><span class="ident" id="5518780">Doc</span><span class="op" id="5518783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518786">p</span><span class="op" id="5518787">.</span><span class="builtinfunc" id="5518788">print</span><span class="op" id="5518793">(</span><span class="ident" id="5518794">d</span><span class="op" id="5518795">.</span><span class="ident" id="5518796">Pos</span><span class="op" id="5518799">(</span><span class="op" id="5518800">)</span><span class="op" id="5518801">,</span>&nbsp;<span class="ident" id="5518803">d</span><span class="op" id="5518804">.</span><span class="ident" id="5518805">Tok</span><span class="op" id="5518808">,</span>&nbsp;<span class="ident" id="5518810">blank</span><span class="op" id="5518815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518819">if</span>&nbsp;<span class="ident" id="5518822">d</span><span class="op" id="5518823">.</span><span class="ident" id="5518824">Lparen</span><span class="op" id="5518830">.</span><span class="ident" id="5518831">IsValid</span><span class="op" id="5518838">(</span><span class="op" id="5518839">)</span>&nbsp;<span class="op" id="5518841">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518845">//&nbsp;group&nbsp;of&nbsp;parenthesized&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518886">p</span><span class="op" id="5518887">.</span><span class="builtinfunc" id="5518888">print</span><span class="op" id="5518893">(</span><span class="ident" id="5518894">d</span><span class="op" id="5518895">.</span><span class="ident" id="5518896">Lparen</span><span class="op" id="5518902">,</span>&nbsp;<span class="ident" id="5518904">token</span><span class="op" id="5518909">.</span><span class="ident" id="5518910">LPAREN</span><span class="op" id="5518916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518920">if</span>&nbsp;<span class="ident" id="5518923">n</span>&nbsp;<span class="op" id="5518925">:=</span>&nbsp;<span class="builtinfunc" id="5518928">len</span><span class="op" id="5518931">(</span><span class="ident" id="5518932">d</span><span class="op" id="5518933">.</span><span class="ident" id="5518934">Specs</span><span class="op" id="5518939">)</span><span class="op" id="5518940">;</span>&nbsp;<span class="ident" id="5518942">n</span>&nbsp;<span class="op" id="5518944">&gt;</span>&nbsp;<span class="num" id="5518946">0</span>&nbsp;<span class="op" id="5518948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518953">p</span><span class="op" id="5518954">.</span><span class="builtinfunc" id="5518955">print</span><span class="op" id="5518960">(</span><span class="ident" id="5518961">indent</span><span class="op" id="5518967">,</span>&nbsp;<span class="ident" id="5518969">formfeed</span><span class="op" id="5518977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518982">if</span>&nbsp;<span class="ident" id="5518985">n</span>&nbsp;<span class="op" id="5518987">&gt;</span>&nbsp;<span class="num" id="5518989">1</span>&nbsp;<span class="op" id="5518991">&amp;&amp;</span>&nbsp;<span class="op" id="5518994">(</span><span class="ident" id="5518995">d</span><span class="op" id="5518996">.</span><span class="ident" id="5518997">Tok</span>&nbsp;<span class="op" id="5519001">==</span>&nbsp;<span class="ident" id="5519004">token</span><span class="op" id="5519009">.</span><span class="ident" id="5519010">CONST</span>&nbsp;<span class="op" id="5519016">||</span>&nbsp;<span class="ident" id="5519019">d</span><span class="op" id="5519020">.</span><span class="ident" id="5519021">Tok</span>&nbsp;<span class="op" id="5519025">==</span>&nbsp;<span class="ident" id="5519028">token</span><span class="op" id="5519033">.</span><span class="ident" id="5519034">VAR</span><span class="op" id="5519037">)</span>&nbsp;<span class="op" id="5519039">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519045">//&nbsp;two&nbsp;or&nbsp;more&nbsp;grouped&nbsp;const/var&nbsp;declarations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519096">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519145">keepType</span>&nbsp;<span class="op" id="5519154">:=</span>&nbsp;<span class="ident" id="5519157">keepTypeColumn</span><span class="op" id="5519171">(</span><span class="ident" id="5519172">d</span><span class="op" id="5519173">.</span><span class="ident" id="5519174">Specs</span><span class="op" id="5519179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519185">var</span>&nbsp;<span class="ident" id="5519189">line</span>&nbsp;<span class="builtintype" id="5519194">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519202">for</span>&nbsp;<span class="ident" id="5519206">i</span><span class="op" id="5519207">,</span>&nbsp;<span class="ident" id="5519209">s</span>&nbsp;<span class="op" id="5519211">:=</span>&nbsp;<span class="keyword" id="5519214">range</span>&nbsp;<span class="ident" id="5519220">d</span><span class="op" id="5519221">.</span><span class="ident" id="5519222">Specs</span>&nbsp;<span class="op" id="5519228">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519235">if</span>&nbsp;<span class="ident" id="5519238">i</span>&nbsp;<span class="op" id="5519240">&gt;</span>&nbsp;<span class="num" id="5519242">0</span>&nbsp;<span class="op" id="5519244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519252">p</span><span class="op" id="5519253">.</span><span class="ident" id="5519254">linebreak</span><span class="op" id="5519263">(</span><span class="ident" id="5519264">p</span><span class="op" id="5519265">.</span><span class="ident" id="5519266">lineFor</span><span class="op" id="5519273">(</span><span class="ident" id="5519274">s</span><span class="op" id="5519275">.</span><span class="ident" id="5519276">Pos</span><span class="op" id="5519279">(</span><span class="op" id="5519280">)</span><span class="op" id="5519281">)</span><span class="op" id="5519282">,</span>&nbsp;<span class="num" id="5519284">1</span><span class="op" id="5519285">,</span>&nbsp;<span class="ident" id="5519287">ignore</span><span class="op" id="5519293">,</span>&nbsp;<span class="ident" id="5519295">p</span><span class="op" id="5519296">.</span><span class="ident" id="5519297">linesFrom</span><span class="op" id="5519306">(</span><span class="ident" id="5519307">line</span><span class="op" id="5519311">)</span>&nbsp;<span class="op" id="5519313">&gt;</span>&nbsp;<span class="num" id="5519315">0</span><span class="op" id="5519316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519330">p</span><span class="op" id="5519331">.</span><span class="ident" id="5519332">recordLine</span><span class="op" id="5519342">(</span><span class="op" id="5519343">&amp;</span><span class="ident" id="5519344">line</span><span class="op" id="5519348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519355">p</span><span class="op" id="5519356">.</span><span class="ident" id="5519357">valueSpec</span><span class="op" id="5519366">(</span><span class="ident" id="5519367">s</span><span class="op" id="5519368">.</span><span class="op" id="5519369">(</span><span class="op" id="5519370">*</span><span class="ident" id="5519371">ast</span><span class="op" id="5519374">.</span><span class="ident" id="5519375">ValueSpec</span><span class="op" id="5519384">)</span><span class="op" id="5519385">,</span>&nbsp;<span class="ident" id="5519387">keepType</span><span class="op" id="5519395">[</span><span class="ident" id="5519396">i</span><span class="op" id="5519397">]</span><span class="op" id="5519398">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519409">}</span>&nbsp;<span class="keyword" id="5519411">else</span>&nbsp;<span class="op" id="5519416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519422">var</span>&nbsp;<span class="ident" id="5519426">line</span>&nbsp;<span class="builtintype" id="5519431">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519439">for</span>&nbsp;<span class="ident" id="5519443">i</span><span class="op" id="5519444">,</span>&nbsp;<span class="ident" id="5519446">s</span>&nbsp;<span class="op" id="5519448">:=</span>&nbsp;<span class="keyword" id="5519451">range</span>&nbsp;<span class="ident" id="5519457">d</span><span class="op" id="5519458">.</span><span class="ident" id="5519459">Specs</span>&nbsp;<span class="op" id="5519465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519472">if</span>&nbsp;<span class="ident" id="5519475">i</span>&nbsp;<span class="op" id="5519477">&gt;</span>&nbsp;<span class="num" id="5519479">0</span>&nbsp;<span class="op" id="5519481">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519489">p</span><span class="op" id="5519490">.</span><span class="ident" id="5519491">linebreak</span><span class="op" id="5519500">(</span><span class="ident" id="5519501">p</span><span class="op" id="5519502">.</span><span class="ident" id="5519503">lineFor</span><span class="op" id="5519510">(</span><span class="ident" id="5519511">s</span><span class="op" id="5519512">.</span><span class="ident" id="5519513">Pos</span><span class="op" id="5519516">(</span><span class="op" id="5519517">)</span><span class="op" id="5519518">)</span><span class="op" id="5519519">,</span>&nbsp;<span class="num" id="5519521">1</span><span class="op" id="5519522">,</span>&nbsp;<span class="ident" id="5519524">ignore</span><span class="op" id="5519530">,</span>&nbsp;<span class="ident" id="5519532">p</span><span class="op" id="5519533">.</span><span class="ident" id="5519534">linesFrom</span><span class="op" id="5519543">(</span><span class="ident" id="5519544">line</span><span class="op" id="5519548">)</span>&nbsp;<span class="op" id="5519550">&gt;</span>&nbsp;<span class="num" id="5519552">0</span><span class="op" id="5519553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519567">p</span><span class="op" id="5519568">.</span><span class="ident" id="5519569">recordLine</span><span class="op" id="5519579">(</span><span class="op" id="5519580">&amp;</span><span class="ident" id="5519581">line</span><span class="op" id="5519585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519592">p</span><span class="op" id="5519593">.</span><span class="ident" id="5519594">spec</span><span class="op" id="5519598">(</span><span class="ident" id="5519599">s</span><span class="op" id="5519600">,</span>&nbsp;<span class="ident" id="5519602">n</span><span class="op" id="5519603">,</span>&nbsp;<span class="builtintype" id="5519605">false</span><span class="op" id="5519610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519616">}</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519626">p</span><span class="op" id="5519627">.</span><span class="builtinfunc" id="5519628">print</span><span class="op" id="5519633">(</span><span class="ident" id="5519634">unindent</span><span class="op" id="5519642">,</span>&nbsp;<span class="ident" id="5519644">formfeed</span><span class="op" id="5519652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519660">p</span><span class="op" id="5519661">.</span><span class="builtinfunc" id="5519662">print</span><span class="op" id="5519667">(</span><span class="ident" id="5519668">d</span><span class="op" id="5519669">.</span><span class="ident" id="5519670">Rparen</span><span class="op" id="5519676">,</span>&nbsp;<span class="ident" id="5519678">token</span><span class="op" id="5519683">.</span><span class="ident" id="5519684">RPAREN</span><span class="op" id="5519690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519694">}</span>&nbsp;<span class="keyword" id="5519696">else</span>&nbsp;<span class="op" id="5519701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519705">//&nbsp;single&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519729">p</span><span class="op" id="5519730">.</span><span class="ident" id="5519731">spec</span><span class="op" id="5519735">(</span><span class="ident" id="5519736">d</span><span class="op" id="5519737">.</span><span class="ident" id="5519738">Specs</span><span class="op" id="5519743">[</span><span class="num" id="5519744">0</span><span class="op" id="5519745">]</span><span class="op" id="5519746">,</span>&nbsp;<span class="num" id="5519748">1</span><span class="op" id="5519749">,</span>&nbsp;<span class="builtintype" id="5519751">true</span><span class="op" id="5519755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519758">}</span><br>
<span class="lineno"></span><span class="op" id="5519760">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5519763">//&nbsp;nodeSize&nbsp;determines&nbsp;the&nbsp;size&nbsp;of&nbsp;n&nbsp;in&nbsp;chars&nbsp;after&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="comment" id="5519827">//&nbsp;The&nbsp;result&nbsp;is&nbsp;&lt;=&nbsp;maxSize&nbsp;if&nbsp;the&nbsp;node&nbsp;fits&nbsp;on&nbsp;one&nbsp;line&nbsp;with&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5519892">//&nbsp;most&nbsp;maxSize&nbsp;chars&nbsp;and&nbsp;the&nbsp;formatted&nbsp;output&nbsp;doesn&#39;t&nbsp;contain</span><br>
<span class="lineno"></span><span class="comment" id="5519955">//&nbsp;any&nbsp;control&nbsp;chars.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;&gt;&nbsp;maxSize.</span><br>
<span class="lineno">1430</span><span class="comment" id="5520013">//</span><br>
<span class="lineno"></span><span class="keyword" id="5520016">func</span>&nbsp;<span class="op" id="5520021">(</span><span class="ident" id="5520022">p</span>&nbsp;<span class="op" id="5520024">*</span><span class="ident" id="5520025">printer</span><span class="op" id="5520032">)</span>&nbsp;<span class="ident" id="5520034">nodeSize</span><span class="op" id="5520042">(</span><span class="ident" id="5520043">n</span>&nbsp;<span class="ident" id="5520045">ast</span><span class="op" id="5520048">.</span><span class="ident" id="5520049">Node</span><span class="op" id="5520053">,</span>&nbsp;<span class="ident" id="5520055">maxSize</span>&nbsp;<span class="builtintype" id="5520063">int</span><span class="op" id="5520066">)</span>&nbsp;<span class="op" id="5520068">(</span><span class="ident" id="5520069">size</span>&nbsp;<span class="builtintype" id="5520074">int</span><span class="op" id="5520077">)</span>&nbsp;<span class="op" id="5520079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520082">//&nbsp;nodeSize&nbsp;invokes&nbsp;the&nbsp;printer,&nbsp;which&nbsp;may&nbsp;invoke&nbsp;nodeSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520142">//&nbsp;recursively.&nbsp;For&nbsp;deep&nbsp;composite&nbsp;literal&nbsp;nests,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520202">//&nbsp;lead&nbsp;to&nbsp;an&nbsp;exponential&nbsp;algorithm.&nbsp;Remember&nbsp;previous</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520258">//&nbsp;results&nbsp;to&nbsp;prune&nbsp;the&nbsp;recursion&nbsp;(was&nbsp;issue&nbsp;1628).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520311">if</span>&nbsp;<span class="ident" id="5520314">size</span><span class="op" id="5520318">,</span>&nbsp;<span class="ident" id="5520320">found</span>&nbsp;<span class="op" id="5520326">:=</span>&nbsp;<span class="ident" id="5520329">p</span><span class="op" id="5520330">.</span><span class="ident" id="5520331">nodeSizes</span><span class="op" id="5520340">[</span><span class="ident" id="5520341">n</span><span class="op" id="5520342">]</span><span class="op" id="5520343">;</span>&nbsp;<span class="ident" id="5520345">found</span>&nbsp;<span class="op" id="5520351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520355">return</span>&nbsp;<span class="ident" id="5520362">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520372">size</span>&nbsp;<span class="op" id="5520377">=</span>&nbsp;<span class="ident" id="5520379">maxSize</span>&nbsp;<span class="op" id="5520387">+</span>&nbsp;<span class="num" id="5520389">1</span>&nbsp;<span class="comment" id="5520391">//&nbsp;assume&nbsp;n&nbsp;doesn&#39;t&nbsp;fit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520416">p</span><span class="op" id="5520417">.</span><span class="ident" id="5520418">nodeSizes</span><span class="op" id="5520427">[</span><span class="ident" id="5520428">n</span><span class="op" id="5520429">]</span>&nbsp;<span class="op" id="5520431">=</span>&nbsp;<span class="ident" id="5520433">size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520440">//&nbsp;nodeSize&nbsp;computation&nbsp;must&nbsp;be&nbsp;independent&nbsp;of&nbsp;particular</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520499">//&nbsp;style&nbsp;so&nbsp;that&nbsp;we&nbsp;always&nbsp;get&nbsp;the&nbsp;same&nbsp;decision;&nbsp;print</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520556">//&nbsp;in&nbsp;RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520573">cfg</span>&nbsp;<span class="op" id="5520577">:=</span>&nbsp;<span class="ident" id="5520580">Config</span><span class="op" id="5520586">{</span><span class="ident" id="5520587">Mode</span><span class="op" id="5520591">:</span>&nbsp;<span class="ident" id="5520593">RawFormat</span><span class="op" id="5520602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520605">var</span>&nbsp;<span class="ident" id="5520609">buf</span>&nbsp;<span class="ident" id="5520613">bytes</span><span class="op" id="5520618">.</span><span class="ident" id="5520619">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520627">if</span>&nbsp;<span class="ident" id="5520630">err</span>&nbsp;<span class="op" id="5520634">:=</span>&nbsp;<span class="ident" id="5520637">cfg</span><span class="op" id="5520640">.</span><span class="ident" id="5520641">fprint</span><span class="op" id="5520647">(</span><span class="op" id="5520648">&amp;</span><span class="ident" id="5520649">buf</span><span class="op" id="5520652">,</span>&nbsp;<span class="ident" id="5520654">p</span><span class="op" id="5520655">.</span><span class="ident" id="5520656">fset</span><span class="op" id="5520660">,</span>&nbsp;<span class="ident" id="5520662">n</span><span class="op" id="5520663">,</span>&nbsp;<span class="ident" id="5520665">p</span><span class="op" id="5520666">.</span><span class="ident" id="5520667">nodeSizes</span><span class="op" id="5520676">)</span><span class="op" id="5520677">;</span>&nbsp;<span class="ident" id="5520679">err</span>&nbsp;<span class="op" id="5520683">!=</span>&nbsp;<span class="builtintype" id="5520686">nil</span>&nbsp;<span class="op" id="5520690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520694">return</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520705">if</span>&nbsp;<span class="ident" id="5520708">buf</span><span class="op" id="5520711">.</span><span class="ident" id="5520712">Len</span><span class="op" id="5520715">(</span><span class="op" id="5520716">)</span>&nbsp;<span class="op" id="5520718">&lt;=</span>&nbsp;<span class="ident" id="5520721">maxSize</span>&nbsp;<span class="op" id="5520729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520733">for</span>&nbsp;<span class="ident" id="5520737">_</span><span class="op" id="5520738">,</span>&nbsp;<span class="ident" id="5520740">ch</span>&nbsp;<span class="op" id="5520743">:=</span>&nbsp;<span class="keyword" id="5520746">range</span>&nbsp;<span class="ident" id="5520752">buf</span><span class="op" id="5520755">.</span><span class="ident" id="5520756">Bytes</span><span class="op" id="5520761">(</span><span class="op" id="5520762">)</span>&nbsp;<span class="op" id="5520764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520769">if</span>&nbsp;<span class="ident" id="5520772">ch</span>&nbsp;<span class="op" id="5520775">&lt;</span>&nbsp;<span class="string" id="5520777">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5520781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520787">return</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520805">size</span>&nbsp;<span class="op" id="5520810">=</span>&nbsp;<span class="ident" id="5520812">buf</span><span class="op" id="5520815">.</span><span class="ident" id="5520816">Len</span><span class="op" id="5520819">(</span><span class="op" id="5520820">)</span>&nbsp;<span class="comment" id="5520822">//&nbsp;n&nbsp;fits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520834">p</span><span class="op" id="5520835">.</span><span class="ident" id="5520836">nodeSizes</span><span class="op" id="5520845">[</span><span class="ident" id="5520846">n</span><span class="op" id="5520847">]</span>&nbsp;<span class="op" id="5520849">=</span>&nbsp;<span class="ident" id="5520851">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520857">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520860">return</span><br>
<span class="lineno"></span><span class="op" id="5520867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520870">//&nbsp;bodySize&nbsp;is&nbsp;like&nbsp;nodeSize&nbsp;but&nbsp;it&nbsp;is&nbsp;specialized&nbsp;for&nbsp;*ast.BlockStmt&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5520943">func</span>&nbsp;<span class="op" id="5520948">(</span><span class="ident" id="5520949">p</span>&nbsp;<span class="op" id="5520951">*</span><span class="ident" id="5520952">printer</span><span class="op" id="5520959">)</span>&nbsp;<span class="ident" id="5520961">bodySize</span><span class="op" id="5520969">(</span><span class="ident" id="5520970">b</span>&nbsp;<span class="op" id="5520972">*</span><span class="ident" id="5520973">ast</span><span class="op" id="5520976">.</span><span class="ident" id="5520977">BlockStmt</span><span class="op" id="5520986">,</span>&nbsp;<span class="ident" id="5520988">maxSize</span>&nbsp;<span class="builtintype" id="5520996">int</span><span class="op" id="5520999">)</span>&nbsp;<span class="builtintype" id="5521001">int</span>&nbsp;<span class="op" id="5521005">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521008">pos1</span>&nbsp;<span class="op" id="5521013">:=</span>&nbsp;<span class="ident" id="5521016">b</span><span class="op" id="5521017">.</span><span class="ident" id="5521018">Pos</span><span class="op" id="5521021">(</span><span class="op" id="5521022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521025">pos2</span>&nbsp;<span class="op" id="5521030">:=</span>&nbsp;<span class="ident" id="5521033">b</span><span class="op" id="5521034">.</span><span class="ident" id="5521035">Rbrace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521043">if</span>&nbsp;<span class="ident" id="5521046">pos1</span><span class="op" id="5521050">.</span><span class="ident" id="5521051">IsValid</span><span class="op" id="5521058">(</span><span class="op" id="5521059">)</span>&nbsp;<span class="op" id="5521061">&amp;&amp;</span>&nbsp;<span class="ident" id="5521064">pos2</span><span class="op" id="5521068">.</span><span class="ident" id="5521069">IsValid</span><span class="op" id="5521076">(</span><span class="op" id="5521077">)</span>&nbsp;<span class="op" id="5521079">&amp;&amp;</span>&nbsp;<span class="ident" id="5521082">p</span><span class="op" id="5521083">.</span><span class="ident" id="5521084">lineFor</span><span class="op" id="5521091">(</span><span class="ident" id="5521092">pos1</span><span class="op" id="5521096">)</span>&nbsp;<span class="op" id="5521098">!=</span>&nbsp;<span class="ident" id="5521101">p</span><span class="op" id="5521102">.</span><span class="ident" id="5521103">lineFor</span><span class="op" id="5521110">(</span><span class="ident" id="5521111">pos2</span><span class="op" id="5521115">)</span>&nbsp;<span class="op" id="5521117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5521121">//&nbsp;opening&nbsp;and&nbsp;closing&nbsp;brace&nbsp;are&nbsp;on&nbsp;different&nbsp;lines&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521203">return</span>&nbsp;<span class="ident" id="5521210">maxSize</span>&nbsp;<span class="op" id="5521218">+</span>&nbsp;<span class="num" id="5521220">1</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5521223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521226">if</span>&nbsp;<span class="builtinfunc" id="5521229">len</span><span class="op" id="5521232">(</span><span class="ident" id="5521233">b</span><span class="op" id="5521234">.</span><span class="ident" id="5521235">List</span><span class="op" id="5521239">)</span>&nbsp;<span class="op" id="5521241">&gt;</span>&nbsp;<span class="num" id="5521243">5</span>&nbsp;<span class="op" id="5521245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5521249">//&nbsp;too&nbsp;many&nbsp;statements&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521302">return</span>&nbsp;<span class="ident" id="5521309">maxSize</span>&nbsp;<span class="op" id="5521317">+</span>&nbsp;<span class="num" id="5521319">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5521322">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5521325">//&nbsp;otherwise,&nbsp;estimate&nbsp;body&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521359">bodySize</span>&nbsp;<span class="op" id="5521368">:=</span>&nbsp;<span class="ident" id="5521371">p</span><span class="op" id="5521372">.</span><span class="ident" id="5521373">commentSizeBefore</span><span class="op" id="5521390">(</span><span class="ident" id="5521391">p</span><span class="op" id="5521392">.</span><span class="ident" id="5521393">posFor</span><span class="op" id="5521399">(</span><span class="ident" id="5521400">pos2</span><span class="op" id="5521404">)</span><span class="op" id="5521405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521408">for</span>&nbsp;<span class="ident" id="5521412">i</span><span class="op" id="5521413">,</span>&nbsp;<span class="ident" id="5521415">s</span>&nbsp;<span class="op" id="5521417">:=</span>&nbsp;<span class="keyword" id="5521420">range</span>&nbsp;<span class="ident" id="5521426">b</span><span class="op" id="5521427">.</span><span class="ident" id="5521428">List</span>&nbsp;<span class="op" id="5521433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521437">if</span>&nbsp;<span class="ident" id="5521440">bodySize</span>&nbsp;<span class="op" id="5521449">&gt;</span>&nbsp;<span class="ident" id="5521451">maxSize</span>&nbsp;<span class="op" id="5521459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521464">break</span>&nbsp;<span class="comment" id="5521470">//&nbsp;no&nbsp;need&nbsp;to&nbsp;continue</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5521495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521499">if</span>&nbsp;<span class="ident" id="5521502">i</span>&nbsp;<span class="op" id="5521504">&gt;</span>&nbsp;<span class="num" id="5521506">0</span>&nbsp;<span class="op" id="5521508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521513">bodySize</span>&nbsp;<span class="op" id="5521522">+=</span>&nbsp;<span class="num" id="5521525">2</span>&nbsp;<span class="comment" id="5521527">//&nbsp;space&nbsp;for&nbsp;a&nbsp;semicolon&nbsp;and&nbsp;blank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5521564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521568">bodySize</span>&nbsp;<span class="op" id="5521577">+=</span>&nbsp;<span class="ident" id="5521580">p</span><span class="op" id="5521581">.</span><span class="ident" id="5521582">nodeSize</span><span class="op" id="5521590">(</span><span class="ident" id="5521591">s</span><span class="op" id="5521592">,</span>&nbsp;<span class="ident" id="5521594">maxSize</span><span class="op" id="5521601">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5521604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521607">return</span>&nbsp;<span class="ident" id="5521614">bodySize</span><br>
<span class="lineno"></span><span class="op" id="5521623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5521626">//&nbsp;adjBlock&nbsp;prints&nbsp;an&nbsp;&#34;adjacent&#34;&nbsp;block&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;or&nbsp;function&nbsp;body)&nbsp;following</span><br>
<span class="lineno">1490</span><span class="comment" id="5521711">//&nbsp;a&nbsp;header&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;control&nbsp;clause&nbsp;or&nbsp;function&nbsp;signature)&nbsp;of&nbsp;given&nbsp;headerSize.</span><br>
<span class="lineno"></span><span class="comment" id="5521800">//&nbsp;If&nbsp;the&nbsp;header&#39;s&nbsp;and&nbsp;block&#39;s&nbsp;size&nbsp;are&nbsp;&#34;small&nbsp;enough&#34;&nbsp;and&nbsp;the&nbsp;block&nbsp;is&nbsp;&#34;simple&nbsp;enough&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5521889">//&nbsp;the&nbsp;block&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;without&nbsp;line&nbsp;breaks,&nbsp;spaced&nbsp;from&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5521978">//&nbsp;by&nbsp;sep.&nbsp;Otherwise&nbsp;the&nbsp;block&#39;s&nbsp;opening&nbsp;&#34;{&#34;&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5522067">//&nbsp;lines&nbsp;for&nbsp;the&nbsp;block&#39;s&nbsp;statements&nbsp;and&nbsp;its&nbsp;closing&nbsp;&#34;}&#34;.</span><br>
<span class="lineno">1495</span><span class="comment" id="5522124">//</span><br>
<span class="lineno"></span><span class="keyword" id="5522127">func</span>&nbsp;<span class="op" id="5522132">(</span><span class="ident" id="5522133">p</span>&nbsp;<span class="op" id="5522135">*</span><span class="ident" id="5522136">printer</span><span class="op" id="5522143">)</span>&nbsp;<span class="ident" id="5522145">adjBlock</span><span class="op" id="5522153">(</span><span class="ident" id="5522154">headerSize</span>&nbsp;<span class="builtintype" id="5522165">int</span><span class="op" id="5522168">,</span>&nbsp;<span class="ident" id="5522170">sep</span>&nbsp;<span class="ident" id="5522174">whiteSpace</span><span class="op" id="5522184">,</span>&nbsp;<span class="ident" id="5522186">b</span>&nbsp;<span class="op" id="5522188">*</span><span class="ident" id="5522189">ast</span><span class="op" id="5522192">.</span><span class="ident" id="5522193">BlockStmt</span><span class="op" id="5522202">)</span>&nbsp;<span class="op" id="5522204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522207">if</span>&nbsp;<span class="ident" id="5522210">b</span>&nbsp;<span class="op" id="5522212">==</span>&nbsp;<span class="builtintype" id="5522215">nil</span>&nbsp;<span class="op" id="5522219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522223">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522231">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522235">const</span>&nbsp;<span class="ident" id="5522241">maxSize</span>&nbsp;<span class="op" id="5522249">=</span>&nbsp;<span class="num" id="5522251">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522256">if</span>&nbsp;<span class="ident" id="5522259">headerSize</span><span class="op" id="5522269">+</span><span class="ident" id="5522270">p</span><span class="op" id="5522271">.</span><span class="ident" id="5522272">bodySize</span><span class="op" id="5522280">(</span><span class="ident" id="5522281">b</span><span class="op" id="5522282">,</span>&nbsp;<span class="ident" id="5522284">maxSize</span><span class="op" id="5522291">)</span>&nbsp;<span class="op" id="5522293">&lt;=</span>&nbsp;<span class="ident" id="5522296">maxSize</span>&nbsp;<span class="op" id="5522304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522308">p</span><span class="op" id="5522309">.</span><span class="builtinfunc" id="5522310">print</span><span class="op" id="5522315">(</span><span class="ident" id="5522316">sep</span><span class="op" id="5522319">,</span>&nbsp;<span class="ident" id="5522321">b</span><span class="op" id="5522322">.</span><span class="ident" id="5522323">Lbrace</span><span class="op" id="5522329">,</span>&nbsp;<span class="ident" id="5522331">token</span><span class="op" id="5522336">.</span><span class="ident" id="5522337">LBRACE</span><span class="op" id="5522343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522347">if</span>&nbsp;<span class="builtinfunc" id="5522350">len</span><span class="op" id="5522353">(</span><span class="ident" id="5522354">b</span><span class="op" id="5522355">.</span><span class="ident" id="5522356">List</span><span class="op" id="5522360">)</span>&nbsp;<span class="op" id="5522362">&gt;</span>&nbsp;<span class="num" id="5522364">0</span>&nbsp;<span class="op" id="5522366">{</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522371">p</span><span class="op" id="5522372">.</span><span class="builtinfunc" id="5522373">print</span><span class="op" id="5522378">(</span><span class="ident" id="5522379">blank</span><span class="op" id="5522384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522389">for</span>&nbsp;<span class="ident" id="5522393">i</span><span class="op" id="5522394">,</span>&nbsp;<span class="ident" id="5522396">s</span>&nbsp;<span class="op" id="5522398">:=</span>&nbsp;<span class="keyword" id="5522401">range</span>&nbsp;<span class="ident" id="5522407">b</span><span class="op" id="5522408">.</span><span class="ident" id="5522409">List</span>&nbsp;<span class="op" id="5522414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522420">if</span>&nbsp;<span class="ident" id="5522423">i</span>&nbsp;<span class="op" id="5522425">&gt;</span>&nbsp;<span class="num" id="5522427">0</span>&nbsp;<span class="op" id="5522429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522436">p</span><span class="op" id="5522437">.</span><span class="builtinfunc" id="5522438">print</span><span class="op" id="5522443">(</span><span class="ident" id="5522444">token</span><span class="op" id="5522449">.</span><span class="ident" id="5522450">SEMICOLON</span><span class="op" id="5522459">,</span>&nbsp;<span class="ident" id="5522461">blank</span><span class="op" id="5522466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522472">}</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522478">p</span><span class="op" id="5522479">.</span><span class="ident" id="5522480">stmt</span><span class="op" id="5522484">(</span><span class="ident" id="5522485">s</span><span class="op" id="5522486">,</span>&nbsp;<span class="ident" id="5522488">i</span>&nbsp;<span class="op" id="5522490">==</span>&nbsp;<span class="builtinfunc" id="5522493">len</span><span class="op" id="5522496">(</span><span class="ident" id="5522497">b</span><span class="op" id="5522498">.</span><span class="ident" id="5522499">List</span><span class="op" id="5522503">)</span><span class="op" id="5522504">-</span><span class="num" id="5522505">1</span><span class="op" id="5522506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522516">p</span><span class="op" id="5522517">.</span><span class="builtinfunc" id="5522518">print</span><span class="op" id="5522523">(</span><span class="ident" id="5522524">blank</span><span class="op" id="5522529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522537">p</span><span class="op" id="5522538">.</span><span class="builtinfunc" id="5522539">print</span><span class="op" id="5522544">(</span><span class="ident" id="5522545">noExtraLinebreak</span><span class="op" id="5522561">,</span>&nbsp;<span class="ident" id="5522563">b</span><span class="op" id="5522564">.</span><span class="ident" id="5522565">Rbrace</span><span class="op" id="5522571">,</span>&nbsp;<span class="ident" id="5522573">token</span><span class="op" id="5522578">.</span><span class="ident" id="5522579">RBRACE</span><span class="op" id="5522585">,</span>&nbsp;<span class="ident" id="5522587">noExtraLinebreak</span><span class="op" id="5522603">)</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522607">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522619">if</span>&nbsp;<span class="ident" id="5522622">sep</span>&nbsp;<span class="op" id="5522626">!=</span>&nbsp;<span class="ident" id="5522629">ignore</span>&nbsp;<span class="op" id="5522636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522640">p</span><span class="op" id="5522641">.</span><span class="builtinfunc" id="5522642">print</span><span class="op" id="5522647">(</span><span class="ident" id="5522648">blank</span><span class="op" id="5522653">)</span>&nbsp;<span class="comment" id="5522655">//&nbsp;always&nbsp;use&nbsp;blank</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5522676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522679">p</span><span class="op" id="5522680">.</span><span class="ident" id="5522681">block</span><span class="op" id="5522686">(</span><span class="ident" id="5522687">b</span><span class="op" id="5522688">,</span>&nbsp;<span class="num" id="5522690">1</span><span class="op" id="5522691">)</span><br>
<span class="lineno"></span><span class="op" id="5522693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522696">//&nbsp;distanceFrom&nbsp;returns&nbsp;the&nbsp;column&nbsp;difference&nbsp;between&nbsp;from&nbsp;and&nbsp;p.pos&nbsp;(the&nbsp;current</span><br>
<span class="lineno">1525</span><span class="comment" id="5522778">//&nbsp;estimated&nbsp;position)&nbsp;if&nbsp;both&nbsp;are&nbsp;on&nbsp;the&nbsp;same&nbsp;line;&nbsp;if&nbsp;they&nbsp;are&nbsp;on&nbsp;different&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5522862">//&nbsp;(or&nbsp;unknown)&nbsp;the&nbsp;result&nbsp;is&nbsp;infinity.</span><br>
<span class="lineno"></span><span class="keyword" id="5522902">func</span>&nbsp;<span class="op" id="5522907">(</span><span class="ident" id="5522908">p</span>&nbsp;<span class="op" id="5522910">*</span><span class="ident" id="5522911">printer</span><span class="op" id="5522918">)</span>&nbsp;<span class="ident" id="5522920">distanceFrom</span><span class="op" id="5522932">(</span><span class="ident" id="5522933">from</span>&nbsp;<span class="ident" id="5522938">token</span><span class="op" id="5522943">.</span><span class="ident" id="5522944">Pos</span><span class="op" id="5522947">)</span>&nbsp;<span class="builtintype" id="5522949">int</span>&nbsp;<span class="op" id="5522953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522956">if</span>&nbsp;<span class="ident" id="5522959">from</span><span class="op" id="5522963">.</span><span class="ident" id="5522964">IsValid</span><span class="op" id="5522971">(</span><span class="op" id="5522972">)</span>&nbsp;<span class="op" id="5522974">&amp;&amp;</span>&nbsp;<span class="ident" id="5522977">p</span><span class="op" id="5522978">.</span><span class="ident" id="5522979">pos</span><span class="op" id="5522982">.</span><span class="ident" id="5522983">IsValid</span><span class="op" id="5522990">(</span><span class="op" id="5522991">)</span>&nbsp;<span class="op" id="5522993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5522997">if</span>&nbsp;<span class="ident" id="5523000">f</span>&nbsp;<span class="op" id="5523002">:=</span>&nbsp;<span class="ident" id="5523005">p</span><span class="op" id="5523006">.</span><span class="ident" id="5523007">posFor</span><span class="op" id="5523013">(</span><span class="ident" id="5523014">from</span><span class="op" id="5523018">)</span><span class="op" id="5523019">;</span>&nbsp;<span class="ident" id="5523021">f</span><span class="op" id="5523022">.</span><span class="ident" id="5523023">Line</span>&nbsp;<span class="op" id="5523028">==</span>&nbsp;<span class="ident" id="5523031">p</span><span class="op" id="5523032">.</span><span class="ident" id="5523033">pos</span><span class="op" id="5523036">.</span><span class="ident" id="5523037">Line</span>&nbsp;<span class="op" id="5523042">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523047">return</span>&nbsp;<span class="ident" id="5523054">p</span><span class="op" id="5523055">.</span><span class="ident" id="5523056">pos</span><span class="op" id="5523059">.</span><span class="ident" id="5523060">Column</span>&nbsp;<span class="op" id="5523067">-</span>&nbsp;<span class="ident" id="5523069">f</span><span class="op" id="5523070">.</span><span class="ident" id="5523071">Column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523086">return</span>&nbsp;<span class="ident" id="5523093">infinity</span><br>
<span class="lineno"></span><span class="op" id="5523102">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span><span class="keyword" id="5523105">func</span>&nbsp;<span class="op" id="5523110">(</span><span class="ident" id="5523111">p</span>&nbsp;<span class="op" id="5523113">*</span><span class="ident" id="5523114">printer</span><span class="op" id="5523121">)</span>&nbsp;<span class="ident" id="5523123">funcDecl</span><span class="op" id="5523131">(</span><span class="ident" id="5523132">d</span>&nbsp;<span class="op" id="5523134">*</span><span class="ident" id="5523135">ast</span><span class="op" id="5523138">.</span><span class="ident" id="5523139">FuncDecl</span><span class="op" id="5523147">)</span>&nbsp;<span class="op" id="5523149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523152">p</span><span class="op" id="5523153">.</span><span class="ident" id="5523154">setComment</span><span class="op" id="5523164">(</span><span class="ident" id="5523165">d</span><span class="op" id="5523166">.</span><span class="ident" id="5523167">Doc</span><span class="op" id="5523170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523173">p</span><span class="op" id="5523174">.</span><span class="builtinfunc" id="5523175">print</span><span class="op" id="5523180">(</span><span class="ident" id="5523181">d</span><span class="op" id="5523182">.</span><span class="ident" id="5523183">Pos</span><span class="op" id="5523186">(</span><span class="op" id="5523187">)</span><span class="op" id="5523188">,</span>&nbsp;<span class="ident" id="5523190">token</span><span class="op" id="5523195">.</span><span class="ident" id="5523196">FUNC</span><span class="op" id="5523200">,</span>&nbsp;<span class="ident" id="5523202">blank</span><span class="op" id="5523207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523210">if</span>&nbsp;<span class="ident" id="5523213">d</span><span class="op" id="5523214">.</span><span class="ident" id="5523215">Recv</span>&nbsp;<span class="op" id="5523220">!=</span>&nbsp;<span class="builtintype" id="5523223">nil</span>&nbsp;<span class="op" id="5523227">{</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523231">p</span><span class="op" id="5523232">.</span><span class="ident" id="5523233">parameters</span><span class="op" id="5523243">(</span><span class="ident" id="5523244">d</span><span class="op" id="5523245">.</span><span class="ident" id="5523246">Recv</span><span class="op" id="5523250">)</span>&nbsp;<span class="comment" id="5523252">//&nbsp;method:&nbsp;print&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523280">p</span><span class="op" id="5523281">.</span><span class="builtinfunc" id="5523282">print</span><span class="op" id="5523287">(</span><span class="ident" id="5523288">blank</span><span class="op" id="5523293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523299">p</span><span class="op" id="5523300">.</span><span class="ident" id="5523301">expr</span><span class="op" id="5523305">(</span><span class="ident" id="5523306">d</span><span class="op" id="5523307">.</span><span class="ident" id="5523308">Name</span><span class="op" id="5523312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523315">p</span><span class="op" id="5523316">.</span><span class="ident" id="5523317">signature</span><span class="op" id="5523326">(</span><span class="ident" id="5523327">d</span><span class="op" id="5523328">.</span><span class="ident" id="5523329">Type</span><span class="op" id="5523333">.</span><span class="ident" id="5523334">Params</span><span class="op" id="5523340">,</span>&nbsp;<span class="ident" id="5523342">d</span><span class="op" id="5523343">.</span><span class="ident" id="5523344">Type</span><span class="op" id="5523348">.</span><span class="ident" id="5523349">Results</span><span class="op" id="5523356">)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523359">p</span><span class="op" id="5523360">.</span><span class="ident" id="5523361">adjBlock</span><span class="op" id="5523369">(</span><span class="ident" id="5523370">p</span><span class="op" id="5523371">.</span><span class="ident" id="5523372">distanceFrom</span><span class="op" id="5523384">(</span><span class="ident" id="5523385">d</span><span class="op" id="5523386">.</span><span class="ident" id="5523387">Pos</span><span class="op" id="5523390">(</span><span class="op" id="5523391">)</span><span class="op" id="5523392">)</span><span class="op" id="5523393">,</span>&nbsp;<span class="ident" id="5523395">vtab</span><span class="op" id="5523399">,</span>&nbsp;<span class="ident" id="5523401">d</span><span class="op" id="5523402">.</span><span class="ident" id="5523403">Body</span><span class="op" id="5523407">)</span><br>
<span class="lineno"></span><span class="op" id="5523409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523412">func</span>&nbsp;<span class="op" id="5523417">(</span><span class="ident" id="5523418">p</span>&nbsp;<span class="op" id="5523420">*</span><span class="ident" id="5523421">printer</span><span class="op" id="5523428">)</span>&nbsp;<span class="ident" id="5523430">decl</span><span class="op" id="5523434">(</span><span class="ident" id="5523435">decl</span>&nbsp;<span class="ident" id="5523440">ast</span><span class="op" id="5523443">.</span><span class="ident" id="5523444">Decl</span><span class="op" id="5523448">)</span>&nbsp;<span class="op" id="5523450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523453">switch</span>&nbsp;<span class="ident" id="5523460">d</span>&nbsp;<span class="op" id="5523462">:=</span>&nbsp;<span class="ident" id="5523465">decl</span><span class="op" id="5523469">.</span><span class="op" id="5523470">(</span><span class="keyword" id="5523471">type</span><span class="op" id="5523475">)</span>&nbsp;<span class="op" id="5523477">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523480">case</span>&nbsp;<span class="op" id="5523485">*</span><span class="ident" id="5523486">ast</span><span class="op" id="5523489">.</span><span class="ident" id="5523490">BadDecl</span><span class="op" id="5523497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523501">p</span><span class="op" id="5523502">.</span><span class="builtinfunc" id="5523503">print</span><span class="op" id="5523508">(</span><span class="ident" id="5523509">d</span><span class="op" id="5523510">.</span><span class="ident" id="5523511">Pos</span><span class="op" id="5523514">(</span><span class="op" id="5523515">)</span><span class="op" id="5523516">,</span>&nbsp;<span class="string" id="5523518">&#34;BadDecl&#34;</span><span class="op" id="5523527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523530">case</span>&nbsp;<span class="op" id="5523535">*</span><span class="ident" id="5523536">ast</span><span class="op" id="5523539">.</span><span class="ident" id="5523540">GenDecl</span><span class="op" id="5523547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523551">p</span><span class="op" id="5523552">.</span><span class="ident" id="5523553">genDecl</span><span class="op" id="5523560">(</span><span class="ident" id="5523561">d</span><span class="op" id="5523562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523565">case</span>&nbsp;<span class="op" id="5523570">*</span><span class="ident" id="5523571">ast</span><span class="op" id="5523574">.</span><span class="ident" id="5523575">FuncDecl</span><span class="op" id="5523583">:</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523587">p</span><span class="op" id="5523588">.</span><span class="ident" id="5523589">funcDecl</span><span class="op" id="5523597">(</span><span class="ident" id="5523598">d</span><span class="op" id="5523599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523602">default</span><span class="op" id="5523609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5523613">panic</span><span class="op" id="5523618">(</span><span class="string" id="5523619">&#34;unreachable&#34;</span><span class="op" id="5523632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523635">}</span><br>
<span class="lineno"></span><span class="op" id="5523637">}</span><br>
<span class="lineno">1560</span><br>
<span class="lineno"></span><span class="comment" id="5523640">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5523720">//&nbsp;Files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523730">func</span>&nbsp;<span class="ident" id="5523735">declToken</span><span class="op" id="5523744">(</span><span class="ident" id="5523745">decl</span>&nbsp;<span class="ident" id="5523750">ast</span><span class="op" id="5523753">.</span><span class="ident" id="5523754">Decl</span><span class="op" id="5523758">)</span>&nbsp;<span class="op" id="5523760">(</span><span class="ident" id="5523761">tok</span>&nbsp;<span class="ident" id="5523765">token</span><span class="op" id="5523770">.</span><span class="ident" id="5523771">Token</span><span class="op" id="5523776">)</span>&nbsp;<span class="op" id="5523778">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523781">tok</span>&nbsp;<span class="op" id="5523785">=</span>&nbsp;<span class="ident" id="5523787">token</span><span class="op" id="5523792">.</span><span class="ident" id="5523793">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523802">switch</span>&nbsp;<span class="ident" id="5523809">d</span>&nbsp;<span class="op" id="5523811">:=</span>&nbsp;<span class="ident" id="5523814">decl</span><span class="op" id="5523818">.</span><span class="op" id="5523819">(</span><span class="keyword" id="5523820">type</span><span class="op" id="5523824">)</span>&nbsp;<span class="op" id="5523826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523829">case</span>&nbsp;<span class="op" id="5523834">*</span><span class="ident" id="5523835">ast</span><span class="op" id="5523838">.</span><span class="ident" id="5523839">GenDecl</span><span class="op" id="5523846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523850">tok</span>&nbsp;<span class="op" id="5523854">=</span>&nbsp;<span class="ident" id="5523856">d</span><span class="op" id="5523857">.</span><span class="ident" id="5523858">Tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523863">case</span>&nbsp;<span class="op" id="5523868">*</span><span class="ident" id="5523869">ast</span><span class="op" id="5523872">.</span><span class="ident" id="5523873">FuncDecl</span><span class="op" id="5523881">:</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523885">tok</span>&nbsp;<span class="op" id="5523889">=</span>&nbsp;<span class="ident" id="5523891">token</span><span class="op" id="5523896">.</span><span class="ident" id="5523897">FUNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523906">return</span><br>
<span class="lineno"></span><span class="op" id="5523913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span><span class="keyword" id="5523916">func</span>&nbsp;<span class="op" id="5523921">(</span><span class="ident" id="5523922">p</span>&nbsp;<span class="op" id="5523924">*</span><span class="ident" id="5523925">printer</span><span class="op" id="5523932">)</span>&nbsp;<span class="ident" id="5523934">declList</span><span class="op" id="5523942">(</span><span class="ident" id="5523943">list</span>&nbsp;<span class="op" id="5523948">[</span><span class="op" id="5523949">]</span><span class="ident" id="5523950">ast</span><span class="op" id="5523953">.</span><span class="ident" id="5523954">Decl</span><span class="op" id="5523958">)</span>&nbsp;<span class="op" id="5523960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523963">tok</span>&nbsp;<span class="op" id="5523967">:=</span>&nbsp;<span class="ident" id="5523970">token</span><span class="op" id="5523975">.</span><span class="ident" id="5523976">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5523985">for</span>&nbsp;<span class="ident" id="5523989">_</span><span class="op" id="5523990">,</span>&nbsp;<span class="ident" id="5523992">d</span>&nbsp;<span class="op" id="5523994">:=</span>&nbsp;<span class="keyword" id="5523997">range</span>&nbsp;<span class="ident" id="5524003">list</span>&nbsp;<span class="op" id="5524008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524012">prev</span>&nbsp;<span class="op" id="5524017">:=</span>&nbsp;<span class="ident" id="5524020">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524026">tok</span>&nbsp;<span class="op" id="5524030">=</span>&nbsp;<span class="ident" id="5524032">declToken</span><span class="op" id="5524041">(</span><span class="ident" id="5524042">d</span><span class="op" id="5524043">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524047">//&nbsp;If&nbsp;the&nbsp;declaration&nbsp;token&nbsp;changed&nbsp;(e.g.,&nbsp;from&nbsp;CONST&nbsp;to&nbsp;TYPE)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524112">//&nbsp;or&nbsp;the&nbsp;next&nbsp;declaration&nbsp;has&nbsp;documentation&nbsp;associated&nbsp;with&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524179">//&nbsp;print&nbsp;an&nbsp;empty&nbsp;line&nbsp;between&nbsp;top-level&nbsp;declarations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524236">//&nbsp;(because&nbsp;p.linebreak&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;position&nbsp;of&nbsp;d,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524302">//&nbsp;is&nbsp;past&nbsp;any&nbsp;documentation,&nbsp;the&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;satisfied</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524371">//&nbsp;even&nbsp;w/o&nbsp;the&nbsp;extra&nbsp;getDoc(d)&nbsp;nil-check&nbsp;-&nbsp;leave&nbsp;it&nbsp;in&nbsp;case&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524438">//&nbsp;linebreak&nbsp;logic&nbsp;improves&nbsp;-&nbsp;there&#39;s&nbsp;already&nbsp;a&nbsp;TODO).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5524495">if</span>&nbsp;<span class="builtinfunc" id="5524498">len</span><span class="op" id="5524501">(</span><span class="ident" id="5524502">p</span><span class="op" id="5524503">.</span><span class="ident" id="5524504">output</span><span class="op" id="5524510">)</span>&nbsp;<span class="op" id="5524512">&gt;</span>&nbsp;<span class="num" id="5524514">0</span>&nbsp;<span class="op" id="5524516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524521">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5524594">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524651">min</span>&nbsp;<span class="op" id="5524655">:=</span>&nbsp;<span class="num" id="5524658">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5524663">if</span>&nbsp;<span class="ident" id="5524666">prev</span>&nbsp;<span class="op" id="5524671">!=</span>&nbsp;<span class="ident" id="5524674">tok</span>&nbsp;<span class="op" id="5524678">||</span>&nbsp;<span class="ident" id="5524681">getDoc</span><span class="op" id="5524687">(</span><span class="ident" id="5524688">d</span><span class="op" id="5524689">)</span>&nbsp;<span class="op" id="5524691">!=</span>&nbsp;<span class="builtintype" id="5524694">nil</span>&nbsp;<span class="op" id="5524698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524704">min</span>&nbsp;<span class="op" id="5524708">=</span>&nbsp;<span class="num" id="5524710">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5524715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524720">p</span><span class="op" id="5524721">.</span><span class="ident" id="5524722">linebreak</span><span class="op" id="5524731">(</span><span class="ident" id="5524732">p</span><span class="op" id="5524733">.</span><span class="ident" id="5524734">lineFor</span><span class="op" id="5524741">(</span><span class="ident" id="5524742">d</span><span class="op" id="5524743">.</span><span class="ident" id="5524744">Pos</span><span class="op" id="5524747">(</span><span class="op" id="5524748">)</span><span class="op" id="5524749">)</span><span class="op" id="5524750">,</span>&nbsp;<span class="ident" id="5524752">min</span><span class="op" id="5524755">,</span>&nbsp;<span class="ident" id="5524757">ignore</span><span class="op" id="5524763">,</span>&nbsp;<span class="builtintype" id="5524765">false</span><span class="op" id="5524770">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5524774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524778">p</span><span class="op" id="5524779">.</span><span class="ident" id="5524780">decl</span><span class="op" id="5524784">(</span><span class="ident" id="5524785">d</span><span class="op" id="5524786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5524789">}</span><br>
<span class="lineno"></span><span class="op" id="5524791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="keyword" id="5524794">func</span>&nbsp;<span class="op" id="5524799">(</span><span class="ident" id="5524800">p</span>&nbsp;<span class="op" id="5524802">*</span><span class="ident" id="5524803">printer</span><span class="op" id="5524810">)</span>&nbsp;<span class="ident" id="5524812">file</span><span class="op" id="5524816">(</span><span class="ident" id="5524817">src</span>&nbsp;<span class="op" id="5524821">*</span><span class="ident" id="5524822">ast</span><span class="op" id="5524825">.</span><span class="ident" id="5524826">File</span><span class="op" id="5524830">)</span>&nbsp;<span class="op" id="5524832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524835">p</span><span class="op" id="5524836">.</span><span class="ident" id="5524837">setComment</span><span class="op" id="5524847">(</span><span class="ident" id="5524848">src</span><span class="op" id="5524851">.</span><span class="ident" id="5524852">Doc</span><span class="op" id="5524855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524858">p</span><span class="op" id="5524859">.</span><span class="builtinfunc" id="5524860">print</span><span class="op" id="5524865">(</span><span class="ident" id="5524866">src</span><span class="op" id="5524869">.</span><span class="ident" id="5524870">Pos</span><span class="op" id="5524873">(</span><span class="op" id="5524874">)</span><span class="op" id="5524875">,</span>&nbsp;<span class="ident" id="5524877">token</span><span class="op" id="5524882">.</span><span class="ident" id="5524883">PACKAGE</span><span class="op" id="5524890">,</span>&nbsp;<span class="ident" id="5524892">blank</span><span class="op" id="5524897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524900">p</span><span class="op" id="5524901">.</span><span class="ident" id="5524902">expr</span><span class="op" id="5524906">(</span><span class="ident" id="5524907">src</span><span class="op" id="5524910">.</span><span class="ident" id="5524911">Name</span><span class="op" id="5524915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524918">p</span><span class="op" id="5524919">.</span><span class="ident" id="5524920">declList</span><span class="op" id="5524928">(</span><span class="ident" id="5524929">src</span><span class="op" id="5524932">.</span><span class="ident" id="5524933">Decls</span><span class="op" id="5524938">)</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524941">p</span><span class="op" id="5524942">.</span><span class="builtinfunc" id="5524943">print</span><span class="op" id="5524948">(</span><span class="ident" id="5524949">newline</span><span class="op" id="5524956">)</span><br>
<span class="lineno"></span><span class="op" id="5524958">}</span>
</div>
</body>
</html>
