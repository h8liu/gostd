<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8380730">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8380785">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8380839">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8380890">package</span>&nbsp;<span class="ident" id="8380898">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380903">import</span>&nbsp;<span class="op" id="8380910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8380913">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8380919">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8380930">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8380941">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8380951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380954">type</span>&nbsp;<span class="ident" id="8380959">listenerFile</span>&nbsp;<span class="keyword" id="8380972">interface</span>&nbsp;<span class="op" id="8380982">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380985">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380995">File</span><span class="op" id="8380999">(</span><span class="op" id="8381000">)</span>&nbsp;<span class="op" id="8381002">(</span><span class="ident" id="8381003">f</span>&nbsp;<span class="op" id="8381005">*</span><span class="ident" id="8381006">os</span><span class="op" id="8381008">.</span><span class="ident" id="8381009">File</span><span class="op" id="8381013">,</span>&nbsp;<span class="ident" id="8381015">err</span>&nbsp;<span class="builtintype" id="8381019">error</span><span class="op" id="8381024">)</span><br>
<span class="lineno"></span><span class="op" id="8381026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8381029">type</span>&nbsp;<span class="ident" id="8381034">packetConnFile</span>&nbsp;<span class="keyword" id="8381049">interface</span>&nbsp;<span class="op" id="8381059">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381062">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381074">File</span><span class="op" id="8381078">(</span><span class="op" id="8381079">)</span>&nbsp;<span class="op" id="8381081">(</span><span class="ident" id="8381082">f</span>&nbsp;<span class="op" id="8381084">*</span><span class="ident" id="8381085">os</span><span class="op" id="8381087">.</span><span class="ident" id="8381088">File</span><span class="op" id="8381092">,</span>&nbsp;<span class="ident" id="8381094">err</span>&nbsp;<span class="builtintype" id="8381098">error</span><span class="op" id="8381103">)</span><br>
<span class="lineno"></span><span class="op" id="8381105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8381108">type</span>&nbsp;<span class="ident" id="8381113">connFile</span>&nbsp;<span class="keyword" id="8381122">interface</span>&nbsp;<span class="op" id="8381132">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381135">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381141">File</span><span class="op" id="8381145">(</span><span class="op" id="8381146">)</span>&nbsp;<span class="op" id="8381148">(</span><span class="ident" id="8381149">f</span>&nbsp;<span class="op" id="8381151">*</span><span class="ident" id="8381152">os</span><span class="op" id="8381154">.</span><span class="ident" id="8381155">File</span><span class="op" id="8381159">,</span>&nbsp;<span class="ident" id="8381161">err</span>&nbsp;<span class="builtintype" id="8381165">error</span><span class="op" id="8381170">)</span><br>
<span class="lineno"></span><span class="op" id="8381172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8381175">func</span>&nbsp;<span class="ident" id="8381180">testFileListener</span><span class="op" id="8381196">(</span><span class="ident" id="8381197">t</span>&nbsp;<span class="op" id="8381199">*</span><span class="ident" id="8381200">testing</span><span class="op" id="8381207">.</span><span class="ident" id="8381208">T</span><span class="op" id="8381209">,</span>&nbsp;<span class="ident" id="8381211">net</span><span class="op" id="8381214">,</span>&nbsp;<span class="ident" id="8381216">laddr</span>&nbsp;<span class="builtintype" id="8381222">string</span><span class="op" id="8381228">)</span>&nbsp;<span class="op" id="8381230">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381233">switch</span>&nbsp;<span class="ident" id="8381240">net</span>&nbsp;<span class="op" id="8381244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381247">case</span>&nbsp;<span class="string" id="8381252">&#34;tcp&#34;</span><span class="op" id="8381257">,</span>&nbsp;<span class="string" id="8381259">&#34;tcp4&#34;</span><span class="op" id="8381265">,</span>&nbsp;<span class="string" id="8381267">&#34;tcp6&#34;</span><span class="op" id="8381273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381277">laddr</span>&nbsp;<span class="op" id="8381283">+=</span>&nbsp;<span class="string" id="8381286">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8381291">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381317">l</span><span class="op" id="8381318">,</span>&nbsp;<span class="ident" id="8381320">err</span>&nbsp;<span class="op" id="8381324">:=</span>&nbsp;<span class="ident" id="8381327">Listen</span><span class="op" id="8381333">(</span><span class="ident" id="8381334">net</span><span class="op" id="8381337">,</span>&nbsp;<span class="ident" id="8381339">laddr</span><span class="op" id="8381344">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381347">if</span>&nbsp;<span class="ident" id="8381350">err</span>&nbsp;<span class="op" id="8381354">!=</span>&nbsp;<span class="ident" id="8381357">nil</span>&nbsp;<span class="op" id="8381361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381365">t</span><span class="op" id="8381366">.</span><span class="ident" id="8381367">Fatalf</span><span class="op" id="8381373">(</span><span class="string" id="8381374">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8381393">,</span>&nbsp;<span class="ident" id="8381395">err</span><span class="op" id="8381398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381404">defer</span>&nbsp;<span class="ident" id="8381410">l</span><span class="op" id="8381411">.</span><span class="ident" id="8381412">Close</span><span class="op" id="8381417">(</span><span class="op" id="8381418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381421">lf</span>&nbsp;<span class="op" id="8381424">:=</span>&nbsp;<span class="ident" id="8381427">l</span><span class="op" id="8381428">.</span><span class="op" id="8381429">(</span><span class="ident" id="8381430">listenerFile</span><span class="op" id="8381442">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381445">f</span><span class="op" id="8381446">,</span>&nbsp;<span class="ident" id="8381448">err</span>&nbsp;<span class="op" id="8381452">:=</span>&nbsp;<span class="ident" id="8381455">lf</span><span class="op" id="8381457">.</span><span class="ident" id="8381458">File</span><span class="op" id="8381462">(</span><span class="op" id="8381463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381466">if</span>&nbsp;<span class="ident" id="8381469">err</span>&nbsp;<span class="op" id="8381473">!=</span>&nbsp;<span class="ident" id="8381476">nil</span>&nbsp;<span class="op" id="8381480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381484">t</span><span class="op" id="8381485">.</span><span class="ident" id="8381486">Fatalf</span><span class="op" id="8381492">(</span><span class="string" id="8381493">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8381510">,</span>&nbsp;<span class="ident" id="8381512">err</span><span class="op" id="8381515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381521">c</span><span class="op" id="8381522">,</span>&nbsp;<span class="ident" id="8381524">err</span>&nbsp;<span class="op" id="8381528">:=</span>&nbsp;<span class="ident" id="8381531">FileListener</span><span class="op" id="8381543">(</span><span class="ident" id="8381544">f</span><span class="op" id="8381545">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381548">if</span>&nbsp;<span class="ident" id="8381551">err</span>&nbsp;<span class="op" id="8381555">!=</span>&nbsp;<span class="ident" id="8381558">nil</span>&nbsp;<span class="op" id="8381562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381566">t</span><span class="op" id="8381567">.</span><span class="ident" id="8381568">Fatalf</span><span class="op" id="8381574">(</span><span class="string" id="8381575">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8381600">,</span>&nbsp;<span class="ident" id="8381602">err</span><span class="op" id="8381605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381611">if</span>&nbsp;<span class="op" id="8381614">!</span><span class="ident" id="8381615">reflect</span><span class="op" id="8381622">.</span><span class="ident" id="8381623">DeepEqual</span><span class="op" id="8381632">(</span><span class="ident" id="8381633">l</span><span class="op" id="8381634">.</span><span class="ident" id="8381635">Addr</span><span class="op" id="8381639">(</span><span class="op" id="8381640">)</span><span class="op" id="8381641">,</span>&nbsp;<span class="ident" id="8381643">c</span><span class="op" id="8381644">.</span><span class="ident" id="8381645">Addr</span><span class="op" id="8381649">(</span><span class="op" id="8381650">)</span><span class="op" id="8381651">)</span>&nbsp;<span class="op" id="8381653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381657">t</span><span class="op" id="8381658">.</span><span class="ident" id="8381659">Fatalf</span><span class="op" id="8381665">(</span><span class="string" id="8381666">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8381695">,</span>&nbsp;<span class="ident" id="8381697">l</span><span class="op" id="8381698">.</span><span class="ident" id="8381699">Addr</span><span class="op" id="8381703">(</span><span class="op" id="8381704">)</span><span class="op" id="8381705">,</span>&nbsp;<span class="ident" id="8381707">c</span><span class="op" id="8381708">.</span><span class="ident" id="8381709">Addr</span><span class="op" id="8381713">(</span><span class="op" id="8381714">)</span><span class="op" id="8381715">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381721">if</span>&nbsp;<span class="ident" id="8381724">err</span>&nbsp;<span class="op" id="8381728">:=</span>&nbsp;<span class="ident" id="8381731">c</span><span class="op" id="8381732">.</span><span class="ident" id="8381733">Close</span><span class="op" id="8381738">(</span><span class="op" id="8381739">)</span><span class="op" id="8381740">;</span>&nbsp;<span class="ident" id="8381742">err</span>&nbsp;<span class="op" id="8381746">!=</span>&nbsp;<span class="ident" id="8381749">nil</span>&nbsp;<span class="op" id="8381753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381757">t</span><span class="op" id="8381758">.</span><span class="ident" id="8381759">Fatalf</span><span class="op" id="8381765">(</span><span class="string" id="8381766">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8381784">,</span>&nbsp;<span class="ident" id="8381786">err</span><span class="op" id="8381789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381795">if</span>&nbsp;<span class="ident" id="8381798">err</span>&nbsp;<span class="op" id="8381802">:=</span>&nbsp;<span class="ident" id="8381805">f</span><span class="op" id="8381806">.</span><span class="ident" id="8381807">Close</span><span class="op" id="8381812">(</span><span class="op" id="8381813">)</span><span class="op" id="8381814">;</span>&nbsp;<span class="ident" id="8381816">err</span>&nbsp;<span class="op" id="8381820">!=</span>&nbsp;<span class="ident" id="8381823">nil</span>&nbsp;<span class="op" id="8381827">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381831">t</span><span class="op" id="8381832">.</span><span class="ident" id="8381833">Fatalf</span><span class="op" id="8381839">(</span><span class="string" id="8381840">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8381858">,</span>&nbsp;<span class="ident" id="8381860">err</span><span class="op" id="8381863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381866">}</span><br>
<span class="lineno"></span><span class="op" id="8381868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8381871">var</span>&nbsp;<span class="ident" id="8381875">fileListenerTests</span>&nbsp;<span class="op" id="8381893">=</span>&nbsp;<span class="op" id="8381895">[</span><span class="op" id="8381896">]</span><span class="keyword" id="8381897">struct</span>&nbsp;<span class="op" id="8381904">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381907">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8381913">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381921">laddr</span>&nbsp;<span class="builtintype" id="8381927">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381935">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8381941">bool</span>&nbsp;<span class="comment" id="8381946">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381987">linux</span>&nbsp;<span class="builtintype" id="8381993">bool</span>&nbsp;<span class="comment" id="8381998">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8382052">}</span><span class="op" id="8382053">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382056">{</span><span class="ident" id="8382057">net</span><span class="op" id="8382060">:</span>&nbsp;<span class="string" id="8382062">&#34;tcp&#34;</span><span class="op" id="8382067">,</span>&nbsp;<span class="ident" id="8382069">laddr</span><span class="op" id="8382074">:</span>&nbsp;<span class="string" id="8382076">&#34;&#34;</span><span class="op" id="8382078">}</span><span class="op" id="8382079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382082">{</span><span class="ident" id="8382083">net</span><span class="op" id="8382086">:</span>&nbsp;<span class="string" id="8382088">&#34;tcp&#34;</span><span class="op" id="8382093">,</span>&nbsp;<span class="ident" id="8382095">laddr</span><span class="op" id="8382100">:</span>&nbsp;<span class="string" id="8382102">&#34;0.0.0.0&#34;</span><span class="op" id="8382111">}</span><span class="op" id="8382112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382115">{</span><span class="ident" id="8382116">net</span><span class="op" id="8382119">:</span>&nbsp;<span class="string" id="8382121">&#34;tcp&#34;</span><span class="op" id="8382126">,</span>&nbsp;<span class="ident" id="8382128">laddr</span><span class="op" id="8382133">:</span>&nbsp;<span class="string" id="8382135">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8382153">}</span><span class="op" id="8382154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382157">{</span><span class="ident" id="8382158">net</span><span class="op" id="8382161">:</span>&nbsp;<span class="string" id="8382163">&#34;tcp&#34;</span><span class="op" id="8382168">,</span>&nbsp;<span class="ident" id="8382170">laddr</span><span class="op" id="8382175">:</span>&nbsp;<span class="string" id="8382177">&#34;[::]&#34;</span><span class="op" id="8382183">,</span>&nbsp;<span class="ident" id="8382185">ipv6</span><span class="op" id="8382189">:</span>&nbsp;<span class="builtintype" id="8382191">true</span><span class="op" id="8382195">}</span><span class="op" id="8382196">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382200">{</span><span class="ident" id="8382201">net</span><span class="op" id="8382204">:</span>&nbsp;<span class="string" id="8382206">&#34;tcp&#34;</span><span class="op" id="8382211">,</span>&nbsp;<span class="ident" id="8382213">laddr</span><span class="op" id="8382218">:</span>&nbsp;<span class="string" id="8382220">&#34;127.0.0.1&#34;</span><span class="op" id="8382231">}</span><span class="op" id="8382232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382235">{</span><span class="ident" id="8382236">net</span><span class="op" id="8382239">:</span>&nbsp;<span class="string" id="8382241">&#34;tcp&#34;</span><span class="op" id="8382246">,</span>&nbsp;<span class="ident" id="8382248">laddr</span><span class="op" id="8382253">:</span>&nbsp;<span class="string" id="8382255">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8382275">}</span><span class="op" id="8382276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382279">{</span><span class="ident" id="8382280">net</span><span class="op" id="8382283">:</span>&nbsp;<span class="string" id="8382285">&#34;tcp&#34;</span><span class="op" id="8382290">,</span>&nbsp;<span class="ident" id="8382292">laddr</span><span class="op" id="8382297">:</span>&nbsp;<span class="string" id="8382299">&#34;[::1]&#34;</span><span class="op" id="8382306">,</span>&nbsp;<span class="ident" id="8382308">ipv6</span><span class="op" id="8382312">:</span>&nbsp;<span class="builtintype" id="8382314">true</span><span class="op" id="8382318">}</span><span class="op" id="8382319">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382323">{</span><span class="ident" id="8382324">net</span><span class="op" id="8382327">:</span>&nbsp;<span class="string" id="8382329">&#34;tcp4&#34;</span><span class="op" id="8382335">,</span>&nbsp;<span class="ident" id="8382337">laddr</span><span class="op" id="8382342">:</span>&nbsp;<span class="string" id="8382344">&#34;&#34;</span><span class="op" id="8382346">}</span><span class="op" id="8382347">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382350">{</span><span class="ident" id="8382351">net</span><span class="op" id="8382354">:</span>&nbsp;<span class="string" id="8382356">&#34;tcp4&#34;</span><span class="op" id="8382362">,</span>&nbsp;<span class="ident" id="8382364">laddr</span><span class="op" id="8382369">:</span>&nbsp;<span class="string" id="8382371">&#34;0.0.0.0&#34;</span><span class="op" id="8382380">}</span><span class="op" id="8382381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382384">{</span><span class="ident" id="8382385">net</span><span class="op" id="8382388">:</span>&nbsp;<span class="string" id="8382390">&#34;tcp4&#34;</span><span class="op" id="8382396">,</span>&nbsp;<span class="ident" id="8382398">laddr</span><span class="op" id="8382403">:</span>&nbsp;<span class="string" id="8382405">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8382423">}</span><span class="op" id="8382424">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382428">{</span><span class="ident" id="8382429">net</span><span class="op" id="8382432">:</span>&nbsp;<span class="string" id="8382434">&#34;tcp4&#34;</span><span class="op" id="8382440">,</span>&nbsp;<span class="ident" id="8382442">laddr</span><span class="op" id="8382447">:</span>&nbsp;<span class="string" id="8382449">&#34;127.0.0.1&#34;</span><span class="op" id="8382460">}</span><span class="op" id="8382461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382464">{</span><span class="ident" id="8382465">net</span><span class="op" id="8382468">:</span>&nbsp;<span class="string" id="8382470">&#34;tcp4&#34;</span><span class="op" id="8382476">,</span>&nbsp;<span class="ident" id="8382478">laddr</span><span class="op" id="8382483">:</span>&nbsp;<span class="string" id="8382485">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8382505">}</span><span class="op" id="8382506">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382510">{</span><span class="ident" id="8382511">net</span><span class="op" id="8382514">:</span>&nbsp;<span class="string" id="8382516">&#34;tcp6&#34;</span><span class="op" id="8382522">,</span>&nbsp;<span class="ident" id="8382524">laddr</span><span class="op" id="8382529">:</span>&nbsp;<span class="string" id="8382531">&#34;&#34;</span><span class="op" id="8382533">,</span>&nbsp;<span class="ident" id="8382535">ipv6</span><span class="op" id="8382539">:</span>&nbsp;<span class="builtintype" id="8382541">true</span><span class="op" id="8382545">}</span><span class="op" id="8382546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382549">{</span><span class="ident" id="8382550">net</span><span class="op" id="8382553">:</span>&nbsp;<span class="string" id="8382555">&#34;tcp6&#34;</span><span class="op" id="8382561">,</span>&nbsp;<span class="ident" id="8382563">laddr</span><span class="op" id="8382568">:</span>&nbsp;<span class="string" id="8382570">&#34;[::]&#34;</span><span class="op" id="8382576">,</span>&nbsp;<span class="ident" id="8382578">ipv6</span><span class="op" id="8382582">:</span>&nbsp;<span class="builtintype" id="8382584">true</span><span class="op" id="8382588">}</span><span class="op" id="8382589">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382593">{</span><span class="ident" id="8382594">net</span><span class="op" id="8382597">:</span>&nbsp;<span class="string" id="8382599">&#34;tcp6&#34;</span><span class="op" id="8382605">,</span>&nbsp;<span class="ident" id="8382607">laddr</span><span class="op" id="8382612">:</span>&nbsp;<span class="string" id="8382614">&#34;[::1]&#34;</span><span class="op" id="8382621">,</span>&nbsp;<span class="ident" id="8382623">ipv6</span><span class="op" id="8382627">:</span>&nbsp;<span class="builtintype" id="8382629">true</span><span class="op" id="8382633">}</span><span class="op" id="8382634">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382638">{</span><span class="ident" id="8382639">net</span><span class="op" id="8382642">:</span>&nbsp;<span class="string" id="8382644">&#34;unix&#34;</span><span class="op" id="8382650">,</span>&nbsp;<span class="ident" id="8382652">laddr</span><span class="op" id="8382657">:</span>&nbsp;<span class="string" id="8382659">&#34;@gotest/net&#34;</span><span class="op" id="8382672">,</span>&nbsp;<span class="ident" id="8382674">linux</span><span class="op" id="8382679">:</span>&nbsp;<span class="builtintype" id="8382681">true</span><span class="op" id="8382685">}</span><span class="op" id="8382686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382689">{</span><span class="ident" id="8382690">net</span><span class="op" id="8382693">:</span>&nbsp;<span class="string" id="8382695">&#34;unixpacket&#34;</span><span class="op" id="8382707">,</span>&nbsp;<span class="ident" id="8382709">laddr</span><span class="op" id="8382714">:</span>&nbsp;<span class="string" id="8382716">&#34;@gotest/net&#34;</span><span class="op" id="8382729">,</span>&nbsp;<span class="ident" id="8382731">linux</span><span class="op" id="8382736">:</span>&nbsp;<span class="builtintype" id="8382738">true</span><span class="op" id="8382742">}</span><span class="op" id="8382743">,</span><br>
<span class="lineno"></span><span class="op" id="8382745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8382748">func</span>&nbsp;<span class="ident" id="8382753">TestFileListener</span><span class="op" id="8382769">(</span><span class="ident" id="8382770">t</span>&nbsp;<span class="op" id="8382772">*</span><span class="ident" id="8382773">testing</span><span class="op" id="8382780">.</span><span class="ident" id="8382781">T</span><span class="op" id="8382782">)</span>&nbsp;<span class="op" id="8382784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382787">switch</span>&nbsp;<span class="ident" id="8382794">runtime</span><span class="op" id="8382801">.</span><span class="ident" id="8382802">GOOS</span>&nbsp;<span class="op" id="8382807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382810">case</span>&nbsp;<span class="string" id="8382815">&#34;nacl&#34;</span><span class="op" id="8382821">,</span>&nbsp;<span class="string" id="8382823">&#34;windows&#34;</span><span class="op" id="8382832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382836">t</span><span class="op" id="8382837">.</span><span class="ident" id="8382838">Skipf</span><span class="op" id="8382843">(</span><span class="string" id="8382844">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8382865">,</span>&nbsp;<span class="ident" id="8382867">runtime</span><span class="op" id="8382874">.</span><span class="ident" id="8382875">GOOS</span><span class="op" id="8382879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382882">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382886">for</span>&nbsp;<span class="ident" id="8382890">_</span><span class="op" id="8382891">,</span>&nbsp;<span class="ident" id="8382893">tt</span>&nbsp;<span class="op" id="8382896">:=</span>&nbsp;<span class="keyword" id="8382899">range</span>&nbsp;<span class="ident" id="8382905">fileListenerTests</span>&nbsp;<span class="op" id="8382923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382927">if</span>&nbsp;<span class="ident" id="8382930">skipServerTest</span><span class="op" id="8382944">(</span><span class="ident" id="8382945">tt</span><span class="op" id="8382947">.</span><span class="ident" id="8382948">net</span><span class="op" id="8382951">,</span>&nbsp;<span class="string" id="8382953">&#34;unix&#34;</span><span class="op" id="8382959">,</span>&nbsp;<span class="ident" id="8382961">tt</span><span class="op" id="8382963">.</span><span class="ident" id="8382964">laddr</span><span class="op" id="8382969">,</span>&nbsp;<span class="ident" id="8382971">tt</span><span class="op" id="8382973">.</span><span class="ident" id="8382974">ipv6</span><span class="op" id="8382978">,</span>&nbsp;<span class="builtintype" id="8382980">false</span><span class="op" id="8382985">,</span>&nbsp;<span class="ident" id="8382987">tt</span><span class="op" id="8382989">.</span><span class="ident" id="8382990">linux</span><span class="op" id="8382995">)</span>&nbsp;<span class="op" id="8382997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383002">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383013">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383017">if</span>&nbsp;<span class="ident" id="8383020">skipServerTest</span><span class="op" id="8383034">(</span><span class="ident" id="8383035">tt</span><span class="op" id="8383037">.</span><span class="ident" id="8383038">net</span><span class="op" id="8383041">,</span>&nbsp;<span class="string" id="8383043">&#34;unixpacket&#34;</span><span class="op" id="8383055">,</span>&nbsp;<span class="ident" id="8383057">tt</span><span class="op" id="8383059">.</span><span class="ident" id="8383060">laddr</span><span class="op" id="8383065">,</span>&nbsp;<span class="ident" id="8383067">tt</span><span class="op" id="8383069">.</span><span class="ident" id="8383070">ipv6</span><span class="op" id="8383074">,</span>&nbsp;<span class="builtintype" id="8383076">false</span><span class="op" id="8383081">,</span>&nbsp;<span class="ident" id="8383083">tt</span><span class="op" id="8383085">.</span><span class="ident" id="8383086">linux</span><span class="op" id="8383091">)</span>&nbsp;<span class="op" id="8383093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383113">testFileListener</span><span class="op" id="8383129">(</span><span class="ident" id="8383130">t</span><span class="op" id="8383131">,</span>&nbsp;<span class="ident" id="8383133">tt</span><span class="op" id="8383135">.</span><span class="ident" id="8383136">net</span><span class="op" id="8383139">,</span>&nbsp;<span class="ident" id="8383141">tt</span><span class="op" id="8383143">.</span><span class="ident" id="8383144">laddr</span><span class="op" id="8383149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383152">}</span><br>
<span class="lineno">105</span><span class="op" id="8383154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8383157">func</span>&nbsp;<span class="ident" id="8383162">testFilePacketConn</span><span class="op" id="8383180">(</span><span class="ident" id="8383181">t</span>&nbsp;<span class="op" id="8383183">*</span><span class="ident" id="8383184">testing</span><span class="op" id="8383191">.</span><span class="ident" id="8383192">T</span><span class="op" id="8383193">,</span>&nbsp;<span class="ident" id="8383195">pcf</span>&nbsp;<span class="ident" id="8383199">packetConnFile</span><span class="op" id="8383213">,</span>&nbsp;<span class="ident" id="8383215">listen</span>&nbsp;<span class="builtintype" id="8383222">bool</span><span class="op" id="8383226">)</span>&nbsp;<span class="op" id="8383228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383231">f</span><span class="op" id="8383232">,</span>&nbsp;<span class="ident" id="8383234">err</span>&nbsp;<span class="op" id="8383238">:=</span>&nbsp;<span class="ident" id="8383241">pcf</span><span class="op" id="8383244">.</span><span class="ident" id="8383245">File</span><span class="op" id="8383249">(</span><span class="op" id="8383250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383253">if</span>&nbsp;<span class="ident" id="8383256">err</span>&nbsp;<span class="op" id="8383260">!=</span>&nbsp;<span class="ident" id="8383263">nil</span>&nbsp;<span class="op" id="8383267">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383271">t</span><span class="op" id="8383272">.</span><span class="ident" id="8383273">Fatalf</span><span class="op" id="8383279">(</span><span class="string" id="8383280">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8383297">,</span>&nbsp;<span class="ident" id="8383299">err</span><span class="op" id="8383302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383308">c</span><span class="op" id="8383309">,</span>&nbsp;<span class="ident" id="8383311">err</span>&nbsp;<span class="op" id="8383315">:=</span>&nbsp;<span class="ident" id="8383318">FilePacketConn</span><span class="op" id="8383332">(</span><span class="ident" id="8383333">f</span><span class="op" id="8383334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383337">if</span>&nbsp;<span class="ident" id="8383340">err</span>&nbsp;<span class="op" id="8383344">!=</span>&nbsp;<span class="ident" id="8383347">nil</span>&nbsp;<span class="op" id="8383351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383355">t</span><span class="op" id="8383356">.</span><span class="ident" id="8383357">Fatalf</span><span class="op" id="8383363">(</span><span class="string" id="8383364">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8383391">,</span>&nbsp;<span class="ident" id="8383393">err</span><span class="op" id="8383396">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383402">if</span>&nbsp;<span class="op" id="8383405">!</span><span class="ident" id="8383406">reflect</span><span class="op" id="8383413">.</span><span class="ident" id="8383414">DeepEqual</span><span class="op" id="8383423">(</span><span class="ident" id="8383424">pcf</span><span class="op" id="8383427">.</span><span class="ident" id="8383428">LocalAddr</span><span class="op" id="8383437">(</span><span class="op" id="8383438">)</span><span class="op" id="8383439">,</span>&nbsp;<span class="ident" id="8383441">c</span><span class="op" id="8383442">.</span><span class="ident" id="8383443">LocalAddr</span><span class="op" id="8383452">(</span><span class="op" id="8383453">)</span><span class="op" id="8383454">)</span>&nbsp;<span class="op" id="8383456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383460">t</span><span class="op" id="8383461">.</span><span class="ident" id="8383462">Fatalf</span><span class="op" id="8383468">(</span><span class="string" id="8383469">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8383503">,</span>&nbsp;<span class="ident" id="8383505">pcf</span><span class="op" id="8383508">.</span><span class="ident" id="8383509">LocalAddr</span><span class="op" id="8383518">(</span><span class="op" id="8383519">)</span><span class="op" id="8383520">,</span>&nbsp;<span class="ident" id="8383522">c</span><span class="op" id="8383523">.</span><span class="ident" id="8383524">LocalAddr</span><span class="op" id="8383533">(</span><span class="op" id="8383534">)</span><span class="op" id="8383535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383541">if</span>&nbsp;<span class="ident" id="8383544">listen</span>&nbsp;<span class="op" id="8383551">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383555">if</span>&nbsp;<span class="ident" id="8383558">_</span><span class="op" id="8383559">,</span>&nbsp;<span class="ident" id="8383561">err</span>&nbsp;<span class="op" id="8383565">:=</span>&nbsp;<span class="ident" id="8383568">c</span><span class="op" id="8383569">.</span><span class="ident" id="8383570">WriteTo</span><span class="op" id="8383577">(</span><span class="op" id="8383578">[</span><span class="op" id="8383579">]</span><span class="builtintype" id="8383580">byte</span><span class="op" id="8383584">{</span><span class="op" id="8383585">}</span><span class="op" id="8383586">,</span>&nbsp;<span class="ident" id="8383588">c</span><span class="op" id="8383589">.</span><span class="ident" id="8383590">LocalAddr</span><span class="op" id="8383599">(</span><span class="op" id="8383600">)</span><span class="op" id="8383601">)</span><span class="op" id="8383602">;</span>&nbsp;<span class="ident" id="8383604">err</span>&nbsp;<span class="op" id="8383608">!=</span>&nbsp;<span class="ident" id="8383611">nil</span>&nbsp;<span class="op" id="8383615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383620">t</span><span class="op" id="8383621">.</span><span class="ident" id="8383622">Fatalf</span><span class="op" id="8383628">(</span><span class="string" id="8383629">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8383649">,</span>&nbsp;<span class="ident" id="8383651">err</span><span class="op" id="8383654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383664">if</span>&nbsp;<span class="ident" id="8383667">err</span>&nbsp;<span class="op" id="8383671">:=</span>&nbsp;<span class="ident" id="8383674">c</span><span class="op" id="8383675">.</span><span class="ident" id="8383676">Close</span><span class="op" id="8383681">(</span><span class="op" id="8383682">)</span><span class="op" id="8383683">;</span>&nbsp;<span class="ident" id="8383685">err</span>&nbsp;<span class="op" id="8383689">!=</span>&nbsp;<span class="ident" id="8383692">nil</span>&nbsp;<span class="op" id="8383696">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383700">t</span><span class="op" id="8383701">.</span><span class="ident" id="8383702">Fatalf</span><span class="op" id="8383708">(</span><span class="string" id="8383709">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8383727">,</span>&nbsp;<span class="ident" id="8383729">err</span><span class="op" id="8383732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383738">if</span>&nbsp;<span class="ident" id="8383741">err</span>&nbsp;<span class="op" id="8383745">:=</span>&nbsp;<span class="ident" id="8383748">f</span><span class="op" id="8383749">.</span><span class="ident" id="8383750">Close</span><span class="op" id="8383755">(</span><span class="op" id="8383756">)</span><span class="op" id="8383757">;</span>&nbsp;<span class="ident" id="8383759">err</span>&nbsp;<span class="op" id="8383763">!=</span>&nbsp;<span class="ident" id="8383766">nil</span>&nbsp;<span class="op" id="8383770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383774">t</span><span class="op" id="8383775">.</span><span class="ident" id="8383776">Fatalf</span><span class="op" id="8383782">(</span><span class="string" id="8383783">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8383801">,</span>&nbsp;<span class="ident" id="8383803">err</span><span class="op" id="8383806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383809">}</span><br>
<span class="lineno">130</span><span class="op" id="8383811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8383814">func</span>&nbsp;<span class="ident" id="8383819">testFilePacketConnListen</span><span class="op" id="8383843">(</span><span class="ident" id="8383844">t</span>&nbsp;<span class="op" id="8383846">*</span><span class="ident" id="8383847">testing</span><span class="op" id="8383854">.</span><span class="ident" id="8383855">T</span><span class="op" id="8383856">,</span>&nbsp;<span class="ident" id="8383858">net</span><span class="op" id="8383861">,</span>&nbsp;<span class="ident" id="8383863">laddr</span>&nbsp;<span class="builtintype" id="8383869">string</span><span class="op" id="8383875">)</span>&nbsp;<span class="op" id="8383877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383880">switch</span>&nbsp;<span class="ident" id="8383887">net</span>&nbsp;<span class="op" id="8383891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383894">case</span>&nbsp;<span class="string" id="8383899">&#34;udp&#34;</span><span class="op" id="8383904">,</span>&nbsp;<span class="string" id="8383906">&#34;udp4&#34;</span><span class="op" id="8383912">,</span>&nbsp;<span class="string" id="8383914">&#34;udp6&#34;</span><span class="op" id="8383920">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383924">laddr</span>&nbsp;<span class="op" id="8383930">+=</span>&nbsp;<span class="string" id="8383933">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8383938">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383964">l</span><span class="op" id="8383965">,</span>&nbsp;<span class="ident" id="8383967">err</span>&nbsp;<span class="op" id="8383971">:=</span>&nbsp;<span class="ident" id="8383974">ListenPacket</span><span class="op" id="8383986">(</span><span class="ident" id="8383987">net</span><span class="op" id="8383990">,</span>&nbsp;<span class="ident" id="8383992">laddr</span><span class="op" id="8383997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384000">if</span>&nbsp;<span class="ident" id="8384003">err</span>&nbsp;<span class="op" id="8384007">!=</span>&nbsp;<span class="ident" id="8384010">nil</span>&nbsp;<span class="op" id="8384014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384018">t</span><span class="op" id="8384019">.</span><span class="ident" id="8384020">Fatalf</span><span class="op" id="8384026">(</span><span class="string" id="8384027">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384052">,</span>&nbsp;<span class="ident" id="8384054">err</span><span class="op" id="8384057">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384063">testFilePacketConn</span><span class="op" id="8384081">(</span><span class="ident" id="8384082">t</span><span class="op" id="8384083">,</span>&nbsp;<span class="ident" id="8384085">l</span><span class="op" id="8384086">.</span><span class="op" id="8384087">(</span><span class="ident" id="8384088">packetConnFile</span><span class="op" id="8384102">)</span><span class="op" id="8384103">,</span>&nbsp;<span class="builtintype" id="8384105">true</span><span class="op" id="8384109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384112">if</span>&nbsp;<span class="ident" id="8384115">err</span>&nbsp;<span class="op" id="8384119">:=</span>&nbsp;<span class="ident" id="8384122">l</span><span class="op" id="8384123">.</span><span class="ident" id="8384124">Close</span><span class="op" id="8384129">(</span><span class="op" id="8384130">)</span><span class="op" id="8384131">;</span>&nbsp;<span class="ident" id="8384133">err</span>&nbsp;<span class="op" id="8384137">!=</span>&nbsp;<span class="ident" id="8384140">nil</span>&nbsp;<span class="op" id="8384144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384148">t</span><span class="op" id="8384149">.</span><span class="ident" id="8384150">Fatalf</span><span class="op" id="8384156">(</span><span class="string" id="8384157">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384175">,</span>&nbsp;<span class="ident" id="8384177">err</span><span class="op" id="8384180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384183">}</span><br>
<span class="lineno">145</span><span class="op" id="8384185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8384188">func</span>&nbsp;<span class="ident" id="8384193">testFilePacketConnDial</span><span class="op" id="8384215">(</span><span class="ident" id="8384216">t</span>&nbsp;<span class="op" id="8384218">*</span><span class="ident" id="8384219">testing</span><span class="op" id="8384226">.</span><span class="ident" id="8384227">T</span><span class="op" id="8384228">,</span>&nbsp;<span class="ident" id="8384230">net</span><span class="op" id="8384233">,</span>&nbsp;<span class="ident" id="8384235">raddr</span>&nbsp;<span class="builtintype" id="8384241">string</span><span class="op" id="8384247">)</span>&nbsp;<span class="op" id="8384249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384252">switch</span>&nbsp;<span class="ident" id="8384259">net</span>&nbsp;<span class="op" id="8384263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384266">case</span>&nbsp;<span class="string" id="8384271">&#34;udp&#34;</span><span class="op" id="8384276">,</span>&nbsp;<span class="string" id="8384278">&#34;udp4&#34;</span><span class="op" id="8384284">,</span>&nbsp;<span class="string" id="8384286">&#34;udp6&#34;</span><span class="op" id="8384292">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384296">raddr</span>&nbsp;<span class="op" id="8384302">+=</span>&nbsp;<span class="string" id="8384305">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384318">c</span><span class="op" id="8384319">,</span>&nbsp;<span class="ident" id="8384321">err</span>&nbsp;<span class="op" id="8384325">:=</span>&nbsp;<span class="ident" id="8384328">Dial</span><span class="op" id="8384332">(</span><span class="ident" id="8384333">net</span><span class="op" id="8384336">,</span>&nbsp;<span class="ident" id="8384338">raddr</span><span class="op" id="8384343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384346">if</span>&nbsp;<span class="ident" id="8384349">err</span>&nbsp;<span class="op" id="8384353">!=</span>&nbsp;<span class="ident" id="8384356">nil</span>&nbsp;<span class="op" id="8384360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384364">t</span><span class="op" id="8384365">.</span><span class="ident" id="8384366">Fatalf</span><span class="op" id="8384372">(</span><span class="string" id="8384373">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384390">,</span>&nbsp;<span class="ident" id="8384392">err</span><span class="op" id="8384395">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384401">testFilePacketConn</span><span class="op" id="8384419">(</span><span class="ident" id="8384420">t</span><span class="op" id="8384421">,</span>&nbsp;<span class="ident" id="8384423">c</span><span class="op" id="8384424">.</span><span class="op" id="8384425">(</span><span class="ident" id="8384426">packetConnFile</span><span class="op" id="8384440">)</span><span class="op" id="8384441">,</span>&nbsp;<span class="builtintype" id="8384443">false</span><span class="op" id="8384448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384451">if</span>&nbsp;<span class="ident" id="8384454">err</span>&nbsp;<span class="op" id="8384458">:=</span>&nbsp;<span class="ident" id="8384461">c</span><span class="op" id="8384462">.</span><span class="ident" id="8384463">Close</span><span class="op" id="8384468">(</span><span class="op" id="8384469">)</span><span class="op" id="8384470">;</span>&nbsp;<span class="ident" id="8384472">err</span>&nbsp;<span class="op" id="8384476">!=</span>&nbsp;<span class="ident" id="8384479">nil</span>&nbsp;<span class="op" id="8384483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384487">t</span><span class="op" id="8384488">.</span><span class="ident" id="8384489">Fatalf</span><span class="op" id="8384495">(</span><span class="string" id="8384496">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384514">,</span>&nbsp;<span class="ident" id="8384516">err</span><span class="op" id="8384519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384522">}</span><br>
<span class="lineno">160</span><span class="op" id="8384524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8384527">var</span>&nbsp;<span class="ident" id="8384531">filePacketConnTests</span>&nbsp;<span class="op" id="8384551">=</span>&nbsp;<span class="op" id="8384553">[</span><span class="op" id="8384554">]</span><span class="keyword" id="8384555">struct</span>&nbsp;<span class="op" id="8384562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384565">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8384571">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384579">addr</span>&nbsp;&nbsp;<span class="builtintype" id="8384585">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384593">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8384599">bool</span>&nbsp;<span class="comment" id="8384604">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384645">linux</span>&nbsp;<span class="builtintype" id="8384651">bool</span>&nbsp;<span class="comment" id="8384656">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8384710">}</span><span class="op" id="8384711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384714">{</span><span class="ident" id="8384715">net</span><span class="op" id="8384718">:</span>&nbsp;<span class="string" id="8384720">&#34;udp&#34;</span><span class="op" id="8384725">,</span>&nbsp;<span class="ident" id="8384727">addr</span><span class="op" id="8384731">:</span>&nbsp;<span class="string" id="8384733">&#34;127.0.0.1&#34;</span><span class="op" id="8384744">}</span><span class="op" id="8384745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384748">{</span><span class="ident" id="8384749">net</span><span class="op" id="8384752">:</span>&nbsp;<span class="string" id="8384754">&#34;udp&#34;</span><span class="op" id="8384759">,</span>&nbsp;<span class="ident" id="8384761">addr</span><span class="op" id="8384765">:</span>&nbsp;<span class="string" id="8384767">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8384787">}</span><span class="op" id="8384788">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384791">{</span><span class="ident" id="8384792">net</span><span class="op" id="8384795">:</span>&nbsp;<span class="string" id="8384797">&#34;udp&#34;</span><span class="op" id="8384802">,</span>&nbsp;<span class="ident" id="8384804">addr</span><span class="op" id="8384808">:</span>&nbsp;<span class="string" id="8384810">&#34;[::1]&#34;</span><span class="op" id="8384817">,</span>&nbsp;<span class="ident" id="8384819">ipv6</span><span class="op" id="8384823">:</span>&nbsp;<span class="builtintype" id="8384825">true</span><span class="op" id="8384829">}</span><span class="op" id="8384830">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384834">{</span><span class="ident" id="8384835">net</span><span class="op" id="8384838">:</span>&nbsp;<span class="string" id="8384840">&#34;udp4&#34;</span><span class="op" id="8384846">,</span>&nbsp;<span class="ident" id="8384848">addr</span><span class="op" id="8384852">:</span>&nbsp;<span class="string" id="8384854">&#34;127.0.0.1&#34;</span><span class="op" id="8384865">}</span><span class="op" id="8384866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384869">{</span><span class="ident" id="8384870">net</span><span class="op" id="8384873">:</span>&nbsp;<span class="string" id="8384875">&#34;udp4&#34;</span><span class="op" id="8384881">,</span>&nbsp;<span class="ident" id="8384883">addr</span><span class="op" id="8384887">:</span>&nbsp;<span class="string" id="8384889">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8384909">}</span><span class="op" id="8384910">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384914">{</span><span class="ident" id="8384915">net</span><span class="op" id="8384918">:</span>&nbsp;<span class="string" id="8384920">&#34;udp6&#34;</span><span class="op" id="8384926">,</span>&nbsp;<span class="ident" id="8384928">addr</span><span class="op" id="8384932">:</span>&nbsp;<span class="string" id="8384934">&#34;[::1]&#34;</span><span class="op" id="8384941">,</span>&nbsp;<span class="ident" id="8384943">ipv6</span><span class="op" id="8384947">:</span>&nbsp;<span class="builtintype" id="8384949">true</span><span class="op" id="8384953">}</span><span class="op" id="8384954">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384958">{</span><span class="ident" id="8384959">net</span><span class="op" id="8384962">:</span>&nbsp;<span class="string" id="8384964">&#34;ip4:icmp&#34;</span><span class="op" id="8384974">,</span>&nbsp;<span class="ident" id="8384976">addr</span><span class="op" id="8384980">:</span>&nbsp;<span class="string" id="8384982">&#34;127.0.0.1&#34;</span><span class="op" id="8384993">}</span><span class="op" id="8384994">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384998">{</span><span class="ident" id="8384999">net</span><span class="op" id="8385002">:</span>&nbsp;<span class="string" id="8385004">&#34;unixgram&#34;</span><span class="op" id="8385014">,</span>&nbsp;<span class="ident" id="8385016">addr</span><span class="op" id="8385020">:</span>&nbsp;<span class="string" id="8385022">&#34;@gotest3/net&#34;</span><span class="op" id="8385036">,</span>&nbsp;<span class="ident" id="8385038">linux</span><span class="op" id="8385043">:</span>&nbsp;<span class="builtintype" id="8385045">true</span><span class="op" id="8385049">}</span><span class="op" id="8385050">,</span><br>
<span class="lineno">180</span><span class="op" id="8385052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8385055">func</span>&nbsp;<span class="ident" id="8385060">TestFilePacketConn</span><span class="op" id="8385078">(</span><span class="ident" id="8385079">t</span>&nbsp;<span class="op" id="8385081">*</span><span class="ident" id="8385082">testing</span><span class="op" id="8385089">.</span><span class="ident" id="8385090">T</span><span class="op" id="8385091">)</span>&nbsp;<span class="op" id="8385093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385096">switch</span>&nbsp;<span class="ident" id="8385103">runtime</span><span class="op" id="8385110">.</span><span class="ident" id="8385111">GOOS</span>&nbsp;<span class="op" id="8385116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385119">case</span>&nbsp;<span class="string" id="8385124">&#34;nacl&#34;</span><span class="op" id="8385130">,</span>&nbsp;<span class="string" id="8385132">&#34;plan9&#34;</span><span class="op" id="8385139">,</span>&nbsp;<span class="string" id="8385141">&#34;windows&#34;</span><span class="op" id="8385150">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385154">t</span><span class="op" id="8385155">.</span><span class="ident" id="8385156">Skipf</span><span class="op" id="8385161">(</span><span class="string" id="8385162">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8385183">,</span>&nbsp;<span class="ident" id="8385185">runtime</span><span class="op" id="8385192">.</span><span class="ident" id="8385193">GOOS</span><span class="op" id="8385197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385204">for</span>&nbsp;<span class="ident" id="8385208">_</span><span class="op" id="8385209">,</span>&nbsp;<span class="ident" id="8385211">tt</span>&nbsp;<span class="op" id="8385214">:=</span>&nbsp;<span class="keyword" id="8385217">range</span>&nbsp;<span class="ident" id="8385223">filePacketConnTests</span>&nbsp;<span class="op" id="8385243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385247">if</span>&nbsp;<span class="ident" id="8385250">skipServerTest</span><span class="op" id="8385264">(</span><span class="ident" id="8385265">tt</span><span class="op" id="8385267">.</span><span class="ident" id="8385268">net</span><span class="op" id="8385271">,</span>&nbsp;<span class="string" id="8385273">&#34;unixgram&#34;</span><span class="op" id="8385283">,</span>&nbsp;<span class="ident" id="8385285">tt</span><span class="op" id="8385287">.</span><span class="ident" id="8385288">addr</span><span class="op" id="8385292">,</span>&nbsp;<span class="ident" id="8385294">tt</span><span class="op" id="8385296">.</span><span class="ident" id="8385297">ipv6</span><span class="op" id="8385301">,</span>&nbsp;<span class="builtintype" id="8385303">false</span><span class="op" id="8385308">,</span>&nbsp;<span class="ident" id="8385310">tt</span><span class="op" id="8385312">.</span><span class="ident" id="8385313">linux</span><span class="op" id="8385318">)</span>&nbsp;<span class="op" id="8385320">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385325">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385340">if</span>&nbsp;<span class="ident" id="8385343">os</span><span class="op" id="8385345">.</span><span class="ident" id="8385346">Getuid</span><span class="op" id="8385352">(</span><span class="op" id="8385353">)</span>&nbsp;<span class="op" id="8385355">!=</span>&nbsp;<span class="num" id="8385358">0</span>&nbsp;<span class="op" id="8385360">&amp;&amp;</span>&nbsp;<span class="ident" id="8385363">tt</span><span class="op" id="8385365">.</span><span class="ident" id="8385366">net</span>&nbsp;<span class="op" id="8385370">==</span>&nbsp;<span class="string" id="8385373">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="8385384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385389">t</span><span class="op" id="8385390">.</span><span class="ident" id="8385391">Log</span><span class="op" id="8385394">(</span><span class="string" id="8385395">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8385424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385429">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385444">testFilePacketConnListen</span><span class="op" id="8385468">(</span><span class="ident" id="8385469">t</span><span class="op" id="8385470">,</span>&nbsp;<span class="ident" id="8385472">tt</span><span class="op" id="8385474">.</span><span class="ident" id="8385475">net</span><span class="op" id="8385478">,</span>&nbsp;<span class="ident" id="8385480">tt</span><span class="op" id="8385482">.</span><span class="ident" id="8385483">addr</span><span class="op" id="8385487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385491">switch</span>&nbsp;<span class="ident" id="8385498">tt</span><span class="op" id="8385500">.</span><span class="ident" id="8385501">addr</span>&nbsp;<span class="op" id="8385506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385510">case</span>&nbsp;<span class="string" id="8385515">&#34;&#34;</span><span class="op" id="8385517">,</span>&nbsp;<span class="string" id="8385519">&#34;0.0.0.0&#34;</span><span class="op" id="8385528">,</span>&nbsp;<span class="string" id="8385530">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8385548">,</span>&nbsp;<span class="string" id="8385550">&#34;[::]&#34;</span><span class="op" id="8385556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385560">default</span><span class="op" id="8385567">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385572">if</span>&nbsp;<span class="ident" id="8385575">tt</span><span class="op" id="8385577">.</span><span class="ident" id="8385578">net</span>&nbsp;<span class="op" id="8385582">!=</span>&nbsp;<span class="string" id="8385585">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="8385596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385602">testFilePacketConnDial</span><span class="op" id="8385624">(</span><span class="ident" id="8385625">t</span><span class="op" id="8385626">,</span>&nbsp;<span class="ident" id="8385628">tt</span><span class="op" id="8385630">.</span><span class="ident" id="8385631">net</span><span class="op" id="8385634">,</span>&nbsp;<span class="ident" id="8385636">tt</span><span class="op" id="8385638">.</span><span class="ident" id="8385639">addr</span><span class="op" id="8385643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385655">}</span><br>
<span class="lineno">205</span><span class="op" id="8385657">}</span>
</div>
</body>
</html>
