<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8416650">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8416706">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8416760">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8416811">//&nbsp;Export&nbsp;guts&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8416840">package</span>&nbsp;<span class="ident" id="8416848">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8416857">import</span>&nbsp;<span class="string" id="8416864">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="8416874">var</span>&nbsp;<span class="ident" id="8416878">Fadd64</span>&nbsp;<span class="op" id="8416885">=</span>&nbsp;<span class="ident" id="8416887">fadd64</span><br>
<span class="lineno"></span><span class="keyword" id="8416894">var</span>&nbsp;<span class="ident" id="8416898">Fsub64</span>&nbsp;<span class="op" id="8416905">=</span>&nbsp;<span class="ident" id="8416907">fsub64</span><br>
<span class="lineno"></span><span class="keyword" id="8416914">var</span>&nbsp;<span class="ident" id="8416918">Fmul64</span>&nbsp;<span class="op" id="8416925">=</span>&nbsp;<span class="ident" id="8416927">fmul64</span><br>
<span class="lineno"></span><span class="keyword" id="8416934">var</span>&nbsp;<span class="ident" id="8416938">Fdiv64</span>&nbsp;<span class="op" id="8416945">=</span>&nbsp;<span class="ident" id="8416947">fdiv64</span><br>
<span class="lineno">15</span><span class="keyword" id="8416954">var</span>&nbsp;<span class="ident" id="8416958">F64to32</span>&nbsp;<span class="op" id="8416966">=</span>&nbsp;<span class="ident" id="8416968">f64to32</span><br>
<span class="lineno"></span><span class="keyword" id="8416976">var</span>&nbsp;<span class="ident" id="8416980">F32to64</span>&nbsp;<span class="op" id="8416988">=</span>&nbsp;<span class="ident" id="8416990">f32to64</span><br>
<span class="lineno"></span><span class="keyword" id="8416998">var</span>&nbsp;<span class="ident" id="8417002">Fcmp64</span>&nbsp;<span class="op" id="8417009">=</span>&nbsp;<span class="ident" id="8417011">fcmp64</span><br>
<span class="lineno"></span><span class="keyword" id="8417018">var</span>&nbsp;<span class="ident" id="8417022">Fintto64</span>&nbsp;<span class="op" id="8417031">=</span>&nbsp;<span class="ident" id="8417033">fintto64</span><br>
<span class="lineno"></span><span class="keyword" id="8417042">var</span>&nbsp;<span class="ident" id="8417046">F64toint</span>&nbsp;<span class="op" id="8417055">=</span>&nbsp;<span class="ident" id="8417057">f64toint</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8417067">//&nbsp;in&nbsp;asm_*.s</span><br>
<span class="lineno"></span><span class="keyword" id="8417081">func</span>&nbsp;<span class="ident" id="8417086">stackguard</span><span class="op" id="8417096">(</span><span class="op" id="8417097">)</span>&nbsp;<span class="op" id="8417099">(</span><span class="ident" id="8417100">sp</span><span class="op" id="8417102">,</span>&nbsp;<span class="ident" id="8417104">limit</span>&nbsp;<span class="builtintype" id="8417110">uintptr</span><span class="op" id="8417117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8417120">var</span>&nbsp;<span class="ident" id="8417124">Entersyscall</span>&nbsp;<span class="op" id="8417137">=</span>&nbsp;<span class="ident" id="8417139">entersyscall</span><br>
<span class="lineno">25</span><span class="keyword" id="8417152">var</span>&nbsp;<span class="ident" id="8417156">Exitsyscall</span>&nbsp;<span class="op" id="8417168">=</span>&nbsp;<span class="ident" id="8417170">exitsyscall</span><br>
<span class="lineno"></span><span class="keyword" id="8417182">var</span>&nbsp;<span class="ident" id="8417186">LockedOSThread</span>&nbsp;<span class="op" id="8417201">=</span>&nbsp;<span class="ident" id="8417203">lockedOSThread</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8417219">type</span>&nbsp;<span class="ident" id="8417224">LFNode</span>&nbsp;<span class="keyword" id="8417231">struct</span>&nbsp;<span class="op" id="8417238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417241">Next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8417249">*</span><span class="ident" id="8417250">LFNode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417258">Pushcnt</span>&nbsp;<span class="builtintype" id="8417266">uintptr</span><br>
<span class="lineno"></span><span class="op" id="8417274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8417277">func</span>&nbsp;<span class="ident" id="8417282">lfstackpush_m</span><span class="op" id="8417295">(</span><span class="op" id="8417296">)</span><br>
<span class="lineno"></span><span class="keyword" id="8417298">func</span>&nbsp;<span class="ident" id="8417303">lfstackpop_m</span><span class="op" id="8417315">(</span><span class="op" id="8417316">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="8417319">func</span>&nbsp;<span class="ident" id="8417324">LFStackPush</span><span class="op" id="8417335">(</span><span class="ident" id="8417336">head</span>&nbsp;<span class="op" id="8417341">*</span><span class="ident" id="8417342">uint64</span><span class="op" id="8417348">,</span>&nbsp;<span class="ident" id="8417350">node</span>&nbsp;<span class="op" id="8417355">*</span><span class="ident" id="8417356">LFNode</span><span class="op" id="8417362">)</span>&nbsp;<span class="op" id="8417364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417367">mp</span>&nbsp;<span class="op" id="8417370">:=</span>&nbsp;<span class="ident" id="8417373">acquirem</span><span class="op" id="8417381">(</span><span class="op" id="8417382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417385">mp</span><span class="op" id="8417387">.</span><span class="ident" id="8417388">ptrarg</span><span class="op" id="8417394">[</span><span class="num" id="8417395">0</span><span class="op" id="8417396">]</span>&nbsp;<span class="op" id="8417398">=</span>&nbsp;<span class="ident" id="8417400">unsafe</span><span class="op" id="8417406">.</span><span class="ident" id="8417407">Pointer</span><span class="op" id="8417414">(</span><span class="ident" id="8417415">head</span><span class="op" id="8417419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417422">mp</span><span class="op" id="8417424">.</span><span class="ident" id="8417425">ptrarg</span><span class="op" id="8417431">[</span><span class="num" id="8417432">1</span><span class="op" id="8417433">]</span>&nbsp;<span class="op" id="8417435">=</span>&nbsp;<span class="ident" id="8417437">unsafe</span><span class="op" id="8417443">.</span><span class="ident" id="8417444">Pointer</span><span class="op" id="8417451">(</span><span class="ident" id="8417452">node</span><span class="op" id="8417456">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417459">onM</span><span class="op" id="8417462">(</span><span class="ident" id="8417463">lfstackpush_m</span><span class="op" id="8417476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417479">releasem</span><span class="op" id="8417487">(</span><span class="ident" id="8417488">mp</span><span class="op" id="8417490">)</span><br>
<span class="lineno"></span><span class="op" id="8417492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8417495">func</span>&nbsp;<span class="ident" id="8417500">LFStackPop</span><span class="op" id="8417510">(</span><span class="ident" id="8417511">head</span>&nbsp;<span class="op" id="8417516">*</span><span class="ident" id="8417517">uint64</span><span class="op" id="8417523">)</span>&nbsp;<span class="op" id="8417525">*</span><span class="ident" id="8417526">LFNode</span>&nbsp;<span class="op" id="8417533">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417536">mp</span>&nbsp;<span class="op" id="8417539">:=</span>&nbsp;<span class="ident" id="8417542">acquirem</span><span class="op" id="8417550">(</span><span class="op" id="8417551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417554">mp</span><span class="op" id="8417556">.</span><span class="ident" id="8417557">ptrarg</span><span class="op" id="8417563">[</span><span class="num" id="8417564">0</span><span class="op" id="8417565">]</span>&nbsp;<span class="op" id="8417567">=</span>&nbsp;<span class="ident" id="8417569">unsafe</span><span class="op" id="8417575">.</span><span class="ident" id="8417576">Pointer</span><span class="op" id="8417583">(</span><span class="ident" id="8417584">head</span><span class="op" id="8417588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417591">onM</span><span class="op" id="8417594">(</span><span class="ident" id="8417595">lfstackpop_m</span><span class="op" id="8417607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417610">node</span>&nbsp;<span class="op" id="8417615">:=</span>&nbsp;<span class="op" id="8417618">(</span><span class="op" id="8417619">*</span><span class="ident" id="8417620">LFNode</span><span class="op" id="8417626">)</span><span class="op" id="8417627">(</span><span class="ident" id="8417628">unsafe</span><span class="op" id="8417634">.</span><span class="ident" id="8417635">Pointer</span><span class="op" id="8417642">(</span><span class="ident" id="8417643">mp</span><span class="op" id="8417645">.</span><span class="ident" id="8417646">ptrarg</span><span class="op" id="8417652">[</span><span class="num" id="8417653">0</span><span class="op" id="8417654">]</span><span class="op" id="8417655">)</span><span class="op" id="8417656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417659">mp</span><span class="op" id="8417661">.</span><span class="ident" id="8417662">ptrarg</span><span class="op" id="8417668">[</span><span class="num" id="8417669">0</span><span class="op" id="8417670">]</span>&nbsp;<span class="op" id="8417672">=</span>&nbsp;<span class="ident" id="8417674">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417679">releasem</span><span class="op" id="8417687">(</span><span class="ident" id="8417688">mp</span><span class="op" id="8417690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8417693">return</span>&nbsp;<span class="ident" id="8417700">node</span><br>
<span class="lineno"></span><span class="op" id="8417705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8417708">type</span>&nbsp;<span class="ident" id="8417713">ParFor</span>&nbsp;<span class="keyword" id="8417720">struct</span>&nbsp;<span class="op" id="8417727">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417730">body</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8417738">*</span><span class="builtintype" id="8417739">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417745">done</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8417753">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417761">Nthr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8417769">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417777">nthrmax</span>&nbsp;<span class="builtintype" id="8417785">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417793">thrseq</span>&nbsp;&nbsp;<span class="builtintype" id="8417801">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417809">Cnt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8417817">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417825">Ctx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8417833">*</span><span class="builtintype" id="8417834">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417840">wait</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8417848">bool</span><br>
<span class="lineno"></span><span class="op" id="8417853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8417856">func</span>&nbsp;<span class="ident" id="8417861">newparfor_m</span><span class="op" id="8417872">(</span><span class="op" id="8417873">)</span><br>
<span class="lineno"></span><span class="keyword" id="8417875">func</span>&nbsp;<span class="ident" id="8417880">parforsetup_m</span><span class="op" id="8417893">(</span><span class="op" id="8417894">)</span><br>
<span class="lineno"></span><span class="keyword" id="8417896">func</span>&nbsp;<span class="ident" id="8417901">parfordo_m</span><span class="op" id="8417911">(</span><span class="op" id="8417912">)</span><br>
<span class="lineno"></span><span class="keyword" id="8417914">func</span>&nbsp;<span class="ident" id="8417919">parforiters_m</span><span class="op" id="8417932">(</span><span class="op" id="8417933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8417936">func</span>&nbsp;<span class="ident" id="8417941">NewParFor</span><span class="op" id="8417950">(</span><span class="ident" id="8417951">nthrmax</span>&nbsp;<span class="builtintype" id="8417959">uint32</span><span class="op" id="8417965">)</span>&nbsp;<span class="op" id="8417967">*</span><span class="ident" id="8417968">ParFor</span>&nbsp;<span class="op" id="8417975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417978">mp</span>&nbsp;<span class="op" id="8417981">:=</span>&nbsp;<span class="ident" id="8417984">acquirem</span><span class="op" id="8417992">(</span><span class="op" id="8417993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417996">mp</span><span class="op" id="8417998">.</span><span class="ident" id="8417999">scalararg</span><span class="op" id="8418008">[</span><span class="num" id="8418009">0</span><span class="op" id="8418010">]</span>&nbsp;<span class="op" id="8418012">=</span>&nbsp;<span class="builtintype" id="8418014">uintptr</span><span class="op" id="8418021">(</span><span class="ident" id="8418022">nthrmax</span><span class="op" id="8418029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418032">onM</span><span class="op" id="8418035">(</span><span class="ident" id="8418036">newparfor_m</span><span class="op" id="8418047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418050">desc</span>&nbsp;<span class="op" id="8418055">:=</span>&nbsp;<span class="op" id="8418058">(</span><span class="op" id="8418059">*</span><span class="ident" id="8418060">ParFor</span><span class="op" id="8418066">)</span><span class="op" id="8418067">(</span><span class="ident" id="8418068">mp</span><span class="op" id="8418070">.</span><span class="ident" id="8418071">ptrarg</span><span class="op" id="8418077">[</span><span class="num" id="8418078">0</span><span class="op" id="8418079">]</span><span class="op" id="8418080">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418083">mp</span><span class="op" id="8418085">.</span><span class="ident" id="8418086">ptrarg</span><span class="op" id="8418092">[</span><span class="num" id="8418093">0</span><span class="op" id="8418094">]</span>&nbsp;<span class="op" id="8418096">=</span>&nbsp;<span class="ident" id="8418098">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418103">releasem</span><span class="op" id="8418111">(</span><span class="ident" id="8418112">mp</span><span class="op" id="8418114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418117">return</span>&nbsp;<span class="ident" id="8418124">desc</span><br>
<span class="lineno"></span><span class="op" id="8418129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8418132">func</span>&nbsp;<span class="ident" id="8418137">ParForSetup</span><span class="op" id="8418148">(</span><span class="ident" id="8418149">desc</span>&nbsp;<span class="op" id="8418154">*</span><span class="ident" id="8418155">ParFor</span><span class="op" id="8418161">,</span>&nbsp;<span class="ident" id="8418163">nthr</span><span class="op" id="8418167">,</span>&nbsp;<span class="ident" id="8418169">n</span>&nbsp;<span class="builtintype" id="8418171">uint32</span><span class="op" id="8418177">,</span>&nbsp;<span class="ident" id="8418179">ctx</span>&nbsp;<span class="op" id="8418183">*</span><span class="builtintype" id="8418184">byte</span><span class="op" id="8418188">,</span>&nbsp;<span class="ident" id="8418190">wait</span>&nbsp;<span class="builtintype" id="8418195">bool</span><span class="op" id="8418199">,</span>&nbsp;<span class="ident" id="8418201">body</span>&nbsp;<span class="keyword" id="8418206">func</span><span class="op" id="8418210">(</span><span class="op" id="8418211">*</span><span class="ident" id="8418212">ParFor</span><span class="op" id="8418218">,</span>&nbsp;<span class="builtintype" id="8418220">uint32</span><span class="op" id="8418226">)</span><span class="op" id="8418227">)</span>&nbsp;<span class="op" id="8418229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418232">mp</span>&nbsp;<span class="op" id="8418235">:=</span>&nbsp;<span class="ident" id="8418238">acquirem</span><span class="op" id="8418246">(</span><span class="op" id="8418247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418250">mp</span><span class="op" id="8418252">.</span><span class="ident" id="8418253">ptrarg</span><span class="op" id="8418259">[</span><span class="num" id="8418260">0</span><span class="op" id="8418261">]</span>&nbsp;<span class="op" id="8418263">=</span>&nbsp;<span class="ident" id="8418265">unsafe</span><span class="op" id="8418271">.</span><span class="ident" id="8418272">Pointer</span><span class="op" id="8418279">(</span><span class="ident" id="8418280">desc</span><span class="op" id="8418284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418287">mp</span><span class="op" id="8418289">.</span><span class="ident" id="8418290">ptrarg</span><span class="op" id="8418296">[</span><span class="num" id="8418297">1</span><span class="op" id="8418298">]</span>&nbsp;<span class="op" id="8418300">=</span>&nbsp;<span class="ident" id="8418302">unsafe</span><span class="op" id="8418308">.</span><span class="ident" id="8418309">Pointer</span><span class="op" id="8418316">(</span><span class="ident" id="8418317">ctx</span><span class="op" id="8418320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418323">mp</span><span class="op" id="8418325">.</span><span class="ident" id="8418326">ptrarg</span><span class="op" id="8418332">[</span><span class="num" id="8418333">2</span><span class="op" id="8418334">]</span>&nbsp;<span class="op" id="8418336">=</span>&nbsp;<span class="ident" id="8418338">unsafe</span><span class="op" id="8418344">.</span><span class="ident" id="8418345">Pointer</span><span class="op" id="8418352">(</span><span class="ident" id="8418353">funcPC</span><span class="op" id="8418359">(</span><span class="ident" id="8418360">body</span><span class="op" id="8418364">)</span><span class="op" id="8418365">)</span>&nbsp;<span class="comment" id="8418367">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;be&nbsp;a&nbsp;scalar.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418402">mp</span><span class="op" id="8418404">.</span><span class="ident" id="8418405">scalararg</span><span class="op" id="8418414">[</span><span class="num" id="8418415">0</span><span class="op" id="8418416">]</span>&nbsp;<span class="op" id="8418418">=</span>&nbsp;<span class="builtintype" id="8418420">uintptr</span><span class="op" id="8418427">(</span><span class="ident" id="8418428">nthr</span><span class="op" id="8418432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418435">mp</span><span class="op" id="8418437">.</span><span class="ident" id="8418438">scalararg</span><span class="op" id="8418447">[</span><span class="num" id="8418448">1</span><span class="op" id="8418449">]</span>&nbsp;<span class="op" id="8418451">=</span>&nbsp;<span class="builtintype" id="8418453">uintptr</span><span class="op" id="8418460">(</span><span class="ident" id="8418461">n</span><span class="op" id="8418462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418465">mp</span><span class="op" id="8418467">.</span><span class="ident" id="8418468">scalararg</span><span class="op" id="8418477">[</span><span class="num" id="8418478">2</span><span class="op" id="8418479">]</span>&nbsp;<span class="op" id="8418481">=</span>&nbsp;<span class="num" id="8418483">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418486">if</span>&nbsp;<span class="ident" id="8418489">wait</span>&nbsp;<span class="op" id="8418494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418498">mp</span><span class="op" id="8418500">.</span><span class="ident" id="8418501">scalararg</span><span class="op" id="8418510">[</span><span class="num" id="8418511">2</span><span class="op" id="8418512">]</span>&nbsp;<span class="op" id="8418514">=</span>&nbsp;<span class="num" id="8418516">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418522">onM</span><span class="op" id="8418525">(</span><span class="ident" id="8418526">parforsetup_m</span><span class="op" id="8418539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418542">releasem</span><span class="op" id="8418550">(</span><span class="ident" id="8418551">mp</span><span class="op" id="8418553">)</span><br>
<span class="lineno"></span><span class="op" id="8418555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8418558">func</span>&nbsp;<span class="ident" id="8418563">ParForDo</span><span class="op" id="8418571">(</span><span class="ident" id="8418572">desc</span>&nbsp;<span class="op" id="8418577">*</span><span class="ident" id="8418578">ParFor</span><span class="op" id="8418584">)</span>&nbsp;<span class="op" id="8418586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418589">mp</span>&nbsp;<span class="op" id="8418592">:=</span>&nbsp;<span class="ident" id="8418595">acquirem</span><span class="op" id="8418603">(</span><span class="op" id="8418604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418607">mp</span><span class="op" id="8418609">.</span><span class="ident" id="8418610">ptrarg</span><span class="op" id="8418616">[</span><span class="num" id="8418617">0</span><span class="op" id="8418618">]</span>&nbsp;<span class="op" id="8418620">=</span>&nbsp;<span class="ident" id="8418622">unsafe</span><span class="op" id="8418628">.</span><span class="ident" id="8418629">Pointer</span><span class="op" id="8418636">(</span><span class="ident" id="8418637">desc</span><span class="op" id="8418641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418644">onM</span><span class="op" id="8418647">(</span><span class="ident" id="8418648">parfordo_m</span><span class="op" id="8418658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418661">releasem</span><span class="op" id="8418669">(</span><span class="ident" id="8418670">mp</span><span class="op" id="8418672">)</span><br>
<span class="lineno">100</span><span class="op" id="8418674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8418677">func</span>&nbsp;<span class="ident" id="8418682">ParForIters</span><span class="op" id="8418693">(</span><span class="ident" id="8418694">desc</span>&nbsp;<span class="op" id="8418699">*</span><span class="ident" id="8418700">ParFor</span><span class="op" id="8418706">,</span>&nbsp;<span class="ident" id="8418708">tid</span>&nbsp;<span class="builtintype" id="8418712">uint32</span><span class="op" id="8418718">)</span>&nbsp;<span class="op" id="8418720">(</span><span class="builtintype" id="8418721">uint32</span><span class="op" id="8418727">,</span>&nbsp;<span class="builtintype" id="8418729">uint32</span><span class="op" id="8418735">)</span>&nbsp;<span class="op" id="8418737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418740">mp</span>&nbsp;<span class="op" id="8418743">:=</span>&nbsp;<span class="ident" id="8418746">acquirem</span><span class="op" id="8418754">(</span><span class="op" id="8418755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418758">mp</span><span class="op" id="8418760">.</span><span class="ident" id="8418761">ptrarg</span><span class="op" id="8418767">[</span><span class="num" id="8418768">0</span><span class="op" id="8418769">]</span>&nbsp;<span class="op" id="8418771">=</span>&nbsp;<span class="ident" id="8418773">unsafe</span><span class="op" id="8418779">.</span><span class="ident" id="8418780">Pointer</span><span class="op" id="8418787">(</span><span class="ident" id="8418788">desc</span><span class="op" id="8418792">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418795">mp</span><span class="op" id="8418797">.</span><span class="ident" id="8418798">scalararg</span><span class="op" id="8418807">[</span><span class="num" id="8418808">0</span><span class="op" id="8418809">]</span>&nbsp;<span class="op" id="8418811">=</span>&nbsp;<span class="builtintype" id="8418813">uintptr</span><span class="op" id="8418820">(</span><span class="ident" id="8418821">tid</span><span class="op" id="8418824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418827">onM</span><span class="op" id="8418830">(</span><span class="ident" id="8418831">parforiters_m</span><span class="op" id="8418844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418847">begin</span>&nbsp;<span class="op" id="8418853">:=</span>&nbsp;<span class="builtintype" id="8418856">uint32</span><span class="op" id="8418862">(</span><span class="ident" id="8418863">mp</span><span class="op" id="8418865">.</span><span class="ident" id="8418866">scalararg</span><span class="op" id="8418875">[</span><span class="num" id="8418876">0</span><span class="op" id="8418877">]</span><span class="op" id="8418878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418881">end</span>&nbsp;<span class="op" id="8418885">:=</span>&nbsp;<span class="builtintype" id="8418888">uint32</span><span class="op" id="8418894">(</span><span class="ident" id="8418895">mp</span><span class="op" id="8418897">.</span><span class="ident" id="8418898">scalararg</span><span class="op" id="8418907">[</span><span class="num" id="8418908">1</span><span class="op" id="8418909">]</span><span class="op" id="8418910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418913">releasem</span><span class="op" id="8418921">(</span><span class="ident" id="8418922">mp</span><span class="op" id="8418924">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418927">return</span>&nbsp;<span class="ident" id="8418934">begin</span><span class="op" id="8418939">,</span>&nbsp;<span class="ident" id="8418941">end</span><br>
<span class="lineno"></span><span class="op" id="8418945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8418948">//&nbsp;in&nbsp;mgc0.c</span><br>
<span class="lineno"></span><span class="comment" id="8418961">//go:noescape</span><br>
<span class="lineno">115</span><span class="keyword" id="8418975">func</span>&nbsp;<span class="ident" id="8418980">getgcmask</span><span class="op" id="8418989">(</span><span class="ident" id="8418990">data</span>&nbsp;<span class="ident" id="8418995">unsafe</span><span class="op" id="8419001">.</span><span class="ident" id="8419002">Pointer</span><span class="op" id="8419009">,</span>&nbsp;<span class="ident" id="8419011">typ</span>&nbsp;<span class="op" id="8419015">*</span><span class="ident" id="8419016">_type</span><span class="op" id="8419021">,</span>&nbsp;<span class="ident" id="8419023">array</span>&nbsp;<span class="op" id="8419029">*</span><span class="op" id="8419030">*</span><span class="builtintype" id="8419031">byte</span><span class="op" id="8419035">,</span>&nbsp;<span class="builtinfunc" id="8419037">len</span>&nbsp;<span class="op" id="8419041">*</span><span class="builtintype" id="8419042">uint</span><span class="op" id="8419046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8419049">func</span>&nbsp;<span class="ident" id="8419054">GCMask</span><span class="op" id="8419060">(</span><span class="ident" id="8419061">x</span>&nbsp;<span class="keyword" id="8419063">interface</span><span class="op" id="8419072">{</span><span class="op" id="8419073">}</span><span class="op" id="8419074">)</span>&nbsp;<span class="op" id="8419076">(</span><span class="ident" id="8419077">ret</span>&nbsp;<span class="op" id="8419081">[</span><span class="op" id="8419082">]</span><span class="builtintype" id="8419083">byte</span><span class="op" id="8419087">)</span>&nbsp;<span class="op" id="8419089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419092">e</span>&nbsp;<span class="op" id="8419094">:=</span>&nbsp;<span class="op" id="8419097">(</span><span class="op" id="8419098">*</span><span class="ident" id="8419099">eface</span><span class="op" id="8419104">)</span><span class="op" id="8419105">(</span><span class="ident" id="8419106">unsafe</span><span class="op" id="8419112">.</span><span class="ident" id="8419113">Pointer</span><span class="op" id="8419120">(</span><span class="op" id="8419121">&amp;</span><span class="ident" id="8419122">x</span><span class="op" id="8419123">)</span><span class="op" id="8419124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419127">s</span>&nbsp;<span class="op" id="8419129">:=</span>&nbsp;<span class="op" id="8419132">(</span><span class="op" id="8419133">*</span><span class="ident" id="8419134">slice</span><span class="op" id="8419139">)</span><span class="op" id="8419140">(</span><span class="ident" id="8419141">unsafe</span><span class="op" id="8419147">.</span><span class="ident" id="8419148">Pointer</span><span class="op" id="8419155">(</span><span class="op" id="8419156">&amp;</span><span class="ident" id="8419157">ret</span><span class="op" id="8419160">)</span><span class="op" id="8419161">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419164">onM</span><span class="op" id="8419167">(</span><span class="keyword" id="8419168">func</span><span class="op" id="8419172">(</span><span class="op" id="8419173">)</span>&nbsp;<span class="op" id="8419175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419179">getgcmask</span><span class="op" id="8419188">(</span><span class="ident" id="8419189">e</span><span class="op" id="8419190">.</span><span class="ident" id="8419191">data</span><span class="op" id="8419195">,</span>&nbsp;<span class="ident" id="8419197">e</span><span class="op" id="8419198">.</span><span class="ident" id="8419199">_type</span><span class="op" id="8419204">,</span>&nbsp;<span class="op" id="8419206">&amp;</span><span class="ident" id="8419207">s</span><span class="op" id="8419208">.</span><span class="ident" id="8419209">array</span><span class="op" id="8419214">,</span>&nbsp;<span class="op" id="8419216">&amp;</span><span class="ident" id="8419217">s</span><span class="op" id="8419218">.</span><span class="builtinfunc" id="8419219">len</span><span class="op" id="8419222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419226">s</span><span class="op" id="8419227">.</span><span class="builtinfunc" id="8419228">cap</span>&nbsp;<span class="op" id="8419232">=</span>&nbsp;<span class="ident" id="8419234">s</span><span class="op" id="8419235">.</span><span class="builtinfunc" id="8419236">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419241">}</span><span class="op" id="8419242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419245">return</span><br>
<span class="lineno">125</span><span class="op" id="8419252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8419255">func</span>&nbsp;<span class="ident" id="8419260">testSchedLocalQueue</span><span class="op" id="8419279">(</span><span class="op" id="8419280">)</span><br>
<span class="lineno"></span><span class="keyword" id="8419282">func</span>&nbsp;<span class="ident" id="8419287">testSchedLocalQueueSteal</span><span class="op" id="8419311">(</span><span class="op" id="8419312">)</span><br>
<span class="lineno"></span><span class="keyword" id="8419314">func</span>&nbsp;<span class="ident" id="8419319">RunSchedLocalQueueTest</span><span class="op" id="8419341">(</span><span class="op" id="8419342">)</span>&nbsp;<span class="op" id="8419344">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419347">onM</span><span class="op" id="8419350">(</span><span class="ident" id="8419351">testSchedLocalQueue</span><span class="op" id="8419370">)</span><br>
<span class="lineno"></span><span class="op" id="8419372">}</span><br>
<span class="lineno"></span><span class="keyword" id="8419374">func</span>&nbsp;<span class="ident" id="8419379">RunSchedLocalQueueStealTest</span><span class="op" id="8419406">(</span><span class="op" id="8419407">)</span>&nbsp;<span class="op" id="8419409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419412">onM</span><span class="op" id="8419415">(</span><span class="ident" id="8419416">testSchedLocalQueueSteal</span><span class="op" id="8419440">)</span><br>
<span class="lineno"></span><span class="op" id="8419442">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8419445">var</span>&nbsp;<span class="ident" id="8419449">HaveGoodHash</span>&nbsp;<span class="op" id="8419462">=</span>&nbsp;<span class="ident" id="8419464">haveGoodHash</span><br>
<span class="lineno"></span><span class="keyword" id="8419477">var</span>&nbsp;<span class="ident" id="8419481">StringHash</span>&nbsp;<span class="op" id="8419492">=</span>&nbsp;<span class="ident" id="8419494">stringHash</span><br>
<span class="lineno"></span><span class="keyword" id="8419505">var</span>&nbsp;<span class="ident" id="8419509">BytesHash</span>&nbsp;<span class="op" id="8419519">=</span>&nbsp;<span class="ident" id="8419521">bytesHash</span><br>
<span class="lineno"></span><span class="keyword" id="8419531">var</span>&nbsp;<span class="ident" id="8419535">Int32Hash</span>&nbsp;<span class="op" id="8419545">=</span>&nbsp;<span class="ident" id="8419547">int32Hash</span><br>
<span class="lineno">140</span><span class="keyword" id="8419557">var</span>&nbsp;<span class="ident" id="8419561">Int64Hash</span>&nbsp;<span class="op" id="8419571">=</span>&nbsp;<span class="ident" id="8419573">int64Hash</span><br>
<span class="lineno"></span><span class="keyword" id="8419583">var</span>&nbsp;<span class="ident" id="8419587">EfaceHash</span>&nbsp;<span class="op" id="8419597">=</span>&nbsp;<span class="ident" id="8419599">efaceHash</span><br>
<span class="lineno"></span><span class="keyword" id="8419609">var</span>&nbsp;<span class="ident" id="8419613">IfaceHash</span>&nbsp;<span class="op" id="8419623">=</span>&nbsp;<span class="ident" id="8419625">ifaceHash</span><br>
<span class="lineno"></span><span class="keyword" id="8419635">var</span>&nbsp;<span class="ident" id="8419639">MemclrBytes</span>&nbsp;<span class="op" id="8419651">=</span>&nbsp;<span class="ident" id="8419653">memclrBytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="8419666">var</span>&nbsp;<span class="ident" id="8419670">HashLoad</span>&nbsp;<span class="op" id="8419679">=</span>&nbsp;<span class="op" id="8419681">&amp;</span><span class="ident" id="8419682">hashLoad</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8419692">//&nbsp;For&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="8419708">func</span>&nbsp;<span class="ident" id="8419713">GogoBytes</span><span class="op" id="8419722">(</span><span class="op" id="8419723">)</span>&nbsp;<span class="builtintype" id="8419725">int32</span>&nbsp;<span class="op" id="8419731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419734">return</span>&nbsp;<span class="ident" id="8419741">_RuntimeGogoBytes</span><br>
<span class="lineno">150</span><span class="op" id="8419759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8419762">//&nbsp;in&nbsp;string.c</span><br>
<span class="lineno"></span><span class="comment" id="8419777">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="8419791">func</span>&nbsp;<span class="ident" id="8419796">gostringw</span><span class="op" id="8419805">(</span><span class="ident" id="8419806">w</span>&nbsp;<span class="op" id="8419808">*</span><span class="builtintype" id="8419809">uint16</span><span class="op" id="8419815">)</span>&nbsp;<span class="builtintype" id="8419817">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="8419825">//&nbsp;entry&nbsp;point&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><span class="keyword" id="8419852">func</span>&nbsp;<span class="ident" id="8419857">GostringW</span><span class="op" id="8419866">(</span><span class="ident" id="8419867">w</span>&nbsp;<span class="op" id="8419869">[</span><span class="op" id="8419870">]</span><span class="builtintype" id="8419871">uint16</span><span class="op" id="8419877">)</span>&nbsp;<span class="op" id="8419879">(</span><span class="ident" id="8419880">s</span>&nbsp;<span class="builtintype" id="8419882">string</span><span class="op" id="8419888">)</span>&nbsp;<span class="op" id="8419890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419893">onM</span><span class="op" id="8419896">(</span><span class="keyword" id="8419897">func</span><span class="op" id="8419901">(</span><span class="op" id="8419902">)</span>&nbsp;<span class="op" id="8419904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419908">s</span>&nbsp;<span class="op" id="8419910">=</span>&nbsp;<span class="ident" id="8419912">gostringw</span><span class="op" id="8419921">(</span><span class="op" id="8419922">&amp;</span><span class="ident" id="8419923">w</span><span class="op" id="8419924">[</span><span class="num" id="8419925">0</span><span class="op" id="8419926">]</span><span class="op" id="8419927">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419930">}</span><span class="op" id="8419931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419934">return</span><br>
<span class="lineno"></span><span class="op" id="8419941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8419944">var</span>&nbsp;<span class="ident" id="8419948">Gostringnocopy</span>&nbsp;<span class="op" id="8419963">=</span>&nbsp;<span class="ident" id="8419965">gostringnocopy</span><br>
<span class="lineno">165</span><span class="keyword" id="8419980">var</span>&nbsp;<span class="ident" id="8419984">Maxstring</span>&nbsp;<span class="op" id="8419994">=</span>&nbsp;<span class="op" id="8419996">&amp;</span><span class="ident" id="8419997">maxstring</span>
</div>
</body>
</html>
