<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html" class="current">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="151330">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="151386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="151440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="151491">package</span>&nbsp;<span class="ident" id="151499">rand_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="151510">import</span>&nbsp;<span class="op" id="151517">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="151520">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="151535">&#34;math/big&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="151547">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="151557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="151560">//&nbsp;http://golang.org/issue/6849.</span><br>
<span class="lineno"></span><span class="keyword" id="151593">func</span>&nbsp;<span class="ident" id="151598">TestPrimeSmall</span><span class="op" id="151612">(</span><span class="ident" id="151613">t</span>&nbsp;<span class="op" id="151615">*</span><span class="ident" id="151616">testing</span><span class="op" id="151623">.</span><span class="ident" id="151624">T</span><span class="op" id="151625">)</span>&nbsp;<span class="op" id="151627">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="151630">for</span>&nbsp;<span class="ident" id="151634">n</span>&nbsp;<span class="op" id="151636">:=</span>&nbsp;<span class="num" id="151639">2</span><span class="op" id="151640">;</span>&nbsp;<span class="ident" id="151642">n</span>&nbsp;<span class="op" id="151644">&lt;</span>&nbsp;<span class="num" id="151646">10</span><span class="op" id="151648">;</span>&nbsp;<span class="ident" id="151650">n</span><span class="op" id="151651">++</span>&nbsp;<span class="op" id="151654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="151658">p</span><span class="op" id="151659">,</span>&nbsp;<span class="ident" id="151661">err</span>&nbsp;<span class="op" id="151665">:=</span>&nbsp;<span class="ident" id="151668">rand</span><span class="op" id="151672">.</span><span class="ident" id="151673">Prime</span><span class="op" id="151678">(</span><span class="ident" id="151679">rand</span><span class="op" id="151683">.</span><span class="ident" id="151684">Reader</span><span class="op" id="151690">,</span>&nbsp;<span class="ident" id="151692">n</span><span class="op" id="151693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="151697">if</span>&nbsp;<span class="ident" id="151700">err</span>&nbsp;<span class="op" id="151704">!=</span>&nbsp;<span class="builtintype" id="151707">nil</span>&nbsp;<span class="op" id="151711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="151716">t</span><span class="op" id="151717">.</span><span class="ident" id="151718">Fatalf</span><span class="op" id="151724">(</span><span class="string" id="151725">&#34;Can&#39;t&nbsp;generate&nbsp;%d-bit&nbsp;prime:&nbsp;%v&#34;</span><span class="op" id="151758">,</span>&nbsp;<span class="ident" id="151760">n</span><span class="op" id="151761">,</span>&nbsp;<span class="ident" id="151763">err</span><span class="op" id="151766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="151770">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="151774">if</span>&nbsp;<span class="ident" id="151777">p</span><span class="op" id="151778">.</span><span class="ident" id="151779">BitLen</span><span class="op" id="151785">(</span><span class="op" id="151786">)</span>&nbsp;<span class="op" id="151788">!=</span>&nbsp;<span class="ident" id="151791">n</span>&nbsp;<span class="op" id="151793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="151798">t</span><span class="op" id="151799">.</span><span class="ident" id="151800">Fatalf</span><span class="op" id="151806">(</span><span class="string" id="151807">&#34;%v&nbsp;is&nbsp;not&nbsp;%d-bit&#34;</span><span class="op" id="151825">,</span>&nbsp;<span class="ident" id="151827">p</span><span class="op" id="151828">,</span>&nbsp;<span class="ident" id="151830">n</span><span class="op" id="151831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="151835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="151839">if</span>&nbsp;<span class="op" id="151842">!</span><span class="ident" id="151843">p</span><span class="op" id="151844">.</span><span class="ident" id="151845">ProbablyPrime</span><span class="op" id="151858">(</span><span class="num" id="151859">32</span><span class="op" id="151861">)</span>&nbsp;<span class="op" id="151863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="151868">t</span><span class="op" id="151869">.</span><span class="ident" id="151870">Fatalf</span><span class="op" id="151876">(</span><span class="string" id="151877">&#34;%v&nbsp;is&nbsp;not&nbsp;prime&#34;</span><span class="op" id="151894">,</span>&nbsp;<span class="ident" id="151896">p</span><span class="op" id="151897">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="151901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="151904">}</span><br>
<span class="lineno"></span><span class="op" id="151906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="151909">//&nbsp;Test&nbsp;that&nbsp;passing&nbsp;bits&nbsp;&lt;&nbsp;2&nbsp;causes&nbsp;Prime&nbsp;to&nbsp;return&nbsp;nil,&nbsp;error</span><br>
<span class="lineno">30</span><span class="keyword" id="151973">func</span>&nbsp;<span class="ident" id="151978">TestPrimeBitsLt2</span><span class="op" id="151994">(</span><span class="ident" id="151995">t</span>&nbsp;<span class="op" id="151997">*</span><span class="ident" id="151998">testing</span><span class="op" id="152005">.</span><span class="ident" id="152006">T</span><span class="op" id="152007">)</span>&nbsp;<span class="op" id="152009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="152012">if</span>&nbsp;<span class="ident" id="152015">p</span><span class="op" id="152016">,</span>&nbsp;<span class="ident" id="152018">err</span>&nbsp;<span class="op" id="152022">:=</span>&nbsp;<span class="ident" id="152025">rand</span><span class="op" id="152029">.</span><span class="ident" id="152030">Prime</span><span class="op" id="152035">(</span><span class="ident" id="152036">rand</span><span class="op" id="152040">.</span><span class="ident" id="152041">Reader</span><span class="op" id="152047">,</span>&nbsp;<span class="num" id="152049">1</span><span class="op" id="152050">)</span><span class="op" id="152051">;</span>&nbsp;<span class="ident" id="152053">p</span>&nbsp;<span class="op" id="152055">!=</span>&nbsp;<span class="builtintype" id="152058">nil</span>&nbsp;<span class="op" id="152062">||</span>&nbsp;<span class="ident" id="152065">err</span>&nbsp;<span class="op" id="152069">==</span>&nbsp;<span class="builtintype" id="152072">nil</span>&nbsp;<span class="op" id="152076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152080">t</span><span class="op" id="152081">.</span><span class="ident" id="152082">Errorf</span><span class="op" id="152088">(</span><span class="string" id="152089">&#34;Prime&nbsp;should&nbsp;return&nbsp;nil,&nbsp;error&nbsp;when&nbsp;called&nbsp;with&nbsp;bits&nbsp;&lt;&nbsp;2&#34;</span><span class="op" id="152147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="152150">}</span><br>
<span class="lineno"></span><span class="op" id="152152">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="152155">func</span>&nbsp;<span class="ident" id="152160">TestInt</span><span class="op" id="152167">(</span><span class="ident" id="152168">t</span>&nbsp;<span class="op" id="152170">*</span><span class="ident" id="152171">testing</span><span class="op" id="152178">.</span><span class="ident" id="152179">T</span><span class="op" id="152180">)</span>&nbsp;<span class="op" id="152182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="152185">//&nbsp;start&nbsp;at&nbsp;128&nbsp;so&nbsp;the&nbsp;case&nbsp;of&nbsp;(max.BitLen()&nbsp;%&nbsp;8)&nbsp;==&nbsp;0&nbsp;is&nbsp;covered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="152252">for</span>&nbsp;<span class="ident" id="152256">n</span>&nbsp;<span class="op" id="152258">:=</span>&nbsp;<span class="num" id="152261">128</span><span class="op" id="152264">;</span>&nbsp;<span class="ident" id="152266">n</span>&nbsp;<span class="op" id="152268">&lt;</span>&nbsp;<span class="num" id="152270">140</span><span class="op" id="152273">;</span>&nbsp;<span class="ident" id="152275">n</span><span class="op" id="152276">++</span>&nbsp;<span class="op" id="152279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152283">b</span>&nbsp;<span class="op" id="152285">:=</span>&nbsp;<span class="builtinfunc" id="152288">new</span><span class="op" id="152291">(</span><span class="ident" id="152292">big</span><span class="op" id="152295">.</span><span class="ident" id="152296">Int</span><span class="op" id="152299">)</span><span class="op" id="152300">.</span><span class="ident" id="152301">SetInt64</span><span class="op" id="152309">(</span><span class="ident" id="152310">int64</span><span class="op" id="152315">(</span><span class="ident" id="152316">n</span><span class="op" id="152317">)</span><span class="op" id="152318">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="152322">if</span>&nbsp;<span class="ident" id="152325">i</span><span class="op" id="152326">,</span>&nbsp;<span class="ident" id="152328">err</span>&nbsp;<span class="op" id="152332">:=</span>&nbsp;<span class="ident" id="152335">rand</span><span class="op" id="152339">.</span><span class="ident" id="152340">Int</span><span class="op" id="152343">(</span><span class="ident" id="152344">rand</span><span class="op" id="152348">.</span><span class="ident" id="152349">Reader</span><span class="op" id="152355">,</span>&nbsp;<span class="ident" id="152357">b</span><span class="op" id="152358">)</span><span class="op" id="152359">;</span>&nbsp;<span class="ident" id="152361">err</span>&nbsp;<span class="op" id="152365">!=</span>&nbsp;<span class="builtintype" id="152368">nil</span>&nbsp;<span class="op" id="152372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152377">t</span><span class="op" id="152378">.</span><span class="ident" id="152379">Fatalf</span><span class="op" id="152385">(</span><span class="string" id="152386">&#34;Can&#39;t&nbsp;generate&nbsp;random&nbsp;value:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="152423">,</span>&nbsp;<span class="ident" id="152425">i</span><span class="op" id="152426">,</span>&nbsp;<span class="ident" id="152428">err</span><span class="op" id="152431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="152435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="152438">}</span><br>
<span class="lineno"></span><span class="op" id="152440">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="152443">func</span>&nbsp;<span class="ident" id="152448">testIntPanics</span><span class="op" id="152461">(</span><span class="ident" id="152462">t</span>&nbsp;<span class="op" id="152464">*</span><span class="ident" id="152465">testing</span><span class="op" id="152472">.</span><span class="ident" id="152473">T</span><span class="op" id="152474">,</span>&nbsp;<span class="ident" id="152476">b</span>&nbsp;<span class="op" id="152478">*</span><span class="ident" id="152479">big</span><span class="op" id="152482">.</span><span class="ident" id="152483">Int</span><span class="op" id="152486">)</span>&nbsp;<span class="op" id="152488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="152491">defer</span>&nbsp;<span class="keyword" id="152497">func</span><span class="op" id="152501">(</span><span class="op" id="152502">)</span>&nbsp;<span class="op" id="152504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="152508">if</span>&nbsp;<span class="ident" id="152511">err</span>&nbsp;<span class="op" id="152515">:=</span>&nbsp;<span class="builtinfunc" id="152518">recover</span><span class="op" id="152525">(</span><span class="op" id="152526">)</span><span class="op" id="152527">;</span>&nbsp;<span class="ident" id="152529">err</span>&nbsp;<span class="op" id="152533">==</span>&nbsp;<span class="builtintype" id="152536">nil</span>&nbsp;<span class="op" id="152540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152545">t</span><span class="op" id="152546">.</span><span class="ident" id="152547">Errorf</span><span class="op" id="152553">(</span><span class="string" id="152554">&#34;Int&nbsp;should&nbsp;panic&nbsp;when&nbsp;called&nbsp;with&nbsp;max&nbsp;&lt;=&nbsp;0:&nbsp;%v&#34;</span><span class="op" id="152602">,</span>&nbsp;<span class="ident" id="152604">b</span><span class="op" id="152605">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="152609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="152612">}</span><span class="op" id="152613">(</span><span class="op" id="152614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152617">rand</span><span class="op" id="152621">.</span><span class="ident" id="152622">Int</span><span class="op" id="152625">(</span><span class="ident" id="152626">rand</span><span class="op" id="152630">.</span><span class="ident" id="152631">Reader</span><span class="op" id="152637">,</span>&nbsp;<span class="ident" id="152639">b</span><span class="op" id="152640">)</span><br>
<span class="lineno"></span><span class="op" id="152642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="152645">//&nbsp;Test&nbsp;that&nbsp;passing&nbsp;a&nbsp;new&nbsp;big.Int&nbsp;as&nbsp;max&nbsp;causes&nbsp;Int&nbsp;to&nbsp;panic</span><br>
<span class="lineno"></span><span class="keyword" id="152707">func</span>&nbsp;<span class="ident" id="152712">TestIntEmptyMaxPanics</span><span class="op" id="152733">(</span><span class="ident" id="152734">t</span>&nbsp;<span class="op" id="152736">*</span><span class="ident" id="152737">testing</span><span class="op" id="152744">.</span><span class="ident" id="152745">T</span><span class="op" id="152746">)</span>&nbsp;<span class="op" id="152748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152751">b</span>&nbsp;<span class="op" id="152753">:=</span>&nbsp;<span class="builtinfunc" id="152756">new</span><span class="op" id="152759">(</span><span class="ident" id="152760">big</span><span class="op" id="152763">.</span><span class="ident" id="152764">Int</span><span class="op" id="152767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152770">testIntPanics</span><span class="op" id="152783">(</span><span class="ident" id="152784">t</span><span class="op" id="152785">,</span>&nbsp;<span class="ident" id="152787">b</span><span class="op" id="152788">)</span><br>
<span class="lineno"></span><span class="op" id="152790">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="152793">//&nbsp;Test&nbsp;that&nbsp;passing&nbsp;a&nbsp;negative&nbsp;value&nbsp;as&nbsp;max&nbsp;causes&nbsp;Int&nbsp;to&nbsp;panic</span><br>
<span class="lineno"></span><span class="keyword" id="152858">func</span>&nbsp;<span class="ident" id="152863">TestIntNegativeMaxPanics</span><span class="op" id="152887">(</span><span class="ident" id="152888">t</span>&nbsp;<span class="op" id="152890">*</span><span class="ident" id="152891">testing</span><span class="op" id="152898">.</span><span class="ident" id="152899">T</span><span class="op" id="152900">)</span>&nbsp;<span class="op" id="152902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152905">b</span>&nbsp;<span class="op" id="152907">:=</span>&nbsp;<span class="builtinfunc" id="152910">new</span><span class="op" id="152913">(</span><span class="ident" id="152914">big</span><span class="op" id="152917">.</span><span class="ident" id="152918">Int</span><span class="op" id="152921">)</span><span class="op" id="152922">.</span><span class="ident" id="152923">SetInt64</span><span class="op" id="152931">(</span><span class="ident" id="152932">int64</span><span class="op" id="152937">(</span><span class="op" id="152938">-</span><span class="num" id="152939">1</span><span class="op" id="152940">)</span><span class="op" id="152941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="152944">testIntPanics</span><span class="op" id="152957">(</span><span class="ident" id="152958">t</span><span class="op" id="152959">,</span>&nbsp;<span class="ident" id="152961">b</span><span class="op" id="152962">)</span><br>
<span class="lineno">65</span><span class="op" id="152964">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
