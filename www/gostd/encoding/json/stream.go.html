<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4831454">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4831510">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4831564">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4831615">package</span>&nbsp;<span class="ident" id="4831623">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4831629">import</span>&nbsp;<span class="op" id="4831636">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4831639">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4831648">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4831658">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4831663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831666">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4831732">type</span>&nbsp;<span class="ident" id="4831737">Decoder</span>&nbsp;<span class="keyword" id="4831745">struct</span>&nbsp;<span class="op" id="4831752">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831755">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831760">io</span><span class="op" id="4831762">.</span><span class="ident" id="4831763">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831771">buf</span>&nbsp;&nbsp;<span class="op" id="4831776">[</span><span class="op" id="4831777">]</span><span class="builtintype" id="4831778">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831784">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831789">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831802">scan</span>&nbsp;<span class="ident" id="4831807">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831816">err</span>&nbsp;&nbsp;<span class="builtintype" id="4831821">error</span><br>
<span class="lineno">20</span><span class="op" id="4831827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831830">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4831885">//</span><br>
<span class="lineno"></span><span class="comment" id="4831888">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="4831940">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="4831994">func</span>&nbsp;<span class="ident" id="4831999">NewDecoder</span><span class="op" id="4832009">(</span><span class="ident" id="4832010">r</span>&nbsp;<span class="ident" id="4832012">io</span><span class="op" id="4832014">.</span><span class="ident" id="4832015">Reader</span><span class="op" id="4832021">)</span>&nbsp;<span class="op" id="4832023">*</span><span class="ident" id="4832024">Decoder</span>&nbsp;<span class="op" id="4832032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832035">return</span>&nbsp;<span class="op" id="4832042">&amp;</span><span class="ident" id="4832043">Decoder</span><span class="op" id="4832050">{</span><span class="ident" id="4832051">r</span><span class="op" id="4832052">:</span>&nbsp;<span class="ident" id="4832054">r</span><span class="op" id="4832055">}</span><br>
<span class="lineno"></span><span class="op" id="4832057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4832060">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4832139">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="4832174">func</span>&nbsp;<span class="op" id="4832179">(</span><span class="ident" id="4832180">dec</span>&nbsp;<span class="op" id="4832184">*</span><span class="ident" id="4832185">Decoder</span><span class="op" id="4832192">)</span>&nbsp;<span class="ident" id="4832194">UseNumber</span><span class="op" id="4832203">(</span><span class="op" id="4832204">)</span>&nbsp;<span class="op" id="4832206">{</span>&nbsp;<span class="ident" id="4832208">dec</span><span class="op" id="4832211">.</span><span class="ident" id="4832212">d</span><span class="op" id="4832213">.</span><span class="ident" id="4832214">useNumber</span>&nbsp;<span class="op" id="4832224">=</span>&nbsp;<span class="builtintype" id="4832226">true</span>&nbsp;<span class="op" id="4832231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4832234">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="4832287">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4832340">//</span><br>
<span class="lineno"></span><span class="comment" id="4832343">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="4832400">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4832443">func</span>&nbsp;<span class="op" id="4832448">(</span><span class="ident" id="4832449">dec</span>&nbsp;<span class="op" id="4832453">*</span><span class="ident" id="4832454">Decoder</span><span class="op" id="4832461">)</span>&nbsp;<span class="ident" id="4832463">Decode</span><span class="op" id="4832469">(</span><span class="ident" id="4832470">v</span>&nbsp;<span class="keyword" id="4832472">interface</span><span class="op" id="4832481">{</span><span class="op" id="4832482">}</span><span class="op" id="4832483">)</span>&nbsp;<span class="builtintype" id="4832485">error</span>&nbsp;<span class="op" id="4832491">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832494">if</span>&nbsp;<span class="ident" id="4832497">dec</span><span class="op" id="4832500">.</span><span class="ident" id="4832501">err</span>&nbsp;<span class="op" id="4832505">!=</span>&nbsp;<span class="ident" id="4832508">nil</span>&nbsp;<span class="op" id="4832512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832516">return</span>&nbsp;<span class="ident" id="4832523">dec</span><span class="op" id="4832526">.</span><span class="ident" id="4832527">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832536">n</span><span class="op" id="4832537">,</span>&nbsp;<span class="ident" id="4832539">err</span>&nbsp;<span class="op" id="4832543">:=</span>&nbsp;<span class="ident" id="4832546">dec</span><span class="op" id="4832549">.</span><span class="ident" id="4832550">readValue</span><span class="op" id="4832559">(</span><span class="op" id="4832560">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832563">if</span>&nbsp;<span class="ident" id="4832566">err</span>&nbsp;<span class="op" id="4832570">!=</span>&nbsp;<span class="ident" id="4832573">nil</span>&nbsp;<span class="op" id="4832577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832581">return</span>&nbsp;<span class="ident" id="4832588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832597">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832645">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832710">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832756">dec</span><span class="op" id="4832759">.</span><span class="ident" id="4832760">d</span><span class="op" id="4832761">.</span><span class="ident" id="4832762">init</span><span class="op" id="4832766">(</span><span class="ident" id="4832767">dec</span><span class="op" id="4832770">.</span><span class="ident" id="4832771">buf</span><span class="op" id="4832774">[</span><span class="num" id="4832775">0</span><span class="op" id="4832776">:</span><span class="ident" id="4832777">n</span><span class="op" id="4832778">]</span><span class="op" id="4832779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832782">err</span>&nbsp;<span class="op" id="4832786">=</span>&nbsp;<span class="ident" id="4832788">dec</span><span class="op" id="4832791">.</span><span class="ident" id="4832792">d</span><span class="op" id="4832793">.</span><span class="ident" id="4832794">unmarshal</span><span class="op" id="4832803">(</span><span class="ident" id="4832804">v</span><span class="op" id="4832805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4832809">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832838">rest</span>&nbsp;<span class="op" id="4832843">:=</span>&nbsp;<span class="builtinfunc" id="4832846">copy</span><span class="op" id="4832850">(</span><span class="ident" id="4832851">dec</span><span class="op" id="4832854">.</span><span class="ident" id="4832855">buf</span><span class="op" id="4832858">,</span>&nbsp;<span class="ident" id="4832860">dec</span><span class="op" id="4832863">.</span><span class="ident" id="4832864">buf</span><span class="op" id="4832867">[</span><span class="ident" id="4832868">n</span><span class="op" id="4832869">:</span><span class="op" id="4832870">]</span><span class="op" id="4832871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832874">dec</span><span class="op" id="4832877">.</span><span class="ident" id="4832878">buf</span>&nbsp;<span class="op" id="4832882">=</span>&nbsp;<span class="ident" id="4832884">dec</span><span class="op" id="4832887">.</span><span class="ident" id="4832888">buf</span><span class="op" id="4832891">[</span><span class="num" id="4832892">0</span><span class="op" id="4832893">:</span><span class="ident" id="4832894">rest</span><span class="op" id="4832898">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832902">return</span>&nbsp;<span class="ident" id="4832909">err</span><br>
<span class="lineno">60</span><span class="op" id="4832913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4832916">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4832984">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="4833046">func</span>&nbsp;<span class="op" id="4833051">(</span><span class="ident" id="4833052">dec</span>&nbsp;<span class="op" id="4833056">*</span><span class="ident" id="4833057">Decoder</span><span class="op" id="4833064">)</span>&nbsp;<span class="ident" id="4833066">Buffered</span><span class="op" id="4833074">(</span><span class="op" id="4833075">)</span>&nbsp;<span class="ident" id="4833077">io</span><span class="op" id="4833079">.</span><span class="ident" id="4833080">Reader</span>&nbsp;<span class="op" id="4833087">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833090">return</span>&nbsp;<span class="ident" id="4833097">bytes</span><span class="op" id="4833102">.</span><span class="ident" id="4833103">NewReader</span><span class="op" id="4833112">(</span><span class="ident" id="4833113">dec</span><span class="op" id="4833116">.</span><span class="ident" id="4833117">buf</span><span class="op" id="4833120">)</span><br>
<span class="lineno"></span><span class="op" id="4833122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4833125">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="4833171">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="4833213">func</span>&nbsp;<span class="op" id="4833218">(</span><span class="ident" id="4833219">dec</span>&nbsp;<span class="op" id="4833223">*</span><span class="ident" id="4833224">Decoder</span><span class="op" id="4833231">)</span>&nbsp;<span class="ident" id="4833233">readValue</span><span class="op" id="4833242">(</span><span class="op" id="4833243">)</span>&nbsp;<span class="op" id="4833245">(</span><span class="builtintype" id="4833246">int</span><span class="op" id="4833249">,</span>&nbsp;<span class="builtintype" id="4833251">error</span><span class="op" id="4833256">)</span>&nbsp;<span class="op" id="4833258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833261">dec</span><span class="op" id="4833264">.</span><span class="ident" id="4833265">scan</span><span class="op" id="4833269">.</span><span class="ident" id="4833270">reset</span><span class="op" id="4833275">(</span><span class="op" id="4833276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833280">scanp</span>&nbsp;<span class="op" id="4833286">:=</span>&nbsp;<span class="num" id="4833289">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833292">var</span>&nbsp;<span class="ident" id="4833296">err</span>&nbsp;<span class="builtintype" id="4833300">error</span><br>
<span class="lineno">75</span><span class="ident" id="4833306">Input</span><span class="op" id="4833311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833314">for</span>&nbsp;<span class="op" id="4833318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833322">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833363">for</span>&nbsp;<span class="ident" id="4833367">i</span><span class="op" id="4833368">,</span>&nbsp;<span class="ident" id="4833370">c</span>&nbsp;<span class="op" id="4833372">:=</span>&nbsp;<span class="keyword" id="4833375">range</span>&nbsp;<span class="ident" id="4833381">dec</span><span class="op" id="4833384">.</span><span class="ident" id="4833385">buf</span><span class="op" id="4833388">[</span><span class="ident" id="4833389">scanp</span><span class="op" id="4833394">:</span><span class="op" id="4833395">]</span>&nbsp;<span class="op" id="4833397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833402">dec</span><span class="op" id="4833405">.</span><span class="ident" id="4833406">scan</span><span class="op" id="4833410">.</span><span class="ident" id="4833411">bytes</span><span class="op" id="4833416">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833422">v</span>&nbsp;<span class="op" id="4833424">:=</span>&nbsp;<span class="ident" id="4833427">dec</span><span class="op" id="4833430">.</span><span class="ident" id="4833431">scan</span><span class="op" id="4833435">.</span><span class="ident" id="4833436">step</span><span class="op" id="4833440">(</span><span class="op" id="4833441">&amp;</span><span class="ident" id="4833442">dec</span><span class="op" id="4833445">.</span><span class="ident" id="4833446">scan</span><span class="op" id="4833450">,</span>&nbsp;<span class="builtintype" id="4833452">int</span><span class="op" id="4833455">(</span><span class="ident" id="4833456">c</span><span class="op" id="4833457">)</span><span class="op" id="4833458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833463">if</span>&nbsp;<span class="ident" id="4833466">v</span>&nbsp;<span class="op" id="4833468">==</span>&nbsp;<span class="ident" id="4833471">scanEnd</span>&nbsp;<span class="op" id="4833479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833485">scanp</span>&nbsp;<span class="op" id="4833491">+=</span>&nbsp;<span class="ident" id="4833494">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833500">break</span>&nbsp;<span class="ident" id="4833506">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833515">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833520">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833555">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833610">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833648">if</span>&nbsp;<span class="op" id="4833651">(</span><span class="ident" id="4833652">v</span>&nbsp;<span class="op" id="4833654">==</span>&nbsp;<span class="ident" id="4833657">scanEndObject</span>&nbsp;<span class="op" id="4833671">||</span>&nbsp;<span class="ident" id="4833674">v</span>&nbsp;<span class="op" id="4833676">==</span>&nbsp;<span class="ident" id="4833679">scanEndArray</span><span class="op" id="4833691">)</span>&nbsp;<span class="op" id="4833693">&amp;&amp;</span>&nbsp;<span class="ident" id="4833696">dec</span><span class="op" id="4833699">.</span><span class="ident" id="4833700">scan</span><span class="op" id="4833704">.</span><span class="ident" id="4833705">step</span><span class="op" id="4833709">(</span><span class="op" id="4833710">&amp;</span><span class="ident" id="4833711">dec</span><span class="op" id="4833714">.</span><span class="ident" id="4833715">scan</span><span class="op" id="4833719">,</span>&nbsp;<span class="string" id="4833721">&#39;&nbsp;&#39;</span><span class="op" id="4833724">)</span>&nbsp;<span class="op" id="4833726">==</span>&nbsp;<span class="ident" id="4833729">scanEnd</span>&nbsp;<span class="op" id="4833737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833743">scanp</span>&nbsp;<span class="op" id="4833749">+=</span>&nbsp;<span class="ident" id="4833752">i</span>&nbsp;<span class="op" id="4833754">+</span>&nbsp;<span class="num" id="4833756">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833762">break</span>&nbsp;<span class="ident" id="4833768">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833782">if</span>&nbsp;<span class="ident" id="4833785">v</span>&nbsp;<span class="op" id="4833787">==</span>&nbsp;<span class="ident" id="4833790">scanError</span>&nbsp;<span class="op" id="4833800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833806">dec</span><span class="op" id="4833809">.</span><span class="ident" id="4833810">err</span>&nbsp;<span class="op" id="4833814">=</span>&nbsp;<span class="ident" id="4833816">dec</span><span class="op" id="4833819">.</span><span class="ident" id="4833820">scan</span><span class="op" id="4833824">.</span><span class="ident" id="4833825">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833833">return</span>&nbsp;<span class="num" id="4833840">0</span><span class="op" id="4833841">,</span>&nbsp;<span class="ident" id="4833843">dec</span><span class="op" id="4833846">.</span><span class="ident" id="4833847">scan</span><span class="op" id="4833851">.</span><span class="ident" id="4833852">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4833863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833867">scanp</span>&nbsp;<span class="op" id="4833873">=</span>&nbsp;<span class="builtinfunc" id="4833875">len</span><span class="op" id="4833878">(</span><span class="ident" id="4833879">dec</span><span class="op" id="4833882">.</span><span class="ident" id="4833883">buf</span><span class="op" id="4833886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833891">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4833929">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833974">if</span>&nbsp;<span class="ident" id="4833977">err</span>&nbsp;<span class="op" id="4833981">!=</span>&nbsp;<span class="ident" id="4833984">nil</span>&nbsp;<span class="op" id="4833988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833993">if</span>&nbsp;<span class="ident" id="4833996">err</span>&nbsp;<span class="op" id="4834000">==</span>&nbsp;<span class="ident" id="4834003">io</span><span class="op" id="4834005">.</span><span class="ident" id="4834006">EOF</span>&nbsp;<span class="op" id="4834010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834016">if</span>&nbsp;<span class="ident" id="4834019">dec</span><span class="op" id="4834022">.</span><span class="ident" id="4834023">scan</span><span class="op" id="4834027">.</span><span class="ident" id="4834028">step</span><span class="op" id="4834032">(</span><span class="op" id="4834033">&amp;</span><span class="ident" id="4834034">dec</span><span class="op" id="4834037">.</span><span class="ident" id="4834038">scan</span><span class="op" id="4834042">,</span>&nbsp;<span class="string" id="4834044">&#39;&nbsp;&#39;</span><span class="op" id="4834047">)</span>&nbsp;<span class="op" id="4834049">==</span>&nbsp;<span class="ident" id="4834052">scanEnd</span>&nbsp;<span class="op" id="4834060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834067">break</span>&nbsp;<span class="ident" id="4834073">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834089">if</span>&nbsp;<span class="ident" id="4834092">nonSpace</span><span class="op" id="4834100">(</span><span class="ident" id="4834101">dec</span><span class="op" id="4834104">.</span><span class="ident" id="4834105">buf</span><span class="op" id="4834108">)</span>&nbsp;<span class="op" id="4834110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834117">err</span>&nbsp;<span class="op" id="4834121">=</span>&nbsp;<span class="ident" id="4834123">io</span><span class="op" id="4834125">.</span><span class="ident" id="4834126">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834152">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834157">dec</span><span class="op" id="4834160">.</span><span class="ident" id="4834161">err</span>&nbsp;<span class="op" id="4834165">=</span>&nbsp;<span class="ident" id="4834167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834174">return</span>&nbsp;<span class="num" id="4834181">0</span><span class="op" id="4834182">,</span>&nbsp;<span class="ident" id="4834184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4834195">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834240">const</span>&nbsp;<span class="ident" id="4834246">minRead</span>&nbsp;<span class="op" id="4834254">=</span>&nbsp;<span class="num" id="4834256">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834262">if</span>&nbsp;<span class="builtinfunc" id="4834265">cap</span><span class="op" id="4834268">(</span><span class="ident" id="4834269">dec</span><span class="op" id="4834272">.</span><span class="ident" id="4834273">buf</span><span class="op" id="4834276">)</span><span class="op" id="4834277">-</span><span class="builtinfunc" id="4834278">len</span><span class="op" id="4834281">(</span><span class="ident" id="4834282">dec</span><span class="op" id="4834285">.</span><span class="ident" id="4834286">buf</span><span class="op" id="4834289">)</span>&nbsp;<span class="op" id="4834291">&lt;</span>&nbsp;<span class="ident" id="4834293">minRead</span>&nbsp;<span class="op" id="4834301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834306">newBuf</span>&nbsp;<span class="op" id="4834313">:=</span>&nbsp;<span class="builtinfunc" id="4834316">make</span><span class="op" id="4834320">(</span><span class="op" id="4834321">[</span><span class="op" id="4834322">]</span><span class="builtintype" id="4834323">byte</span><span class="op" id="4834327">,</span>&nbsp;<span class="builtinfunc" id="4834329">len</span><span class="op" id="4834332">(</span><span class="ident" id="4834333">dec</span><span class="op" id="4834336">.</span><span class="ident" id="4834337">buf</span><span class="op" id="4834340">)</span><span class="op" id="4834341">,</span>&nbsp;<span class="num" id="4834343">2</span><span class="op" id="4834344">*</span><span class="builtinfunc" id="4834345">cap</span><span class="op" id="4834348">(</span><span class="ident" id="4834349">dec</span><span class="op" id="4834352">.</span><span class="ident" id="4834353">buf</span><span class="op" id="4834356">)</span><span class="op" id="4834357">+</span><span class="ident" id="4834358">minRead</span><span class="op" id="4834365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4834370">copy</span><span class="op" id="4834374">(</span><span class="ident" id="4834375">newBuf</span><span class="op" id="4834381">,</span>&nbsp;<span class="ident" id="4834383">dec</span><span class="op" id="4834386">.</span><span class="ident" id="4834387">buf</span><span class="op" id="4834390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834395">dec</span><span class="op" id="4834398">.</span><span class="ident" id="4834399">buf</span>&nbsp;<span class="op" id="4834403">=</span>&nbsp;<span class="ident" id="4834405">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4834419">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834476">var</span>&nbsp;<span class="ident" id="4834480">n</span>&nbsp;<span class="builtintype" id="4834482">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834488">n</span><span class="op" id="4834489">,</span>&nbsp;<span class="ident" id="4834491">err</span>&nbsp;<span class="op" id="4834495">=</span>&nbsp;<span class="ident" id="4834497">dec</span><span class="op" id="4834500">.</span><span class="ident" id="4834501">r</span><span class="op" id="4834502">.</span><span class="ident" id="4834503">Read</span><span class="op" id="4834507">(</span><span class="ident" id="4834508">dec</span><span class="op" id="4834511">.</span><span class="ident" id="4834512">buf</span><span class="op" id="4834515">[</span><span class="builtinfunc" id="4834516">len</span><span class="op" id="4834519">(</span><span class="ident" id="4834520">dec</span><span class="op" id="4834523">.</span><span class="ident" id="4834524">buf</span><span class="op" id="4834527">)</span><span class="op" id="4834528">:</span><span class="builtinfunc" id="4834529">cap</span><span class="op" id="4834532">(</span><span class="ident" id="4834533">dec</span><span class="op" id="4834536">.</span><span class="ident" id="4834537">buf</span><span class="op" id="4834540">)</span><span class="op" id="4834541">]</span><span class="op" id="4834542">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834546">dec</span><span class="op" id="4834549">.</span><span class="ident" id="4834550">buf</span>&nbsp;<span class="op" id="4834554">=</span>&nbsp;<span class="ident" id="4834556">dec</span><span class="op" id="4834559">.</span><span class="ident" id="4834560">buf</span><span class="op" id="4834563">[</span><span class="num" id="4834564">0</span>&nbsp;<span class="op" id="4834566">:</span>&nbsp;<span class="builtinfunc" id="4834568">len</span><span class="op" id="4834571">(</span><span class="ident" id="4834572">dec</span><span class="op" id="4834575">.</span><span class="ident" id="4834576">buf</span><span class="op" id="4834579">)</span><span class="op" id="4834580">+</span><span class="ident" id="4834581">n</span><span class="op" id="4834582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834588">return</span>&nbsp;<span class="ident" id="4834595">scanp</span><span class="op" id="4834600">,</span>&nbsp;<span class="ident" id="4834602">nil</span><br>
<span class="lineno"></span><span class="op" id="4834606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4834609">func</span>&nbsp;<span class="ident" id="4834614">nonSpace</span><span class="op" id="4834622">(</span><span class="ident" id="4834623">b</span>&nbsp;<span class="op" id="4834625">[</span><span class="op" id="4834626">]</span><span class="builtintype" id="4834627">byte</span><span class="op" id="4834631">)</span>&nbsp;<span class="builtintype" id="4834633">bool</span>&nbsp;<span class="op" id="4834638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834641">for</span>&nbsp;<span class="ident" id="4834645">_</span><span class="op" id="4834646">,</span>&nbsp;<span class="ident" id="4834648">c</span>&nbsp;<span class="op" id="4834650">:=</span>&nbsp;<span class="keyword" id="4834653">range</span>&nbsp;<span class="ident" id="4834659">b</span>&nbsp;<span class="op" id="4834661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834665">if</span>&nbsp;<span class="op" id="4834668">!</span><span class="ident" id="4834669">isSpace</span><span class="op" id="4834676">(</span><span class="builtintype" id="4834677">rune</span><span class="op" id="4834681">(</span><span class="ident" id="4834682">c</span><span class="op" id="4834683">)</span><span class="op" id="4834684">)</span>&nbsp;<span class="op" id="4834686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834691">return</span>&nbsp;<span class="builtintype" id="4834698">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834705">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4834708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834711">return</span>&nbsp;<span class="builtintype" id="4834718">false</span><br>
<span class="lineno"></span><span class="op" id="4834724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4834727">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="4834782">type</span>&nbsp;<span class="ident" id="4834787">Encoder</span>&nbsp;<span class="keyword" id="4834795">struct</span>&nbsp;<span class="op" id="4834802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834805">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4834809">io</span><span class="op" id="4834811">.</span><span class="ident" id="4834812">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4834820">err</span>&nbsp;<span class="builtintype" id="4834824">error</span><br>
<span class="lineno"></span><span class="op" id="4834830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4834833">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4834887">func</span>&nbsp;<span class="ident" id="4834892">NewEncoder</span><span class="op" id="4834902">(</span><span class="ident" id="4834903">w</span>&nbsp;<span class="ident" id="4834905">io</span><span class="op" id="4834907">.</span><span class="ident" id="4834908">Writer</span><span class="op" id="4834914">)</span>&nbsp;<span class="op" id="4834916">*</span><span class="ident" id="4834917">Encoder</span>&nbsp;<span class="op" id="4834925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4834928">return</span>&nbsp;<span class="op" id="4834935">&amp;</span><span class="ident" id="4834936">Encoder</span><span class="op" id="4834943">{</span><span class="ident" id="4834944">w</span><span class="op" id="4834945">:</span>&nbsp;<span class="ident" id="4834947">w</span><span class="op" id="4834948">}</span><br>
<span class="lineno"></span><span class="op" id="4834950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4834953">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4835008">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4835044">//</span><br>
<span class="lineno"></span><span class="comment" id="4835047">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4835106">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="4835142">func</span>&nbsp;<span class="op" id="4835147">(</span><span class="ident" id="4835148">enc</span>&nbsp;<span class="op" id="4835152">*</span><span class="ident" id="4835153">Encoder</span><span class="op" id="4835160">)</span>&nbsp;<span class="ident" id="4835162">Encode</span><span class="op" id="4835168">(</span><span class="ident" id="4835169">v</span>&nbsp;<span class="keyword" id="4835171">interface</span><span class="op" id="4835180">{</span><span class="op" id="4835181">}</span><span class="op" id="4835182">)</span>&nbsp;<span class="builtintype" id="4835184">error</span>&nbsp;<span class="op" id="4835190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835193">if</span>&nbsp;<span class="ident" id="4835196">enc</span><span class="op" id="4835199">.</span><span class="ident" id="4835200">err</span>&nbsp;<span class="op" id="4835204">!=</span>&nbsp;<span class="ident" id="4835207">nil</span>&nbsp;<span class="op" id="4835211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835215">return</span>&nbsp;<span class="ident" id="4835222">enc</span><span class="op" id="4835225">.</span><span class="ident" id="4835226">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4835231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4835234">e</span>&nbsp;<span class="op" id="4835236">:=</span>&nbsp;<span class="ident" id="4835239">newEncodeState</span><span class="op" id="4835253">(</span><span class="op" id="4835254">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4835257">err</span>&nbsp;<span class="op" id="4835261">:=</span>&nbsp;<span class="ident" id="4835264">e</span><span class="op" id="4835265">.</span><span class="ident" id="4835266">marshal</span><span class="op" id="4835273">(</span><span class="ident" id="4835274">v</span><span class="op" id="4835275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835278">if</span>&nbsp;<span class="ident" id="4835281">err</span>&nbsp;<span class="op" id="4835285">!=</span>&nbsp;<span class="ident" id="4835288">nil</span>&nbsp;<span class="op" id="4835292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835296">return</span>&nbsp;<span class="ident" id="4835303">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4835308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835312">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835353">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835399">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835442">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835493">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4835540">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4835559">e</span><span class="op" id="4835560">.</span><span class="ident" id="4835561">WriteByte</span><span class="op" id="4835570">(</span><span class="string" id="4835571">&#39;\n&#39;</span><span class="op" id="4835575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835579">if</span>&nbsp;<span class="ident" id="4835582">_</span><span class="op" id="4835583">,</span>&nbsp;<span class="ident" id="4835585">err</span>&nbsp;<span class="op" id="4835589">=</span>&nbsp;<span class="ident" id="4835591">enc</span><span class="op" id="4835594">.</span><span class="ident" id="4835595">w</span><span class="op" id="4835596">.</span><span class="ident" id="4835597">Write</span><span class="op" id="4835602">(</span><span class="ident" id="4835603">e</span><span class="op" id="4835604">.</span><span class="ident" id="4835605">Bytes</span><span class="op" id="4835610">(</span><span class="op" id="4835611">)</span><span class="op" id="4835612">)</span><span class="op" id="4835613">;</span>&nbsp;<span class="ident" id="4835615">err</span>&nbsp;<span class="op" id="4835619">!=</span>&nbsp;<span class="ident" id="4835622">nil</span>&nbsp;<span class="op" id="4835626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4835630">enc</span><span class="op" id="4835633">.</span><span class="ident" id="4835634">err</span>&nbsp;<span class="op" id="4835638">=</span>&nbsp;<span class="ident" id="4835640">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4835645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4835648">encodeStatePool</span><span class="op" id="4835663">.</span><span class="ident" id="4835664">Put</span><span class="op" id="4835667">(</span><span class="ident" id="4835668">e</span><span class="op" id="4835669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835672">return</span>&nbsp;<span class="ident" id="4835679">err</span><br>
<span class="lineno"></span><span class="op" id="4835683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4835686">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4835730">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4835781">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4835846">type</span>&nbsp;<span class="ident" id="4835851">RawMessage</span>&nbsp;<span class="op" id="4835862">[</span><span class="op" id="4835863">]</span><span class="builtintype" id="4835864">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4835870">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="4835923">func</span>&nbsp;<span class="op" id="4835928">(</span><span class="ident" id="4835929">m</span>&nbsp;<span class="op" id="4835931">*</span><span class="ident" id="4835932">RawMessage</span><span class="op" id="4835942">)</span>&nbsp;<span class="ident" id="4835944">MarshalJSON</span><span class="op" id="4835955">(</span><span class="op" id="4835956">)</span>&nbsp;<span class="op" id="4835958">(</span><span class="op" id="4835959">[</span><span class="op" id="4835960">]</span><span class="builtintype" id="4835961">byte</span><span class="op" id="4835965">,</span>&nbsp;<span class="builtintype" id="4835967">error</span><span class="op" id="4835972">)</span>&nbsp;<span class="op" id="4835974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4835977">return</span>&nbsp;<span class="op" id="4835984">*</span><span class="ident" id="4835985">m</span><span class="op" id="4835986">,</span>&nbsp;<span class="ident" id="4835988">nil</span><br>
<span class="lineno"></span><span class="op" id="4835992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4835995">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4836039">func</span>&nbsp;<span class="op" id="4836044">(</span><span class="ident" id="4836045">m</span>&nbsp;<span class="op" id="4836047">*</span><span class="ident" id="4836048">RawMessage</span><span class="op" id="4836058">)</span>&nbsp;<span class="ident" id="4836060">UnmarshalJSON</span><span class="op" id="4836073">(</span><span class="ident" id="4836074">data</span>&nbsp;<span class="op" id="4836079">[</span><span class="op" id="4836080">]</span><span class="builtintype" id="4836081">byte</span><span class="op" id="4836085">)</span>&nbsp;<span class="builtintype" id="4836087">error</span>&nbsp;<span class="op" id="4836093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4836096">if</span>&nbsp;<span class="ident" id="4836099">m</span>&nbsp;<span class="op" id="4836101">==</span>&nbsp;<span class="ident" id="4836104">nil</span>&nbsp;<span class="op" id="4836108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4836112">return</span>&nbsp;<span class="ident" id="4836119">errors</span><span class="op" id="4836125">.</span><span class="ident" id="4836126">New</span><span class="op" id="4836129">(</span><span class="string" id="4836130">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="4836177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4836180">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4836183">*</span><span class="ident" id="4836184">m</span>&nbsp;<span class="op" id="4836186">=</span>&nbsp;<span class="builtinfunc" id="4836188">append</span><span class="op" id="4836194">(</span><span class="op" id="4836195">(</span><span class="op" id="4836196">*</span><span class="ident" id="4836197">m</span><span class="op" id="4836198">)</span><span class="op" id="4836199">[</span><span class="num" id="4836200">0</span><span class="op" id="4836201">:</span><span class="num" id="4836202">0</span><span class="op" id="4836203">]</span><span class="op" id="4836204">,</span>&nbsp;<span class="ident" id="4836206">data</span><span class="op" id="4836210">...</span><span class="op" id="4836213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4836216">return</span>&nbsp;<span class="ident" id="4836223">nil</span><br>
<span class="lineno"></span><span class="op" id="4836227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4836230">var</span>&nbsp;<span class="ident" id="4836234">_</span>&nbsp;<span class="ident" id="4836236">Marshaler</span>&nbsp;<span class="op" id="4836246">=</span>&nbsp;<span class="op" id="4836248">(</span><span class="op" id="4836249">*</span><span class="ident" id="4836250">RawMessage</span><span class="op" id="4836260">)</span><span class="op" id="4836261">(</span><span class="ident" id="4836262">nil</span><span class="op" id="4836265">)</span><br>
<span class="lineno">200</span><span class="keyword" id="4836267">var</span>&nbsp;<span class="ident" id="4836271">_</span>&nbsp;<span class="ident" id="4836273">Unmarshaler</span>&nbsp;<span class="op" id="4836285">=</span>&nbsp;<span class="op" id="4836287">(</span><span class="op" id="4836288">*</span><span class="ident" id="4836289">RawMessage</span><span class="op" id="4836299">)</span><span class="op" id="4836300">(</span><span class="ident" id="4836301">nil</span><span class="op" id="4836304">)</span>
</div>
</body>
</html>
