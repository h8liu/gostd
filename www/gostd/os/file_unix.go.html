<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2473739">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2473794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2473848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2473899">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2473969">package</span>&nbsp;<span class="ident" id="2473977">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2473981">import</span>&nbsp;<span class="op" id="2473988">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2473991">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2474002">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2474017">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2474027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2474030">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2474074">type</span>&nbsp;<span class="ident" id="2474079">File</span>&nbsp;<span class="keyword" id="2474084">struct</span>&nbsp;<span class="op" id="2474091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2474094">*</span><span class="ident" id="2474095">file</span><br>
<span class="lineno"></span><span class="op" id="2474100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2474103">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2474148">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2474212">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2474272">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2474311">type</span>&nbsp;<span class="ident" id="2474316">file</span>&nbsp;<span class="keyword" id="2474321">struct</span>&nbsp;<span class="op" id="2474328">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474331">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2474339">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474344">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2474352">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474360">dirinfo</span>&nbsp;<span class="op" id="2474368">*</span><span class="ident" id="2474369">dirInfo</span>&nbsp;<span class="comment" id="2474377">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474413">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2474421">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2474430">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2474470">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2474473">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2474547">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2474635">func</span>&nbsp;<span class="op" id="2474640">(</span><span class="ident" id="2474641">f</span>&nbsp;<span class="op" id="2474643">*</span><span class="ident" id="2474644">File</span><span class="op" id="2474648">)</span>&nbsp;<span class="ident" id="2474650">Fd</span><span class="op" id="2474652">(</span><span class="op" id="2474653">)</span>&nbsp;<span class="builtintype" id="2474655">uintptr</span>&nbsp;<span class="op" id="2474663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474666">if</span>&nbsp;<span class="ident" id="2474669">f</span>&nbsp;<span class="op" id="2474671">==</span>&nbsp;<span class="ident" id="2474674">nil</span>&nbsp;<span class="op" id="2474678">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474682">return</span>&nbsp;<span class="op" id="2474689">^</span><span class="op" id="2474690">(</span><span class="builtintype" id="2474691">uintptr</span><span class="op" id="2474698">(</span><span class="num" id="2474699">0</span><span class="op" id="2474700">)</span><span class="op" id="2474701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2474704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474707">return</span>&nbsp;<span class="builtintype" id="2474714">uintptr</span><span class="op" id="2474721">(</span><span class="ident" id="2474722">f</span><span class="op" id="2474723">.</span><span class="ident" id="2474724">fd</span><span class="op" id="2474726">)</span><br>
<span class="lineno"></span><span class="op" id="2474728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2474731">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2474802">func</span>&nbsp;<span class="ident" id="2474807">NewFile</span><span class="op" id="2474814">(</span><span class="ident" id="2474815">fd</span>&nbsp;<span class="builtintype" id="2474818">uintptr</span><span class="op" id="2474825">,</span>&nbsp;<span class="ident" id="2474827">name</span>&nbsp;<span class="builtintype" id="2474832">string</span><span class="op" id="2474838">)</span>&nbsp;<span class="op" id="2474840">*</span><span class="ident" id="2474841">File</span>&nbsp;<span class="op" id="2474846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474849">fdi</span>&nbsp;<span class="op" id="2474853">:=</span>&nbsp;<span class="builtintype" id="2474856">int</span><span class="op" id="2474859">(</span><span class="ident" id="2474860">fd</span><span class="op" id="2474862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474865">if</span>&nbsp;<span class="ident" id="2474868">fdi</span>&nbsp;<span class="op" id="2474872">&lt;</span>&nbsp;<span class="num" id="2474874">0</span>&nbsp;<span class="op" id="2474876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474880">return</span>&nbsp;<span class="ident" id="2474887">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2474892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474895">f</span>&nbsp;<span class="op" id="2474897">:=</span>&nbsp;<span class="op" id="2474900">&amp;</span><span class="ident" id="2474901">File</span><span class="op" id="2474905">{</span><span class="op" id="2474906">&amp;</span><span class="ident" id="2474907">file</span><span class="op" id="2474911">{</span><span class="ident" id="2474912">fd</span><span class="op" id="2474914">:</span>&nbsp;<span class="ident" id="2474916">fdi</span><span class="op" id="2474919">,</span>&nbsp;<span class="ident" id="2474921">name</span><span class="op" id="2474925">:</span>&nbsp;<span class="ident" id="2474927">name</span><span class="op" id="2474931">}</span><span class="op" id="2474932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2474935">runtime</span><span class="op" id="2474942">.</span><span class="ident" id="2474943">SetFinalizer</span><span class="op" id="2474955">(</span><span class="ident" id="2474956">f</span><span class="op" id="2474957">.</span><span class="ident" id="2474958">file</span><span class="op" id="2474962">,</span>&nbsp;<span class="op" id="2474964">(</span><span class="op" id="2474965">*</span><span class="ident" id="2474966">file</span><span class="op" id="2474970">)</span><span class="op" id="2474971">.</span><span class="builtinfunc" id="2474972">close</span><span class="op" id="2474977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2474980">return</span>&nbsp;<span class="ident" id="2474987">f</span><br>
<span class="lineno"></span><span class="op" id="2474989">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2474992">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2475051">type</span>&nbsp;<span class="ident" id="2475056">dirInfo</span>&nbsp;<span class="keyword" id="2475064">struct</span>&nbsp;<span class="op" id="2475071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475074">buf</span>&nbsp;&nbsp;<span class="op" id="2475079">[</span><span class="op" id="2475080">]</span><span class="builtintype" id="2475081">byte</span>&nbsp;<span class="comment" id="2475086">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475115">nbuf</span>&nbsp;<span class="builtintype" id="2475120">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2475127">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475178">bufp</span>&nbsp;<span class="builtintype" id="2475183">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2475190">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2475225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2475228">func</span>&nbsp;<span class="ident" id="2475233">epipecheck</span><span class="op" id="2475243">(</span><span class="ident" id="2475244">file</span>&nbsp;<span class="op" id="2475249">*</span><span class="ident" id="2475250">File</span><span class="op" id="2475254">,</span>&nbsp;<span class="ident" id="2475256">e</span>&nbsp;<span class="builtintype" id="2475258">error</span><span class="op" id="2475263">)</span>&nbsp;<span class="op" id="2475265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2475268">if</span>&nbsp;<span class="ident" id="2475271">e</span>&nbsp;<span class="op" id="2475273">==</span>&nbsp;<span class="ident" id="2475276">syscall</span><span class="op" id="2475283">.</span><span class="ident" id="2475284">EPIPE</span>&nbsp;<span class="op" id="2475290">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2475294">if</span>&nbsp;<span class="ident" id="2475297">atomic</span><span class="op" id="2475303">.</span><span class="ident" id="2475304">AddInt32</span><span class="op" id="2475312">(</span><span class="op" id="2475313">&amp;</span><span class="ident" id="2475314">file</span><span class="op" id="2475318">.</span><span class="ident" id="2475319">nepipe</span><span class="op" id="2475325">,</span>&nbsp;<span class="num" id="2475327">1</span><span class="op" id="2475328">)</span>&nbsp;<span class="op" id="2475330">&gt;=</span>&nbsp;<span class="num" id="2475333">10</span>&nbsp;<span class="op" id="2475336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475341">sigpipe</span><span class="op" id="2475348">(</span><span class="op" id="2475349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2475353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2475356">}</span>&nbsp;<span class="keyword" id="2475358">else</span>&nbsp;<span class="op" id="2475363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475367">atomic</span><span class="op" id="2475373">.</span><span class="ident" id="2475374">StoreInt32</span><span class="op" id="2475384">(</span><span class="op" id="2475385">&amp;</span><span class="ident" id="2475386">file</span><span class="op" id="2475390">.</span><span class="ident" id="2475391">nepipe</span><span class="op" id="2475397">,</span>&nbsp;<span class="num" id="2475399">0</span><span class="op" id="2475400">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2475403">}</span><br>
<span class="lineno"></span><span class="op" id="2475405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2475408">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2475474">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2475537">const</span>&nbsp;<span class="ident" id="2475543">DevNull</span>&nbsp;<span class="op" id="2475551">=</span>&nbsp;<span class="string" id="2475553">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2475566">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2475633">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2475700">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2475772">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2475825">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2475881">func</span>&nbsp;<span class="ident" id="2475886">OpenFile</span><span class="op" id="2475894">(</span><span class="ident" id="2475895">name</span>&nbsp;<span class="builtintype" id="2475900">string</span><span class="op" id="2475906">,</span>&nbsp;<span class="ident" id="2475908">flag</span>&nbsp;<span class="builtintype" id="2475913">int</span><span class="op" id="2475916">,</span>&nbsp;<span class="ident" id="2475918">perm</span>&nbsp;<span class="ident" id="2475923">FileMode</span><span class="op" id="2475931">)</span>&nbsp;<span class="op" id="2475933">(</span><span class="ident" id="2475934">file</span>&nbsp;<span class="op" id="2475939">*</span><span class="ident" id="2475940">File</span><span class="op" id="2475944">,</span>&nbsp;<span class="ident" id="2475946">err</span>&nbsp;<span class="builtintype" id="2475950">error</span><span class="op" id="2475955">)</span>&nbsp;<span class="op" id="2475957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2475960">r</span><span class="op" id="2475961">,</span>&nbsp;<span class="ident" id="2475963">e</span>&nbsp;<span class="op" id="2475965">:=</span>&nbsp;<span class="ident" id="2475968">syscall</span><span class="op" id="2475975">.</span><span class="ident" id="2475976">Open</span><span class="op" id="2475980">(</span><span class="ident" id="2475981">name</span><span class="op" id="2475985">,</span>&nbsp;<span class="ident" id="2475987">flag</span><span class="op" id="2475991">|</span><span class="ident" id="2475992">syscall</span><span class="op" id="2475999">.</span><span class="ident" id="2476000">O_CLOEXEC</span><span class="op" id="2476009">,</span>&nbsp;<span class="ident" id="2476011">syscallMode</span><span class="op" id="2476022">(</span><span class="ident" id="2476023">perm</span><span class="op" id="2476027">)</span><span class="op" id="2476028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476031">if</span>&nbsp;<span class="ident" id="2476034">e</span>&nbsp;<span class="op" id="2476036">!=</span>&nbsp;<span class="ident" id="2476039">nil</span>&nbsp;<span class="op" id="2476043">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476047">return</span>&nbsp;<span class="ident" id="2476054">nil</span><span class="op" id="2476057">,</span>&nbsp;<span class="op" id="2476059">&amp;</span><span class="ident" id="2476060">PathError</span><span class="op" id="2476069">{</span><span class="string" id="2476070">&#34;open&#34;</span><span class="op" id="2476076">,</span>&nbsp;<span class="ident" id="2476078">name</span><span class="op" id="2476082">,</span>&nbsp;<span class="ident" id="2476084">e</span><span class="op" id="2476085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2476088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2476092">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2476145">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476201">if</span>&nbsp;<span class="op" id="2476204">!</span><span class="ident" id="2476205">supportsCloseOnExec</span>&nbsp;<span class="op" id="2476225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2476229">syscall</span><span class="op" id="2476236">.</span><span class="ident" id="2476237">CloseOnExec</span><span class="op" id="2476248">(</span><span class="ident" id="2476249">r</span><span class="op" id="2476250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2476253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476257">return</span>&nbsp;<span class="ident" id="2476264">NewFile</span><span class="op" id="2476271">(</span><span class="builtintype" id="2476272">uintptr</span><span class="op" id="2476279">(</span><span class="ident" id="2476280">r</span><span class="op" id="2476281">)</span><span class="op" id="2476282">,</span>&nbsp;<span class="ident" id="2476284">name</span><span class="op" id="2476288">)</span><span class="op" id="2476289">,</span>&nbsp;<span class="ident" id="2476291">nil</span><br>
<span class="lineno">90</span><span class="op" id="2476295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2476298">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2476355">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2476387">func</span>&nbsp;<span class="op" id="2476392">(</span><span class="ident" id="2476393">f</span>&nbsp;<span class="op" id="2476395">*</span><span class="ident" id="2476396">File</span><span class="op" id="2476400">)</span>&nbsp;<span class="ident" id="2476402">Close</span><span class="op" id="2476407">(</span><span class="op" id="2476408">)</span>&nbsp;<span class="builtintype" id="2476410">error</span>&nbsp;<span class="op" id="2476416">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476419">if</span>&nbsp;<span class="ident" id="2476422">f</span>&nbsp;<span class="op" id="2476424">==</span>&nbsp;<span class="ident" id="2476427">nil</span>&nbsp;<span class="op" id="2476431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476435">return</span>&nbsp;<span class="ident" id="2476442">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2476454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476457">return</span>&nbsp;<span class="ident" id="2476464">f</span><span class="op" id="2476465">.</span><span class="ident" id="2476466">file</span><span class="op" id="2476470">.</span><span class="builtinfunc" id="2476471">close</span><span class="op" id="2476476">(</span><span class="op" id="2476477">)</span><br>
<span class="lineno"></span><span class="op" id="2476479">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2476482">func</span>&nbsp;<span class="op" id="2476487">(</span><span class="ident" id="2476488">file</span>&nbsp;<span class="op" id="2476493">*</span><span class="ident" id="2476494">file</span><span class="op" id="2476498">)</span>&nbsp;<span class="builtinfunc" id="2476500">close</span><span class="op" id="2476505">(</span><span class="op" id="2476506">)</span>&nbsp;<span class="builtintype" id="2476508">error</span>&nbsp;<span class="op" id="2476514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476517">if</span>&nbsp;<span class="ident" id="2476520">file</span>&nbsp;<span class="op" id="2476525">==</span>&nbsp;<span class="ident" id="2476528">nil</span>&nbsp;<span class="op" id="2476532">||</span>&nbsp;<span class="ident" id="2476535">file</span><span class="op" id="2476539">.</span><span class="ident" id="2476540">fd</span>&nbsp;<span class="op" id="2476543">&lt;</span>&nbsp;<span class="num" id="2476545">0</span>&nbsp;<span class="op" id="2476547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476551">return</span>&nbsp;<span class="ident" id="2476558">syscall</span><span class="op" id="2476565">.</span><span class="ident" id="2476566">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2476574">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476577">var</span>&nbsp;<span class="ident" id="2476581">err</span>&nbsp;<span class="builtintype" id="2476585">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476592">if</span>&nbsp;<span class="ident" id="2476595">e</span>&nbsp;<span class="op" id="2476597">:=</span>&nbsp;<span class="ident" id="2476600">syscall</span><span class="op" id="2476607">.</span><span class="ident" id="2476608">Close</span><span class="op" id="2476613">(</span><span class="ident" id="2476614">file</span><span class="op" id="2476618">.</span><span class="ident" id="2476619">fd</span><span class="op" id="2476621">)</span><span class="op" id="2476622">;</span>&nbsp;<span class="ident" id="2476624">e</span>&nbsp;<span class="op" id="2476626">!=</span>&nbsp;<span class="ident" id="2476629">nil</span>&nbsp;<span class="op" id="2476633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2476637">err</span>&nbsp;<span class="op" id="2476641">=</span>&nbsp;<span class="op" id="2476643">&amp;</span><span class="ident" id="2476644">PathError</span><span class="op" id="2476653">{</span><span class="string" id="2476654">&#34;close&#34;</span><span class="op" id="2476661">,</span>&nbsp;<span class="ident" id="2476663">file</span><span class="op" id="2476667">.</span><span class="ident" id="2476668">name</span><span class="op" id="2476672">,</span>&nbsp;<span class="ident" id="2476674">e</span><span class="op" id="2476675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2476678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2476681">file</span><span class="op" id="2476685">.</span><span class="ident" id="2476686">fd</span>&nbsp;<span class="op" id="2476689">=</span>&nbsp;<span class="op" id="2476691">-</span><span class="num" id="2476692">1</span>&nbsp;<span class="comment" id="2476694">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2476727">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2476763">runtime</span><span class="op" id="2476770">.</span><span class="ident" id="2476771">SetFinalizer</span><span class="op" id="2476783">(</span><span class="ident" id="2476784">file</span><span class="op" id="2476788">,</span>&nbsp;<span class="ident" id="2476790">nil</span><span class="op" id="2476793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476796">return</span>&nbsp;<span class="ident" id="2476803">err</span><br>
<span class="lineno"></span><span class="op" id="2476807">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2476810">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2476866">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2476922">func</span>&nbsp;<span class="op" id="2476927">(</span><span class="ident" id="2476928">f</span>&nbsp;<span class="op" id="2476930">*</span><span class="ident" id="2476931">File</span><span class="op" id="2476935">)</span>&nbsp;<span class="ident" id="2476937">Stat</span><span class="op" id="2476941">(</span><span class="op" id="2476942">)</span>&nbsp;<span class="op" id="2476944">(</span><span class="ident" id="2476945">fi</span>&nbsp;<span class="ident" id="2476948">FileInfo</span><span class="op" id="2476956">,</span>&nbsp;<span class="ident" id="2476958">err</span>&nbsp;<span class="builtintype" id="2476962">error</span><span class="op" id="2476967">)</span>&nbsp;<span class="op" id="2476969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476972">if</span>&nbsp;<span class="ident" id="2476975">f</span>&nbsp;<span class="op" id="2476977">==</span>&nbsp;<span class="ident" id="2476980">nil</span>&nbsp;<span class="op" id="2476984">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2476988">return</span>&nbsp;<span class="ident" id="2476995">nil</span><span class="op" id="2476998">,</span>&nbsp;<span class="ident" id="2477000">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2477012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477015">var</span>&nbsp;<span class="ident" id="2477019">stat</span>&nbsp;<span class="ident" id="2477024">syscall</span><span class="op" id="2477031">.</span><span class="ident" id="2477032">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2477040">err</span>&nbsp;<span class="op" id="2477044">=</span>&nbsp;<span class="ident" id="2477046">syscall</span><span class="op" id="2477053">.</span><span class="ident" id="2477054">Fstat</span><span class="op" id="2477059">(</span><span class="ident" id="2477060">f</span><span class="op" id="2477061">.</span><span class="ident" id="2477062">fd</span><span class="op" id="2477064">,</span>&nbsp;<span class="op" id="2477066">&amp;</span><span class="ident" id="2477067">stat</span><span class="op" id="2477071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477074">if</span>&nbsp;<span class="ident" id="2477077">err</span>&nbsp;<span class="op" id="2477081">!=</span>&nbsp;<span class="ident" id="2477084">nil</span>&nbsp;<span class="op" id="2477088">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477092">return</span>&nbsp;<span class="ident" id="2477099">nil</span><span class="op" id="2477102">,</span>&nbsp;<span class="op" id="2477104">&amp;</span><span class="ident" id="2477105">PathError</span><span class="op" id="2477114">{</span><span class="string" id="2477115">&#34;stat&#34;</span><span class="op" id="2477121">,</span>&nbsp;<span class="ident" id="2477123">f</span><span class="op" id="2477124">.</span><span class="ident" id="2477125">name</span><span class="op" id="2477129">,</span>&nbsp;<span class="ident" id="2477131">err</span><span class="op" id="2477134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2477137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477140">return</span>&nbsp;<span class="ident" id="2477147">fileInfoFromStat</span><span class="op" id="2477163">(</span><span class="op" id="2477164">&amp;</span><span class="ident" id="2477165">stat</span><span class="op" id="2477169">,</span>&nbsp;<span class="ident" id="2477171">f</span><span class="op" id="2477172">.</span><span class="ident" id="2477173">name</span><span class="op" id="2477177">)</span><span class="op" id="2477178">,</span>&nbsp;<span class="ident" id="2477180">nil</span><br>
<span class="lineno"></span><span class="op" id="2477184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2477187">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2477241">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2477297">func</span>&nbsp;<span class="ident" id="2477302">Stat</span><span class="op" id="2477306">(</span><span class="ident" id="2477307">name</span>&nbsp;<span class="builtintype" id="2477312">string</span><span class="op" id="2477318">)</span>&nbsp;<span class="op" id="2477320">(</span><span class="ident" id="2477321">fi</span>&nbsp;<span class="ident" id="2477324">FileInfo</span><span class="op" id="2477332">,</span>&nbsp;<span class="ident" id="2477334">err</span>&nbsp;<span class="builtintype" id="2477338">error</span><span class="op" id="2477343">)</span>&nbsp;<span class="op" id="2477345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477348">var</span>&nbsp;<span class="ident" id="2477352">stat</span>&nbsp;<span class="ident" id="2477357">syscall</span><span class="op" id="2477364">.</span><span class="ident" id="2477365">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2477373">err</span>&nbsp;<span class="op" id="2477377">=</span>&nbsp;<span class="ident" id="2477379">syscall</span><span class="op" id="2477386">.</span><span class="ident" id="2477387">Stat</span><span class="op" id="2477391">(</span><span class="ident" id="2477392">name</span><span class="op" id="2477396">,</span>&nbsp;<span class="op" id="2477398">&amp;</span><span class="ident" id="2477399">stat</span><span class="op" id="2477403">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477406">if</span>&nbsp;<span class="ident" id="2477409">err</span>&nbsp;<span class="op" id="2477413">!=</span>&nbsp;<span class="ident" id="2477416">nil</span>&nbsp;<span class="op" id="2477420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477424">return</span>&nbsp;<span class="ident" id="2477431">nil</span><span class="op" id="2477434">,</span>&nbsp;<span class="op" id="2477436">&amp;</span><span class="ident" id="2477437">PathError</span><span class="op" id="2477446">{</span><span class="string" id="2477447">&#34;stat&#34;</span><span class="op" id="2477453">,</span>&nbsp;<span class="ident" id="2477455">name</span><span class="op" id="2477459">,</span>&nbsp;<span class="ident" id="2477461">err</span><span class="op" id="2477464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2477467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477470">return</span>&nbsp;<span class="ident" id="2477477">fileInfoFromStat</span><span class="op" id="2477493">(</span><span class="op" id="2477494">&amp;</span><span class="ident" id="2477495">stat</span><span class="op" id="2477499">,</span>&nbsp;<span class="ident" id="2477501">name</span><span class="op" id="2477505">)</span><span class="op" id="2477506">,</span>&nbsp;<span class="ident" id="2477508">nil</span><br>
<span class="lineno"></span><span class="op" id="2477512">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2477515">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2477570">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2477627">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2477703">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2477759">func</span>&nbsp;<span class="ident" id="2477764">Lstat</span><span class="op" id="2477769">(</span><span class="ident" id="2477770">name</span>&nbsp;<span class="builtintype" id="2477775">string</span><span class="op" id="2477781">)</span>&nbsp;<span class="op" id="2477783">(</span><span class="ident" id="2477784">fi</span>&nbsp;<span class="ident" id="2477787">FileInfo</span><span class="op" id="2477795">,</span>&nbsp;<span class="ident" id="2477797">err</span>&nbsp;<span class="builtintype" id="2477801">error</span><span class="op" id="2477806">)</span>&nbsp;<span class="op" id="2477808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477811">var</span>&nbsp;<span class="ident" id="2477815">stat</span>&nbsp;<span class="ident" id="2477820">syscall</span><span class="op" id="2477827">.</span><span class="ident" id="2477828">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2477836">err</span>&nbsp;<span class="op" id="2477840">=</span>&nbsp;<span class="ident" id="2477842">syscall</span><span class="op" id="2477849">.</span><span class="ident" id="2477850">Lstat</span><span class="op" id="2477855">(</span><span class="ident" id="2477856">name</span><span class="op" id="2477860">,</span>&nbsp;<span class="op" id="2477862">&amp;</span><span class="ident" id="2477863">stat</span><span class="op" id="2477867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477870">if</span>&nbsp;<span class="ident" id="2477873">err</span>&nbsp;<span class="op" id="2477877">!=</span>&nbsp;<span class="ident" id="2477880">nil</span>&nbsp;<span class="op" id="2477884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477888">return</span>&nbsp;<span class="ident" id="2477895">nil</span><span class="op" id="2477898">,</span>&nbsp;<span class="op" id="2477900">&amp;</span><span class="ident" id="2477901">PathError</span><span class="op" id="2477910">{</span><span class="string" id="2477911">&#34;lstat&#34;</span><span class="op" id="2477918">,</span>&nbsp;<span class="ident" id="2477920">name</span><span class="op" id="2477924">,</span>&nbsp;<span class="ident" id="2477926">err</span><span class="op" id="2477929">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2477932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2477935">return</span>&nbsp;<span class="ident" id="2477942">fileInfoFromStat</span><span class="op" id="2477958">(</span><span class="op" id="2477959">&amp;</span><span class="ident" id="2477960">stat</span><span class="op" id="2477964">,</span>&nbsp;<span class="ident" id="2477966">name</span><span class="op" id="2477970">)</span><span class="op" id="2477971">,</span>&nbsp;<span class="ident" id="2477973">nil</span><br>
<span class="lineno"></span><span class="op" id="2477977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2477980">func</span>&nbsp;<span class="op" id="2477985">(</span><span class="ident" id="2477986">f</span>&nbsp;<span class="op" id="2477988">*</span><span class="ident" id="2477989">File</span><span class="op" id="2477993">)</span>&nbsp;<span class="ident" id="2477995">readdir</span><span class="op" id="2478002">(</span><span class="ident" id="2478003">n</span>&nbsp;<span class="builtintype" id="2478005">int</span><span class="op" id="2478008">)</span>&nbsp;<span class="op" id="2478010">(</span><span class="ident" id="2478011">fi</span>&nbsp;<span class="op" id="2478014">[</span><span class="op" id="2478015">]</span><span class="ident" id="2478016">FileInfo</span><span class="op" id="2478024">,</span>&nbsp;<span class="ident" id="2478026">err</span>&nbsp;<span class="builtintype" id="2478030">error</span><span class="op" id="2478035">)</span>&nbsp;<span class="op" id="2478037">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478040">dirname</span>&nbsp;<span class="op" id="2478048">:=</span>&nbsp;<span class="ident" id="2478051">f</span><span class="op" id="2478052">.</span><span class="ident" id="2478053">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478059">if</span>&nbsp;<span class="ident" id="2478062">dirname</span>&nbsp;<span class="op" id="2478070">==</span>&nbsp;<span class="string" id="2478073">&#34;&#34;</span>&nbsp;<span class="op" id="2478076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478080">dirname</span>&nbsp;<span class="op" id="2478088">=</span>&nbsp;<span class="string" id="2478090">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2478095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478098">names</span><span class="op" id="2478103">,</span>&nbsp;<span class="ident" id="2478105">err</span>&nbsp;<span class="op" id="2478109">:=</span>&nbsp;<span class="ident" id="2478112">f</span><span class="op" id="2478113">.</span><span class="ident" id="2478114">Readdirnames</span><span class="op" id="2478126">(</span><span class="ident" id="2478127">n</span><span class="op" id="2478128">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478131">fi</span>&nbsp;<span class="op" id="2478134">=</span>&nbsp;<span class="builtinfunc" id="2478136">make</span><span class="op" id="2478140">(</span><span class="op" id="2478141">[</span><span class="op" id="2478142">]</span><span class="ident" id="2478143">FileInfo</span><span class="op" id="2478151">,</span>&nbsp;<span class="num" id="2478153">0</span><span class="op" id="2478154">,</span>&nbsp;<span class="builtinfunc" id="2478156">len</span><span class="op" id="2478159">(</span><span class="ident" id="2478160">names</span><span class="op" id="2478165">)</span><span class="op" id="2478166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478169">for</span>&nbsp;<span class="ident" id="2478173">_</span><span class="op" id="2478174">,</span>&nbsp;<span class="ident" id="2478176">filename</span>&nbsp;<span class="op" id="2478185">:=</span>&nbsp;<span class="keyword" id="2478188">range</span>&nbsp;<span class="ident" id="2478194">names</span>&nbsp;<span class="op" id="2478200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478204">fip</span><span class="op" id="2478207">,</span>&nbsp;<span class="ident" id="2478209">lerr</span>&nbsp;<span class="op" id="2478214">:=</span>&nbsp;<span class="ident" id="2478217">lstat</span><span class="op" id="2478222">(</span><span class="ident" id="2478223">dirname</span>&nbsp;<span class="op" id="2478231">+</span>&nbsp;<span class="string" id="2478233">&#34;/&#34;</span>&nbsp;<span class="op" id="2478237">+</span>&nbsp;<span class="ident" id="2478239">filename</span><span class="op" id="2478247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478251">if</span>&nbsp;<span class="ident" id="2478254">IsNotExist</span><span class="op" id="2478264">(</span><span class="ident" id="2478265">lerr</span><span class="op" id="2478269">)</span>&nbsp;<span class="op" id="2478271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2478276">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2478323">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478366">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2478377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478381">if</span>&nbsp;<span class="ident" id="2478384">lerr</span>&nbsp;<span class="op" id="2478389">!=</span>&nbsp;<span class="ident" id="2478392">nil</span>&nbsp;<span class="op" id="2478396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478401">return</span>&nbsp;<span class="ident" id="2478408">fi</span><span class="op" id="2478410">,</span>&nbsp;<span class="ident" id="2478412">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2478419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478423">fi</span>&nbsp;<span class="op" id="2478426">=</span>&nbsp;<span class="builtinfunc" id="2478428">append</span><span class="op" id="2478434">(</span><span class="ident" id="2478435">fi</span><span class="op" id="2478437">,</span>&nbsp;<span class="ident" id="2478439">fip</span><span class="op" id="2478442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2478445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478448">return</span>&nbsp;<span class="ident" id="2478455">fi</span><span class="op" id="2478457">,</span>&nbsp;<span class="ident" id="2478459">err</span><br>
<span class="lineno"></span><span class="op" id="2478463">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2478466">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2478524">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2478578">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2478632">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2478650">const</span>&nbsp;<span class="op" id="2478656">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478659">needsMaxRW</span>&nbsp;<span class="op" id="2478670">=</span>&nbsp;<span class="ident" id="2478672">runtime</span><span class="op" id="2478679">.</span><span class="ident" id="2478680">GOOS</span>&nbsp;<span class="op" id="2478685">==</span>&nbsp;<span class="string" id="2478688">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2478697">||</span>&nbsp;<span class="ident" id="2478700">runtime</span><span class="op" id="2478707">.</span><span class="ident" id="2478708">GOOS</span>&nbsp;<span class="op" id="2478713">==</span>&nbsp;<span class="string" id="2478716">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478727">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2478738">=</span>&nbsp;<span class="num" id="2478740">1</span>&nbsp;<span class="op" id="2478742">&lt;&lt;</span>&nbsp;<span class="num" id="2478745">30</span><br>
<span class="lineno"></span><span class="op" id="2478748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2478751">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2478799">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2478860">func</span>&nbsp;<span class="op" id="2478865">(</span><span class="ident" id="2478866">f</span>&nbsp;<span class="op" id="2478868">*</span><span class="ident" id="2478869">File</span><span class="op" id="2478873">)</span>&nbsp;<span class="ident" id="2478875">read</span><span class="op" id="2478879">(</span><span class="ident" id="2478880">b</span>&nbsp;<span class="op" id="2478882">[</span><span class="op" id="2478883">]</span><span class="builtintype" id="2478884">byte</span><span class="op" id="2478888">)</span>&nbsp;<span class="op" id="2478890">(</span><span class="ident" id="2478891">n</span>&nbsp;<span class="builtintype" id="2478893">int</span><span class="op" id="2478896">,</span>&nbsp;<span class="ident" id="2478898">err</span>&nbsp;<span class="builtintype" id="2478902">error</span><span class="op" id="2478907">)</span>&nbsp;<span class="op" id="2478909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478912">if</span>&nbsp;<span class="ident" id="2478915">needsMaxRW</span>&nbsp;<span class="op" id="2478926">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2478929">len</span><span class="op" id="2478932">(</span><span class="ident" id="2478933">b</span><span class="op" id="2478934">)</span>&nbsp;<span class="op" id="2478936">&gt;</span>&nbsp;<span class="ident" id="2478938">maxRW</span>&nbsp;<span class="op" id="2478944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2478948">b</span>&nbsp;<span class="op" id="2478950">=</span>&nbsp;<span class="ident" id="2478952">b</span><span class="op" id="2478953">[</span><span class="op" id="2478954">:</span><span class="ident" id="2478955">maxRW</span><span class="op" id="2478960">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2478963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2478966">return</span>&nbsp;<span class="ident" id="2478973">fixCount</span><span class="op" id="2478981">(</span><span class="ident" id="2478982">syscall</span><span class="op" id="2478989">.</span><span class="ident" id="2478990">Read</span><span class="op" id="2478994">(</span><span class="ident" id="2478995">f</span><span class="op" id="2478996">.</span><span class="ident" id="2478997">fd</span><span class="op" id="2478999">,</span>&nbsp;<span class="ident" id="2479001">b</span><span class="op" id="2479002">)</span><span class="op" id="2479003">)</span><br>
<span class="lineno"></span><span class="op" id="2479005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2479008">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2479079">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2479141">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2479197">func</span>&nbsp;<span class="op" id="2479202">(</span><span class="ident" id="2479203">f</span>&nbsp;<span class="op" id="2479205">*</span><span class="ident" id="2479206">File</span><span class="op" id="2479210">)</span>&nbsp;<span class="ident" id="2479212">pread</span><span class="op" id="2479217">(</span><span class="ident" id="2479218">b</span>&nbsp;<span class="op" id="2479220">[</span><span class="op" id="2479221">]</span><span class="builtintype" id="2479222">byte</span><span class="op" id="2479226">,</span>&nbsp;<span class="ident" id="2479228">off</span>&nbsp;<span class="ident" id="2479232">int64</span><span class="op" id="2479237">)</span>&nbsp;<span class="op" id="2479239">(</span><span class="ident" id="2479240">n</span>&nbsp;<span class="builtintype" id="2479242">int</span><span class="op" id="2479245">,</span>&nbsp;<span class="ident" id="2479247">err</span>&nbsp;<span class="builtintype" id="2479251">error</span><span class="op" id="2479256">)</span>&nbsp;<span class="op" id="2479258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479261">if</span>&nbsp;<span class="ident" id="2479264">needsMaxRW</span>&nbsp;<span class="op" id="2479275">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2479278">len</span><span class="op" id="2479281">(</span><span class="ident" id="2479282">b</span><span class="op" id="2479283">)</span>&nbsp;<span class="op" id="2479285">&gt;</span>&nbsp;<span class="ident" id="2479287">maxRW</span>&nbsp;<span class="op" id="2479293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479297">b</span>&nbsp;<span class="op" id="2479299">=</span>&nbsp;<span class="ident" id="2479301">b</span><span class="op" id="2479302">[</span><span class="op" id="2479303">:</span><span class="ident" id="2479304">maxRW</span><span class="op" id="2479309">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2479312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479315">return</span>&nbsp;<span class="ident" id="2479322">fixCount</span><span class="op" id="2479330">(</span><span class="ident" id="2479331">syscall</span><span class="op" id="2479338">.</span><span class="ident" id="2479339">Pread</span><span class="op" id="2479344">(</span><span class="ident" id="2479345">f</span><span class="op" id="2479346">.</span><span class="ident" id="2479347">fd</span><span class="op" id="2479349">,</span>&nbsp;<span class="ident" id="2479351">b</span><span class="op" id="2479352">,</span>&nbsp;<span class="ident" id="2479354">off</span><span class="op" id="2479357">)</span><span class="op" id="2479358">)</span><br>
<span class="lineno"></span><span class="op" id="2479360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2479363">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2479405">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2479469">func</span>&nbsp;<span class="op" id="2479474">(</span><span class="ident" id="2479475">f</span>&nbsp;<span class="op" id="2479477">*</span><span class="ident" id="2479478">File</span><span class="op" id="2479482">)</span>&nbsp;<span class="ident" id="2479484">write</span><span class="op" id="2479489">(</span><span class="ident" id="2479490">b</span>&nbsp;<span class="op" id="2479492">[</span><span class="op" id="2479493">]</span><span class="builtintype" id="2479494">byte</span><span class="op" id="2479498">)</span>&nbsp;<span class="op" id="2479500">(</span><span class="ident" id="2479501">n</span>&nbsp;<span class="builtintype" id="2479503">int</span><span class="op" id="2479506">,</span>&nbsp;<span class="ident" id="2479508">err</span>&nbsp;<span class="builtintype" id="2479512">error</span><span class="op" id="2479517">)</span>&nbsp;<span class="op" id="2479519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479522">for</span>&nbsp;<span class="op" id="2479526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479530">bcap</span>&nbsp;<span class="op" id="2479535">:=</span>&nbsp;<span class="ident" id="2479538">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479542">if</span>&nbsp;<span class="ident" id="2479545">needsMaxRW</span>&nbsp;<span class="op" id="2479556">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2479559">len</span><span class="op" id="2479562">(</span><span class="ident" id="2479563">bcap</span><span class="op" id="2479567">)</span>&nbsp;<span class="op" id="2479569">&gt;</span>&nbsp;<span class="ident" id="2479571">maxRW</span>&nbsp;<span class="op" id="2479577">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479582">bcap</span>&nbsp;<span class="op" id="2479587">=</span>&nbsp;<span class="ident" id="2479589">bcap</span><span class="op" id="2479593">[</span><span class="op" id="2479594">:</span><span class="ident" id="2479595">maxRW</span><span class="op" id="2479600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2479604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479608">m</span><span class="op" id="2479609">,</span>&nbsp;<span class="ident" id="2479611">err</span>&nbsp;<span class="op" id="2479615">:=</span>&nbsp;<span class="ident" id="2479618">fixCount</span><span class="op" id="2479626">(</span><span class="ident" id="2479627">syscall</span><span class="op" id="2479634">.</span><span class="ident" id="2479635">Write</span><span class="op" id="2479640">(</span><span class="ident" id="2479641">f</span><span class="op" id="2479642">.</span><span class="ident" id="2479643">fd</span><span class="op" id="2479645">,</span>&nbsp;<span class="ident" id="2479647">bcap</span><span class="op" id="2479651">)</span><span class="op" id="2479652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479656">n</span>&nbsp;<span class="op" id="2479658">+=</span>&nbsp;<span class="ident" id="2479661">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2479666">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2479728">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2479788">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479854">if</span>&nbsp;<span class="num" id="2479857">0</span>&nbsp;<span class="op" id="2479859">&lt;</span>&nbsp;<span class="ident" id="2479861">m</span>&nbsp;<span class="op" id="2479863">&amp;&amp;</span>&nbsp;<span class="ident" id="2479866">m</span>&nbsp;<span class="op" id="2479868">&lt;</span>&nbsp;<span class="builtinfunc" id="2479870">len</span><span class="op" id="2479873">(</span><span class="ident" id="2479874">bcap</span><span class="op" id="2479878">)</span>&nbsp;<span class="op" id="2479880">||</span>&nbsp;<span class="ident" id="2479883">err</span>&nbsp;<span class="op" id="2479887">==</span>&nbsp;<span class="ident" id="2479890">syscall</span><span class="op" id="2479897">.</span><span class="ident" id="2479898">EINTR</span>&nbsp;<span class="op" id="2479904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479909">b</span>&nbsp;<span class="op" id="2479911">=</span>&nbsp;<span class="ident" id="2479913">b</span><span class="op" id="2479914">[</span><span class="ident" id="2479915">m</span><span class="op" id="2479916">:</span><span class="op" id="2479917">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2479933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2479938">if</span>&nbsp;<span class="ident" id="2479941">needsMaxRW</span>&nbsp;<span class="op" id="2479952">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2479955">len</span><span class="op" id="2479958">(</span><span class="ident" id="2479959">bcap</span><span class="op" id="2479963">)</span>&nbsp;<span class="op" id="2479965">!=</span>&nbsp;<span class="builtinfunc" id="2479968">len</span><span class="op" id="2479971">(</span><span class="ident" id="2479972">b</span><span class="op" id="2479973">)</span>&nbsp;<span class="op" id="2479975">&amp;&amp;</span>&nbsp;<span class="ident" id="2479978">err</span>&nbsp;<span class="op" id="2479982">==</span>&nbsp;<span class="ident" id="2479985">nil</span>&nbsp;<span class="op" id="2479989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2479994">b</span>&nbsp;<span class="op" id="2479996">=</span>&nbsp;<span class="ident" id="2479998">b</span><span class="op" id="2479999">[</span><span class="ident" id="2480000">m</span><span class="op" id="2480001">:</span><span class="op" id="2480002">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480007">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2480018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480023">return</span>&nbsp;<span class="ident" id="2480030">n</span><span class="op" id="2480031">,</span>&nbsp;<span class="ident" id="2480033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2480038">}</span><br>
<span class="lineno">230</span><span class="op" id="2480040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2480043">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2480114">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2480178">func</span>&nbsp;<span class="op" id="2480183">(</span><span class="ident" id="2480184">f</span>&nbsp;<span class="op" id="2480186">*</span><span class="ident" id="2480187">File</span><span class="op" id="2480191">)</span>&nbsp;<span class="ident" id="2480193">pwrite</span><span class="op" id="2480199">(</span><span class="ident" id="2480200">b</span>&nbsp;<span class="op" id="2480202">[</span><span class="op" id="2480203">]</span><span class="builtintype" id="2480204">byte</span><span class="op" id="2480208">,</span>&nbsp;<span class="ident" id="2480210">off</span>&nbsp;<span class="ident" id="2480214">int64</span><span class="op" id="2480219">)</span>&nbsp;<span class="op" id="2480221">(</span><span class="ident" id="2480222">n</span>&nbsp;<span class="builtintype" id="2480224">int</span><span class="op" id="2480227">,</span>&nbsp;<span class="ident" id="2480229">err</span>&nbsp;<span class="builtintype" id="2480233">error</span><span class="op" id="2480238">)</span>&nbsp;<span class="op" id="2480240">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480243">if</span>&nbsp;<span class="ident" id="2480246">needsMaxRW</span>&nbsp;<span class="op" id="2480257">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2480260">len</span><span class="op" id="2480263">(</span><span class="ident" id="2480264">b</span><span class="op" id="2480265">)</span>&nbsp;<span class="op" id="2480267">&gt;</span>&nbsp;<span class="ident" id="2480269">maxRW</span>&nbsp;<span class="op" id="2480275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2480279">b</span>&nbsp;<span class="op" id="2480281">=</span>&nbsp;<span class="ident" id="2480283">b</span><span class="op" id="2480284">[</span><span class="op" id="2480285">:</span><span class="ident" id="2480286">maxRW</span><span class="op" id="2480291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2480294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480297">return</span>&nbsp;<span class="ident" id="2480304">fixCount</span><span class="op" id="2480312">(</span><span class="ident" id="2480313">syscall</span><span class="op" id="2480320">.</span><span class="ident" id="2480321">Pwrite</span><span class="op" id="2480327">(</span><span class="ident" id="2480328">f</span><span class="op" id="2480329">.</span><span class="ident" id="2480330">fd</span><span class="op" id="2480332">,</span>&nbsp;<span class="ident" id="2480334">b</span><span class="op" id="2480335">,</span>&nbsp;<span class="ident" id="2480337">off</span><span class="op" id="2480340">)</span><span class="op" id="2480341">)</span><br>
<span class="lineno"></span><span class="op" id="2480343">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2480346">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2480428">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2480504">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2480572">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2480623">func</span>&nbsp;<span class="op" id="2480628">(</span><span class="ident" id="2480629">f</span>&nbsp;<span class="op" id="2480631">*</span><span class="ident" id="2480632">File</span><span class="op" id="2480636">)</span>&nbsp;<span class="ident" id="2480638">seek</span><span class="op" id="2480642">(</span><span class="ident" id="2480643">offset</span>&nbsp;<span class="ident" id="2480650">int64</span><span class="op" id="2480655">,</span>&nbsp;<span class="ident" id="2480657">whence</span>&nbsp;<span class="builtintype" id="2480664">int</span><span class="op" id="2480667">)</span>&nbsp;<span class="op" id="2480669">(</span><span class="ident" id="2480670">ret</span>&nbsp;<span class="ident" id="2480674">int64</span><span class="op" id="2480679">,</span>&nbsp;<span class="ident" id="2480681">err</span>&nbsp;<span class="builtintype" id="2480685">error</span><span class="op" id="2480690">)</span>&nbsp;<span class="op" id="2480692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480695">return</span>&nbsp;<span class="ident" id="2480702">syscall</span><span class="op" id="2480709">.</span><span class="ident" id="2480710">Seek</span><span class="op" id="2480714">(</span><span class="ident" id="2480715">f</span><span class="op" id="2480716">.</span><span class="ident" id="2480717">fd</span><span class="op" id="2480719">,</span>&nbsp;<span class="ident" id="2480721">offset</span><span class="op" id="2480727">,</span>&nbsp;<span class="ident" id="2480729">whence</span><span class="op" id="2480735">)</span><br>
<span class="lineno"></span><span class="op" id="2480737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2480740">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2480788">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2480865">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2480921">func</span>&nbsp;<span class="ident" id="2480926">Truncate</span><span class="op" id="2480934">(</span><span class="ident" id="2480935">name</span>&nbsp;<span class="builtintype" id="2480940">string</span><span class="op" id="2480946">,</span>&nbsp;<span class="ident" id="2480948">size</span>&nbsp;<span class="ident" id="2480953">int64</span><span class="op" id="2480958">)</span>&nbsp;<span class="builtintype" id="2480960">error</span>&nbsp;<span class="op" id="2480966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2480969">if</span>&nbsp;<span class="ident" id="2480972">e</span>&nbsp;<span class="op" id="2480974">:=</span>&nbsp;<span class="ident" id="2480977">syscall</span><span class="op" id="2480984">.</span><span class="ident" id="2480985">Truncate</span><span class="op" id="2480993">(</span><span class="ident" id="2480994">name</span><span class="op" id="2480998">,</span>&nbsp;<span class="ident" id="2481000">size</span><span class="op" id="2481004">)</span><span class="op" id="2481005">;</span>&nbsp;<span class="ident" id="2481007">e</span>&nbsp;<span class="op" id="2481009">!=</span>&nbsp;<span class="ident" id="2481012">nil</span>&nbsp;<span class="op" id="2481016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481020">return</span>&nbsp;<span class="op" id="2481027">&amp;</span><span class="ident" id="2481028">PathError</span><span class="op" id="2481037">{</span><span class="string" id="2481038">&#34;truncate&#34;</span><span class="op" id="2481048">,</span>&nbsp;<span class="ident" id="2481050">name</span><span class="op" id="2481054">,</span>&nbsp;<span class="ident" id="2481056">e</span><span class="op" id="2481057">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2481060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481063">return</span>&nbsp;<span class="ident" id="2481070">nil</span><br>
<span class="lineno"></span><span class="op" id="2481074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2481077">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2481124">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2481180">func</span>&nbsp;<span class="ident" id="2481185">Remove</span><span class="op" id="2481191">(</span><span class="ident" id="2481192">name</span>&nbsp;<span class="builtintype" id="2481197">string</span><span class="op" id="2481203">)</span>&nbsp;<span class="builtintype" id="2481205">error</span>&nbsp;<span class="op" id="2481211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481214">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481258">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481299">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481343">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2481380">e</span>&nbsp;<span class="op" id="2481382">:=</span>&nbsp;<span class="ident" id="2481385">syscall</span><span class="op" id="2481392">.</span><span class="ident" id="2481393">Unlink</span><span class="op" id="2481399">(</span><span class="ident" id="2481400">name</span><span class="op" id="2481404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481407">if</span>&nbsp;<span class="ident" id="2481410">e</span>&nbsp;<span class="op" id="2481412">==</span>&nbsp;<span class="ident" id="2481415">nil</span>&nbsp;<span class="op" id="2481419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481423">return</span>&nbsp;<span class="ident" id="2481430">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2481435">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2481438">e1</span>&nbsp;<span class="op" id="2481441">:=</span>&nbsp;<span class="ident" id="2481444">syscall</span><span class="op" id="2481451">.</span><span class="ident" id="2481452">Rmdir</span><span class="op" id="2481457">(</span><span class="ident" id="2481458">name</span><span class="op" id="2481462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481465">if</span>&nbsp;<span class="ident" id="2481468">e1</span>&nbsp;<span class="op" id="2481471">==</span>&nbsp;<span class="ident" id="2481474">nil</span>&nbsp;<span class="op" id="2481478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481482">return</span>&nbsp;<span class="ident" id="2481489">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2481494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481498">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481549">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481598">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481647">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481696">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481750">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481801">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481856">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2481905">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481936">if</span>&nbsp;<span class="ident" id="2481939">e1</span>&nbsp;<span class="op" id="2481942">!=</span>&nbsp;<span class="ident" id="2481945">syscall</span><span class="op" id="2481952">.</span><span class="ident" id="2481953">ENOTDIR</span>&nbsp;<span class="op" id="2481961">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2481965">e</span>&nbsp;<span class="op" id="2481967">=</span>&nbsp;<span class="ident" id="2481969">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2481973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2481976">return</span>&nbsp;<span class="op" id="2481983">&amp;</span><span class="ident" id="2481984">PathError</span><span class="op" id="2481993">{</span><span class="string" id="2481994">&#34;remove&#34;</span><span class="op" id="2482002">,</span>&nbsp;<span class="ident" id="2482004">name</span><span class="op" id="2482008">,</span>&nbsp;<span class="ident" id="2482010">e</span><span class="op" id="2482011">}</span><br>
<span class="lineno"></span><span class="op" id="2482013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2482016">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2482099">func</span>&nbsp;<span class="ident" id="2482104">basename</span><span class="op" id="2482112">(</span><span class="ident" id="2482113">name</span>&nbsp;<span class="builtintype" id="2482118">string</span><span class="op" id="2482124">)</span>&nbsp;<span class="builtintype" id="2482126">string</span>&nbsp;<span class="op" id="2482133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482136">i</span>&nbsp;<span class="op" id="2482138">:=</span>&nbsp;<span class="builtinfunc" id="2482141">len</span><span class="op" id="2482144">(</span><span class="ident" id="2482145">name</span><span class="op" id="2482149">)</span>&nbsp;<span class="op" id="2482151">-</span>&nbsp;<span class="num" id="2482153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2482156">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482184">for</span>&nbsp;<span class="op" id="2482188">;</span>&nbsp;<span class="ident" id="2482190">i</span>&nbsp;<span class="op" id="2482192">&gt;</span>&nbsp;<span class="num" id="2482194">0</span>&nbsp;<span class="op" id="2482196">&amp;&amp;</span>&nbsp;<span class="ident" id="2482199">name</span><span class="op" id="2482203">[</span><span class="ident" id="2482204">i</span><span class="op" id="2482205">]</span>&nbsp;<span class="op" id="2482207">==</span>&nbsp;<span class="string" id="2482210">&#39;/&#39;</span><span class="op" id="2482213">;</span>&nbsp;<span class="ident" id="2482215">i</span><span class="op" id="2482216">--</span>&nbsp;<span class="op" id="2482219">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482223">name</span>&nbsp;<span class="op" id="2482228">=</span>&nbsp;<span class="ident" id="2482230">name</span><span class="op" id="2482234">[</span><span class="op" id="2482235">:</span><span class="ident" id="2482236">i</span><span class="op" id="2482237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2482243">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482277">for</span>&nbsp;<span class="ident" id="2482281">i</span><span class="op" id="2482282">--</span><span class="op" id="2482284">;</span>&nbsp;<span class="ident" id="2482286">i</span>&nbsp;<span class="op" id="2482288">&gt;=</span>&nbsp;<span class="num" id="2482291">0</span><span class="op" id="2482292">;</span>&nbsp;<span class="ident" id="2482294">i</span><span class="op" id="2482295">--</span>&nbsp;<span class="op" id="2482298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482302">if</span>&nbsp;<span class="ident" id="2482305">name</span><span class="op" id="2482309">[</span><span class="ident" id="2482310">i</span><span class="op" id="2482311">]</span>&nbsp;<span class="op" id="2482313">==</span>&nbsp;<span class="string" id="2482316">&#39;/&#39;</span>&nbsp;<span class="op" id="2482320">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482325">name</span>&nbsp;<span class="op" id="2482330">=</span>&nbsp;<span class="ident" id="2482332">name</span><span class="op" id="2482336">[</span><span class="ident" id="2482337">i</span><span class="op" id="2482338">+</span><span class="num" id="2482339">1</span><span class="op" id="2482340">:</span><span class="op" id="2482341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482346">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482361">return</span>&nbsp;<span class="ident" id="2482368">name</span><br>
<span class="lineno"></span><span class="op" id="2482373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2482376">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2482445">func</span>&nbsp;<span class="ident" id="2482450">TempDir</span><span class="op" id="2482457">(</span><span class="op" id="2482458">)</span>&nbsp;<span class="builtintype" id="2482460">string</span>&nbsp;<span class="op" id="2482467">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482470">dir</span>&nbsp;<span class="op" id="2482474">:=</span>&nbsp;<span class="ident" id="2482477">Getenv</span><span class="op" id="2482483">(</span><span class="string" id="2482484">&#34;TMPDIR&#34;</span><span class="op" id="2482492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482495">if</span>&nbsp;<span class="ident" id="2482498">dir</span>&nbsp;<span class="op" id="2482502">==</span>&nbsp;<span class="string" id="2482505">&#34;&#34;</span>&nbsp;<span class="op" id="2482508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482512">if</span>&nbsp;<span class="ident" id="2482515">runtime</span><span class="op" id="2482522">.</span><span class="ident" id="2482523">GOOS</span>&nbsp;<span class="op" id="2482528">==</span>&nbsp;<span class="string" id="2482531">&#34;android&#34;</span>&nbsp;<span class="op" id="2482541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482546">dir</span>&nbsp;<span class="op" id="2482550">=</span>&nbsp;<span class="string" id="2482552">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482572">}</span>&nbsp;<span class="keyword" id="2482574">else</span>&nbsp;<span class="op" id="2482579">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482584">dir</span>&nbsp;<span class="op" id="2482588">=</span>&nbsp;<span class="string" id="2482590">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482605">return</span>&nbsp;<span class="ident" id="2482612">dir</span><br>
<span class="lineno"></span><span class="op" id="2482616">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2482619">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2482679">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2482735">func</span>&nbsp;<span class="ident" id="2482740">Link</span><span class="op" id="2482744">(</span><span class="ident" id="2482745">oldname</span><span class="op" id="2482752">,</span>&nbsp;<span class="ident" id="2482754">newname</span>&nbsp;<span class="builtintype" id="2482762">string</span><span class="op" id="2482768">)</span>&nbsp;<span class="builtintype" id="2482770">error</span>&nbsp;<span class="op" id="2482776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2482779">e</span>&nbsp;<span class="op" id="2482781">:=</span>&nbsp;<span class="ident" id="2482784">syscall</span><span class="op" id="2482791">.</span><span class="ident" id="2482792">Link</span><span class="op" id="2482796">(</span><span class="ident" id="2482797">oldname</span><span class="op" id="2482804">,</span>&nbsp;<span class="ident" id="2482806">newname</span><span class="op" id="2482813">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482816">if</span>&nbsp;<span class="ident" id="2482819">e</span>&nbsp;<span class="op" id="2482821">!=</span>&nbsp;<span class="ident" id="2482824">nil</span>&nbsp;<span class="op" id="2482828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482832">return</span>&nbsp;<span class="op" id="2482839">&amp;</span><span class="ident" id="2482840">LinkError</span><span class="op" id="2482849">{</span><span class="string" id="2482850">&#34;link&#34;</span><span class="op" id="2482856">,</span>&nbsp;<span class="ident" id="2482858">oldname</span><span class="op" id="2482865">,</span>&nbsp;<span class="ident" id="2482867">newname</span><span class="op" id="2482874">,</span>&nbsp;<span class="ident" id="2482876">e</span><span class="op" id="2482877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2482880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2482883">return</span>&nbsp;<span class="ident" id="2482890">nil</span><br>
<span class="lineno"></span><span class="op" id="2482894">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2482897">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2482955">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2483011">func</span>&nbsp;<span class="ident" id="2483016">Symlink</span><span class="op" id="2483023">(</span><span class="ident" id="2483024">oldname</span><span class="op" id="2483031">,</span>&nbsp;<span class="ident" id="2483033">newname</span>&nbsp;<span class="builtintype" id="2483041">string</span><span class="op" id="2483047">)</span>&nbsp;<span class="builtintype" id="2483049">error</span>&nbsp;<span class="op" id="2483055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483058">e</span>&nbsp;<span class="op" id="2483060">:=</span>&nbsp;<span class="ident" id="2483063">syscall</span><span class="op" id="2483070">.</span><span class="ident" id="2483071">Symlink</span><span class="op" id="2483078">(</span><span class="ident" id="2483079">oldname</span><span class="op" id="2483086">,</span>&nbsp;<span class="ident" id="2483088">newname</span><span class="op" id="2483095">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2483098">if</span>&nbsp;<span class="ident" id="2483101">e</span>&nbsp;<span class="op" id="2483103">!=</span>&nbsp;<span class="ident" id="2483106">nil</span>&nbsp;<span class="op" id="2483110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2483114">return</span>&nbsp;<span class="op" id="2483121">&amp;</span><span class="ident" id="2483122">LinkError</span><span class="op" id="2483131">{</span><span class="string" id="2483132">&#34;symlink&#34;</span><span class="op" id="2483141">,</span>&nbsp;<span class="ident" id="2483143">oldname</span><span class="op" id="2483150">,</span>&nbsp;<span class="ident" id="2483152">newname</span><span class="op" id="2483159">,</span>&nbsp;<span class="ident" id="2483161">e</span><span class="op" id="2483162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2483165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2483168">return</span>&nbsp;<span class="ident" id="2483175">nil</span><br>
<span class="lineno"></span><span class="op" id="2483179">}</span>
</div>
</body>
</html>
