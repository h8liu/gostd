<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8094157">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8094212">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8094266">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8094317">package</span>&nbsp;<span class="ident" id="8094325">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094330">import</span>&nbsp;<span class="op" id="8094337">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094340">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094349">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094358">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094373">_</span>&nbsp;<span class="string" id="8094375">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094388">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094401">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094414">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8094420">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8094430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094433">func</span>&nbsp;<span class="ident" id="8094438">readImg</span><span class="op" id="8094445">(</span><span class="ident" id="8094446">filename</span>&nbsp;<span class="builtintype" id="8094455">string</span><span class="op" id="8094461">)</span>&nbsp;<span class="op" id="8094463">(</span><span class="ident" id="8094464">image</span><span class="op" id="8094469">.</span><span class="ident" id="8094470">Image</span><span class="op" id="8094475">,</span>&nbsp;<span class="builtintype" id="8094477">error</span><span class="op" id="8094482">)</span>&nbsp;<span class="op" id="8094484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094487">f</span><span class="op" id="8094488">,</span>&nbsp;<span class="ident" id="8094490">err</span>&nbsp;<span class="op" id="8094494">:=</span>&nbsp;<span class="ident" id="8094497">os</span><span class="op" id="8094499">.</span><span class="ident" id="8094500">Open</span><span class="op" id="8094504">(</span><span class="ident" id="8094505">filename</span><span class="op" id="8094513">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094516">if</span>&nbsp;<span class="ident" id="8094519">err</span>&nbsp;<span class="op" id="8094523">!=</span>&nbsp;<span class="builtintype" id="8094526">nil</span>&nbsp;<span class="op" id="8094530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094534">return</span>&nbsp;<span class="builtintype" id="8094541">nil</span><span class="op" id="8094544">,</span>&nbsp;<span class="ident" id="8094546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8094551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094554">defer</span>&nbsp;<span class="ident" id="8094560">f</span><span class="op" id="8094561">.</span><span class="ident" id="8094562">Close</span><span class="op" id="8094567">(</span><span class="op" id="8094568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094571">m</span><span class="op" id="8094572">,</span>&nbsp;<span class="ident" id="8094574">_</span><span class="op" id="8094575">,</span>&nbsp;<span class="ident" id="8094577">err</span>&nbsp;<span class="op" id="8094581">:=</span>&nbsp;<span class="ident" id="8094584">image</span><span class="op" id="8094589">.</span><span class="ident" id="8094590">Decode</span><span class="op" id="8094596">(</span><span class="ident" id="8094597">f</span><span class="op" id="8094598">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094601">return</span>&nbsp;<span class="ident" id="8094608">m</span><span class="op" id="8094609">,</span>&nbsp;<span class="ident" id="8094611">err</span><br>
<span class="lineno"></span><span class="op" id="8094615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094618">func</span>&nbsp;<span class="ident" id="8094623">readGIF</span><span class="op" id="8094630">(</span><span class="ident" id="8094631">filename</span>&nbsp;<span class="builtintype" id="8094640">string</span><span class="op" id="8094646">)</span>&nbsp;<span class="op" id="8094648">(</span><span class="op" id="8094649">*</span><span class="ident" id="8094650">GIF</span><span class="op" id="8094653">,</span>&nbsp;<span class="builtintype" id="8094655">error</span><span class="op" id="8094660">)</span>&nbsp;<span class="op" id="8094662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094665">f</span><span class="op" id="8094666">,</span>&nbsp;<span class="ident" id="8094668">err</span>&nbsp;<span class="op" id="8094672">:=</span>&nbsp;<span class="ident" id="8094675">os</span><span class="op" id="8094677">.</span><span class="ident" id="8094678">Open</span><span class="op" id="8094682">(</span><span class="ident" id="8094683">filename</span><span class="op" id="8094691">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094694">if</span>&nbsp;<span class="ident" id="8094697">err</span>&nbsp;<span class="op" id="8094701">!=</span>&nbsp;<span class="builtintype" id="8094704">nil</span>&nbsp;<span class="op" id="8094708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094712">return</span>&nbsp;<span class="builtintype" id="8094719">nil</span><span class="op" id="8094722">,</span>&nbsp;<span class="ident" id="8094724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8094729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094732">defer</span>&nbsp;<span class="ident" id="8094738">f</span><span class="op" id="8094739">.</span><span class="ident" id="8094740">Close</span><span class="op" id="8094745">(</span><span class="op" id="8094746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094749">return</span>&nbsp;<span class="ident" id="8094756">DecodeAll</span><span class="op" id="8094765">(</span><span class="ident" id="8094766">f</span><span class="op" id="8094767">)</span><br>
<span class="lineno">35</span><span class="op" id="8094769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094772">func</span>&nbsp;<span class="ident" id="8094777">delta</span><span class="op" id="8094782">(</span><span class="ident" id="8094783">u0</span><span class="op" id="8094785">,</span>&nbsp;<span class="ident" id="8094787">u1</span>&nbsp;<span class="builtintype" id="8094790">uint32</span><span class="op" id="8094796">)</span>&nbsp;<span class="ident" id="8094798">int64</span>&nbsp;<span class="op" id="8094804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8094807">d</span>&nbsp;<span class="op" id="8094809">:=</span>&nbsp;<span class="ident" id="8094812">int64</span><span class="op" id="8094817">(</span><span class="ident" id="8094818">u0</span><span class="op" id="8094820">)</span>&nbsp;<span class="op" id="8094822">-</span>&nbsp;<span class="ident" id="8094824">int64</span><span class="op" id="8094829">(</span><span class="ident" id="8094830">u1</span><span class="op" id="8094832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094835">if</span>&nbsp;<span class="ident" id="8094838">d</span>&nbsp;<span class="op" id="8094840">&lt;</span>&nbsp;<span class="num" id="8094842">0</span>&nbsp;<span class="op" id="8094844">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094848">return</span>&nbsp;<span class="op" id="8094855">-</span><span class="ident" id="8094856">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8094859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8094862">return</span>&nbsp;<span class="ident" id="8094869">d</span><br>
<span class="lineno"></span><span class="op" id="8094871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="8094874">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="8094950">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8094975">func</span>&nbsp;<span class="ident" id="8094980">averageDelta</span><span class="op" id="8094992">(</span><span class="ident" id="8094993">m0</span><span class="op" id="8094995">,</span>&nbsp;<span class="ident" id="8094997">m1</span>&nbsp;<span class="ident" id="8095000">image</span><span class="op" id="8095005">.</span><span class="ident" id="8095006">Image</span><span class="op" id="8095011">)</span>&nbsp;<span class="ident" id="8095013">int64</span>&nbsp;<span class="op" id="8095019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095022">b</span>&nbsp;<span class="op" id="8095024">:=</span>&nbsp;<span class="ident" id="8095027">m0</span><span class="op" id="8095029">.</span><span class="ident" id="8095030">Bounds</span><span class="op" id="8095036">(</span><span class="op" id="8095037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095040">var</span>&nbsp;<span class="ident" id="8095044">sum</span><span class="op" id="8095047">,</span>&nbsp;<span class="ident" id="8095049">n</span>&nbsp;<span class="ident" id="8095051">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095058">for</span>&nbsp;<span class="ident" id="8095062">y</span>&nbsp;<span class="op" id="8095064">:=</span>&nbsp;<span class="ident" id="8095067">b</span><span class="op" id="8095068">.</span><span class="ident" id="8095069">Min</span><span class="op" id="8095072">.</span><span class="ident" id="8095073">Y</span><span class="op" id="8095074">;</span>&nbsp;<span class="ident" id="8095076">y</span>&nbsp;<span class="op" id="8095078">&lt;</span>&nbsp;<span class="ident" id="8095080">b</span><span class="op" id="8095081">.</span><span class="ident" id="8095082">Max</span><span class="op" id="8095085">.</span><span class="ident" id="8095086">Y</span><span class="op" id="8095087">;</span>&nbsp;<span class="ident" id="8095089">y</span><span class="op" id="8095090">++</span>&nbsp;<span class="op" id="8095093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095097">for</span>&nbsp;<span class="ident" id="8095101">x</span>&nbsp;<span class="op" id="8095103">:=</span>&nbsp;<span class="ident" id="8095106">b</span><span class="op" id="8095107">.</span><span class="ident" id="8095108">Min</span><span class="op" id="8095111">.</span><span class="ident" id="8095112">X</span><span class="op" id="8095113">;</span>&nbsp;<span class="ident" id="8095115">x</span>&nbsp;<span class="op" id="8095117">&lt;</span>&nbsp;<span class="ident" id="8095119">b</span><span class="op" id="8095120">.</span><span class="ident" id="8095121">Max</span><span class="op" id="8095124">.</span><span class="ident" id="8095125">X</span><span class="op" id="8095126">;</span>&nbsp;<span class="ident" id="8095128">x</span><span class="op" id="8095129">++</span>&nbsp;<span class="op" id="8095132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095137">c0</span>&nbsp;<span class="op" id="8095140">:=</span>&nbsp;<span class="ident" id="8095143">m0</span><span class="op" id="8095145">.</span><span class="ident" id="8095146">At</span><span class="op" id="8095148">(</span><span class="ident" id="8095149">x</span><span class="op" id="8095150">,</span>&nbsp;<span class="ident" id="8095152">y</span><span class="op" id="8095153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095158">c1</span>&nbsp;<span class="op" id="8095161">:=</span>&nbsp;<span class="ident" id="8095164">m1</span><span class="op" id="8095166">.</span><span class="ident" id="8095167">At</span><span class="op" id="8095169">(</span><span class="ident" id="8095170">x</span><span class="op" id="8095171">,</span>&nbsp;<span class="ident" id="8095173">y</span><span class="op" id="8095174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095179">r0</span><span class="op" id="8095181">,</span>&nbsp;<span class="ident" id="8095183">g0</span><span class="op" id="8095185">,</span>&nbsp;<span class="ident" id="8095187">b0</span><span class="op" id="8095189">,</span>&nbsp;<span class="ident" id="8095191">_</span>&nbsp;<span class="op" id="8095193">:=</span>&nbsp;<span class="ident" id="8095196">c0</span><span class="op" id="8095198">.</span><span class="ident" id="8095199">RGBA</span><span class="op" id="8095203">(</span><span class="op" id="8095204">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095209">r1</span><span class="op" id="8095211">,</span>&nbsp;<span class="ident" id="8095213">g1</span><span class="op" id="8095215">,</span>&nbsp;<span class="ident" id="8095217">b1</span><span class="op" id="8095219">,</span>&nbsp;<span class="ident" id="8095221">_</span>&nbsp;<span class="op" id="8095223">:=</span>&nbsp;<span class="ident" id="8095226">c1</span><span class="op" id="8095228">.</span><span class="ident" id="8095229">RGBA</span><span class="op" id="8095233">(</span><span class="op" id="8095234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095239">sum</span>&nbsp;<span class="op" id="8095243">+=</span>&nbsp;<span class="ident" id="8095246">delta</span><span class="op" id="8095251">(</span><span class="ident" id="8095252">r0</span><span class="op" id="8095254">,</span>&nbsp;<span class="ident" id="8095256">r1</span><span class="op" id="8095258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095263">sum</span>&nbsp;<span class="op" id="8095267">+=</span>&nbsp;<span class="ident" id="8095270">delta</span><span class="op" id="8095275">(</span><span class="ident" id="8095276">g0</span><span class="op" id="8095278">,</span>&nbsp;<span class="ident" id="8095280">g1</span><span class="op" id="8095282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095287">sum</span>&nbsp;<span class="op" id="8095291">+=</span>&nbsp;<span class="ident" id="8095294">delta</span><span class="op" id="8095299">(</span><span class="ident" id="8095300">b0</span><span class="op" id="8095302">,</span>&nbsp;<span class="ident" id="8095304">b1</span><span class="op" id="8095306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095311">n</span>&nbsp;<span class="op" id="8095313">+=</span>&nbsp;<span class="num" id="8095316">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095326">return</span>&nbsp;<span class="ident" id="8095333">sum</span>&nbsp;<span class="op" id="8095337">/</span>&nbsp;<span class="ident" id="8095339">n</span><br>
<span class="lineno"></span><span class="op" id="8095341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8095344">var</span>&nbsp;<span class="ident" id="8095348">testCase</span>&nbsp;<span class="op" id="8095357">=</span>&nbsp;<span class="op" id="8095359">[</span><span class="op" id="8095360">]</span><span class="keyword" id="8095361">struct</span>&nbsp;<span class="op" id="8095368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095371">filename</span>&nbsp;&nbsp;<span class="builtintype" id="8095381">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095389">tolerance</span>&nbsp;<span class="ident" id="8095399">int64</span><br>
<span class="lineno"></span><span class="op" id="8095405">}</span><span class="op" id="8095406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095409">{</span><span class="string" id="8095410">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8095437">,</span>&nbsp;<span class="num" id="8095439">1</span>&nbsp;<span class="op" id="8095441">&lt;&lt;</span>&nbsp;<span class="num" id="8095444">12</span><span class="op" id="8095446">}</span><span class="op" id="8095447">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095450">{</span><span class="string" id="8095451">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8095478">,</span>&nbsp;<span class="num" id="8095480">0</span><span class="op" id="8095481">}</span><span class="op" id="8095482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095485">{</span><span class="string" id="8095486">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="8095524">,</span>&nbsp;<span class="num" id="8095526">0</span><span class="op" id="8095527">}</span><span class="op" id="8095528">,</span><br>
<span class="lineno"></span><span class="op" id="8095530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8095533">func</span>&nbsp;<span class="ident" id="8095538">TestWriter</span><span class="op" id="8095548">(</span><span class="ident" id="8095549">t</span>&nbsp;<span class="op" id="8095551">*</span><span class="ident" id="8095552">testing</span><span class="op" id="8095559">.</span><span class="ident" id="8095560">T</span><span class="op" id="8095561">)</span>&nbsp;<span class="op" id="8095563">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095566">for</span>&nbsp;<span class="ident" id="8095570">_</span><span class="op" id="8095571">,</span>&nbsp;<span class="ident" id="8095573">tc</span>&nbsp;<span class="op" id="8095576">:=</span>&nbsp;<span class="keyword" id="8095579">range</span>&nbsp;<span class="ident" id="8095585">testCase</span>&nbsp;<span class="op" id="8095594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095598">m0</span><span class="op" id="8095600">,</span>&nbsp;<span class="ident" id="8095602">err</span>&nbsp;<span class="op" id="8095606">:=</span>&nbsp;<span class="ident" id="8095609">readImg</span><span class="op" id="8095616">(</span><span class="ident" id="8095617">tc</span><span class="op" id="8095619">.</span><span class="ident" id="8095620">filename</span><span class="op" id="8095628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095632">if</span>&nbsp;<span class="ident" id="8095635">err</span>&nbsp;<span class="op" id="8095639">!=</span>&nbsp;<span class="builtintype" id="8095642">nil</span>&nbsp;<span class="op" id="8095646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095651">t</span><span class="op" id="8095652">.</span><span class="ident" id="8095653">Error</span><span class="op" id="8095658">(</span><span class="ident" id="8095659">tc</span><span class="op" id="8095661">.</span><span class="ident" id="8095662">filename</span><span class="op" id="8095670">,</span>&nbsp;<span class="ident" id="8095672">err</span><span class="op" id="8095675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095680">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095695">var</span>&nbsp;<span class="ident" id="8095699">buf</span>&nbsp;<span class="ident" id="8095703">bytes</span><span class="op" id="8095708">.</span><span class="ident" id="8095709">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095718">err</span>&nbsp;<span class="op" id="8095722">=</span>&nbsp;<span class="ident" id="8095724">Encode</span><span class="op" id="8095730">(</span><span class="op" id="8095731">&amp;</span><span class="ident" id="8095732">buf</span><span class="op" id="8095735">,</span>&nbsp;<span class="ident" id="8095737">m0</span><span class="op" id="8095739">,</span>&nbsp;<span class="builtintype" id="8095741">nil</span><span class="op" id="8095744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095748">if</span>&nbsp;<span class="ident" id="8095751">err</span>&nbsp;<span class="op" id="8095755">!=</span>&nbsp;<span class="builtintype" id="8095758">nil</span>&nbsp;<span class="op" id="8095762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095767">t</span><span class="op" id="8095768">.</span><span class="ident" id="8095769">Error</span><span class="op" id="8095774">(</span><span class="ident" id="8095775">tc</span><span class="op" id="8095777">.</span><span class="ident" id="8095778">filename</span><span class="op" id="8095786">,</span>&nbsp;<span class="ident" id="8095788">err</span><span class="op" id="8095791">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095796">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095811">m1</span><span class="op" id="8095813">,</span>&nbsp;<span class="ident" id="8095815">err</span>&nbsp;<span class="op" id="8095819">:=</span>&nbsp;<span class="ident" id="8095822">Decode</span><span class="op" id="8095828">(</span><span class="op" id="8095829">&amp;</span><span class="ident" id="8095830">buf</span><span class="op" id="8095833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095837">if</span>&nbsp;<span class="ident" id="8095840">err</span>&nbsp;<span class="op" id="8095844">!=</span>&nbsp;<span class="builtintype" id="8095847">nil</span>&nbsp;<span class="op" id="8095851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095856">t</span><span class="op" id="8095857">.</span><span class="ident" id="8095858">Error</span><span class="op" id="8095863">(</span><span class="ident" id="8095864">tc</span><span class="op" id="8095866">.</span><span class="ident" id="8095867">filename</span><span class="op" id="8095875">,</span>&nbsp;<span class="ident" id="8095877">err</span><span class="op" id="8095880">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095885">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8095896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8095900">if</span>&nbsp;<span class="ident" id="8095903">m0</span><span class="op" id="8095905">.</span><span class="ident" id="8095906">Bounds</span><span class="op" id="8095912">(</span><span class="op" id="8095913">)</span>&nbsp;<span class="op" id="8095915">!=</span>&nbsp;<span class="ident" id="8095918">m1</span><span class="op" id="8095920">.</span><span class="ident" id="8095921">Bounds</span><span class="op" id="8095927">(</span><span class="op" id="8095928">)</span>&nbsp;<span class="op" id="8095930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8095935">t</span><span class="op" id="8095936">.</span><span class="ident" id="8095937">Errorf</span><span class="op" id="8095943">(</span><span class="string" id="8095944">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8095974">,</span>&nbsp;<span class="ident" id="8095976">tc</span><span class="op" id="8095978">.</span><span class="ident" id="8095979">filename</span><span class="op" id="8095987">,</span>&nbsp;<span class="ident" id="8095989">m0</span><span class="op" id="8095991">.</span><span class="ident" id="8095992">Bounds</span><span class="op" id="8095998">(</span><span class="op" id="8095999">)</span><span class="op" id="8096000">,</span>&nbsp;<span class="ident" id="8096002">m1</span><span class="op" id="8096004">.</span><span class="ident" id="8096005">Bounds</span><span class="op" id="8096011">(</span><span class="op" id="8096012">)</span><span class="op" id="8096013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096018">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8096033">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096088">avgDelta</span>&nbsp;<span class="op" id="8096097">:=</span>&nbsp;<span class="ident" id="8096100">averageDelta</span><span class="op" id="8096112">(</span><span class="ident" id="8096113">m0</span><span class="op" id="8096115">,</span>&nbsp;<span class="ident" id="8096117">m1</span><span class="op" id="8096119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096123">if</span>&nbsp;<span class="ident" id="8096126">avgDelta</span>&nbsp;<span class="op" id="8096135">&gt;</span>&nbsp;<span class="ident" id="8096137">tc</span><span class="op" id="8096139">.</span><span class="ident" id="8096140">tolerance</span>&nbsp;<span class="op" id="8096150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096155">t</span><span class="op" id="8096156">.</span><span class="ident" id="8096157">Errorf</span><span class="op" id="8096163">(</span><span class="string" id="8096164">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8096217">,</span>&nbsp;<span class="ident" id="8096219">tc</span><span class="op" id="8096221">.</span><span class="ident" id="8096222">filename</span><span class="op" id="8096230">,</span>&nbsp;<span class="ident" id="8096232">tc</span><span class="op" id="8096234">.</span><span class="ident" id="8096235">tolerance</span><span class="op" id="8096244">,</span>&nbsp;<span class="ident" id="8096246">avgDelta</span><span class="op" id="8096254">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096259">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096273">}</span><br>
<span class="lineno"></span><span class="op" id="8096275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8096278">func</span>&nbsp;<span class="ident" id="8096283">TestSubImage</span><span class="op" id="8096295">(</span><span class="ident" id="8096296">t</span>&nbsp;<span class="op" id="8096298">*</span><span class="ident" id="8096299">testing</span><span class="op" id="8096306">.</span><span class="ident" id="8096307">T</span><span class="op" id="8096308">)</span>&nbsp;<span class="op" id="8096310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096313">m0</span><span class="op" id="8096315">,</span>&nbsp;<span class="ident" id="8096317">err</span>&nbsp;<span class="op" id="8096321">:=</span>&nbsp;<span class="ident" id="8096324">readImg</span><span class="op" id="8096331">(</span><span class="string" id="8096332">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8096359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096362">if</span>&nbsp;<span class="ident" id="8096365">err</span>&nbsp;<span class="op" id="8096369">!=</span>&nbsp;<span class="builtintype" id="8096372">nil</span>&nbsp;<span class="op" id="8096376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096380">t</span><span class="op" id="8096381">.</span><span class="ident" id="8096382">Fatalf</span><span class="op" id="8096388">(</span><span class="string" id="8096389">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="8096402">,</span>&nbsp;<span class="ident" id="8096404">err</span><span class="op" id="8096407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096410">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096413">m0</span>&nbsp;<span class="op" id="8096416">=</span>&nbsp;<span class="ident" id="8096418">m0</span><span class="op" id="8096420">.</span><span class="op" id="8096421">(</span><span class="op" id="8096422">*</span><span class="ident" id="8096423">image</span><span class="op" id="8096428">.</span><span class="ident" id="8096429">Paletted</span><span class="op" id="8096437">)</span><span class="op" id="8096438">.</span><span class="ident" id="8096439">SubImage</span><span class="op" id="8096447">(</span><span class="ident" id="8096448">image</span><span class="op" id="8096453">.</span><span class="ident" id="8096454">Rect</span><span class="op" id="8096458">(</span><span class="num" id="8096459">0</span><span class="op" id="8096460">,</span>&nbsp;<span class="num" id="8096462">0</span><span class="op" id="8096463">,</span>&nbsp;<span class="num" id="8096465">50</span><span class="op" id="8096467">,</span>&nbsp;<span class="num" id="8096469">30</span><span class="op" id="8096471">)</span><span class="op" id="8096472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096475">var</span>&nbsp;<span class="ident" id="8096479">buf</span>&nbsp;<span class="ident" id="8096483">bytes</span><span class="op" id="8096488">.</span><span class="ident" id="8096489">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096497">err</span>&nbsp;<span class="op" id="8096501">=</span>&nbsp;<span class="ident" id="8096503">Encode</span><span class="op" id="8096509">(</span><span class="op" id="8096510">&amp;</span><span class="ident" id="8096511">buf</span><span class="op" id="8096514">,</span>&nbsp;<span class="ident" id="8096516">m0</span><span class="op" id="8096518">,</span>&nbsp;<span class="builtintype" id="8096520">nil</span><span class="op" id="8096523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096526">if</span>&nbsp;<span class="ident" id="8096529">err</span>&nbsp;<span class="op" id="8096533">!=</span>&nbsp;<span class="builtintype" id="8096536">nil</span>&nbsp;<span class="op" id="8096540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096544">t</span><span class="op" id="8096545">.</span><span class="ident" id="8096546">Fatalf</span><span class="op" id="8096552">(</span><span class="string" id="8096553">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="8096565">,</span>&nbsp;<span class="ident" id="8096567">err</span><span class="op" id="8096570">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096576">m1</span><span class="op" id="8096578">,</span>&nbsp;<span class="ident" id="8096580">err</span>&nbsp;<span class="op" id="8096584">:=</span>&nbsp;<span class="ident" id="8096587">Decode</span><span class="op" id="8096593">(</span><span class="op" id="8096594">&amp;</span><span class="ident" id="8096595">buf</span><span class="op" id="8096598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096601">if</span>&nbsp;<span class="ident" id="8096604">err</span>&nbsp;<span class="op" id="8096608">!=</span>&nbsp;<span class="builtintype" id="8096611">nil</span>&nbsp;<span class="op" id="8096615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096619">t</span><span class="op" id="8096620">.</span><span class="ident" id="8096621">Fatalf</span><span class="op" id="8096627">(</span><span class="string" id="8096628">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8096640">,</span>&nbsp;<span class="ident" id="8096642">err</span><span class="op" id="8096645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096648">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096651">if</span>&nbsp;<span class="ident" id="8096654">m0</span><span class="op" id="8096656">.</span><span class="ident" id="8096657">Bounds</span><span class="op" id="8096663">(</span><span class="op" id="8096664">)</span>&nbsp;<span class="op" id="8096666">!=</span>&nbsp;<span class="ident" id="8096669">m1</span><span class="op" id="8096671">.</span><span class="ident" id="8096672">Bounds</span><span class="op" id="8096678">(</span><span class="op" id="8096679">)</span>&nbsp;<span class="op" id="8096681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096685">t</span><span class="op" id="8096686">.</span><span class="ident" id="8096687">Fatalf</span><span class="op" id="8096693">(</span><span class="string" id="8096694">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8096720">,</span>&nbsp;<span class="ident" id="8096722">m0</span><span class="op" id="8096724">.</span><span class="ident" id="8096725">Bounds</span><span class="op" id="8096731">(</span><span class="op" id="8096732">)</span><span class="op" id="8096733">,</span>&nbsp;<span class="ident" id="8096735">m1</span><span class="op" id="8096737">.</span><span class="ident" id="8096738">Bounds</span><span class="op" id="8096744">(</span><span class="op" id="8096745">)</span><span class="op" id="8096746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8096752">if</span>&nbsp;<span class="ident" id="8096755">averageDelta</span><span class="op" id="8096767">(</span><span class="ident" id="8096768">m0</span><span class="op" id="8096770">,</span>&nbsp;<span class="ident" id="8096772">m1</span><span class="op" id="8096774">)</span>&nbsp;<span class="op" id="8096776">!=</span>&nbsp;<span class="num" id="8096779">0</span>&nbsp;<span class="op" id="8096781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096785">t</span><span class="op" id="8096786">.</span><span class="ident" id="8096787">Fatalf</span><span class="op" id="8096793">(</span><span class="string" id="8096794">&#34;images&nbsp;differ&#34;</span><span class="op" id="8096809">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8096812">}</span><br>
<span class="lineno"></span><span class="op" id="8096814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096817">var</span>&nbsp;<span class="ident" id="8096821">frames</span>&nbsp;<span class="op" id="8096828">=</span>&nbsp;<span class="op" id="8096830">[</span><span class="op" id="8096831">]</span><span class="builtintype" id="8096832">string</span><span class="op" id="8096838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8096841">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8096868">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8096871">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="8096903">,</span><br>
<span class="lineno"></span><span class="op" id="8096905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096908">func</span>&nbsp;<span class="ident" id="8096913">TestEncodeAll</span><span class="op" id="8096926">(</span><span class="ident" id="8096927">t</span>&nbsp;<span class="op" id="8096929">*</span><span class="ident" id="8096930">testing</span><span class="op" id="8096937">.</span><span class="ident" id="8096938">T</span><span class="op" id="8096939">)</span>&nbsp;<span class="op" id="8096941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096944">g0</span>&nbsp;<span class="op" id="8096947">:=</span>&nbsp;<span class="op" id="8096950">&amp;</span><span class="ident" id="8096951">GIF</span><span class="op" id="8096954">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8096958">Image</span><span class="op" id="8096963">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8096969">make</span><span class="op" id="8096973">(</span><span class="op" id="8096974">[</span><span class="op" id="8096975">]</span><span class="op" id="8096976">*</span><span class="ident" id="8096977">image</span><span class="op" id="8096982">.</span><span class="ident" id="8096983">Paletted</span><span class="op" id="8096991">,</span>&nbsp;<span class="builtinfunc" id="8096993">len</span><span class="op" id="8096996">(</span><span class="ident" id="8096997">frames</span><span class="op" id="8097003">)</span><span class="op" id="8097004">)</span><span class="op" id="8097005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097009">Delay</span><span class="op" id="8097014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8097020">make</span><span class="op" id="8097024">(</span><span class="op" id="8097025">[</span><span class="op" id="8097026">]</span><span class="builtintype" id="8097027">int</span><span class="op" id="8097030">,</span>&nbsp;<span class="builtinfunc" id="8097032">len</span><span class="op" id="8097035">(</span><span class="ident" id="8097036">frames</span><span class="op" id="8097042">)</span><span class="op" id="8097043">)</span><span class="op" id="8097044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097048">LoopCount</span><span class="op" id="8097057">:</span>&nbsp;<span class="num" id="8097059">5</span><span class="op" id="8097060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097066">for</span>&nbsp;<span class="ident" id="8097070">i</span><span class="op" id="8097071">,</span>&nbsp;<span class="ident" id="8097073">f</span>&nbsp;<span class="op" id="8097075">:=</span>&nbsp;<span class="keyword" id="8097078">range</span>&nbsp;<span class="ident" id="8097084">frames</span>&nbsp;<span class="op" id="8097091">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097095">m</span><span class="op" id="8097096">,</span>&nbsp;<span class="ident" id="8097098">err</span>&nbsp;<span class="op" id="8097102">:=</span>&nbsp;<span class="ident" id="8097105">readGIF</span><span class="op" id="8097112">(</span><span class="ident" id="8097113">f</span><span class="op" id="8097114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097118">if</span>&nbsp;<span class="ident" id="8097121">err</span>&nbsp;<span class="op" id="8097125">!=</span>&nbsp;<span class="builtintype" id="8097128">nil</span>&nbsp;<span class="op" id="8097132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097137">t</span><span class="op" id="8097138">.</span><span class="ident" id="8097139">Fatal</span><span class="op" id="8097144">(</span><span class="ident" id="8097145">f</span><span class="op" id="8097146">,</span>&nbsp;<span class="ident" id="8097148">err</span><span class="op" id="8097151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097159">g0</span><span class="op" id="8097161">.</span><span class="ident" id="8097162">Image</span><span class="op" id="8097167">[</span><span class="ident" id="8097168">i</span><span class="op" id="8097169">]</span>&nbsp;<span class="op" id="8097171">=</span>&nbsp;<span class="ident" id="8097173">m</span><span class="op" id="8097174">.</span><span class="ident" id="8097175">Image</span><span class="op" id="8097180">[</span><span class="num" id="8097181">0</span><span class="op" id="8097182">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097188">var</span>&nbsp;<span class="ident" id="8097192">buf</span>&nbsp;<span class="ident" id="8097196">bytes</span><span class="op" id="8097201">.</span><span class="ident" id="8097202">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097210">if</span>&nbsp;<span class="ident" id="8097213">err</span>&nbsp;<span class="op" id="8097217">:=</span>&nbsp;<span class="ident" id="8097220">EncodeAll</span><span class="op" id="8097229">(</span><span class="op" id="8097230">&amp;</span><span class="ident" id="8097231">buf</span><span class="op" id="8097234">,</span>&nbsp;<span class="ident" id="8097236">g0</span><span class="op" id="8097238">)</span><span class="op" id="8097239">;</span>&nbsp;<span class="ident" id="8097241">err</span>&nbsp;<span class="op" id="8097245">!=</span>&nbsp;<span class="builtintype" id="8097248">nil</span>&nbsp;<span class="op" id="8097252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097256">t</span><span class="op" id="8097257">.</span><span class="ident" id="8097258">Fatal</span><span class="op" id="8097263">(</span><span class="string" id="8097264">&#34;EncodeAll:&#34;</span><span class="op" id="8097276">,</span>&nbsp;<span class="ident" id="8097278">err</span><span class="op" id="8097281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097284">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097287">g1</span><span class="op" id="8097289">,</span>&nbsp;<span class="ident" id="8097291">err</span>&nbsp;<span class="op" id="8097295">:=</span>&nbsp;<span class="ident" id="8097298">DecodeAll</span><span class="op" id="8097307">(</span><span class="op" id="8097308">&amp;</span><span class="ident" id="8097309">buf</span><span class="op" id="8097312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097315">if</span>&nbsp;<span class="ident" id="8097318">err</span>&nbsp;<span class="op" id="8097322">!=</span>&nbsp;<span class="builtintype" id="8097325">nil</span>&nbsp;<span class="op" id="8097329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097333">t</span><span class="op" id="8097334">.</span><span class="ident" id="8097335">Fatal</span><span class="op" id="8097340">(</span><span class="string" id="8097341">&#34;DecodeAll:&#34;</span><span class="op" id="8097353">,</span>&nbsp;<span class="ident" id="8097355">err</span><span class="op" id="8097358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097364">if</span>&nbsp;<span class="ident" id="8097367">g0</span><span class="op" id="8097369">.</span><span class="ident" id="8097370">LoopCount</span>&nbsp;<span class="op" id="8097380">!=</span>&nbsp;<span class="ident" id="8097383">g1</span><span class="op" id="8097385">.</span><span class="ident" id="8097386">LoopCount</span>&nbsp;<span class="op" id="8097396">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097400">t</span><span class="op" id="8097401">.</span><span class="ident" id="8097402">Errorf</span><span class="op" id="8097408">(</span><span class="string" id="8097409">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8097440">,</span>&nbsp;<span class="ident" id="8097442">g0</span><span class="op" id="8097444">.</span><span class="ident" id="8097445">LoopCount</span><span class="op" id="8097454">,</span>&nbsp;<span class="ident" id="8097456">g1</span><span class="op" id="8097458">.</span><span class="ident" id="8097459">LoopCount</span><span class="op" id="8097468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097474">for</span>&nbsp;<span class="ident" id="8097478">i</span>&nbsp;<span class="op" id="8097480">:=</span>&nbsp;<span class="keyword" id="8097483">range</span>&nbsp;<span class="ident" id="8097489">g0</span><span class="op" id="8097491">.</span><span class="ident" id="8097492">Image</span>&nbsp;<span class="op" id="8097498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097502">m0</span><span class="op" id="8097504">,</span>&nbsp;<span class="ident" id="8097506">m1</span>&nbsp;<span class="op" id="8097509">:=</span>&nbsp;<span class="ident" id="8097512">g0</span><span class="op" id="8097514">.</span><span class="ident" id="8097515">Image</span><span class="op" id="8097520">[</span><span class="ident" id="8097521">i</span><span class="op" id="8097522">]</span><span class="op" id="8097523">,</span>&nbsp;<span class="ident" id="8097525">g1</span><span class="op" id="8097527">.</span><span class="ident" id="8097528">Image</span><span class="op" id="8097533">[</span><span class="ident" id="8097534">i</span><span class="op" id="8097535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097539">if</span>&nbsp;<span class="ident" id="8097542">m0</span><span class="op" id="8097544">.</span><span class="ident" id="8097545">Bounds</span><span class="op" id="8097551">(</span><span class="op" id="8097552">)</span>&nbsp;<span class="op" id="8097554">!=</span>&nbsp;<span class="ident" id="8097557">m1</span><span class="op" id="8097559">.</span><span class="ident" id="8097560">Bounds</span><span class="op" id="8097566">(</span><span class="op" id="8097567">)</span>&nbsp;<span class="op" id="8097569">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097574">t</span><span class="op" id="8097575">.</span><span class="ident" id="8097576">Errorf</span><span class="op" id="8097582">(</span><span class="string" id="8097583">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8097613">,</span>&nbsp;<span class="ident" id="8097615">frames</span><span class="op" id="8097621">[</span><span class="ident" id="8097622">i</span><span class="op" id="8097623">]</span><span class="op" id="8097624">,</span>&nbsp;<span class="ident" id="8097626">m0</span><span class="op" id="8097628">.</span><span class="ident" id="8097629">Bounds</span><span class="op" id="8097635">(</span><span class="op" id="8097636">)</span><span class="op" id="8097637">,</span>&nbsp;<span class="ident" id="8097639">m1</span><span class="op" id="8097641">.</span><span class="ident" id="8097642">Bounds</span><span class="op" id="8097648">(</span><span class="op" id="8097649">)</span><span class="op" id="8097650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097658">d0</span><span class="op" id="8097660">,</span>&nbsp;<span class="ident" id="8097662">d1</span>&nbsp;<span class="op" id="8097665">:=</span>&nbsp;<span class="ident" id="8097668">g0</span><span class="op" id="8097670">.</span><span class="ident" id="8097671">Delay</span><span class="op" id="8097676">[</span><span class="ident" id="8097677">i</span><span class="op" id="8097678">]</span><span class="op" id="8097679">,</span>&nbsp;<span class="ident" id="8097681">g1</span><span class="op" id="8097683">.</span><span class="ident" id="8097684">Delay</span><span class="op" id="8097689">[</span><span class="ident" id="8097690">i</span><span class="op" id="8097691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097695">if</span>&nbsp;<span class="ident" id="8097698">d0</span>&nbsp;<span class="op" id="8097701">!=</span>&nbsp;<span class="ident" id="8097704">d1</span>&nbsp;<span class="op" id="8097707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097712">t</span><span class="op" id="8097713">.</span><span class="ident" id="8097714">Errorf</span><span class="op" id="8097720">(</span><span class="string" id="8097721">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8097757">,</span>&nbsp;<span class="ident" id="8097759">frames</span><span class="op" id="8097765">[</span><span class="ident" id="8097766">i</span><span class="op" id="8097767">]</span><span class="op" id="8097768">,</span>&nbsp;<span class="ident" id="8097770">d0</span><span class="op" id="8097772">,</span>&nbsp;<span class="ident" id="8097774">d1</span><span class="op" id="8097776">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097787">g1</span><span class="op" id="8097789">.</span><span class="ident" id="8097790">Delay</span>&nbsp;<span class="op" id="8097796">=</span>&nbsp;<span class="builtinfunc" id="8097798">make</span><span class="op" id="8097802">(</span><span class="op" id="8097803">[</span><span class="op" id="8097804">]</span><span class="builtintype" id="8097805">int</span><span class="op" id="8097808">,</span>&nbsp;<span class="num" id="8097810">1</span><span class="op" id="8097811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097814">if</span>&nbsp;<span class="ident" id="8097817">err</span>&nbsp;<span class="op" id="8097821">:=</span>&nbsp;<span class="ident" id="8097824">EncodeAll</span><span class="op" id="8097833">(</span><span class="ident" id="8097834">ioutil</span><span class="op" id="8097840">.</span><span class="ident" id="8097841">Discard</span><span class="op" id="8097848">,</span>&nbsp;<span class="ident" id="8097850">g1</span><span class="op" id="8097852">)</span><span class="op" id="8097853">;</span>&nbsp;<span class="ident" id="8097855">err</span>&nbsp;<span class="op" id="8097859">==</span>&nbsp;<span class="builtintype" id="8097862">nil</span>&nbsp;<span class="op" id="8097866">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8097870">t</span><span class="op" id="8097871">.</span><span class="ident" id="8097872">Error</span><span class="op" id="8097877">(</span><span class="string" id="8097878">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="8097940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8097946">if</span>&nbsp;<span class="ident" id="8097949">err</span>&nbsp;<span class="op" id="8097953">:=</span>&nbsp;<span class="ident" id="8097956">EncodeAll</span><span class="op" id="8097965">(</span><span class="ident" id="8097966">ioutil</span><span class="op" id="8097972">.</span><span class="ident" id="8097973">Discard</span><span class="op" id="8097980">,</span>&nbsp;<span class="op" id="8097982">&amp;</span><span class="ident" id="8097983">GIF</span><span class="op" id="8097986">{</span><span class="op" id="8097987">}</span><span class="op" id="8097988">)</span><span class="op" id="8097989">;</span>&nbsp;<span class="ident" id="8097991">err</span>&nbsp;<span class="op" id="8097995">==</span>&nbsp;<span class="builtintype" id="8097998">nil</span>&nbsp;<span class="op" id="8098002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098006">t</span><span class="op" id="8098007">.</span><span class="ident" id="8098008">Error</span><span class="op" id="8098013">(</span><span class="string" id="8098014">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="8098055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098058">}</span><br>
<span class="lineno">175</span><span class="op" id="8098060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8098063">func</span>&nbsp;<span class="ident" id="8098068">BenchmarkEncode</span><span class="op" id="8098083">(</span><span class="ident" id="8098084">b</span>&nbsp;<span class="op" id="8098086">*</span><span class="ident" id="8098087">testing</span><span class="op" id="8098094">.</span><span class="ident" id="8098095">B</span><span class="op" id="8098096">)</span>&nbsp;<span class="op" id="8098098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098101">b</span><span class="op" id="8098102">.</span><span class="ident" id="8098103">StopTimer</span><span class="op" id="8098112">(</span><span class="op" id="8098113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098117">bo</span>&nbsp;<span class="op" id="8098120">:=</span>&nbsp;<span class="ident" id="8098123">image</span><span class="op" id="8098128">.</span><span class="ident" id="8098129">Rect</span><span class="op" id="8098133">(</span><span class="num" id="8098134">0</span><span class="op" id="8098135">,</span>&nbsp;<span class="num" id="8098137">0</span><span class="op" id="8098138">,</span>&nbsp;<span class="num" id="8098140">640</span><span class="op" id="8098143">,</span>&nbsp;<span class="num" id="8098145">480</span><span class="op" id="8098148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098151">rnd</span>&nbsp;<span class="op" id="8098155">:=</span>&nbsp;<span class="ident" id="8098158">rand</span><span class="op" id="8098162">.</span><span class="ident" id="8098163">New</span><span class="op" id="8098166">(</span><span class="ident" id="8098167">rand</span><span class="op" id="8098171">.</span><span class="ident" id="8098172">NewSource</span><span class="op" id="8098181">(</span><span class="num" id="8098182">123</span><span class="op" id="8098185">)</span><span class="op" id="8098186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8098190">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098261">palette</span>&nbsp;<span class="op" id="8098269">:=</span>&nbsp;<span class="builtinfunc" id="8098272">make</span><span class="op" id="8098276">(</span><span class="ident" id="8098277">color</span><span class="op" id="8098282">.</span><span class="ident" id="8098283">Palette</span><span class="op" id="8098290">,</span>&nbsp;<span class="num" id="8098292">256</span><span class="op" id="8098295">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098298">for</span>&nbsp;<span class="ident" id="8098302">i</span>&nbsp;<span class="op" id="8098304">:=</span>&nbsp;<span class="keyword" id="8098307">range</span>&nbsp;<span class="ident" id="8098313">palette</span>&nbsp;<span class="op" id="8098321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098325">palette</span><span class="op" id="8098332">[</span><span class="ident" id="8098333">i</span><span class="op" id="8098334">]</span>&nbsp;<span class="op" id="8098336">=</span>&nbsp;<span class="ident" id="8098338">color</span><span class="op" id="8098343">.</span><span class="ident" id="8098344">RGBA</span><span class="op" id="8098348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8098353">uint8</span><span class="op" id="8098358">(</span><span class="ident" id="8098359">rnd</span><span class="op" id="8098362">.</span><span class="ident" id="8098363">Intn</span><span class="op" id="8098367">(</span><span class="num" id="8098368">256</span><span class="op" id="8098371">)</span><span class="op" id="8098372">)</span><span class="op" id="8098373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8098378">uint8</span><span class="op" id="8098383">(</span><span class="ident" id="8098384">rnd</span><span class="op" id="8098387">.</span><span class="ident" id="8098388">Intn</span><span class="op" id="8098392">(</span><span class="num" id="8098393">256</span><span class="op" id="8098396">)</span><span class="op" id="8098397">)</span><span class="op" id="8098398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8098403">uint8</span><span class="op" id="8098408">(</span><span class="ident" id="8098409">rnd</span><span class="op" id="8098412">.</span><span class="ident" id="8098413">Intn</span><span class="op" id="8098417">(</span><span class="num" id="8098418">256</span><span class="op" id="8098421">)</span><span class="op" id="8098422">)</span><span class="op" id="8098423">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8098428">255</span><span class="op" id="8098431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098441">img</span>&nbsp;<span class="op" id="8098445">:=</span>&nbsp;<span class="ident" id="8098448">image</span><span class="op" id="8098453">.</span><span class="ident" id="8098454">NewPaletted</span><span class="op" id="8098465">(</span><span class="ident" id="8098466">image</span><span class="op" id="8098471">.</span><span class="ident" id="8098472">Rect</span><span class="op" id="8098476">(</span><span class="num" id="8098477">0</span><span class="op" id="8098478">,</span>&nbsp;<span class="num" id="8098480">0</span><span class="op" id="8098481">,</span>&nbsp;<span class="num" id="8098483">640</span><span class="op" id="8098486">,</span>&nbsp;<span class="num" id="8098488">480</span><span class="op" id="8098491">)</span><span class="op" id="8098492">,</span>&nbsp;<span class="ident" id="8098494">palette</span><span class="op" id="8098501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098504">for</span>&nbsp;<span class="ident" id="8098508">y</span>&nbsp;<span class="op" id="8098510">:=</span>&nbsp;<span class="ident" id="8098513">bo</span><span class="op" id="8098515">.</span><span class="ident" id="8098516">Min</span><span class="op" id="8098519">.</span><span class="ident" id="8098520">Y</span><span class="op" id="8098521">;</span>&nbsp;<span class="ident" id="8098523">y</span>&nbsp;<span class="op" id="8098525">&lt;</span>&nbsp;<span class="ident" id="8098527">bo</span><span class="op" id="8098529">.</span><span class="ident" id="8098530">Max</span><span class="op" id="8098533">.</span><span class="ident" id="8098534">Y</span><span class="op" id="8098535">;</span>&nbsp;<span class="ident" id="8098537">y</span><span class="op" id="8098538">++</span>&nbsp;<span class="op" id="8098541">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098545">for</span>&nbsp;<span class="ident" id="8098549">x</span>&nbsp;<span class="op" id="8098551">:=</span>&nbsp;<span class="ident" id="8098554">bo</span><span class="op" id="8098556">.</span><span class="ident" id="8098557">Min</span><span class="op" id="8098560">.</span><span class="ident" id="8098561">X</span><span class="op" id="8098562">;</span>&nbsp;<span class="ident" id="8098564">x</span>&nbsp;<span class="op" id="8098566">&lt;</span>&nbsp;<span class="ident" id="8098568">bo</span><span class="op" id="8098570">.</span><span class="ident" id="8098571">Max</span><span class="op" id="8098574">.</span><span class="ident" id="8098575">X</span><span class="op" id="8098576">;</span>&nbsp;<span class="ident" id="8098578">x</span><span class="op" id="8098579">++</span>&nbsp;<span class="op" id="8098582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098587">img</span><span class="op" id="8098590">.</span><span class="ident" id="8098591">Set</span><span class="op" id="8098594">(</span><span class="ident" id="8098595">x</span><span class="op" id="8098596">,</span>&nbsp;<span class="ident" id="8098598">y</span><span class="op" id="8098599">,</span>&nbsp;<span class="ident" id="8098601">palette</span><span class="op" id="8098608">[</span><span class="ident" id="8098609">rnd</span><span class="op" id="8098612">.</span><span class="ident" id="8098613">Intn</span><span class="op" id="8098617">(</span><span class="num" id="8098618">256</span><span class="op" id="8098621">)</span><span class="op" id="8098622">]</span><span class="op" id="8098623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098634">b</span><span class="op" id="8098635">.</span><span class="ident" id="8098636">SetBytes</span><span class="op" id="8098644">(</span><span class="num" id="8098645">640</span>&nbsp;<span class="op" id="8098649">*</span>&nbsp;<span class="num" id="8098651">480</span>&nbsp;<span class="op" id="8098655">*</span>&nbsp;<span class="num" id="8098657">4</span><span class="op" id="8098658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098661">b</span><span class="op" id="8098662">.</span><span class="ident" id="8098663">StartTimer</span><span class="op" id="8098673">(</span><span class="op" id="8098674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098677">for</span>&nbsp;<span class="ident" id="8098681">i</span>&nbsp;<span class="op" id="8098683">:=</span>&nbsp;<span class="num" id="8098686">0</span><span class="op" id="8098687">;</span>&nbsp;<span class="ident" id="8098689">i</span>&nbsp;<span class="op" id="8098691">&lt;</span>&nbsp;<span class="ident" id="8098693">b</span><span class="op" id="8098694">.</span><span class="ident" id="8098695">N</span><span class="op" id="8098696">;</span>&nbsp;<span class="ident" id="8098698">i</span><span class="op" id="8098699">++</span>&nbsp;<span class="op" id="8098702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098706">Encode</span><span class="op" id="8098712">(</span><span class="ident" id="8098713">ioutil</span><span class="op" id="8098719">.</span><span class="ident" id="8098720">Discard</span><span class="op" id="8098727">,</span>&nbsp;<span class="ident" id="8098729">img</span><span class="op" id="8098732">,</span>&nbsp;<span class="builtintype" id="8098734">nil</span><span class="op" id="8098737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8098740">}</span><br>
<span class="lineno">205</span><span class="op" id="8098742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8098745">func</span>&nbsp;<span class="ident" id="8098750">BenchmarkQuantizedEncode</span><span class="op" id="8098774">(</span><span class="ident" id="8098775">b</span>&nbsp;<span class="op" id="8098777">*</span><span class="ident" id="8098778">testing</span><span class="op" id="8098785">.</span><span class="ident" id="8098786">B</span><span class="op" id="8098787">)</span>&nbsp;<span class="op" id="8098789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098792">b</span><span class="op" id="8098793">.</span><span class="ident" id="8098794">StopTimer</span><span class="op" id="8098803">(</span><span class="op" id="8098804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098807">img</span>&nbsp;<span class="op" id="8098811">:=</span>&nbsp;<span class="ident" id="8098814">image</span><span class="op" id="8098819">.</span><span class="ident" id="8098820">NewRGBA</span><span class="op" id="8098827">(</span><span class="ident" id="8098828">image</span><span class="op" id="8098833">.</span><span class="ident" id="8098834">Rect</span><span class="op" id="8098838">(</span><span class="num" id="8098839">0</span><span class="op" id="8098840">,</span>&nbsp;<span class="num" id="8098842">0</span><span class="op" id="8098843">,</span>&nbsp;<span class="num" id="8098845">640</span><span class="op" id="8098848">,</span>&nbsp;<span class="num" id="8098850">480</span><span class="op" id="8098853">)</span><span class="op" id="8098854">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098857">bo</span>&nbsp;<span class="op" id="8098860">:=</span>&nbsp;<span class="ident" id="8098863">img</span><span class="op" id="8098866">.</span><span class="ident" id="8098867">Bounds</span><span class="op" id="8098873">(</span><span class="op" id="8098874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098877">rnd</span>&nbsp;<span class="op" id="8098881">:=</span>&nbsp;<span class="ident" id="8098884">rand</span><span class="op" id="8098888">.</span><span class="ident" id="8098889">New</span><span class="op" id="8098892">(</span><span class="ident" id="8098893">rand</span><span class="op" id="8098897">.</span><span class="ident" id="8098898">NewSource</span><span class="op" id="8098907">(</span><span class="num" id="8098908">123</span><span class="op" id="8098911">)</span><span class="op" id="8098912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098915">for</span>&nbsp;<span class="ident" id="8098919">y</span>&nbsp;<span class="op" id="8098921">:=</span>&nbsp;<span class="ident" id="8098924">bo</span><span class="op" id="8098926">.</span><span class="ident" id="8098927">Min</span><span class="op" id="8098930">.</span><span class="ident" id="8098931">Y</span><span class="op" id="8098932">;</span>&nbsp;<span class="ident" id="8098934">y</span>&nbsp;<span class="op" id="8098936">&lt;</span>&nbsp;<span class="ident" id="8098938">bo</span><span class="op" id="8098940">.</span><span class="ident" id="8098941">Max</span><span class="op" id="8098944">.</span><span class="ident" id="8098945">Y</span><span class="op" id="8098946">;</span>&nbsp;<span class="ident" id="8098948">y</span><span class="op" id="8098949">++</span>&nbsp;<span class="op" id="8098952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8098956">for</span>&nbsp;<span class="ident" id="8098960">x</span>&nbsp;<span class="op" id="8098962">:=</span>&nbsp;<span class="ident" id="8098965">bo</span><span class="op" id="8098967">.</span><span class="ident" id="8098968">Min</span><span class="op" id="8098971">.</span><span class="ident" id="8098972">X</span><span class="op" id="8098973">;</span>&nbsp;<span class="ident" id="8098975">x</span>&nbsp;<span class="op" id="8098977">&lt;</span>&nbsp;<span class="ident" id="8098979">bo</span><span class="op" id="8098981">.</span><span class="ident" id="8098982">Max</span><span class="op" id="8098985">.</span><span class="ident" id="8098986">X</span><span class="op" id="8098987">;</span>&nbsp;<span class="ident" id="8098989">x</span><span class="op" id="8098990">++</span>&nbsp;<span class="op" id="8098993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8098998">img</span><span class="op" id="8099001">.</span><span class="ident" id="8099002">SetRGBA</span><span class="op" id="8099009">(</span><span class="ident" id="8099010">x</span><span class="op" id="8099011">,</span>&nbsp;<span class="ident" id="8099013">y</span><span class="op" id="8099014">,</span>&nbsp;<span class="ident" id="8099016">color</span><span class="op" id="8099021">.</span><span class="ident" id="8099022">RGBA</span><span class="op" id="8099026">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8099032">uint8</span><span class="op" id="8099037">(</span><span class="ident" id="8099038">rnd</span><span class="op" id="8099041">.</span><span class="ident" id="8099042">Intn</span><span class="op" id="8099046">(</span><span class="num" id="8099047">256</span><span class="op" id="8099050">)</span><span class="op" id="8099051">)</span><span class="op" id="8099052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8099058">uint8</span><span class="op" id="8099063">(</span><span class="ident" id="8099064">rnd</span><span class="op" id="8099067">.</span><span class="ident" id="8099068">Intn</span><span class="op" id="8099072">(</span><span class="num" id="8099073">256</span><span class="op" id="8099076">)</span><span class="op" id="8099077">)</span><span class="op" id="8099078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8099084">uint8</span><span class="op" id="8099089">(</span><span class="ident" id="8099090">rnd</span><span class="op" id="8099093">.</span><span class="ident" id="8099094">Intn</span><span class="op" id="8099098">(</span><span class="num" id="8099099">256</span><span class="op" id="8099102">)</span><span class="op" id="8099103">)</span><span class="op" id="8099104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8099110">255</span><span class="op" id="8099113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8099118">}</span><span class="op" id="8099119">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8099123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8099126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8099129">b</span><span class="op" id="8099130">.</span><span class="ident" id="8099131">SetBytes</span><span class="op" id="8099139">(</span><span class="num" id="8099140">640</span>&nbsp;<span class="op" id="8099144">*</span>&nbsp;<span class="num" id="8099146">480</span>&nbsp;<span class="op" id="8099150">*</span>&nbsp;<span class="num" id="8099152">4</span><span class="op" id="8099153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8099156">b</span><span class="op" id="8099157">.</span><span class="ident" id="8099158">StartTimer</span><span class="op" id="8099168">(</span><span class="op" id="8099169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8099172">for</span>&nbsp;<span class="ident" id="8099176">i</span>&nbsp;<span class="op" id="8099178">:=</span>&nbsp;<span class="num" id="8099181">0</span><span class="op" id="8099182">;</span>&nbsp;<span class="ident" id="8099184">i</span>&nbsp;<span class="op" id="8099186">&lt;</span>&nbsp;<span class="ident" id="8099188">b</span><span class="op" id="8099189">.</span><span class="ident" id="8099190">N</span><span class="op" id="8099191">;</span>&nbsp;<span class="ident" id="8099193">i</span><span class="op" id="8099194">++</span>&nbsp;<span class="op" id="8099197">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8099201">Encode</span><span class="op" id="8099207">(</span><span class="ident" id="8099208">ioutil</span><span class="op" id="8099214">.</span><span class="ident" id="8099215">Discard</span><span class="op" id="8099222">,</span>&nbsp;<span class="ident" id="8099224">img</span><span class="op" id="8099227">,</span>&nbsp;<span class="builtintype" id="8099229">nil</span><span class="op" id="8099232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8099235">}</span><br>
<span class="lineno"></span><span class="op" id="8099237">}</span>
</div>
</body>
</html>
