<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7920412">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7920467">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7920521">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7920572">package</span>&nbsp;<span class="ident" id="7920580">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7920585">import</span>&nbsp;<span class="string" id="7920592">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7920600">type</span>&nbsp;<span class="ident" id="7920605">streamListener</span>&nbsp;<span class="keyword" id="7920620">struct</span>&nbsp;<span class="op" id="7920627">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920630">net</span><span class="op" id="7920633">,</span>&nbsp;<span class="ident" id="7920635">addr</span>&nbsp;<span class="builtintype" id="7920640">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920648">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7920658">Listener</span><br>
<span class="lineno"></span><span class="op" id="7920667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7920670">type</span>&nbsp;<span class="ident" id="7920675">dualStackServer</span>&nbsp;<span class="keyword" id="7920691">struct</span>&nbsp;<span class="op" id="7920698">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920701">lnmu</span>&nbsp;<span class="ident" id="7920706">sync</span><span class="op" id="7920710">.</span><span class="ident" id="7920711">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920720">lns</span>&nbsp;&nbsp;<span class="op" id="7920725">[</span><span class="op" id="7920726">]</span><span class="ident" id="7920727">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920743">port</span>&nbsp;<span class="builtintype" id="7920748">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920757">cmu</span>&nbsp;<span class="ident" id="7920761">sync</span><span class="op" id="7920765">.</span><span class="ident" id="7920766">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920775">cs</span>&nbsp;&nbsp;<span class="op" id="7920779">[</span><span class="op" id="7920780">]</span><span class="ident" id="7920781">Conn</span>&nbsp;<span class="comment" id="7920786">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="7920838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7920841">func</span>&nbsp;<span class="op" id="7920846">(</span><span class="ident" id="7920847">dss</span>&nbsp;<span class="op" id="7920851">*</span><span class="ident" id="7920852">dualStackServer</span><span class="op" id="7920867">)</span>&nbsp;<span class="ident" id="7920869">buildup</span><span class="op" id="7920876">(</span><span class="ident" id="7920877">server</span>&nbsp;<span class="keyword" id="7920884">func</span><span class="op" id="7920888">(</span><span class="op" id="7920889">*</span><span class="ident" id="7920890">dualStackServer</span><span class="op" id="7920905">,</span>&nbsp;<span class="ident" id="7920907">Listener</span><span class="op" id="7920915">)</span><span class="op" id="7920916">)</span>&nbsp;<span class="builtintype" id="7920918">error</span>&nbsp;<span class="op" id="7920924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920927">for</span>&nbsp;<span class="ident" id="7920931">i</span>&nbsp;<span class="op" id="7920933">:=</span>&nbsp;<span class="keyword" id="7920936">range</span>&nbsp;<span class="ident" id="7920942">dss</span><span class="op" id="7920945">.</span><span class="ident" id="7920946">lns</span>&nbsp;<span class="op" id="7920950">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920954">go</span>&nbsp;<span class="ident" id="7920957">server</span><span class="op" id="7920963">(</span><span class="ident" id="7920964">dss</span><span class="op" id="7920967">,</span>&nbsp;<span class="ident" id="7920969">dss</span><span class="op" id="7920972">.</span><span class="ident" id="7920973">lns</span><span class="op" id="7920976">[</span><span class="ident" id="7920977">i</span><span class="op" id="7920978">]</span><span class="op" id="7920979">.</span><span class="ident" id="7920980">ln</span><span class="op" id="7920982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920988">return</span>&nbsp;<span class="ident" id="7920995">nil</span><br>
<span class="lineno"></span><span class="op" id="7920999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7921002">func</span>&nbsp;<span class="op" id="7921007">(</span><span class="ident" id="7921008">dss</span>&nbsp;<span class="op" id="7921012">*</span><span class="ident" id="7921013">dualStackServer</span><span class="op" id="7921028">)</span>&nbsp;<span class="ident" id="7921030">putConn</span><span class="op" id="7921037">(</span><span class="ident" id="7921038">c</span>&nbsp;<span class="ident" id="7921040">Conn</span><span class="op" id="7921044">)</span>&nbsp;<span class="builtintype" id="7921046">error</span>&nbsp;<span class="op" id="7921052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921055">dss</span><span class="op" id="7921058">.</span><span class="ident" id="7921059">cmu</span><span class="op" id="7921062">.</span><span class="ident" id="7921063">Lock</span><span class="op" id="7921067">(</span><span class="op" id="7921068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921071">dss</span><span class="op" id="7921074">.</span><span class="ident" id="7921075">cs</span>&nbsp;<span class="op" id="7921078">=</span>&nbsp;<span class="builtinfunc" id="7921080">append</span><span class="op" id="7921086">(</span><span class="ident" id="7921087">dss</span><span class="op" id="7921090">.</span><span class="ident" id="7921091">cs</span><span class="op" id="7921093">,</span>&nbsp;<span class="ident" id="7921095">c</span><span class="op" id="7921096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921099">dss</span><span class="op" id="7921102">.</span><span class="ident" id="7921103">cmu</span><span class="op" id="7921106">.</span><span class="ident" id="7921107">Unlock</span><span class="op" id="7921113">(</span><span class="op" id="7921114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921117">return</span>&nbsp;<span class="ident" id="7921124">nil</span><br>
<span class="lineno">35</span><span class="op" id="7921128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7921131">func</span>&nbsp;<span class="op" id="7921136">(</span><span class="ident" id="7921137">dss</span>&nbsp;<span class="op" id="7921141">*</span><span class="ident" id="7921142">dualStackServer</span><span class="op" id="7921157">)</span>&nbsp;<span class="ident" id="7921159">teardownNetwork</span><span class="op" id="7921174">(</span><span class="ident" id="7921175">net</span>&nbsp;<span class="builtintype" id="7921179">string</span><span class="op" id="7921185">)</span>&nbsp;<span class="builtintype" id="7921187">error</span>&nbsp;<span class="op" id="7921193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921196">dss</span><span class="op" id="7921199">.</span><span class="ident" id="7921200">lnmu</span><span class="op" id="7921204">.</span><span class="ident" id="7921205">Lock</span><span class="op" id="7921209">(</span><span class="op" id="7921210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921213">for</span>&nbsp;<span class="ident" id="7921217">i</span>&nbsp;<span class="op" id="7921219">:=</span>&nbsp;<span class="keyword" id="7921222">range</span>&nbsp;<span class="ident" id="7921228">dss</span><span class="op" id="7921231">.</span><span class="ident" id="7921232">lns</span>&nbsp;<span class="op" id="7921236">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921240">if</span>&nbsp;<span class="ident" id="7921243">net</span>&nbsp;<span class="op" id="7921247">==</span>&nbsp;<span class="ident" id="7921250">dss</span><span class="op" id="7921253">.</span><span class="ident" id="7921254">lns</span><span class="op" id="7921257">[</span><span class="ident" id="7921258">i</span><span class="op" id="7921259">]</span><span class="op" id="7921260">.</span><span class="ident" id="7921261">net</span>&nbsp;<span class="op" id="7921265">&amp;&amp;</span>&nbsp;<span class="ident" id="7921268">dss</span><span class="op" id="7921271">.</span><span class="ident" id="7921272">lns</span><span class="op" id="7921275">[</span><span class="ident" id="7921276">i</span><span class="op" id="7921277">]</span><span class="op" id="7921278">.</span><span class="ident" id="7921279">ln</span>&nbsp;<span class="op" id="7921282">!=</span>&nbsp;<span class="ident" id="7921285">nil</span>&nbsp;<span class="op" id="7921289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921294">dss</span><span class="op" id="7921297">.</span><span class="ident" id="7921298">lns</span><span class="op" id="7921301">[</span><span class="ident" id="7921302">i</span><span class="op" id="7921303">]</span><span class="op" id="7921304">.</span><span class="ident" id="7921305">ln</span><span class="op" id="7921307">.</span><span class="ident" id="7921308">Close</span><span class="op" id="7921313">(</span><span class="op" id="7921314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921319">dss</span><span class="op" id="7921322">.</span><span class="ident" id="7921323">lns</span><span class="op" id="7921326">[</span><span class="ident" id="7921327">i</span><span class="op" id="7921328">]</span><span class="op" id="7921329">.</span><span class="ident" id="7921330">ln</span>&nbsp;<span class="op" id="7921333">=</span>&nbsp;<span class="ident" id="7921335">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921344">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921347">dss</span><span class="op" id="7921350">.</span><span class="ident" id="7921351">lnmu</span><span class="op" id="7921355">.</span><span class="ident" id="7921356">Unlock</span><span class="op" id="7921362">(</span><span class="op" id="7921363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921366">return</span>&nbsp;<span class="ident" id="7921373">nil</span><br>
<span class="lineno"></span><span class="op" id="7921377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7921380">func</span>&nbsp;<span class="op" id="7921385">(</span><span class="ident" id="7921386">dss</span>&nbsp;<span class="op" id="7921390">*</span><span class="ident" id="7921391">dualStackServer</span><span class="op" id="7921406">)</span>&nbsp;<span class="ident" id="7921408">teardown</span><span class="op" id="7921416">(</span><span class="op" id="7921417">)</span>&nbsp;<span class="builtintype" id="7921419">error</span>&nbsp;<span class="op" id="7921425">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921428">dss</span><span class="op" id="7921431">.</span><span class="ident" id="7921432">lnmu</span><span class="op" id="7921436">.</span><span class="ident" id="7921437">Lock</span><span class="op" id="7921441">(</span><span class="op" id="7921442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921445">for</span>&nbsp;<span class="ident" id="7921449">i</span>&nbsp;<span class="op" id="7921451">:=</span>&nbsp;<span class="keyword" id="7921454">range</span>&nbsp;<span class="ident" id="7921460">dss</span><span class="op" id="7921463">.</span><span class="ident" id="7921464">lns</span>&nbsp;<span class="op" id="7921468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921472">if</span>&nbsp;<span class="ident" id="7921475">dss</span><span class="op" id="7921478">.</span><span class="ident" id="7921479">lns</span><span class="op" id="7921482">[</span><span class="ident" id="7921483">i</span><span class="op" id="7921484">]</span><span class="op" id="7921485">.</span><span class="ident" id="7921486">ln</span>&nbsp;<span class="op" id="7921489">!=</span>&nbsp;<span class="ident" id="7921492">nil</span>&nbsp;<span class="op" id="7921496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921501">dss</span><span class="op" id="7921504">.</span><span class="ident" id="7921505">lns</span><span class="op" id="7921508">[</span><span class="ident" id="7921509">i</span><span class="op" id="7921510">]</span><span class="op" id="7921511">.</span><span class="ident" id="7921512">ln</span><span class="op" id="7921514">.</span><span class="ident" id="7921515">Close</span><span class="op" id="7921520">(</span><span class="op" id="7921521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921525">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921531">dss</span><span class="op" id="7921534">.</span><span class="ident" id="7921535">lnmu</span><span class="op" id="7921539">.</span><span class="ident" id="7921540">Unlock</span><span class="op" id="7921546">(</span><span class="op" id="7921547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921550">dss</span><span class="op" id="7921553">.</span><span class="ident" id="7921554">cmu</span><span class="op" id="7921557">.</span><span class="ident" id="7921558">Lock</span><span class="op" id="7921562">(</span><span class="op" id="7921563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921566">for</span>&nbsp;<span class="ident" id="7921570">_</span><span class="op" id="7921571">,</span>&nbsp;<span class="ident" id="7921573">c</span>&nbsp;<span class="op" id="7921575">:=</span>&nbsp;<span class="keyword" id="7921578">range</span>&nbsp;<span class="ident" id="7921584">dss</span><span class="op" id="7921587">.</span><span class="ident" id="7921588">cs</span>&nbsp;<span class="op" id="7921591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921595">c</span><span class="op" id="7921596">.</span><span class="ident" id="7921597">Close</span><span class="op" id="7921602">(</span><span class="op" id="7921603">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921609">dss</span><span class="op" id="7921612">.</span><span class="ident" id="7921613">cmu</span><span class="op" id="7921616">.</span><span class="ident" id="7921617">Unlock</span><span class="op" id="7921623">(</span><span class="op" id="7921624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921627">return</span>&nbsp;<span class="ident" id="7921634">nil</span><br>
<span class="lineno"></span><span class="op" id="7921638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7921641">func</span>&nbsp;<span class="ident" id="7921646">newDualStackServer</span><span class="op" id="7921664">(</span><span class="ident" id="7921665">lns</span>&nbsp;<span class="op" id="7921669">[</span><span class="op" id="7921670">]</span><span class="ident" id="7921671">streamListener</span><span class="op" id="7921685">)</span>&nbsp;<span class="op" id="7921687">(</span><span class="op" id="7921688">*</span><span class="ident" id="7921689">dualStackServer</span><span class="op" id="7921704">,</span>&nbsp;<span class="builtintype" id="7921706">error</span><span class="op" id="7921711">)</span>&nbsp;<span class="op" id="7921713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921716">dss</span>&nbsp;<span class="op" id="7921720">:=</span>&nbsp;<span class="op" id="7921723">&amp;</span><span class="ident" id="7921724">dualStackServer</span><span class="op" id="7921739">{</span><span class="ident" id="7921740">lns</span><span class="op" id="7921743">:</span>&nbsp;<span class="ident" id="7921745">lns</span><span class="op" id="7921748">,</span>&nbsp;<span class="ident" id="7921750">port</span><span class="op" id="7921754">:</span>&nbsp;<span class="string" id="7921756">&#34;0&#34;</span><span class="op" id="7921759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921762">for</span>&nbsp;<span class="ident" id="7921766">i</span>&nbsp;<span class="op" id="7921768">:=</span>&nbsp;<span class="keyword" id="7921771">range</span>&nbsp;<span class="ident" id="7921777">dss</span><span class="op" id="7921780">.</span><span class="ident" id="7921781">lns</span>&nbsp;<span class="op" id="7921785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921789">ln</span><span class="op" id="7921791">,</span>&nbsp;<span class="ident" id="7921793">err</span>&nbsp;<span class="op" id="7921797">:=</span>&nbsp;<span class="ident" id="7921800">Listen</span><span class="op" id="7921806">(</span><span class="ident" id="7921807">dss</span><span class="op" id="7921810">.</span><span class="ident" id="7921811">lns</span><span class="op" id="7921814">[</span><span class="ident" id="7921815">i</span><span class="op" id="7921816">]</span><span class="op" id="7921817">.</span><span class="ident" id="7921818">net</span><span class="op" id="7921821">,</span>&nbsp;<span class="ident" id="7921823">dss</span><span class="op" id="7921826">.</span><span class="ident" id="7921827">lns</span><span class="op" id="7921830">[</span><span class="ident" id="7921831">i</span><span class="op" id="7921832">]</span><span class="op" id="7921833">.</span><span class="ident" id="7921834">addr</span><span class="op" id="7921838">+</span><span class="string" id="7921839">&#34;:&#34;</span><span class="op" id="7921842">+</span><span class="ident" id="7921843">dss</span><span class="op" id="7921846">.</span><span class="ident" id="7921847">port</span><span class="op" id="7921851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921855">if</span>&nbsp;<span class="ident" id="7921858">err</span>&nbsp;<span class="op" id="7921862">!=</span>&nbsp;<span class="ident" id="7921865">nil</span>&nbsp;<span class="op" id="7921869">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921874">dss</span><span class="op" id="7921877">.</span><span class="ident" id="7921878">teardown</span><span class="op" id="7921886">(</span><span class="op" id="7921887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921892">return</span>&nbsp;<span class="ident" id="7921899">nil</span><span class="op" id="7921902">,</span>&nbsp;<span class="ident" id="7921904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921914">dss</span><span class="op" id="7921917">.</span><span class="ident" id="7921918">lns</span><span class="op" id="7921921">[</span><span class="ident" id="7921922">i</span><span class="op" id="7921923">]</span><span class="op" id="7921924">.</span><span class="ident" id="7921925">ln</span>&nbsp;<span class="op" id="7921928">=</span>&nbsp;<span class="ident" id="7921930">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921935">if</span>&nbsp;<span class="ident" id="7921938">dss</span><span class="op" id="7921941">.</span><span class="ident" id="7921942">port</span>&nbsp;<span class="op" id="7921947">==</span>&nbsp;<span class="string" id="7921950">&#34;0&#34;</span>&nbsp;<span class="op" id="7921954">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921959">if</span>&nbsp;<span class="ident" id="7921962">_</span><span class="op" id="7921963">,</span>&nbsp;<span class="ident" id="7921965">dss</span><span class="op" id="7921968">.</span><span class="ident" id="7921969">port</span><span class="op" id="7921973">,</span>&nbsp;<span class="ident" id="7921975">err</span>&nbsp;<span class="op" id="7921979">=</span>&nbsp;<span class="ident" id="7921981">SplitHostPort</span><span class="op" id="7921994">(</span><span class="ident" id="7921995">ln</span><span class="op" id="7921997">.</span><span class="ident" id="7921998">Addr</span><span class="op" id="7922002">(</span><span class="op" id="7922003">)</span><span class="op" id="7922004">.</span><span class="ident" id="7922005">String</span><span class="op" id="7922011">(</span><span class="op" id="7922012">)</span><span class="op" id="7922013">)</span><span class="op" id="7922014">;</span>&nbsp;<span class="ident" id="7922016">err</span>&nbsp;<span class="op" id="7922020">!=</span>&nbsp;<span class="ident" id="7922023">nil</span>&nbsp;<span class="op" id="7922027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922033">dss</span><span class="op" id="7922036">.</span><span class="ident" id="7922037">teardown</span><span class="op" id="7922045">(</span><span class="op" id="7922046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922052">return</span>&nbsp;<span class="ident" id="7922059">nil</span><span class="op" id="7922062">,</span>&nbsp;<span class="ident" id="7922064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922075">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922081">return</span>&nbsp;<span class="ident" id="7922088">dss</span><span class="op" id="7922091">,</span>&nbsp;<span class="ident" id="7922093">nil</span><br>
<span class="lineno"></span><span class="op" id="7922097">}</span>
</div>
</body>
</html>
