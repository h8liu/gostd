<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2304404">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2304459">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2304513">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2304564">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2304634">package</span>&nbsp;<span class="ident" id="2304642">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2304646">import</span>&nbsp;<span class="op" id="2304653">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2304656">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2304662">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2304672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2304675">const</span>&nbsp;<span class="op" id="2304681">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304684">blockSize</span>&nbsp;<span class="op" id="2304694">=</span>&nbsp;<span class="num" id="2304696">4096</span><br>
<span class="lineno"></span><span class="op" id="2304701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2304704">func</span>&nbsp;<span class="op" id="2304709">(</span><span class="ident" id="2304710">f</span>&nbsp;<span class="op" id="2304712">*</span><span class="ident" id="2304713">File</span><span class="op" id="2304717">)</span>&nbsp;<span class="ident" id="2304719">readdirnames</span><span class="op" id="2304731">(</span><span class="ident" id="2304732">n</span>&nbsp;<span class="builtintype" id="2304734">int</span><span class="op" id="2304737">)</span>&nbsp;<span class="op" id="2304739">(</span><span class="ident" id="2304740">names</span>&nbsp;<span class="op" id="2304746">[</span><span class="op" id="2304747">]</span><span class="builtintype" id="2304748">string</span><span class="op" id="2304754">,</span>&nbsp;<span class="ident" id="2304756">err</span>&nbsp;<span class="builtintype" id="2304760">error</span><span class="op" id="2304765">)</span>&nbsp;<span class="op" id="2304767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304770">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304815">if</span>&nbsp;<span class="ident" id="2304818">f</span><span class="op" id="2304819">.</span><span class="ident" id="2304820">dirinfo</span>&nbsp;<span class="op" id="2304828">==</span>&nbsp;<span class="ident" id="2304831">nil</span>&nbsp;<span class="op" id="2304835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304839">f</span><span class="op" id="2304840">.</span><span class="ident" id="2304841">dirinfo</span>&nbsp;<span class="op" id="2304849">=</span>&nbsp;<span class="builtinfunc" id="2304851">new</span><span class="op" id="2304854">(</span><span class="ident" id="2304855">dirInfo</span><span class="op" id="2304862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304866">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304913">f</span><span class="op" id="2304914">.</span><span class="ident" id="2304915">dirinfo</span><span class="op" id="2304922">.</span><span class="ident" id="2304923">buf</span>&nbsp;<span class="op" id="2304927">=</span>&nbsp;<span class="builtinfunc" id="2304929">make</span><span class="op" id="2304933">(</span><span class="op" id="2304934">[</span><span class="op" id="2304935">]</span><span class="builtintype" id="2304936">byte</span><span class="op" id="2304940">,</span>&nbsp;<span class="ident" id="2304942">blockSize</span><span class="op" id="2304951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304954">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304957">d</span>&nbsp;<span class="op" id="2304959">:=</span>&nbsp;<span class="ident" id="2304962">f</span><span class="op" id="2304963">.</span><span class="ident" id="2304964">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304974">size</span>&nbsp;<span class="op" id="2304979">:=</span>&nbsp;<span class="ident" id="2304982">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304985">if</span>&nbsp;<span class="ident" id="2304988">size</span>&nbsp;<span class="op" id="2304993">&lt;=</span>&nbsp;<span class="num" id="2304996">0</span>&nbsp;<span class="op" id="2304998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305002">size</span>&nbsp;<span class="op" id="2305007">=</span>&nbsp;<span class="num" id="2305009">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305015">n</span>&nbsp;<span class="op" id="2305017">=</span>&nbsp;<span class="op" id="2305019">-</span><span class="num" id="2305020">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305027">names</span>&nbsp;<span class="op" id="2305033">=</span>&nbsp;<span class="builtinfunc" id="2305035">make</span><span class="op" id="2305039">(</span><span class="op" id="2305040">[</span><span class="op" id="2305041">]</span><span class="builtintype" id="2305042">string</span><span class="op" id="2305048">,</span>&nbsp;<span class="num" id="2305050">0</span><span class="op" id="2305051">,</span>&nbsp;<span class="ident" id="2305053">size</span><span class="op" id="2305057">)</span>&nbsp;<span class="comment" id="2305059">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305088">for</span>&nbsp;<span class="ident" id="2305092">n</span>&nbsp;<span class="op" id="2305094">!=</span>&nbsp;<span class="num" id="2305097">0</span>&nbsp;<span class="op" id="2305099">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305103">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305139">if</span>&nbsp;<span class="ident" id="2305142">d</span><span class="op" id="2305143">.</span><span class="ident" id="2305144">bufp</span>&nbsp;<span class="op" id="2305149">&gt;=</span>&nbsp;<span class="ident" id="2305152">d</span><span class="op" id="2305153">.</span><span class="ident" id="2305154">nbuf</span>&nbsp;<span class="op" id="2305159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305164">d</span><span class="op" id="2305165">.</span><span class="ident" id="2305166">bufp</span>&nbsp;<span class="op" id="2305171">=</span>&nbsp;<span class="num" id="2305173">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305178">var</span>&nbsp;<span class="ident" id="2305182">errno</span>&nbsp;<span class="builtintype" id="2305188">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305197">d</span><span class="op" id="2305198">.</span><span class="ident" id="2305199">nbuf</span><span class="op" id="2305203">,</span>&nbsp;<span class="ident" id="2305205">errno</span>&nbsp;<span class="op" id="2305211">=</span>&nbsp;<span class="ident" id="2305213">fixCount</span><span class="op" id="2305221">(</span><span class="ident" id="2305222">syscall</span><span class="op" id="2305229">.</span><span class="ident" id="2305230">ReadDirent</span><span class="op" id="2305240">(</span><span class="ident" id="2305241">f</span><span class="op" id="2305242">.</span><span class="ident" id="2305243">fd</span><span class="op" id="2305245">,</span>&nbsp;<span class="ident" id="2305247">d</span><span class="op" id="2305248">.</span><span class="ident" id="2305249">buf</span><span class="op" id="2305252">)</span><span class="op" id="2305253">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305258">if</span>&nbsp;<span class="ident" id="2305261">errno</span>&nbsp;<span class="op" id="2305267">!=</span>&nbsp;<span class="ident" id="2305270">nil</span>&nbsp;<span class="op" id="2305274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305280">return</span>&nbsp;<span class="ident" id="2305287">names</span><span class="op" id="2305292">,</span>&nbsp;<span class="ident" id="2305294">NewSyscallError</span><span class="op" id="2305309">(</span><span class="string" id="2305310">&#34;readdirent&#34;</span><span class="op" id="2305322">,</span>&nbsp;<span class="ident" id="2305324">errno</span><span class="op" id="2305329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305339">if</span>&nbsp;<span class="ident" id="2305342">d</span><span class="op" id="2305343">.</span><span class="ident" id="2305344">nbuf</span>&nbsp;<span class="op" id="2305349">&lt;=</span>&nbsp;<span class="num" id="2305352">0</span>&nbsp;<span class="op" id="2305354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305360">break</span>&nbsp;<span class="comment" id="2305366">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305385">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305407">var</span>&nbsp;<span class="ident" id="2305411">nb</span><span class="op" id="2305413">,</span>&nbsp;<span class="ident" id="2305415">nc</span>&nbsp;<span class="builtintype" id="2305418">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305424">nb</span><span class="op" id="2305426">,</span>&nbsp;<span class="ident" id="2305428">nc</span><span class="op" id="2305430">,</span>&nbsp;<span class="ident" id="2305432">names</span>&nbsp;<span class="op" id="2305438">=</span>&nbsp;<span class="ident" id="2305440">syscall</span><span class="op" id="2305447">.</span><span class="ident" id="2305448">ParseDirent</span><span class="op" id="2305459">(</span><span class="ident" id="2305460">d</span><span class="op" id="2305461">.</span><span class="ident" id="2305462">buf</span><span class="op" id="2305465">[</span><span class="ident" id="2305466">d</span><span class="op" id="2305467">.</span><span class="ident" id="2305468">bufp</span><span class="op" id="2305472">:</span><span class="ident" id="2305473">d</span><span class="op" id="2305474">.</span><span class="ident" id="2305475">nbuf</span><span class="op" id="2305479">]</span><span class="op" id="2305480">,</span>&nbsp;<span class="ident" id="2305482">n</span><span class="op" id="2305483">,</span>&nbsp;<span class="ident" id="2305485">names</span><span class="op" id="2305490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305494">d</span><span class="op" id="2305495">.</span><span class="ident" id="2305496">bufp</span>&nbsp;<span class="op" id="2305501">+=</span>&nbsp;<span class="ident" id="2305504">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305509">n</span>&nbsp;<span class="op" id="2305511">-=</span>&nbsp;<span class="ident" id="2305514">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305521">if</span>&nbsp;<span class="ident" id="2305524">n</span>&nbsp;<span class="op" id="2305526">&gt;=</span>&nbsp;<span class="num" id="2305529">0</span>&nbsp;<span class="op" id="2305531">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2305534">len</span><span class="op" id="2305537">(</span><span class="ident" id="2305538">names</span><span class="op" id="2305543">)</span>&nbsp;<span class="op" id="2305545">==</span>&nbsp;<span class="num" id="2305548">0</span>&nbsp;<span class="op" id="2305550">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305554">return</span>&nbsp;<span class="ident" id="2305561">names</span><span class="op" id="2305566">,</span>&nbsp;<span class="ident" id="2305568">io</span><span class="op" id="2305570">.</span><span class="ident" id="2305571">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305579">return</span>&nbsp;<span class="ident" id="2305586">names</span><span class="op" id="2305591">,</span>&nbsp;<span class="ident" id="2305593">nil</span><br>
<span class="lineno"></span><span class="op" id="2305597">}</span>
</div>
</body>
</html>
