<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html" class="current">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3333844">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3333899">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3333953">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3334004">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334065">package</span>&nbsp;<span class="ident" id="3334073">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334078">import</span>&nbsp;<span class="op" id="3334085">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334088">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334094">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334104">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334115">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="3334131">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334150">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3334161">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3334176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334179">var</span>&nbsp;<span class="op" id="3334183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334186">ldquo</span>&nbsp;<span class="op" id="3334192">=</span>&nbsp;<span class="op" id="3334194">[</span><span class="op" id="3334195">]</span><span class="builtintype" id="3334196">byte</span><span class="op" id="3334200">(</span><span class="string" id="3334201">&#34;&amp;ldquo;&#34;</span><span class="op" id="3334210">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334213">rdquo</span>&nbsp;<span class="op" id="3334219">=</span>&nbsp;<span class="op" id="3334221">[</span><span class="op" id="3334222">]</span><span class="builtintype" id="3334223">byte</span><span class="op" id="3334227">(</span><span class="string" id="3334228">&#34;&amp;rdquo;&#34;</span><span class="op" id="3334237">)</span><br>
<span class="lineno"></span><span class="op" id="3334239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3334242">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="3334291">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="3334341">func</span>&nbsp;<span class="ident" id="3334346">commentEscape</span><span class="op" id="3334359">(</span><span class="ident" id="3334360">w</span>&nbsp;<span class="ident" id="3334362">io</span><span class="op" id="3334364">.</span><span class="ident" id="3334365">Writer</span><span class="op" id="3334371">,</span>&nbsp;<span class="ident" id="3334373">text</span>&nbsp;<span class="builtintype" id="3334378">string</span><span class="op" id="3334384">,</span>&nbsp;<span class="ident" id="3334386">nice</span>&nbsp;<span class="builtintype" id="3334391">bool</span><span class="op" id="3334395">)</span>&nbsp;<span class="op" id="3334397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334400">last</span>&nbsp;<span class="op" id="3334405">:=</span>&nbsp;<span class="num" id="3334408">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334411">if</span>&nbsp;<span class="ident" id="3334414">nice</span>&nbsp;<span class="op" id="3334419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334423">for</span>&nbsp;<span class="ident" id="3334427">i</span>&nbsp;<span class="op" id="3334429">:=</span>&nbsp;<span class="num" id="3334432">0</span><span class="op" id="3334433">;</span>&nbsp;<span class="ident" id="3334435">i</span>&nbsp;<span class="op" id="3334437">&lt;</span>&nbsp;<span class="builtinfunc" id="3334439">len</span><span class="op" id="3334442">(</span><span class="ident" id="3334443">text</span><span class="op" id="3334447">)</span><span class="op" id="3334448">-</span><span class="num" id="3334449">1</span><span class="op" id="3334450">;</span>&nbsp;<span class="ident" id="3334452">i</span><span class="op" id="3334453">++</span>&nbsp;<span class="op" id="3334456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334461">ch</span>&nbsp;<span class="op" id="3334464">:=</span>&nbsp;<span class="ident" id="3334467">text</span><span class="op" id="3334471">[</span><span class="ident" id="3334472">i</span><span class="op" id="3334473">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334478">if</span>&nbsp;<span class="ident" id="3334481">ch</span>&nbsp;<span class="op" id="3334484">==</span>&nbsp;<span class="ident" id="3334487">text</span><span class="op" id="3334491">[</span><span class="ident" id="3334492">i</span><span class="op" id="3334493">+</span><span class="num" id="3334494">1</span><span class="op" id="3334495">]</span>&nbsp;<span class="op" id="3334497">&amp;&amp;</span>&nbsp;<span class="op" id="3334500">(</span><span class="ident" id="3334501">ch</span>&nbsp;<span class="op" id="3334504">==</span>&nbsp;<span class="string" id="3334507">&#39;`&#39;</span>&nbsp;<span class="op" id="3334511">||</span>&nbsp;<span class="ident" id="3334514">ch</span>&nbsp;<span class="op" id="3334517">==</span>&nbsp;<span class="string" id="3334520">&#39;\&#39;&#39;</span><span class="op" id="3334524">)</span>&nbsp;<span class="op" id="3334526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334532">template</span><span class="op" id="3334540">.</span><span class="ident" id="3334541">HTMLEscape</span><span class="op" id="3334551">(</span><span class="ident" id="3334552">w</span><span class="op" id="3334553">,</span>&nbsp;<span class="op" id="3334555">[</span><span class="op" id="3334556">]</span><span class="builtintype" id="3334557">byte</span><span class="op" id="3334561">(</span><span class="ident" id="3334562">text</span><span class="op" id="3334566">[</span><span class="ident" id="3334567">last</span><span class="op" id="3334571">:</span><span class="ident" id="3334572">i</span><span class="op" id="3334573">]</span><span class="op" id="3334574">)</span><span class="op" id="3334575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334581">last</span>&nbsp;<span class="op" id="3334586">=</span>&nbsp;<span class="ident" id="3334588">i</span>&nbsp;<span class="op" id="3334590">+</span>&nbsp;<span class="num" id="3334592">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334598">switch</span>&nbsp;<span class="ident" id="3334605">ch</span>&nbsp;<span class="op" id="3334608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334614">case</span>&nbsp;<span class="string" id="3334619">&#39;`&#39;</span><span class="op" id="3334622">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334629">w</span><span class="op" id="3334630">.</span><span class="ident" id="3334631">Write</span><span class="op" id="3334636">(</span><span class="ident" id="3334637">ldquo</span><span class="op" id="3334642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3334648">case</span>&nbsp;<span class="string" id="3334653">&#39;\&#39;&#39;</span><span class="op" id="3334657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334664">w</span><span class="op" id="3334665">.</span><span class="ident" id="3334666">Write</span><span class="op" id="3334671">(</span><span class="ident" id="3334672">rdquo</span><span class="op" id="3334677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3334683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334689">i</span><span class="op" id="3334690">++</span>&nbsp;<span class="comment" id="3334693">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3334722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3334726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3334729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334732">template</span><span class="op" id="3334740">.</span><span class="ident" id="3334741">HTMLEscape</span><span class="op" id="3334751">(</span><span class="ident" id="3334752">w</span><span class="op" id="3334753">,</span>&nbsp;<span class="op" id="3334755">[</span><span class="op" id="3334756">]</span><span class="builtintype" id="3334757">byte</span><span class="op" id="3334761">(</span><span class="ident" id="3334762">text</span><span class="op" id="3334766">[</span><span class="ident" id="3334767">last</span><span class="op" id="3334771">:</span><span class="op" id="3334772">]</span><span class="op" id="3334773">)</span><span class="op" id="3334774">)</span><br>
<span class="lineno"></span><span class="op" id="3334776">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3334779">const</span>&nbsp;<span class="op" id="3334785">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3334788">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334818">identRx</span>&nbsp;<span class="op" id="3334826">=</span>&nbsp;<span class="string" id="3334828">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3334849">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334869">protocol</span>&nbsp;<span class="op" id="3334878">=</span>&nbsp;<span class="string" id="3334880">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334944">hostPart</span>&nbsp;<span class="op" id="3334953">=</span>&nbsp;<span class="string" id="3334955">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3334975">filePart</span>&nbsp;<span class="op" id="3334984">=</span>&nbsp;<span class="string" id="3334986">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="3335014">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335077">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335086">=</span>&nbsp;<span class="string" id="3335088">`(`</span>&nbsp;<span class="op" id="3335092">+</span>&nbsp;<span class="ident" id="3335094">protocol</span>&nbsp;<span class="op" id="3335103">+</span>&nbsp;<span class="string" id="3335105">`)://`</span>&nbsp;<span class="op" id="3335112">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3335116">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335129">hostPart</span>&nbsp;<span class="op" id="3335138">+</span>&nbsp;<span class="string" id="3335140">`([.:]`</span>&nbsp;<span class="op" id="3335148">+</span>&nbsp;<span class="ident" id="3335150">hostPart</span>&nbsp;<span class="op" id="3335159">+</span>&nbsp;<span class="string" id="3335161">`)*/?`</span>&nbsp;<span class="op" id="3335168">+</span>&nbsp;<span class="comment" id="3335170">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335198">filePart</span>&nbsp;<span class="op" id="3335207">+</span>&nbsp;<span class="string" id="3335209">`([:.,]`</span>&nbsp;<span class="op" id="3335218">+</span>&nbsp;<span class="ident" id="3335220">filePart</span>&nbsp;<span class="op" id="3335229">+</span>&nbsp;<span class="string" id="3335231">`)*`</span><br>
<span class="lineno"></span><span class="op" id="3335236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3335239">var</span>&nbsp;<span class="ident" id="3335243">matchRx</span>&nbsp;<span class="op" id="3335251">=</span>&nbsp;<span class="ident" id="3335253">regexp</span><span class="op" id="3335259">.</span><span class="ident" id="3335260">MustCompile</span><span class="op" id="3335271">(</span><span class="string" id="3335272">`(`</span>&nbsp;<span class="op" id="3335276">+</span>&nbsp;<span class="ident" id="3335278">urlRx</span>&nbsp;<span class="op" id="3335284">+</span>&nbsp;<span class="string" id="3335286">`)|(`</span>&nbsp;<span class="op" id="3335292">+</span>&nbsp;<span class="ident" id="3335294">identRx</span>&nbsp;<span class="op" id="3335302">+</span>&nbsp;<span class="string" id="3335304">`)`</span><span class="op" id="3335307">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3335310">var</span>&nbsp;<span class="op" id="3335314">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335317">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335329">=</span>&nbsp;<span class="op" id="3335331">[</span><span class="op" id="3335332">]</span><span class="builtintype" id="3335333">byte</span><span class="op" id="3335337">(</span><span class="string" id="3335338">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="3335349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335352">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335364">=</span>&nbsp;<span class="op" id="3335366">[</span><span class="op" id="3335367">]</span><span class="builtintype" id="3335368">byte</span><span class="op" id="3335372">(</span><span class="string" id="3335373">`&#34;&gt;`</span><span class="op" id="3335377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335380">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3335392">=</span>&nbsp;<span class="op" id="3335394">[</span><span class="op" id="3335395">]</span><span class="builtintype" id="3335396">byte</span><span class="op" id="3335400">(</span><span class="string" id="3335401">&#34;&lt;/a&gt;&#34;</span><span class="op" id="3335407">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335410">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335422">=</span>&nbsp;<span class="op" id="3335424">[</span><span class="op" id="3335425">]</span><span class="builtintype" id="3335426">byte</span><span class="op" id="3335430">(</span><span class="string" id="3335431">&#34;&lt;i&gt;&#34;</span><span class="op" id="3335436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335439">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3335451">=</span>&nbsp;<span class="op" id="3335453">[</span><span class="op" id="3335454">]</span><span class="builtintype" id="3335455">byte</span><span class="op" id="3335459">(</span><span class="string" id="3335460">&#34;&lt;/i&gt;&#34;</span><span class="op" id="3335466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335469">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335481">=</span>&nbsp;<span class="op" id="3335483">[</span><span class="op" id="3335484">]</span><span class="builtintype" id="3335485">byte</span><span class="op" id="3335489">(</span><span class="string" id="3335490">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="3335497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335500">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3335512">=</span>&nbsp;<span class="op" id="3335514">[</span><span class="op" id="3335515">]</span><span class="builtintype" id="3335516">byte</span><span class="op" id="3335520">(</span><span class="string" id="3335521">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="3335529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335532">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335544">=</span>&nbsp;<span class="op" id="3335546">[</span><span class="op" id="3335547">]</span><span class="builtintype" id="3335548">byte</span><span class="op" id="3335552">(</span><span class="string" id="3335553">&#34;&lt;pre&gt;&#34;</span><span class="op" id="3335560">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335563">html_endpre</span>&nbsp;<span class="op" id="3335575">=</span>&nbsp;<span class="op" id="3335577">[</span><span class="op" id="3335578">]</span><span class="builtintype" id="3335579">byte</span><span class="op" id="3335583">(</span><span class="string" id="3335584">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="3335594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335597">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335609">=</span>&nbsp;<span class="op" id="3335611">[</span><span class="op" id="3335612">]</span><span class="builtintype" id="3335613">byte</span><span class="op" id="3335617">(</span><span class="string" id="3335618">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="3335628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335631">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335643">=</span>&nbsp;<span class="op" id="3335645">[</span><span class="op" id="3335646">]</span><span class="builtintype" id="3335647">byte</span><span class="op" id="3335651">(</span><span class="string" id="3335652">`&#34;&gt;`</span><span class="op" id="3335656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335659">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3335671">=</span>&nbsp;<span class="op" id="3335673">[</span><span class="op" id="3335674">]</span><span class="builtintype" id="3335675">byte</span><span class="op" id="3335679">(</span><span class="string" id="3335680">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="3335689">)</span><br>
<span class="lineno"></span><span class="op" id="3335691">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3335694">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="3335796">func</span>&nbsp;<span class="ident" id="3335801">pairedParensPrefixLen</span><span class="op" id="3335822">(</span><span class="ident" id="3335823">s</span>&nbsp;<span class="builtintype" id="3335825">string</span><span class="op" id="3335831">)</span>&nbsp;<span class="builtintype" id="3335833">int</span>&nbsp;<span class="op" id="3335837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335840">parens</span>&nbsp;<span class="op" id="3335847">:=</span>&nbsp;<span class="num" id="3335850">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335853">l</span>&nbsp;<span class="op" id="3335855">:=</span>&nbsp;<span class="builtinfunc" id="3335858">len</span><span class="op" id="3335861">(</span><span class="ident" id="3335862">s</span><span class="op" id="3335863">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335866">for</span>&nbsp;<span class="ident" id="3335870">i</span><span class="op" id="3335871">,</span>&nbsp;<span class="ident" id="3335873">ch</span>&nbsp;<span class="op" id="3335876">:=</span>&nbsp;<span class="keyword" id="3335879">range</span>&nbsp;<span class="ident" id="3335885">s</span>&nbsp;<span class="op" id="3335887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335891">switch</span>&nbsp;<span class="ident" id="3335898">ch</span>&nbsp;<span class="op" id="3335901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335905">case</span>&nbsp;<span class="string" id="3335910">&#39;(&#39;</span><span class="op" id="3335913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335918">if</span>&nbsp;<span class="ident" id="3335921">parens</span>&nbsp;<span class="op" id="3335928">==</span>&nbsp;<span class="num" id="3335931">0</span>&nbsp;<span class="op" id="3335933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335939">l</span>&nbsp;<span class="op" id="3335941">=</span>&nbsp;<span class="ident" id="3335943">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3335948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335953">parens</span><span class="op" id="3335959">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335964">case</span>&nbsp;<span class="string" id="3335969">&#39;)&#39;</span><span class="op" id="3335972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3335977">parens</span><span class="op" id="3335983">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3335989">if</span>&nbsp;<span class="ident" id="3335992">parens</span>&nbsp;<span class="op" id="3335999">==</span>&nbsp;<span class="num" id="3336002">0</span>&nbsp;<span class="op" id="3336004">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3336010">l</span>&nbsp;<span class="op" id="3336012">=</span>&nbsp;<span class="builtinfunc" id="3336014">len</span><span class="op" id="3336017">(</span><span class="ident" id="3336018">s</span><span class="op" id="3336019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336024">}</span>&nbsp;<span class="keyword" id="3336026">else</span>&nbsp;<span class="keyword" id="3336031">if</span>&nbsp;<span class="ident" id="3336034">parens</span>&nbsp;<span class="op" id="3336041">&lt;</span>&nbsp;<span class="num" id="3336043">0</span>&nbsp;<span class="op" id="3336045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3336051">return</span>&nbsp;<span class="ident" id="3336058">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336067">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3336073">return</span>&nbsp;<span class="ident" id="3336080">l</span><br>
<span class="lineno"></span><span class="op" id="3336082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336085">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="3336165">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="3336245">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3336322">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3336402">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3336481">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="3336560">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="3336640">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="3336665">func</span>&nbsp;<span class="ident" id="3336670">emphasize</span><span class="op" id="3336679">(</span><span class="ident" id="3336680">w</span>&nbsp;<span class="ident" id="3336682">io</span><span class="op" id="3336684">.</span><span class="ident" id="3336685">Writer</span><span class="op" id="3336691">,</span>&nbsp;<span class="ident" id="3336693">line</span>&nbsp;<span class="builtintype" id="3336698">string</span><span class="op" id="3336704">,</span>&nbsp;<span class="ident" id="3336706">words</span>&nbsp;<span class="keyword" id="3336712">map</span><span class="op" id="3336715">[</span><span class="builtintype" id="3336716">string</span><span class="op" id="3336722">]</span><span class="builtintype" id="3336723">string</span><span class="op" id="3336729">,</span>&nbsp;<span class="ident" id="3336731">nice</span>&nbsp;<span class="builtintype" id="3336736">bool</span><span class="op" id="3336740">)</span>&nbsp;<span class="op" id="3336742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3336745">for</span>&nbsp;<span class="op" id="3336749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3336753">m</span>&nbsp;<span class="op" id="3336755">:=</span>&nbsp;<span class="ident" id="3336758">matchRx</span><span class="op" id="3336765">.</span><span class="ident" id="3336766">FindStringSubmatchIndex</span><span class="op" id="3336789">(</span><span class="ident" id="3336790">line</span><span class="op" id="3336794">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3336798">if</span>&nbsp;<span class="ident" id="3336801">m</span>&nbsp;<span class="op" id="3336803">==</span>&nbsp;<span class="builtintype" id="3336806">nil</span>&nbsp;<span class="op" id="3336810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3336815">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3336823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3336827">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3336901">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3336930">commentEscape</span><span class="op" id="3336943">(</span><span class="ident" id="3336944">w</span><span class="op" id="3336945">,</span>&nbsp;<span class="ident" id="3336947">line</span><span class="op" id="3336951">[</span><span class="num" id="3336952">0</span><span class="op" id="3336953">:</span><span class="ident" id="3336954">m</span><span class="op" id="3336955">[</span><span class="num" id="3336956">0</span><span class="op" id="3336957">]</span><span class="op" id="3336958">]</span><span class="op" id="3336959">,</span>&nbsp;<span class="ident" id="3336961">nice</span><span class="op" id="3336965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3336970">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337001">match</span>&nbsp;<span class="op" id="3337007">:=</span>&nbsp;<span class="ident" id="3337010">line</span><span class="op" id="3337014">[</span><span class="ident" id="3337015">m</span><span class="op" id="3337016">[</span><span class="num" id="3337017">0</span><span class="op" id="3337018">]</span><span class="op" id="3337019">:</span><span class="ident" id="3337020">m</span><span class="op" id="3337021">[</span><span class="num" id="3337022">1</span><span class="op" id="3337023">]</span><span class="op" id="3337024">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337028">if</span>&nbsp;<span class="ident" id="3337031">n</span>&nbsp;<span class="op" id="3337033">:=</span>&nbsp;<span class="ident" id="3337036">pairedParensPrefixLen</span><span class="op" id="3337057">(</span><span class="ident" id="3337058">match</span><span class="op" id="3337063">)</span><span class="op" id="3337064">;</span>&nbsp;<span class="ident" id="3337066">n</span>&nbsp;<span class="op" id="3337068">&lt;</span>&nbsp;<span class="builtinfunc" id="3337070">len</span><span class="op" id="3337073">(</span><span class="ident" id="3337074">match</span><span class="op" id="3337079">)</span>&nbsp;<span class="op" id="3337081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337086">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337136">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337196">m</span>&nbsp;<span class="op" id="3337198">=</span>&nbsp;<span class="ident" id="3337200">matchRx</span><span class="op" id="3337207">.</span><span class="ident" id="3337208">FindStringSubmatchIndex</span><span class="op" id="3337231">(</span><span class="ident" id="3337232">line</span><span class="op" id="3337236">[</span><span class="op" id="3337237">:</span><span class="ident" id="3337238">m</span><span class="op" id="3337239">[</span><span class="num" id="3337240">0</span><span class="op" id="3337241">]</span><span class="op" id="3337242">+</span><span class="ident" id="3337243">n</span><span class="op" id="3337244">]</span><span class="op" id="3337245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337250">match</span>&nbsp;<span class="op" id="3337256">=</span>&nbsp;<span class="ident" id="3337258">match</span><span class="op" id="3337263">[</span><span class="op" id="3337264">:</span><span class="ident" id="3337265">n</span><span class="op" id="3337266">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337275">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337294">url</span>&nbsp;<span class="op" id="3337298">:=</span>&nbsp;<span class="string" id="3337301">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337306">italics</span>&nbsp;<span class="op" id="3337314">:=</span>&nbsp;<span class="builtintype" id="3337317">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337325">if</span>&nbsp;<span class="ident" id="3337328">words</span>&nbsp;<span class="op" id="3337334">!=</span>&nbsp;<span class="builtintype" id="3337337">nil</span>&nbsp;<span class="op" id="3337341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337346">url</span><span class="op" id="3337349">,</span>&nbsp;<span class="ident" id="3337351">italics</span>&nbsp;<span class="op" id="3337359">=</span>&nbsp;<span class="ident" id="3337361">words</span><span class="op" id="3337366">[</span><span class="ident" id="3337367">match</span><span class="op" id="3337372">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337380">if</span>&nbsp;<span class="ident" id="3337383">m</span><span class="op" id="3337384">[</span><span class="num" id="3337385">2</span><span class="op" id="3337386">]</span>&nbsp;<span class="op" id="3337388">&gt;=</span>&nbsp;<span class="num" id="3337391">0</span>&nbsp;<span class="op" id="3337393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337398">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337478">if</span>&nbsp;<span class="op" id="3337481">!</span><span class="ident" id="3337482">italics</span>&nbsp;<span class="op" id="3337490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337496">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337555">url</span>&nbsp;<span class="op" id="3337559">=</span>&nbsp;<span class="ident" id="3337561">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337575">italics</span>&nbsp;<span class="op" id="3337583">=</span>&nbsp;<span class="builtintype" id="3337585">false</span>&nbsp;<span class="comment" id="3337591">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337622">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337639">if</span>&nbsp;<span class="builtinfunc" id="3337642">len</span><span class="op" id="3337645">(</span><span class="ident" id="3337646">url</span><span class="op" id="3337649">)</span>&nbsp;<span class="op" id="3337651">&gt;</span>&nbsp;<span class="num" id="3337653">0</span>&nbsp;<span class="op" id="3337655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337660">w</span><span class="op" id="3337661">.</span><span class="ident" id="3337662">Write</span><span class="op" id="3337667">(</span><span class="ident" id="3337668">html_a</span><span class="op" id="3337674">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337679">template</span><span class="op" id="3337687">.</span><span class="ident" id="3337688">HTMLEscape</span><span class="op" id="3337698">(</span><span class="ident" id="3337699">w</span><span class="op" id="3337700">,</span>&nbsp;<span class="op" id="3337702">[</span><span class="op" id="3337703">]</span><span class="builtintype" id="3337704">byte</span><span class="op" id="3337708">(</span><span class="ident" id="3337709">url</span><span class="op" id="3337712">)</span><span class="op" id="3337713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337718">w</span><span class="op" id="3337719">.</span><span class="ident" id="3337720">Write</span><span class="op" id="3337725">(</span><span class="ident" id="3337726">html_aq</span><span class="op" id="3337733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337741">if</span>&nbsp;<span class="ident" id="3337744">italics</span>&nbsp;<span class="op" id="3337752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337757">w</span><span class="op" id="3337758">.</span><span class="ident" id="3337759">Write</span><span class="op" id="3337764">(</span><span class="ident" id="3337765">html_i</span><span class="op" id="3337771">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337779">commentEscape</span><span class="op" id="3337792">(</span><span class="ident" id="3337793">w</span><span class="op" id="3337794">,</span>&nbsp;<span class="ident" id="3337796">match</span><span class="op" id="3337801">,</span>&nbsp;<span class="ident" id="3337803">nice</span><span class="op" id="3337807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337811">if</span>&nbsp;<span class="ident" id="3337814">italics</span>&nbsp;<span class="op" id="3337822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337827">w</span><span class="op" id="3337828">.</span><span class="ident" id="3337829">Write</span><span class="op" id="3337834">(</span><span class="ident" id="3337835">html_endi</span><span class="op" id="3337844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337848">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337852">if</span>&nbsp;<span class="builtinfunc" id="3337855">len</span><span class="op" id="3337858">(</span><span class="ident" id="3337859">url</span><span class="op" id="3337862">)</span>&nbsp;<span class="op" id="3337864">&gt;</span>&nbsp;<span class="num" id="3337866">0</span>&nbsp;<span class="op" id="3337868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337873">w</span><span class="op" id="3337874">.</span><span class="ident" id="3337875">Write</span><span class="op" id="3337880">(</span><span class="ident" id="3337881">html_enda</span><span class="op" id="3337890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337899">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337912">line</span>&nbsp;<span class="op" id="3337917">=</span>&nbsp;<span class="ident" id="3337919">line</span><span class="op" id="3337923">[</span><span class="ident" id="3337924">m</span><span class="op" id="3337925">[</span><span class="num" id="3337926">1</span><span class="op" id="3337927">]</span><span class="op" id="3337928">:</span><span class="op" id="3337929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337935">commentEscape</span><span class="op" id="3337948">(</span><span class="ident" id="3337949">w</span><span class="op" id="3337950">,</span>&nbsp;<span class="ident" id="3337952">line</span><span class="op" id="3337956">,</span>&nbsp;<span class="ident" id="3337958">nice</span><span class="op" id="3337962">)</span><br>
<span class="lineno"></span><span class="op" id="3337964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="3337967">func</span>&nbsp;<span class="ident" id="3337972">indentLen</span><span class="op" id="3337981">(</span><span class="ident" id="3337982">s</span>&nbsp;<span class="builtintype" id="3337984">string</span><span class="op" id="3337990">)</span>&nbsp;<span class="builtintype" id="3337992">int</span>&nbsp;<span class="op" id="3337996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337999">i</span>&nbsp;<span class="op" id="3338001">:=</span>&nbsp;<span class="num" id="3338004">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338007">for</span>&nbsp;<span class="ident" id="3338011">i</span>&nbsp;<span class="op" id="3338013">&lt;</span>&nbsp;<span class="builtinfunc" id="3338015">len</span><span class="op" id="3338018">(</span><span class="ident" id="3338019">s</span><span class="op" id="3338020">)</span>&nbsp;<span class="op" id="3338022">&amp;&amp;</span>&nbsp;<span class="op" id="3338025">(</span><span class="ident" id="3338026">s</span><span class="op" id="3338027">[</span><span class="ident" id="3338028">i</span><span class="op" id="3338029">]</span>&nbsp;<span class="op" id="3338031">==</span>&nbsp;<span class="string" id="3338034">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3338038">||</span>&nbsp;<span class="ident" id="3338041">s</span><span class="op" id="3338042">[</span><span class="ident" id="3338043">i</span><span class="op" id="3338044">]</span>&nbsp;<span class="op" id="3338046">==</span>&nbsp;<span class="string" id="3338049">&#39;\t&#39;</span><span class="op" id="3338053">)</span>&nbsp;<span class="op" id="3338055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338059">i</span><span class="op" id="3338060">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338064">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338067">return</span>&nbsp;<span class="ident" id="3338074">i</span><br>
<span class="lineno"></span><span class="op" id="3338076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3338079">func</span>&nbsp;<span class="ident" id="3338084">isBlank</span><span class="op" id="3338091">(</span><span class="ident" id="3338092">s</span>&nbsp;<span class="builtintype" id="3338094">string</span><span class="op" id="3338100">)</span>&nbsp;<span class="builtintype" id="3338102">bool</span>&nbsp;<span class="op" id="3338107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338110">return</span>&nbsp;<span class="builtinfunc" id="3338117">len</span><span class="op" id="3338120">(</span><span class="ident" id="3338121">s</span><span class="op" id="3338122">)</span>&nbsp;<span class="op" id="3338124">==</span>&nbsp;<span class="num" id="3338127">0</span>&nbsp;<span class="op" id="3338129">||</span>&nbsp;<span class="op" id="3338132">(</span><span class="builtinfunc" id="3338133">len</span><span class="op" id="3338136">(</span><span class="ident" id="3338137">s</span><span class="op" id="3338138">)</span>&nbsp;<span class="op" id="3338140">==</span>&nbsp;<span class="num" id="3338143">1</span>&nbsp;<span class="op" id="3338145">&amp;&amp;</span>&nbsp;<span class="ident" id="3338148">s</span><span class="op" id="3338149">[</span><span class="num" id="3338150">0</span><span class="op" id="3338151">]</span>&nbsp;<span class="op" id="3338153">==</span>&nbsp;<span class="string" id="3338156">&#39;\n&#39;</span><span class="op" id="3338160">)</span><br>
<span class="lineno">175</span><span class="op" id="3338162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3338165">func</span>&nbsp;<span class="ident" id="3338170">commonPrefix</span><span class="op" id="3338182">(</span><span class="ident" id="3338183">a</span><span class="op" id="3338184">,</span>&nbsp;<span class="ident" id="3338186">b</span>&nbsp;<span class="builtintype" id="3338188">string</span><span class="op" id="3338194">)</span>&nbsp;<span class="builtintype" id="3338196">string</span>&nbsp;<span class="op" id="3338203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338206">i</span>&nbsp;<span class="op" id="3338208">:=</span>&nbsp;<span class="num" id="3338211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338214">for</span>&nbsp;<span class="ident" id="3338218">i</span>&nbsp;<span class="op" id="3338220">&lt;</span>&nbsp;<span class="builtinfunc" id="3338222">len</span><span class="op" id="3338225">(</span><span class="ident" id="3338226">a</span><span class="op" id="3338227">)</span>&nbsp;<span class="op" id="3338229">&amp;&amp;</span>&nbsp;<span class="ident" id="3338232">i</span>&nbsp;<span class="op" id="3338234">&lt;</span>&nbsp;<span class="builtinfunc" id="3338236">len</span><span class="op" id="3338239">(</span><span class="ident" id="3338240">b</span><span class="op" id="3338241">)</span>&nbsp;<span class="op" id="3338243">&amp;&amp;</span>&nbsp;<span class="ident" id="3338246">a</span><span class="op" id="3338247">[</span><span class="ident" id="3338248">i</span><span class="op" id="3338249">]</span>&nbsp;<span class="op" id="3338251">==</span>&nbsp;<span class="ident" id="3338254">b</span><span class="op" id="3338255">[</span><span class="ident" id="3338256">i</span><span class="op" id="3338257">]</span>&nbsp;<span class="op" id="3338259">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338263">i</span><span class="op" id="3338264">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338271">return</span>&nbsp;<span class="ident" id="3338278">a</span><span class="op" id="3338279">[</span><span class="num" id="3338280">0</span><span class="op" id="3338281">:</span><span class="ident" id="3338282">i</span><span class="op" id="3338283">]</span><br>
<span class="lineno"></span><span class="op" id="3338285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="3338288">func</span>&nbsp;<span class="ident" id="3338293">unindent</span><span class="op" id="3338301">(</span><span class="ident" id="3338302">block</span>&nbsp;<span class="op" id="3338308">[</span><span class="op" id="3338309">]</span><span class="builtintype" id="3338310">string</span><span class="op" id="3338316">)</span>&nbsp;<span class="op" id="3338318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338321">if</span>&nbsp;<span class="builtinfunc" id="3338324">len</span><span class="op" id="3338327">(</span><span class="ident" id="3338328">block</span><span class="op" id="3338333">)</span>&nbsp;<span class="op" id="3338335">==</span>&nbsp;<span class="num" id="3338338">0</span>&nbsp;<span class="op" id="3338340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338356">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338396">prefix</span>&nbsp;<span class="op" id="3338403">:=</span>&nbsp;<span class="ident" id="3338406">block</span><span class="op" id="3338411">[</span><span class="num" id="3338412">0</span><span class="op" id="3338413">]</span><span class="op" id="3338414">[</span><span class="num" id="3338415">0</span><span class="op" id="3338416">:</span><span class="ident" id="3338417">indentLen</span><span class="op" id="3338426">(</span><span class="ident" id="3338427">block</span><span class="op" id="3338432">[</span><span class="num" id="3338433">0</span><span class="op" id="3338434">]</span><span class="op" id="3338435">)</span><span class="op" id="3338436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338439">for</span>&nbsp;<span class="ident" id="3338443">_</span><span class="op" id="3338444">,</span>&nbsp;<span class="ident" id="3338446">line</span>&nbsp;<span class="op" id="3338451">:=</span>&nbsp;<span class="keyword" id="3338454">range</span>&nbsp;<span class="ident" id="3338460">block</span>&nbsp;<span class="op" id="3338466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338470">if</span>&nbsp;<span class="op" id="3338473">!</span><span class="ident" id="3338474">isBlank</span><span class="op" id="3338481">(</span><span class="ident" id="3338482">line</span><span class="op" id="3338486">)</span>&nbsp;<span class="op" id="3338488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338493">prefix</span>&nbsp;<span class="op" id="3338500">=</span>&nbsp;<span class="ident" id="3338502">commonPrefix</span><span class="op" id="3338514">(</span><span class="ident" id="3338515">prefix</span><span class="op" id="3338521">,</span>&nbsp;<span class="ident" id="3338523">line</span><span class="op" id="3338527">[</span><span class="num" id="3338528">0</span><span class="op" id="3338529">:</span><span class="ident" id="3338530">indentLen</span><span class="op" id="3338539">(</span><span class="ident" id="3338540">line</span><span class="op" id="3338544">)</span><span class="op" id="3338545">]</span><span class="op" id="3338546">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338556">n</span>&nbsp;<span class="op" id="3338558">:=</span>&nbsp;<span class="builtinfunc" id="3338561">len</span><span class="op" id="3338564">(</span><span class="ident" id="3338565">prefix</span><span class="op" id="3338571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338575">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338586">for</span>&nbsp;<span class="ident" id="3338590">i</span><span class="op" id="3338591">,</span>&nbsp;<span class="ident" id="3338593">line</span>&nbsp;<span class="op" id="3338598">:=</span>&nbsp;<span class="keyword" id="3338601">range</span>&nbsp;<span class="ident" id="3338607">block</span>&nbsp;<span class="op" id="3338613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338617">if</span>&nbsp;<span class="op" id="3338620">!</span><span class="ident" id="3338621">isBlank</span><span class="op" id="3338628">(</span><span class="ident" id="3338629">line</span><span class="op" id="3338633">)</span>&nbsp;<span class="op" id="3338635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338640">block</span><span class="op" id="3338645">[</span><span class="ident" id="3338646">i</span><span class="op" id="3338647">]</span>&nbsp;<span class="op" id="3338649">=</span>&nbsp;<span class="ident" id="3338651">line</span><span class="op" id="3338655">[</span><span class="ident" id="3338656">n</span><span class="op" id="3338657">:</span><span class="op" id="3338658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338665">}</span><br>
<span class="lineno">205</span><span class="op" id="3338667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3338670">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="3338741">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3338783">func</span>&nbsp;<span class="ident" id="3338788">heading</span><span class="op" id="3338795">(</span><span class="ident" id="3338796">line</span>&nbsp;<span class="builtintype" id="3338801">string</span><span class="op" id="3338807">)</span>&nbsp;<span class="builtintype" id="3338809">string</span>&nbsp;<span class="op" id="3338816">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338819">line</span>&nbsp;<span class="op" id="3338824">=</span>&nbsp;<span class="ident" id="3338826">strings</span><span class="op" id="3338833">.</span><span class="ident" id="3338834">TrimSpace</span><span class="op" id="3338843">(</span><span class="ident" id="3338844">line</span><span class="op" id="3338848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338851">if</span>&nbsp;<span class="builtinfunc" id="3338854">len</span><span class="op" id="3338857">(</span><span class="ident" id="3338858">line</span><span class="op" id="3338862">)</span>&nbsp;<span class="op" id="3338864">==</span>&nbsp;<span class="num" id="3338867">0</span>&nbsp;<span class="op" id="3338869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338873">return</span>&nbsp;<span class="string" id="3338880">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3338884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3338888">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338938">r</span><span class="op" id="3338939">,</span>&nbsp;<span class="ident" id="3338941">_</span>&nbsp;<span class="op" id="3338943">:=</span>&nbsp;<span class="ident" id="3338946">utf8</span><span class="op" id="3338950">.</span><span class="ident" id="3338951">DecodeRuneInString</span><span class="op" id="3338969">(</span><span class="ident" id="3338970">line</span><span class="op" id="3338974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3338977">if</span>&nbsp;<span class="op" id="3338980">!</span><span class="ident" id="3338981">unicode</span><span class="op" id="3338988">.</span><span class="ident" id="3338989">IsLetter</span><span class="op" id="3338997">(</span><span class="ident" id="3338998">r</span><span class="op" id="3338999">)</span>&nbsp;<span class="op" id="3339001">||</span>&nbsp;<span class="op" id="3339004">!</span><span class="ident" id="3339005">unicode</span><span class="op" id="3339012">.</span><span class="ident" id="3339013">IsUpper</span><span class="op" id="3339020">(</span><span class="ident" id="3339021">r</span><span class="op" id="3339022">)</span>&nbsp;<span class="op" id="3339024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339028">return</span>&nbsp;<span class="string" id="3339035">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339039">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339043">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339081">r</span><span class="op" id="3339082">,</span>&nbsp;<span class="ident" id="3339084">_</span>&nbsp;<span class="op" id="3339086">=</span>&nbsp;<span class="ident" id="3339088">utf8</span><span class="op" id="3339092">.</span><span class="ident" id="3339093">DecodeLastRuneInString</span><span class="op" id="3339115">(</span><span class="ident" id="3339116">line</span><span class="op" id="3339120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339123">if</span>&nbsp;<span class="op" id="3339126">!</span><span class="ident" id="3339127">unicode</span><span class="op" id="3339134">.</span><span class="ident" id="3339135">IsLetter</span><span class="op" id="3339143">(</span><span class="ident" id="3339144">r</span><span class="op" id="3339145">)</span>&nbsp;<span class="op" id="3339147">&amp;&amp;</span>&nbsp;<span class="op" id="3339150">!</span><span class="ident" id="3339151">unicode</span><span class="op" id="3339158">.</span><span class="ident" id="3339159">IsDigit</span><span class="op" id="3339166">(</span><span class="ident" id="3339167">r</span><span class="op" id="3339168">)</span>&nbsp;<span class="op" id="3339170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339174">return</span>&nbsp;<span class="string" id="3339181">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339189">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339231">if</span>&nbsp;<span class="ident" id="3339234">strings</span><span class="op" id="3339241">.</span><span class="ident" id="3339242">IndexAny</span><span class="op" id="3339250">(</span><span class="ident" id="3339251">line</span><span class="op" id="3339255">,</span>&nbsp;<span class="string" id="3339257">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="3339292">)</span>&nbsp;<span class="op" id="3339294">&gt;=</span>&nbsp;<span class="num" id="3339297">0</span>&nbsp;<span class="op" id="3339299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339303">return</span>&nbsp;<span class="string" id="3339310">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339318">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339357">for</span>&nbsp;<span class="ident" id="3339361">b</span>&nbsp;<span class="op" id="3339363">:=</span>&nbsp;<span class="ident" id="3339366">line</span><span class="op" id="3339370">;</span>&nbsp;<span class="op" id="3339372">;</span>&nbsp;<span class="op" id="3339374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339378">i</span>&nbsp;<span class="op" id="3339380">:=</span>&nbsp;<span class="ident" id="3339383">strings</span><span class="op" id="3339390">.</span><span class="ident" id="3339391">IndexRune</span><span class="op" id="3339400">(</span><span class="ident" id="3339401">b</span><span class="op" id="3339402">,</span>&nbsp;<span class="string" id="3339404">&#39;\&#39;&#39;</span><span class="op" id="3339408">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339412">if</span>&nbsp;<span class="ident" id="3339415">i</span>&nbsp;<span class="op" id="3339417">&lt;</span>&nbsp;<span class="num" id="3339419">0</span>&nbsp;<span class="op" id="3339421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339426">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339438">if</span>&nbsp;<span class="ident" id="3339441">i</span><span class="op" id="3339442">+</span><span class="num" id="3339443">1</span>&nbsp;<span class="op" id="3339445">&gt;=</span>&nbsp;<span class="builtinfunc" id="3339448">len</span><span class="op" id="3339451">(</span><span class="ident" id="3339452">b</span><span class="op" id="3339453">)</span>&nbsp;<span class="op" id="3339455">||</span>&nbsp;<span class="ident" id="3339458">b</span><span class="op" id="3339459">[</span><span class="ident" id="3339460">i</span><span class="op" id="3339461">+</span><span class="num" id="3339462">1</span><span class="op" id="3339463">]</span>&nbsp;<span class="op" id="3339465">!=</span>&nbsp;<span class="string" id="3339468">&#39;s&#39;</span>&nbsp;<span class="op" id="3339472">||</span>&nbsp;<span class="op" id="3339475">(</span><span class="ident" id="3339476">i</span><span class="op" id="3339477">+</span><span class="num" id="3339478">2</span>&nbsp;<span class="op" id="3339480">&lt;</span>&nbsp;<span class="builtinfunc" id="3339482">len</span><span class="op" id="3339485">(</span><span class="ident" id="3339486">b</span><span class="op" id="3339487">)</span>&nbsp;<span class="op" id="3339489">&amp;&amp;</span>&nbsp;<span class="ident" id="3339492">b</span><span class="op" id="3339493">[</span><span class="ident" id="3339494">i</span><span class="op" id="3339495">+</span><span class="num" id="3339496">2</span><span class="op" id="3339497">]</span>&nbsp;<span class="op" id="3339499">!=</span>&nbsp;<span class="string" id="3339502">&#39;&nbsp;&#39;</span><span class="op" id="3339505">)</span>&nbsp;<span class="op" id="3339507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339512">return</span>&nbsp;<span class="string" id="3339519">&#34;&#34;</span>&nbsp;<span class="comment" id="3339522">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339552">b</span>&nbsp;<span class="op" id="3339554">=</span>&nbsp;<span class="ident" id="3339556">b</span><span class="op" id="3339557">[</span><span class="ident" id="3339558">i</span><span class="op" id="3339559">+</span><span class="num" id="3339560">2</span><span class="op" id="3339561">:</span><span class="op" id="3339562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339569">return</span>&nbsp;<span class="ident" id="3339576">line</span><br>
<span class="lineno">245</span><span class="op" id="3339581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339584">type</span>&nbsp;<span class="ident" id="3339589">op</span>&nbsp;<span class="builtintype" id="3339592">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339597">const</span>&nbsp;<span class="op" id="3339603">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339606">opPara</span>&nbsp;<span class="ident" id="3339613">op</span>&nbsp;<span class="op" id="3339616">=</span>&nbsp;<span class="ident" id="3339618">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339624">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339632">opPre</span><br>
<span class="lineno"></span><span class="op" id="3339638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3339641">type</span>&nbsp;<span class="ident" id="3339646">block</span>&nbsp;<span class="keyword" id="3339652">struct</span>&nbsp;<span class="op" id="3339659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339662">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339668">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339672">lines</span>&nbsp;<span class="op" id="3339678">[</span><span class="op" id="3339679">]</span><span class="builtintype" id="3339680">string</span><br>
<span class="lineno"></span><span class="op" id="3339687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3339690">var</span>&nbsp;<span class="ident" id="3339694">nonAlphaNumRx</span>&nbsp;<span class="op" id="3339708">=</span>&nbsp;<span class="ident" id="3339710">regexp</span><span class="op" id="3339716">.</span><span class="ident" id="3339717">MustCompile</span><span class="op" id="3339728">(</span><span class="string" id="3339729">`[^a-zA-Z0-9]`</span><span class="op" id="3339743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339746">func</span>&nbsp;<span class="ident" id="3339751">anchorID</span><span class="op" id="3339759">(</span><span class="ident" id="3339760">line</span>&nbsp;<span class="builtintype" id="3339765">string</span><span class="op" id="3339771">)</span>&nbsp;<span class="builtintype" id="3339773">string</span>&nbsp;<span class="op" id="3339780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339783">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339863">return</span>&nbsp;<span class="string" id="3339870">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="3339877">+</span>&nbsp;<span class="ident" id="3339879">nonAlphaNumRx</span><span class="op" id="3339892">.</span><span class="ident" id="3339893">ReplaceAllString</span><span class="op" id="3339909">(</span><span class="ident" id="3339910">line</span><span class="op" id="3339914">,</span>&nbsp;<span class="string" id="3339916">&#34;_&#34;</span><span class="op" id="3339919">)</span><br>
<span class="lineno">265</span><span class="op" id="3339921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339924">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="3339975">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="3340017">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="3340077">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="3340129">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3340179">//</span><br>
<span class="lineno"></span><span class="comment" id="3340182">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3340243">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="3340314">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="3340383">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="3340444">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="3340474">//</span><br>
<span class="lineno"></span><span class="comment" id="3340477">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="3340538">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3340580">//</span><br>
<span class="lineno"></span><span class="comment" id="3340583">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="3340661">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3340739">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="3340808">//</span><br>
<span class="lineno"></span><span class="comment" id="3340811">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3340895">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3340982">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3340998">func</span>&nbsp;<span class="ident" id="3341003">ToHTML</span><span class="op" id="3341009">(</span><span class="ident" id="3341010">w</span>&nbsp;<span class="ident" id="3341012">io</span><span class="op" id="3341014">.</span><span class="ident" id="3341015">Writer</span><span class="op" id="3341021">,</span>&nbsp;<span class="ident" id="3341023">text</span>&nbsp;<span class="builtintype" id="3341028">string</span><span class="op" id="3341034">,</span>&nbsp;<span class="ident" id="3341036">words</span>&nbsp;<span class="keyword" id="3341042">map</span><span class="op" id="3341045">[</span><span class="builtintype" id="3341046">string</span><span class="op" id="3341052">]</span><span class="builtintype" id="3341053">string</span><span class="op" id="3341059">)</span>&nbsp;<span class="op" id="3341061">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341064">for</span>&nbsp;<span class="ident" id="3341068">_</span><span class="op" id="3341069">,</span>&nbsp;<span class="ident" id="3341071">b</span>&nbsp;<span class="op" id="3341073">:=</span>&nbsp;<span class="keyword" id="3341076">range</span>&nbsp;<span class="ident" id="3341082">blocks</span><span class="op" id="3341088">(</span><span class="ident" id="3341089">text</span><span class="op" id="3341093">)</span>&nbsp;<span class="op" id="3341095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341099">switch</span>&nbsp;<span class="ident" id="3341106">b</span><span class="op" id="3341107">.</span><span class="ident" id="3341108">op</span>&nbsp;<span class="op" id="3341111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341115">case</span>&nbsp;<span class="ident" id="3341120">opPara</span><span class="op" id="3341126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341131">w</span><span class="op" id="3341132">.</span><span class="ident" id="3341133">Write</span><span class="op" id="3341138">(</span><span class="ident" id="3341139">html_p</span><span class="op" id="3341145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341150">for</span>&nbsp;<span class="ident" id="3341154">_</span><span class="op" id="3341155">,</span>&nbsp;<span class="ident" id="3341157">line</span>&nbsp;<span class="op" id="3341162">:=</span>&nbsp;<span class="keyword" id="3341165">range</span>&nbsp;<span class="ident" id="3341171">b</span><span class="op" id="3341172">.</span><span class="ident" id="3341173">lines</span>&nbsp;<span class="op" id="3341179">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341185">emphasize</span><span class="op" id="3341194">(</span><span class="ident" id="3341195">w</span><span class="op" id="3341196">,</span>&nbsp;<span class="ident" id="3341198">line</span><span class="op" id="3341202">,</span>&nbsp;<span class="ident" id="3341204">words</span><span class="op" id="3341209">,</span>&nbsp;<span class="builtintype" id="3341211">true</span><span class="op" id="3341215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341225">w</span><span class="op" id="3341226">.</span><span class="ident" id="3341227">Write</span><span class="op" id="3341232">(</span><span class="ident" id="3341233">html_endp</span><span class="op" id="3341242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341246">case</span>&nbsp;<span class="ident" id="3341251">opHead</span><span class="op" id="3341257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341262">w</span><span class="op" id="3341263">.</span><span class="ident" id="3341264">Write</span><span class="op" id="3341269">(</span><span class="ident" id="3341270">html_h</span><span class="op" id="3341276">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341281">id</span>&nbsp;<span class="op" id="3341284">:=</span>&nbsp;<span class="string" id="3341287">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341293">for</span>&nbsp;<span class="ident" id="3341297">_</span><span class="op" id="3341298">,</span>&nbsp;<span class="ident" id="3341300">line</span>&nbsp;<span class="op" id="3341305">:=</span>&nbsp;<span class="keyword" id="3341308">range</span>&nbsp;<span class="ident" id="3341314">b</span><span class="op" id="3341315">.</span><span class="ident" id="3341316">lines</span>&nbsp;<span class="op" id="3341322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341328">if</span>&nbsp;<span class="ident" id="3341331">id</span>&nbsp;<span class="op" id="3341334">==</span>&nbsp;<span class="string" id="3341337">&#34;&#34;</span>&nbsp;<span class="op" id="3341340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341347">id</span>&nbsp;<span class="op" id="3341350">=</span>&nbsp;<span class="ident" id="3341352">anchorID</span><span class="op" id="3341360">(</span><span class="ident" id="3341361">line</span><span class="op" id="3341365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341372">w</span><span class="op" id="3341373">.</span><span class="ident" id="3341374">Write</span><span class="op" id="3341379">(</span><span class="op" id="3341380">[</span><span class="op" id="3341381">]</span><span class="builtintype" id="3341382">byte</span><span class="op" id="3341386">(</span><span class="ident" id="3341387">id</span><span class="op" id="3341389">)</span><span class="op" id="3341390">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341397">w</span><span class="op" id="3341398">.</span><span class="ident" id="3341399">Write</span><span class="op" id="3341404">(</span><span class="ident" id="3341405">html_hq</span><span class="op" id="3341412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341424">commentEscape</span><span class="op" id="3341437">(</span><span class="ident" id="3341438">w</span><span class="op" id="3341439">,</span>&nbsp;<span class="ident" id="3341441">line</span><span class="op" id="3341445">,</span>&nbsp;<span class="builtintype" id="3341447">true</span><span class="op" id="3341451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341461">if</span>&nbsp;<span class="ident" id="3341464">id</span>&nbsp;<span class="op" id="3341467">==</span>&nbsp;<span class="string" id="3341470">&#34;&#34;</span>&nbsp;<span class="op" id="3341473">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341479">w</span><span class="op" id="3341480">.</span><span class="ident" id="3341481">Write</span><span class="op" id="3341486">(</span><span class="ident" id="3341487">html_hq</span><span class="op" id="3341494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341504">w</span><span class="op" id="3341505">.</span><span class="ident" id="3341506">Write</span><span class="op" id="3341511">(</span><span class="ident" id="3341512">html_endh</span><span class="op" id="3341521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341525">case</span>&nbsp;<span class="ident" id="3341530">opPre</span><span class="op" id="3341535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341540">w</span><span class="op" id="3341541">.</span><span class="ident" id="3341542">Write</span><span class="op" id="3341547">(</span><span class="ident" id="3341548">html_pre</span><span class="op" id="3341556">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341561">for</span>&nbsp;<span class="ident" id="3341565">_</span><span class="op" id="3341566">,</span>&nbsp;<span class="ident" id="3341568">line</span>&nbsp;<span class="op" id="3341573">:=</span>&nbsp;<span class="keyword" id="3341576">range</span>&nbsp;<span class="ident" id="3341582">b</span><span class="op" id="3341583">.</span><span class="ident" id="3341584">lines</span>&nbsp;<span class="op" id="3341590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341596">emphasize</span><span class="op" id="3341605">(</span><span class="ident" id="3341606">w</span><span class="op" id="3341607">,</span>&nbsp;<span class="ident" id="3341609">line</span><span class="op" id="3341613">,</span>&nbsp;<span class="builtintype" id="3341615">nil</span><span class="op" id="3341618">,</span>&nbsp;<span class="builtintype" id="3341620">false</span><span class="op" id="3341625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341635">w</span><span class="op" id="3341636">.</span><span class="ident" id="3341637">Write</span><span class="op" id="3341642">(</span><span class="ident" id="3341643">html_endpre</span><span class="op" id="3341654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341658">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341661">}</span><br>
<span class="lineno"></span><span class="op" id="3341663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3341666">func</span>&nbsp;<span class="ident" id="3341671">blocks</span><span class="op" id="3341677">(</span><span class="ident" id="3341678">text</span>&nbsp;<span class="builtintype" id="3341683">string</span><span class="op" id="3341689">)</span>&nbsp;<span class="op" id="3341691">[</span><span class="op" id="3341692">]</span><span class="ident" id="3341693">block</span>&nbsp;<span class="op" id="3341699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341702">var</span>&nbsp;<span class="op" id="3341706">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341710">out</span>&nbsp;&nbsp;<span class="op" id="3341715">[</span><span class="op" id="3341716">]</span><span class="ident" id="3341717">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341725">para</span>&nbsp;<span class="op" id="3341730">[</span><span class="op" id="3341731">]</span><span class="builtintype" id="3341732">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341742">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3341757">=</span>&nbsp;<span class="builtintype" id="3341759">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341767">lastWasHeading</span>&nbsp;<span class="op" id="3341782">=</span>&nbsp;<span class="builtintype" id="3341784">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3341795">close</span>&nbsp;<span class="op" id="3341801">:=</span>&nbsp;<span class="keyword" id="3341804">func</span><span class="op" id="3341808">(</span><span class="op" id="3341809">)</span>&nbsp;<span class="op" id="3341811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341815">if</span>&nbsp;<span class="ident" id="3341818">para</span>&nbsp;<span class="op" id="3341823">!=</span>&nbsp;<span class="builtintype" id="3341826">nil</span>&nbsp;<span class="op" id="3341830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341835">out</span>&nbsp;<span class="op" id="3341839">=</span>&nbsp;<span class="builtinfunc" id="3341841">append</span><span class="op" id="3341847">(</span><span class="ident" id="3341848">out</span><span class="op" id="3341851">,</span>&nbsp;<span class="ident" id="3341853">block</span><span class="op" id="3341858">{</span><span class="ident" id="3341859">opPara</span><span class="op" id="3341865">,</span>&nbsp;<span class="ident" id="3341867">para</span><span class="op" id="3341871">}</span><span class="op" id="3341872">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341877">para</span>&nbsp;<span class="op" id="3341882">=</span>&nbsp;<span class="builtintype" id="3341884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341897">lines</span>&nbsp;<span class="op" id="3341903">:=</span>&nbsp;<span class="ident" id="3341906">strings</span><span class="op" id="3341913">.</span><span class="ident" id="3341914">SplitAfter</span><span class="op" id="3341924">(</span><span class="ident" id="3341925">text</span><span class="op" id="3341929">,</span>&nbsp;<span class="string" id="3341931">&#34;\n&#34;</span><span class="op" id="3341935">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341938">unindent</span><span class="op" id="3341946">(</span><span class="ident" id="3341947">lines</span><span class="op" id="3341952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341955">for</span>&nbsp;<span class="ident" id="3341959">i</span>&nbsp;<span class="op" id="3341961">:=</span>&nbsp;<span class="num" id="3341964">0</span><span class="op" id="3341965">;</span>&nbsp;<span class="ident" id="3341967">i</span>&nbsp;<span class="op" id="3341969">&lt;</span>&nbsp;<span class="builtinfunc" id="3341971">len</span><span class="op" id="3341974">(</span><span class="ident" id="3341975">lines</span><span class="op" id="3341980">)</span><span class="op" id="3341981">;</span>&nbsp;<span class="op" id="3341983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341987">line</span>&nbsp;<span class="op" id="3341992">:=</span>&nbsp;<span class="ident" id="3341995">lines</span><span class="op" id="3342000">[</span><span class="ident" id="3342001">i</span><span class="op" id="3342002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342006">if</span>&nbsp;<span class="ident" id="3342009">isBlank</span><span class="op" id="3342016">(</span><span class="ident" id="3342017">line</span><span class="op" id="3342021">)</span>&nbsp;<span class="op" id="3342023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342028">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3342050">close</span><span class="op" id="3342055">(</span><span class="op" id="3342056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342061">i</span><span class="op" id="3342062">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342068">lastWasBlank</span>&nbsp;<span class="op" id="3342081">=</span>&nbsp;<span class="builtintype" id="3342083">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342091">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342102">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342106">if</span>&nbsp;<span class="ident" id="3342109">indentLen</span><span class="op" id="3342118">(</span><span class="ident" id="3342119">line</span><span class="op" id="3342123">)</span>&nbsp;<span class="op" id="3342125">&gt;</span>&nbsp;<span class="num" id="3342127">0</span>&nbsp;<span class="op" id="3342129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342134">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3342156">close</span><span class="op" id="3342161">(</span><span class="op" id="3342162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342168">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342204">j</span>&nbsp;<span class="op" id="3342206">:=</span>&nbsp;<span class="ident" id="3342209">i</span>&nbsp;<span class="op" id="3342211">+</span>&nbsp;<span class="num" id="3342213">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342218">for</span>&nbsp;<span class="ident" id="3342222">j</span>&nbsp;<span class="op" id="3342224">&lt;</span>&nbsp;<span class="builtinfunc" id="3342226">len</span><span class="op" id="3342229">(</span><span class="ident" id="3342230">lines</span><span class="op" id="3342235">)</span>&nbsp;<span class="op" id="3342237">&amp;&amp;</span>&nbsp;<span class="op" id="3342240">(</span><span class="ident" id="3342241">isBlank</span><span class="op" id="3342248">(</span><span class="ident" id="3342249">lines</span><span class="op" id="3342254">[</span><span class="ident" id="3342255">j</span><span class="op" id="3342256">]</span><span class="op" id="3342257">)</span>&nbsp;<span class="op" id="3342259">||</span>&nbsp;<span class="ident" id="3342262">indentLen</span><span class="op" id="3342271">(</span><span class="ident" id="3342272">lines</span><span class="op" id="3342277">[</span><span class="ident" id="3342278">j</span><span class="op" id="3342279">]</span><span class="op" id="3342280">)</span>&nbsp;<span class="op" id="3342282">&gt;</span>&nbsp;<span class="num" id="3342284">0</span><span class="op" id="3342285">)</span>&nbsp;<span class="op" id="3342287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342293">j</span><span class="op" id="3342294">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342305">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342340">for</span>&nbsp;<span class="ident" id="3342344">j</span>&nbsp;<span class="op" id="3342346">&gt;</span>&nbsp;<span class="ident" id="3342348">i</span>&nbsp;<span class="op" id="3342350">&amp;&amp;</span>&nbsp;<span class="ident" id="3342353">isBlank</span><span class="op" id="3342360">(</span><span class="ident" id="3342361">lines</span><span class="op" id="3342366">[</span><span class="ident" id="3342367">j</span><span class="op" id="3342368">-</span><span class="num" id="3342369">1</span><span class="op" id="3342370">]</span><span class="op" id="3342371">)</span>&nbsp;<span class="op" id="3342373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342379">j</span><span class="op" id="3342380">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342391">pre</span>&nbsp;<span class="op" id="3342395">:=</span>&nbsp;<span class="ident" id="3342398">lines</span><span class="op" id="3342403">[</span><span class="ident" id="3342404">i</span><span class="op" id="3342405">:</span><span class="ident" id="3342406">j</span><span class="op" id="3342407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342412">i</span>&nbsp;<span class="op" id="3342414">=</span>&nbsp;<span class="ident" id="3342416">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342422">unindent</span><span class="op" id="3342430">(</span><span class="ident" id="3342431">pre</span><span class="op" id="3342434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342440">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342477">out</span>&nbsp;<span class="op" id="3342481">=</span>&nbsp;<span class="builtinfunc" id="3342483">append</span><span class="op" id="3342489">(</span><span class="ident" id="3342490">out</span><span class="op" id="3342493">,</span>&nbsp;<span class="ident" id="3342495">block</span><span class="op" id="3342500">{</span><span class="ident" id="3342501">opPre</span><span class="op" id="3342506">,</span>&nbsp;<span class="ident" id="3342508">pre</span><span class="op" id="3342511">}</span><span class="op" id="3342512">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342517">lastWasHeading</span>&nbsp;<span class="op" id="3342532">=</span>&nbsp;<span class="builtintype" id="3342534">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342543">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342559">if</span>&nbsp;<span class="ident" id="3342562">lastWasBlank</span>&nbsp;<span class="op" id="3342575">&amp;&amp;</span>&nbsp;<span class="op" id="3342578">!</span><span class="ident" id="3342579">lastWasHeading</span>&nbsp;<span class="op" id="3342594">&amp;&amp;</span>&nbsp;<span class="ident" id="3342597">i</span><span class="op" id="3342598">+</span><span class="num" id="3342599">2</span>&nbsp;<span class="op" id="3342601">&lt;</span>&nbsp;<span class="builtinfunc" id="3342603">len</span><span class="op" id="3342606">(</span><span class="ident" id="3342607">lines</span><span class="op" id="3342612">)</span>&nbsp;<span class="op" id="3342614">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342620">isBlank</span><span class="op" id="3342627">(</span><span class="ident" id="3342628">lines</span><span class="op" id="3342633">[</span><span class="ident" id="3342634">i</span><span class="op" id="3342635">+</span><span class="num" id="3342636">1</span><span class="op" id="3342637">]</span><span class="op" id="3342638">)</span>&nbsp;<span class="op" id="3342640">&amp;&amp;</span>&nbsp;<span class="op" id="3342643">!</span><span class="ident" id="3342644">isBlank</span><span class="op" id="3342651">(</span><span class="ident" id="3342652">lines</span><span class="op" id="3342657">[</span><span class="ident" id="3342658">i</span><span class="op" id="3342659">+</span><span class="num" id="3342660">2</span><span class="op" id="3342661">]</span><span class="op" id="3342662">)</span>&nbsp;<span class="op" id="3342664">&amp;&amp;</span>&nbsp;<span class="ident" id="3342667">indentLen</span><span class="op" id="3342676">(</span><span class="ident" id="3342677">lines</span><span class="op" id="3342682">[</span><span class="ident" id="3342683">i</span><span class="op" id="3342684">+</span><span class="num" id="3342685">2</span><span class="op" id="3342686">]</span><span class="op" id="3342687">)</span>&nbsp;<span class="op" id="3342689">==</span>&nbsp;<span class="num" id="3342692">0</span>&nbsp;<span class="op" id="3342694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342699">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342758">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342814">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342840">if</span>&nbsp;<span class="ident" id="3342843">head</span>&nbsp;<span class="op" id="3342848">:=</span>&nbsp;<span class="ident" id="3342851">heading</span><span class="op" id="3342858">(</span><span class="ident" id="3342859">line</span><span class="op" id="3342863">)</span><span class="op" id="3342864">;</span>&nbsp;<span class="ident" id="3342866">head</span>&nbsp;<span class="op" id="3342871">!=</span>&nbsp;<span class="string" id="3342874">&#34;&#34;</span>&nbsp;<span class="op" id="3342877">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3342883">close</span><span class="op" id="3342888">(</span><span class="op" id="3342889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342895">out</span>&nbsp;<span class="op" id="3342899">=</span>&nbsp;<span class="builtinfunc" id="3342901">append</span><span class="op" id="3342907">(</span><span class="ident" id="3342908">out</span><span class="op" id="3342911">,</span>&nbsp;<span class="ident" id="3342913">block</span><span class="op" id="3342918">{</span><span class="ident" id="3342919">opHead</span><span class="op" id="3342925">,</span>&nbsp;<span class="op" id="3342927">[</span><span class="op" id="3342928">]</span><span class="builtintype" id="3342929">string</span><span class="op" id="3342935">{</span><span class="ident" id="3342936">head</span><span class="op" id="3342940">}</span><span class="op" id="3342941">}</span><span class="op" id="3342942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342948">i</span>&nbsp;<span class="op" id="3342950">+=</span>&nbsp;<span class="num" id="3342953">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342959">lastWasHeading</span>&nbsp;<span class="op" id="3342974">=</span>&nbsp;<span class="builtintype" id="3342976">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342985">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3343006">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343026">lastWasBlank</span>&nbsp;<span class="op" id="3343039">=</span>&nbsp;<span class="builtintype" id="3343041">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343049">lastWasHeading</span>&nbsp;<span class="op" id="3343064">=</span>&nbsp;<span class="builtintype" id="3343066">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343074">para</span>&nbsp;<span class="op" id="3343079">=</span>&nbsp;<span class="builtinfunc" id="3343081">append</span><span class="op" id="3343087">(</span><span class="ident" id="3343088">para</span><span class="op" id="3343092">,</span>&nbsp;<span class="ident" id="3343094">lines</span><span class="op" id="3343099">[</span><span class="ident" id="3343100">i</span><span class="op" id="3343101">]</span><span class="op" id="3343102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343106">i</span><span class="op" id="3343107">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3343114">close</span><span class="op" id="3343119">(</span><span class="op" id="3343120">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343124">return</span>&nbsp;<span class="ident" id="3343131">out</span><br>
<span class="lineno"></span><span class="op" id="3343135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3343138">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="3343206">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="3343275">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="3343349">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="3343424">func</span>&nbsp;<span class="ident" id="3343429">ToText</span><span class="op" id="3343435">(</span><span class="ident" id="3343436">w</span>&nbsp;<span class="ident" id="3343438">io</span><span class="op" id="3343440">.</span><span class="ident" id="3343441">Writer</span><span class="op" id="3343447">,</span>&nbsp;<span class="ident" id="3343449">text</span>&nbsp;<span class="builtintype" id="3343454">string</span><span class="op" id="3343460">,</span>&nbsp;<span class="ident" id="3343462">indent</span><span class="op" id="3343468">,</span>&nbsp;<span class="ident" id="3343470">preIndent</span>&nbsp;<span class="builtintype" id="3343480">string</span><span class="op" id="3343486">,</span>&nbsp;<span class="ident" id="3343488">width</span>&nbsp;<span class="builtintype" id="3343494">int</span><span class="op" id="3343497">)</span>&nbsp;<span class="op" id="3343499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343502">l</span>&nbsp;<span class="op" id="3343504">:=</span>&nbsp;<span class="ident" id="3343507">lineWrapper</span><span class="op" id="3343518">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343522">out</span><span class="op" id="3343525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343530">w</span><span class="op" id="3343531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343535">width</span><span class="op" id="3343540">:</span>&nbsp;&nbsp;<span class="ident" id="3343543">width</span><span class="op" id="3343548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343552">indent</span><span class="op" id="3343558">:</span>&nbsp;<span class="ident" id="3343560">indent</span><span class="op" id="3343566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343572">for</span>&nbsp;<span class="ident" id="3343576">_</span><span class="op" id="3343577">,</span>&nbsp;<span class="ident" id="3343579">b</span>&nbsp;<span class="op" id="3343581">:=</span>&nbsp;<span class="keyword" id="3343584">range</span>&nbsp;<span class="ident" id="3343590">blocks</span><span class="op" id="3343596">(</span><span class="ident" id="3343597">text</span><span class="op" id="3343601">)</span>&nbsp;<span class="op" id="3343603">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343607">switch</span>&nbsp;<span class="ident" id="3343614">b</span><span class="op" id="3343615">.</span><span class="ident" id="3343616">op</span>&nbsp;<span class="op" id="3343619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343623">case</span>&nbsp;<span class="ident" id="3343628">opPara</span><span class="op" id="3343634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3343639">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343690">for</span>&nbsp;<span class="ident" id="3343694">_</span><span class="op" id="3343695">,</span>&nbsp;<span class="ident" id="3343697">line</span>&nbsp;<span class="op" id="3343702">:=</span>&nbsp;<span class="keyword" id="3343705">range</span>&nbsp;<span class="ident" id="3343711">b</span><span class="op" id="3343712">.</span><span class="ident" id="3343713">lines</span>&nbsp;<span class="op" id="3343719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343725">l</span><span class="op" id="3343726">.</span><span class="ident" id="3343727">write</span><span class="op" id="3343732">(</span><span class="ident" id="3343733">line</span><span class="op" id="3343737">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343747">l</span><span class="op" id="3343748">.</span><span class="ident" id="3343749">flush</span><span class="op" id="3343754">(</span><span class="op" id="3343755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343759">case</span>&nbsp;<span class="ident" id="3343764">opHead</span><span class="op" id="3343770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343775">w</span><span class="op" id="3343776">.</span><span class="ident" id="3343777">Write</span><span class="op" id="3343782">(</span><span class="ident" id="3343783">nl</span><span class="op" id="3343785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343790">for</span>&nbsp;<span class="ident" id="3343794">_</span><span class="op" id="3343795">,</span>&nbsp;<span class="ident" id="3343797">line</span>&nbsp;<span class="op" id="3343802">:=</span>&nbsp;<span class="keyword" id="3343805">range</span>&nbsp;<span class="ident" id="3343811">b</span><span class="op" id="3343812">.</span><span class="ident" id="3343813">lines</span>&nbsp;<span class="op" id="3343819">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343825">l</span><span class="op" id="3343826">.</span><span class="ident" id="3343827">write</span><span class="op" id="3343832">(</span><span class="ident" id="3343833">line</span>&nbsp;<span class="op" id="3343838">+</span>&nbsp;<span class="string" id="3343840">&#34;\n&#34;</span><span class="op" id="3343844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343854">l</span><span class="op" id="3343855">.</span><span class="ident" id="3343856">flush</span><span class="op" id="3343861">(</span><span class="op" id="3343862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343866">case</span>&nbsp;<span class="ident" id="3343871">opPre</span><span class="op" id="3343876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343881">w</span><span class="op" id="3343882">.</span><span class="ident" id="3343883">Write</span><span class="op" id="3343888">(</span><span class="ident" id="3343889">nl</span><span class="op" id="3343891">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343896">for</span>&nbsp;<span class="ident" id="3343900">_</span><span class="op" id="3343901">,</span>&nbsp;<span class="ident" id="3343903">line</span>&nbsp;<span class="op" id="3343908">:=</span>&nbsp;<span class="keyword" id="3343911">range</span>&nbsp;<span class="ident" id="3343917">b</span><span class="op" id="3343918">.</span><span class="ident" id="3343919">lines</span>&nbsp;<span class="op" id="3343925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343931">if</span>&nbsp;<span class="ident" id="3343934">isBlank</span><span class="op" id="3343941">(</span><span class="ident" id="3343942">line</span><span class="op" id="3343946">)</span>&nbsp;<span class="op" id="3343948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343955">w</span><span class="op" id="3343956">.</span><span class="ident" id="3343957">Write</span><span class="op" id="3343962">(</span><span class="op" id="3343963">[</span><span class="op" id="3343964">]</span><span class="builtintype" id="3343965">byte</span><span class="op" id="3343969">(</span><span class="string" id="3343970">&#34;\n&#34;</span><span class="op" id="3343974">)</span><span class="op" id="3343975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343981">}</span>&nbsp;<span class="keyword" id="3343983">else</span>&nbsp;<span class="op" id="3343988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343995">w</span><span class="op" id="3343996">.</span><span class="ident" id="3343997">Write</span><span class="op" id="3344002">(</span><span class="op" id="3344003">[</span><span class="op" id="3344004">]</span><span class="builtintype" id="3344005">byte</span><span class="op" id="3344009">(</span><span class="ident" id="3344010">preIndent</span><span class="op" id="3344019">)</span><span class="op" id="3344020">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344027">w</span><span class="op" id="3344028">.</span><span class="ident" id="3344029">Write</span><span class="op" id="3344034">(</span><span class="op" id="3344035">[</span><span class="op" id="3344036">]</span><span class="builtintype" id="3344037">byte</span><span class="op" id="3344041">(</span><span class="ident" id="3344042">line</span><span class="op" id="3344046">)</span><span class="op" id="3344047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344065">}</span><br>
<span class="lineno">435</span><span class="op" id="3344067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3344070">type</span>&nbsp;<span class="ident" id="3344075">lineWrapper</span>&nbsp;<span class="keyword" id="3344087">struct</span>&nbsp;<span class="op" id="3344094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344097">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344107">io</span><span class="op" id="3344109">.</span><span class="ident" id="3344110">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344118">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3344128">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344134">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3344144">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344149">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3344159">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344167">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3344177">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344182">pendSpace</span>&nbsp;<span class="builtintype" id="3344192">int</span><br>
<span class="lineno"></span><span class="op" id="3344196">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="3344199">var</span>&nbsp;<span class="ident" id="3344203">nl</span>&nbsp;<span class="op" id="3344206">=</span>&nbsp;<span class="op" id="3344208">[</span><span class="op" id="3344209">]</span><span class="builtintype" id="3344210">byte</span><span class="op" id="3344214">(</span><span class="string" id="3344215">&#34;\n&#34;</span><span class="op" id="3344219">)</span><br>
<span class="lineno"></span><span class="keyword" id="3344221">var</span>&nbsp;<span class="ident" id="3344225">space</span>&nbsp;<span class="op" id="3344231">=</span>&nbsp;<span class="op" id="3344233">[</span><span class="op" id="3344234">]</span><span class="builtintype" id="3344235">byte</span><span class="op" id="3344239">(</span><span class="string" id="3344240">&#34;&nbsp;&#34;</span><span class="op" id="3344243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3344246">func</span>&nbsp;<span class="op" id="3344251">(</span><span class="ident" id="3344252">l</span>&nbsp;<span class="op" id="3344254">*</span><span class="ident" id="3344255">lineWrapper</span><span class="op" id="3344266">)</span>&nbsp;<span class="ident" id="3344268">write</span><span class="op" id="3344273">(</span><span class="ident" id="3344274">text</span>&nbsp;<span class="builtintype" id="3344279">string</span><span class="op" id="3344285">)</span>&nbsp;<span class="op" id="3344287">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344290">if</span>&nbsp;<span class="ident" id="3344293">l</span><span class="op" id="3344294">.</span><span class="ident" id="3344295">n</span>&nbsp;<span class="op" id="3344297">==</span>&nbsp;<span class="num" id="3344300">0</span>&nbsp;<span class="op" id="3344302">&amp;&amp;</span>&nbsp;<span class="ident" id="3344305">l</span><span class="op" id="3344306">.</span><span class="ident" id="3344307">printed</span>&nbsp;<span class="op" id="3344315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344319">l</span><span class="op" id="3344320">.</span><span class="ident" id="3344321">out</span><span class="op" id="3344324">.</span><span class="ident" id="3344325">Write</span><span class="op" id="3344330">(</span><span class="ident" id="3344331">nl</span><span class="op" id="3344333">)</span>&nbsp;<span class="comment" id="3344335">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344374">l</span><span class="op" id="3344375">.</span><span class="ident" id="3344376">printed</span>&nbsp;<span class="op" id="3344384">=</span>&nbsp;<span class="builtintype" id="3344386">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344393">for</span>&nbsp;<span class="ident" id="3344397">_</span><span class="op" id="3344398">,</span>&nbsp;<span class="ident" id="3344400">f</span>&nbsp;<span class="op" id="3344402">:=</span>&nbsp;<span class="keyword" id="3344405">range</span>&nbsp;<span class="ident" id="3344411">strings</span><span class="op" id="3344418">.</span><span class="ident" id="3344419">Fields</span><span class="op" id="3344425">(</span><span class="ident" id="3344426">text</span><span class="op" id="3344430">)</span>&nbsp;<span class="op" id="3344432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344436">w</span>&nbsp;<span class="op" id="3344438">:=</span>&nbsp;<span class="ident" id="3344441">utf8</span><span class="op" id="3344445">.</span><span class="ident" id="3344446">RuneCountInString</span><span class="op" id="3344463">(</span><span class="ident" id="3344464">f</span><span class="op" id="3344465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3344469">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344499">if</span>&nbsp;<span class="ident" id="3344502">l</span><span class="op" id="3344503">.</span><span class="ident" id="3344504">n</span>&nbsp;<span class="op" id="3344506">&gt;</span>&nbsp;<span class="num" id="3344508">0</span>&nbsp;<span class="op" id="3344510">&amp;&amp;</span>&nbsp;<span class="ident" id="3344513">l</span><span class="op" id="3344514">.</span><span class="ident" id="3344515">n</span><span class="op" id="3344516">+</span><span class="ident" id="3344517">l</span><span class="op" id="3344518">.</span><span class="ident" id="3344519">pendSpace</span><span class="op" id="3344528">+</span><span class="ident" id="3344529">w</span>&nbsp;<span class="op" id="3344531">&gt;</span>&nbsp;<span class="ident" id="3344533">l</span><span class="op" id="3344534">.</span><span class="ident" id="3344535">width</span>&nbsp;<span class="op" id="3344541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344546">l</span><span class="op" id="3344547">.</span><span class="ident" id="3344548">out</span><span class="op" id="3344551">.</span><span class="ident" id="3344552">Write</span><span class="op" id="3344557">(</span><span class="ident" id="3344558">nl</span><span class="op" id="3344560">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344565">l</span><span class="op" id="3344566">.</span><span class="ident" id="3344567">n</span>&nbsp;<span class="op" id="3344569">=</span>&nbsp;<span class="num" id="3344571">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344576">l</span><span class="op" id="3344577">.</span><span class="ident" id="3344578">pendSpace</span>&nbsp;<span class="op" id="3344588">=</span>&nbsp;<span class="num" id="3344590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344598">if</span>&nbsp;<span class="ident" id="3344601">l</span><span class="op" id="3344602">.</span><span class="ident" id="3344603">n</span>&nbsp;<span class="op" id="3344605">==</span>&nbsp;<span class="num" id="3344608">0</span>&nbsp;<span class="op" id="3344610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344615">l</span><span class="op" id="3344616">.</span><span class="ident" id="3344617">out</span><span class="op" id="3344620">.</span><span class="ident" id="3344621">Write</span><span class="op" id="3344626">(</span><span class="op" id="3344627">[</span><span class="op" id="3344628">]</span><span class="builtintype" id="3344629">byte</span><span class="op" id="3344633">(</span><span class="ident" id="3344634">l</span><span class="op" id="3344635">.</span><span class="ident" id="3344636">indent</span><span class="op" id="3344642">)</span><span class="op" id="3344643">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344651">l</span><span class="op" id="3344652">.</span><span class="ident" id="3344653">out</span><span class="op" id="3344656">.</span><span class="ident" id="3344657">Write</span><span class="op" id="3344662">(</span><span class="ident" id="3344663">space</span><span class="op" id="3344668">[</span><span class="op" id="3344669">:</span><span class="ident" id="3344670">l</span><span class="op" id="3344671">.</span><span class="ident" id="3344672">pendSpace</span><span class="op" id="3344681">]</span><span class="op" id="3344682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344686">l</span><span class="op" id="3344687">.</span><span class="ident" id="3344688">out</span><span class="op" id="3344691">.</span><span class="ident" id="3344692">Write</span><span class="op" id="3344697">(</span><span class="op" id="3344698">[</span><span class="op" id="3344699">]</span><span class="builtintype" id="3344700">byte</span><span class="op" id="3344704">(</span><span class="ident" id="3344705">f</span><span class="op" id="3344706">)</span><span class="op" id="3344707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344711">l</span><span class="op" id="3344712">.</span><span class="ident" id="3344713">n</span>&nbsp;<span class="op" id="3344715">+=</span>&nbsp;<span class="ident" id="3344718">l</span><span class="op" id="3344719">.</span><span class="ident" id="3344720">pendSpace</span>&nbsp;<span class="op" id="3344730">+</span>&nbsp;<span class="ident" id="3344732">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344736">l</span><span class="op" id="3344737">.</span><span class="ident" id="3344738">pendSpace</span>&nbsp;<span class="op" id="3344748">=</span>&nbsp;<span class="num" id="3344750">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344753">}</span><br>
<span class="lineno"></span><span class="op" id="3344755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3344758">func</span>&nbsp;<span class="op" id="3344763">(</span><span class="ident" id="3344764">l</span>&nbsp;<span class="op" id="3344766">*</span><span class="ident" id="3344767">lineWrapper</span><span class="op" id="3344778">)</span>&nbsp;<span class="ident" id="3344780">flush</span><span class="op" id="3344785">(</span><span class="op" id="3344786">)</span>&nbsp;<span class="op" id="3344788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344791">if</span>&nbsp;<span class="ident" id="3344794">l</span><span class="op" id="3344795">.</span><span class="ident" id="3344796">n</span>&nbsp;<span class="op" id="3344798">==</span>&nbsp;<span class="num" id="3344801">0</span>&nbsp;<span class="op" id="3344803">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344818">l</span><span class="op" id="3344819">.</span><span class="ident" id="3344820">out</span><span class="op" id="3344823">.</span><span class="ident" id="3344824">Write</span><span class="op" id="3344829">(</span><span class="ident" id="3344830">nl</span><span class="op" id="3344832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344835">l</span><span class="op" id="3344836">.</span><span class="ident" id="3344837">pendSpace</span>&nbsp;<span class="op" id="3344847">=</span>&nbsp;<span class="num" id="3344849">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344852">l</span><span class="op" id="3344853">.</span><span class="ident" id="3344854">n</span>&nbsp;<span class="op" id="3344856">=</span>&nbsp;<span class="num" id="3344858">0</span><br>
<span class="lineno">480</span><span class="op" id="3344860">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
