<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html" class="current">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2370418">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2370474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2370528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2370579">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2370649">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2370681">package</span>&nbsp;<span class="ident" id="2370689">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2370698">import</span>&nbsp;<span class="string" id="2370705">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2370713">var</span>&nbsp;<span class="op" id="2370717">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2370720">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2370787">envOnce</span>&nbsp;<span class="ident" id="2370795">sync</span><span class="op" id="2370799">.</span><span class="ident" id="2370800">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2370807">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2370840">envLock</span>&nbsp;<span class="ident" id="2370848">sync</span><span class="op" id="2370852">.</span><span class="ident" id="2370853">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2370863">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2370938">env</span>&nbsp;<span class="keyword" id="2370942">map</span><span class="op" id="2370945">[</span><span class="builtintype" id="2370946">string</span><span class="op" id="2370952">]</span><span class="builtintype" id="2370953">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2370959">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371021">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371083">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371119">envs</span>&nbsp;<span class="op" id="2371124">[</span><span class="op" id="2371125">]</span><span class="builtintype" id="2371126">string</span>&nbsp;<span class="op" id="2371133">=</span>&nbsp;<span class="ident" id="2371135">runtime_envs</span><span class="op" id="2371147">(</span><span class="op" id="2371148">)</span><br>
<span class="lineno"></span><span class="op" id="2371150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2371153">func</span>&nbsp;<span class="ident" id="2371158">runtime_envs</span><span class="op" id="2371170">(</span><span class="op" id="2371171">)</span>&nbsp;<span class="op" id="2371173">[</span><span class="op" id="2371174">]</span><span class="builtintype" id="2371175">string</span>&nbsp;<span class="comment" id="2371182">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2371205">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2371275">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2371299">func</span>&nbsp;<span class="ident" id="2371304">setenv_c</span><span class="op" id="2371312">(</span><span class="ident" id="2371313">k</span><span class="op" id="2371314">,</span>&nbsp;<span class="ident" id="2371316">v</span>&nbsp;<span class="builtintype" id="2371318">string</span><span class="op" id="2371324">)</span><br>
<span class="lineno"></span><span class="keyword" id="2371326">func</span>&nbsp;<span class="ident" id="2371331">unsetenv_c</span><span class="op" id="2371341">(</span><span class="ident" id="2371342">k</span>&nbsp;<span class="builtintype" id="2371344">string</span><span class="op" id="2371350">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2371353">func</span>&nbsp;<span class="ident" id="2371358">copyenv</span><span class="op" id="2371365">(</span><span class="op" id="2371366">)</span>&nbsp;<span class="op" id="2371368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371371">env</span>&nbsp;<span class="op" id="2371375">=</span>&nbsp;<span class="builtinfunc" id="2371377">make</span><span class="op" id="2371381">(</span><span class="keyword" id="2371382">map</span><span class="op" id="2371385">[</span><span class="builtintype" id="2371386">string</span><span class="op" id="2371392">]</span><span class="builtintype" id="2371393">int</span><span class="op" id="2371396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371399">for</span>&nbsp;<span class="ident" id="2371403">i</span><span class="op" id="2371404">,</span>&nbsp;<span class="ident" id="2371406">s</span>&nbsp;<span class="op" id="2371408">:=</span>&nbsp;<span class="keyword" id="2371411">range</span>&nbsp;<span class="ident" id="2371417">envs</span>&nbsp;<span class="op" id="2371422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371426">for</span>&nbsp;<span class="ident" id="2371430">j</span>&nbsp;<span class="op" id="2371432">:=</span>&nbsp;<span class="num" id="2371435">0</span><span class="op" id="2371436">;</span>&nbsp;<span class="ident" id="2371438">j</span>&nbsp;<span class="op" id="2371440">&lt;</span>&nbsp;<span class="builtinfunc" id="2371442">len</span><span class="op" id="2371445">(</span><span class="ident" id="2371446">s</span><span class="op" id="2371447">)</span><span class="op" id="2371448">;</span>&nbsp;<span class="ident" id="2371450">j</span><span class="op" id="2371451">++</span>&nbsp;<span class="op" id="2371454">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371459">if</span>&nbsp;<span class="ident" id="2371462">s</span><span class="op" id="2371463">[</span><span class="ident" id="2371464">j</span><span class="op" id="2371465">]</span>&nbsp;<span class="op" id="2371467">==</span>&nbsp;<span class="string" id="2371470">&#39;=&#39;</span>&nbsp;<span class="op" id="2371474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371480">key</span>&nbsp;<span class="op" id="2371484">:=</span>&nbsp;<span class="ident" id="2371487">s</span><span class="op" id="2371488">[</span><span class="op" id="2371489">:</span><span class="ident" id="2371490">j</span><span class="op" id="2371491">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371497">if</span>&nbsp;<span class="ident" id="2371500">_</span><span class="op" id="2371501">,</span>&nbsp;<span class="ident" id="2371503">ok</span>&nbsp;<span class="op" id="2371506">:=</span>&nbsp;<span class="ident" id="2371509">env</span><span class="op" id="2371512">[</span><span class="ident" id="2371513">key</span><span class="op" id="2371516">]</span><span class="op" id="2371517">;</span>&nbsp;<span class="op" id="2371519">!</span><span class="ident" id="2371520">ok</span>&nbsp;<span class="op" id="2371523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371530">env</span><span class="op" id="2371533">[</span><span class="ident" id="2371534">key</span><span class="op" id="2371537">]</span>&nbsp;<span class="op" id="2371539">=</span>&nbsp;<span class="ident" id="2371541">i</span>&nbsp;<span class="comment" id="2371543">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371571">}</span>&nbsp;<span class="keyword" id="2371573">else</span>&nbsp;<span class="op" id="2371578">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371585">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371640">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371690">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2371738">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371781">envs</span><span class="op" id="2371785">[</span><span class="ident" id="2371786">i</span><span class="op" id="2371787">]</span>&nbsp;<span class="op" id="2371789">=</span>&nbsp;<span class="string" id="2371791">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371804">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371820">}</span><br>
<span class="lineno">55</span><span class="op" id="2371822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2371825">func</span>&nbsp;<span class="ident" id="2371830">Unsetenv</span><span class="op" id="2371838">(</span><span class="ident" id="2371839">key</span>&nbsp;<span class="builtintype" id="2371843">string</span><span class="op" id="2371849">)</span>&nbsp;<span class="builtintype" id="2371851">error</span>&nbsp;<span class="op" id="2371857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371860">envOnce</span><span class="op" id="2371867">.</span><span class="ident" id="2371868">Do</span><span class="op" id="2371870">(</span><span class="ident" id="2371871">copyenv</span><span class="op" id="2371878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371882">envLock</span><span class="op" id="2371889">.</span><span class="ident" id="2371890">Lock</span><span class="op" id="2371894">(</span><span class="op" id="2371895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371898">defer</span>&nbsp;<span class="ident" id="2371904">envLock</span><span class="op" id="2371911">.</span><span class="ident" id="2371912">Unlock</span><span class="op" id="2371918">(</span><span class="op" id="2371919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2371923">if</span>&nbsp;<span class="ident" id="2371926">i</span><span class="op" id="2371927">,</span>&nbsp;<span class="ident" id="2371929">ok</span>&nbsp;<span class="op" id="2371932">:=</span>&nbsp;<span class="ident" id="2371935">env</span><span class="op" id="2371938">[</span><span class="ident" id="2371939">key</span><span class="op" id="2371942">]</span><span class="op" id="2371943">;</span>&nbsp;<span class="ident" id="2371945">ok</span>&nbsp;<span class="op" id="2371948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371952">envs</span><span class="op" id="2371956">[</span><span class="ident" id="2371957">i</span><span class="op" id="2371958">]</span>&nbsp;<span class="op" id="2371960">=</span>&nbsp;<span class="string" id="2371962">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2371967">delete</span><span class="op" id="2371973">(</span><span class="ident" id="2371974">env</span><span class="op" id="2371977">,</span>&nbsp;<span class="ident" id="2371979">key</span><span class="op" id="2371982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2371985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2371988">unsetenv_c</span><span class="op" id="2371998">(</span><span class="ident" id="2371999">key</span><span class="op" id="2372002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372005">return</span>&nbsp;<span class="builtintype" id="2372012">nil</span><br>
<span class="lineno"></span><span class="op" id="2372016">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2372019">func</span>&nbsp;<span class="ident" id="2372024">Getenv</span><span class="op" id="2372030">(</span><span class="ident" id="2372031">key</span>&nbsp;<span class="builtintype" id="2372035">string</span><span class="op" id="2372041">)</span>&nbsp;<span class="op" id="2372043">(</span><span class="ident" id="2372044">value</span>&nbsp;<span class="builtintype" id="2372050">string</span><span class="op" id="2372056">,</span>&nbsp;<span class="ident" id="2372058">found</span>&nbsp;<span class="builtintype" id="2372064">bool</span><span class="op" id="2372068">)</span>&nbsp;<span class="op" id="2372070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372073">envOnce</span><span class="op" id="2372080">.</span><span class="ident" id="2372081">Do</span><span class="op" id="2372083">(</span><span class="ident" id="2372084">copyenv</span><span class="op" id="2372091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372094">if</span>&nbsp;<span class="builtinfunc" id="2372097">len</span><span class="op" id="2372100">(</span><span class="ident" id="2372101">key</span><span class="op" id="2372104">)</span>&nbsp;<span class="op" id="2372106">==</span>&nbsp;<span class="num" id="2372109">0</span>&nbsp;<span class="op" id="2372111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372115">return</span>&nbsp;<span class="string" id="2372122">&#34;&#34;</span><span class="op" id="2372124">,</span>&nbsp;<span class="builtintype" id="2372126">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372137">envLock</span><span class="op" id="2372144">.</span><span class="ident" id="2372145">RLock</span><span class="op" id="2372150">(</span><span class="op" id="2372151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372154">defer</span>&nbsp;<span class="ident" id="2372160">envLock</span><span class="op" id="2372167">.</span><span class="ident" id="2372168">RUnlock</span><span class="op" id="2372175">(</span><span class="op" id="2372176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372180">i</span><span class="op" id="2372181">,</span>&nbsp;<span class="ident" id="2372183">ok</span>&nbsp;<span class="op" id="2372186">:=</span>&nbsp;<span class="ident" id="2372189">env</span><span class="op" id="2372192">[</span><span class="ident" id="2372193">key</span><span class="op" id="2372196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372199">if</span>&nbsp;<span class="op" id="2372202">!</span><span class="ident" id="2372203">ok</span>&nbsp;<span class="op" id="2372206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372210">return</span>&nbsp;<span class="string" id="2372217">&#34;&#34;</span><span class="op" id="2372219">,</span>&nbsp;<span class="builtintype" id="2372221">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372231">s</span>&nbsp;<span class="op" id="2372233">:=</span>&nbsp;<span class="ident" id="2372236">envs</span><span class="op" id="2372240">[</span><span class="ident" id="2372241">i</span><span class="op" id="2372242">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372245">for</span>&nbsp;<span class="ident" id="2372249">i</span>&nbsp;<span class="op" id="2372251">:=</span>&nbsp;<span class="num" id="2372254">0</span><span class="op" id="2372255">;</span>&nbsp;<span class="ident" id="2372257">i</span>&nbsp;<span class="op" id="2372259">&lt;</span>&nbsp;<span class="builtinfunc" id="2372261">len</span><span class="op" id="2372264">(</span><span class="ident" id="2372265">s</span><span class="op" id="2372266">)</span><span class="op" id="2372267">;</span>&nbsp;<span class="ident" id="2372269">i</span><span class="op" id="2372270">++</span>&nbsp;<span class="op" id="2372273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372277">if</span>&nbsp;<span class="ident" id="2372280">s</span><span class="op" id="2372281">[</span><span class="ident" id="2372282">i</span><span class="op" id="2372283">]</span>&nbsp;<span class="op" id="2372285">==</span>&nbsp;<span class="string" id="2372288">&#39;=&#39;</span>&nbsp;<span class="op" id="2372292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372297">return</span>&nbsp;<span class="ident" id="2372304">s</span><span class="op" id="2372305">[</span><span class="ident" id="2372306">i</span><span class="op" id="2372307">+</span><span class="num" id="2372308">1</span><span class="op" id="2372309">:</span><span class="op" id="2372310">]</span><span class="op" id="2372311">,</span>&nbsp;<span class="builtintype" id="2372313">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372323">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372326">return</span>&nbsp;<span class="string" id="2372333">&#34;&#34;</span><span class="op" id="2372335">,</span>&nbsp;<span class="builtintype" id="2372337">false</span><br>
<span class="lineno"></span><span class="op" id="2372343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2372346">func</span>&nbsp;<span class="ident" id="2372351">Setenv</span><span class="op" id="2372357">(</span><span class="ident" id="2372358">key</span><span class="op" id="2372361">,</span>&nbsp;<span class="ident" id="2372363">value</span>&nbsp;<span class="builtintype" id="2372369">string</span><span class="op" id="2372375">)</span>&nbsp;<span class="builtintype" id="2372377">error</span>&nbsp;<span class="op" id="2372383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372386">envOnce</span><span class="op" id="2372393">.</span><span class="ident" id="2372394">Do</span><span class="op" id="2372396">(</span><span class="ident" id="2372397">copyenv</span><span class="op" id="2372404">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372407">if</span>&nbsp;<span class="builtinfunc" id="2372410">len</span><span class="op" id="2372413">(</span><span class="ident" id="2372414">key</span><span class="op" id="2372417">)</span>&nbsp;<span class="op" id="2372419">==</span>&nbsp;<span class="num" id="2372422">0</span>&nbsp;<span class="op" id="2372424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372428">return</span>&nbsp;<span class="ident" id="2372435">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372446">for</span>&nbsp;<span class="ident" id="2372450">i</span>&nbsp;<span class="op" id="2372452">:=</span>&nbsp;<span class="num" id="2372455">0</span><span class="op" id="2372456">;</span>&nbsp;<span class="ident" id="2372458">i</span>&nbsp;<span class="op" id="2372460">&lt;</span>&nbsp;<span class="builtinfunc" id="2372462">len</span><span class="op" id="2372465">(</span><span class="ident" id="2372466">key</span><span class="op" id="2372469">)</span><span class="op" id="2372470">;</span>&nbsp;<span class="ident" id="2372472">i</span><span class="op" id="2372473">++</span>&nbsp;<span class="op" id="2372476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372480">if</span>&nbsp;<span class="ident" id="2372483">key</span><span class="op" id="2372486">[</span><span class="ident" id="2372487">i</span><span class="op" id="2372488">]</span>&nbsp;<span class="op" id="2372490">==</span>&nbsp;<span class="string" id="2372493">&#39;=&#39;</span>&nbsp;<span class="op" id="2372497">||</span>&nbsp;<span class="ident" id="2372500">key</span><span class="op" id="2372503">[</span><span class="ident" id="2372504">i</span><span class="op" id="2372505">]</span>&nbsp;<span class="op" id="2372507">==</span>&nbsp;<span class="num" id="2372510">0</span>&nbsp;<span class="op" id="2372512">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372517">return</span>&nbsp;<span class="ident" id="2372524">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372539">for</span>&nbsp;<span class="ident" id="2372543">i</span>&nbsp;<span class="op" id="2372545">:=</span>&nbsp;<span class="num" id="2372548">0</span><span class="op" id="2372549">;</span>&nbsp;<span class="ident" id="2372551">i</span>&nbsp;<span class="op" id="2372553">&lt;</span>&nbsp;<span class="builtinfunc" id="2372555">len</span><span class="op" id="2372558">(</span><span class="ident" id="2372559">value</span><span class="op" id="2372564">)</span><span class="op" id="2372565">;</span>&nbsp;<span class="ident" id="2372567">i</span><span class="op" id="2372568">++</span>&nbsp;<span class="op" id="2372571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372575">if</span>&nbsp;<span class="ident" id="2372578">value</span><span class="op" id="2372583">[</span><span class="ident" id="2372584">i</span><span class="op" id="2372585">]</span>&nbsp;<span class="op" id="2372587">==</span>&nbsp;<span class="num" id="2372590">0</span>&nbsp;<span class="op" id="2372592">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372597">return</span>&nbsp;<span class="ident" id="2372604">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372620">envLock</span><span class="op" id="2372627">.</span><span class="ident" id="2372628">Lock</span><span class="op" id="2372632">(</span><span class="op" id="2372633">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372636">defer</span>&nbsp;<span class="ident" id="2372642">envLock</span><span class="op" id="2372649">.</span><span class="ident" id="2372650">Unlock</span><span class="op" id="2372656">(</span><span class="op" id="2372657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372661">i</span><span class="op" id="2372662">,</span>&nbsp;<span class="ident" id="2372664">ok</span>&nbsp;<span class="op" id="2372667">:=</span>&nbsp;<span class="ident" id="2372670">env</span><span class="op" id="2372673">[</span><span class="ident" id="2372674">key</span><span class="op" id="2372677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372680">kv</span>&nbsp;<span class="op" id="2372683">:=</span>&nbsp;<span class="ident" id="2372686">key</span>&nbsp;<span class="op" id="2372690">+</span>&nbsp;<span class="string" id="2372692">&#34;=&#34;</span>&nbsp;<span class="op" id="2372696">+</span>&nbsp;<span class="ident" id="2372698">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372705">if</span>&nbsp;<span class="ident" id="2372708">ok</span>&nbsp;<span class="op" id="2372711">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372715">envs</span><span class="op" id="2372719">[</span><span class="ident" id="2372720">i</span><span class="op" id="2372721">]</span>&nbsp;<span class="op" id="2372723">=</span>&nbsp;<span class="ident" id="2372725">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372729">}</span>&nbsp;<span class="keyword" id="2372731">else</span>&nbsp;<span class="op" id="2372736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372740">i</span>&nbsp;<span class="op" id="2372742">=</span>&nbsp;<span class="builtinfunc" id="2372744">len</span><span class="op" id="2372747">(</span><span class="ident" id="2372748">envs</span><span class="op" id="2372752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372756">envs</span>&nbsp;<span class="op" id="2372761">=</span>&nbsp;<span class="builtinfunc" id="2372763">append</span><span class="op" id="2372769">(</span><span class="ident" id="2372770">envs</span><span class="op" id="2372774">,</span>&nbsp;<span class="ident" id="2372776">kv</span><span class="op" id="2372778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372781">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372784">env</span><span class="op" id="2372787">[</span><span class="ident" id="2372788">key</span><span class="op" id="2372791">]</span>&nbsp;<span class="op" id="2372793">=</span>&nbsp;<span class="ident" id="2372795">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372798">setenv_c</span><span class="op" id="2372806">(</span><span class="ident" id="2372807">key</span><span class="op" id="2372810">,</span>&nbsp;<span class="ident" id="2372812">value</span><span class="op" id="2372817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372820">return</span>&nbsp;<span class="builtintype" id="2372827">nil</span><br>
<span class="lineno"></span><span class="op" id="2372831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2372834">func</span>&nbsp;<span class="ident" id="2372839">Clearenv</span><span class="op" id="2372847">(</span><span class="op" id="2372848">)</span>&nbsp;<span class="op" id="2372850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372853">envOnce</span><span class="op" id="2372860">.</span><span class="ident" id="2372861">Do</span><span class="op" id="2372863">(</span><span class="ident" id="2372864">copyenv</span><span class="op" id="2372871">)</span>&nbsp;<span class="comment" id="2372873">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372911">envLock</span><span class="op" id="2372918">.</span><span class="ident" id="2372919">Lock</span><span class="op" id="2372923">(</span><span class="op" id="2372924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372927">defer</span>&nbsp;<span class="ident" id="2372933">envLock</span><span class="op" id="2372940">.</span><span class="ident" id="2372941">Unlock</span><span class="op" id="2372947">(</span><span class="op" id="2372948">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2372952">for</span>&nbsp;<span class="ident" id="2372956">k</span>&nbsp;<span class="op" id="2372958">:=</span>&nbsp;<span class="keyword" id="2372961">range</span>&nbsp;<span class="ident" id="2372967">env</span>&nbsp;<span class="op" id="2372971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372975">unsetenv_c</span><span class="op" id="2372985">(</span><span class="ident" id="2372986">k</span><span class="op" id="2372987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2372990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2372993">env</span>&nbsp;<span class="op" id="2372997">=</span>&nbsp;<span class="builtinfunc" id="2372999">make</span><span class="op" id="2373003">(</span><span class="keyword" id="2373004">map</span><span class="op" id="2373007">[</span><span class="builtintype" id="2373008">string</span><span class="op" id="2373014">]</span><span class="builtintype" id="2373015">int</span><span class="op" id="2373018">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2373021">envs</span>&nbsp;<span class="op" id="2373026">=</span>&nbsp;<span class="op" id="2373028">[</span><span class="op" id="2373029">]</span><span class="builtintype" id="2373030">string</span><span class="op" id="2373036">{</span><span class="op" id="2373037">}</span><br>
<span class="lineno"></span><span class="op" id="2373039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2373042">func</span>&nbsp;<span class="ident" id="2373047">Environ</span><span class="op" id="2373054">(</span><span class="op" id="2373055">)</span>&nbsp;<span class="op" id="2373057">[</span><span class="op" id="2373058">]</span><span class="builtintype" id="2373059">string</span>&nbsp;<span class="op" id="2373066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2373069">envOnce</span><span class="op" id="2373076">.</span><span class="ident" id="2373077">Do</span><span class="op" id="2373079">(</span><span class="ident" id="2373080">copyenv</span><span class="op" id="2373087">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2373090">envLock</span><span class="op" id="2373097">.</span><span class="ident" id="2373098">RLock</span><span class="op" id="2373103">(</span><span class="op" id="2373104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2373107">defer</span>&nbsp;<span class="ident" id="2373113">envLock</span><span class="op" id="2373120">.</span><span class="ident" id="2373121">RUnlock</span><span class="op" id="2373128">(</span><span class="op" id="2373129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2373132">a</span>&nbsp;<span class="op" id="2373134">:=</span>&nbsp;<span class="builtinfunc" id="2373137">make</span><span class="op" id="2373141">(</span><span class="op" id="2373142">[</span><span class="op" id="2373143">]</span><span class="builtintype" id="2373144">string</span><span class="op" id="2373150">,</span>&nbsp;<span class="num" id="2373152">0</span><span class="op" id="2373153">,</span>&nbsp;<span class="builtinfunc" id="2373155">len</span><span class="op" id="2373158">(</span><span class="ident" id="2373159">envs</span><span class="op" id="2373163">)</span><span class="op" id="2373164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2373167">for</span>&nbsp;<span class="ident" id="2373171">_</span><span class="op" id="2373172">,</span>&nbsp;<span class="ident" id="2373174">env</span>&nbsp;<span class="op" id="2373178">:=</span>&nbsp;<span class="keyword" id="2373181">range</span>&nbsp;<span class="ident" id="2373187">envs</span>&nbsp;<span class="op" id="2373192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2373196">if</span>&nbsp;<span class="ident" id="2373199">env</span>&nbsp;<span class="op" id="2373203">!=</span>&nbsp;<span class="string" id="2373206">&#34;&#34;</span>&nbsp;<span class="op" id="2373209">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2373214">a</span>&nbsp;<span class="op" id="2373216">=</span>&nbsp;<span class="builtinfunc" id="2373218">append</span><span class="op" id="2373224">(</span><span class="ident" id="2373225">a</span><span class="op" id="2373226">,</span>&nbsp;<span class="ident" id="2373228">env</span><span class="op" id="2373231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2373235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2373238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2373241">return</span>&nbsp;<span class="ident" id="2373248">a</span><br>
<span class="lineno"></span><span class="op" id="2373250">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
