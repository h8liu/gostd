<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4732462">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4732517">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4732571">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4732622">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4732687">package</span>&nbsp;<span class="ident" id="4732695">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4732700">import</span>&nbsp;<span class="op" id="4732707">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732710">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732720">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732735">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732752">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732762">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732770">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4732776">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4732787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4732790">var</span>&nbsp;<span class="ident" id="4732794">bigZero</span>&nbsp;<span class="op" id="4732802">=</span>&nbsp;<span class="ident" id="4732804">big</span><span class="op" id="4732807">.</span><span class="ident" id="4732808">NewInt</span><span class="op" id="4732814">(</span><span class="num" id="4732815">0</span><span class="op" id="4732816">)</span><br>
<span class="lineno"></span><span class="keyword" id="4732818">var</span>&nbsp;<span class="ident" id="4732822">bigOne</span>&nbsp;<span class="op" id="4732829">=</span>&nbsp;<span class="ident" id="4732831">big</span><span class="op" id="4732834">.</span><span class="ident" id="4732835">NewInt</span><span class="op" id="4732841">(</span><span class="num" id="4732842">1</span><span class="op" id="4732843">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4732846">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4732903">type</span>&nbsp;<span class="ident" id="4732908">PublicKey</span>&nbsp;<span class="keyword" id="4732918">struct</span>&nbsp;<span class="op" id="4732925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732928">N</span>&nbsp;<span class="op" id="4732930">*</span><span class="ident" id="4732931">big</span><span class="op" id="4732934">.</span><span class="ident" id="4732935">Int</span>&nbsp;<span class="comment" id="4732939">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732951">E</span>&nbsp;<span class="builtintype" id="4732953">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4732962">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4732981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4732984">var</span>&nbsp;<span class="op" id="4732988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732991">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733014">=</span>&nbsp;<span class="ident" id="4733016">errors</span><span class="op" id="4733022">.</span><span class="ident" id="4733023">New</span><span class="op" id="4733026">(</span><span class="string" id="4733027">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4733063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733066">errPublicExponentSmall</span>&nbsp;<span class="op" id="4733089">=</span>&nbsp;<span class="ident" id="4733091">errors</span><span class="op" id="4733097">.</span><span class="ident" id="4733098">New</span><span class="op" id="4733101">(</span><span class="string" id="4733102">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4733141">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733144">errPublicExponentLarge</span>&nbsp;<span class="op" id="4733167">=</span>&nbsp;<span class="ident" id="4733169">errors</span><span class="op" id="4733175">.</span><span class="ident" id="4733176">New</span><span class="op" id="4733179">(</span><span class="string" id="4733180">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4733219">)</span><br>
<span class="lineno"></span><span class="op" id="4733221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4733224">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4733283">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4733343">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4733398">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4733432">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4733487">func</span>&nbsp;<span class="ident" id="4733492">checkPub</span><span class="op" id="4733500">(</span><span class="ident" id="4733501">pub</span>&nbsp;<span class="op" id="4733505">*</span><span class="ident" id="4733506">PublicKey</span><span class="op" id="4733515">)</span>&nbsp;<span class="builtintype" id="4733517">error</span>&nbsp;<span class="op" id="4733523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733526">if</span>&nbsp;<span class="ident" id="4733529">pub</span><span class="op" id="4733532">.</span><span class="ident" id="4733533">N</span>&nbsp;<span class="op" id="4733535">==</span>&nbsp;<span class="ident" id="4733538">nil</span>&nbsp;<span class="op" id="4733542">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733546">return</span>&nbsp;<span class="ident" id="4733553">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733574">if</span>&nbsp;<span class="ident" id="4733577">pub</span><span class="op" id="4733580">.</span><span class="ident" id="4733581">E</span>&nbsp;<span class="op" id="4733583">&lt;</span>&nbsp;<span class="num" id="4733585">2</span>&nbsp;<span class="op" id="4733587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733591">return</span>&nbsp;<span class="ident" id="4733598">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733622">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733625">if</span>&nbsp;<span class="ident" id="4733628">pub</span><span class="op" id="4733631">.</span><span class="ident" id="4733632">E</span>&nbsp;<span class="op" id="4733634">&gt;</span>&nbsp;<span class="num" id="4733636">1</span><span class="op" id="4733637">&lt;&lt;</span><span class="num" id="4733639">31</span><span class="op" id="4733641">-</span><span class="num" id="4733642">1</span>&nbsp;<span class="op" id="4733644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733648">return</span>&nbsp;<span class="ident" id="4733655">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733682">return</span>&nbsp;<span class="ident" id="4733689">nil</span><br>
<span class="lineno"></span><span class="op" id="4733693">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4733696">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4733734">type</span>&nbsp;<span class="ident" id="4733739">PrivateKey</span>&nbsp;<span class="keyword" id="4733750">struct</span>&nbsp;<span class="op" id="4733757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733760">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4733781">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733798">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733808">*</span><span class="ident" id="4733809">big</span><span class="op" id="4733812">.</span><span class="ident" id="4733813">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4733819">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733840">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733850">[</span><span class="op" id="4733851">]</span><span class="op" id="4733852">*</span><span class="ident" id="4733853">big</span><span class="op" id="4733856">.</span><span class="ident" id="4733857">Int</span>&nbsp;<span class="comment" id="4733861">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733905">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733971">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734001">Precomputed</span>&nbsp;<span class="ident" id="4734013">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4734031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4734034">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4734090">func</span>&nbsp;<span class="op" id="4734095">(</span><span class="ident" id="4734096">priv</span>&nbsp;<span class="op" id="4734101">*</span><span class="ident" id="4734102">PrivateKey</span><span class="op" id="4734112">)</span>&nbsp;<span class="ident" id="4734114">Public</span><span class="op" id="4734120">(</span><span class="op" id="4734121">)</span>&nbsp;<span class="ident" id="4734123">crypto</span><span class="op" id="4734129">.</span><span class="ident" id="4734130">PublicKey</span>&nbsp;<span class="op" id="4734140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734143">return</span>&nbsp;<span class="op" id="4734150">&amp;</span><span class="ident" id="4734151">priv</span><span class="op" id="4734155">.</span><span class="ident" id="4734156">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4734166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4734169">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4734241">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4734320">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4734398">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4734475">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4734505">func</span>&nbsp;<span class="op" id="4734510">(</span><span class="ident" id="4734511">priv</span>&nbsp;<span class="op" id="4734516">*</span><span class="ident" id="4734517">PrivateKey</span><span class="op" id="4734527">)</span>&nbsp;<span class="ident" id="4734529">Sign</span><span class="op" id="4734533">(</span><span class="ident" id="4734534">rand</span>&nbsp;<span class="ident" id="4734539">io</span><span class="op" id="4734541">.</span><span class="ident" id="4734542">Reader</span><span class="op" id="4734548">,</span>&nbsp;<span class="ident" id="4734550">msg</span>&nbsp;<span class="op" id="4734554">[</span><span class="op" id="4734555">]</span><span class="builtintype" id="4734556">byte</span><span class="op" id="4734560">,</span>&nbsp;<span class="ident" id="4734562">opts</span>&nbsp;<span class="ident" id="4734567">crypto</span><span class="op" id="4734573">.</span><span class="ident" id="4734574">SignerOpts</span><span class="op" id="4734584">)</span>&nbsp;<span class="op" id="4734586">(</span><span class="op" id="4734587">[</span><span class="op" id="4734588">]</span><span class="builtintype" id="4734589">byte</span><span class="op" id="4734593">,</span>&nbsp;<span class="builtintype" id="4734595">error</span><span class="op" id="4734600">)</span>&nbsp;<span class="op" id="4734602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734605">if</span>&nbsp;<span class="ident" id="4734608">pssOpts</span><span class="op" id="4734615">,</span>&nbsp;<span class="ident" id="4734617">ok</span>&nbsp;<span class="op" id="4734620">:=</span>&nbsp;<span class="ident" id="4734623">opts</span><span class="op" id="4734627">.</span><span class="op" id="4734628">(</span><span class="op" id="4734629">*</span><span class="ident" id="4734630">PSSOptions</span><span class="op" id="4734640">)</span><span class="op" id="4734641">;</span>&nbsp;<span class="ident" id="4734643">ok</span>&nbsp;<span class="op" id="4734646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734650">return</span>&nbsp;<span class="ident" id="4734657">SignPSS</span><span class="op" id="4734664">(</span><span class="ident" id="4734665">rand</span><span class="op" id="4734669">,</span>&nbsp;<span class="ident" id="4734671">priv</span><span class="op" id="4734675">,</span>&nbsp;<span class="ident" id="4734677">pssOpts</span><span class="op" id="4734684">.</span><span class="ident" id="4734685">Hash</span><span class="op" id="4734689">,</span>&nbsp;<span class="ident" id="4734691">msg</span><span class="op" id="4734694">,</span>&nbsp;<span class="ident" id="4734696">pssOpts</span><span class="op" id="4734703">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4734706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734710">return</span>&nbsp;<span class="ident" id="4734717">SignPKCS1v15</span><span class="op" id="4734729">(</span><span class="ident" id="4734730">rand</span><span class="op" id="4734734">,</span>&nbsp;<span class="ident" id="4734736">priv</span><span class="op" id="4734740">,</span>&nbsp;<span class="ident" id="4734742">opts</span><span class="op" id="4734746">.</span><span class="ident" id="4734747">HashFunc</span><span class="op" id="4734755">(</span><span class="op" id="4734756">)</span><span class="op" id="4734757">,</span>&nbsp;<span class="ident" id="4734759">msg</span><span class="op" id="4734762">)</span><br>
<span class="lineno"></span><span class="op" id="4734764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4734767">type</span>&nbsp;<span class="ident" id="4734772">PrecomputedValues</span>&nbsp;<span class="keyword" id="4734790">struct</span>&nbsp;<span class="op" id="4734797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734800">Dp</span><span class="op" id="4734802">,</span>&nbsp;<span class="ident" id="4734804">Dq</span>&nbsp;<span class="op" id="4734807">*</span><span class="ident" id="4734808">big</span><span class="op" id="4734811">.</span><span class="ident" id="4734812">Int</span>&nbsp;<span class="comment" id="4734816">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734845">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4734852">*</span><span class="ident" id="4734853">big</span><span class="op" id="4734856">.</span><span class="ident" id="4734857">Int</span>&nbsp;<span class="comment" id="4734861">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734877">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734943">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735012">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735075">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735110">CRTValues</span>&nbsp;<span class="op" id="4735120">[</span><span class="op" id="4735121">]</span><span class="ident" id="4735122">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4735131">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4735134">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4735205">type</span>&nbsp;<span class="ident" id="4735210">CRTValue</span>&nbsp;<span class="keyword" id="4735219">struct</span>&nbsp;<span class="op" id="4735226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735229">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4735235">*</span><span class="ident" id="4735236">big</span><span class="op" id="4735239">.</span><span class="ident" id="4735240">Int</span>&nbsp;<span class="comment" id="4735244">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735265">Coeff</span>&nbsp;<span class="op" id="4735271">*</span><span class="ident" id="4735272">big</span><span class="op" id="4735275">.</span><span class="ident" id="4735276">Int</span>&nbsp;<span class="comment" id="4735280">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735310">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4735316">*</span><span class="ident" id="4735317">big</span><span class="op" id="4735320">.</span><span class="ident" id="4735321">Int</span>&nbsp;<span class="comment" id="4735325">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4735375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735378">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4735431">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4735509">func</span>&nbsp;<span class="op" id="4735514">(</span><span class="ident" id="4735515">priv</span>&nbsp;<span class="op" id="4735520">*</span><span class="ident" id="4735521">PrivateKey</span><span class="op" id="4735531">)</span>&nbsp;<span class="ident" id="4735533">Validate</span><span class="op" id="4735541">(</span><span class="op" id="4735542">)</span>&nbsp;<span class="builtintype" id="4735544">error</span>&nbsp;<span class="op" id="4735550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735553">if</span>&nbsp;<span class="ident" id="4735556">err</span>&nbsp;<span class="op" id="4735560">:=</span>&nbsp;<span class="ident" id="4735563">checkPub</span><span class="op" id="4735571">(</span><span class="op" id="4735572">&amp;</span><span class="ident" id="4735573">priv</span><span class="op" id="4735577">.</span><span class="ident" id="4735578">PublicKey</span><span class="op" id="4735587">)</span><span class="op" id="4735588">;</span>&nbsp;<span class="ident" id="4735590">err</span>&nbsp;<span class="op" id="4735594">!=</span>&nbsp;<span class="ident" id="4735597">nil</span>&nbsp;<span class="op" id="4735601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735605">return</span>&nbsp;<span class="ident" id="4735612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735621">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735692">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735754">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4735824">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735891">for</span>&nbsp;<span class="ident" id="4735895">_</span><span class="op" id="4735896">,</span>&nbsp;<span class="ident" id="4735898">prime</span>&nbsp;<span class="op" id="4735904">:=</span>&nbsp;<span class="keyword" id="4735907">range</span>&nbsp;<span class="ident" id="4735913">priv</span><span class="op" id="4735917">.</span><span class="ident" id="4735918">Primes</span>&nbsp;<span class="op" id="4735925">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735929">if</span>&nbsp;<span class="op" id="4735932">!</span><span class="ident" id="4735933">prime</span><span class="op" id="4735938">.</span><span class="ident" id="4735939">ProbablyPrime</span><span class="op" id="4735952">(</span><span class="num" id="4735953">20</span><span class="op" id="4735955">)</span>&nbsp;<span class="op" id="4735957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735962">return</span>&nbsp;<span class="ident" id="4735969">errors</span><span class="op" id="4735975">.</span><span class="ident" id="4735976">New</span><span class="op" id="4735979">(</span><span class="string" id="4735980">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4736019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736030">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736060">modulus</span>&nbsp;<span class="op" id="4736068">:=</span>&nbsp;<span class="builtinfunc" id="4736071">new</span><span class="op" id="4736074">(</span><span class="ident" id="4736075">big</span><span class="op" id="4736078">.</span><span class="ident" id="4736079">Int</span><span class="op" id="4736082">)</span><span class="op" id="4736083">.</span><span class="ident" id="4736084">Set</span><span class="op" id="4736087">(</span><span class="ident" id="4736088">bigOne</span><span class="op" id="4736094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736097">for</span>&nbsp;<span class="ident" id="4736101">_</span><span class="op" id="4736102">,</span>&nbsp;<span class="ident" id="4736104">prime</span>&nbsp;<span class="op" id="4736110">:=</span>&nbsp;<span class="keyword" id="4736113">range</span>&nbsp;<span class="ident" id="4736119">priv</span><span class="op" id="4736123">.</span><span class="ident" id="4736124">Primes</span>&nbsp;<span class="op" id="4736131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736135">modulus</span><span class="op" id="4736142">.</span><span class="ident" id="4736143">Mul</span><span class="op" id="4736146">(</span><span class="ident" id="4736147">modulus</span><span class="op" id="4736154">,</span>&nbsp;<span class="ident" id="4736156">prime</span><span class="op" id="4736161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736164">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736167">if</span>&nbsp;<span class="ident" id="4736170">modulus</span><span class="op" id="4736177">.</span><span class="ident" id="4736178">Cmp</span><span class="op" id="4736181">(</span><span class="ident" id="4736182">priv</span><span class="op" id="4736186">.</span><span class="ident" id="4736187">N</span><span class="op" id="4736188">)</span>&nbsp;<span class="op" id="4736190">!=</span>&nbsp;<span class="num" id="4736193">0</span>&nbsp;<span class="op" id="4736195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736199">return</span>&nbsp;<span class="ident" id="4736206">errors</span><span class="op" id="4736212">.</span><span class="ident" id="4736213">New</span><span class="op" id="4736216">(</span><span class="string" id="4736217">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4736246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736253">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736302">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736375">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736437">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4736516">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736586">congruence</span>&nbsp;<span class="op" id="4736597">:=</span>&nbsp;<span class="builtinfunc" id="4736600">new</span><span class="op" id="4736603">(</span><span class="ident" id="4736604">big</span><span class="op" id="4736607">.</span><span class="ident" id="4736608">Int</span><span class="op" id="4736611">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736614">de</span>&nbsp;<span class="op" id="4736617">:=</span>&nbsp;<span class="builtinfunc" id="4736620">new</span><span class="op" id="4736623">(</span><span class="ident" id="4736624">big</span><span class="op" id="4736627">.</span><span class="ident" id="4736628">Int</span><span class="op" id="4736631">)</span><span class="op" id="4736632">.</span><span class="ident" id="4736633">SetInt64</span><span class="op" id="4736641">(</span><span class="ident" id="4736642">int64</span><span class="op" id="4736647">(</span><span class="ident" id="4736648">priv</span><span class="op" id="4736652">.</span><span class="ident" id="4736653">E</span><span class="op" id="4736654">)</span><span class="op" id="4736655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736658">de</span><span class="op" id="4736660">.</span><span class="ident" id="4736661">Mul</span><span class="op" id="4736664">(</span><span class="ident" id="4736665">de</span><span class="op" id="4736667">,</span>&nbsp;<span class="ident" id="4736669">priv</span><span class="op" id="4736673">.</span><span class="ident" id="4736674">D</span><span class="op" id="4736675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736678">for</span>&nbsp;<span class="ident" id="4736682">_</span><span class="op" id="4736683">,</span>&nbsp;<span class="ident" id="4736685">prime</span>&nbsp;<span class="op" id="4736691">:=</span>&nbsp;<span class="keyword" id="4736694">range</span>&nbsp;<span class="ident" id="4736700">priv</span><span class="op" id="4736704">.</span><span class="ident" id="4736705">Primes</span>&nbsp;<span class="op" id="4736712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736716">pminus1</span>&nbsp;<span class="op" id="4736724">:=</span>&nbsp;<span class="builtinfunc" id="4736727">new</span><span class="op" id="4736730">(</span><span class="ident" id="4736731">big</span><span class="op" id="4736734">.</span><span class="ident" id="4736735">Int</span><span class="op" id="4736738">)</span><span class="op" id="4736739">.</span><span class="ident" id="4736740">Sub</span><span class="op" id="4736743">(</span><span class="ident" id="4736744">prime</span><span class="op" id="4736749">,</span>&nbsp;<span class="ident" id="4736751">bigOne</span><span class="op" id="4736757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736761">congruence</span><span class="op" id="4736771">.</span><span class="ident" id="4736772">Mod</span><span class="op" id="4736775">(</span><span class="ident" id="4736776">de</span><span class="op" id="4736778">,</span>&nbsp;<span class="ident" id="4736780">pminus1</span><span class="op" id="4736787">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736791">if</span>&nbsp;<span class="ident" id="4736794">congruence</span><span class="op" id="4736804">.</span><span class="ident" id="4736805">Cmp</span><span class="op" id="4736808">(</span><span class="ident" id="4736809">bigOne</span><span class="op" id="4736815">)</span>&nbsp;<span class="op" id="4736817">!=</span>&nbsp;<span class="num" id="4736820">0</span>&nbsp;<span class="op" id="4736822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736827">return</span>&nbsp;<span class="ident" id="4736834">errors</span><span class="op" id="4736840">.</span><span class="ident" id="4736841">New</span><span class="op" id="4736844">(</span><span class="string" id="4736845">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4736876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736886">return</span>&nbsp;<span class="ident" id="4736893">nil</span><br>
<span class="lineno">140</span><span class="op" id="4736897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4736900">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4736972">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4737031">func</span>&nbsp;<span class="ident" id="4737036">GenerateKey</span><span class="op" id="4737047">(</span><span class="ident" id="4737048">random</span>&nbsp;<span class="ident" id="4737055">io</span><span class="op" id="4737057">.</span><span class="ident" id="4737058">Reader</span><span class="op" id="4737064">,</span>&nbsp;<span class="ident" id="4737066">bits</span>&nbsp;<span class="builtintype" id="4737071">int</span><span class="op" id="4737074">)</span>&nbsp;<span class="op" id="4737076">(</span><span class="ident" id="4737077">priv</span>&nbsp;<span class="op" id="4737082">*</span><span class="ident" id="4737083">PrivateKey</span><span class="op" id="4737093">,</span>&nbsp;<span class="ident" id="4737095">err</span>&nbsp;<span class="builtintype" id="4737099">error</span><span class="op" id="4737104">)</span>&nbsp;<span class="op" id="4737106">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737109">return</span>&nbsp;<span class="ident" id="4737116">GenerateMultiPrimeKey</span><span class="op" id="4737137">(</span><span class="ident" id="4737138">random</span><span class="op" id="4737144">,</span>&nbsp;<span class="num" id="4737146">2</span><span class="op" id="4737147">,</span>&nbsp;<span class="ident" id="4737149">bits</span><span class="op" id="4737153">)</span><br>
<span class="lineno"></span><span class="op" id="4737155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737158">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4737236">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4737314">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4737390">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4737469">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4737546">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4737555">//</span><br>
<span class="lineno">155</span><span class="comment" id="4737558">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4737629">//</span><br>
<span class="lineno"></span><span class="comment" id="4737632">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4737673">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4737747">func</span>&nbsp;<span class="ident" id="4737752">GenerateMultiPrimeKey</span><span class="op" id="4737773">(</span><span class="ident" id="4737774">random</span>&nbsp;<span class="ident" id="4737781">io</span><span class="op" id="4737783">.</span><span class="ident" id="4737784">Reader</span><span class="op" id="4737790">,</span>&nbsp;<span class="ident" id="4737792">nprimes</span>&nbsp;<span class="builtintype" id="4737800">int</span><span class="op" id="4737803">,</span>&nbsp;<span class="ident" id="4737805">bits</span>&nbsp;<span class="builtintype" id="4737810">int</span><span class="op" id="4737813">)</span>&nbsp;<span class="op" id="4737815">(</span><span class="ident" id="4737816">priv</span>&nbsp;<span class="op" id="4737821">*</span><span class="ident" id="4737822">PrivateKey</span><span class="op" id="4737832">,</span>&nbsp;<span class="ident" id="4737834">err</span>&nbsp;<span class="builtintype" id="4737838">error</span><span class="op" id="4737843">)</span>&nbsp;<span class="op" id="4737845">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737848">priv</span>&nbsp;<span class="op" id="4737853">=</span>&nbsp;<span class="builtinfunc" id="4737855">new</span><span class="op" id="4737858">(</span><span class="ident" id="4737859">PrivateKey</span><span class="op" id="4737869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737872">priv</span><span class="op" id="4737876">.</span><span class="ident" id="4737877">E</span>&nbsp;<span class="op" id="4737879">=</span>&nbsp;<span class="num" id="4737881">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737889">if</span>&nbsp;<span class="ident" id="4737892">nprimes</span>&nbsp;<span class="op" id="4737900">&lt;</span>&nbsp;<span class="num" id="4737902">2</span>&nbsp;<span class="op" id="4737904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737908">return</span>&nbsp;<span class="ident" id="4737915">nil</span><span class="op" id="4737918">,</span>&nbsp;<span class="ident" id="4737920">errors</span><span class="op" id="4737926">.</span><span class="ident" id="4737927">New</span><span class="op" id="4737930">(</span><span class="string" id="4737931">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4737988">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737995">primes</span>&nbsp;<span class="op" id="4738002">:=</span>&nbsp;<span class="builtinfunc" id="4738005">make</span><span class="op" id="4738009">(</span><span class="op" id="4738010">[</span><span class="op" id="4738011">]</span><span class="op" id="4738012">*</span><span class="ident" id="4738013">big</span><span class="op" id="4738016">.</span><span class="ident" id="4738017">Int</span><span class="op" id="4738020">,</span>&nbsp;<span class="ident" id="4738022">nprimes</span><span class="op" id="4738029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4738032">NextSetOfPrimes</span><span class="op" id="4738047">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738050">for</span>&nbsp;<span class="op" id="4738054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738058">todo</span>&nbsp;<span class="op" id="4738063">:=</span>&nbsp;<span class="ident" id="4738066">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738073">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738133">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738167">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738218">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738243">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738267">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738335">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738340">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738404">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738475">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738540">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738569">if</span>&nbsp;<span class="ident" id="4738572">nprimes</span>&nbsp;<span class="op" id="4738580">&gt;=</span>&nbsp;<span class="num" id="4738583">7</span>&nbsp;<span class="op" id="4738585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738590">todo</span>&nbsp;<span class="op" id="4738595">+=</span>&nbsp;<span class="op" id="4738598">(</span><span class="ident" id="4738599">nprimes</span>&nbsp;<span class="op" id="4738607">-</span>&nbsp;<span class="num" id="4738609">2</span><span class="op" id="4738610">)</span>&nbsp;<span class="op" id="4738612">/</span>&nbsp;<span class="num" id="4738614">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738622">for</span>&nbsp;<span class="ident" id="4738626">i</span>&nbsp;<span class="op" id="4738628">:=</span>&nbsp;<span class="num" id="4738631">0</span><span class="op" id="4738632">;</span>&nbsp;<span class="ident" id="4738634">i</span>&nbsp;<span class="op" id="4738636">&lt;</span>&nbsp;<span class="ident" id="4738638">nprimes</span><span class="op" id="4738645">;</span>&nbsp;<span class="ident" id="4738647">i</span><span class="op" id="4738648">++</span>&nbsp;<span class="op" id="4738651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738656">primes</span><span class="op" id="4738662">[</span><span class="ident" id="4738663">i</span><span class="op" id="4738664">]</span><span class="op" id="4738665">,</span>&nbsp;<span class="ident" id="4738667">err</span>&nbsp;<span class="op" id="4738671">=</span>&nbsp;<span class="ident" id="4738673">rand</span><span class="op" id="4738677">.</span><span class="ident" id="4738678">Prime</span><span class="op" id="4738683">(</span><span class="ident" id="4738684">random</span><span class="op" id="4738690">,</span>&nbsp;<span class="ident" id="4738692">todo</span><span class="op" id="4738696">/</span><span class="op" id="4738697">(</span><span class="ident" id="4738698">nprimes</span><span class="op" id="4738705">-</span><span class="ident" id="4738706">i</span><span class="op" id="4738707">)</span><span class="op" id="4738708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738713">if</span>&nbsp;<span class="ident" id="4738716">err</span>&nbsp;<span class="op" id="4738720">!=</span>&nbsp;<span class="ident" id="4738723">nil</span>&nbsp;<span class="op" id="4738727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738733">return</span>&nbsp;<span class="ident" id="4738740">nil</span><span class="op" id="4738743">,</span>&nbsp;<span class="ident" id="4738745">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738757">todo</span>&nbsp;<span class="op" id="4738762">-=</span>&nbsp;<span class="ident" id="4738765">primes</span><span class="op" id="4738771">[</span><span class="ident" id="4738772">i</span><span class="op" id="4738773">]</span><span class="op" id="4738774">.</span><span class="ident" id="4738775">BitLen</span><span class="op" id="4738781">(</span><span class="op" id="4738782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4738791">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738839">for</span>&nbsp;<span class="ident" id="4738843">i</span><span class="op" id="4738844">,</span>&nbsp;<span class="ident" id="4738846">prime</span>&nbsp;<span class="op" id="4738852">:=</span>&nbsp;<span class="keyword" id="4738855">range</span>&nbsp;<span class="ident" id="4738861">primes</span>&nbsp;<span class="op" id="4738868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738873">for</span>&nbsp;<span class="ident" id="4738877">j</span>&nbsp;<span class="op" id="4738879">:=</span>&nbsp;<span class="num" id="4738882">0</span><span class="op" id="4738883">;</span>&nbsp;<span class="ident" id="4738885">j</span>&nbsp;<span class="op" id="4738887">&lt;</span>&nbsp;<span class="ident" id="4738889">i</span><span class="op" id="4738890">;</span>&nbsp;<span class="ident" id="4738892">j</span><span class="op" id="4738893">++</span>&nbsp;<span class="op" id="4738896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738902">if</span>&nbsp;<span class="ident" id="4738905">prime</span><span class="op" id="4738910">.</span><span class="ident" id="4738911">Cmp</span><span class="op" id="4738914">(</span><span class="ident" id="4738915">primes</span><span class="op" id="4738921">[</span><span class="ident" id="4738922">j</span><span class="op" id="4738923">]</span><span class="op" id="4738924">)</span>&nbsp;<span class="op" id="4738926">==</span>&nbsp;<span class="num" id="4738929">0</span>&nbsp;<span class="op" id="4738931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738938">continue</span>&nbsp;<span class="ident" id="4738947">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738967">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738981">n</span>&nbsp;<span class="op" id="4738983">:=</span>&nbsp;<span class="builtinfunc" id="4738986">new</span><span class="op" id="4738989">(</span><span class="ident" id="4738990">big</span><span class="op" id="4738993">.</span><span class="ident" id="4738994">Int</span><span class="op" id="4738997">)</span><span class="op" id="4738998">.</span><span class="ident" id="4738999">Set</span><span class="op" id="4739002">(</span><span class="ident" id="4739003">bigOne</span><span class="op" id="4739009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739013">totient</span>&nbsp;<span class="op" id="4739021">:=</span>&nbsp;<span class="builtinfunc" id="4739024">new</span><span class="op" id="4739027">(</span><span class="ident" id="4739028">big</span><span class="op" id="4739031">.</span><span class="ident" id="4739032">Int</span><span class="op" id="4739035">)</span><span class="op" id="4739036">.</span><span class="ident" id="4739037">Set</span><span class="op" id="4739040">(</span><span class="ident" id="4739041">bigOne</span><span class="op" id="4739047">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739051">pminus1</span>&nbsp;<span class="op" id="4739059">:=</span>&nbsp;<span class="builtinfunc" id="4739062">new</span><span class="op" id="4739065">(</span><span class="ident" id="4739066">big</span><span class="op" id="4739069">.</span><span class="ident" id="4739070">Int</span><span class="op" id="4739073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739077">for</span>&nbsp;<span class="ident" id="4739081">_</span><span class="op" id="4739082">,</span>&nbsp;<span class="ident" id="4739084">prime</span>&nbsp;<span class="op" id="4739090">:=</span>&nbsp;<span class="keyword" id="4739093">range</span>&nbsp;<span class="ident" id="4739099">primes</span>&nbsp;<span class="op" id="4739106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739111">n</span><span class="op" id="4739112">.</span><span class="ident" id="4739113">Mul</span><span class="op" id="4739116">(</span><span class="ident" id="4739117">n</span><span class="op" id="4739118">,</span>&nbsp;<span class="ident" id="4739120">prime</span><span class="op" id="4739125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739130">pminus1</span><span class="op" id="4739137">.</span><span class="ident" id="4739138">Sub</span><span class="op" id="4739141">(</span><span class="ident" id="4739142">prime</span><span class="op" id="4739147">,</span>&nbsp;<span class="ident" id="4739149">bigOne</span><span class="op" id="4739155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739160">totient</span><span class="op" id="4739167">.</span><span class="ident" id="4739168">Mul</span><span class="op" id="4739171">(</span><span class="ident" id="4739172">totient</span><span class="op" id="4739179">,</span>&nbsp;<span class="ident" id="4739181">pminus1</span><span class="op" id="4739188">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739196">if</span>&nbsp;<span class="ident" id="4739199">n</span><span class="op" id="4739200">.</span><span class="ident" id="4739201">BitLen</span><span class="op" id="4739207">(</span><span class="op" id="4739208">)</span>&nbsp;<span class="op" id="4739210">!=</span>&nbsp;<span class="ident" id="4739213">bits</span>&nbsp;<span class="op" id="4739218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739223">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739279">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739340">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739396">continue</span>&nbsp;<span class="ident" id="4739405">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739428">g</span>&nbsp;<span class="op" id="4739430">:=</span>&nbsp;<span class="builtinfunc" id="4739433">new</span><span class="op" id="4739436">(</span><span class="ident" id="4739437">big</span><span class="op" id="4739440">.</span><span class="ident" id="4739441">Int</span><span class="op" id="4739444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739448">priv</span><span class="op" id="4739452">.</span><span class="ident" id="4739453">D</span>&nbsp;<span class="op" id="4739455">=</span>&nbsp;<span class="builtinfunc" id="4739457">new</span><span class="op" id="4739460">(</span><span class="ident" id="4739461">big</span><span class="op" id="4739464">.</span><span class="ident" id="4739465">Int</span><span class="op" id="4739468">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739472">y</span>&nbsp;<span class="op" id="4739474">:=</span>&nbsp;<span class="builtinfunc" id="4739477">new</span><span class="op" id="4739480">(</span><span class="ident" id="4739481">big</span><span class="op" id="4739484">.</span><span class="ident" id="4739485">Int</span><span class="op" id="4739488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739492">e</span>&nbsp;<span class="op" id="4739494">:=</span>&nbsp;<span class="ident" id="4739497">big</span><span class="op" id="4739500">.</span><span class="ident" id="4739501">NewInt</span><span class="op" id="4739507">(</span><span class="ident" id="4739508">int64</span><span class="op" id="4739513">(</span><span class="ident" id="4739514">priv</span><span class="op" id="4739518">.</span><span class="ident" id="4739519">E</span><span class="op" id="4739520">)</span><span class="op" id="4739521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739525">g</span><span class="op" id="4739526">.</span><span class="ident" id="4739527">GCD</span><span class="op" id="4739530">(</span><span class="ident" id="4739531">priv</span><span class="op" id="4739535">.</span><span class="ident" id="4739536">D</span><span class="op" id="4739537">,</span>&nbsp;<span class="ident" id="4739539">y</span><span class="op" id="4739540">,</span>&nbsp;<span class="ident" id="4739542">e</span><span class="op" id="4739543">,</span>&nbsp;<span class="ident" id="4739545">totient</span><span class="op" id="4739552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739557">if</span>&nbsp;<span class="ident" id="4739560">g</span><span class="op" id="4739561">.</span><span class="ident" id="4739562">Cmp</span><span class="op" id="4739565">(</span><span class="ident" id="4739566">bigOne</span><span class="op" id="4739572">)</span>&nbsp;<span class="op" id="4739574">==</span>&nbsp;<span class="num" id="4739577">0</span>&nbsp;<span class="op" id="4739579">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739584">if</span>&nbsp;<span class="ident" id="4739587">priv</span><span class="op" id="4739591">.</span><span class="ident" id="4739592">D</span><span class="op" id="4739593">.</span><span class="ident" id="4739594">Sign</span><span class="op" id="4739598">(</span><span class="op" id="4739599">)</span>&nbsp;<span class="op" id="4739601">&lt;</span>&nbsp;<span class="num" id="4739603">0</span>&nbsp;<span class="op" id="4739605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739611">priv</span><span class="op" id="4739615">.</span><span class="ident" id="4739616">D</span><span class="op" id="4739617">.</span><span class="ident" id="4739618">Add</span><span class="op" id="4739621">(</span><span class="ident" id="4739622">priv</span><span class="op" id="4739626">.</span><span class="ident" id="4739627">D</span><span class="op" id="4739628">,</span>&nbsp;<span class="ident" id="4739630">totient</span><span class="op" id="4739637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739647">priv</span><span class="op" id="4739651">.</span><span class="ident" id="4739652">Primes</span>&nbsp;<span class="op" id="4739659">=</span>&nbsp;<span class="ident" id="4739661">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739671">priv</span><span class="op" id="4739675">.</span><span class="ident" id="4739676">N</span>&nbsp;<span class="op" id="4739678">=</span>&nbsp;<span class="ident" id="4739680">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739686">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739701">priv</span><span class="op" id="4739705">.</span><span class="ident" id="4739706">Precompute</span><span class="op" id="4739716">(</span><span class="op" id="4739717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739720">return</span><br>
<span class="lineno"></span><span class="op" id="4739727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739730">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4739788">func</span>&nbsp;<span class="ident" id="4739793">incCounter</span><span class="op" id="4739803">(</span><span class="ident" id="4739804">c</span>&nbsp;<span class="op" id="4739806">*</span><span class="op" id="4739807">[</span><span class="num" id="4739808">4</span><span class="op" id="4739809">]</span><span class="builtintype" id="4739810">byte</span><span class="op" id="4739814">)</span>&nbsp;<span class="op" id="4739816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739819">if</span>&nbsp;<span class="ident" id="4739822">c</span><span class="op" id="4739823">[</span><span class="num" id="4739824">3</span><span class="op" id="4739825">]</span><span class="op" id="4739826">++</span><span class="op" id="4739828">;</span>&nbsp;<span class="ident" id="4739830">c</span><span class="op" id="4739831">[</span><span class="num" id="4739832">3</span><span class="op" id="4739833">]</span>&nbsp;<span class="op" id="4739835">!=</span>&nbsp;<span class="num" id="4739838">0</span>&nbsp;<span class="op" id="4739840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739855">if</span>&nbsp;<span class="ident" id="4739858">c</span><span class="op" id="4739859">[</span><span class="num" id="4739860">2</span><span class="op" id="4739861">]</span><span class="op" id="4739862">++</span><span class="op" id="4739864">;</span>&nbsp;<span class="ident" id="4739866">c</span><span class="op" id="4739867">[</span><span class="num" id="4739868">2</span><span class="op" id="4739869">]</span>&nbsp;<span class="op" id="4739871">!=</span>&nbsp;<span class="num" id="4739874">0</span>&nbsp;<span class="op" id="4739876">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739880">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739891">if</span>&nbsp;<span class="ident" id="4739894">c</span><span class="op" id="4739895">[</span><span class="num" id="4739896">1</span><span class="op" id="4739897">]</span><span class="op" id="4739898">++</span><span class="op" id="4739900">;</span>&nbsp;<span class="ident" id="4739902">c</span><span class="op" id="4739903">[</span><span class="num" id="4739904">1</span><span class="op" id="4739905">]</span>&nbsp;<span class="op" id="4739907">!=</span>&nbsp;<span class="num" id="4739910">0</span>&nbsp;<span class="op" id="4739912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739924">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739927">c</span><span class="op" id="4739928">[</span><span class="num" id="4739929">0</span><span class="op" id="4739930">]</span><span class="op" id="4739931">++</span><br>
<span class="lineno"></span><span class="op" id="4739934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739937">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4740016">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4740045">func</span>&nbsp;<span class="ident" id="4740050">mgf1XOR</span><span class="op" id="4740057">(</span><span class="ident" id="4740058">out</span>&nbsp;<span class="op" id="4740062">[</span><span class="op" id="4740063">]</span><span class="builtintype" id="4740064">byte</span><span class="op" id="4740068">,</span>&nbsp;<span class="ident" id="4740070">hash</span>&nbsp;<span class="ident" id="4740075">hash</span><span class="op" id="4740079">.</span><span class="ident" id="4740080">Hash</span><span class="op" id="4740084">,</span>&nbsp;<span class="ident" id="4740086">seed</span>&nbsp;<span class="op" id="4740091">[</span><span class="op" id="4740092">]</span><span class="builtintype" id="4740093">byte</span><span class="op" id="4740097">)</span>&nbsp;<span class="op" id="4740099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740102">var</span>&nbsp;<span class="ident" id="4740106">counter</span>&nbsp;<span class="op" id="4740114">[</span><span class="num" id="4740115">4</span><span class="op" id="4740116">]</span><span class="builtintype" id="4740117">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740123">var</span>&nbsp;<span class="ident" id="4740127">digest</span>&nbsp;<span class="op" id="4740134">[</span><span class="op" id="4740135">]</span><span class="builtintype" id="4740136">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740143">done</span>&nbsp;<span class="op" id="4740148">:=</span>&nbsp;<span class="num" id="4740151">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740154">for</span>&nbsp;<span class="ident" id="4740158">done</span>&nbsp;<span class="op" id="4740163">&lt;</span>&nbsp;<span class="builtinfunc" id="4740165">len</span><span class="op" id="4740168">(</span><span class="ident" id="4740169">out</span><span class="op" id="4740172">)</span>&nbsp;<span class="op" id="4740174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740178">hash</span><span class="op" id="4740182">.</span><span class="ident" id="4740183">Write</span><span class="op" id="4740188">(</span><span class="ident" id="4740189">seed</span><span class="op" id="4740193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740197">hash</span><span class="op" id="4740201">.</span><span class="ident" id="4740202">Write</span><span class="op" id="4740207">(</span><span class="ident" id="4740208">counter</span><span class="op" id="4740215">[</span><span class="num" id="4740216">0</span><span class="op" id="4740217">:</span><span class="num" id="4740218">4</span><span class="op" id="4740219">]</span><span class="op" id="4740220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740224">digest</span>&nbsp;<span class="op" id="4740231">=</span>&nbsp;<span class="ident" id="4740233">hash</span><span class="op" id="4740237">.</span><span class="ident" id="4740238">Sum</span><span class="op" id="4740241">(</span><span class="ident" id="4740242">digest</span><span class="op" id="4740248">[</span><span class="op" id="4740249">:</span><span class="num" id="4740250">0</span><span class="op" id="4740251">]</span><span class="op" id="4740252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740256">hash</span><span class="op" id="4740260">.</span><span class="ident" id="4740261">Reset</span><span class="op" id="4740266">(</span><span class="op" id="4740267">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740272">for</span>&nbsp;<span class="ident" id="4740276">i</span>&nbsp;<span class="op" id="4740278">:=</span>&nbsp;<span class="num" id="4740281">0</span><span class="op" id="4740282">;</span>&nbsp;<span class="ident" id="4740284">i</span>&nbsp;<span class="op" id="4740286">&lt;</span>&nbsp;<span class="builtinfunc" id="4740288">len</span><span class="op" id="4740291">(</span><span class="ident" id="4740292">digest</span><span class="op" id="4740298">)</span>&nbsp;<span class="op" id="4740300">&amp;&amp;</span>&nbsp;<span class="ident" id="4740303">done</span>&nbsp;<span class="op" id="4740308">&lt;</span>&nbsp;<span class="builtinfunc" id="4740310">len</span><span class="op" id="4740313">(</span><span class="ident" id="4740314">out</span><span class="op" id="4740317">)</span><span class="op" id="4740318">;</span>&nbsp;<span class="ident" id="4740320">i</span><span class="op" id="4740321">++</span>&nbsp;<span class="op" id="4740324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740329">out</span><span class="op" id="4740332">[</span><span class="ident" id="4740333">done</span><span class="op" id="4740337">]</span>&nbsp;<span class="op" id="4740339">^=</span>&nbsp;<span class="ident" id="4740342">digest</span><span class="op" id="4740348">[</span><span class="ident" id="4740349">i</span><span class="op" id="4740350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740355">done</span><span class="op" id="4740359">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740364">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740368">incCounter</span><span class="op" id="4740378">(</span><span class="op" id="4740379">&amp;</span><span class="ident" id="4740380">counter</span><span class="op" id="4740387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740390">}</span><br>
<span class="lineno"></span><span class="op" id="4740392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4740395">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4740474">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4740519">var</span>&nbsp;<span class="ident" id="4740523">ErrMessageTooLong</span>&nbsp;<span class="op" id="4740541">=</span>&nbsp;<span class="ident" id="4740543">errors</span><span class="op" id="4740549">.</span><span class="ident" id="4740550">New</span><span class="op" id="4740553">(</span><span class="string" id="4740554">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4740608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4740611">func</span>&nbsp;<span class="ident" id="4740616">encrypt</span><span class="op" id="4740623">(</span><span class="ident" id="4740624">c</span>&nbsp;<span class="op" id="4740626">*</span><span class="ident" id="4740627">big</span><span class="op" id="4740630">.</span><span class="ident" id="4740631">Int</span><span class="op" id="4740634">,</span>&nbsp;<span class="ident" id="4740636">pub</span>&nbsp;<span class="op" id="4740640">*</span><span class="ident" id="4740641">PublicKey</span><span class="op" id="4740650">,</span>&nbsp;<span class="ident" id="4740652">m</span>&nbsp;<span class="op" id="4740654">*</span><span class="ident" id="4740655">big</span><span class="op" id="4740658">.</span><span class="ident" id="4740659">Int</span><span class="op" id="4740662">)</span>&nbsp;<span class="op" id="4740664">*</span><span class="ident" id="4740665">big</span><span class="op" id="4740668">.</span><span class="ident" id="4740669">Int</span>&nbsp;<span class="op" id="4740673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740676">e</span>&nbsp;<span class="op" id="4740678">:=</span>&nbsp;<span class="ident" id="4740681">big</span><span class="op" id="4740684">.</span><span class="ident" id="4740685">NewInt</span><span class="op" id="4740691">(</span><span class="ident" id="4740692">int64</span><span class="op" id="4740697">(</span><span class="ident" id="4740698">pub</span><span class="op" id="4740701">.</span><span class="ident" id="4740702">E</span><span class="op" id="4740703">)</span><span class="op" id="4740704">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740707">c</span><span class="op" id="4740708">.</span><span class="ident" id="4740709">Exp</span><span class="op" id="4740712">(</span><span class="ident" id="4740713">m</span><span class="op" id="4740714">,</span>&nbsp;<span class="ident" id="4740716">e</span><span class="op" id="4740717">,</span>&nbsp;<span class="ident" id="4740719">pub</span><span class="op" id="4740722">.</span><span class="ident" id="4740723">N</span><span class="op" id="4740724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740727">return</span>&nbsp;<span class="ident" id="4740734">c</span><br>
<span class="lineno"></span><span class="op" id="4740736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4740739">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4740796">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4740872">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4740905">func</span>&nbsp;<span class="ident" id="4740910">EncryptOAEP</span><span class="op" id="4740921">(</span><span class="ident" id="4740922">hash</span>&nbsp;<span class="ident" id="4740927">hash</span><span class="op" id="4740931">.</span><span class="ident" id="4740932">Hash</span><span class="op" id="4740936">,</span>&nbsp;<span class="ident" id="4740938">random</span>&nbsp;<span class="ident" id="4740945">io</span><span class="op" id="4740947">.</span><span class="ident" id="4740948">Reader</span><span class="op" id="4740954">,</span>&nbsp;<span class="ident" id="4740956">pub</span>&nbsp;<span class="op" id="4740960">*</span><span class="ident" id="4740961">PublicKey</span><span class="op" id="4740970">,</span>&nbsp;<span class="ident" id="4740972">msg</span>&nbsp;<span class="op" id="4740976">[</span><span class="op" id="4740977">]</span><span class="builtintype" id="4740978">byte</span><span class="op" id="4740982">,</span>&nbsp;<span class="ident" id="4740984">label</span>&nbsp;<span class="op" id="4740990">[</span><span class="op" id="4740991">]</span><span class="builtintype" id="4740992">byte</span><span class="op" id="4740996">)</span>&nbsp;<span class="op" id="4740998">(</span><span class="ident" id="4740999">out</span>&nbsp;<span class="op" id="4741003">[</span><span class="op" id="4741004">]</span><span class="builtintype" id="4741005">byte</span><span class="op" id="4741009">,</span>&nbsp;<span class="ident" id="4741011">err</span>&nbsp;<span class="builtintype" id="4741015">error</span><span class="op" id="4741020">)</span>&nbsp;<span class="op" id="4741022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741025">if</span>&nbsp;<span class="ident" id="4741028">err</span>&nbsp;<span class="op" id="4741032">:=</span>&nbsp;<span class="ident" id="4741035">checkPub</span><span class="op" id="4741043">(</span><span class="ident" id="4741044">pub</span><span class="op" id="4741047">)</span><span class="op" id="4741048">;</span>&nbsp;<span class="ident" id="4741050">err</span>&nbsp;<span class="op" id="4741054">!=</span>&nbsp;<span class="ident" id="4741057">nil</span>&nbsp;<span class="op" id="4741061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741065">return</span>&nbsp;<span class="ident" id="4741072">nil</span><span class="op" id="4741075">,</span>&nbsp;<span class="ident" id="4741077">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741085">hash</span><span class="op" id="4741089">.</span><span class="ident" id="4741090">Reset</span><span class="op" id="4741095">(</span><span class="op" id="4741096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741099">k</span>&nbsp;<span class="op" id="4741101">:=</span>&nbsp;<span class="op" id="4741104">(</span><span class="ident" id="4741105">pub</span><span class="op" id="4741108">.</span><span class="ident" id="4741109">N</span><span class="op" id="4741110">.</span><span class="ident" id="4741111">BitLen</span><span class="op" id="4741117">(</span><span class="op" id="4741118">)</span>&nbsp;<span class="op" id="4741120">+</span>&nbsp;<span class="num" id="4741122">7</span><span class="op" id="4741123">)</span>&nbsp;<span class="op" id="4741125">/</span>&nbsp;<span class="num" id="4741127">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741130">if</span>&nbsp;<span class="builtinfunc" id="4741133">len</span><span class="op" id="4741136">(</span><span class="ident" id="4741137">msg</span><span class="op" id="4741140">)</span>&nbsp;<span class="op" id="4741142">&gt;</span>&nbsp;<span class="ident" id="4741144">k</span><span class="op" id="4741145">-</span><span class="num" id="4741146">2</span><span class="op" id="4741147">*</span><span class="ident" id="4741148">hash</span><span class="op" id="4741152">.</span><span class="ident" id="4741153">Size</span><span class="op" id="4741157">(</span><span class="op" id="4741158">)</span><span class="op" id="4741159">-</span><span class="num" id="4741160">2</span>&nbsp;<span class="op" id="4741162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741166">err</span>&nbsp;<span class="op" id="4741170">=</span>&nbsp;<span class="ident" id="4741172">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741192">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741204">hash</span><span class="op" id="4741208">.</span><span class="ident" id="4741209">Write</span><span class="op" id="4741214">(</span><span class="ident" id="4741215">label</span><span class="op" id="4741220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741223">lHash</span>&nbsp;<span class="op" id="4741229">:=</span>&nbsp;<span class="ident" id="4741232">hash</span><span class="op" id="4741236">.</span><span class="ident" id="4741237">Sum</span><span class="op" id="4741240">(</span><span class="ident" id="4741241">nil</span><span class="op" id="4741244">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741247">hash</span><span class="op" id="4741251">.</span><span class="ident" id="4741252">Reset</span><span class="op" id="4741257">(</span><span class="op" id="4741258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741262">em</span>&nbsp;<span class="op" id="4741265">:=</span>&nbsp;<span class="builtinfunc" id="4741268">make</span><span class="op" id="4741272">(</span><span class="op" id="4741273">[</span><span class="op" id="4741274">]</span><span class="builtintype" id="4741275">byte</span><span class="op" id="4741279">,</span>&nbsp;<span class="ident" id="4741281">k</span><span class="op" id="4741282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741285">seed</span>&nbsp;<span class="op" id="4741290">:=</span>&nbsp;<span class="ident" id="4741293">em</span><span class="op" id="4741295">[</span><span class="num" id="4741296">1</span>&nbsp;<span class="op" id="4741298">:</span>&nbsp;<span class="num" id="4741300">1</span><span class="op" id="4741301">+</span><span class="ident" id="4741302">hash</span><span class="op" id="4741306">.</span><span class="ident" id="4741307">Size</span><span class="op" id="4741311">(</span><span class="op" id="4741312">)</span><span class="op" id="4741313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741316">db</span>&nbsp;<span class="op" id="4741319">:=</span>&nbsp;<span class="ident" id="4741322">em</span><span class="op" id="4741324">[</span><span class="num" id="4741325">1</span><span class="op" id="4741326">+</span><span class="ident" id="4741327">hash</span><span class="op" id="4741331">.</span><span class="ident" id="4741332">Size</span><span class="op" id="4741336">(</span><span class="op" id="4741337">)</span><span class="op" id="4741338">:</span><span class="op" id="4741339">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4741343">copy</span><span class="op" id="4741347">(</span><span class="ident" id="4741348">db</span><span class="op" id="4741350">[</span><span class="num" id="4741351">0</span><span class="op" id="4741352">:</span><span class="ident" id="4741353">hash</span><span class="op" id="4741357">.</span><span class="ident" id="4741358">Size</span><span class="op" id="4741362">(</span><span class="op" id="4741363">)</span><span class="op" id="4741364">]</span><span class="op" id="4741365">,</span>&nbsp;<span class="ident" id="4741367">lHash</span><span class="op" id="4741372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741375">db</span><span class="op" id="4741377">[</span><span class="builtinfunc" id="4741378">len</span><span class="op" id="4741381">(</span><span class="ident" id="4741382">db</span><span class="op" id="4741384">)</span><span class="op" id="4741385">-</span><span class="builtinfunc" id="4741386">len</span><span class="op" id="4741389">(</span><span class="ident" id="4741390">msg</span><span class="op" id="4741393">)</span><span class="op" id="4741394">-</span><span class="num" id="4741395">1</span><span class="op" id="4741396">]</span>&nbsp;<span class="op" id="4741398">=</span>&nbsp;<span class="num" id="4741400">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4741403">copy</span><span class="op" id="4741407">(</span><span class="ident" id="4741408">db</span><span class="op" id="4741410">[</span><span class="builtinfunc" id="4741411">len</span><span class="op" id="4741414">(</span><span class="ident" id="4741415">db</span><span class="op" id="4741417">)</span><span class="op" id="4741418">-</span><span class="builtinfunc" id="4741419">len</span><span class="op" id="4741422">(</span><span class="ident" id="4741423">msg</span><span class="op" id="4741426">)</span><span class="op" id="4741427">:</span><span class="op" id="4741428">]</span><span class="op" id="4741429">,</span>&nbsp;<span class="ident" id="4741431">msg</span><span class="op" id="4741434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741438">_</span><span class="op" id="4741439">,</span>&nbsp;<span class="ident" id="4741441">err</span>&nbsp;<span class="op" id="4741445">=</span>&nbsp;<span class="ident" id="4741447">io</span><span class="op" id="4741449">.</span><span class="ident" id="4741450">ReadFull</span><span class="op" id="4741458">(</span><span class="ident" id="4741459">random</span><span class="op" id="4741465">,</span>&nbsp;<span class="ident" id="4741467">seed</span><span class="op" id="4741471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741474">if</span>&nbsp;<span class="ident" id="4741477">err</span>&nbsp;<span class="op" id="4741481">!=</span>&nbsp;<span class="ident" id="4741484">nil</span>&nbsp;<span class="op" id="4741488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741504">mgf1XOR</span><span class="op" id="4741511">(</span><span class="ident" id="4741512">db</span><span class="op" id="4741514">,</span>&nbsp;<span class="ident" id="4741516">hash</span><span class="op" id="4741520">,</span>&nbsp;<span class="ident" id="4741522">seed</span><span class="op" id="4741526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741529">mgf1XOR</span><span class="op" id="4741536">(</span><span class="ident" id="4741537">seed</span><span class="op" id="4741541">,</span>&nbsp;<span class="ident" id="4741543">hash</span><span class="op" id="4741547">,</span>&nbsp;<span class="ident" id="4741549">db</span><span class="op" id="4741551">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741555">m</span>&nbsp;<span class="op" id="4741557">:=</span>&nbsp;<span class="builtinfunc" id="4741560">new</span><span class="op" id="4741563">(</span><span class="ident" id="4741564">big</span><span class="op" id="4741567">.</span><span class="ident" id="4741568">Int</span><span class="op" id="4741571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741574">m</span><span class="op" id="4741575">.</span><span class="ident" id="4741576">SetBytes</span><span class="op" id="4741584">(</span><span class="ident" id="4741585">em</span><span class="op" id="4741587">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741590">c</span>&nbsp;<span class="op" id="4741592">:=</span>&nbsp;<span class="ident" id="4741595">encrypt</span><span class="op" id="4741602">(</span><span class="builtinfunc" id="4741603">new</span><span class="op" id="4741606">(</span><span class="ident" id="4741607">big</span><span class="op" id="4741610">.</span><span class="ident" id="4741611">Int</span><span class="op" id="4741614">)</span><span class="op" id="4741615">,</span>&nbsp;<span class="ident" id="4741617">pub</span><span class="op" id="4741620">,</span>&nbsp;<span class="ident" id="4741622">m</span><span class="op" id="4741623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741626">out</span>&nbsp;<span class="op" id="4741630">=</span>&nbsp;<span class="ident" id="4741632">c</span><span class="op" id="4741633">.</span><span class="ident" id="4741634">Bytes</span><span class="op" id="4741639">(</span><span class="op" id="4741640">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741644">if</span>&nbsp;<span class="builtinfunc" id="4741647">len</span><span class="op" id="4741650">(</span><span class="ident" id="4741651">out</span><span class="op" id="4741654">)</span>&nbsp;<span class="op" id="4741656">&lt;</span>&nbsp;<span class="ident" id="4741658">k</span>&nbsp;<span class="op" id="4741660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741664">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741729">t</span>&nbsp;<span class="op" id="4741731">:=</span>&nbsp;<span class="builtinfunc" id="4741734">make</span><span class="op" id="4741738">(</span><span class="op" id="4741739">[</span><span class="op" id="4741740">]</span><span class="builtintype" id="4741741">byte</span><span class="op" id="4741745">,</span>&nbsp;<span class="ident" id="4741747">k</span><span class="op" id="4741748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4741752">copy</span><span class="op" id="4741756">(</span><span class="ident" id="4741757">t</span><span class="op" id="4741758">[</span><span class="ident" id="4741759">k</span><span class="op" id="4741760">-</span><span class="builtinfunc" id="4741761">len</span><span class="op" id="4741764">(</span><span class="ident" id="4741765">out</span><span class="op" id="4741768">)</span><span class="op" id="4741769">:</span><span class="op" id="4741770">]</span><span class="op" id="4741771">,</span>&nbsp;<span class="ident" id="4741773">out</span><span class="op" id="4741776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741780">out</span>&nbsp;<span class="op" id="4741784">=</span>&nbsp;<span class="ident" id="4741786">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741793">return</span><br>
<span class="lineno"></span><span class="op" id="4741800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4741803">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4741863">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4741918">var</span>&nbsp;<span class="ident" id="4741922">ErrDecryption</span>&nbsp;<span class="op" id="4741936">=</span>&nbsp;<span class="ident" id="4741938">errors</span><span class="op" id="4741944">.</span><span class="ident" id="4741945">New</span><span class="op" id="4741948">(</span><span class="string" id="4741949">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4741979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4741982">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4742045">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4742100">var</span>&nbsp;<span class="ident" id="4742104">ErrVerification</span>&nbsp;<span class="op" id="4742120">=</span>&nbsp;<span class="ident" id="4742122">errors</span><span class="op" id="4742128">.</span><span class="ident" id="4742129">New</span><span class="op" id="4742132">(</span><span class="string" id="4742133">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4742165">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4742168">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4742248">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4742324">func</span>&nbsp;<span class="ident" id="4742329">modInverse</span><span class="op" id="4742339">(</span><span class="ident" id="4742340">a</span><span class="op" id="4742341">,</span>&nbsp;<span class="ident" id="4742343">n</span>&nbsp;<span class="op" id="4742345">*</span><span class="ident" id="4742346">big</span><span class="op" id="4742349">.</span><span class="ident" id="4742350">Int</span><span class="op" id="4742353">)</span>&nbsp;<span class="op" id="4742355">(</span><span class="ident" id="4742356">ia</span>&nbsp;<span class="op" id="4742359">*</span><span class="ident" id="4742360">big</span><span class="op" id="4742363">.</span><span class="ident" id="4742364">Int</span><span class="op" id="4742367">,</span>&nbsp;<span class="ident" id="4742369">ok</span>&nbsp;<span class="builtintype" id="4742372">bool</span><span class="op" id="4742376">)</span>&nbsp;<span class="op" id="4742378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742381">g</span>&nbsp;<span class="op" id="4742383">:=</span>&nbsp;<span class="builtinfunc" id="4742386">new</span><span class="op" id="4742389">(</span><span class="ident" id="4742390">big</span><span class="op" id="4742393">.</span><span class="ident" id="4742394">Int</span><span class="op" id="4742397">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742400">x</span>&nbsp;<span class="op" id="4742402">:=</span>&nbsp;<span class="builtinfunc" id="4742405">new</span><span class="op" id="4742408">(</span><span class="ident" id="4742409">big</span><span class="op" id="4742412">.</span><span class="ident" id="4742413">Int</span><span class="op" id="4742416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742419">y</span>&nbsp;<span class="op" id="4742421">:=</span>&nbsp;<span class="builtinfunc" id="4742424">new</span><span class="op" id="4742427">(</span><span class="ident" id="4742428">big</span><span class="op" id="4742431">.</span><span class="ident" id="4742432">Int</span><span class="op" id="4742435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742438">g</span><span class="op" id="4742439">.</span><span class="ident" id="4742440">GCD</span><span class="op" id="4742443">(</span><span class="ident" id="4742444">x</span><span class="op" id="4742445">,</span>&nbsp;<span class="ident" id="4742447">y</span><span class="op" id="4742448">,</span>&nbsp;<span class="ident" id="4742450">a</span><span class="op" id="4742451">,</span>&nbsp;<span class="ident" id="4742453">n</span><span class="op" id="4742454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742457">if</span>&nbsp;<span class="ident" id="4742460">g</span><span class="op" id="4742461">.</span><span class="ident" id="4742462">Cmp</span><span class="op" id="4742465">(</span><span class="ident" id="4742466">bigOne</span><span class="op" id="4742472">)</span>&nbsp;<span class="op" id="4742474">!=</span>&nbsp;<span class="num" id="4742477">0</span>&nbsp;<span class="op" id="4742479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742483">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742549">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742615">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742678">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742698">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742702">if</span>&nbsp;<span class="ident" id="4742705">x</span><span class="op" id="4742706">.</span><span class="ident" id="4742707">Cmp</span><span class="op" id="4742710">(</span><span class="ident" id="4742711">bigOne</span><span class="op" id="4742717">)</span>&nbsp;<span class="op" id="4742719">&lt;</span>&nbsp;<span class="num" id="4742721">0</span>&nbsp;<span class="op" id="4742723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742727">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742792">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742822">x</span><span class="op" id="4742823">.</span><span class="ident" id="4742824">Add</span><span class="op" id="4742827">(</span><span class="ident" id="4742828">x</span><span class="op" id="4742829">,</span>&nbsp;<span class="ident" id="4742831">n</span><span class="op" id="4742832">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742839">return</span>&nbsp;<span class="ident" id="4742846">x</span><span class="op" id="4742847">,</span>&nbsp;<span class="builtintype" id="4742849">true</span><br>
<span class="lineno"></span><span class="op" id="4742854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4742857">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4742935">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4742953">func</span>&nbsp;<span class="op" id="4742958">(</span><span class="ident" id="4742959">priv</span>&nbsp;<span class="op" id="4742964">*</span><span class="ident" id="4742965">PrivateKey</span><span class="op" id="4742975">)</span>&nbsp;<span class="ident" id="4742977">Precompute</span><span class="op" id="4742987">(</span><span class="op" id="4742988">)</span>&nbsp;<span class="op" id="4742990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742993">if</span>&nbsp;<span class="ident" id="4742996">priv</span><span class="op" id="4743000">.</span><span class="ident" id="4743001">Precomputed</span><span class="op" id="4743012">.</span><span class="ident" id="4743013">Dp</span>&nbsp;<span class="op" id="4743016">!=</span>&nbsp;<span class="ident" id="4743019">nil</span>&nbsp;<span class="op" id="4743023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743027">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743039">priv</span><span class="op" id="4743043">.</span><span class="ident" id="4743044">Precomputed</span><span class="op" id="4743055">.</span><span class="ident" id="4743056">Dp</span>&nbsp;<span class="op" id="4743059">=</span>&nbsp;<span class="builtinfunc" id="4743061">new</span><span class="op" id="4743064">(</span><span class="ident" id="4743065">big</span><span class="op" id="4743068">.</span><span class="ident" id="4743069">Int</span><span class="op" id="4743072">)</span><span class="op" id="4743073">.</span><span class="ident" id="4743074">Sub</span><span class="op" id="4743077">(</span><span class="ident" id="4743078">priv</span><span class="op" id="4743082">.</span><span class="ident" id="4743083">Primes</span><span class="op" id="4743089">[</span><span class="num" id="4743090">0</span><span class="op" id="4743091">]</span><span class="op" id="4743092">,</span>&nbsp;<span class="ident" id="4743094">bigOne</span><span class="op" id="4743100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743103">priv</span><span class="op" id="4743107">.</span><span class="ident" id="4743108">Precomputed</span><span class="op" id="4743119">.</span><span class="ident" id="4743120">Dp</span><span class="op" id="4743122">.</span><span class="ident" id="4743123">Mod</span><span class="op" id="4743126">(</span><span class="ident" id="4743127">priv</span><span class="op" id="4743131">.</span><span class="ident" id="4743132">D</span><span class="op" id="4743133">,</span>&nbsp;<span class="ident" id="4743135">priv</span><span class="op" id="4743139">.</span><span class="ident" id="4743140">Precomputed</span><span class="op" id="4743151">.</span><span class="ident" id="4743152">Dp</span><span class="op" id="4743154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743158">priv</span><span class="op" id="4743162">.</span><span class="ident" id="4743163">Precomputed</span><span class="op" id="4743174">.</span><span class="ident" id="4743175">Dq</span>&nbsp;<span class="op" id="4743178">=</span>&nbsp;<span class="builtinfunc" id="4743180">new</span><span class="op" id="4743183">(</span><span class="ident" id="4743184">big</span><span class="op" id="4743187">.</span><span class="ident" id="4743188">Int</span><span class="op" id="4743191">)</span><span class="op" id="4743192">.</span><span class="ident" id="4743193">Sub</span><span class="op" id="4743196">(</span><span class="ident" id="4743197">priv</span><span class="op" id="4743201">.</span><span class="ident" id="4743202">Primes</span><span class="op" id="4743208">[</span><span class="num" id="4743209">1</span><span class="op" id="4743210">]</span><span class="op" id="4743211">,</span>&nbsp;<span class="ident" id="4743213">bigOne</span><span class="op" id="4743219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743222">priv</span><span class="op" id="4743226">.</span><span class="ident" id="4743227">Precomputed</span><span class="op" id="4743238">.</span><span class="ident" id="4743239">Dq</span><span class="op" id="4743241">.</span><span class="ident" id="4743242">Mod</span><span class="op" id="4743245">(</span><span class="ident" id="4743246">priv</span><span class="op" id="4743250">.</span><span class="ident" id="4743251">D</span><span class="op" id="4743252">,</span>&nbsp;<span class="ident" id="4743254">priv</span><span class="op" id="4743258">.</span><span class="ident" id="4743259">Precomputed</span><span class="op" id="4743270">.</span><span class="ident" id="4743271">Dq</span><span class="op" id="4743273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743277">priv</span><span class="op" id="4743281">.</span><span class="ident" id="4743282">Precomputed</span><span class="op" id="4743293">.</span><span class="ident" id="4743294">Qinv</span>&nbsp;<span class="op" id="4743299">=</span>&nbsp;<span class="builtinfunc" id="4743301">new</span><span class="op" id="4743304">(</span><span class="ident" id="4743305">big</span><span class="op" id="4743308">.</span><span class="ident" id="4743309">Int</span><span class="op" id="4743312">)</span><span class="op" id="4743313">.</span><span class="ident" id="4743314">ModInverse</span><span class="op" id="4743324">(</span><span class="ident" id="4743325">priv</span><span class="op" id="4743329">.</span><span class="ident" id="4743330">Primes</span><span class="op" id="4743336">[</span><span class="num" id="4743337">1</span><span class="op" id="4743338">]</span><span class="op" id="4743339">,</span>&nbsp;<span class="ident" id="4743341">priv</span><span class="op" id="4743345">.</span><span class="ident" id="4743346">Primes</span><span class="op" id="4743352">[</span><span class="num" id="4743353">0</span><span class="op" id="4743354">]</span><span class="op" id="4743355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743359">r</span>&nbsp;<span class="op" id="4743361">:=</span>&nbsp;<span class="builtinfunc" id="4743364">new</span><span class="op" id="4743367">(</span><span class="ident" id="4743368">big</span><span class="op" id="4743371">.</span><span class="ident" id="4743372">Int</span><span class="op" id="4743375">)</span><span class="op" id="4743376">.</span><span class="ident" id="4743377">Mul</span><span class="op" id="4743380">(</span><span class="ident" id="4743381">priv</span><span class="op" id="4743385">.</span><span class="ident" id="4743386">Primes</span><span class="op" id="4743392">[</span><span class="num" id="4743393">0</span><span class="op" id="4743394">]</span><span class="op" id="4743395">,</span>&nbsp;<span class="ident" id="4743397">priv</span><span class="op" id="4743401">.</span><span class="ident" id="4743402">Primes</span><span class="op" id="4743408">[</span><span class="num" id="4743409">1</span><span class="op" id="4743410">]</span><span class="op" id="4743411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743414">priv</span><span class="op" id="4743418">.</span><span class="ident" id="4743419">Precomputed</span><span class="op" id="4743430">.</span><span class="ident" id="4743431">CRTValues</span>&nbsp;<span class="op" id="4743441">=</span>&nbsp;<span class="builtinfunc" id="4743443">make</span><span class="op" id="4743447">(</span><span class="op" id="4743448">[</span><span class="op" id="4743449">]</span><span class="ident" id="4743450">CRTValue</span><span class="op" id="4743458">,</span>&nbsp;<span class="builtinfunc" id="4743460">len</span><span class="op" id="4743463">(</span><span class="ident" id="4743464">priv</span><span class="op" id="4743468">.</span><span class="ident" id="4743469">Primes</span><span class="op" id="4743475">)</span><span class="op" id="4743476">-</span><span class="num" id="4743477">2</span><span class="op" id="4743478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743481">for</span>&nbsp;<span class="ident" id="4743485">i</span>&nbsp;<span class="op" id="4743487">:=</span>&nbsp;<span class="num" id="4743490">2</span><span class="op" id="4743491">;</span>&nbsp;<span class="ident" id="4743493">i</span>&nbsp;<span class="op" id="4743495">&lt;</span>&nbsp;<span class="builtinfunc" id="4743497">len</span><span class="op" id="4743500">(</span><span class="ident" id="4743501">priv</span><span class="op" id="4743505">.</span><span class="ident" id="4743506">Primes</span><span class="op" id="4743512">)</span><span class="op" id="4743513">;</span>&nbsp;<span class="ident" id="4743515">i</span><span class="op" id="4743516">++</span>&nbsp;<span class="op" id="4743519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743523">prime</span>&nbsp;<span class="op" id="4743529">:=</span>&nbsp;<span class="ident" id="4743532">priv</span><span class="op" id="4743536">.</span><span class="ident" id="4743537">Primes</span><span class="op" id="4743543">[</span><span class="ident" id="4743544">i</span><span class="op" id="4743545">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743549">values</span>&nbsp;<span class="op" id="4743556">:=</span>&nbsp;<span class="op" id="4743559">&amp;</span><span class="ident" id="4743560">priv</span><span class="op" id="4743564">.</span><span class="ident" id="4743565">Precomputed</span><span class="op" id="4743576">.</span><span class="ident" id="4743577">CRTValues</span><span class="op" id="4743586">[</span><span class="ident" id="4743587">i</span><span class="op" id="4743588">-</span><span class="num" id="4743589">2</span><span class="op" id="4743590">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743595">values</span><span class="op" id="4743601">.</span><span class="ident" id="4743602">Exp</span>&nbsp;<span class="op" id="4743606">=</span>&nbsp;<span class="builtinfunc" id="4743608">new</span><span class="op" id="4743611">(</span><span class="ident" id="4743612">big</span><span class="op" id="4743615">.</span><span class="ident" id="4743616">Int</span><span class="op" id="4743619">)</span><span class="op" id="4743620">.</span><span class="ident" id="4743621">Sub</span><span class="op" id="4743624">(</span><span class="ident" id="4743625">prime</span><span class="op" id="4743630">,</span>&nbsp;<span class="ident" id="4743632">bigOne</span><span class="op" id="4743638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743642">values</span><span class="op" id="4743648">.</span><span class="ident" id="4743649">Exp</span><span class="op" id="4743652">.</span><span class="ident" id="4743653">Mod</span><span class="op" id="4743656">(</span><span class="ident" id="4743657">priv</span><span class="op" id="4743661">.</span><span class="ident" id="4743662">D</span><span class="op" id="4743663">,</span>&nbsp;<span class="ident" id="4743665">values</span><span class="op" id="4743671">.</span><span class="ident" id="4743672">Exp</span><span class="op" id="4743675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743680">values</span><span class="op" id="4743686">.</span><span class="ident" id="4743687">R</span>&nbsp;<span class="op" id="4743689">=</span>&nbsp;<span class="builtinfunc" id="4743691">new</span><span class="op" id="4743694">(</span><span class="ident" id="4743695">big</span><span class="op" id="4743698">.</span><span class="ident" id="4743699">Int</span><span class="op" id="4743702">)</span><span class="op" id="4743703">.</span><span class="ident" id="4743704">Set</span><span class="op" id="4743707">(</span><span class="ident" id="4743708">r</span><span class="op" id="4743709">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743713">values</span><span class="op" id="4743719">.</span><span class="ident" id="4743720">Coeff</span>&nbsp;<span class="op" id="4743726">=</span>&nbsp;<span class="builtinfunc" id="4743728">new</span><span class="op" id="4743731">(</span><span class="ident" id="4743732">big</span><span class="op" id="4743735">.</span><span class="ident" id="4743736">Int</span><span class="op" id="4743739">)</span><span class="op" id="4743740">.</span><span class="ident" id="4743741">ModInverse</span><span class="op" id="4743751">(</span><span class="ident" id="4743752">r</span><span class="op" id="4743753">,</span>&nbsp;<span class="ident" id="4743755">prime</span><span class="op" id="4743760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743765">r</span><span class="op" id="4743766">.</span><span class="ident" id="4743767">Mul</span><span class="op" id="4743770">(</span><span class="ident" id="4743771">r</span><span class="op" id="4743772">,</span>&nbsp;<span class="ident" id="4743774">prime</span><span class="op" id="4743779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743782">}</span><br>
<span class="lineno"></span><span class="op" id="4743784">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4743787">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4743865">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4743914">func</span>&nbsp;<span class="ident" id="4743919">decrypt</span><span class="op" id="4743926">(</span><span class="ident" id="4743927">random</span>&nbsp;<span class="ident" id="4743934">io</span><span class="op" id="4743936">.</span><span class="ident" id="4743937">Reader</span><span class="op" id="4743943">,</span>&nbsp;<span class="ident" id="4743945">priv</span>&nbsp;<span class="op" id="4743950">*</span><span class="ident" id="4743951">PrivateKey</span><span class="op" id="4743961">,</span>&nbsp;<span class="ident" id="4743963">c</span>&nbsp;<span class="op" id="4743965">*</span><span class="ident" id="4743966">big</span><span class="op" id="4743969">.</span><span class="ident" id="4743970">Int</span><span class="op" id="4743973">)</span>&nbsp;<span class="op" id="4743975">(</span><span class="ident" id="4743976">m</span>&nbsp;<span class="op" id="4743978">*</span><span class="ident" id="4743979">big</span><span class="op" id="4743982">.</span><span class="ident" id="4743983">Int</span><span class="op" id="4743986">,</span>&nbsp;<span class="ident" id="4743988">err</span>&nbsp;<span class="builtintype" id="4743992">error</span><span class="op" id="4743997">)</span>&nbsp;<span class="op" id="4743999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744002">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744054">if</span>&nbsp;<span class="ident" id="4744057">c</span><span class="op" id="4744058">.</span><span class="ident" id="4744059">Cmp</span><span class="op" id="4744062">(</span><span class="ident" id="4744063">priv</span><span class="op" id="4744067">.</span><span class="ident" id="4744068">N</span><span class="op" id="4744069">)</span>&nbsp;<span class="op" id="4744071">&gt;</span>&nbsp;<span class="num" id="4744073">0</span>&nbsp;<span class="op" id="4744075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744079">err</span>&nbsp;<span class="op" id="4744083">=</span>&nbsp;<span class="ident" id="4744085">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744101">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744113">var</span>&nbsp;<span class="ident" id="4744117">ir</span>&nbsp;<span class="op" id="4744120">*</span><span class="ident" id="4744121">big</span><span class="op" id="4744124">.</span><span class="ident" id="4744125">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744130">if</span>&nbsp;<span class="ident" id="4744133">random</span>&nbsp;<span class="op" id="4744140">!=</span>&nbsp;<span class="ident" id="4744143">nil</span>&nbsp;<span class="op" id="4744147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744151">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744214">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744278">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744342">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744399">var</span>&nbsp;<span class="ident" id="4744403">r</span>&nbsp;<span class="op" id="4744405">*</span><span class="ident" id="4744406">big</span><span class="op" id="4744409">.</span><span class="ident" id="4744410">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744417">for</span>&nbsp;<span class="op" id="4744421">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744426">r</span><span class="op" id="4744427">,</span>&nbsp;<span class="ident" id="4744429">err</span>&nbsp;<span class="op" id="4744433">=</span>&nbsp;<span class="ident" id="4744435">rand</span><span class="op" id="4744439">.</span><span class="ident" id="4744440">Int</span><span class="op" id="4744443">(</span><span class="ident" id="4744444">random</span><span class="op" id="4744450">,</span>&nbsp;<span class="ident" id="4744452">priv</span><span class="op" id="4744456">.</span><span class="ident" id="4744457">N</span><span class="op" id="4744458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744463">if</span>&nbsp;<span class="ident" id="4744466">err</span>&nbsp;<span class="op" id="4744470">!=</span>&nbsp;<span class="ident" id="4744473">nil</span>&nbsp;<span class="op" id="4744477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744483">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744498">if</span>&nbsp;<span class="ident" id="4744501">r</span><span class="op" id="4744502">.</span><span class="ident" id="4744503">Cmp</span><span class="op" id="4744506">(</span><span class="ident" id="4744507">bigZero</span><span class="op" id="4744514">)</span>&nbsp;<span class="op" id="4744516">==</span>&nbsp;<span class="num" id="4744519">0</span>&nbsp;<span class="op" id="4744521">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744527">r</span>&nbsp;<span class="op" id="4744529">=</span>&nbsp;<span class="ident" id="4744531">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744546">var</span>&nbsp;<span class="ident" id="4744550">ok</span>&nbsp;<span class="builtintype" id="4744553">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744561">ir</span><span class="op" id="4744563">,</span>&nbsp;<span class="ident" id="4744565">ok</span>&nbsp;<span class="op" id="4744568">=</span>&nbsp;<span class="ident" id="4744570">modInverse</span><span class="op" id="4744580">(</span><span class="ident" id="4744581">r</span><span class="op" id="4744582">,</span>&nbsp;<span class="ident" id="4744584">priv</span><span class="op" id="4744588">.</span><span class="ident" id="4744589">N</span><span class="op" id="4744590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744595">if</span>&nbsp;<span class="ident" id="4744598">ok</span>&nbsp;<span class="op" id="4744601">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744607">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744624">bigE</span>&nbsp;<span class="op" id="4744629">:=</span>&nbsp;<span class="ident" id="4744632">big</span><span class="op" id="4744635">.</span><span class="ident" id="4744636">NewInt</span><span class="op" id="4744642">(</span><span class="ident" id="4744643">int64</span><span class="op" id="4744648">(</span><span class="ident" id="4744649">priv</span><span class="op" id="4744653">.</span><span class="ident" id="4744654">E</span><span class="op" id="4744655">)</span><span class="op" id="4744656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744660">rpowe</span>&nbsp;<span class="op" id="4744666">:=</span>&nbsp;<span class="builtinfunc" id="4744669">new</span><span class="op" id="4744672">(</span><span class="ident" id="4744673">big</span><span class="op" id="4744676">.</span><span class="ident" id="4744677">Int</span><span class="op" id="4744680">)</span><span class="op" id="4744681">.</span><span class="ident" id="4744682">Exp</span><span class="op" id="4744685">(</span><span class="ident" id="4744686">r</span><span class="op" id="4744687">,</span>&nbsp;<span class="ident" id="4744689">bigE</span><span class="op" id="4744693">,</span>&nbsp;<span class="ident" id="4744695">priv</span><span class="op" id="4744699">.</span><span class="ident" id="4744700">N</span><span class="op" id="4744701">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744705">cCopy</span>&nbsp;<span class="op" id="4744711">:=</span>&nbsp;<span class="builtinfunc" id="4744714">new</span><span class="op" id="4744717">(</span><span class="ident" id="4744718">big</span><span class="op" id="4744721">.</span><span class="ident" id="4744722">Int</span><span class="op" id="4744725">)</span><span class="op" id="4744726">.</span><span class="ident" id="4744727">Set</span><span class="op" id="4744730">(</span><span class="ident" id="4744731">c</span><span class="op" id="4744732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744736">cCopy</span><span class="op" id="4744741">.</span><span class="ident" id="4744742">Mul</span><span class="op" id="4744745">(</span><span class="ident" id="4744746">cCopy</span><span class="op" id="4744751">,</span>&nbsp;<span class="ident" id="4744753">rpowe</span><span class="op" id="4744758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744762">cCopy</span><span class="op" id="4744767">.</span><span class="ident" id="4744768">Mod</span><span class="op" id="4744771">(</span><span class="ident" id="4744772">cCopy</span><span class="op" id="4744777">,</span>&nbsp;<span class="ident" id="4744779">priv</span><span class="op" id="4744783">.</span><span class="ident" id="4744784">N</span><span class="op" id="4744785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744789">c</span>&nbsp;<span class="op" id="4744791">=</span>&nbsp;<span class="ident" id="4744793">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744800">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744804">if</span>&nbsp;<span class="ident" id="4744807">priv</span><span class="op" id="4744811">.</span><span class="ident" id="4744812">Precomputed</span><span class="op" id="4744823">.</span><span class="ident" id="4744824">Dp</span>&nbsp;<span class="op" id="4744827">==</span>&nbsp;<span class="ident" id="4744830">nil</span>&nbsp;<span class="op" id="4744834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744838">m</span>&nbsp;<span class="op" id="4744840">=</span>&nbsp;<span class="builtinfunc" id="4744842">new</span><span class="op" id="4744845">(</span><span class="ident" id="4744846">big</span><span class="op" id="4744849">.</span><span class="ident" id="4744850">Int</span><span class="op" id="4744853">)</span><span class="op" id="4744854">.</span><span class="ident" id="4744855">Exp</span><span class="op" id="4744858">(</span><span class="ident" id="4744859">c</span><span class="op" id="4744860">,</span>&nbsp;<span class="ident" id="4744862">priv</span><span class="op" id="4744866">.</span><span class="ident" id="4744867">D</span><span class="op" id="4744868">,</span>&nbsp;<span class="ident" id="4744870">priv</span><span class="op" id="4744874">.</span><span class="ident" id="4744875">N</span><span class="op" id="4744876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744879">}</span>&nbsp;<span class="keyword" id="4744881">else</span>&nbsp;<span class="op" id="4744886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4744890">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744948">m</span>&nbsp;<span class="op" id="4744950">=</span>&nbsp;<span class="builtinfunc" id="4744952">new</span><span class="op" id="4744955">(</span><span class="ident" id="4744956">big</span><span class="op" id="4744959">.</span><span class="ident" id="4744960">Int</span><span class="op" id="4744963">)</span><span class="op" id="4744964">.</span><span class="ident" id="4744965">Exp</span><span class="op" id="4744968">(</span><span class="ident" id="4744969">c</span><span class="op" id="4744970">,</span>&nbsp;<span class="ident" id="4744972">priv</span><span class="op" id="4744976">.</span><span class="ident" id="4744977">Precomputed</span><span class="op" id="4744988">.</span><span class="ident" id="4744989">Dp</span><span class="op" id="4744991">,</span>&nbsp;<span class="ident" id="4744993">priv</span><span class="op" id="4744997">.</span><span class="ident" id="4744998">Primes</span><span class="op" id="4745004">[</span><span class="num" id="4745005">0</span><span class="op" id="4745006">]</span><span class="op" id="4745007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745011">m2</span>&nbsp;<span class="op" id="4745014">:=</span>&nbsp;<span class="builtinfunc" id="4745017">new</span><span class="op" id="4745020">(</span><span class="ident" id="4745021">big</span><span class="op" id="4745024">.</span><span class="ident" id="4745025">Int</span><span class="op" id="4745028">)</span><span class="op" id="4745029">.</span><span class="ident" id="4745030">Exp</span><span class="op" id="4745033">(</span><span class="ident" id="4745034">c</span><span class="op" id="4745035">,</span>&nbsp;<span class="ident" id="4745037">priv</span><span class="op" id="4745041">.</span><span class="ident" id="4745042">Precomputed</span><span class="op" id="4745053">.</span><span class="ident" id="4745054">Dq</span><span class="op" id="4745056">,</span>&nbsp;<span class="ident" id="4745058">priv</span><span class="op" id="4745062">.</span><span class="ident" id="4745063">Primes</span><span class="op" id="4745069">[</span><span class="num" id="4745070">1</span><span class="op" id="4745071">]</span><span class="op" id="4745072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745076">m</span><span class="op" id="4745077">.</span><span class="ident" id="4745078">Sub</span><span class="op" id="4745081">(</span><span class="ident" id="4745082">m</span><span class="op" id="4745083">,</span>&nbsp;<span class="ident" id="4745085">m2</span><span class="op" id="4745087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745091">if</span>&nbsp;<span class="ident" id="4745094">m</span><span class="op" id="4745095">.</span><span class="ident" id="4745096">Sign</span><span class="op" id="4745100">(</span><span class="op" id="4745101">)</span>&nbsp;<span class="op" id="4745103">&lt;</span>&nbsp;<span class="num" id="4745105">0</span>&nbsp;<span class="op" id="4745107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745112">m</span><span class="op" id="4745113">.</span><span class="ident" id="4745114">Add</span><span class="op" id="4745117">(</span><span class="ident" id="4745118">m</span><span class="op" id="4745119">,</span>&nbsp;<span class="ident" id="4745121">priv</span><span class="op" id="4745125">.</span><span class="ident" id="4745126">Primes</span><span class="op" id="4745132">[</span><span class="num" id="4745133">0</span><span class="op" id="4745134">]</span><span class="op" id="4745135">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745143">m</span><span class="op" id="4745144">.</span><span class="ident" id="4745145">Mul</span><span class="op" id="4745148">(</span><span class="ident" id="4745149">m</span><span class="op" id="4745150">,</span>&nbsp;<span class="ident" id="4745152">priv</span><span class="op" id="4745156">.</span><span class="ident" id="4745157">Precomputed</span><span class="op" id="4745168">.</span><span class="ident" id="4745169">Qinv</span><span class="op" id="4745173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745177">m</span><span class="op" id="4745178">.</span><span class="ident" id="4745179">Mod</span><span class="op" id="4745182">(</span><span class="ident" id="4745183">m</span><span class="op" id="4745184">,</span>&nbsp;<span class="ident" id="4745186">priv</span><span class="op" id="4745190">.</span><span class="ident" id="4745191">Primes</span><span class="op" id="4745197">[</span><span class="num" id="4745198">0</span><span class="op" id="4745199">]</span><span class="op" id="4745200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745204">m</span><span class="op" id="4745205">.</span><span class="ident" id="4745206">Mul</span><span class="op" id="4745209">(</span><span class="ident" id="4745210">m</span><span class="op" id="4745211">,</span>&nbsp;<span class="ident" id="4745213">priv</span><span class="op" id="4745217">.</span><span class="ident" id="4745218">Primes</span><span class="op" id="4745224">[</span><span class="num" id="4745225">1</span><span class="op" id="4745226">]</span><span class="op" id="4745227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745231">m</span><span class="op" id="4745232">.</span><span class="ident" id="4745233">Add</span><span class="op" id="4745236">(</span><span class="ident" id="4745237">m</span><span class="op" id="4745238">,</span>&nbsp;<span class="ident" id="4745240">m2</span><span class="op" id="4745242">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745247">for</span>&nbsp;<span class="ident" id="4745251">i</span><span class="op" id="4745252">,</span>&nbsp;<span class="ident" id="4745254">values</span>&nbsp;<span class="op" id="4745261">:=</span>&nbsp;<span class="keyword" id="4745264">range</span>&nbsp;<span class="ident" id="4745270">priv</span><span class="op" id="4745274">.</span><span class="ident" id="4745275">Precomputed</span><span class="op" id="4745286">.</span><span class="ident" id="4745287">CRTValues</span>&nbsp;<span class="op" id="4745297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745302">prime</span>&nbsp;<span class="op" id="4745308">:=</span>&nbsp;<span class="ident" id="4745311">priv</span><span class="op" id="4745315">.</span><span class="ident" id="4745316">Primes</span><span class="op" id="4745322">[</span><span class="num" id="4745323">2</span><span class="op" id="4745324">+</span><span class="ident" id="4745325">i</span><span class="op" id="4745326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745331">m2</span><span class="op" id="4745333">.</span><span class="ident" id="4745334">Exp</span><span class="op" id="4745337">(</span><span class="ident" id="4745338">c</span><span class="op" id="4745339">,</span>&nbsp;<span class="ident" id="4745341">values</span><span class="op" id="4745347">.</span><span class="ident" id="4745348">Exp</span><span class="op" id="4745351">,</span>&nbsp;<span class="ident" id="4745353">prime</span><span class="op" id="4745358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745363">m2</span><span class="op" id="4745365">.</span><span class="ident" id="4745366">Sub</span><span class="op" id="4745369">(</span><span class="ident" id="4745370">m2</span><span class="op" id="4745372">,</span>&nbsp;<span class="ident" id="4745374">m</span><span class="op" id="4745375">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745380">m2</span><span class="op" id="4745382">.</span><span class="ident" id="4745383">Mul</span><span class="op" id="4745386">(</span><span class="ident" id="4745387">m2</span><span class="op" id="4745389">,</span>&nbsp;<span class="ident" id="4745391">values</span><span class="op" id="4745397">.</span><span class="ident" id="4745398">Coeff</span><span class="op" id="4745403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745408">m2</span><span class="op" id="4745410">.</span><span class="ident" id="4745411">Mod</span><span class="op" id="4745414">(</span><span class="ident" id="4745415">m2</span><span class="op" id="4745417">,</span>&nbsp;<span class="ident" id="4745419">prime</span><span class="op" id="4745424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745429">if</span>&nbsp;<span class="ident" id="4745432">m2</span><span class="op" id="4745434">.</span><span class="ident" id="4745435">Sign</span><span class="op" id="4745439">(</span><span class="op" id="4745440">)</span>&nbsp;<span class="op" id="4745442">&lt;</span>&nbsp;<span class="num" id="4745444">0</span>&nbsp;<span class="op" id="4745446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745452">m2</span><span class="op" id="4745454">.</span><span class="ident" id="4745455">Add</span><span class="op" id="4745458">(</span><span class="ident" id="4745459">m2</span><span class="op" id="4745461">,</span>&nbsp;<span class="ident" id="4745463">prime</span><span class="op" id="4745468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745473">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745478">m2</span><span class="op" id="4745480">.</span><span class="ident" id="4745481">Mul</span><span class="op" id="4745484">(</span><span class="ident" id="4745485">m2</span><span class="op" id="4745487">,</span>&nbsp;<span class="ident" id="4745489">values</span><span class="op" id="4745495">.</span><span class="ident" id="4745496">R</span><span class="op" id="4745497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745502">m</span><span class="op" id="4745503">.</span><span class="ident" id="4745504">Add</span><span class="op" id="4745507">(</span><span class="ident" id="4745508">m</span><span class="op" id="4745509">,</span>&nbsp;<span class="ident" id="4745511">m2</span><span class="op" id="4745513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745524">if</span>&nbsp;<span class="ident" id="4745527">ir</span>&nbsp;<span class="op" id="4745530">!=</span>&nbsp;<span class="ident" id="4745533">nil</span>&nbsp;<span class="op" id="4745537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745541">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745555">m</span><span class="op" id="4745556">.</span><span class="ident" id="4745557">Mul</span><span class="op" id="4745560">(</span><span class="ident" id="4745561">m</span><span class="op" id="4745562">,</span>&nbsp;<span class="ident" id="4745564">ir</span><span class="op" id="4745566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745570">m</span><span class="op" id="4745571">.</span><span class="ident" id="4745572">Mod</span><span class="op" id="4745575">(</span><span class="ident" id="4745576">m</span><span class="op" id="4745577">,</span>&nbsp;<span class="ident" id="4745579">priv</span><span class="op" id="4745583">.</span><span class="ident" id="4745584">N</span><span class="op" id="4745585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745588">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745592">return</span><br>
<span class="lineno"></span><span class="op" id="4745599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745602">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4745653">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4745742">func</span>&nbsp;<span class="ident" id="4745747">DecryptOAEP</span><span class="op" id="4745758">(</span><span class="ident" id="4745759">hash</span>&nbsp;<span class="ident" id="4745764">hash</span><span class="op" id="4745768">.</span><span class="ident" id="4745769">Hash</span><span class="op" id="4745773">,</span>&nbsp;<span class="ident" id="4745775">random</span>&nbsp;<span class="ident" id="4745782">io</span><span class="op" id="4745784">.</span><span class="ident" id="4745785">Reader</span><span class="op" id="4745791">,</span>&nbsp;<span class="ident" id="4745793">priv</span>&nbsp;<span class="op" id="4745798">*</span><span class="ident" id="4745799">PrivateKey</span><span class="op" id="4745809">,</span>&nbsp;<span class="ident" id="4745811">ciphertext</span>&nbsp;<span class="op" id="4745822">[</span><span class="op" id="4745823">]</span><span class="builtintype" id="4745824">byte</span><span class="op" id="4745828">,</span>&nbsp;<span class="ident" id="4745830">label</span>&nbsp;<span class="op" id="4745836">[</span><span class="op" id="4745837">]</span><span class="builtintype" id="4745838">byte</span><span class="op" id="4745842">)</span>&nbsp;<span class="op" id="4745844">(</span><span class="ident" id="4745845">msg</span>&nbsp;<span class="op" id="4745849">[</span><span class="op" id="4745850">]</span><span class="builtintype" id="4745851">byte</span><span class="op" id="4745855">,</span>&nbsp;<span class="ident" id="4745857">err</span>&nbsp;<span class="builtintype" id="4745861">error</span><span class="op" id="4745866">)</span>&nbsp;<span class="op" id="4745868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745871">if</span>&nbsp;<span class="ident" id="4745874">err</span>&nbsp;<span class="op" id="4745878">:=</span>&nbsp;<span class="ident" id="4745881">checkPub</span><span class="op" id="4745889">(</span><span class="op" id="4745890">&amp;</span><span class="ident" id="4745891">priv</span><span class="op" id="4745895">.</span><span class="ident" id="4745896">PublicKey</span><span class="op" id="4745905">)</span><span class="op" id="4745906">;</span>&nbsp;<span class="ident" id="4745908">err</span>&nbsp;<span class="op" id="4745912">!=</span>&nbsp;<span class="ident" id="4745915">nil</span>&nbsp;<span class="op" id="4745919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745923">return</span>&nbsp;<span class="ident" id="4745930">nil</span><span class="op" id="4745933">,</span>&nbsp;<span class="ident" id="4745935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745940">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745943">k</span>&nbsp;<span class="op" id="4745945">:=</span>&nbsp;<span class="op" id="4745948">(</span><span class="ident" id="4745949">priv</span><span class="op" id="4745953">.</span><span class="ident" id="4745954">N</span><span class="op" id="4745955">.</span><span class="ident" id="4745956">BitLen</span><span class="op" id="4745962">(</span><span class="op" id="4745963">)</span>&nbsp;<span class="op" id="4745965">+</span>&nbsp;<span class="num" id="4745967">7</span><span class="op" id="4745968">)</span>&nbsp;<span class="op" id="4745970">/</span>&nbsp;<span class="num" id="4745972">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745975">if</span>&nbsp;<span class="builtinfunc" id="4745978">len</span><span class="op" id="4745981">(</span><span class="ident" id="4745982">ciphertext</span><span class="op" id="4745992">)</span>&nbsp;<span class="op" id="4745994">&gt;</span>&nbsp;<span class="ident" id="4745996">k</span>&nbsp;<span class="op" id="4745998">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746003">k</span>&nbsp;<span class="op" id="4746005">&lt;</span>&nbsp;<span class="ident" id="4746007">hash</span><span class="op" id="4746011">.</span><span class="ident" id="4746012">Size</span><span class="op" id="4746016">(</span><span class="op" id="4746017">)</span><span class="op" id="4746018">*</span><span class="num" id="4746019">2</span><span class="op" id="4746020">+</span><span class="num" id="4746021">2</span>&nbsp;<span class="op" id="4746023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746027">err</span>&nbsp;<span class="op" id="4746031">=</span>&nbsp;<span class="ident" id="4746033">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746049">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746061">c</span>&nbsp;<span class="op" id="4746063">:=</span>&nbsp;<span class="builtinfunc" id="4746066">new</span><span class="op" id="4746069">(</span><span class="ident" id="4746070">big</span><span class="op" id="4746073">.</span><span class="ident" id="4746074">Int</span><span class="op" id="4746077">)</span><span class="op" id="4746078">.</span><span class="ident" id="4746079">SetBytes</span><span class="op" id="4746087">(</span><span class="ident" id="4746088">ciphertext</span><span class="op" id="4746098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746102">m</span><span class="op" id="4746103">,</span>&nbsp;<span class="ident" id="4746105">err</span>&nbsp;<span class="op" id="4746109">:=</span>&nbsp;<span class="ident" id="4746112">decrypt</span><span class="op" id="4746119">(</span><span class="ident" id="4746120">random</span><span class="op" id="4746126">,</span>&nbsp;<span class="ident" id="4746128">priv</span><span class="op" id="4746132">,</span>&nbsp;<span class="ident" id="4746134">c</span><span class="op" id="4746135">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746138">if</span>&nbsp;<span class="ident" id="4746141">err</span>&nbsp;<span class="op" id="4746145">!=</span>&nbsp;<span class="ident" id="4746148">nil</span>&nbsp;<span class="op" id="4746152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746168">hash</span><span class="op" id="4746172">.</span><span class="ident" id="4746173">Write</span><span class="op" id="4746178">(</span><span class="ident" id="4746179">label</span><span class="op" id="4746184">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746187">lHash</span>&nbsp;<span class="op" id="4746193">:=</span>&nbsp;<span class="ident" id="4746196">hash</span><span class="op" id="4746200">.</span><span class="ident" id="4746201">Sum</span><span class="op" id="4746204">(</span><span class="ident" id="4746205">nil</span><span class="op" id="4746208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746211">hash</span><span class="op" id="4746215">.</span><span class="ident" id="4746216">Reset</span><span class="op" id="4746221">(</span><span class="op" id="4746222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746226">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746286">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746359">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746428">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746496">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746522">em</span>&nbsp;<span class="op" id="4746525">:=</span>&nbsp;<span class="ident" id="4746528">leftPad</span><span class="op" id="4746535">(</span><span class="ident" id="4746536">m</span><span class="op" id="4746537">.</span><span class="ident" id="4746538">Bytes</span><span class="op" id="4746543">(</span><span class="op" id="4746544">)</span><span class="op" id="4746545">,</span>&nbsp;<span class="ident" id="4746547">k</span><span class="op" id="4746548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746552">firstByteIsZero</span>&nbsp;<span class="op" id="4746568">:=</span>&nbsp;<span class="ident" id="4746571">subtle</span><span class="op" id="4746577">.</span><span class="ident" id="4746578">ConstantTimeByteEq</span><span class="op" id="4746596">(</span><span class="ident" id="4746597">em</span><span class="op" id="4746599">[</span><span class="num" id="4746600">0</span><span class="op" id="4746601">]</span><span class="op" id="4746602">,</span>&nbsp;<span class="num" id="4746604">0</span><span class="op" id="4746605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746609">seed</span>&nbsp;<span class="op" id="4746614">:=</span>&nbsp;<span class="ident" id="4746617">em</span><span class="op" id="4746619">[</span><span class="num" id="4746620">1</span>&nbsp;<span class="op" id="4746622">:</span>&nbsp;<span class="ident" id="4746624">hash</span><span class="op" id="4746628">.</span><span class="ident" id="4746629">Size</span><span class="op" id="4746633">(</span><span class="op" id="4746634">)</span><span class="op" id="4746635">+</span><span class="num" id="4746636">1</span><span class="op" id="4746637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746640">db</span>&nbsp;<span class="op" id="4746643">:=</span>&nbsp;<span class="ident" id="4746646">em</span><span class="op" id="4746648">[</span><span class="ident" id="4746649">hash</span><span class="op" id="4746653">.</span><span class="ident" id="4746654">Size</span><span class="op" id="4746658">(</span><span class="op" id="4746659">)</span><span class="op" id="4746660">+</span><span class="num" id="4746661">1</span><span class="op" id="4746662">:</span><span class="op" id="4746663">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746667">mgf1XOR</span><span class="op" id="4746674">(</span><span class="ident" id="4746675">seed</span><span class="op" id="4746679">,</span>&nbsp;<span class="ident" id="4746681">hash</span><span class="op" id="4746685">,</span>&nbsp;<span class="ident" id="4746687">db</span><span class="op" id="4746689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746692">mgf1XOR</span><span class="op" id="4746699">(</span><span class="ident" id="4746700">db</span><span class="op" id="4746702">,</span>&nbsp;<span class="ident" id="4746704">hash</span><span class="op" id="4746708">,</span>&nbsp;<span class="ident" id="4746710">seed</span><span class="op" id="4746714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746718">lHash2</span>&nbsp;<span class="op" id="4746725">:=</span>&nbsp;<span class="ident" id="4746728">db</span><span class="op" id="4746730">[</span><span class="num" id="4746731">0</span><span class="op" id="4746732">:</span><span class="ident" id="4746733">hash</span><span class="op" id="4746737">.</span><span class="ident" id="4746738">Size</span><span class="op" id="4746742">(</span><span class="op" id="4746743">)</span><span class="op" id="4746744">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746748">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746821">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746892">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746960">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747016">lHash2Good</span>&nbsp;<span class="op" id="4747027">:=</span>&nbsp;<span class="ident" id="4747030">subtle</span><span class="op" id="4747036">.</span><span class="ident" id="4747037">ConstantTimeCompare</span><span class="op" id="4747056">(</span><span class="ident" id="4747057">lHash</span><span class="op" id="4747062">,</span>&nbsp;<span class="ident" id="4747064">lHash2</span><span class="op" id="4747070">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747074">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747145">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747183">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747246">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747293">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747354">var</span>&nbsp;<span class="ident" id="4747358">lookingForIndex</span><span class="op" id="4747373">,</span>&nbsp;<span class="ident" id="4747375">index</span><span class="op" id="4747380">,</span>&nbsp;<span class="ident" id="4747382">invalid</span>&nbsp;<span class="builtintype" id="4747390">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747395">lookingForIndex</span>&nbsp;<span class="op" id="4747411">=</span>&nbsp;<span class="num" id="4747413">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747416">rest</span>&nbsp;<span class="op" id="4747421">:=</span>&nbsp;<span class="ident" id="4747424">db</span><span class="op" id="4747426">[</span><span class="ident" id="4747427">hash</span><span class="op" id="4747431">.</span><span class="ident" id="4747432">Size</span><span class="op" id="4747436">(</span><span class="op" id="4747437">)</span><span class="op" id="4747438">:</span><span class="op" id="4747439">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747443">for</span>&nbsp;<span class="ident" id="4747447">i</span>&nbsp;<span class="op" id="4747449">:=</span>&nbsp;<span class="num" id="4747452">0</span><span class="op" id="4747453">;</span>&nbsp;<span class="ident" id="4747455">i</span>&nbsp;<span class="op" id="4747457">&lt;</span>&nbsp;<span class="builtinfunc" id="4747459">len</span><span class="op" id="4747462">(</span><span class="ident" id="4747463">rest</span><span class="op" id="4747467">)</span><span class="op" id="4747468">;</span>&nbsp;<span class="ident" id="4747470">i</span><span class="op" id="4747471">++</span>&nbsp;<span class="op" id="4747474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747478">equals0</span>&nbsp;<span class="op" id="4747486">:=</span>&nbsp;<span class="ident" id="4747489">subtle</span><span class="op" id="4747495">.</span><span class="ident" id="4747496">ConstantTimeByteEq</span><span class="op" id="4747514">(</span><span class="ident" id="4747515">rest</span><span class="op" id="4747519">[</span><span class="ident" id="4747520">i</span><span class="op" id="4747521">]</span><span class="op" id="4747522">,</span>&nbsp;<span class="num" id="4747524">0</span><span class="op" id="4747525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747529">equals1</span>&nbsp;<span class="op" id="4747537">:=</span>&nbsp;<span class="ident" id="4747540">subtle</span><span class="op" id="4747546">.</span><span class="ident" id="4747547">ConstantTimeByteEq</span><span class="op" id="4747565">(</span><span class="ident" id="4747566">rest</span><span class="op" id="4747570">[</span><span class="ident" id="4747571">i</span><span class="op" id="4747572">]</span><span class="op" id="4747573">,</span>&nbsp;<span class="num" id="4747575">1</span><span class="op" id="4747576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747580">index</span>&nbsp;<span class="op" id="4747586">=</span>&nbsp;<span class="ident" id="4747588">subtle</span><span class="op" id="4747594">.</span><span class="ident" id="4747595">ConstantTimeSelect</span><span class="op" id="4747613">(</span><span class="ident" id="4747614">lookingForIndex</span><span class="op" id="4747629">&amp;</span><span class="ident" id="4747630">equals1</span><span class="op" id="4747637">,</span>&nbsp;<span class="ident" id="4747639">i</span><span class="op" id="4747640">,</span>&nbsp;<span class="ident" id="4747642">index</span><span class="op" id="4747647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747651">lookingForIndex</span>&nbsp;<span class="op" id="4747667">=</span>&nbsp;<span class="ident" id="4747669">subtle</span><span class="op" id="4747675">.</span><span class="ident" id="4747676">ConstantTimeSelect</span><span class="op" id="4747694">(</span><span class="ident" id="4747695">equals1</span><span class="op" id="4747702">,</span>&nbsp;<span class="num" id="4747704">0</span><span class="op" id="4747705">,</span>&nbsp;<span class="ident" id="4747707">lookingForIndex</span><span class="op" id="4747722">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747726">invalid</span>&nbsp;<span class="op" id="4747734">=</span>&nbsp;<span class="ident" id="4747736">subtle</span><span class="op" id="4747742">.</span><span class="ident" id="4747743">ConstantTimeSelect</span><span class="op" id="4747761">(</span><span class="ident" id="4747762">lookingForIndex</span><span class="op" id="4747777">&amp;^</span><span class="ident" id="4747779">equals0</span><span class="op" id="4747786">,</span>&nbsp;<span class="num" id="4747788">1</span><span class="op" id="4747789">,</span>&nbsp;<span class="ident" id="4747791">invalid</span><span class="op" id="4747798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747805">if</span>&nbsp;<span class="ident" id="4747808">firstByteIsZero</span><span class="op" id="4747823">&amp;</span><span class="ident" id="4747824">lHash2Good</span><span class="op" id="4747834">&amp;^</span><span class="ident" id="4747836">invalid</span><span class="op" id="4747843">&amp;^</span><span class="ident" id="4747845">lookingForIndex</span>&nbsp;<span class="op" id="4747861">!=</span>&nbsp;<span class="num" id="4747864">1</span>&nbsp;<span class="op" id="4747866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747870">err</span>&nbsp;<span class="op" id="4747874">=</span>&nbsp;<span class="ident" id="4747876">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747904">msg</span>&nbsp;<span class="op" id="4747908">=</span>&nbsp;<span class="ident" id="4747910">rest</span><span class="op" id="4747914">[</span><span class="ident" id="4747915">index</span><span class="op" id="4747920">+</span><span class="num" id="4747921">1</span><span class="op" id="4747922">:</span><span class="op" id="4747923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747926">return</span><br>
<span class="lineno">545</span><span class="op" id="4747933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4747936">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4748015">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4748044">func</span>&nbsp;<span class="ident" id="4748049">leftPad</span><span class="op" id="4748056">(</span><span class="ident" id="4748057">input</span>&nbsp;<span class="op" id="4748063">[</span><span class="op" id="4748064">]</span><span class="builtintype" id="4748065">byte</span><span class="op" id="4748069">,</span>&nbsp;<span class="ident" id="4748071">size</span>&nbsp;<span class="builtintype" id="4748076">int</span><span class="op" id="4748079">)</span>&nbsp;<span class="op" id="4748081">(</span><span class="ident" id="4748082">out</span>&nbsp;<span class="op" id="4748086">[</span><span class="op" id="4748087">]</span><span class="builtintype" id="4748088">byte</span><span class="op" id="4748092">)</span>&nbsp;<span class="op" id="4748094">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748097">n</span>&nbsp;<span class="op" id="4748099">:=</span>&nbsp;<span class="builtinfunc" id="4748102">len</span><span class="op" id="4748105">(</span><span class="ident" id="4748106">input</span><span class="op" id="4748111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748114">if</span>&nbsp;<span class="ident" id="4748117">n</span>&nbsp;<span class="op" id="4748119">&gt;</span>&nbsp;<span class="ident" id="4748121">size</span>&nbsp;<span class="op" id="4748126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748130">n</span>&nbsp;<span class="op" id="4748132">=</span>&nbsp;<span class="ident" id="4748134">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748143">out</span>&nbsp;<span class="op" id="4748147">=</span>&nbsp;<span class="builtinfunc" id="4748149">make</span><span class="op" id="4748153">(</span><span class="op" id="4748154">[</span><span class="op" id="4748155">]</span><span class="builtintype" id="4748156">byte</span><span class="op" id="4748160">,</span>&nbsp;<span class="ident" id="4748162">size</span><span class="op" id="4748166">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4748169">copy</span><span class="op" id="4748173">(</span><span class="ident" id="4748174">out</span><span class="op" id="4748177">[</span><span class="builtinfunc" id="4748178">len</span><span class="op" id="4748181">(</span><span class="ident" id="4748182">out</span><span class="op" id="4748185">)</span><span class="op" id="4748186">-</span><span class="ident" id="4748187">n</span><span class="op" id="4748188">:</span><span class="op" id="4748189">]</span><span class="op" id="4748190">,</span>&nbsp;<span class="ident" id="4748192">input</span><span class="op" id="4748197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748200">return</span><br>
<span class="lineno"></span><span class="op" id="4748207">}</span>
</div>
</body>
</html>
