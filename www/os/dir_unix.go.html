<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2193625">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2193680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2193734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2193785">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193855">package</span>&nbsp;<span class="ident" id="2193863">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193867">import</span>&nbsp;<span class="op" id="2193874">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2193877">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2193883">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2193893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193896">const</span>&nbsp;<span class="op" id="2193902">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193905">blockSize</span>&nbsp;<span class="op" id="2193915">=</span>&nbsp;<span class="num" id="2193917">4096</span><br>
<span class="lineno"></span><span class="op" id="2193922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193925">func</span>&nbsp;<span class="op" id="2193930">(</span><span class="ident" id="2193931">f</span>&nbsp;<span class="op" id="2193933">*</span><span class="ident" id="2193934">File</span><span class="op" id="2193938">)</span>&nbsp;<span class="ident" id="2193940">readdirnames</span><span class="op" id="2193952">(</span><span class="ident" id="2193953">n</span>&nbsp;<span class="builtintype" id="2193955">int</span><span class="op" id="2193958">)</span>&nbsp;<span class="op" id="2193960">(</span><span class="ident" id="2193961">names</span>&nbsp;<span class="op" id="2193967">[</span><span class="op" id="2193968">]</span><span class="builtintype" id="2193969">string</span><span class="op" id="2193975">,</span>&nbsp;<span class="ident" id="2193977">err</span>&nbsp;<span class="builtintype" id="2193981">error</span><span class="op" id="2193986">)</span>&nbsp;<span class="op" id="2193988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193991">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194036">if</span>&nbsp;<span class="ident" id="2194039">f</span><span class="op" id="2194040">.</span><span class="ident" id="2194041">dirinfo</span>&nbsp;<span class="op" id="2194049">==</span>&nbsp;<span class="ident" id="2194052">nil</span>&nbsp;<span class="op" id="2194056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194060">f</span><span class="op" id="2194061">.</span><span class="ident" id="2194062">dirinfo</span>&nbsp;<span class="op" id="2194070">=</span>&nbsp;<span class="builtinfunc" id="2194072">new</span><span class="op" id="2194075">(</span><span class="ident" id="2194076">dirInfo</span><span class="op" id="2194083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194087">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194134">f</span><span class="op" id="2194135">.</span><span class="ident" id="2194136">dirinfo</span><span class="op" id="2194143">.</span><span class="ident" id="2194144">buf</span>&nbsp;<span class="op" id="2194148">=</span>&nbsp;<span class="builtinfunc" id="2194150">make</span><span class="op" id="2194154">(</span><span class="op" id="2194155">[</span><span class="op" id="2194156">]</span><span class="builtintype" id="2194157">byte</span><span class="op" id="2194161">,</span>&nbsp;<span class="ident" id="2194163">blockSize</span><span class="op" id="2194172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194175">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194178">d</span>&nbsp;<span class="op" id="2194180">:=</span>&nbsp;<span class="ident" id="2194183">f</span><span class="op" id="2194184">.</span><span class="ident" id="2194185">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194195">size</span>&nbsp;<span class="op" id="2194200">:=</span>&nbsp;<span class="ident" id="2194203">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194206">if</span>&nbsp;<span class="ident" id="2194209">size</span>&nbsp;<span class="op" id="2194214">&lt;=</span>&nbsp;<span class="num" id="2194217">0</span>&nbsp;<span class="op" id="2194219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194223">size</span>&nbsp;<span class="op" id="2194228">=</span>&nbsp;<span class="num" id="2194230">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194236">n</span>&nbsp;<span class="op" id="2194238">=</span>&nbsp;<span class="op" id="2194240">-</span><span class="num" id="2194241">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194248">names</span>&nbsp;<span class="op" id="2194254">=</span>&nbsp;<span class="builtinfunc" id="2194256">make</span><span class="op" id="2194260">(</span><span class="op" id="2194261">[</span><span class="op" id="2194262">]</span><span class="builtintype" id="2194263">string</span><span class="op" id="2194269">,</span>&nbsp;<span class="num" id="2194271">0</span><span class="op" id="2194272">,</span>&nbsp;<span class="ident" id="2194274">size</span><span class="op" id="2194278">)</span>&nbsp;<span class="comment" id="2194280">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194309">for</span>&nbsp;<span class="ident" id="2194313">n</span>&nbsp;<span class="op" id="2194315">!=</span>&nbsp;<span class="num" id="2194318">0</span>&nbsp;<span class="op" id="2194320">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194324">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194360">if</span>&nbsp;<span class="ident" id="2194363">d</span><span class="op" id="2194364">.</span><span class="ident" id="2194365">bufp</span>&nbsp;<span class="op" id="2194370">&gt;=</span>&nbsp;<span class="ident" id="2194373">d</span><span class="op" id="2194374">.</span><span class="ident" id="2194375">nbuf</span>&nbsp;<span class="op" id="2194380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194385">d</span><span class="op" id="2194386">.</span><span class="ident" id="2194387">bufp</span>&nbsp;<span class="op" id="2194392">=</span>&nbsp;<span class="num" id="2194394">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194399">var</span>&nbsp;<span class="ident" id="2194403">errno</span>&nbsp;<span class="builtintype" id="2194409">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194418">d</span><span class="op" id="2194419">.</span><span class="ident" id="2194420">nbuf</span><span class="op" id="2194424">,</span>&nbsp;<span class="ident" id="2194426">errno</span>&nbsp;<span class="op" id="2194432">=</span>&nbsp;<span class="ident" id="2194434">fixCount</span><span class="op" id="2194442">(</span><span class="ident" id="2194443">syscall</span><span class="op" id="2194450">.</span><span class="ident" id="2194451">ReadDirent</span><span class="op" id="2194461">(</span><span class="ident" id="2194462">f</span><span class="op" id="2194463">.</span><span class="ident" id="2194464">fd</span><span class="op" id="2194466">,</span>&nbsp;<span class="ident" id="2194468">d</span><span class="op" id="2194469">.</span><span class="ident" id="2194470">buf</span><span class="op" id="2194473">)</span><span class="op" id="2194474">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194479">if</span>&nbsp;<span class="ident" id="2194482">errno</span>&nbsp;<span class="op" id="2194488">!=</span>&nbsp;<span class="ident" id="2194491">nil</span>&nbsp;<span class="op" id="2194495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194501">return</span>&nbsp;<span class="ident" id="2194508">names</span><span class="op" id="2194513">,</span>&nbsp;<span class="ident" id="2194515">NewSyscallError</span><span class="op" id="2194530">(</span><span class="string" id="2194531">&#34;readdirent&#34;</span><span class="op" id="2194543">,</span>&nbsp;<span class="ident" id="2194545">errno</span><span class="op" id="2194550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194560">if</span>&nbsp;<span class="ident" id="2194563">d</span><span class="op" id="2194564">.</span><span class="ident" id="2194565">nbuf</span>&nbsp;<span class="op" id="2194570">&lt;=</span>&nbsp;<span class="num" id="2194573">0</span>&nbsp;<span class="op" id="2194575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194581">break</span>&nbsp;<span class="comment" id="2194587">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194606">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194628">var</span>&nbsp;<span class="ident" id="2194632">nb</span><span class="op" id="2194634">,</span>&nbsp;<span class="ident" id="2194636">nc</span>&nbsp;<span class="builtintype" id="2194639">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194645">nb</span><span class="op" id="2194647">,</span>&nbsp;<span class="ident" id="2194649">nc</span><span class="op" id="2194651">,</span>&nbsp;<span class="ident" id="2194653">names</span>&nbsp;<span class="op" id="2194659">=</span>&nbsp;<span class="ident" id="2194661">syscall</span><span class="op" id="2194668">.</span><span class="ident" id="2194669">ParseDirent</span><span class="op" id="2194680">(</span><span class="ident" id="2194681">d</span><span class="op" id="2194682">.</span><span class="ident" id="2194683">buf</span><span class="op" id="2194686">[</span><span class="ident" id="2194687">d</span><span class="op" id="2194688">.</span><span class="ident" id="2194689">bufp</span><span class="op" id="2194693">:</span><span class="ident" id="2194694">d</span><span class="op" id="2194695">.</span><span class="ident" id="2194696">nbuf</span><span class="op" id="2194700">]</span><span class="op" id="2194701">,</span>&nbsp;<span class="ident" id="2194703">n</span><span class="op" id="2194704">,</span>&nbsp;<span class="ident" id="2194706">names</span><span class="op" id="2194711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194715">d</span><span class="op" id="2194716">.</span><span class="ident" id="2194717">bufp</span>&nbsp;<span class="op" id="2194722">+=</span>&nbsp;<span class="ident" id="2194725">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194730">n</span>&nbsp;<span class="op" id="2194732">-=</span>&nbsp;<span class="ident" id="2194735">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194742">if</span>&nbsp;<span class="ident" id="2194745">n</span>&nbsp;<span class="op" id="2194747">&gt;=</span>&nbsp;<span class="num" id="2194750">0</span>&nbsp;<span class="op" id="2194752">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2194755">len</span><span class="op" id="2194758">(</span><span class="ident" id="2194759">names</span><span class="op" id="2194764">)</span>&nbsp;<span class="op" id="2194766">==</span>&nbsp;<span class="num" id="2194769">0</span>&nbsp;<span class="op" id="2194771">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194775">return</span>&nbsp;<span class="ident" id="2194782">names</span><span class="op" id="2194787">,</span>&nbsp;<span class="ident" id="2194789">io</span><span class="op" id="2194791">.</span><span class="ident" id="2194792">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194800">return</span>&nbsp;<span class="ident" id="2194807">names</span><span class="op" id="2194812">,</span>&nbsp;<span class="ident" id="2194814">nil</span><br>
<span class="lineno"></span><span class="op" id="2194818">}</span>
</div>
</body>
</html>
