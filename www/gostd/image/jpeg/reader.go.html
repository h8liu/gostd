<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4896554">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4896609">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4896663">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4896714">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="4896775">//</span><br>
<span class="lineno"></span><span class="comment" id="4896778">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="4896857">package</span>&nbsp;<span class="ident" id="4896865">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4896871">import</span>&nbsp;<span class="op" id="4896878">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4896881">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4896890">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4896905">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4896910">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4896913">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4896990">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897047">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="4897108">type</span>&nbsp;<span class="ident" id="4897113">FormatError</span>&nbsp;<span class="builtintype" id="4897125">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4897133">func</span>&nbsp;<span class="op" id="4897138">(</span><span class="ident" id="4897139">e</span>&nbsp;<span class="ident" id="4897141">FormatError</span><span class="op" id="4897152">)</span>&nbsp;<span class="ident" id="4897154">Error</span><span class="op" id="4897159">(</span><span class="op" id="4897160">)</span>&nbsp;<span class="builtintype" id="4897162">string</span>&nbsp;<span class="op" id="4897169">{</span>&nbsp;<span class="keyword" id="4897171">return</span>&nbsp;<span class="string" id="4897178">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="4897202">+</span>&nbsp;<span class="builtintype" id="4897204">string</span><span class="op" id="4897210">(</span><span class="ident" id="4897211">e</span><span class="op" id="4897212">)</span>&nbsp;<span class="op" id="4897214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897217">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="4897308">type</span>&nbsp;<span class="ident" id="4897313">UnsupportedError</span>&nbsp;<span class="builtintype" id="4897330">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4897338">func</span>&nbsp;<span class="op" id="4897343">(</span><span class="ident" id="4897344">e</span>&nbsp;<span class="ident" id="4897346">UnsupportedError</span><span class="op" id="4897362">)</span>&nbsp;<span class="ident" id="4897364">Error</span><span class="op" id="4897369">(</span><span class="op" id="4897370">)</span>&nbsp;<span class="builtintype" id="4897372">string</span>&nbsp;<span class="op" id="4897379">{</span>&nbsp;<span class="keyword" id="4897381">return</span>&nbsp;<span class="string" id="4897388">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="4897417">+</span>&nbsp;<span class="builtintype" id="4897419">string</span><span class="op" id="4897425">(</span><span class="ident" id="4897426">e</span><span class="op" id="4897427">)</span>&nbsp;<span class="op" id="4897429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897432">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="4897488">type</span>&nbsp;<span class="ident" id="4897493">component</span>&nbsp;<span class="keyword" id="4897503">struct</span>&nbsp;<span class="op" id="4897510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897513">h</span>&nbsp;&nbsp;<span class="builtintype" id="4897516">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4897522">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897554">v</span>&nbsp;&nbsp;<span class="builtintype" id="4897557">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4897563">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897593">c</span>&nbsp;&nbsp;<span class="builtintype" id="4897596">uint8</span>&nbsp;<span class="comment" id="4897602">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897628">tq</span>&nbsp;<span class="builtintype" id="4897631">uint8</span>&nbsp;<span class="comment" id="4897637">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="4897681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4897684">const</span>&nbsp;<span class="op" id="4897690">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897693">dcTable</span>&nbsp;<span class="op" id="4897701">=</span>&nbsp;<span class="num" id="4897703">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897706">acTable</span>&nbsp;<span class="op" id="4897714">=</span>&nbsp;<span class="num" id="4897716">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897719">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4897727">=</span>&nbsp;<span class="num" id="4897729">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897732">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4897740">=</span>&nbsp;<span class="num" id="4897742">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897745">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4897753">=</span>&nbsp;<span class="num" id="4897755">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4897759">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897810">nGrayComponent</span>&nbsp;<span class="op" id="4897825">=</span>&nbsp;<span class="num" id="4897827">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4897830">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897882">nColorComponent</span>&nbsp;<span class="op" id="4897898">=</span>&nbsp;<span class="num" id="4897900">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4897904">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4897986">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4898062">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898099">maxH</span>&nbsp;<span class="op" id="4898104">=</span>&nbsp;<span class="num" id="4898106">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898109">maxV</span>&nbsp;<span class="op" id="4898114">=</span>&nbsp;<span class="num" id="4898116">2</span><br>
<span class="lineno"></span><span class="op" id="4898118">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="4898121">const</span>&nbsp;<span class="op" id="4898127">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898130">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898142">=</span>&nbsp;<span class="num" id="4898144">0xd8</span>&nbsp;<span class="comment" id="4898149">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898169">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898181">=</span>&nbsp;<span class="num" id="4898183">0xd9</span>&nbsp;<span class="comment" id="4898188">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898206">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="4898218">=</span>&nbsp;<span class="num" id="4898220">0xc0</span>&nbsp;<span class="comment" id="4898225">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898256">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="4898268">=</span>&nbsp;<span class="num" id="4898270">0xc2</span>&nbsp;<span class="comment" id="4898275">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898309">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898321">=</span>&nbsp;<span class="num" id="4898323">0xc4</span>&nbsp;<span class="comment" id="4898328">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898354">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898366">=</span>&nbsp;<span class="num" id="4898368">0xdb</span>&nbsp;<span class="comment" id="4898373">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898404">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898416">=</span>&nbsp;<span class="num" id="4898418">0xda</span>&nbsp;<span class="comment" id="4898423">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898442">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898454">=</span>&nbsp;<span class="num" id="4898456">0xdd</span>&nbsp;<span class="comment" id="4898461">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898490">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="4898502">=</span>&nbsp;<span class="num" id="4898504">0xd0</span>&nbsp;<span class="comment" id="4898509">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898526">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="4898538">=</span>&nbsp;<span class="num" id="4898540">0xd7</span>&nbsp;<span class="comment" id="4898545">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898562">app0Marker</span>&nbsp;&nbsp;<span class="op" id="4898574">=</span>&nbsp;<span class="num" id="4898576">0xe0</span>&nbsp;<span class="comment" id="4898581">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898611">app15Marker</span>&nbsp;<span class="op" id="4898623">=</span>&nbsp;<span class="num" id="4898625">0xef</span>&nbsp;<span class="comment" id="4898630">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898661">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4898673">=</span>&nbsp;<span class="num" id="4898675">0xfe</span>&nbsp;<span class="comment" id="4898680">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="4898692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4898695">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="4898773">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4898851">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="4898931">var</span>&nbsp;<span class="ident" id="4898935">unzig</span>&nbsp;<span class="op" id="4898941">=</span>&nbsp;<span class="op" id="4898943">[</span><span class="ident" id="4898944">blockSize</span><span class="op" id="4898953">]</span><span class="builtintype" id="4898954">int</span><span class="op" id="4898957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4898960">0</span><span class="op" id="4898961">,</span>&nbsp;<span class="num" id="4898963">1</span><span class="op" id="4898964">,</span>&nbsp;<span class="num" id="4898966">8</span><span class="op" id="4898967">,</span>&nbsp;<span class="num" id="4898969">16</span><span class="op" id="4898971">,</span>&nbsp;<span class="num" id="4898973">9</span><span class="op" id="4898974">,</span>&nbsp;<span class="num" id="4898976">2</span><span class="op" id="4898977">,</span>&nbsp;<span class="num" id="4898979">3</span><span class="op" id="4898980">,</span>&nbsp;<span class="num" id="4898982">10</span><span class="op" id="4898984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4898987">17</span><span class="op" id="4898989">,</span>&nbsp;<span class="num" id="4898991">24</span><span class="op" id="4898993">,</span>&nbsp;<span class="num" id="4898995">32</span><span class="op" id="4898997">,</span>&nbsp;<span class="num" id="4898999">25</span><span class="op" id="4899001">,</span>&nbsp;<span class="num" id="4899003">18</span><span class="op" id="4899005">,</span>&nbsp;<span class="num" id="4899007">11</span><span class="op" id="4899009">,</span>&nbsp;<span class="num" id="4899011">4</span><span class="op" id="4899012">,</span>&nbsp;<span class="num" id="4899014">5</span><span class="op" id="4899015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899018">12</span><span class="op" id="4899020">,</span>&nbsp;<span class="num" id="4899022">19</span><span class="op" id="4899024">,</span>&nbsp;<span class="num" id="4899026">26</span><span class="op" id="4899028">,</span>&nbsp;<span class="num" id="4899030">33</span><span class="op" id="4899032">,</span>&nbsp;<span class="num" id="4899034">40</span><span class="op" id="4899036">,</span>&nbsp;<span class="num" id="4899038">48</span><span class="op" id="4899040">,</span>&nbsp;<span class="num" id="4899042">41</span><span class="op" id="4899044">,</span>&nbsp;<span class="num" id="4899046">34</span><span class="op" id="4899048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899051">27</span><span class="op" id="4899053">,</span>&nbsp;<span class="num" id="4899055">20</span><span class="op" id="4899057">,</span>&nbsp;<span class="num" id="4899059">13</span><span class="op" id="4899061">,</span>&nbsp;<span class="num" id="4899063">6</span><span class="op" id="4899064">,</span>&nbsp;<span class="num" id="4899066">7</span><span class="op" id="4899067">,</span>&nbsp;<span class="num" id="4899069">14</span><span class="op" id="4899071">,</span>&nbsp;<span class="num" id="4899073">21</span><span class="op" id="4899075">,</span>&nbsp;<span class="num" id="4899077">28</span><span class="op" id="4899079">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899082">35</span><span class="op" id="4899084">,</span>&nbsp;<span class="num" id="4899086">42</span><span class="op" id="4899088">,</span>&nbsp;<span class="num" id="4899090">49</span><span class="op" id="4899092">,</span>&nbsp;<span class="num" id="4899094">56</span><span class="op" id="4899096">,</span>&nbsp;<span class="num" id="4899098">57</span><span class="op" id="4899100">,</span>&nbsp;<span class="num" id="4899102">50</span><span class="op" id="4899104">,</span>&nbsp;<span class="num" id="4899106">43</span><span class="op" id="4899108">,</span>&nbsp;<span class="num" id="4899110">36</span><span class="op" id="4899112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899115">29</span><span class="op" id="4899117">,</span>&nbsp;<span class="num" id="4899119">22</span><span class="op" id="4899121">,</span>&nbsp;<span class="num" id="4899123">15</span><span class="op" id="4899125">,</span>&nbsp;<span class="num" id="4899127">23</span><span class="op" id="4899129">,</span>&nbsp;<span class="num" id="4899131">30</span><span class="op" id="4899133">,</span>&nbsp;<span class="num" id="4899135">37</span><span class="op" id="4899137">,</span>&nbsp;<span class="num" id="4899139">44</span><span class="op" id="4899141">,</span>&nbsp;<span class="num" id="4899143">51</span><span class="op" id="4899145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899148">58</span><span class="op" id="4899150">,</span>&nbsp;<span class="num" id="4899152">59</span><span class="op" id="4899154">,</span>&nbsp;<span class="num" id="4899156">52</span><span class="op" id="4899158">,</span>&nbsp;<span class="num" id="4899160">45</span><span class="op" id="4899162">,</span>&nbsp;<span class="num" id="4899164">38</span><span class="op" id="4899166">,</span>&nbsp;<span class="num" id="4899168">31</span><span class="op" id="4899170">,</span>&nbsp;<span class="num" id="4899172">39</span><span class="op" id="4899174">,</span>&nbsp;<span class="num" id="4899176">46</span><span class="op" id="4899178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4899181">53</span><span class="op" id="4899183">,</span>&nbsp;<span class="num" id="4899185">60</span><span class="op" id="4899187">,</span>&nbsp;<span class="num" id="4899189">61</span><span class="op" id="4899191">,</span>&nbsp;<span class="num" id="4899193">54</span><span class="op" id="4899195">,</span>&nbsp;<span class="num" id="4899197">47</span><span class="op" id="4899199">,</span>&nbsp;<span class="num" id="4899201">55</span><span class="op" id="4899203">,</span>&nbsp;<span class="num" id="4899205">62</span><span class="op" id="4899207">,</span>&nbsp;<span class="num" id="4899209">63</span><span class="op" id="4899211">,</span><br>
<span class="lineno"></span><span class="op" id="4899213">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4899216">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="4899241">type</span>&nbsp;<span class="ident" id="4899246">Reader</span>&nbsp;<span class="keyword" id="4899253">interface</span>&nbsp;<span class="op" id="4899263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899266">io</span><span class="op" id="4899268">.</span><span class="ident" id="4899269">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899281">io</span><span class="op" id="4899283">.</span><span class="ident" id="4899284">Reader</span><br>
<span class="lineno">90</span><span class="op" id="4899291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4899294">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="4899372">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4899452">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="4899466">type</span>&nbsp;<span class="ident" id="4899471">bits</span>&nbsp;<span class="keyword" id="4899476">struct</span>&nbsp;<span class="op" id="4899483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899486">a</span>&nbsp;<span class="builtintype" id="4899488">uint32</span>&nbsp;<span class="comment" id="4899495">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899512">m</span>&nbsp;<span class="builtintype" id="4899514">uint32</span>&nbsp;<span class="comment" id="4899521">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899574">n</span>&nbsp;<span class="builtintype" id="4899576">int32</span>&nbsp;&nbsp;<span class="comment" id="4899583">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="4899618">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4899621">type</span>&nbsp;<span class="ident" id="4899626">decoder</span>&nbsp;<span class="keyword" id="4899634">struct</span>&nbsp;<span class="op" id="4899641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899644">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899649">io</span><span class="op" id="4899651">.</span><span class="ident" id="4899652">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899660">bits</span>&nbsp;<span class="ident" id="4899665">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899671">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899741">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899810">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899861">bytes</span>&nbsp;<span class="keyword" id="4899867">struct</span>&nbsp;<span class="op" id="4899874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899878">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899940">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899996">buf</span>&nbsp;&nbsp;<span class="op" id="4900001">[</span><span class="num" id="4900002">4096</span><span class="op" id="4900006">]</span><span class="builtintype" id="4900007">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900014">i</span><span class="op" id="4900015">,</span>&nbsp;<span class="ident" id="4900017">j</span>&nbsp;<span class="builtintype" id="4900019">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4900025">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4900084">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900124">nUnreadable</span>&nbsp;<span class="builtintype" id="4900136">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900144">width</span><span class="op" id="4900149">,</span>&nbsp;<span class="ident" id="4900151">height</span>&nbsp;<span class="builtintype" id="4900158">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900163">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900177">*</span><span class="ident" id="4900178">image</span><span class="op" id="4900183">.</span><span class="ident" id="4900184">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900190">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900204">*</span><span class="ident" id="4900205">image</span><span class="op" id="4900210">.</span><span class="ident" id="4900211">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900218">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4900232">int</span>&nbsp;<span class="comment" id="4900236">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900258">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4900272">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900277">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4900291">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900297">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4900311">uint16</span>&nbsp;<span class="comment" id="4900318">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900369">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900383">[</span><span class="ident" id="4900384">nColorComponent</span><span class="op" id="4900399">]</span><span class="ident" id="4900400">component</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900411">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900425">[</span><span class="ident" id="4900426">nColorComponent</span><span class="op" id="4900441">]</span><span class="op" id="4900442">[</span><span class="op" id="4900443">]</span><span class="ident" id="4900444">block</span>&nbsp;<span class="comment" id="4900450">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900498">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900512">[</span><span class="ident" id="4900513">maxTc</span>&nbsp;<span class="op" id="4900519">+</span>&nbsp;<span class="num" id="4900521">1</span><span class="op" id="4900522">]</span><span class="op" id="4900523">[</span><span class="ident" id="4900524">maxTh</span>&nbsp;<span class="op" id="4900530">+</span>&nbsp;<span class="num" id="4900532">1</span><span class="op" id="4900533">]</span><span class="ident" id="4900534">huffman</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900543">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900557">[</span><span class="ident" id="4900558">maxTq</span>&nbsp;<span class="op" id="4900564">+</span>&nbsp;<span class="num" id="4900566">1</span><span class="op" id="4900567">]</span><span class="ident" id="4900568">block</span>&nbsp;<span class="comment" id="4900574">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900617">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900631">[</span><span class="ident" id="4900632">blockSize</span>&nbsp;<span class="op" id="4900642">+</span>&nbsp;<span class="num" id="4900644">1</span><span class="op" id="4900645">]</span><span class="builtintype" id="4900646">byte</span><br>
<span class="lineno"></span><span class="op" id="4900651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4900654">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4900728">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4900796">func</span>&nbsp;<span class="op" id="4900801">(</span><span class="ident" id="4900802">d</span>&nbsp;<span class="op" id="4900804">*</span><span class="ident" id="4900805">decoder</span><span class="op" id="4900812">)</span>&nbsp;<span class="ident" id="4900814">fill</span><span class="op" id="4900818">(</span><span class="op" id="4900819">)</span>&nbsp;<span class="builtintype" id="4900821">error</span>&nbsp;<span class="op" id="4900827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900830">if</span>&nbsp;<span class="ident" id="4900833">d</span><span class="op" id="4900834">.</span><span class="ident" id="4900835">bytes</span><span class="op" id="4900840">.</span><span class="ident" id="4900841">i</span>&nbsp;<span class="op" id="4900843">!=</span>&nbsp;<span class="ident" id="4900846">d</span><span class="op" id="4900847">.</span><span class="ident" id="4900848">bytes</span><span class="op" id="4900853">.</span><span class="ident" id="4900854">j</span>&nbsp;<span class="op" id="4900856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4900860">panic</span><span class="op" id="4900865">(</span><span class="string" id="4900866">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="4900909">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4900915">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4900985">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901020">if</span>&nbsp;<span class="ident" id="4901023">d</span><span class="op" id="4901024">.</span><span class="ident" id="4901025">bytes</span><span class="op" id="4901030">.</span><span class="ident" id="4901031">j</span>&nbsp;<span class="op" id="4901033">&gt;</span>&nbsp;<span class="num" id="4901035">2</span>&nbsp;<span class="op" id="4901037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901041">d</span><span class="op" id="4901042">.</span><span class="ident" id="4901043">bytes</span><span class="op" id="4901048">.</span><span class="ident" id="4901049">buf</span><span class="op" id="4901052">[</span><span class="num" id="4901053">0</span><span class="op" id="4901054">]</span>&nbsp;<span class="op" id="4901056">=</span>&nbsp;<span class="ident" id="4901058">d</span><span class="op" id="4901059">.</span><span class="ident" id="4901060">bytes</span><span class="op" id="4901065">.</span><span class="ident" id="4901066">buf</span><span class="op" id="4901069">[</span><span class="ident" id="4901070">d</span><span class="op" id="4901071">.</span><span class="ident" id="4901072">bytes</span><span class="op" id="4901077">.</span><span class="ident" id="4901078">j</span><span class="op" id="4901079">-</span><span class="num" id="4901080">2</span><span class="op" id="4901081">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901085">d</span><span class="op" id="4901086">.</span><span class="ident" id="4901087">bytes</span><span class="op" id="4901092">.</span><span class="ident" id="4901093">buf</span><span class="op" id="4901096">[</span><span class="num" id="4901097">1</span><span class="op" id="4901098">]</span>&nbsp;<span class="op" id="4901100">=</span>&nbsp;<span class="ident" id="4901102">d</span><span class="op" id="4901103">.</span><span class="ident" id="4901104">bytes</span><span class="op" id="4901109">.</span><span class="ident" id="4901110">buf</span><span class="op" id="4901113">[</span><span class="ident" id="4901114">d</span><span class="op" id="4901115">.</span><span class="ident" id="4901116">bytes</span><span class="op" id="4901121">.</span><span class="ident" id="4901122">j</span><span class="op" id="4901123">-</span><span class="num" id="4901124">1</span><span class="op" id="4901125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901129">d</span><span class="op" id="4901130">.</span><span class="ident" id="4901131">bytes</span><span class="op" id="4901136">.</span><span class="ident" id="4901137">i</span><span class="op" id="4901138">,</span>&nbsp;<span class="ident" id="4901140">d</span><span class="op" id="4901141">.</span><span class="ident" id="4901142">bytes</span><span class="op" id="4901147">.</span><span class="ident" id="4901148">j</span>&nbsp;<span class="op" id="4901150">=</span>&nbsp;<span class="num" id="4901152">2</span><span class="op" id="4901153">,</span>&nbsp;<span class="num" id="4901155">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4901161">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901197">n</span><span class="op" id="4901198">,</span>&nbsp;<span class="ident" id="4901200">err</span>&nbsp;<span class="op" id="4901204">:=</span>&nbsp;<span class="ident" id="4901207">d</span><span class="op" id="4901208">.</span><span class="ident" id="4901209">r</span><span class="op" id="4901210">.</span><span class="ident" id="4901211">Read</span><span class="op" id="4901215">(</span><span class="ident" id="4901216">d</span><span class="op" id="4901217">.</span><span class="ident" id="4901218">bytes</span><span class="op" id="4901223">.</span><span class="ident" id="4901224">buf</span><span class="op" id="4901227">[</span><span class="ident" id="4901228">d</span><span class="op" id="4901229">.</span><span class="ident" id="4901230">bytes</span><span class="op" id="4901235">.</span><span class="ident" id="4901236">j</span><span class="op" id="4901237">:</span><span class="op" id="4901238">]</span><span class="op" id="4901239">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901242">d</span><span class="op" id="4901243">.</span><span class="ident" id="4901244">bytes</span><span class="op" id="4901249">.</span><span class="ident" id="4901250">j</span>&nbsp;<span class="op" id="4901252">+=</span>&nbsp;<span class="ident" id="4901255">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901258">if</span>&nbsp;<span class="ident" id="4901261">n</span>&nbsp;<span class="op" id="4901263">&gt;</span>&nbsp;<span class="num" id="4901265">0</span>&nbsp;<span class="op" id="4901267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901271">err</span>&nbsp;<span class="op" id="4901275">=</span>&nbsp;<span class="builtintype" id="4901277">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901285">return</span>&nbsp;<span class="ident" id="4901292">err</span><br>
<span class="lineno">150</span><span class="op" id="4901296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4901299">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="4901373">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="4901453">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="4901532">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="4901610">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="4901678">func</span>&nbsp;<span class="op" id="4901683">(</span><span class="ident" id="4901684">d</span>&nbsp;<span class="op" id="4901686">*</span><span class="ident" id="4901687">decoder</span><span class="op" id="4901694">)</span>&nbsp;<span class="ident" id="4901696">unreadByteStuffedByte</span><span class="op" id="4901717">(</span><span class="op" id="4901718">)</span>&nbsp;<span class="op" id="4901720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901723">if</span>&nbsp;<span class="ident" id="4901726">d</span><span class="op" id="4901727">.</span><span class="ident" id="4901728">bytes</span><span class="op" id="4901733">.</span><span class="ident" id="4901734">nUnreadable</span>&nbsp;<span class="op" id="4901746">==</span>&nbsp;<span class="num" id="4901749">0</span>&nbsp;<span class="op" id="4901751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4901755">panic</span><span class="op" id="4901760">(</span><span class="string" id="4901761">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="4901815">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901821">d</span><span class="op" id="4901822">.</span><span class="ident" id="4901823">bytes</span><span class="op" id="4901828">.</span><span class="ident" id="4901829">i</span>&nbsp;<span class="op" id="4901831">-=</span>&nbsp;<span class="ident" id="4901834">d</span><span class="op" id="4901835">.</span><span class="ident" id="4901836">bytes</span><span class="op" id="4901841">.</span><span class="ident" id="4901842">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901855">d</span><span class="op" id="4901856">.</span><span class="ident" id="4901857">bytes</span><span class="op" id="4901862">.</span><span class="ident" id="4901863">nUnreadable</span>&nbsp;<span class="op" id="4901875">=</span>&nbsp;<span class="num" id="4901877">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901880">if</span>&nbsp;<span class="ident" id="4901883">d</span><span class="op" id="4901884">.</span><span class="ident" id="4901885">bits</span><span class="op" id="4901889">.</span><span class="ident" id="4901890">n</span>&nbsp;<span class="op" id="4901892">&gt;=</span>&nbsp;<span class="num" id="4901895">8</span>&nbsp;<span class="op" id="4901897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901901">d</span><span class="op" id="4901902">.</span><span class="ident" id="4901903">bits</span><span class="op" id="4901907">.</span><span class="ident" id="4901908">a</span>&nbsp;<span class="op" id="4901910">&gt;&gt;=</span>&nbsp;<span class="num" id="4901914">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901918">d</span><span class="op" id="4901919">.</span><span class="ident" id="4901920">bits</span><span class="op" id="4901924">.</span><span class="ident" id="4901925">n</span>&nbsp;<span class="op" id="4901927">-=</span>&nbsp;<span class="num" id="4901930">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901934">d</span><span class="op" id="4901935">.</span><span class="ident" id="4901936">bits</span><span class="op" id="4901940">.</span><span class="ident" id="4901941">m</span>&nbsp;<span class="op" id="4901943">&gt;&gt;=</span>&nbsp;<span class="num" id="4901947">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901950">}</span><br>
<span class="lineno"></span><span class="op" id="4901952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4901955">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4902032">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="4902065">func</span>&nbsp;<span class="op" id="4902070">(</span><span class="ident" id="4902071">d</span>&nbsp;<span class="op" id="4902073">*</span><span class="ident" id="4902074">decoder</span><span class="op" id="4902081">)</span>&nbsp;<span class="ident" id="4902083">readByte</span><span class="op" id="4902091">(</span><span class="op" id="4902092">)</span>&nbsp;<span class="op" id="4902094">(</span><span class="ident" id="4902095">x</span>&nbsp;<span class="builtintype" id="4902097">byte</span><span class="op" id="4902101">,</span>&nbsp;<span class="ident" id="4902103">err</span>&nbsp;<span class="builtintype" id="4902107">error</span><span class="op" id="4902112">)</span>&nbsp;<span class="op" id="4902114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902117">for</span>&nbsp;<span class="ident" id="4902121">d</span><span class="op" id="4902122">.</span><span class="ident" id="4902123">bytes</span><span class="op" id="4902128">.</span><span class="ident" id="4902129">i</span>&nbsp;<span class="op" id="4902131">==</span>&nbsp;<span class="ident" id="4902134">d</span><span class="op" id="4902135">.</span><span class="ident" id="4902136">bytes</span><span class="op" id="4902141">.</span><span class="ident" id="4902142">j</span>&nbsp;<span class="op" id="4902144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902148">if</span>&nbsp;<span class="ident" id="4902151">err</span>&nbsp;<span class="op" id="4902155">=</span>&nbsp;<span class="ident" id="4902157">d</span><span class="op" id="4902158">.</span><span class="ident" id="4902159">fill</span><span class="op" id="4902163">(</span><span class="op" id="4902164">)</span><span class="op" id="4902165">;</span>&nbsp;<span class="ident" id="4902167">err</span>&nbsp;<span class="op" id="4902171">!=</span>&nbsp;<span class="builtintype" id="4902174">nil</span>&nbsp;<span class="op" id="4902178">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902183">return</span>&nbsp;<span class="num" id="4902190">0</span><span class="op" id="4902191">,</span>&nbsp;<span class="ident" id="4902193">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902205">x</span>&nbsp;<span class="op" id="4902207">=</span>&nbsp;<span class="ident" id="4902209">d</span><span class="op" id="4902210">.</span><span class="ident" id="4902211">bytes</span><span class="op" id="4902216">.</span><span class="ident" id="4902217">buf</span><span class="op" id="4902220">[</span><span class="ident" id="4902221">d</span><span class="op" id="4902222">.</span><span class="ident" id="4902223">bytes</span><span class="op" id="4902228">.</span><span class="ident" id="4902229">i</span><span class="op" id="4902230">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902233">d</span><span class="op" id="4902234">.</span><span class="ident" id="4902235">bytes</span><span class="op" id="4902240">.</span><span class="ident" id="4902241">i</span><span class="op" id="4902242">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902246">d</span><span class="op" id="4902247">.</span><span class="ident" id="4902248">bytes</span><span class="op" id="4902253">.</span><span class="ident" id="4902254">nUnreadable</span>&nbsp;<span class="op" id="4902266">=</span>&nbsp;<span class="num" id="4902268">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902271">return</span>&nbsp;<span class="ident" id="4902278">x</span><span class="op" id="4902279">,</span>&nbsp;<span class="builtintype" id="4902281">nil</span><br>
<span class="lineno"></span><span class="op" id="4902285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4902288">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="4902365">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="4902440">var</span>&nbsp;<span class="ident" id="4902444">errMissingFF00</span>&nbsp;<span class="op" id="4902459">=</span>&nbsp;<span class="ident" id="4902461">FormatError</span><span class="op" id="4902472">(</span><span class="string" id="4902473">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="4902498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4902501">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4902579">func</span>&nbsp;<span class="op" id="4902584">(</span><span class="ident" id="4902585">d</span>&nbsp;<span class="op" id="4902587">*</span><span class="ident" id="4902588">decoder</span><span class="op" id="4902595">)</span>&nbsp;<span class="ident" id="4902597">readByteStuffedByte</span><span class="op" id="4902616">(</span><span class="op" id="4902617">)</span>&nbsp;<span class="op" id="4902619">(</span><span class="ident" id="4902620">x</span>&nbsp;<span class="builtintype" id="4902622">byte</span><span class="op" id="4902626">,</span>&nbsp;<span class="ident" id="4902628">err</span>&nbsp;<span class="builtintype" id="4902632">error</span><span class="op" id="4902637">)</span>&nbsp;<span class="op" id="4902639">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4902642">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902709">if</span>&nbsp;<span class="ident" id="4902712">d</span><span class="op" id="4902713">.</span><span class="ident" id="4902714">bytes</span><span class="op" id="4902719">.</span><span class="ident" id="4902720">i</span><span class="op" id="4902721">+</span><span class="num" id="4902722">2</span>&nbsp;<span class="op" id="4902724">&lt;=</span>&nbsp;<span class="ident" id="4902727">d</span><span class="op" id="4902728">.</span><span class="ident" id="4902729">bytes</span><span class="op" id="4902734">.</span><span class="ident" id="4902735">j</span>&nbsp;<span class="op" id="4902737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902741">x</span>&nbsp;<span class="op" id="4902743">=</span>&nbsp;<span class="ident" id="4902745">d</span><span class="op" id="4902746">.</span><span class="ident" id="4902747">bytes</span><span class="op" id="4902752">.</span><span class="ident" id="4902753">buf</span><span class="op" id="4902756">[</span><span class="ident" id="4902757">d</span><span class="op" id="4902758">.</span><span class="ident" id="4902759">bytes</span><span class="op" id="4902764">.</span><span class="ident" id="4902765">i</span><span class="op" id="4902766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902770">d</span><span class="op" id="4902771">.</span><span class="ident" id="4902772">bytes</span><span class="op" id="4902777">.</span><span class="ident" id="4902778">i</span><span class="op" id="4902779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902784">d</span><span class="op" id="4902785">.</span><span class="ident" id="4902786">bytes</span><span class="op" id="4902791">.</span><span class="ident" id="4902792">nUnreadable</span>&nbsp;<span class="op" id="4902804">=</span>&nbsp;<span class="num" id="4902806">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902810">if</span>&nbsp;<span class="ident" id="4902813">x</span>&nbsp;<span class="op" id="4902815">!=</span>&nbsp;<span class="num" id="4902818">0xff</span>&nbsp;<span class="op" id="4902823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902828">return</span>&nbsp;<span class="ident" id="4902835">x</span><span class="op" id="4902836">,</span>&nbsp;<span class="ident" id="4902838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902848">if</span>&nbsp;<span class="ident" id="4902851">d</span><span class="op" id="4902852">.</span><span class="ident" id="4902853">bytes</span><span class="op" id="4902858">.</span><span class="ident" id="4902859">buf</span><span class="op" id="4902862">[</span><span class="ident" id="4902863">d</span><span class="op" id="4902864">.</span><span class="ident" id="4902865">bytes</span><span class="op" id="4902870">.</span><span class="ident" id="4902871">i</span><span class="op" id="4902872">]</span>&nbsp;<span class="op" id="4902874">!=</span>&nbsp;<span class="num" id="4902877">0x00</span>&nbsp;<span class="op" id="4902882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902887">return</span>&nbsp;<span class="num" id="4902894">0</span><span class="op" id="4902895">,</span>&nbsp;<span class="ident" id="4902897">errMissingFF00</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902918">d</span><span class="op" id="4902919">.</span><span class="ident" id="4902920">bytes</span><span class="op" id="4902925">.</span><span class="ident" id="4902926">i</span><span class="op" id="4902927">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902932">d</span><span class="op" id="4902933">.</span><span class="ident" id="4902934">bytes</span><span class="op" id="4902939">.</span><span class="ident" id="4902940">nUnreadable</span>&nbsp;<span class="op" id="4902952">=</span>&nbsp;<span class="num" id="4902954">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902958">return</span>&nbsp;<span class="num" id="4902965">0xff</span><span class="op" id="4902969">,</span>&nbsp;<span class="builtintype" id="4902971">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902976">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902980">x</span><span class="op" id="4902981">,</span>&nbsp;<span class="ident" id="4902983">err</span>&nbsp;<span class="op" id="4902987">=</span>&nbsp;<span class="ident" id="4902989">d</span><span class="op" id="4902990">.</span><span class="ident" id="4902991">readByte</span><span class="op" id="4902999">(</span><span class="op" id="4903000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903003">if</span>&nbsp;<span class="ident" id="4903006">err</span>&nbsp;<span class="op" id="4903010">!=</span>&nbsp;<span class="builtintype" id="4903013">nil</span>&nbsp;<span class="op" id="4903017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903021">return</span>&nbsp;<span class="num" id="4903028">0</span><span class="op" id="4903029">,</span>&nbsp;<span class="ident" id="4903031">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903036">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903039">if</span>&nbsp;<span class="ident" id="4903042">x</span>&nbsp;<span class="op" id="4903044">!=</span>&nbsp;<span class="num" id="4903047">0xff</span>&nbsp;<span class="op" id="4903052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903056">d</span><span class="op" id="4903057">.</span><span class="ident" id="4903058">bytes</span><span class="op" id="4903063">.</span><span class="ident" id="4903064">nUnreadable</span>&nbsp;<span class="op" id="4903076">=</span>&nbsp;<span class="num" id="4903078">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903082">return</span>&nbsp;<span class="ident" id="4903089">x</span><span class="op" id="4903090">,</span>&nbsp;<span class="builtintype" id="4903092">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903101">x</span><span class="op" id="4903102">,</span>&nbsp;<span class="ident" id="4903104">err</span>&nbsp;<span class="op" id="4903108">=</span>&nbsp;<span class="ident" id="4903110">d</span><span class="op" id="4903111">.</span><span class="ident" id="4903112">readByte</span><span class="op" id="4903120">(</span><span class="op" id="4903121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903124">if</span>&nbsp;<span class="ident" id="4903127">err</span>&nbsp;<span class="op" id="4903131">!=</span>&nbsp;<span class="builtintype" id="4903134">nil</span>&nbsp;<span class="op" id="4903138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903142">d</span><span class="op" id="4903143">.</span><span class="ident" id="4903144">bytes</span><span class="op" id="4903149">.</span><span class="ident" id="4903150">nUnreadable</span>&nbsp;<span class="op" id="4903162">=</span>&nbsp;<span class="num" id="4903164">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903168">return</span>&nbsp;<span class="num" id="4903175">0</span><span class="op" id="4903176">,</span>&nbsp;<span class="ident" id="4903178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903183">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903186">d</span><span class="op" id="4903187">.</span><span class="ident" id="4903188">bytes</span><span class="op" id="4903193">.</span><span class="ident" id="4903194">nUnreadable</span>&nbsp;<span class="op" id="4903206">=</span>&nbsp;<span class="num" id="4903208">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903211">if</span>&nbsp;<span class="ident" id="4903214">x</span>&nbsp;<span class="op" id="4903216">!=</span>&nbsp;<span class="num" id="4903219">0x00</span>&nbsp;<span class="op" id="4903224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903228">return</span>&nbsp;<span class="num" id="4903235">0</span><span class="op" id="4903236">,</span>&nbsp;<span class="ident" id="4903238">errMissingFF00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903257">return</span>&nbsp;<span class="num" id="4903264">0xff</span><span class="op" id="4903268">,</span>&nbsp;<span class="builtintype" id="4903270">nil</span><br>
<span class="lineno">225</span><span class="op" id="4903274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4903277">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4903352">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="4903365">func</span>&nbsp;<span class="op" id="4903370">(</span><span class="ident" id="4903371">d</span>&nbsp;<span class="op" id="4903373">*</span><span class="ident" id="4903374">decoder</span><span class="op" id="4903381">)</span>&nbsp;<span class="ident" id="4903383">readFull</span><span class="op" id="4903391">(</span><span class="ident" id="4903392">p</span>&nbsp;<span class="op" id="4903394">[</span><span class="op" id="4903395">]</span><span class="builtintype" id="4903396">byte</span><span class="op" id="4903400">)</span>&nbsp;<span class="builtintype" id="4903402">error</span>&nbsp;<span class="op" id="4903408">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4903411">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903450">if</span>&nbsp;<span class="ident" id="4903453">d</span><span class="op" id="4903454">.</span><span class="ident" id="4903455">bytes</span><span class="op" id="4903460">.</span><span class="ident" id="4903461">nUnreadable</span>&nbsp;<span class="op" id="4903473">!=</span>&nbsp;<span class="num" id="4903476">0</span>&nbsp;<span class="op" id="4903478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903482">if</span>&nbsp;<span class="ident" id="4903485">d</span><span class="op" id="4903486">.</span><span class="ident" id="4903487">bits</span><span class="op" id="4903491">.</span><span class="ident" id="4903492">n</span>&nbsp;<span class="op" id="4903494">&gt;=</span>&nbsp;<span class="num" id="4903497">8</span>&nbsp;<span class="op" id="4903499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903504">d</span><span class="op" id="4903505">.</span><span class="ident" id="4903506">unreadByteStuffedByte</span><span class="op" id="4903527">(</span><span class="op" id="4903528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903532">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903536">d</span><span class="op" id="4903537">.</span><span class="ident" id="4903538">bytes</span><span class="op" id="4903543">.</span><span class="ident" id="4903544">nUnreadable</span>&nbsp;<span class="op" id="4903556">=</span>&nbsp;<span class="num" id="4903558">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903565">for</span>&nbsp;<span class="op" id="4903569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903573">n</span>&nbsp;<span class="op" id="4903575">:=</span>&nbsp;<span class="builtinfunc" id="4903578">copy</span><span class="op" id="4903582">(</span><span class="ident" id="4903583">p</span><span class="op" id="4903584">,</span>&nbsp;<span class="ident" id="4903586">d</span><span class="op" id="4903587">.</span><span class="ident" id="4903588">bytes</span><span class="op" id="4903593">.</span><span class="ident" id="4903594">buf</span><span class="op" id="4903597">[</span><span class="ident" id="4903598">d</span><span class="op" id="4903599">.</span><span class="ident" id="4903600">bytes</span><span class="op" id="4903605">.</span><span class="ident" id="4903606">i</span><span class="op" id="4903607">:</span><span class="ident" id="4903608">d</span><span class="op" id="4903609">.</span><span class="ident" id="4903610">bytes</span><span class="op" id="4903615">.</span><span class="ident" id="4903616">j</span><span class="op" id="4903617">]</span><span class="op" id="4903618">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903622">p</span>&nbsp;<span class="op" id="4903624">=</span>&nbsp;<span class="ident" id="4903626">p</span><span class="op" id="4903627">[</span><span class="ident" id="4903628">n</span><span class="op" id="4903629">:</span><span class="op" id="4903630">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903634">d</span><span class="op" id="4903635">.</span><span class="ident" id="4903636">bytes</span><span class="op" id="4903641">.</span><span class="ident" id="4903642">i</span>&nbsp;<span class="op" id="4903644">+=</span>&nbsp;<span class="ident" id="4903647">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903651">if</span>&nbsp;<span class="builtinfunc" id="4903654">len</span><span class="op" id="4903657">(</span><span class="ident" id="4903658">p</span><span class="op" id="4903659">)</span>&nbsp;<span class="op" id="4903661">==</span>&nbsp;<span class="num" id="4903664">0</span>&nbsp;<span class="op" id="4903666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903671">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903679">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903683">if</span>&nbsp;<span class="ident" id="4903686">err</span>&nbsp;<span class="op" id="4903690">:=</span>&nbsp;<span class="ident" id="4903693">d</span><span class="op" id="4903694">.</span><span class="ident" id="4903695">fill</span><span class="op" id="4903699">(</span><span class="op" id="4903700">)</span><span class="op" id="4903701">;</span>&nbsp;<span class="ident" id="4903703">err</span>&nbsp;<span class="op" id="4903707">!=</span>&nbsp;<span class="builtintype" id="4903710">nil</span>&nbsp;<span class="op" id="4903714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903719">if</span>&nbsp;<span class="ident" id="4903722">err</span>&nbsp;<span class="op" id="4903726">==</span>&nbsp;<span class="ident" id="4903729">io</span><span class="op" id="4903731">.</span><span class="ident" id="4903732">EOF</span>&nbsp;<span class="op" id="4903736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903742">err</span>&nbsp;<span class="op" id="4903746">=</span>&nbsp;<span class="ident" id="4903748">io</span><span class="op" id="4903750">.</span><span class="ident" id="4903751">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903776">return</span>&nbsp;<span class="ident" id="4903783">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903795">return</span>&nbsp;<span class="builtintype" id="4903802">nil</span><br>
<span class="lineno"></span><span class="op" id="4903806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4903809">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4903845">func</span>&nbsp;<span class="op" id="4903850">(</span><span class="ident" id="4903851">d</span>&nbsp;<span class="op" id="4903853">*</span><span class="ident" id="4903854">decoder</span><span class="op" id="4903861">)</span>&nbsp;<span class="ident" id="4903863">ignore</span><span class="op" id="4903869">(</span><span class="ident" id="4903870">n</span>&nbsp;<span class="builtintype" id="4903872">int</span><span class="op" id="4903875">)</span>&nbsp;<span class="builtintype" id="4903877">error</span>&nbsp;<span class="op" id="4903883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4903886">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903925">if</span>&nbsp;<span class="ident" id="4903928">d</span><span class="op" id="4903929">.</span><span class="ident" id="4903930">bytes</span><span class="op" id="4903935">.</span><span class="ident" id="4903936">nUnreadable</span>&nbsp;<span class="op" id="4903948">!=</span>&nbsp;<span class="num" id="4903951">0</span>&nbsp;<span class="op" id="4903953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903957">if</span>&nbsp;<span class="ident" id="4903960">d</span><span class="op" id="4903961">.</span><span class="ident" id="4903962">bits</span><span class="op" id="4903966">.</span><span class="ident" id="4903967">n</span>&nbsp;<span class="op" id="4903969">&gt;=</span>&nbsp;<span class="num" id="4903972">8</span>&nbsp;<span class="op" id="4903974">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903979">d</span><span class="op" id="4903980">.</span><span class="ident" id="4903981">unreadByteStuffedByte</span><span class="op" id="4904002">(</span><span class="op" id="4904003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904011">d</span><span class="op" id="4904012">.</span><span class="ident" id="4904013">bytes</span><span class="op" id="4904018">.</span><span class="ident" id="4904019">nUnreadable</span>&nbsp;<span class="op" id="4904031">=</span>&nbsp;<span class="num" id="4904033">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904040">for</span>&nbsp;<span class="op" id="4904044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904048">m</span>&nbsp;<span class="op" id="4904050">:=</span>&nbsp;<span class="ident" id="4904053">d</span><span class="op" id="4904054">.</span><span class="ident" id="4904055">bytes</span><span class="op" id="4904060">.</span><span class="ident" id="4904061">j</span>&nbsp;<span class="op" id="4904063">-</span>&nbsp;<span class="ident" id="4904065">d</span><span class="op" id="4904066">.</span><span class="ident" id="4904067">bytes</span><span class="op" id="4904072">.</span><span class="ident" id="4904073">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904077">if</span>&nbsp;<span class="ident" id="4904080">m</span>&nbsp;<span class="op" id="4904082">&gt;</span>&nbsp;<span class="ident" id="4904084">n</span>&nbsp;<span class="op" id="4904086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904091">m</span>&nbsp;<span class="op" id="4904093">=</span>&nbsp;<span class="ident" id="4904095">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904099">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904103">d</span><span class="op" id="4904104">.</span><span class="ident" id="4904105">bytes</span><span class="op" id="4904110">.</span><span class="ident" id="4904111">i</span>&nbsp;<span class="op" id="4904113">+=</span>&nbsp;<span class="ident" id="4904116">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904120">n</span>&nbsp;<span class="op" id="4904122">-=</span>&nbsp;<span class="ident" id="4904125">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904129">if</span>&nbsp;<span class="ident" id="4904132">n</span>&nbsp;<span class="op" id="4904134">==</span>&nbsp;<span class="num" id="4904137">0</span>&nbsp;<span class="op" id="4904139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904144">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904152">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904156">if</span>&nbsp;<span class="ident" id="4904159">err</span>&nbsp;<span class="op" id="4904163">:=</span>&nbsp;<span class="ident" id="4904166">d</span><span class="op" id="4904167">.</span><span class="ident" id="4904168">fill</span><span class="op" id="4904172">(</span><span class="op" id="4904173">)</span><span class="op" id="4904174">;</span>&nbsp;<span class="ident" id="4904176">err</span>&nbsp;<span class="op" id="4904180">!=</span>&nbsp;<span class="builtintype" id="4904183">nil</span>&nbsp;<span class="op" id="4904187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904192">if</span>&nbsp;<span class="ident" id="4904195">err</span>&nbsp;<span class="op" id="4904199">==</span>&nbsp;<span class="ident" id="4904202">io</span><span class="op" id="4904204">.</span><span class="ident" id="4904205">EOF</span>&nbsp;<span class="op" id="4904209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904215">err</span>&nbsp;<span class="op" id="4904219">=</span>&nbsp;<span class="ident" id="4904221">io</span><span class="op" id="4904223">.</span><span class="ident" id="4904224">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904249">return</span>&nbsp;<span class="ident" id="4904256">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904268">return</span>&nbsp;<span class="builtintype" id="4904275">nil</span><br>
<span class="lineno"></span><span class="op" id="4904279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="4904282">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="4904313">func</span>&nbsp;<span class="op" id="4904318">(</span><span class="ident" id="4904319">d</span>&nbsp;<span class="op" id="4904321">*</span><span class="ident" id="4904322">decoder</span><span class="op" id="4904329">)</span>&nbsp;<span class="ident" id="4904331">processSOF</span><span class="op" id="4904341">(</span><span class="ident" id="4904342">n</span>&nbsp;<span class="builtintype" id="4904344">int</span><span class="op" id="4904347">)</span>&nbsp;<span class="builtintype" id="4904349">error</span>&nbsp;<span class="op" id="4904355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904358">switch</span>&nbsp;<span class="ident" id="4904365">n</span>&nbsp;<span class="op" id="4904367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904370">case</span>&nbsp;<span class="num" id="4904375">6</span>&nbsp;<span class="op" id="4904377">+</span>&nbsp;<span class="num" id="4904379">3</span><span class="op" id="4904380">*</span><span class="ident" id="4904381">nGrayComponent</span><span class="op" id="4904395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904399">d</span><span class="op" id="4904400">.</span><span class="ident" id="4904401">nComp</span>&nbsp;<span class="op" id="4904407">=</span>&nbsp;<span class="ident" id="4904409">nGrayComponent</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904425">case</span>&nbsp;<span class="num" id="4904430">6</span>&nbsp;<span class="op" id="4904432">+</span>&nbsp;<span class="num" id="4904434">3</span><span class="op" id="4904435">*</span><span class="ident" id="4904436">nColorComponent</span><span class="op" id="4904451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904455">d</span><span class="op" id="4904456">.</span><span class="ident" id="4904457">nComp</span>&nbsp;<span class="op" id="4904463">=</span>&nbsp;<span class="ident" id="4904465">nColorComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904482">default</span><span class="op" id="4904489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904493">return</span>&nbsp;<span class="ident" id="4904500">UnsupportedError</span><span class="op" id="4904516">(</span><span class="string" id="4904517">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4904539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904542">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904545">if</span>&nbsp;<span class="ident" id="4904548">err</span>&nbsp;<span class="op" id="4904552">:=</span>&nbsp;<span class="ident" id="4904555">d</span><span class="op" id="4904556">.</span><span class="ident" id="4904557">readFull</span><span class="op" id="4904565">(</span><span class="ident" id="4904566">d</span><span class="op" id="4904567">.</span><span class="ident" id="4904568">tmp</span><span class="op" id="4904571">[</span><span class="op" id="4904572">:</span><span class="ident" id="4904573">n</span><span class="op" id="4904574">]</span><span class="op" id="4904575">)</span><span class="op" id="4904576">;</span>&nbsp;<span class="ident" id="4904578">err</span>&nbsp;<span class="op" id="4904582">!=</span>&nbsp;<span class="builtintype" id="4904585">nil</span>&nbsp;<span class="op" id="4904589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904593">return</span>&nbsp;<span class="ident" id="4904600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4904608">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904645">if</span>&nbsp;<span class="ident" id="4904648">d</span><span class="op" id="4904649">.</span><span class="ident" id="4904650">tmp</span><span class="op" id="4904653">[</span><span class="num" id="4904654">0</span><span class="op" id="4904655">]</span>&nbsp;<span class="op" id="4904657">!=</span>&nbsp;<span class="num" id="4904660">8</span>&nbsp;<span class="op" id="4904662">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904666">return</span>&nbsp;<span class="ident" id="4904673">UnsupportedError</span><span class="op" id="4904689">(</span><span class="string" id="4904690">&#34;precision&#34;</span><span class="op" id="4904701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904707">d</span><span class="op" id="4904708">.</span><span class="ident" id="4904709">height</span>&nbsp;<span class="op" id="4904716">=</span>&nbsp;<span class="builtintype" id="4904718">int</span><span class="op" id="4904721">(</span><span class="ident" id="4904722">d</span><span class="op" id="4904723">.</span><span class="ident" id="4904724">tmp</span><span class="op" id="4904727">[</span><span class="num" id="4904728">1</span><span class="op" id="4904729">]</span><span class="op" id="4904730">)</span><span class="op" id="4904731">&lt;&lt;</span><span class="num" id="4904733">8</span>&nbsp;<span class="op" id="4904735">+</span>&nbsp;<span class="builtintype" id="4904737">int</span><span class="op" id="4904740">(</span><span class="ident" id="4904741">d</span><span class="op" id="4904742">.</span><span class="ident" id="4904743">tmp</span><span class="op" id="4904746">[</span><span class="num" id="4904747">2</span><span class="op" id="4904748">]</span><span class="op" id="4904749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904752">d</span><span class="op" id="4904753">.</span><span class="ident" id="4904754">width</span>&nbsp;<span class="op" id="4904760">=</span>&nbsp;<span class="builtintype" id="4904762">int</span><span class="op" id="4904765">(</span><span class="ident" id="4904766">d</span><span class="op" id="4904767">.</span><span class="ident" id="4904768">tmp</span><span class="op" id="4904771">[</span><span class="num" id="4904772">3</span><span class="op" id="4904773">]</span><span class="op" id="4904774">)</span><span class="op" id="4904775">&lt;&lt;</span><span class="num" id="4904777">8</span>&nbsp;<span class="op" id="4904779">+</span>&nbsp;<span class="builtintype" id="4904781">int</span><span class="op" id="4904784">(</span><span class="ident" id="4904785">d</span><span class="op" id="4904786">.</span><span class="ident" id="4904787">tmp</span><span class="op" id="4904790">[</span><span class="num" id="4904791">4</span><span class="op" id="4904792">]</span><span class="op" id="4904793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904796">if</span>&nbsp;<span class="builtintype" id="4904799">int</span><span class="op" id="4904802">(</span><span class="ident" id="4904803">d</span><span class="op" id="4904804">.</span><span class="ident" id="4904805">tmp</span><span class="op" id="4904808">[</span><span class="num" id="4904809">5</span><span class="op" id="4904810">]</span><span class="op" id="4904811">)</span>&nbsp;<span class="op" id="4904813">!=</span>&nbsp;<span class="ident" id="4904816">d</span><span class="op" id="4904817">.</span><span class="ident" id="4904818">nComp</span>&nbsp;<span class="op" id="4904824">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904828">return</span>&nbsp;<span class="ident" id="4904835">UnsupportedError</span><span class="op" id="4904851">(</span><span class="string" id="4904852">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="4904894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904900">for</span>&nbsp;<span class="ident" id="4904904">i</span>&nbsp;<span class="op" id="4904906">:=</span>&nbsp;<span class="num" id="4904909">0</span><span class="op" id="4904910">;</span>&nbsp;<span class="ident" id="4904912">i</span>&nbsp;<span class="op" id="4904914">&lt;</span>&nbsp;<span class="ident" id="4904916">d</span><span class="op" id="4904917">.</span><span class="ident" id="4904918">nComp</span><span class="op" id="4904923">;</span>&nbsp;<span class="ident" id="4904925">i</span><span class="op" id="4904926">++</span>&nbsp;<span class="op" id="4904929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904933">d</span><span class="op" id="4904934">.</span><span class="ident" id="4904935">comp</span><span class="op" id="4904939">[</span><span class="ident" id="4904940">i</span><span class="op" id="4904941">]</span><span class="op" id="4904942">.</span><span class="ident" id="4904943">c</span>&nbsp;<span class="op" id="4904945">=</span>&nbsp;<span class="ident" id="4904947">d</span><span class="op" id="4904948">.</span><span class="ident" id="4904949">tmp</span><span class="op" id="4904952">[</span><span class="num" id="4904953">6</span><span class="op" id="4904954">+</span><span class="num" id="4904955">3</span><span class="op" id="4904956">*</span><span class="ident" id="4904957">i</span><span class="op" id="4904958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904962">d</span><span class="op" id="4904963">.</span><span class="ident" id="4904964">comp</span><span class="op" id="4904968">[</span><span class="ident" id="4904969">i</span><span class="op" id="4904970">]</span><span class="op" id="4904971">.</span><span class="ident" id="4904972">tq</span>&nbsp;<span class="op" id="4904975">=</span>&nbsp;<span class="ident" id="4904977">d</span><span class="op" id="4904978">.</span><span class="ident" id="4904979">tmp</span><span class="op" id="4904982">[</span><span class="num" id="4904983">8</span><span class="op" id="4904984">+</span><span class="num" id="4904985">3</span><span class="op" id="4904986">*</span><span class="ident" id="4904987">i</span><span class="op" id="4904988">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904992">if</span>&nbsp;<span class="ident" id="4904995">d</span><span class="op" id="4904996">.</span><span class="ident" id="4904997">nComp</span>&nbsp;<span class="op" id="4905003">==</span>&nbsp;<span class="ident" id="4905006">nGrayComponent</span>&nbsp;<span class="op" id="4905021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905026">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905100">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905173">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905249">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905326">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905402">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905479">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905555">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905631">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905708">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905781">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905812">d</span><span class="op" id="4905813">.</span><span class="ident" id="4905814">comp</span><span class="op" id="4905818">[</span><span class="ident" id="4905819">i</span><span class="op" id="4905820">]</span><span class="op" id="4905821">.</span><span class="ident" id="4905822">h</span>&nbsp;<span class="op" id="4905824">=</span>&nbsp;<span class="num" id="4905826">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905831">d</span><span class="op" id="4905832">.</span><span class="ident" id="4905833">comp</span><span class="op" id="4905837">[</span><span class="ident" id="4905838">i</span><span class="op" id="4905839">]</span><span class="op" id="4905840">.</span><span class="ident" id="4905841">v</span>&nbsp;<span class="op" id="4905843">=</span>&nbsp;<span class="num" id="4905845">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4905850">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4905861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905865">hv</span>&nbsp;<span class="op" id="4905868">:=</span>&nbsp;<span class="ident" id="4905871">d</span><span class="op" id="4905872">.</span><span class="ident" id="4905873">tmp</span><span class="op" id="4905876">[</span><span class="num" id="4905877">7</span><span class="op" id="4905878">+</span><span class="num" id="4905879">3</span><span class="op" id="4905880">*</span><span class="ident" id="4905881">i</span><span class="op" id="4905882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905886">d</span><span class="op" id="4905887">.</span><span class="ident" id="4905888">comp</span><span class="op" id="4905892">[</span><span class="ident" id="4905893">i</span><span class="op" id="4905894">]</span><span class="op" id="4905895">.</span><span class="ident" id="4905896">h</span>&nbsp;<span class="op" id="4905898">=</span>&nbsp;<span class="builtintype" id="4905900">int</span><span class="op" id="4905903">(</span><span class="ident" id="4905904">hv</span>&nbsp;<span class="op" id="4905907">&gt;&gt;</span>&nbsp;<span class="num" id="4905910">4</span><span class="op" id="4905911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905915">d</span><span class="op" id="4905916">.</span><span class="ident" id="4905917">comp</span><span class="op" id="4905921">[</span><span class="ident" id="4905922">i</span><span class="op" id="4905923">]</span><span class="op" id="4905924">.</span><span class="ident" id="4905925">v</span>&nbsp;<span class="op" id="4905927">=</span>&nbsp;<span class="builtintype" id="4905929">int</span><span class="op" id="4905932">(</span><span class="ident" id="4905933">hv</span>&nbsp;<span class="op" id="4905936">&amp;</span>&nbsp;<span class="num" id="4905938">0x0f</span><span class="op" id="4905942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905946">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906021">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906093">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906168">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906225">if</span>&nbsp;<span class="ident" id="4906228">i</span>&nbsp;<span class="op" id="4906230">==</span>&nbsp;<span class="num" id="4906233">0</span>&nbsp;<span class="op" id="4906235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906240">if</span>&nbsp;<span class="ident" id="4906243">hv</span>&nbsp;<span class="op" id="4906246">!=</span>&nbsp;<span class="num" id="4906249">0x11</span>&nbsp;<span class="op" id="4906254">&amp;&amp;</span>&nbsp;<span class="ident" id="4906257">hv</span>&nbsp;<span class="op" id="4906260">!=</span>&nbsp;<span class="num" id="4906263">0x21</span>&nbsp;<span class="op" id="4906268">&amp;&amp;</span>&nbsp;<span class="ident" id="4906271">hv</span>&nbsp;<span class="op" id="4906274">!=</span>&nbsp;<span class="num" id="4906277">0x22</span>&nbsp;<span class="op" id="4906282">&amp;&amp;</span>&nbsp;<span class="ident" id="4906285">hv</span>&nbsp;<span class="op" id="4906288">!=</span>&nbsp;<span class="num" id="4906291">0x12</span>&nbsp;<span class="op" id="4906296">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906302">return</span>&nbsp;<span class="ident" id="4906309">UnsupportedError</span><span class="op" id="4906325">(</span><span class="string" id="4906326">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="4906356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906365">}</span>&nbsp;<span class="keyword" id="4906367">else</span>&nbsp;<span class="keyword" id="4906372">if</span>&nbsp;<span class="ident" id="4906375">hv</span>&nbsp;<span class="op" id="4906378">!=</span>&nbsp;<span class="num" id="4906381">0x11</span>&nbsp;<span class="op" id="4906386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906391">return</span>&nbsp;<span class="ident" id="4906398">UnsupportedError</span><span class="op" id="4906414">(</span><span class="string" id="4906415">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="4906445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906449">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906455">return</span>&nbsp;<span class="builtintype" id="4906462">nil</span><br>
<span class="lineno"></span><span class="op" id="4906466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4906469">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="4906502">func</span>&nbsp;<span class="op" id="4906507">(</span><span class="ident" id="4906508">d</span>&nbsp;<span class="op" id="4906510">*</span><span class="ident" id="4906511">decoder</span><span class="op" id="4906518">)</span>&nbsp;<span class="ident" id="4906520">processDQT</span><span class="op" id="4906530">(</span><span class="ident" id="4906531">n</span>&nbsp;<span class="builtintype" id="4906533">int</span><span class="op" id="4906536">)</span>&nbsp;<span class="builtintype" id="4906538">error</span>&nbsp;<span class="op" id="4906544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906547">const</span>&nbsp;<span class="ident" id="4906553">qtLength</span>&nbsp;<span class="op" id="4906562">=</span>&nbsp;<span class="num" id="4906564">1</span>&nbsp;<span class="op" id="4906566">+</span>&nbsp;<span class="ident" id="4906568">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906579">for</span>&nbsp;<span class="op" id="4906583">;</span>&nbsp;<span class="ident" id="4906585">n</span>&nbsp;<span class="op" id="4906587">&gt;=</span>&nbsp;<span class="ident" id="4906590">qtLength</span><span class="op" id="4906598">;</span>&nbsp;<span class="ident" id="4906600">n</span>&nbsp;<span class="op" id="4906602">-=</span>&nbsp;<span class="ident" id="4906605">qtLength</span>&nbsp;<span class="op" id="4906614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906618">if</span>&nbsp;<span class="ident" id="4906621">err</span>&nbsp;<span class="op" id="4906625">:=</span>&nbsp;<span class="ident" id="4906628">d</span><span class="op" id="4906629">.</span><span class="ident" id="4906630">readFull</span><span class="op" id="4906638">(</span><span class="ident" id="4906639">d</span><span class="op" id="4906640">.</span><span class="ident" id="4906641">tmp</span><span class="op" id="4906644">[</span><span class="op" id="4906645">:</span><span class="ident" id="4906646">qtLength</span><span class="op" id="4906654">]</span><span class="op" id="4906655">)</span><span class="op" id="4906656">;</span>&nbsp;<span class="ident" id="4906658">err</span>&nbsp;<span class="op" id="4906662">!=</span>&nbsp;<span class="builtintype" id="4906665">nil</span>&nbsp;<span class="op" id="4906669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906674">return</span>&nbsp;<span class="ident" id="4906681">err</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906691">pq</span>&nbsp;<span class="op" id="4906694">:=</span>&nbsp;<span class="ident" id="4906697">d</span><span class="op" id="4906698">.</span><span class="ident" id="4906699">tmp</span><span class="op" id="4906702">[</span><span class="num" id="4906703">0</span><span class="op" id="4906704">]</span>&nbsp;<span class="op" id="4906706">&gt;&gt;</span>&nbsp;<span class="num" id="4906709">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906713">if</span>&nbsp;<span class="ident" id="4906716">pq</span>&nbsp;<span class="op" id="4906719">!=</span>&nbsp;<span class="num" id="4906722">0</span>&nbsp;<span class="op" id="4906724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906729">return</span>&nbsp;<span class="ident" id="4906736">UnsupportedError</span><span class="op" id="4906752">(</span><span class="string" id="4906753">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="4906767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906771">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906775">tq</span>&nbsp;<span class="op" id="4906778">:=</span>&nbsp;<span class="ident" id="4906781">d</span><span class="op" id="4906782">.</span><span class="ident" id="4906783">tmp</span><span class="op" id="4906786">[</span><span class="num" id="4906787">0</span><span class="op" id="4906788">]</span>&nbsp;<span class="op" id="4906790">&amp;</span>&nbsp;<span class="num" id="4906792">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906799">if</span>&nbsp;<span class="ident" id="4906802">tq</span>&nbsp;<span class="op" id="4906805">&gt;</span>&nbsp;<span class="ident" id="4906807">maxTq</span>&nbsp;<span class="op" id="4906813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906818">return</span>&nbsp;<span class="ident" id="4906825">FormatError</span><span class="op" id="4906836">(</span><span class="string" id="4906837">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="4906851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906859">for</span>&nbsp;<span class="ident" id="4906863">i</span>&nbsp;<span class="op" id="4906865">:=</span>&nbsp;<span class="keyword" id="4906868">range</span>&nbsp;<span class="ident" id="4906874">d</span><span class="op" id="4906875">.</span><span class="ident" id="4906876">quant</span><span class="op" id="4906881">[</span><span class="ident" id="4906882">tq</span><span class="op" id="4906884">]</span>&nbsp;<span class="op" id="4906886">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906891">d</span><span class="op" id="4906892">.</span><span class="ident" id="4906893">quant</span><span class="op" id="4906898">[</span><span class="ident" id="4906899">tq</span><span class="op" id="4906901">]</span><span class="op" id="4906902">[</span><span class="ident" id="4906903">i</span><span class="op" id="4906904">]</span>&nbsp;<span class="op" id="4906906">=</span>&nbsp;<span class="builtintype" id="4906908">int32</span><span class="op" id="4906913">(</span><span class="ident" id="4906914">d</span><span class="op" id="4906915">.</span><span class="ident" id="4906916">tmp</span><span class="op" id="4906919">[</span><span class="ident" id="4906920">i</span><span class="op" id="4906921">+</span><span class="num" id="4906922">1</span><span class="op" id="4906923">]</span><span class="op" id="4906924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906934">if</span>&nbsp;<span class="ident" id="4906937">n</span>&nbsp;<span class="op" id="4906939">!=</span>&nbsp;<span class="num" id="4906942">0</span>&nbsp;<span class="op" id="4906944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906948">return</span>&nbsp;<span class="ident" id="4906955">FormatError</span><span class="op" id="4906966">(</span><span class="string" id="4906967">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4906989">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906995">return</span>&nbsp;<span class="builtintype" id="4907002">nil</span><br>
<span class="lineno"></span><span class="op" id="4907006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4907009">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="4907042">func</span>&nbsp;<span class="op" id="4907047">(</span><span class="ident" id="4907048">d</span>&nbsp;<span class="op" id="4907050">*</span><span class="ident" id="4907051">decoder</span><span class="op" id="4907058">)</span>&nbsp;<span class="ident" id="4907060">processDRI</span><span class="op" id="4907070">(</span><span class="ident" id="4907071">n</span>&nbsp;<span class="builtintype" id="4907073">int</span><span class="op" id="4907076">)</span>&nbsp;<span class="builtintype" id="4907078">error</span>&nbsp;<span class="op" id="4907084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907087">if</span>&nbsp;<span class="ident" id="4907090">n</span>&nbsp;<span class="op" id="4907092">!=</span>&nbsp;<span class="num" id="4907095">2</span>&nbsp;<span class="op" id="4907097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907101">return</span>&nbsp;<span class="ident" id="4907108">FormatError</span><span class="op" id="4907119">(</span><span class="string" id="4907120">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4907142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907148">if</span>&nbsp;<span class="ident" id="4907151">err</span>&nbsp;<span class="op" id="4907155">:=</span>&nbsp;<span class="ident" id="4907158">d</span><span class="op" id="4907159">.</span><span class="ident" id="4907160">readFull</span><span class="op" id="4907168">(</span><span class="ident" id="4907169">d</span><span class="op" id="4907170">.</span><span class="ident" id="4907171">tmp</span><span class="op" id="4907174">[</span><span class="op" id="4907175">:</span><span class="num" id="4907176">2</span><span class="op" id="4907177">]</span><span class="op" id="4907178">)</span><span class="op" id="4907179">;</span>&nbsp;<span class="ident" id="4907181">err</span>&nbsp;<span class="op" id="4907185">!=</span>&nbsp;<span class="builtintype" id="4907188">nil</span>&nbsp;<span class="op" id="4907192">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907196">return</span>&nbsp;<span class="ident" id="4907203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907211">d</span><span class="op" id="4907212">.</span><span class="ident" id="4907213">ri</span>&nbsp;<span class="op" id="4907216">=</span>&nbsp;<span class="builtintype" id="4907218">int</span><span class="op" id="4907221">(</span><span class="ident" id="4907222">d</span><span class="op" id="4907223">.</span><span class="ident" id="4907224">tmp</span><span class="op" id="4907227">[</span><span class="num" id="4907228">0</span><span class="op" id="4907229">]</span><span class="op" id="4907230">)</span><span class="op" id="4907231">&lt;&lt;</span><span class="num" id="4907233">8</span>&nbsp;<span class="op" id="4907235">+</span>&nbsp;<span class="builtintype" id="4907237">int</span><span class="op" id="4907240">(</span><span class="ident" id="4907241">d</span><span class="op" id="4907242">.</span><span class="ident" id="4907243">tmp</span><span class="op" id="4907246">[</span><span class="num" id="4907247">1</span><span class="op" id="4907248">]</span><span class="op" id="4907249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907252">return</span>&nbsp;<span class="builtintype" id="4907259">nil</span><br>
<span class="lineno"></span><span class="op" id="4907263">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="4907266">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="4907336">func</span>&nbsp;<span class="op" id="4907341">(</span><span class="ident" id="4907342">d</span>&nbsp;<span class="op" id="4907344">*</span><span class="ident" id="4907345">decoder</span><span class="op" id="4907352">)</span>&nbsp;<span class="ident" id="4907354">decode</span><span class="op" id="4907360">(</span><span class="ident" id="4907361">r</span>&nbsp;<span class="ident" id="4907363">io</span><span class="op" id="4907365">.</span><span class="ident" id="4907366">Reader</span><span class="op" id="4907372">,</span>&nbsp;<span class="ident" id="4907374">configOnly</span>&nbsp;<span class="builtintype" id="4907385">bool</span><span class="op" id="4907389">)</span>&nbsp;<span class="op" id="4907391">(</span><span class="ident" id="4907392">image</span><span class="op" id="4907397">.</span><span class="ident" id="4907398">Image</span><span class="op" id="4907403">,</span>&nbsp;<span class="builtintype" id="4907405">error</span><span class="op" id="4907410">)</span>&nbsp;<span class="op" id="4907412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907415">d</span><span class="op" id="4907416">.</span><span class="ident" id="4907417">r</span>&nbsp;<span class="op" id="4907419">=</span>&nbsp;<span class="ident" id="4907421">r</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907425">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907466">if</span>&nbsp;<span class="ident" id="4907469">err</span>&nbsp;<span class="op" id="4907473">:=</span>&nbsp;<span class="ident" id="4907476">d</span><span class="op" id="4907477">.</span><span class="ident" id="4907478">readFull</span><span class="op" id="4907486">(</span><span class="ident" id="4907487">d</span><span class="op" id="4907488">.</span><span class="ident" id="4907489">tmp</span><span class="op" id="4907492">[</span><span class="op" id="4907493">:</span><span class="num" id="4907494">2</span><span class="op" id="4907495">]</span><span class="op" id="4907496">)</span><span class="op" id="4907497">;</span>&nbsp;<span class="ident" id="4907499">err</span>&nbsp;<span class="op" id="4907503">!=</span>&nbsp;<span class="builtintype" id="4907506">nil</span>&nbsp;<span class="op" id="4907510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907514">return</span>&nbsp;<span class="builtintype" id="4907521">nil</span><span class="op" id="4907524">,</span>&nbsp;<span class="ident" id="4907526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907534">if</span>&nbsp;<span class="ident" id="4907537">d</span><span class="op" id="4907538">.</span><span class="ident" id="4907539">tmp</span><span class="op" id="4907542">[</span><span class="num" id="4907543">0</span><span class="op" id="4907544">]</span>&nbsp;<span class="op" id="4907546">!=</span>&nbsp;<span class="num" id="4907549">0xff</span>&nbsp;<span class="op" id="4907554">||</span>&nbsp;<span class="ident" id="4907557">d</span><span class="op" id="4907558">.</span><span class="ident" id="4907559">tmp</span><span class="op" id="4907562">[</span><span class="num" id="4907563">1</span><span class="op" id="4907564">]</span>&nbsp;<span class="op" id="4907566">!=</span>&nbsp;<span class="ident" id="4907569">soiMarker</span>&nbsp;<span class="op" id="4907579">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907583">return</span>&nbsp;<span class="builtintype" id="4907590">nil</span><span class="op" id="4907593">,</span>&nbsp;<span class="ident" id="4907595">FormatError</span><span class="op" id="4907606">(</span><span class="string" id="4907607">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="4907627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907634">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907700">for</span>&nbsp;<span class="op" id="4907704">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907708">err</span>&nbsp;<span class="op" id="4907712">:=</span>&nbsp;<span class="ident" id="4907715">d</span><span class="op" id="4907716">.</span><span class="ident" id="4907717">readFull</span><span class="op" id="4907725">(</span><span class="ident" id="4907726">d</span><span class="op" id="4907727">.</span><span class="ident" id="4907728">tmp</span><span class="op" id="4907731">[</span><span class="op" id="4907732">:</span><span class="num" id="4907733">2</span><span class="op" id="4907734">]</span><span class="op" id="4907735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907739">if</span>&nbsp;<span class="ident" id="4907742">err</span>&nbsp;<span class="op" id="4907746">!=</span>&nbsp;<span class="builtintype" id="4907749">nil</span>&nbsp;<span class="op" id="4907753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907758">return</span>&nbsp;<span class="builtintype" id="4907765">nil</span><span class="op" id="4907768">,</span>&nbsp;<span class="ident" id="4907770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907780">for</span>&nbsp;<span class="ident" id="4907784">d</span><span class="op" id="4907785">.</span><span class="ident" id="4907786">tmp</span><span class="op" id="4907789">[</span><span class="num" id="4907790">0</span><span class="op" id="4907791">]</span>&nbsp;<span class="op" id="4907793">!=</span>&nbsp;<span class="num" id="4907796">0xff</span>&nbsp;<span class="op" id="4907801">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907806">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907875">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907941">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908010">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908077">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908147">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908213">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908282">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908354">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908421">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908493">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908517">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908523">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908594">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908621">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908627">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908694">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908748">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908754">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908824">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908891">d</span><span class="op" id="4908892">.</span><span class="ident" id="4908893">tmp</span><span class="op" id="4908896">[</span><span class="num" id="4908897">0</span><span class="op" id="4908898">]</span>&nbsp;<span class="op" id="4908900">=</span>&nbsp;<span class="ident" id="4908902">d</span><span class="op" id="4908903">.</span><span class="ident" id="4908904">tmp</span><span class="op" id="4908907">[</span><span class="num" id="4908908">1</span><span class="op" id="4908909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908914">d</span><span class="op" id="4908915">.</span><span class="ident" id="4908916">tmp</span><span class="op" id="4908919">[</span><span class="num" id="4908920">1</span><span class="op" id="4908921">]</span><span class="op" id="4908922">,</span>&nbsp;<span class="ident" id="4908924">err</span>&nbsp;<span class="op" id="4908928">=</span>&nbsp;<span class="ident" id="4908930">d</span><span class="op" id="4908931">.</span><span class="ident" id="4908932">readByte</span><span class="op" id="4908940">(</span><span class="op" id="4908941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908946">if</span>&nbsp;<span class="ident" id="4908949">err</span>&nbsp;<span class="op" id="4908953">!=</span>&nbsp;<span class="builtintype" id="4908956">nil</span>&nbsp;<span class="op" id="4908960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908966">return</span>&nbsp;<span class="builtintype" id="4908973">nil</span><span class="op" id="4908976">,</span>&nbsp;<span class="ident" id="4908978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908985">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908993">marker</span>&nbsp;<span class="op" id="4909000">:=</span>&nbsp;<span class="ident" id="4909003">d</span><span class="op" id="4909004">.</span><span class="ident" id="4909005">tmp</span><span class="op" id="4909008">[</span><span class="num" id="4909009">1</span><span class="op" id="4909010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909014">if</span>&nbsp;<span class="ident" id="4909017">marker</span>&nbsp;<span class="op" id="4909024">==</span>&nbsp;<span class="num" id="4909027">0</span>&nbsp;<span class="op" id="4909029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909034">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909077">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909092">for</span>&nbsp;<span class="ident" id="4909096">marker</span>&nbsp;<span class="op" id="4909103">==</span>&nbsp;<span class="num" id="4909106">0xff</span>&nbsp;<span class="op" id="4909111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909116">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909190">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909256">marker</span><span class="op" id="4909262">,</span>&nbsp;<span class="ident" id="4909264">err</span>&nbsp;<span class="op" id="4909268">=</span>&nbsp;<span class="ident" id="4909270">d</span><span class="op" id="4909271">.</span><span class="ident" id="4909272">readByte</span><span class="op" id="4909280">(</span><span class="op" id="4909281">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909286">if</span>&nbsp;<span class="ident" id="4909289">err</span>&nbsp;<span class="op" id="4909293">!=</span>&nbsp;<span class="builtintype" id="4909296">nil</span>&nbsp;<span class="op" id="4909300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909306">return</span>&nbsp;<span class="builtintype" id="4909313">nil</span><span class="op" id="4909316">,</span>&nbsp;<span class="ident" id="4909318">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909333">if</span>&nbsp;<span class="ident" id="4909336">marker</span>&nbsp;<span class="op" id="4909343">==</span>&nbsp;<span class="ident" id="4909346">eoiMarker</span>&nbsp;<span class="op" id="4909356">{</span>&nbsp;<span class="comment" id="4909358">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909378">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909390">if</span>&nbsp;<span class="ident" id="4909393">rst0Marker</span>&nbsp;<span class="op" id="4909404">&lt;=</span>&nbsp;<span class="ident" id="4909407">marker</span>&nbsp;<span class="op" id="4909414">&amp;&amp;</span>&nbsp;<span class="ident" id="4909417">marker</span>&nbsp;<span class="op" id="4909424">&lt;=</span>&nbsp;<span class="ident" id="4909427">rst7Marker</span>&nbsp;<span class="op" id="4909438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909443">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909527">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909604">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909683">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909768">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909854">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909930">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909946">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4910029">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910104">if</span>&nbsp;<span class="ident" id="4910107">err</span>&nbsp;<span class="op" id="4910111">=</span>&nbsp;<span class="ident" id="4910113">d</span><span class="op" id="4910114">.</span><span class="ident" id="4910115">readFull</span><span class="op" id="4910123">(</span><span class="ident" id="4910124">d</span><span class="op" id="4910125">.</span><span class="ident" id="4910126">tmp</span><span class="op" id="4910129">[</span><span class="op" id="4910130">:</span><span class="num" id="4910131">2</span><span class="op" id="4910132">]</span><span class="op" id="4910133">)</span><span class="op" id="4910134">;</span>&nbsp;<span class="ident" id="4910136">err</span>&nbsp;<span class="op" id="4910140">!=</span>&nbsp;<span class="builtintype" id="4910143">nil</span>&nbsp;<span class="op" id="4910147">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910152">return</span>&nbsp;<span class="builtintype" id="4910159">nil</span><span class="op" id="4910162">,</span>&nbsp;<span class="ident" id="4910164">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910174">n</span>&nbsp;<span class="op" id="4910176">:=</span>&nbsp;<span class="builtintype" id="4910179">int</span><span class="op" id="4910182">(</span><span class="ident" id="4910183">d</span><span class="op" id="4910184">.</span><span class="ident" id="4910185">tmp</span><span class="op" id="4910188">[</span><span class="num" id="4910189">0</span><span class="op" id="4910190">]</span><span class="op" id="4910191">)</span><span class="op" id="4910192">&lt;&lt;</span><span class="num" id="4910194">8</span>&nbsp;<span class="op" id="4910196">+</span>&nbsp;<span class="builtintype" id="4910198">int</span><span class="op" id="4910201">(</span><span class="ident" id="4910202">d</span><span class="op" id="4910203">.</span><span class="ident" id="4910204">tmp</span><span class="op" id="4910207">[</span><span class="num" id="4910208">1</span><span class="op" id="4910209">]</span><span class="op" id="4910210">)</span>&nbsp;<span class="op" id="4910212">-</span>&nbsp;<span class="num" id="4910214">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910218">if</span>&nbsp;<span class="ident" id="4910221">n</span>&nbsp;<span class="op" id="4910223">&lt;</span>&nbsp;<span class="num" id="4910225">0</span>&nbsp;<span class="op" id="4910227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910232">return</span>&nbsp;<span class="builtintype" id="4910239">nil</span><span class="op" id="4910242">,</span>&nbsp;<span class="ident" id="4910244">FormatError</span><span class="op" id="4910255">(</span><span class="string" id="4910256">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="4910278">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910287">switch</span>&nbsp;<span class="op" id="4910294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910298">case</span>&nbsp;<span class="ident" id="4910303">marker</span>&nbsp;<span class="op" id="4910310">==</span>&nbsp;<span class="ident" id="4910313">sof0Marker</span>&nbsp;<span class="op" id="4910324">||</span>&nbsp;<span class="ident" id="4910327">marker</span>&nbsp;<span class="op" id="4910334">==</span>&nbsp;<span class="ident" id="4910337">sof2Marker</span><span class="op" id="4910347">:</span>&nbsp;<span class="comment" id="4910349">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910371">d</span><span class="op" id="4910372">.</span><span class="ident" id="4910373">progressive</span>&nbsp;<span class="op" id="4910385">=</span>&nbsp;<span class="ident" id="4910387">marker</span>&nbsp;<span class="op" id="4910394">==</span>&nbsp;<span class="ident" id="4910397">sof2Marker</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910411">err</span>&nbsp;<span class="op" id="4910415">=</span>&nbsp;<span class="ident" id="4910417">d</span><span class="op" id="4910418">.</span><span class="ident" id="4910419">processSOF</span><span class="op" id="4910429">(</span><span class="ident" id="4910430">n</span><span class="op" id="4910431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910436">if</span>&nbsp;<span class="ident" id="4910439">configOnly</span>&nbsp;<span class="op" id="4910450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910456">return</span>&nbsp;<span class="builtintype" id="4910463">nil</span><span class="op" id="4910466">,</span>&nbsp;<span class="ident" id="4910468">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910479">case</span>&nbsp;<span class="ident" id="4910484">marker</span>&nbsp;<span class="op" id="4910491">==</span>&nbsp;<span class="ident" id="4910494">dhtMarker</span><span class="op" id="4910503">:</span>&nbsp;<span class="comment" id="4910505">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910533">err</span>&nbsp;<span class="op" id="4910537">=</span>&nbsp;<span class="ident" id="4910539">d</span><span class="op" id="4910540">.</span><span class="ident" id="4910541">processDHT</span><span class="op" id="4910551">(</span><span class="ident" id="4910552">n</span><span class="op" id="4910553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910557">case</span>&nbsp;<span class="ident" id="4910562">marker</span>&nbsp;<span class="op" id="4910569">==</span>&nbsp;<span class="ident" id="4910572">dqtMarker</span><span class="op" id="4910581">:</span>&nbsp;<span class="comment" id="4910583">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910616">err</span>&nbsp;<span class="op" id="4910620">=</span>&nbsp;<span class="ident" id="4910622">d</span><span class="op" id="4910623">.</span><span class="ident" id="4910624">processDQT</span><span class="op" id="4910634">(</span><span class="ident" id="4910635">n</span><span class="op" id="4910636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910640">case</span>&nbsp;<span class="ident" id="4910645">marker</span>&nbsp;<span class="op" id="4910652">==</span>&nbsp;<span class="ident" id="4910655">sosMarker</span><span class="op" id="4910664">:</span>&nbsp;<span class="comment" id="4910666">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910687">err</span>&nbsp;<span class="op" id="4910691">=</span>&nbsp;<span class="ident" id="4910693">d</span><span class="op" id="4910694">.</span><span class="ident" id="4910695">processSOS</span><span class="op" id="4910705">(</span><span class="ident" id="4910706">n</span><span class="op" id="4910707">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910711">case</span>&nbsp;<span class="ident" id="4910716">marker</span>&nbsp;<span class="op" id="4910723">==</span>&nbsp;<span class="ident" id="4910726">driMarker</span><span class="op" id="4910735">:</span>&nbsp;<span class="comment" id="4910737">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910768">err</span>&nbsp;<span class="op" id="4910772">=</span>&nbsp;<span class="ident" id="4910774">d</span><span class="op" id="4910775">.</span><span class="ident" id="4910776">processDRI</span><span class="op" id="4910786">(</span><span class="ident" id="4910787">n</span><span class="op" id="4910788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910792">case</span>&nbsp;<span class="ident" id="4910797">app0Marker</span>&nbsp;<span class="op" id="4910808">&lt;=</span>&nbsp;<span class="ident" id="4910811">marker</span>&nbsp;<span class="op" id="4910818">&amp;&amp;</span>&nbsp;<span class="ident" id="4910821">marker</span>&nbsp;<span class="op" id="4910828">&lt;=</span>&nbsp;<span class="ident" id="4910831">app15Marker</span>&nbsp;<span class="op" id="4910843">||</span>&nbsp;<span class="ident" id="4910846">marker</span>&nbsp;<span class="op" id="4910853">==</span>&nbsp;<span class="ident" id="4910856">comMarker</span><span class="op" id="4910865">:</span>&nbsp;<span class="comment" id="4910867">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910907">err</span>&nbsp;<span class="op" id="4910911">=</span>&nbsp;<span class="ident" id="4910913">d</span><span class="op" id="4910914">.</span><span class="ident" id="4910915">ignore</span><span class="op" id="4910921">(</span><span class="ident" id="4910922">n</span><span class="op" id="4910923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910927">default</span><span class="op" id="4910934">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910939">err</span>&nbsp;<span class="op" id="4910943">=</span>&nbsp;<span class="ident" id="4910945">UnsupportedError</span><span class="op" id="4910961">(</span><span class="string" id="4910962">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="4910978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910986">if</span>&nbsp;<span class="ident" id="4910989">err</span>&nbsp;<span class="op" id="4910993">!=</span>&nbsp;<span class="builtintype" id="4910996">nil</span>&nbsp;<span class="op" id="4911000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911005">return</span>&nbsp;<span class="builtintype" id="4911012">nil</span><span class="op" id="4911015">,</span>&nbsp;<span class="ident" id="4911017">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911023">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911029">if</span>&nbsp;<span class="ident" id="4911032">d</span><span class="op" id="4911033">.</span><span class="ident" id="4911034">img1</span>&nbsp;<span class="op" id="4911039">!=</span>&nbsp;<span class="builtintype" id="4911042">nil</span>&nbsp;<span class="op" id="4911046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911050">return</span>&nbsp;<span class="ident" id="4911057">d</span><span class="op" id="4911058">.</span><span class="ident" id="4911059">img1</span><span class="op" id="4911063">,</span>&nbsp;<span class="builtintype" id="4911065">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911073">if</span>&nbsp;<span class="ident" id="4911076">d</span><span class="op" id="4911077">.</span><span class="ident" id="4911078">img3</span>&nbsp;<span class="op" id="4911083">!=</span>&nbsp;<span class="builtintype" id="4911086">nil</span>&nbsp;<span class="op" id="4911090">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911094">return</span>&nbsp;<span class="ident" id="4911101">d</span><span class="op" id="4911102">.</span><span class="ident" id="4911103">img3</span><span class="op" id="4911107">,</span>&nbsp;<span class="builtintype" id="4911109">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911117">return</span>&nbsp;<span class="builtintype" id="4911124">nil</span><span class="op" id="4911127">,</span>&nbsp;<span class="ident" id="4911129">FormatError</span><span class="op" id="4911140">(</span><span class="string" id="4911141">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="4911161">)</span><br>
<span class="lineno"></span><span class="op" id="4911163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="4911166">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="4911236">func</span>&nbsp;<span class="ident" id="4911241">Decode</span><span class="op" id="4911247">(</span><span class="ident" id="4911248">r</span>&nbsp;<span class="ident" id="4911250">io</span><span class="op" id="4911252">.</span><span class="ident" id="4911253">Reader</span><span class="op" id="4911259">)</span>&nbsp;<span class="op" id="4911261">(</span><span class="ident" id="4911262">image</span><span class="op" id="4911267">.</span><span class="ident" id="4911268">Image</span><span class="op" id="4911273">,</span>&nbsp;<span class="builtintype" id="4911275">error</span><span class="op" id="4911280">)</span>&nbsp;<span class="op" id="4911282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911285">var</span>&nbsp;<span class="ident" id="4911289">d</span>&nbsp;<span class="ident" id="4911291">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911300">return</span>&nbsp;<span class="ident" id="4911307">d</span><span class="op" id="4911308">.</span><span class="ident" id="4911309">decode</span><span class="op" id="4911315">(</span><span class="ident" id="4911316">r</span><span class="op" id="4911317">,</span>&nbsp;<span class="builtintype" id="4911319">false</span><span class="op" id="4911324">)</span><br>
<span class="lineno"></span><span class="op" id="4911326">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="4911329">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4911408">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4911438">func</span>&nbsp;<span class="ident" id="4911443">DecodeConfig</span><span class="op" id="4911455">(</span><span class="ident" id="4911456">r</span>&nbsp;<span class="ident" id="4911458">io</span><span class="op" id="4911460">.</span><span class="ident" id="4911461">Reader</span><span class="op" id="4911467">)</span>&nbsp;<span class="op" id="4911469">(</span><span class="ident" id="4911470">image</span><span class="op" id="4911475">.</span><span class="ident" id="4911476">Config</span><span class="op" id="4911482">,</span>&nbsp;<span class="builtintype" id="4911484">error</span><span class="op" id="4911489">)</span>&nbsp;<span class="op" id="4911491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911494">var</span>&nbsp;<span class="ident" id="4911498">d</span>&nbsp;<span class="ident" id="4911500">decoder</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911509">if</span>&nbsp;<span class="ident" id="4911512">_</span><span class="op" id="4911513">,</span>&nbsp;<span class="ident" id="4911515">err</span>&nbsp;<span class="op" id="4911519">:=</span>&nbsp;<span class="ident" id="4911522">d</span><span class="op" id="4911523">.</span><span class="ident" id="4911524">decode</span><span class="op" id="4911530">(</span><span class="ident" id="4911531">r</span><span class="op" id="4911532">,</span>&nbsp;<span class="builtintype" id="4911534">true</span><span class="op" id="4911538">)</span><span class="op" id="4911539">;</span>&nbsp;<span class="ident" id="4911541">err</span>&nbsp;<span class="op" id="4911545">!=</span>&nbsp;<span class="builtintype" id="4911548">nil</span>&nbsp;<span class="op" id="4911552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911556">return</span>&nbsp;<span class="ident" id="4911563">image</span><span class="op" id="4911568">.</span><span class="ident" id="4911569">Config</span><span class="op" id="4911575">{</span><span class="op" id="4911576">}</span><span class="op" id="4911577">,</span>&nbsp;<span class="ident" id="4911579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911587">switch</span>&nbsp;<span class="ident" id="4911594">d</span><span class="op" id="4911595">.</span><span class="ident" id="4911596">nComp</span>&nbsp;<span class="op" id="4911602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911605">case</span>&nbsp;<span class="ident" id="4911610">nGrayComponent</span><span class="op" id="4911624">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911628">return</span>&nbsp;<span class="ident" id="4911635">image</span><span class="op" id="4911640">.</span><span class="ident" id="4911641">Config</span><span class="op" id="4911647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911652">ColorModel</span><span class="op" id="4911662">:</span>&nbsp;<span class="ident" id="4911664">color</span><span class="op" id="4911669">.</span><span class="ident" id="4911670">GrayModel</span><span class="op" id="4911679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911684">Width</span><span class="op" id="4911689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911696">d</span><span class="op" id="4911697">.</span><span class="ident" id="4911698">width</span><span class="op" id="4911703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911708">Height</span><span class="op" id="4911714">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911720">d</span><span class="op" id="4911721">.</span><span class="ident" id="4911722">height</span><span class="op" id="4911728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911732">}</span><span class="op" id="4911733">,</span>&nbsp;<span class="builtintype" id="4911735">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911740">case</span>&nbsp;<span class="ident" id="4911745">nColorComponent</span><span class="op" id="4911760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911764">return</span>&nbsp;<span class="ident" id="4911771">image</span><span class="op" id="4911776">.</span><span class="ident" id="4911777">Config</span><span class="op" id="4911783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911788">ColorModel</span><span class="op" id="4911798">:</span>&nbsp;<span class="ident" id="4911800">color</span><span class="op" id="4911805">.</span><span class="ident" id="4911806">YCbCrModel</span><span class="op" id="4911816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911821">Width</span><span class="op" id="4911826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911833">d</span><span class="op" id="4911834">.</span><span class="ident" id="4911835">width</span><span class="op" id="4911840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911845">Height</span><span class="op" id="4911851">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911857">d</span><span class="op" id="4911858">.</span><span class="ident" id="4911859">height</span><span class="op" id="4911865">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911869">}</span><span class="op" id="4911870">,</span>&nbsp;<span class="builtintype" id="4911872">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911880">return</span>&nbsp;<span class="ident" id="4911887">image</span><span class="op" id="4911892">.</span><span class="ident" id="4911893">Config</span><span class="op" id="4911899">{</span><span class="op" id="4911900">}</span><span class="op" id="4911901">,</span>&nbsp;<span class="ident" id="4911903">FormatError</span><span class="op" id="4911914">(</span><span class="string" id="4911915">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="4911935">)</span><br>
<span class="lineno"></span><span class="op" id="4911937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="4911940">func</span>&nbsp;<span class="ident" id="4911945">init</span><span class="op" id="4911949">(</span><span class="op" id="4911950">)</span>&nbsp;<span class="op" id="4911952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911955">image</span><span class="op" id="4911960">.</span><span class="ident" id="4911961">RegisterFormat</span><span class="op" id="4911975">(</span><span class="string" id="4911976">&#34;jpeg&#34;</span><span class="op" id="4911982">,</span>&nbsp;<span class="string" id="4911984">&#34;\xff\xd8&#34;</span><span class="op" id="4911994">,</span>&nbsp;<span class="ident" id="4911996">Decode</span><span class="op" id="4912002">,</span>&nbsp;<span class="ident" id="4912004">DecodeConfig</span><span class="op" id="4912016">)</span><br>
<span class="lineno"></span><span class="op" id="4912018">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
