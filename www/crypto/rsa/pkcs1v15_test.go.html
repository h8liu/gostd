<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8192763">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8192818">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8192872">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8192923">package</span>&nbsp;<span class="ident" id="8192931">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192936">import</span>&nbsp;<span class="op" id="8192943">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192946">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192955">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192965">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192980">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192995">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193014">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193030">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193036">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193048">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193059">&#34;testing/quick&#34;</span><br>
<span class="lineno"></span><span class="op" id="8193075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8193078">func</span>&nbsp;<span class="ident" id="8193083">decodeBase64</span><span class="op" id="8193095">(</span><span class="ident" id="8193096">in</span>&nbsp;<span class="builtintype" id="8193099">string</span><span class="op" id="8193105">)</span>&nbsp;<span class="op" id="8193107">[</span><span class="op" id="8193108">]</span><span class="builtintype" id="8193109">byte</span>&nbsp;<span class="op" id="8193114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193117">out</span>&nbsp;<span class="op" id="8193121">:=</span>&nbsp;<span class="builtinfunc" id="8193124">make</span><span class="op" id="8193128">(</span><span class="op" id="8193129">[</span><span class="op" id="8193130">]</span><span class="builtintype" id="8193131">byte</span><span class="op" id="8193135">,</span>&nbsp;<span class="ident" id="8193137">base64</span><span class="op" id="8193143">.</span><span class="ident" id="8193144">StdEncoding</span><span class="op" id="8193155">.</span><span class="ident" id="8193156">DecodedLen</span><span class="op" id="8193166">(</span><span class="builtinfunc" id="8193167">len</span><span class="op" id="8193170">(</span><span class="ident" id="8193171">in</span><span class="op" id="8193173">)</span><span class="op" id="8193174">)</span><span class="op" id="8193175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193178">n</span><span class="op" id="8193179">,</span>&nbsp;<span class="ident" id="8193181">err</span>&nbsp;<span class="op" id="8193185">:=</span>&nbsp;<span class="ident" id="8193188">base64</span><span class="op" id="8193194">.</span><span class="ident" id="8193195">StdEncoding</span><span class="op" id="8193206">.</span><span class="ident" id="8193207">Decode</span><span class="op" id="8193213">(</span><span class="ident" id="8193214">out</span><span class="op" id="8193217">,</span>&nbsp;<span class="op" id="8193219">[</span><span class="op" id="8193220">]</span><span class="builtintype" id="8193221">byte</span><span class="op" id="8193225">(</span><span class="ident" id="8193226">in</span><span class="op" id="8193228">)</span><span class="op" id="8193229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193232">if</span>&nbsp;<span class="ident" id="8193235">err</span>&nbsp;<span class="op" id="8193239">!=</span>&nbsp;<span class="ident" id="8193242">nil</span>&nbsp;<span class="op" id="8193246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193250">return</span>&nbsp;<span class="ident" id="8193257">nil</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193265">return</span>&nbsp;<span class="ident" id="8193272">out</span><span class="op" id="8193275">[</span><span class="num" id="8193276">0</span><span class="op" id="8193277">:</span><span class="ident" id="8193278">n</span><span class="op" id="8193279">]</span><br>
<span class="lineno"></span><span class="op" id="8193281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8193284">type</span>&nbsp;<span class="ident" id="8193289">DecryptPKCS1v15Test</span>&nbsp;<span class="keyword" id="8193309">struct</span>&nbsp;<span class="op" id="8193316">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193319">in</span><span class="op" id="8193321">,</span>&nbsp;<span class="ident" id="8193323">out</span>&nbsp;<span class="builtintype" id="8193327">string</span><br>
<span class="lineno"></span><span class="op" id="8193334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8193337">//&nbsp;These&nbsp;test&nbsp;vectors&nbsp;were&nbsp;generated&nbsp;with&nbsp;`openssl&nbsp;rsautl&nbsp;-pkcs&nbsp;-encrypt`</span><br>
<span class="lineno"></span><span class="keyword" id="8193411">var</span>&nbsp;<span class="ident" id="8193415">decryptPKCS1v15Tests</span>&nbsp;<span class="op" id="8193436">=</span>&nbsp;<span class="op" id="8193438">[</span><span class="op" id="8193439">]</span><span class="ident" id="8193440">DecryptPKCS1v15Test</span><span class="op" id="8193459">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193466">&#34;gIcUIoVkD6ATMBk/u/nlCZCCWRKdkfjCgFdo35VpRXLduiKXhNz1XupLLzTXAybEq15juc+EgY5o0DHv/nt3yg==&#34;</span><span class="op" id="8193556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193560">&#34;x&#34;</span><span class="op" id="8193563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193566">}</span><span class="op" id="8193567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193570">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193574">&#34;Y7TOCSqofGhkRb+jaVRLzK8xw2cSo1IVES19utzv6hwvx+M8kFsoWQm5DzBeJCZTCVDPkTpavUuEbgp8hnUGDw==&#34;</span><span class="op" id="8193664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193668">&#34;testing.&#34;</span><span class="op" id="8193678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193681">}</span><span class="op" id="8193682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193689">&#34;arReP9DJtEVyV2Dg3dDp4c/PSk1O6lxkoJ8HcFupoRorBZG+7+1fDAwT1olNddFnQMjmkb8vxwmNMoTAT/BFjQ==&#34;</span><span class="op" id="8193779">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193783">&#34;testing.\n&#34;</span><span class="op" id="8193795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193798">}</span><span class="op" id="8193799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193806">&#34;WtaBXIoGC54+vH0NH0CHHE+dRDOsMc/6BrfFu2lEqcKL9+uDuWaf+Xj9mrbQCjjZcpQuX733zyok/jsnqe/Ftw==&#34;</span><span class="op" id="8193896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193900">&#34;01234567890123456789012345678901234567890123456789012&#34;</span><span class="op" id="8193955">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193958">}</span><span class="op" id="8193959">,</span><br>
<span class="lineno"></span><span class="op" id="8193961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8193964">func</span>&nbsp;<span class="ident" id="8193969">TestDecryptPKCS1v15</span><span class="op" id="8193988">(</span><span class="ident" id="8193989">t</span>&nbsp;<span class="op" id="8193991">*</span><span class="ident" id="8193992">testing</span><span class="op" id="8193999">.</span><span class="ident" id="8194000">T</span><span class="op" id="8194001">)</span>&nbsp;<span class="op" id="8194003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194006">for</span>&nbsp;<span class="ident" id="8194010">i</span><span class="op" id="8194011">,</span>&nbsp;<span class="ident" id="8194013">test</span>&nbsp;<span class="op" id="8194018">:=</span>&nbsp;<span class="keyword" id="8194021">range</span>&nbsp;<span class="ident" id="8194027">decryptPKCS1v15Tests</span>&nbsp;<span class="op" id="8194048">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194052">out</span><span class="op" id="8194055">,</span>&nbsp;<span class="ident" id="8194057">err</span>&nbsp;<span class="op" id="8194061">:=</span>&nbsp;<span class="ident" id="8194064">DecryptPKCS1v15</span><span class="op" id="8194079">(</span><span class="ident" id="8194080">nil</span><span class="op" id="8194083">,</span>&nbsp;<span class="ident" id="8194085">rsaPrivateKey</span><span class="op" id="8194098">,</span>&nbsp;<span class="ident" id="8194100">decodeBase64</span><span class="op" id="8194112">(</span><span class="ident" id="8194113">test</span><span class="op" id="8194117">.</span><span class="ident" id="8194118">in</span><span class="op" id="8194120">)</span><span class="op" id="8194121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194125">if</span>&nbsp;<span class="ident" id="8194128">err</span>&nbsp;<span class="op" id="8194132">!=</span>&nbsp;<span class="ident" id="8194135">nil</span>&nbsp;<span class="op" id="8194139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194144">t</span><span class="op" id="8194145">.</span><span class="ident" id="8194146">Errorf</span><span class="op" id="8194152">(</span><span class="string" id="8194153">&#34;#%d&nbsp;error&nbsp;decrypting&#34;</span><span class="op" id="8194175">,</span>&nbsp;<span class="ident" id="8194177">i</span><span class="op" id="8194178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194186">want</span>&nbsp;<span class="op" id="8194191">:=</span>&nbsp;<span class="op" id="8194194">[</span><span class="op" id="8194195">]</span><span class="builtintype" id="8194196">byte</span><span class="op" id="8194200">(</span><span class="ident" id="8194201">test</span><span class="op" id="8194205">.</span><span class="ident" id="8194206">out</span><span class="op" id="8194209">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194213">if</span>&nbsp;<span class="op" id="8194216">!</span><span class="ident" id="8194217">bytes</span><span class="op" id="8194222">.</span><span class="ident" id="8194223">Equal</span><span class="op" id="8194228">(</span><span class="ident" id="8194229">out</span><span class="op" id="8194232">,</span>&nbsp;<span class="ident" id="8194234">want</span><span class="op" id="8194238">)</span>&nbsp;<span class="op" id="8194240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194245">t</span><span class="op" id="8194246">.</span><span class="ident" id="8194247">Errorf</span><span class="op" id="8194253">(</span><span class="string" id="8194254">&#34;#%d&nbsp;got:%#v&nbsp;want:%#v&#34;</span><span class="op" id="8194276">,</span>&nbsp;<span class="ident" id="8194278">i</span><span class="op" id="8194279">,</span>&nbsp;<span class="ident" id="8194281">out</span><span class="op" id="8194284">,</span>&nbsp;<span class="ident" id="8194286">want</span><span class="op" id="8194290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194297">}</span><br>
<span class="lineno"></span><span class="op" id="8194299">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8194302">func</span>&nbsp;<span class="ident" id="8194307">TestEncryptPKCS1v15</span><span class="op" id="8194326">(</span><span class="ident" id="8194327">t</span>&nbsp;<span class="op" id="8194329">*</span><span class="ident" id="8194330">testing</span><span class="op" id="8194337">.</span><span class="ident" id="8194338">T</span><span class="op" id="8194339">)</span>&nbsp;<span class="op" id="8194341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194344">random</span>&nbsp;<span class="op" id="8194351">:=</span>&nbsp;<span class="ident" id="8194354">rand</span><span class="op" id="8194358">.</span><span class="ident" id="8194359">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194367">k</span>&nbsp;<span class="op" id="8194369">:=</span>&nbsp;<span class="op" id="8194372">(</span><span class="ident" id="8194373">rsaPrivateKey</span><span class="op" id="8194386">.</span><span class="ident" id="8194387">N</span><span class="op" id="8194388">.</span><span class="ident" id="8194389">BitLen</span><span class="op" id="8194395">(</span><span class="op" id="8194396">)</span>&nbsp;<span class="op" id="8194398">+</span>&nbsp;<span class="num" id="8194400">7</span><span class="op" id="8194401">)</span>&nbsp;<span class="op" id="8194403">/</span>&nbsp;<span class="num" id="8194405">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194409">tryEncryptDecrypt</span>&nbsp;<span class="op" id="8194427">:=</span>&nbsp;<span class="keyword" id="8194430">func</span><span class="op" id="8194434">(</span><span class="ident" id="8194435">in</span>&nbsp;<span class="op" id="8194438">[</span><span class="op" id="8194439">]</span><span class="builtintype" id="8194440">byte</span><span class="op" id="8194444">,</span>&nbsp;<span class="ident" id="8194446">blind</span>&nbsp;<span class="builtintype" id="8194452">bool</span><span class="op" id="8194456">)</span>&nbsp;<span class="builtintype" id="8194458">bool</span>&nbsp;<span class="op" id="8194463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194467">if</span>&nbsp;<span class="builtinfunc" id="8194470">len</span><span class="op" id="8194473">(</span><span class="ident" id="8194474">in</span><span class="op" id="8194476">)</span>&nbsp;<span class="op" id="8194478">&gt;</span>&nbsp;<span class="ident" id="8194480">k</span><span class="op" id="8194481">-</span><span class="num" id="8194482">11</span>&nbsp;<span class="op" id="8194485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194490">in</span>&nbsp;<span class="op" id="8194493">=</span>&nbsp;<span class="ident" id="8194495">in</span><span class="op" id="8194497">[</span><span class="num" id="8194498">0</span>&nbsp;<span class="op" id="8194500">:</span>&nbsp;<span class="ident" id="8194502">k</span><span class="op" id="8194503">-</span><span class="num" id="8194504">11</span><span class="op" id="8194506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194515">ciphertext</span><span class="op" id="8194525">,</span>&nbsp;<span class="ident" id="8194527">err</span>&nbsp;<span class="op" id="8194531">:=</span>&nbsp;<span class="ident" id="8194534">EncryptPKCS1v15</span><span class="op" id="8194549">(</span><span class="ident" id="8194550">random</span><span class="op" id="8194556">,</span>&nbsp;<span class="op" id="8194558">&amp;</span><span class="ident" id="8194559">rsaPrivateKey</span><span class="op" id="8194572">.</span><span class="ident" id="8194573">PublicKey</span><span class="op" id="8194582">,</span>&nbsp;<span class="ident" id="8194584">in</span><span class="op" id="8194586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194590">if</span>&nbsp;<span class="ident" id="8194593">err</span>&nbsp;<span class="op" id="8194597">!=</span>&nbsp;<span class="ident" id="8194600">nil</span>&nbsp;<span class="op" id="8194604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194609">t</span><span class="op" id="8194610">.</span><span class="ident" id="8194611">Errorf</span><span class="op" id="8194617">(</span><span class="string" id="8194618">&#34;error&nbsp;encrypting:&nbsp;%s&#34;</span><span class="op" id="8194640">,</span>&nbsp;<span class="ident" id="8194642">err</span><span class="op" id="8194645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194650">return</span>&nbsp;<span class="ident" id="8194657">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194665">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194670">var</span>&nbsp;<span class="ident" id="8194674">rand</span>&nbsp;<span class="ident" id="8194679">io</span><span class="op" id="8194681">.</span><span class="ident" id="8194682">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194691">if</span>&nbsp;<span class="op" id="8194694">!</span><span class="ident" id="8194695">blind</span>&nbsp;<span class="op" id="8194701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194706">rand</span>&nbsp;<span class="op" id="8194711">=</span>&nbsp;<span class="ident" id="8194713">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194719">}</span>&nbsp;<span class="keyword" id="8194721">else</span>&nbsp;<span class="op" id="8194726">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194731">rand</span>&nbsp;<span class="op" id="8194736">=</span>&nbsp;<span class="ident" id="8194738">random</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194751">plaintext</span><span class="op" id="8194760">,</span>&nbsp;<span class="ident" id="8194762">err</span>&nbsp;<span class="op" id="8194766">:=</span>&nbsp;<span class="ident" id="8194769">DecryptPKCS1v15</span><span class="op" id="8194784">(</span><span class="ident" id="8194785">rand</span><span class="op" id="8194789">,</span>&nbsp;<span class="ident" id="8194791">rsaPrivateKey</span><span class="op" id="8194804">,</span>&nbsp;<span class="ident" id="8194806">ciphertext</span><span class="op" id="8194816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194820">if</span>&nbsp;<span class="ident" id="8194823">err</span>&nbsp;<span class="op" id="8194827">!=</span>&nbsp;<span class="ident" id="8194830">nil</span>&nbsp;<span class="op" id="8194834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194839">t</span><span class="op" id="8194840">.</span><span class="ident" id="8194841">Errorf</span><span class="op" id="8194847">(</span><span class="string" id="8194848">&#34;error&nbsp;decrypting:&nbsp;%s&#34;</span><span class="op" id="8194870">,</span>&nbsp;<span class="ident" id="8194872">err</span><span class="op" id="8194875">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194880">return</span>&nbsp;<span class="ident" id="8194887">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194900">if</span>&nbsp;<span class="op" id="8194903">!</span><span class="ident" id="8194904">bytes</span><span class="op" id="8194909">.</span><span class="ident" id="8194910">Equal</span><span class="op" id="8194915">(</span><span class="ident" id="8194916">plaintext</span><span class="op" id="8194925">,</span>&nbsp;<span class="ident" id="8194927">in</span><span class="op" id="8194929">)</span>&nbsp;<span class="op" id="8194931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194936">t</span><span class="op" id="8194937">.</span><span class="ident" id="8194938">Errorf</span><span class="op" id="8194944">(</span><span class="string" id="8194945">&#34;output&nbsp;mismatch:&nbsp;%#v&nbsp;%#v&#34;</span><span class="op" id="8194971">,</span>&nbsp;<span class="ident" id="8194973">plaintext</span><span class="op" id="8194982">,</span>&nbsp;<span class="ident" id="8194984">in</span><span class="op" id="8194986">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194991">return</span>&nbsp;<span class="ident" id="8194998">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195010">return</span>&nbsp;<span class="ident" id="8195017">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195027">config</span>&nbsp;<span class="op" id="8195034">:=</span>&nbsp;<span class="builtinfunc" id="8195037">new</span><span class="op" id="8195040">(</span><span class="ident" id="8195041">quick</span><span class="op" id="8195046">.</span><span class="ident" id="8195047">Config</span><span class="op" id="8195053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195056">if</span>&nbsp;<span class="ident" id="8195059">testing</span><span class="op" id="8195066">.</span><span class="ident" id="8195067">Short</span><span class="op" id="8195072">(</span><span class="op" id="8195073">)</span>&nbsp;<span class="op" id="8195075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195079">config</span><span class="op" id="8195085">.</span><span class="ident" id="8195086">MaxCount</span>&nbsp;<span class="op" id="8195095">=</span>&nbsp;<span class="num" id="8195097">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195104">quick</span><span class="op" id="8195109">.</span><span class="ident" id="8195110">Check</span><span class="op" id="8195115">(</span><span class="ident" id="8195116">tryEncryptDecrypt</span><span class="op" id="8195133">,</span>&nbsp;<span class="ident" id="8195135">config</span><span class="op" id="8195141">)</span><br>
<span class="lineno">105</span><span class="op" id="8195143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8195146">//&nbsp;These&nbsp;test&nbsp;vectors&nbsp;were&nbsp;generated&nbsp;with&nbsp;`openssl&nbsp;rsautl&nbsp;-pkcs&nbsp;-encrypt`</span><br>
<span class="lineno"></span><span class="keyword" id="8195220">var</span>&nbsp;<span class="ident" id="8195224">decryptPKCS1v15SessionKeyTests</span>&nbsp;<span class="op" id="8195255">=</span>&nbsp;<span class="op" id="8195257">[</span><span class="op" id="8195258">]</span><span class="ident" id="8195259">DecryptPKCS1v15Test</span><span class="op" id="8195278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195281">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195285">&#34;e6ukkae6Gykq0fKzYwULpZehX+UPXYzMoB5mHQUDEiclRbOTqas4Y0E6nwns1BBpdvEJcilhl5zsox/6DtGsYg==&#34;</span><span class="op" id="8195375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195379">&#34;1234&#34;</span><span class="op" id="8195385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195388">}</span><span class="op" id="8195389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195396">&#34;Dtis4uk/q/LQGGqGk97P59K03hkCIVFMEFZRgVWOAAhxgYpCRG0MX2adptt92l67IqMki6iVQyyt0TtX3IdtEw==&#34;</span><span class="op" id="8195486">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195490">&#34;FAIL&#34;</span><span class="op" id="8195496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195499">}</span><span class="op" id="8195500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195507">&#34;LIyFyCYCptPxrvTxpol8F3M7ZivlMsf53zs0vHRAv+rDIh2YsHS69ePMoPMe3TkOMZ3NupiL3takPxIs1sK+dw==&#34;</span><span class="op" id="8195597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195601">&#34;abcd&#34;</span><span class="op" id="8195607">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195610">}</span><span class="op" id="8195611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195618">&#34;bafnobel46bKy76JzqU/RIVOH0uAYvzUtauKmIidKgM0sMlvobYVAVQPeUQ/oTGjbIZ1v/6Gyi5AO4DtHruGdw==&#34;</span><span class="op" id="8195708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8195712">&#34;FAIL&#34;</span><span class="op" id="8195718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195721">}</span><span class="op" id="8195722">,</span><br>
<span class="lineno">125</span><span class="op" id="8195724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8195727">func</span>&nbsp;<span class="ident" id="8195732">TestEncryptPKCS1v15SessionKey</span><span class="op" id="8195761">(</span><span class="ident" id="8195762">t</span>&nbsp;<span class="op" id="8195764">*</span><span class="ident" id="8195765">testing</span><span class="op" id="8195772">.</span><span class="ident" id="8195773">T</span><span class="op" id="8195774">)</span>&nbsp;<span class="op" id="8195776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195779">for</span>&nbsp;<span class="ident" id="8195783">i</span><span class="op" id="8195784">,</span>&nbsp;<span class="ident" id="8195786">test</span>&nbsp;<span class="op" id="8195791">:=</span>&nbsp;<span class="keyword" id="8195794">range</span>&nbsp;<span class="ident" id="8195800">decryptPKCS1v15SessionKeyTests</span>&nbsp;<span class="op" id="8195831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195835">key</span>&nbsp;<span class="op" id="8195839">:=</span>&nbsp;<span class="op" id="8195842">[</span><span class="op" id="8195843">]</span><span class="builtintype" id="8195844">byte</span><span class="op" id="8195848">(</span><span class="string" id="8195849">&#34;FAIL&#34;</span><span class="op" id="8195855">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195859">err</span>&nbsp;<span class="op" id="8195863">:=</span>&nbsp;<span class="ident" id="8195866">DecryptPKCS1v15SessionKey</span><span class="op" id="8195891">(</span><span class="ident" id="8195892">nil</span><span class="op" id="8195895">,</span>&nbsp;<span class="ident" id="8195897">rsaPrivateKey</span><span class="op" id="8195910">,</span>&nbsp;<span class="ident" id="8195912">decodeBase64</span><span class="op" id="8195924">(</span><span class="ident" id="8195925">test</span><span class="op" id="8195929">.</span><span class="ident" id="8195930">in</span><span class="op" id="8195932">)</span><span class="op" id="8195933">,</span>&nbsp;<span class="ident" id="8195935">key</span><span class="op" id="8195938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8195942">if</span>&nbsp;<span class="ident" id="8195945">err</span>&nbsp;<span class="op" id="8195949">!=</span>&nbsp;<span class="ident" id="8195952">nil</span>&nbsp;<span class="op" id="8195956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195961">t</span><span class="op" id="8195962">.</span><span class="ident" id="8195963">Errorf</span><span class="op" id="8195969">(</span><span class="string" id="8195970">&#34;#%d&nbsp;error&nbsp;decrypting&#34;</span><span class="op" id="8195992">,</span>&nbsp;<span class="ident" id="8195994">i</span><span class="op" id="8195995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196003">want</span>&nbsp;<span class="op" id="8196008">:=</span>&nbsp;<span class="op" id="8196011">[</span><span class="op" id="8196012">]</span><span class="builtintype" id="8196013">byte</span><span class="op" id="8196017">(</span><span class="ident" id="8196018">test</span><span class="op" id="8196022">.</span><span class="ident" id="8196023">out</span><span class="op" id="8196026">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196030">if</span>&nbsp;<span class="op" id="8196033">!</span><span class="ident" id="8196034">bytes</span><span class="op" id="8196039">.</span><span class="ident" id="8196040">Equal</span><span class="op" id="8196045">(</span><span class="ident" id="8196046">key</span><span class="op" id="8196049">,</span>&nbsp;<span class="ident" id="8196051">want</span><span class="op" id="8196055">)</span>&nbsp;<span class="op" id="8196057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196062">t</span><span class="op" id="8196063">.</span><span class="ident" id="8196064">Errorf</span><span class="op" id="8196070">(</span><span class="string" id="8196071">&#34;#%d&nbsp;got:%#v&nbsp;want:%#v&#34;</span><span class="op" id="8196093">,</span>&nbsp;<span class="ident" id="8196095">i</span><span class="op" id="8196096">,</span>&nbsp;<span class="ident" id="8196098">key</span><span class="op" id="8196101">,</span>&nbsp;<span class="ident" id="8196103">want</span><span class="op" id="8196107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196114">}</span><br>
<span class="lineno"></span><span class="op" id="8196116">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="8196119">func</span>&nbsp;<span class="ident" id="8196124">TestNonZeroRandomBytes</span><span class="op" id="8196146">(</span><span class="ident" id="8196147">t</span>&nbsp;<span class="op" id="8196149">*</span><span class="ident" id="8196150">testing</span><span class="op" id="8196157">.</span><span class="ident" id="8196158">T</span><span class="op" id="8196159">)</span>&nbsp;<span class="op" id="8196161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196164">random</span>&nbsp;<span class="op" id="8196171">:=</span>&nbsp;<span class="ident" id="8196174">rand</span><span class="op" id="8196178">.</span><span class="ident" id="8196179">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196188">b</span>&nbsp;<span class="op" id="8196190">:=</span>&nbsp;<span class="builtinfunc" id="8196193">make</span><span class="op" id="8196197">(</span><span class="op" id="8196198">[</span><span class="op" id="8196199">]</span><span class="builtintype" id="8196200">byte</span><span class="op" id="8196204">,</span>&nbsp;<span class="num" id="8196206">512</span><span class="op" id="8196209">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196212">err</span>&nbsp;<span class="op" id="8196216">:=</span>&nbsp;<span class="ident" id="8196219">nonZeroRandomBytes</span><span class="op" id="8196237">(</span><span class="ident" id="8196238">b</span><span class="op" id="8196239">,</span>&nbsp;<span class="ident" id="8196241">random</span><span class="op" id="8196247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196250">if</span>&nbsp;<span class="ident" id="8196253">err</span>&nbsp;<span class="op" id="8196257">!=</span>&nbsp;<span class="ident" id="8196260">nil</span>&nbsp;<span class="op" id="8196264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196268">t</span><span class="op" id="8196269">.</span><span class="ident" id="8196270">Errorf</span><span class="op" id="8196276">(</span><span class="string" id="8196277">&#34;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8196297">,</span>&nbsp;<span class="ident" id="8196299">err</span><span class="op" id="8196302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196308">for</span>&nbsp;<span class="ident" id="8196312">_</span><span class="op" id="8196313">,</span>&nbsp;<span class="ident" id="8196315">b</span>&nbsp;<span class="op" id="8196317">:=</span>&nbsp;<span class="keyword" id="8196320">range</span>&nbsp;<span class="ident" id="8196326">b</span>&nbsp;<span class="op" id="8196328">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196332">if</span>&nbsp;<span class="ident" id="8196335">b</span>&nbsp;<span class="op" id="8196337">==</span>&nbsp;<span class="num" id="8196340">0</span>&nbsp;<span class="op" id="8196342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196347">t</span><span class="op" id="8196348">.</span><span class="ident" id="8196349">Errorf</span><span class="op" id="8196355">(</span><span class="string" id="8196356">&#34;Zero&nbsp;octet&nbsp;found&#34;</span><span class="op" id="8196374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196379">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196391">}</span><br>
<span class="lineno">155</span><span class="op" id="8196393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8196396">type</span>&nbsp;<span class="ident" id="8196401">signPKCS1v15Test</span>&nbsp;<span class="keyword" id="8196418">struct</span>&nbsp;<span class="op" id="8196425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196428">in</span><span class="op" id="8196430">,</span>&nbsp;<span class="ident" id="8196432">out</span>&nbsp;<span class="builtintype" id="8196436">string</span><br>
<span class="lineno"></span><span class="op" id="8196443">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8196446">//&nbsp;These&nbsp;vectors&nbsp;have&nbsp;been&nbsp;tested&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8196485">//&nbsp;&nbsp;&nbsp;`openssl&nbsp;rsautl&nbsp;-verify&nbsp;-inkey&nbsp;pk&nbsp;-in&nbsp;signature&nbsp;|&nbsp;hexdump&nbsp;-C`</span><br>
<span class="lineno"></span><span class="keyword" id="8196552">var</span>&nbsp;<span class="ident" id="8196556">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8196574">=</span>&nbsp;<span class="op" id="8196576">[</span><span class="op" id="8196577">]</span><span class="ident" id="8196578">signPKCS1v15Test</span><span class="op" id="8196594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8196597">{</span><span class="string" id="8196598">&#34;Test.\n&#34;</span><span class="op" id="8196607">,</span>&nbsp;<span class="string" id="8196609">&#34;a4f3fa6ea93bcdd0c57be020c1193ecbfd6f200a3d95c409769b029578fa0e336ad9a347600e40d3ae823b8c7e6bad88cc07c1d54c3a1523cbbb6d58efc362ae&#34;</span><span class="op" id="8196739">}</span><span class="op" id="8196740">,</span><br>
<span class="lineno">165</span><span class="op" id="8196742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8196745">func</span>&nbsp;<span class="ident" id="8196750">TestSignPKCS1v15</span><span class="op" id="8196766">(</span><span class="ident" id="8196767">t</span>&nbsp;<span class="op" id="8196769">*</span><span class="ident" id="8196770">testing</span><span class="op" id="8196777">.</span><span class="ident" id="8196778">T</span><span class="op" id="8196779">)</span>&nbsp;<span class="op" id="8196781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196784">for</span>&nbsp;<span class="ident" id="8196788">i</span><span class="op" id="8196789">,</span>&nbsp;<span class="ident" id="8196791">test</span>&nbsp;<span class="op" id="8196796">:=</span>&nbsp;<span class="keyword" id="8196799">range</span>&nbsp;<span class="ident" id="8196805">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8196823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196827">h</span>&nbsp;<span class="op" id="8196829">:=</span>&nbsp;<span class="ident" id="8196832">sha1</span><span class="op" id="8196836">.</span><span class="ident" id="8196837">New</span><span class="op" id="8196840">(</span><span class="op" id="8196841">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196845">h</span><span class="op" id="8196846">.</span><span class="ident" id="8196847">Write</span><span class="op" id="8196852">(</span><span class="op" id="8196853">[</span><span class="op" id="8196854">]</span><span class="builtintype" id="8196855">byte</span><span class="op" id="8196859">(</span><span class="ident" id="8196860">test</span><span class="op" id="8196864">.</span><span class="ident" id="8196865">in</span><span class="op" id="8196867">)</span><span class="op" id="8196868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196872">digest</span>&nbsp;<span class="op" id="8196879">:=</span>&nbsp;<span class="ident" id="8196882">h</span><span class="op" id="8196883">.</span><span class="ident" id="8196884">Sum</span><span class="op" id="8196887">(</span><span class="ident" id="8196888">nil</span><span class="op" id="8196891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196896">s</span><span class="op" id="8196897">,</span>&nbsp;<span class="ident" id="8196899">err</span>&nbsp;<span class="op" id="8196903">:=</span>&nbsp;<span class="ident" id="8196906">SignPKCS1v15</span><span class="op" id="8196918">(</span><span class="ident" id="8196919">nil</span><span class="op" id="8196922">,</span>&nbsp;<span class="ident" id="8196924">rsaPrivateKey</span><span class="op" id="8196937">,</span>&nbsp;<span class="ident" id="8196939">crypto</span><span class="op" id="8196945">.</span><span class="ident" id="8196946">SHA1</span><span class="op" id="8196950">,</span>&nbsp;<span class="ident" id="8196952">digest</span><span class="op" id="8196958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8196962">if</span>&nbsp;<span class="ident" id="8196965">err</span>&nbsp;<span class="op" id="8196969">!=</span>&nbsp;<span class="ident" id="8196972">nil</span>&nbsp;<span class="op" id="8196976">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8196981">t</span><span class="op" id="8196982">.</span><span class="ident" id="8196983">Errorf</span><span class="op" id="8196989">(</span><span class="string" id="8196990">&#34;#%d&nbsp;%s&#34;</span><span class="op" id="8196998">,</span>&nbsp;<span class="ident" id="8197000">i</span><span class="op" id="8197001">,</span>&nbsp;<span class="ident" id="8197003">err</span><span class="op" id="8197006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197015">expected</span><span class="op" id="8197023">,</span>&nbsp;<span class="ident" id="8197025">_</span>&nbsp;<span class="op" id="8197027">:=</span>&nbsp;<span class="ident" id="8197030">hex</span><span class="op" id="8197033">.</span><span class="ident" id="8197034">DecodeString</span><span class="op" id="8197046">(</span><span class="ident" id="8197047">test</span><span class="op" id="8197051">.</span><span class="ident" id="8197052">out</span><span class="op" id="8197055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197059">if</span>&nbsp;<span class="op" id="8197062">!</span><span class="ident" id="8197063">bytes</span><span class="op" id="8197068">.</span><span class="ident" id="8197069">Equal</span><span class="op" id="8197074">(</span><span class="ident" id="8197075">s</span><span class="op" id="8197076">,</span>&nbsp;<span class="ident" id="8197078">expected</span><span class="op" id="8197086">)</span>&nbsp;<span class="op" id="8197088">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197093">t</span><span class="op" id="8197094">.</span><span class="ident" id="8197095">Errorf</span><span class="op" id="8197101">(</span><span class="string" id="8197102">&#34;#%d&nbsp;got:&nbsp;%x&nbsp;want:&nbsp;%x&#34;</span><span class="op" id="8197124">,</span>&nbsp;<span class="ident" id="8197126">i</span><span class="op" id="8197127">,</span>&nbsp;<span class="ident" id="8197129">s</span><span class="op" id="8197130">,</span>&nbsp;<span class="ident" id="8197132">expected</span><span class="op" id="8197140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197147">}</span><br>
<span class="lineno"></span><span class="op" id="8197149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8197152">func</span>&nbsp;<span class="ident" id="8197157">TestVerifyPKCS1v15</span><span class="op" id="8197175">(</span><span class="ident" id="8197176">t</span>&nbsp;<span class="op" id="8197178">*</span><span class="ident" id="8197179">testing</span><span class="op" id="8197186">.</span><span class="ident" id="8197187">T</span><span class="op" id="8197188">)</span>&nbsp;<span class="op" id="8197190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197193">for</span>&nbsp;<span class="ident" id="8197197">i</span><span class="op" id="8197198">,</span>&nbsp;<span class="ident" id="8197200">test</span>&nbsp;<span class="op" id="8197205">:=</span>&nbsp;<span class="keyword" id="8197208">range</span>&nbsp;<span class="ident" id="8197214">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8197232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197236">h</span>&nbsp;<span class="op" id="8197238">:=</span>&nbsp;<span class="ident" id="8197241">sha1</span><span class="op" id="8197245">.</span><span class="ident" id="8197246">New</span><span class="op" id="8197249">(</span><span class="op" id="8197250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197254">h</span><span class="op" id="8197255">.</span><span class="ident" id="8197256">Write</span><span class="op" id="8197261">(</span><span class="op" id="8197262">[</span><span class="op" id="8197263">]</span><span class="builtintype" id="8197264">byte</span><span class="op" id="8197268">(</span><span class="ident" id="8197269">test</span><span class="op" id="8197273">.</span><span class="ident" id="8197274">in</span><span class="op" id="8197276">)</span><span class="op" id="8197277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197281">digest</span>&nbsp;<span class="op" id="8197288">:=</span>&nbsp;<span class="ident" id="8197291">h</span><span class="op" id="8197292">.</span><span class="ident" id="8197293">Sum</span><span class="op" id="8197296">(</span><span class="ident" id="8197297">nil</span><span class="op" id="8197300">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197305">sig</span><span class="op" id="8197308">,</span>&nbsp;<span class="ident" id="8197310">_</span>&nbsp;<span class="op" id="8197312">:=</span>&nbsp;<span class="ident" id="8197315">hex</span><span class="op" id="8197318">.</span><span class="ident" id="8197319">DecodeString</span><span class="op" id="8197331">(</span><span class="ident" id="8197332">test</span><span class="op" id="8197336">.</span><span class="ident" id="8197337">out</span><span class="op" id="8197340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197345">err</span>&nbsp;<span class="op" id="8197349">:=</span>&nbsp;<span class="ident" id="8197352">VerifyPKCS1v15</span><span class="op" id="8197366">(</span><span class="op" id="8197367">&amp;</span><span class="ident" id="8197368">rsaPrivateKey</span><span class="op" id="8197381">.</span><span class="ident" id="8197382">PublicKey</span><span class="op" id="8197391">,</span>&nbsp;<span class="ident" id="8197393">crypto</span><span class="op" id="8197399">.</span><span class="ident" id="8197400">SHA1</span><span class="op" id="8197404">,</span>&nbsp;<span class="ident" id="8197406">digest</span><span class="op" id="8197412">,</span>&nbsp;<span class="ident" id="8197414">sig</span><span class="op" id="8197417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197421">if</span>&nbsp;<span class="ident" id="8197424">err</span>&nbsp;<span class="op" id="8197428">!=</span>&nbsp;<span class="ident" id="8197431">nil</span>&nbsp;<span class="op" id="8197435">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197440">t</span><span class="op" id="8197441">.</span><span class="ident" id="8197442">Errorf</span><span class="op" id="8197448">(</span><span class="string" id="8197449">&#34;#%d&nbsp;%s&#34;</span><span class="op" id="8197457">,</span>&nbsp;<span class="ident" id="8197459">i</span><span class="op" id="8197460">,</span>&nbsp;<span class="ident" id="8197462">err</span><span class="op" id="8197465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197472">}</span><br>
<span class="lineno"></span><span class="op" id="8197474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="8197477">func</span>&nbsp;<span class="ident" id="8197482">TestOverlongMessagePKCS1v15</span><span class="op" id="8197509">(</span><span class="ident" id="8197510">t</span>&nbsp;<span class="op" id="8197512">*</span><span class="ident" id="8197513">testing</span><span class="op" id="8197520">.</span><span class="ident" id="8197521">T</span><span class="op" id="8197522">)</span>&nbsp;<span class="op" id="8197524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197527">ciphertext</span>&nbsp;<span class="op" id="8197538">:=</span>&nbsp;<span class="ident" id="8197541">decodeBase64</span><span class="op" id="8197553">(</span><span class="string" id="8197554">&#34;fjOVdirUzFoLlukv80dBllMLjXythIf22feqPrNo0YoIjzyzyoMFiLjAc/Y4krkeZ11XFThIrEvw\nkRiZcCq5ng==&#34;</span><span class="op" id="8197646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197649">_</span><span class="op" id="8197650">,</span>&nbsp;<span class="ident" id="8197652">err</span>&nbsp;<span class="op" id="8197656">:=</span>&nbsp;<span class="ident" id="8197659">DecryptPKCS1v15</span><span class="op" id="8197674">(</span><span class="ident" id="8197675">nil</span><span class="op" id="8197678">,</span>&nbsp;<span class="ident" id="8197680">rsaPrivateKey</span><span class="op" id="8197693">,</span>&nbsp;<span class="ident" id="8197695">ciphertext</span><span class="op" id="8197705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8197708">if</span>&nbsp;<span class="ident" id="8197711">err</span>&nbsp;<span class="op" id="8197715">==</span>&nbsp;<span class="ident" id="8197718">nil</span>&nbsp;<span class="op" id="8197722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197726">t</span><span class="op" id="8197727">.</span><span class="ident" id="8197728">Error</span><span class="op" id="8197733">(</span><span class="string" id="8197734">&#34;RSA&nbsp;decrypted&nbsp;a&nbsp;message&nbsp;that&nbsp;was&nbsp;too&nbsp;long.&#34;</span><span class="op" id="8197778">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8197781">}</span><br>
<span class="lineno"></span><span class="op" id="8197783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8197786">func</span>&nbsp;<span class="ident" id="8197791">TestUnpaddedSignature</span><span class="op" id="8197812">(</span><span class="ident" id="8197813">t</span>&nbsp;<span class="op" id="8197815">*</span><span class="ident" id="8197816">testing</span><span class="op" id="8197823">.</span><span class="ident" id="8197824">T</span><span class="op" id="8197825">)</span>&nbsp;<span class="op" id="8197827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8197830">msg</span>&nbsp;<span class="op" id="8197834">:=</span>&nbsp;<span class="op" id="8197837">[</span><span class="op" id="8197838">]</span><span class="builtintype" id="8197839">byte</span><span class="op" id="8197843">(</span><span class="string" id="8197844">&#34;Thu&nbsp;Dec&nbsp;19&nbsp;18:06:16&nbsp;EST&nbsp;2013\n&#34;</span><span class="op" id="8197876">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8197879">//&nbsp;This&nbsp;base64&nbsp;value&nbsp;was&nbsp;generated&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8197921">//&nbsp;%&nbsp;echo&nbsp;Thu&nbsp;Dec&nbsp;19&nbsp;18:06:16&nbsp;EST&nbsp;2013&nbsp;&gt;&nbsp;/tmp/msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8197972">//&nbsp;%&nbsp;openssl&nbsp;rsautl&nbsp;-sign&nbsp;-inkey&nbsp;key&nbsp;-out&nbsp;/tmp/sig&nbsp;-in&nbsp;/tmp/msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198037">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198041">//&nbsp;Where&nbsp;&#34;key&#34;&nbsp;contains&nbsp;the&nbsp;RSA&nbsp;private&nbsp;key&nbsp;given&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;this</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198114">//&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198124">expectedSig</span>&nbsp;<span class="op" id="8198136">:=</span>&nbsp;<span class="ident" id="8198139">decodeBase64</span><span class="op" id="8198151">(</span><span class="string" id="8198152">&#34;pX4DR8azytjdQ1rtUiC040FjkepuQut5q2ZFX1pTjBrOVKNjgsCDyiJDGZTCNoh9qpXYbhl7iEym30BWWwuiZg==&#34;</span><span class="op" id="8198242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198246">sig</span><span class="op" id="8198249">,</span>&nbsp;<span class="ident" id="8198251">err</span>&nbsp;<span class="op" id="8198255">:=</span>&nbsp;<span class="ident" id="8198258">SignPKCS1v15</span><span class="op" id="8198270">(</span><span class="ident" id="8198271">nil</span><span class="op" id="8198274">,</span>&nbsp;<span class="ident" id="8198276">rsaPrivateKey</span><span class="op" id="8198289">,</span>&nbsp;<span class="ident" id="8198291">crypto</span><span class="op" id="8198297">.</span><span class="ident" id="8198298">Hash</span><span class="op" id="8198302">(</span><span class="num" id="8198303">0</span><span class="op" id="8198304">)</span><span class="op" id="8198305">,</span>&nbsp;<span class="ident" id="8198307">msg</span><span class="op" id="8198310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198313">if</span>&nbsp;<span class="ident" id="8198316">err</span>&nbsp;<span class="op" id="8198320">!=</span>&nbsp;<span class="ident" id="8198323">nil</span>&nbsp;<span class="op" id="8198327">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198331">t</span><span class="op" id="8198332">.</span><span class="ident" id="8198333">Fatalf</span><span class="op" id="8198339">(</span><span class="string" id="8198340">&#34;SignPKCS1v15&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8198365">,</span>&nbsp;<span class="ident" id="8198367">err</span><span class="op" id="8198370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198376">if</span>&nbsp;<span class="op" id="8198379">!</span><span class="ident" id="8198380">bytes</span><span class="op" id="8198385">.</span><span class="ident" id="8198386">Equal</span><span class="op" id="8198391">(</span><span class="ident" id="8198392">sig</span><span class="op" id="8198395">,</span>&nbsp;<span class="ident" id="8198397">expectedSig</span><span class="op" id="8198408">)</span>&nbsp;<span class="op" id="8198410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198414">t</span><span class="op" id="8198415">.</span><span class="ident" id="8198416">Fatalf</span><span class="op" id="8198422">(</span><span class="string" id="8198423">&#34;signature&nbsp;is&nbsp;not&nbsp;expected&nbsp;value:&nbsp;got&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="8198473">,</span>&nbsp;<span class="ident" id="8198475">sig</span><span class="op" id="8198478">,</span>&nbsp;<span class="ident" id="8198480">expectedSig</span><span class="op" id="8198491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198494">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198497">if</span>&nbsp;<span class="ident" id="8198500">err</span>&nbsp;<span class="op" id="8198504">:=</span>&nbsp;<span class="ident" id="8198507">VerifyPKCS1v15</span><span class="op" id="8198521">(</span><span class="op" id="8198522">&amp;</span><span class="ident" id="8198523">rsaPrivateKey</span><span class="op" id="8198536">.</span><span class="ident" id="8198537">PublicKey</span><span class="op" id="8198546">,</span>&nbsp;<span class="ident" id="8198548">crypto</span><span class="op" id="8198554">.</span><span class="ident" id="8198555">Hash</span><span class="op" id="8198559">(</span><span class="num" id="8198560">0</span><span class="op" id="8198561">)</span><span class="op" id="8198562">,</span>&nbsp;<span class="ident" id="8198564">msg</span><span class="op" id="8198567">,</span>&nbsp;<span class="ident" id="8198569">sig</span><span class="op" id="8198572">)</span><span class="op" id="8198573">;</span>&nbsp;<span class="ident" id="8198575">err</span>&nbsp;<span class="op" id="8198579">!=</span>&nbsp;<span class="ident" id="8198582">nil</span>&nbsp;<span class="op" id="8198586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198590">t</span><span class="op" id="8198591">.</span><span class="ident" id="8198592">Fatalf</span><span class="op" id="8198598">(</span><span class="string" id="8198599">&#34;signature&nbsp;failed&nbsp;to&nbsp;verify:&nbsp;%s&#34;</span><span class="op" id="8198631">,</span>&nbsp;<span class="ident" id="8198633">err</span><span class="op" id="8198636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198639">}</span><br>
<span class="lineno"></span><span class="op" id="8198641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8198644">func</span>&nbsp;<span class="ident" id="8198649">TestShortSessionKey</span><span class="op" id="8198668">(</span><span class="ident" id="8198669">t</span>&nbsp;<span class="op" id="8198671">*</span><span class="ident" id="8198672">testing</span><span class="op" id="8198679">.</span><span class="ident" id="8198680">T</span><span class="op" id="8198681">)</span>&nbsp;<span class="op" id="8198683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198686">//&nbsp;This&nbsp;tests&nbsp;that&nbsp;attempting&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;session&nbsp;key&nbsp;where&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8198752">//&nbsp;ciphertext&nbsp;is&nbsp;too&nbsp;small&nbsp;doesn&#39;t&nbsp;run&nbsp;outside&nbsp;the&nbsp;array&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198818">ciphertext</span><span class="op" id="8198828">,</span>&nbsp;<span class="ident" id="8198830">err</span>&nbsp;<span class="op" id="8198834">:=</span>&nbsp;<span class="ident" id="8198837">EncryptPKCS1v15</span><span class="op" id="8198852">(</span><span class="ident" id="8198853">rand</span><span class="op" id="8198857">.</span><span class="ident" id="8198858">Reader</span><span class="op" id="8198864">,</span>&nbsp;<span class="op" id="8198866">&amp;</span><span class="ident" id="8198867">rsaPrivateKey</span><span class="op" id="8198880">.</span><span class="ident" id="8198881">PublicKey</span><span class="op" id="8198890">,</span>&nbsp;<span class="op" id="8198892">[</span><span class="op" id="8198893">]</span><span class="builtintype" id="8198894">byte</span><span class="op" id="8198898">{</span><span class="num" id="8198899">1</span><span class="op" id="8198900">}</span><span class="op" id="8198901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198904">if</span>&nbsp;<span class="ident" id="8198907">err</span>&nbsp;<span class="op" id="8198911">!=</span>&nbsp;<span class="ident" id="8198914">nil</span>&nbsp;<span class="op" id="8198918">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8198922">t</span><span class="op" id="8198923">.</span><span class="ident" id="8198924">Fatalf</span><span class="op" id="8198930">(</span><span class="string" id="8198931">&#34;Failed&nbsp;to&nbsp;encrypt&nbsp;short&nbsp;message:&nbsp;%s&#34;</span><span class="op" id="8198968">,</span>&nbsp;<span class="ident" id="8198970">err</span><span class="op" id="8198973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8198976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198980">var</span>&nbsp;<span class="ident" id="8198984">key</span>&nbsp;<span class="op" id="8198988">[</span><span class="num" id="8198989">32</span><span class="op" id="8198991">]</span><span class="builtintype" id="8198992">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8198998">if</span>&nbsp;<span class="ident" id="8199001">err</span>&nbsp;<span class="op" id="8199005">:=</span>&nbsp;<span class="ident" id="8199008">DecryptPKCS1v15SessionKey</span><span class="op" id="8199033">(</span><span class="ident" id="8199034">nil</span><span class="op" id="8199037">,</span>&nbsp;<span class="ident" id="8199039">rsaPrivateKey</span><span class="op" id="8199052">,</span>&nbsp;<span class="ident" id="8199054">ciphertext</span><span class="op" id="8199064">,</span>&nbsp;<span class="ident" id="8199066">key</span><span class="op" id="8199069">[</span><span class="op" id="8199070">:</span><span class="op" id="8199071">]</span><span class="op" id="8199072">)</span><span class="op" id="8199073">;</span>&nbsp;<span class="ident" id="8199075">err</span>&nbsp;<span class="op" id="8199079">!=</span>&nbsp;<span class="ident" id="8199082">nil</span>&nbsp;<span class="op" id="8199086">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199090">t</span><span class="op" id="8199091">.</span><span class="ident" id="8199092">Fatalf</span><span class="op" id="8199098">(</span><span class="string" id="8199099">&#34;Failed&nbsp;to&nbsp;decrypt&nbsp;short&nbsp;message:&nbsp;%s&#34;</span><span class="op" id="8199136">,</span>&nbsp;<span class="ident" id="8199138">err</span><span class="op" id="8199141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199148">for</span>&nbsp;<span class="ident" id="8199152">_</span><span class="op" id="8199153">,</span>&nbsp;<span class="ident" id="8199155">v</span>&nbsp;<span class="op" id="8199157">:=</span>&nbsp;<span class="keyword" id="8199160">range</span>&nbsp;<span class="ident" id="8199166">key</span>&nbsp;<span class="op" id="8199170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8199174">if</span>&nbsp;<span class="ident" id="8199177">v</span>&nbsp;<span class="op" id="8199179">!=</span>&nbsp;<span class="num" id="8199182">0</span>&nbsp;<span class="op" id="8199184">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199189">t</span><span class="op" id="8199190">.</span><span class="ident" id="8199191">Fatal</span><span class="op" id="8199196">(</span><span class="string" id="8199197">&#34;key&nbsp;was&nbsp;modified&nbsp;when&nbsp;ciphertext&nbsp;was&nbsp;invalid&#34;</span><span class="op" id="8199243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8199250">}</span><br>
<span class="lineno"></span><span class="op" id="8199252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="8199255">//&nbsp;In&nbsp;order&nbsp;to&nbsp;generate&nbsp;new&nbsp;test&nbsp;vectors&nbsp;you&#39;ll&nbsp;need&nbsp;the&nbsp;PEM&nbsp;form&nbsp;of&nbsp;this&nbsp;key:</span><br>
<span class="lineno"></span><span class="comment" id="8199334">//&nbsp;-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----</span><br>
<span class="lineno"></span><span class="comment" id="8199369">//&nbsp;MIIBOgIBAAJBALKZD0nEffqM1ACuak0bijtqE2QrI/KLADv7l3kK3ppMyCuLKoF0</span><br>
<span class="lineno"></span><span class="comment" id="8199437">//&nbsp;fd7Ai2KW5ToIwzFofvJcS/STa6HA5gQenRUCAwEAAQJBAIq9amn00aS0h/CrjXqu</span><br>
<span class="lineno"></span><span class="comment" id="8199505">//&nbsp;/ThglAXJmZhOMPVn4eiu7/ROixi9sex436MaVeMqSNf7Ex9a8fRNfWss7Sqd9eWu</span><br>
<span class="lineno">255</span><span class="comment" id="8199573">//&nbsp;RTUCIQDasvGASLqmjeffBNLTXV2A5g4t+kLVCpsEIZAycV5GswIhANEPLmax0ME/</span><br>
<span class="lineno"></span><span class="comment" id="8199641">//&nbsp;EO+ZJ79TJKN5yiGBRsv5yvx5UiHxajEXAiAhAol5N4EUyq6I9w1rYdhPMGpLfk7A</span><br>
<span class="lineno"></span><span class="comment" id="8199709">//&nbsp;IU2snfRJ6Nq2CQIgFrPsWRCkV+gOYcajD17rEqmuLrdIRexpg8N1DOSXoJ8CIGlS</span><br>
<span class="lineno"></span><span class="comment" id="8199777">//&nbsp;tAboUGBxTDq3ZroNism3DaMIbKPyYrAqhKov1h5V</span><br>
<span class="lineno"></span><span class="comment" id="8199821">//&nbsp;-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8199855">var</span>&nbsp;<span class="ident" id="8199859">rsaPrivateKey</span>&nbsp;<span class="op" id="8199873">=</span>&nbsp;<span class="op" id="8199875">&amp;</span><span class="ident" id="8199876">PrivateKey</span><span class="op" id="8199886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199889">PublicKey</span><span class="op" id="8199898">:</span>&nbsp;<span class="ident" id="8199900">PublicKey</span><span class="op" id="8199909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8199913">N</span><span class="op" id="8199914">:</span>&nbsp;<span class="ident" id="8199916">fromBase10</span><span class="op" id="8199926">(</span><span class="string" id="8199927">&#34;9353930466774385905609975137998169297361893554149986716853295022578535724979677252958524466350471210367835187480748268864277464700638583474144061408845077&#34;</span><span class="op" id="8200083">)</span><span class="op" id="8200084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200088">E</span><span class="op" id="8200089">:</span>&nbsp;<span class="num" id="8200091">65537</span><span class="op" id="8200096">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8200099">}</span><span class="op" id="8200100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200103">D</span><span class="op" id="8200104">:</span>&nbsp;<span class="ident" id="8200106">fromBase10</span><span class="op" id="8200116">(</span><span class="string" id="8200117">&#34;7266398431328116344057699379749222532279343923819063639497049039389899328538543087657733766554155839834519529439851673014800261285757759040931985506583861&#34;</span><span class="op" id="8200273">)</span><span class="op" id="8200274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200277">Primes</span><span class="op" id="8200283">:</span>&nbsp;<span class="op" id="8200285">[</span><span class="op" id="8200286">]</span><span class="op" id="8200287">*</span><span class="ident" id="8200288">big</span><span class="op" id="8200291">.</span><span class="ident" id="8200292">Int</span><span class="op" id="8200295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200299">fromBase10</span><span class="op" id="8200309">(</span><span class="string" id="8200310">&#34;98920366548084643601728869055592650835572950932266967461790948584315647051443&#34;</span><span class="op" id="8200389">)</span><span class="op" id="8200390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8200394">fromBase10</span><span class="op" id="8200404">(</span><span class="string" id="8200405">&#34;94560208308847015747498523884063394671606671904944666360068158221458669711639&#34;</span><span class="op" id="8200484">)</span><span class="op" id="8200485">,</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8200488">}</span><span class="op" id="8200489">,</span><br>
<span class="lineno"></span><span class="op" id="8200491">}</span>
</div>
</body>
</html>
