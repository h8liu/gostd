<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4069566">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4069621">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4069675">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4069726">package</span>&nbsp;<span class="ident" id="4069734">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4069739">import</span>&nbsp;<span class="op" id="4069746">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069749">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069767">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069777">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069792">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069807">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069814">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069820">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069832">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069843">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4069851">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4069858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4069861">const</span>&nbsp;<span class="op" id="4069867">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069870">VersionSSL30</span>&nbsp;<span class="op" id="4069883">=</span>&nbsp;<span class="num" id="4069885">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069893">VersionTLS10</span>&nbsp;<span class="op" id="4069906">=</span>&nbsp;<span class="num" id="4069908">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069916">VersionTLS11</span>&nbsp;<span class="op" id="4069929">=</span>&nbsp;<span class="num" id="4069931">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069939">VersionTLS12</span>&nbsp;<span class="op" id="4069952">=</span>&nbsp;<span class="num" id="4069954">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4069961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4069964">const</span>&nbsp;<span class="op" id="4069970">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069973">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069989">=</span>&nbsp;<span class="num" id="4069991">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070004">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070041">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4070057">=</span>&nbsp;<span class="num" id="4070059">16384</span>&nbsp;<span class="op" id="4070065">+</span>&nbsp;<span class="num" id="4070067">2048</span>&nbsp;<span class="comment" id="4070072">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070110">recordHeaderLen</span>&nbsp;<span class="op" id="4070126">=</span>&nbsp;<span class="num" id="4070128">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070141">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070166">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070182">=</span>&nbsp;<span class="num" id="4070184">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070197">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070255">minVersion</span>&nbsp;<span class="op" id="4070266">=</span>&nbsp;<span class="ident" id="4070268">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070282">maxVersion</span>&nbsp;<span class="op" id="4070293">=</span>&nbsp;<span class="ident" id="4070295">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4070308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070311">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4070332">type</span>&nbsp;<span class="ident" id="4070337">recordType</span>&nbsp;<span class="builtintype" id="4070348">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4070355">const</span>&nbsp;<span class="op" id="4070361">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070364">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4070391">recordType</span>&nbsp;<span class="op" id="4070402">=</span>&nbsp;<span class="num" id="4070404">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070408">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4070435">recordType</span>&nbsp;<span class="op" id="4070446">=</span>&nbsp;<span class="num" id="4070448">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070452">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4070479">recordType</span>&nbsp;<span class="op" id="4070490">=</span>&nbsp;<span class="num" id="4070492">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070496">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4070523">recordType</span>&nbsp;<span class="op" id="4070534">=</span>&nbsp;<span class="num" id="4070536">23</span><br>
<span class="lineno">45</span><span class="op" id="4070539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070542">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4070574">const</span>&nbsp;<span class="op" id="4070580">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070583">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070606">uint8</span>&nbsp;<span class="op" id="4070612">=</span>&nbsp;<span class="num" id="4070614">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070617">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070640">uint8</span>&nbsp;<span class="op" id="4070646">=</span>&nbsp;<span class="num" id="4070648">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070651">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070674">uint8</span>&nbsp;<span class="op" id="4070680">=</span>&nbsp;<span class="num" id="4070682">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070685">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070708">uint8</span>&nbsp;<span class="op" id="4070714">=</span>&nbsp;<span class="num" id="4070716">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070720">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4070743">uint8</span>&nbsp;<span class="op" id="4070749">=</span>&nbsp;<span class="num" id="4070751">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070755">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4070778">uint8</span>&nbsp;<span class="op" id="4070784">=</span>&nbsp;<span class="num" id="4070786">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070790">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070813">uint8</span>&nbsp;<span class="op" id="4070819">=</span>&nbsp;<span class="num" id="4070821">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070825">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4070848">uint8</span>&nbsp;<span class="op" id="4070854">=</span>&nbsp;<span class="num" id="4070856">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070860">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4070883">uint8</span>&nbsp;<span class="op" id="4070889">=</span>&nbsp;<span class="num" id="4070891">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070895">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070918">uint8</span>&nbsp;<span class="op" id="4070924">=</span>&nbsp;<span class="num" id="4070926">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070930">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4070953">uint8</span>&nbsp;<span class="op" id="4070959">=</span>&nbsp;<span class="num" id="4070961">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070965">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4070988">uint8</span>&nbsp;<span class="op" id="4070994">=</span>&nbsp;<span class="num" id="4070996">67</span>&nbsp;<span class="comment" id="4070999">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4071020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071023">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4071049">const</span>&nbsp;<span class="op" id="4071055">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071058">compressionNone</span>&nbsp;<span class="builtintype" id="4071074">uint8</span>&nbsp;<span class="op" id="4071080">=</span>&nbsp;<span class="num" id="4071082">0</span><br>
<span class="lineno"></span><span class="op" id="4071084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071087">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4071112">const</span>&nbsp;<span class="op" id="4071118">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071121">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071150">uint16</span>&nbsp;<span class="op" id="4071157">=</span>&nbsp;<span class="num" id="4071159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071162">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071191">uint16</span>&nbsp;<span class="op" id="4071198">=</span>&nbsp;<span class="num" id="4071200">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071203">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071232">uint16</span>&nbsp;<span class="op" id="4071239">=</span>&nbsp;<span class="num" id="4071241">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071245">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071274">uint16</span>&nbsp;<span class="op" id="4071281">=</span>&nbsp;<span class="num" id="4071283">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071287">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4071316">uint16</span>&nbsp;<span class="op" id="4071323">=</span>&nbsp;<span class="num" id="4071325">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071329">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071358">uint16</span>&nbsp;<span class="op" id="4071365">=</span>&nbsp;<span class="num" id="4071367">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071371">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071400">uint16</span>&nbsp;<span class="op" id="4071407">=</span>&nbsp;<span class="num" id="4071409">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071413">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071442">uint16</span>&nbsp;<span class="op" id="4071449">=</span>&nbsp;<span class="num" id="4071451">13172</span>&nbsp;<span class="comment" id="4071457">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071479">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071508">uint16</span>&nbsp;<span class="op" id="4071515">=</span>&nbsp;<span class="num" id="4071517">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4071524">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4071527">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4071564">const</span>&nbsp;<span class="op" id="4071570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071573">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4071591">uint16</span>&nbsp;<span class="op" id="4071598">=</span>&nbsp;<span class="num" id="4071600">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4071607">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4071610">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4071680">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4071766">type</span>&nbsp;<span class="ident" id="4071771">CurveID</span>&nbsp;<span class="builtintype" id="4071779">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4071787">const</span>&nbsp;<span class="op" id="4071793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071796">CurveP256</span>&nbsp;<span class="ident" id="4071806">CurveID</span>&nbsp;<span class="op" id="4071814">=</span>&nbsp;<span class="num" id="4071816">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071820">CurveP384</span>&nbsp;<span class="ident" id="4071830">CurveID</span>&nbsp;<span class="op" id="4071838">=</span>&nbsp;<span class="num" id="4071840">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071844">CurveP521</span>&nbsp;<span class="ident" id="4071854">CurveID</span>&nbsp;<span class="op" id="4071862">=</span>&nbsp;<span class="num" id="4071864">25</span><br>
<span class="lineno"></span><span class="op" id="4071867">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4071870">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4071906">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4071992">const</span>&nbsp;<span class="op" id="4071998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072001">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4072025">uint8</span>&nbsp;<span class="op" id="4072031">=</span>&nbsp;<span class="num" id="4072033">0</span><br>
<span class="lineno">100</span><span class="op" id="4072035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072038">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4072078">const</span>&nbsp;<span class="op" id="4072084">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072087">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4072102">uint8</span>&nbsp;<span class="op" id="4072108">=</span>&nbsp;<span class="num" id="4072110">1</span><br>
<span class="lineno">105</span><span class="op" id="4072112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072115">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4072164">const</span>&nbsp;<span class="op" id="4072170">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072173">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4072192">=</span>&nbsp;<span class="num" id="4072194">1</span>&nbsp;<span class="comment" id="4072196">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072236">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4072255">=</span>&nbsp;<span class="num" id="4072257">2</span>&nbsp;<span class="comment" id="4072259">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072298">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4072317">=</span>&nbsp;<span class="num" id="4072319">3</span>&nbsp;<span class="comment" id="4072321">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072366">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4072385">=</span>&nbsp;<span class="num" id="4072387">4</span>&nbsp;<span class="comment" id="4072389">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072435">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072471">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4072494">=</span>&nbsp;<span class="num" id="4072496">64</span>&nbsp;<span class="comment" id="4072499">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072576">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4072599">=</span>&nbsp;<span class="num" id="4072601">65</span>&nbsp;<span class="comment" id="4072604">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072678">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4072701">=</span>&nbsp;<span class="num" id="4072703">66</span>&nbsp;<span class="comment" id="4072706">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072783">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4072829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072832">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4072892">const</span>&nbsp;<span class="op" id="4072898">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072901">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4072912">uint8</span>&nbsp;<span class="op" id="4072918">=</span>&nbsp;<span class="num" id="4072920">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072923">hashSHA256</span>&nbsp;<span class="builtintype" id="4072934">uint8</span>&nbsp;<span class="op" id="4072940">=</span>&nbsp;<span class="num" id="4072942">4</span><br>
<span class="lineno"></span><span class="op" id="4072944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072947">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4073013">const</span>&nbsp;<span class="op" id="4073019">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073022">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4073037">uint8</span>&nbsp;<span class="op" id="4073043">=</span>&nbsp;<span class="num" id="4073045">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073048">signatureECDSA</span>&nbsp;<span class="builtintype" id="4073063">uint8</span>&nbsp;<span class="op" id="4073069">=</span>&nbsp;<span class="num" id="4073071">3</span><br>
<span class="lineno"></span><span class="op" id="4073073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073076">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4073155">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4073183">type</span>&nbsp;<span class="ident" id="4073188">signatureAndHash</span>&nbsp;<span class="keyword" id="4073205">struct</span>&nbsp;<span class="op" id="4073212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073215">hash</span><span class="op" id="4073219">,</span>&nbsp;<span class="ident" id="4073221">signature</span>&nbsp;<span class="builtintype" id="4073231">uint8</span><br>
<span class="lineno"></span><span class="op" id="4073237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4073240">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4073318">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4073385">var</span>&nbsp;<span class="ident" id="4073389">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4073421">=</span>&nbsp;<span class="op" id="4073423">[</span><span class="op" id="4073424">]</span><span class="ident" id="4073425">signatureAndHash</span><span class="op" id="4073441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073444">{</span><span class="ident" id="4073445">hashSHA256</span><span class="op" id="4073455">,</span>&nbsp;<span class="ident" id="4073457">signatureRSA</span><span class="op" id="4073469">}</span><span class="op" id="4073470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073473">{</span><span class="ident" id="4073474">hashSHA256</span><span class="op" id="4073484">,</span>&nbsp;<span class="ident" id="4073486">signatureECDSA</span><span class="op" id="4073500">}</span><span class="op" id="4073501">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073504">{</span><span class="ident" id="4073505">hashSHA1</span><span class="op" id="4073513">,</span>&nbsp;<span class="ident" id="4073515">signatureRSA</span><span class="op" id="4073527">}</span><span class="op" id="4073528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073531">{</span><span class="ident" id="4073532">hashSHA1</span><span class="op" id="4073540">,</span>&nbsp;<span class="ident" id="4073542">signatureECDSA</span><span class="op" id="4073556">}</span><span class="op" id="4073557">,</span><br>
<span class="lineno"></span><span class="op" id="4073559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073562">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4073636">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4073701">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4073724">var</span>&nbsp;<span class="ident" id="4073728">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4073767">=</span>&nbsp;<span class="op" id="4073769">[</span><span class="op" id="4073770">]</span><span class="ident" id="4073771">signatureAndHash</span><span class="op" id="4073787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073790">{</span><span class="ident" id="4073791">hashSHA256</span><span class="op" id="4073801">,</span>&nbsp;<span class="ident" id="4073803">signatureRSA</span><span class="op" id="4073815">}</span><span class="op" id="4073816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073819">{</span><span class="ident" id="4073820">hashSHA256</span><span class="op" id="4073830">,</span>&nbsp;<span class="ident" id="4073832">signatureECDSA</span><span class="op" id="4073846">}</span><span class="op" id="4073847">,</span><br>
<span class="lineno">155</span><span class="op" id="4073849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073852">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4073919">type</span>&nbsp;<span class="ident" id="4073924">ConnectionState</span>&nbsp;<span class="keyword" id="4073940">struct</span>&nbsp;<span class="op" id="4073947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073950">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4073977">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073999">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074058">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4074085">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074107">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074137">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4074164">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074186">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074235">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4074262">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074284">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074340">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4074367">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074389">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074443">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4074470">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074492">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074541">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4074568">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4074590">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074653">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4074680">[</span><span class="op" id="4074681">]</span><span class="op" id="4074682">*</span><span class="ident" id="4074683">x509</span><span class="op" id="4074687">.</span><span class="ident" id="4074688">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4074702">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074749">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4074776">[</span><span class="op" id="4074777">]</span><span class="op" id="4074778">[</span><span class="op" id="4074779">]</span><span class="op" id="4074780">*</span><span class="ident" id="4074781">x509</span><span class="op" id="4074785">.</span><span class="ident" id="4074786">Certificate</span>&nbsp;<span class="comment" id="4074798">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074847">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074918">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074984">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075044">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075117">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075183">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075217">TLSUnique</span>&nbsp;<span class="op" id="4075227">[</span><span class="op" id="4075228">]</span><span class="builtintype" id="4075229">byte</span><br>
<span class="lineno"></span><span class="op" id="4075234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4075237">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4075302">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4075332">type</span>&nbsp;<span class="ident" id="4075337">ClientAuthType</span>&nbsp;<span class="builtintype" id="4075352">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4075357">const</span>&nbsp;<span class="op" id="4075363">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075366">NoClientCert</span>&nbsp;<span class="ident" id="4075379">ClientAuthType</span>&nbsp;<span class="op" id="4075394">=</span>&nbsp;<span class="ident" id="4075396">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075402">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075421">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075443">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075468">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4075495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4075498">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4075571">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4075584">type</span>&nbsp;<span class="ident" id="4075589">ClientSessionState</span>&nbsp;<span class="keyword" id="4075608">struct</span>&nbsp;<span class="op" id="4075615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075618">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4075637">[</span><span class="op" id="4075638">]</span><span class="builtintype" id="4075639">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4075657">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075718">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4075737">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4075757">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075804">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4075823">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4075843">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075886">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4075905">[</span><span class="op" id="4075906">]</span><span class="builtintype" id="4075907">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4075925">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075982">serverCertificates</span>&nbsp;<span class="op" id="4076001">[</span><span class="op" id="4076002">]</span><span class="op" id="4076003">*</span><span class="ident" id="4076004">x509</span><span class="op" id="4076008">.</span><span class="ident" id="4076009">Certificate</span>&nbsp;<span class="comment" id="4076021">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4076066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4076069">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4076149">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4076228">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4076302">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4076317">type</span>&nbsp;<span class="ident" id="4076322">ClientSessionCache</span>&nbsp;<span class="keyword" id="4076341">interface</span>&nbsp;<span class="op" id="4076351">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076354">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076427">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076471">Get</span><span class="op" id="4076474">(</span><span class="ident" id="4076475">sessionKey</span>&nbsp;<span class="builtintype" id="4076486">string</span><span class="op" id="4076492">)</span>&nbsp;<span class="op" id="4076494">(</span><span class="ident" id="4076495">session</span>&nbsp;<span class="op" id="4076503">*</span><span class="ident" id="4076504">ClientSessionState</span><span class="op" id="4076522">,</span>&nbsp;<span class="ident" id="4076524">ok</span>&nbsp;<span class="builtintype" id="4076527">bool</span><span class="op" id="4076531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076535">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076604">Put</span><span class="op" id="4076607">(</span><span class="ident" id="4076608">sessionKey</span>&nbsp;<span class="builtintype" id="4076619">string</span><span class="op" id="4076625">,</span>&nbsp;<span class="ident" id="4076627">cs</span>&nbsp;<span class="op" id="4076630">*</span><span class="ident" id="4076631">ClientSessionState</span><span class="op" id="4076649">)</span><br>
<span class="lineno"></span><span class="op" id="4076651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076654">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4076733">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4076796">type</span>&nbsp;<span class="ident" id="4076801">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4076817">struct</span>&nbsp;<span class="op" id="4076824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076827">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076897">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076928">CipherSuites</span>&nbsp;<span class="op" id="4076941">[</span><span class="op" id="4076942">]</span><span class="builtintype" id="4076943">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076952">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077024">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077095">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077124">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077177">ServerName</span>&nbsp;<span class="builtintype" id="4077188">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077197">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077268">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077333">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077366">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077421">SupportedCurves</span>&nbsp;<span class="op" id="4077437">[</span><span class="op" id="4077438">]</span><span class="ident" id="4077439">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077449">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077518">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077591">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077614">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077669">SupportedPoints</span>&nbsp;<span class="op" id="4077685">[</span><span class="op" id="4077686">]</span><span class="builtintype" id="4077687">uint8</span><br>
<span class="lineno"></span><span class="op" id="4077693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077696">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4077763">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4077825">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4077892">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4077906">type</span>&nbsp;<span class="ident" id="4077911">Config</span>&nbsp;<span class="keyword" id="4077918">struct</span>&nbsp;<span class="op" id="4077925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077928">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077997">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078069">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078086">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078146">Rand</span>&nbsp;<span class="ident" id="4078151">io</span><span class="op" id="4078153">.</span><span class="ident" id="4078154">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078163">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078239">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078278">Time</span>&nbsp;<span class="keyword" id="4078283">func</span><span class="op" id="4078287">(</span><span class="op" id="4078288">)</span>&nbsp;<span class="ident" id="4078290">time</span><span class="op" id="4078294">.</span><span class="ident" id="4078295">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078302">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078359">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078411">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078476">Certificates</span>&nbsp;<span class="op" id="4078489">[</span><span class="op" id="4078490">]</span><span class="ident" id="4078491">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078505">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078573">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078639">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078708">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078746">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078816">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078841">NameToCertificate</span>&nbsp;<span class="keyword" id="4078859">map</span><span class="op" id="4078862">[</span><span class="builtintype" id="4078863">string</span><span class="op" id="4078869">]</span><span class="op" id="4078870">*</span><span class="ident" id="4078871">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078885">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078945">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079016">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079072">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079144">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079154">GetCertificate</span>&nbsp;<span class="keyword" id="4079169">func</span><span class="op" id="4079173">(</span><span class="ident" id="4079174">clientHello</span>&nbsp;<span class="op" id="4079186">*</span><span class="ident" id="4079187">ClientHelloInfo</span><span class="op" id="4079202">)</span>&nbsp;<span class="op" id="4079204">(</span><span class="op" id="4079205">*</span><span class="ident" id="4079206">Certificate</span><span class="op" id="4079217">,</span>&nbsp;<span class="builtintype" id="4079219">error</span><span class="op" id="4079224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079228">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079288">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079345">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079401">RootCAs</span>&nbsp;<span class="op" id="4079409">*</span><span class="ident" id="4079410">x509</span><span class="op" id="4079414">.</span><span class="ident" id="4079415">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079426">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079494">NextProtos</span>&nbsp;<span class="op" id="4079505">[</span><span class="op" id="4079506">]</span><span class="builtintype" id="4079507">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079516">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079578">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079651">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079709">ServerName</span>&nbsp;<span class="builtintype" id="4079720">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079729">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079779">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079839">ClientAuth</span>&nbsp;<span class="ident" id="4079850">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079867">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079929">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4079993">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080026">ClientCAs</span>&nbsp;<span class="op" id="4080036">*</span><span class="ident" id="4080037">x509</span><span class="op" id="4080041">.</span><span class="ident" id="4080042">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080053">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080115">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080161">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080224">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080291">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080358">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080400">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4080419">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080426">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080497">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080568">CipherSuites</span>&nbsp;<span class="op" id="4080581">[</span><span class="op" id="4080582">]</span><span class="builtintype" id="4080583">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080592">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080661">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080733">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080804">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080856">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4080881">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080888">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080960">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080986">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4081009">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081016">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081079">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081141">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081192">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081196">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081266">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081325">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081388">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081436">SessionTicketKey</span>&nbsp;<span class="op" id="4081453">[</span><span class="num" id="4081454">32</span><span class="op" id="4081456">]</span><span class="builtintype" id="4081457">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081464">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081538">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081554">ClientSessionCache</span>&nbsp;<span class="ident" id="4081573">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081594">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081666">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081715">MinVersion</span>&nbsp;<span class="builtintype" id="4081726">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081735">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081807">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081880">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081912">MaxVersion</span>&nbsp;<span class="builtintype" id="4081923">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081932">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082003">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082075">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082088">CurvePreferences</span>&nbsp;<span class="op" id="4082105">[</span><span class="op" id="4082106">]</span><span class="ident" id="4082107">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082117">serverInitOnce</span>&nbsp;<span class="ident" id="4082132">sync</span><span class="op" id="4082136">.</span><span class="ident" id="4082137">Once</span>&nbsp;<span class="comment" id="4082142">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4082181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4082184">func</span>&nbsp;<span class="op" id="4082189">(</span><span class="ident" id="4082190">c</span>&nbsp;<span class="op" id="4082192">*</span><span class="ident" id="4082193">Config</span><span class="op" id="4082199">)</span>&nbsp;<span class="ident" id="4082201">serverInit</span><span class="op" id="4082211">(</span><span class="op" id="4082212">)</span>&nbsp;<span class="op" id="4082214">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082217">if</span>&nbsp;<span class="ident" id="4082220">c</span><span class="op" id="4082221">.</span><span class="ident" id="4082222">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4082245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082249">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082261">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082325">for</span>&nbsp;<span class="ident" id="4082329">_</span><span class="op" id="4082330">,</span>&nbsp;<span class="ident" id="4082332">b</span>&nbsp;<span class="op" id="4082334">:=</span>&nbsp;<span class="keyword" id="4082337">range</span>&nbsp;<span class="ident" id="4082343">c</span><span class="op" id="4082344">.</span><span class="ident" id="4082345">SessionTicketKey</span>&nbsp;<span class="op" id="4082362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082366">if</span>&nbsp;<span class="ident" id="4082369">b</span>&nbsp;<span class="op" id="4082371">!=</span>&nbsp;<span class="num" id="4082374">0</span>&nbsp;<span class="op" id="4082376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082381">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082393">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082397">if</span>&nbsp;<span class="ident" id="4082400">_</span><span class="op" id="4082401">,</span>&nbsp;<span class="ident" id="4082403">err</span>&nbsp;<span class="op" id="4082407">:=</span>&nbsp;<span class="ident" id="4082410">io</span><span class="op" id="4082412">.</span><span class="ident" id="4082413">ReadFull</span><span class="op" id="4082421">(</span><span class="ident" id="4082422">c</span><span class="op" id="4082423">.</span><span class="ident" id="4082424">rand</span><span class="op" id="4082428">(</span><span class="op" id="4082429">)</span><span class="op" id="4082430">,</span>&nbsp;<span class="ident" id="4082432">c</span><span class="op" id="4082433">.</span><span class="ident" id="4082434">SessionTicketKey</span><span class="op" id="4082450">[</span><span class="op" id="4082451">:</span><span class="op" id="4082452">]</span><span class="op" id="4082453">)</span><span class="op" id="4082454">;</span>&nbsp;<span class="ident" id="4082456">err</span>&nbsp;<span class="op" id="4082460">!=</span>&nbsp;<span class="ident" id="4082463">nil</span>&nbsp;<span class="op" id="4082467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082471">c</span><span class="op" id="4082472">.</span><span class="ident" id="4082473">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4082496">=</span>&nbsp;<span class="builtintype" id="4082498">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082504">}</span><br>
<span class="lineno"></span><span class="op" id="4082506">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4082509">func</span>&nbsp;<span class="op" id="4082514">(</span><span class="ident" id="4082515">c</span>&nbsp;<span class="op" id="4082517">*</span><span class="ident" id="4082518">Config</span><span class="op" id="4082524">)</span>&nbsp;<span class="ident" id="4082526">rand</span><span class="op" id="4082530">(</span><span class="op" id="4082531">)</span>&nbsp;<span class="ident" id="4082533">io</span><span class="op" id="4082535">.</span><span class="ident" id="4082536">Reader</span>&nbsp;<span class="op" id="4082543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082546">r</span>&nbsp;<span class="op" id="4082548">:=</span>&nbsp;<span class="ident" id="4082551">c</span><span class="op" id="4082552">.</span><span class="ident" id="4082553">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082559">if</span>&nbsp;<span class="ident" id="4082562">r</span>&nbsp;<span class="op" id="4082564">==</span>&nbsp;<span class="ident" id="4082567">nil</span>&nbsp;<span class="op" id="4082571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082575">return</span>&nbsp;<span class="ident" id="4082582">rand</span><span class="op" id="4082586">.</span><span class="ident" id="4082587">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082598">return</span>&nbsp;<span class="ident" id="4082605">r</span><br>
<span class="lineno"></span><span class="op" id="4082607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4082610">func</span>&nbsp;<span class="op" id="4082615">(</span><span class="ident" id="4082616">c</span>&nbsp;<span class="op" id="4082618">*</span><span class="ident" id="4082619">Config</span><span class="op" id="4082625">)</span>&nbsp;<span class="ident" id="4082627">time</span><span class="op" id="4082631">(</span><span class="op" id="4082632">)</span>&nbsp;<span class="ident" id="4082634">time</span><span class="op" id="4082638">.</span><span class="ident" id="4082639">Time</span>&nbsp;<span class="op" id="4082644">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082647">t</span>&nbsp;<span class="op" id="4082649">:=</span>&nbsp;<span class="ident" id="4082652">c</span><span class="op" id="4082653">.</span><span class="ident" id="4082654">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082660">if</span>&nbsp;<span class="ident" id="4082663">t</span>&nbsp;<span class="op" id="4082665">==</span>&nbsp;<span class="ident" id="4082668">nil</span>&nbsp;<span class="op" id="4082672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082676">t</span>&nbsp;<span class="op" id="4082678">=</span>&nbsp;<span class="ident" id="4082680">time</span><span class="op" id="4082684">.</span><span class="ident" id="4082685">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082693">return</span>&nbsp;<span class="ident" id="4082700">t</span><span class="op" id="4082701">(</span><span class="op" id="4082702">)</span><br>
<span class="lineno">380</span><span class="op" id="4082704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4082707">func</span>&nbsp;<span class="op" id="4082712">(</span><span class="ident" id="4082713">c</span>&nbsp;<span class="op" id="4082715">*</span><span class="ident" id="4082716">Config</span><span class="op" id="4082722">)</span>&nbsp;<span class="ident" id="4082724">cipherSuites</span><span class="op" id="4082736">(</span><span class="op" id="4082737">)</span>&nbsp;<span class="op" id="4082739">[</span><span class="op" id="4082740">]</span><span class="builtintype" id="4082741">uint16</span>&nbsp;<span class="op" id="4082748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082751">s</span>&nbsp;<span class="op" id="4082753">:=</span>&nbsp;<span class="ident" id="4082756">c</span><span class="op" id="4082757">.</span><span class="ident" id="4082758">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082772">if</span>&nbsp;<span class="ident" id="4082775">s</span>&nbsp;<span class="op" id="4082777">==</span>&nbsp;<span class="ident" id="4082780">nil</span>&nbsp;<span class="op" id="4082784">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082788">s</span>&nbsp;<span class="op" id="4082790">=</span>&nbsp;<span class="ident" id="4082792">defaultCipherSuites</span><span class="op" id="4082811">(</span><span class="op" id="4082812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082818">return</span>&nbsp;<span class="ident" id="4082825">s</span><br>
<span class="lineno"></span><span class="op" id="4082827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4082830">func</span>&nbsp;<span class="op" id="4082835">(</span><span class="ident" id="4082836">c</span>&nbsp;<span class="op" id="4082838">*</span><span class="ident" id="4082839">Config</span><span class="op" id="4082845">)</span>&nbsp;<span class="ident" id="4082847">minVersion</span><span class="op" id="4082857">(</span><span class="op" id="4082858">)</span>&nbsp;<span class="builtintype" id="4082860">uint16</span>&nbsp;<span class="op" id="4082867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082870">if</span>&nbsp;<span class="ident" id="4082873">c</span>&nbsp;<span class="op" id="4082875">==</span>&nbsp;<span class="ident" id="4082878">nil</span>&nbsp;<span class="op" id="4082882">||</span>&nbsp;<span class="ident" id="4082885">c</span><span class="op" id="4082886">.</span><span class="ident" id="4082887">MinVersion</span>&nbsp;<span class="op" id="4082898">==</span>&nbsp;<span class="num" id="4082901">0</span>&nbsp;<span class="op" id="4082903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082907">return</span>&nbsp;<span class="ident" id="4082914">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082929">return</span>&nbsp;<span class="ident" id="4082936">c</span><span class="op" id="4082937">.</span><span class="ident" id="4082938">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4082949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4082952">func</span>&nbsp;<span class="op" id="4082957">(</span><span class="ident" id="4082958">c</span>&nbsp;<span class="op" id="4082960">*</span><span class="ident" id="4082961">Config</span><span class="op" id="4082967">)</span>&nbsp;<span class="ident" id="4082969">maxVersion</span><span class="op" id="4082979">(</span><span class="op" id="4082980">)</span>&nbsp;<span class="builtintype" id="4082982">uint16</span>&nbsp;<span class="op" id="4082989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082992">if</span>&nbsp;<span class="ident" id="4082995">c</span>&nbsp;<span class="op" id="4082997">==</span>&nbsp;<span class="ident" id="4083000">nil</span>&nbsp;<span class="op" id="4083004">||</span>&nbsp;<span class="ident" id="4083007">c</span><span class="op" id="4083008">.</span><span class="ident" id="4083009">MaxVersion</span>&nbsp;<span class="op" id="4083020">==</span>&nbsp;<span class="num" id="4083023">0</span>&nbsp;<span class="op" id="4083025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083029">return</span>&nbsp;<span class="ident" id="4083036">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083051">return</span>&nbsp;<span class="ident" id="4083058">c</span><span class="op" id="4083059">.</span><span class="ident" id="4083060">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4083071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4083074">var</span>&nbsp;<span class="ident" id="4083078">defaultCurvePreferences</span>&nbsp;<span class="op" id="4083102">=</span>&nbsp;<span class="op" id="4083104">[</span><span class="op" id="4083105">]</span><span class="ident" id="4083106">CurveID</span><span class="op" id="4083113">{</span><span class="ident" id="4083114">CurveP256</span><span class="op" id="4083123">,</span>&nbsp;<span class="ident" id="4083125">CurveP384</span><span class="op" id="4083134">,</span>&nbsp;<span class="ident" id="4083136">CurveP521</span><span class="op" id="4083145">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4083148">func</span>&nbsp;<span class="op" id="4083153">(</span><span class="ident" id="4083154">c</span>&nbsp;<span class="op" id="4083156">*</span><span class="ident" id="4083157">Config</span><span class="op" id="4083163">)</span>&nbsp;<span class="ident" id="4083165">curvePreferences</span><span class="op" id="4083181">(</span><span class="op" id="4083182">)</span>&nbsp;<span class="op" id="4083184">[</span><span class="op" id="4083185">]</span><span class="ident" id="4083186">CurveID</span>&nbsp;<span class="op" id="4083194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083197">if</span>&nbsp;<span class="ident" id="4083200">c</span>&nbsp;<span class="op" id="4083202">==</span>&nbsp;<span class="ident" id="4083205">nil</span>&nbsp;<span class="op" id="4083209">||</span>&nbsp;<span class="builtinfunc" id="4083212">len</span><span class="op" id="4083215">(</span><span class="ident" id="4083216">c</span><span class="op" id="4083217">.</span><span class="ident" id="4083218">CurvePreferences</span><span class="op" id="4083234">)</span>&nbsp;<span class="op" id="4083236">==</span>&nbsp;<span class="num" id="4083239">0</span>&nbsp;<span class="op" id="4083241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083245">return</span>&nbsp;<span class="ident" id="4083252">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083277">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083280">return</span>&nbsp;<span class="ident" id="4083287">c</span><span class="op" id="4083288">.</span><span class="ident" id="4083289">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4083306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4083309">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4083383">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4083407">func</span>&nbsp;<span class="op" id="4083412">(</span><span class="ident" id="4083413">c</span>&nbsp;<span class="op" id="4083415">*</span><span class="ident" id="4083416">Config</span><span class="op" id="4083422">)</span>&nbsp;<span class="ident" id="4083424">mutualVersion</span><span class="op" id="4083437">(</span><span class="ident" id="4083438">vers</span>&nbsp;<span class="builtintype" id="4083443">uint16</span><span class="op" id="4083449">)</span>&nbsp;<span class="op" id="4083451">(</span><span class="builtintype" id="4083452">uint16</span><span class="op" id="4083458">,</span>&nbsp;<span class="builtintype" id="4083460">bool</span><span class="op" id="4083464">)</span>&nbsp;<span class="op" id="4083466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083469">minVersion</span>&nbsp;<span class="op" id="4083480">:=</span>&nbsp;<span class="ident" id="4083483">c</span><span class="op" id="4083484">.</span><span class="ident" id="4083485">minVersion</span><span class="op" id="4083495">(</span><span class="op" id="4083496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083499">maxVersion</span>&nbsp;<span class="op" id="4083510">:=</span>&nbsp;<span class="ident" id="4083513">c</span><span class="op" id="4083514">.</span><span class="ident" id="4083515">maxVersion</span><span class="op" id="4083525">(</span><span class="op" id="4083526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083530">if</span>&nbsp;<span class="ident" id="4083533">vers</span>&nbsp;<span class="op" id="4083538">&lt;</span>&nbsp;<span class="ident" id="4083540">minVersion</span>&nbsp;<span class="op" id="4083551">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083555">return</span>&nbsp;<span class="num" id="4083562">0</span><span class="op" id="4083563">,</span>&nbsp;<span class="builtintype" id="4083565">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083575">if</span>&nbsp;<span class="ident" id="4083578">vers</span>&nbsp;<span class="op" id="4083583">&gt;</span>&nbsp;<span class="ident" id="4083585">maxVersion</span>&nbsp;<span class="op" id="4083596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083600">vers</span>&nbsp;<span class="op" id="4083605">=</span>&nbsp;<span class="ident" id="4083607">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083619">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083622">return</span>&nbsp;<span class="ident" id="4083629">vers</span><span class="op" id="4083633">,</span>&nbsp;<span class="builtintype" id="4083635">true</span><br>
<span class="lineno"></span><span class="op" id="4083640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4083643">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4083721">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4083775">func</span>&nbsp;<span class="op" id="4083780">(</span><span class="ident" id="4083781">c</span>&nbsp;<span class="op" id="4083783">*</span><span class="ident" id="4083784">Config</span><span class="op" id="4083790">)</span>&nbsp;<span class="ident" id="4083792">getCertificate</span><span class="op" id="4083806">(</span><span class="ident" id="4083807">clientHello</span>&nbsp;<span class="op" id="4083819">*</span><span class="ident" id="4083820">ClientHelloInfo</span><span class="op" id="4083835">)</span>&nbsp;<span class="op" id="4083837">(</span><span class="op" id="4083838">*</span><span class="ident" id="4083839">Certificate</span><span class="op" id="4083850">,</span>&nbsp;<span class="builtintype" id="4083852">error</span><span class="op" id="4083857">)</span>&nbsp;<span class="op" id="4083859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083862">if</span>&nbsp;<span class="ident" id="4083865">c</span><span class="op" id="4083866">.</span><span class="ident" id="4083867">GetCertificate</span>&nbsp;<span class="op" id="4083882">!=</span>&nbsp;<span class="ident" id="4083885">nil</span>&nbsp;<span class="op" id="4083889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083893">cert</span><span class="op" id="4083897">,</span>&nbsp;<span class="ident" id="4083899">err</span>&nbsp;<span class="op" id="4083903">:=</span>&nbsp;<span class="ident" id="4083906">c</span><span class="op" id="4083907">.</span><span class="ident" id="4083908">GetCertificate</span><span class="op" id="4083922">(</span><span class="ident" id="4083923">clientHello</span><span class="op" id="4083934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083938">if</span>&nbsp;<span class="ident" id="4083941">cert</span>&nbsp;<span class="op" id="4083946">!=</span>&nbsp;<span class="ident" id="4083949">nil</span>&nbsp;<span class="op" id="4083953">||</span>&nbsp;<span class="ident" id="4083956">err</span>&nbsp;<span class="op" id="4083960">!=</span>&nbsp;<span class="ident" id="4083963">nil</span>&nbsp;<span class="op" id="4083967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083972">return</span>&nbsp;<span class="ident" id="4083979">cert</span><span class="op" id="4083983">,</span>&nbsp;<span class="ident" id="4083985">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083998">if</span>&nbsp;<span class="builtinfunc" id="4084001">len</span><span class="op" id="4084004">(</span><span class="ident" id="4084005">c</span><span class="op" id="4084006">.</span><span class="ident" id="4084007">Certificates</span><span class="op" id="4084019">)</span>&nbsp;<span class="op" id="4084021">==</span>&nbsp;<span class="num" id="4084024">1</span>&nbsp;<span class="op" id="4084026">||</span>&nbsp;<span class="ident" id="4084029">c</span><span class="op" id="4084030">.</span><span class="ident" id="4084031">NameToCertificate</span>&nbsp;<span class="op" id="4084049">==</span>&nbsp;<span class="ident" id="4084052">nil</span>&nbsp;<span class="op" id="4084056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4084060">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084118">return</span>&nbsp;<span class="op" id="4084125">&amp;</span><span class="ident" id="4084126">c</span><span class="op" id="4084127">.</span><span class="ident" id="4084128">Certificates</span><span class="op" id="4084140">[</span><span class="num" id="4084141">0</span><span class="op" id="4084142">]</span><span class="op" id="4084143">,</span>&nbsp;<span class="ident" id="4084145">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084154">name</span>&nbsp;<span class="op" id="4084159">:=</span>&nbsp;<span class="ident" id="4084162">strings</span><span class="op" id="4084169">.</span><span class="ident" id="4084170">ToLower</span><span class="op" id="4084177">(</span><span class="ident" id="4084178">clientHello</span><span class="op" id="4084189">.</span><span class="ident" id="4084190">ServerName</span><span class="op" id="4084200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084203">for</span>&nbsp;<span class="builtinfunc" id="4084207">len</span><span class="op" id="4084210">(</span><span class="ident" id="4084211">name</span><span class="op" id="4084215">)</span>&nbsp;<span class="op" id="4084217">&gt;</span>&nbsp;<span class="num" id="4084219">0</span>&nbsp;<span class="op" id="4084221">&amp;&amp;</span>&nbsp;<span class="ident" id="4084224">name</span><span class="op" id="4084228">[</span><span class="builtinfunc" id="4084229">len</span><span class="op" id="4084232">(</span><span class="ident" id="4084233">name</span><span class="op" id="4084237">)</span><span class="op" id="4084238">-</span><span class="num" id="4084239">1</span><span class="op" id="4084240">]</span>&nbsp;<span class="op" id="4084242">==</span>&nbsp;<span class="string" id="4084245">&#39;.&#39;</span>&nbsp;<span class="op" id="4084249">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084253">name</span>&nbsp;<span class="op" id="4084258">=</span>&nbsp;<span class="ident" id="4084260">name</span><span class="op" id="4084264">[</span><span class="op" id="4084265">:</span><span class="builtinfunc" id="4084266">len</span><span class="op" id="4084269">(</span><span class="ident" id="4084270">name</span><span class="op" id="4084274">)</span><span class="op" id="4084275">-</span><span class="num" id="4084276">1</span><span class="op" id="4084277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084284">if</span>&nbsp;<span class="ident" id="4084287">cert</span><span class="op" id="4084291">,</span>&nbsp;<span class="ident" id="4084293">ok</span>&nbsp;<span class="op" id="4084296">:=</span>&nbsp;<span class="ident" id="4084299">c</span><span class="op" id="4084300">.</span><span class="ident" id="4084301">NameToCertificate</span><span class="op" id="4084318">[</span><span class="ident" id="4084319">name</span><span class="op" id="4084323">]</span><span class="op" id="4084324">;</span>&nbsp;<span class="ident" id="4084326">ok</span>&nbsp;<span class="op" id="4084329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084333">return</span>&nbsp;<span class="ident" id="4084340">cert</span><span class="op" id="4084344">,</span>&nbsp;<span class="ident" id="4084346">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4084355">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4084422">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084433">labels</span>&nbsp;<span class="op" id="4084440">:=</span>&nbsp;<span class="ident" id="4084443">strings</span><span class="op" id="4084450">.</span><span class="ident" id="4084451">Split</span><span class="op" id="4084456">(</span><span class="ident" id="4084457">name</span><span class="op" id="4084461">,</span>&nbsp;<span class="string" id="4084463">&#34;.&#34;</span><span class="op" id="4084466">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084469">for</span>&nbsp;<span class="ident" id="4084473">i</span>&nbsp;<span class="op" id="4084475">:=</span>&nbsp;<span class="keyword" id="4084478">range</span>&nbsp;<span class="ident" id="4084484">labels</span>&nbsp;<span class="op" id="4084491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084495">labels</span><span class="op" id="4084501">[</span><span class="ident" id="4084502">i</span><span class="op" id="4084503">]</span>&nbsp;<span class="op" id="4084505">=</span>&nbsp;<span class="string" id="4084507">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084513">candidate</span>&nbsp;<span class="op" id="4084523">:=</span>&nbsp;<span class="ident" id="4084526">strings</span><span class="op" id="4084533">.</span><span class="ident" id="4084534">Join</span><span class="op" id="4084538">(</span><span class="ident" id="4084539">labels</span><span class="op" id="4084545">,</span>&nbsp;<span class="string" id="4084547">&#34;.&#34;</span><span class="op" id="4084550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084554">if</span>&nbsp;<span class="ident" id="4084557">cert</span><span class="op" id="4084561">,</span>&nbsp;<span class="ident" id="4084563">ok</span>&nbsp;<span class="op" id="4084566">:=</span>&nbsp;<span class="ident" id="4084569">c</span><span class="op" id="4084570">.</span><span class="ident" id="4084571">NameToCertificate</span><span class="op" id="4084588">[</span><span class="ident" id="4084589">candidate</span><span class="op" id="4084598">]</span><span class="op" id="4084599">;</span>&nbsp;<span class="ident" id="4084601">ok</span>&nbsp;<span class="op" id="4084604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084609">return</span>&nbsp;<span class="ident" id="4084616">cert</span><span class="op" id="4084620">,</span>&nbsp;<span class="ident" id="4084622">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4084635">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084689">return</span>&nbsp;<span class="op" id="4084696">&amp;</span><span class="ident" id="4084697">c</span><span class="op" id="4084698">.</span><span class="ident" id="4084699">Certificates</span><span class="op" id="4084711">[</span><span class="num" id="4084712">0</span><span class="op" id="4084713">]</span><span class="op" id="4084714">,</span>&nbsp;<span class="ident" id="4084716">nil</span><br>
<span class="lineno">465</span><span class="op" id="4084720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4084723">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4084802">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4084877">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4084894">func</span>&nbsp;<span class="op" id="4084899">(</span><span class="ident" id="4084900">c</span>&nbsp;<span class="op" id="4084902">*</span><span class="ident" id="4084903">Config</span><span class="op" id="4084909">)</span>&nbsp;<span class="ident" id="4084911">BuildNameToCertificate</span><span class="op" id="4084933">(</span><span class="op" id="4084934">)</span>&nbsp;<span class="op" id="4084936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084939">c</span><span class="op" id="4084940">.</span><span class="ident" id="4084941">NameToCertificate</span>&nbsp;<span class="op" id="4084959">=</span>&nbsp;<span class="builtinfunc" id="4084961">make</span><span class="op" id="4084965">(</span><span class="keyword" id="4084966">map</span><span class="op" id="4084969">[</span><span class="builtintype" id="4084970">string</span><span class="op" id="4084976">]</span><span class="op" id="4084977">*</span><span class="ident" id="4084978">Certificate</span><span class="op" id="4084989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084992">for</span>&nbsp;<span class="ident" id="4084996">i</span>&nbsp;<span class="op" id="4084998">:=</span>&nbsp;<span class="keyword" id="4085001">range</span>&nbsp;<span class="ident" id="4085007">c</span><span class="op" id="4085008">.</span><span class="ident" id="4085009">Certificates</span>&nbsp;<span class="op" id="4085022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085026">cert</span>&nbsp;<span class="op" id="4085031">:=</span>&nbsp;<span class="op" id="4085034">&amp;</span><span class="ident" id="4085035">c</span><span class="op" id="4085036">.</span><span class="ident" id="4085037">Certificates</span><span class="op" id="4085049">[</span><span class="ident" id="4085050">i</span><span class="op" id="4085051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085055">x509Cert</span><span class="op" id="4085063">,</span>&nbsp;<span class="ident" id="4085065">err</span>&nbsp;<span class="op" id="4085069">:=</span>&nbsp;<span class="ident" id="4085072">x509</span><span class="op" id="4085076">.</span><span class="ident" id="4085077">ParseCertificate</span><span class="op" id="4085093">(</span><span class="ident" id="4085094">cert</span><span class="op" id="4085098">.</span><span class="ident" id="4085099">Certificate</span><span class="op" id="4085110">[</span><span class="num" id="4085111">0</span><span class="op" id="4085112">]</span><span class="op" id="4085113">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085117">if</span>&nbsp;<span class="ident" id="4085120">err</span>&nbsp;<span class="op" id="4085124">!=</span>&nbsp;<span class="ident" id="4085127">nil</span>&nbsp;<span class="op" id="4085131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085136">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085151">if</span>&nbsp;<span class="builtinfunc" id="4085154">len</span><span class="op" id="4085157">(</span><span class="ident" id="4085158">x509Cert</span><span class="op" id="4085166">.</span><span class="ident" id="4085167">Subject</span><span class="op" id="4085174">.</span><span class="ident" id="4085175">CommonName</span><span class="op" id="4085185">)</span>&nbsp;<span class="op" id="4085187">&gt;</span>&nbsp;<span class="num" id="4085189">0</span>&nbsp;<span class="op" id="4085191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085196">c</span><span class="op" id="4085197">.</span><span class="ident" id="4085198">NameToCertificate</span><span class="op" id="4085215">[</span><span class="ident" id="4085216">x509Cert</span><span class="op" id="4085224">.</span><span class="ident" id="4085225">Subject</span><span class="op" id="4085232">.</span><span class="ident" id="4085233">CommonName</span><span class="op" id="4085243">]</span>&nbsp;<span class="op" id="4085245">=</span>&nbsp;<span class="ident" id="4085247">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085258">for</span>&nbsp;<span class="ident" id="4085262">_</span><span class="op" id="4085263">,</span>&nbsp;<span class="ident" id="4085265">san</span>&nbsp;<span class="op" id="4085269">:=</span>&nbsp;<span class="keyword" id="4085272">range</span>&nbsp;<span class="ident" id="4085278">x509Cert</span><span class="op" id="4085286">.</span><span class="ident" id="4085287">DNSNames</span>&nbsp;<span class="op" id="4085296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085301">c</span><span class="op" id="4085302">.</span><span class="ident" id="4085303">NameToCertificate</span><span class="op" id="4085320">[</span><span class="ident" id="4085321">san</span><span class="op" id="4085324">]</span>&nbsp;<span class="op" id="4085326">=</span>&nbsp;<span class="ident" id="4085328">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085338">}</span><br>
<span class="lineno">485</span><span class="op" id="4085340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4085343">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4085412">type</span>&nbsp;<span class="ident" id="4085417">Certificate</span>&nbsp;<span class="keyword" id="4085429">struct</span>&nbsp;<span class="op" id="4085436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085439">Certificate</span>&nbsp;<span class="op" id="4085451">[</span><span class="op" id="4085452">]</span><span class="op" id="4085453">[</span><span class="op" id="4085454">]</span><span class="builtintype" id="4085455">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085461">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085533">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085594">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085664">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085734">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085763">PrivateKey</span>&nbsp;<span class="ident" id="4085774">crypto</span><span class="op" id="4085780">.</span><span class="ident" id="4085781">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085793">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085864">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085896">OCSPStaple</span>&nbsp;<span class="op" id="4085907">[</span><span class="op" id="4085908">]</span><span class="builtintype" id="4085909">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085915">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4085981">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4086049">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4086121">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086168">Leaf</span>&nbsp;<span class="op" id="4086173">*</span><span class="ident" id="4086174">x509</span><span class="op" id="4086178">.</span><span class="ident" id="4086179">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4086191">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4086194">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4086211">type</span>&nbsp;<span class="ident" id="4086216">record</span>&nbsp;<span class="keyword" id="4086223">struct</span>&nbsp;<span class="op" id="4086230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086233">contentType</span>&nbsp;&nbsp;<span class="ident" id="4086246">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086258">major</span><span class="op" id="4086263">,</span>&nbsp;<span class="ident" id="4086265">minor</span>&nbsp;<span class="builtintype" id="4086271">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086278">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086291">[</span><span class="op" id="4086292">]</span><span class="builtintype" id="4086293">byte</span><br>
<span class="lineno"></span><span class="op" id="4086298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4086301">type</span>&nbsp;<span class="ident" id="4086306">handshakeMessage</span>&nbsp;<span class="keyword" id="4086323">interface</span>&nbsp;<span class="op" id="4086333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086336">marshal</span><span class="op" id="4086343">(</span><span class="op" id="4086344">)</span>&nbsp;<span class="op" id="4086346">[</span><span class="op" id="4086347">]</span><span class="builtintype" id="4086348">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086354">unmarshal</span><span class="op" id="4086363">(</span><span class="op" id="4086364">[</span><span class="op" id="4086365">]</span><span class="builtintype" id="4086366">byte</span><span class="op" id="4086370">)</span>&nbsp;<span class="builtintype" id="4086372">bool</span><br>
<span class="lineno"></span><span class="op" id="4086377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4086380">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4086455">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4086476">type</span>&nbsp;<span class="ident" id="4086481">lruSessionCache</span>&nbsp;<span class="keyword" id="4086497">struct</span>&nbsp;<span class="op" id="4086504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086507">sync</span><span class="op" id="4086511">.</span><span class="ident" id="4086512">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086520">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086529">map</span><span class="op" id="4086532">[</span><span class="builtintype" id="4086533">string</span><span class="op" id="4086539">]</span><span class="op" id="4086540">*</span><span class="ident" id="4086541">list</span><span class="op" id="4086545">.</span><span class="ident" id="4086546">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086555">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086564">*</span><span class="ident" id="4086565">list</span><span class="op" id="4086569">.</span><span class="ident" id="4086570">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086576">capacity</span>&nbsp;<span class="builtintype" id="4086585">int</span><br>
<span class="lineno"></span><span class="op" id="4086589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4086592">type</span>&nbsp;<span class="ident" id="4086597">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4086618">struct</span>&nbsp;<span class="op" id="4086625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086628">sessionKey</span>&nbsp;<span class="builtintype" id="4086639">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086647">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086658">*</span><span class="ident" id="4086659">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4086678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4086681">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4086753">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4086831">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4086851">func</span>&nbsp;<span class="ident" id="4086856">NewLRUClientSessionCache</span><span class="op" id="4086880">(</span><span class="ident" id="4086881">capacity</span>&nbsp;<span class="builtintype" id="4086890">int</span><span class="op" id="4086893">)</span>&nbsp;<span class="ident" id="4086895">ClientSessionCache</span>&nbsp;<span class="op" id="4086914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086917">const</span>&nbsp;<span class="ident" id="4086923">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4086951">=</span>&nbsp;<span class="num" id="4086953">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086958">if</span>&nbsp;<span class="ident" id="4086961">capacity</span>&nbsp;<span class="op" id="4086970">&lt;</span>&nbsp;<span class="num" id="4086972">1</span>&nbsp;<span class="op" id="4086974">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086978">capacity</span>&nbsp;<span class="op" id="4086987">=</span>&nbsp;<span class="ident" id="4086989">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087021">return</span>&nbsp;<span class="op" id="4087028">&amp;</span><span class="ident" id="4087029">lruSessionCache</span><span class="op" id="4087044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087048">m</span><span class="op" id="4087049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4087058">make</span><span class="op" id="4087062">(</span><span class="keyword" id="4087063">map</span><span class="op" id="4087066">[</span><span class="builtintype" id="4087067">string</span><span class="op" id="4087073">]</span><span class="op" id="4087074">*</span><span class="ident" id="4087075">list</span><span class="op" id="4087079">.</span><span class="ident" id="4087080">Element</span><span class="op" id="4087087">)</span><span class="op" id="4087088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087092">q</span><span class="op" id="4087093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087102">list</span><span class="op" id="4087106">.</span><span class="ident" id="4087107">New</span><span class="op" id="4087110">(</span><span class="op" id="4087111">)</span><span class="op" id="4087112">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087116">capacity</span><span class="op" id="4087124">:</span>&nbsp;<span class="ident" id="4087126">capacity</span><span class="op" id="4087134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087137">}</span><br>
<span class="lineno"></span><span class="op" id="4087139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4087142">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4087203">func</span>&nbsp;<span class="op" id="4087208">(</span><span class="ident" id="4087209">c</span>&nbsp;<span class="op" id="4087211">*</span><span class="ident" id="4087212">lruSessionCache</span><span class="op" id="4087227">)</span>&nbsp;<span class="ident" id="4087229">Put</span><span class="op" id="4087232">(</span><span class="ident" id="4087233">sessionKey</span>&nbsp;<span class="builtintype" id="4087244">string</span><span class="op" id="4087250">,</span>&nbsp;<span class="ident" id="4087252">cs</span>&nbsp;<span class="op" id="4087255">*</span><span class="ident" id="4087256">ClientSessionState</span><span class="op" id="4087274">)</span>&nbsp;<span class="op" id="4087276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087279">c</span><span class="op" id="4087280">.</span><span class="ident" id="4087281">Lock</span><span class="op" id="4087285">(</span><span class="op" id="4087286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087289">defer</span>&nbsp;<span class="ident" id="4087295">c</span><span class="op" id="4087296">.</span><span class="ident" id="4087297">Unlock</span><span class="op" id="4087303">(</span><span class="op" id="4087304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087308">if</span>&nbsp;<span class="ident" id="4087311">elem</span><span class="op" id="4087315">,</span>&nbsp;<span class="ident" id="4087317">ok</span>&nbsp;<span class="op" id="4087320">:=</span>&nbsp;<span class="ident" id="4087323">c</span><span class="op" id="4087324">.</span><span class="ident" id="4087325">m</span><span class="op" id="4087326">[</span><span class="ident" id="4087327">sessionKey</span><span class="op" id="4087337">]</span><span class="op" id="4087338">;</span>&nbsp;<span class="ident" id="4087340">ok</span>&nbsp;<span class="op" id="4087343">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087347">entry</span>&nbsp;<span class="op" id="4087353">:=</span>&nbsp;<span class="ident" id="4087356">elem</span><span class="op" id="4087360">.</span><span class="ident" id="4087361">Value</span><span class="op" id="4087366">.</span><span class="op" id="4087367">(</span><span class="op" id="4087368">*</span><span class="ident" id="4087369">lruSessionCacheEntry</span><span class="op" id="4087389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087393">entry</span><span class="op" id="4087398">.</span><span class="ident" id="4087399">state</span>&nbsp;<span class="op" id="4087405">=</span>&nbsp;<span class="ident" id="4087407">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087412">c</span><span class="op" id="4087413">.</span><span class="ident" id="4087414">q</span><span class="op" id="4087415">.</span><span class="ident" id="4087416">MoveToFront</span><span class="op" id="4087427">(</span><span class="ident" id="4087428">elem</span><span class="op" id="4087432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087436">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087444">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087448">if</span>&nbsp;<span class="ident" id="4087451">c</span><span class="op" id="4087452">.</span><span class="ident" id="4087453">q</span><span class="op" id="4087454">.</span><span class="ident" id="4087455">Len</span><span class="op" id="4087458">(</span><span class="op" id="4087459">)</span>&nbsp;<span class="op" id="4087461">&lt;</span>&nbsp;<span class="ident" id="4087463">c</span><span class="op" id="4087464">.</span><span class="ident" id="4087465">capacity</span>&nbsp;<span class="op" id="4087474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087478">entry</span>&nbsp;<span class="op" id="4087484">:=</span>&nbsp;<span class="op" id="4087487">&amp;</span><span class="ident" id="4087488">lruSessionCacheEntry</span><span class="op" id="4087508">{</span><span class="ident" id="4087509">sessionKey</span><span class="op" id="4087519">,</span>&nbsp;<span class="ident" id="4087521">cs</span><span class="op" id="4087523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087527">c</span><span class="op" id="4087528">.</span><span class="ident" id="4087529">m</span><span class="op" id="4087530">[</span><span class="ident" id="4087531">sessionKey</span><span class="op" id="4087541">]</span>&nbsp;<span class="op" id="4087543">=</span>&nbsp;<span class="ident" id="4087545">c</span><span class="op" id="4087546">.</span><span class="ident" id="4087547">q</span><span class="op" id="4087548">.</span><span class="ident" id="4087549">PushFront</span><span class="op" id="4087558">(</span><span class="ident" id="4087559">entry</span><span class="op" id="4087564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087568">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087580">elem</span>&nbsp;<span class="op" id="4087585">:=</span>&nbsp;<span class="ident" id="4087588">c</span><span class="op" id="4087589">.</span><span class="ident" id="4087590">q</span><span class="op" id="4087591">.</span><span class="ident" id="4087592">Back</span><span class="op" id="4087596">(</span><span class="op" id="4087597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087600">entry</span>&nbsp;<span class="op" id="4087606">:=</span>&nbsp;<span class="ident" id="4087609">elem</span><span class="op" id="4087613">.</span><span class="ident" id="4087614">Value</span><span class="op" id="4087619">.</span><span class="op" id="4087620">(</span><span class="op" id="4087621">*</span><span class="ident" id="4087622">lruSessionCacheEntry</span><span class="op" id="4087642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4087645">delete</span><span class="op" id="4087651">(</span><span class="ident" id="4087652">c</span><span class="op" id="4087653">.</span><span class="ident" id="4087654">m</span><span class="op" id="4087655">,</span>&nbsp;<span class="ident" id="4087657">entry</span><span class="op" id="4087662">.</span><span class="ident" id="4087663">sessionKey</span><span class="op" id="4087673">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087676">entry</span><span class="op" id="4087681">.</span><span class="ident" id="4087682">sessionKey</span>&nbsp;<span class="op" id="4087693">=</span>&nbsp;<span class="ident" id="4087695">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087707">entry</span><span class="op" id="4087712">.</span><span class="ident" id="4087713">state</span>&nbsp;<span class="op" id="4087719">=</span>&nbsp;<span class="ident" id="4087721">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087725">c</span><span class="op" id="4087726">.</span><span class="ident" id="4087727">q</span><span class="op" id="4087728">.</span><span class="ident" id="4087729">MoveToFront</span><span class="op" id="4087740">(</span><span class="ident" id="4087741">elem</span><span class="op" id="4087745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087748">c</span><span class="op" id="4087749">.</span><span class="ident" id="4087750">m</span><span class="op" id="4087751">[</span><span class="ident" id="4087752">sessionKey</span><span class="op" id="4087762">]</span>&nbsp;<span class="op" id="4087764">=</span>&nbsp;<span class="ident" id="4087766">elem</span><br>
<span class="lineno"></span><span class="op" id="4087771">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4087774">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4087850">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4087896">func</span>&nbsp;<span class="op" id="4087901">(</span><span class="ident" id="4087902">c</span>&nbsp;<span class="op" id="4087904">*</span><span class="ident" id="4087905">lruSessionCache</span><span class="op" id="4087920">)</span>&nbsp;<span class="ident" id="4087922">Get</span><span class="op" id="4087925">(</span><span class="ident" id="4087926">sessionKey</span>&nbsp;<span class="builtintype" id="4087937">string</span><span class="op" id="4087943">)</span>&nbsp;<span class="op" id="4087945">(</span><span class="op" id="4087946">*</span><span class="ident" id="4087947">ClientSessionState</span><span class="op" id="4087965">,</span>&nbsp;<span class="builtintype" id="4087967">bool</span><span class="op" id="4087971">)</span>&nbsp;<span class="op" id="4087973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087976">c</span><span class="op" id="4087977">.</span><span class="ident" id="4087978">Lock</span><span class="op" id="4087982">(</span><span class="op" id="4087983">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087986">defer</span>&nbsp;<span class="ident" id="4087992">c</span><span class="op" id="4087993">.</span><span class="ident" id="4087994">Unlock</span><span class="op" id="4088000">(</span><span class="op" id="4088001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088005">if</span>&nbsp;<span class="ident" id="4088008">elem</span><span class="op" id="4088012">,</span>&nbsp;<span class="ident" id="4088014">ok</span>&nbsp;<span class="op" id="4088017">:=</span>&nbsp;<span class="ident" id="4088020">c</span><span class="op" id="4088021">.</span><span class="ident" id="4088022">m</span><span class="op" id="4088023">[</span><span class="ident" id="4088024">sessionKey</span><span class="op" id="4088034">]</span><span class="op" id="4088035">;</span>&nbsp;<span class="ident" id="4088037">ok</span>&nbsp;<span class="op" id="4088040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088044">c</span><span class="op" id="4088045">.</span><span class="ident" id="4088046">q</span><span class="op" id="4088047">.</span><span class="ident" id="4088048">MoveToFront</span><span class="op" id="4088059">(</span><span class="ident" id="4088060">elem</span><span class="op" id="4088064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088068">return</span>&nbsp;<span class="ident" id="4088075">elem</span><span class="op" id="4088079">.</span><span class="ident" id="4088080">Value</span><span class="op" id="4088085">.</span><span class="op" id="4088086">(</span><span class="op" id="4088087">*</span><span class="ident" id="4088088">lruSessionCacheEntry</span><span class="op" id="4088108">)</span><span class="op" id="4088109">.</span><span class="ident" id="4088110">state</span><span class="op" id="4088115">,</span>&nbsp;<span class="builtintype" id="4088117">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088126">return</span>&nbsp;<span class="ident" id="4088133">nil</span><span class="op" id="4088136">,</span>&nbsp;<span class="builtintype" id="4088138">false</span><br>
<span class="lineno"></span><span class="op" id="4088144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4088147">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4088220">type</span>&nbsp;<span class="ident" id="4088225">dsaSignature</span>&nbsp;<span class="keyword" id="4088238">struct</span>&nbsp;<span class="op" id="4088245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088248">R</span><span class="op" id="4088249">,</span>&nbsp;<span class="ident" id="4088251">S</span>&nbsp;<span class="op" id="4088253">*</span><span class="ident" id="4088254">big</span><span class="op" id="4088257">.</span><span class="ident" id="4088258">Int</span><br>
<span class="lineno"></span><span class="op" id="4088262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088265">type</span>&nbsp;<span class="ident" id="4088270">ecdsaSignature</span>&nbsp;<span class="ident" id="4088285">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4088299">var</span>&nbsp;<span class="ident" id="4088303">emptyConfig</span>&nbsp;<span class="ident" id="4088315">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088323">func</span>&nbsp;<span class="ident" id="4088328">defaultConfig</span><span class="op" id="4088341">(</span><span class="op" id="4088342">)</span>&nbsp;<span class="op" id="4088344">*</span><span class="ident" id="4088345">Config</span>&nbsp;<span class="op" id="4088352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088355">return</span>&nbsp;<span class="op" id="4088362">&amp;</span><span class="ident" id="4088363">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4088375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088378">var</span>&nbsp;<span class="op" id="4088382">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088385">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088408">sync</span><span class="op" id="4088412">.</span><span class="ident" id="4088413">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088419">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4088442">[</span><span class="op" id="4088443">]</span><span class="builtintype" id="4088444">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4088451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088454">func</span>&nbsp;<span class="ident" id="4088459">defaultCipherSuites</span><span class="op" id="4088478">(</span><span class="op" id="4088479">)</span>&nbsp;<span class="op" id="4088481">[</span><span class="op" id="4088482">]</span><span class="builtintype" id="4088483">uint16</span>&nbsp;<span class="op" id="4088490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088493">once</span><span class="op" id="4088497">.</span><span class="ident" id="4088498">Do</span><span class="op" id="4088500">(</span><span class="ident" id="4088501">initDefaultCipherSuites</span><span class="op" id="4088524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088527">return</span>&nbsp;<span class="ident" id="4088534">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4088557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088560">func</span>&nbsp;<span class="ident" id="4088565">initDefaultCipherSuites</span><span class="op" id="4088588">(</span><span class="op" id="4088589">)</span>&nbsp;<span class="op" id="4088591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088594">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4088617">=</span>&nbsp;<span class="builtinfunc" id="4088619">make</span><span class="op" id="4088623">(</span><span class="op" id="4088624">[</span><span class="op" id="4088625">]</span><span class="builtintype" id="4088626">uint16</span><span class="op" id="4088632">,</span>&nbsp;<span class="builtinfunc" id="4088634">len</span><span class="op" id="4088637">(</span><span class="ident" id="4088638">cipherSuites</span><span class="op" id="4088650">)</span><span class="op" id="4088651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088654">for</span>&nbsp;<span class="ident" id="4088658">i</span><span class="op" id="4088659">,</span>&nbsp;<span class="ident" id="4088661">suite</span>&nbsp;<span class="op" id="4088667">:=</span>&nbsp;<span class="keyword" id="4088670">range</span>&nbsp;<span class="ident" id="4088676">cipherSuites</span>&nbsp;<span class="op" id="4088689">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088693">varDefaultCipherSuites</span><span class="op" id="4088715">[</span><span class="ident" id="4088716">i</span><span class="op" id="4088717">]</span>&nbsp;<span class="op" id="4088719">=</span>&nbsp;<span class="ident" id="4088721">suite</span><span class="op" id="4088726">.</span><span class="ident" id="4088727">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088731">}</span><br>
<span class="lineno"></span><span class="op" id="4088733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4088736">func</span>&nbsp;<span class="ident" id="4088741">unexpectedMessageError</span><span class="op" id="4088763">(</span><span class="ident" id="4088764">wanted</span><span class="op" id="4088770">,</span>&nbsp;<span class="ident" id="4088772">got</span>&nbsp;<span class="keyword" id="4088776">interface</span><span class="op" id="4088785">{</span><span class="op" id="4088786">}</span><span class="op" id="4088787">)</span>&nbsp;<span class="builtintype" id="4088789">error</span>&nbsp;<span class="op" id="4088795">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088798">return</span>&nbsp;<span class="ident" id="4088805">fmt</span><span class="op" id="4088808">.</span><span class="ident" id="4088809">Errorf</span><span class="op" id="4088815">(</span><span class="string" id="4088816">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4088891">,</span>&nbsp;<span class="ident" id="4088893">got</span><span class="op" id="4088896">,</span>&nbsp;<span class="ident" id="4088898">wanted</span><span class="op" id="4088904">)</span><br>
<span class="lineno"></span><span class="op" id="4088906">}</span>
</div>
</body>
</html>
