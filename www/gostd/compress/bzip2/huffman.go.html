<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6293513">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6293568">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6293622">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6293673">package</span>&nbsp;<span class="ident" id="6293681">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6293688">import</span>&nbsp;<span class="string" id="6293695">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6293703">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="6293779">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6293790">type</span>&nbsp;<span class="ident" id="6293795">huffmanTree</span>&nbsp;<span class="keyword" id="6293807">struct</span>&nbsp;<span class="op" id="6293814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6293817">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6293888">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6293961">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294017">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6294026">[</span><span class="op" id="6294027">]</span><span class="ident" id="6294028">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294041">nextNode</span>&nbsp;<span class="builtintype" id="6294050">int</span><br>
<span class="lineno"></span><span class="op" id="6294054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6294057">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6294137">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6294217">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="6294277">//</span><br>
<span class="lineno"></span><span class="comment" id="6294280">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6294357">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="6294435">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6294485">type</span>&nbsp;<span class="ident" id="6294490">huffmanNode</span>&nbsp;<span class="keyword" id="6294502">struct</span>&nbsp;<span class="op" id="6294509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294512">left</span><span class="op" id="6294516">,</span>&nbsp;<span class="ident" id="6294518">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6294534">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294542">leftValue</span><span class="op" id="6294551">,</span>&nbsp;<span class="ident" id="6294553">rightValue</span>&nbsp;<span class="builtintype" id="6294564">uint16</span><br>
<span class="lineno"></span><span class="op" id="6294571">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6294574">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="6294651">const</span>&nbsp;<span class="ident" id="6294657">invalidNodeValue</span>&nbsp;<span class="op" id="6294674">=</span>&nbsp;<span class="num" id="6294676">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6294684">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="6294761">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6294781">func</span>&nbsp;<span class="op" id="6294786">(</span><span class="ident" id="6294787">t</span>&nbsp;<span class="op" id="6294789">*</span><span class="ident" id="6294790">huffmanTree</span><span class="op" id="6294801">)</span>&nbsp;<span class="ident" id="6294803">Decode</span><span class="op" id="6294809">(</span><span class="ident" id="6294810">br</span>&nbsp;<span class="op" id="6294813">*</span><span class="ident" id="6294814">bitReader</span><span class="op" id="6294823">)</span>&nbsp;<span class="op" id="6294825">(</span><span class="ident" id="6294826">v</span>&nbsp;<span class="builtintype" id="6294828">uint16</span><span class="op" id="6294834">)</span>&nbsp;<span class="op" id="6294836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294839">nodeIndex</span>&nbsp;<span class="op" id="6294849">:=</span>&nbsp;<span class="builtintype" id="6294852">uint16</span><span class="op" id="6294858">(</span><span class="num" id="6294859">0</span><span class="op" id="6294860">)</span>&nbsp;<span class="comment" id="6294862">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6294899">for</span>&nbsp;<span class="op" id="6294903">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294907">node</span>&nbsp;<span class="op" id="6294912">:=</span>&nbsp;<span class="op" id="6294915">&amp;</span><span class="ident" id="6294916">t</span><span class="op" id="6294917">.</span><span class="ident" id="6294918">nodes</span><span class="op" id="6294923">[</span><span class="ident" id="6294924">nodeIndex</span><span class="op" id="6294933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294937">bit</span><span class="op" id="6294940">,</span>&nbsp;<span class="ident" id="6294942">ok</span>&nbsp;<span class="op" id="6294945">:=</span>&nbsp;<span class="ident" id="6294948">br</span><span class="op" id="6294950">.</span><span class="ident" id="6294951">TryReadBit</span><span class="op" id="6294961">(</span><span class="op" id="6294962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6294966">if</span>&nbsp;<span class="op" id="6294969">!</span><span class="ident" id="6294970">ok</span>&nbsp;<span class="op" id="6294973">&amp;&amp;</span>&nbsp;<span class="ident" id="6294976">br</span><span class="op" id="6294978">.</span><span class="ident" id="6294979">ReadBit</span><span class="op" id="6294986">(</span><span class="op" id="6294987">)</span>&nbsp;<span class="op" id="6294989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294994">bit</span>&nbsp;<span class="op" id="6294998">=</span>&nbsp;<span class="num" id="6295000">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295004">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295008">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295047">if</span>&nbsp;<span class="ident" id="6295050">bit</span>&nbsp;<span class="op" id="6295054">!=</span>&nbsp;<span class="num" id="6295057">0</span>&nbsp;<span class="op" id="6295059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295064">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295075">if</span>&nbsp;<span class="ident" id="6295078">node</span><span class="op" id="6295082">.</span><span class="ident" id="6295083">left</span>&nbsp;<span class="op" id="6295088">==</span>&nbsp;<span class="ident" id="6295091">invalidNodeValue</span>&nbsp;<span class="op" id="6295108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295114">return</span>&nbsp;<span class="ident" id="6295121">node</span><span class="op" id="6295125">.</span><span class="ident" id="6295126">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295144">nodeIndex</span>&nbsp;<span class="op" id="6295154">=</span>&nbsp;<span class="ident" id="6295156">node</span><span class="op" id="6295160">.</span><span class="ident" id="6295161">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295168">}</span>&nbsp;<span class="keyword" id="6295170">else</span>&nbsp;<span class="op" id="6295175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295180">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295192">if</span>&nbsp;<span class="ident" id="6295195">node</span><span class="op" id="6295199">.</span><span class="ident" id="6295200">right</span>&nbsp;<span class="op" id="6295206">==</span>&nbsp;<span class="ident" id="6295209">invalidNodeValue</span>&nbsp;<span class="op" id="6295226">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295232">return</span>&nbsp;<span class="ident" id="6295239">node</span><span class="op" id="6295243">.</span><span class="ident" id="6295244">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295263">nodeIndex</span>&nbsp;<span class="op" id="6295273">=</span>&nbsp;<span class="ident" id="6295275">node</span><span class="op" id="6295279">.</span><span class="ident" id="6295280">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295291">}</span><br>
<span class="lineno">60</span><span class="op" id="6295293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6295296">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6295369">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6295432">func</span>&nbsp;<span class="ident" id="6295437">newHuffmanTree</span><span class="op" id="6295451">(</span><span class="ident" id="6295452">lengths</span>&nbsp;<span class="op" id="6295460">[</span><span class="op" id="6295461">]</span><span class="builtintype" id="6295462">uint8</span><span class="op" id="6295467">)</span>&nbsp;<span class="op" id="6295469">(</span><span class="ident" id="6295470">huffmanTree</span><span class="op" id="6295481">,</span>&nbsp;<span class="builtintype" id="6295483">error</span><span class="op" id="6295488">)</span>&nbsp;<span class="op" id="6295490">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295493">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295563">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295628">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295690">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295758">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295829">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295899">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295938">if</span>&nbsp;<span class="builtinfunc" id="6295941">len</span><span class="op" id="6295944">(</span><span class="ident" id="6295945">lengths</span><span class="op" id="6295952">)</span>&nbsp;<span class="op" id="6295954">&lt;</span>&nbsp;<span class="num" id="6295956">2</span>&nbsp;<span class="op" id="6295958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6295962">panic</span><span class="op" id="6295967">(</span><span class="string" id="6295968">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="6296001">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296008">var</span>&nbsp;<span class="ident" id="6296012">t</span>&nbsp;<span class="ident" id="6296014">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296028">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296100">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296142">pairs</span>&nbsp;<span class="op" id="6296148">:=</span>&nbsp;<span class="ident" id="6296151">huffmanSymbolLengthPairs</span><span class="op" id="6296175">(</span><span class="builtinfunc" id="6296176">make</span><span class="op" id="6296180">(</span><span class="op" id="6296181">[</span><span class="op" id="6296182">]</span><span class="ident" id="6296183">huffmanSymbolLengthPair</span><span class="op" id="6296206">,</span>&nbsp;<span class="builtinfunc" id="6296208">len</span><span class="op" id="6296211">(</span><span class="ident" id="6296212">lengths</span><span class="op" id="6296219">)</span><span class="op" id="6296220">)</span><span class="op" id="6296221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296224">for</span>&nbsp;<span class="ident" id="6296228">i</span><span class="op" id="6296229">,</span>&nbsp;<span class="ident" id="6296231">length</span>&nbsp;<span class="op" id="6296238">:=</span>&nbsp;<span class="keyword" id="6296241">range</span>&nbsp;<span class="ident" id="6296247">lengths</span>&nbsp;<span class="op" id="6296255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296259">pairs</span><span class="op" id="6296264">[</span><span class="ident" id="6296265">i</span><span class="op" id="6296266">]</span><span class="op" id="6296267">.</span><span class="ident" id="6296268">value</span>&nbsp;<span class="op" id="6296274">=</span>&nbsp;<span class="builtintype" id="6296276">uint16</span><span class="op" id="6296282">(</span><span class="ident" id="6296283">i</span><span class="op" id="6296284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296288">pairs</span><span class="op" id="6296293">[</span><span class="ident" id="6296294">i</span><span class="op" id="6296295">]</span><span class="op" id="6296296">.</span><span class="ident" id="6296297">length</span>&nbsp;<span class="op" id="6296304">=</span>&nbsp;<span class="ident" id="6296306">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296318">sort</span><span class="op" id="6296322">.</span><span class="ident" id="6296323">Sort</span><span class="op" id="6296327">(</span><span class="ident" id="6296328">pairs</span><span class="op" id="6296333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296337">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296409">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296482">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296554">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296575">code</span>&nbsp;<span class="op" id="6296580">:=</span>&nbsp;<span class="builtintype" id="6296583">uint32</span><span class="op" id="6296589">(</span><span class="num" id="6296590">0</span><span class="op" id="6296591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296594">length</span>&nbsp;<span class="op" id="6296601">:=</span>&nbsp;<span class="builtintype" id="6296604">uint8</span><span class="op" id="6296609">(</span><span class="num" id="6296610">32</span><span class="op" id="6296612">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296616">codes</span>&nbsp;<span class="op" id="6296622">:=</span>&nbsp;<span class="ident" id="6296625">huffmanCodes</span><span class="op" id="6296637">(</span><span class="builtinfunc" id="6296638">make</span><span class="op" id="6296642">(</span><span class="op" id="6296643">[</span><span class="op" id="6296644">]</span><span class="ident" id="6296645">huffmanCode</span><span class="op" id="6296656">,</span>&nbsp;<span class="builtinfunc" id="6296658">len</span><span class="op" id="6296661">(</span><span class="ident" id="6296662">lengths</span><span class="op" id="6296669">)</span><span class="op" id="6296670">)</span><span class="op" id="6296671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296674">for</span>&nbsp;<span class="ident" id="6296678">i</span>&nbsp;<span class="op" id="6296680">:=</span>&nbsp;<span class="builtinfunc" id="6296683">len</span><span class="op" id="6296686">(</span><span class="ident" id="6296687">pairs</span><span class="op" id="6296692">)</span>&nbsp;<span class="op" id="6296694">-</span>&nbsp;<span class="num" id="6296696">1</span><span class="op" id="6296697">;</span>&nbsp;<span class="ident" id="6296699">i</span>&nbsp;<span class="op" id="6296701">&gt;=</span>&nbsp;<span class="num" id="6296704">0</span><span class="op" id="6296705">;</span>&nbsp;<span class="ident" id="6296707">i</span><span class="op" id="6296708">--</span>&nbsp;<span class="op" id="6296711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296715">if</span>&nbsp;<span class="ident" id="6296718">length</span>&nbsp;<span class="op" id="6296725">&gt;</span>&nbsp;<span class="ident" id="6296727">pairs</span><span class="op" id="6296732">[</span><span class="ident" id="6296733">i</span><span class="op" id="6296734">]</span><span class="op" id="6296735">.</span><span class="ident" id="6296736">length</span>&nbsp;<span class="op" id="6296743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296748">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296804">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296852">length</span>&nbsp;<span class="op" id="6296859">&gt;&gt;=</span>&nbsp;<span class="num" id="6296863">32</span>&nbsp;<span class="op" id="6296866">-</span>&nbsp;<span class="ident" id="6296868">pairs</span><span class="op" id="6296873">[</span><span class="ident" id="6296874">i</span><span class="op" id="6296875">]</span><span class="op" id="6296876">.</span><span class="ident" id="6296877">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296887">length</span>&nbsp;<span class="op" id="6296894">&lt;&lt;=</span>&nbsp;<span class="num" id="6296898">32</span>&nbsp;<span class="op" id="6296901">-</span>&nbsp;<span class="ident" id="6296903">pairs</span><span class="op" id="6296908">[</span><span class="ident" id="6296909">i</span><span class="op" id="6296910">]</span><span class="op" id="6296911">.</span><span class="ident" id="6296912">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296922">length</span>&nbsp;<span class="op" id="6296929">=</span>&nbsp;<span class="ident" id="6296931">pairs</span><span class="op" id="6296936">[</span><span class="ident" id="6296937">i</span><span class="op" id="6296938">]</span><span class="op" id="6296939">.</span><span class="ident" id="6296940">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296949">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296953">codes</span><span class="op" id="6296958">[</span><span class="ident" id="6296959">i</span><span class="op" id="6296960">]</span><span class="op" id="6296961">.</span><span class="ident" id="6296962">code</span>&nbsp;<span class="op" id="6296967">=</span>&nbsp;<span class="ident" id="6296969">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296976">codes</span><span class="op" id="6296981">[</span><span class="ident" id="6296982">i</span><span class="op" id="6296983">]</span><span class="op" id="6296984">.</span><span class="ident" id="6296985">codeLen</span>&nbsp;<span class="op" id="6296993">=</span>&nbsp;<span class="ident" id="6296995">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297004">codes</span><span class="op" id="6297009">[</span><span class="ident" id="6297010">i</span><span class="op" id="6297011">]</span><span class="op" id="6297012">.</span><span class="ident" id="6297013">value</span>&nbsp;<span class="op" id="6297019">=</span>&nbsp;<span class="ident" id="6297021">pairs</span><span class="op" id="6297026">[</span><span class="ident" id="6297027">i</span><span class="op" id="6297028">]</span><span class="op" id="6297029">.</span><span class="ident" id="6297030">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297038">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297104">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297137">code</span>&nbsp;<span class="op" id="6297142">+=</span>&nbsp;<span class="num" id="6297145">1</span>&nbsp;<span class="op" id="6297147">&lt;&lt;</span>&nbsp;<span class="op" id="6297150">(</span><span class="num" id="6297151">32</span>&nbsp;<span class="op" id="6297154">-</span>&nbsp;<span class="ident" id="6297156">length</span><span class="op" id="6297162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6297165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297169">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297242">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297277">sort</span><span class="op" id="6297281">.</span><span class="ident" id="6297282">Sort</span><span class="op" id="6297286">(</span><span class="ident" id="6297287">codes</span><span class="op" id="6297292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297296">t</span><span class="op" id="6297297">.</span><span class="ident" id="6297298">nodes</span>&nbsp;<span class="op" id="6297304">=</span>&nbsp;<span class="builtinfunc" id="6297306">make</span><span class="op" id="6297310">(</span><span class="op" id="6297311">[</span><span class="op" id="6297312">]</span><span class="ident" id="6297313">huffmanNode</span><span class="op" id="6297324">,</span>&nbsp;<span class="builtinfunc" id="6297326">len</span><span class="op" id="6297329">(</span><span class="ident" id="6297330">codes</span><span class="op" id="6297335">)</span><span class="op" id="6297336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297339">_</span><span class="op" id="6297340">,</span>&nbsp;<span class="ident" id="6297342">err</span>&nbsp;<span class="op" id="6297346">:=</span>&nbsp;<span class="ident" id="6297349">buildHuffmanNode</span><span class="op" id="6297365">(</span><span class="op" id="6297366">&amp;</span><span class="ident" id="6297367">t</span><span class="op" id="6297368">,</span>&nbsp;<span class="ident" id="6297370">codes</span><span class="op" id="6297375">,</span>&nbsp;<span class="num" id="6297377">0</span><span class="op" id="6297378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297381">return</span>&nbsp;<span class="ident" id="6297388">t</span><span class="op" id="6297389">,</span>&nbsp;<span class="ident" id="6297391">err</span><br>
<span class="lineno">120</span><span class="op" id="6297395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297398">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6297464">type</span>&nbsp;<span class="ident" id="6297469">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="6297493">struct</span>&nbsp;<span class="op" id="6297500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297503">value</span>&nbsp;&nbsp;<span class="builtintype" id="6297510">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297518">length</span>&nbsp;<span class="builtintype" id="6297525">uint8</span><br>
<span class="lineno"></span><span class="op" id="6297531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297534">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="6297606">type</span>&nbsp;<span class="ident" id="6297611">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="6297636">[</span><span class="op" id="6297637">]</span><span class="ident" id="6297638">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6297663">func</span>&nbsp;<span class="op" id="6297668">(</span><span class="ident" id="6297669">h</span>&nbsp;<span class="ident" id="6297671">huffmanSymbolLengthPairs</span><span class="op" id="6297695">)</span>&nbsp;<span class="ident" id="6297697">Len</span><span class="op" id="6297700">(</span><span class="op" id="6297701">)</span>&nbsp;<span class="builtintype" id="6297703">int</span>&nbsp;<span class="op" id="6297707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297710">return</span>&nbsp;<span class="builtinfunc" id="6297717">len</span><span class="op" id="6297720">(</span><span class="ident" id="6297721">h</span><span class="op" id="6297722">)</span><br>
<span class="lineno"></span><span class="op" id="6297724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6297727">func</span>&nbsp;<span class="op" id="6297732">(</span><span class="ident" id="6297733">h</span>&nbsp;<span class="ident" id="6297735">huffmanSymbolLengthPairs</span><span class="op" id="6297759">)</span>&nbsp;<span class="ident" id="6297761">Less</span><span class="op" id="6297765">(</span><span class="ident" id="6297766">i</span><span class="op" id="6297767">,</span>&nbsp;<span class="ident" id="6297769">j</span>&nbsp;<span class="builtintype" id="6297771">int</span><span class="op" id="6297774">)</span>&nbsp;<span class="builtintype" id="6297776">bool</span>&nbsp;<span class="op" id="6297781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297784">if</span>&nbsp;<span class="ident" id="6297787">h</span><span class="op" id="6297788">[</span><span class="ident" id="6297789">i</span><span class="op" id="6297790">]</span><span class="op" id="6297791">.</span><span class="ident" id="6297792">length</span>&nbsp;<span class="op" id="6297799">&lt;</span>&nbsp;<span class="ident" id="6297801">h</span><span class="op" id="6297802">[</span><span class="ident" id="6297803">j</span><span class="op" id="6297804">]</span><span class="op" id="6297805">.</span><span class="ident" id="6297806">length</span>&nbsp;<span class="op" id="6297813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297817">return</span>&nbsp;<span class="builtintype" id="6297824">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6297830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297833">if</span>&nbsp;<span class="ident" id="6297836">h</span><span class="op" id="6297837">[</span><span class="ident" id="6297838">i</span><span class="op" id="6297839">]</span><span class="op" id="6297840">.</span><span class="ident" id="6297841">length</span>&nbsp;<span class="op" id="6297848">&gt;</span>&nbsp;<span class="ident" id="6297850">h</span><span class="op" id="6297851">[</span><span class="ident" id="6297852">j</span><span class="op" id="6297853">]</span><span class="op" id="6297854">.</span><span class="ident" id="6297855">length</span>&nbsp;<span class="op" id="6297862">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297866">return</span>&nbsp;<span class="builtintype" id="6297873">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6297880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297883">if</span>&nbsp;<span class="ident" id="6297886">h</span><span class="op" id="6297887">[</span><span class="ident" id="6297888">i</span><span class="op" id="6297889">]</span><span class="op" id="6297890">.</span><span class="ident" id="6297891">value</span>&nbsp;<span class="op" id="6297897">&lt;</span>&nbsp;<span class="ident" id="6297899">h</span><span class="op" id="6297900">[</span><span class="ident" id="6297901">j</span><span class="op" id="6297902">]</span><span class="op" id="6297903">.</span><span class="ident" id="6297904">value</span>&nbsp;<span class="op" id="6297910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297914">return</span>&nbsp;<span class="builtintype" id="6297921">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6297927">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297930">return</span>&nbsp;<span class="builtintype" id="6297937">false</span><br>
<span class="lineno"></span><span class="op" id="6297943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297946">func</span>&nbsp;<span class="op" id="6297951">(</span><span class="ident" id="6297952">h</span>&nbsp;<span class="ident" id="6297954">huffmanSymbolLengthPairs</span><span class="op" id="6297978">)</span>&nbsp;<span class="ident" id="6297980">Swap</span><span class="op" id="6297984">(</span><span class="ident" id="6297985">i</span><span class="op" id="6297986">,</span>&nbsp;<span class="ident" id="6297988">j</span>&nbsp;<span class="builtintype" id="6297990">int</span><span class="op" id="6297993">)</span>&nbsp;<span class="op" id="6297995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297998">h</span><span class="op" id="6297999">[</span><span class="ident" id="6298000">i</span><span class="op" id="6298001">]</span><span class="op" id="6298002">,</span>&nbsp;<span class="ident" id="6298004">h</span><span class="op" id="6298005">[</span><span class="ident" id="6298006">j</span><span class="op" id="6298007">]</span>&nbsp;<span class="op" id="6298009">=</span>&nbsp;<span class="ident" id="6298011">h</span><span class="op" id="6298012">[</span><span class="ident" id="6298013">j</span><span class="op" id="6298014">]</span><span class="op" id="6298015">,</span>&nbsp;<span class="ident" id="6298017">h</span><span class="op" id="6298018">[</span><span class="ident" id="6298019">i</span><span class="op" id="6298020">]</span><br>
<span class="lineno">150</span><span class="op" id="6298022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298025">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6298085">type</span>&nbsp;<span class="ident" id="6298090">huffmanCode</span>&nbsp;<span class="keyword" id="6298102">struct</span>&nbsp;<span class="op" id="6298109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298112">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6298120">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298128">codeLen</span>&nbsp;<span class="builtintype" id="6298136">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298143">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6298151">uint16</span><br>
<span class="lineno"></span><span class="op" id="6298158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298161">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="6298222">type</span>&nbsp;<span class="ident" id="6298227">huffmanCodes</span>&nbsp;<span class="op" id="6298240">[</span><span class="op" id="6298241">]</span><span class="ident" id="6298242">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298255">func</span>&nbsp;<span class="op" id="6298260">(</span><span class="ident" id="6298261">n</span>&nbsp;<span class="ident" id="6298263">huffmanCodes</span><span class="op" id="6298275">)</span>&nbsp;<span class="ident" id="6298277">Len</span><span class="op" id="6298280">(</span><span class="op" id="6298281">)</span>&nbsp;<span class="builtintype" id="6298283">int</span>&nbsp;<span class="op" id="6298287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298290">return</span>&nbsp;<span class="builtinfunc" id="6298297">len</span><span class="op" id="6298300">(</span><span class="ident" id="6298301">n</span><span class="op" id="6298302">)</span><br>
<span class="lineno"></span><span class="op" id="6298304">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6298307">func</span>&nbsp;<span class="op" id="6298312">(</span><span class="ident" id="6298313">n</span>&nbsp;<span class="ident" id="6298315">huffmanCodes</span><span class="op" id="6298327">)</span>&nbsp;<span class="ident" id="6298329">Less</span><span class="op" id="6298333">(</span><span class="ident" id="6298334">i</span><span class="op" id="6298335">,</span>&nbsp;<span class="ident" id="6298337">j</span>&nbsp;<span class="builtintype" id="6298339">int</span><span class="op" id="6298342">)</span>&nbsp;<span class="builtintype" id="6298344">bool</span>&nbsp;<span class="op" id="6298349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298352">return</span>&nbsp;<span class="ident" id="6298359">n</span><span class="op" id="6298360">[</span><span class="ident" id="6298361">i</span><span class="op" id="6298362">]</span><span class="op" id="6298363">.</span><span class="ident" id="6298364">code</span>&nbsp;<span class="op" id="6298369">&lt;</span>&nbsp;<span class="ident" id="6298371">n</span><span class="op" id="6298372">[</span><span class="ident" id="6298373">j</span><span class="op" id="6298374">]</span><span class="op" id="6298375">.</span><span class="ident" id="6298376">code</span><br>
<span class="lineno"></span><span class="op" id="6298381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6298384">func</span>&nbsp;<span class="op" id="6298389">(</span><span class="ident" id="6298390">n</span>&nbsp;<span class="ident" id="6298392">huffmanCodes</span><span class="op" id="6298404">)</span>&nbsp;<span class="ident" id="6298406">Swap</span><span class="op" id="6298410">(</span><span class="ident" id="6298411">i</span><span class="op" id="6298412">,</span>&nbsp;<span class="ident" id="6298414">j</span>&nbsp;<span class="builtintype" id="6298416">int</span><span class="op" id="6298419">)</span>&nbsp;<span class="op" id="6298421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298424">n</span><span class="op" id="6298425">[</span><span class="ident" id="6298426">i</span><span class="op" id="6298427">]</span><span class="op" id="6298428">,</span>&nbsp;<span class="ident" id="6298430">n</span><span class="op" id="6298431">[</span><span class="ident" id="6298432">j</span><span class="op" id="6298433">]</span>&nbsp;<span class="op" id="6298435">=</span>&nbsp;<span class="ident" id="6298437">n</span><span class="op" id="6298438">[</span><span class="ident" id="6298439">j</span><span class="op" id="6298440">]</span><span class="op" id="6298441">,</span>&nbsp;<span class="ident" id="6298443">n</span><span class="op" id="6298444">[</span><span class="ident" id="6298445">i</span><span class="op" id="6298446">]</span><br>
<span class="lineno"></span><span class="op" id="6298448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298451">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="6298529">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="6298603">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6298624">func</span>&nbsp;<span class="ident" id="6298629">buildHuffmanNode</span><span class="op" id="6298645">(</span><span class="ident" id="6298646">t</span>&nbsp;<span class="op" id="6298648">*</span><span class="ident" id="6298649">huffmanTree</span><span class="op" id="6298660">,</span>&nbsp;<span class="ident" id="6298662">codes</span>&nbsp;<span class="op" id="6298668">[</span><span class="op" id="6298669">]</span><span class="ident" id="6298670">huffmanCode</span><span class="op" id="6298681">,</span>&nbsp;<span class="ident" id="6298683">level</span>&nbsp;<span class="builtintype" id="6298689">uint32</span><span class="op" id="6298695">)</span>&nbsp;<span class="op" id="6298697">(</span><span class="ident" id="6298698">nodeIndex</span>&nbsp;<span class="builtintype" id="6298708">uint16</span><span class="op" id="6298714">,</span>&nbsp;<span class="ident" id="6298716">err</span>&nbsp;<span class="builtintype" id="6298720">error</span><span class="op" id="6298725">)</span>&nbsp;<span class="op" id="6298727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298730">test</span>&nbsp;<span class="op" id="6298735">:=</span>&nbsp;<span class="builtintype" id="6298738">uint32</span><span class="op" id="6298744">(</span><span class="num" id="6298745">1</span><span class="op" id="6298746">)</span>&nbsp;<span class="op" id="6298748">&lt;&lt;</span>&nbsp;<span class="op" id="6298751">(</span><span class="num" id="6298752">31</span>&nbsp;<span class="op" id="6298755">-</span>&nbsp;<span class="ident" id="6298757">level</span><span class="op" id="6298762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6298766">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298859">firstRightIndex</span>&nbsp;<span class="op" id="6298875">:=</span>&nbsp;<span class="builtinfunc" id="6298878">len</span><span class="op" id="6298881">(</span><span class="ident" id="6298882">codes</span><span class="op" id="6298887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298890">for</span>&nbsp;<span class="ident" id="6298894">i</span><span class="op" id="6298895">,</span>&nbsp;<span class="ident" id="6298897">code</span>&nbsp;<span class="op" id="6298902">:=</span>&nbsp;<span class="keyword" id="6298905">range</span>&nbsp;<span class="ident" id="6298911">codes</span>&nbsp;<span class="op" id="6298917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298921">if</span>&nbsp;<span class="ident" id="6298924">code</span><span class="op" id="6298928">.</span><span class="ident" id="6298929">code</span><span class="op" id="6298933">&amp;</span><span class="ident" id="6298934">test</span>&nbsp;<span class="op" id="6298939">!=</span>&nbsp;<span class="num" id="6298942">0</span>&nbsp;<span class="op" id="6298944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298949">firstRightIndex</span>&nbsp;<span class="op" id="6298965">=</span>&nbsp;<span class="ident" id="6298967">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298972">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298987">left</span>&nbsp;<span class="op" id="6298992">:=</span>&nbsp;<span class="ident" id="6298995">codes</span><span class="op" id="6299000">[</span><span class="op" id="6299001">:</span><span class="ident" id="6299002">firstRightIndex</span><span class="op" id="6299017">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299020">right</span>&nbsp;<span class="op" id="6299026">:=</span>&nbsp;<span class="ident" id="6299029">codes</span><span class="op" id="6299034">[</span><span class="ident" id="6299035">firstRightIndex</span><span class="op" id="6299050">:</span><span class="op" id="6299051">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299055">if</span>&nbsp;<span class="builtinfunc" id="6299058">len</span><span class="op" id="6299061">(</span><span class="ident" id="6299062">left</span><span class="op" id="6299066">)</span>&nbsp;<span class="op" id="6299068">==</span>&nbsp;<span class="num" id="6299071">0</span>&nbsp;<span class="op" id="6299073">||</span>&nbsp;<span class="builtinfunc" id="6299076">len</span><span class="op" id="6299079">(</span><span class="ident" id="6299080">right</span><span class="op" id="6299085">)</span>&nbsp;<span class="op" id="6299087">==</span>&nbsp;<span class="num" id="6299090">0</span>&nbsp;<span class="op" id="6299092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299096">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299161">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299227">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299259">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299322">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299385">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299433">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299438">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299503">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299569">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299631">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299686">if</span>&nbsp;<span class="builtinfunc" id="6299689">len</span><span class="op" id="6299692">(</span><span class="ident" id="6299693">codes</span><span class="op" id="6299698">)</span>&nbsp;<span class="op" id="6299700">&lt;</span>&nbsp;<span class="num" id="6299702">2</span>&nbsp;<span class="op" id="6299704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299709">return</span>&nbsp;<span class="num" id="6299716">0</span><span class="op" id="6299717">,</span>&nbsp;<span class="ident" id="6299719">StructuralError</span><span class="op" id="6299734">(</span><span class="string" id="6299735">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6299755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299764">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299829">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299888">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299904">if</span>&nbsp;<span class="ident" id="6299907">level</span>&nbsp;<span class="op" id="6299913">==</span>&nbsp;<span class="num" id="6299916">31</span>&nbsp;<span class="op" id="6299919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299924">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299981">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300040">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300091">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300117">return</span>&nbsp;<span class="num" id="6300124">0</span><span class="op" id="6300125">,</span>&nbsp;<span class="ident" id="6300127">StructuralError</span><span class="op" id="6300142">(</span><span class="string" id="6300143">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6300174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300183">if</span>&nbsp;<span class="builtinfunc" id="6300186">len</span><span class="op" id="6300189">(</span><span class="ident" id="6300190">left</span><span class="op" id="6300194">)</span>&nbsp;<span class="op" id="6300196">==</span>&nbsp;<span class="num" id="6300199">0</span>&nbsp;<span class="op" id="6300201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300206">return</span>&nbsp;<span class="ident" id="6300213">buildHuffmanNode</span><span class="op" id="6300229">(</span><span class="ident" id="6300230">t</span><span class="op" id="6300231">,</span>&nbsp;<span class="ident" id="6300233">right</span><span class="op" id="6300238">,</span>&nbsp;<span class="ident" id="6300240">level</span><span class="op" id="6300245">+</span><span class="num" id="6300246">1</span><span class="op" id="6300247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300255">return</span>&nbsp;<span class="ident" id="6300262">buildHuffmanNode</span><span class="op" id="6300278">(</span><span class="ident" id="6300279">t</span><span class="op" id="6300280">,</span>&nbsp;<span class="ident" id="6300282">left</span><span class="op" id="6300286">,</span>&nbsp;<span class="ident" id="6300288">level</span><span class="op" id="6300293">+</span><span class="num" id="6300294">1</span><span class="op" id="6300295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300298">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300302">nodeIndex</span>&nbsp;<span class="op" id="6300312">=</span>&nbsp;<span class="builtintype" id="6300314">uint16</span><span class="op" id="6300320">(</span><span class="ident" id="6300321">t</span><span class="op" id="6300322">.</span><span class="ident" id="6300323">nextNode</span><span class="op" id="6300331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300334">node</span>&nbsp;<span class="op" id="6300339">:=</span>&nbsp;<span class="op" id="6300342">&amp;</span><span class="ident" id="6300343">t</span><span class="op" id="6300344">.</span><span class="ident" id="6300345">nodes</span><span class="op" id="6300350">[</span><span class="ident" id="6300351">t</span><span class="op" id="6300352">.</span><span class="ident" id="6300353">nextNode</span><span class="op" id="6300361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300364">t</span><span class="op" id="6300365">.</span><span class="ident" id="6300366">nextNode</span><span class="op" id="6300374">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300379">if</span>&nbsp;<span class="builtinfunc" id="6300382">len</span><span class="op" id="6300385">(</span><span class="ident" id="6300386">left</span><span class="op" id="6300390">)</span>&nbsp;<span class="op" id="6300392">==</span>&nbsp;<span class="num" id="6300395">1</span>&nbsp;<span class="op" id="6300397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300401">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300416">node</span><span class="op" id="6300420">.</span><span class="ident" id="6300421">left</span>&nbsp;<span class="op" id="6300426">=</span>&nbsp;<span class="ident" id="6300428">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300447">node</span><span class="op" id="6300451">.</span><span class="ident" id="6300452">leftValue</span>&nbsp;<span class="op" id="6300462">=</span>&nbsp;<span class="ident" id="6300464">left</span><span class="op" id="6300468">[</span><span class="num" id="6300469">0</span><span class="op" id="6300470">]</span><span class="op" id="6300471">.</span><span class="ident" id="6300472">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300479">}</span>&nbsp;<span class="keyword" id="6300481">else</span>&nbsp;<span class="op" id="6300486">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300490">node</span><span class="op" id="6300494">.</span><span class="ident" id="6300495">left</span><span class="op" id="6300499">,</span>&nbsp;<span class="ident" id="6300501">err</span>&nbsp;<span class="op" id="6300505">=</span>&nbsp;<span class="ident" id="6300507">buildHuffmanNode</span><span class="op" id="6300523">(</span><span class="ident" id="6300524">t</span><span class="op" id="6300525">,</span>&nbsp;<span class="ident" id="6300527">left</span><span class="op" id="6300531">,</span>&nbsp;<span class="ident" id="6300533">level</span><span class="op" id="6300538">+</span><span class="num" id="6300539">1</span><span class="op" id="6300540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300547">if</span>&nbsp;<span class="ident" id="6300550">err</span>&nbsp;<span class="op" id="6300554">!=</span>&nbsp;<span class="builtintype" id="6300557">nil</span>&nbsp;<span class="op" id="6300561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300565">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300577">if</span>&nbsp;<span class="builtinfunc" id="6300580">len</span><span class="op" id="6300583">(</span><span class="ident" id="6300584">right</span><span class="op" id="6300589">)</span>&nbsp;<span class="op" id="6300591">==</span>&nbsp;<span class="num" id="6300594">1</span>&nbsp;<span class="op" id="6300596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300600">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300615">node</span><span class="op" id="6300619">.</span><span class="ident" id="6300620">right</span>&nbsp;<span class="op" id="6300626">=</span>&nbsp;<span class="ident" id="6300628">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300647">node</span><span class="op" id="6300651">.</span><span class="ident" id="6300652">rightValue</span>&nbsp;<span class="op" id="6300663">=</span>&nbsp;<span class="ident" id="6300665">right</span><span class="op" id="6300670">[</span><span class="num" id="6300671">0</span><span class="op" id="6300672">]</span><span class="op" id="6300673">.</span><span class="ident" id="6300674">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300681">}</span>&nbsp;<span class="keyword" id="6300683">else</span>&nbsp;<span class="op" id="6300688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300692">node</span><span class="op" id="6300696">.</span><span class="ident" id="6300697">right</span><span class="op" id="6300702">,</span>&nbsp;<span class="ident" id="6300704">err</span>&nbsp;<span class="op" id="6300708">=</span>&nbsp;<span class="ident" id="6300710">buildHuffmanNode</span><span class="op" id="6300726">(</span><span class="ident" id="6300727">t</span><span class="op" id="6300728">,</span>&nbsp;<span class="ident" id="6300730">right</span><span class="op" id="6300735">,</span>&nbsp;<span class="ident" id="6300737">level</span><span class="op" id="6300742">+</span><span class="num" id="6300743">1</span><span class="op" id="6300744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6300751">return</span><br>
<span class="lineno"></span><span class="op" id="6300758">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
