<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5606305">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5606360">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5606414">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5606465">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5606524">//</span><br>
<span class="lineno"></span><span class="comment" id="5606527">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="5606606">package</span>&nbsp;<span class="ident" id="5606614">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5606619">import</span>&nbsp;<span class="op" id="5606626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606629">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606638">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606654">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606664">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606671">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606680">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5606695">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5606700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5606703">var</span>&nbsp;<span class="op" id="5606707">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606710">errNotEnough</span>&nbsp;<span class="op" id="5606723">=</span>&nbsp;<span class="ident" id="5606725">errors</span><span class="op" id="5606731">.</span><span class="ident" id="5606732">New</span><span class="op" id="5606735">(</span><span class="string" id="5606736">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="5606764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606767">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5606780">=</span>&nbsp;<span class="ident" id="5606782">errors</span><span class="op" id="5606788">.</span><span class="ident" id="5606789">New</span><span class="op" id="5606792">(</span><span class="string" id="5606793">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="5606819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606822">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="5606835">=</span>&nbsp;<span class="ident" id="5606837">errors</span><span class="op" id="5606843">.</span><span class="ident" id="5606844">New</span><span class="op" id="5606847">(</span><span class="string" id="5606848">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="5606874">)</span><br>
<span class="lineno"></span><span class="op" id="5606876">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5606879">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="5606974">type</span>&nbsp;<span class="ident" id="5606979">reader</span>&nbsp;<span class="keyword" id="5606986">interface</span>&nbsp;<span class="op" id="5606996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606999">io</span><span class="op" id="5607001">.</span><span class="ident" id="5607002">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607010">io</span><span class="op" id="5607012">.</span><span class="ident" id="5607013">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="5607024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607027">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="5607041">const</span>&nbsp;<span class="op" id="5607047">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607050">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607062">fColorMapFollows</span>&nbsp;<span class="op" id="5607079">=</span>&nbsp;<span class="num" id="5607081">1</span>&nbsp;<span class="op" id="5607083">&lt;&lt;</span>&nbsp;<span class="num" id="5607086">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607090">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607108">ifLocalColorTable</span>&nbsp;<span class="op" id="5607126">=</span>&nbsp;<span class="num" id="5607128">1</span>&nbsp;<span class="op" id="5607130">&lt;&lt;</span>&nbsp;<span class="num" id="5607133">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607136">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607154">=</span>&nbsp;<span class="num" id="5607156">1</span>&nbsp;<span class="op" id="5607158">&lt;&lt;</span>&nbsp;<span class="num" id="5607161">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607164">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5607182">=</span>&nbsp;<span class="num" id="5607184">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607188">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607215">gcTransparentColorSet</span>&nbsp;<span class="op" id="5607237">=</span>&nbsp;<span class="num" id="5607239">1</span>&nbsp;<span class="op" id="5607241">&lt;&lt;</span>&nbsp;<span class="num" id="5607244">0</span><br>
<span class="lineno"></span><span class="op" id="5607246">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5607249">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="5607272">const</span>&nbsp;<span class="op" id="5607278">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607281">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607298">=</span>&nbsp;<span class="num" id="5607300">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607306">sImageDescriptor</span>&nbsp;<span class="op" id="5607323">=</span>&nbsp;<span class="num" id="5607325">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607331">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607348">=</span>&nbsp;<span class="num" id="5607350">0x3B</span><br>
<span class="lineno"></span><span class="op" id="5607355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607358">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5607373">const</span>&nbsp;<span class="op" id="5607379">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607382">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607398">=</span>&nbsp;<span class="num" id="5607400">0x01</span>&nbsp;<span class="comment" id="5607405">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607420">eGraphicControl</span>&nbsp;<span class="op" id="5607436">=</span>&nbsp;<span class="num" id="5607438">0xF9</span>&nbsp;<span class="comment" id="5607443">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607463">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607479">=</span>&nbsp;<span class="num" id="5607481">0xFE</span>&nbsp;<span class="comment" id="5607486">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607498">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607514">=</span>&nbsp;<span class="num" id="5607516">0xFF</span>&nbsp;<span class="comment" id="5607521">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="5607536">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5607539">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5607589">type</span>&nbsp;<span class="ident" id="5607594">decoder</span>&nbsp;<span class="keyword" id="5607602">struct</span>&nbsp;<span class="op" id="5607609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607612">r</span>&nbsp;<span class="ident" id="5607614">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607623">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607640">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607656">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607664">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607680">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607685">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607701">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607706">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607722">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607728">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607744">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607750">backgroundIndex</span>&nbsp;<span class="builtintype" id="5607766">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607772">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607788">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607793">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607809">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607815">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607839">aspect</span>&nbsp;<span class="builtintype" id="5607846">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607853">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607880">imageFields</span>&nbsp;<span class="builtintype" id="5607892">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607899">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607926">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5607946">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607952">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="5607972">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607979">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607993">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5608008">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608014">globalColorMap</span>&nbsp;<span class="ident" id="5608029">color</span><span class="op" id="5608034">.</span><span class="ident" id="5608035">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608045">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608069">delay</span>&nbsp;<span class="op" id="5608075">[</span><span class="op" id="5608076">]</span><span class="builtintype" id="5608077">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608082">image</span>&nbsp;<span class="op" id="5608088">[</span><span class="op" id="5608089">]</span><span class="op" id="5608090">*</span><span class="ident" id="5608091">image</span><span class="op" id="5608096">.</span><span class="ident" id="5608097">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608107">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5608113">[</span><span class="num" id="5608114">1024</span><span class="op" id="5608118">]</span><span class="builtintype" id="5608119">byte</span>&nbsp;<span class="comment" id="5608124">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="5608173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5608176">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5608243">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5608310">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5608374">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="5608444">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5608513">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="5608542">type</span>&nbsp;<span class="ident" id="5608547">blockReader</span>&nbsp;<span class="keyword" id="5608559">struct</span>&nbsp;<span class="op" id="5608566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608569">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608575">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608583">slice</span>&nbsp;<span class="op" id="5608589">[</span><span class="op" id="5608590">]</span><span class="builtintype" id="5608591">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608597">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5608603">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608610">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5608616">[</span><span class="num" id="5608617">256</span><span class="op" id="5608620">]</span><span class="builtintype" id="5608621">byte</span><br>
<span class="lineno"></span><span class="op" id="5608626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608629">func</span>&nbsp;<span class="op" id="5608634">(</span><span class="ident" id="5608635">b</span>&nbsp;<span class="op" id="5608637">*</span><span class="ident" id="5608638">blockReader</span><span class="op" id="5608649">)</span>&nbsp;<span class="ident" id="5608651">Read</span><span class="op" id="5608655">(</span><span class="ident" id="5608656">p</span>&nbsp;<span class="op" id="5608658">[</span><span class="op" id="5608659">]</span><span class="builtintype" id="5608660">byte</span><span class="op" id="5608664">)</span>&nbsp;<span class="op" id="5608666">(</span><span class="builtintype" id="5608667">int</span><span class="op" id="5608670">,</span>&nbsp;<span class="builtintype" id="5608672">error</span><span class="op" id="5608677">)</span>&nbsp;<span class="op" id="5608679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608682">if</span>&nbsp;<span class="ident" id="5608685">b</span><span class="op" id="5608686">.</span><span class="ident" id="5608687">err</span>&nbsp;<span class="op" id="5608691">!=</span>&nbsp;<span class="ident" id="5608694">nil</span>&nbsp;<span class="op" id="5608698">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608702">return</span>&nbsp;<span class="num" id="5608709">0</span><span class="op" id="5608710">,</span>&nbsp;<span class="ident" id="5608712">b</span><span class="op" id="5608713">.</span><span class="ident" id="5608714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608722">if</span>&nbsp;<span class="builtinfunc" id="5608725">len</span><span class="op" id="5608728">(</span><span class="ident" id="5608729">p</span><span class="op" id="5608730">)</span>&nbsp;<span class="op" id="5608732">==</span>&nbsp;<span class="num" id="5608735">0</span>&nbsp;<span class="op" id="5608737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608741">return</span>&nbsp;<span class="num" id="5608748">0</span><span class="op" id="5608749">,</span>&nbsp;<span class="ident" id="5608751">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608756">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608759">if</span>&nbsp;<span class="builtinfunc" id="5608762">len</span><span class="op" id="5608765">(</span><span class="ident" id="5608766">b</span><span class="op" id="5608767">.</span><span class="ident" id="5608768">slice</span><span class="op" id="5608773">)</span>&nbsp;<span class="op" id="5608775">==</span>&nbsp;<span class="num" id="5608778">0</span>&nbsp;<span class="op" id="5608780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608784">var</span>&nbsp;<span class="ident" id="5608788">blockLen</span>&nbsp;<span class="builtintype" id="5608797">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608805">blockLen</span><span class="op" id="5608813">,</span>&nbsp;<span class="ident" id="5608815">b</span><span class="op" id="5608816">.</span><span class="ident" id="5608817">err</span>&nbsp;<span class="op" id="5608821">=</span>&nbsp;<span class="ident" id="5608823">b</span><span class="op" id="5608824">.</span><span class="ident" id="5608825">r</span><span class="op" id="5608826">.</span><span class="ident" id="5608827">ReadByte</span><span class="op" id="5608835">(</span><span class="op" id="5608836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608840">if</span>&nbsp;<span class="ident" id="5608843">b</span><span class="op" id="5608844">.</span><span class="ident" id="5608845">err</span>&nbsp;<span class="op" id="5608849">!=</span>&nbsp;<span class="ident" id="5608852">nil</span>&nbsp;<span class="op" id="5608856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608861">return</span>&nbsp;<span class="num" id="5608868">0</span><span class="op" id="5608869">,</span>&nbsp;<span class="ident" id="5608871">b</span><span class="op" id="5608872">.</span><span class="ident" id="5608873">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608883">if</span>&nbsp;<span class="ident" id="5608886">blockLen</span>&nbsp;<span class="op" id="5608895">==</span>&nbsp;<span class="num" id="5608898">0</span>&nbsp;<span class="op" id="5608900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608905">b</span><span class="op" id="5608906">.</span><span class="ident" id="5608907">err</span>&nbsp;<span class="op" id="5608911">=</span>&nbsp;<span class="ident" id="5608913">io</span><span class="op" id="5608915">.</span><span class="ident" id="5608916">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608923">return</span>&nbsp;<span class="num" id="5608930">0</span><span class="op" id="5608931">,</span>&nbsp;<span class="ident" id="5608933">b</span><span class="op" id="5608934">.</span><span class="ident" id="5608935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608941">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608945">b</span><span class="op" id="5608946">.</span><span class="ident" id="5608947">slice</span>&nbsp;<span class="op" id="5608953">=</span>&nbsp;<span class="ident" id="5608955">b</span><span class="op" id="5608956">.</span><span class="ident" id="5608957">tmp</span><span class="op" id="5608960">[</span><span class="num" id="5608961">0</span><span class="op" id="5608962">:</span><span class="ident" id="5608963">blockLen</span><span class="op" id="5608971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608975">if</span>&nbsp;<span class="ident" id="5608978">_</span><span class="op" id="5608979">,</span>&nbsp;<span class="ident" id="5608981">b</span><span class="op" id="5608982">.</span><span class="ident" id="5608983">err</span>&nbsp;<span class="op" id="5608987">=</span>&nbsp;<span class="ident" id="5608989">io</span><span class="op" id="5608991">.</span><span class="ident" id="5608992">ReadFull</span><span class="op" id="5609000">(</span><span class="ident" id="5609001">b</span><span class="op" id="5609002">.</span><span class="ident" id="5609003">r</span><span class="op" id="5609004">,</span>&nbsp;<span class="ident" id="5609006">b</span><span class="op" id="5609007">.</span><span class="ident" id="5609008">slice</span><span class="op" id="5609013">)</span><span class="op" id="5609014">;</span>&nbsp;<span class="ident" id="5609016">b</span><span class="op" id="5609017">.</span><span class="ident" id="5609018">err</span>&nbsp;<span class="op" id="5609022">!=</span>&nbsp;<span class="ident" id="5609025">nil</span>&nbsp;<span class="op" id="5609029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609034">return</span>&nbsp;<span class="num" id="5609041">0</span><span class="op" id="5609042">,</span>&nbsp;<span class="ident" id="5609044">b</span><span class="op" id="5609045">.</span><span class="ident" id="5609046">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609055">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609058">n</span>&nbsp;<span class="op" id="5609060">:=</span>&nbsp;<span class="builtinfunc" id="5609063">copy</span><span class="op" id="5609067">(</span><span class="ident" id="5609068">p</span><span class="op" id="5609069">,</span>&nbsp;<span class="ident" id="5609071">b</span><span class="op" id="5609072">.</span><span class="ident" id="5609073">slice</span><span class="op" id="5609078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609081">b</span><span class="op" id="5609082">.</span><span class="ident" id="5609083">slice</span>&nbsp;<span class="op" id="5609089">=</span>&nbsp;<span class="ident" id="5609091">b</span><span class="op" id="5609092">.</span><span class="ident" id="5609093">slice</span><span class="op" id="5609098">[</span><span class="ident" id="5609099">n</span><span class="op" id="5609100">:</span><span class="op" id="5609101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609104">return</span>&nbsp;<span class="ident" id="5609111">n</span><span class="op" id="5609112">,</span>&nbsp;<span class="ident" id="5609114">nil</span><br>
<span class="lineno"></span><span class="op" id="5609118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5609121">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5609184">func</span>&nbsp;<span class="op" id="5609189">(</span><span class="ident" id="5609190">d</span>&nbsp;<span class="op" id="5609192">*</span><span class="ident" id="5609193">decoder</span><span class="op" id="5609200">)</span>&nbsp;<span class="ident" id="5609202">decode</span><span class="op" id="5609208">(</span><span class="ident" id="5609209">r</span>&nbsp;<span class="ident" id="5609211">io</span><span class="op" id="5609213">.</span><span class="ident" id="5609214">Reader</span><span class="op" id="5609220">,</span>&nbsp;<span class="ident" id="5609222">configOnly</span>&nbsp;<span class="builtintype" id="5609233">bool</span><span class="op" id="5609237">)</span>&nbsp;<span class="builtintype" id="5609239">error</span>&nbsp;<span class="op" id="5609245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609248">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609298">if</span>&nbsp;<span class="ident" id="5609301">rr</span><span class="op" id="5609303">,</span>&nbsp;<span class="ident" id="5609305">ok</span>&nbsp;<span class="op" id="5609308">:=</span>&nbsp;<span class="ident" id="5609311">r</span><span class="op" id="5609312">.</span><span class="op" id="5609313">(</span><span class="ident" id="5609314">reader</span><span class="op" id="5609320">)</span><span class="op" id="5609321">;</span>&nbsp;<span class="ident" id="5609323">ok</span>&nbsp;<span class="op" id="5609326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609330">d</span><span class="op" id="5609331">.</span><span class="ident" id="5609332">r</span>&nbsp;<span class="op" id="5609334">=</span>&nbsp;<span class="ident" id="5609336">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609340">}</span>&nbsp;<span class="keyword" id="5609342">else</span>&nbsp;<span class="op" id="5609347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609351">d</span><span class="op" id="5609352">.</span><span class="ident" id="5609353">r</span>&nbsp;<span class="op" id="5609355">=</span>&nbsp;<span class="ident" id="5609357">bufio</span><span class="op" id="5609362">.</span><span class="ident" id="5609363">NewReader</span><span class="op" id="5609372">(</span><span class="ident" id="5609373">r</span><span class="op" id="5609374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609381">err</span>&nbsp;<span class="op" id="5609385">:=</span>&nbsp;<span class="ident" id="5609388">d</span><span class="op" id="5609389">.</span><span class="ident" id="5609390">readHeaderAndScreenDescriptor</span><span class="op" id="5609419">(</span><span class="op" id="5609420">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609423">if</span>&nbsp;<span class="ident" id="5609426">err</span>&nbsp;<span class="op" id="5609430">!=</span>&nbsp;<span class="ident" id="5609433">nil</span>&nbsp;<span class="op" id="5609437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609441">return</span>&nbsp;<span class="ident" id="5609448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609456">if</span>&nbsp;<span class="ident" id="5609459">configOnly</span>&nbsp;<span class="op" id="5609470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609474">return</span>&nbsp;<span class="ident" id="5609481">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609490">if</span>&nbsp;<span class="ident" id="5609493">d</span><span class="op" id="5609494">.</span><span class="ident" id="5609495">headerFields</span><span class="op" id="5609507">&amp;</span><span class="ident" id="5609508">fColorMapFollows</span>&nbsp;<span class="op" id="5609525">!=</span>&nbsp;<span class="num" id="5609528">0</span>&nbsp;<span class="op" id="5609530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609534">if</span>&nbsp;<span class="ident" id="5609537">d</span><span class="op" id="5609538">.</span><span class="ident" id="5609539">globalColorMap</span><span class="op" id="5609553">,</span>&nbsp;<span class="ident" id="5609555">err</span>&nbsp;<span class="op" id="5609559">=</span>&nbsp;<span class="ident" id="5609561">d</span><span class="op" id="5609562">.</span><span class="ident" id="5609563">readColorMap</span><span class="op" id="5609575">(</span><span class="op" id="5609576">)</span><span class="op" id="5609577">;</span>&nbsp;<span class="ident" id="5609579">err</span>&nbsp;<span class="op" id="5609583">!=</span>&nbsp;<span class="ident" id="5609586">nil</span>&nbsp;<span class="op" id="5609590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609595">return</span>&nbsp;<span class="ident" id="5609602">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609615">for</span>&nbsp;<span class="op" id="5609619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609623">c</span><span class="op" id="5609624">,</span>&nbsp;<span class="ident" id="5609626">err</span>&nbsp;<span class="op" id="5609630">:=</span>&nbsp;<span class="ident" id="5609633">d</span><span class="op" id="5609634">.</span><span class="ident" id="5609635">r</span><span class="op" id="5609636">.</span><span class="ident" id="5609637">ReadByte</span><span class="op" id="5609645">(</span><span class="op" id="5609646">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609650">if</span>&nbsp;<span class="ident" id="5609653">err</span>&nbsp;<span class="op" id="5609657">!=</span>&nbsp;<span class="ident" id="5609660">nil</span>&nbsp;<span class="op" id="5609664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609669">return</span>&nbsp;<span class="ident" id="5609676">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609686">switch</span>&nbsp;<span class="ident" id="5609693">c</span>&nbsp;<span class="op" id="5609695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609699">case</span>&nbsp;<span class="ident" id="5609704">sExtension</span><span class="op" id="5609714">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609719">if</span>&nbsp;<span class="ident" id="5609722">err</span>&nbsp;<span class="op" id="5609726">=</span>&nbsp;<span class="ident" id="5609728">d</span><span class="op" id="5609729">.</span><span class="ident" id="5609730">readExtension</span><span class="op" id="5609743">(</span><span class="op" id="5609744">)</span><span class="op" id="5609745">;</span>&nbsp;<span class="ident" id="5609747">err</span>&nbsp;<span class="op" id="5609751">!=</span>&nbsp;<span class="ident" id="5609754">nil</span>&nbsp;<span class="op" id="5609758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609764">return</span>&nbsp;<span class="ident" id="5609771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609783">case</span>&nbsp;<span class="ident" id="5609788">sImageDescriptor</span><span class="op" id="5609804">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609809">m</span><span class="op" id="5609810">,</span>&nbsp;<span class="ident" id="5609812">err</span>&nbsp;<span class="op" id="5609816">:=</span>&nbsp;<span class="ident" id="5609819">d</span><span class="op" id="5609820">.</span><span class="ident" id="5609821">newImageFromDescriptor</span><span class="op" id="5609843">(</span><span class="op" id="5609844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609849">if</span>&nbsp;<span class="ident" id="5609852">err</span>&nbsp;<span class="op" id="5609856">!=</span>&nbsp;<span class="ident" id="5609859">nil</span>&nbsp;<span class="op" id="5609863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609869">return</span>&nbsp;<span class="ident" id="5609876">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609888">useLocalColorMap</span>&nbsp;<span class="op" id="5609905">:=</span>&nbsp;<span class="ident" id="5609908">d</span><span class="op" id="5609909">.</span><span class="ident" id="5609910">imageFields</span><span class="op" id="5609921">&amp;</span><span class="ident" id="5609922">fColorMapFollows</span>&nbsp;<span class="op" id="5609939">!=</span>&nbsp;<span class="num" id="5609942">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609947">if</span>&nbsp;<span class="ident" id="5609950">useLocalColorMap</span>&nbsp;<span class="op" id="5609967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609973">m</span><span class="op" id="5609974">.</span><span class="ident" id="5609975">Palette</span><span class="op" id="5609982">,</span>&nbsp;<span class="ident" id="5609984">err</span>&nbsp;<span class="op" id="5609988">=</span>&nbsp;<span class="ident" id="5609990">d</span><span class="op" id="5609991">.</span><span class="ident" id="5609992">readColorMap</span><span class="op" id="5610004">(</span><span class="op" id="5610005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610011">if</span>&nbsp;<span class="ident" id="5610014">err</span>&nbsp;<span class="op" id="5610018">!=</span>&nbsp;<span class="ident" id="5610021">nil</span>&nbsp;<span class="op" id="5610025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610032">return</span>&nbsp;<span class="ident" id="5610039">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610047">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610052">}</span>&nbsp;<span class="keyword" id="5610054">else</span>&nbsp;<span class="op" id="5610059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610065">m</span><span class="op" id="5610066">.</span><span class="ident" id="5610067">Palette</span>&nbsp;<span class="op" id="5610075">=</span>&nbsp;<span class="ident" id="5610077">d</span><span class="op" id="5610078">.</span><span class="ident" id="5610079">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610102">if</span>&nbsp;<span class="ident" id="5610105">d</span><span class="op" id="5610106">.</span><span class="ident" id="5610107">hasTransparentIndex</span>&nbsp;<span class="op" id="5610127">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5610130">int</span><span class="op" id="5610133">(</span><span class="ident" id="5610134">d</span><span class="op" id="5610135">.</span><span class="ident" id="5610136">transparentIndex</span><span class="op" id="5610152">)</span>&nbsp;<span class="op" id="5610154">&lt;</span>&nbsp;<span class="builtinfunc" id="5610156">len</span><span class="op" id="5610159">(</span><span class="ident" id="5610160">m</span><span class="op" id="5610161">.</span><span class="ident" id="5610162">Palette</span><span class="op" id="5610169">)</span>&nbsp;<span class="op" id="5610171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610177">if</span>&nbsp;<span class="op" id="5610180">!</span><span class="ident" id="5610181">useLocalColorMap</span>&nbsp;<span class="op" id="5610198">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610205">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610241">m</span><span class="op" id="5610242">.</span><span class="ident" id="5610243">Palette</span>&nbsp;<span class="op" id="5610251">=</span>&nbsp;<span class="builtinfunc" id="5610253">append</span><span class="op" id="5610259">(</span><span class="ident" id="5610260">color</span><span class="op" id="5610265">.</span><span class="ident" id="5610266">Palette</span><span class="op" id="5610273">(</span><span class="ident" id="5610274">nil</span><span class="op" id="5610277">)</span><span class="op" id="5610278">,</span>&nbsp;<span class="ident" id="5610280">d</span><span class="op" id="5610281">.</span><span class="ident" id="5610282">globalColorMap</span><span class="op" id="5610296">...</span><span class="op" id="5610299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610311">m</span><span class="op" id="5610312">.</span><span class="ident" id="5610313">Palette</span><span class="op" id="5610320">[</span><span class="ident" id="5610321">d</span><span class="op" id="5610322">.</span><span class="ident" id="5610323">transparentIndex</span><span class="op" id="5610339">]</span>&nbsp;<span class="op" id="5610341">=</span>&nbsp;<span class="ident" id="5610343">color</span><span class="op" id="5610348">.</span><span class="ident" id="5610349">RGBA</span><span class="op" id="5610353">{</span><span class="op" id="5610354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610359">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610364">litWidth</span><span class="op" id="5610372">,</span>&nbsp;<span class="ident" id="5610374">err</span>&nbsp;<span class="op" id="5610378">:=</span>&nbsp;<span class="ident" id="5610381">d</span><span class="op" id="5610382">.</span><span class="ident" id="5610383">r</span><span class="op" id="5610384">.</span><span class="ident" id="5610385">ReadByte</span><span class="op" id="5610393">(</span><span class="op" id="5610394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610399">if</span>&nbsp;<span class="ident" id="5610402">err</span>&nbsp;<span class="op" id="5610406">!=</span>&nbsp;<span class="ident" id="5610409">nil</span>&nbsp;<span class="op" id="5610413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610419">return</span>&nbsp;<span class="ident" id="5610426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610438">if</span>&nbsp;<span class="ident" id="5610441">litWidth</span>&nbsp;<span class="op" id="5610450">&lt;</span>&nbsp;<span class="num" id="5610452">2</span>&nbsp;<span class="op" id="5610454">||</span>&nbsp;<span class="ident" id="5610457">litWidth</span>&nbsp;<span class="op" id="5610466">&gt;</span>&nbsp;<span class="num" id="5610468">8</span>&nbsp;<span class="op" id="5610470">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610476">return</span>&nbsp;<span class="ident" id="5610483">fmt</span><span class="op" id="5610486">.</span><span class="ident" id="5610487">Errorf</span><span class="op" id="5610493">(</span><span class="string" id="5610494">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="5610538">,</span>&nbsp;<span class="ident" id="5610540">litWidth</span><span class="op" id="5610548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610558">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610602">br</span>&nbsp;<span class="op" id="5610605">:=</span>&nbsp;<span class="op" id="5610608">&amp;</span><span class="ident" id="5610609">blockReader</span><span class="op" id="5610620">{</span><span class="ident" id="5610621">r</span><span class="op" id="5610622">:</span>&nbsp;<span class="ident" id="5610624">d</span><span class="op" id="5610625">.</span><span class="ident" id="5610626">r</span><span class="op" id="5610627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610632">lzwr</span>&nbsp;<span class="op" id="5610637">:=</span>&nbsp;<span class="ident" id="5610640">lzw</span><span class="op" id="5610643">.</span><span class="ident" id="5610644">NewReader</span><span class="op" id="5610653">(</span><span class="ident" id="5610654">br</span><span class="op" id="5610656">,</span>&nbsp;<span class="ident" id="5610658">lzw</span><span class="op" id="5610661">.</span><span class="ident" id="5610662">LSB</span><span class="op" id="5610665">,</span>&nbsp;<span class="builtintype" id="5610667">int</span><span class="op" id="5610670">(</span><span class="ident" id="5610671">litWidth</span><span class="op" id="5610679">)</span><span class="op" id="5610680">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610685">defer</span>&nbsp;<span class="ident" id="5610691">lzwr</span><span class="op" id="5610695">.</span><span class="ident" id="5610696">Close</span><span class="op" id="5610701">(</span><span class="op" id="5610702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610707">if</span>&nbsp;<span class="ident" id="5610710">_</span><span class="op" id="5610711">,</span>&nbsp;<span class="ident" id="5610713">err</span>&nbsp;<span class="op" id="5610717">=</span>&nbsp;<span class="ident" id="5610719">io</span><span class="op" id="5610721">.</span><span class="ident" id="5610722">ReadFull</span><span class="op" id="5610730">(</span><span class="ident" id="5610731">lzwr</span><span class="op" id="5610735">,</span>&nbsp;<span class="ident" id="5610737">m</span><span class="op" id="5610738">.</span><span class="ident" id="5610739">Pix</span><span class="op" id="5610742">)</span><span class="op" id="5610743">;</span>&nbsp;<span class="ident" id="5610745">err</span>&nbsp;<span class="op" id="5610749">!=</span>&nbsp;<span class="ident" id="5610752">nil</span>&nbsp;<span class="op" id="5610756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610762">if</span>&nbsp;<span class="ident" id="5610765">err</span>&nbsp;<span class="op" id="5610769">!=</span>&nbsp;<span class="ident" id="5610772">io</span><span class="op" id="5610774">.</span><span class="ident" id="5610775">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5610792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610799">return</span>&nbsp;<span class="ident" id="5610806">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610814">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610820">return</span>&nbsp;<span class="ident" id="5610827">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610848">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610910">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610942">if</span>&nbsp;<span class="ident" id="5610945">n</span><span class="op" id="5610946">,</span>&nbsp;<span class="ident" id="5610948">err</span>&nbsp;<span class="op" id="5610952">:=</span>&nbsp;<span class="ident" id="5610955">lzwr</span><span class="op" id="5610959">.</span><span class="ident" id="5610960">Read</span><span class="op" id="5610964">(</span><span class="ident" id="5610965">d</span><span class="op" id="5610966">.</span><span class="ident" id="5610967">tmp</span><span class="op" id="5610970">[</span><span class="op" id="5610971">:</span><span class="num" id="5610972">1</span><span class="op" id="5610973">]</span><span class="op" id="5610974">)</span><span class="op" id="5610975">;</span>&nbsp;<span class="ident" id="5610977">n</span>&nbsp;<span class="op" id="5610979">!=</span>&nbsp;<span class="num" id="5610982">0</span>&nbsp;<span class="op" id="5610984">||</span>&nbsp;<span class="ident" id="5610987">err</span>&nbsp;<span class="op" id="5610991">!=</span>&nbsp;<span class="ident" id="5610994">io</span><span class="op" id="5610996">.</span><span class="ident" id="5610997">EOF</span>&nbsp;<span class="op" id="5611001">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611007">if</span>&nbsp;<span class="ident" id="5611010">err</span>&nbsp;<span class="op" id="5611014">!=</span>&nbsp;<span class="ident" id="5611017">nil</span>&nbsp;<span class="op" id="5611021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611028">return</span>&nbsp;<span class="ident" id="5611035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611049">return</span>&nbsp;<span class="ident" id="5611056">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611070">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611075">if</span>&nbsp;<span class="ident" id="5611078">n</span><span class="op" id="5611079">,</span>&nbsp;<span class="ident" id="5611081">err</span>&nbsp;<span class="op" id="5611085">:=</span>&nbsp;<span class="ident" id="5611088">br</span><span class="op" id="5611090">.</span><span class="ident" id="5611091">Read</span><span class="op" id="5611095">(</span><span class="ident" id="5611096">d</span><span class="op" id="5611097">.</span><span class="ident" id="5611098">tmp</span><span class="op" id="5611101">[</span><span class="op" id="5611102">:</span><span class="num" id="5611103">1</span><span class="op" id="5611104">]</span><span class="op" id="5611105">)</span><span class="op" id="5611106">;</span>&nbsp;<span class="ident" id="5611108">n</span>&nbsp;<span class="op" id="5611110">!=</span>&nbsp;<span class="num" id="5611113">0</span>&nbsp;<span class="op" id="5611115">||</span>&nbsp;<span class="ident" id="5611118">err</span>&nbsp;<span class="op" id="5611122">!=</span>&nbsp;<span class="ident" id="5611125">io</span><span class="op" id="5611127">.</span><span class="ident" id="5611128">EOF</span>&nbsp;<span class="op" id="5611132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611138">if</span>&nbsp;<span class="ident" id="5611141">err</span>&nbsp;<span class="op" id="5611145">!=</span>&nbsp;<span class="ident" id="5611148">nil</span>&nbsp;<span class="op" id="5611152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611159">return</span>&nbsp;<span class="ident" id="5611166">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611180">return</span>&nbsp;<span class="ident" id="5611187">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611207">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611266">if</span>&nbsp;<span class="builtinfunc" id="5611269">len</span><span class="op" id="5611272">(</span><span class="ident" id="5611273">m</span><span class="op" id="5611274">.</span><span class="ident" id="5611275">Palette</span><span class="op" id="5611282">)</span>&nbsp;<span class="op" id="5611284">&lt;</span>&nbsp;<span class="num" id="5611286">256</span>&nbsp;<span class="op" id="5611290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611296">for</span>&nbsp;<span class="ident" id="5611300">_</span><span class="op" id="5611301">,</span>&nbsp;<span class="ident" id="5611303">pixel</span>&nbsp;<span class="op" id="5611309">:=</span>&nbsp;<span class="keyword" id="5611312">range</span>&nbsp;<span class="ident" id="5611318">m</span><span class="op" id="5611319">.</span><span class="ident" id="5611320">Pix</span>&nbsp;<span class="op" id="5611324">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611331">if</span>&nbsp;<span class="builtintype" id="5611334">int</span><span class="op" id="5611337">(</span><span class="ident" id="5611338">pixel</span><span class="op" id="5611343">)</span>&nbsp;<span class="op" id="5611345">&gt;=</span>&nbsp;<span class="builtinfunc" id="5611348">len</span><span class="op" id="5611351">(</span><span class="ident" id="5611352">m</span><span class="op" id="5611353">.</span><span class="ident" id="5611354">Palette</span><span class="op" id="5611361">)</span>&nbsp;<span class="op" id="5611363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611371">return</span>&nbsp;<span class="ident" id="5611378">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611406">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611412">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611453">if</span>&nbsp;<span class="ident" id="5611456">d</span><span class="op" id="5611457">.</span><span class="ident" id="5611458">imageFields</span><span class="op" id="5611469">&amp;</span><span class="ident" id="5611470">ifInterlace</span>&nbsp;<span class="op" id="5611482">!=</span>&nbsp;<span class="num" id="5611485">0</span>&nbsp;<span class="op" id="5611487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611493">uninterlace</span><span class="op" id="5611504">(</span><span class="ident" id="5611505">m</span><span class="op" id="5611506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611511">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611517">d</span><span class="op" id="5611518">.</span><span class="ident" id="5611519">image</span>&nbsp;<span class="op" id="5611525">=</span>&nbsp;<span class="builtinfunc" id="5611527">append</span><span class="op" id="5611533">(</span><span class="ident" id="5611534">d</span><span class="op" id="5611535">.</span><span class="ident" id="5611536">image</span><span class="op" id="5611541">,</span>&nbsp;<span class="ident" id="5611543">m</span><span class="op" id="5611544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611549">d</span><span class="op" id="5611550">.</span><span class="ident" id="5611551">delay</span>&nbsp;<span class="op" id="5611557">=</span>&nbsp;<span class="builtinfunc" id="5611559">append</span><span class="op" id="5611565">(</span><span class="ident" id="5611566">d</span><span class="op" id="5611567">.</span><span class="ident" id="5611568">delay</span><span class="op" id="5611573">,</span>&nbsp;<span class="ident" id="5611575">d</span><span class="op" id="5611576">.</span><span class="ident" id="5611577">delayTime</span><span class="op" id="5611586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611591">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611659">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611731">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611792">d</span><span class="op" id="5611793">.</span><span class="ident" id="5611794">delayTime</span>&nbsp;<span class="op" id="5611804">=</span>&nbsp;<span class="num" id="5611806">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611811">d</span><span class="op" id="5611812">.</span><span class="ident" id="5611813">hasTransparentIndex</span>&nbsp;<span class="op" id="5611833">=</span>&nbsp;<span class="builtintype" id="5611835">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611844">case</span>&nbsp;<span class="ident" id="5611849">sTrailer</span><span class="op" id="5611857">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611862">if</span>&nbsp;<span class="builtinfunc" id="5611865">len</span><span class="op" id="5611868">(</span><span class="ident" id="5611869">d</span><span class="op" id="5611870">.</span><span class="ident" id="5611871">image</span><span class="op" id="5611876">)</span>&nbsp;<span class="op" id="5611878">==</span>&nbsp;<span class="num" id="5611881">0</span>&nbsp;<span class="op" id="5611883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611889">return</span>&nbsp;<span class="ident" id="5611896">io</span><span class="op" id="5611898">.</span><span class="ident" id="5611899">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611924">return</span>&nbsp;<span class="ident" id="5611931">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611938">default</span><span class="op" id="5611945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611950">return</span>&nbsp;<span class="ident" id="5611957">fmt</span><span class="op" id="5611960">.</span><span class="ident" id="5611961">Errorf</span><span class="op" id="5611967">(</span><span class="string" id="5611968">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="5612001">,</span>&nbsp;<span class="ident" id="5612003">c</span><span class="op" id="5612004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612011">}</span><br>
<span class="lineno"></span><span class="op" id="5612013">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5612016">func</span>&nbsp;<span class="op" id="5612021">(</span><span class="ident" id="5612022">d</span>&nbsp;<span class="op" id="5612024">*</span><span class="ident" id="5612025">decoder</span><span class="op" id="5612032">)</span>&nbsp;<span class="ident" id="5612034">readHeaderAndScreenDescriptor</span><span class="op" id="5612063">(</span><span class="op" id="5612064">)</span>&nbsp;<span class="builtintype" id="5612066">error</span>&nbsp;<span class="op" id="5612072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612075">_</span><span class="op" id="5612076">,</span>&nbsp;<span class="ident" id="5612078">err</span>&nbsp;<span class="op" id="5612082">:=</span>&nbsp;<span class="ident" id="5612085">io</span><span class="op" id="5612087">.</span><span class="ident" id="5612088">ReadFull</span><span class="op" id="5612096">(</span><span class="ident" id="5612097">d</span><span class="op" id="5612098">.</span><span class="ident" id="5612099">r</span><span class="op" id="5612100">,</span>&nbsp;<span class="ident" id="5612102">d</span><span class="op" id="5612103">.</span><span class="ident" id="5612104">tmp</span><span class="op" id="5612107">[</span><span class="num" id="5612108">0</span><span class="op" id="5612109">:</span><span class="num" id="5612110">13</span><span class="op" id="5612112">]</span><span class="op" id="5612113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612116">if</span>&nbsp;<span class="ident" id="5612119">err</span>&nbsp;<span class="op" id="5612123">!=</span>&nbsp;<span class="ident" id="5612126">nil</span>&nbsp;<span class="op" id="5612130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612134">return</span>&nbsp;<span class="ident" id="5612141">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612149">d</span><span class="op" id="5612150">.</span><span class="ident" id="5612151">vers</span>&nbsp;<span class="op" id="5612156">=</span>&nbsp;<span class="builtintype" id="5612158">string</span><span class="op" id="5612164">(</span><span class="ident" id="5612165">d</span><span class="op" id="5612166">.</span><span class="ident" id="5612167">tmp</span><span class="op" id="5612170">[</span><span class="num" id="5612171">0</span><span class="op" id="5612172">:</span><span class="num" id="5612173">6</span><span class="op" id="5612174">]</span><span class="op" id="5612175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612178">if</span>&nbsp;<span class="ident" id="5612181">d</span><span class="op" id="5612182">.</span><span class="ident" id="5612183">vers</span>&nbsp;<span class="op" id="5612188">!=</span>&nbsp;<span class="string" id="5612191">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="5612200">&amp;&amp;</span>&nbsp;<span class="ident" id="5612203">d</span><span class="op" id="5612204">.</span><span class="ident" id="5612205">vers</span>&nbsp;<span class="op" id="5612210">!=</span>&nbsp;<span class="string" id="5612213">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="5612222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612226">return</span>&nbsp;<span class="ident" id="5612233">fmt</span><span class="op" id="5612236">.</span><span class="ident" id="5612237">Errorf</span><span class="op" id="5612243">(</span><span class="string" id="5612244">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="5612276">,</span>&nbsp;<span class="ident" id="5612278">d</span><span class="op" id="5612279">.</span><span class="ident" id="5612280">vers</span><span class="op" id="5612284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612287">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612290">d</span><span class="op" id="5612291">.</span><span class="ident" id="5612292">width</span>&nbsp;<span class="op" id="5612298">=</span>&nbsp;<span class="builtintype" id="5612300">int</span><span class="op" id="5612303">(</span><span class="ident" id="5612304">d</span><span class="op" id="5612305">.</span><span class="ident" id="5612306">tmp</span><span class="op" id="5612309">[</span><span class="num" id="5612310">6</span><span class="op" id="5612311">]</span><span class="op" id="5612312">)</span>&nbsp;<span class="op" id="5612314">+</span>&nbsp;<span class="builtintype" id="5612316">int</span><span class="op" id="5612319">(</span><span class="ident" id="5612320">d</span><span class="op" id="5612321">.</span><span class="ident" id="5612322">tmp</span><span class="op" id="5612325">[</span><span class="num" id="5612326">7</span><span class="op" id="5612327">]</span><span class="op" id="5612328">)</span><span class="op" id="5612329">&lt;&lt;</span><span class="num" id="5612331">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612334">d</span><span class="op" id="5612335">.</span><span class="ident" id="5612336">height</span>&nbsp;<span class="op" id="5612343">=</span>&nbsp;<span class="builtintype" id="5612345">int</span><span class="op" id="5612348">(</span><span class="ident" id="5612349">d</span><span class="op" id="5612350">.</span><span class="ident" id="5612351">tmp</span><span class="op" id="5612354">[</span><span class="num" id="5612355">8</span><span class="op" id="5612356">]</span><span class="op" id="5612357">)</span>&nbsp;<span class="op" id="5612359">+</span>&nbsp;<span class="builtintype" id="5612361">int</span><span class="op" id="5612364">(</span><span class="ident" id="5612365">d</span><span class="op" id="5612366">.</span><span class="ident" id="5612367">tmp</span><span class="op" id="5612370">[</span><span class="num" id="5612371">9</span><span class="op" id="5612372">]</span><span class="op" id="5612373">)</span><span class="op" id="5612374">&lt;&lt;</span><span class="num" id="5612376">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612379">d</span><span class="op" id="5612380">.</span><span class="ident" id="5612381">headerFields</span>&nbsp;<span class="op" id="5612394">=</span>&nbsp;<span class="ident" id="5612396">d</span><span class="op" id="5612397">.</span><span class="ident" id="5612398">tmp</span><span class="op" id="5612401">[</span><span class="num" id="5612402">10</span><span class="op" id="5612404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612407">d</span><span class="op" id="5612408">.</span><span class="ident" id="5612409">backgroundIndex</span>&nbsp;<span class="op" id="5612425">=</span>&nbsp;<span class="ident" id="5612427">d</span><span class="op" id="5612428">.</span><span class="ident" id="5612429">tmp</span><span class="op" id="5612432">[</span><span class="num" id="5612433">11</span><span class="op" id="5612435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612438">d</span><span class="op" id="5612439">.</span><span class="ident" id="5612440">aspect</span>&nbsp;<span class="op" id="5612447">=</span>&nbsp;<span class="ident" id="5612449">d</span><span class="op" id="5612450">.</span><span class="ident" id="5612451">tmp</span><span class="op" id="5612454">[</span><span class="num" id="5612455">12</span><span class="op" id="5612457">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612460">d</span><span class="op" id="5612461">.</span><span class="ident" id="5612462">loopCount</span>&nbsp;<span class="op" id="5612472">=</span>&nbsp;<span class="op" id="5612474">-</span><span class="num" id="5612475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612478">d</span><span class="op" id="5612479">.</span><span class="ident" id="5612480">pixelSize</span>&nbsp;<span class="op" id="5612490">=</span>&nbsp;<span class="builtintype" id="5612492">uint</span><span class="op" id="5612496">(</span><span class="ident" id="5612497">d</span><span class="op" id="5612498">.</span><span class="ident" id="5612499">headerFields</span><span class="op" id="5612511">&amp;</span><span class="num" id="5612512">7</span><span class="op" id="5612513">)</span>&nbsp;<span class="op" id="5612515">+</span>&nbsp;<span class="num" id="5612517">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612520">return</span>&nbsp;<span class="ident" id="5612527">nil</span><br>
<span class="lineno"></span><span class="op" id="5612531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5612534">func</span>&nbsp;<span class="op" id="5612539">(</span><span class="ident" id="5612540">d</span>&nbsp;<span class="op" id="5612542">*</span><span class="ident" id="5612543">decoder</span><span class="op" id="5612550">)</span>&nbsp;<span class="ident" id="5612552">readColorMap</span><span class="op" id="5612564">(</span><span class="op" id="5612565">)</span>&nbsp;<span class="op" id="5612567">(</span><span class="ident" id="5612568">color</span><span class="op" id="5612573">.</span><span class="ident" id="5612574">Palette</span><span class="op" id="5612581">,</span>&nbsp;<span class="builtintype" id="5612583">error</span><span class="op" id="5612588">)</span>&nbsp;<span class="op" id="5612590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612593">if</span>&nbsp;<span class="ident" id="5612596">d</span><span class="op" id="5612597">.</span><span class="ident" id="5612598">pixelSize</span>&nbsp;<span class="op" id="5612608">&gt;</span>&nbsp;<span class="num" id="5612610">8</span>&nbsp;<span class="op" id="5612612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612616">return</span>&nbsp;<span class="ident" id="5612623">nil</span><span class="op" id="5612626">,</span>&nbsp;<span class="ident" id="5612628">fmt</span><span class="op" id="5612631">.</span><span class="ident" id="5612632">Errorf</span><span class="op" id="5612638">(</span><span class="string" id="5612639">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="5612676">,</span>&nbsp;<span class="ident" id="5612678">d</span><span class="op" id="5612679">.</span><span class="ident" id="5612680">pixelSize</span><span class="op" id="5612689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612695">numColors</span>&nbsp;<span class="op" id="5612705">:=</span>&nbsp;<span class="num" id="5612708">1</span>&nbsp;<span class="op" id="5612710">&lt;&lt;</span>&nbsp;<span class="ident" id="5612713">d</span><span class="op" id="5612714">.</span><span class="ident" id="5612715">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612726">if</span>&nbsp;<span class="ident" id="5612729">d</span><span class="op" id="5612730">.</span><span class="ident" id="5612731">imageFields</span><span class="op" id="5612742">&amp;</span><span class="ident" id="5612743">ifLocalColorTable</span>&nbsp;<span class="op" id="5612761">!=</span>&nbsp;<span class="num" id="5612764">0</span>&nbsp;<span class="op" id="5612766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612770">numColors</span>&nbsp;<span class="op" id="5612780">=</span>&nbsp;<span class="num" id="5612782">1</span>&nbsp;<span class="op" id="5612784">&lt;&lt;</span>&nbsp;<span class="op" id="5612787">(</span><span class="op" id="5612788">(</span><span class="ident" id="5612789">d</span><span class="op" id="5612790">.</span><span class="ident" id="5612791">imageFields</span>&nbsp;<span class="op" id="5612803">&amp;</span>&nbsp;<span class="ident" id="5612805">ifPixelSizeMask</span><span class="op" id="5612820">)</span>&nbsp;<span class="op" id="5612822">+</span>&nbsp;<span class="num" id="5612824">1</span><span class="op" id="5612825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612831">numValues</span>&nbsp;<span class="op" id="5612841">:=</span>&nbsp;<span class="num" id="5612844">3</span>&nbsp;<span class="op" id="5612846">*</span>&nbsp;<span class="ident" id="5612848">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612859">_</span><span class="op" id="5612860">,</span>&nbsp;<span class="ident" id="5612862">err</span>&nbsp;<span class="op" id="5612866">:=</span>&nbsp;<span class="ident" id="5612869">io</span><span class="op" id="5612871">.</span><span class="ident" id="5612872">ReadFull</span><span class="op" id="5612880">(</span><span class="ident" id="5612881">d</span><span class="op" id="5612882">.</span><span class="ident" id="5612883">r</span><span class="op" id="5612884">,</span>&nbsp;<span class="ident" id="5612886">d</span><span class="op" id="5612887">.</span><span class="ident" id="5612888">tmp</span><span class="op" id="5612891">[</span><span class="num" id="5612892">0</span><span class="op" id="5612893">:</span><span class="ident" id="5612894">numValues</span><span class="op" id="5612903">]</span><span class="op" id="5612904">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612907">if</span>&nbsp;<span class="ident" id="5612910">err</span>&nbsp;<span class="op" id="5612914">!=</span>&nbsp;<span class="ident" id="5612917">nil</span>&nbsp;<span class="op" id="5612921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612925">return</span>&nbsp;<span class="ident" id="5612932">nil</span><span class="op" id="5612935">,</span>&nbsp;<span class="ident" id="5612937">fmt</span><span class="op" id="5612940">.</span><span class="ident" id="5612941">Errorf</span><span class="op" id="5612947">(</span><span class="string" id="5612948">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="5612982">,</span>&nbsp;<span class="ident" id="5612984">err</span><span class="op" id="5612987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612993">colorMap</span>&nbsp;<span class="op" id="5613002">:=</span>&nbsp;<span class="builtinfunc" id="5613005">make</span><span class="op" id="5613009">(</span><span class="ident" id="5613010">color</span><span class="op" id="5613015">.</span><span class="ident" id="5613016">Palette</span><span class="op" id="5613023">,</span>&nbsp;<span class="ident" id="5613025">numColors</span><span class="op" id="5613034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613037">j</span>&nbsp;<span class="op" id="5613039">:=</span>&nbsp;<span class="num" id="5613042">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613045">for</span>&nbsp;<span class="ident" id="5613049">i</span>&nbsp;<span class="op" id="5613051">:=</span>&nbsp;<span class="keyword" id="5613054">range</span>&nbsp;<span class="ident" id="5613060">colorMap</span>&nbsp;<span class="op" id="5613069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613073">colorMap</span><span class="op" id="5613081">[</span><span class="ident" id="5613082">i</span><span class="op" id="5613083">]</span>&nbsp;<span class="op" id="5613085">=</span>&nbsp;<span class="ident" id="5613087">color</span><span class="op" id="5613092">.</span><span class="ident" id="5613093">RGBA</span><span class="op" id="5613097">{</span><span class="ident" id="5613098">d</span><span class="op" id="5613099">.</span><span class="ident" id="5613100">tmp</span><span class="op" id="5613103">[</span><span class="ident" id="5613104">j</span><span class="op" id="5613105">+</span><span class="num" id="5613106">0</span><span class="op" id="5613107">]</span><span class="op" id="5613108">,</span>&nbsp;<span class="ident" id="5613110">d</span><span class="op" id="5613111">.</span><span class="ident" id="5613112">tmp</span><span class="op" id="5613115">[</span><span class="ident" id="5613116">j</span><span class="op" id="5613117">+</span><span class="num" id="5613118">1</span><span class="op" id="5613119">]</span><span class="op" id="5613120">,</span>&nbsp;<span class="ident" id="5613122">d</span><span class="op" id="5613123">.</span><span class="ident" id="5613124">tmp</span><span class="op" id="5613127">[</span><span class="ident" id="5613128">j</span><span class="op" id="5613129">+</span><span class="num" id="5613130">2</span><span class="op" id="5613131">]</span><span class="op" id="5613132">,</span>&nbsp;<span class="num" id="5613134">0xFF</span><span class="op" id="5613138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613142">j</span>&nbsp;<span class="op" id="5613144">+=</span>&nbsp;<span class="num" id="5613147">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613153">return</span>&nbsp;<span class="ident" id="5613160">colorMap</span><span class="op" id="5613168">,</span>&nbsp;<span class="ident" id="5613170">nil</span><br>
<span class="lineno">295</span><span class="op" id="5613174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5613177">func</span>&nbsp;<span class="op" id="5613182">(</span><span class="ident" id="5613183">d</span>&nbsp;<span class="op" id="5613185">*</span><span class="ident" id="5613186">decoder</span><span class="op" id="5613193">)</span>&nbsp;<span class="ident" id="5613195">readExtension</span><span class="op" id="5613208">(</span><span class="op" id="5613209">)</span>&nbsp;<span class="builtintype" id="5613211">error</span>&nbsp;<span class="op" id="5613217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613220">extension</span><span class="op" id="5613229">,</span>&nbsp;<span class="ident" id="5613231">err</span>&nbsp;<span class="op" id="5613235">:=</span>&nbsp;<span class="ident" id="5613238">d</span><span class="op" id="5613239">.</span><span class="ident" id="5613240">r</span><span class="op" id="5613241">.</span><span class="ident" id="5613242">ReadByte</span><span class="op" id="5613250">(</span><span class="op" id="5613251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613254">if</span>&nbsp;<span class="ident" id="5613257">err</span>&nbsp;<span class="op" id="5613261">!=</span>&nbsp;<span class="ident" id="5613264">nil</span>&nbsp;<span class="op" id="5613268">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613272">return</span>&nbsp;<span class="ident" id="5613279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613287">size</span>&nbsp;<span class="op" id="5613292">:=</span>&nbsp;<span class="num" id="5613295">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613298">switch</span>&nbsp;<span class="ident" id="5613305">extension</span>&nbsp;<span class="op" id="5613315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613318">case</span>&nbsp;<span class="ident" id="5613323">eText</span><span class="op" id="5613328">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613332">size</span>&nbsp;<span class="op" id="5613337">=</span>&nbsp;<span class="num" id="5613339">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613343">case</span>&nbsp;<span class="ident" id="5613348">eGraphicControl</span><span class="op" id="5613363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613367">return</span>&nbsp;<span class="ident" id="5613374">d</span><span class="op" id="5613375">.</span><span class="ident" id="5613376">readGraphicControl</span><span class="op" id="5613394">(</span><span class="op" id="5613395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613398">case</span>&nbsp;<span class="ident" id="5613403">eComment</span><span class="op" id="5613411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613415">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613452">case</span>&nbsp;<span class="ident" id="5613457">eApplication</span><span class="op" id="5613469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613473">b</span><span class="op" id="5613474">,</span>&nbsp;<span class="ident" id="5613476">err</span>&nbsp;<span class="op" id="5613480">:=</span>&nbsp;<span class="ident" id="5613483">d</span><span class="op" id="5613484">.</span><span class="ident" id="5613485">r</span><span class="op" id="5613486">.</span><span class="ident" id="5613487">ReadByte</span><span class="op" id="5613495">(</span><span class="op" id="5613496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613500">if</span>&nbsp;<span class="ident" id="5613503">err</span>&nbsp;<span class="op" id="5613507">!=</span>&nbsp;<span class="ident" id="5613510">nil</span>&nbsp;<span class="op" id="5613514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613519">return</span>&nbsp;<span class="ident" id="5613526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613532">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613536">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613600">size</span>&nbsp;<span class="op" id="5613605">=</span>&nbsp;<span class="builtintype" id="5613607">int</span><span class="op" id="5613610">(</span><span class="ident" id="5613611">b</span><span class="op" id="5613612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613615">default</span><span class="op" id="5613622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613626">return</span>&nbsp;<span class="ident" id="5613633">fmt</span><span class="op" id="5613636">.</span><span class="ident" id="5613637">Errorf</span><span class="op" id="5613643">(</span><span class="string" id="5613644">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="5613675">,</span>&nbsp;<span class="ident" id="5613677">extension</span><span class="op" id="5613686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613689">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613692">if</span>&nbsp;<span class="ident" id="5613695">size</span>&nbsp;<span class="op" id="5613700">&gt;</span>&nbsp;<span class="num" id="5613702">0</span>&nbsp;<span class="op" id="5613704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613708">if</span>&nbsp;<span class="ident" id="5613711">_</span><span class="op" id="5613712">,</span>&nbsp;<span class="ident" id="5613714">err</span>&nbsp;<span class="op" id="5613718">:=</span>&nbsp;<span class="ident" id="5613721">io</span><span class="op" id="5613723">.</span><span class="ident" id="5613724">ReadFull</span><span class="op" id="5613732">(</span><span class="ident" id="5613733">d</span><span class="op" id="5613734">.</span><span class="ident" id="5613735">r</span><span class="op" id="5613736">,</span>&nbsp;<span class="ident" id="5613738">d</span><span class="op" id="5613739">.</span><span class="ident" id="5613740">tmp</span><span class="op" id="5613743">[</span><span class="num" id="5613744">0</span><span class="op" id="5613745">:</span><span class="ident" id="5613746">size</span><span class="op" id="5613750">]</span><span class="op" id="5613751">)</span><span class="op" id="5613752">;</span>&nbsp;<span class="ident" id="5613754">err</span>&nbsp;<span class="op" id="5613758">!=</span>&nbsp;<span class="ident" id="5613761">nil</span>&nbsp;<span class="op" id="5613765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613770">return</span>&nbsp;<span class="ident" id="5613777">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613786">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613790">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613865">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613906">if</span>&nbsp;<span class="ident" id="5613909">extension</span>&nbsp;<span class="op" id="5613919">==</span>&nbsp;<span class="ident" id="5613922">eApplication</span>&nbsp;<span class="op" id="5613935">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5613938">string</span><span class="op" id="5613944">(</span><span class="ident" id="5613945">d</span><span class="op" id="5613946">.</span><span class="ident" id="5613947">tmp</span><span class="op" id="5613950">[</span><span class="op" id="5613951">:</span><span class="ident" id="5613952">size</span><span class="op" id="5613956">]</span><span class="op" id="5613957">)</span>&nbsp;<span class="op" id="5613959">==</span>&nbsp;<span class="string" id="5613962">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="5613976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613980">n</span><span class="op" id="5613981">,</span>&nbsp;<span class="ident" id="5613983">err</span>&nbsp;<span class="op" id="5613987">:=</span>&nbsp;<span class="ident" id="5613990">d</span><span class="op" id="5613991">.</span><span class="ident" id="5613992">readBlock</span><span class="op" id="5614001">(</span><span class="op" id="5614002">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614006">if</span>&nbsp;<span class="ident" id="5614009">n</span>&nbsp;<span class="op" id="5614011">==</span>&nbsp;<span class="num" id="5614014">0</span>&nbsp;<span class="op" id="5614016">||</span>&nbsp;<span class="ident" id="5614019">err</span>&nbsp;<span class="op" id="5614023">!=</span>&nbsp;<span class="ident" id="5614026">nil</span>&nbsp;<span class="op" id="5614030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614035">return</span>&nbsp;<span class="ident" id="5614042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614052">if</span>&nbsp;<span class="ident" id="5614055">n</span>&nbsp;<span class="op" id="5614057">==</span>&nbsp;<span class="num" id="5614060">3</span>&nbsp;<span class="op" id="5614062">&amp;&amp;</span>&nbsp;<span class="ident" id="5614065">d</span><span class="op" id="5614066">.</span><span class="ident" id="5614067">tmp</span><span class="op" id="5614070">[</span><span class="num" id="5614071">0</span><span class="op" id="5614072">]</span>&nbsp;<span class="op" id="5614074">==</span>&nbsp;<span class="num" id="5614077">1</span>&nbsp;<span class="op" id="5614079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614084">d</span><span class="op" id="5614085">.</span><span class="ident" id="5614086">loopCount</span>&nbsp;<span class="op" id="5614096">=</span>&nbsp;<span class="builtintype" id="5614098">int</span><span class="op" id="5614101">(</span><span class="ident" id="5614102">d</span><span class="op" id="5614103">.</span><span class="ident" id="5614104">tmp</span><span class="op" id="5614107">[</span><span class="num" id="5614108">1</span><span class="op" id="5614109">]</span><span class="op" id="5614110">)</span>&nbsp;<span class="op" id="5614112">|</span>&nbsp;<span class="builtintype" id="5614114">int</span><span class="op" id="5614117">(</span><span class="ident" id="5614118">d</span><span class="op" id="5614119">.</span><span class="ident" id="5614120">tmp</span><span class="op" id="5614123">[</span><span class="num" id="5614124">2</span><span class="op" id="5614125">]</span><span class="op" id="5614126">)</span><span class="op" id="5614127">&lt;&lt;</span><span class="num" id="5614129">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614139">for</span>&nbsp;<span class="op" id="5614143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614147">n</span><span class="op" id="5614148">,</span>&nbsp;<span class="ident" id="5614150">err</span>&nbsp;<span class="op" id="5614154">:=</span>&nbsp;<span class="ident" id="5614157">d</span><span class="op" id="5614158">.</span><span class="ident" id="5614159">readBlock</span><span class="op" id="5614168">(</span><span class="op" id="5614169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614173">if</span>&nbsp;<span class="ident" id="5614176">n</span>&nbsp;<span class="op" id="5614178">==</span>&nbsp;<span class="num" id="5614181">0</span>&nbsp;<span class="op" id="5614183">||</span>&nbsp;<span class="ident" id="5614186">err</span>&nbsp;<span class="op" id="5614190">!=</span>&nbsp;<span class="ident" id="5614193">nil</span>&nbsp;<span class="op" id="5614197">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614202">return</span>&nbsp;<span class="ident" id="5614209">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614218">}</span><br>
<span class="lineno"></span><span class="op" id="5614220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="5614223">func</span>&nbsp;<span class="op" id="5614228">(</span><span class="ident" id="5614229">d</span>&nbsp;<span class="op" id="5614231">*</span><span class="ident" id="5614232">decoder</span><span class="op" id="5614239">)</span>&nbsp;<span class="ident" id="5614241">readGraphicControl</span><span class="op" id="5614259">(</span><span class="op" id="5614260">)</span>&nbsp;<span class="builtintype" id="5614262">error</span>&nbsp;<span class="op" id="5614268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614271">if</span>&nbsp;<span class="ident" id="5614274">_</span><span class="op" id="5614275">,</span>&nbsp;<span class="ident" id="5614277">err</span>&nbsp;<span class="op" id="5614281">:=</span>&nbsp;<span class="ident" id="5614284">io</span><span class="op" id="5614286">.</span><span class="ident" id="5614287">ReadFull</span><span class="op" id="5614295">(</span><span class="ident" id="5614296">d</span><span class="op" id="5614297">.</span><span class="ident" id="5614298">r</span><span class="op" id="5614299">,</span>&nbsp;<span class="ident" id="5614301">d</span><span class="op" id="5614302">.</span><span class="ident" id="5614303">tmp</span><span class="op" id="5614306">[</span><span class="num" id="5614307">0</span><span class="op" id="5614308">:</span><span class="num" id="5614309">6</span><span class="op" id="5614310">]</span><span class="op" id="5614311">)</span><span class="op" id="5614312">;</span>&nbsp;<span class="ident" id="5614314">err</span>&nbsp;<span class="op" id="5614318">!=</span>&nbsp;<span class="ident" id="5614321">nil</span>&nbsp;<span class="op" id="5614325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614329">return</span>&nbsp;<span class="ident" id="5614336">fmt</span><span class="op" id="5614339">.</span><span class="ident" id="5614340">Errorf</span><span class="op" id="5614346">(</span><span class="string" id="5614347">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="5614384">,</span>&nbsp;<span class="ident" id="5614386">err</span><span class="op" id="5614389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614395">d</span><span class="op" id="5614396">.</span><span class="ident" id="5614397">flags</span>&nbsp;<span class="op" id="5614403">=</span>&nbsp;<span class="ident" id="5614405">d</span><span class="op" id="5614406">.</span><span class="ident" id="5614407">tmp</span><span class="op" id="5614410">[</span><span class="num" id="5614411">1</span><span class="op" id="5614412">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614415">d</span><span class="op" id="5614416">.</span><span class="ident" id="5614417">delayTime</span>&nbsp;<span class="op" id="5614427">=</span>&nbsp;<span class="builtintype" id="5614429">int</span><span class="op" id="5614432">(</span><span class="ident" id="5614433">d</span><span class="op" id="5614434">.</span><span class="ident" id="5614435">tmp</span><span class="op" id="5614438">[</span><span class="num" id="5614439">2</span><span class="op" id="5614440">]</span><span class="op" id="5614441">)</span>&nbsp;<span class="op" id="5614443">|</span>&nbsp;<span class="builtintype" id="5614445">int</span><span class="op" id="5614448">(</span><span class="ident" id="5614449">d</span><span class="op" id="5614450">.</span><span class="ident" id="5614451">tmp</span><span class="op" id="5614454">[</span><span class="num" id="5614455">3</span><span class="op" id="5614456">]</span><span class="op" id="5614457">)</span><span class="op" id="5614458">&lt;&lt;</span><span class="num" id="5614460">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614463">if</span>&nbsp;<span class="ident" id="5614466">d</span><span class="op" id="5614467">.</span><span class="ident" id="5614468">flags</span><span class="op" id="5614473">&amp;</span><span class="ident" id="5614474">gcTransparentColorSet</span>&nbsp;<span class="op" id="5614496">!=</span>&nbsp;<span class="num" id="5614499">0</span>&nbsp;<span class="op" id="5614501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614505">d</span><span class="op" id="5614506">.</span><span class="ident" id="5614507">transparentIndex</span>&nbsp;<span class="op" id="5614524">=</span>&nbsp;<span class="ident" id="5614526">d</span><span class="op" id="5614527">.</span><span class="ident" id="5614528">tmp</span><span class="op" id="5614531">[</span><span class="num" id="5614532">4</span><span class="op" id="5614533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614537">d</span><span class="op" id="5614538">.</span><span class="ident" id="5614539">hasTransparentIndex</span>&nbsp;<span class="op" id="5614559">=</span>&nbsp;<span class="builtintype" id="5614561">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614567">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614570">return</span>&nbsp;<span class="ident" id="5614577">nil</span><br>
<span class="lineno"></span><span class="op" id="5614581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5614584">func</span>&nbsp;<span class="op" id="5614589">(</span><span class="ident" id="5614590">d</span>&nbsp;<span class="op" id="5614592">*</span><span class="ident" id="5614593">decoder</span><span class="op" id="5614600">)</span>&nbsp;<span class="ident" id="5614602">newImageFromDescriptor</span><span class="op" id="5614624">(</span><span class="op" id="5614625">)</span>&nbsp;<span class="op" id="5614627">(</span><span class="op" id="5614628">*</span><span class="ident" id="5614629">image</span><span class="op" id="5614634">.</span><span class="ident" id="5614635">Paletted</span><span class="op" id="5614643">,</span>&nbsp;<span class="builtintype" id="5614645">error</span><span class="op" id="5614650">)</span>&nbsp;<span class="op" id="5614652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614655">if</span>&nbsp;<span class="ident" id="5614658">_</span><span class="op" id="5614659">,</span>&nbsp;<span class="ident" id="5614661">err</span>&nbsp;<span class="op" id="5614665">:=</span>&nbsp;<span class="ident" id="5614668">io</span><span class="op" id="5614670">.</span><span class="ident" id="5614671">ReadFull</span><span class="op" id="5614679">(</span><span class="ident" id="5614680">d</span><span class="op" id="5614681">.</span><span class="ident" id="5614682">r</span><span class="op" id="5614683">,</span>&nbsp;<span class="ident" id="5614685">d</span><span class="op" id="5614686">.</span><span class="ident" id="5614687">tmp</span><span class="op" id="5614690">[</span><span class="num" id="5614691">0</span><span class="op" id="5614692">:</span><span class="num" id="5614693">9</span><span class="op" id="5614694">]</span><span class="op" id="5614695">)</span><span class="op" id="5614696">;</span>&nbsp;<span class="ident" id="5614698">err</span>&nbsp;<span class="op" id="5614702">!=</span>&nbsp;<span class="ident" id="5614705">nil</span>&nbsp;<span class="op" id="5614709">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614713">return</span>&nbsp;<span class="ident" id="5614720">nil</span><span class="op" id="5614723">,</span>&nbsp;<span class="ident" id="5614725">fmt</span><span class="op" id="5614728">.</span><span class="ident" id="5614729">Errorf</span><span class="op" id="5614735">(</span><span class="string" id="5614736">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="5614774">,</span>&nbsp;<span class="ident" id="5614776">err</span><span class="op" id="5614779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614785">left</span>&nbsp;<span class="op" id="5614790">:=</span>&nbsp;<span class="builtintype" id="5614793">int</span><span class="op" id="5614796">(</span><span class="ident" id="5614797">d</span><span class="op" id="5614798">.</span><span class="ident" id="5614799">tmp</span><span class="op" id="5614802">[</span><span class="num" id="5614803">0</span><span class="op" id="5614804">]</span><span class="op" id="5614805">)</span>&nbsp;<span class="op" id="5614807">+</span>&nbsp;<span class="builtintype" id="5614809">int</span><span class="op" id="5614812">(</span><span class="ident" id="5614813">d</span><span class="op" id="5614814">.</span><span class="ident" id="5614815">tmp</span><span class="op" id="5614818">[</span><span class="num" id="5614819">1</span><span class="op" id="5614820">]</span><span class="op" id="5614821">)</span><span class="op" id="5614822">&lt;&lt;</span><span class="num" id="5614824">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614827">top</span>&nbsp;<span class="op" id="5614831">:=</span>&nbsp;<span class="builtintype" id="5614834">int</span><span class="op" id="5614837">(</span><span class="ident" id="5614838">d</span><span class="op" id="5614839">.</span><span class="ident" id="5614840">tmp</span><span class="op" id="5614843">[</span><span class="num" id="5614844">2</span><span class="op" id="5614845">]</span><span class="op" id="5614846">)</span>&nbsp;<span class="op" id="5614848">+</span>&nbsp;<span class="builtintype" id="5614850">int</span><span class="op" id="5614853">(</span><span class="ident" id="5614854">d</span><span class="op" id="5614855">.</span><span class="ident" id="5614856">tmp</span><span class="op" id="5614859">[</span><span class="num" id="5614860">3</span><span class="op" id="5614861">]</span><span class="op" id="5614862">)</span><span class="op" id="5614863">&lt;&lt;</span><span class="num" id="5614865">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614868">width</span>&nbsp;<span class="op" id="5614874">:=</span>&nbsp;<span class="builtintype" id="5614877">int</span><span class="op" id="5614880">(</span><span class="ident" id="5614881">d</span><span class="op" id="5614882">.</span><span class="ident" id="5614883">tmp</span><span class="op" id="5614886">[</span><span class="num" id="5614887">4</span><span class="op" id="5614888">]</span><span class="op" id="5614889">)</span>&nbsp;<span class="op" id="5614891">+</span>&nbsp;<span class="builtintype" id="5614893">int</span><span class="op" id="5614896">(</span><span class="ident" id="5614897">d</span><span class="op" id="5614898">.</span><span class="ident" id="5614899">tmp</span><span class="op" id="5614902">[</span><span class="num" id="5614903">5</span><span class="op" id="5614904">]</span><span class="op" id="5614905">)</span><span class="op" id="5614906">&lt;&lt;</span><span class="num" id="5614908">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614911">height</span>&nbsp;<span class="op" id="5614918">:=</span>&nbsp;<span class="builtintype" id="5614921">int</span><span class="op" id="5614924">(</span><span class="ident" id="5614925">d</span><span class="op" id="5614926">.</span><span class="ident" id="5614927">tmp</span><span class="op" id="5614930">[</span><span class="num" id="5614931">6</span><span class="op" id="5614932">]</span><span class="op" id="5614933">)</span>&nbsp;<span class="op" id="5614935">+</span>&nbsp;<span class="builtintype" id="5614937">int</span><span class="op" id="5614940">(</span><span class="ident" id="5614941">d</span><span class="op" id="5614942">.</span><span class="ident" id="5614943">tmp</span><span class="op" id="5614946">[</span><span class="num" id="5614947">7</span><span class="op" id="5614948">]</span><span class="op" id="5614949">)</span><span class="op" id="5614950">&lt;&lt;</span><span class="num" id="5614952">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614955">d</span><span class="op" id="5614956">.</span><span class="ident" id="5614957">imageFields</span>&nbsp;<span class="op" id="5614969">=</span>&nbsp;<span class="ident" id="5614971">d</span><span class="op" id="5614972">.</span><span class="ident" id="5614973">tmp</span><span class="op" id="5614976">[</span><span class="num" id="5614977">8</span><span class="op" id="5614978">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614982">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5615039">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5615101">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615159">bounds</span>&nbsp;<span class="op" id="5615166">:=</span>&nbsp;<span class="ident" id="5615169">image</span><span class="op" id="5615174">.</span><span class="ident" id="5615175">Rect</span><span class="op" id="5615179">(</span><span class="ident" id="5615180">left</span><span class="op" id="5615184">,</span>&nbsp;<span class="ident" id="5615186">top</span><span class="op" id="5615189">,</span>&nbsp;<span class="ident" id="5615191">left</span><span class="op" id="5615195">+</span><span class="ident" id="5615196">width</span><span class="op" id="5615201">,</span>&nbsp;<span class="ident" id="5615203">top</span><span class="op" id="5615206">+</span><span class="ident" id="5615207">height</span><span class="op" id="5615213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615216">if</span>&nbsp;<span class="ident" id="5615219">bounds</span>&nbsp;<span class="op" id="5615226">!=</span>&nbsp;<span class="ident" id="5615229">bounds</span><span class="op" id="5615235">.</span><span class="ident" id="5615236">Intersect</span><span class="op" id="5615245">(</span><span class="ident" id="5615246">image</span><span class="op" id="5615251">.</span><span class="ident" id="5615252">Rect</span><span class="op" id="5615256">(</span><span class="num" id="5615257">0</span><span class="op" id="5615258">,</span>&nbsp;<span class="num" id="5615260">0</span><span class="op" id="5615261">,</span>&nbsp;<span class="ident" id="5615263">d</span><span class="op" id="5615264">.</span><span class="ident" id="5615265">width</span><span class="op" id="5615270">,</span>&nbsp;<span class="ident" id="5615272">d</span><span class="op" id="5615273">.</span><span class="ident" id="5615274">height</span><span class="op" id="5615280">)</span><span class="op" id="5615281">)</span>&nbsp;<span class="op" id="5615283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615287">return</span>&nbsp;<span class="ident" id="5615294">nil</span><span class="op" id="5615297">,</span>&nbsp;<span class="ident" id="5615299">errors</span><span class="op" id="5615305">.</span><span class="ident" id="5615306">New</span><span class="op" id="5615309">(</span><span class="string" id="5615310">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="5615354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615357">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615360">return</span>&nbsp;<span class="ident" id="5615367">image</span><span class="op" id="5615372">.</span><span class="ident" id="5615373">NewPaletted</span><span class="op" id="5615384">(</span><span class="ident" id="5615385">bounds</span><span class="op" id="5615391">,</span>&nbsp;<span class="ident" id="5615393">nil</span><span class="op" id="5615396">)</span><span class="op" id="5615397">,</span>&nbsp;<span class="ident" id="5615399">nil</span><br>
<span class="lineno"></span><span class="op" id="5615403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5615406">func</span>&nbsp;<span class="op" id="5615411">(</span><span class="ident" id="5615412">d</span>&nbsp;<span class="op" id="5615414">*</span><span class="ident" id="5615415">decoder</span><span class="op" id="5615422">)</span>&nbsp;<span class="ident" id="5615424">readBlock</span><span class="op" id="5615433">(</span><span class="op" id="5615434">)</span>&nbsp;<span class="op" id="5615436">(</span><span class="builtintype" id="5615437">int</span><span class="op" id="5615440">,</span>&nbsp;<span class="builtintype" id="5615442">error</span><span class="op" id="5615447">)</span>&nbsp;<span class="op" id="5615449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615452">n</span><span class="op" id="5615453">,</span>&nbsp;<span class="ident" id="5615455">err</span>&nbsp;<span class="op" id="5615459">:=</span>&nbsp;<span class="ident" id="5615462">d</span><span class="op" id="5615463">.</span><span class="ident" id="5615464">r</span><span class="op" id="5615465">.</span><span class="ident" id="5615466">ReadByte</span><span class="op" id="5615474">(</span><span class="op" id="5615475">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615478">if</span>&nbsp;<span class="ident" id="5615481">n</span>&nbsp;<span class="op" id="5615483">==</span>&nbsp;<span class="num" id="5615486">0</span>&nbsp;<span class="op" id="5615488">||</span>&nbsp;<span class="ident" id="5615491">err</span>&nbsp;<span class="op" id="5615495">!=</span>&nbsp;<span class="ident" id="5615498">nil</span>&nbsp;<span class="op" id="5615502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615506">return</span>&nbsp;<span class="num" id="5615513">0</span><span class="op" id="5615514">,</span>&nbsp;<span class="ident" id="5615516">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615524">return</span>&nbsp;<span class="ident" id="5615531">io</span><span class="op" id="5615533">.</span><span class="ident" id="5615534">ReadFull</span><span class="op" id="5615542">(</span><span class="ident" id="5615543">d</span><span class="op" id="5615544">.</span><span class="ident" id="5615545">r</span><span class="op" id="5615546">,</span>&nbsp;<span class="ident" id="5615548">d</span><span class="op" id="5615549">.</span><span class="ident" id="5615550">tmp</span><span class="op" id="5615553">[</span><span class="num" id="5615554">0</span><span class="op" id="5615555">:</span><span class="ident" id="5615556">n</span><span class="op" id="5615557">]</span><span class="op" id="5615558">)</span><br>
<span class="lineno"></span><span class="op" id="5615560">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="5615563">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="5615640">type</span>&nbsp;<span class="ident" id="5615645">interlaceScan</span>&nbsp;<span class="keyword" id="5615659">struct</span>&nbsp;<span class="op" id="5615666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615669">skip</span><span class="op" id="5615673">,</span>&nbsp;<span class="ident" id="5615675">start</span>&nbsp;<span class="builtintype" id="5615681">int</span><br>
<span class="lineno"></span><span class="op" id="5615685">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="5615688">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5615759">var</span>&nbsp;<span class="ident" id="5615763">interlacing</span>&nbsp;<span class="op" id="5615775">=</span>&nbsp;<span class="op" id="5615777">[</span><span class="op" id="5615778">]</span><span class="ident" id="5615779">interlaceScan</span><span class="op" id="5615792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615795">{</span><span class="num" id="5615796">8</span><span class="op" id="5615797">,</span>&nbsp;<span class="num" id="5615799">0</span><span class="op" id="5615800">}</span><span class="op" id="5615801">,</span>&nbsp;<span class="comment" id="5615803">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615854">{</span><span class="num" id="5615855">8</span><span class="op" id="5615856">,</span>&nbsp;<span class="num" id="5615858">4</span><span class="op" id="5615859">}</span><span class="op" id="5615860">,</span>&nbsp;<span class="comment" id="5615862">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615913">{</span><span class="num" id="5615914">4</span><span class="op" id="5615915">,</span>&nbsp;<span class="num" id="5615917">2</span><span class="op" id="5615918">}</span><span class="op" id="5615919">,</span>&nbsp;<span class="comment" id="5615921">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615972">{</span><span class="num" id="5615973">2</span><span class="op" id="5615974">,</span>&nbsp;<span class="num" id="5615976">1</span><span class="op" id="5615977">}</span><span class="op" id="5615978">,</span>&nbsp;<span class="comment" id="5615980">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="5616030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616033">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="5616108">func</span>&nbsp;<span class="ident" id="5616113">uninterlace</span><span class="op" id="5616124">(</span><span class="ident" id="5616125">m</span>&nbsp;<span class="op" id="5616127">*</span><span class="ident" id="5616128">image</span><span class="op" id="5616133">.</span><span class="ident" id="5616134">Paletted</span><span class="op" id="5616142">)</span>&nbsp;<span class="op" id="5616144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616147">var</span>&nbsp;<span class="ident" id="5616151">nPix</span>&nbsp;<span class="op" id="5616156">[</span><span class="op" id="5616157">]</span><span class="builtintype" id="5616158">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616165">dx</span>&nbsp;<span class="op" id="5616168">:=</span>&nbsp;<span class="ident" id="5616171">m</span><span class="op" id="5616172">.</span><span class="ident" id="5616173">Bounds</span><span class="op" id="5616179">(</span><span class="op" id="5616180">)</span><span class="op" id="5616181">.</span><span class="ident" id="5616182">Dx</span><span class="op" id="5616184">(</span><span class="op" id="5616185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616188">dy</span>&nbsp;<span class="op" id="5616191">:=</span>&nbsp;<span class="ident" id="5616194">m</span><span class="op" id="5616195">.</span><span class="ident" id="5616196">Bounds</span><span class="op" id="5616202">(</span><span class="op" id="5616203">)</span><span class="op" id="5616204">.</span><span class="ident" id="5616205">Dy</span><span class="op" id="5616207">(</span><span class="op" id="5616208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616211">nPix</span>&nbsp;<span class="op" id="5616216">=</span>&nbsp;<span class="builtinfunc" id="5616218">make</span><span class="op" id="5616222">(</span><span class="op" id="5616223">[</span><span class="op" id="5616224">]</span><span class="builtintype" id="5616225">uint8</span><span class="op" id="5616230">,</span>&nbsp;<span class="ident" id="5616232">dx</span><span class="op" id="5616234">*</span><span class="ident" id="5616235">dy</span><span class="op" id="5616237">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616240">offset</span>&nbsp;<span class="op" id="5616247">:=</span>&nbsp;<span class="num" id="5616250">0</span>&nbsp;<span class="comment" id="5616252">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616306">for</span>&nbsp;<span class="ident" id="5616310">_</span><span class="op" id="5616311">,</span>&nbsp;<span class="ident" id="5616313">pass</span>&nbsp;<span class="op" id="5616318">:=</span>&nbsp;<span class="keyword" id="5616321">range</span>&nbsp;<span class="ident" id="5616327">interlacing</span>&nbsp;<span class="op" id="5616339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616343">nOffset</span>&nbsp;<span class="op" id="5616351">:=</span>&nbsp;<span class="ident" id="5616354">pass</span><span class="op" id="5616358">.</span><span class="ident" id="5616359">start</span>&nbsp;<span class="op" id="5616365">*</span>&nbsp;<span class="ident" id="5616367">dx</span>&nbsp;<span class="comment" id="5616370">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616420">for</span>&nbsp;<span class="ident" id="5616424">y</span>&nbsp;<span class="op" id="5616426">:=</span>&nbsp;<span class="ident" id="5616429">pass</span><span class="op" id="5616433">.</span><span class="ident" id="5616434">start</span><span class="op" id="5616439">;</span>&nbsp;<span class="ident" id="5616441">y</span>&nbsp;<span class="op" id="5616443">&lt;</span>&nbsp;<span class="ident" id="5616445">dy</span><span class="op" id="5616447">;</span>&nbsp;<span class="ident" id="5616449">y</span>&nbsp;<span class="op" id="5616451">+=</span>&nbsp;<span class="ident" id="5616454">pass</span><span class="op" id="5616458">.</span><span class="ident" id="5616459">skip</span>&nbsp;<span class="op" id="5616464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5616469">copy</span><span class="op" id="5616473">(</span><span class="ident" id="5616474">nPix</span><span class="op" id="5616478">[</span><span class="ident" id="5616479">nOffset</span><span class="op" id="5616486">:</span><span class="ident" id="5616487">nOffset</span><span class="op" id="5616494">+</span><span class="ident" id="5616495">dx</span><span class="op" id="5616497">]</span><span class="op" id="5616498">,</span>&nbsp;<span class="ident" id="5616500">m</span><span class="op" id="5616501">.</span><span class="ident" id="5616502">Pix</span><span class="op" id="5616505">[</span><span class="ident" id="5616506">offset</span><span class="op" id="5616512">:</span><span class="ident" id="5616513">offset</span><span class="op" id="5616519">+</span><span class="ident" id="5616520">dx</span><span class="op" id="5616522">]</span><span class="op" id="5616523">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616528">offset</span>&nbsp;<span class="op" id="5616535">+=</span>&nbsp;<span class="ident" id="5616538">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616544">nOffset</span>&nbsp;<span class="op" id="5616552">+=</span>&nbsp;<span class="ident" id="5616555">dx</span>&nbsp;<span class="op" id="5616558">*</span>&nbsp;<span class="ident" id="5616560">pass</span><span class="op" id="5616564">.</span><span class="ident" id="5616565">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5616572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5616575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616578">m</span><span class="op" id="5616579">.</span><span class="ident" id="5616580">Pix</span>&nbsp;<span class="op" id="5616584">=</span>&nbsp;<span class="ident" id="5616586">nPix</span><br>
<span class="lineno">415</span><span class="op" id="5616591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616594">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="5616660">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5616688">func</span>&nbsp;<span class="ident" id="5616693">Decode</span><span class="op" id="5616699">(</span><span class="ident" id="5616700">r</span>&nbsp;<span class="ident" id="5616702">io</span><span class="op" id="5616704">.</span><span class="ident" id="5616705">Reader</span><span class="op" id="5616711">)</span>&nbsp;<span class="op" id="5616713">(</span><span class="ident" id="5616714">image</span><span class="op" id="5616719">.</span><span class="ident" id="5616720">Image</span><span class="op" id="5616725">,</span>&nbsp;<span class="builtintype" id="5616727">error</span><span class="op" id="5616732">)</span>&nbsp;<span class="op" id="5616734">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616737">var</span>&nbsp;<span class="ident" id="5616741">d</span>&nbsp;<span class="ident" id="5616743">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616752">if</span>&nbsp;<span class="ident" id="5616755">err</span>&nbsp;<span class="op" id="5616759">:=</span>&nbsp;<span class="ident" id="5616762">d</span><span class="op" id="5616763">.</span><span class="ident" id="5616764">decode</span><span class="op" id="5616770">(</span><span class="ident" id="5616771">r</span><span class="op" id="5616772">,</span>&nbsp;<span class="builtintype" id="5616774">false</span><span class="op" id="5616779">)</span><span class="op" id="5616780">;</span>&nbsp;<span class="ident" id="5616782">err</span>&nbsp;<span class="op" id="5616786">!=</span>&nbsp;<span class="ident" id="5616789">nil</span>&nbsp;<span class="op" id="5616793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616797">return</span>&nbsp;<span class="ident" id="5616804">nil</span><span class="op" id="5616807">,</span>&nbsp;<span class="ident" id="5616809">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5616814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616817">return</span>&nbsp;<span class="ident" id="5616824">d</span><span class="op" id="5616825">.</span><span class="ident" id="5616826">image</span><span class="op" id="5616831">[</span><span class="num" id="5616832">0</span><span class="op" id="5616833">]</span><span class="op" id="5616834">,</span>&nbsp;<span class="ident" id="5616836">nil</span><br>
<span class="lineno">425</span><span class="op" id="5616840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616843">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5616912">type</span>&nbsp;<span class="ident" id="5616917">GIF</span>&nbsp;<span class="keyword" id="5616921">struct</span>&nbsp;<span class="op" id="5616928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616931">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616941">[</span><span class="op" id="5616942">]</span><span class="op" id="5616943">*</span><span class="ident" id="5616944">image</span><span class="op" id="5616949">.</span><span class="ident" id="5616950">Paletted</span>&nbsp;<span class="comment" id="5616959">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616986">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616996">[</span><span class="op" id="5616997">]</span><span class="builtintype" id="5616998">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617014">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617084">LoopCount</span>&nbsp;<span class="builtintype" id="5617094">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617112">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="5617131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617134">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="5617206">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5617233">func</span>&nbsp;<span class="ident" id="5617238">DecodeAll</span><span class="op" id="5617247">(</span><span class="ident" id="5617248">r</span>&nbsp;<span class="ident" id="5617250">io</span><span class="op" id="5617252">.</span><span class="ident" id="5617253">Reader</span><span class="op" id="5617259">)</span>&nbsp;<span class="op" id="5617261">(</span><span class="op" id="5617262">*</span><span class="ident" id="5617263">GIF</span><span class="op" id="5617266">,</span>&nbsp;<span class="builtintype" id="5617268">error</span><span class="op" id="5617273">)</span>&nbsp;<span class="op" id="5617275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617278">var</span>&nbsp;<span class="ident" id="5617282">d</span>&nbsp;<span class="ident" id="5617284">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617293">if</span>&nbsp;<span class="ident" id="5617296">err</span>&nbsp;<span class="op" id="5617300">:=</span>&nbsp;<span class="ident" id="5617303">d</span><span class="op" id="5617304">.</span><span class="ident" id="5617305">decode</span><span class="op" id="5617311">(</span><span class="ident" id="5617312">r</span><span class="op" id="5617313">,</span>&nbsp;<span class="builtintype" id="5617315">false</span><span class="op" id="5617320">)</span><span class="op" id="5617321">;</span>&nbsp;<span class="ident" id="5617323">err</span>&nbsp;<span class="op" id="5617327">!=</span>&nbsp;<span class="ident" id="5617330">nil</span>&nbsp;<span class="op" id="5617334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617338">return</span>&nbsp;<span class="ident" id="5617345">nil</span><span class="op" id="5617348">,</span>&nbsp;<span class="ident" id="5617350">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617358">gif</span>&nbsp;<span class="op" id="5617362">:=</span>&nbsp;<span class="op" id="5617365">&amp;</span><span class="ident" id="5617366">GIF</span><span class="op" id="5617369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617373">Image</span><span class="op" id="5617378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617384">d</span><span class="op" id="5617385">.</span><span class="ident" id="5617386">image</span><span class="op" id="5617391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617395">LoopCount</span><span class="op" id="5617404">:</span>&nbsp;<span class="ident" id="5617406">d</span><span class="op" id="5617407">.</span><span class="ident" id="5617408">loopCount</span><span class="op" id="5617417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617421">Delay</span><span class="op" id="5617426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617432">d</span><span class="op" id="5617433">.</span><span class="ident" id="5617434">delay</span><span class="op" id="5617439">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617445">return</span>&nbsp;<span class="ident" id="5617452">gif</span><span class="op" id="5617455">,</span>&nbsp;<span class="ident" id="5617457">nil</span><br>
<span class="lineno"></span><span class="op" id="5617461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617464">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="5617541">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5617579">func</span>&nbsp;<span class="ident" id="5617584">DecodeConfig</span><span class="op" id="5617596">(</span><span class="ident" id="5617597">r</span>&nbsp;<span class="ident" id="5617599">io</span><span class="op" id="5617601">.</span><span class="ident" id="5617602">Reader</span><span class="op" id="5617608">)</span>&nbsp;<span class="op" id="5617610">(</span><span class="ident" id="5617611">image</span><span class="op" id="5617616">.</span><span class="ident" id="5617617">Config</span><span class="op" id="5617623">,</span>&nbsp;<span class="builtintype" id="5617625">error</span><span class="op" id="5617630">)</span>&nbsp;<span class="op" id="5617632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617635">var</span>&nbsp;<span class="ident" id="5617639">d</span>&nbsp;<span class="ident" id="5617641">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617650">if</span>&nbsp;<span class="ident" id="5617653">err</span>&nbsp;<span class="op" id="5617657">:=</span>&nbsp;<span class="ident" id="5617660">d</span><span class="op" id="5617661">.</span><span class="ident" id="5617662">decode</span><span class="op" id="5617668">(</span><span class="ident" id="5617669">r</span><span class="op" id="5617670">,</span>&nbsp;<span class="builtintype" id="5617672">true</span><span class="op" id="5617676">)</span><span class="op" id="5617677">;</span>&nbsp;<span class="ident" id="5617679">err</span>&nbsp;<span class="op" id="5617683">!=</span>&nbsp;<span class="ident" id="5617686">nil</span>&nbsp;<span class="op" id="5617690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617694">return</span>&nbsp;<span class="ident" id="5617701">image</span><span class="op" id="5617706">.</span><span class="ident" id="5617707">Config</span><span class="op" id="5617713">{</span><span class="op" id="5617714">}</span><span class="op" id="5617715">,</span>&nbsp;<span class="ident" id="5617717">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617725">return</span>&nbsp;<span class="ident" id="5617732">image</span><span class="op" id="5617737">.</span><span class="ident" id="5617738">Config</span><span class="op" id="5617744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617748">ColorModel</span><span class="op" id="5617758">:</span>&nbsp;<span class="ident" id="5617760">d</span><span class="op" id="5617761">.</span><span class="ident" id="5617762">globalColorMap</span><span class="op" id="5617776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617780">Width</span><span class="op" id="5617785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617792">d</span><span class="op" id="5617793">.</span><span class="ident" id="5617794">width</span><span class="op" id="5617799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617803">Height</span><span class="op" id="5617809">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617815">d</span><span class="op" id="5617816">.</span><span class="ident" id="5617817">height</span><span class="op" id="5617823">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617826">}</span><span class="op" id="5617827">,</span>&nbsp;<span class="ident" id="5617829">nil</span><br>
<span class="lineno"></span><span class="op" id="5617833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5617836">func</span>&nbsp;<span class="ident" id="5617841">init</span><span class="op" id="5617845">(</span><span class="op" id="5617846">)</span>&nbsp;<span class="op" id="5617848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617851">image</span><span class="op" id="5617856">.</span><span class="ident" id="5617857">RegisterFormat</span><span class="op" id="5617871">(</span><span class="string" id="5617872">&#34;gif&#34;</span><span class="op" id="5617877">,</span>&nbsp;<span class="string" id="5617879">&#34;GIF8?a&#34;</span><span class="op" id="5617887">,</span>&nbsp;<span class="ident" id="5617889">Decode</span><span class="op" id="5617895">,</span>&nbsp;<span class="ident" id="5617897">DecodeConfig</span><span class="op" id="5617909">)</span><br>
<span class="lineno">465</span><span class="op" id="5617911">}</span>
</div>
</body>
</html>
