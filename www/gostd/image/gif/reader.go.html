<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6030562">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6030617">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6030671">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6030722">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6030781">//</span><br>
<span class="lineno"></span><span class="comment" id="6030784">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6030863">package</span>&nbsp;<span class="ident" id="6030871">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6030876">import</span>&nbsp;<span class="op" id="6030883">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030886">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030895">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030911">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030921">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030928">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030937">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6030952">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6030957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6030960">var</span>&nbsp;<span class="op" id="6030964">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6030967">errNotEnough</span>&nbsp;<span class="op" id="6030980">=</span>&nbsp;<span class="ident" id="6030982">errors</span><span class="op" id="6030988">.</span><span class="ident" id="6030989">New</span><span class="op" id="6030992">(</span><span class="string" id="6030993">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6031021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031024">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6031037">=</span>&nbsp;<span class="ident" id="6031039">errors</span><span class="op" id="6031045">.</span><span class="ident" id="6031046">New</span><span class="op" id="6031049">(</span><span class="string" id="6031050">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6031076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031079">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6031092">=</span>&nbsp;<span class="ident" id="6031094">errors</span><span class="op" id="6031100">.</span><span class="ident" id="6031101">New</span><span class="op" id="6031104">(</span><span class="string" id="6031105">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6031131">)</span><br>
<span class="lineno"></span><span class="op" id="6031133">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6031136">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6031231">type</span>&nbsp;<span class="ident" id="6031236">reader</span>&nbsp;<span class="keyword" id="6031243">interface</span>&nbsp;<span class="op" id="6031253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031256">io</span><span class="op" id="6031258">.</span><span class="ident" id="6031259">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031267">io</span><span class="op" id="6031269">.</span><span class="ident" id="6031270">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6031281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031284">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6031298">const</span>&nbsp;<span class="op" id="6031304">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031307">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031319">fColorMapFollows</span>&nbsp;<span class="op" id="6031336">=</span>&nbsp;<span class="num" id="6031338">1</span>&nbsp;<span class="op" id="6031340">&lt;&lt;</span>&nbsp;<span class="num" id="6031343">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031347">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031365">ifLocalColorTable</span>&nbsp;<span class="op" id="6031383">=</span>&nbsp;<span class="num" id="6031385">1</span>&nbsp;<span class="op" id="6031387">&lt;&lt;</span>&nbsp;<span class="num" id="6031390">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031393">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031411">=</span>&nbsp;<span class="num" id="6031413">1</span>&nbsp;<span class="op" id="6031415">&lt;&lt;</span>&nbsp;<span class="num" id="6031418">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031421">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6031439">=</span>&nbsp;<span class="num" id="6031441">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031445">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031472">gcTransparentColorSet</span>&nbsp;<span class="op" id="6031494">=</span>&nbsp;<span class="num" id="6031496">1</span>&nbsp;<span class="op" id="6031498">&lt;&lt;</span>&nbsp;<span class="num" id="6031501">0</span><br>
<span class="lineno"></span><span class="op" id="6031503">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6031506">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6031529">const</span>&nbsp;<span class="op" id="6031535">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031538">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031555">=</span>&nbsp;<span class="num" id="6031557">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031563">sImageDescriptor</span>&nbsp;<span class="op" id="6031580">=</span>&nbsp;<span class="num" id="6031582">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031588">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031605">=</span>&nbsp;<span class="num" id="6031607">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6031612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031615">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6031630">const</span>&nbsp;<span class="op" id="6031636">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031639">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031655">=</span>&nbsp;<span class="num" id="6031657">0x01</span>&nbsp;<span class="comment" id="6031662">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031677">eGraphicControl</span>&nbsp;<span class="op" id="6031693">=</span>&nbsp;<span class="num" id="6031695">0xF9</span>&nbsp;<span class="comment" id="6031700">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031720">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031736">=</span>&nbsp;<span class="num" id="6031738">0xFE</span>&nbsp;<span class="comment" id="6031743">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031755">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6031771">=</span>&nbsp;<span class="num" id="6031773">0xFF</span>&nbsp;<span class="comment" id="6031778">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6031793">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6031796">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6031846">type</span>&nbsp;<span class="ident" id="6031851">decoder</span>&nbsp;<span class="keyword" id="6031859">struct</span>&nbsp;<span class="op" id="6031866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031869">r</span>&nbsp;<span class="ident" id="6031871">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6031880">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031897">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6031913">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031921">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6031937">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031942">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6031958">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031963">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6031979">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6031985">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032001">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032007">backgroundIndex</span>&nbsp;<span class="builtintype" id="6032023">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032029">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032045">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032050">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032066">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032072">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032096">aspect</span>&nbsp;<span class="builtintype" id="6032103">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032110">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032137">imageFields</span>&nbsp;<span class="builtintype" id="6032149">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032156">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032183">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032203">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032209">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6032229">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032236">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032250">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032265">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032271">globalColorMap</span>&nbsp;<span class="ident" id="6032286">color</span><span class="op" id="6032291">.</span><span class="ident" id="6032292">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6032302">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032326">delay</span>&nbsp;<span class="op" id="6032332">[</span><span class="op" id="6032333">]</span><span class="builtintype" id="6032334">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032339">image</span>&nbsp;<span class="op" id="6032345">[</span><span class="op" id="6032346">]</span><span class="op" id="6032347">*</span><span class="ident" id="6032348">image</span><span class="op" id="6032353">.</span><span class="ident" id="6032354">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032364">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6032370">[</span><span class="num" id="6032371">1024</span><span class="op" id="6032375">]</span><span class="builtintype" id="6032376">byte</span>&nbsp;<span class="comment" id="6032381">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6032430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6032433">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6032500">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6032567">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6032631">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6032701">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6032770">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6032799">type</span>&nbsp;<span class="ident" id="6032804">blockReader</span>&nbsp;<span class="keyword" id="6032816">struct</span>&nbsp;<span class="op" id="6032823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032826">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032832">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032840">slice</span>&nbsp;<span class="op" id="6032846">[</span><span class="op" id="6032847">]</span><span class="builtintype" id="6032848">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032854">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6032860">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6032867">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6032873">[</span><span class="num" id="6032874">256</span><span class="op" id="6032877">]</span><span class="builtintype" id="6032878">byte</span><br>
<span class="lineno"></span><span class="op" id="6032883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6032886">func</span>&nbsp;<span class="op" id="6032891">(</span><span class="ident" id="6032892">b</span>&nbsp;<span class="op" id="6032894">*</span><span class="ident" id="6032895">blockReader</span><span class="op" id="6032906">)</span>&nbsp;<span class="ident" id="6032908">Read</span><span class="op" id="6032912">(</span><span class="ident" id="6032913">p</span>&nbsp;<span class="op" id="6032915">[</span><span class="op" id="6032916">]</span><span class="builtintype" id="6032917">byte</span><span class="op" id="6032921">)</span>&nbsp;<span class="op" id="6032923">(</span><span class="builtintype" id="6032924">int</span><span class="op" id="6032927">,</span>&nbsp;<span class="builtintype" id="6032929">error</span><span class="op" id="6032934">)</span>&nbsp;<span class="op" id="6032936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032939">if</span>&nbsp;<span class="ident" id="6032942">b</span><span class="op" id="6032943">.</span><span class="ident" id="6032944">err</span>&nbsp;<span class="op" id="6032948">!=</span>&nbsp;<span class="builtintype" id="6032951">nil</span>&nbsp;<span class="op" id="6032955">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032959">return</span>&nbsp;<span class="num" id="6032966">0</span><span class="op" id="6032967">,</span>&nbsp;<span class="ident" id="6032969">b</span><span class="op" id="6032970">.</span><span class="ident" id="6032971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032979">if</span>&nbsp;<span class="builtinfunc" id="6032982">len</span><span class="op" id="6032985">(</span><span class="ident" id="6032986">p</span><span class="op" id="6032987">)</span>&nbsp;<span class="op" id="6032989">==</span>&nbsp;<span class="num" id="6032992">0</span>&nbsp;<span class="op" id="6032994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032998">return</span>&nbsp;<span class="num" id="6033005">0</span><span class="op" id="6033006">,</span>&nbsp;<span class="builtintype" id="6033008">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033013">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033016">if</span>&nbsp;<span class="builtinfunc" id="6033019">len</span><span class="op" id="6033022">(</span><span class="ident" id="6033023">b</span><span class="op" id="6033024">.</span><span class="ident" id="6033025">slice</span><span class="op" id="6033030">)</span>&nbsp;<span class="op" id="6033032">==</span>&nbsp;<span class="num" id="6033035">0</span>&nbsp;<span class="op" id="6033037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033041">var</span>&nbsp;<span class="ident" id="6033045">blockLen</span>&nbsp;<span class="builtintype" id="6033054">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033062">blockLen</span><span class="op" id="6033070">,</span>&nbsp;<span class="ident" id="6033072">b</span><span class="op" id="6033073">.</span><span class="ident" id="6033074">err</span>&nbsp;<span class="op" id="6033078">=</span>&nbsp;<span class="ident" id="6033080">b</span><span class="op" id="6033081">.</span><span class="ident" id="6033082">r</span><span class="op" id="6033083">.</span><span class="ident" id="6033084">ReadByte</span><span class="op" id="6033092">(</span><span class="op" id="6033093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033097">if</span>&nbsp;<span class="ident" id="6033100">b</span><span class="op" id="6033101">.</span><span class="ident" id="6033102">err</span>&nbsp;<span class="op" id="6033106">!=</span>&nbsp;<span class="builtintype" id="6033109">nil</span>&nbsp;<span class="op" id="6033113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033118">return</span>&nbsp;<span class="num" id="6033125">0</span><span class="op" id="6033126">,</span>&nbsp;<span class="ident" id="6033128">b</span><span class="op" id="6033129">.</span><span class="ident" id="6033130">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033140">if</span>&nbsp;<span class="ident" id="6033143">blockLen</span>&nbsp;<span class="op" id="6033152">==</span>&nbsp;<span class="num" id="6033155">0</span>&nbsp;<span class="op" id="6033157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033162">b</span><span class="op" id="6033163">.</span><span class="ident" id="6033164">err</span>&nbsp;<span class="op" id="6033168">=</span>&nbsp;<span class="ident" id="6033170">io</span><span class="op" id="6033172">.</span><span class="ident" id="6033173">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033180">return</span>&nbsp;<span class="num" id="6033187">0</span><span class="op" id="6033188">,</span>&nbsp;<span class="ident" id="6033190">b</span><span class="op" id="6033191">.</span><span class="ident" id="6033192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033198">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033202">b</span><span class="op" id="6033203">.</span><span class="ident" id="6033204">slice</span>&nbsp;<span class="op" id="6033210">=</span>&nbsp;<span class="ident" id="6033212">b</span><span class="op" id="6033213">.</span><span class="ident" id="6033214">tmp</span><span class="op" id="6033217">[</span><span class="num" id="6033218">0</span><span class="op" id="6033219">:</span><span class="ident" id="6033220">blockLen</span><span class="op" id="6033228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033232">if</span>&nbsp;<span class="ident" id="6033235">_</span><span class="op" id="6033236">,</span>&nbsp;<span class="ident" id="6033238">b</span><span class="op" id="6033239">.</span><span class="ident" id="6033240">err</span>&nbsp;<span class="op" id="6033244">=</span>&nbsp;<span class="ident" id="6033246">io</span><span class="op" id="6033248">.</span><span class="ident" id="6033249">ReadFull</span><span class="op" id="6033257">(</span><span class="ident" id="6033258">b</span><span class="op" id="6033259">.</span><span class="ident" id="6033260">r</span><span class="op" id="6033261">,</span>&nbsp;<span class="ident" id="6033263">b</span><span class="op" id="6033264">.</span><span class="ident" id="6033265">slice</span><span class="op" id="6033270">)</span><span class="op" id="6033271">;</span>&nbsp;<span class="ident" id="6033273">b</span><span class="op" id="6033274">.</span><span class="ident" id="6033275">err</span>&nbsp;<span class="op" id="6033279">!=</span>&nbsp;<span class="builtintype" id="6033282">nil</span>&nbsp;<span class="op" id="6033286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033291">return</span>&nbsp;<span class="num" id="6033298">0</span><span class="op" id="6033299">,</span>&nbsp;<span class="ident" id="6033301">b</span><span class="op" id="6033302">.</span><span class="ident" id="6033303">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033312">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033315">n</span>&nbsp;<span class="op" id="6033317">:=</span>&nbsp;<span class="builtinfunc" id="6033320">copy</span><span class="op" id="6033324">(</span><span class="ident" id="6033325">p</span><span class="op" id="6033326">,</span>&nbsp;<span class="ident" id="6033328">b</span><span class="op" id="6033329">.</span><span class="ident" id="6033330">slice</span><span class="op" id="6033335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033338">b</span><span class="op" id="6033339">.</span><span class="ident" id="6033340">slice</span>&nbsp;<span class="op" id="6033346">=</span>&nbsp;<span class="ident" id="6033348">b</span><span class="op" id="6033349">.</span><span class="ident" id="6033350">slice</span><span class="op" id="6033355">[</span><span class="ident" id="6033356">n</span><span class="op" id="6033357">:</span><span class="op" id="6033358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033361">return</span>&nbsp;<span class="ident" id="6033368">n</span><span class="op" id="6033369">,</span>&nbsp;<span class="builtintype" id="6033371">nil</span><br>
<span class="lineno"></span><span class="op" id="6033375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6033378">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6033441">func</span>&nbsp;<span class="op" id="6033446">(</span><span class="ident" id="6033447">d</span>&nbsp;<span class="op" id="6033449">*</span><span class="ident" id="6033450">decoder</span><span class="op" id="6033457">)</span>&nbsp;<span class="ident" id="6033459">decode</span><span class="op" id="6033465">(</span><span class="ident" id="6033466">r</span>&nbsp;<span class="ident" id="6033468">io</span><span class="op" id="6033470">.</span><span class="ident" id="6033471">Reader</span><span class="op" id="6033477">,</span>&nbsp;<span class="ident" id="6033479">configOnly</span>&nbsp;<span class="builtintype" id="6033490">bool</span><span class="op" id="6033494">)</span>&nbsp;<span class="builtintype" id="6033496">error</span>&nbsp;<span class="op" id="6033502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6033505">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033555">if</span>&nbsp;<span class="ident" id="6033558">rr</span><span class="op" id="6033560">,</span>&nbsp;<span class="ident" id="6033562">ok</span>&nbsp;<span class="op" id="6033565">:=</span>&nbsp;<span class="ident" id="6033568">r</span><span class="op" id="6033569">.</span><span class="op" id="6033570">(</span><span class="ident" id="6033571">reader</span><span class="op" id="6033577">)</span><span class="op" id="6033578">;</span>&nbsp;<span class="ident" id="6033580">ok</span>&nbsp;<span class="op" id="6033583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033587">d</span><span class="op" id="6033588">.</span><span class="ident" id="6033589">r</span>&nbsp;<span class="op" id="6033591">=</span>&nbsp;<span class="ident" id="6033593">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033597">}</span>&nbsp;<span class="keyword" id="6033599">else</span>&nbsp;<span class="op" id="6033604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033608">d</span><span class="op" id="6033609">.</span><span class="ident" id="6033610">r</span>&nbsp;<span class="op" id="6033612">=</span>&nbsp;<span class="ident" id="6033614">bufio</span><span class="op" id="6033619">.</span><span class="ident" id="6033620">NewReader</span><span class="op" id="6033629">(</span><span class="ident" id="6033630">r</span><span class="op" id="6033631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033638">err</span>&nbsp;<span class="op" id="6033642">:=</span>&nbsp;<span class="ident" id="6033645">d</span><span class="op" id="6033646">.</span><span class="ident" id="6033647">readHeaderAndScreenDescriptor</span><span class="op" id="6033676">(</span><span class="op" id="6033677">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033680">if</span>&nbsp;<span class="ident" id="6033683">err</span>&nbsp;<span class="op" id="6033687">!=</span>&nbsp;<span class="builtintype" id="6033690">nil</span>&nbsp;<span class="op" id="6033694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033698">return</span>&nbsp;<span class="ident" id="6033705">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033713">if</span>&nbsp;<span class="ident" id="6033716">configOnly</span>&nbsp;<span class="op" id="6033727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033731">return</span>&nbsp;<span class="builtintype" id="6033738">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033747">if</span>&nbsp;<span class="ident" id="6033750">d</span><span class="op" id="6033751">.</span><span class="ident" id="6033752">headerFields</span><span class="op" id="6033764">&amp;</span><span class="ident" id="6033765">fColorMapFollows</span>&nbsp;<span class="op" id="6033782">!=</span>&nbsp;<span class="num" id="6033785">0</span>&nbsp;<span class="op" id="6033787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033791">if</span>&nbsp;<span class="ident" id="6033794">d</span><span class="op" id="6033795">.</span><span class="ident" id="6033796">globalColorMap</span><span class="op" id="6033810">,</span>&nbsp;<span class="ident" id="6033812">err</span>&nbsp;<span class="op" id="6033816">=</span>&nbsp;<span class="ident" id="6033818">d</span><span class="op" id="6033819">.</span><span class="ident" id="6033820">readColorMap</span><span class="op" id="6033832">(</span><span class="op" id="6033833">)</span><span class="op" id="6033834">;</span>&nbsp;<span class="ident" id="6033836">err</span>&nbsp;<span class="op" id="6033840">!=</span>&nbsp;<span class="builtintype" id="6033843">nil</span>&nbsp;<span class="op" id="6033847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033852">return</span>&nbsp;<span class="ident" id="6033859">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033872">for</span>&nbsp;<span class="op" id="6033876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6033880">c</span><span class="op" id="6033881">,</span>&nbsp;<span class="ident" id="6033883">err</span>&nbsp;<span class="op" id="6033887">:=</span>&nbsp;<span class="ident" id="6033890">d</span><span class="op" id="6033891">.</span><span class="ident" id="6033892">r</span><span class="op" id="6033893">.</span><span class="ident" id="6033894">ReadByte</span><span class="op" id="6033902">(</span><span class="op" id="6033903">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033907">if</span>&nbsp;<span class="ident" id="6033910">err</span>&nbsp;<span class="op" id="6033914">!=</span>&nbsp;<span class="builtintype" id="6033917">nil</span>&nbsp;<span class="op" id="6033921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033926">return</span>&nbsp;<span class="ident" id="6033933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033943">switch</span>&nbsp;<span class="ident" id="6033950">c</span>&nbsp;<span class="op" id="6033952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033956">case</span>&nbsp;<span class="ident" id="6033961">sExtension</span><span class="op" id="6033971">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6033976">if</span>&nbsp;<span class="ident" id="6033979">err</span>&nbsp;<span class="op" id="6033983">=</span>&nbsp;<span class="ident" id="6033985">d</span><span class="op" id="6033986">.</span><span class="ident" id="6033987">readExtension</span><span class="op" id="6034000">(</span><span class="op" id="6034001">)</span><span class="op" id="6034002">;</span>&nbsp;<span class="ident" id="6034004">err</span>&nbsp;<span class="op" id="6034008">!=</span>&nbsp;<span class="builtintype" id="6034011">nil</span>&nbsp;<span class="op" id="6034015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034021">return</span>&nbsp;<span class="ident" id="6034028">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034040">case</span>&nbsp;<span class="ident" id="6034045">sImageDescriptor</span><span class="op" id="6034061">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034066">m</span><span class="op" id="6034067">,</span>&nbsp;<span class="ident" id="6034069">err</span>&nbsp;<span class="op" id="6034073">:=</span>&nbsp;<span class="ident" id="6034076">d</span><span class="op" id="6034077">.</span><span class="ident" id="6034078">newImageFromDescriptor</span><span class="op" id="6034100">(</span><span class="op" id="6034101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034106">if</span>&nbsp;<span class="ident" id="6034109">err</span>&nbsp;<span class="op" id="6034113">!=</span>&nbsp;<span class="builtintype" id="6034116">nil</span>&nbsp;<span class="op" id="6034120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034126">return</span>&nbsp;<span class="ident" id="6034133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034145">useLocalColorMap</span>&nbsp;<span class="op" id="6034162">:=</span>&nbsp;<span class="ident" id="6034165">d</span><span class="op" id="6034166">.</span><span class="ident" id="6034167">imageFields</span><span class="op" id="6034178">&amp;</span><span class="ident" id="6034179">fColorMapFollows</span>&nbsp;<span class="op" id="6034196">!=</span>&nbsp;<span class="num" id="6034199">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034204">if</span>&nbsp;<span class="ident" id="6034207">useLocalColorMap</span>&nbsp;<span class="op" id="6034224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034230">m</span><span class="op" id="6034231">.</span><span class="ident" id="6034232">Palette</span><span class="op" id="6034239">,</span>&nbsp;<span class="ident" id="6034241">err</span>&nbsp;<span class="op" id="6034245">=</span>&nbsp;<span class="ident" id="6034247">d</span><span class="op" id="6034248">.</span><span class="ident" id="6034249">readColorMap</span><span class="op" id="6034261">(</span><span class="op" id="6034262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034268">if</span>&nbsp;<span class="ident" id="6034271">err</span>&nbsp;<span class="op" id="6034275">!=</span>&nbsp;<span class="builtintype" id="6034278">nil</span>&nbsp;<span class="op" id="6034282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034289">return</span>&nbsp;<span class="ident" id="6034296">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034304">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034309">}</span>&nbsp;<span class="keyword" id="6034311">else</span>&nbsp;<span class="op" id="6034316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034322">m</span><span class="op" id="6034323">.</span><span class="ident" id="6034324">Palette</span>&nbsp;<span class="op" id="6034332">=</span>&nbsp;<span class="ident" id="6034334">d</span><span class="op" id="6034335">.</span><span class="ident" id="6034336">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034359">if</span>&nbsp;<span class="ident" id="6034362">d</span><span class="op" id="6034363">.</span><span class="ident" id="6034364">hasTransparentIndex</span>&nbsp;<span class="op" id="6034384">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6034387">int</span><span class="op" id="6034390">(</span><span class="ident" id="6034391">d</span><span class="op" id="6034392">.</span><span class="ident" id="6034393">transparentIndex</span><span class="op" id="6034409">)</span>&nbsp;<span class="op" id="6034411">&lt;</span>&nbsp;<span class="builtinfunc" id="6034413">len</span><span class="op" id="6034416">(</span><span class="ident" id="6034417">m</span><span class="op" id="6034418">.</span><span class="ident" id="6034419">Palette</span><span class="op" id="6034426">)</span>&nbsp;<span class="op" id="6034428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034434">if</span>&nbsp;<span class="op" id="6034437">!</span><span class="ident" id="6034438">useLocalColorMap</span>&nbsp;<span class="op" id="6034455">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6034462">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034498">m</span><span class="op" id="6034499">.</span><span class="ident" id="6034500">Palette</span>&nbsp;<span class="op" id="6034508">=</span>&nbsp;<span class="builtinfunc" id="6034510">append</span><span class="op" id="6034516">(</span><span class="ident" id="6034517">color</span><span class="op" id="6034522">.</span><span class="ident" id="6034523">Palette</span><span class="op" id="6034530">(</span><span class="builtintype" id="6034531">nil</span><span class="op" id="6034534">)</span><span class="op" id="6034535">,</span>&nbsp;<span class="ident" id="6034537">d</span><span class="op" id="6034538">.</span><span class="ident" id="6034539">globalColorMap</span><span class="op" id="6034553">...</span><span class="op" id="6034556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034568">m</span><span class="op" id="6034569">.</span><span class="ident" id="6034570">Palette</span><span class="op" id="6034577">[</span><span class="ident" id="6034578">d</span><span class="op" id="6034579">.</span><span class="ident" id="6034580">transparentIndex</span><span class="op" id="6034596">]</span>&nbsp;<span class="op" id="6034598">=</span>&nbsp;<span class="ident" id="6034600">color</span><span class="op" id="6034605">.</span><span class="ident" id="6034606">RGBA</span><span class="op" id="6034610">{</span><span class="op" id="6034611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034616">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034621">litWidth</span><span class="op" id="6034629">,</span>&nbsp;<span class="ident" id="6034631">err</span>&nbsp;<span class="op" id="6034635">:=</span>&nbsp;<span class="ident" id="6034638">d</span><span class="op" id="6034639">.</span><span class="ident" id="6034640">r</span><span class="op" id="6034641">.</span><span class="ident" id="6034642">ReadByte</span><span class="op" id="6034650">(</span><span class="op" id="6034651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034656">if</span>&nbsp;<span class="ident" id="6034659">err</span>&nbsp;<span class="op" id="6034663">!=</span>&nbsp;<span class="builtintype" id="6034666">nil</span>&nbsp;<span class="op" id="6034670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034676">return</span>&nbsp;<span class="ident" id="6034683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034695">if</span>&nbsp;<span class="ident" id="6034698">litWidth</span>&nbsp;<span class="op" id="6034707">&lt;</span>&nbsp;<span class="num" id="6034709">2</span>&nbsp;<span class="op" id="6034711">||</span>&nbsp;<span class="ident" id="6034714">litWidth</span>&nbsp;<span class="op" id="6034723">&gt;</span>&nbsp;<span class="num" id="6034725">8</span>&nbsp;<span class="op" id="6034727">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034733">return</span>&nbsp;<span class="ident" id="6034740">fmt</span><span class="op" id="6034743">.</span><span class="ident" id="6034744">Errorf</span><span class="op" id="6034750">(</span><span class="string" id="6034751">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6034795">,</span>&nbsp;<span class="ident" id="6034797">litWidth</span><span class="op" id="6034805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6034815">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034859">br</span>&nbsp;<span class="op" id="6034862">:=</span>&nbsp;<span class="op" id="6034865">&amp;</span><span class="ident" id="6034866">blockReader</span><span class="op" id="6034877">{</span><span class="ident" id="6034878">r</span><span class="op" id="6034879">:</span>&nbsp;<span class="ident" id="6034881">d</span><span class="op" id="6034882">.</span><span class="ident" id="6034883">r</span><span class="op" id="6034884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034889">lzwr</span>&nbsp;<span class="op" id="6034894">:=</span>&nbsp;<span class="ident" id="6034897">lzw</span><span class="op" id="6034900">.</span><span class="ident" id="6034901">NewReader</span><span class="op" id="6034910">(</span><span class="ident" id="6034911">br</span><span class="op" id="6034913">,</span>&nbsp;<span class="ident" id="6034915">lzw</span><span class="op" id="6034918">.</span><span class="ident" id="6034919">LSB</span><span class="op" id="6034922">,</span>&nbsp;<span class="builtintype" id="6034924">int</span><span class="op" id="6034927">(</span><span class="ident" id="6034928">litWidth</span><span class="op" id="6034936">)</span><span class="op" id="6034937">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034942">defer</span>&nbsp;<span class="ident" id="6034948">lzwr</span><span class="op" id="6034952">.</span><span class="ident" id="6034953">Close</span><span class="op" id="6034958">(</span><span class="op" id="6034959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034964">if</span>&nbsp;<span class="ident" id="6034967">_</span><span class="op" id="6034968">,</span>&nbsp;<span class="ident" id="6034970">err</span>&nbsp;<span class="op" id="6034974">=</span>&nbsp;<span class="ident" id="6034976">io</span><span class="op" id="6034978">.</span><span class="ident" id="6034979">ReadFull</span><span class="op" id="6034987">(</span><span class="ident" id="6034988">lzwr</span><span class="op" id="6034992">,</span>&nbsp;<span class="ident" id="6034994">m</span><span class="op" id="6034995">.</span><span class="ident" id="6034996">Pix</span><span class="op" id="6034999">)</span><span class="op" id="6035000">;</span>&nbsp;<span class="ident" id="6035002">err</span>&nbsp;<span class="op" id="6035006">!=</span>&nbsp;<span class="builtintype" id="6035009">nil</span>&nbsp;<span class="op" id="6035013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035019">if</span>&nbsp;<span class="ident" id="6035022">err</span>&nbsp;<span class="op" id="6035026">!=</span>&nbsp;<span class="ident" id="6035029">io</span><span class="op" id="6035031">.</span><span class="ident" id="6035032">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6035049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035056">return</span>&nbsp;<span class="ident" id="6035063">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035071">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035077">return</span>&nbsp;<span class="ident" id="6035084">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035105">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035167">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035199">if</span>&nbsp;<span class="ident" id="6035202">n</span><span class="op" id="6035203">,</span>&nbsp;<span class="ident" id="6035205">err</span>&nbsp;<span class="op" id="6035209">:=</span>&nbsp;<span class="ident" id="6035212">lzwr</span><span class="op" id="6035216">.</span><span class="ident" id="6035217">Read</span><span class="op" id="6035221">(</span><span class="ident" id="6035222">d</span><span class="op" id="6035223">.</span><span class="ident" id="6035224">tmp</span><span class="op" id="6035227">[</span><span class="op" id="6035228">:</span><span class="num" id="6035229">1</span><span class="op" id="6035230">]</span><span class="op" id="6035231">)</span><span class="op" id="6035232">;</span>&nbsp;<span class="ident" id="6035234">n</span>&nbsp;<span class="op" id="6035236">!=</span>&nbsp;<span class="num" id="6035239">0</span>&nbsp;<span class="op" id="6035241">||</span>&nbsp;<span class="ident" id="6035244">err</span>&nbsp;<span class="op" id="6035248">!=</span>&nbsp;<span class="ident" id="6035251">io</span><span class="op" id="6035253">.</span><span class="ident" id="6035254">EOF</span>&nbsp;<span class="op" id="6035258">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035264">if</span>&nbsp;<span class="ident" id="6035267">err</span>&nbsp;<span class="op" id="6035271">!=</span>&nbsp;<span class="builtintype" id="6035274">nil</span>&nbsp;<span class="op" id="6035278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035285">return</span>&nbsp;<span class="ident" id="6035292">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035306">return</span>&nbsp;<span class="ident" id="6035313">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035327">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035332">if</span>&nbsp;<span class="ident" id="6035335">n</span><span class="op" id="6035336">,</span>&nbsp;<span class="ident" id="6035338">err</span>&nbsp;<span class="op" id="6035342">:=</span>&nbsp;<span class="ident" id="6035345">br</span><span class="op" id="6035347">.</span><span class="ident" id="6035348">Read</span><span class="op" id="6035352">(</span><span class="ident" id="6035353">d</span><span class="op" id="6035354">.</span><span class="ident" id="6035355">tmp</span><span class="op" id="6035358">[</span><span class="op" id="6035359">:</span><span class="num" id="6035360">1</span><span class="op" id="6035361">]</span><span class="op" id="6035362">)</span><span class="op" id="6035363">;</span>&nbsp;<span class="ident" id="6035365">n</span>&nbsp;<span class="op" id="6035367">!=</span>&nbsp;<span class="num" id="6035370">0</span>&nbsp;<span class="op" id="6035372">||</span>&nbsp;<span class="ident" id="6035375">err</span>&nbsp;<span class="op" id="6035379">!=</span>&nbsp;<span class="ident" id="6035382">io</span><span class="op" id="6035384">.</span><span class="ident" id="6035385">EOF</span>&nbsp;<span class="op" id="6035389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035395">if</span>&nbsp;<span class="ident" id="6035398">err</span>&nbsp;<span class="op" id="6035402">!=</span>&nbsp;<span class="builtintype" id="6035405">nil</span>&nbsp;<span class="op" id="6035409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035416">return</span>&nbsp;<span class="ident" id="6035423">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035437">return</span>&nbsp;<span class="ident" id="6035444">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035464">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035523">if</span>&nbsp;<span class="builtinfunc" id="6035526">len</span><span class="op" id="6035529">(</span><span class="ident" id="6035530">m</span><span class="op" id="6035531">.</span><span class="ident" id="6035532">Palette</span><span class="op" id="6035539">)</span>&nbsp;<span class="op" id="6035541">&lt;</span>&nbsp;<span class="num" id="6035543">256</span>&nbsp;<span class="op" id="6035547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035553">for</span>&nbsp;<span class="ident" id="6035557">_</span><span class="op" id="6035558">,</span>&nbsp;<span class="ident" id="6035560">pixel</span>&nbsp;<span class="op" id="6035566">:=</span>&nbsp;<span class="keyword" id="6035569">range</span>&nbsp;<span class="ident" id="6035575">m</span><span class="op" id="6035576">.</span><span class="ident" id="6035577">Pix</span>&nbsp;<span class="op" id="6035581">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035588">if</span>&nbsp;<span class="builtintype" id="6035591">int</span><span class="op" id="6035594">(</span><span class="ident" id="6035595">pixel</span><span class="op" id="6035600">)</span>&nbsp;<span class="op" id="6035602">&gt;=</span>&nbsp;<span class="builtinfunc" id="6035605">len</span><span class="op" id="6035608">(</span><span class="ident" id="6035609">m</span><span class="op" id="6035610">.</span><span class="ident" id="6035611">Palette</span><span class="op" id="6035618">)</span>&nbsp;<span class="op" id="6035620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035628">return</span>&nbsp;<span class="ident" id="6035635">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035663">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035669">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035710">if</span>&nbsp;<span class="ident" id="6035713">d</span><span class="op" id="6035714">.</span><span class="ident" id="6035715">imageFields</span><span class="op" id="6035726">&amp;</span><span class="ident" id="6035727">ifInterlace</span>&nbsp;<span class="op" id="6035739">!=</span>&nbsp;<span class="num" id="6035742">0</span>&nbsp;<span class="op" id="6035744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035750">uninterlace</span><span class="op" id="6035761">(</span><span class="ident" id="6035762">m</span><span class="op" id="6035763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035768">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035774">d</span><span class="op" id="6035775">.</span><span class="ident" id="6035776">image</span>&nbsp;<span class="op" id="6035782">=</span>&nbsp;<span class="builtinfunc" id="6035784">append</span><span class="op" id="6035790">(</span><span class="ident" id="6035791">d</span><span class="op" id="6035792">.</span><span class="ident" id="6035793">image</span><span class="op" id="6035798">,</span>&nbsp;<span class="ident" id="6035800">m</span><span class="op" id="6035801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035806">d</span><span class="op" id="6035807">.</span><span class="ident" id="6035808">delay</span>&nbsp;<span class="op" id="6035814">=</span>&nbsp;<span class="builtinfunc" id="6035816">append</span><span class="op" id="6035822">(</span><span class="ident" id="6035823">d</span><span class="op" id="6035824">.</span><span class="ident" id="6035825">delay</span><span class="op" id="6035830">,</span>&nbsp;<span class="ident" id="6035832">d</span><span class="op" id="6035833">.</span><span class="ident" id="6035834">delayTime</span><span class="op" id="6035843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035848">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035916">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035988">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036049">d</span><span class="op" id="6036050">.</span><span class="ident" id="6036051">delayTime</span>&nbsp;<span class="op" id="6036061">=</span>&nbsp;<span class="num" id="6036063">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036068">d</span><span class="op" id="6036069">.</span><span class="ident" id="6036070">hasTransparentIndex</span>&nbsp;<span class="op" id="6036090">=</span>&nbsp;<span class="builtintype" id="6036092">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036101">case</span>&nbsp;<span class="ident" id="6036106">sTrailer</span><span class="op" id="6036114">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036119">if</span>&nbsp;<span class="builtinfunc" id="6036122">len</span><span class="op" id="6036125">(</span><span class="ident" id="6036126">d</span><span class="op" id="6036127">.</span><span class="ident" id="6036128">image</span><span class="op" id="6036133">)</span>&nbsp;<span class="op" id="6036135">==</span>&nbsp;<span class="num" id="6036138">0</span>&nbsp;<span class="op" id="6036140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036146">return</span>&nbsp;<span class="ident" id="6036153">io</span><span class="op" id="6036155">.</span><span class="ident" id="6036156">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036181">return</span>&nbsp;<span class="builtintype" id="6036188">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036195">default</span><span class="op" id="6036202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036207">return</span>&nbsp;<span class="ident" id="6036214">fmt</span><span class="op" id="6036217">.</span><span class="ident" id="6036218">Errorf</span><span class="op" id="6036224">(</span><span class="string" id="6036225">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6036258">,</span>&nbsp;<span class="ident" id="6036260">c</span><span class="op" id="6036261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036268">}</span><br>
<span class="lineno"></span><span class="op" id="6036270">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6036273">func</span>&nbsp;<span class="op" id="6036278">(</span><span class="ident" id="6036279">d</span>&nbsp;<span class="op" id="6036281">*</span><span class="ident" id="6036282">decoder</span><span class="op" id="6036289">)</span>&nbsp;<span class="ident" id="6036291">readHeaderAndScreenDescriptor</span><span class="op" id="6036320">(</span><span class="op" id="6036321">)</span>&nbsp;<span class="builtintype" id="6036323">error</span>&nbsp;<span class="op" id="6036329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036332">_</span><span class="op" id="6036333">,</span>&nbsp;<span class="ident" id="6036335">err</span>&nbsp;<span class="op" id="6036339">:=</span>&nbsp;<span class="ident" id="6036342">io</span><span class="op" id="6036344">.</span><span class="ident" id="6036345">ReadFull</span><span class="op" id="6036353">(</span><span class="ident" id="6036354">d</span><span class="op" id="6036355">.</span><span class="ident" id="6036356">r</span><span class="op" id="6036357">,</span>&nbsp;<span class="ident" id="6036359">d</span><span class="op" id="6036360">.</span><span class="ident" id="6036361">tmp</span><span class="op" id="6036364">[</span><span class="num" id="6036365">0</span><span class="op" id="6036366">:</span><span class="num" id="6036367">13</span><span class="op" id="6036369">]</span><span class="op" id="6036370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036373">if</span>&nbsp;<span class="ident" id="6036376">err</span>&nbsp;<span class="op" id="6036380">!=</span>&nbsp;<span class="builtintype" id="6036383">nil</span>&nbsp;<span class="op" id="6036387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036391">return</span>&nbsp;<span class="ident" id="6036398">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036406">d</span><span class="op" id="6036407">.</span><span class="ident" id="6036408">vers</span>&nbsp;<span class="op" id="6036413">=</span>&nbsp;<span class="builtintype" id="6036415">string</span><span class="op" id="6036421">(</span><span class="ident" id="6036422">d</span><span class="op" id="6036423">.</span><span class="ident" id="6036424">tmp</span><span class="op" id="6036427">[</span><span class="num" id="6036428">0</span><span class="op" id="6036429">:</span><span class="num" id="6036430">6</span><span class="op" id="6036431">]</span><span class="op" id="6036432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036435">if</span>&nbsp;<span class="ident" id="6036438">d</span><span class="op" id="6036439">.</span><span class="ident" id="6036440">vers</span>&nbsp;<span class="op" id="6036445">!=</span>&nbsp;<span class="string" id="6036448">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6036457">&amp;&amp;</span>&nbsp;<span class="ident" id="6036460">d</span><span class="op" id="6036461">.</span><span class="ident" id="6036462">vers</span>&nbsp;<span class="op" id="6036467">!=</span>&nbsp;<span class="string" id="6036470">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6036479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036483">return</span>&nbsp;<span class="ident" id="6036490">fmt</span><span class="op" id="6036493">.</span><span class="ident" id="6036494">Errorf</span><span class="op" id="6036500">(</span><span class="string" id="6036501">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6036533">,</span>&nbsp;<span class="ident" id="6036535">d</span><span class="op" id="6036536">.</span><span class="ident" id="6036537">vers</span><span class="op" id="6036541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036544">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036547">d</span><span class="op" id="6036548">.</span><span class="ident" id="6036549">width</span>&nbsp;<span class="op" id="6036555">=</span>&nbsp;<span class="builtintype" id="6036557">int</span><span class="op" id="6036560">(</span><span class="ident" id="6036561">d</span><span class="op" id="6036562">.</span><span class="ident" id="6036563">tmp</span><span class="op" id="6036566">[</span><span class="num" id="6036567">6</span><span class="op" id="6036568">]</span><span class="op" id="6036569">)</span>&nbsp;<span class="op" id="6036571">+</span>&nbsp;<span class="builtintype" id="6036573">int</span><span class="op" id="6036576">(</span><span class="ident" id="6036577">d</span><span class="op" id="6036578">.</span><span class="ident" id="6036579">tmp</span><span class="op" id="6036582">[</span><span class="num" id="6036583">7</span><span class="op" id="6036584">]</span><span class="op" id="6036585">)</span><span class="op" id="6036586">&lt;&lt;</span><span class="num" id="6036588">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036591">d</span><span class="op" id="6036592">.</span><span class="ident" id="6036593">height</span>&nbsp;<span class="op" id="6036600">=</span>&nbsp;<span class="builtintype" id="6036602">int</span><span class="op" id="6036605">(</span><span class="ident" id="6036606">d</span><span class="op" id="6036607">.</span><span class="ident" id="6036608">tmp</span><span class="op" id="6036611">[</span><span class="num" id="6036612">8</span><span class="op" id="6036613">]</span><span class="op" id="6036614">)</span>&nbsp;<span class="op" id="6036616">+</span>&nbsp;<span class="builtintype" id="6036618">int</span><span class="op" id="6036621">(</span><span class="ident" id="6036622">d</span><span class="op" id="6036623">.</span><span class="ident" id="6036624">tmp</span><span class="op" id="6036627">[</span><span class="num" id="6036628">9</span><span class="op" id="6036629">]</span><span class="op" id="6036630">)</span><span class="op" id="6036631">&lt;&lt;</span><span class="num" id="6036633">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036636">d</span><span class="op" id="6036637">.</span><span class="ident" id="6036638">headerFields</span>&nbsp;<span class="op" id="6036651">=</span>&nbsp;<span class="ident" id="6036653">d</span><span class="op" id="6036654">.</span><span class="ident" id="6036655">tmp</span><span class="op" id="6036658">[</span><span class="num" id="6036659">10</span><span class="op" id="6036661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036664">d</span><span class="op" id="6036665">.</span><span class="ident" id="6036666">backgroundIndex</span>&nbsp;<span class="op" id="6036682">=</span>&nbsp;<span class="ident" id="6036684">d</span><span class="op" id="6036685">.</span><span class="ident" id="6036686">tmp</span><span class="op" id="6036689">[</span><span class="num" id="6036690">11</span><span class="op" id="6036692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036695">d</span><span class="op" id="6036696">.</span><span class="ident" id="6036697">aspect</span>&nbsp;<span class="op" id="6036704">=</span>&nbsp;<span class="ident" id="6036706">d</span><span class="op" id="6036707">.</span><span class="ident" id="6036708">tmp</span><span class="op" id="6036711">[</span><span class="num" id="6036712">12</span><span class="op" id="6036714">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036717">d</span><span class="op" id="6036718">.</span><span class="ident" id="6036719">loopCount</span>&nbsp;<span class="op" id="6036729">=</span>&nbsp;<span class="op" id="6036731">-</span><span class="num" id="6036732">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036735">d</span><span class="op" id="6036736">.</span><span class="ident" id="6036737">pixelSize</span>&nbsp;<span class="op" id="6036747">=</span>&nbsp;<span class="builtintype" id="6036749">uint</span><span class="op" id="6036753">(</span><span class="ident" id="6036754">d</span><span class="op" id="6036755">.</span><span class="ident" id="6036756">headerFields</span><span class="op" id="6036768">&amp;</span><span class="num" id="6036769">7</span><span class="op" id="6036770">)</span>&nbsp;<span class="op" id="6036772">+</span>&nbsp;<span class="num" id="6036774">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036777">return</span>&nbsp;<span class="builtintype" id="6036784">nil</span><br>
<span class="lineno"></span><span class="op" id="6036788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6036791">func</span>&nbsp;<span class="op" id="6036796">(</span><span class="ident" id="6036797">d</span>&nbsp;<span class="op" id="6036799">*</span><span class="ident" id="6036800">decoder</span><span class="op" id="6036807">)</span>&nbsp;<span class="ident" id="6036809">readColorMap</span><span class="op" id="6036821">(</span><span class="op" id="6036822">)</span>&nbsp;<span class="op" id="6036824">(</span><span class="ident" id="6036825">color</span><span class="op" id="6036830">.</span><span class="ident" id="6036831">Palette</span><span class="op" id="6036838">,</span>&nbsp;<span class="builtintype" id="6036840">error</span><span class="op" id="6036845">)</span>&nbsp;<span class="op" id="6036847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036850">if</span>&nbsp;<span class="ident" id="6036853">d</span><span class="op" id="6036854">.</span><span class="ident" id="6036855">pixelSize</span>&nbsp;<span class="op" id="6036865">&gt;</span>&nbsp;<span class="num" id="6036867">8</span>&nbsp;<span class="op" id="6036869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036873">return</span>&nbsp;<span class="builtintype" id="6036880">nil</span><span class="op" id="6036883">,</span>&nbsp;<span class="ident" id="6036885">fmt</span><span class="op" id="6036888">.</span><span class="ident" id="6036889">Errorf</span><span class="op" id="6036895">(</span><span class="string" id="6036896">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6036933">,</span>&nbsp;<span class="ident" id="6036935">d</span><span class="op" id="6036936">.</span><span class="ident" id="6036937">pixelSize</span><span class="op" id="6036946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036952">numColors</span>&nbsp;<span class="op" id="6036962">:=</span>&nbsp;<span class="num" id="6036965">1</span>&nbsp;<span class="op" id="6036967">&lt;&lt;</span>&nbsp;<span class="ident" id="6036970">d</span><span class="op" id="6036971">.</span><span class="ident" id="6036972">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036983">if</span>&nbsp;<span class="ident" id="6036986">d</span><span class="op" id="6036987">.</span><span class="ident" id="6036988">imageFields</span><span class="op" id="6036999">&amp;</span><span class="ident" id="6037000">ifLocalColorTable</span>&nbsp;<span class="op" id="6037018">!=</span>&nbsp;<span class="num" id="6037021">0</span>&nbsp;<span class="op" id="6037023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037027">numColors</span>&nbsp;<span class="op" id="6037037">=</span>&nbsp;<span class="num" id="6037039">1</span>&nbsp;<span class="op" id="6037041">&lt;&lt;</span>&nbsp;<span class="op" id="6037044">(</span><span class="op" id="6037045">(</span><span class="ident" id="6037046">d</span><span class="op" id="6037047">.</span><span class="ident" id="6037048">imageFields</span>&nbsp;<span class="op" id="6037060">&amp;</span>&nbsp;<span class="ident" id="6037062">ifPixelSizeMask</span><span class="op" id="6037077">)</span>&nbsp;<span class="op" id="6037079">+</span>&nbsp;<span class="num" id="6037081">1</span><span class="op" id="6037082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037088">numValues</span>&nbsp;<span class="op" id="6037098">:=</span>&nbsp;<span class="num" id="6037101">3</span>&nbsp;<span class="op" id="6037103">*</span>&nbsp;<span class="ident" id="6037105">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037116">_</span><span class="op" id="6037117">,</span>&nbsp;<span class="ident" id="6037119">err</span>&nbsp;<span class="op" id="6037123">:=</span>&nbsp;<span class="ident" id="6037126">io</span><span class="op" id="6037128">.</span><span class="ident" id="6037129">ReadFull</span><span class="op" id="6037137">(</span><span class="ident" id="6037138">d</span><span class="op" id="6037139">.</span><span class="ident" id="6037140">r</span><span class="op" id="6037141">,</span>&nbsp;<span class="ident" id="6037143">d</span><span class="op" id="6037144">.</span><span class="ident" id="6037145">tmp</span><span class="op" id="6037148">[</span><span class="num" id="6037149">0</span><span class="op" id="6037150">:</span><span class="ident" id="6037151">numValues</span><span class="op" id="6037160">]</span><span class="op" id="6037161">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037164">if</span>&nbsp;<span class="ident" id="6037167">err</span>&nbsp;<span class="op" id="6037171">!=</span>&nbsp;<span class="builtintype" id="6037174">nil</span>&nbsp;<span class="op" id="6037178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037182">return</span>&nbsp;<span class="builtintype" id="6037189">nil</span><span class="op" id="6037192">,</span>&nbsp;<span class="ident" id="6037194">fmt</span><span class="op" id="6037197">.</span><span class="ident" id="6037198">Errorf</span><span class="op" id="6037204">(</span><span class="string" id="6037205">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6037239">,</span>&nbsp;<span class="ident" id="6037241">err</span><span class="op" id="6037244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037250">colorMap</span>&nbsp;<span class="op" id="6037259">:=</span>&nbsp;<span class="builtinfunc" id="6037262">make</span><span class="op" id="6037266">(</span><span class="ident" id="6037267">color</span><span class="op" id="6037272">.</span><span class="ident" id="6037273">Palette</span><span class="op" id="6037280">,</span>&nbsp;<span class="ident" id="6037282">numColors</span><span class="op" id="6037291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037294">j</span>&nbsp;<span class="op" id="6037296">:=</span>&nbsp;<span class="num" id="6037299">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037302">for</span>&nbsp;<span class="ident" id="6037306">i</span>&nbsp;<span class="op" id="6037308">:=</span>&nbsp;<span class="keyword" id="6037311">range</span>&nbsp;<span class="ident" id="6037317">colorMap</span>&nbsp;<span class="op" id="6037326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037330">colorMap</span><span class="op" id="6037338">[</span><span class="ident" id="6037339">i</span><span class="op" id="6037340">]</span>&nbsp;<span class="op" id="6037342">=</span>&nbsp;<span class="ident" id="6037344">color</span><span class="op" id="6037349">.</span><span class="ident" id="6037350">RGBA</span><span class="op" id="6037354">{</span><span class="ident" id="6037355">d</span><span class="op" id="6037356">.</span><span class="ident" id="6037357">tmp</span><span class="op" id="6037360">[</span><span class="ident" id="6037361">j</span><span class="op" id="6037362">+</span><span class="num" id="6037363">0</span><span class="op" id="6037364">]</span><span class="op" id="6037365">,</span>&nbsp;<span class="ident" id="6037367">d</span><span class="op" id="6037368">.</span><span class="ident" id="6037369">tmp</span><span class="op" id="6037372">[</span><span class="ident" id="6037373">j</span><span class="op" id="6037374">+</span><span class="num" id="6037375">1</span><span class="op" id="6037376">]</span><span class="op" id="6037377">,</span>&nbsp;<span class="ident" id="6037379">d</span><span class="op" id="6037380">.</span><span class="ident" id="6037381">tmp</span><span class="op" id="6037384">[</span><span class="ident" id="6037385">j</span><span class="op" id="6037386">+</span><span class="num" id="6037387">2</span><span class="op" id="6037388">]</span><span class="op" id="6037389">,</span>&nbsp;<span class="num" id="6037391">0xFF</span><span class="op" id="6037395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037399">j</span>&nbsp;<span class="op" id="6037401">+=</span>&nbsp;<span class="num" id="6037404">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037410">return</span>&nbsp;<span class="ident" id="6037417">colorMap</span><span class="op" id="6037425">,</span>&nbsp;<span class="builtintype" id="6037427">nil</span><br>
<span class="lineno">295</span><span class="op" id="6037431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037434">func</span>&nbsp;<span class="op" id="6037439">(</span><span class="ident" id="6037440">d</span>&nbsp;<span class="op" id="6037442">*</span><span class="ident" id="6037443">decoder</span><span class="op" id="6037450">)</span>&nbsp;<span class="ident" id="6037452">readExtension</span><span class="op" id="6037465">(</span><span class="op" id="6037466">)</span>&nbsp;<span class="builtintype" id="6037468">error</span>&nbsp;<span class="op" id="6037474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037477">extension</span><span class="op" id="6037486">,</span>&nbsp;<span class="ident" id="6037488">err</span>&nbsp;<span class="op" id="6037492">:=</span>&nbsp;<span class="ident" id="6037495">d</span><span class="op" id="6037496">.</span><span class="ident" id="6037497">r</span><span class="op" id="6037498">.</span><span class="ident" id="6037499">ReadByte</span><span class="op" id="6037507">(</span><span class="op" id="6037508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037511">if</span>&nbsp;<span class="ident" id="6037514">err</span>&nbsp;<span class="op" id="6037518">!=</span>&nbsp;<span class="builtintype" id="6037521">nil</span>&nbsp;<span class="op" id="6037525">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037529">return</span>&nbsp;<span class="ident" id="6037536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037544">size</span>&nbsp;<span class="op" id="6037549">:=</span>&nbsp;<span class="num" id="6037552">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037555">switch</span>&nbsp;<span class="ident" id="6037562">extension</span>&nbsp;<span class="op" id="6037572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037575">case</span>&nbsp;<span class="ident" id="6037580">eText</span><span class="op" id="6037585">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037589">size</span>&nbsp;<span class="op" id="6037594">=</span>&nbsp;<span class="num" id="6037596">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037600">case</span>&nbsp;<span class="ident" id="6037605">eGraphicControl</span><span class="op" id="6037620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037624">return</span>&nbsp;<span class="ident" id="6037631">d</span><span class="op" id="6037632">.</span><span class="ident" id="6037633">readGraphicControl</span><span class="op" id="6037651">(</span><span class="op" id="6037652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037655">case</span>&nbsp;<span class="ident" id="6037660">eComment</span><span class="op" id="6037668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037672">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037709">case</span>&nbsp;<span class="ident" id="6037714">eApplication</span><span class="op" id="6037726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037730">b</span><span class="op" id="6037731">,</span>&nbsp;<span class="ident" id="6037733">err</span>&nbsp;<span class="op" id="6037737">:=</span>&nbsp;<span class="ident" id="6037740">d</span><span class="op" id="6037741">.</span><span class="ident" id="6037742">r</span><span class="op" id="6037743">.</span><span class="ident" id="6037744">ReadByte</span><span class="op" id="6037752">(</span><span class="op" id="6037753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037757">if</span>&nbsp;<span class="ident" id="6037760">err</span>&nbsp;<span class="op" id="6037764">!=</span>&nbsp;<span class="builtintype" id="6037767">nil</span>&nbsp;<span class="op" id="6037771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037776">return</span>&nbsp;<span class="ident" id="6037783">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037789">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037793">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037857">size</span>&nbsp;<span class="op" id="6037862">=</span>&nbsp;<span class="builtintype" id="6037864">int</span><span class="op" id="6037867">(</span><span class="ident" id="6037868">b</span><span class="op" id="6037869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037872">default</span><span class="op" id="6037879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037883">return</span>&nbsp;<span class="ident" id="6037890">fmt</span><span class="op" id="6037893">.</span><span class="ident" id="6037894">Errorf</span><span class="op" id="6037900">(</span><span class="string" id="6037901">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6037932">,</span>&nbsp;<span class="ident" id="6037934">extension</span><span class="op" id="6037943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037946">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037949">if</span>&nbsp;<span class="ident" id="6037952">size</span>&nbsp;<span class="op" id="6037957">&gt;</span>&nbsp;<span class="num" id="6037959">0</span>&nbsp;<span class="op" id="6037961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037965">if</span>&nbsp;<span class="ident" id="6037968">_</span><span class="op" id="6037969">,</span>&nbsp;<span class="ident" id="6037971">err</span>&nbsp;<span class="op" id="6037975">:=</span>&nbsp;<span class="ident" id="6037978">io</span><span class="op" id="6037980">.</span><span class="ident" id="6037981">ReadFull</span><span class="op" id="6037989">(</span><span class="ident" id="6037990">d</span><span class="op" id="6037991">.</span><span class="ident" id="6037992">r</span><span class="op" id="6037993">,</span>&nbsp;<span class="ident" id="6037995">d</span><span class="op" id="6037996">.</span><span class="ident" id="6037997">tmp</span><span class="op" id="6038000">[</span><span class="num" id="6038001">0</span><span class="op" id="6038002">:</span><span class="ident" id="6038003">size</span><span class="op" id="6038007">]</span><span class="op" id="6038008">)</span><span class="op" id="6038009">;</span>&nbsp;<span class="ident" id="6038011">err</span>&nbsp;<span class="op" id="6038015">!=</span>&nbsp;<span class="builtintype" id="6038018">nil</span>&nbsp;<span class="op" id="6038022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038027">return</span>&nbsp;<span class="ident" id="6038034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038043">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038047">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038122">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038163">if</span>&nbsp;<span class="ident" id="6038166">extension</span>&nbsp;<span class="op" id="6038176">==</span>&nbsp;<span class="ident" id="6038179">eApplication</span>&nbsp;<span class="op" id="6038192">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6038195">string</span><span class="op" id="6038201">(</span><span class="ident" id="6038202">d</span><span class="op" id="6038203">.</span><span class="ident" id="6038204">tmp</span><span class="op" id="6038207">[</span><span class="op" id="6038208">:</span><span class="ident" id="6038209">size</span><span class="op" id="6038213">]</span><span class="op" id="6038214">)</span>&nbsp;<span class="op" id="6038216">==</span>&nbsp;<span class="string" id="6038219">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6038233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038237">n</span><span class="op" id="6038238">,</span>&nbsp;<span class="ident" id="6038240">err</span>&nbsp;<span class="op" id="6038244">:=</span>&nbsp;<span class="ident" id="6038247">d</span><span class="op" id="6038248">.</span><span class="ident" id="6038249">readBlock</span><span class="op" id="6038258">(</span><span class="op" id="6038259">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038263">if</span>&nbsp;<span class="ident" id="6038266">n</span>&nbsp;<span class="op" id="6038268">==</span>&nbsp;<span class="num" id="6038271">0</span>&nbsp;<span class="op" id="6038273">||</span>&nbsp;<span class="ident" id="6038276">err</span>&nbsp;<span class="op" id="6038280">!=</span>&nbsp;<span class="builtintype" id="6038283">nil</span>&nbsp;<span class="op" id="6038287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038292">return</span>&nbsp;<span class="ident" id="6038299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038309">if</span>&nbsp;<span class="ident" id="6038312">n</span>&nbsp;<span class="op" id="6038314">==</span>&nbsp;<span class="num" id="6038317">3</span>&nbsp;<span class="op" id="6038319">&amp;&amp;</span>&nbsp;<span class="ident" id="6038322">d</span><span class="op" id="6038323">.</span><span class="ident" id="6038324">tmp</span><span class="op" id="6038327">[</span><span class="num" id="6038328">0</span><span class="op" id="6038329">]</span>&nbsp;<span class="op" id="6038331">==</span>&nbsp;<span class="num" id="6038334">1</span>&nbsp;<span class="op" id="6038336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038341">d</span><span class="op" id="6038342">.</span><span class="ident" id="6038343">loopCount</span>&nbsp;<span class="op" id="6038353">=</span>&nbsp;<span class="builtintype" id="6038355">int</span><span class="op" id="6038358">(</span><span class="ident" id="6038359">d</span><span class="op" id="6038360">.</span><span class="ident" id="6038361">tmp</span><span class="op" id="6038364">[</span><span class="num" id="6038365">1</span><span class="op" id="6038366">]</span><span class="op" id="6038367">)</span>&nbsp;<span class="op" id="6038369">|</span>&nbsp;<span class="builtintype" id="6038371">int</span><span class="op" id="6038374">(</span><span class="ident" id="6038375">d</span><span class="op" id="6038376">.</span><span class="ident" id="6038377">tmp</span><span class="op" id="6038380">[</span><span class="num" id="6038381">2</span><span class="op" id="6038382">]</span><span class="op" id="6038383">)</span><span class="op" id="6038384">&lt;&lt;</span><span class="num" id="6038386">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038396">for</span>&nbsp;<span class="op" id="6038400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038404">n</span><span class="op" id="6038405">,</span>&nbsp;<span class="ident" id="6038407">err</span>&nbsp;<span class="op" id="6038411">:=</span>&nbsp;<span class="ident" id="6038414">d</span><span class="op" id="6038415">.</span><span class="ident" id="6038416">readBlock</span><span class="op" id="6038425">(</span><span class="op" id="6038426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038430">if</span>&nbsp;<span class="ident" id="6038433">n</span>&nbsp;<span class="op" id="6038435">==</span>&nbsp;<span class="num" id="6038438">0</span>&nbsp;<span class="op" id="6038440">||</span>&nbsp;<span class="ident" id="6038443">err</span>&nbsp;<span class="op" id="6038447">!=</span>&nbsp;<span class="builtintype" id="6038450">nil</span>&nbsp;<span class="op" id="6038454">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038459">return</span>&nbsp;<span class="ident" id="6038466">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038475">}</span><br>
<span class="lineno"></span><span class="op" id="6038477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6038480">func</span>&nbsp;<span class="op" id="6038485">(</span><span class="ident" id="6038486">d</span>&nbsp;<span class="op" id="6038488">*</span><span class="ident" id="6038489">decoder</span><span class="op" id="6038496">)</span>&nbsp;<span class="ident" id="6038498">readGraphicControl</span><span class="op" id="6038516">(</span><span class="op" id="6038517">)</span>&nbsp;<span class="builtintype" id="6038519">error</span>&nbsp;<span class="op" id="6038525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038528">if</span>&nbsp;<span class="ident" id="6038531">_</span><span class="op" id="6038532">,</span>&nbsp;<span class="ident" id="6038534">err</span>&nbsp;<span class="op" id="6038538">:=</span>&nbsp;<span class="ident" id="6038541">io</span><span class="op" id="6038543">.</span><span class="ident" id="6038544">ReadFull</span><span class="op" id="6038552">(</span><span class="ident" id="6038553">d</span><span class="op" id="6038554">.</span><span class="ident" id="6038555">r</span><span class="op" id="6038556">,</span>&nbsp;<span class="ident" id="6038558">d</span><span class="op" id="6038559">.</span><span class="ident" id="6038560">tmp</span><span class="op" id="6038563">[</span><span class="num" id="6038564">0</span><span class="op" id="6038565">:</span><span class="num" id="6038566">6</span><span class="op" id="6038567">]</span><span class="op" id="6038568">)</span><span class="op" id="6038569">;</span>&nbsp;<span class="ident" id="6038571">err</span>&nbsp;<span class="op" id="6038575">!=</span>&nbsp;<span class="builtintype" id="6038578">nil</span>&nbsp;<span class="op" id="6038582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038586">return</span>&nbsp;<span class="ident" id="6038593">fmt</span><span class="op" id="6038596">.</span><span class="ident" id="6038597">Errorf</span><span class="op" id="6038603">(</span><span class="string" id="6038604">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6038641">,</span>&nbsp;<span class="ident" id="6038643">err</span><span class="op" id="6038646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038652">d</span><span class="op" id="6038653">.</span><span class="ident" id="6038654">flags</span>&nbsp;<span class="op" id="6038660">=</span>&nbsp;<span class="ident" id="6038662">d</span><span class="op" id="6038663">.</span><span class="ident" id="6038664">tmp</span><span class="op" id="6038667">[</span><span class="num" id="6038668">1</span><span class="op" id="6038669">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038672">d</span><span class="op" id="6038673">.</span><span class="ident" id="6038674">delayTime</span>&nbsp;<span class="op" id="6038684">=</span>&nbsp;<span class="builtintype" id="6038686">int</span><span class="op" id="6038689">(</span><span class="ident" id="6038690">d</span><span class="op" id="6038691">.</span><span class="ident" id="6038692">tmp</span><span class="op" id="6038695">[</span><span class="num" id="6038696">2</span><span class="op" id="6038697">]</span><span class="op" id="6038698">)</span>&nbsp;<span class="op" id="6038700">|</span>&nbsp;<span class="builtintype" id="6038702">int</span><span class="op" id="6038705">(</span><span class="ident" id="6038706">d</span><span class="op" id="6038707">.</span><span class="ident" id="6038708">tmp</span><span class="op" id="6038711">[</span><span class="num" id="6038712">3</span><span class="op" id="6038713">]</span><span class="op" id="6038714">)</span><span class="op" id="6038715">&lt;&lt;</span><span class="num" id="6038717">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038720">if</span>&nbsp;<span class="ident" id="6038723">d</span><span class="op" id="6038724">.</span><span class="ident" id="6038725">flags</span><span class="op" id="6038730">&amp;</span><span class="ident" id="6038731">gcTransparentColorSet</span>&nbsp;<span class="op" id="6038753">!=</span>&nbsp;<span class="num" id="6038756">0</span>&nbsp;<span class="op" id="6038758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038762">d</span><span class="op" id="6038763">.</span><span class="ident" id="6038764">transparentIndex</span>&nbsp;<span class="op" id="6038781">=</span>&nbsp;<span class="ident" id="6038783">d</span><span class="op" id="6038784">.</span><span class="ident" id="6038785">tmp</span><span class="op" id="6038788">[</span><span class="num" id="6038789">4</span><span class="op" id="6038790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038794">d</span><span class="op" id="6038795">.</span><span class="ident" id="6038796">hasTransparentIndex</span>&nbsp;<span class="op" id="6038816">=</span>&nbsp;<span class="builtintype" id="6038818">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038824">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038827">return</span>&nbsp;<span class="builtintype" id="6038834">nil</span><br>
<span class="lineno"></span><span class="op" id="6038838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6038841">func</span>&nbsp;<span class="op" id="6038846">(</span><span class="ident" id="6038847">d</span>&nbsp;<span class="op" id="6038849">*</span><span class="ident" id="6038850">decoder</span><span class="op" id="6038857">)</span>&nbsp;<span class="ident" id="6038859">newImageFromDescriptor</span><span class="op" id="6038881">(</span><span class="op" id="6038882">)</span>&nbsp;<span class="op" id="6038884">(</span><span class="op" id="6038885">*</span><span class="ident" id="6038886">image</span><span class="op" id="6038891">.</span><span class="ident" id="6038892">Paletted</span><span class="op" id="6038900">,</span>&nbsp;<span class="builtintype" id="6038902">error</span><span class="op" id="6038907">)</span>&nbsp;<span class="op" id="6038909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038912">if</span>&nbsp;<span class="ident" id="6038915">_</span><span class="op" id="6038916">,</span>&nbsp;<span class="ident" id="6038918">err</span>&nbsp;<span class="op" id="6038922">:=</span>&nbsp;<span class="ident" id="6038925">io</span><span class="op" id="6038927">.</span><span class="ident" id="6038928">ReadFull</span><span class="op" id="6038936">(</span><span class="ident" id="6038937">d</span><span class="op" id="6038938">.</span><span class="ident" id="6038939">r</span><span class="op" id="6038940">,</span>&nbsp;<span class="ident" id="6038942">d</span><span class="op" id="6038943">.</span><span class="ident" id="6038944">tmp</span><span class="op" id="6038947">[</span><span class="num" id="6038948">0</span><span class="op" id="6038949">:</span><span class="num" id="6038950">9</span><span class="op" id="6038951">]</span><span class="op" id="6038952">)</span><span class="op" id="6038953">;</span>&nbsp;<span class="ident" id="6038955">err</span>&nbsp;<span class="op" id="6038959">!=</span>&nbsp;<span class="builtintype" id="6038962">nil</span>&nbsp;<span class="op" id="6038966">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038970">return</span>&nbsp;<span class="builtintype" id="6038977">nil</span><span class="op" id="6038980">,</span>&nbsp;<span class="ident" id="6038982">fmt</span><span class="op" id="6038985">.</span><span class="ident" id="6038986">Errorf</span><span class="op" id="6038992">(</span><span class="string" id="6038993">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6039031">,</span>&nbsp;<span class="ident" id="6039033">err</span><span class="op" id="6039036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039042">left</span>&nbsp;<span class="op" id="6039047">:=</span>&nbsp;<span class="builtintype" id="6039050">int</span><span class="op" id="6039053">(</span><span class="ident" id="6039054">d</span><span class="op" id="6039055">.</span><span class="ident" id="6039056">tmp</span><span class="op" id="6039059">[</span><span class="num" id="6039060">0</span><span class="op" id="6039061">]</span><span class="op" id="6039062">)</span>&nbsp;<span class="op" id="6039064">+</span>&nbsp;<span class="builtintype" id="6039066">int</span><span class="op" id="6039069">(</span><span class="ident" id="6039070">d</span><span class="op" id="6039071">.</span><span class="ident" id="6039072">tmp</span><span class="op" id="6039075">[</span><span class="num" id="6039076">1</span><span class="op" id="6039077">]</span><span class="op" id="6039078">)</span><span class="op" id="6039079">&lt;&lt;</span><span class="num" id="6039081">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039084">top</span>&nbsp;<span class="op" id="6039088">:=</span>&nbsp;<span class="builtintype" id="6039091">int</span><span class="op" id="6039094">(</span><span class="ident" id="6039095">d</span><span class="op" id="6039096">.</span><span class="ident" id="6039097">tmp</span><span class="op" id="6039100">[</span><span class="num" id="6039101">2</span><span class="op" id="6039102">]</span><span class="op" id="6039103">)</span>&nbsp;<span class="op" id="6039105">+</span>&nbsp;<span class="builtintype" id="6039107">int</span><span class="op" id="6039110">(</span><span class="ident" id="6039111">d</span><span class="op" id="6039112">.</span><span class="ident" id="6039113">tmp</span><span class="op" id="6039116">[</span><span class="num" id="6039117">3</span><span class="op" id="6039118">]</span><span class="op" id="6039119">)</span><span class="op" id="6039120">&lt;&lt;</span><span class="num" id="6039122">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039125">width</span>&nbsp;<span class="op" id="6039131">:=</span>&nbsp;<span class="builtintype" id="6039134">int</span><span class="op" id="6039137">(</span><span class="ident" id="6039138">d</span><span class="op" id="6039139">.</span><span class="ident" id="6039140">tmp</span><span class="op" id="6039143">[</span><span class="num" id="6039144">4</span><span class="op" id="6039145">]</span><span class="op" id="6039146">)</span>&nbsp;<span class="op" id="6039148">+</span>&nbsp;<span class="builtintype" id="6039150">int</span><span class="op" id="6039153">(</span><span class="ident" id="6039154">d</span><span class="op" id="6039155">.</span><span class="ident" id="6039156">tmp</span><span class="op" id="6039159">[</span><span class="num" id="6039160">5</span><span class="op" id="6039161">]</span><span class="op" id="6039162">)</span><span class="op" id="6039163">&lt;&lt;</span><span class="num" id="6039165">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039168">height</span>&nbsp;<span class="op" id="6039175">:=</span>&nbsp;<span class="builtintype" id="6039178">int</span><span class="op" id="6039181">(</span><span class="ident" id="6039182">d</span><span class="op" id="6039183">.</span><span class="ident" id="6039184">tmp</span><span class="op" id="6039187">[</span><span class="num" id="6039188">6</span><span class="op" id="6039189">]</span><span class="op" id="6039190">)</span>&nbsp;<span class="op" id="6039192">+</span>&nbsp;<span class="builtintype" id="6039194">int</span><span class="op" id="6039197">(</span><span class="ident" id="6039198">d</span><span class="op" id="6039199">.</span><span class="ident" id="6039200">tmp</span><span class="op" id="6039203">[</span><span class="num" id="6039204">7</span><span class="op" id="6039205">]</span><span class="op" id="6039206">)</span><span class="op" id="6039207">&lt;&lt;</span><span class="num" id="6039209">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039212">d</span><span class="op" id="6039213">.</span><span class="ident" id="6039214">imageFields</span>&nbsp;<span class="op" id="6039226">=</span>&nbsp;<span class="ident" id="6039228">d</span><span class="op" id="6039229">.</span><span class="ident" id="6039230">tmp</span><span class="op" id="6039233">[</span><span class="num" id="6039234">8</span><span class="op" id="6039235">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039239">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039296">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039358">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039416">bounds</span>&nbsp;<span class="op" id="6039423">:=</span>&nbsp;<span class="ident" id="6039426">image</span><span class="op" id="6039431">.</span><span class="ident" id="6039432">Rect</span><span class="op" id="6039436">(</span><span class="ident" id="6039437">left</span><span class="op" id="6039441">,</span>&nbsp;<span class="ident" id="6039443">top</span><span class="op" id="6039446">,</span>&nbsp;<span class="ident" id="6039448">left</span><span class="op" id="6039452">+</span><span class="ident" id="6039453">width</span><span class="op" id="6039458">,</span>&nbsp;<span class="ident" id="6039460">top</span><span class="op" id="6039463">+</span><span class="ident" id="6039464">height</span><span class="op" id="6039470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039473">if</span>&nbsp;<span class="ident" id="6039476">bounds</span>&nbsp;<span class="op" id="6039483">!=</span>&nbsp;<span class="ident" id="6039486">bounds</span><span class="op" id="6039492">.</span><span class="ident" id="6039493">Intersect</span><span class="op" id="6039502">(</span><span class="ident" id="6039503">image</span><span class="op" id="6039508">.</span><span class="ident" id="6039509">Rect</span><span class="op" id="6039513">(</span><span class="num" id="6039514">0</span><span class="op" id="6039515">,</span>&nbsp;<span class="num" id="6039517">0</span><span class="op" id="6039518">,</span>&nbsp;<span class="ident" id="6039520">d</span><span class="op" id="6039521">.</span><span class="ident" id="6039522">width</span><span class="op" id="6039527">,</span>&nbsp;<span class="ident" id="6039529">d</span><span class="op" id="6039530">.</span><span class="ident" id="6039531">height</span><span class="op" id="6039537">)</span><span class="op" id="6039538">)</span>&nbsp;<span class="op" id="6039540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039544">return</span>&nbsp;<span class="builtintype" id="6039551">nil</span><span class="op" id="6039554">,</span>&nbsp;<span class="ident" id="6039556">errors</span><span class="op" id="6039562">.</span><span class="ident" id="6039563">New</span><span class="op" id="6039566">(</span><span class="string" id="6039567">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6039611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039614">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039617">return</span>&nbsp;<span class="ident" id="6039624">image</span><span class="op" id="6039629">.</span><span class="ident" id="6039630">NewPaletted</span><span class="op" id="6039641">(</span><span class="ident" id="6039642">bounds</span><span class="op" id="6039648">,</span>&nbsp;<span class="builtintype" id="6039650">nil</span><span class="op" id="6039653">)</span><span class="op" id="6039654">,</span>&nbsp;<span class="builtintype" id="6039656">nil</span><br>
<span class="lineno"></span><span class="op" id="6039660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6039663">func</span>&nbsp;<span class="op" id="6039668">(</span><span class="ident" id="6039669">d</span>&nbsp;<span class="op" id="6039671">*</span><span class="ident" id="6039672">decoder</span><span class="op" id="6039679">)</span>&nbsp;<span class="ident" id="6039681">readBlock</span><span class="op" id="6039690">(</span><span class="op" id="6039691">)</span>&nbsp;<span class="op" id="6039693">(</span><span class="builtintype" id="6039694">int</span><span class="op" id="6039697">,</span>&nbsp;<span class="builtintype" id="6039699">error</span><span class="op" id="6039704">)</span>&nbsp;<span class="op" id="6039706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039709">n</span><span class="op" id="6039710">,</span>&nbsp;<span class="ident" id="6039712">err</span>&nbsp;<span class="op" id="6039716">:=</span>&nbsp;<span class="ident" id="6039719">d</span><span class="op" id="6039720">.</span><span class="ident" id="6039721">r</span><span class="op" id="6039722">.</span><span class="ident" id="6039723">ReadByte</span><span class="op" id="6039731">(</span><span class="op" id="6039732">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039735">if</span>&nbsp;<span class="ident" id="6039738">n</span>&nbsp;<span class="op" id="6039740">==</span>&nbsp;<span class="num" id="6039743">0</span>&nbsp;<span class="op" id="6039745">||</span>&nbsp;<span class="ident" id="6039748">err</span>&nbsp;<span class="op" id="6039752">!=</span>&nbsp;<span class="builtintype" id="6039755">nil</span>&nbsp;<span class="op" id="6039759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039763">return</span>&nbsp;<span class="num" id="6039770">0</span><span class="op" id="6039771">,</span>&nbsp;<span class="ident" id="6039773">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039781">return</span>&nbsp;<span class="ident" id="6039788">io</span><span class="op" id="6039790">.</span><span class="ident" id="6039791">ReadFull</span><span class="op" id="6039799">(</span><span class="ident" id="6039800">d</span><span class="op" id="6039801">.</span><span class="ident" id="6039802">r</span><span class="op" id="6039803">,</span>&nbsp;<span class="ident" id="6039805">d</span><span class="op" id="6039806">.</span><span class="ident" id="6039807">tmp</span><span class="op" id="6039810">[</span><span class="num" id="6039811">0</span><span class="op" id="6039812">:</span><span class="ident" id="6039813">n</span><span class="op" id="6039814">]</span><span class="op" id="6039815">)</span><br>
<span class="lineno"></span><span class="op" id="6039817">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6039820">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6039897">type</span>&nbsp;<span class="ident" id="6039902">interlaceScan</span>&nbsp;<span class="keyword" id="6039916">struct</span>&nbsp;<span class="op" id="6039923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039926">skip</span><span class="op" id="6039930">,</span>&nbsp;<span class="ident" id="6039932">start</span>&nbsp;<span class="builtintype" id="6039938">int</span><br>
<span class="lineno"></span><span class="op" id="6039942">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6039945">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6040016">var</span>&nbsp;<span class="ident" id="6040020">interlacing</span>&nbsp;<span class="op" id="6040032">=</span>&nbsp;<span class="op" id="6040034">[</span><span class="op" id="6040035">]</span><span class="ident" id="6040036">interlaceScan</span><span class="op" id="6040049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040052">{</span><span class="num" id="6040053">8</span><span class="op" id="6040054">,</span>&nbsp;<span class="num" id="6040056">0</span><span class="op" id="6040057">}</span><span class="op" id="6040058">,</span>&nbsp;<span class="comment" id="6040060">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040111">{</span><span class="num" id="6040112">8</span><span class="op" id="6040113">,</span>&nbsp;<span class="num" id="6040115">4</span><span class="op" id="6040116">}</span><span class="op" id="6040117">,</span>&nbsp;<span class="comment" id="6040119">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040170">{</span><span class="num" id="6040171">4</span><span class="op" id="6040172">,</span>&nbsp;<span class="num" id="6040174">2</span><span class="op" id="6040175">}</span><span class="op" id="6040176">,</span>&nbsp;<span class="comment" id="6040178">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040229">{</span><span class="num" id="6040230">2</span><span class="op" id="6040231">,</span>&nbsp;<span class="num" id="6040233">1</span><span class="op" id="6040234">}</span><span class="op" id="6040235">,</span>&nbsp;<span class="comment" id="6040237">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6040287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6040290">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6040365">func</span>&nbsp;<span class="ident" id="6040370">uninterlace</span><span class="op" id="6040381">(</span><span class="ident" id="6040382">m</span>&nbsp;<span class="op" id="6040384">*</span><span class="ident" id="6040385">image</span><span class="op" id="6040390">.</span><span class="ident" id="6040391">Paletted</span><span class="op" id="6040399">)</span>&nbsp;<span class="op" id="6040401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040404">var</span>&nbsp;<span class="ident" id="6040408">nPix</span>&nbsp;<span class="op" id="6040413">[</span><span class="op" id="6040414">]</span><span class="builtintype" id="6040415">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040422">dx</span>&nbsp;<span class="op" id="6040425">:=</span>&nbsp;<span class="ident" id="6040428">m</span><span class="op" id="6040429">.</span><span class="ident" id="6040430">Bounds</span><span class="op" id="6040436">(</span><span class="op" id="6040437">)</span><span class="op" id="6040438">.</span><span class="ident" id="6040439">Dx</span><span class="op" id="6040441">(</span><span class="op" id="6040442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040445">dy</span>&nbsp;<span class="op" id="6040448">:=</span>&nbsp;<span class="ident" id="6040451">m</span><span class="op" id="6040452">.</span><span class="ident" id="6040453">Bounds</span><span class="op" id="6040459">(</span><span class="op" id="6040460">)</span><span class="op" id="6040461">.</span><span class="ident" id="6040462">Dy</span><span class="op" id="6040464">(</span><span class="op" id="6040465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040468">nPix</span>&nbsp;<span class="op" id="6040473">=</span>&nbsp;<span class="builtinfunc" id="6040475">make</span><span class="op" id="6040479">(</span><span class="op" id="6040480">[</span><span class="op" id="6040481">]</span><span class="builtintype" id="6040482">uint8</span><span class="op" id="6040487">,</span>&nbsp;<span class="ident" id="6040489">dx</span><span class="op" id="6040491">*</span><span class="ident" id="6040492">dy</span><span class="op" id="6040494">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040497">offset</span>&nbsp;<span class="op" id="6040504">:=</span>&nbsp;<span class="num" id="6040507">0</span>&nbsp;<span class="comment" id="6040509">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040563">for</span>&nbsp;<span class="ident" id="6040567">_</span><span class="op" id="6040568">,</span>&nbsp;<span class="ident" id="6040570">pass</span>&nbsp;<span class="op" id="6040575">:=</span>&nbsp;<span class="keyword" id="6040578">range</span>&nbsp;<span class="ident" id="6040584">interlacing</span>&nbsp;<span class="op" id="6040596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040600">nOffset</span>&nbsp;<span class="op" id="6040608">:=</span>&nbsp;<span class="ident" id="6040611">pass</span><span class="op" id="6040615">.</span><span class="ident" id="6040616">start</span>&nbsp;<span class="op" id="6040622">*</span>&nbsp;<span class="ident" id="6040624">dx</span>&nbsp;<span class="comment" id="6040627">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040677">for</span>&nbsp;<span class="ident" id="6040681">y</span>&nbsp;<span class="op" id="6040683">:=</span>&nbsp;<span class="ident" id="6040686">pass</span><span class="op" id="6040690">.</span><span class="ident" id="6040691">start</span><span class="op" id="6040696">;</span>&nbsp;<span class="ident" id="6040698">y</span>&nbsp;<span class="op" id="6040700">&lt;</span>&nbsp;<span class="ident" id="6040702">dy</span><span class="op" id="6040704">;</span>&nbsp;<span class="ident" id="6040706">y</span>&nbsp;<span class="op" id="6040708">+=</span>&nbsp;<span class="ident" id="6040711">pass</span><span class="op" id="6040715">.</span><span class="ident" id="6040716">skip</span>&nbsp;<span class="op" id="6040721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6040726">copy</span><span class="op" id="6040730">(</span><span class="ident" id="6040731">nPix</span><span class="op" id="6040735">[</span><span class="ident" id="6040736">nOffset</span><span class="op" id="6040743">:</span><span class="ident" id="6040744">nOffset</span><span class="op" id="6040751">+</span><span class="ident" id="6040752">dx</span><span class="op" id="6040754">]</span><span class="op" id="6040755">,</span>&nbsp;<span class="ident" id="6040757">m</span><span class="op" id="6040758">.</span><span class="ident" id="6040759">Pix</span><span class="op" id="6040762">[</span><span class="ident" id="6040763">offset</span><span class="op" id="6040769">:</span><span class="ident" id="6040770">offset</span><span class="op" id="6040776">+</span><span class="ident" id="6040777">dx</span><span class="op" id="6040779">]</span><span class="op" id="6040780">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040785">offset</span>&nbsp;<span class="op" id="6040792">+=</span>&nbsp;<span class="ident" id="6040795">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040801">nOffset</span>&nbsp;<span class="op" id="6040809">+=</span>&nbsp;<span class="ident" id="6040812">dx</span>&nbsp;<span class="op" id="6040815">*</span>&nbsp;<span class="ident" id="6040817">pass</span><span class="op" id="6040821">.</span><span class="ident" id="6040822">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040835">m</span><span class="op" id="6040836">.</span><span class="ident" id="6040837">Pix</span>&nbsp;<span class="op" id="6040841">=</span>&nbsp;<span class="ident" id="6040843">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6040848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6040851">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6040917">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6040945">func</span>&nbsp;<span class="ident" id="6040950">Decode</span><span class="op" id="6040956">(</span><span class="ident" id="6040957">r</span>&nbsp;<span class="ident" id="6040959">io</span><span class="op" id="6040961">.</span><span class="ident" id="6040962">Reader</span><span class="op" id="6040968">)</span>&nbsp;<span class="op" id="6040970">(</span><span class="ident" id="6040971">image</span><span class="op" id="6040976">.</span><span class="ident" id="6040977">Image</span><span class="op" id="6040982">,</span>&nbsp;<span class="builtintype" id="6040984">error</span><span class="op" id="6040989">)</span>&nbsp;<span class="op" id="6040991">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040994">var</span>&nbsp;<span class="ident" id="6040998">d</span>&nbsp;<span class="ident" id="6041000">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041009">if</span>&nbsp;<span class="ident" id="6041012">err</span>&nbsp;<span class="op" id="6041016">:=</span>&nbsp;<span class="ident" id="6041019">d</span><span class="op" id="6041020">.</span><span class="ident" id="6041021">decode</span><span class="op" id="6041027">(</span><span class="ident" id="6041028">r</span><span class="op" id="6041029">,</span>&nbsp;<span class="builtintype" id="6041031">false</span><span class="op" id="6041036">)</span><span class="op" id="6041037">;</span>&nbsp;<span class="ident" id="6041039">err</span>&nbsp;<span class="op" id="6041043">!=</span>&nbsp;<span class="builtintype" id="6041046">nil</span>&nbsp;<span class="op" id="6041050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041054">return</span>&nbsp;<span class="builtintype" id="6041061">nil</span><span class="op" id="6041064">,</span>&nbsp;<span class="ident" id="6041066">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041074">return</span>&nbsp;<span class="ident" id="6041081">d</span><span class="op" id="6041082">.</span><span class="ident" id="6041083">image</span><span class="op" id="6041088">[</span><span class="num" id="6041089">0</span><span class="op" id="6041090">]</span><span class="op" id="6041091">,</span>&nbsp;<span class="builtintype" id="6041093">nil</span><br>
<span class="lineno">425</span><span class="op" id="6041097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041100">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6041169">type</span>&nbsp;<span class="ident" id="6041174">GIF</span>&nbsp;<span class="keyword" id="6041178">struct</span>&nbsp;<span class="op" id="6041185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041188">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041198">[</span><span class="op" id="6041199">]</span><span class="op" id="6041200">*</span><span class="ident" id="6041201">image</span><span class="op" id="6041206">.</span><span class="ident" id="6041207">Paletted</span>&nbsp;<span class="comment" id="6041216">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041243">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041253">[</span><span class="op" id="6041254">]</span><span class="builtintype" id="6041255">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6041271">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041341">LoopCount</span>&nbsp;<span class="builtintype" id="6041351">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6041369">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6041388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041391">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6041463">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6041490">func</span>&nbsp;<span class="ident" id="6041495">DecodeAll</span><span class="op" id="6041504">(</span><span class="ident" id="6041505">r</span>&nbsp;<span class="ident" id="6041507">io</span><span class="op" id="6041509">.</span><span class="ident" id="6041510">Reader</span><span class="op" id="6041516">)</span>&nbsp;<span class="op" id="6041518">(</span><span class="op" id="6041519">*</span><span class="ident" id="6041520">GIF</span><span class="op" id="6041523">,</span>&nbsp;<span class="builtintype" id="6041525">error</span><span class="op" id="6041530">)</span>&nbsp;<span class="op" id="6041532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041535">var</span>&nbsp;<span class="ident" id="6041539">d</span>&nbsp;<span class="ident" id="6041541">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041550">if</span>&nbsp;<span class="ident" id="6041553">err</span>&nbsp;<span class="op" id="6041557">:=</span>&nbsp;<span class="ident" id="6041560">d</span><span class="op" id="6041561">.</span><span class="ident" id="6041562">decode</span><span class="op" id="6041568">(</span><span class="ident" id="6041569">r</span><span class="op" id="6041570">,</span>&nbsp;<span class="builtintype" id="6041572">false</span><span class="op" id="6041577">)</span><span class="op" id="6041578">;</span>&nbsp;<span class="ident" id="6041580">err</span>&nbsp;<span class="op" id="6041584">!=</span>&nbsp;<span class="builtintype" id="6041587">nil</span>&nbsp;<span class="op" id="6041591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041595">return</span>&nbsp;<span class="builtintype" id="6041602">nil</span><span class="op" id="6041605">,</span>&nbsp;<span class="ident" id="6041607">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041615">gif</span>&nbsp;<span class="op" id="6041619">:=</span>&nbsp;<span class="op" id="6041622">&amp;</span><span class="ident" id="6041623">GIF</span><span class="op" id="6041626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041630">Image</span><span class="op" id="6041635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041641">d</span><span class="op" id="6041642">.</span><span class="ident" id="6041643">image</span><span class="op" id="6041648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041652">LoopCount</span><span class="op" id="6041661">:</span>&nbsp;<span class="ident" id="6041663">d</span><span class="op" id="6041664">.</span><span class="ident" id="6041665">loopCount</span><span class="op" id="6041674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041678">Delay</span><span class="op" id="6041683">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041689">d</span><span class="op" id="6041690">.</span><span class="ident" id="6041691">delay</span><span class="op" id="6041696">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041702">return</span>&nbsp;<span class="ident" id="6041709">gif</span><span class="op" id="6041712">,</span>&nbsp;<span class="builtintype" id="6041714">nil</span><br>
<span class="lineno"></span><span class="op" id="6041718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041721">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6041798">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6041836">func</span>&nbsp;<span class="ident" id="6041841">DecodeConfig</span><span class="op" id="6041853">(</span><span class="ident" id="6041854">r</span>&nbsp;<span class="ident" id="6041856">io</span><span class="op" id="6041858">.</span><span class="ident" id="6041859">Reader</span><span class="op" id="6041865">)</span>&nbsp;<span class="op" id="6041867">(</span><span class="ident" id="6041868">image</span><span class="op" id="6041873">.</span><span class="ident" id="6041874">Config</span><span class="op" id="6041880">,</span>&nbsp;<span class="builtintype" id="6041882">error</span><span class="op" id="6041887">)</span>&nbsp;<span class="op" id="6041889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041892">var</span>&nbsp;<span class="ident" id="6041896">d</span>&nbsp;<span class="ident" id="6041898">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041907">if</span>&nbsp;<span class="ident" id="6041910">err</span>&nbsp;<span class="op" id="6041914">:=</span>&nbsp;<span class="ident" id="6041917">d</span><span class="op" id="6041918">.</span><span class="ident" id="6041919">decode</span><span class="op" id="6041925">(</span><span class="ident" id="6041926">r</span><span class="op" id="6041927">,</span>&nbsp;<span class="builtintype" id="6041929">true</span><span class="op" id="6041933">)</span><span class="op" id="6041934">;</span>&nbsp;<span class="ident" id="6041936">err</span>&nbsp;<span class="op" id="6041940">!=</span>&nbsp;<span class="builtintype" id="6041943">nil</span>&nbsp;<span class="op" id="6041947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041951">return</span>&nbsp;<span class="ident" id="6041958">image</span><span class="op" id="6041963">.</span><span class="ident" id="6041964">Config</span><span class="op" id="6041970">{</span><span class="op" id="6041971">}</span><span class="op" id="6041972">,</span>&nbsp;<span class="ident" id="6041974">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041982">return</span>&nbsp;<span class="ident" id="6041989">image</span><span class="op" id="6041994">.</span><span class="ident" id="6041995">Config</span><span class="op" id="6042001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042005">ColorModel</span><span class="op" id="6042015">:</span>&nbsp;<span class="ident" id="6042017">d</span><span class="op" id="6042018">.</span><span class="ident" id="6042019">globalColorMap</span><span class="op" id="6042033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042037">Width</span><span class="op" id="6042042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042049">d</span><span class="op" id="6042050">.</span><span class="ident" id="6042051">width</span><span class="op" id="6042056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042060">Height</span><span class="op" id="6042066">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042072">d</span><span class="op" id="6042073">.</span><span class="ident" id="6042074">height</span><span class="op" id="6042080">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042083">}</span><span class="op" id="6042084">,</span>&nbsp;<span class="builtintype" id="6042086">nil</span><br>
<span class="lineno"></span><span class="op" id="6042090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042093">func</span>&nbsp;<span class="ident" id="6042098">init</span><span class="op" id="6042102">(</span><span class="op" id="6042103">)</span>&nbsp;<span class="op" id="6042105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042108">image</span><span class="op" id="6042113">.</span><span class="ident" id="6042114">RegisterFormat</span><span class="op" id="6042128">(</span><span class="string" id="6042129">&#34;gif&#34;</span><span class="op" id="6042134">,</span>&nbsp;<span class="string" id="6042136">&#34;GIF8?a&#34;</span><span class="op" id="6042144">,</span>&nbsp;<span class="ident" id="6042146">Decode</span><span class="op" id="6042152">,</span>&nbsp;<span class="ident" id="6042154">DecodeConfig</span><span class="op" id="6042166">)</span><br>
<span class="lineno">465</span><span class="op" id="6042168">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
