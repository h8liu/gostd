<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3093184">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3093239">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3093293">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3093344">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="3093422">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3093497">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3093568">package</span>&nbsp;<span class="ident" id="3093576">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3093583">import</span>&nbsp;<span class="op" id="3093590">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3093593">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3093602">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3093612">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3093618">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3093633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3093636">const</span>&nbsp;<span class="op" id="3093642">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093645">defaultBufSize</span>&nbsp;<span class="op" id="3093660">=</span>&nbsp;<span class="num" id="3093662">4096</span><br>
<span class="lineno"></span><span class="op" id="3093667">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3093670">var</span>&nbsp;<span class="op" id="3093674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093677">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="3093698">=</span>&nbsp;<span class="ident" id="3093700">errors</span><span class="op" id="3093706">.</span><span class="ident" id="3093707">New</span><span class="op" id="3093710">(</span><span class="string" id="3093711">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="3093745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093748">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="3093769">=</span>&nbsp;<span class="ident" id="3093771">errors</span><span class="op" id="3093777">.</span><span class="ident" id="3093778">New</span><span class="op" id="3093781">(</span><span class="string" id="3093782">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="3093816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093819">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3093840">=</span>&nbsp;<span class="ident" id="3093842">errors</span><span class="op" id="3093848">.</span><span class="ident" id="3093849">New</span><span class="op" id="3093852">(</span><span class="string" id="3093853">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="3093873">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093876">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3093897">=</span>&nbsp;<span class="ident" id="3093899">errors</span><span class="op" id="3093905">.</span><span class="ident" id="3093906">New</span><span class="op" id="3093909">(</span><span class="string" id="3093910">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="3093933">)</span><br>
<span class="lineno"></span><span class="op" id="3093935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3093938">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3093958">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="3094014">type</span>&nbsp;<span class="ident" id="3094019">Reader</span>&nbsp;<span class="keyword" id="3094026">struct</span>&nbsp;<span class="op" id="3094033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094036">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3094049">[</span><span class="op" id="3094050">]</span><span class="builtintype" id="3094051">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094057">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3094070">io</span><span class="op" id="3094072">.</span><span class="ident" id="3094073">Reader</span>&nbsp;<span class="comment" id="3094080">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094114">r</span><span class="op" id="3094115">,</span>&nbsp;<span class="ident" id="3094117">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3094127">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3094137">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094170">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3094183">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094190">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3094203">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094208">lastRuneSize</span>&nbsp;<span class="builtintype" id="3094221">int</span><br>
<span class="lineno"></span><span class="op" id="3094225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3094228">const</span>&nbsp;<span class="ident" id="3094234">minReadBufferSize</span>&nbsp;<span class="op" id="3094252">=</span>&nbsp;<span class="num" id="3094254">16</span><br>
<span class="lineno"></span><span class="keyword" id="3094257">const</span>&nbsp;<span class="ident" id="3094263">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3094288">=</span>&nbsp;<span class="num" id="3094290">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3094295">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3094373">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="3094446">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="3094489">func</span>&nbsp;<span class="ident" id="3094494">NewReaderSize</span><span class="op" id="3094507">(</span><span class="ident" id="3094508">rd</span>&nbsp;<span class="ident" id="3094511">io</span><span class="op" id="3094513">.</span><span class="ident" id="3094514">Reader</span><span class="op" id="3094520">,</span>&nbsp;<span class="ident" id="3094522">size</span>&nbsp;<span class="builtintype" id="3094527">int</span><span class="op" id="3094530">)</span>&nbsp;<span class="op" id="3094532">*</span><span class="ident" id="3094533">Reader</span>&nbsp;<span class="op" id="3094540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3094543">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094571">b</span><span class="op" id="3094572">,</span>&nbsp;<span class="ident" id="3094574">ok</span>&nbsp;<span class="op" id="3094577">:=</span>&nbsp;<span class="ident" id="3094580">rd</span><span class="op" id="3094582">.</span><span class="op" id="3094583">(</span><span class="op" id="3094584">*</span><span class="ident" id="3094585">Reader</span><span class="op" id="3094591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094594">if</span>&nbsp;<span class="ident" id="3094597">ok</span>&nbsp;<span class="op" id="3094600">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3094603">len</span><span class="op" id="3094606">(</span><span class="ident" id="3094607">b</span><span class="op" id="3094608">.</span><span class="ident" id="3094609">buf</span><span class="op" id="3094612">)</span>&nbsp;<span class="op" id="3094614">&gt;=</span>&nbsp;<span class="ident" id="3094617">size</span>&nbsp;<span class="op" id="3094622">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094626">return</span>&nbsp;<span class="ident" id="3094633">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094639">if</span>&nbsp;<span class="ident" id="3094642">size</span>&nbsp;<span class="op" id="3094647">&lt;</span>&nbsp;<span class="ident" id="3094649">minReadBufferSize</span>&nbsp;<span class="op" id="3094667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094671">size</span>&nbsp;<span class="op" id="3094676">=</span>&nbsp;<span class="ident" id="3094678">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094697">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094700">r</span>&nbsp;<span class="op" id="3094702">:=</span>&nbsp;<span class="builtinfunc" id="3094705">new</span><span class="op" id="3094708">(</span><span class="ident" id="3094709">Reader</span><span class="op" id="3094715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094718">r</span><span class="op" id="3094719">.</span><span class="ident" id="3094720">reset</span><span class="op" id="3094725">(</span><span class="builtinfunc" id="3094726">make</span><span class="op" id="3094730">(</span><span class="op" id="3094731">[</span><span class="op" id="3094732">]</span><span class="builtintype" id="3094733">byte</span><span class="op" id="3094737">,</span>&nbsp;<span class="ident" id="3094739">size</span><span class="op" id="3094743">)</span><span class="op" id="3094744">,</span>&nbsp;<span class="ident" id="3094746">rd</span><span class="op" id="3094748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094751">return</span>&nbsp;<span class="ident" id="3094758">r</span><br>
<span class="lineno"></span><span class="op" id="3094760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3094763">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3094832">func</span>&nbsp;<span class="ident" id="3094837">NewReader</span><span class="op" id="3094846">(</span><span class="ident" id="3094847">rd</span>&nbsp;<span class="ident" id="3094850">io</span><span class="op" id="3094852">.</span><span class="ident" id="3094853">Reader</span><span class="op" id="3094859">)</span>&nbsp;<span class="op" id="3094861">*</span><span class="ident" id="3094862">Reader</span>&nbsp;<span class="op" id="3094869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094872">return</span>&nbsp;<span class="ident" id="3094879">NewReaderSize</span><span class="op" id="3094892">(</span><span class="ident" id="3094893">rd</span><span class="op" id="3094895">,</span>&nbsp;<span class="ident" id="3094897">defaultBufSize</span><span class="op" id="3094911">)</span><br>
<span class="lineno"></span><span class="op" id="3094913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3094916">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="3094984">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3095023">func</span>&nbsp;<span class="op" id="3095028">(</span><span class="ident" id="3095029">b</span>&nbsp;<span class="op" id="3095031">*</span><span class="ident" id="3095032">Reader</span><span class="op" id="3095038">)</span>&nbsp;<span class="ident" id="3095040">Reset</span><span class="op" id="3095045">(</span><span class="ident" id="3095046">r</span>&nbsp;<span class="ident" id="3095048">io</span><span class="op" id="3095050">.</span><span class="ident" id="3095051">Reader</span><span class="op" id="3095057">)</span>&nbsp;<span class="op" id="3095059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095062">b</span><span class="op" id="3095063">.</span><span class="ident" id="3095064">reset</span><span class="op" id="3095069">(</span><span class="ident" id="3095070">b</span><span class="op" id="3095071">.</span><span class="ident" id="3095072">buf</span><span class="op" id="3095075">,</span>&nbsp;<span class="ident" id="3095077">r</span><span class="op" id="3095078">)</span><br>
<span class="lineno"></span><span class="op" id="3095080">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3095083">func</span>&nbsp;<span class="op" id="3095088">(</span><span class="ident" id="3095089">b</span>&nbsp;<span class="op" id="3095091">*</span><span class="ident" id="3095092">Reader</span><span class="op" id="3095098">)</span>&nbsp;<span class="ident" id="3095100">reset</span><span class="op" id="3095105">(</span><span class="ident" id="3095106">buf</span>&nbsp;<span class="op" id="3095110">[</span><span class="op" id="3095111">]</span><span class="builtintype" id="3095112">byte</span><span class="op" id="3095116">,</span>&nbsp;<span class="ident" id="3095118">r</span>&nbsp;<span class="ident" id="3095120">io</span><span class="op" id="3095122">.</span><span class="ident" id="3095123">Reader</span><span class="op" id="3095129">)</span>&nbsp;<span class="op" id="3095131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095134">*</span><span class="ident" id="3095135">b</span>&nbsp;<span class="op" id="3095137">=</span>&nbsp;<span class="ident" id="3095139">Reader</span><span class="op" id="3095145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095149">buf</span><span class="op" id="3095152">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3095163">buf</span><span class="op" id="3095166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095170">rd</span><span class="op" id="3095172">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3095184">r</span><span class="op" id="3095185">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095189">lastByte</span><span class="op" id="3095197">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3095203">-</span><span class="num" id="3095204">1</span><span class="op" id="3095205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095209">lastRuneSize</span><span class="op" id="3095221">:</span>&nbsp;<span class="op" id="3095223">-</span><span class="num" id="3095224">1</span><span class="op" id="3095225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095228">}</span><br>
<span class="lineno"></span><span class="op" id="3095230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3095233">var</span>&nbsp;<span class="ident" id="3095237">errNegativeRead</span>&nbsp;<span class="op" id="3095253">=</span>&nbsp;<span class="ident" id="3095255">errors</span><span class="op" id="3095261">.</span><span class="ident" id="3095262">New</span><span class="op" id="3095265">(</span><span class="string" id="3095266">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="3095315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3095318">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3095361">func</span>&nbsp;<span class="op" id="3095366">(</span><span class="ident" id="3095367">b</span>&nbsp;<span class="op" id="3095369">*</span><span class="ident" id="3095370">Reader</span><span class="op" id="3095376">)</span>&nbsp;<span class="ident" id="3095378">fill</span><span class="op" id="3095382">(</span><span class="op" id="3095383">)</span>&nbsp;<span class="op" id="3095385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3095388">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095426">if</span>&nbsp;<span class="ident" id="3095429">b</span><span class="op" id="3095430">.</span><span class="ident" id="3095431">r</span>&nbsp;<span class="op" id="3095433">&gt;</span>&nbsp;<span class="num" id="3095435">0</span>&nbsp;<span class="op" id="3095437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3095441">copy</span><span class="op" id="3095445">(</span><span class="ident" id="3095446">b</span><span class="op" id="3095447">.</span><span class="ident" id="3095448">buf</span><span class="op" id="3095451">,</span>&nbsp;<span class="ident" id="3095453">b</span><span class="op" id="3095454">.</span><span class="ident" id="3095455">buf</span><span class="op" id="3095458">[</span><span class="ident" id="3095459">b</span><span class="op" id="3095460">.</span><span class="ident" id="3095461">r</span><span class="op" id="3095462">:</span><span class="ident" id="3095463">b</span><span class="op" id="3095464">.</span><span class="ident" id="3095465">w</span><span class="op" id="3095466">]</span><span class="op" id="3095467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095471">b</span><span class="op" id="3095472">.</span><span class="ident" id="3095473">w</span>&nbsp;<span class="op" id="3095475">-=</span>&nbsp;<span class="ident" id="3095478">b</span><span class="op" id="3095479">.</span><span class="ident" id="3095480">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095484">b</span><span class="op" id="3095485">.</span><span class="ident" id="3095486">r</span>&nbsp;<span class="op" id="3095488">=</span>&nbsp;<span class="num" id="3095490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095493">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095497">if</span>&nbsp;<span class="ident" id="3095500">b</span><span class="op" id="3095501">.</span><span class="ident" id="3095502">w</span>&nbsp;<span class="op" id="3095504">&gt;=</span>&nbsp;<span class="builtinfunc" id="3095507">len</span><span class="op" id="3095510">(</span><span class="ident" id="3095511">b</span><span class="op" id="3095512">.</span><span class="ident" id="3095513">buf</span><span class="op" id="3095516">)</span>&nbsp;<span class="op" id="3095518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3095522">panic</span><span class="op" id="3095527">(</span><span class="string" id="3095528">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="3095562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3095569">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095619">for</span>&nbsp;<span class="ident" id="3095623">i</span>&nbsp;<span class="op" id="3095625">:=</span>&nbsp;<span class="ident" id="3095628">maxConsecutiveEmptyReads</span><span class="op" id="3095652">;</span>&nbsp;<span class="ident" id="3095654">i</span>&nbsp;<span class="op" id="3095656">&gt;</span>&nbsp;<span class="num" id="3095658">0</span><span class="op" id="3095659">;</span>&nbsp;<span class="ident" id="3095661">i</span><span class="op" id="3095662">--</span>&nbsp;<span class="op" id="3095665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095669">n</span><span class="op" id="3095670">,</span>&nbsp;<span class="ident" id="3095672">err</span>&nbsp;<span class="op" id="3095676">:=</span>&nbsp;<span class="ident" id="3095679">b</span><span class="op" id="3095680">.</span><span class="ident" id="3095681">rd</span><span class="op" id="3095683">.</span><span class="ident" id="3095684">Read</span><span class="op" id="3095688">(</span><span class="ident" id="3095689">b</span><span class="op" id="3095690">.</span><span class="ident" id="3095691">buf</span><span class="op" id="3095694">[</span><span class="ident" id="3095695">b</span><span class="op" id="3095696">.</span><span class="ident" id="3095697">w</span><span class="op" id="3095698">:</span><span class="op" id="3095699">]</span><span class="op" id="3095700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095704">if</span>&nbsp;<span class="ident" id="3095707">n</span>&nbsp;<span class="op" id="3095709">&lt;</span>&nbsp;<span class="num" id="3095711">0</span>&nbsp;<span class="op" id="3095713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3095718">panic</span><span class="op" id="3095723">(</span><span class="ident" id="3095724">errNegativeRead</span><span class="op" id="3095739">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095747">b</span><span class="op" id="3095748">.</span><span class="ident" id="3095749">w</span>&nbsp;<span class="op" id="3095751">+=</span>&nbsp;<span class="ident" id="3095754">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095758">if</span>&nbsp;<span class="ident" id="3095761">err</span>&nbsp;<span class="op" id="3095765">!=</span>&nbsp;<span class="ident" id="3095768">nil</span>&nbsp;<span class="op" id="3095772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095777">b</span><span class="op" id="3095778">.</span><span class="ident" id="3095779">err</span>&nbsp;<span class="op" id="3095783">=</span>&nbsp;<span class="ident" id="3095785">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095792">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095805">if</span>&nbsp;<span class="ident" id="3095808">n</span>&nbsp;<span class="op" id="3095810">&gt;</span>&nbsp;<span class="num" id="3095812">0</span>&nbsp;<span class="op" id="3095814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095819">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095831">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095834">b</span><span class="op" id="3095835">.</span><span class="ident" id="3095836">err</span>&nbsp;<span class="op" id="3095840">=</span>&nbsp;<span class="ident" id="3095842">io</span><span class="op" id="3095844">.</span><span class="ident" id="3095845">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="3095859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3095862">func</span>&nbsp;<span class="op" id="3095867">(</span><span class="ident" id="3095868">b</span>&nbsp;<span class="op" id="3095870">*</span><span class="ident" id="3095871">Reader</span><span class="op" id="3095877">)</span>&nbsp;<span class="ident" id="3095879">readErr</span><span class="op" id="3095886">(</span><span class="op" id="3095887">)</span>&nbsp;<span class="builtintype" id="3095889">error</span>&nbsp;<span class="op" id="3095895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095898">err</span>&nbsp;<span class="op" id="3095902">:=</span>&nbsp;<span class="ident" id="3095905">b</span><span class="op" id="3095906">.</span><span class="ident" id="3095907">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095912">b</span><span class="op" id="3095913">.</span><span class="ident" id="3095914">err</span>&nbsp;<span class="op" id="3095918">=</span>&nbsp;<span class="ident" id="3095920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095925">return</span>&nbsp;<span class="ident" id="3095932">err</span><br>
<span class="lineno"></span><span class="op" id="3095936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3095939">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="3096017">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3096094">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3096166">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3096220">func</span>&nbsp;<span class="op" id="3096225">(</span><span class="ident" id="3096226">b</span>&nbsp;<span class="op" id="3096228">*</span><span class="ident" id="3096229">Reader</span><span class="op" id="3096235">)</span>&nbsp;<span class="ident" id="3096237">Peek</span><span class="op" id="3096241">(</span><span class="ident" id="3096242">n</span>&nbsp;<span class="builtintype" id="3096244">int</span><span class="op" id="3096247">)</span>&nbsp;<span class="op" id="3096249">(</span><span class="op" id="3096250">[</span><span class="op" id="3096251">]</span><span class="builtintype" id="3096252">byte</span><span class="op" id="3096256">,</span>&nbsp;<span class="builtintype" id="3096258">error</span><span class="op" id="3096263">)</span>&nbsp;<span class="op" id="3096265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096268">if</span>&nbsp;<span class="ident" id="3096271">n</span>&nbsp;<span class="op" id="3096273">&lt;</span>&nbsp;<span class="num" id="3096275">0</span>&nbsp;<span class="op" id="3096277">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096281">return</span>&nbsp;<span class="ident" id="3096288">nil</span><span class="op" id="3096291">,</span>&nbsp;<span class="ident" id="3096293">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096314">if</span>&nbsp;<span class="ident" id="3096317">n</span>&nbsp;<span class="op" id="3096319">&gt;</span>&nbsp;<span class="builtinfunc" id="3096321">len</span><span class="op" id="3096324">(</span><span class="ident" id="3096325">b</span><span class="op" id="3096326">.</span><span class="ident" id="3096327">buf</span><span class="op" id="3096330">)</span>&nbsp;<span class="op" id="3096332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096336">return</span>&nbsp;<span class="ident" id="3096343">nil</span><span class="op" id="3096346">,</span>&nbsp;<span class="ident" id="3096348">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096363">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096366">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096391">for</span>&nbsp;<span class="ident" id="3096395">b</span><span class="op" id="3096396">.</span><span class="ident" id="3096397">w</span><span class="op" id="3096398">-</span><span class="ident" id="3096399">b</span><span class="op" id="3096400">.</span><span class="ident" id="3096401">r</span>&nbsp;<span class="op" id="3096403">&lt;</span>&nbsp;<span class="ident" id="3096405">n</span>&nbsp;<span class="op" id="3096407">&amp;&amp;</span>&nbsp;<span class="ident" id="3096410">b</span><span class="op" id="3096411">.</span><span class="ident" id="3096412">err</span>&nbsp;<span class="op" id="3096416">==</span>&nbsp;<span class="ident" id="3096419">nil</span>&nbsp;<span class="op" id="3096423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096427">b</span><span class="op" id="3096428">.</span><span class="ident" id="3096429">fill</span><span class="op" id="3096433">(</span><span class="op" id="3096434">)</span>&nbsp;<span class="comment" id="3096436">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096487">var</span>&nbsp;<span class="ident" id="3096491">err</span>&nbsp;<span class="builtintype" id="3096495">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096502">if</span>&nbsp;<span class="ident" id="3096505">avail</span>&nbsp;<span class="op" id="3096511">:=</span>&nbsp;<span class="ident" id="3096514">b</span><span class="op" id="3096515">.</span><span class="ident" id="3096516">w</span>&nbsp;<span class="op" id="3096518">-</span>&nbsp;<span class="ident" id="3096520">b</span><span class="op" id="3096521">.</span><span class="ident" id="3096522">r</span><span class="op" id="3096523">;</span>&nbsp;<span class="ident" id="3096525">avail</span>&nbsp;<span class="op" id="3096531">&lt;</span>&nbsp;<span class="ident" id="3096533">n</span>&nbsp;<span class="op" id="3096535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096539">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096570">n</span>&nbsp;<span class="op" id="3096572">=</span>&nbsp;<span class="ident" id="3096574">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096582">err</span>&nbsp;<span class="op" id="3096586">=</span>&nbsp;<span class="ident" id="3096588">b</span><span class="op" id="3096589">.</span><span class="ident" id="3096590">readErr</span><span class="op" id="3096597">(</span><span class="op" id="3096598">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096602">if</span>&nbsp;<span class="ident" id="3096605">err</span>&nbsp;<span class="op" id="3096609">==</span>&nbsp;<span class="ident" id="3096612">nil</span>&nbsp;<span class="op" id="3096616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096621">err</span>&nbsp;<span class="op" id="3096625">=</span>&nbsp;<span class="ident" id="3096627">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096649">return</span>&nbsp;<span class="ident" id="3096656">b</span><span class="op" id="3096657">.</span><span class="ident" id="3096658">buf</span><span class="op" id="3096661">[</span><span class="ident" id="3096662">b</span><span class="op" id="3096663">.</span><span class="ident" id="3096664">r</span>&nbsp;<span class="op" id="3096666">:</span>&nbsp;<span class="ident" id="3096668">b</span><span class="op" id="3096669">.</span><span class="ident" id="3096670">r</span><span class="op" id="3096671">+</span><span class="ident" id="3096672">n</span><span class="op" id="3096673">]</span><span class="op" id="3096674">,</span>&nbsp;<span class="ident" id="3096676">err</span><br>
<span class="lineno">145</span><span class="op" id="3096680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3096683">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3096710">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3096757">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="3096813">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="3096849">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3096907">func</span>&nbsp;<span class="op" id="3096912">(</span><span class="ident" id="3096913">b</span>&nbsp;<span class="op" id="3096915">*</span><span class="ident" id="3096916">Reader</span><span class="op" id="3096922">)</span>&nbsp;<span class="ident" id="3096924">Read</span><span class="op" id="3096928">(</span><span class="ident" id="3096929">p</span>&nbsp;<span class="op" id="3096931">[</span><span class="op" id="3096932">]</span><span class="builtintype" id="3096933">byte</span><span class="op" id="3096937">)</span>&nbsp;<span class="op" id="3096939">(</span><span class="ident" id="3096940">n</span>&nbsp;<span class="builtintype" id="3096942">int</span><span class="op" id="3096945">,</span>&nbsp;<span class="ident" id="3096947">err</span>&nbsp;<span class="builtintype" id="3096951">error</span><span class="op" id="3096956">)</span>&nbsp;<span class="op" id="3096958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096961">n</span>&nbsp;<span class="op" id="3096963">=</span>&nbsp;<span class="builtinfunc" id="3096965">len</span><span class="op" id="3096968">(</span><span class="ident" id="3096969">p</span><span class="op" id="3096970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096973">if</span>&nbsp;<span class="ident" id="3096976">n</span>&nbsp;<span class="op" id="3096978">==</span>&nbsp;<span class="num" id="3096981">0</span>&nbsp;<span class="op" id="3096983">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096987">return</span>&nbsp;<span class="num" id="3096994">0</span><span class="op" id="3096995">,</span>&nbsp;<span class="ident" id="3096997">b</span><span class="op" id="3096998">.</span><span class="ident" id="3096999">readErr</span><span class="op" id="3097006">(</span><span class="op" id="3097007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097013">if</span>&nbsp;<span class="ident" id="3097016">b</span><span class="op" id="3097017">.</span><span class="ident" id="3097018">r</span>&nbsp;<span class="op" id="3097020">==</span>&nbsp;<span class="ident" id="3097023">b</span><span class="op" id="3097024">.</span><span class="ident" id="3097025">w</span>&nbsp;<span class="op" id="3097027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097031">if</span>&nbsp;<span class="ident" id="3097034">b</span><span class="op" id="3097035">.</span><span class="ident" id="3097036">err</span>&nbsp;<span class="op" id="3097040">!=</span>&nbsp;<span class="ident" id="3097043">nil</span>&nbsp;<span class="op" id="3097047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097052">return</span>&nbsp;<span class="num" id="3097059">0</span><span class="op" id="3097060">,</span>&nbsp;<span class="ident" id="3097062">b</span><span class="op" id="3097063">.</span><span class="ident" id="3097064">readErr</span><span class="op" id="3097071">(</span><span class="op" id="3097072">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097080">if</span>&nbsp;<span class="builtinfunc" id="3097083">len</span><span class="op" id="3097086">(</span><span class="ident" id="3097087">p</span><span class="op" id="3097088">)</span>&nbsp;<span class="op" id="3097090">&gt;=</span>&nbsp;<span class="builtinfunc" id="3097093">len</span><span class="op" id="3097096">(</span><span class="ident" id="3097097">b</span><span class="op" id="3097098">.</span><span class="ident" id="3097099">buf</span><span class="op" id="3097102">)</span>&nbsp;<span class="op" id="3097104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3097109">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3097141">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097183">n</span><span class="op" id="3097184">,</span>&nbsp;<span class="ident" id="3097186">b</span><span class="op" id="3097187">.</span><span class="ident" id="3097188">err</span>&nbsp;<span class="op" id="3097192">=</span>&nbsp;<span class="ident" id="3097194">b</span><span class="op" id="3097195">.</span><span class="ident" id="3097196">rd</span><span class="op" id="3097198">.</span><span class="ident" id="3097199">Read</span><span class="op" id="3097203">(</span><span class="ident" id="3097204">p</span><span class="op" id="3097205">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097210">if</span>&nbsp;<span class="ident" id="3097213">n</span>&nbsp;<span class="op" id="3097215">&lt;</span>&nbsp;<span class="num" id="3097217">0</span>&nbsp;<span class="op" id="3097219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3097225">panic</span><span class="op" id="3097230">(</span><span class="ident" id="3097231">errNegativeRead</span><span class="op" id="3097246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097256">if</span>&nbsp;<span class="ident" id="3097259">n</span>&nbsp;<span class="op" id="3097261">&gt;</span>&nbsp;<span class="num" id="3097263">0</span>&nbsp;<span class="op" id="3097265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097271">b</span><span class="op" id="3097272">.</span><span class="ident" id="3097273">lastByte</span>&nbsp;<span class="op" id="3097282">=</span>&nbsp;<span class="builtintype" id="3097284">int</span><span class="op" id="3097287">(</span><span class="ident" id="3097288">p</span><span class="op" id="3097289">[</span><span class="ident" id="3097290">n</span><span class="op" id="3097291">-</span><span class="num" id="3097292">1</span><span class="op" id="3097293">]</span><span class="op" id="3097294">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097300">b</span><span class="op" id="3097301">.</span><span class="ident" id="3097302">lastRuneSize</span>&nbsp;<span class="op" id="3097315">=</span>&nbsp;<span class="op" id="3097317">-</span><span class="num" id="3097318">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097328">return</span>&nbsp;<span class="ident" id="3097335">n</span><span class="op" id="3097336">,</span>&nbsp;<span class="ident" id="3097338">b</span><span class="op" id="3097339">.</span><span class="ident" id="3097340">readErr</span><span class="op" id="3097347">(</span><span class="op" id="3097348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097356">b</span><span class="op" id="3097357">.</span><span class="ident" id="3097358">fill</span><span class="op" id="3097362">(</span><span class="op" id="3097363">)</span>&nbsp;<span class="comment" id="3097365">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097386">if</span>&nbsp;<span class="ident" id="3097389">b</span><span class="op" id="3097390">.</span><span class="ident" id="3097391">r</span>&nbsp;<span class="op" id="3097393">==</span>&nbsp;<span class="ident" id="3097396">b</span><span class="op" id="3097397">.</span><span class="ident" id="3097398">w</span>&nbsp;<span class="op" id="3097400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097405">return</span>&nbsp;<span class="num" id="3097412">0</span><span class="op" id="3097413">,</span>&nbsp;<span class="ident" id="3097415">b</span><span class="op" id="3097416">.</span><span class="ident" id="3097417">readErr</span><span class="op" id="3097424">(</span><span class="op" id="3097425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3097436">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097463">n</span>&nbsp;<span class="op" id="3097465">=</span>&nbsp;<span class="builtinfunc" id="3097467">copy</span><span class="op" id="3097471">(</span><span class="ident" id="3097472">p</span><span class="op" id="3097473">,</span>&nbsp;<span class="ident" id="3097475">b</span><span class="op" id="3097476">.</span><span class="ident" id="3097477">buf</span><span class="op" id="3097480">[</span><span class="ident" id="3097481">b</span><span class="op" id="3097482">.</span><span class="ident" id="3097483">r</span><span class="op" id="3097484">:</span><span class="ident" id="3097485">b</span><span class="op" id="3097486">.</span><span class="ident" id="3097487">w</span><span class="op" id="3097488">]</span><span class="op" id="3097489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097492">b</span><span class="op" id="3097493">.</span><span class="ident" id="3097494">r</span>&nbsp;<span class="op" id="3097496">+=</span>&nbsp;<span class="ident" id="3097499">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097502">b</span><span class="op" id="3097503">.</span><span class="ident" id="3097504">lastByte</span>&nbsp;<span class="op" id="3097513">=</span>&nbsp;<span class="builtintype" id="3097515">int</span><span class="op" id="3097518">(</span><span class="ident" id="3097519">b</span><span class="op" id="3097520">.</span><span class="ident" id="3097521">buf</span><span class="op" id="3097524">[</span><span class="ident" id="3097525">b</span><span class="op" id="3097526">.</span><span class="ident" id="3097527">r</span><span class="op" id="3097528">-</span><span class="num" id="3097529">1</span><span class="op" id="3097530">]</span><span class="op" id="3097531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097534">b</span><span class="op" id="3097535">.</span><span class="ident" id="3097536">lastRuneSize</span>&nbsp;<span class="op" id="3097549">=</span>&nbsp;<span class="op" id="3097551">-</span><span class="num" id="3097552">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097555">return</span>&nbsp;<span class="ident" id="3097562">n</span><span class="op" id="3097563">,</span>&nbsp;<span class="ident" id="3097565">nil</span><br>
<span class="lineno"></span><span class="op" id="3097569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3097572">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="3097617">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="3097663">func</span>&nbsp;<span class="op" id="3097668">(</span><span class="ident" id="3097669">b</span>&nbsp;<span class="op" id="3097671">*</span><span class="ident" id="3097672">Reader</span><span class="op" id="3097678">)</span>&nbsp;<span class="ident" id="3097680">ReadByte</span><span class="op" id="3097688">(</span><span class="op" id="3097689">)</span>&nbsp;<span class="op" id="3097691">(</span><span class="ident" id="3097692">c</span>&nbsp;<span class="builtintype" id="3097694">byte</span><span class="op" id="3097698">,</span>&nbsp;<span class="ident" id="3097700">err</span>&nbsp;<span class="builtintype" id="3097704">error</span><span class="op" id="3097709">)</span>&nbsp;<span class="op" id="3097711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097714">b</span><span class="op" id="3097715">.</span><span class="ident" id="3097716">lastRuneSize</span>&nbsp;<span class="op" id="3097729">=</span>&nbsp;<span class="op" id="3097731">-</span><span class="num" id="3097732">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097735">for</span>&nbsp;<span class="ident" id="3097739">b</span><span class="op" id="3097740">.</span><span class="ident" id="3097741">r</span>&nbsp;<span class="op" id="3097743">==</span>&nbsp;<span class="ident" id="3097746">b</span><span class="op" id="3097747">.</span><span class="ident" id="3097748">w</span>&nbsp;<span class="op" id="3097750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097754">if</span>&nbsp;<span class="ident" id="3097757">b</span><span class="op" id="3097758">.</span><span class="ident" id="3097759">err</span>&nbsp;<span class="op" id="3097763">!=</span>&nbsp;<span class="ident" id="3097766">nil</span>&nbsp;<span class="op" id="3097770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097775">return</span>&nbsp;<span class="num" id="3097782">0</span><span class="op" id="3097783">,</span>&nbsp;<span class="ident" id="3097785">b</span><span class="op" id="3097786">.</span><span class="ident" id="3097787">readErr</span><span class="op" id="3097794">(</span><span class="op" id="3097795">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097803">b</span><span class="op" id="3097804">.</span><span class="ident" id="3097805">fill</span><span class="op" id="3097809">(</span><span class="op" id="3097810">)</span>&nbsp;<span class="comment" id="3097812">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097835">c</span>&nbsp;<span class="op" id="3097837">=</span>&nbsp;<span class="ident" id="3097839">b</span><span class="op" id="3097840">.</span><span class="ident" id="3097841">buf</span><span class="op" id="3097844">[</span><span class="ident" id="3097845">b</span><span class="op" id="3097846">.</span><span class="ident" id="3097847">r</span><span class="op" id="3097848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097851">b</span><span class="op" id="3097852">.</span><span class="ident" id="3097853">r</span><span class="op" id="3097854">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097858">b</span><span class="op" id="3097859">.</span><span class="ident" id="3097860">lastByte</span>&nbsp;<span class="op" id="3097869">=</span>&nbsp;<span class="builtintype" id="3097871">int</span><span class="op" id="3097874">(</span><span class="ident" id="3097875">c</span><span class="op" id="3097876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097879">return</span>&nbsp;<span class="ident" id="3097886">c</span><span class="op" id="3097887">,</span>&nbsp;<span class="ident" id="3097889">nil</span><br>
<span class="lineno"></span><span class="op" id="3097893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3097896">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="3097982">func</span>&nbsp;<span class="op" id="3097987">(</span><span class="ident" id="3097988">b</span>&nbsp;<span class="op" id="3097990">*</span><span class="ident" id="3097991">Reader</span><span class="op" id="3097997">)</span>&nbsp;<span class="ident" id="3097999">UnreadByte</span><span class="op" id="3098009">(</span><span class="op" id="3098010">)</span>&nbsp;<span class="builtintype" id="3098012">error</span>&nbsp;<span class="op" id="3098018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098021">if</span>&nbsp;<span class="ident" id="3098024">b</span><span class="op" id="3098025">.</span><span class="ident" id="3098026">lastByte</span>&nbsp;<span class="op" id="3098035">&lt;</span>&nbsp;<span class="num" id="3098037">0</span>&nbsp;<span class="op" id="3098039">||</span>&nbsp;<span class="ident" id="3098042">b</span><span class="op" id="3098043">.</span><span class="ident" id="3098044">r</span>&nbsp;<span class="op" id="3098046">==</span>&nbsp;<span class="num" id="3098049">0</span>&nbsp;<span class="op" id="3098051">&amp;&amp;</span>&nbsp;<span class="ident" id="3098054">b</span><span class="op" id="3098055">.</span><span class="ident" id="3098056">w</span>&nbsp;<span class="op" id="3098058">&gt;</span>&nbsp;<span class="num" id="3098060">0</span>&nbsp;<span class="op" id="3098062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098066">return</span>&nbsp;<span class="ident" id="3098073">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098098">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098122">if</span>&nbsp;<span class="ident" id="3098125">b</span><span class="op" id="3098126">.</span><span class="ident" id="3098127">r</span>&nbsp;<span class="op" id="3098129">&gt;</span>&nbsp;<span class="num" id="3098131">0</span>&nbsp;<span class="op" id="3098133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098137">b</span><span class="op" id="3098138">.</span><span class="ident" id="3098139">r</span><span class="op" id="3098140">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098144">}</span>&nbsp;<span class="keyword" id="3098146">else</span>&nbsp;<span class="op" id="3098151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098155">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098181">b</span><span class="op" id="3098182">.</span><span class="ident" id="3098183">w</span>&nbsp;<span class="op" id="3098185">=</span>&nbsp;<span class="num" id="3098187">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098193">b</span><span class="op" id="3098194">.</span><span class="ident" id="3098195">buf</span><span class="op" id="3098198">[</span><span class="ident" id="3098199">b</span><span class="op" id="3098200">.</span><span class="ident" id="3098201">r</span><span class="op" id="3098202">]</span>&nbsp;<span class="op" id="3098204">=</span>&nbsp;<span class="builtintype" id="3098206">byte</span><span class="op" id="3098210">(</span><span class="ident" id="3098211">b</span><span class="op" id="3098212">.</span><span class="ident" id="3098213">lastByte</span><span class="op" id="3098221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098224">b</span><span class="op" id="3098225">.</span><span class="ident" id="3098226">lastByte</span>&nbsp;<span class="op" id="3098235">=</span>&nbsp;<span class="op" id="3098237">-</span><span class="num" id="3098238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098241">b</span><span class="op" id="3098242">.</span><span class="ident" id="3098243">lastRuneSize</span>&nbsp;<span class="op" id="3098256">=</span>&nbsp;<span class="op" id="3098258">-</span><span class="num" id="3098259">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098262">return</span>&nbsp;<span class="ident" id="3098269">nil</span><br>
<span class="lineno">220</span><span class="op" id="3098273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3098276">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3098351">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3098435">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="3098501">func</span>&nbsp;<span class="op" id="3098506">(</span><span class="ident" id="3098507">b</span>&nbsp;<span class="op" id="3098509">*</span><span class="ident" id="3098510">Reader</span><span class="op" id="3098516">)</span>&nbsp;<span class="ident" id="3098518">ReadRune</span><span class="op" id="3098526">(</span><span class="op" id="3098527">)</span>&nbsp;<span class="op" id="3098529">(</span><span class="ident" id="3098530">r</span>&nbsp;<span class="builtintype" id="3098532">rune</span><span class="op" id="3098536">,</span>&nbsp;<span class="ident" id="3098538">size</span>&nbsp;<span class="builtintype" id="3098543">int</span><span class="op" id="3098546">,</span>&nbsp;<span class="ident" id="3098548">err</span>&nbsp;<span class="builtintype" id="3098552">error</span><span class="op" id="3098557">)</span>&nbsp;<span class="op" id="3098559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098562">for</span>&nbsp;<span class="ident" id="3098566">b</span><span class="op" id="3098567">.</span><span class="ident" id="3098568">r</span><span class="op" id="3098569">+</span><span class="ident" id="3098570">utf8</span><span class="op" id="3098574">.</span><span class="ident" id="3098575">UTFMax</span>&nbsp;<span class="op" id="3098582">&gt;</span>&nbsp;<span class="ident" id="3098584">b</span><span class="op" id="3098585">.</span><span class="ident" id="3098586">w</span>&nbsp;<span class="op" id="3098588">&amp;&amp;</span>&nbsp;<span class="op" id="3098591">!</span><span class="ident" id="3098592">utf8</span><span class="op" id="3098596">.</span><span class="ident" id="3098597">FullRune</span><span class="op" id="3098605">(</span><span class="ident" id="3098606">b</span><span class="op" id="3098607">.</span><span class="ident" id="3098608">buf</span><span class="op" id="3098611">[</span><span class="ident" id="3098612">b</span><span class="op" id="3098613">.</span><span class="ident" id="3098614">r</span><span class="op" id="3098615">:</span><span class="ident" id="3098616">b</span><span class="op" id="3098617">.</span><span class="ident" id="3098618">w</span><span class="op" id="3098619">]</span><span class="op" id="3098620">)</span>&nbsp;<span class="op" id="3098622">&amp;&amp;</span>&nbsp;<span class="ident" id="3098625">b</span><span class="op" id="3098626">.</span><span class="ident" id="3098627">err</span>&nbsp;<span class="op" id="3098631">==</span>&nbsp;<span class="ident" id="3098634">nil</span>&nbsp;<span class="op" id="3098638">&amp;&amp;</span>&nbsp;<span class="ident" id="3098641">b</span><span class="op" id="3098642">.</span><span class="ident" id="3098643">w</span><span class="op" id="3098644">-</span><span class="ident" id="3098645">b</span><span class="op" id="3098646">.</span><span class="ident" id="3098647">r</span>&nbsp;<span class="op" id="3098649">&lt;</span>&nbsp;<span class="builtinfunc" id="3098651">len</span><span class="op" id="3098654">(</span><span class="ident" id="3098655">b</span><span class="op" id="3098656">.</span><span class="ident" id="3098657">buf</span><span class="op" id="3098660">)</span>&nbsp;<span class="op" id="3098662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098666">b</span><span class="op" id="3098667">.</span><span class="ident" id="3098668">fill</span><span class="op" id="3098672">(</span><span class="op" id="3098673">)</span>&nbsp;<span class="comment" id="3098675">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098723">b</span><span class="op" id="3098724">.</span><span class="ident" id="3098725">lastRuneSize</span>&nbsp;<span class="op" id="3098738">=</span>&nbsp;<span class="op" id="3098740">-</span><span class="num" id="3098741">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098744">if</span>&nbsp;<span class="ident" id="3098747">b</span><span class="op" id="3098748">.</span><span class="ident" id="3098749">r</span>&nbsp;<span class="op" id="3098751">==</span>&nbsp;<span class="ident" id="3098754">b</span><span class="op" id="3098755">.</span><span class="ident" id="3098756">w</span>&nbsp;<span class="op" id="3098758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098762">return</span>&nbsp;<span class="num" id="3098769">0</span><span class="op" id="3098770">,</span>&nbsp;<span class="num" id="3098772">0</span><span class="op" id="3098773">,</span>&nbsp;<span class="ident" id="3098775">b</span><span class="op" id="3098776">.</span><span class="ident" id="3098777">readErr</span><span class="op" id="3098784">(</span><span class="op" id="3098785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098791">r</span><span class="op" id="3098792">,</span>&nbsp;<span class="ident" id="3098794">size</span>&nbsp;<span class="op" id="3098799">=</span>&nbsp;<span class="builtintype" id="3098801">rune</span><span class="op" id="3098805">(</span><span class="ident" id="3098806">b</span><span class="op" id="3098807">.</span><span class="ident" id="3098808">buf</span><span class="op" id="3098811">[</span><span class="ident" id="3098812">b</span><span class="op" id="3098813">.</span><span class="ident" id="3098814">r</span><span class="op" id="3098815">]</span><span class="op" id="3098816">)</span><span class="op" id="3098817">,</span>&nbsp;<span class="num" id="3098819">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098822">if</span>&nbsp;<span class="ident" id="3098825">r</span>&nbsp;<span class="op" id="3098827">&gt;=</span>&nbsp;<span class="num" id="3098830">0x80</span>&nbsp;<span class="op" id="3098835">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098839">r</span><span class="op" id="3098840">,</span>&nbsp;<span class="ident" id="3098842">size</span>&nbsp;<span class="op" id="3098847">=</span>&nbsp;<span class="ident" id="3098849">utf8</span><span class="op" id="3098853">.</span><span class="ident" id="3098854">DecodeRune</span><span class="op" id="3098864">(</span><span class="ident" id="3098865">b</span><span class="op" id="3098866">.</span><span class="ident" id="3098867">buf</span><span class="op" id="3098870">[</span><span class="ident" id="3098871">b</span><span class="op" id="3098872">.</span><span class="ident" id="3098873">r</span><span class="op" id="3098874">:</span><span class="ident" id="3098875">b</span><span class="op" id="3098876">.</span><span class="ident" id="3098877">w</span><span class="op" id="3098878">]</span><span class="op" id="3098879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098885">b</span><span class="op" id="3098886">.</span><span class="ident" id="3098887">r</span>&nbsp;<span class="op" id="3098889">+=</span>&nbsp;<span class="ident" id="3098892">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098898">b</span><span class="op" id="3098899">.</span><span class="ident" id="3098900">lastByte</span>&nbsp;<span class="op" id="3098909">=</span>&nbsp;<span class="builtintype" id="3098911">int</span><span class="op" id="3098914">(</span><span class="ident" id="3098915">b</span><span class="op" id="3098916">.</span><span class="ident" id="3098917">buf</span><span class="op" id="3098920">[</span><span class="ident" id="3098921">b</span><span class="op" id="3098922">.</span><span class="ident" id="3098923">r</span><span class="op" id="3098924">-</span><span class="num" id="3098925">1</span><span class="op" id="3098926">]</span><span class="op" id="3098927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098930">b</span><span class="op" id="3098931">.</span><span class="ident" id="3098932">lastRuneSize</span>&nbsp;<span class="op" id="3098945">=</span>&nbsp;<span class="ident" id="3098947">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098953">return</span>&nbsp;<span class="ident" id="3098960">r</span><span class="op" id="3098961">,</span>&nbsp;<span class="ident" id="3098963">size</span><span class="op" id="3098967">,</span>&nbsp;<span class="ident" id="3098969">nil</span><br>
<span class="lineno"></span><span class="op" id="3098973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3098976">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3099051">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="3099124">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3099198">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="3099227">func</span>&nbsp;<span class="op" id="3099232">(</span><span class="ident" id="3099233">b</span>&nbsp;<span class="op" id="3099235">*</span><span class="ident" id="3099236">Reader</span><span class="op" id="3099242">)</span>&nbsp;<span class="ident" id="3099244">UnreadRune</span><span class="op" id="3099254">(</span><span class="op" id="3099255">)</span>&nbsp;<span class="builtintype" id="3099257">error</span>&nbsp;<span class="op" id="3099263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099266">if</span>&nbsp;<span class="ident" id="3099269">b</span><span class="op" id="3099270">.</span><span class="ident" id="3099271">lastRuneSize</span>&nbsp;<span class="op" id="3099284">&lt;</span>&nbsp;<span class="num" id="3099286">0</span>&nbsp;<span class="op" id="3099288">||</span>&nbsp;<span class="ident" id="3099291">b</span><span class="op" id="3099292">.</span><span class="ident" id="3099293">r</span>&nbsp;<span class="op" id="3099295">&lt;</span>&nbsp;<span class="ident" id="3099297">b</span><span class="op" id="3099298">.</span><span class="ident" id="3099299">lastRuneSize</span>&nbsp;<span class="op" id="3099312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099316">return</span>&nbsp;<span class="ident" id="3099323">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099348">b</span><span class="op" id="3099349">.</span><span class="ident" id="3099350">r</span>&nbsp;<span class="op" id="3099352">-=</span>&nbsp;<span class="ident" id="3099355">b</span><span class="op" id="3099356">.</span><span class="ident" id="3099357">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099371">b</span><span class="op" id="3099372">.</span><span class="ident" id="3099373">lastByte</span>&nbsp;<span class="op" id="3099382">=</span>&nbsp;<span class="op" id="3099384">-</span><span class="num" id="3099385">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099388">b</span><span class="op" id="3099389">.</span><span class="ident" id="3099390">lastRuneSize</span>&nbsp;<span class="op" id="3099403">=</span>&nbsp;<span class="op" id="3099405">-</span><span class="num" id="3099406">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099409">return</span>&nbsp;<span class="ident" id="3099416">nil</span><br>
<span class="lineno">255</span><span class="op" id="3099420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3099423">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3099505">func</span>&nbsp;<span class="op" id="3099510">(</span><span class="ident" id="3099511">b</span>&nbsp;<span class="op" id="3099513">*</span><span class="ident" id="3099514">Reader</span><span class="op" id="3099520">)</span>&nbsp;<span class="ident" id="3099522">Buffered</span><span class="op" id="3099530">(</span><span class="op" id="3099531">)</span>&nbsp;<span class="builtintype" id="3099533">int</span>&nbsp;<span class="op" id="3099537">{</span>&nbsp;<span class="keyword" id="3099539">return</span>&nbsp;<span class="ident" id="3099546">b</span><span class="op" id="3099547">.</span><span class="ident" id="3099548">w</span>&nbsp;<span class="op" id="3099550">-</span>&nbsp;<span class="ident" id="3099552">b</span><span class="op" id="3099553">.</span><span class="ident" id="3099554">r</span>&nbsp;<span class="op" id="3099556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3099559">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3099628">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3099686">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="3099734">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3099798">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="3099876">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3099957">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="3100021">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3100075">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3100111">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="3100186">func</span>&nbsp;<span class="op" id="3100191">(</span><span class="ident" id="3100192">b</span>&nbsp;<span class="op" id="3100194">*</span><span class="ident" id="3100195">Reader</span><span class="op" id="3100201">)</span>&nbsp;<span class="ident" id="3100203">ReadSlice</span><span class="op" id="3100212">(</span><span class="ident" id="3100213">delim</span>&nbsp;<span class="builtintype" id="3100219">byte</span><span class="op" id="3100223">)</span>&nbsp;<span class="op" id="3100225">(</span><span class="ident" id="3100226">line</span>&nbsp;<span class="op" id="3100231">[</span><span class="op" id="3100232">]</span><span class="builtintype" id="3100233">byte</span><span class="op" id="3100237">,</span>&nbsp;<span class="ident" id="3100239">err</span>&nbsp;<span class="builtintype" id="3100243">error</span><span class="op" id="3100248">)</span>&nbsp;<span class="op" id="3100250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100253">for</span>&nbsp;<span class="op" id="3100257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100261">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100281">if</span>&nbsp;<span class="ident" id="3100284">i</span>&nbsp;<span class="op" id="3100286">:=</span>&nbsp;<span class="ident" id="3100289">bytes</span><span class="op" id="3100294">.</span><span class="ident" id="3100295">IndexByte</span><span class="op" id="3100304">(</span><span class="ident" id="3100305">b</span><span class="op" id="3100306">.</span><span class="ident" id="3100307">buf</span><span class="op" id="3100310">[</span><span class="ident" id="3100311">b</span><span class="op" id="3100312">.</span><span class="ident" id="3100313">r</span><span class="op" id="3100314">:</span><span class="ident" id="3100315">b</span><span class="op" id="3100316">.</span><span class="ident" id="3100317">w</span><span class="op" id="3100318">]</span><span class="op" id="3100319">,</span>&nbsp;<span class="ident" id="3100321">delim</span><span class="op" id="3100326">)</span><span class="op" id="3100327">;</span>&nbsp;<span class="ident" id="3100329">i</span>&nbsp;<span class="op" id="3100331">&gt;=</span>&nbsp;<span class="num" id="3100334">0</span>&nbsp;<span class="op" id="3100336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100341">line</span>&nbsp;<span class="op" id="3100346">=</span>&nbsp;<span class="ident" id="3100348">b</span><span class="op" id="3100349">.</span><span class="ident" id="3100350">buf</span><span class="op" id="3100353">[</span><span class="ident" id="3100354">b</span><span class="op" id="3100355">.</span><span class="ident" id="3100356">r</span>&nbsp;<span class="op" id="3100358">:</span>&nbsp;<span class="ident" id="3100360">b</span><span class="op" id="3100361">.</span><span class="ident" id="3100362">r</span><span class="op" id="3100363">+</span><span class="ident" id="3100364">i</span><span class="op" id="3100365">+</span><span class="num" id="3100366">1</span><span class="op" id="3100367">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100372">b</span><span class="op" id="3100373">.</span><span class="ident" id="3100374">r</span>&nbsp;<span class="op" id="3100376">+=</span>&nbsp;<span class="ident" id="3100379">i</span>&nbsp;<span class="op" id="3100381">+</span>&nbsp;<span class="num" id="3100383">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100388">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100401">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100421">if</span>&nbsp;<span class="ident" id="3100424">b</span><span class="op" id="3100425">.</span><span class="ident" id="3100426">err</span>&nbsp;<span class="op" id="3100430">!=</span>&nbsp;<span class="ident" id="3100433">nil</span>&nbsp;<span class="op" id="3100437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100442">line</span>&nbsp;<span class="op" id="3100447">=</span>&nbsp;<span class="ident" id="3100449">b</span><span class="op" id="3100450">.</span><span class="ident" id="3100451">buf</span><span class="op" id="3100454">[</span><span class="ident" id="3100455">b</span><span class="op" id="3100456">.</span><span class="ident" id="3100457">r</span><span class="op" id="3100458">:</span><span class="ident" id="3100459">b</span><span class="op" id="3100460">.</span><span class="ident" id="3100461">w</span><span class="op" id="3100462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100467">b</span><span class="op" id="3100468">.</span><span class="ident" id="3100469">r</span>&nbsp;<span class="op" id="3100471">=</span>&nbsp;<span class="ident" id="3100473">b</span><span class="op" id="3100474">.</span><span class="ident" id="3100475">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100480">err</span>&nbsp;<span class="op" id="3100484">=</span>&nbsp;<span class="ident" id="3100486">b</span><span class="op" id="3100487">.</span><span class="ident" id="3100488">readErr</span><span class="op" id="3100495">(</span><span class="op" id="3100496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100501">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100514">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100532">if</span>&nbsp;<span class="ident" id="3100535">b</span><span class="op" id="3100536">.</span><span class="ident" id="3100537">Buffered</span><span class="op" id="3100545">(</span><span class="op" id="3100546">)</span>&nbsp;<span class="op" id="3100548">&gt;=</span>&nbsp;<span class="builtinfunc" id="3100551">len</span><span class="op" id="3100554">(</span><span class="ident" id="3100555">b</span><span class="op" id="3100556">.</span><span class="ident" id="3100557">buf</span><span class="op" id="3100560">)</span>&nbsp;<span class="op" id="3100562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100567">b</span><span class="op" id="3100568">.</span><span class="ident" id="3100569">r</span>&nbsp;<span class="op" id="3100571">=</span>&nbsp;<span class="ident" id="3100573">b</span><span class="op" id="3100574">.</span><span class="ident" id="3100575">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100580">line</span>&nbsp;<span class="op" id="3100585">=</span>&nbsp;<span class="ident" id="3100587">b</span><span class="op" id="3100588">.</span><span class="ident" id="3100589">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100596">err</span>&nbsp;<span class="op" id="3100600">=</span>&nbsp;<span class="ident" id="3100602">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100619">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100632">b</span><span class="op" id="3100633">.</span><span class="ident" id="3100634">fill</span><span class="op" id="3100638">(</span><span class="op" id="3100639">)</span>&nbsp;<span class="comment" id="3100641">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100668">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100698">if</span>&nbsp;<span class="ident" id="3100701">i</span>&nbsp;<span class="op" id="3100703">:=</span>&nbsp;<span class="builtinfunc" id="3100706">len</span><span class="op" id="3100709">(</span><span class="ident" id="3100710">line</span><span class="op" id="3100714">)</span>&nbsp;<span class="op" id="3100716">-</span>&nbsp;<span class="num" id="3100718">1</span><span class="op" id="3100719">;</span>&nbsp;<span class="ident" id="3100721">i</span>&nbsp;<span class="op" id="3100723">&gt;=</span>&nbsp;<span class="num" id="3100726">0</span>&nbsp;<span class="op" id="3100728">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100732">b</span><span class="op" id="3100733">.</span><span class="ident" id="3100734">lastByte</span>&nbsp;<span class="op" id="3100743">=</span>&nbsp;<span class="builtintype" id="3100745">int</span><span class="op" id="3100748">(</span><span class="ident" id="3100749">line</span><span class="op" id="3100753">[</span><span class="ident" id="3100754">i</span><span class="op" id="3100755">]</span><span class="op" id="3100756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100760">b</span><span class="op" id="3100761">.</span><span class="ident" id="3100762">lastRuneSize</span>&nbsp;<span class="op" id="3100775">=</span>&nbsp;<span class="op" id="3100777">-</span><span class="num" id="3100778">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100785">return</span><br>
<span class="lineno">305</span><span class="op" id="3100792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3100795">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3100870">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="3100935">//</span><br>
<span class="lineno">310</span><span class="comment" id="3100938">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3101018">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3101090">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3101166">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="3101244">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="3101317">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="3101393">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="3101408">//</span><br>
<span class="lineno"></span><span class="comment" id="3101411">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="3101494">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="3101573">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3101648">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3101725">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="3101767">func</span>&nbsp;<span class="op" id="3101772">(</span><span class="ident" id="3101773">b</span>&nbsp;<span class="op" id="3101775">*</span><span class="ident" id="3101776">Reader</span><span class="op" id="3101782">)</span>&nbsp;<span class="ident" id="3101784">ReadLine</span><span class="op" id="3101792">(</span><span class="op" id="3101793">)</span>&nbsp;<span class="op" id="3101795">(</span><span class="ident" id="3101796">line</span>&nbsp;<span class="op" id="3101801">[</span><span class="op" id="3101802">]</span><span class="builtintype" id="3101803">byte</span><span class="op" id="3101807">,</span>&nbsp;<span class="ident" id="3101809">isPrefix</span>&nbsp;<span class="builtintype" id="3101818">bool</span><span class="op" id="3101822">,</span>&nbsp;<span class="ident" id="3101824">err</span>&nbsp;<span class="builtintype" id="3101828">error</span><span class="op" id="3101833">)</span>&nbsp;<span class="op" id="3101835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3101838">line</span><span class="op" id="3101842">,</span>&nbsp;<span class="ident" id="3101844">err</span>&nbsp;<span class="op" id="3101848">=</span>&nbsp;<span class="ident" id="3101850">b</span><span class="op" id="3101851">.</span><span class="ident" id="3101852">ReadSlice</span><span class="op" id="3101861">(</span><span class="string" id="3101862">&#39;\n&#39;</span><span class="op" id="3101866">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101869">if</span>&nbsp;<span class="ident" id="3101872">err</span>&nbsp;<span class="op" id="3101876">==</span>&nbsp;<span class="ident" id="3101879">ErrBufferFull</span>&nbsp;<span class="op" id="3101893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3101897">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101953">if</span>&nbsp;<span class="builtinfunc" id="3101956">len</span><span class="op" id="3101959">(</span><span class="ident" id="3101960">line</span><span class="op" id="3101964">)</span>&nbsp;<span class="op" id="3101966">&gt;</span>&nbsp;<span class="num" id="3101968">0</span>&nbsp;<span class="op" id="3101970">&amp;&amp;</span>&nbsp;<span class="ident" id="3101973">line</span><span class="op" id="3101977">[</span><span class="builtinfunc" id="3101978">len</span><span class="op" id="3101981">(</span><span class="ident" id="3101982">line</span><span class="op" id="3101986">)</span><span class="op" id="3101987">-</span><span class="num" id="3101988">1</span><span class="op" id="3101989">]</span>&nbsp;<span class="op" id="3101991">==</span>&nbsp;<span class="string" id="3101994">&#39;\r&#39;</span>&nbsp;<span class="op" id="3101999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102004">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102058">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102112">if</span>&nbsp;<span class="ident" id="3102115">b</span><span class="op" id="3102116">.</span><span class="ident" id="3102117">r</span>&nbsp;<span class="op" id="3102119">==</span>&nbsp;<span class="num" id="3102122">0</span>&nbsp;<span class="op" id="3102124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102130">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3102159">panic</span><span class="op" id="3102164">(</span><span class="string" id="3102165">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="3102210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102220">b</span><span class="op" id="3102221">.</span><span class="ident" id="3102222">r</span><span class="op" id="3102223">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102229">line</span>&nbsp;<span class="op" id="3102234">=</span>&nbsp;<span class="ident" id="3102236">line</span><span class="op" id="3102240">[</span><span class="op" id="3102241">:</span><span class="builtinfunc" id="3102242">len</span><span class="op" id="3102245">(</span><span class="ident" id="3102246">line</span><span class="op" id="3102250">)</span><span class="op" id="3102251">-</span><span class="num" id="3102252">1</span><span class="op" id="3102253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102261">return</span>&nbsp;<span class="ident" id="3102268">line</span><span class="op" id="3102272">,</span>&nbsp;<span class="ident" id="3102274">true</span><span class="op" id="3102278">,</span>&nbsp;<span class="ident" id="3102280">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102289">if</span>&nbsp;<span class="builtinfunc" id="3102292">len</span><span class="op" id="3102295">(</span><span class="ident" id="3102296">line</span><span class="op" id="3102300">)</span>&nbsp;<span class="op" id="3102302">==</span>&nbsp;<span class="num" id="3102305">0</span>&nbsp;<span class="op" id="3102307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102311">if</span>&nbsp;<span class="ident" id="3102314">err</span>&nbsp;<span class="op" id="3102318">!=</span>&nbsp;<span class="ident" id="3102321">nil</span>&nbsp;<span class="op" id="3102325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102330">line</span>&nbsp;<span class="op" id="3102335">=</span>&nbsp;<span class="ident" id="3102337">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102347">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102358">err</span>&nbsp;<span class="op" id="3102362">=</span>&nbsp;<span class="ident" id="3102364">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102370">if</span>&nbsp;<span class="ident" id="3102373">line</span><span class="op" id="3102377">[</span><span class="builtinfunc" id="3102378">len</span><span class="op" id="3102381">(</span><span class="ident" id="3102382">line</span><span class="op" id="3102386">)</span><span class="op" id="3102387">-</span><span class="num" id="3102388">1</span><span class="op" id="3102389">]</span>&nbsp;<span class="op" id="3102391">==</span>&nbsp;<span class="string" id="3102394">&#39;\n&#39;</span>&nbsp;<span class="op" id="3102399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102403">drop</span>&nbsp;<span class="op" id="3102408">:=</span>&nbsp;<span class="num" id="3102411">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102415">if</span>&nbsp;<span class="builtinfunc" id="3102418">len</span><span class="op" id="3102421">(</span><span class="ident" id="3102422">line</span><span class="op" id="3102426">)</span>&nbsp;<span class="op" id="3102428">&gt;</span>&nbsp;<span class="num" id="3102430">1</span>&nbsp;<span class="op" id="3102432">&amp;&amp;</span>&nbsp;<span class="ident" id="3102435">line</span><span class="op" id="3102439">[</span><span class="builtinfunc" id="3102440">len</span><span class="op" id="3102443">(</span><span class="ident" id="3102444">line</span><span class="op" id="3102448">)</span><span class="op" id="3102449">-</span><span class="num" id="3102450">2</span><span class="op" id="3102451">]</span>&nbsp;<span class="op" id="3102453">==</span>&nbsp;<span class="string" id="3102456">&#39;\r&#39;</span>&nbsp;<span class="op" id="3102461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102466">drop</span>&nbsp;<span class="op" id="3102471">=</span>&nbsp;<span class="num" id="3102473">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102481">line</span>&nbsp;<span class="op" id="3102486">=</span>&nbsp;<span class="ident" id="3102488">line</span><span class="op" id="3102492">[</span><span class="op" id="3102493">:</span><span class="builtinfunc" id="3102494">len</span><span class="op" id="3102497">(</span><span class="ident" id="3102498">line</span><span class="op" id="3102502">)</span><span class="op" id="3102503">-</span><span class="ident" id="3102504">drop</span><span class="op" id="3102508">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102511">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102514">return</span><br>
<span class="lineno"></span><span class="op" id="3102521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3102524">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3102593">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="3102669">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3102733">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3102815">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3102896">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3102906">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="3102960">func</span>&nbsp;<span class="op" id="3102965">(</span><span class="ident" id="3102966">b</span>&nbsp;<span class="op" id="3102968">*</span><span class="ident" id="3102969">Reader</span><span class="op" id="3102975">)</span>&nbsp;<span class="ident" id="3102977">ReadBytes</span><span class="op" id="3102986">(</span><span class="ident" id="3102987">delim</span>&nbsp;<span class="builtintype" id="3102993">byte</span><span class="op" id="3102997">)</span>&nbsp;<span class="op" id="3102999">(</span><span class="ident" id="3103000">line</span>&nbsp;<span class="op" id="3103005">[</span><span class="op" id="3103006">]</span><span class="builtintype" id="3103007">byte</span><span class="op" id="3103011">,</span>&nbsp;<span class="ident" id="3103013">err</span>&nbsp;<span class="builtintype" id="3103017">error</span><span class="op" id="3103022">)</span>&nbsp;<span class="op" id="3103024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103027">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103064">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103095">var</span>&nbsp;<span class="ident" id="3103099">frag</span>&nbsp;<span class="op" id="3103104">[</span><span class="op" id="3103105">]</span><span class="builtintype" id="3103106">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103112">var</span>&nbsp;<span class="ident" id="3103116">full</span>&nbsp;<span class="op" id="3103121">[</span><span class="op" id="3103122">]</span><span class="op" id="3103123">[</span><span class="op" id="3103124">]</span><span class="builtintype" id="3103125">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103131">err</span>&nbsp;<span class="op" id="3103135">=</span>&nbsp;<span class="ident" id="3103137">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103143">for</span>&nbsp;<span class="op" id="3103147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103151">var</span>&nbsp;<span class="ident" id="3103155">e</span>&nbsp;<span class="builtintype" id="3103157">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103165">frag</span><span class="op" id="3103169">,</span>&nbsp;<span class="ident" id="3103171">e</span>&nbsp;<span class="op" id="3103173">=</span>&nbsp;<span class="ident" id="3103175">b</span><span class="op" id="3103176">.</span><span class="ident" id="3103177">ReadSlice</span><span class="op" id="3103186">(</span><span class="ident" id="3103187">delim</span><span class="op" id="3103192">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103196">if</span>&nbsp;<span class="ident" id="3103199">e</span>&nbsp;<span class="op" id="3103201">==</span>&nbsp;<span class="ident" id="3103204">nil</span>&nbsp;<span class="op" id="3103208">{</span>&nbsp;<span class="comment" id="3103210">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103235">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103247">if</span>&nbsp;<span class="ident" id="3103250">e</span>&nbsp;<span class="op" id="3103252">!=</span>&nbsp;<span class="ident" id="3103255">ErrBufferFull</span>&nbsp;<span class="op" id="3103269">{</span>&nbsp;<span class="comment" id="3103271">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103294">err</span>&nbsp;<span class="op" id="3103298">=</span>&nbsp;<span class="ident" id="3103300">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103305">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103318">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103350">buf</span>&nbsp;<span class="op" id="3103354">:=</span>&nbsp;<span class="builtinfunc" id="3103357">make</span><span class="op" id="3103361">(</span><span class="op" id="3103362">[</span><span class="op" id="3103363">]</span><span class="builtintype" id="3103364">byte</span><span class="op" id="3103368">,</span>&nbsp;<span class="builtinfunc" id="3103370">len</span><span class="op" id="3103373">(</span><span class="ident" id="3103374">frag</span><span class="op" id="3103378">)</span><span class="op" id="3103379">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3103383">copy</span><span class="op" id="3103387">(</span><span class="ident" id="3103388">buf</span><span class="op" id="3103391">,</span>&nbsp;<span class="ident" id="3103393">frag</span><span class="op" id="3103397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103401">full</span>&nbsp;<span class="op" id="3103406">=</span>&nbsp;<span class="builtinfunc" id="3103408">append</span><span class="op" id="3103414">(</span><span class="ident" id="3103415">full</span><span class="op" id="3103419">,</span>&nbsp;<span class="ident" id="3103421">buf</span><span class="op" id="3103424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103431">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103497">n</span>&nbsp;<span class="op" id="3103499">:=</span>&nbsp;<span class="num" id="3103502">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103505">for</span>&nbsp;<span class="ident" id="3103509">i</span>&nbsp;<span class="op" id="3103511">:=</span>&nbsp;<span class="keyword" id="3103514">range</span>&nbsp;<span class="ident" id="3103520">full</span>&nbsp;<span class="op" id="3103525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103529">n</span>&nbsp;<span class="op" id="3103531">+=</span>&nbsp;<span class="builtinfunc" id="3103534">len</span><span class="op" id="3103537">(</span><span class="ident" id="3103538">full</span><span class="op" id="3103542">[</span><span class="ident" id="3103543">i</span><span class="op" id="3103544">]</span><span class="op" id="3103545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103551">n</span>&nbsp;<span class="op" id="3103553">+=</span>&nbsp;<span class="builtinfunc" id="3103556">len</span><span class="op" id="3103559">(</span><span class="ident" id="3103560">frag</span><span class="op" id="3103564">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103568">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103606">buf</span>&nbsp;<span class="op" id="3103610">:=</span>&nbsp;<span class="builtinfunc" id="3103613">make</span><span class="op" id="3103617">(</span><span class="op" id="3103618">[</span><span class="op" id="3103619">]</span><span class="builtintype" id="3103620">byte</span><span class="op" id="3103624">,</span>&nbsp;<span class="ident" id="3103626">n</span><span class="op" id="3103627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103630">n</span>&nbsp;<span class="op" id="3103632">=</span>&nbsp;<span class="num" id="3103634">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103637">for</span>&nbsp;<span class="ident" id="3103641">i</span>&nbsp;<span class="op" id="3103643">:=</span>&nbsp;<span class="keyword" id="3103646">range</span>&nbsp;<span class="ident" id="3103652">full</span>&nbsp;<span class="op" id="3103657">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103661">n</span>&nbsp;<span class="op" id="3103663">+=</span>&nbsp;<span class="builtinfunc" id="3103666">copy</span><span class="op" id="3103670">(</span><span class="ident" id="3103671">buf</span><span class="op" id="3103674">[</span><span class="ident" id="3103675">n</span><span class="op" id="3103676">:</span><span class="op" id="3103677">]</span><span class="op" id="3103678">,</span>&nbsp;<span class="ident" id="3103680">full</span><span class="op" id="3103684">[</span><span class="ident" id="3103685">i</span><span class="op" id="3103686">]</span><span class="op" id="3103687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3103693">copy</span><span class="op" id="3103697">(</span><span class="ident" id="3103698">buf</span><span class="op" id="3103701">[</span><span class="ident" id="3103702">n</span><span class="op" id="3103703">:</span><span class="op" id="3103704">]</span><span class="op" id="3103705">,</span>&nbsp;<span class="ident" id="3103707">frag</span><span class="op" id="3103711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103714">return</span>&nbsp;<span class="ident" id="3103721">buf</span><span class="op" id="3103724">,</span>&nbsp;<span class="ident" id="3103726">err</span><br>
<span class="lineno"></span><span class="op" id="3103730">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3103733">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3103803">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3103880">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3103945">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="3104027">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3104109">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3104119">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="3104173">func</span>&nbsp;<span class="op" id="3104178">(</span><span class="ident" id="3104179">b</span>&nbsp;<span class="op" id="3104181">*</span><span class="ident" id="3104182">Reader</span><span class="op" id="3104188">)</span>&nbsp;<span class="ident" id="3104190">ReadString</span><span class="op" id="3104200">(</span><span class="ident" id="3104201">delim</span>&nbsp;<span class="builtintype" id="3104207">byte</span><span class="op" id="3104211">)</span>&nbsp;<span class="op" id="3104213">(</span><span class="ident" id="3104214">line</span>&nbsp;<span class="builtintype" id="3104219">string</span><span class="op" id="3104225">,</span>&nbsp;<span class="ident" id="3104227">err</span>&nbsp;<span class="builtintype" id="3104231">error</span><span class="op" id="3104236">)</span>&nbsp;<span class="op" id="3104238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104241">bytes</span><span class="op" id="3104246">,</span>&nbsp;<span class="ident" id="3104248">err</span>&nbsp;<span class="op" id="3104252">:=</span>&nbsp;<span class="ident" id="3104255">b</span><span class="op" id="3104256">.</span><span class="ident" id="3104257">ReadBytes</span><span class="op" id="3104266">(</span><span class="ident" id="3104267">delim</span><span class="op" id="3104272">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104275">line</span>&nbsp;<span class="op" id="3104280">=</span>&nbsp;<span class="builtintype" id="3104282">string</span><span class="op" id="3104288">(</span><span class="ident" id="3104289">bytes</span><span class="op" id="3104294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104297">return</span>&nbsp;<span class="ident" id="3104304">line</span><span class="op" id="3104308">,</span>&nbsp;<span class="ident" id="3104310">err</span><br>
<span class="lineno"></span><span class="op" id="3104314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3104317">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="3104352">func</span>&nbsp;<span class="op" id="3104357">(</span><span class="ident" id="3104358">b</span>&nbsp;<span class="op" id="3104360">*</span><span class="ident" id="3104361">Reader</span><span class="op" id="3104367">)</span>&nbsp;<span class="ident" id="3104369">WriteTo</span><span class="op" id="3104376">(</span><span class="ident" id="3104377">w</span>&nbsp;<span class="ident" id="3104379">io</span><span class="op" id="3104381">.</span><span class="ident" id="3104382">Writer</span><span class="op" id="3104388">)</span>&nbsp;<span class="op" id="3104390">(</span><span class="ident" id="3104391">n</span>&nbsp;<span class="ident" id="3104393">int64</span><span class="op" id="3104398">,</span>&nbsp;<span class="ident" id="3104400">err</span>&nbsp;<span class="builtintype" id="3104404">error</span><span class="op" id="3104409">)</span>&nbsp;<span class="op" id="3104411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104414">n</span><span class="op" id="3104415">,</span>&nbsp;<span class="ident" id="3104417">err</span>&nbsp;<span class="op" id="3104421">=</span>&nbsp;<span class="ident" id="3104423">b</span><span class="op" id="3104424">.</span><span class="ident" id="3104425">writeBuf</span><span class="op" id="3104433">(</span><span class="ident" id="3104434">w</span><span class="op" id="3104435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104438">if</span>&nbsp;<span class="ident" id="3104441">err</span>&nbsp;<span class="op" id="3104445">!=</span>&nbsp;<span class="ident" id="3104448">nil</span>&nbsp;<span class="op" id="3104452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104456">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104464">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104468">if</span>&nbsp;<span class="ident" id="3104471">r</span><span class="op" id="3104472">,</span>&nbsp;<span class="ident" id="3104474">ok</span>&nbsp;<span class="op" id="3104477">:=</span>&nbsp;<span class="ident" id="3104480">b</span><span class="op" id="3104481">.</span><span class="ident" id="3104482">rd</span><span class="op" id="3104484">.</span><span class="op" id="3104485">(</span><span class="ident" id="3104486">io</span><span class="op" id="3104488">.</span><span class="ident" id="3104489">WriterTo</span><span class="op" id="3104497">)</span><span class="op" id="3104498">;</span>&nbsp;<span class="ident" id="3104500">ok</span>&nbsp;<span class="op" id="3104503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104507">m</span><span class="op" id="3104508">,</span>&nbsp;<span class="ident" id="3104510">err</span>&nbsp;<span class="op" id="3104514">:=</span>&nbsp;<span class="ident" id="3104517">r</span><span class="op" id="3104518">.</span><span class="ident" id="3104519">WriteTo</span><span class="op" id="3104526">(</span><span class="ident" id="3104527">w</span><span class="op" id="3104528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104532">n</span>&nbsp;<span class="op" id="3104534">+=</span>&nbsp;<span class="ident" id="3104537">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104541">return</span>&nbsp;<span class="ident" id="3104548">n</span><span class="op" id="3104549">,</span>&nbsp;<span class="ident" id="3104551">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104560">if</span>&nbsp;<span class="ident" id="3104563">w</span><span class="op" id="3104564">,</span>&nbsp;<span class="ident" id="3104566">ok</span>&nbsp;<span class="op" id="3104569">:=</span>&nbsp;<span class="ident" id="3104572">w</span><span class="op" id="3104573">.</span><span class="op" id="3104574">(</span><span class="ident" id="3104575">io</span><span class="op" id="3104577">.</span><span class="ident" id="3104578">ReaderFrom</span><span class="op" id="3104588">)</span><span class="op" id="3104589">;</span>&nbsp;<span class="ident" id="3104591">ok</span>&nbsp;<span class="op" id="3104594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104598">m</span><span class="op" id="3104599">,</span>&nbsp;<span class="ident" id="3104601">err</span>&nbsp;<span class="op" id="3104605">:=</span>&nbsp;<span class="ident" id="3104608">w</span><span class="op" id="3104609">.</span><span class="ident" id="3104610">ReadFrom</span><span class="op" id="3104618">(</span><span class="ident" id="3104619">b</span><span class="op" id="3104620">.</span><span class="ident" id="3104621">rd</span><span class="op" id="3104623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104627">n</span>&nbsp;<span class="op" id="3104629">+=</span>&nbsp;<span class="ident" id="3104632">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104636">return</span>&nbsp;<span class="ident" id="3104643">n</span><span class="op" id="3104644">,</span>&nbsp;<span class="ident" id="3104646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104655">if</span>&nbsp;<span class="ident" id="3104658">b</span><span class="op" id="3104659">.</span><span class="ident" id="3104660">w</span><span class="op" id="3104661">-</span><span class="ident" id="3104662">b</span><span class="op" id="3104663">.</span><span class="ident" id="3104664">r</span>&nbsp;<span class="op" id="3104666">&lt;</span>&nbsp;<span class="builtinfunc" id="3104668">len</span><span class="op" id="3104671">(</span><span class="ident" id="3104672">b</span><span class="op" id="3104673">.</span><span class="ident" id="3104674">buf</span><span class="op" id="3104677">)</span>&nbsp;<span class="op" id="3104679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104683">b</span><span class="op" id="3104684">.</span><span class="ident" id="3104685">fill</span><span class="op" id="3104689">(</span><span class="op" id="3104690">)</span>&nbsp;<span class="comment" id="3104692">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104716">for</span>&nbsp;<span class="ident" id="3104720">b</span><span class="op" id="3104721">.</span><span class="ident" id="3104722">r</span>&nbsp;<span class="op" id="3104724">&lt;</span>&nbsp;<span class="ident" id="3104726">b</span><span class="op" id="3104727">.</span><span class="ident" id="3104728">w</span>&nbsp;<span class="op" id="3104730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104734">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104772">m</span><span class="op" id="3104773">,</span>&nbsp;<span class="ident" id="3104775">err</span>&nbsp;<span class="op" id="3104779">:=</span>&nbsp;<span class="ident" id="3104782">b</span><span class="op" id="3104783">.</span><span class="ident" id="3104784">writeBuf</span><span class="op" id="3104792">(</span><span class="ident" id="3104793">w</span><span class="op" id="3104794">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104798">n</span>&nbsp;<span class="op" id="3104800">+=</span>&nbsp;<span class="ident" id="3104803">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104807">if</span>&nbsp;<span class="ident" id="3104810">err</span>&nbsp;<span class="op" id="3104814">!=</span>&nbsp;<span class="ident" id="3104817">nil</span>&nbsp;<span class="op" id="3104821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104826">return</span>&nbsp;<span class="ident" id="3104833">n</span><span class="op" id="3104834">,</span>&nbsp;<span class="ident" id="3104836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104846">b</span><span class="op" id="3104847">.</span><span class="ident" id="3104848">fill</span><span class="op" id="3104852">(</span><span class="op" id="3104853">)</span>&nbsp;<span class="comment" id="3104855">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104879">if</span>&nbsp;<span class="ident" id="3104882">b</span><span class="op" id="3104883">.</span><span class="ident" id="3104884">err</span>&nbsp;<span class="op" id="3104888">==</span>&nbsp;<span class="ident" id="3104891">io</span><span class="op" id="3104893">.</span><span class="ident" id="3104894">EOF</span>&nbsp;<span class="op" id="3104898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104902">b</span><span class="op" id="3104903">.</span><span class="ident" id="3104904">err</span>&nbsp;<span class="op" id="3104908">=</span>&nbsp;<span class="ident" id="3104910">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104915">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104919">return</span>&nbsp;<span class="ident" id="3104926">n</span><span class="op" id="3104927">,</span>&nbsp;<span class="ident" id="3104929">b</span><span class="op" id="3104930">.</span><span class="ident" id="3104931">readErr</span><span class="op" id="3104938">(</span><span class="op" id="3104939">)</span><br>
<span class="lineno"></span><span class="op" id="3104941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3104944">var</span>&nbsp;<span class="ident" id="3104948">errNegativeWrite</span>&nbsp;<span class="op" id="3104965">=</span>&nbsp;<span class="ident" id="3104967">errors</span><span class="op" id="3104973">.</span><span class="ident" id="3104974">New</span><span class="op" id="3104977">(</span><span class="string" id="3104978">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="3105028">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3105031">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3105085">func</span>&nbsp;<span class="op" id="3105090">(</span><span class="ident" id="3105091">b</span>&nbsp;<span class="op" id="3105093">*</span><span class="ident" id="3105094">Reader</span><span class="op" id="3105100">)</span>&nbsp;<span class="ident" id="3105102">writeBuf</span><span class="op" id="3105110">(</span><span class="ident" id="3105111">w</span>&nbsp;<span class="ident" id="3105113">io</span><span class="op" id="3105115">.</span><span class="ident" id="3105116">Writer</span><span class="op" id="3105122">)</span>&nbsp;<span class="op" id="3105124">(</span><span class="ident" id="3105125">int64</span><span class="op" id="3105130">,</span>&nbsp;<span class="builtintype" id="3105132">error</span><span class="op" id="3105137">)</span>&nbsp;<span class="op" id="3105139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105142">n</span><span class="op" id="3105143">,</span>&nbsp;<span class="ident" id="3105145">err</span>&nbsp;<span class="op" id="3105149">:=</span>&nbsp;<span class="ident" id="3105152">w</span><span class="op" id="3105153">.</span><span class="ident" id="3105154">Write</span><span class="op" id="3105159">(</span><span class="ident" id="3105160">b</span><span class="op" id="3105161">.</span><span class="ident" id="3105162">buf</span><span class="op" id="3105165">[</span><span class="ident" id="3105166">b</span><span class="op" id="3105167">.</span><span class="ident" id="3105168">r</span><span class="op" id="3105169">:</span><span class="ident" id="3105170">b</span><span class="op" id="3105171">.</span><span class="ident" id="3105172">w</span><span class="op" id="3105173">]</span><span class="op" id="3105174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105177">if</span>&nbsp;<span class="ident" id="3105180">n</span>&nbsp;<span class="op" id="3105182">&lt;</span>&nbsp;<span class="num" id="3105184">0</span>&nbsp;<span class="op" id="3105186">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3105190">panic</span><span class="op" id="3105195">(</span><span class="ident" id="3105196">errNegativeWrite</span><span class="op" id="3105212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105218">b</span><span class="op" id="3105219">.</span><span class="ident" id="3105220">r</span>&nbsp;<span class="op" id="3105222">+=</span>&nbsp;<span class="ident" id="3105225">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105228">return</span>&nbsp;<span class="ident" id="3105235">int64</span><span class="op" id="3105240">(</span><span class="ident" id="3105241">n</span><span class="op" id="3105242">)</span><span class="op" id="3105243">,</span>&nbsp;<span class="ident" id="3105245">err</span><br>
<span class="lineno"></span><span class="op" id="3105249">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3105252">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3105272">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3105328">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="3105392">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3105453">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3105516">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3105576">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3105605">type</span>&nbsp;<span class="ident" id="3105610">Writer</span>&nbsp;<span class="keyword" id="3105617">struct</span>&nbsp;<span class="op" id="3105624">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105627">err</span>&nbsp;<span class="builtintype" id="3105631">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105638">buf</span>&nbsp;<span class="op" id="3105642">[</span><span class="op" id="3105643">]</span><span class="builtintype" id="3105644">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105650">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3105654">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105659">wr</span>&nbsp;&nbsp;<span class="ident" id="3105663">io</span><span class="op" id="3105665">.</span><span class="ident" id="3105666">Writer</span><br>
<span class="lineno"></span><span class="op" id="3105673">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="3105676">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3105754">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="3105827">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3105870">func</span>&nbsp;<span class="ident" id="3105875">NewWriterSize</span><span class="op" id="3105888">(</span><span class="ident" id="3105889">w</span>&nbsp;<span class="ident" id="3105891">io</span><span class="op" id="3105893">.</span><span class="ident" id="3105894">Writer</span><span class="op" id="3105900">,</span>&nbsp;<span class="ident" id="3105902">size</span>&nbsp;<span class="builtintype" id="3105907">int</span><span class="op" id="3105910">)</span>&nbsp;<span class="op" id="3105912">*</span><span class="ident" id="3105913">Writer</span>&nbsp;<span class="op" id="3105920">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105923">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105951">b</span><span class="op" id="3105952">,</span>&nbsp;<span class="ident" id="3105954">ok</span>&nbsp;<span class="op" id="3105957">:=</span>&nbsp;<span class="ident" id="3105960">w</span><span class="op" id="3105961">.</span><span class="op" id="3105962">(</span><span class="op" id="3105963">*</span><span class="ident" id="3105964">Writer</span><span class="op" id="3105970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105973">if</span>&nbsp;<span class="ident" id="3105976">ok</span>&nbsp;<span class="op" id="3105979">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3105982">len</span><span class="op" id="3105985">(</span><span class="ident" id="3105986">b</span><span class="op" id="3105987">.</span><span class="ident" id="3105988">buf</span><span class="op" id="3105991">)</span>&nbsp;<span class="op" id="3105993">&gt;=</span>&nbsp;<span class="ident" id="3105996">size</span>&nbsp;<span class="op" id="3106001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106005">return</span>&nbsp;<span class="ident" id="3106012">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106015">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106018">if</span>&nbsp;<span class="ident" id="3106021">size</span>&nbsp;<span class="op" id="3106026">&lt;=</span>&nbsp;<span class="num" id="3106029">0</span>&nbsp;<span class="op" id="3106031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106035">size</span>&nbsp;<span class="op" id="3106040">=</span>&nbsp;<span class="ident" id="3106042">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106061">return</span>&nbsp;<span class="op" id="3106068">&amp;</span><span class="ident" id="3106069">Writer</span><span class="op" id="3106075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106079">buf</span><span class="op" id="3106082">:</span>&nbsp;<span class="builtinfunc" id="3106084">make</span><span class="op" id="3106088">(</span><span class="op" id="3106089">[</span><span class="op" id="3106090">]</span><span class="builtintype" id="3106091">byte</span><span class="op" id="3106095">,</span>&nbsp;<span class="ident" id="3106097">size</span><span class="op" id="3106101">)</span><span class="op" id="3106102">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106106">wr</span><span class="op" id="3106108">:</span>&nbsp;&nbsp;<span class="ident" id="3106111">w</span><span class="op" id="3106112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106115">}</span><br>
<span class="lineno"></span><span class="op" id="3106117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3106120">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="3106189">func</span>&nbsp;<span class="ident" id="3106194">NewWriter</span><span class="op" id="3106203">(</span><span class="ident" id="3106204">w</span>&nbsp;<span class="ident" id="3106206">io</span><span class="op" id="3106208">.</span><span class="ident" id="3106209">Writer</span><span class="op" id="3106215">)</span>&nbsp;<span class="op" id="3106217">*</span><span class="ident" id="3106218">Writer</span>&nbsp;<span class="op" id="3106225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106228">return</span>&nbsp;<span class="ident" id="3106235">NewWriterSize</span><span class="op" id="3106248">(</span><span class="ident" id="3106249">w</span><span class="op" id="3106250">,</span>&nbsp;<span class="ident" id="3106252">defaultBufSize</span><span class="op" id="3106266">)</span><br>
<span class="lineno"></span><span class="op" id="3106268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3106271">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="3106340">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3106378">func</span>&nbsp;<span class="op" id="3106383">(</span><span class="ident" id="3106384">b</span>&nbsp;<span class="op" id="3106386">*</span><span class="ident" id="3106387">Writer</span><span class="op" id="3106393">)</span>&nbsp;<span class="ident" id="3106395">Reset</span><span class="op" id="3106400">(</span><span class="ident" id="3106401">w</span>&nbsp;<span class="ident" id="3106403">io</span><span class="op" id="3106405">.</span><span class="ident" id="3106406">Writer</span><span class="op" id="3106412">)</span>&nbsp;<span class="op" id="3106414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106417">b</span><span class="op" id="3106418">.</span><span class="ident" id="3106419">err</span>&nbsp;<span class="op" id="3106423">=</span>&nbsp;<span class="ident" id="3106425">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106430">b</span><span class="op" id="3106431">.</span><span class="ident" id="3106432">n</span>&nbsp;<span class="op" id="3106434">=</span>&nbsp;<span class="num" id="3106436">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106439">b</span><span class="op" id="3106440">.</span><span class="ident" id="3106441">wr</span>&nbsp;<span class="op" id="3106444">=</span>&nbsp;<span class="ident" id="3106446">w</span><br>
<span class="lineno">515</span><span class="op" id="3106448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3106451">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3106514">func</span>&nbsp;<span class="op" id="3106519">(</span><span class="ident" id="3106520">b</span>&nbsp;<span class="op" id="3106522">*</span><span class="ident" id="3106523">Writer</span><span class="op" id="3106529">)</span>&nbsp;<span class="ident" id="3106531">Flush</span><span class="op" id="3106536">(</span><span class="op" id="3106537">)</span>&nbsp;<span class="builtintype" id="3106539">error</span>&nbsp;<span class="op" id="3106545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106548">err</span>&nbsp;<span class="op" id="3106552">:=</span>&nbsp;<span class="ident" id="3106555">b</span><span class="op" id="3106556">.</span><span class="ident" id="3106557">flush</span><span class="op" id="3106562">(</span><span class="op" id="3106563">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106566">return</span>&nbsp;<span class="ident" id="3106573">err</span><br>
<span class="lineno"></span><span class="op" id="3106577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3106580">func</span>&nbsp;<span class="op" id="3106585">(</span><span class="ident" id="3106586">b</span>&nbsp;<span class="op" id="3106588">*</span><span class="ident" id="3106589">Writer</span><span class="op" id="3106595">)</span>&nbsp;<span class="ident" id="3106597">flush</span><span class="op" id="3106602">(</span><span class="op" id="3106603">)</span>&nbsp;<span class="builtintype" id="3106605">error</span>&nbsp;<span class="op" id="3106611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106614">if</span>&nbsp;<span class="ident" id="3106617">b</span><span class="op" id="3106618">.</span><span class="ident" id="3106619">err</span>&nbsp;<span class="op" id="3106623">!=</span>&nbsp;<span class="ident" id="3106626">nil</span>&nbsp;<span class="op" id="3106630">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106634">return</span>&nbsp;<span class="ident" id="3106641">b</span><span class="op" id="3106642">.</span><span class="ident" id="3106643">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106651">if</span>&nbsp;<span class="ident" id="3106654">b</span><span class="op" id="3106655">.</span><span class="ident" id="3106656">n</span>&nbsp;<span class="op" id="3106658">==</span>&nbsp;<span class="num" id="3106661">0</span>&nbsp;<span class="op" id="3106663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106667">return</span>&nbsp;<span class="ident" id="3106674">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106679">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106682">n</span><span class="op" id="3106683">,</span>&nbsp;<span class="ident" id="3106685">err</span>&nbsp;<span class="op" id="3106689">:=</span>&nbsp;<span class="ident" id="3106692">b</span><span class="op" id="3106693">.</span><span class="ident" id="3106694">wr</span><span class="op" id="3106696">.</span><span class="ident" id="3106697">Write</span><span class="op" id="3106702">(</span><span class="ident" id="3106703">b</span><span class="op" id="3106704">.</span><span class="ident" id="3106705">buf</span><span class="op" id="3106708">[</span><span class="num" id="3106709">0</span><span class="op" id="3106710">:</span><span class="ident" id="3106711">b</span><span class="op" id="3106712">.</span><span class="ident" id="3106713">n</span><span class="op" id="3106714">]</span><span class="op" id="3106715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106718">if</span>&nbsp;<span class="ident" id="3106721">n</span>&nbsp;<span class="op" id="3106723">&lt;</span>&nbsp;<span class="ident" id="3106725">b</span><span class="op" id="3106726">.</span><span class="ident" id="3106727">n</span>&nbsp;<span class="op" id="3106729">&amp;&amp;</span>&nbsp;<span class="ident" id="3106732">err</span>&nbsp;<span class="op" id="3106736">==</span>&nbsp;<span class="ident" id="3106739">nil</span>&nbsp;<span class="op" id="3106743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106747">err</span>&nbsp;<span class="op" id="3106751">=</span>&nbsp;<span class="ident" id="3106753">io</span><span class="op" id="3106755">.</span><span class="ident" id="3106756">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106774">if</span>&nbsp;<span class="ident" id="3106777">err</span>&nbsp;<span class="op" id="3106781">!=</span>&nbsp;<span class="ident" id="3106784">nil</span>&nbsp;<span class="op" id="3106788">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106792">if</span>&nbsp;<span class="ident" id="3106795">n</span>&nbsp;<span class="op" id="3106797">&gt;</span>&nbsp;<span class="num" id="3106799">0</span>&nbsp;<span class="op" id="3106801">&amp;&amp;</span>&nbsp;<span class="ident" id="3106804">n</span>&nbsp;<span class="op" id="3106806">&lt;</span>&nbsp;<span class="ident" id="3106808">b</span><span class="op" id="3106809">.</span><span class="ident" id="3106810">n</span>&nbsp;<span class="op" id="3106812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3106817">copy</span><span class="op" id="3106821">(</span><span class="ident" id="3106822">b</span><span class="op" id="3106823">.</span><span class="ident" id="3106824">buf</span><span class="op" id="3106827">[</span><span class="num" id="3106828">0</span><span class="op" id="3106829">:</span><span class="ident" id="3106830">b</span><span class="op" id="3106831">.</span><span class="ident" id="3106832">n</span><span class="op" id="3106833">-</span><span class="ident" id="3106834">n</span><span class="op" id="3106835">]</span><span class="op" id="3106836">,</span>&nbsp;<span class="ident" id="3106838">b</span><span class="op" id="3106839">.</span><span class="ident" id="3106840">buf</span><span class="op" id="3106843">[</span><span class="ident" id="3106844">n</span><span class="op" id="3106845">:</span><span class="ident" id="3106846">b</span><span class="op" id="3106847">.</span><span class="ident" id="3106848">n</span><span class="op" id="3106849">]</span><span class="op" id="3106850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106858">b</span><span class="op" id="3106859">.</span><span class="ident" id="3106860">n</span>&nbsp;<span class="op" id="3106862">-=</span>&nbsp;<span class="ident" id="3106865">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106869">b</span><span class="op" id="3106870">.</span><span class="ident" id="3106871">err</span>&nbsp;<span class="op" id="3106875">=</span>&nbsp;<span class="ident" id="3106877">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106883">return</span>&nbsp;<span class="ident" id="3106890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106898">b</span><span class="op" id="3106899">.</span><span class="ident" id="3106900">n</span>&nbsp;<span class="op" id="3106902">=</span>&nbsp;<span class="num" id="3106904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106907">return</span>&nbsp;<span class="ident" id="3106914">nil</span><br>
<span class="lineno"></span><span class="op" id="3106918">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3106921">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3106983">func</span>&nbsp;<span class="op" id="3106988">(</span><span class="ident" id="3106989">b</span>&nbsp;<span class="op" id="3106991">*</span><span class="ident" id="3106992">Writer</span><span class="op" id="3106998">)</span>&nbsp;<span class="ident" id="3107000">Available</span><span class="op" id="3107009">(</span><span class="op" id="3107010">)</span>&nbsp;<span class="builtintype" id="3107012">int</span>&nbsp;<span class="op" id="3107016">{</span>&nbsp;<span class="keyword" id="3107018">return</span>&nbsp;<span class="builtinfunc" id="3107025">len</span><span class="op" id="3107028">(</span><span class="ident" id="3107029">b</span><span class="op" id="3107030">.</span><span class="ident" id="3107031">buf</span><span class="op" id="3107034">)</span>&nbsp;<span class="op" id="3107036">-</span>&nbsp;<span class="ident" id="3107038">b</span><span class="op" id="3107039">.</span><span class="ident" id="3107040">n</span>&nbsp;<span class="op" id="3107042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3107045">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="3107133">func</span>&nbsp;<span class="op" id="3107138">(</span><span class="ident" id="3107139">b</span>&nbsp;<span class="op" id="3107141">*</span><span class="ident" id="3107142">Writer</span><span class="op" id="3107148">)</span>&nbsp;<span class="ident" id="3107150">Buffered</span><span class="op" id="3107158">(</span><span class="op" id="3107159">)</span>&nbsp;<span class="builtintype" id="3107161">int</span>&nbsp;<span class="op" id="3107165">{</span>&nbsp;<span class="keyword" id="3107167">return</span>&nbsp;<span class="ident" id="3107174">b</span><span class="op" id="3107175">.</span><span class="ident" id="3107176">n</span>&nbsp;<span class="op" id="3107178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3107181">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3107232">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3107275">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="3107330">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3107357">func</span>&nbsp;<span class="op" id="3107362">(</span><span class="ident" id="3107363">b</span>&nbsp;<span class="op" id="3107365">*</span><span class="ident" id="3107366">Writer</span><span class="op" id="3107372">)</span>&nbsp;<span class="ident" id="3107374">Write</span><span class="op" id="3107379">(</span><span class="ident" id="3107380">p</span>&nbsp;<span class="op" id="3107382">[</span><span class="op" id="3107383">]</span><span class="builtintype" id="3107384">byte</span><span class="op" id="3107388">)</span>&nbsp;<span class="op" id="3107390">(</span><span class="ident" id="3107391">nn</span>&nbsp;<span class="builtintype" id="3107394">int</span><span class="op" id="3107397">,</span>&nbsp;<span class="ident" id="3107399">err</span>&nbsp;<span class="builtintype" id="3107403">error</span><span class="op" id="3107408">)</span>&nbsp;<span class="op" id="3107410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107413">for</span>&nbsp;<span class="builtinfunc" id="3107417">len</span><span class="op" id="3107420">(</span><span class="ident" id="3107421">p</span><span class="op" id="3107422">)</span>&nbsp;<span class="op" id="3107424">&gt;</span>&nbsp;<span class="ident" id="3107426">b</span><span class="op" id="3107427">.</span><span class="ident" id="3107428">Available</span><span class="op" id="3107437">(</span><span class="op" id="3107438">)</span>&nbsp;<span class="op" id="3107440">&amp;&amp;</span>&nbsp;<span class="ident" id="3107443">b</span><span class="op" id="3107444">.</span><span class="ident" id="3107445">err</span>&nbsp;<span class="op" id="3107449">==</span>&nbsp;<span class="ident" id="3107452">nil</span>&nbsp;<span class="op" id="3107456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107460">var</span>&nbsp;<span class="ident" id="3107464">n</span>&nbsp;<span class="builtintype" id="3107466">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107472">if</span>&nbsp;<span class="ident" id="3107475">b</span><span class="op" id="3107476">.</span><span class="ident" id="3107477">Buffered</span><span class="op" id="3107485">(</span><span class="op" id="3107486">)</span>&nbsp;<span class="op" id="3107488">==</span>&nbsp;<span class="num" id="3107491">0</span>&nbsp;<span class="op" id="3107493">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107498">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107531">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107574">n</span><span class="op" id="3107575">,</span>&nbsp;<span class="ident" id="3107577">b</span><span class="op" id="3107578">.</span><span class="ident" id="3107579">err</span>&nbsp;<span class="op" id="3107583">=</span>&nbsp;<span class="ident" id="3107585">b</span><span class="op" id="3107586">.</span><span class="ident" id="3107587">wr</span><span class="op" id="3107589">.</span><span class="ident" id="3107590">Write</span><span class="op" id="3107595">(</span><span class="ident" id="3107596">p</span><span class="op" id="3107597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107601">}</span>&nbsp;<span class="keyword" id="3107603">else</span>&nbsp;<span class="op" id="3107608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107613">n</span>&nbsp;<span class="op" id="3107615">=</span>&nbsp;<span class="builtinfunc" id="3107617">copy</span><span class="op" id="3107621">(</span><span class="ident" id="3107622">b</span><span class="op" id="3107623">.</span><span class="ident" id="3107624">buf</span><span class="op" id="3107627">[</span><span class="ident" id="3107628">b</span><span class="op" id="3107629">.</span><span class="ident" id="3107630">n</span><span class="op" id="3107631">:</span><span class="op" id="3107632">]</span><span class="op" id="3107633">,</span>&nbsp;<span class="ident" id="3107635">p</span><span class="op" id="3107636">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107641">b</span><span class="op" id="3107642">.</span><span class="ident" id="3107643">n</span>&nbsp;<span class="op" id="3107645">+=</span>&nbsp;<span class="ident" id="3107648">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107653">b</span><span class="op" id="3107654">.</span><span class="ident" id="3107655">flush</span><span class="op" id="3107660">(</span><span class="op" id="3107661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107669">nn</span>&nbsp;<span class="op" id="3107672">+=</span>&nbsp;<span class="ident" id="3107675">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107679">p</span>&nbsp;<span class="op" id="3107681">=</span>&nbsp;<span class="ident" id="3107683">p</span><span class="op" id="3107684">[</span><span class="ident" id="3107685">n</span><span class="op" id="3107686">:</span><span class="op" id="3107687">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107693">if</span>&nbsp;<span class="ident" id="3107696">b</span><span class="op" id="3107697">.</span><span class="ident" id="3107698">err</span>&nbsp;<span class="op" id="3107702">!=</span>&nbsp;<span class="ident" id="3107705">nil</span>&nbsp;<span class="op" id="3107709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107713">return</span>&nbsp;<span class="ident" id="3107720">nn</span><span class="op" id="3107722">,</span>&nbsp;<span class="ident" id="3107724">b</span><span class="op" id="3107725">.</span><span class="ident" id="3107726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107734">n</span>&nbsp;<span class="op" id="3107736">:=</span>&nbsp;<span class="builtinfunc" id="3107739">copy</span><span class="op" id="3107743">(</span><span class="ident" id="3107744">b</span><span class="op" id="3107745">.</span><span class="ident" id="3107746">buf</span><span class="op" id="3107749">[</span><span class="ident" id="3107750">b</span><span class="op" id="3107751">.</span><span class="ident" id="3107752">n</span><span class="op" id="3107753">:</span><span class="op" id="3107754">]</span><span class="op" id="3107755">,</span>&nbsp;<span class="ident" id="3107757">p</span><span class="op" id="3107758">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107761">b</span><span class="op" id="3107762">.</span><span class="ident" id="3107763">n</span>&nbsp;<span class="op" id="3107765">+=</span>&nbsp;<span class="ident" id="3107768">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107771">nn</span>&nbsp;<span class="op" id="3107774">+=</span>&nbsp;<span class="ident" id="3107777">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107780">return</span>&nbsp;<span class="ident" id="3107787">nn</span><span class="op" id="3107789">,</span>&nbsp;<span class="ident" id="3107791">nil</span><br>
<span class="lineno"></span><span class="op" id="3107795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3107798">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3107833">func</span>&nbsp;<span class="op" id="3107838">(</span><span class="ident" id="3107839">b</span>&nbsp;<span class="op" id="3107841">*</span><span class="ident" id="3107842">Writer</span><span class="op" id="3107848">)</span>&nbsp;<span class="ident" id="3107850">WriteByte</span><span class="op" id="3107859">(</span><span class="ident" id="3107860">c</span>&nbsp;<span class="builtintype" id="3107862">byte</span><span class="op" id="3107866">)</span>&nbsp;<span class="builtintype" id="3107868">error</span>&nbsp;<span class="op" id="3107874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107877">if</span>&nbsp;<span class="ident" id="3107880">b</span><span class="op" id="3107881">.</span><span class="ident" id="3107882">err</span>&nbsp;<span class="op" id="3107886">!=</span>&nbsp;<span class="ident" id="3107889">nil</span>&nbsp;<span class="op" id="3107893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107897">return</span>&nbsp;<span class="ident" id="3107904">b</span><span class="op" id="3107905">.</span><span class="ident" id="3107906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107911">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107914">if</span>&nbsp;<span class="ident" id="3107917">b</span><span class="op" id="3107918">.</span><span class="ident" id="3107919">Available</span><span class="op" id="3107928">(</span><span class="op" id="3107929">)</span>&nbsp;<span class="op" id="3107931">&lt;=</span>&nbsp;<span class="num" id="3107934">0</span>&nbsp;<span class="op" id="3107936">&amp;&amp;</span>&nbsp;<span class="ident" id="3107939">b</span><span class="op" id="3107940">.</span><span class="ident" id="3107941">flush</span><span class="op" id="3107946">(</span><span class="op" id="3107947">)</span>&nbsp;<span class="op" id="3107949">!=</span>&nbsp;<span class="ident" id="3107952">nil</span>&nbsp;<span class="op" id="3107956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107960">return</span>&nbsp;<span class="ident" id="3107967">b</span><span class="op" id="3107968">.</span><span class="ident" id="3107969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107977">b</span><span class="op" id="3107978">.</span><span class="ident" id="3107979">buf</span><span class="op" id="3107982">[</span><span class="ident" id="3107983">b</span><span class="op" id="3107984">.</span><span class="ident" id="3107985">n</span><span class="op" id="3107986">]</span>&nbsp;<span class="op" id="3107988">=</span>&nbsp;<span class="ident" id="3107990">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107993">b</span><span class="op" id="3107994">.</span><span class="ident" id="3107995">n</span><span class="op" id="3107996">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108000">return</span>&nbsp;<span class="ident" id="3108007">nil</span><br>
<span class="lineno"></span><span class="op" id="3108011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3108014">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="3108073">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="3108119">func</span>&nbsp;<span class="op" id="3108124">(</span><span class="ident" id="3108125">b</span>&nbsp;<span class="op" id="3108127">*</span><span class="ident" id="3108128">Writer</span><span class="op" id="3108134">)</span>&nbsp;<span class="ident" id="3108136">WriteRune</span><span class="op" id="3108145">(</span><span class="ident" id="3108146">r</span>&nbsp;<span class="builtintype" id="3108148">rune</span><span class="op" id="3108152">)</span>&nbsp;<span class="op" id="3108154">(</span><span class="ident" id="3108155">size</span>&nbsp;<span class="builtintype" id="3108160">int</span><span class="op" id="3108163">,</span>&nbsp;<span class="ident" id="3108165">err</span>&nbsp;<span class="builtintype" id="3108169">error</span><span class="op" id="3108174">)</span>&nbsp;<span class="op" id="3108176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108179">if</span>&nbsp;<span class="ident" id="3108182">r</span>&nbsp;<span class="op" id="3108184">&lt;</span>&nbsp;<span class="ident" id="3108186">utf8</span><span class="op" id="3108190">.</span><span class="ident" id="3108191">RuneSelf</span>&nbsp;<span class="op" id="3108200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108204">err</span>&nbsp;<span class="op" id="3108208">=</span>&nbsp;<span class="ident" id="3108210">b</span><span class="op" id="3108211">.</span><span class="ident" id="3108212">WriteByte</span><span class="op" id="3108221">(</span><span class="builtintype" id="3108222">byte</span><span class="op" id="3108226">(</span><span class="ident" id="3108227">r</span><span class="op" id="3108228">)</span><span class="op" id="3108229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108233">if</span>&nbsp;<span class="ident" id="3108236">err</span>&nbsp;<span class="op" id="3108240">!=</span>&nbsp;<span class="ident" id="3108243">nil</span>&nbsp;<span class="op" id="3108247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108252">return</span>&nbsp;<span class="num" id="3108259">0</span><span class="op" id="3108260">,</span>&nbsp;<span class="ident" id="3108262">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108272">return</span>&nbsp;<span class="num" id="3108279">1</span><span class="op" id="3108280">,</span>&nbsp;<span class="ident" id="3108282">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108290">if</span>&nbsp;<span class="ident" id="3108293">b</span><span class="op" id="3108294">.</span><span class="ident" id="3108295">err</span>&nbsp;<span class="op" id="3108299">!=</span>&nbsp;<span class="ident" id="3108302">nil</span>&nbsp;<span class="op" id="3108306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108310">return</span>&nbsp;<span class="num" id="3108317">0</span><span class="op" id="3108318">,</span>&nbsp;<span class="ident" id="3108320">b</span><span class="op" id="3108321">.</span><span class="ident" id="3108322">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108330">n</span>&nbsp;<span class="op" id="3108332">:=</span>&nbsp;<span class="ident" id="3108335">b</span><span class="op" id="3108336">.</span><span class="ident" id="3108337">Available</span><span class="op" id="3108346">(</span><span class="op" id="3108347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108350">if</span>&nbsp;<span class="ident" id="3108353">n</span>&nbsp;<span class="op" id="3108355">&lt;</span>&nbsp;<span class="ident" id="3108357">utf8</span><span class="op" id="3108361">.</span><span class="ident" id="3108362">UTFMax</span>&nbsp;<span class="op" id="3108369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108373">if</span>&nbsp;<span class="ident" id="3108376">b</span><span class="op" id="3108377">.</span><span class="ident" id="3108378">flush</span><span class="op" id="3108383">(</span><span class="op" id="3108384">)</span><span class="op" id="3108385">;</span>&nbsp;<span class="ident" id="3108387">b</span><span class="op" id="3108388">.</span><span class="ident" id="3108389">err</span>&nbsp;<span class="op" id="3108393">!=</span>&nbsp;<span class="ident" id="3108396">nil</span>&nbsp;<span class="op" id="3108400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108405">return</span>&nbsp;<span class="num" id="3108412">0</span><span class="op" id="3108413">,</span>&nbsp;<span class="ident" id="3108415">b</span><span class="op" id="3108416">.</span><span class="ident" id="3108417">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108427">n</span>&nbsp;<span class="op" id="3108429">=</span>&nbsp;<span class="ident" id="3108431">b</span><span class="op" id="3108432">.</span><span class="ident" id="3108433">Available</span><span class="op" id="3108442">(</span><span class="op" id="3108443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108447">if</span>&nbsp;<span class="ident" id="3108450">n</span>&nbsp;<span class="op" id="3108452">&lt;</span>&nbsp;<span class="ident" id="3108454">utf8</span><span class="op" id="3108458">.</span><span class="ident" id="3108459">UTFMax</span>&nbsp;<span class="op" id="3108466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3108471">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108519">return</span>&nbsp;<span class="ident" id="3108526">b</span><span class="op" id="3108527">.</span><span class="ident" id="3108528">WriteString</span><span class="op" id="3108539">(</span><span class="builtintype" id="3108540">string</span><span class="op" id="3108546">(</span><span class="ident" id="3108547">r</span><span class="op" id="3108548">)</span><span class="op" id="3108549">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108559">size</span>&nbsp;<span class="op" id="3108564">=</span>&nbsp;<span class="ident" id="3108566">utf8</span><span class="op" id="3108570">.</span><span class="ident" id="3108571">EncodeRune</span><span class="op" id="3108581">(</span><span class="ident" id="3108582">b</span><span class="op" id="3108583">.</span><span class="ident" id="3108584">buf</span><span class="op" id="3108587">[</span><span class="ident" id="3108588">b</span><span class="op" id="3108589">.</span><span class="ident" id="3108590">n</span><span class="op" id="3108591">:</span><span class="op" id="3108592">]</span><span class="op" id="3108593">,</span>&nbsp;<span class="ident" id="3108595">r</span><span class="op" id="3108596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108599">b</span><span class="op" id="3108600">.</span><span class="ident" id="3108601">n</span>&nbsp;<span class="op" id="3108603">+=</span>&nbsp;<span class="ident" id="3108606">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108612">return</span>&nbsp;<span class="ident" id="3108619">size</span><span class="op" id="3108623">,</span>&nbsp;<span class="ident" id="3108625">nil</span><br>
<span class="lineno">620</span><span class="op" id="3108629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3108632">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3108664">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3108707">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="3108780">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3108807">func</span>&nbsp;<span class="op" id="3108812">(</span><span class="ident" id="3108813">b</span>&nbsp;<span class="op" id="3108815">*</span><span class="ident" id="3108816">Writer</span><span class="op" id="3108822">)</span>&nbsp;<span class="ident" id="3108824">WriteString</span><span class="op" id="3108835">(</span><span class="ident" id="3108836">s</span>&nbsp;<span class="builtintype" id="3108838">string</span><span class="op" id="3108844">)</span>&nbsp;<span class="op" id="3108846">(</span><span class="builtintype" id="3108847">int</span><span class="op" id="3108850">,</span>&nbsp;<span class="builtintype" id="3108852">error</span><span class="op" id="3108857">)</span>&nbsp;<span class="op" id="3108859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108862">nn</span>&nbsp;<span class="op" id="3108865">:=</span>&nbsp;<span class="num" id="3108868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108871">for</span>&nbsp;<span class="builtinfunc" id="3108875">len</span><span class="op" id="3108878">(</span><span class="ident" id="3108879">s</span><span class="op" id="3108880">)</span>&nbsp;<span class="op" id="3108882">&gt;</span>&nbsp;<span class="ident" id="3108884">b</span><span class="op" id="3108885">.</span><span class="ident" id="3108886">Available</span><span class="op" id="3108895">(</span><span class="op" id="3108896">)</span>&nbsp;<span class="op" id="3108898">&amp;&amp;</span>&nbsp;<span class="ident" id="3108901">b</span><span class="op" id="3108902">.</span><span class="ident" id="3108903">err</span>&nbsp;<span class="op" id="3108907">==</span>&nbsp;<span class="ident" id="3108910">nil</span>&nbsp;<span class="op" id="3108914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108918">n</span>&nbsp;<span class="op" id="3108920">:=</span>&nbsp;<span class="builtinfunc" id="3108923">copy</span><span class="op" id="3108927">(</span><span class="ident" id="3108928">b</span><span class="op" id="3108929">.</span><span class="ident" id="3108930">buf</span><span class="op" id="3108933">[</span><span class="ident" id="3108934">b</span><span class="op" id="3108935">.</span><span class="ident" id="3108936">n</span><span class="op" id="3108937">:</span><span class="op" id="3108938">]</span><span class="op" id="3108939">,</span>&nbsp;<span class="ident" id="3108941">s</span><span class="op" id="3108942">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108946">b</span><span class="op" id="3108947">.</span><span class="ident" id="3108948">n</span>&nbsp;<span class="op" id="3108950">+=</span>&nbsp;<span class="ident" id="3108953">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108957">nn</span>&nbsp;<span class="op" id="3108960">+=</span>&nbsp;<span class="ident" id="3108963">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108967">s</span>&nbsp;<span class="op" id="3108969">=</span>&nbsp;<span class="ident" id="3108971">s</span><span class="op" id="3108972">[</span><span class="ident" id="3108973">n</span><span class="op" id="3108974">:</span><span class="op" id="3108975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108979">b</span><span class="op" id="3108980">.</span><span class="ident" id="3108981">flush</span><span class="op" id="3108986">(</span><span class="op" id="3108987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108990">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108993">if</span>&nbsp;<span class="ident" id="3108996">b</span><span class="op" id="3108997">.</span><span class="ident" id="3108998">err</span>&nbsp;<span class="op" id="3109002">!=</span>&nbsp;<span class="ident" id="3109005">nil</span>&nbsp;<span class="op" id="3109009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109013">return</span>&nbsp;<span class="ident" id="3109020">nn</span><span class="op" id="3109022">,</span>&nbsp;<span class="ident" id="3109024">b</span><span class="op" id="3109025">.</span><span class="ident" id="3109026">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109034">n</span>&nbsp;<span class="op" id="3109036">:=</span>&nbsp;<span class="builtinfunc" id="3109039">copy</span><span class="op" id="3109043">(</span><span class="ident" id="3109044">b</span><span class="op" id="3109045">.</span><span class="ident" id="3109046">buf</span><span class="op" id="3109049">[</span><span class="ident" id="3109050">b</span><span class="op" id="3109051">.</span><span class="ident" id="3109052">n</span><span class="op" id="3109053">:</span><span class="op" id="3109054">]</span><span class="op" id="3109055">,</span>&nbsp;<span class="ident" id="3109057">s</span><span class="op" id="3109058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109061">b</span><span class="op" id="3109062">.</span><span class="ident" id="3109063">n</span>&nbsp;<span class="op" id="3109065">+=</span>&nbsp;<span class="ident" id="3109068">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109071">nn</span>&nbsp;<span class="op" id="3109074">+=</span>&nbsp;<span class="ident" id="3109077">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109080">return</span>&nbsp;<span class="ident" id="3109087">nn</span><span class="op" id="3109089">,</span>&nbsp;<span class="ident" id="3109091">nil</span><br>
<span class="lineno"></span><span class="op" id="3109095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3109098">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="3109136">func</span>&nbsp;<span class="op" id="3109141">(</span><span class="ident" id="3109142">b</span>&nbsp;<span class="op" id="3109144">*</span><span class="ident" id="3109145">Writer</span><span class="op" id="3109151">)</span>&nbsp;<span class="ident" id="3109153">ReadFrom</span><span class="op" id="3109161">(</span><span class="ident" id="3109162">r</span>&nbsp;<span class="ident" id="3109164">io</span><span class="op" id="3109166">.</span><span class="ident" id="3109167">Reader</span><span class="op" id="3109173">)</span>&nbsp;<span class="op" id="3109175">(</span><span class="ident" id="3109176">n</span>&nbsp;<span class="ident" id="3109178">int64</span><span class="op" id="3109183">,</span>&nbsp;<span class="ident" id="3109185">err</span>&nbsp;<span class="builtintype" id="3109189">error</span><span class="op" id="3109194">)</span>&nbsp;<span class="op" id="3109196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109199">if</span>&nbsp;<span class="ident" id="3109202">b</span><span class="op" id="3109203">.</span><span class="ident" id="3109204">Buffered</span><span class="op" id="3109212">(</span><span class="op" id="3109213">)</span>&nbsp;<span class="op" id="3109215">==</span>&nbsp;<span class="num" id="3109218">0</span>&nbsp;<span class="op" id="3109220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109224">if</span>&nbsp;<span class="ident" id="3109227">w</span><span class="op" id="3109228">,</span>&nbsp;<span class="ident" id="3109230">ok</span>&nbsp;<span class="op" id="3109233">:=</span>&nbsp;<span class="ident" id="3109236">b</span><span class="op" id="3109237">.</span><span class="ident" id="3109238">wr</span><span class="op" id="3109240">.</span><span class="op" id="3109241">(</span><span class="ident" id="3109242">io</span><span class="op" id="3109244">.</span><span class="ident" id="3109245">ReaderFrom</span><span class="op" id="3109255">)</span><span class="op" id="3109256">;</span>&nbsp;<span class="ident" id="3109258">ok</span>&nbsp;<span class="op" id="3109261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109266">return</span>&nbsp;<span class="ident" id="3109273">w</span><span class="op" id="3109274">.</span><span class="ident" id="3109275">ReadFrom</span><span class="op" id="3109283">(</span><span class="ident" id="3109284">r</span><span class="op" id="3109285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109289">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109295">var</span>&nbsp;<span class="ident" id="3109299">m</span>&nbsp;<span class="builtintype" id="3109301">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109306">for</span>&nbsp;<span class="op" id="3109310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109314">if</span>&nbsp;<span class="ident" id="3109317">b</span><span class="op" id="3109318">.</span><span class="ident" id="3109319">Available</span><span class="op" id="3109328">(</span><span class="op" id="3109329">)</span>&nbsp;<span class="op" id="3109331">==</span>&nbsp;<span class="num" id="3109334">0</span>&nbsp;<span class="op" id="3109336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109341">if</span>&nbsp;<span class="ident" id="3109344">err1</span>&nbsp;<span class="op" id="3109349">:=</span>&nbsp;<span class="ident" id="3109352">b</span><span class="op" id="3109353">.</span><span class="ident" id="3109354">flush</span><span class="op" id="3109359">(</span><span class="op" id="3109360">)</span><span class="op" id="3109361">;</span>&nbsp;<span class="ident" id="3109363">err1</span>&nbsp;<span class="op" id="3109368">!=</span>&nbsp;<span class="ident" id="3109371">nil</span>&nbsp;<span class="op" id="3109375">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109381">return</span>&nbsp;<span class="ident" id="3109388">n</span><span class="op" id="3109389">,</span>&nbsp;<span class="ident" id="3109391">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109407">nr</span>&nbsp;<span class="op" id="3109410">:=</span>&nbsp;<span class="num" id="3109413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109417">for</span>&nbsp;<span class="ident" id="3109421">nr</span>&nbsp;<span class="op" id="3109424">&lt;</span>&nbsp;<span class="ident" id="3109426">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3109451">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109456">m</span><span class="op" id="3109457">,</span>&nbsp;<span class="ident" id="3109459">err</span>&nbsp;<span class="op" id="3109463">=</span>&nbsp;<span class="ident" id="3109465">r</span><span class="op" id="3109466">.</span><span class="ident" id="3109467">Read</span><span class="op" id="3109471">(</span><span class="ident" id="3109472">b</span><span class="op" id="3109473">.</span><span class="ident" id="3109474">buf</span><span class="op" id="3109477">[</span><span class="ident" id="3109478">b</span><span class="op" id="3109479">.</span><span class="ident" id="3109480">n</span><span class="op" id="3109481">:</span><span class="op" id="3109482">]</span><span class="op" id="3109483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109488">if</span>&nbsp;<span class="ident" id="3109491">m</span>&nbsp;<span class="op" id="3109493">!=</span>&nbsp;<span class="num" id="3109496">0</span>&nbsp;<span class="op" id="3109498">||</span>&nbsp;<span class="ident" id="3109501">err</span>&nbsp;<span class="op" id="3109505">!=</span>&nbsp;<span class="ident" id="3109508">nil</span>&nbsp;<span class="op" id="3109512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109518">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109532">nr</span><span class="op" id="3109534">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109543">if</span>&nbsp;<span class="ident" id="3109546">nr</span>&nbsp;<span class="op" id="3109549">==</span>&nbsp;<span class="ident" id="3109552">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3109577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109582">return</span>&nbsp;<span class="ident" id="3109589">n</span><span class="op" id="3109590">,</span>&nbsp;<span class="ident" id="3109592">io</span><span class="op" id="3109594">.</span><span class="ident" id="3109595">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109615">b</span><span class="op" id="3109616">.</span><span class="ident" id="3109617">n</span>&nbsp;<span class="op" id="3109619">+=</span>&nbsp;<span class="ident" id="3109622">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109626">n</span>&nbsp;<span class="op" id="3109628">+=</span>&nbsp;<span class="ident" id="3109631">int64</span><span class="op" id="3109636">(</span><span class="ident" id="3109637">m</span><span class="op" id="3109638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109642">if</span>&nbsp;<span class="ident" id="3109645">err</span>&nbsp;<span class="op" id="3109649">!=</span>&nbsp;<span class="ident" id="3109652">nil</span>&nbsp;<span class="op" id="3109656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109661">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109672">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109675">if</span>&nbsp;<span class="ident" id="3109678">err</span>&nbsp;<span class="op" id="3109682">==</span>&nbsp;<span class="ident" id="3109685">io</span><span class="op" id="3109687">.</span><span class="ident" id="3109688">EOF</span>&nbsp;<span class="op" id="3109692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3109696">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109755">if</span>&nbsp;<span class="ident" id="3109758">b</span><span class="op" id="3109759">.</span><span class="ident" id="3109760">Available</span><span class="op" id="3109769">(</span><span class="op" id="3109770">)</span>&nbsp;<span class="op" id="3109772">==</span>&nbsp;<span class="num" id="3109775">0</span>&nbsp;<span class="op" id="3109777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109782">err</span>&nbsp;<span class="op" id="3109786">=</span>&nbsp;<span class="ident" id="3109788">b</span><span class="op" id="3109789">.</span><span class="ident" id="3109790">flush</span><span class="op" id="3109795">(</span><span class="op" id="3109796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109800">}</span>&nbsp;<span class="keyword" id="3109802">else</span>&nbsp;<span class="op" id="3109807">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109812">err</span>&nbsp;<span class="op" id="3109816">=</span>&nbsp;<span class="ident" id="3109818">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109830">return</span>&nbsp;<span class="ident" id="3109837">n</span><span class="op" id="3109838">,</span>&nbsp;<span class="ident" id="3109840">err</span><br>
<span class="lineno"></span><span class="op" id="3109844">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3109847">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3109877">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3109933">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="3109965">type</span>&nbsp;<span class="ident" id="3109970">ReadWriter</span>&nbsp;<span class="keyword" id="3109981">struct</span>&nbsp;<span class="op" id="3109988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109991">*</span><span class="ident" id="3109992">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110000">*</span><span class="ident" id="3110001">Writer</span><br>
<span class="lineno"></span><span class="op" id="3110008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3110011">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3110083">func</span>&nbsp;<span class="ident" id="3110088">NewReadWriter</span><span class="op" id="3110101">(</span><span class="ident" id="3110102">r</span>&nbsp;<span class="op" id="3110104">*</span><span class="ident" id="3110105">Reader</span><span class="op" id="3110111">,</span>&nbsp;<span class="ident" id="3110113">w</span>&nbsp;<span class="op" id="3110115">*</span><span class="ident" id="3110116">Writer</span><span class="op" id="3110122">)</span>&nbsp;<span class="op" id="3110124">*</span><span class="ident" id="3110125">ReadWriter</span>&nbsp;<span class="op" id="3110136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110139">return</span>&nbsp;<span class="op" id="3110146">&amp;</span><span class="ident" id="3110147">ReadWriter</span><span class="op" id="3110157">{</span><span class="ident" id="3110158">r</span><span class="op" id="3110159">,</span>&nbsp;<span class="ident" id="3110161">w</span><span class="op" id="3110162">}</span><br>
<span class="lineno"></span><span class="op" id="3110164">}</span>
</div>
</body>
</html>
