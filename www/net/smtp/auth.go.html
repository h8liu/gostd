<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5182518">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5182573">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5182627">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5182678">package</span>&nbsp;<span class="ident" id="5182686">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5182692">import</span>&nbsp;<span class="op" id="5182699">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5182702">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5182717">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5182731">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5182741">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5182747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182750">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5182810">type</span>&nbsp;<span class="ident" id="5182815">Auth</span>&nbsp;<span class="keyword" id="5182820">interface</span>&nbsp;<span class="op" id="5182830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182833">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182883">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182938">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183001">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183063">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183110">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183168">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183226">Start</span><span class="op" id="5183231">(</span><span class="ident" id="5183232">server</span>&nbsp;<span class="op" id="5183239">*</span><span class="ident" id="5183240"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="5183250">)</span>&nbsp;<span class="op" id="5183252">(</span><span class="ident" id="5183253">proto</span>&nbsp;<span class="builtintype" id="5183259">string</span><span class="op" id="5183265">,</span>&nbsp;<span class="ident" id="5183267">toServer</span>&nbsp;<span class="op" id="5183276">[</span><span class="op" id="5183277">]</span><span class="builtintype" id="5183278">byte</span><span class="op" id="5183282">,</span>&nbsp;<span class="ident" id="5183284">err</span>&nbsp;<span class="builtintype" id="5183288">error</span><span class="op" id="5183293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183297">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183361">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183424">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183486">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183526">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183586">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183644">Next</span><span class="op" id="5183648">(</span><span class="ident" id="5183649">fromServer</span>&nbsp;<span class="op" id="5183660">[</span><span class="op" id="5183661">]</span><span class="builtintype" id="5183662">byte</span><span class="op" id="5183666">,</span>&nbsp;<span class="ident" id="5183668">more</span>&nbsp;<span class="builtintype" id="5183673">bool</span><span class="op" id="5183677">)</span>&nbsp;<span class="op" id="5183679">(</span><span class="ident" id="5183680">toServer</span>&nbsp;<span class="op" id="5183689">[</span><span class="op" id="5183690">]</span><span class="builtintype" id="5183691">byte</span><span class="op" id="5183695">,</span>&nbsp;<span class="ident" id="5183697">err</span>&nbsp;<span class="builtintype" id="5183701">error</span><span class="op" id="5183706">)</span><br>
<span class="lineno"></span><span class="op" id="5183708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5183711">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5183767">type</span>&nbsp;<span class="ident" id="5183772">ServerInfo</span>&nbsp;<span class="keyword" id="5183783">struct</span>&nbsp;<span class="op" id="5183790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183793">Name</span>&nbsp;<span class="builtintype" id="5183798">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5183807">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183828">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5183833">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183842">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183889">Auth</span>&nbsp;<span class="op" id="5183894">[</span><span class="op" id="5183895">]</span><span class="builtintype" id="5183896">string</span>&nbsp;<span class="comment" id="5183903">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5183943">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5183946">type</span>&nbsp;<span class="ident" id="5183951">plainAuth</span>&nbsp;<span class="keyword" id="5183961">struct</span>&nbsp;<span class="op" id="5183968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183971">identity</span><span class="op" id="5183979">,</span>&nbsp;<span class="ident" id="5183981">username</span><span class="op" id="5183989">,</span>&nbsp;<span class="ident" id="5183991">password</span>&nbsp;<span class="builtintype" id="5184000">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184008">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5184037">string</span><br>
<span class="lineno"></span><span class="op" id="5184044">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5184047">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5184117">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5184154">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5184228">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5184304">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5184338">func</span>&nbsp;<span class="ident" id="5184343">PlainAuth</span><span class="op" id="5184352">(</span><span class="ident" id="5184353">identity</span><span class="op" id="5184361">,</span>&nbsp;<span class="ident" id="5184363">username</span><span class="op" id="5184371">,</span>&nbsp;<span class="ident" id="5184373">password</span><span class="op" id="5184381">,</span>&nbsp;<span class="ident" id="5184383">host</span>&nbsp;<span class="builtintype" id="5184388">string</span><span class="op" id="5184394">)</span>&nbsp;<span class="ident" id="5184396"><a href="/net/smtp/auth.go.html#5182815">Auth</a></span>&nbsp;<span class="op" id="5184401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184404">return</span>&nbsp;<span class="op" id="5184411">&amp;</span><span class="ident" id="5184412"><a href="/net/smtp/auth.go.html#5183951">plainAuth</a></span><span class="op" id="5184421">{</span><span class="ident" id="5184422"><a href="/net/smtp/auth.go.html#5184353">identity</a></span><span class="op" id="5184430">,</span>&nbsp;<span class="ident" id="5184432"><a href="/net/smtp/auth.go.html#5184363">username</a></span><span class="op" id="5184440">,</span>&nbsp;<span class="ident" id="5184442"><a href="/net/smtp/auth.go.html#5184373">password</a></span><span class="op" id="5184450">,</span>&nbsp;<span class="ident" id="5184452"><a href="/net/smtp/auth.go.html#5184383">host</a></span><span class="op" id="5184456">}</span><br>
<span class="lineno"></span><span class="op" id="5184458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5184461">func</span>&nbsp;<span class="op" id="5184466">(</span><span class="ident" id="5184467">a</span>&nbsp;<span class="op" id="5184469">*</span><span class="ident" id="5184470"><a href="/net/smtp/auth.go.html#5183951">plainAuth</a></span><span class="op" id="5184479">)</span>&nbsp;<span class="ident" id="5184481">Start</span><span class="op" id="5184486">(</span><span class="ident" id="5184487">server</span>&nbsp;<span class="op" id="5184494">*</span><span class="ident" id="5184495"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="5184505">)</span>&nbsp;<span class="op" id="5184507">(</span><span class="builtintype" id="5184508">string</span><span class="op" id="5184514">,</span>&nbsp;<span class="op" id="5184516">[</span><span class="op" id="5184517">]</span><span class="builtintype" id="5184518">byte</span><span class="op" id="5184522">,</span>&nbsp;<span class="builtintype" id="5184524">error</span><span class="op" id="5184529">)</span>&nbsp;<span class="op" id="5184531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184534">if</span>&nbsp;<span class="op" id="5184537">!</span><span class="ident" id="5184538"><a href="/net/smtp/auth.go.html#5184487">server</a></span><span class="op" id="5184544">.</span><span class="ident" id="5184545">TLS</span>&nbsp;<span class="op" id="5184549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184553">advertised</span>&nbsp;<span class="op" id="5184564">:=</span>&nbsp;<span class="ident" id="5184567">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184575">for</span>&nbsp;<span class="ident" id="5184579">_</span><span class="op" id="5184580">,</span>&nbsp;<span class="ident" id="5184582">mechanism</span>&nbsp;<span class="op" id="5184592">:=</span>&nbsp;<span class="keyword" id="5184595">range</span>&nbsp;<span class="ident" id="5184601"><a href="/net/smtp/auth.go.html#5184487">server</a></span><span class="op" id="5184607">.</span><span class="ident" id="5184608">Auth</span>&nbsp;<span class="op" id="5184613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184618">if</span>&nbsp;<span class="ident" id="5184621"><a href="/net/smtp/auth.go.html#5184582">mechanism</a></span>&nbsp;<span class="op" id="5184631">==</span>&nbsp;<span class="string" id="5184634">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5184642">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184648"><a href="/net/smtp/auth.go.html#5184553">advertised</a></span>&nbsp;<span class="op" id="5184659">=</span>&nbsp;<span class="ident" id="5184661">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184670">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184687">if</span>&nbsp;<span class="op" id="5184690">!</span><span class="ident" id="5184691"><a href="/net/smtp/auth.go.html#5184553">advertised</a></span>&nbsp;<span class="op" id="5184702">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184707">return</span>&nbsp;<span class="string" id="5184714">&#34;&#34;</span><span class="op" id="5184716">,</span>&nbsp;<span class="ident" id="5184718">nil</span><span class="op" id="5184721">,</span>&nbsp;<span class="ident" id="5184723"><a href="/net/smtp/auth.go.html#5182731">errors</a></span><span class="op" id="5184729">.</span><span class="ident" id="5184730">New</span><span class="op" id="5184733">(</span><span class="string" id="5184734">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5184758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184768">if</span>&nbsp;<span class="ident" id="5184771"><a href="/net/smtp/auth.go.html#5184487">server</a></span><span class="op" id="5184777">.</span><span class="ident" id="5184778">Name</span>&nbsp;<span class="op" id="5184783">!=</span>&nbsp;<span class="ident" id="5184786"><a href="/net/smtp/auth.go.html#5184467">a</a></span><span class="op" id="5184787">.</span><span class="ident" id="5184788">host</span>&nbsp;<span class="op" id="5184793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184797">return</span>&nbsp;<span class="string" id="5184804">&#34;&#34;</span><span class="op" id="5184806">,</span>&nbsp;<span class="ident" id="5184808">nil</span><span class="op" id="5184811">,</span>&nbsp;<span class="ident" id="5184813"><a href="/net/smtp/auth.go.html#5182731">errors</a></span><span class="op" id="5184819">.</span><span class="ident" id="5184820">New</span><span class="op" id="5184823">(</span><span class="string" id="5184824">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5184841">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184847">resp</span>&nbsp;<span class="op" id="5184852">:=</span>&nbsp;<span class="op" id="5184855">[</span><span class="op" id="5184856">]</span><span class="builtintype" id="5184857">byte</span><span class="op" id="5184861">(</span><span class="ident" id="5184862"><a href="/net/smtp/auth.go.html#5184467">a</a></span><span class="op" id="5184863">.</span><span class="ident" id="5184864">identity</span>&nbsp;<span class="op" id="5184873">+</span>&nbsp;<span class="string" id="5184875">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5184882">+</span>&nbsp;<span class="ident" id="5184884"><a href="/net/smtp/auth.go.html#5184467">a</a></span><span class="op" id="5184885">.</span><span class="ident" id="5184886">username</span>&nbsp;<span class="op" id="5184895">+</span>&nbsp;<span class="string" id="5184897">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5184904">+</span>&nbsp;<span class="ident" id="5184906"><a href="/net/smtp/auth.go.html#5184467">a</a></span><span class="op" id="5184907">.</span><span class="ident" id="5184908">password</span><span class="op" id="5184916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184919">return</span>&nbsp;<span class="string" id="5184926">&#34;PLAIN&#34;</span><span class="op" id="5184933">,</span>&nbsp;<span class="ident" id="5184935"><a href="/net/smtp/auth.go.html#5184847">resp</a></span><span class="op" id="5184939">,</span>&nbsp;<span class="ident" id="5184941">nil</span><br>
<span class="lineno"></span><span class="op" id="5184945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5184948">func</span>&nbsp;<span class="op" id="5184953">(</span><span class="ident" id="5184954">a</span>&nbsp;<span class="op" id="5184956">*</span><span class="ident" id="5184957"><a href="/net/smtp/auth.go.html#5183951">plainAuth</a></span><span class="op" id="5184966">)</span>&nbsp;<span class="ident" id="5184968">Next</span><span class="op" id="5184972">(</span><span class="ident" id="5184973">fromServer</span>&nbsp;<span class="op" id="5184984">[</span><span class="op" id="5184985">]</span><span class="builtintype" id="5184986">byte</span><span class="op" id="5184990">,</span>&nbsp;<span class="ident" id="5184992">more</span>&nbsp;<span class="builtintype" id="5184997">bool</span><span class="op" id="5185001">)</span>&nbsp;<span class="op" id="5185003">(</span><span class="op" id="5185004">[</span><span class="op" id="5185005">]</span><span class="builtintype" id="5185006">byte</span><span class="op" id="5185010">,</span>&nbsp;<span class="builtintype" id="5185012">error</span><span class="op" id="5185017">)</span>&nbsp;<span class="op" id="5185019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185022">if</span>&nbsp;<span class="ident" id="5185025"><a href="/net/smtp/auth.go.html#5184992">more</a></span>&nbsp;<span class="op" id="5185030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185034">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185070">return</span>&nbsp;<span class="ident" id="5185077">nil</span><span class="op" id="5185080">,</span>&nbsp;<span class="ident" id="5185082"><a href="/net/smtp/auth.go.html#5182731">errors</a></span><span class="op" id="5185088">.</span><span class="ident" id="5185089">New</span><span class="op" id="5185092">(</span><span class="string" id="5185093">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5185122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185125">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185128">return</span>&nbsp;<span class="ident" id="5185135">nil</span><span class="op" id="5185138">,</span>&nbsp;<span class="ident" id="5185140">nil</span><br>
<span class="lineno"></span><span class="op" id="5185144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5185147">type</span>&nbsp;<span class="ident" id="5185152">cramMD5Auth</span>&nbsp;<span class="keyword" id="5185164">struct</span>&nbsp;<span class="op" id="5185171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185174">username</span><span class="op" id="5185182">,</span>&nbsp;<span class="ident" id="5185184">secret</span>&nbsp;<span class="builtintype" id="5185191">string</span><br>
<span class="lineno">85</span><span class="op" id="5185198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185201">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5185276">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5185313">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5185385">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5185442">func</span>&nbsp;<span class="ident" id="5185447">CRAMMD5Auth</span><span class="op" id="5185458">(</span><span class="ident" id="5185459">username</span><span class="op" id="5185467">,</span>&nbsp;<span class="ident" id="5185469">secret</span>&nbsp;<span class="builtintype" id="5185476">string</span><span class="op" id="5185482">)</span>&nbsp;<span class="ident" id="5185484"><a href="/net/smtp/auth.go.html#5182815">Auth</a></span>&nbsp;<span class="op" id="5185489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185492">return</span>&nbsp;<span class="op" id="5185499">&amp;</span><span class="ident" id="5185500"><a href="/net/smtp/auth.go.html#5185152">cramMD5Auth</a></span><span class="op" id="5185511">{</span><span class="ident" id="5185512"><a href="/net/smtp/auth.go.html#5185459">username</a></span><span class="op" id="5185520">,</span>&nbsp;<span class="ident" id="5185522"><a href="/net/smtp/auth.go.html#5185469">secret</a></span><span class="op" id="5185528">}</span><br>
<span class="lineno"></span><span class="op" id="5185530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5185533">func</span>&nbsp;<span class="op" id="5185538">(</span><span class="ident" id="5185539">a</span>&nbsp;<span class="op" id="5185541">*</span><span class="ident" id="5185542"><a href="/net/smtp/auth.go.html#5185152">cramMD5Auth</a></span><span class="op" id="5185553">)</span>&nbsp;<span class="ident" id="5185555">Start</span><span class="op" id="5185560">(</span><span class="ident" id="5185561">server</span>&nbsp;<span class="op" id="5185568">*</span><span class="ident" id="5185569"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="5185579">)</span>&nbsp;<span class="op" id="5185581">(</span><span class="builtintype" id="5185582">string</span><span class="op" id="5185588">,</span>&nbsp;<span class="op" id="5185590">[</span><span class="op" id="5185591">]</span><span class="builtintype" id="5185592">byte</span><span class="op" id="5185596">,</span>&nbsp;<span class="builtintype" id="5185598">error</span><span class="op" id="5185603">)</span>&nbsp;<span class="op" id="5185605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185608">return</span>&nbsp;<span class="string" id="5185615">&#34;CRAM-MD5&#34;</span><span class="op" id="5185625">,</span>&nbsp;<span class="ident" id="5185627">nil</span><span class="op" id="5185630">,</span>&nbsp;<span class="ident" id="5185632">nil</span><br>
<span class="lineno"></span><span class="op" id="5185636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5185639">func</span>&nbsp;<span class="op" id="5185644">(</span><span class="ident" id="5185645">a</span>&nbsp;<span class="op" id="5185647">*</span><span class="ident" id="5185648"><a href="/net/smtp/auth.go.html#5185152">cramMD5Auth</a></span><span class="op" id="5185659">)</span>&nbsp;<span class="ident" id="5185661">Next</span><span class="op" id="5185665">(</span><span class="ident" id="5185666">fromServer</span>&nbsp;<span class="op" id="5185677">[</span><span class="op" id="5185678">]</span><span class="builtintype" id="5185679">byte</span><span class="op" id="5185683">,</span>&nbsp;<span class="ident" id="5185685">more</span>&nbsp;<span class="builtintype" id="5185690">bool</span><span class="op" id="5185694">)</span>&nbsp;<span class="op" id="5185696">(</span><span class="op" id="5185697">[</span><span class="op" id="5185698">]</span><span class="builtintype" id="5185699">byte</span><span class="op" id="5185703">,</span>&nbsp;<span class="builtintype" id="5185705">error</span><span class="op" id="5185710">)</span>&nbsp;<span class="op" id="5185712">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185715">if</span>&nbsp;<span class="ident" id="5185718"><a href="/net/smtp/auth.go.html#5185685">more</a></span>&nbsp;<span class="op" id="5185723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185727">d</span>&nbsp;<span class="op" id="5185729">:=</span>&nbsp;<span class="ident" id="5185732"><a href="/net/smtp/auth.go.html#5182702">hmac</a></span><span class="op" id="5185736">.</span><span class="ident" id="5185737">New</span><span class="op" id="5185740">(</span><span class="ident" id="5185741"><a href="/net/smtp/auth.go.html#5182717">md5</a></span><span class="op" id="5185744">.</span><span class="ident" id="5185745">New</span><span class="op" id="5185748">,</span>&nbsp;<span class="op" id="5185750">[</span><span class="op" id="5185751">]</span><span class="builtintype" id="5185752">byte</span><span class="op" id="5185756">(</span><span class="ident" id="5185757"><a href="/net/smtp/auth.go.html#5185645">a</a></span><span class="op" id="5185758">.</span><span class="ident" id="5185759">secret</span><span class="op" id="5185765">)</span><span class="op" id="5185766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185770"><a href="/net/smtp/auth.go.html#5185727">d</a></span><span class="op" id="5185771">.</span><span class="ident" id="5185772">Write</span><span class="op" id="5185777">(</span><span class="ident" id="5185778"><a href="/net/smtp/auth.go.html#5185666">fromServer</a></span><span class="op" id="5185788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185792">s</span>&nbsp;<span class="op" id="5185794">:=</span>&nbsp;<span class="builtinfunc" id="5185797">make</span><span class="op" id="5185801">(</span><span class="op" id="5185802">[</span><span class="op" id="5185803">]</span><span class="builtintype" id="5185804">byte</span><span class="op" id="5185808">,</span>&nbsp;<span class="num" id="5185810">0</span><span class="op" id="5185811">,</span>&nbsp;<span class="ident" id="5185813"><a href="/net/smtp/auth.go.html#5185727">d</a></span><span class="op" id="5185814">.</span><span class="ident" id="5185815">Size</span><span class="op" id="5185819">(</span><span class="op" id="5185820">)</span><span class="op" id="5185821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185825">return</span>&nbsp;<span class="op" id="5185832">[</span><span class="op" id="5185833">]</span><span class="builtintype" id="5185834">byte</span><span class="op" id="5185838">(</span><span class="ident" id="5185839"><a href="/net/smtp/auth.go.html#5182741">fmt</a></span><span class="op" id="5185842">.</span><span class="ident" id="5185843">Sprintf</span><span class="op" id="5185850">(</span><span class="string" id="5185851">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5185858">,</span>&nbsp;<span class="ident" id="5185860"><a href="/net/smtp/auth.go.html#5185645">a</a></span><span class="op" id="5185861">.</span><span class="ident" id="5185862">username</span><span class="op" id="5185870">,</span>&nbsp;<span class="ident" id="5185872"><a href="/net/smtp/auth.go.html#5185727">d</a></span><span class="op" id="5185873">.</span><span class="ident" id="5185874">Sum</span><span class="op" id="5185877">(</span><span class="ident" id="5185878"><a href="/net/smtp/auth.go.html#5185792">s</a></span><span class="op" id="5185879">)</span><span class="op" id="5185880">)</span><span class="op" id="5185881">)</span><span class="op" id="5185882">,</span>&nbsp;<span class="ident" id="5185884">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185892">return</span>&nbsp;<span class="ident" id="5185899">nil</span><span class="op" id="5185902">,</span>&nbsp;<span class="ident" id="5185904">nil</span><br>
<span class="lineno"></span><span class="op" id="5185908">}</span>
</div>
</body>
</html>
