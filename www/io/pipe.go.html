<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1422615">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1422670">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1422724">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1422775">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1422830">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1422868">package</span>&nbsp;<span class="ident" id="1422876">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1422880">import</span>&nbsp;<span class="op" id="1422887">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1422890">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1422900">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1422907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1422910">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1422992">var</span>&nbsp;<span class="ident" id="1422996">ErrClosedPipe</span>&nbsp;<span class="op" id="1423010">=</span>&nbsp;<span class="ident" id="1423012">errors</span><span class="op" id="1423018">.</span><span class="ident" id="1423019">New</span><span class="op" id="1423022">(</span><span class="string" id="1423023">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1423054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1423057">type</span>&nbsp;<span class="ident" id="1423062">pipeResult</span>&nbsp;<span class="keyword" id="1423073">struct</span>&nbsp;<span class="op" id="1423080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423083">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1423087">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423092">err</span>&nbsp;<span class="builtintype" id="1423096">error</span><br>
<span class="lineno"></span><span class="op" id="1423102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423105">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1423182">type</span>&nbsp;<span class="ident" id="1423187">pipe</span>&nbsp;<span class="keyword" id="1423192">struct</span>&nbsp;<span class="op" id="1423199">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423202">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1423208">sync</span><span class="op" id="1423212">.</span><span class="ident" id="1423213">Mutex</span>&nbsp;<span class="comment" id="1423219">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423251">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1423257">sync</span><span class="op" id="1423261">.</span><span class="ident" id="1423262">Mutex</span>&nbsp;<span class="comment" id="1423268">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423300">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1423306">sync</span><span class="op" id="1423310">.</span><span class="ident" id="1423311">Mutex</span>&nbsp;<span class="comment" id="1423317">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423347">data</span>&nbsp;&nbsp;<span class="op" id="1423353">[</span><span class="op" id="1423354">]</span><span class="builtintype" id="1423355">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1423364">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423400">rwait</span>&nbsp;<span class="ident" id="1423406">sync</span><span class="op" id="1423410">.</span><span class="ident" id="1423411">Cond</span>&nbsp;&nbsp;<span class="comment" id="1423417">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423436">wwait</span>&nbsp;<span class="ident" id="1423442">sync</span><span class="op" id="1423446">.</span><span class="ident" id="1423447">Cond</span>&nbsp;&nbsp;<span class="comment" id="1423453">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423472">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1423478">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1423489">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423532">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1423538">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1423549">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1423590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1423593">func</span>&nbsp;<span class="op" id="1423598">(</span><span class="ident" id="1423599">p</span>&nbsp;<span class="op" id="1423601">*</span><span class="ident" id="1423602">pipe</span><span class="op" id="1423606">)</span>&nbsp;<span class="ident" id="1423608">read</span><span class="op" id="1423612">(</span><span class="ident" id="1423613">b</span>&nbsp;<span class="op" id="1423615">[</span><span class="op" id="1423616">]</span><span class="builtintype" id="1423617">byte</span><span class="op" id="1423621">)</span>&nbsp;<span class="op" id="1423623">(</span><span class="ident" id="1423624">n</span>&nbsp;<span class="builtintype" id="1423626">int</span><span class="op" id="1423629">,</span>&nbsp;<span class="ident" id="1423631">err</span>&nbsp;<span class="builtintype" id="1423635">error</span><span class="op" id="1423640">)</span>&nbsp;<span class="op" id="1423642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1423645">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423671">p</span><span class="op" id="1423672">.</span><span class="ident" id="1423673">rl</span><span class="op" id="1423675">.</span><span class="ident" id="1423676">Lock</span><span class="op" id="1423680">(</span><span class="op" id="1423681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423684">defer</span>&nbsp;<span class="ident" id="1423690">p</span><span class="op" id="1423691">.</span><span class="ident" id="1423692">rl</span><span class="op" id="1423694">.</span><span class="ident" id="1423695">Unlock</span><span class="op" id="1423701">(</span><span class="op" id="1423702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423706">p</span><span class="op" id="1423707">.</span><span class="ident" id="1423708">l</span><span class="op" id="1423709">.</span><span class="ident" id="1423710">Lock</span><span class="op" id="1423714">(</span><span class="op" id="1423715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423718">defer</span>&nbsp;<span class="ident" id="1423724">p</span><span class="op" id="1423725">.</span><span class="ident" id="1423726">l</span><span class="op" id="1423727">.</span><span class="ident" id="1423728">Unlock</span><span class="op" id="1423734">(</span><span class="op" id="1423735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423738">for</span>&nbsp;<span class="op" id="1423742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423746">if</span>&nbsp;<span class="ident" id="1423749">p</span><span class="op" id="1423750">.</span><span class="ident" id="1423751">rerr</span>&nbsp;<span class="op" id="1423756">!=</span>&nbsp;<span class="ident" id="1423759">nil</span>&nbsp;<span class="op" id="1423763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423768">return</span>&nbsp;<span class="num" id="1423775">0</span><span class="op" id="1423776">,</span>&nbsp;<span class="ident" id="1423778">ErrClosedPipe</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423798">if</span>&nbsp;<span class="ident" id="1423801">p</span><span class="op" id="1423802">.</span><span class="ident" id="1423803">data</span>&nbsp;<span class="op" id="1423808">!=</span>&nbsp;<span class="ident" id="1423811">nil</span>&nbsp;<span class="op" id="1423815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423820">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423832">if</span>&nbsp;<span class="ident" id="1423835">p</span><span class="op" id="1423836">.</span><span class="ident" id="1423837">werr</span>&nbsp;<span class="op" id="1423842">!=</span>&nbsp;<span class="ident" id="1423845">nil</span>&nbsp;<span class="op" id="1423849">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423854">return</span>&nbsp;<span class="num" id="1423861">0</span><span class="op" id="1423862">,</span>&nbsp;<span class="ident" id="1423864">p</span><span class="op" id="1423865">.</span><span class="ident" id="1423866">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423877">p</span><span class="op" id="1423878">.</span><span class="ident" id="1423879">rwait</span><span class="op" id="1423884">.</span><span class="ident" id="1423885">Wait</span><span class="op" id="1423889">(</span><span class="op" id="1423890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423896">n</span>&nbsp;<span class="op" id="1423898">=</span>&nbsp;<span class="builtinfunc" id="1423900">copy</span><span class="op" id="1423904">(</span><span class="ident" id="1423905">b</span><span class="op" id="1423906">,</span>&nbsp;<span class="ident" id="1423908">p</span><span class="op" id="1423909">.</span><span class="ident" id="1423910">data</span><span class="op" id="1423914">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423917">p</span><span class="op" id="1423918">.</span><span class="ident" id="1423919">data</span>&nbsp;<span class="op" id="1423924">=</span>&nbsp;<span class="ident" id="1423926">p</span><span class="op" id="1423927">.</span><span class="ident" id="1423928">data</span><span class="op" id="1423932">[</span><span class="ident" id="1423933">n</span><span class="op" id="1423934">:</span><span class="op" id="1423935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423938">if</span>&nbsp;<span class="builtinfunc" id="1423941">len</span><span class="op" id="1423944">(</span><span class="ident" id="1423945">p</span><span class="op" id="1423946">.</span><span class="ident" id="1423947">data</span><span class="op" id="1423951">)</span>&nbsp;<span class="op" id="1423953">==</span>&nbsp;<span class="num" id="1423956">0</span>&nbsp;<span class="op" id="1423958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423962">p</span><span class="op" id="1423963">.</span><span class="ident" id="1423964">data</span>&nbsp;<span class="op" id="1423969">=</span>&nbsp;<span class="ident" id="1423971">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1423977">p</span><span class="op" id="1423978">.</span><span class="ident" id="1423979">wwait</span><span class="op" id="1423984">.</span><span class="ident" id="1423985">Signal</span><span class="op" id="1423991">(</span><span class="op" id="1423992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1423995">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1423998">return</span><br>
<span class="lineno"></span><span class="op" id="1424005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1424008">var</span>&nbsp;<span class="ident" id="1424012">zero</span>&nbsp;<span class="op" id="1424017">[</span><span class="num" id="1424018">0</span><span class="op" id="1424019">]</span><span class="builtintype" id="1424020">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1424026">func</span>&nbsp;<span class="op" id="1424031">(</span><span class="ident" id="1424032">p</span>&nbsp;<span class="op" id="1424034">*</span><span class="ident" id="1424035">pipe</span><span class="op" id="1424039">)</span>&nbsp;<span class="ident" id="1424041">write</span><span class="op" id="1424046">(</span><span class="ident" id="1424047">b</span>&nbsp;<span class="op" id="1424049">[</span><span class="op" id="1424050">]</span><span class="builtintype" id="1424051">byte</span><span class="op" id="1424055">)</span>&nbsp;<span class="op" id="1424057">(</span><span class="ident" id="1424058">n</span>&nbsp;<span class="builtintype" id="1424060">int</span><span class="op" id="1424063">,</span>&nbsp;<span class="ident" id="1424065">err</span>&nbsp;<span class="builtintype" id="1424069">error</span><span class="op" id="1424074">)</span>&nbsp;<span class="op" id="1424076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424079">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424119">if</span>&nbsp;<span class="ident" id="1424122">b</span>&nbsp;<span class="op" id="1424124">==</span>&nbsp;<span class="ident" id="1424127">nil</span>&nbsp;<span class="op" id="1424131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424135">b</span>&nbsp;<span class="op" id="1424137">=</span>&nbsp;<span class="ident" id="1424139">zero</span><span class="op" id="1424143">[</span><span class="op" id="1424144">:</span><span class="op" id="1424145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424148">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424152">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424178">p</span><span class="op" id="1424179">.</span><span class="ident" id="1424180">wl</span><span class="op" id="1424182">.</span><span class="ident" id="1424183">Lock</span><span class="op" id="1424187">(</span><span class="op" id="1424188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424191">defer</span>&nbsp;<span class="ident" id="1424197">p</span><span class="op" id="1424198">.</span><span class="ident" id="1424199">wl</span><span class="op" id="1424201">.</span><span class="ident" id="1424202">Unlock</span><span class="op" id="1424208">(</span><span class="op" id="1424209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424213">p</span><span class="op" id="1424214">.</span><span class="ident" id="1424215">l</span><span class="op" id="1424216">.</span><span class="ident" id="1424217">Lock</span><span class="op" id="1424221">(</span><span class="op" id="1424222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424225">defer</span>&nbsp;<span class="ident" id="1424231">p</span><span class="op" id="1424232">.</span><span class="ident" id="1424233">l</span><span class="op" id="1424234">.</span><span class="ident" id="1424235">Unlock</span><span class="op" id="1424241">(</span><span class="op" id="1424242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424245">if</span>&nbsp;<span class="ident" id="1424248">p</span><span class="op" id="1424249">.</span><span class="ident" id="1424250">werr</span>&nbsp;<span class="op" id="1424255">!=</span>&nbsp;<span class="ident" id="1424258">nil</span>&nbsp;<span class="op" id="1424262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424266">err</span>&nbsp;<span class="op" id="1424270">=</span>&nbsp;<span class="ident" id="1424272">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424288">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424299">p</span><span class="op" id="1424300">.</span><span class="ident" id="1424301">data</span>&nbsp;<span class="op" id="1424306">=</span>&nbsp;<span class="ident" id="1424308">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424311">p</span><span class="op" id="1424312">.</span><span class="ident" id="1424313">rwait</span><span class="op" id="1424318">.</span><span class="ident" id="1424319">Signal</span><span class="op" id="1424325">(</span><span class="op" id="1424326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424329">for</span>&nbsp;<span class="op" id="1424333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424337">if</span>&nbsp;<span class="ident" id="1424340">p</span><span class="op" id="1424341">.</span><span class="ident" id="1424342">data</span>&nbsp;<span class="op" id="1424347">==</span>&nbsp;<span class="ident" id="1424350">nil</span>&nbsp;<span class="op" id="1424354">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424359">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424371">if</span>&nbsp;<span class="ident" id="1424374">p</span><span class="op" id="1424375">.</span><span class="ident" id="1424376">rerr</span>&nbsp;<span class="op" id="1424381">!=</span>&nbsp;<span class="ident" id="1424384">nil</span>&nbsp;<span class="op" id="1424388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424393">err</span>&nbsp;<span class="op" id="1424397">=</span>&nbsp;<span class="ident" id="1424399">p</span><span class="op" id="1424400">.</span><span class="ident" id="1424401">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424409">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424421">if</span>&nbsp;<span class="ident" id="1424424">p</span><span class="op" id="1424425">.</span><span class="ident" id="1424426">werr</span>&nbsp;<span class="op" id="1424431">!=</span>&nbsp;<span class="ident" id="1424434">nil</span>&nbsp;<span class="op" id="1424438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424443">err</span>&nbsp;<span class="op" id="1424447">=</span>&nbsp;<span class="ident" id="1424449">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424469">p</span><span class="op" id="1424470">.</span><span class="ident" id="1424471">wwait</span><span class="op" id="1424476">.</span><span class="ident" id="1424477">Wait</span><span class="op" id="1424481">(</span><span class="op" id="1424482">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424488">n</span>&nbsp;<span class="op" id="1424490">=</span>&nbsp;<span class="builtinfunc" id="1424492">len</span><span class="op" id="1424495">(</span><span class="ident" id="1424496">b</span><span class="op" id="1424497">)</span>&nbsp;<span class="op" id="1424499">-</span>&nbsp;<span class="builtinfunc" id="1424501">len</span><span class="op" id="1424504">(</span><span class="ident" id="1424505">p</span><span class="op" id="1424506">.</span><span class="ident" id="1424507">data</span><span class="op" id="1424511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424514">p</span><span class="op" id="1424515">.</span><span class="ident" id="1424516">data</span>&nbsp;<span class="op" id="1424521">=</span>&nbsp;<span class="ident" id="1424523">nil</span>&nbsp;<span class="comment" id="1424527">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424555">return</span><br>
<span class="lineno"></span><span class="op" id="1424562">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1424565">func</span>&nbsp;<span class="op" id="1424570">(</span><span class="ident" id="1424571">p</span>&nbsp;<span class="op" id="1424573">*</span><span class="ident" id="1424574">pipe</span><span class="op" id="1424578">)</span>&nbsp;<span class="ident" id="1424580">rclose</span><span class="op" id="1424586">(</span><span class="ident" id="1424587">err</span>&nbsp;<span class="builtintype" id="1424591">error</span><span class="op" id="1424596">)</span>&nbsp;<span class="op" id="1424598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424601">if</span>&nbsp;<span class="ident" id="1424604">err</span>&nbsp;<span class="op" id="1424608">==</span>&nbsp;<span class="ident" id="1424611">nil</span>&nbsp;<span class="op" id="1424615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424619">err</span>&nbsp;<span class="op" id="1424623">=</span>&nbsp;<span class="ident" id="1424625">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424640">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424643">p</span><span class="op" id="1424644">.</span><span class="ident" id="1424645">l</span><span class="op" id="1424646">.</span><span class="ident" id="1424647">Lock</span><span class="op" id="1424651">(</span><span class="op" id="1424652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424655">defer</span>&nbsp;<span class="ident" id="1424661">p</span><span class="op" id="1424662">.</span><span class="ident" id="1424663">l</span><span class="op" id="1424664">.</span><span class="ident" id="1424665">Unlock</span><span class="op" id="1424671">(</span><span class="op" id="1424672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424675">p</span><span class="op" id="1424676">.</span><span class="ident" id="1424677">rerr</span>&nbsp;<span class="op" id="1424682">=</span>&nbsp;<span class="ident" id="1424684">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424689">p</span><span class="op" id="1424690">.</span><span class="ident" id="1424691">rwait</span><span class="op" id="1424696">.</span><span class="ident" id="1424697">Signal</span><span class="op" id="1424703">(</span><span class="op" id="1424704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424707">p</span><span class="op" id="1424708">.</span><span class="ident" id="1424709">wwait</span><span class="op" id="1424714">.</span><span class="ident" id="1424715">Signal</span><span class="op" id="1424721">(</span><span class="op" id="1424722">)</span><br>
<span class="lineno">110</span><span class="op" id="1424724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1424727">func</span>&nbsp;<span class="op" id="1424732">(</span><span class="ident" id="1424733">p</span>&nbsp;<span class="op" id="1424735">*</span><span class="ident" id="1424736">pipe</span><span class="op" id="1424740">)</span>&nbsp;<span class="ident" id="1424742">wclose</span><span class="op" id="1424748">(</span><span class="ident" id="1424749">err</span>&nbsp;<span class="builtintype" id="1424753">error</span><span class="op" id="1424758">)</span>&nbsp;<span class="op" id="1424760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424763">if</span>&nbsp;<span class="ident" id="1424766">err</span>&nbsp;<span class="op" id="1424770">==</span>&nbsp;<span class="ident" id="1424773">nil</span>&nbsp;<span class="op" id="1424777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424781">err</span>&nbsp;<span class="op" id="1424785">=</span>&nbsp;<span class="ident" id="1424787">EOF</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424795">p</span><span class="op" id="1424796">.</span><span class="ident" id="1424797">l</span><span class="op" id="1424798">.</span><span class="ident" id="1424799">Lock</span><span class="op" id="1424803">(</span><span class="op" id="1424804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424807">defer</span>&nbsp;<span class="ident" id="1424813">p</span><span class="op" id="1424814">.</span><span class="ident" id="1424815">l</span><span class="op" id="1424816">.</span><span class="ident" id="1424817">Unlock</span><span class="op" id="1424823">(</span><span class="op" id="1424824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424827">p</span><span class="op" id="1424828">.</span><span class="ident" id="1424829">werr</span>&nbsp;<span class="op" id="1424834">=</span>&nbsp;<span class="ident" id="1424836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424841">p</span><span class="op" id="1424842">.</span><span class="ident" id="1424843">rwait</span><span class="op" id="1424848">.</span><span class="ident" id="1424849">Signal</span><span class="op" id="1424855">(</span><span class="op" id="1424856">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424859">p</span><span class="op" id="1424860">.</span><span class="ident" id="1424861">wwait</span><span class="op" id="1424866">.</span><span class="ident" id="1424867">Signal</span><span class="op" id="1424873">(</span><span class="op" id="1424874">)</span><br>
<span class="lineno"></span><span class="op" id="1424876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424879">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1424923">type</span>&nbsp;<span class="ident" id="1424928">PipeReader</span>&nbsp;<span class="keyword" id="1424939">struct</span>&nbsp;<span class="op" id="1424946">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424949">p</span>&nbsp;<span class="op" id="1424951">*</span><span class="ident" id="1424952">pipe</span><br>
<span class="lineno"></span><span class="op" id="1424957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424960">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1425008">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1425064">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1425103">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1425162">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1425204">func</span>&nbsp;<span class="op" id="1425209">(</span><span class="ident" id="1425210">r</span>&nbsp;<span class="op" id="1425212">*</span><span class="ident" id="1425213">PipeReader</span><span class="op" id="1425223">)</span>&nbsp;<span class="ident" id="1425225">Read</span><span class="op" id="1425229">(</span><span class="ident" id="1425230">data</span>&nbsp;<span class="op" id="1425235">[</span><span class="op" id="1425236">]</span><span class="builtintype" id="1425237">byte</span><span class="op" id="1425241">)</span>&nbsp;<span class="op" id="1425243">(</span><span class="ident" id="1425244">n</span>&nbsp;<span class="builtintype" id="1425246">int</span><span class="op" id="1425249">,</span>&nbsp;<span class="ident" id="1425251">err</span>&nbsp;<span class="builtintype" id="1425255">error</span><span class="op" id="1425260">)</span>&nbsp;<span class="op" id="1425262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425265">return</span>&nbsp;<span class="ident" id="1425272">r</span><span class="op" id="1425273">.</span><span class="ident" id="1425274">p</span><span class="op" id="1425275">.</span><span class="ident" id="1425276">read</span><span class="op" id="1425280">(</span><span class="ident" id="1425281">data</span><span class="op" id="1425285">)</span><br>
<span class="lineno">135</span><span class="op" id="1425287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425290">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1425343">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1425406">func</span>&nbsp;<span class="op" id="1425411">(</span><span class="ident" id="1425412">r</span>&nbsp;<span class="op" id="1425414">*</span><span class="ident" id="1425415">PipeReader</span><span class="op" id="1425425">)</span>&nbsp;<span class="ident" id="1425427">Close</span><span class="op" id="1425432">(</span><span class="op" id="1425433">)</span>&nbsp;<span class="builtintype" id="1425435">error</span>&nbsp;<span class="op" id="1425441">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425444">return</span>&nbsp;<span class="ident" id="1425451">r</span><span class="op" id="1425452">.</span><span class="ident" id="1425453">CloseWithError</span><span class="op" id="1425467">(</span><span class="ident" id="1425468">nil</span><span class="op" id="1425471">)</span><br>
<span class="lineno"></span><span class="op" id="1425473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425476">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1425531">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1425591">func</span>&nbsp;<span class="op" id="1425596">(</span><span class="ident" id="1425597">r</span>&nbsp;<span class="op" id="1425599">*</span><span class="ident" id="1425600">PipeReader</span><span class="op" id="1425610">)</span>&nbsp;<span class="ident" id="1425612">CloseWithError</span><span class="op" id="1425626">(</span><span class="ident" id="1425627">err</span>&nbsp;<span class="builtintype" id="1425631">error</span><span class="op" id="1425636">)</span>&nbsp;<span class="builtintype" id="1425638">error</span>&nbsp;<span class="op" id="1425644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425647">r</span><span class="op" id="1425648">.</span><span class="ident" id="1425649">p</span><span class="op" id="1425650">.</span><span class="ident" id="1425651">rclose</span><span class="op" id="1425657">(</span><span class="ident" id="1425658">err</span><span class="op" id="1425661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425664">return</span>&nbsp;<span class="ident" id="1425671">nil</span><br>
<span class="lineno"></span><span class="op" id="1425675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1425678">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1425723">type</span>&nbsp;<span class="ident" id="1425728">PipeWriter</span>&nbsp;<span class="keyword" id="1425739">struct</span>&nbsp;<span class="op" id="1425746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425749">p</span>&nbsp;<span class="op" id="1425751">*</span><span class="ident" id="1425752">pipe</span><br>
<span class="lineno"></span><span class="op" id="1425757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1425760">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1425810">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1425864">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1425921">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1425977">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1426029">func</span>&nbsp;<span class="op" id="1426034">(</span><span class="ident" id="1426035">w</span>&nbsp;<span class="op" id="1426037">*</span><span class="ident" id="1426038">PipeWriter</span><span class="op" id="1426048">)</span>&nbsp;<span class="ident" id="1426050">Write</span><span class="op" id="1426055">(</span><span class="ident" id="1426056">data</span>&nbsp;<span class="op" id="1426061">[</span><span class="op" id="1426062">]</span><span class="builtintype" id="1426063">byte</span><span class="op" id="1426067">)</span>&nbsp;<span class="op" id="1426069">(</span><span class="ident" id="1426070">n</span>&nbsp;<span class="builtintype" id="1426072">int</span><span class="op" id="1426075">,</span>&nbsp;<span class="ident" id="1426077">err</span>&nbsp;<span class="builtintype" id="1426081">error</span><span class="op" id="1426086">)</span>&nbsp;<span class="op" id="1426088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426091">return</span>&nbsp;<span class="ident" id="1426098">w</span><span class="op" id="1426099">.</span><span class="ident" id="1426100">p</span><span class="op" id="1426101">.</span><span class="ident" id="1426102">write</span><span class="op" id="1426107">(</span><span class="ident" id="1426108">data</span><span class="op" id="1426112">)</span><br>
<span class="lineno"></span><span class="op" id="1426114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426117">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1426171">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1426226">func</span>&nbsp;<span class="op" id="1426231">(</span><span class="ident" id="1426232">w</span>&nbsp;<span class="op" id="1426234">*</span><span class="ident" id="1426235">PipeWriter</span><span class="op" id="1426245">)</span>&nbsp;<span class="ident" id="1426247">Close</span><span class="op" id="1426252">(</span><span class="op" id="1426253">)</span>&nbsp;<span class="builtintype" id="1426255">error</span>&nbsp;<span class="op" id="1426261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426264">return</span>&nbsp;<span class="ident" id="1426271">w</span><span class="op" id="1426272">.</span><span class="ident" id="1426273">CloseWithError</span><span class="op" id="1426287">(</span><span class="ident" id="1426288">nil</span><span class="op" id="1426291">)</span><br>
<span class="lineno"></span><span class="op" id="1426293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1426296">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1426359">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1426424">func</span>&nbsp;<span class="op" id="1426429">(</span><span class="ident" id="1426430">w</span>&nbsp;<span class="op" id="1426432">*</span><span class="ident" id="1426433">PipeWriter</span><span class="op" id="1426443">)</span>&nbsp;<span class="ident" id="1426445">CloseWithError</span><span class="op" id="1426459">(</span><span class="ident" id="1426460">err</span>&nbsp;<span class="builtintype" id="1426464">error</span><span class="op" id="1426469">)</span>&nbsp;<span class="builtintype" id="1426471">error</span>&nbsp;<span class="op" id="1426477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426480">w</span><span class="op" id="1426481">.</span><span class="ident" id="1426482">p</span><span class="op" id="1426483">.</span><span class="ident" id="1426484">wclose</span><span class="op" id="1426490">(</span><span class="ident" id="1426491">err</span><span class="op" id="1426494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426497">return</span>&nbsp;<span class="ident" id="1426504">nil</span><br>
<span class="lineno">175</span><span class="op" id="1426508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426511">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1426557">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1426614">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1426651">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1426709">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1426783">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1426856">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1426930">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1426983">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1427035">func</span>&nbsp;<span class="ident" id="1427040">Pipe</span><span class="op" id="1427044">(</span><span class="op" id="1427045">)</span>&nbsp;<span class="op" id="1427047">(</span><span class="op" id="1427048">*</span><span class="ident" id="1427049">PipeReader</span><span class="op" id="1427059">,</span>&nbsp;<span class="op" id="1427061">*</span><span class="ident" id="1427062">PipeWriter</span><span class="op" id="1427072">)</span>&nbsp;<span class="op" id="1427074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427077">p</span>&nbsp;<span class="op" id="1427079">:=</span>&nbsp;<span class="builtinfunc" id="1427082">new</span><span class="op" id="1427085">(</span><span class="ident" id="1427086">pipe</span><span class="op" id="1427090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427093">p</span><span class="op" id="1427094">.</span><span class="ident" id="1427095">rwait</span><span class="op" id="1427100">.</span><span class="ident" id="1427101">L</span>&nbsp;<span class="op" id="1427103">=</span>&nbsp;<span class="op" id="1427105">&amp;</span><span class="ident" id="1427106">p</span><span class="op" id="1427107">.</span><span class="ident" id="1427108">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427111">p</span><span class="op" id="1427112">.</span><span class="ident" id="1427113">wwait</span><span class="op" id="1427118">.</span><span class="ident" id="1427119">L</span>&nbsp;<span class="op" id="1427121">=</span>&nbsp;<span class="op" id="1427123">&amp;</span><span class="ident" id="1427124">p</span><span class="op" id="1427125">.</span><span class="ident" id="1427126">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427129">r</span>&nbsp;<span class="op" id="1427131">:=</span>&nbsp;<span class="op" id="1427134">&amp;</span><span class="ident" id="1427135">PipeReader</span><span class="op" id="1427145">{</span><span class="ident" id="1427146">p</span><span class="op" id="1427147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427150">w</span>&nbsp;<span class="op" id="1427152">:=</span>&nbsp;<span class="op" id="1427155">&amp;</span><span class="ident" id="1427156">PipeWriter</span><span class="op" id="1427166">{</span><span class="ident" id="1427167">p</span><span class="op" id="1427168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427171">return</span>&nbsp;<span class="ident" id="1427178">r</span><span class="op" id="1427179">,</span>&nbsp;<span class="ident" id="1427181">w</span><br>
<span class="lineno"></span><span class="op" id="1427183">}</span>
</div>
</body>
</html>
