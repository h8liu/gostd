<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6143223">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6143278">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6143332">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6143383">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="6143449">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6143470">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="6143540">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="6143556">//</span><br>
<span class="lineno"></span><span class="comment" id="6143559">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="6143626">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6143685">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6143749">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="6143789">package</span>&nbsp;<span class="ident" id="6143797">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6143802">import</span>&nbsp;<span class="op" id="6143809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143812">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143821">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143828">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143834">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143841">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143853">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143859">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143870">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143887">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143897">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143908">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143919">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="6143929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6143932">var</span>&nbsp;<span class="ident" id="6143936">trailingPort</span>&nbsp;<span class="op" id="6143949">=</span>&nbsp;<span class="ident" id="6143951"><a href="/net/http/cgi/host.go.html#6143887">regexp</a></span><span class="op" id="6143957">.</span><span class="ident" id="6143958">MustCompile</span><span class="op" id="6143969">(</span><span class="string" id="6143970">`:([0-9]+)$`</span><span class="op" id="6143982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6143985">var</span>&nbsp;<span class="ident" id="6143989">osDefaultInheritEnv</span>&nbsp;<span class="op" id="6144009">=</span>&nbsp;<span class="keyword" id="6144011">map</span><span class="op" id="6144014">[</span><span class="builtintype" id="6144015">string</span><span class="op" id="6144021">]</span><span class="op" id="6144022">[</span><span class="op" id="6144023">]</span><span class="builtintype" id="6144024">string</span><span class="op" id="6144030">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144033">&#34;darwin&#34;</span><span class="op" id="6144041">:</span>&nbsp;&nbsp;<span class="op" id="6144044">{</span><span class="string" id="6144045">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="6144064">}</span><span class="op" id="6144065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144068">&#34;freebsd&#34;</span><span class="op" id="6144077">:</span>&nbsp;<span class="op" id="6144079">{</span><span class="string" id="6144080">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144097">}</span><span class="op" id="6144098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144101">&#34;hpux&#34;</span><span class="op" id="6144107">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144112">{</span><span class="string" id="6144113">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144130">,</span>&nbsp;<span class="string" id="6144132">&#34;SHLIB_PATH&#34;</span><span class="op" id="6144144">}</span><span class="op" id="6144145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144148">&#34;irix&#34;</span><span class="op" id="6144154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144159">{</span><span class="string" id="6144160">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144177">,</span>&nbsp;<span class="string" id="6144179">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="6144199">,</span>&nbsp;<span class="string" id="6144201">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="6144220">}</span><span class="op" id="6144221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144224">&#34;linux&#34;</span><span class="op" id="6144231">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6144235">{</span><span class="string" id="6144236">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144253">}</span><span class="op" id="6144254">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144257">&#34;openbsd&#34;</span><span class="op" id="6144266">:</span>&nbsp;<span class="op" id="6144268">{</span><span class="string" id="6144269">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144286">}</span><span class="op" id="6144287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144290">&#34;solaris&#34;</span><span class="op" id="6144299">:</span>&nbsp;<span class="op" id="6144301">{</span><span class="string" id="6144302">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6144319">,</span>&nbsp;<span class="string" id="6144321">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="6144341">,</span>&nbsp;<span class="string" id="6144343">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="6144363">}</span><span class="op" id="6144364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6144367">&#34;windows&#34;</span><span class="op" id="6144376">:</span>&nbsp;<span class="op" id="6144378">{</span><span class="string" id="6144379">&#34;SystemRoot&#34;</span><span class="op" id="6144391">,</span>&nbsp;<span class="string" id="6144393">&#34;COMSPEC&#34;</span><span class="op" id="6144402">,</span>&nbsp;<span class="string" id="6144404">&#34;PATHEXT&#34;</span><span class="op" id="6144413">,</span>&nbsp;<span class="string" id="6144415">&#34;WINDIR&#34;</span><span class="op" id="6144423">}</span><span class="op" id="6144424">,</span><br>
<span class="lineno"></span><span class="op" id="6144426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6144429">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="6144499">type</span>&nbsp;<span class="ident" id="6144504">Handler</span>&nbsp;<span class="keyword" id="6144512">struct</span>&nbsp;<span class="op" id="6144519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144522">Path</span>&nbsp;<span class="builtintype" id="6144527">string</span>&nbsp;<span class="comment" id="6144534">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144565">Root</span>&nbsp;<span class="builtintype" id="6144570">string</span>&nbsp;<span class="comment" id="6144577">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144626">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144684">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144741">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144796">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144819">Dir</span>&nbsp;<span class="builtintype" id="6144823">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144832">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144843">[</span><span class="op" id="6144844">]</span><span class="builtintype" id="6144845">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144855">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144918">InheritEnv</span>&nbsp;<span class="op" id="6144929">[</span><span class="op" id="6144930">]</span><span class="builtintype" id="6144931">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144941">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144998">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145009">*</span><span class="ident" id="6145010"><a href="/net/http/cgi/host.go.html#6143834">log</a></span><span class="op" id="6145013">.</span><span class="ident" id="6145014">Logger</span>&nbsp;<span class="comment" id="6145021">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145073">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145084">[</span><span class="op" id="6145085">]</span><span class="builtintype" id="6145086">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6145096">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145145">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145206">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145264">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145324">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145380">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145406">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145410">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145475">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145529">PathLocationHandler</span>&nbsp;<span class="ident" id="6145549"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6145553">.</span><span class="ident" id="6145554">Handler</span><br>
<span class="lineno">70</span><span class="op" id="6145562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6145565">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="6145634">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="6145691">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="6145710">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6145722">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="6145772">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="6145780">func</span>&nbsp;<span class="ident" id="6145785">removeLeadingDuplicates</span><span class="op" id="6145808">(</span><span class="ident" id="6145809">env</span>&nbsp;<span class="op" id="6145813">[</span><span class="op" id="6145814">]</span><span class="builtintype" id="6145815">string</span><span class="op" id="6145821">)</span>&nbsp;<span class="op" id="6145823">(</span><span class="ident" id="6145824">ret</span>&nbsp;<span class="op" id="6145828">[</span><span class="op" id="6145829">]</span><span class="builtintype" id="6145830">string</span><span class="op" id="6145836">)</span>&nbsp;<span class="op" id="6145838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145841">n</span>&nbsp;<span class="op" id="6145843">:=</span>&nbsp;<span class="builtinfunc" id="6145846">len</span><span class="op" id="6145849">(</span><span class="ident" id="6145850"><a href="/net/http/cgi/host.go.html#6145809">env</a></span><span class="op" id="6145853">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145856">for</span>&nbsp;<span class="ident" id="6145860">i</span>&nbsp;<span class="op" id="6145862">:=</span>&nbsp;<span class="num" id="6145865">0</span><span class="op" id="6145866">;</span>&nbsp;<span class="ident" id="6145868"><a href="/net/http/cgi/host.go.html#6145860">i</a></span>&nbsp;<span class="op" id="6145870">&lt;</span>&nbsp;<span class="ident" id="6145872"><a href="/net/http/cgi/host.go.html#6145841">n</a></span><span class="op" id="6145873">;</span>&nbsp;<span class="ident" id="6145875"><a href="/net/http/cgi/host.go.html#6145860">i</a></span><span class="op" id="6145876">++</span>&nbsp;<span class="op" id="6145879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145883">e</span>&nbsp;<span class="op" id="6145885">:=</span>&nbsp;<span class="ident" id="6145888"><a href="/net/http/cgi/host.go.html#6145809">env</a></span><span class="op" id="6145891">[</span><span class="ident" id="6145892"><a href="/net/http/cgi/host.go.html#6145860">i</a></span><span class="op" id="6145893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145897">s</span>&nbsp;<span class="op" id="6145899">:=</span>&nbsp;<span class="ident" id="6145902"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6145909">.</span><span class="ident" id="6145910">SplitN</span><span class="op" id="6145916">(</span><span class="ident" id="6145917"><a href="/net/http/cgi/host.go.html#6145883">e</a></span><span class="op" id="6145918">,</span>&nbsp;<span class="string" id="6145920">&#34;=&#34;</span><span class="op" id="6145923">,</span>&nbsp;<span class="num" id="6145925">2</span><span class="op" id="6145926">)</span><span class="op" id="6145927">[</span><span class="num" id="6145928">0</span><span class="op" id="6145929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145933">found</span>&nbsp;<span class="op" id="6145939">:=</span>&nbsp;<span class="builtintype" id="6145942">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145950">for</span>&nbsp;<span class="ident" id="6145954">j</span>&nbsp;<span class="op" id="6145956">:=</span>&nbsp;<span class="ident" id="6145959"><a href="/net/http/cgi/host.go.html#6145860">i</a></span>&nbsp;<span class="op" id="6145961">+</span>&nbsp;<span class="num" id="6145963">1</span><span class="op" id="6145964">;</span>&nbsp;<span class="ident" id="6145966"><a href="/net/http/cgi/host.go.html#6145954">j</a></span>&nbsp;<span class="op" id="6145968">&lt;</span>&nbsp;<span class="ident" id="6145970"><a href="/net/http/cgi/host.go.html#6145841">n</a></span><span class="op" id="6145971">;</span>&nbsp;<span class="ident" id="6145973"><a href="/net/http/cgi/host.go.html#6145954">j</a></span><span class="op" id="6145974">++</span>&nbsp;<span class="op" id="6145977">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145982">if</span>&nbsp;<span class="ident" id="6145985"><a href="/net/http/cgi/host.go.html#6145897">s</a></span>&nbsp;<span class="op" id="6145987">==</span>&nbsp;<span class="ident" id="6145990"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6145997">.</span><span class="ident" id="6145998">SplitN</span><span class="op" id="6146004">(</span><span class="ident" id="6146005"><a href="/net/http/cgi/host.go.html#6145809">env</a></span><span class="op" id="6146008">[</span><span class="ident" id="6146009"><a href="/net/http/cgi/host.go.html#6145954">j</a></span><span class="op" id="6146010">]</span><span class="op" id="6146011">,</span>&nbsp;<span class="string" id="6146013">&#34;=&#34;</span><span class="op" id="6146016">,</span>&nbsp;<span class="num" id="6146018">2</span><span class="op" id="6146019">)</span><span class="op" id="6146020">[</span><span class="num" id="6146021">0</span><span class="op" id="6146022">]</span>&nbsp;<span class="op" id="6146024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146030"><a href="/net/http/cgi/host.go.html#6145933">found</a></span>&nbsp;<span class="op" id="6146036">=</span>&nbsp;<span class="builtintype" id="6146038">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146047">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146060">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146064">if</span>&nbsp;<span class="op" id="6146067">!</span><span class="ident" id="6146068"><a href="/net/http/cgi/host.go.html#6145933">found</a></span>&nbsp;<span class="op" id="6146074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146079"><a href="/net/http/cgi/host.go.html#6145824">ret</a></span>&nbsp;<span class="op" id="6146083">=</span>&nbsp;<span class="builtinfunc" id="6146085">append</span><span class="op" id="6146091">(</span><span class="ident" id="6146092"><a href="/net/http/cgi/host.go.html#6145824">ret</a></span><span class="op" id="6146095">,</span>&nbsp;<span class="ident" id="6146097"><a href="/net/http/cgi/host.go.html#6145883">e</a></span><span class="op" id="6146098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146108">return</span><br>
<span class="lineno">95</span><span class="op" id="6146115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6146118">func</span>&nbsp;<span class="op" id="6146123">(</span><span class="ident" id="6146124">h</span>&nbsp;<span class="op" id="6146126">*</span><span class="ident" id="6146127"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="6146134">)</span>&nbsp;<span class="ident" id="6146136">ServeHTTP</span><span class="op" id="6146145">(</span><span class="ident" id="6146146">rw</span>&nbsp;<span class="ident" id="6146149"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6146153">.</span><span class="ident" id="6146154">ResponseWriter</span><span class="op" id="6146168">,</span>&nbsp;<span class="ident" id="6146170">req</span>&nbsp;<span class="op" id="6146174">*</span><span class="ident" id="6146175"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6146179">.</span><span class="ident" id="6146180">Request</span><span class="op" id="6146187">)</span>&nbsp;<span class="op" id="6146189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146192">root</span>&nbsp;<span class="op" id="6146197">:=</span>&nbsp;<span class="ident" id="6146200"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6146201">.</span><span class="ident" id="6146202">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146208">if</span>&nbsp;<span class="ident" id="6146211"><a href="/net/http/cgi/host.go.html#6146192">root</a></span>&nbsp;<span class="op" id="6146216">==</span>&nbsp;<span class="string" id="6146219">&#34;&#34;</span>&nbsp;<span class="op" id="6146222">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146226"><a href="/net/http/cgi/host.go.html#6146192">root</a></span>&nbsp;<span class="op" id="6146231">=</span>&nbsp;<span class="string" id="6146233">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146242">if</span>&nbsp;<span class="builtinfunc" id="6146245">len</span><span class="op" id="6146248">(</span><span class="ident" id="6146249"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146252">.</span><span class="ident" id="6146253">TransferEncoding</span><span class="op" id="6146269">)</span>&nbsp;<span class="op" id="6146271">&gt;</span>&nbsp;<span class="num" id="6146273">0</span>&nbsp;<span class="op" id="6146275">&amp;&amp;</span>&nbsp;<span class="ident" id="6146278"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146281">.</span><span class="ident" id="6146282">TransferEncoding</span><span class="op" id="6146298">[</span><span class="num" id="6146299">0</span><span class="op" id="6146300">]</span>&nbsp;<span class="op" id="6146302">==</span>&nbsp;<span class="string" id="6146305">&#34;chunked&#34;</span>&nbsp;<span class="op" id="6146315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146319"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6146321">.</span><span class="ident" id="6146322">WriteHeader</span><span class="op" id="6146333">(</span><span class="ident" id="6146334"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6146338">.</span><span class="ident" id="6146339">StatusBadRequest</span><span class="op" id="6146355">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146359"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6146361">.</span><span class="ident" id="6146362">Write</span><span class="op" id="6146367">(</span><span class="op" id="6146368">[</span><span class="op" id="6146369">]</span><span class="builtintype" id="6146370">byte</span><span class="op" id="6146374">(</span><span class="string" id="6146375">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="6146425">)</span><span class="op" id="6146426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146430">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146442">pathInfo</span>&nbsp;<span class="op" id="6146451">:=</span>&nbsp;<span class="ident" id="6146454"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146457">.</span><span class="ident" id="6146458">URL</span><span class="op" id="6146461">.</span><span class="ident" id="6146462">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146468">if</span>&nbsp;<span class="ident" id="6146471"><a href="/net/http/cgi/host.go.html#6146192">root</a></span>&nbsp;<span class="op" id="6146476">!=</span>&nbsp;<span class="string" id="6146479">&#34;/&#34;</span>&nbsp;<span class="op" id="6146483">&amp;&amp;</span>&nbsp;<span class="ident" id="6146486"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6146493">.</span><span class="ident" id="6146494">HasPrefix</span><span class="op" id="6146503">(</span><span class="ident" id="6146504"><a href="/net/http/cgi/host.go.html#6146442">pathInfo</a></span><span class="op" id="6146512">,</span>&nbsp;<span class="ident" id="6146514"><a href="/net/http/cgi/host.go.html#6146192">root</a></span><span class="op" id="6146518">)</span>&nbsp;<span class="op" id="6146520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146524"><a href="/net/http/cgi/host.go.html#6146442">pathInfo</a></span>&nbsp;<span class="op" id="6146533">=</span>&nbsp;<span class="ident" id="6146535"><a href="/net/http/cgi/host.go.html#6146442">pathInfo</a></span><span class="op" id="6146543">[</span><span class="builtinfunc" id="6146544">len</span><span class="op" id="6146547">(</span><span class="ident" id="6146548"><a href="/net/http/cgi/host.go.html#6146192">root</a></span><span class="op" id="6146552">)</span><span class="op" id="6146553">:</span><span class="op" id="6146554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146561">port</span>&nbsp;<span class="op" id="6146566">:=</span>&nbsp;<span class="string" id="6146569">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146575">if</span>&nbsp;<span class="ident" id="6146578">matches</span>&nbsp;<span class="op" id="6146586">:=</span>&nbsp;<span class="ident" id="6146589"><a href="/net/http/cgi/host.go.html#6143936">trailingPort</a></span><span class="op" id="6146601">.</span><span class="ident" id="6146602">FindStringSubmatch</span><span class="op" id="6146620">(</span><span class="ident" id="6146621"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146624">.</span><span class="ident" id="6146625">Host</span><span class="op" id="6146629">)</span><span class="op" id="6146630">;</span>&nbsp;<span class="builtinfunc" id="6146632">len</span><span class="op" id="6146635">(</span><span class="ident" id="6146636"><a href="/net/http/cgi/host.go.html#6146578">matches</a></span><span class="op" id="6146643">)</span>&nbsp;<span class="op" id="6146645">!=</span>&nbsp;<span class="num" id="6146648">0</span>&nbsp;<span class="op" id="6146650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146654"><a href="/net/http/cgi/host.go.html#6146561">port</a></span>&nbsp;<span class="op" id="6146659">=</span>&nbsp;<span class="ident" id="6146661"><a href="/net/http/cgi/host.go.html#6146578">matches</a></span><span class="op" id="6146668">[</span><span class="num" id="6146669">1</span><span class="op" id="6146670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146677">env</span>&nbsp;<span class="op" id="6146681">:=</span>&nbsp;<span class="op" id="6146684">[</span><span class="op" id="6146685">]</span><span class="builtintype" id="6146686">string</span><span class="op" id="6146692">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146696">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="6146716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146720">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="6146735">+</span>&nbsp;<span class="ident" id="6146737"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146740">.</span><span class="ident" id="6146741">Host</span><span class="op" id="6146745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146749">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="6146775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146779">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="6146792">+</span>&nbsp;<span class="ident" id="6146794"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146797">.</span><span class="ident" id="6146798">Host</span><span class="op" id="6146802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146806">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="6146833">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146837">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="6146855">+</span>&nbsp;<span class="ident" id="6146857"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146860">.</span><span class="ident" id="6146861">Method</span><span class="op" id="6146867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146871">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="6146887">+</span>&nbsp;<span class="ident" id="6146889"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146892">.</span><span class="ident" id="6146893">URL</span><span class="op" id="6146896">.</span><span class="ident" id="6146897">RawQuery</span><span class="op" id="6146905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146909">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="6146924">+</span>&nbsp;<span class="ident" id="6146926"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6146929">.</span><span class="ident" id="6146930">URL</span><span class="op" id="6146933">.</span><span class="ident" id="6146934">RequestURI</span><span class="op" id="6146944">(</span><span class="op" id="6146945">)</span><span class="op" id="6146946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146950">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="6146963">+</span>&nbsp;<span class="ident" id="6146965"><a href="/net/http/cgi/host.go.html#6146442">pathInfo</a></span><span class="op" id="6146973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6146977">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="6146992">+</span>&nbsp;<span class="ident" id="6146994"><a href="/net/http/cgi/host.go.html#6146192">root</a></span><span class="op" id="6146998">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6147002">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="6147021">+</span>&nbsp;<span class="ident" id="6147023"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6147024">.</span><span class="ident" id="6147025">Path</span><span class="op" id="6147029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6147033">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="6147048">+</span>&nbsp;<span class="ident" id="6147050"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147053">.</span><span class="ident" id="6147054">RemoteAddr</span><span class="op" id="6147064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6147068">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="6147083">+</span>&nbsp;<span class="ident" id="6147085"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147088">.</span><span class="ident" id="6147089">RemoteAddr</span><span class="op" id="6147099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6147103">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="6147118">+</span>&nbsp;<span class="ident" id="6147120"><a href="/net/http/cgi/host.go.html#6146561">port</a></span><span class="op" id="6147124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147127">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147131">if</span>&nbsp;<span class="ident" id="6147134"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147137">.</span><span class="ident" id="6147138">TLS</span>&nbsp;<span class="op" id="6147142">!=</span>&nbsp;<span class="ident" id="6147145">nil</span>&nbsp;<span class="op" id="6147149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147153"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147157">=</span>&nbsp;<span class="builtinfunc" id="6147159">append</span><span class="op" id="6147165">(</span><span class="ident" id="6147166"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147169">,</span>&nbsp;<span class="string" id="6147171">&#34;HTTPS=on&#34;</span><span class="op" id="6147181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147188">for</span>&nbsp;<span class="ident" id="6147192">k</span><span class="op" id="6147193">,</span>&nbsp;<span class="ident" id="6147195">v</span>&nbsp;<span class="op" id="6147197">:=</span>&nbsp;<span class="keyword" id="6147200">range</span>&nbsp;<span class="ident" id="6147206"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147209">.</span><span class="ident" id="6147210">Header</span>&nbsp;<span class="op" id="6147217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147221"><a href="/net/http/cgi/host.go.html#6147192">k</a></span>&nbsp;<span class="op" id="6147223">=</span>&nbsp;<span class="ident" id="6147225"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6147232">.</span><span class="ident" id="6147233">Map</span><span class="op" id="6147236">(</span><span class="ident" id="6147237"><a href="/net/http/cgi/host.go.html#6152528">upperCaseAndUnderscore</a></span><span class="op" id="6147259">,</span>&nbsp;<span class="ident" id="6147261"><a href="/net/http/cgi/host.go.html#6147192">k</a></span><span class="op" id="6147262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147266">joinStr</span>&nbsp;<span class="op" id="6147274">:=</span>&nbsp;<span class="string" id="6147277">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147284">if</span>&nbsp;<span class="ident" id="6147287"><a href="/net/http/cgi/host.go.html#6147192">k</a></span>&nbsp;<span class="op" id="6147289">==</span>&nbsp;<span class="string" id="6147292">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="6147301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147306"><a href="/net/http/cgi/host.go.html#6147266">joinStr</a></span>&nbsp;<span class="op" id="6147314">=</span>&nbsp;<span class="string" id="6147316">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147327"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147331">=</span>&nbsp;<span class="builtinfunc" id="6147333">append</span><span class="op" id="6147339">(</span><span class="ident" id="6147340"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147343">,</span>&nbsp;<span class="string" id="6147345">&#34;HTTP_&#34;</span><span class="op" id="6147352">+</span><span class="ident" id="6147353"><a href="/net/http/cgi/host.go.html#6147192">k</a></span><span class="op" id="6147354">+</span><span class="string" id="6147355">&#34;=&#34;</span><span class="op" id="6147358">+</span><span class="ident" id="6147359"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6147366">.</span><span class="ident" id="6147367">Join</span><span class="op" id="6147371">(</span><span class="ident" id="6147372"><a href="/net/http/cgi/host.go.html#6147195">v</a></span><span class="op" id="6147373">,</span>&nbsp;<span class="ident" id="6147375"><a href="/net/http/cgi/host.go.html#6147266">joinStr</a></span><span class="op" id="6147382">)</span><span class="op" id="6147383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147390">if</span>&nbsp;<span class="ident" id="6147393"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147396">.</span><span class="ident" id="6147397">ContentLength</span>&nbsp;<span class="op" id="6147411">&gt;</span>&nbsp;<span class="num" id="6147413">0</span>&nbsp;<span class="op" id="6147415">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147419"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147423">=</span>&nbsp;<span class="builtinfunc" id="6147425">append</span><span class="op" id="6147431">(</span><span class="ident" id="6147432"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147435">,</span>&nbsp;<span class="ident" id="6147437"><a href="/net/http/cgi/host.go.html#6143821">fmt</a></span><span class="op" id="6147440">.</span><span class="ident" id="6147441">Sprintf</span><span class="op" id="6147448">(</span><span class="string" id="6147449">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="6147468">,</span>&nbsp;<span class="ident" id="6147470"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147473">.</span><span class="ident" id="6147474">ContentLength</span><span class="op" id="6147487">)</span><span class="op" id="6147488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147494">if</span>&nbsp;<span class="ident" id="6147497">ctype</span>&nbsp;<span class="op" id="6147503">:=</span>&nbsp;<span class="ident" id="6147506"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6147509">.</span><span class="ident" id="6147510">Header</span><span class="op" id="6147516">.</span><span class="ident" id="6147517">Get</span><span class="op" id="6147520">(</span><span class="string" id="6147521">&#34;Content-Type&#34;</span><span class="op" id="6147535">)</span><span class="op" id="6147536">;</span>&nbsp;<span class="ident" id="6147538"><a href="/net/http/cgi/host.go.html#6147497">ctype</a></span>&nbsp;<span class="op" id="6147544">!=</span>&nbsp;<span class="string" id="6147547">&#34;&#34;</span>&nbsp;<span class="op" id="6147550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147554"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147558">=</span>&nbsp;<span class="builtinfunc" id="6147560">append</span><span class="op" id="6147566">(</span><span class="ident" id="6147567"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147570">,</span>&nbsp;<span class="string" id="6147572">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="6147587">+</span><span class="ident" id="6147588"><a href="/net/http/cgi/host.go.html#6147497">ctype</a></span><span class="op" id="6147593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147596">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147600">if</span>&nbsp;<span class="ident" id="6147603"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6147604">.</span><span class="ident" id="6147605">Env</span>&nbsp;<span class="op" id="6147609">!=</span>&nbsp;<span class="ident" id="6147612">nil</span>&nbsp;<span class="op" id="6147616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147620"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147624">=</span>&nbsp;<span class="builtinfunc" id="6147626">append</span><span class="op" id="6147632">(</span><span class="ident" id="6147633"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147636">,</span>&nbsp;<span class="ident" id="6147638"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6147639">.</span><span class="ident" id="6147640">Env</span><span class="op" id="6147643">...</span><span class="op" id="6147646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147653">envPath</span>&nbsp;<span class="op" id="6147661">:=</span>&nbsp;<span class="ident" id="6147664"><a href="/net/http/cgi/host.go.html#6143853">os</a></span><span class="op" id="6147666">.</span><span class="ident" id="6147667">Getenv</span><span class="op" id="6147673">(</span><span class="string" id="6147674">&#34;PATH&#34;</span><span class="op" id="6147680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147683">if</span>&nbsp;<span class="ident" id="6147686"><a href="/net/http/cgi/host.go.html#6147653">envPath</a></span>&nbsp;<span class="op" id="6147694">==</span>&nbsp;<span class="string" id="6147697">&#34;&#34;</span>&nbsp;<span class="op" id="6147700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147704"><a href="/net/http/cgi/host.go.html#6147653">envPath</a></span>&nbsp;<span class="op" id="6147712">=</span>&nbsp;<span class="string" id="6147714">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147767"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147771">=</span>&nbsp;<span class="builtinfunc" id="6147773">append</span><span class="op" id="6147779">(</span><span class="ident" id="6147780"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147783">,</span>&nbsp;<span class="string" id="6147785">&#34;PATH=&#34;</span><span class="op" id="6147792">+</span><span class="ident" id="6147793"><a href="/net/http/cgi/host.go.html#6147653">envPath</a></span><span class="op" id="6147800">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147804">for</span>&nbsp;<span class="ident" id="6147808">_</span><span class="op" id="6147809">,</span>&nbsp;<span class="ident" id="6147811">e</span>&nbsp;<span class="op" id="6147813">:=</span>&nbsp;<span class="keyword" id="6147816">range</span>&nbsp;<span class="ident" id="6147822"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6147823">.</span><span class="ident" id="6147824">InheritEnv</span>&nbsp;<span class="op" id="6147835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147839">if</span>&nbsp;<span class="ident" id="6147842">v</span>&nbsp;<span class="op" id="6147844">:=</span>&nbsp;<span class="ident" id="6147847"><a href="/net/http/cgi/host.go.html#6143853">os</a></span><span class="op" id="6147849">.</span><span class="ident" id="6147850">Getenv</span><span class="op" id="6147856">(</span><span class="ident" id="6147857"><a href="/net/http/cgi/host.go.html#6147811">e</a></span><span class="op" id="6147858">)</span><span class="op" id="6147859">;</span>&nbsp;<span class="ident" id="6147861"><a href="/net/http/cgi/host.go.html#6147842">v</a></span>&nbsp;<span class="op" id="6147863">!=</span>&nbsp;<span class="string" id="6147866">&#34;&#34;</span>&nbsp;<span class="op" id="6147869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147874"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6147878">=</span>&nbsp;<span class="builtinfunc" id="6147880">append</span><span class="op" id="6147886">(</span><span class="ident" id="6147887"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6147890">,</span>&nbsp;<span class="ident" id="6147892"><a href="/net/http/cgi/host.go.html#6147811">e</a></span><span class="op" id="6147893">+</span><span class="string" id="6147894">&#34;=&#34;</span><span class="op" id="6147897">+</span><span class="ident" id="6147898"><a href="/net/http/cgi/host.go.html#6147842">v</a></span><span class="op" id="6147899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147903">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147910">for</span>&nbsp;<span class="ident" id="6147914">_</span><span class="op" id="6147915">,</span>&nbsp;<span class="ident" id="6147917">e</span>&nbsp;<span class="op" id="6147919">:=</span>&nbsp;<span class="keyword" id="6147922">range</span>&nbsp;<span class="ident" id="6147928"><a href="/net/http/cgi/host.go.html#6143989">osDefaultInheritEnv</a></span><span class="op" id="6147947">[</span><span class="ident" id="6147948"><a href="/net/http/cgi/host.go.html#6143897">runtime</a></span><span class="op" id="6147955">.</span><span class="ident" id="6147956">GOOS</span><span class="op" id="6147960">]</span>&nbsp;<span class="op" id="6147962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147966">if</span>&nbsp;<span class="ident" id="6147969">v</span>&nbsp;<span class="op" id="6147971">:=</span>&nbsp;<span class="ident" id="6147974"><a href="/net/http/cgi/host.go.html#6143853">os</a></span><span class="op" id="6147976">.</span><span class="ident" id="6147977">Getenv</span><span class="op" id="6147983">(</span><span class="ident" id="6147984"><a href="/net/http/cgi/host.go.html#6147917">e</a></span><span class="op" id="6147985">)</span><span class="op" id="6147986">;</span>&nbsp;<span class="ident" id="6147988"><a href="/net/http/cgi/host.go.html#6147969">v</a></span>&nbsp;<span class="op" id="6147990">!=</span>&nbsp;<span class="string" id="6147993">&#34;&#34;</span>&nbsp;<span class="op" id="6147996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148001"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6148005">=</span>&nbsp;<span class="builtinfunc" id="6148007">append</span><span class="op" id="6148013">(</span><span class="ident" id="6148014"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6148017">,</span>&nbsp;<span class="ident" id="6148019"><a href="/net/http/cgi/host.go.html#6147917">e</a></span><span class="op" id="6148020">+</span><span class="string" id="6148021">&#34;=&#34;</span><span class="op" id="6148024">+</span><span class="ident" id="6148025"><a href="/net/http/cgi/host.go.html#6147969">v</a></span><span class="op" id="6148026">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148037"><a href="/net/http/cgi/host.go.html#6146677">env</a></span>&nbsp;<span class="op" id="6148041">=</span>&nbsp;<span class="ident" id="6148043"><a href="/net/http/cgi/host.go.html#6145785">removeLeadingDuplicates</a></span><span class="op" id="6148066">(</span><span class="ident" id="6148067"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6148070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148074">var</span>&nbsp;<span class="ident" id="6148078">cwd</span><span class="op" id="6148081">,</span>&nbsp;<span class="ident" id="6148083">path</span>&nbsp;<span class="builtintype" id="6148088">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148096">if</span>&nbsp;<span class="ident" id="6148099"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148100">.</span><span class="ident" id="6148101">Dir</span>&nbsp;<span class="op" id="6148105">!=</span>&nbsp;<span class="string" id="6148108">&#34;&#34;</span>&nbsp;<span class="op" id="6148111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148115"><a href="/net/http/cgi/host.go.html#6148083">path</a></span>&nbsp;<span class="op" id="6148120">=</span>&nbsp;<span class="ident" id="6148122"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148123">.</span><span class="ident" id="6148124">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148131"><a href="/net/http/cgi/host.go.html#6148078">cwd</a></span>&nbsp;<span class="op" id="6148135">=</span>&nbsp;<span class="ident" id="6148137"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148138">.</span><span class="ident" id="6148139">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148144">}</span>&nbsp;<span class="keyword" id="6148146">else</span>&nbsp;<span class="op" id="6148151">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148155"><a href="/net/http/cgi/host.go.html#6148078">cwd</a></span><span class="op" id="6148158">,</span>&nbsp;<span class="ident" id="6148160"><a href="/net/http/cgi/host.go.html#6148083">path</a></span>&nbsp;<span class="op" id="6148165">=</span>&nbsp;<span class="ident" id="6148167"><a href="/net/http/cgi/host.go.html#6143870">filepath</a></span><span class="op" id="6148175">.</span><span class="ident" id="6148176">Split</span><span class="op" id="6148181">(</span><span class="ident" id="6148182"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148183">.</span><span class="ident" id="6148184">Path</span><span class="op" id="6148188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148194">if</span>&nbsp;<span class="ident" id="6148197"><a href="/net/http/cgi/host.go.html#6148078">cwd</a></span>&nbsp;<span class="op" id="6148201">==</span>&nbsp;<span class="string" id="6148204">&#34;&#34;</span>&nbsp;<span class="op" id="6148207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148211"><a href="/net/http/cgi/host.go.html#6148078">cwd</a></span>&nbsp;<span class="op" id="6148215">=</span>&nbsp;<span class="string" id="6148217">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148222">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148226">internalError</span>&nbsp;<span class="op" id="6148240">:=</span>&nbsp;<span class="keyword" id="6148243">func</span><span class="op" id="6148247">(</span><span class="ident" id="6148248">err</span>&nbsp;<span class="builtintype" id="6148252">error</span><span class="op" id="6148257">)</span>&nbsp;<span class="op" id="6148259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148263"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6148265">.</span><span class="ident" id="6148266">WriteHeader</span><span class="op" id="6148277">(</span><span class="ident" id="6148278"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6148282">.</span><span class="ident" id="6148283">StatusInternalServerError</span><span class="op" id="6148308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148312"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148313">.</span><span class="ident" id="6148314">printf</span><span class="op" id="6148320">(</span><span class="string" id="6148321">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6148336">,</span>&nbsp;<span class="ident" id="6148338"><a href="/net/http/cgi/host.go.html#6148248">err</a></span><span class="op" id="6148341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148344">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148348">cmd</span>&nbsp;<span class="op" id="6148352">:=</span>&nbsp;<span class="op" id="6148355">&amp;</span><span class="ident" id="6148356"><a href="/net/http/cgi/host.go.html#6143859">exec</a></span><span class="op" id="6148360">.</span><span class="ident" id="6148361">Cmd</span><span class="op" id="6148364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148368">Path</span><span class="op" id="6148372">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6148376"><a href="/net/http/cgi/host.go.html#6148083">path</a></span><span class="op" id="6148380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148384">Args</span><span class="op" id="6148388">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6148392">append</span><span class="op" id="6148398">(</span><span class="op" id="6148399">[</span><span class="op" id="6148400">]</span><span class="builtintype" id="6148401">string</span><span class="op" id="6148407">{</span><span class="ident" id="6148408"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148409">.</span><span class="ident" id="6148410">Path</span><span class="op" id="6148414">}</span><span class="op" id="6148415">,</span>&nbsp;<span class="ident" id="6148417"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6148418">.</span><span class="ident" id="6148419">Args</span><span class="op" id="6148423">...</span><span class="op" id="6148426">)</span><span class="op" id="6148427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148431">Dir</span><span class="op" id="6148434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6148439"><a href="/net/http/cgi/host.go.html#6148078">cwd</a></span><span class="op" id="6148442">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148446">Env</span><span class="op" id="6148449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6148454"><a href="/net/http/cgi/host.go.html#6146677">env</a></span><span class="op" id="6148457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148461">Stderr</span><span class="op" id="6148467">:</span>&nbsp;<span class="ident" id="6148469"><a href="/net/http/cgi/host.go.html#6143853">os</a></span><span class="op" id="6148471">.</span><span class="ident" id="6148472">Stderr</span><span class="op" id="6148478">,</span>&nbsp;<span class="comment" id="6148480">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148495">if</span>&nbsp;<span class="ident" id="6148498"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6148501">.</span><span class="ident" id="6148502">ContentLength</span>&nbsp;<span class="op" id="6148516">!=</span>&nbsp;<span class="num" id="6148519">0</span>&nbsp;<span class="op" id="6148521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148525"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6148528">.</span><span class="ident" id="6148529">Stdin</span>&nbsp;<span class="op" id="6148535">=</span>&nbsp;<span class="ident" id="6148537"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6148540">.</span><span class="ident" id="6148541">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148550">stdoutRead</span><span class="op" id="6148560">,</span>&nbsp;<span class="ident" id="6148562">err</span>&nbsp;<span class="op" id="6148566">:=</span>&nbsp;<span class="ident" id="6148569"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6148572">.</span><span class="ident" id="6148573">StdoutPipe</span><span class="op" id="6148583">(</span><span class="op" id="6148584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148587">if</span>&nbsp;<span class="ident" id="6148590"><a href="/net/http/cgi/host.go.html#6148562">err</a></span>&nbsp;<span class="op" id="6148594">!=</span>&nbsp;<span class="ident" id="6148597">nil</span>&nbsp;<span class="op" id="6148601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148605"><a href="/net/http/cgi/host.go.html#6148226">internalError</a></span><span class="op" id="6148618">(</span><span class="ident" id="6148619"><a href="/net/http/cgi/host.go.html#6148562">err</a></span><span class="op" id="6148622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148626">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148638"><a href="/net/http/cgi/host.go.html#6148562">err</a></span>&nbsp;<span class="op" id="6148642">=</span>&nbsp;<span class="ident" id="6148644"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6148647">.</span><span class="ident" id="6148648">Start</span><span class="op" id="6148653">(</span><span class="op" id="6148654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148657">if</span>&nbsp;<span class="ident" id="6148660"><a href="/net/http/cgi/host.go.html#6148562">err</a></span>&nbsp;<span class="op" id="6148664">!=</span>&nbsp;<span class="ident" id="6148667">nil</span>&nbsp;<span class="op" id="6148671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148675"><a href="/net/http/cgi/host.go.html#6148226">internalError</a></span><span class="op" id="6148688">(</span><span class="ident" id="6148689"><a href="/net/http/cgi/host.go.html#6148562">err</a></span><span class="op" id="6148692">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148707">if</span>&nbsp;<span class="ident" id="6148710">hook</span>&nbsp;<span class="op" id="6148715">:=</span>&nbsp;<span class="ident" id="6148718"><a href="/net/http/cgi/host.go.html#6152923">testHookStartProcess</a></span><span class="op" id="6148738">;</span>&nbsp;<span class="ident" id="6148740"><a href="/net/http/cgi/host.go.html#6148710">hook</a></span>&nbsp;<span class="op" id="6148745">!=</span>&nbsp;<span class="ident" id="6148748">nil</span>&nbsp;<span class="op" id="6148752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148756"><a href="/net/http/cgi/host.go.html#6148710">hook</a></span><span class="op" id="6148760">(</span><span class="ident" id="6148761"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6148764">.</span><span class="ident" id="6148765">Process</span><span class="op" id="6148772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148775">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148778">defer</span>&nbsp;<span class="ident" id="6148784"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6148787">.</span><span class="ident" id="6148788">Wait</span><span class="op" id="6148792">(</span><span class="op" id="6148793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148796">defer</span>&nbsp;<span class="ident" id="6148802"><a href="/net/http/cgi/host.go.html#6148550">stdoutRead</a></span><span class="op" id="6148812">.</span><span class="ident" id="6148813">Close</span><span class="op" id="6148818">(</span><span class="op" id="6148819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148823">linebody</span>&nbsp;<span class="op" id="6148832">:=</span>&nbsp;<span class="ident" id="6148835"><a href="/net/http/cgi/host.go.html#6143812">bufio</a></span><span class="op" id="6148840">.</span><span class="ident" id="6148841">NewReaderSize</span><span class="op" id="6148854">(</span><span class="ident" id="6148855"><a href="/net/http/cgi/host.go.html#6148550">stdoutRead</a></span><span class="op" id="6148865">,</span>&nbsp;<span class="num" id="6148867">1024</span><span class="op" id="6148871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148874">headers</span>&nbsp;<span class="op" id="6148882">:=</span>&nbsp;<span class="builtinfunc" id="6148885">make</span><span class="op" id="6148889">(</span><span class="ident" id="6148890"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6148894">.</span><span class="ident" id="6148895">Header</span><span class="op" id="6148901">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148904">statusCode</span>&nbsp;<span class="op" id="6148915">:=</span>&nbsp;<span class="num" id="6148918">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148921">headerLines</span>&nbsp;<span class="op" id="6148933">:=</span>&nbsp;<span class="num" id="6148936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148939">sawBlankLine</span>&nbsp;<span class="op" id="6148952">:=</span>&nbsp;<span class="builtintype" id="6148955">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148962">for</span>&nbsp;<span class="op" id="6148966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148970">line</span><span class="op" id="6148974">,</span>&nbsp;<span class="ident" id="6148976">isPrefix</span><span class="op" id="6148984">,</span>&nbsp;<span class="ident" id="6148986">err</span>&nbsp;<span class="op" id="6148990">:=</span>&nbsp;<span class="ident" id="6148993"><a href="/net/http/cgi/host.go.html#6148823">linebody</a></span><span class="op" id="6149001">.</span><span class="ident" id="6149002">ReadLine</span><span class="op" id="6149010">(</span><span class="op" id="6149011">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149015">if</span>&nbsp;<span class="ident" id="6149018"><a href="/net/http/cgi/host.go.html#6148976">isPrefix</a></span>&nbsp;<span class="op" id="6149027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149032"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6149034">.</span><span class="ident" id="6149035">WriteHeader</span><span class="op" id="6149046">(</span><span class="ident" id="6149047"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6149051">.</span><span class="ident" id="6149052">StatusInternalServerError</span><span class="op" id="6149077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149082"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149083">.</span><span class="ident" id="6149084">printf</span><span class="op" id="6149090">(</span><span class="string" id="6149091">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="6149131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149136">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149145">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149149">if</span>&nbsp;<span class="ident" id="6149152"><a href="/net/http/cgi/host.go.html#6148986">err</a></span>&nbsp;<span class="op" id="6149156">==</span>&nbsp;<span class="ident" id="6149159"><a href="/net/http/cgi/host.go.html#6143828">io</a></span><span class="op" id="6149161">.</span><span class="ident" id="6149162">EOF</span>&nbsp;<span class="op" id="6149166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149183">if</span>&nbsp;<span class="ident" id="6149186"><a href="/net/http/cgi/host.go.html#6148986">err</a></span>&nbsp;<span class="op" id="6149190">!=</span>&nbsp;<span class="ident" id="6149193">nil</span>&nbsp;<span class="op" id="6149197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149202"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6149204">.</span><span class="ident" id="6149205">WriteHeader</span><span class="op" id="6149216">(</span><span class="ident" id="6149217"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6149221">.</span><span class="ident" id="6149222">StatusInternalServerError</span><span class="op" id="6149247">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149252"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149253">.</span><span class="ident" id="6149254">printf</span><span class="op" id="6149260">(</span><span class="string" id="6149261">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="6149293">,</span>&nbsp;<span class="ident" id="6149295"><a href="/net/http/cgi/host.go.html#6148986">err</a></span><span class="op" id="6149298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149303">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149316">if</span>&nbsp;<span class="builtinfunc" id="6149319">len</span><span class="op" id="6149322">(</span><span class="ident" id="6149323"><a href="/net/http/cgi/host.go.html#6148970">line</a></span><span class="op" id="6149327">)</span>&nbsp;<span class="op" id="6149329">==</span>&nbsp;<span class="num" id="6149332">0</span>&nbsp;<span class="op" id="6149334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149339"><a href="/net/http/cgi/host.go.html#6148939">sawBlankLine</a></span>&nbsp;<span class="op" id="6149352">=</span>&nbsp;<span class="builtintype" id="6149354">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149362">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149374"><a href="/net/http/cgi/host.go.html#6148921">headerLines</a></span><span class="op" id="6149385">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149390">parts</span>&nbsp;<span class="op" id="6149396">:=</span>&nbsp;<span class="ident" id="6149399"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6149406">.</span><span class="ident" id="6149407">SplitN</span><span class="op" id="6149413">(</span><span class="builtintype" id="6149414">string</span><span class="op" id="6149420">(</span><span class="ident" id="6149421"><a href="/net/http/cgi/host.go.html#6148970">line</a></span><span class="op" id="6149425">)</span><span class="op" id="6149426">,</span>&nbsp;<span class="string" id="6149428">&#34;:&#34;</span><span class="op" id="6149431">,</span>&nbsp;<span class="num" id="6149433">2</span><span class="op" id="6149434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149438">if</span>&nbsp;<span class="builtinfunc" id="6149441">len</span><span class="op" id="6149444">(</span><span class="ident" id="6149445"><a href="/net/http/cgi/host.go.html#6149390">parts</a></span><span class="op" id="6149450">)</span>&nbsp;<span class="op" id="6149452">&lt;</span>&nbsp;<span class="num" id="6149454">2</span>&nbsp;<span class="op" id="6149456">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149461"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149462">.</span><span class="ident" id="6149463">printf</span><span class="op" id="6149469">(</span><span class="string" id="6149470">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="6149498">,</span>&nbsp;<span class="builtintype" id="6149500">string</span><span class="op" id="6149506">(</span><span class="ident" id="6149507"><a href="/net/http/cgi/host.go.html#6148970">line</a></span><span class="op" id="6149511">)</span><span class="op" id="6149512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149517">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149532">header</span><span class="op" id="6149538">,</span>&nbsp;<span class="ident" id="6149540">val</span>&nbsp;<span class="op" id="6149544">:=</span>&nbsp;<span class="ident" id="6149547"><a href="/net/http/cgi/host.go.html#6149390">parts</a></span><span class="op" id="6149552">[</span><span class="num" id="6149553">0</span><span class="op" id="6149554">]</span><span class="op" id="6149555">,</span>&nbsp;<span class="ident" id="6149557"><a href="/net/http/cgi/host.go.html#6149390">parts</a></span><span class="op" id="6149562">[</span><span class="num" id="6149563">1</span><span class="op" id="6149564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149568"><a href="/net/http/cgi/host.go.html#6149532">header</a></span>&nbsp;<span class="op" id="6149575">=</span>&nbsp;<span class="ident" id="6149577"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6149584">.</span><span class="ident" id="6149585">TrimSpace</span><span class="op" id="6149594">(</span><span class="ident" id="6149595"><a href="/net/http/cgi/host.go.html#6149532">header</a></span><span class="op" id="6149601">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149605"><a href="/net/http/cgi/host.go.html#6149540">val</a></span>&nbsp;<span class="op" id="6149609">=</span>&nbsp;<span class="ident" id="6149611"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6149618">.</span><span class="ident" id="6149619">TrimSpace</span><span class="op" id="6149628">(</span><span class="ident" id="6149629"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149636">switch</span>&nbsp;<span class="op" id="6149643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149647">case</span>&nbsp;<span class="ident" id="6149652"><a href="/net/http/cgi/host.go.html#6149532">header</a></span>&nbsp;<span class="op" id="6149659">==</span>&nbsp;<span class="string" id="6149662">&#34;Status&#34;</span><span class="op" id="6149670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149675">if</span>&nbsp;<span class="builtinfunc" id="6149678">len</span><span class="op" id="6149681">(</span><span class="ident" id="6149682"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149685">)</span>&nbsp;<span class="op" id="6149687">&lt;</span>&nbsp;<span class="num" id="6149689">3</span>&nbsp;<span class="op" id="6149691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149697"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149698">.</span><span class="ident" id="6149699">printf</span><span class="op" id="6149705">(</span><span class="string" id="6149706">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="6149737">,</span>&nbsp;<span class="ident" id="6149739"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149742">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149748">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149763">code</span><span class="op" id="6149767">,</span>&nbsp;<span class="ident" id="6149769">err</span>&nbsp;<span class="op" id="6149773">:=</span>&nbsp;<span class="ident" id="6149776"><a href="/net/http/cgi/host.go.html#6143908">strconv</a></span><span class="op" id="6149783">.</span><span class="ident" id="6149784">Atoi</span><span class="op" id="6149788">(</span><span class="ident" id="6149789"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149792">[</span><span class="num" id="6149793">0</span><span class="op" id="6149794">:</span><span class="num" id="6149795">3</span><span class="op" id="6149796">]</span><span class="op" id="6149797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149802">if</span>&nbsp;<span class="ident" id="6149805"><a href="/net/http/cgi/host.go.html#6149769">err</a></span>&nbsp;<span class="op" id="6149809">!=</span>&nbsp;<span class="ident" id="6149812">nil</span>&nbsp;<span class="op" id="6149816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149822"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149823">.</span><span class="ident" id="6149824">printf</span><span class="op" id="6149830">(</span><span class="string" id="6149831">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="6149854">,</span>&nbsp;<span class="ident" id="6149856"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149859">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149865"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6149866">.</span><span class="ident" id="6149867">printf</span><span class="op" id="6149873">(</span><span class="string" id="6149874">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="6149892">,</span>&nbsp;<span class="ident" id="6149894"><a href="/net/http/cgi/host.go.html#6148970">line</a></span><span class="op" id="6149898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149904">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149919"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6149930">=</span>&nbsp;<span class="ident" id="6149932"><a href="/net/http/cgi/host.go.html#6149763">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149939">default</span><span class="op" id="6149946">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149951"><a href="/net/http/cgi/host.go.html#6148874">headers</a></span><span class="op" id="6149958">.</span><span class="ident" id="6149959">Add</span><span class="op" id="6149962">(</span><span class="ident" id="6149963"><a href="/net/http/cgi/host.go.html#6149532">header</a></span><span class="op" id="6149969">,</span>&nbsp;<span class="ident" id="6149971"><a href="/net/http/cgi/host.go.html#6149540">val</a></span><span class="op" id="6149974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149984">if</span>&nbsp;<span class="ident" id="6149987"><a href="/net/http/cgi/host.go.html#6148921">headerLines</a></span>&nbsp;<span class="op" id="6149999">==</span>&nbsp;<span class="num" id="6150002">0</span>&nbsp;<span class="op" id="6150004">||</span>&nbsp;<span class="op" id="6150007">!</span><span class="ident" id="6150008"><a href="/net/http/cgi/host.go.html#6148939">sawBlankLine</a></span>&nbsp;<span class="op" id="6150021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150025"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150027">.</span><span class="ident" id="6150028">WriteHeader</span><span class="op" id="6150039">(</span><span class="ident" id="6150040"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6150044">.</span><span class="ident" id="6150045">StatusInternalServerError</span><span class="op" id="6150070">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150074"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6150075">.</span><span class="ident" id="6150076">printf</span><span class="op" id="6150082">(</span><span class="string" id="6150083">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="6150100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150116">if</span>&nbsp;<span class="ident" id="6150119">loc</span>&nbsp;<span class="op" id="6150123">:=</span>&nbsp;<span class="ident" id="6150126"><a href="/net/http/cgi/host.go.html#6148874">headers</a></span><span class="op" id="6150133">.</span><span class="ident" id="6150134">Get</span><span class="op" id="6150137">(</span><span class="string" id="6150138">&#34;Location&#34;</span><span class="op" id="6150148">)</span><span class="op" id="6150149">;</span>&nbsp;<span class="ident" id="6150151"><a href="/net/http/cgi/host.go.html#6150119">loc</a></span>&nbsp;<span class="op" id="6150155">!=</span>&nbsp;<span class="string" id="6150158">&#34;&#34;</span>&nbsp;<span class="op" id="6150161">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150165">if</span>&nbsp;<span class="ident" id="6150168"><a href="/net/http/cgi/host.go.html#6143919">strings</a></span><span class="op" id="6150175">.</span><span class="ident" id="6150176">HasPrefix</span><span class="op" id="6150185">(</span><span class="ident" id="6150186"><a href="/net/http/cgi/host.go.html#6150119">loc</a></span><span class="op" id="6150189">,</span>&nbsp;<span class="string" id="6150191">&#34;/&#34;</span><span class="op" id="6150194">)</span>&nbsp;<span class="op" id="6150196">&amp;&amp;</span>&nbsp;<span class="ident" id="6150199"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6150200">.</span><span class="ident" id="6150201">PathLocationHandler</span>&nbsp;<span class="op" id="6150221">!=</span>&nbsp;<span class="ident" id="6150224">nil</span>&nbsp;<span class="op" id="6150228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150233"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6150234">.</span><span class="ident" id="6150235">handleInternalRedirect</span><span class="op" id="6150257">(</span><span class="ident" id="6150258"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150260">,</span>&nbsp;<span class="ident" id="6150262"><a href="/net/http/cgi/host.go.html#6146170">req</a></span><span class="op" id="6150265">,</span>&nbsp;<span class="ident" id="6150267"><a href="/net/http/cgi/host.go.html#6150119">loc</a></span><span class="op" id="6150270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150288">if</span>&nbsp;<span class="ident" id="6150291"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6150302">==</span>&nbsp;<span class="num" id="6150305">0</span>&nbsp;<span class="op" id="6150307">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150312"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6150323">=</span>&nbsp;<span class="ident" id="6150325"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6150329">.</span><span class="ident" id="6150330">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150351">if</span>&nbsp;<span class="ident" id="6150354"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6150365">==</span>&nbsp;<span class="num" id="6150368">0</span>&nbsp;<span class="op" id="6150370">&amp;&amp;</span>&nbsp;<span class="ident" id="6150373"><a href="/net/http/cgi/host.go.html#6148874">headers</a></span><span class="op" id="6150380">.</span><span class="ident" id="6150381">Get</span><span class="op" id="6150384">(</span><span class="string" id="6150385">&#34;Content-Type&#34;</span><span class="op" id="6150399">)</span>&nbsp;<span class="op" id="6150401">==</span>&nbsp;<span class="string" id="6150404">&#34;&#34;</span>&nbsp;<span class="op" id="6150407">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150411"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150413">.</span><span class="ident" id="6150414">WriteHeader</span><span class="op" id="6150425">(</span><span class="ident" id="6150426"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6150430">.</span><span class="ident" id="6150431">StatusInternalServerError</span><span class="op" id="6150456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150460"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6150461">.</span><span class="ident" id="6150462">printf</span><span class="op" id="6150468">(</span><span class="string" id="6150469">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="6150516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150532">if</span>&nbsp;<span class="ident" id="6150535"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6150546">==</span>&nbsp;<span class="num" id="6150549">0</span>&nbsp;<span class="op" id="6150551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150555"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span>&nbsp;<span class="op" id="6150566">=</span>&nbsp;<span class="ident" id="6150568"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6150572">.</span><span class="ident" id="6150573">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150587">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150648">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150708">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150742">for</span>&nbsp;<span class="ident" id="6150746">k</span><span class="op" id="6150747">,</span>&nbsp;<span class="ident" id="6150749">vv</span>&nbsp;<span class="op" id="6150752">:=</span>&nbsp;<span class="keyword" id="6150755">range</span>&nbsp;<span class="ident" id="6150761"><a href="/net/http/cgi/host.go.html#6148874">headers</a></span>&nbsp;<span class="op" id="6150769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150773">for</span>&nbsp;<span class="ident" id="6150777">_</span><span class="op" id="6150778">,</span>&nbsp;<span class="ident" id="6150780">v</span>&nbsp;<span class="op" id="6150782">:=</span>&nbsp;<span class="keyword" id="6150785">range</span>&nbsp;<span class="ident" id="6150791"><a href="/net/http/cgi/host.go.html#6150749">vv</a></span>&nbsp;<span class="op" id="6150794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150799"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150801">.</span><span class="ident" id="6150802">Header</span><span class="op" id="6150808">(</span><span class="op" id="6150809">)</span><span class="op" id="6150810">.</span><span class="ident" id="6150811">Add</span><span class="op" id="6150814">(</span><span class="ident" id="6150815"><a href="/net/http/cgi/host.go.html#6150746">k</a></span><span class="op" id="6150816">,</span>&nbsp;<span class="ident" id="6150818"><a href="/net/http/cgi/host.go.html#6150780">v</a></span><span class="op" id="6150819">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150830"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150832">.</span><span class="ident" id="6150833">WriteHeader</span><span class="op" id="6150844">(</span><span class="ident" id="6150845"><a href="/net/http/cgi/host.go.html#6148904">statusCode</a></span><span class="op" id="6150855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150859">_</span><span class="op" id="6150860">,</span>&nbsp;<span class="ident" id="6150862"><a href="/net/http/cgi/host.go.html#6148562">err</a></span>&nbsp;<span class="op" id="6150866">=</span>&nbsp;<span class="ident" id="6150868"><a href="/net/http/cgi/host.go.html#6143828">io</a></span><span class="op" id="6150870">.</span><span class="ident" id="6150871">Copy</span><span class="op" id="6150875">(</span><span class="ident" id="6150876"><a href="/net/http/cgi/host.go.html#6146146">rw</a></span><span class="op" id="6150878">,</span>&nbsp;<span class="ident" id="6150880"><a href="/net/http/cgi/host.go.html#6148823">linebody</a></span><span class="op" id="6150888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150891">if</span>&nbsp;<span class="ident" id="6150894"><a href="/net/http/cgi/host.go.html#6148562">err</a></span>&nbsp;<span class="op" id="6150898">!=</span>&nbsp;<span class="ident" id="6150901">nil</span>&nbsp;<span class="op" id="6150905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150909"><a href="/net/http/cgi/host.go.html#6146124">h</a></span><span class="op" id="6150910">.</span><span class="ident" id="6150911">printf</span><span class="op" id="6150917">(</span><span class="string" id="6150918">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6150939">,</span>&nbsp;<span class="ident" id="6150941"><a href="/net/http/cgi/host.go.html#6148562">err</a></span><span class="op" id="6150944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150948">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151004">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151059">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151115">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151168">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151226">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151270"><a href="/net/http/cgi/host.go.html#6148348">cmd</a></span><span class="op" id="6151273">.</span><span class="ident" id="6151274">Process</span><span class="op" id="6151281">.</span><span class="ident" id="6151282">Kill</span><span class="op" id="6151286">(</span><span class="op" id="6151287">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151290">}</span><br>
<span class="lineno"></span><span class="op" id="6151292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6151295">func</span>&nbsp;<span class="op" id="6151300">(</span><span class="ident" id="6151301">h</span>&nbsp;<span class="op" id="6151303">*</span><span class="ident" id="6151304"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="6151311">)</span>&nbsp;<span class="ident" id="6151313">printf</span><span class="op" id="6151319">(</span><span class="ident" id="6151320">format</span>&nbsp;<span class="builtintype" id="6151327">string</span><span class="op" id="6151333">,</span>&nbsp;<span class="ident" id="6151335">v</span>&nbsp;<span class="op" id="6151337">...</span><span class="keyword" id="6151340">interface</span><span class="op" id="6151349">{</span><span class="op" id="6151350">}</span><span class="op" id="6151351">)</span>&nbsp;<span class="op" id="6151353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151356">if</span>&nbsp;<span class="ident" id="6151359"><a href="/net/http/cgi/host.go.html#6151301">h</a></span><span class="op" id="6151360">.</span><span class="ident" id="6151361">Logger</span>&nbsp;<span class="op" id="6151368">!=</span>&nbsp;<span class="ident" id="6151371">nil</span>&nbsp;<span class="op" id="6151375">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151379"><a href="/net/http/cgi/host.go.html#6151301">h</a></span><span class="op" id="6151380">.</span><span class="ident" id="6151381">Logger</span><span class="op" id="6151387">.</span><span class="ident" id="6151388">Printf</span><span class="op" id="6151394">(</span><span class="ident" id="6151395"><a href="/net/http/cgi/host.go.html#6151320">format</a></span><span class="op" id="6151401">,</span>&nbsp;<span class="ident" id="6151403"><a href="/net/http/cgi/host.go.html#6151335">v</a></span><span class="op" id="6151404">...</span><span class="op" id="6151407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151410">}</span>&nbsp;<span class="keyword" id="6151412">else</span>&nbsp;<span class="op" id="6151417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151421"><a href="/net/http/cgi/host.go.html#6143834">log</a></span><span class="op" id="6151424">.</span><span class="ident" id="6151425">Printf</span><span class="op" id="6151431">(</span><span class="ident" id="6151432"><a href="/net/http/cgi/host.go.html#6151320">format</a></span><span class="op" id="6151438">,</span>&nbsp;<span class="ident" id="6151440"><a href="/net/http/cgi/host.go.html#6151335">v</a></span><span class="op" id="6151441">...</span><span class="op" id="6151444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151447">}</span><br>
<span class="lineno"></span><span class="op" id="6151449">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6151452">func</span>&nbsp;<span class="op" id="6151457">(</span><span class="ident" id="6151458">h</span>&nbsp;<span class="op" id="6151460">*</span><span class="ident" id="6151461"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="6151468">)</span>&nbsp;<span class="ident" id="6151470">handleInternalRedirect</span><span class="op" id="6151492">(</span><span class="ident" id="6151493">rw</span>&nbsp;<span class="ident" id="6151496"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6151500">.</span><span class="ident" id="6151501">ResponseWriter</span><span class="op" id="6151515">,</span>&nbsp;<span class="ident" id="6151517">req</span>&nbsp;<span class="op" id="6151521">*</span><span class="ident" id="6151522"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6151526">.</span><span class="ident" id="6151527">Request</span><span class="op" id="6151534">,</span>&nbsp;<span class="ident" id="6151536">path</span>&nbsp;<span class="builtintype" id="6151541">string</span><span class="op" id="6151547">)</span>&nbsp;<span class="op" id="6151549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151552">url</span><span class="op" id="6151555">,</span>&nbsp;<span class="ident" id="6151557">err</span>&nbsp;<span class="op" id="6151561">:=</span>&nbsp;<span class="ident" id="6151564"><a href="/net/http/cgi/host.go.html#6151517">req</a></span><span class="op" id="6151567">.</span><span class="ident" id="6151568">URL</span><span class="op" id="6151571">.</span><span class="ident" id="6151572">Parse</span><span class="op" id="6151577">(</span><span class="ident" id="6151578"><a href="/net/http/cgi/host.go.html#6151536">path</a></span><span class="op" id="6151582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151585">if</span>&nbsp;<span class="ident" id="6151588"><a href="/net/http/cgi/host.go.html#6151557">err</a></span>&nbsp;<span class="op" id="6151592">!=</span>&nbsp;<span class="ident" id="6151595">nil</span>&nbsp;<span class="op" id="6151599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151603"><a href="/net/http/cgi/host.go.html#6151493">rw</a></span><span class="op" id="6151605">.</span><span class="ident" id="6151606">WriteHeader</span><span class="op" id="6151617">(</span><span class="ident" id="6151618"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6151622">.</span><span class="ident" id="6151623">StatusInternalServerError</span><span class="op" id="6151648">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151652"><a href="/net/http/cgi/host.go.html#6151458">h</a></span><span class="op" id="6151653">.</span><span class="ident" id="6151654">printf</span><span class="op" id="6151660">(</span><span class="string" id="6151661">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="6151705">,</span>&nbsp;<span class="ident" id="6151707"><a href="/net/http/cgi/host.go.html#6151536">path</a></span><span class="op" id="6151711">,</span>&nbsp;<span class="ident" id="6151713"><a href="/net/http/cgi/host.go.html#6151557">err</a></span><span class="op" id="6151716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151720">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151731">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151795">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151856">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151918">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151979">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152041">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152102">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152155">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152217">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152237">newReq</span>&nbsp;<span class="op" id="6152244">:=</span>&nbsp;<span class="op" id="6152247">&amp;</span><span class="ident" id="6152248"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6152252">.</span><span class="ident" id="6152253">Request</span><span class="op" id="6152260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152264">Method</span><span class="op" id="6152270">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6152276">&#34;GET&#34;</span><span class="op" id="6152281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152285">URL</span><span class="op" id="6152288">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6152297"><a href="/net/http/cgi/host.go.html#6151552">url</a></span><span class="op" id="6152300">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152304">Proto</span><span class="op" id="6152309">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6152316">&#34;HTTP/1.1&#34;</span><span class="op" id="6152326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152330">ProtoMajor</span><span class="op" id="6152340">:</span>&nbsp;<span class="num" id="6152342">1</span><span class="op" id="6152343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152347">ProtoMinor</span><span class="op" id="6152357">:</span>&nbsp;<span class="num" id="6152359">1</span><span class="op" id="6152360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152364">Header</span><span class="op" id="6152370">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6152376">make</span><span class="op" id="6152380">(</span><span class="ident" id="6152381"><a href="/net/http/cgi/host.go.html#6143841">http</a></span><span class="op" id="6152385">.</span><span class="ident" id="6152386">Header</span><span class="op" id="6152392">)</span><span class="op" id="6152393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152397">Host</span><span class="op" id="6152401">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6152409"><a href="/net/http/cgi/host.go.html#6151552">url</a></span><span class="op" id="6152412">.</span><span class="ident" id="6152413">Host</span><span class="op" id="6152417">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152421">RemoteAddr</span><span class="op" id="6152431">:</span>&nbsp;<span class="ident" id="6152433"><a href="/net/http/cgi/host.go.html#6151517">req</a></span><span class="op" id="6152436">.</span><span class="ident" id="6152437">RemoteAddr</span><span class="op" id="6152447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152451">TLS</span><span class="op" id="6152454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6152463"><a href="/net/http/cgi/host.go.html#6151517">req</a></span><span class="op" id="6152466">.</span><span class="ident" id="6152467">TLS</span><span class="op" id="6152470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152476"><a href="/net/http/cgi/host.go.html#6151458">h</a></span><span class="op" id="6152477">.</span><span class="ident" id="6152478">PathLocationHandler</span><span class="op" id="6152497">.</span><span class="ident" id="6152498">ServeHTTP</span><span class="op" id="6152507">(</span><span class="ident" id="6152508"><a href="/net/http/cgi/host.go.html#6151493">rw</a></span><span class="op" id="6152510">,</span>&nbsp;<span class="ident" id="6152512"><a href="/net/http/cgi/host.go.html#6152237">newReq</a></span><span class="op" id="6152518">)</span><br>
<span class="lineno"></span><span class="op" id="6152520">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="6152523">func</span>&nbsp;<span class="ident" id="6152528">upperCaseAndUnderscore</span><span class="op" id="6152550">(</span><span class="ident" id="6152551">r</span>&nbsp;<span class="builtintype" id="6152553">rune</span><span class="op" id="6152557">)</span>&nbsp;<span class="builtintype" id="6152559">rune</span>&nbsp;<span class="op" id="6152564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152567">switch</span>&nbsp;<span class="op" id="6152574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152577">case</span>&nbsp;<span class="ident" id="6152582"><a href="/net/http/cgi/host.go.html#6152551">r</a></span>&nbsp;<span class="op" id="6152584">&gt;=</span>&nbsp;<span class="string" id="6152587">&#39;a&#39;</span>&nbsp;<span class="op" id="6152591">&amp;&amp;</span>&nbsp;<span class="ident" id="6152594"><a href="/net/http/cgi/host.go.html#6152551">r</a></span>&nbsp;<span class="op" id="6152596">&lt;=</span>&nbsp;<span class="string" id="6152599">&#39;z&#39;</span><span class="op" id="6152602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152606">return</span>&nbsp;<span class="ident" id="6152613"><a href="/net/http/cgi/host.go.html#6152551">r</a></span>&nbsp;<span class="op" id="6152615">-</span>&nbsp;<span class="op" id="6152617">(</span><span class="string" id="6152618">&#39;a&#39;</span>&nbsp;<span class="op" id="6152622">-</span>&nbsp;<span class="string" id="6152624">&#39;A&#39;</span><span class="op" id="6152627">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152630">case</span>&nbsp;<span class="ident" id="6152635"><a href="/net/http/cgi/host.go.html#6152551">r</a></span>&nbsp;<span class="op" id="6152637">==</span>&nbsp;<span class="string" id="6152640">&#39;-&#39;</span><span class="op" id="6152643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152647">return</span>&nbsp;<span class="string" id="6152654">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152659">case</span>&nbsp;<span class="ident" id="6152664"><a href="/net/http/cgi/host.go.html#6152551">r</a></span>&nbsp;<span class="op" id="6152666">==</span>&nbsp;<span class="string" id="6152669">&#39;=&#39;</span><span class="op" id="6152672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152676">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152732">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152787">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152839">return</span>&nbsp;<span class="string" id="6152846">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152854">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152907">return</span>&nbsp;<span class="ident" id="6152914"><a href="/net/http/cgi/host.go.html#6152551">r</a></span><br>
<span class="lineno">375</span><span class="op" id="6152916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6152919">var</span>&nbsp;<span class="ident" id="6152923">testHookStartProcess</span>&nbsp;<span class="keyword" id="6152944">func</span><span class="op" id="6152948">(</span><span class="op" id="6152949">*</span><span class="ident" id="6152950"><a href="/net/http/cgi/host.go.html#6143853">os</a></span><span class="op" id="6152952">.</span><span class="ident" id="6152953">Process</span><span class="op" id="6152960">)</span>&nbsp;<span class="comment" id="6152962">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
