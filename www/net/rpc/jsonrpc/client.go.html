<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6274002">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6274058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6274112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6274163">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="6274232">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6274256">package</span>&nbsp;<span class="ident" id="6274264">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6274273">import</span>&nbsp;<span class="op" id="6274280">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274283">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274300">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274307">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274313">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274320">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274331">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6274338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6274341">type</span>&nbsp;<span class="ident" id="6274346">clientCodec</span>&nbsp;<span class="keyword" id="6274358">struct</span>&nbsp;<span class="op" id="6274365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274368">dec</span>&nbsp;<span class="op" id="6274372">*</span><span class="ident" id="6274373"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6274377">.</span><span class="ident" id="6274378">Decoder</span>&nbsp;<span class="comment" id="6274386">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274414">enc</span>&nbsp;<span class="op" id="6274418">*</span><span class="ident" id="6274419"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6274423">.</span><span class="ident" id="6274424">Encoder</span>&nbsp;<span class="comment" id="6274432">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274460">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6274464"><a href="/net/rpc/jsonrpc/client.go.html#6274307">io</a></span><span class="op" id="6274466">.</span><span class="ident" id="6274467">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274476">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274501">req</span>&nbsp;&nbsp;<span class="ident" id="6274506"><a href="/net/rpc/jsonrpc/client.go.html#6275183">clientRequest</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274521">resp</span>&nbsp;<span class="ident" id="6274526"><a href="/net/rpc/jsonrpc/client.go.html#6275582">clientResponse</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274543">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274617">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274647">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274712">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274785">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6274793"><a href="/net/rpc/jsonrpc/client.go.html#6274331">sync</a></span><span class="op" id="6274797">.</span><span class="ident" id="6274798">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6274811">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274832">pending</span>&nbsp;<span class="keyword" id="6274840">map</span><span class="op" id="6274843">[</span><span class="ident" id="6274844">uint64</span><span class="op" id="6274850">]</span><span class="builtintype" id="6274851">string</span>&nbsp;<span class="comment" id="6274858">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="6274891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6274894">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="6274966">func</span>&nbsp;<span class="ident" id="6274971">NewClientCodec</span><span class="op" id="6274985">(</span><span class="ident" id="6274986">conn</span>&nbsp;<span class="ident" id="6274991"><a href="/net/rpc/jsonrpc/client.go.html#6274307">io</a></span><span class="op" id="6274993">.</span><span class="ident" id="6274994">ReadWriteCloser</span><span class="op" id="6275009">)</span>&nbsp;<span class="ident" id="6275011"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6275014">.</span><span class="ident" id="6275015">ClientCodec</span>&nbsp;<span class="op" id="6275027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275030">return</span>&nbsp;<span class="op" id="6275037">&amp;</span><span class="ident" id="6275038"><a href="/net/rpc/jsonrpc/client.go.html#6274346">clientCodec</a></span><span class="op" id="6275049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275053">dec</span><span class="op" id="6275056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275062"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6275066">.</span><span class="ident" id="6275067">NewDecoder</span><span class="op" id="6275077">(</span><span class="ident" id="6275078"><a href="/net/rpc/jsonrpc/client.go.html#6274986">conn</a></span><span class="op" id="6275082">)</span><span class="op" id="6275083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275087">enc</span><span class="op" id="6275090">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275096"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6275100">.</span><span class="ident" id="6275101">NewEncoder</span><span class="op" id="6275111">(</span><span class="ident" id="6275112"><a href="/net/rpc/jsonrpc/client.go.html#6274986">conn</a></span><span class="op" id="6275116">)</span><span class="op" id="6275117">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275121">c</span><span class="op" id="6275122">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275130"><a href="/net/rpc/jsonrpc/client.go.html#6274986">conn</a></span><span class="op" id="6275134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275138">pending</span><span class="op" id="6275145">:</span>&nbsp;<span class="builtinfunc" id="6275147">make</span><span class="op" id="6275151">(</span><span class="keyword" id="6275152">map</span><span class="op" id="6275155">[</span><span class="ident" id="6275156">uint64</span><span class="op" id="6275162">]</span><span class="builtintype" id="6275163">string</span><span class="op" id="6275169">)</span><span class="op" id="6275170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275173">}</span><br>
<span class="lineno"></span><span class="op" id="6275175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6275178">type</span>&nbsp;<span class="ident" id="6275183">clientRequest</span>&nbsp;<span class="keyword" id="6275197">struct</span>&nbsp;<span class="op" id="6275204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275207">Method</span>&nbsp;<span class="builtintype" id="6275214">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6275229">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275246">Params</span>&nbsp;<span class="op" id="6275253">[</span><span class="num" id="6275254">1</span><span class="op" id="6275255">]</span><span class="keyword" id="6275256">interface</span><span class="op" id="6275265">{</span><span class="op" id="6275266">}</span>&nbsp;<span class="string" id="6275268">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275285">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275292">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6275307">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6275319">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6275322">func</span>&nbsp;<span class="op" id="6275327">(</span><span class="ident" id="6275328">c</span>&nbsp;<span class="op" id="6275330">*</span><span class="ident" id="6275331"><a href="/net/rpc/jsonrpc/client.go.html#6274346">clientCodec</a></span><span class="op" id="6275342">)</span>&nbsp;<span class="ident" id="6275344">WriteRequest</span><span class="op" id="6275356">(</span><span class="ident" id="6275357">r</span>&nbsp;<span class="op" id="6275359">*</span><span class="ident" id="6275360"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6275363">.</span><span class="ident" id="6275364">Request</span><span class="op" id="6275371">,</span>&nbsp;<span class="ident" id="6275373">param</span>&nbsp;<span class="keyword" id="6275379">interface</span><span class="op" id="6275388">{</span><span class="op" id="6275389">}</span><span class="op" id="6275390">)</span>&nbsp;<span class="builtintype" id="6275392">error</span>&nbsp;<span class="op" id="6275398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275401"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275402">.</span><span class="ident" id="6275403">mutex</span><span class="op" id="6275408">.</span><span class="ident" id="6275409">Lock</span><span class="op" id="6275413">(</span><span class="op" id="6275414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275417"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275418">.</span><span class="ident" id="6275419">pending</span><span class="op" id="6275426">[</span><span class="ident" id="6275427"><a href="/net/rpc/jsonrpc/client.go.html#6275357">r</a></span><span class="op" id="6275428">.</span><span class="ident" id="6275429">Seq</span><span class="op" id="6275432">]</span>&nbsp;<span class="op" id="6275434">=</span>&nbsp;<span class="ident" id="6275436"><a href="/net/rpc/jsonrpc/client.go.html#6275357">r</a></span><span class="op" id="6275437">.</span><span class="ident" id="6275438">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275453"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275454">.</span><span class="ident" id="6275455">mutex</span><span class="op" id="6275460">.</span><span class="ident" id="6275461">Unlock</span><span class="op" id="6275467">(</span><span class="op" id="6275468">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275471"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275472">.</span><span class="ident" id="6275473">req</span><span class="op" id="6275476">.</span><span class="ident" id="6275477">Method</span>&nbsp;<span class="op" id="6275484">=</span>&nbsp;<span class="ident" id="6275486"><a href="/net/rpc/jsonrpc/client.go.html#6275357">r</a></span><span class="op" id="6275487">.</span><span class="ident" id="6275488">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275503"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275504">.</span><span class="ident" id="6275505">req</span><span class="op" id="6275508">.</span><span class="ident" id="6275509">Params</span><span class="op" id="6275515">[</span><span class="num" id="6275516">0</span><span class="op" id="6275517">]</span>&nbsp;<span class="op" id="6275519">=</span>&nbsp;<span class="ident" id="6275521"><a href="/net/rpc/jsonrpc/client.go.html#6275373">param</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275528"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275529">.</span><span class="ident" id="6275530">req</span><span class="op" id="6275533">.</span><span class="ident" id="6275534">Id</span>&nbsp;<span class="op" id="6275537">=</span>&nbsp;<span class="ident" id="6275539"><a href="/net/rpc/jsonrpc/client.go.html#6275357">r</a></span><span class="op" id="6275540">.</span><span class="ident" id="6275541">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275546">return</span>&nbsp;<span class="ident" id="6275553"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275554">.</span><span class="ident" id="6275555">enc</span><span class="op" id="6275558">.</span><span class="ident" id="6275559">Encode</span><span class="op" id="6275565">(</span><span class="op" id="6275566">&amp;</span><span class="ident" id="6275567"><a href="/net/rpc/jsonrpc/client.go.html#6275328">c</a></span><span class="op" id="6275568">.</span><span class="ident" id="6275569">req</span><span class="op" id="6275572">)</span><br>
<span class="lineno"></span><span class="op" id="6275574">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6275577">type</span>&nbsp;<span class="ident" id="6275582">clientResponse</span>&nbsp;<span class="keyword" id="6275597">struct</span>&nbsp;<span class="op" id="6275604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275607">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6275614">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6275631">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275644">Result</span>&nbsp;<span class="op" id="6275651">*</span><span class="ident" id="6275652"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6275656">.</span><span class="ident" id="6275657">RawMessage</span>&nbsp;<span class="string" id="6275668">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275685">Error</span>&nbsp;&nbsp;<span class="keyword" id="6275692">interface</span><span class="op" id="6275701">{</span><span class="op" id="6275702">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6275709">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="6275724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6275727">func</span>&nbsp;<span class="op" id="6275732">(</span><span class="ident" id="6275733">r</span>&nbsp;<span class="op" id="6275735">*</span><span class="ident" id="6275736"><a href="/net/rpc/jsonrpc/client.go.html#6275582">clientResponse</a></span><span class="op" id="6275750">)</span>&nbsp;<span class="ident" id="6275752">reset</span><span class="op" id="6275757">(</span><span class="op" id="6275758">)</span>&nbsp;<span class="op" id="6275760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275763"><a href="/net/rpc/jsonrpc/client.go.html#6275733">r</a></span><span class="op" id="6275764">.</span><span class="ident" id="6275765">Id</span>&nbsp;<span class="op" id="6275768">=</span>&nbsp;<span class="num" id="6275770">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275773"><a href="/net/rpc/jsonrpc/client.go.html#6275733">r</a></span><span class="op" id="6275774">.</span><span class="ident" id="6275775">Result</span>&nbsp;<span class="op" id="6275782">=</span>&nbsp;<span class="ident" id="6275784">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275789"><a href="/net/rpc/jsonrpc/client.go.html#6275733">r</a></span><span class="op" id="6275790">.</span><span class="ident" id="6275791">Error</span>&nbsp;<span class="op" id="6275797">=</span>&nbsp;<span class="ident" id="6275799">nil</span><br>
<span class="lineno"></span><span class="op" id="6275803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6275806">func</span>&nbsp;<span class="op" id="6275811">(</span><span class="ident" id="6275812">c</span>&nbsp;<span class="op" id="6275814">*</span><span class="ident" id="6275815"><a href="/net/rpc/jsonrpc/client.go.html#6274346">clientCodec</a></span><span class="op" id="6275826">)</span>&nbsp;<span class="ident" id="6275828">ReadResponseHeader</span><span class="op" id="6275846">(</span><span class="ident" id="6275847">r</span>&nbsp;<span class="op" id="6275849">*</span><span class="ident" id="6275850"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6275853">.</span><span class="ident" id="6275854">Response</span><span class="op" id="6275862">)</span>&nbsp;<span class="builtintype" id="6275864">error</span>&nbsp;<span class="op" id="6275870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275873"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275874">.</span><span class="ident" id="6275875">resp</span><span class="op" id="6275879">.</span><span class="ident" id="6275880">reset</span><span class="op" id="6275885">(</span><span class="op" id="6275886">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275889">if</span>&nbsp;<span class="ident" id="6275892">err</span>&nbsp;<span class="op" id="6275896">:=</span>&nbsp;<span class="ident" id="6275899"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275900">.</span><span class="ident" id="6275901">dec</span><span class="op" id="6275904">.</span><span class="ident" id="6275905">Decode</span><span class="op" id="6275911">(</span><span class="op" id="6275912">&amp;</span><span class="ident" id="6275913"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275914">.</span><span class="ident" id="6275915">resp</span><span class="op" id="6275919">)</span><span class="op" id="6275920">;</span>&nbsp;<span class="ident" id="6275922"><a href="/net/rpc/jsonrpc/client.go.html#6275892">err</a></span>&nbsp;<span class="op" id="6275926">!=</span>&nbsp;<span class="ident" id="6275929">nil</span>&nbsp;<span class="op" id="6275933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275937">return</span>&nbsp;<span class="ident" id="6275944"><a href="/net/rpc/jsonrpc/client.go.html#6275892">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275953"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275954">.</span><span class="ident" id="6275955">mutex</span><span class="op" id="6275960">.</span><span class="ident" id="6275961">Lock</span><span class="op" id="6275965">(</span><span class="op" id="6275966">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275969"><a href="/net/rpc/jsonrpc/client.go.html#6275847">r</a></span><span class="op" id="6275970">.</span><span class="ident" id="6275971">ServiceMethod</span>&nbsp;<span class="op" id="6275985">=</span>&nbsp;<span class="ident" id="6275987"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275988">.</span><span class="ident" id="6275989">pending</span><span class="op" id="6275996">[</span><span class="ident" id="6275997"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6275998">.</span><span class="ident" id="6275999">resp</span><span class="op" id="6276003">.</span><span class="ident" id="6276004">Id</span><span class="op" id="6276006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6276009">delete</span><span class="op" id="6276015">(</span><span class="ident" id="6276016"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276017">.</span><span class="ident" id="6276018">pending</span><span class="op" id="6276025">,</span>&nbsp;<span class="ident" id="6276027"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276028">.</span><span class="ident" id="6276029">resp</span><span class="op" id="6276033">.</span><span class="ident" id="6276034">Id</span><span class="op" id="6276036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276039"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276040">.</span><span class="ident" id="6276041">mutex</span><span class="op" id="6276046">.</span><span class="ident" id="6276047">Unlock</span><span class="op" id="6276053">(</span><span class="op" id="6276054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276058"><a href="/net/rpc/jsonrpc/client.go.html#6275847">r</a></span><span class="op" id="6276059">.</span><span class="ident" id="6276060">Error</span>&nbsp;<span class="op" id="6276066">=</span>&nbsp;<span class="string" id="6276068">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276072"><a href="/net/rpc/jsonrpc/client.go.html#6275847">r</a></span><span class="op" id="6276073">.</span><span class="ident" id="6276074">Seq</span>&nbsp;<span class="op" id="6276078">=</span>&nbsp;<span class="ident" id="6276080"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276081">.</span><span class="ident" id="6276082">resp</span><span class="op" id="6276086">.</span><span class="ident" id="6276087">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276091">if</span>&nbsp;<span class="ident" id="6276094"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276095">.</span><span class="ident" id="6276096">resp</span><span class="op" id="6276100">.</span><span class="ident" id="6276101">Error</span>&nbsp;<span class="op" id="6276107">!=</span>&nbsp;<span class="ident" id="6276110">nil</span>&nbsp;<span class="op" id="6276114">||</span>&nbsp;<span class="ident" id="6276117"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276118">.</span><span class="ident" id="6276119">resp</span><span class="op" id="6276123">.</span><span class="ident" id="6276124">Result</span>&nbsp;<span class="op" id="6276131">==</span>&nbsp;<span class="ident" id="6276134">nil</span>&nbsp;<span class="op" id="6276138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276142">x</span><span class="op" id="6276143">,</span>&nbsp;<span class="ident" id="6276145">ok</span>&nbsp;<span class="op" id="6276148">:=</span>&nbsp;<span class="ident" id="6276151"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276152">.</span><span class="ident" id="6276153">resp</span><span class="op" id="6276157">.</span><span class="ident" id="6276158">Error</span><span class="op" id="6276163">.</span><span class="op" id="6276164">(</span><span class="builtintype" id="6276165">string</span><span class="op" id="6276171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276175">if</span>&nbsp;<span class="op" id="6276178">!</span><span class="ident" id="6276179"><a href="/net/rpc/jsonrpc/client.go.html#6276145">ok</a></span>&nbsp;<span class="op" id="6276182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276187">return</span>&nbsp;<span class="ident" id="6276194"><a href="/net/rpc/jsonrpc/client.go.html#6274300">fmt</a></span><span class="op" id="6276197">.</span><span class="ident" id="6276198">Errorf</span><span class="op" id="6276204">(</span><span class="string" id="6276205">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="6276223">,</span>&nbsp;<span class="ident" id="6276225"><a href="/net/rpc/jsonrpc/client.go.html#6275812">c</a></span><span class="op" id="6276226">.</span><span class="ident" id="6276227">resp</span><span class="op" id="6276231">.</span><span class="ident" id="6276232">Error</span><span class="op" id="6276237">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276245">if</span>&nbsp;<span class="ident" id="6276248"><a href="/net/rpc/jsonrpc/client.go.html#6276142">x</a></span>&nbsp;<span class="op" id="6276250">==</span>&nbsp;<span class="string" id="6276253">&#34;&#34;</span>&nbsp;<span class="op" id="6276256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276261"><a href="/net/rpc/jsonrpc/client.go.html#6276142">x</a></span>&nbsp;<span class="op" id="6276263">=</span>&nbsp;<span class="string" id="6276265">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276291"><a href="/net/rpc/jsonrpc/client.go.html#6275847">r</a></span><span class="op" id="6276292">.</span><span class="ident" id="6276293">Error</span>&nbsp;<span class="op" id="6276299">=</span>&nbsp;<span class="ident" id="6276301"><a href="/net/rpc/jsonrpc/client.go.html#6276142">x</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276307">return</span>&nbsp;<span class="ident" id="6276314">nil</span><br>
<span class="lineno"></span><span class="op" id="6276318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6276321">func</span>&nbsp;<span class="op" id="6276326">(</span><span class="ident" id="6276327">c</span>&nbsp;<span class="op" id="6276329">*</span><span class="ident" id="6276330"><a href="/net/rpc/jsonrpc/client.go.html#6274346">clientCodec</a></span><span class="op" id="6276341">)</span>&nbsp;<span class="ident" id="6276343">ReadResponseBody</span><span class="op" id="6276359">(</span><span class="ident" id="6276360">x</span>&nbsp;<span class="keyword" id="6276362">interface</span><span class="op" id="6276371">{</span><span class="op" id="6276372">}</span><span class="op" id="6276373">)</span>&nbsp;<span class="builtintype" id="6276375">error</span>&nbsp;<span class="op" id="6276381">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276384">if</span>&nbsp;<span class="ident" id="6276387"><a href="/net/rpc/jsonrpc/client.go.html#6276360">x</a></span>&nbsp;<span class="op" id="6276389">==</span>&nbsp;<span class="ident" id="6276392">nil</span>&nbsp;<span class="op" id="6276396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276400">return</span>&nbsp;<span class="ident" id="6276407">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276415">return</span>&nbsp;<span class="ident" id="6276422"><a href="/net/rpc/jsonrpc/client.go.html#6274283">json</a></span><span class="op" id="6276426">.</span><span class="ident" id="6276427">Unmarshal</span><span class="op" id="6276436">(</span><span class="op" id="6276437">*</span><span class="ident" id="6276438"><a href="/net/rpc/jsonrpc/client.go.html#6276327">c</a></span><span class="op" id="6276439">.</span><span class="ident" id="6276440">resp</span><span class="op" id="6276444">.</span><span class="ident" id="6276445">Result</span><span class="op" id="6276451">,</span>&nbsp;<span class="ident" id="6276453"><a href="/net/rpc/jsonrpc/client.go.html#6276360">x</a></span><span class="op" id="6276454">)</span><br>
<span class="lineno"></span><span class="op" id="6276456">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6276459">func</span>&nbsp;<span class="op" id="6276464">(</span><span class="ident" id="6276465">c</span>&nbsp;<span class="op" id="6276467">*</span><span class="ident" id="6276468"><a href="/net/rpc/jsonrpc/client.go.html#6274346">clientCodec</a></span><span class="op" id="6276479">)</span>&nbsp;<span class="ident" id="6276481">Close</span><span class="op" id="6276486">(</span><span class="op" id="6276487">)</span>&nbsp;<span class="builtintype" id="6276489">error</span>&nbsp;<span class="op" id="6276495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276498">return</span>&nbsp;<span class="ident" id="6276505"><a href="/net/rpc/jsonrpc/client.go.html#6276465">c</a></span><span class="op" id="6276506">.</span><span class="ident" id="6276507">c</span><span class="op" id="6276508">.</span><span class="ident" id="6276509">Close</span><span class="op" id="6276514">(</span><span class="op" id="6276515">)</span><br>
<span class="lineno"></span><span class="op" id="6276517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6276520">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6276584">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6276639">func</span>&nbsp;<span class="ident" id="6276644">NewClient</span><span class="op" id="6276653">(</span><span class="ident" id="6276654">conn</span>&nbsp;<span class="ident" id="6276659"><a href="/net/rpc/jsonrpc/client.go.html#6274307">io</a></span><span class="op" id="6276661">.</span><span class="ident" id="6276662">ReadWriteCloser</span><span class="op" id="6276677">)</span>&nbsp;<span class="op" id="6276679">*</span><span class="ident" id="6276680"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6276683">.</span><span class="ident" id="6276684">Client</span>&nbsp;<span class="op" id="6276691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276694">return</span>&nbsp;<span class="ident" id="6276701"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6276704">.</span><span class="ident" id="6276705">NewClientWithCodec</span><span class="op" id="6276723">(</span><span class="ident" id="6276724"><a href="/net/rpc/jsonrpc/client.go.html#6274971">NewClientCodec</a></span><span class="op" id="6276738">(</span><span class="ident" id="6276739"><a href="/net/rpc/jsonrpc/client.go.html#6276654">conn</a></span><span class="op" id="6276743">)</span><span class="op" id="6276744">)</span><br>
<span class="lineno"></span><span class="op" id="6276746">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6276749">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6276821">func</span>&nbsp;<span class="ident" id="6276826">Dial</span><span class="op" id="6276830">(</span><span class="ident" id="6276831">network</span><span class="op" id="6276838">,</span>&nbsp;<span class="ident" id="6276840">address</span>&nbsp;<span class="builtintype" id="6276848">string</span><span class="op" id="6276854">)</span>&nbsp;<span class="op" id="6276856">(</span><span class="op" id="6276857">*</span><span class="ident" id="6276858"><a href="/net/rpc/jsonrpc/client.go.html#6274320">rpc</a></span><span class="op" id="6276861">.</span><span class="ident" id="6276862">Client</span><span class="op" id="6276868">,</span>&nbsp;<span class="builtintype" id="6276870">error</span><span class="op" id="6276875">)</span>&nbsp;<span class="op" id="6276877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276880">conn</span><span class="op" id="6276884">,</span>&nbsp;<span class="ident" id="6276886">err</span>&nbsp;<span class="op" id="6276890">:=</span>&nbsp;<span class="ident" id="6276893"><a href="/net/rpc/jsonrpc/client.go.html#6274313">net</a></span><span class="op" id="6276896">.</span><span class="ident" id="6276897">Dial</span><span class="op" id="6276901">(</span><span class="ident" id="6276902"><a href="/net/rpc/jsonrpc/client.go.html#6276831">network</a></span><span class="op" id="6276909">,</span>&nbsp;<span class="ident" id="6276911"><a href="/net/rpc/jsonrpc/client.go.html#6276840">address</a></span><span class="op" id="6276918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276921">if</span>&nbsp;<span class="ident" id="6276924"><a href="/net/rpc/jsonrpc/client.go.html#6276886">err</a></span>&nbsp;<span class="op" id="6276928">!=</span>&nbsp;<span class="ident" id="6276931">nil</span>&nbsp;<span class="op" id="6276935">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276939">return</span>&nbsp;<span class="ident" id="6276946">nil</span><span class="op" id="6276949">,</span>&nbsp;<span class="ident" id="6276951"><a href="/net/rpc/jsonrpc/client.go.html#6276886">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276959">return</span>&nbsp;<span class="ident" id="6276966"><a href="/net/rpc/jsonrpc/client.go.html#6276644">NewClient</a></span><span class="op" id="6276975">(</span><span class="ident" id="6276976"><a href="/net/rpc/jsonrpc/client.go.html#6276880">conn</a></span><span class="op" id="6276980">)</span><span class="op" id="6276981">,</span>&nbsp;<span class="ident" id="6276983"><a href="/net/rpc/jsonrpc/client.go.html#6276886">err</a></span><br>
<span class="lineno"></span><span class="op" id="6276987">}</span>
</div>
</body>
</html>
