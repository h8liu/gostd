<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3344802">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3344857">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3344911">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3344962">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3344992">//</span><br>
<span class="lineno"></span><span class="comment" id="3344995">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3345039">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3345092">package</span>&nbsp;<span class="ident" id="3345100">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345106">import</span>&nbsp;<span class="op" id="3345113">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345116">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345135">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345145">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345152">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345158">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345171">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345178">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345189">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345200">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345208">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3345215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3345218">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3345285">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="3345330">//</span><br>
<span class="lineno"></span><span class="comment" id="3345333">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3345400">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="3345467">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="3345538">//</span><br>
<span class="lineno"></span><span class="comment" id="3345541">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3345609">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3345670">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="3345684">type</span>&nbsp;<span class="ident" id="3345689">Client</span>&nbsp;<span class="keyword" id="3345696">struct</span>&nbsp;<span class="op" id="3345703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345706">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345764">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345792">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345830">Transport</span>&nbsp;<span class="ident" id="3345840">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345855">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345918">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3345978">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346040">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346103">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346166">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346216">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346278">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346307">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346311">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346376">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346428">CheckRedirect</span>&nbsp;<span class="keyword" id="3346442">func</span><span class="op" id="3346446">(</span><span class="ident" id="3346447">req</span>&nbsp;<span class="op" id="3346451">*</span><span class="ident" id="3346452">Request</span><span class="op" id="3346459">,</span>&nbsp;<span class="ident" id="3346461">via</span>&nbsp;<span class="op" id="3346465">[</span><span class="op" id="3346466">]</span><span class="op" id="3346467">*</span><span class="ident" id="3346468">Request</span><span class="op" id="3346475">)</span>&nbsp;<span class="builtintype" id="3346477">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346485">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346519">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346583">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346601">Jar</span>&nbsp;<span class="ident" id="3346605">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346617">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346678">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346732">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346796">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346853">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346897">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346901">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346941">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346945">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347003">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347067">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347127">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347184">Timeout</span>&nbsp;<span class="ident" id="3347192">time</span><span class="op" id="3347196">.</span><span class="ident" id="3347197">Duration</span><br>
<span class="lineno"></span><span class="op" id="3347206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347209">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="3347284">var</span>&nbsp;<span class="ident" id="3347288">DefaultClient</span>&nbsp;<span class="op" id="3347302">=</span>&nbsp;<span class="op" id="3347304">&amp;</span><span class="ident" id="3347305">Client</span><span class="op" id="3347311">{</span><span class="op" id="3347312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347315">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3347385">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="3347457">//</span><br>
<span class="lineno">80</span><span class="comment" id="3347460">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="3347522">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3347537">type</span>&nbsp;<span class="ident" id="3347542">RoundTripper</span>&nbsp;<span class="keyword" id="3347555">interface</span>&nbsp;<span class="op" id="3347565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347568">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347628">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347688">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347743">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347807">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347869">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347930">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347984">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348037">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348069">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348073">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348129">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348190">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348247">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348264">RoundTrip</span><span class="op" id="3348273">(</span><span class="op" id="3348274">*</span><span class="ident" id="3348275">Request</span><span class="op" id="3348282">)</span>&nbsp;<span class="op" id="3348284">(</span><span class="op" id="3348285">*</span><span class="ident" id="3348286">Response</span><span class="op" id="3348294">,</span>&nbsp;<span class="builtintype" id="3348296">error</span><span class="op" id="3348301">)</span><br>
<span class="lineno"></span><span class="op" id="3348303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3348306">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3348384">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3348430">func</span>&nbsp;<span class="ident" id="3348435">hasPort</span><span class="op" id="3348442">(</span><span class="ident" id="3348443">s</span>&nbsp;<span class="builtintype" id="3348445">string</span><span class="op" id="3348451">)</span>&nbsp;<span class="builtintype" id="3348453">bool</span>&nbsp;<span class="op" id="3348458">{</span>&nbsp;<span class="keyword" id="3348460">return</span>&nbsp;<span class="ident" id="3348467">strings</span><span class="op" id="3348474">.</span><span class="ident" id="3348475">LastIndex</span><span class="op" id="3348484">(</span><span class="ident" id="3348485">s</span><span class="op" id="3348486">,</span>&nbsp;<span class="string" id="3348488">&#34;:&#34;</span><span class="op" id="3348491">)</span>&nbsp;<span class="op" id="3348493">&gt;</span>&nbsp;<span class="ident" id="3348495">strings</span><span class="op" id="3348502">.</span><span class="ident" id="3348503">LastIndex</span><span class="op" id="3348512">(</span><span class="ident" id="3348513">s</span><span class="op" id="3348514">,</span>&nbsp;<span class="string" id="3348516">&#34;]&#34;</span><span class="op" id="3348519">)</span>&nbsp;<span class="op" id="3348521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348524">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="3348594">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="3348667">func</span>&nbsp;<span class="ident" id="3348672">refererForURL</span><span class="op" id="3348685">(</span><span class="ident" id="3348686">lastReq</span><span class="op" id="3348693">,</span>&nbsp;<span class="ident" id="3348695">newReq</span>&nbsp;<span class="op" id="3348702">*</span><span class="ident" id="3348703">url</span><span class="op" id="3348706">.</span><span class="ident" id="3348707">URL</span><span class="op" id="3348710">)</span>&nbsp;<span class="builtintype" id="3348712">string</span>&nbsp;<span class="op" id="3348719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348722">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348776">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348838">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348897">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348941">if</span>&nbsp;<span class="ident" id="3348944">lastReq</span><span class="op" id="3348951">.</span><span class="ident" id="3348952">Scheme</span>&nbsp;<span class="op" id="3348959">==</span>&nbsp;<span class="string" id="3348962">&#34;https&#34;</span>&nbsp;<span class="op" id="3348970">&amp;&amp;</span>&nbsp;<span class="ident" id="3348973">newReq</span><span class="op" id="3348979">.</span><span class="ident" id="3348980">Scheme</span>&nbsp;<span class="op" id="3348987">==</span>&nbsp;<span class="string" id="3348990">&#34;http&#34;</span>&nbsp;<span class="op" id="3348997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349001">return</span>&nbsp;<span class="string" id="3349008">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349015">referer</span>&nbsp;<span class="op" id="3349023">:=</span>&nbsp;<span class="ident" id="3349026">lastReq</span><span class="op" id="3349033">.</span><span class="ident" id="3349034">String</span><span class="op" id="3349040">(</span><span class="op" id="3349041">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349044">if</span>&nbsp;<span class="ident" id="3349047">lastReq</span><span class="op" id="3349054">.</span><span class="ident" id="3349055">User</span>&nbsp;<span class="op" id="3349060">!=</span>&nbsp;<span class="ident" id="3349063">nil</span>&nbsp;<span class="op" id="3349067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349071">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349127">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349144">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349183">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349216">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349274">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349316">auth</span>&nbsp;<span class="op" id="3349321">:=</span>&nbsp;<span class="ident" id="3349324">lastReq</span><span class="op" id="3349331">.</span><span class="ident" id="3349332">User</span><span class="op" id="3349336">.</span><span class="ident" id="3349337">String</span><span class="op" id="3349343">(</span><span class="op" id="3349344">)</span>&nbsp;<span class="op" id="3349346">+</span>&nbsp;<span class="string" id="3349348">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349354">referer</span>&nbsp;<span class="op" id="3349362">=</span>&nbsp;<span class="ident" id="3349364">strings</span><span class="op" id="3349371">.</span><span class="ident" id="3349372">Replace</span><span class="op" id="3349379">(</span><span class="ident" id="3349380">referer</span><span class="op" id="3349387">,</span>&nbsp;<span class="ident" id="3349389">auth</span><span class="op" id="3349393">,</span>&nbsp;<span class="string" id="3349395">&#34;&#34;</span><span class="op" id="3349397">,</span>&nbsp;<span class="num" id="3349399">1</span><span class="op" id="3349400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349403">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349406">return</span>&nbsp;<span class="ident" id="3349413">referer</span><br>
<span class="lineno"></span><span class="op" id="3349421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349424">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3349492">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="3349563">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3349586">type</span>&nbsp;<span class="ident" id="3349591">readClose</span>&nbsp;<span class="keyword" id="3349601">struct</span>&nbsp;<span class="op" id="3349608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349611">io</span><span class="op" id="3349613">.</span><span class="ident" id="3349614">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349622">io</span><span class="op" id="3349624">.</span><span class="ident" id="3349625">Closer</span><br>
<span class="lineno"></span><span class="op" id="3349632">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="3349635">func</span>&nbsp;<span class="op" id="3349640">(</span><span class="ident" id="3349641">c</span>&nbsp;<span class="op" id="3349643">*</span><span class="ident" id="3349644">Client</span><span class="op" id="3349650">)</span>&nbsp;<span class="ident" id="3349652">send</span><span class="op" id="3349656">(</span><span class="ident" id="3349657">req</span>&nbsp;<span class="op" id="3349661">*</span><span class="ident" id="3349662">Request</span><span class="op" id="3349669">)</span>&nbsp;<span class="op" id="3349671">(</span><span class="op" id="3349672">*</span><span class="ident" id="3349673">Response</span><span class="op" id="3349681">,</span>&nbsp;<span class="builtintype" id="3349683">error</span><span class="op" id="3349688">)</span>&nbsp;<span class="op" id="3349690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349693">if</span>&nbsp;<span class="ident" id="3349696">c</span><span class="op" id="3349697">.</span><span class="ident" id="3349698">Jar</span>&nbsp;<span class="op" id="3349702">!=</span>&nbsp;<span class="ident" id="3349705">nil</span>&nbsp;<span class="op" id="3349709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349713">for</span>&nbsp;<span class="ident" id="3349717">_</span><span class="op" id="3349718">,</span>&nbsp;<span class="ident" id="3349720">cookie</span>&nbsp;<span class="op" id="3349727">:=</span>&nbsp;<span class="keyword" id="3349730">range</span>&nbsp;<span class="ident" id="3349736">c</span><span class="op" id="3349737">.</span><span class="ident" id="3349738">Jar</span><span class="op" id="3349741">.</span><span class="ident" id="3349742">Cookies</span><span class="op" id="3349749">(</span><span class="ident" id="3349750">req</span><span class="op" id="3349753">.</span><span class="ident" id="3349754">URL</span><span class="op" id="3349757">)</span>&nbsp;<span class="op" id="3349759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349764">req</span><span class="op" id="3349767">.</span><span class="ident" id="3349768">AddCookie</span><span class="op" id="3349777">(</span><span class="ident" id="3349778">cookie</span><span class="op" id="3349784">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349794">resp</span><span class="op" id="3349798">,</span>&nbsp;<span class="ident" id="3349800">err</span>&nbsp;<span class="op" id="3349804">:=</span>&nbsp;<span class="ident" id="3349807">send</span><span class="op" id="3349811">(</span><span class="ident" id="3349812">req</span><span class="op" id="3349815">,</span>&nbsp;<span class="ident" id="3349817">c</span><span class="op" id="3349818">.</span><span class="ident" id="3349819">transport</span><span class="op" id="3349828">(</span><span class="op" id="3349829">)</span><span class="op" id="3349830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349833">if</span>&nbsp;<span class="ident" id="3349836">err</span>&nbsp;<span class="op" id="3349840">!=</span>&nbsp;<span class="ident" id="3349843">nil</span>&nbsp;<span class="op" id="3349847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349851">return</span>&nbsp;<span class="ident" id="3349858">nil</span><span class="op" id="3349861">,</span>&nbsp;<span class="ident" id="3349863">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349871">if</span>&nbsp;<span class="ident" id="3349874">c</span><span class="op" id="3349875">.</span><span class="ident" id="3349876">Jar</span>&nbsp;<span class="op" id="3349880">!=</span>&nbsp;<span class="ident" id="3349883">nil</span>&nbsp;<span class="op" id="3349887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349891">if</span>&nbsp;<span class="ident" id="3349894">rc</span>&nbsp;<span class="op" id="3349897">:=</span>&nbsp;<span class="ident" id="3349900">resp</span><span class="op" id="3349904">.</span><span class="ident" id="3349905">Cookies</span><span class="op" id="3349912">(</span><span class="op" id="3349913">)</span><span class="op" id="3349914">;</span>&nbsp;<span class="builtinfunc" id="3349916">len</span><span class="op" id="3349919">(</span><span class="ident" id="3349920">rc</span><span class="op" id="3349922">)</span>&nbsp;<span class="op" id="3349924">&gt;</span>&nbsp;<span class="num" id="3349926">0</span>&nbsp;<span class="op" id="3349928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349933">c</span><span class="op" id="3349934">.</span><span class="ident" id="3349935">Jar</span><span class="op" id="3349938">.</span><span class="ident" id="3349939">SetCookies</span><span class="op" id="3349949">(</span><span class="ident" id="3349950">req</span><span class="op" id="3349953">.</span><span class="ident" id="3349954">URL</span><span class="op" id="3349957">,</span>&nbsp;<span class="ident" id="3349959">rc</span><span class="op" id="3349961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349965">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349971">return</span>&nbsp;<span class="ident" id="3349978">resp</span><span class="op" id="3349982">,</span>&nbsp;<span class="ident" id="3349984">err</span><br>
<span class="lineno"></span><span class="op" id="3349988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349991">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="3350059">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3350130">//</span><br>
<span class="lineno"></span><span class="comment" id="3350133">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3350193">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3350252">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="3350298">//</span><br>
<span class="lineno"></span><span class="comment" id="3350301">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3350363">//</span><br>
<span class="lineno"></span><span class="comment" id="3350366">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3350430">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="3350495">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3350563">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3350630">//</span><br>
<span class="lineno"></span><span class="comment" id="3350633">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3350699">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="3350729">//</span><br>
<span class="lineno"></span><span class="comment" id="3350732">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="3350796">func</span>&nbsp;<span class="op" id="3350801">(</span><span class="ident" id="3350802">c</span>&nbsp;<span class="op" id="3350804">*</span><span class="ident" id="3350805">Client</span><span class="op" id="3350811">)</span>&nbsp;<span class="ident" id="3350813">Do</span><span class="op" id="3350815">(</span><span class="ident" id="3350816">req</span>&nbsp;<span class="op" id="3350820">*</span><span class="ident" id="3350821">Request</span><span class="op" id="3350828">)</span>&nbsp;<span class="op" id="3350830">(</span><span class="ident" id="3350831">resp</span>&nbsp;<span class="op" id="3350836">*</span><span class="ident" id="3350837">Response</span><span class="op" id="3350845">,</span>&nbsp;<span class="ident" id="3350847">err</span>&nbsp;<span class="builtintype" id="3350851">error</span><span class="op" id="3350856">)</span>&nbsp;<span class="op" id="3350858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350861">if</span>&nbsp;<span class="ident" id="3350864">req</span><span class="op" id="3350867">.</span><span class="ident" id="3350868">Method</span>&nbsp;<span class="op" id="3350875">==</span>&nbsp;<span class="string" id="3350878">&#34;GET&#34;</span>&nbsp;<span class="op" id="3350884">||</span>&nbsp;<span class="ident" id="3350887">req</span><span class="op" id="3350890">.</span><span class="ident" id="3350891">Method</span>&nbsp;<span class="op" id="3350898">==</span>&nbsp;<span class="string" id="3350901">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3350908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350912">return</span>&nbsp;<span class="ident" id="3350919">c</span><span class="op" id="3350920">.</span><span class="ident" id="3350921">doFollowingRedirects</span><span class="op" id="3350941">(</span><span class="ident" id="3350942">req</span><span class="op" id="3350945">,</span>&nbsp;<span class="ident" id="3350947">shouldRedirectGet</span><span class="op" id="3350964">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350970">if</span>&nbsp;<span class="ident" id="3350973">req</span><span class="op" id="3350976">.</span><span class="ident" id="3350977">Method</span>&nbsp;<span class="op" id="3350984">==</span>&nbsp;<span class="string" id="3350987">&#34;POST&#34;</span>&nbsp;<span class="op" id="3350994">||</span>&nbsp;<span class="ident" id="3350997">req</span><span class="op" id="3351000">.</span><span class="ident" id="3351001">Method</span>&nbsp;<span class="op" id="3351008">==</span>&nbsp;<span class="string" id="3351011">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3351017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351021">return</span>&nbsp;<span class="ident" id="3351028">c</span><span class="op" id="3351029">.</span><span class="ident" id="3351030">doFollowingRedirects</span><span class="op" id="3351050">(</span><span class="ident" id="3351051">req</span><span class="op" id="3351054">,</span>&nbsp;<span class="ident" id="3351056">shouldRedirectPost</span><span class="op" id="3351074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351080">return</span>&nbsp;<span class="ident" id="3351087">c</span><span class="op" id="3351088">.</span><span class="ident" id="3351089">send</span><span class="op" id="3351093">(</span><span class="ident" id="3351094">req</span><span class="op" id="3351097">)</span><br>
<span class="lineno">180</span><span class="op" id="3351099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3351102">func</span>&nbsp;<span class="op" id="3351107">(</span><span class="ident" id="3351108">c</span>&nbsp;<span class="op" id="3351110">*</span><span class="ident" id="3351111">Client</span><span class="op" id="3351117">)</span>&nbsp;<span class="ident" id="3351119">transport</span><span class="op" id="3351128">(</span><span class="op" id="3351129">)</span>&nbsp;<span class="ident" id="3351131">RoundTripper</span>&nbsp;<span class="op" id="3351144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351147">if</span>&nbsp;<span class="ident" id="3351150">c</span><span class="op" id="3351151">.</span><span class="ident" id="3351152">Transport</span>&nbsp;<span class="op" id="3351162">!=</span>&nbsp;<span class="ident" id="3351165">nil</span>&nbsp;<span class="op" id="3351169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351173">return</span>&nbsp;<span class="ident" id="3351180">c</span><span class="op" id="3351181">.</span><span class="ident" id="3351182">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351196">return</span>&nbsp;<span class="ident" id="3351203">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="3351220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351223">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="3351255">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3351315">func</span>&nbsp;<span class="ident" id="3351320">send</span><span class="op" id="3351324">(</span><span class="ident" id="3351325">req</span>&nbsp;<span class="op" id="3351329">*</span><span class="ident" id="3351330">Request</span><span class="op" id="3351337">,</span>&nbsp;<span class="ident" id="3351339">t</span>&nbsp;<span class="ident" id="3351341">RoundTripper</span><span class="op" id="3351353">)</span>&nbsp;<span class="op" id="3351355">(</span><span class="ident" id="3351356">resp</span>&nbsp;<span class="op" id="3351361">*</span><span class="ident" id="3351362">Response</span><span class="op" id="3351370">,</span>&nbsp;<span class="ident" id="3351372">err</span>&nbsp;<span class="builtintype" id="3351376">error</span><span class="op" id="3351381">)</span>&nbsp;<span class="op" id="3351383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351386">if</span>&nbsp;<span class="ident" id="3351389">t</span>&nbsp;<span class="op" id="3351391">==</span>&nbsp;<span class="ident" id="3351394">nil</span>&nbsp;<span class="op" id="3351398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351402">req</span><span class="op" id="3351405">.</span><span class="ident" id="3351406">closeBody</span><span class="op" id="3351415">(</span><span class="op" id="3351416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351420">return</span>&nbsp;<span class="ident" id="3351427">nil</span><span class="op" id="3351430">,</span>&nbsp;<span class="ident" id="3351432">errors</span><span class="op" id="3351438">.</span><span class="ident" id="3351439">New</span><span class="op" id="3351442">(</span><span class="string" id="3351443">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="3351490">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351497">if</span>&nbsp;<span class="ident" id="3351500">req</span><span class="op" id="3351503">.</span><span class="ident" id="3351504">URL</span>&nbsp;<span class="op" id="3351508">==</span>&nbsp;<span class="ident" id="3351511">nil</span>&nbsp;<span class="op" id="3351515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351519">req</span><span class="op" id="3351522">.</span><span class="ident" id="3351523">closeBody</span><span class="op" id="3351532">(</span><span class="op" id="3351533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351537">return</span>&nbsp;<span class="ident" id="3351544">nil</span><span class="op" id="3351547">,</span>&nbsp;<span class="ident" id="3351549">errors</span><span class="op" id="3351555">.</span><span class="ident" id="3351556">New</span><span class="op" id="3351559">(</span><span class="string" id="3351560">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3351583">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351590">if</span>&nbsp;<span class="ident" id="3351593">req</span><span class="op" id="3351596">.</span><span class="ident" id="3351597">RequestURI</span>&nbsp;<span class="op" id="3351608">!=</span>&nbsp;<span class="string" id="3351611">&#34;&#34;</span>&nbsp;<span class="op" id="3351614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351618">req</span><span class="op" id="3351621">.</span><span class="ident" id="3351622">closeBody</span><span class="op" id="3351631">(</span><span class="op" id="3351632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351636">return</span>&nbsp;<span class="ident" id="3351643">nil</span><span class="op" id="3351646">,</span>&nbsp;<span class="ident" id="3351648">errors</span><span class="op" id="3351654">.</span><span class="ident" id="3351655">New</span><span class="op" id="3351658">(</span><span class="string" id="3351659">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="3351718">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351725">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351784">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3351844">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351898">if</span>&nbsp;<span class="ident" id="3351901">req</span><span class="op" id="3351904">.</span><span class="ident" id="3351905">Header</span>&nbsp;<span class="op" id="3351912">==</span>&nbsp;<span class="ident" id="3351915">nil</span>&nbsp;<span class="op" id="3351919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351923">req</span><span class="op" id="3351926">.</span><span class="ident" id="3351927">Header</span>&nbsp;<span class="op" id="3351934">=</span>&nbsp;<span class="builtinfunc" id="3351936">make</span><span class="op" id="3351940">(</span><span class="ident" id="3351941">Header</span><span class="op" id="3351947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351954">if</span>&nbsp;<span class="ident" id="3351957">u</span>&nbsp;<span class="op" id="3351959">:=</span>&nbsp;<span class="ident" id="3351962">req</span><span class="op" id="3351965">.</span><span class="ident" id="3351966">URL</span><span class="op" id="3351969">.</span><span class="ident" id="3351970">User</span><span class="op" id="3351974">;</span>&nbsp;<span class="ident" id="3351976">u</span>&nbsp;<span class="op" id="3351978">!=</span>&nbsp;<span class="ident" id="3351981">nil</span>&nbsp;<span class="op" id="3351985">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351989">username</span>&nbsp;<span class="op" id="3351998">:=</span>&nbsp;<span class="ident" id="3352001">u</span><span class="op" id="3352002">.</span><span class="ident" id="3352003">Username</span><span class="op" id="3352011">(</span><span class="op" id="3352012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352016">password</span><span class="op" id="3352024">,</span>&nbsp;<span class="ident" id="3352026">_</span>&nbsp;<span class="op" id="3352028">:=</span>&nbsp;<span class="ident" id="3352031">u</span><span class="op" id="3352032">.</span><span class="ident" id="3352033">Password</span><span class="op" id="3352041">(</span><span class="op" id="3352042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352046">req</span><span class="op" id="3352049">.</span><span class="ident" id="3352050">Header</span><span class="op" id="3352056">.</span><span class="ident" id="3352057">Set</span><span class="op" id="3352060">(</span><span class="string" id="3352061">&#34;Authorization&#34;</span><span class="op" id="3352076">,</span>&nbsp;<span class="string" id="3352078">&#34;Basic&nbsp;&#34;</span><span class="op" id="3352086">+</span><span class="ident" id="3352087">basicAuth</span><span class="op" id="3352096">(</span><span class="ident" id="3352097">username</span><span class="op" id="3352105">,</span>&nbsp;<span class="ident" id="3352107">password</span><span class="op" id="3352115">)</span><span class="op" id="3352116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352122">resp</span><span class="op" id="3352126">,</span>&nbsp;<span class="ident" id="3352128">err</span>&nbsp;<span class="op" id="3352132">=</span>&nbsp;<span class="ident" id="3352134">t</span><span class="op" id="3352135">.</span><span class="ident" id="3352136">RoundTrip</span><span class="op" id="3352145">(</span><span class="ident" id="3352146">req</span><span class="op" id="3352149">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352152">if</span>&nbsp;<span class="ident" id="3352155">err</span>&nbsp;<span class="op" id="3352159">!=</span>&nbsp;<span class="ident" id="3352162">nil</span>&nbsp;<span class="op" id="3352166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352170">if</span>&nbsp;<span class="ident" id="3352173">resp</span>&nbsp;<span class="op" id="3352178">!=</span>&nbsp;<span class="ident" id="3352181">nil</span>&nbsp;<span class="op" id="3352185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352190">log</span><span class="op" id="3352193">.</span><span class="ident" id="3352194">Printf</span><span class="op" id="3352200">(</span><span class="string" id="3352201">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="3352262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352270">return</span>&nbsp;<span class="ident" id="3352277">nil</span><span class="op" id="3352280">,</span>&nbsp;<span class="ident" id="3352282">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352290">return</span>&nbsp;<span class="ident" id="3352297">resp</span><span class="op" id="3352301">,</span>&nbsp;<span class="ident" id="3352303">nil</span><br>
<span class="lineno"></span><span class="op" id="3352307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3352310">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="3352371">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="3352443">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="3352507">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3352546">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="3352583">func</span>&nbsp;<span class="ident" id="3352588">basicAuth</span><span class="op" id="3352597">(</span><span class="ident" id="3352598">username</span><span class="op" id="3352606">,</span>&nbsp;<span class="ident" id="3352608">password</span>&nbsp;<span class="builtintype" id="3352617">string</span><span class="op" id="3352623">)</span>&nbsp;<span class="builtintype" id="3352625">string</span>&nbsp;<span class="op" id="3352632">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352635">auth</span>&nbsp;<span class="op" id="3352640">:=</span>&nbsp;<span class="ident" id="3352643">username</span>&nbsp;<span class="op" id="3352652">+</span>&nbsp;<span class="string" id="3352654">&#34;:&#34;</span>&nbsp;<span class="op" id="3352658">+</span>&nbsp;<span class="ident" id="3352660">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352670">return</span>&nbsp;<span class="ident" id="3352677">base64</span><span class="op" id="3352683">.</span><span class="ident" id="3352684">StdEncoding</span><span class="op" id="3352695">.</span><span class="ident" id="3352696">EncodeToString</span><span class="op" id="3352710">(</span><span class="op" id="3352711">[</span><span class="op" id="3352712">]</span><span class="builtintype" id="3352713">byte</span><span class="op" id="3352717">(</span><span class="ident" id="3352718">auth</span><span class="op" id="3352722">)</span><span class="op" id="3352723">)</span><br>
<span class="lineno"></span><span class="op" id="3352725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3352728">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="3352810">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3352837">func</span>&nbsp;<span class="ident" id="3352842">shouldRedirectGet</span><span class="op" id="3352859">(</span><span class="ident" id="3352860">statusCode</span>&nbsp;<span class="builtintype" id="3352871">int</span><span class="op" id="3352874">)</span>&nbsp;<span class="builtintype" id="3352876">bool</span>&nbsp;<span class="op" id="3352881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352884">switch</span>&nbsp;<span class="ident" id="3352891">statusCode</span>&nbsp;<span class="op" id="3352902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352905">case</span>&nbsp;<span class="ident" id="3352910">StatusMovedPermanently</span><span class="op" id="3352932">,</span>&nbsp;<span class="ident" id="3352934">StatusFound</span><span class="op" id="3352945">,</span>&nbsp;<span class="ident" id="3352947">StatusSeeOther</span><span class="op" id="3352961">,</span>&nbsp;<span class="ident" id="3352963">StatusTemporaryRedirect</span><span class="op" id="3352986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352990">return</span>&nbsp;<span class="builtintype" id="3352997">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3353003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353006">return</span>&nbsp;<span class="builtintype" id="3353013">false</span><br>
<span class="lineno"></span><span class="op" id="3353019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353022">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="3353105">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3353132">func</span>&nbsp;<span class="ident" id="3353137">shouldRedirectPost</span><span class="op" id="3353155">(</span><span class="ident" id="3353156">statusCode</span>&nbsp;<span class="builtintype" id="3353167">int</span><span class="op" id="3353170">)</span>&nbsp;<span class="builtintype" id="3353172">bool</span>&nbsp;<span class="op" id="3353177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353180">switch</span>&nbsp;<span class="ident" id="3353187">statusCode</span>&nbsp;<span class="op" id="3353198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353201">case</span>&nbsp;<span class="ident" id="3353206">StatusFound</span><span class="op" id="3353217">,</span>&nbsp;<span class="ident" id="3353219">StatusSeeOther</span><span class="op" id="3353233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353237">return</span>&nbsp;<span class="builtintype" id="3353244">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3353250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353253">return</span>&nbsp;<span class="builtintype" id="3353260">false</span><br>
<span class="lineno"></span><span class="op" id="3353266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353269">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3353352">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="3353430">//</span><br>
<span class="lineno"></span><span class="comment" id="3353433">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3353463">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3353481">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="3353503">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3353534">//</span><br>
<span class="lineno"></span><span class="comment" id="3353537">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3353606">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3353673">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="3353683">//</span><br>
<span class="lineno"></span><span class="comment" id="3353686">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3353748">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3353808">//</span><br>
<span class="lineno"></span><span class="comment" id="3353811">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="3353857">func</span>&nbsp;<span class="ident" id="3353862">Get</span><span class="op" id="3353865">(</span><span class="ident" id="3353866">url</span>&nbsp;<span class="builtintype" id="3353870">string</span><span class="op" id="3353876">)</span>&nbsp;<span class="op" id="3353878">(</span><span class="ident" id="3353879">resp</span>&nbsp;<span class="op" id="3353884">*</span><span class="ident" id="3353885">Response</span><span class="op" id="3353893">,</span>&nbsp;<span class="ident" id="3353895">err</span>&nbsp;<span class="builtintype" id="3353899">error</span><span class="op" id="3353904">)</span>&nbsp;<span class="op" id="3353906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353909">return</span>&nbsp;<span class="ident" id="3353916">DefaultClient</span><span class="op" id="3353929">.</span><span class="ident" id="3353930">Get</span><span class="op" id="3353933">(</span><span class="ident" id="3353934">url</span><span class="op" id="3353937">)</span><br>
<span class="lineno"></span><span class="op" id="3353939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353942">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="3354015">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3354087">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3354123">//</span><br>
<span class="lineno"></span><span class="comment" id="3354126">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3354156">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="3354174">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3354196">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3354227">//</span><br>
<span class="lineno"></span><span class="comment" id="3354230">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3354299">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="3354369">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3354388">//</span><br>
<span class="lineno"></span><span class="comment" id="3354391">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3354453">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3354513">func</span>&nbsp;<span class="op" id="3354518">(</span><span class="ident" id="3354519">c</span>&nbsp;<span class="op" id="3354521">*</span><span class="ident" id="3354522">Client</span><span class="op" id="3354528">)</span>&nbsp;<span class="ident" id="3354530">Get</span><span class="op" id="3354533">(</span><span class="ident" id="3354534">url</span>&nbsp;<span class="builtintype" id="3354538">string</span><span class="op" id="3354544">)</span>&nbsp;<span class="op" id="3354546">(</span><span class="ident" id="3354547">resp</span>&nbsp;<span class="op" id="3354552">*</span><span class="ident" id="3354553">Response</span><span class="op" id="3354561">,</span>&nbsp;<span class="ident" id="3354563">err</span>&nbsp;<span class="builtintype" id="3354567">error</span><span class="op" id="3354572">)</span>&nbsp;<span class="op" id="3354574">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354577">req</span><span class="op" id="3354580">,</span>&nbsp;<span class="ident" id="3354582">err</span>&nbsp;<span class="op" id="3354586">:=</span>&nbsp;<span class="ident" id="3354589">NewRequest</span><span class="op" id="3354599">(</span><span class="string" id="3354600">&#34;GET&#34;</span><span class="op" id="3354605">,</span>&nbsp;<span class="ident" id="3354607">url</span><span class="op" id="3354610">,</span>&nbsp;<span class="ident" id="3354612">nil</span><span class="op" id="3354615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354618">if</span>&nbsp;<span class="ident" id="3354621">err</span>&nbsp;<span class="op" id="3354625">!=</span>&nbsp;<span class="ident" id="3354628">nil</span>&nbsp;<span class="op" id="3354632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354636">return</span>&nbsp;<span class="ident" id="3354643">nil</span><span class="op" id="3354646">,</span>&nbsp;<span class="ident" id="3354648">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354656">return</span>&nbsp;<span class="ident" id="3354663">c</span><span class="op" id="3354664">.</span><span class="ident" id="3354665">doFollowingRedirects</span><span class="op" id="3354685">(</span><span class="ident" id="3354686">req</span><span class="op" id="3354689">,</span>&nbsp;<span class="ident" id="3354691">shouldRedirectGet</span><span class="op" id="3354708">)</span><br>
<span class="lineno">300</span><span class="op" id="3354710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3354713">func</span>&nbsp;<span class="op" id="3354718">(</span><span class="ident" id="3354719">c</span>&nbsp;<span class="op" id="3354721">*</span><span class="ident" id="3354722">Client</span><span class="op" id="3354728">)</span>&nbsp;<span class="ident" id="3354730">doFollowingRedirects</span><span class="op" id="3354750">(</span><span class="ident" id="3354751">ireq</span>&nbsp;<span class="op" id="3354756">*</span><span class="ident" id="3354757">Request</span><span class="op" id="3354764">,</span>&nbsp;<span class="ident" id="3354766">shouldRedirect</span>&nbsp;<span class="keyword" id="3354781">func</span><span class="op" id="3354785">(</span><span class="builtintype" id="3354786">int</span><span class="op" id="3354789">)</span>&nbsp;<span class="builtintype" id="3354791">bool</span><span class="op" id="3354795">)</span>&nbsp;<span class="op" id="3354797">(</span><span class="ident" id="3354798">resp</span>&nbsp;<span class="op" id="3354803">*</span><span class="ident" id="3354804">Response</span><span class="op" id="3354812">,</span>&nbsp;<span class="ident" id="3354814">err</span>&nbsp;<span class="builtintype" id="3354818">error</span><span class="op" id="3354823">)</span>&nbsp;<span class="op" id="3354825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354828">var</span>&nbsp;<span class="ident" id="3354832">base</span>&nbsp;<span class="op" id="3354837">*</span><span class="ident" id="3354838">url</span><span class="op" id="3354841">.</span><span class="ident" id="3354842">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354847">redirectChecker</span>&nbsp;<span class="op" id="3354863">:=</span>&nbsp;<span class="ident" id="3354866">c</span><span class="op" id="3354867">.</span><span class="ident" id="3354868">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354883">if</span>&nbsp;<span class="ident" id="3354886">redirectChecker</span>&nbsp;<span class="op" id="3354902">==</span>&nbsp;<span class="ident" id="3354905">nil</span>&nbsp;<span class="op" id="3354909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354913">redirectChecker</span>&nbsp;<span class="op" id="3354929">=</span>&nbsp;<span class="ident" id="3354931">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354956">var</span>&nbsp;<span class="ident" id="3354960">via</span>&nbsp;<span class="op" id="3354964">[</span><span class="op" id="3354965">]</span><span class="op" id="3354966">*</span><span class="ident" id="3354967">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354977">if</span>&nbsp;<span class="ident" id="3354980">ireq</span><span class="op" id="3354984">.</span><span class="ident" id="3354985">URL</span>&nbsp;<span class="op" id="3354989">==</span>&nbsp;<span class="ident" id="3354992">nil</span>&nbsp;<span class="op" id="3354996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355000">ireq</span><span class="op" id="3355004">.</span><span class="ident" id="3355005">closeBody</span><span class="op" id="3355014">(</span><span class="op" id="3355015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355019">return</span>&nbsp;<span class="ident" id="3355026">nil</span><span class="op" id="3355029">,</span>&nbsp;<span class="ident" id="3355031">errors</span><span class="op" id="3355037">.</span><span class="ident" id="3355038">New</span><span class="op" id="3355041">(</span><span class="string" id="3355042">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3355065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355072">var</span>&nbsp;<span class="ident" id="3355076">reqmu</span>&nbsp;<span class="ident" id="3355082">sync</span><span class="op" id="3355086">.</span><span class="ident" id="3355087">Mutex</span>&nbsp;<span class="comment" id="3355093">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355108">req</span>&nbsp;<span class="op" id="3355112">:=</span>&nbsp;<span class="ident" id="3355115">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355122">var</span>&nbsp;<span class="ident" id="3355126">timer</span>&nbsp;<span class="op" id="3355132">*</span><span class="ident" id="3355133">time</span><span class="op" id="3355137">.</span><span class="ident" id="3355138">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355145">if</span>&nbsp;<span class="ident" id="3355148">c</span><span class="op" id="3355149">.</span><span class="ident" id="3355150">Timeout</span>&nbsp;<span class="op" id="3355158">&gt;</span>&nbsp;<span class="num" id="3355160">0</span>&nbsp;<span class="op" id="3355162">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355166">type</span>&nbsp;<span class="ident" id="3355171">canceler</span>&nbsp;<span class="keyword" id="3355180">interface</span>&nbsp;<span class="op" id="3355190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355195">CancelRequest</span><span class="op" id="3355208">(</span><span class="op" id="3355209">*</span><span class="ident" id="3355210">Request</span><span class="op" id="3355217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355225">tr</span><span class="op" id="3355227">,</span>&nbsp;<span class="ident" id="3355229">ok</span>&nbsp;<span class="op" id="3355232">:=</span>&nbsp;<span class="ident" id="3355235">c</span><span class="op" id="3355236">.</span><span class="ident" id="3355237">transport</span><span class="op" id="3355246">(</span><span class="op" id="3355247">)</span><span class="op" id="3355248">.</span><span class="op" id="3355249">(</span><span class="ident" id="3355250">canceler</span><span class="op" id="3355258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355262">if</span>&nbsp;<span class="op" id="3355265">!</span><span class="ident" id="3355266">ok</span>&nbsp;<span class="op" id="3355269">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355274">return</span>&nbsp;<span class="ident" id="3355281">nil</span><span class="op" id="3355284">,</span>&nbsp;<span class="ident" id="3355286">fmt</span><span class="op" id="3355289">.</span><span class="ident" id="3355290">Errorf</span><span class="op" id="3355296">(</span><span class="string" id="3355297">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3355389">,</span>&nbsp;<span class="ident" id="3355391">c</span><span class="op" id="3355392">.</span><span class="ident" id="3355393">transport</span><span class="op" id="3355402">(</span><span class="op" id="3355403">)</span><span class="op" id="3355404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355412">timer</span>&nbsp;<span class="op" id="3355418">=</span>&nbsp;<span class="ident" id="3355420">time</span><span class="op" id="3355424">.</span><span class="ident" id="3355425">AfterFunc</span><span class="op" id="3355434">(</span><span class="ident" id="3355435">c</span><span class="op" id="3355436">.</span><span class="ident" id="3355437">Timeout</span><span class="op" id="3355444">,</span>&nbsp;<span class="keyword" id="3355446">func</span><span class="op" id="3355450">(</span><span class="op" id="3355451">)</span>&nbsp;<span class="op" id="3355453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355458">reqmu</span><span class="op" id="3355463">.</span><span class="ident" id="3355464">Lock</span><span class="op" id="3355468">(</span><span class="op" id="3355469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355474">defer</span>&nbsp;<span class="ident" id="3355480">reqmu</span><span class="op" id="3355485">.</span><span class="ident" id="3355486">Unlock</span><span class="op" id="3355492">(</span><span class="op" id="3355493">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355498">tr</span><span class="op" id="3355500">.</span><span class="ident" id="3355501">CancelRequest</span><span class="op" id="3355514">(</span><span class="ident" id="3355515">req</span><span class="op" id="3355518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355522">}</span><span class="op" id="3355523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355530">urlStr</span>&nbsp;<span class="op" id="3355537">:=</span>&nbsp;<span class="string" id="3355540">&#34;&#34;</span>&nbsp;<span class="comment" id="3355543">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355608">redirectFailed</span>&nbsp;<span class="op" id="3355623">:=</span>&nbsp;<span class="builtintype" id="3355626">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355633">for</span>&nbsp;<span class="ident" id="3355637">redirect</span>&nbsp;<span class="op" id="3355646">:=</span>&nbsp;<span class="num" id="3355649">0</span><span class="op" id="3355650">;</span>&nbsp;<span class="op" id="3355652">;</span>&nbsp;<span class="ident" id="3355654">redirect</span><span class="op" id="3355662">++</span>&nbsp;<span class="op" id="3355665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355669">if</span>&nbsp;<span class="ident" id="3355672">redirect</span>&nbsp;<span class="op" id="3355681">!=</span>&nbsp;<span class="num" id="3355684">0</span>&nbsp;<span class="op" id="3355686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355691">nreq</span>&nbsp;<span class="op" id="3355696">:=</span>&nbsp;<span class="builtinfunc" id="3355699">new</span><span class="op" id="3355702">(</span><span class="ident" id="3355703">Request</span><span class="op" id="3355710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355715">nreq</span><span class="op" id="3355719">.</span><span class="ident" id="3355720">Method</span>&nbsp;<span class="op" id="3355727">=</span>&nbsp;<span class="ident" id="3355729">ireq</span><span class="op" id="3355733">.</span><span class="ident" id="3355734">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355744">if</span>&nbsp;<span class="ident" id="3355747">ireq</span><span class="op" id="3355751">.</span><span class="ident" id="3355752">Method</span>&nbsp;<span class="op" id="3355759">==</span>&nbsp;<span class="string" id="3355762">&#34;POST&#34;</span>&nbsp;<span class="op" id="3355769">||</span>&nbsp;<span class="ident" id="3355772">ireq</span><span class="op" id="3355776">.</span><span class="ident" id="3355777">Method</span>&nbsp;<span class="op" id="3355784">==</span>&nbsp;<span class="string" id="3355787">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3355793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355799">nreq</span><span class="op" id="3355803">.</span><span class="ident" id="3355804">Method</span>&nbsp;<span class="op" id="3355811">=</span>&nbsp;<span class="string" id="3355813">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355827">nreq</span><span class="op" id="3355831">.</span><span class="ident" id="3355832">Header</span>&nbsp;<span class="op" id="3355839">=</span>&nbsp;<span class="builtinfunc" id="3355841">make</span><span class="op" id="3355845">(</span><span class="ident" id="3355846">Header</span><span class="op" id="3355852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355857">nreq</span><span class="op" id="3355861">.</span><span class="ident" id="3355862">URL</span><span class="op" id="3355865">,</span>&nbsp;<span class="ident" id="3355867">err</span>&nbsp;<span class="op" id="3355871">=</span>&nbsp;<span class="ident" id="3355873">base</span><span class="op" id="3355877">.</span><span class="ident" id="3355878">Parse</span><span class="op" id="3355883">(</span><span class="ident" id="3355884">urlStr</span><span class="op" id="3355890">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355895">if</span>&nbsp;<span class="ident" id="3355898">err</span>&nbsp;<span class="op" id="3355902">!=</span>&nbsp;<span class="ident" id="3355905">nil</span>&nbsp;<span class="op" id="3355909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355915">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355929">if</span>&nbsp;<span class="builtinfunc" id="3355932">len</span><span class="op" id="3355935">(</span><span class="ident" id="3355936">via</span><span class="op" id="3355939">)</span>&nbsp;<span class="op" id="3355941">&gt;</span>&nbsp;<span class="num" id="3355943">0</span>&nbsp;<span class="op" id="3355945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355951">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355982">lastReq</span>&nbsp;<span class="op" id="3355990">:=</span>&nbsp;<span class="ident" id="3355993">via</span><span class="op" id="3355996">[</span><span class="builtinfunc" id="3355997">len</span><span class="op" id="3356000">(</span><span class="ident" id="3356001">via</span><span class="op" id="3356004">)</span><span class="op" id="3356005">-</span><span class="num" id="3356006">1</span><span class="op" id="3356007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356013">if</span>&nbsp;<span class="ident" id="3356016">ref</span>&nbsp;<span class="op" id="3356020">:=</span>&nbsp;<span class="ident" id="3356023">refererForURL</span><span class="op" id="3356036">(</span><span class="ident" id="3356037">lastReq</span><span class="op" id="3356044">.</span><span class="ident" id="3356045">URL</span><span class="op" id="3356048">,</span>&nbsp;<span class="ident" id="3356050">nreq</span><span class="op" id="3356054">.</span><span class="ident" id="3356055">URL</span><span class="op" id="3356058">)</span><span class="op" id="3356059">;</span>&nbsp;<span class="ident" id="3356061">ref</span>&nbsp;<span class="op" id="3356065">!=</span>&nbsp;<span class="string" id="3356068">&#34;&#34;</span>&nbsp;<span class="op" id="3356071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356078">nreq</span><span class="op" id="3356082">.</span><span class="ident" id="3356083">Header</span><span class="op" id="3356089">.</span><span class="ident" id="3356090">Set</span><span class="op" id="3356093">(</span><span class="string" id="3356094">&#34;Referer&#34;</span><span class="op" id="3356103">,</span>&nbsp;<span class="ident" id="3356105">ref</span><span class="op" id="3356108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356121">err</span>&nbsp;<span class="op" id="3356125">=</span>&nbsp;<span class="ident" id="3356127">redirectChecker</span><span class="op" id="3356142">(</span><span class="ident" id="3356143">nreq</span><span class="op" id="3356147">,</span>&nbsp;<span class="ident" id="3356149">via</span><span class="op" id="3356152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356158">if</span>&nbsp;<span class="ident" id="3356161">err</span>&nbsp;<span class="op" id="3356165">!=</span>&nbsp;<span class="ident" id="3356168">nil</span>&nbsp;<span class="op" id="3356172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356179">redirectFailed</span>&nbsp;<span class="op" id="3356194">=</span>&nbsp;<span class="builtintype" id="3356196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356206">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356216">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356226">reqmu</span><span class="op" id="3356231">.</span><span class="ident" id="3356232">Lock</span><span class="op" id="3356236">(</span><span class="op" id="3356237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356242">req</span>&nbsp;<span class="op" id="3356246">=</span>&nbsp;<span class="ident" id="3356248">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356256">reqmu</span><span class="op" id="3356261">.</span><span class="ident" id="3356262">Unlock</span><span class="op" id="3356268">(</span><span class="op" id="3356269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356273">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356278">urlStr</span>&nbsp;<span class="op" id="3356285">=</span>&nbsp;<span class="ident" id="3356287">req</span><span class="op" id="3356290">.</span><span class="ident" id="3356291">URL</span><span class="op" id="3356294">.</span><span class="ident" id="3356295">String</span><span class="op" id="3356301">(</span><span class="op" id="3356302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356306">if</span>&nbsp;<span class="ident" id="3356309">resp</span><span class="op" id="3356313">,</span>&nbsp;<span class="ident" id="3356315">err</span>&nbsp;<span class="op" id="3356319">=</span>&nbsp;<span class="ident" id="3356321">c</span><span class="op" id="3356322">.</span><span class="ident" id="3356323">send</span><span class="op" id="3356327">(</span><span class="ident" id="3356328">req</span><span class="op" id="3356331">)</span><span class="op" id="3356332">;</span>&nbsp;<span class="ident" id="3356334">err</span>&nbsp;<span class="op" id="3356338">!=</span>&nbsp;<span class="ident" id="3356341">nil</span>&nbsp;<span class="op" id="3356345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356350">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356358">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356363">if</span>&nbsp;<span class="ident" id="3356366">shouldRedirect</span><span class="op" id="3356380">(</span><span class="ident" id="3356381">resp</span><span class="op" id="3356385">.</span><span class="ident" id="3356386">StatusCode</span><span class="op" id="3356396">)</span>&nbsp;<span class="op" id="3356398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3356403">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3356478">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356559">const</span>&nbsp;<span class="ident" id="3356565">maxBodySlurpSize</span>&nbsp;<span class="op" id="3356582">=</span>&nbsp;<span class="num" id="3356584">2</span>&nbsp;<span class="op" id="3356586">&lt;&lt;</span>&nbsp;<span class="num" id="3356589">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356595">if</span>&nbsp;<span class="ident" id="3356598">resp</span><span class="op" id="3356602">.</span><span class="ident" id="3356603">ContentLength</span>&nbsp;<span class="op" id="3356617">==</span>&nbsp;<span class="op" id="3356620">-</span><span class="num" id="3356621">1</span>&nbsp;<span class="op" id="3356623">||</span>&nbsp;<span class="ident" id="3356626">resp</span><span class="op" id="3356630">.</span><span class="ident" id="3356631">ContentLength</span>&nbsp;<span class="op" id="3356645">&lt;=</span>&nbsp;<span class="ident" id="3356648">maxBodySlurpSize</span>&nbsp;<span class="op" id="3356665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356671">io</span><span class="op" id="3356673">.</span><span class="ident" id="3356674">CopyN</span><span class="op" id="3356679">(</span><span class="ident" id="3356680">ioutil</span><span class="op" id="3356686">.</span><span class="ident" id="3356687">Discard</span><span class="op" id="3356694">,</span>&nbsp;<span class="ident" id="3356696">resp</span><span class="op" id="3356700">.</span><span class="ident" id="3356701">Body</span><span class="op" id="3356705">,</span>&nbsp;<span class="ident" id="3356707">maxBodySlurpSize</span><span class="op" id="3356723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356733">resp</span><span class="op" id="3356737">.</span><span class="ident" id="3356738">Body</span><span class="op" id="3356742">.</span><span class="ident" id="3356743">Close</span><span class="op" id="3356748">(</span><span class="op" id="3356749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356754">if</span>&nbsp;<span class="ident" id="3356757">urlStr</span>&nbsp;<span class="op" id="3356764">=</span>&nbsp;<span class="ident" id="3356766">resp</span><span class="op" id="3356770">.</span><span class="ident" id="3356771">Header</span><span class="op" id="3356777">.</span><span class="ident" id="3356778">Get</span><span class="op" id="3356781">(</span><span class="string" id="3356782">&#34;Location&#34;</span><span class="op" id="3356792">)</span><span class="op" id="3356793">;</span>&nbsp;<span class="ident" id="3356795">urlStr</span>&nbsp;<span class="op" id="3356802">==</span>&nbsp;<span class="string" id="3356805">&#34;&#34;</span>&nbsp;<span class="op" id="3356808">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356814">err</span>&nbsp;<span class="op" id="3356818">=</span>&nbsp;<span class="ident" id="3356820">errors</span><span class="op" id="3356826">.</span><span class="ident" id="3356827">New</span><span class="op" id="3356830">(</span><span class="ident" id="3356831">fmt</span><span class="op" id="3356834">.</span><span class="ident" id="3356835">Sprintf</span><span class="op" id="3356842">(</span><span class="string" id="3356843">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="3356880">,</span>&nbsp;<span class="ident" id="3356882">resp</span><span class="op" id="3356886">.</span><span class="ident" id="3356887">StatusCode</span><span class="op" id="3356897">)</span><span class="op" id="3356898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356904">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356918">base</span>&nbsp;<span class="op" id="3356923">=</span>&nbsp;<span class="ident" id="3356925">req</span><span class="op" id="3356928">.</span><span class="ident" id="3356929">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356936">via</span>&nbsp;<span class="op" id="3356940">=</span>&nbsp;<span class="builtinfunc" id="3356942">append</span><span class="op" id="3356948">(</span><span class="ident" id="3356949">via</span><span class="op" id="3356952">,</span>&nbsp;<span class="ident" id="3356954">req</span><span class="op" id="3356957">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356962">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356977">if</span>&nbsp;<span class="ident" id="3356980">timer</span>&nbsp;<span class="op" id="3356986">!=</span>&nbsp;<span class="ident" id="3356989">nil</span>&nbsp;<span class="op" id="3356993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356998">resp</span><span class="op" id="3357002">.</span><span class="ident" id="3357003">Body</span>&nbsp;<span class="op" id="3357008">=</span>&nbsp;<span class="op" id="3357010">&amp;</span><span class="ident" id="3357011">cancelTimerBody</span><span class="op" id="3357026">{</span><span class="ident" id="3357027">timer</span><span class="op" id="3357032">,</span>&nbsp;<span class="ident" id="3357034">resp</span><span class="op" id="3357038">.</span><span class="ident" id="3357039">Body</span><span class="op" id="3357043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357047">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357051">return</span>&nbsp;<span class="ident" id="3357058">resp</span><span class="op" id="3357062">,</span>&nbsp;<span class="ident" id="3357064">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357073">method</span>&nbsp;<span class="op" id="3357080">:=</span>&nbsp;<span class="ident" id="3357083">ireq</span><span class="op" id="3357087">.</span><span class="ident" id="3357088">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357096">urlErr</span>&nbsp;<span class="op" id="3357103">:=</span>&nbsp;<span class="op" id="3357106">&amp;</span><span class="ident" id="3357107">url</span><span class="op" id="3357110">.</span><span class="ident" id="3357111">Error</span><span class="op" id="3357116">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357120">Op</span><span class="op" id="3357122">:</span>&nbsp;&nbsp;<span class="ident" id="3357125">method</span><span class="op" id="3357131">[</span><span class="num" id="3357132">0</span><span class="op" id="3357133">:</span><span class="num" id="3357134">1</span><span class="op" id="3357135">]</span>&nbsp;<span class="op" id="3357137">+</span>&nbsp;<span class="ident" id="3357139">strings</span><span class="op" id="3357146">.</span><span class="ident" id="3357147">ToLower</span><span class="op" id="3357154">(</span><span class="ident" id="3357155">method</span><span class="op" id="3357161">[</span><span class="num" id="3357162">1</span><span class="op" id="3357163">:</span><span class="op" id="3357164">]</span><span class="op" id="3357165">)</span><span class="op" id="3357166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357170">URL</span><span class="op" id="3357173">:</span>&nbsp;<span class="ident" id="3357175">urlStr</span><span class="op" id="3357181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357185">Err</span><span class="op" id="3357188">:</span>&nbsp;<span class="ident" id="3357190">err</span><span class="op" id="3357193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357200">if</span>&nbsp;<span class="ident" id="3357203">redirectFailed</span>&nbsp;<span class="op" id="3357218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357222">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357289">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357345">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357383">return</span>&nbsp;<span class="ident" id="3357390">resp</span><span class="op" id="3357394">,</span>&nbsp;<span class="ident" id="3357396">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357408">if</span>&nbsp;<span class="ident" id="3357411">resp</span>&nbsp;<span class="op" id="3357416">!=</span>&nbsp;<span class="ident" id="3357419">nil</span>&nbsp;<span class="op" id="3357423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357427">resp</span><span class="op" id="3357431">.</span><span class="ident" id="3357432">Body</span><span class="op" id="3357436">.</span><span class="ident" id="3357437">Close</span><span class="op" id="3357442">(</span><span class="op" id="3357443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357446">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357449">return</span>&nbsp;<span class="ident" id="3357456">nil</span><span class="op" id="3357459">,</span>&nbsp;<span class="ident" id="3357461">urlErr</span><br>
<span class="lineno"></span><span class="op" id="3357468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357471">func</span>&nbsp;<span class="ident" id="3357476">defaultCheckRedirect</span><span class="op" id="3357496">(</span><span class="ident" id="3357497">req</span>&nbsp;<span class="op" id="3357501">*</span><span class="ident" id="3357502">Request</span><span class="op" id="3357509">,</span>&nbsp;<span class="ident" id="3357511">via</span>&nbsp;<span class="op" id="3357515">[</span><span class="op" id="3357516">]</span><span class="op" id="3357517">*</span><span class="ident" id="3357518">Request</span><span class="op" id="3357525">)</span>&nbsp;<span class="builtintype" id="3357527">error</span>&nbsp;<span class="op" id="3357533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357536">if</span>&nbsp;<span class="builtinfunc" id="3357539">len</span><span class="op" id="3357542">(</span><span class="ident" id="3357543">via</span><span class="op" id="3357546">)</span>&nbsp;<span class="op" id="3357548">&gt;=</span>&nbsp;<span class="num" id="3357551">10</span>&nbsp;<span class="op" id="3357554">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357558">return</span>&nbsp;<span class="ident" id="3357565">errors</span><span class="op" id="3357571">.</span><span class="ident" id="3357572">New</span><span class="op" id="3357575">(</span><span class="string" id="3357576">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="3357604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357610">return</span>&nbsp;<span class="ident" id="3357617">nil</span><br>
<span class="lineno"></span><span class="op" id="3357621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3357624">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="3357668">//</span><br>
<span class="lineno"></span><span class="comment" id="3357671">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3357731">//</span><br>
<span class="lineno"></span><span class="comment" id="3357734">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="3357781">func</span>&nbsp;<span class="ident" id="3357786">Post</span><span class="op" id="3357790">(</span><span class="ident" id="3357791">url</span>&nbsp;<span class="builtintype" id="3357795">string</span><span class="op" id="3357801">,</span>&nbsp;<span class="ident" id="3357803">bodyType</span>&nbsp;<span class="builtintype" id="3357812">string</span><span class="op" id="3357818">,</span>&nbsp;<span class="ident" id="3357820">body</span>&nbsp;<span class="ident" id="3357825">io</span><span class="op" id="3357827">.</span><span class="ident" id="3357828">Reader</span><span class="op" id="3357834">)</span>&nbsp;<span class="op" id="3357836">(</span><span class="ident" id="3357837">resp</span>&nbsp;<span class="op" id="3357842">*</span><span class="ident" id="3357843">Response</span><span class="op" id="3357851">,</span>&nbsp;<span class="ident" id="3357853">err</span>&nbsp;<span class="builtintype" id="3357857">error</span><span class="op" id="3357862">)</span>&nbsp;<span class="op" id="3357864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357867">return</span>&nbsp;<span class="ident" id="3357874">DefaultClient</span><span class="op" id="3357887">.</span><span class="ident" id="3357888">Post</span><span class="op" id="3357892">(</span><span class="ident" id="3357893">url</span><span class="op" id="3357896">,</span>&nbsp;<span class="ident" id="3357898">bodyType</span><span class="op" id="3357906">,</span>&nbsp;<span class="ident" id="3357908">body</span><span class="op" id="3357912">)</span><br>
<span class="lineno"></span><span class="op" id="3357914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3357917">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="3357961">//</span><br>
<span class="lineno"></span><span class="comment" id="3357964">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3358024">//</span><br>
<span class="lineno"></span><span class="comment" id="3358027">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3358096">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="3358108">func</span>&nbsp;<span class="op" id="3358113">(</span><span class="ident" id="3358114">c</span>&nbsp;<span class="op" id="3358116">*</span><span class="ident" id="3358117">Client</span><span class="op" id="3358123">)</span>&nbsp;<span class="ident" id="3358125">Post</span><span class="op" id="3358129">(</span><span class="ident" id="3358130">url</span>&nbsp;<span class="builtintype" id="3358134">string</span><span class="op" id="3358140">,</span>&nbsp;<span class="ident" id="3358142">bodyType</span>&nbsp;<span class="builtintype" id="3358151">string</span><span class="op" id="3358157">,</span>&nbsp;<span class="ident" id="3358159">body</span>&nbsp;<span class="ident" id="3358164">io</span><span class="op" id="3358166">.</span><span class="ident" id="3358167">Reader</span><span class="op" id="3358173">)</span>&nbsp;<span class="op" id="3358175">(</span><span class="ident" id="3358176">resp</span>&nbsp;<span class="op" id="3358181">*</span><span class="ident" id="3358182">Response</span><span class="op" id="3358190">,</span>&nbsp;<span class="ident" id="3358192">err</span>&nbsp;<span class="builtintype" id="3358196">error</span><span class="op" id="3358201">)</span>&nbsp;<span class="op" id="3358203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358206">req</span><span class="op" id="3358209">,</span>&nbsp;<span class="ident" id="3358211">err</span>&nbsp;<span class="op" id="3358215">:=</span>&nbsp;<span class="ident" id="3358218">NewRequest</span><span class="op" id="3358228">(</span><span class="string" id="3358229">&#34;POST&#34;</span><span class="op" id="3358235">,</span>&nbsp;<span class="ident" id="3358237">url</span><span class="op" id="3358240">,</span>&nbsp;<span class="ident" id="3358242">body</span><span class="op" id="3358246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358249">if</span>&nbsp;<span class="ident" id="3358252">err</span>&nbsp;<span class="op" id="3358256">!=</span>&nbsp;<span class="ident" id="3358259">nil</span>&nbsp;<span class="op" id="3358263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358267">return</span>&nbsp;<span class="ident" id="3358274">nil</span><span class="op" id="3358277">,</span>&nbsp;<span class="ident" id="3358279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358284">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358287">req</span><span class="op" id="3358290">.</span><span class="ident" id="3358291">Header</span><span class="op" id="3358297">.</span><span class="ident" id="3358298">Set</span><span class="op" id="3358301">(</span><span class="string" id="3358302">&#34;Content-Type&#34;</span><span class="op" id="3358316">,</span>&nbsp;<span class="ident" id="3358318">bodyType</span><span class="op" id="3358326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358329">return</span>&nbsp;<span class="ident" id="3358336">c</span><span class="op" id="3358337">.</span><span class="ident" id="3358338">doFollowingRedirects</span><span class="op" id="3358358">(</span><span class="ident" id="3358359">req</span><span class="op" id="3358362">,</span>&nbsp;<span class="ident" id="3358364">shouldRedirectPost</span><span class="op" id="3358382">)</span><br>
<span class="lineno"></span><span class="op" id="3358384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358387">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="3358456">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3358499">//</span><br>
<span class="lineno"></span><span class="comment" id="3358502">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3358564">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3358624">//</span><br>
<span class="lineno">450</span><span class="comment" id="3358627">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="3358682">func</span>&nbsp;<span class="ident" id="3358687">PostForm</span><span class="op" id="3358695">(</span><span class="ident" id="3358696">url</span>&nbsp;<span class="builtintype" id="3358700">string</span><span class="op" id="3358706">,</span>&nbsp;<span class="ident" id="3358708">data</span>&nbsp;<span class="ident" id="3358713">url</span><span class="op" id="3358716">.</span><span class="ident" id="3358717">Values</span><span class="op" id="3358723">)</span>&nbsp;<span class="op" id="3358725">(</span><span class="ident" id="3358726">resp</span>&nbsp;<span class="op" id="3358731">*</span><span class="ident" id="3358732">Response</span><span class="op" id="3358740">,</span>&nbsp;<span class="ident" id="3358742">err</span>&nbsp;<span class="builtintype" id="3358746">error</span><span class="op" id="3358751">)</span>&nbsp;<span class="op" id="3358753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358756">return</span>&nbsp;<span class="ident" id="3358763">DefaultClient</span><span class="op" id="3358776">.</span><span class="ident" id="3358777">PostForm</span><span class="op" id="3358785">(</span><span class="ident" id="3358786">url</span><span class="op" id="3358789">,</span>&nbsp;<span class="ident" id="3358791">data</span><span class="op" id="3358795">)</span><br>
<span class="lineno"></span><span class="op" id="3358797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3358800">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="3358848">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3358911">//</span><br>
<span class="lineno"></span><span class="comment" id="3358914">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3358976">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="3359036">func</span>&nbsp;<span class="op" id="3359041">(</span><span class="ident" id="3359042">c</span>&nbsp;<span class="op" id="3359044">*</span><span class="ident" id="3359045">Client</span><span class="op" id="3359051">)</span>&nbsp;<span class="ident" id="3359053">PostForm</span><span class="op" id="3359061">(</span><span class="ident" id="3359062">url</span>&nbsp;<span class="builtintype" id="3359066">string</span><span class="op" id="3359072">,</span>&nbsp;<span class="ident" id="3359074">data</span>&nbsp;<span class="ident" id="3359079">url</span><span class="op" id="3359082">.</span><span class="ident" id="3359083">Values</span><span class="op" id="3359089">)</span>&nbsp;<span class="op" id="3359091">(</span><span class="ident" id="3359092">resp</span>&nbsp;<span class="op" id="3359097">*</span><span class="ident" id="3359098">Response</span><span class="op" id="3359106">,</span>&nbsp;<span class="ident" id="3359108">err</span>&nbsp;<span class="builtintype" id="3359112">error</span><span class="op" id="3359117">)</span>&nbsp;<span class="op" id="3359119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359122">return</span>&nbsp;<span class="ident" id="3359129">c</span><span class="op" id="3359130">.</span><span class="ident" id="3359131">Post</span><span class="op" id="3359135">(</span><span class="ident" id="3359136">url</span><span class="op" id="3359139">,</span>&nbsp;<span class="string" id="3359141">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3359176">,</span>&nbsp;<span class="ident" id="3359178">strings</span><span class="op" id="3359185">.</span><span class="ident" id="3359186">NewReader</span><span class="op" id="3359195">(</span><span class="ident" id="3359196">data</span><span class="op" id="3359200">.</span><span class="ident" id="3359201">Encode</span><span class="op" id="3359207">(</span><span class="op" id="3359208">)</span><span class="op" id="3359209">)</span><span class="op" id="3359210">)</span><br>
<span class="lineno"></span><span class="op" id="3359212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3359215">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3359290">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3359363">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3359399">//</span><br>
<span class="lineno"></span><span class="comment" id="3359402">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3359432">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="3359450">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3359472">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3359503">//</span><br>
<span class="lineno"></span><span class="comment" id="3359506">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="3359553">func</span>&nbsp;<span class="ident" id="3359558">Head</span><span class="op" id="3359562">(</span><span class="ident" id="3359563">url</span>&nbsp;<span class="builtintype" id="3359567">string</span><span class="op" id="3359573">)</span>&nbsp;<span class="op" id="3359575">(</span><span class="ident" id="3359576">resp</span>&nbsp;<span class="op" id="3359581">*</span><span class="ident" id="3359582">Response</span><span class="op" id="3359590">,</span>&nbsp;<span class="ident" id="3359592">err</span>&nbsp;<span class="builtintype" id="3359596">error</span><span class="op" id="3359601">)</span>&nbsp;<span class="op" id="3359603">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359606">return</span>&nbsp;<span class="ident" id="3359613">DefaultClient</span><span class="op" id="3359626">.</span><span class="ident" id="3359627">Head</span><span class="op" id="3359631">(</span><span class="ident" id="3359632">url</span><span class="op" id="3359635">)</span><br>
<span class="lineno"></span><span class="op" id="3359637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3359640">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3359715">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="3359788">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3359824">//</span><br>
<span class="lineno"></span><span class="comment" id="3359827">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3359857">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3359875">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="3359897">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="3359928">func</span>&nbsp;<span class="op" id="3359933">(</span><span class="ident" id="3359934">c</span>&nbsp;<span class="op" id="3359936">*</span><span class="ident" id="3359937">Client</span><span class="op" id="3359943">)</span>&nbsp;<span class="ident" id="3359945">Head</span><span class="op" id="3359949">(</span><span class="ident" id="3359950">url</span>&nbsp;<span class="builtintype" id="3359954">string</span><span class="op" id="3359960">)</span>&nbsp;<span class="op" id="3359962">(</span><span class="ident" id="3359963">resp</span>&nbsp;<span class="op" id="3359968">*</span><span class="ident" id="3359969">Response</span><span class="op" id="3359977">,</span>&nbsp;<span class="ident" id="3359979">err</span>&nbsp;<span class="builtintype" id="3359983">error</span><span class="op" id="3359988">)</span>&nbsp;<span class="op" id="3359990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359993">req</span><span class="op" id="3359996">,</span>&nbsp;<span class="ident" id="3359998">err</span>&nbsp;<span class="op" id="3360002">:=</span>&nbsp;<span class="ident" id="3360005">NewRequest</span><span class="op" id="3360015">(</span><span class="string" id="3360016">&#34;HEAD&#34;</span><span class="op" id="3360022">,</span>&nbsp;<span class="ident" id="3360024">url</span><span class="op" id="3360027">,</span>&nbsp;<span class="ident" id="3360029">nil</span><span class="op" id="3360032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360035">if</span>&nbsp;<span class="ident" id="3360038">err</span>&nbsp;<span class="op" id="3360042">!=</span>&nbsp;<span class="ident" id="3360045">nil</span>&nbsp;<span class="op" id="3360049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360053">return</span>&nbsp;<span class="ident" id="3360060">nil</span><span class="op" id="3360063">,</span>&nbsp;<span class="ident" id="3360065">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360073">return</span>&nbsp;<span class="ident" id="3360080">c</span><span class="op" id="3360081">.</span><span class="ident" id="3360082">doFollowingRedirects</span><span class="op" id="3360102">(</span><span class="ident" id="3360103">req</span><span class="op" id="3360106">,</span>&nbsp;<span class="ident" id="3360108">shouldRedirectGet</span><span class="op" id="3360125">)</span><br>
<span class="lineno"></span><span class="op" id="3360127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3360130">type</span>&nbsp;<span class="ident" id="3360135">cancelTimerBody</span>&nbsp;<span class="keyword" id="3360151">struct</span>&nbsp;<span class="op" id="3360158">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360161">t</span>&nbsp;&nbsp;<span class="op" id="3360164">*</span><span class="ident" id="3360165">time</span><span class="op" id="3360169">.</span><span class="ident" id="3360170">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360177">rc</span>&nbsp;<span class="ident" id="3360180">io</span><span class="op" id="3360182">.</span><span class="ident" id="3360183">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="3360194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3360197">func</span>&nbsp;<span class="op" id="3360202">(</span><span class="ident" id="3360203">b</span>&nbsp;<span class="op" id="3360205">*</span><span class="ident" id="3360206">cancelTimerBody</span><span class="op" id="3360221">)</span>&nbsp;<span class="ident" id="3360223">Read</span><span class="op" id="3360227">(</span><span class="ident" id="3360228">p</span>&nbsp;<span class="op" id="3360230">[</span><span class="op" id="3360231">]</span><span class="builtintype" id="3360232">byte</span><span class="op" id="3360236">)</span>&nbsp;<span class="op" id="3360238">(</span><span class="ident" id="3360239">n</span>&nbsp;<span class="builtintype" id="3360241">int</span><span class="op" id="3360244">,</span>&nbsp;<span class="ident" id="3360246">err</span>&nbsp;<span class="builtintype" id="3360250">error</span><span class="op" id="3360255">)</span>&nbsp;<span class="op" id="3360257">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360260">n</span><span class="op" id="3360261">,</span>&nbsp;<span class="ident" id="3360263">err</span>&nbsp;<span class="op" id="3360267">=</span>&nbsp;<span class="ident" id="3360269">b</span><span class="op" id="3360270">.</span><span class="ident" id="3360271">rc</span><span class="op" id="3360273">.</span><span class="ident" id="3360274">Read</span><span class="op" id="3360278">(</span><span class="ident" id="3360279">p</span><span class="op" id="3360280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360283">if</span>&nbsp;<span class="ident" id="3360286">err</span>&nbsp;<span class="op" id="3360290">==</span>&nbsp;<span class="ident" id="3360293">io</span><span class="op" id="3360295">.</span><span class="ident" id="3360296">EOF</span>&nbsp;<span class="op" id="3360300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360304">b</span><span class="op" id="3360305">.</span><span class="ident" id="3360306">t</span><span class="op" id="3360307">.</span><span class="ident" id="3360308">Stop</span><span class="op" id="3360312">(</span><span class="op" id="3360313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360319">return</span><br>
<span class="lineno">505</span><span class="op" id="3360326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3360329">func</span>&nbsp;<span class="op" id="3360334">(</span><span class="ident" id="3360335">b</span>&nbsp;<span class="op" id="3360337">*</span><span class="ident" id="3360338">cancelTimerBody</span><span class="op" id="3360353">)</span>&nbsp;<span class="ident" id="3360355">Close</span><span class="op" id="3360360">(</span><span class="op" id="3360361">)</span>&nbsp;<span class="builtintype" id="3360363">error</span>&nbsp;<span class="op" id="3360369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360372">err</span>&nbsp;<span class="op" id="3360376">:=</span>&nbsp;<span class="ident" id="3360379">b</span><span class="op" id="3360380">.</span><span class="ident" id="3360381">rc</span><span class="op" id="3360383">.</span><span class="ident" id="3360384">Close</span><span class="op" id="3360389">(</span><span class="op" id="3360390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360393">b</span><span class="op" id="3360394">.</span><span class="ident" id="3360395">t</span><span class="op" id="3360396">.</span><span class="ident" id="3360397">Stop</span><span class="op" id="3360401">(</span><span class="op" id="3360402">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360405">return</span>&nbsp;<span class="ident" id="3360412">err</span><br>
<span class="lineno"></span><span class="op" id="3360416">}</span>
</div>
</body>
</html>
