<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html" class="current">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7977631">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7977686">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7977740">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7977791">package</span>&nbsp;<span class="ident" id="7977799">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7977804">import</span>&nbsp;<span class="op" id="7977811">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977814">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977822">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977829">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977835">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977846">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7977857">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7977867">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7977870">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="7977943">var</span>&nbsp;<span class="ident" id="7977947">testIPv6</span>&nbsp;<span class="op" id="7977956">=</span>&nbsp;<span class="ident" id="7977958">flag</span><span class="op" id="7977962">.</span><span class="ident" id="7977963">Bool</span><span class="op" id="7977967">(</span><span class="string" id="7977968">&#34;ipv6&#34;</span><span class="op" id="7977974">,</span>&nbsp;<span class="builtintype" id="7977976">false</span><span class="op" id="7977981">,</span>&nbsp;<span class="string" id="7977983">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="7978014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7978017">func</span>&nbsp;<span class="ident" id="7978022">TestResolveGoogle</span><span class="op" id="7978039">(</span><span class="ident" id="7978040">t</span>&nbsp;<span class="op" id="7978042">*</span><span class="ident" id="7978043">testing</span><span class="op" id="7978050">.</span><span class="ident" id="7978051">T</span><span class="op" id="7978052">)</span>&nbsp;<span class="op" id="7978054">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978057">if</span>&nbsp;<span class="ident" id="7978060">testing</span><span class="op" id="7978067">.</span><span class="ident" id="7978068">Short</span><span class="op" id="7978073">(</span><span class="op" id="7978074">)</span>&nbsp;<span class="op" id="7978076">||</span>&nbsp;<span class="op" id="7978079">!</span><span class="op" id="7978080">*</span><span class="ident" id="7978081">testExternal</span>&nbsp;<span class="op" id="7978094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978098">t</span><span class="op" id="7978099">.</span><span class="ident" id="7978100">Skip</span><span class="op" id="7978104">(</span><span class="string" id="7978105">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7978146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978153">for</span>&nbsp;<span class="ident" id="7978157">_</span><span class="op" id="7978158">,</span>&nbsp;<span class="ident" id="7978160">network</span>&nbsp;<span class="op" id="7978168">:=</span>&nbsp;<span class="keyword" id="7978171">range</span>&nbsp;<span class="op" id="7978177">[</span><span class="op" id="7978178">]</span><span class="builtintype" id="7978179">string</span><span class="op" id="7978185">{</span><span class="string" id="7978186">&#34;tcp&#34;</span><span class="op" id="7978191">,</span>&nbsp;<span class="string" id="7978193">&#34;tcp4&#34;</span><span class="op" id="7978199">,</span>&nbsp;<span class="string" id="7978201">&#34;tcp6&#34;</span><span class="op" id="7978207">}</span>&nbsp;<span class="op" id="7978209">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978213">addr</span><span class="op" id="7978217">,</span>&nbsp;<span class="ident" id="7978219">err</span>&nbsp;<span class="op" id="7978223">:=</span>&nbsp;<span class="ident" id="7978226">ResolveTCPAddr</span><span class="op" id="7978240">(</span><span class="ident" id="7978241">network</span><span class="op" id="7978248">,</span>&nbsp;<span class="string" id="7978250">&#34;www.google.com:http&#34;</span><span class="op" id="7978271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978275">if</span>&nbsp;<span class="ident" id="7978278">err</span>&nbsp;<span class="op" id="7978282">!=</span>&nbsp;<span class="ident" id="7978285">nil</span>&nbsp;<span class="op" id="7978289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978294">if</span>&nbsp;<span class="op" id="7978297">(</span><span class="ident" id="7978298">network</span>&nbsp;<span class="op" id="7978306">==</span>&nbsp;<span class="string" id="7978309">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7978315">||</span>&nbsp;<span class="ident" id="7978318">network</span>&nbsp;<span class="op" id="7978326">==</span>&nbsp;<span class="string" id="7978329">&#34;tcp4&#34;</span><span class="op" id="7978335">)</span>&nbsp;<span class="op" id="7978337">&amp;&amp;</span>&nbsp;<span class="op" id="7978340">!</span><span class="ident" id="7978341">supportsIPv4</span>&nbsp;<span class="op" id="7978354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978360">t</span><span class="op" id="7978361">.</span><span class="ident" id="7978362">Logf</span><span class="op" id="7978366">(</span><span class="string" id="7978367">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7978394">,</span>&nbsp;<span class="ident" id="7978396">err</span><span class="op" id="7978399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978404">}</span>&nbsp;<span class="keyword" id="7978406">else</span>&nbsp;<span class="keyword" id="7978411">if</span>&nbsp;<span class="ident" id="7978414">network</span>&nbsp;<span class="op" id="7978422">==</span>&nbsp;<span class="string" id="7978425">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7978432">&amp;&amp;</span>&nbsp;<span class="op" id="7978435">!</span><span class="ident" id="7978436">supportsIPv6</span>&nbsp;<span class="op" id="7978449">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978455">t</span><span class="op" id="7978456">.</span><span class="ident" id="7978457">Logf</span><span class="op" id="7978461">(</span><span class="string" id="7978462">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7978489">,</span>&nbsp;<span class="ident" id="7978491">err</span><span class="op" id="7978494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978499">}</span>&nbsp;<span class="keyword" id="7978501">else</span>&nbsp;<span class="op" id="7978506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978512">t</span><span class="op" id="7978513">.</span><span class="ident" id="7978514">Errorf</span><span class="op" id="7978520">(</span><span class="string" id="7978521">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7978548">,</span>&nbsp;<span class="ident" id="7978550">err</span><span class="op" id="7978553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978563">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978578">if</span>&nbsp;<span class="op" id="7978581">(</span><span class="ident" id="7978582">network</span>&nbsp;<span class="op" id="7978590">==</span>&nbsp;<span class="string" id="7978593">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7978599">||</span>&nbsp;<span class="ident" id="7978602">network</span>&nbsp;<span class="op" id="7978610">==</span>&nbsp;<span class="string" id="7978613">&#34;tcp4&#34;</span><span class="op" id="7978619">)</span>&nbsp;<span class="op" id="7978621">&amp;&amp;</span>&nbsp;<span class="ident" id="7978624">addr</span><span class="op" id="7978628">.</span><span class="ident" id="7978629">IP</span><span class="op" id="7978631">.</span><span class="ident" id="7978632">To4</span><span class="op" id="7978635">(</span><span class="op" id="7978636">)</span>&nbsp;<span class="op" id="7978638">==</span>&nbsp;<span class="ident" id="7978641">nil</span>&nbsp;<span class="op" id="7978645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978650">t</span><span class="op" id="7978651">.</span><span class="ident" id="7978652">Errorf</span><span class="op" id="7978658">(</span><span class="string" id="7978659">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7978699">,</span>&nbsp;<span class="ident" id="7978701">addr</span><span class="op" id="7978705">,</span>&nbsp;<span class="ident" id="7978707">network</span><span class="op" id="7978714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978718">}</span>&nbsp;<span class="keyword" id="7978720">else</span>&nbsp;<span class="keyword" id="7978725">if</span>&nbsp;<span class="ident" id="7978728">network</span>&nbsp;<span class="op" id="7978736">==</span>&nbsp;<span class="string" id="7978739">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7978746">&amp;&amp;</span>&nbsp;<span class="op" id="7978749">(</span><span class="ident" id="7978750">addr</span><span class="op" id="7978754">.</span><span class="ident" id="7978755">IP</span><span class="op" id="7978757">.</span><span class="ident" id="7978758">To16</span><span class="op" id="7978762">(</span><span class="op" id="7978763">)</span>&nbsp;<span class="op" id="7978765">==</span>&nbsp;<span class="ident" id="7978768">nil</span>&nbsp;<span class="op" id="7978772">||</span>&nbsp;<span class="ident" id="7978775">addr</span><span class="op" id="7978779">.</span><span class="ident" id="7978780">IP</span><span class="op" id="7978782">.</span><span class="ident" id="7978783">To4</span><span class="op" id="7978786">(</span><span class="op" id="7978787">)</span>&nbsp;<span class="op" id="7978789">!=</span>&nbsp;<span class="ident" id="7978792">nil</span><span class="op" id="7978795">)</span>&nbsp;<span class="op" id="7978797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978802">t</span><span class="op" id="7978803">.</span><span class="ident" id="7978804">Errorf</span><span class="op" id="7978810">(</span><span class="string" id="7978811">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7978851">,</span>&nbsp;<span class="ident" id="7978853">addr</span><span class="op" id="7978857">,</span>&nbsp;<span class="ident" id="7978859">network</span><span class="op" id="7978866">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7978873">}</span><br>
<span class="lineno"></span><span class="op" id="7978875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7978878">func</span>&nbsp;<span class="ident" id="7978883">TestDialGoogle</span><span class="op" id="7978897">(</span><span class="ident" id="7978898">t</span>&nbsp;<span class="op" id="7978900">*</span><span class="ident" id="7978901">testing</span><span class="op" id="7978908">.</span><span class="ident" id="7978909">T</span><span class="op" id="7978910">)</span>&nbsp;<span class="op" id="7978912">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7978915">if</span>&nbsp;<span class="ident" id="7978918">testing</span><span class="op" id="7978925">.</span><span class="ident" id="7978926">Short</span><span class="op" id="7978931">(</span><span class="op" id="7978932">)</span>&nbsp;<span class="op" id="7978934">||</span>&nbsp;<span class="op" id="7978937">!</span><span class="op" id="7978938">*</span><span class="ident" id="7978939">testExternal</span>&nbsp;<span class="op" id="7978952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7978956">t</span><span class="op" id="7978957">.</span><span class="ident" id="7978958">Skip</span><span class="op" id="7978962">(</span><span class="string" id="7978963">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7979004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979011">d</span>&nbsp;<span class="op" id="7979013">:=</span>&nbsp;<span class="op" id="7979016">&amp;</span><span class="ident" id="7979017">Dialer</span><span class="op" id="7979023">{</span><span class="ident" id="7979024">DualStack</span><span class="op" id="7979033">:</span>&nbsp;<span class="builtintype" id="7979035">true</span><span class="op" id="7979039">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979042">for</span>&nbsp;<span class="ident" id="7979046">_</span><span class="op" id="7979047">,</span>&nbsp;<span class="ident" id="7979049">network</span>&nbsp;<span class="op" id="7979057">:=</span>&nbsp;<span class="keyword" id="7979060">range</span>&nbsp;<span class="op" id="7979066">[</span><span class="op" id="7979067">]</span><span class="builtintype" id="7979068">string</span><span class="op" id="7979074">{</span><span class="string" id="7979075">&#34;tcp&#34;</span><span class="op" id="7979080">,</span>&nbsp;<span class="string" id="7979082">&#34;tcp4&#34;</span><span class="op" id="7979088">,</span>&nbsp;<span class="string" id="7979090">&#34;tcp6&#34;</span><span class="op" id="7979096">}</span>&nbsp;<span class="op" id="7979098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979102">if</span>&nbsp;<span class="ident" id="7979105">network</span>&nbsp;<span class="op" id="7979113">==</span>&nbsp;<span class="string" id="7979116">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7979122">&amp;&amp;</span>&nbsp;<span class="op" id="7979125">!</span><span class="ident" id="7979126">supportsIPv4</span>&nbsp;<span class="op" id="7979139">&amp;&amp;</span>&nbsp;<span class="op" id="7979142">!</span><span class="ident" id="7979143">supportsIPv6</span>&nbsp;<span class="op" id="7979156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979161">t</span><span class="op" id="7979162">.</span><span class="ident" id="7979163">Logf</span><span class="op" id="7979167">(</span><span class="string" id="7979168">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7979221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979237">}</span>&nbsp;<span class="keyword" id="7979239">else</span>&nbsp;<span class="keyword" id="7979244">if</span>&nbsp;<span class="ident" id="7979247">network</span>&nbsp;<span class="op" id="7979255">==</span>&nbsp;<span class="string" id="7979258">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="7979265">&amp;&amp;</span>&nbsp;<span class="op" id="7979268">!</span><span class="ident" id="7979269">supportsIPv4</span>&nbsp;<span class="op" id="7979282">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979287">t</span><span class="op" id="7979288">.</span><span class="ident" id="7979289">Logf</span><span class="op" id="7979293">(</span><span class="string" id="7979294">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7979332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979337">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979348">}</span>&nbsp;<span class="keyword" id="7979350">else</span>&nbsp;<span class="keyword" id="7979355">if</span>&nbsp;<span class="ident" id="7979358">network</span>&nbsp;<span class="op" id="7979366">==</span>&nbsp;<span class="string" id="7979369">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7979376">&amp;&amp;</span>&nbsp;<span class="op" id="7979379">!</span><span class="ident" id="7979380">supportsIPv6</span>&nbsp;<span class="op" id="7979393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979398">t</span><span class="op" id="7979399">.</span><span class="ident" id="7979400">Logf</span><span class="op" id="7979404">(</span><span class="string" id="7979405">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7979443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979448">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979459">}</span>&nbsp;<span class="keyword" id="7979461">else</span>&nbsp;<span class="keyword" id="7979466">if</span>&nbsp;<span class="ident" id="7979469">network</span>&nbsp;<span class="op" id="7979477">==</span>&nbsp;<span class="string" id="7979480">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7979487">&amp;&amp;</span>&nbsp;<span class="op" id="7979490">!</span><span class="op" id="7979491">*</span><span class="ident" id="7979492">testIPv6</span>&nbsp;<span class="op" id="7979501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979506">t</span><span class="op" id="7979507">.</span><span class="ident" id="7979508">Logf</span><span class="op" id="7979512">(</span><span class="string" id="7979513">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7979549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979554">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7979569">if</span>&nbsp;<span class="ident" id="7979572">c</span><span class="op" id="7979573">,</span>&nbsp;<span class="ident" id="7979575">err</span>&nbsp;<span class="op" id="7979579">:=</span>&nbsp;<span class="ident" id="7979582">d</span><span class="op" id="7979583">.</span><span class="ident" id="7979584">Dial</span><span class="op" id="7979588">(</span><span class="ident" id="7979589">network</span><span class="op" id="7979596">,</span>&nbsp;<span class="string" id="7979598">&#34;www.google.com:http&#34;</span><span class="op" id="7979619">)</span><span class="op" id="7979620">;</span>&nbsp;<span class="ident" id="7979622">err</span>&nbsp;<span class="op" id="7979626">!=</span>&nbsp;<span class="ident" id="7979629">nil</span>&nbsp;<span class="op" id="7979633">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979638">t</span><span class="op" id="7979639">.</span><span class="ident" id="7979640">Errorf</span><span class="op" id="7979646">(</span><span class="string" id="7979647">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7979664">,</span>&nbsp;<span class="ident" id="7979666">err</span><span class="op" id="7979669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979673">}</span>&nbsp;<span class="keyword" id="7979675">else</span>&nbsp;<span class="op" id="7979680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979685">c</span><span class="op" id="7979686">.</span><span class="ident" id="7979687">Close</span><span class="op" id="7979692">(</span><span class="op" id="7979693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7979700">}</span><br>
<span class="lineno">70</span><span class="op" id="7979702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7979705">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="7979761">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="7979815">func</span>&nbsp;<span class="ident" id="7979820">fetchGoogle</span><span class="op" id="7979831">(</span><span class="ident" id="7979832">t</span>&nbsp;<span class="op" id="7979834">*</span><span class="ident" id="7979835">testing</span><span class="op" id="7979842">.</span><span class="ident" id="7979843">T</span><span class="op" id="7979844">,</span>&nbsp;<span class="ident" id="7979846">fd</span>&nbsp;<span class="ident" id="7979849">Conn</span><span class="op" id="7979853">,</span>&nbsp;<span class="ident" id="7979855">network</span><span class="op" id="7979862">,</span>&nbsp;<span class="ident" id="7979864">addr</span>&nbsp;<span class="builtintype" id="7979869">string</span><span class="op" id="7979875">)</span>&nbsp;<span class="op" id="7979877">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979880">req</span>&nbsp;<span class="op" id="7979884">:=</span>&nbsp;<span class="op" id="7979887">[</span><span class="op" id="7979888">]</span><span class="builtintype" id="7979889">byte</span><span class="op" id="7979893">(</span><span class="string" id="7979894">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="7979952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979955">n</span><span class="op" id="7979956">,</span>&nbsp;<span class="ident" id="7979958">err</span>&nbsp;<span class="op" id="7979962">:=</span>&nbsp;<span class="ident" id="7979965">fd</span><span class="op" id="7979967">.</span><span class="ident" id="7979968">Write</span><span class="op" id="7979973">(</span><span class="ident" id="7979974">req</span><span class="op" id="7979977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7979981">buf</span>&nbsp;<span class="op" id="7979985">:=</span>&nbsp;<span class="builtinfunc" id="7979988">make</span><span class="op" id="7979992">(</span><span class="op" id="7979993">[</span><span class="op" id="7979994">]</span><span class="builtintype" id="7979995">byte</span><span class="op" id="7979999">,</span>&nbsp;<span class="num" id="7980001">1000</span><span class="op" id="7980005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980008">n</span><span class="op" id="7980009">,</span>&nbsp;<span class="ident" id="7980011">err</span>&nbsp;<span class="op" id="7980015">=</span>&nbsp;<span class="ident" id="7980017">io</span><span class="op" id="7980019">.</span><span class="ident" id="7980020">ReadFull</span><span class="op" id="7980028">(</span><span class="ident" id="7980029">fd</span><span class="op" id="7980031">,</span>&nbsp;<span class="ident" id="7980033">buf</span><span class="op" id="7980036">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980040">if</span>&nbsp;<span class="ident" id="7980043">n</span>&nbsp;<span class="op" id="7980045">&lt;</span>&nbsp;<span class="num" id="7980047">1000</span>&nbsp;<span class="op" id="7980052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980056">t</span><span class="op" id="7980057">.</span><span class="ident" id="7980058">Errorf</span><span class="op" id="7980064">(</span><span class="string" id="7980065">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="7980111">,</span>&nbsp;<span class="ident" id="7980113">network</span><span class="op" id="7980120">,</span>&nbsp;<span class="ident" id="7980122">addr</span><span class="op" id="7980126">,</span>&nbsp;<span class="ident" id="7980128">err</span><span class="op" id="7980131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980135">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7980143">}</span><br>
<span class="lineno">85</span><span class="op" id="7980145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980148">func</span>&nbsp;<span class="ident" id="7980153">doDial</span><span class="op" id="7980159">(</span><span class="ident" id="7980160">t</span>&nbsp;<span class="op" id="7980162">*</span><span class="ident" id="7980163">testing</span><span class="op" id="7980170">.</span><span class="ident" id="7980171">T</span><span class="op" id="7980172">,</span>&nbsp;<span class="ident" id="7980174">network</span><span class="op" id="7980181">,</span>&nbsp;<span class="ident" id="7980183">addr</span>&nbsp;<span class="builtintype" id="7980188">string</span><span class="op" id="7980194">)</span>&nbsp;<span class="op" id="7980196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980199">fd</span><span class="op" id="7980201">,</span>&nbsp;<span class="ident" id="7980203">err</span>&nbsp;<span class="op" id="7980207">:=</span>&nbsp;<span class="ident" id="7980210">Dial</span><span class="op" id="7980214">(</span><span class="ident" id="7980215">network</span><span class="op" id="7980222">,</span>&nbsp;<span class="ident" id="7980224">addr</span><span class="op" id="7980228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980231">if</span>&nbsp;<span class="ident" id="7980234">err</span>&nbsp;<span class="op" id="7980238">!=</span>&nbsp;<span class="ident" id="7980241">nil</span>&nbsp;<span class="op" id="7980245">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980249">t</span><span class="op" id="7980250">.</span><span class="ident" id="7980251">Errorf</span><span class="op" id="7980257">(</span><span class="string" id="7980258">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7980284">,</span>&nbsp;<span class="ident" id="7980286">network</span><span class="op" id="7980293">,</span>&nbsp;<span class="string" id="7980295">&#34;&#34;</span><span class="op" id="7980297">,</span>&nbsp;<span class="ident" id="7980299">addr</span><span class="op" id="7980303">,</span>&nbsp;<span class="ident" id="7980305">err</span><span class="op" id="7980308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7980320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980323">fetchGoogle</span><span class="op" id="7980334">(</span><span class="ident" id="7980335">t</span><span class="op" id="7980336">,</span>&nbsp;<span class="ident" id="7980338">fd</span><span class="op" id="7980340">,</span>&nbsp;<span class="ident" id="7980342">network</span><span class="op" id="7980349">,</span>&nbsp;<span class="ident" id="7980351">addr</span><span class="op" id="7980355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980358">fd</span><span class="op" id="7980360">.</span><span class="ident" id="7980361">Close</span><span class="op" id="7980366">(</span><span class="op" id="7980367">)</span><br>
<span class="lineno">95</span><span class="op" id="7980369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980372">var</span>&nbsp;<span class="ident" id="7980376">googleaddrsipv4</span>&nbsp;<span class="op" id="7980392">=</span>&nbsp;<span class="op" id="7980394">[</span><span class="op" id="7980395">]</span><span class="builtintype" id="7980396">string</span><span class="op" id="7980402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980405">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="7980421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980424">&#34;www.google.com:80&#34;</span><span class="op" id="7980443">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980446">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="7980464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980467">&#34;www.google.com:http&#34;</span><span class="op" id="7980488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980491">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="7980517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980520">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7980545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980548">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7980579">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980582">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7980618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980621">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7980659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980662">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7980694">,</span><br>
<span class="lineno"></span><span class="op" id="7980696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7980699">func</span>&nbsp;<span class="ident" id="7980704">TestDialGoogleIPv4</span><span class="op" id="7980722">(</span><span class="ident" id="7980723">t</span>&nbsp;<span class="op" id="7980725">*</span><span class="ident" id="7980726">testing</span><span class="op" id="7980733">.</span><span class="ident" id="7980734">T</span><span class="op" id="7980735">)</span>&nbsp;<span class="op" id="7980737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980740">if</span>&nbsp;<span class="ident" id="7980743">testing</span><span class="op" id="7980750">.</span><span class="ident" id="7980751">Short</span><span class="op" id="7980756">(</span><span class="op" id="7980757">)</span>&nbsp;<span class="op" id="7980759">||</span>&nbsp;<span class="op" id="7980762">!</span><span class="op" id="7980763">*</span><span class="ident" id="7980764">testExternal</span>&nbsp;<span class="op" id="7980777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980781">t</span><span class="op" id="7980782">.</span><span class="ident" id="7980783">Skip</span><span class="op" id="7980787">(</span><span class="string" id="7980788">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7980829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7980832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7980836">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7980885">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980905">addrs</span><span class="op" id="7980910">,</span>&nbsp;<span class="ident" id="7980912">err</span>&nbsp;<span class="op" id="7980916">:=</span>&nbsp;<span class="ident" id="7980919">LookupIP</span><span class="op" id="7980927">(</span><span class="string" id="7980928">&#34;www.google.com&#34;</span><span class="op" id="7980944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7980947">if</span>&nbsp;<span class="ident" id="7980950">err</span>&nbsp;<span class="op" id="7980954">!=</span>&nbsp;<span class="ident" id="7980957">nil</span>&nbsp;<span class="op" id="7980961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7980965">t</span><span class="op" id="7980966">.</span><span class="ident" id="7980967">Fatalf</span><span class="op" id="7980973">(</span><span class="string" id="7980974">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="7981001">,</span>&nbsp;<span class="ident" id="7981003">err</span><span class="op" id="7981006">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981012">var</span>&nbsp;<span class="ident" id="7981016">ip</span>&nbsp;<span class="ident" id="7981019">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981023">for</span>&nbsp;<span class="ident" id="7981027">_</span><span class="op" id="7981028">,</span>&nbsp;<span class="ident" id="7981030">addr</span>&nbsp;<span class="op" id="7981035">:=</span>&nbsp;<span class="keyword" id="7981038">range</span>&nbsp;<span class="ident" id="7981044">addrs</span>&nbsp;<span class="op" id="7981050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981054">if</span>&nbsp;<span class="ident" id="7981057">x</span>&nbsp;<span class="op" id="7981059">:=</span>&nbsp;<span class="ident" id="7981062">addr</span><span class="op" id="7981066">.</span><span class="ident" id="7981067">To4</span><span class="op" id="7981070">(</span><span class="op" id="7981071">)</span><span class="op" id="7981072">;</span>&nbsp;<span class="ident" id="7981074">x</span>&nbsp;<span class="op" id="7981076">!=</span>&nbsp;<span class="ident" id="7981079">nil</span>&nbsp;<span class="op" id="7981083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981088">ip</span>&nbsp;<span class="op" id="7981091">=</span>&nbsp;<span class="ident" id="7981093">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981098">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981112">if</span>&nbsp;<span class="ident" id="7981115">ip</span>&nbsp;<span class="op" id="7981118">==</span>&nbsp;<span class="ident" id="7981121">nil</span>&nbsp;<span class="op" id="7981125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981129">t</span><span class="op" id="7981130">.</span><span class="ident" id="7981131">Fatalf</span><span class="op" id="7981137">(</span><span class="string" id="7981138">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="7981176">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981183">for</span>&nbsp;<span class="ident" id="7981187">i</span><span class="op" id="7981188">,</span>&nbsp;<span class="ident" id="7981190">s</span>&nbsp;<span class="op" id="7981192">:=</span>&nbsp;<span class="keyword" id="7981195">range</span>&nbsp;<span class="ident" id="7981201">googleaddrsipv4</span>&nbsp;<span class="op" id="7981217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981221">if</span>&nbsp;<span class="ident" id="7981224">strings</span><span class="op" id="7981231">.</span><span class="ident" id="7981232">Contains</span><span class="op" id="7981240">(</span><span class="ident" id="7981241">s</span><span class="op" id="7981242">,</span>&nbsp;<span class="string" id="7981244">&#34;%&#34;</span><span class="op" id="7981247">)</span>&nbsp;<span class="op" id="7981249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981254">googleaddrsipv4</span><span class="op" id="7981269">[</span><span class="ident" id="7981270">i</span><span class="op" id="7981271">]</span>&nbsp;<span class="op" id="7981273">=</span>&nbsp;<span class="ident" id="7981275">fmt</span><span class="op" id="7981278">.</span><span class="ident" id="7981279">Sprintf</span><span class="op" id="7981286">(</span><span class="ident" id="7981287">s</span><span class="op" id="7981288">,</span>&nbsp;<span class="ident" id="7981290">ip</span><span class="op" id="7981292">[</span><span class="num" id="7981293">0</span><span class="op" id="7981294">]</span><span class="op" id="7981295">,</span>&nbsp;<span class="ident" id="7981297">ip</span><span class="op" id="7981299">[</span><span class="num" id="7981300">1</span><span class="op" id="7981301">]</span><span class="op" id="7981302">,</span>&nbsp;<span class="ident" id="7981304">ip</span><span class="op" id="7981306">[</span><span class="num" id="7981307">2</span><span class="op" id="7981308">]</span><span class="op" id="7981309">,</span>&nbsp;<span class="ident" id="7981311">ip</span><span class="op" id="7981313">[</span><span class="num" id="7981314">3</span><span class="op" id="7981315">]</span><span class="op" id="7981316">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981327">for</span>&nbsp;<span class="ident" id="7981331">i</span>&nbsp;<span class="op" id="7981333">:=</span>&nbsp;<span class="num" id="7981336">0</span><span class="op" id="7981337">;</span>&nbsp;<span class="ident" id="7981339">i</span>&nbsp;<span class="op" id="7981341">&lt;</span>&nbsp;<span class="builtinfunc" id="7981343">len</span><span class="op" id="7981346">(</span><span class="ident" id="7981347">googleaddrsipv4</span><span class="op" id="7981362">)</span><span class="op" id="7981363">;</span>&nbsp;<span class="ident" id="7981365">i</span><span class="op" id="7981366">++</span>&nbsp;<span class="op" id="7981369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981373">addr</span>&nbsp;<span class="op" id="7981378">:=</span>&nbsp;<span class="ident" id="7981381">googleaddrsipv4</span><span class="op" id="7981396">[</span><span class="ident" id="7981397">i</span><span class="op" id="7981398">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981402">if</span>&nbsp;<span class="ident" id="7981405">addr</span>&nbsp;<span class="op" id="7981410">==</span>&nbsp;<span class="string" id="7981413">&#34;&#34;</span>&nbsp;<span class="op" id="7981416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981421">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981436">t</span><span class="op" id="7981437">.</span><span class="ident" id="7981438">Logf</span><span class="op" id="7981442">(</span><span class="string" id="7981443">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7981453">,</span>&nbsp;<span class="ident" id="7981455">addr</span><span class="op" id="7981459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981463">doDial</span><span class="op" id="7981469">(</span><span class="ident" id="7981470">t</span><span class="op" id="7981471">,</span>&nbsp;<span class="string" id="7981473">&#34;tcp&#34;</span><span class="op" id="7981478">,</span>&nbsp;<span class="ident" id="7981480">addr</span><span class="op" id="7981484">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981488">if</span>&nbsp;<span class="ident" id="7981491">addr</span><span class="op" id="7981495">[</span><span class="num" id="7981496">0</span><span class="op" id="7981497">]</span>&nbsp;<span class="op" id="7981499">!=</span>&nbsp;<span class="string" id="7981502">&#39;[&#39;</span>&nbsp;<span class="op" id="7981506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981511">doDial</span><span class="op" id="7981517">(</span><span class="ident" id="7981518">t</span><span class="op" id="7981519">,</span>&nbsp;<span class="string" id="7981521">&#34;tcp4&#34;</span><span class="op" id="7981527">,</span>&nbsp;<span class="ident" id="7981529">addr</span><span class="op" id="7981533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7981538">if</span>&nbsp;<span class="ident" id="7981541">supportsIPv6</span>&nbsp;<span class="op" id="7981554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7981560">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981615">syscall</span><span class="op" id="7981622">.</span><span class="ident" id="7981623">SocketDisableIPv6</span>&nbsp;<span class="op" id="7981641">=</span>&nbsp;<span class="builtintype" id="7981643">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981652">doDial</span><span class="op" id="7981658">(</span><span class="ident" id="7981659">t</span><span class="op" id="7981660">,</span>&nbsp;<span class="string" id="7981662">&#34;tcp&#34;</span><span class="op" id="7981667">,</span>&nbsp;<span class="ident" id="7981669">addr</span><span class="op" id="7981673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981679">doDial</span><span class="op" id="7981685">(</span><span class="ident" id="7981686">t</span><span class="op" id="7981687">,</span>&nbsp;<span class="string" id="7981689">&#34;tcp4&#34;</span><span class="op" id="7981695">,</span>&nbsp;<span class="ident" id="7981697">addr</span><span class="op" id="7981701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981707">syscall</span><span class="op" id="7981714">.</span><span class="ident" id="7981715">SocketDisableIPv6</span>&nbsp;<span class="op" id="7981733">=</span>&nbsp;<span class="builtintype" id="7981735">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981748">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7981751">}</span><br>
<span class="lineno"></span><span class="op" id="7981753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7981756">var</span>&nbsp;<span class="ident" id="7981760">googleaddrsipv6</span>&nbsp;<span class="op" id="7981776">=</span>&nbsp;<span class="op" id="7981778">[</span><span class="op" id="7981779">]</span><span class="builtintype" id="7981780">string</span><span class="op" id="7981786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981789">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7981867">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981870">&#34;ipv6.google.com:80&#34;</span><span class="op" id="7981890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981893">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="7981973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981976">&#34;ipv6.google.com:http&#34;</span><span class="op" id="7981998">,</span><br>
<span class="lineno"></span><span class="op" id="7982000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7982003">func</span>&nbsp;<span class="ident" id="7982008">TestDialGoogleIPv6</span><span class="op" id="7982026">(</span><span class="ident" id="7982027">t</span>&nbsp;<span class="op" id="7982029">*</span><span class="ident" id="7982030">testing</span><span class="op" id="7982037">.</span><span class="ident" id="7982038">T</span><span class="op" id="7982039">)</span>&nbsp;<span class="op" id="7982041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982044">if</span>&nbsp;<span class="ident" id="7982047">testing</span><span class="op" id="7982054">.</span><span class="ident" id="7982055">Short</span><span class="op" id="7982060">(</span><span class="op" id="7982061">)</span>&nbsp;<span class="op" id="7982063">||</span>&nbsp;<span class="op" id="7982066">!</span><span class="op" id="7982067">*</span><span class="ident" id="7982068">testExternal</span>&nbsp;<span class="op" id="7982081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982085">t</span><span class="op" id="7982086">.</span><span class="ident" id="7982087">Skip</span><span class="op" id="7982091">(</span><span class="string" id="7982092">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7982133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7982139">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982185">if</span>&nbsp;<span class="op" id="7982188">!</span><span class="ident" id="7982189">supportsIPv6</span>&nbsp;<span class="op" id="7982202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982206">t</span><span class="op" id="7982207">.</span><span class="ident" id="7982208">Skip</span><span class="op" id="7982212">(</span><span class="string" id="7982213">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7982251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982257">if</span>&nbsp;<span class="op" id="7982260">!</span><span class="op" id="7982261">*</span><span class="ident" id="7982262">testIPv6</span>&nbsp;<span class="op" id="7982271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982275">t</span><span class="op" id="7982276">.</span><span class="ident" id="7982277">Skip</span><span class="op" id="7982281">(</span><span class="string" id="7982282">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7982318">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7982325">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7982379">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982399">addrs</span><span class="op" id="7982404">,</span>&nbsp;<span class="ident" id="7982406">err</span>&nbsp;<span class="op" id="7982410">:=</span>&nbsp;<span class="ident" id="7982413">LookupIP</span><span class="op" id="7982421">(</span><span class="string" id="7982422">&#34;ipv6.google.com&#34;</span><span class="op" id="7982439">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982442">if</span>&nbsp;<span class="ident" id="7982445">err</span>&nbsp;<span class="op" id="7982449">!=</span>&nbsp;<span class="ident" id="7982452">nil</span>&nbsp;<span class="op" id="7982456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982460">t</span><span class="op" id="7982461">.</span><span class="ident" id="7982462">Fatalf</span><span class="op" id="7982468">(</span><span class="string" id="7982469">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="7982497">,</span>&nbsp;<span class="ident" id="7982499">err</span><span class="op" id="7982502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982508">var</span>&nbsp;<span class="ident" id="7982512">ip</span>&nbsp;<span class="ident" id="7982515">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982519">for</span>&nbsp;<span class="ident" id="7982523">_</span><span class="op" id="7982524">,</span>&nbsp;<span class="ident" id="7982526">addr</span>&nbsp;<span class="op" id="7982531">:=</span>&nbsp;<span class="keyword" id="7982534">range</span>&nbsp;<span class="ident" id="7982540">addrs</span>&nbsp;<span class="op" id="7982546">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982550">if</span>&nbsp;<span class="ident" id="7982553">x</span>&nbsp;<span class="op" id="7982555">:=</span>&nbsp;<span class="ident" id="7982558">addr</span><span class="op" id="7982562">.</span><span class="ident" id="7982563">To16</span><span class="op" id="7982567">(</span><span class="op" id="7982568">)</span><span class="op" id="7982569">;</span>&nbsp;<span class="ident" id="7982571">x</span>&nbsp;<span class="op" id="7982573">!=</span>&nbsp;<span class="ident" id="7982576">nil</span>&nbsp;<span class="op" id="7982580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982585">ip</span>&nbsp;<span class="op" id="7982588">=</span>&nbsp;<span class="ident" id="7982590">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982595">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982606">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982609">if</span>&nbsp;<span class="ident" id="7982612">ip</span>&nbsp;<span class="op" id="7982615">==</span>&nbsp;<span class="ident" id="7982618">nil</span>&nbsp;<span class="op" id="7982622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982626">t</span><span class="op" id="7982627">.</span><span class="ident" id="7982628">Fatalf</span><span class="op" id="7982634">(</span><span class="string" id="7982635">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="7982674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982681">for</span>&nbsp;<span class="ident" id="7982685">i</span><span class="op" id="7982686">,</span>&nbsp;<span class="ident" id="7982688">s</span>&nbsp;<span class="op" id="7982690">:=</span>&nbsp;<span class="keyword" id="7982693">range</span>&nbsp;<span class="ident" id="7982699">googleaddrsipv6</span>&nbsp;<span class="op" id="7982715">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982719">if</span>&nbsp;<span class="ident" id="7982722">strings</span><span class="op" id="7982729">.</span><span class="ident" id="7982730">Contains</span><span class="op" id="7982738">(</span><span class="ident" id="7982739">s</span><span class="op" id="7982740">,</span>&nbsp;<span class="string" id="7982742">&#34;%&#34;</span><span class="op" id="7982745">)</span>&nbsp;<span class="op" id="7982747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982752">googleaddrsipv6</span><span class="op" id="7982767">[</span><span class="ident" id="7982768">i</span><span class="op" id="7982769">]</span>&nbsp;<span class="op" id="7982771">=</span>&nbsp;<span class="ident" id="7982773">fmt</span><span class="op" id="7982776">.</span><span class="ident" id="7982777">Sprintf</span><span class="op" id="7982784">(</span><span class="ident" id="7982785">s</span><span class="op" id="7982786">,</span>&nbsp;<span class="ident" id="7982788">ip</span><span class="op" id="7982790">[</span><span class="num" id="7982791">0</span><span class="op" id="7982792">]</span><span class="op" id="7982793">,</span>&nbsp;<span class="ident" id="7982795">ip</span><span class="op" id="7982797">[</span><span class="num" id="7982798">1</span><span class="op" id="7982799">]</span><span class="op" id="7982800">,</span>&nbsp;<span class="ident" id="7982802">ip</span><span class="op" id="7982804">[</span><span class="num" id="7982805">2</span><span class="op" id="7982806">]</span><span class="op" id="7982807">,</span>&nbsp;<span class="ident" id="7982809">ip</span><span class="op" id="7982811">[</span><span class="num" id="7982812">3</span><span class="op" id="7982813">]</span><span class="op" id="7982814">,</span>&nbsp;<span class="ident" id="7982816">ip</span><span class="op" id="7982818">[</span><span class="num" id="7982819">4</span><span class="op" id="7982820">]</span><span class="op" id="7982821">,</span>&nbsp;<span class="ident" id="7982823">ip</span><span class="op" id="7982825">[</span><span class="num" id="7982826">5</span><span class="op" id="7982827">]</span><span class="op" id="7982828">,</span>&nbsp;<span class="ident" id="7982830">ip</span><span class="op" id="7982832">[</span><span class="num" id="7982833">6</span><span class="op" id="7982834">]</span><span class="op" id="7982835">,</span>&nbsp;<span class="ident" id="7982837">ip</span><span class="op" id="7982839">[</span><span class="num" id="7982840">7</span><span class="op" id="7982841">]</span><span class="op" id="7982842">,</span>&nbsp;<span class="ident" id="7982844">ip</span><span class="op" id="7982846">[</span><span class="num" id="7982847">8</span><span class="op" id="7982848">]</span><span class="op" id="7982849">,</span>&nbsp;<span class="ident" id="7982851">ip</span><span class="op" id="7982853">[</span><span class="num" id="7982854">9</span><span class="op" id="7982855">]</span><span class="op" id="7982856">,</span>&nbsp;<span class="ident" id="7982858">ip</span><span class="op" id="7982860">[</span><span class="num" id="7982861">10</span><span class="op" id="7982863">]</span><span class="op" id="7982864">,</span>&nbsp;<span class="ident" id="7982866">ip</span><span class="op" id="7982868">[</span><span class="num" id="7982869">11</span><span class="op" id="7982871">]</span><span class="op" id="7982872">,</span>&nbsp;<span class="ident" id="7982874">ip</span><span class="op" id="7982876">[</span><span class="num" id="7982877">12</span><span class="op" id="7982879">]</span><span class="op" id="7982880">,</span>&nbsp;<span class="ident" id="7982882">ip</span><span class="op" id="7982884">[</span><span class="num" id="7982885">13</span><span class="op" id="7982887">]</span><span class="op" id="7982888">,</span>&nbsp;<span class="ident" id="7982890">ip</span><span class="op" id="7982892">[</span><span class="num" id="7982893">14</span><span class="op" id="7982895">]</span><span class="op" id="7982896">,</span>&nbsp;<span class="ident" id="7982898">ip</span><span class="op" id="7982900">[</span><span class="num" id="7982901">15</span><span class="op" id="7982903">]</span><span class="op" id="7982904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7982911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982915">for</span>&nbsp;<span class="ident" id="7982919">i</span>&nbsp;<span class="op" id="7982921">:=</span>&nbsp;<span class="num" id="7982924">0</span><span class="op" id="7982925">;</span>&nbsp;<span class="ident" id="7982927">i</span>&nbsp;<span class="op" id="7982929">&lt;</span>&nbsp;<span class="builtinfunc" id="7982931">len</span><span class="op" id="7982934">(</span><span class="ident" id="7982935">googleaddrsipv6</span><span class="op" id="7982950">)</span><span class="op" id="7982951">;</span>&nbsp;<span class="ident" id="7982953">i</span><span class="op" id="7982954">++</span>&nbsp;<span class="op" id="7982957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7982961">addr</span>&nbsp;<span class="op" id="7982966">:=</span>&nbsp;<span class="ident" id="7982969">googleaddrsipv6</span><span class="op" id="7982984">[</span><span class="ident" id="7982985">i</span><span class="op" id="7982986">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7982990">if</span>&nbsp;<span class="ident" id="7982993">addr</span>&nbsp;<span class="op" id="7982998">==</span>&nbsp;<span class="string" id="7983001">&#34;&#34;</span>&nbsp;<span class="op" id="7983004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7983009">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7983020">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7983024">t</span><span class="op" id="7983025">.</span><span class="ident" id="7983026">Logf</span><span class="op" id="7983030">(</span><span class="string" id="7983031">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7983041">,</span>&nbsp;<span class="ident" id="7983043">addr</span><span class="op" id="7983047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7983051">doDial</span><span class="op" id="7983057">(</span><span class="ident" id="7983058">t</span><span class="op" id="7983059">,</span>&nbsp;<span class="string" id="7983061">&#34;tcp&#34;</span><span class="op" id="7983066">,</span>&nbsp;<span class="ident" id="7983068">addr</span><span class="op" id="7983072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7983076">doDial</span><span class="op" id="7983082">(</span><span class="ident" id="7983083">t</span><span class="op" id="7983084">,</span>&nbsp;<span class="string" id="7983086">&#34;tcp6&#34;</span><span class="op" id="7983092">,</span>&nbsp;<span class="ident" id="7983094">addr</span><span class="op" id="7983098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7983101">}</span><br>
<span class="lineno"></span><span class="op" id="7983103">}</span>
</div>
</body>
</html>
