<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html" class="current">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1636880">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1636935">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1636989">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1637040">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1637118">package</span>&nbsp;<span class="ident" id="1637126">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1637135">import</span>&nbsp;<span class="string" id="1637142">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1637152">//&nbsp;Integrated&nbsp;network&nbsp;poller&nbsp;(platform-independent&nbsp;part).</span><br>
<span class="lineno"></span><span class="comment" id="1637210">//&nbsp;A&nbsp;particular&nbsp;implementation&nbsp;(epoll/kqueue)&nbsp;must&nbsp;define&nbsp;the&nbsp;following&nbsp;functions:</span><br>
<span class="lineno"></span><span class="comment" id="1637293">//&nbsp;func&nbsp;netpollinit()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;to&nbsp;initialize&nbsp;the&nbsp;poller</span><br>
<span class="lineno"></span><span class="comment" id="1637345">//&nbsp;func&nbsp;netpollopen(fd&nbsp;uintptr,&nbsp;pd&nbsp;*pollDesc)&nbsp;int32&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;to&nbsp;arm&nbsp;edge-triggered&nbsp;notifications</span><br>
<span class="lineno">15</span><span class="comment" id="1637436">//&nbsp;and&nbsp;associate&nbsp;fd&nbsp;with&nbsp;pd.</span><br>
<span class="lineno"></span><span class="comment" id="1637465">//&nbsp;An&nbsp;implementation&nbsp;must&nbsp;call&nbsp;the&nbsp;following&nbsp;function&nbsp;to&nbsp;denote&nbsp;that&nbsp;the&nbsp;pd&nbsp;is&nbsp;ready.</span><br>
<span class="lineno"></span><span class="comment" id="1637551">//&nbsp;func&nbsp;netpollready(gpp&nbsp;**g,&nbsp;pd&nbsp;*pollDesc,&nbsp;mode&nbsp;int32)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637608">//&nbsp;pollDesc&nbsp;contains&nbsp;2&nbsp;binary&nbsp;semaphores,&nbsp;rg&nbsp;and&nbsp;wg,&nbsp;to&nbsp;park&nbsp;reader&nbsp;and&nbsp;writer</span><br>
<span class="lineno">20</span><span class="comment" id="1637687">//&nbsp;goroutines&nbsp;respectively.&nbsp;The&nbsp;semaphore&nbsp;can&nbsp;be&nbsp;in&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno"></span><span class="comment" id="1637761">//&nbsp;pdReady&nbsp;-&nbsp;io&nbsp;readiness&nbsp;notification&nbsp;is&nbsp;pending;</span><br>
<span class="lineno"></span><span class="comment" id="1637812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;goroutine&nbsp;consumes&nbsp;the&nbsp;notification&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1637893">//&nbsp;pdWait&nbsp;-&nbsp;a&nbsp;goroutine&nbsp;prepares&nbsp;to&nbsp;park&nbsp;on&nbsp;the&nbsp;semaphore,&nbsp;but&nbsp;not&nbsp;yet&nbsp;parked;</span><br>
<span class="lineno"></span><span class="comment" id="1637972">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;goroutine&nbsp;commits&nbsp;to&nbsp;park&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;G&nbsp;pointer,</span><br>
<span class="lineno">25</span><span class="comment" id="1638050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;io&nbsp;notification&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY,</span><br>
<span class="lineno"></span><span class="comment" id="1638136">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1638218">//&nbsp;G&nbsp;pointer&nbsp;-&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;blocked&nbsp;on&nbsp;the&nbsp;semaphore;</span><br>
<span class="lineno"></span><span class="comment" id="1638276">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;notification&nbsp;or&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY&nbsp;or&nbsp;nil&nbsp;respectively</span><br>
<span class="lineno"></span><span class="comment" id="1638371">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;unparks&nbsp;the&nbsp;goroutine.</span><br>
<span class="lineno">30</span><span class="comment" id="1638413">//&nbsp;nil&nbsp;-&nbsp;nothing&nbsp;of&nbsp;the&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="1638444">const</span>&nbsp;<span class="op" id="1638450">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1638453">pdReady</span>&nbsp;<span class="builtintype" id="1638461">uintptr</span>&nbsp;<span class="op" id="1638469">=</span>&nbsp;<span class="num" id="1638471">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1638474">pdWait</span>&nbsp;&nbsp;<span class="builtintype" id="1638482">uintptr</span>&nbsp;<span class="op" id="1638490">=</span>&nbsp;<span class="num" id="1638492">2</span><br>
<span class="lineno"></span><span class="op" id="1638494">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="1638497">const</span>&nbsp;<span class="ident" id="1638503">pollBlockSize</span>&nbsp;<span class="op" id="1638517">=</span>&nbsp;<span class="num" id="1638519">4</span>&nbsp;<span class="op" id="1638521">*</span>&nbsp;<span class="num" id="1638523">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638529">//&nbsp;Network&nbsp;poller&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="1638559">type</span>&nbsp;<span class="ident" id="1638564">pollDesc</span>&nbsp;<span class="keyword" id="1638573">struct</span>&nbsp;<span class="op" id="1638580">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1638583">link</span>&nbsp;<span class="op" id="1638588">*</span><span class="ident" id="1638589"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span>&nbsp;<span class="comment" id="1638598">//&nbsp;in&nbsp;pollcache,&nbsp;protected&nbsp;by&nbsp;pollcache.lock</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1638645">//&nbsp;The&nbsp;lock&nbsp;protects&nbsp;pollOpen,&nbsp;pollSetDeadline,&nbsp;pollUnblock&nbsp;and&nbsp;deadlineimpl&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1638735">//&nbsp;This&nbsp;fully&nbsp;covers&nbsp;seq,&nbsp;rt&nbsp;and&nbsp;wt&nbsp;variables.&nbsp;fd&nbsp;is&nbsp;constant&nbsp;throughout&nbsp;the&nbsp;PollDesc&nbsp;lifetime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1638832">//&nbsp;pollReset,&nbsp;pollWait,&nbsp;pollWaitCanceled&nbsp;and&nbsp;runtimeÂ·netpollready&nbsp;(IO&nbsp;readiness&nbsp;notification)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1638928">//&nbsp;proceed&nbsp;w/o&nbsp;taking&nbsp;the&nbsp;lock.&nbsp;So&nbsp;closing,&nbsp;rg,&nbsp;rd,&nbsp;wg&nbsp;and&nbsp;wd&nbsp;are&nbsp;manipulated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639007">//&nbsp;in&nbsp;a&nbsp;lock-free&nbsp;way&nbsp;by&nbsp;all&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639049">//&nbsp;NOTE(dvyukov):&nbsp;the&nbsp;following&nbsp;code&nbsp;uses&nbsp;uintptr&nbsp;to&nbsp;store&nbsp;*g&nbsp;(rg/wg),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639121">//&nbsp;that&nbsp;will&nbsp;blow&nbsp;up&nbsp;when&nbsp;GC&nbsp;starts&nbsp;moving&nbsp;objects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639174">lock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639182"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span>&nbsp;<span class="comment" id="1639188">//&nbsp;protectes&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639223">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639231">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639240">closing</span>&nbsp;<span class="builtintype" id="1639248">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639254">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639262">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639277">//&nbsp;protects&nbsp;from&nbsp;stale&nbsp;timers&nbsp;and&nbsp;ready&nbsp;notifications</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639332">rg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639340">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639355">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;read&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639402">rt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639410"><a href="/gostd/runtime/time.go.html#1757223">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639425">//&nbsp;read&nbsp;deadline&nbsp;timer&nbsp;(set&nbsp;if&nbsp;rt.f&nbsp;!=&nbsp;nil)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639470">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639478">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639493">//&nbsp;read&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639511">wg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639519">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639534">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;write&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639582">wt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639590"><a href="/gostd/runtime/time.go.html#1757223">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639605">//&nbsp;write&nbsp;deadline&nbsp;timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639630">wd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1639638">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639653">//&nbsp;write&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639672">user</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639680"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1639686">.</span><span class="ident" id="1639687">Pointer</span>&nbsp;<span class="comment" id="1639695">//&nbsp;user&nbsp;settable&nbsp;cookie</span><br>
<span class="lineno">60</span><span class="op" id="1639719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1639722">type</span>&nbsp;<span class="ident" id="1639727">pollCache</span>&nbsp;<span class="keyword" id="1639737">struct</span>&nbsp;<span class="op" id="1639744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639747">lock</span>&nbsp;&nbsp;<span class="ident" id="1639753"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1639760">first</span>&nbsp;<span class="op" id="1639766">*</span><span class="ident" id="1639767"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639777">//&nbsp;PollDesc&nbsp;objects&nbsp;must&nbsp;be&nbsp;type-stable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639819">//&nbsp;because&nbsp;we&nbsp;can&nbsp;get&nbsp;ready&nbsp;notification&nbsp;from&nbsp;epoll/kqueue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639879">//&nbsp;after&nbsp;the&nbsp;descriptor&nbsp;is&nbsp;closed/reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639922">//&nbsp;Stale&nbsp;notifications&nbsp;are&nbsp;detected&nbsp;using&nbsp;seq&nbsp;variable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1639979">//&nbsp;seq&nbsp;is&nbsp;incremented&nbsp;when&nbsp;deadlines&nbsp;are&nbsp;changed&nbsp;or&nbsp;descriptor&nbsp;is&nbsp;reused.</span><br>
<span class="lineno">70</span><span class="op" id="1640053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1640056">var</span>&nbsp;<span class="ident" id="1640060">pollcache</span>&nbsp;<span class="ident" id="1640070"><a href="/gostd/runtime/netpoll.go.html#1639727">pollCache</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1640081">func</span>&nbsp;<span class="ident" id="1640086">netpollServerInit</span><span class="op" id="1640103">(</span><span class="op" id="1640104">)</span>&nbsp;<span class="op" id="1640106">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640109"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1640112">(</span><span class="ident" id="1640113"><a href="/gostd/runtime/netpoll_epoll.go.html#1649107">netpollinit</a></span><span class="op" id="1640124">)</span><br>
<span class="lineno"></span><span class="op" id="1640126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1640129">func</span>&nbsp;<span class="ident" id="1640134">netpollOpen</span><span class="op" id="1640145">(</span><span class="ident" id="1640146">fd</span>&nbsp;<span class="builtintype" id="1640149">uintptr</span><span class="op" id="1640156">)</span>&nbsp;<span class="op" id="1640158">(</span><span class="op" id="1640159">*</span><span class="ident" id="1640160"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1640168">,</span>&nbsp;<span class="builtintype" id="1640170">int</span><span class="op" id="1640173">)</span>&nbsp;<span class="op" id="1640175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640178">pd</span>&nbsp;<span class="op" id="1640181">:=</span>&nbsp;<span class="ident" id="1640184"><a href="/gostd/runtime/netpoll.go.html#1640060">pollcache</a></span><span class="op" id="1640193">.</span><span class="ident" id="1640194"><a href="/gostd/runtime/netpoll.go.html#1648062">alloc</a></span><span class="op" id="1640199">(</span><span class="op" id="1640200">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640203"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1640207">(</span><span class="op" id="1640208">&amp;</span><span class="ident" id="1640209"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640211">.</span><span class="ident" id="1640212"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1640216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640219">if</span>&nbsp;<span class="ident" id="1640222"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640224">.</span><span class="ident" id="1640225"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1640228">!=</span>&nbsp;<span class="num" id="1640231">0</span>&nbsp;<span class="op" id="1640233">&amp;&amp;</span>&nbsp;<span class="ident" id="1640236"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640238">.</span><span class="ident" id="1640239"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1640242">!=</span>&nbsp;<span class="ident" id="1640245"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1640253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640257"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1640264">(</span><span class="string" id="1640265">&#34;netpollOpen:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="1640312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640318">if</span>&nbsp;<span class="ident" id="1640321"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640323">.</span><span class="ident" id="1640324"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1640327">!=</span>&nbsp;<span class="num" id="1640330">0</span>&nbsp;<span class="op" id="1640332">&amp;&amp;</span>&nbsp;<span class="ident" id="1640335"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640337">.</span><span class="ident" id="1640338"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1640341">!=</span>&nbsp;<span class="ident" id="1640344"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1640352">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640356"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1640363">(</span><span class="string" id="1640364">&#34;netpollOpen:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="1640410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640416"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640418">.</span><span class="ident" id="1640419"><a href="/gostd/runtime/netpoll.go.html#1639223">fd</a></span>&nbsp;<span class="op" id="1640422">=</span>&nbsp;<span class="ident" id="1640424"><a href="/gostd/runtime/netpoll.go.html#1640146">fd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640428"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640430">.</span><span class="ident" id="1640431"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1640439">=</span>&nbsp;<span class="builtintype" id="1640441">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640448"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640450">.</span><span class="ident" id="1640451"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><span class="op" id="1640454">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640458"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640460">.</span><span class="ident" id="1640461"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1640464">=</span>&nbsp;<span class="num" id="1640466">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640469"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640471">.</span><span class="ident" id="1640472"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1640475">=</span>&nbsp;<span class="num" id="1640477">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640480"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640482">.</span><span class="ident" id="1640483"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1640486">=</span>&nbsp;<span class="num" id="1640488">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640491"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640493">.</span><span class="ident" id="1640494"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1640497">=</span>&nbsp;<span class="num" id="1640499">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640502"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1640508">(</span><span class="op" id="1640509">&amp;</span><span class="ident" id="1640510"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640512">.</span><span class="ident" id="1640513"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1640517">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640521">var</span>&nbsp;<span class="ident" id="1640525">errno</span>&nbsp;<span class="builtintype" id="1640531">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640538"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1640541">(</span><span class="keyword" id="1640542">func</span><span class="op" id="1640546">(</span><span class="op" id="1640547">)</span>&nbsp;<span class="op" id="1640549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640553"><a href="/gostd/runtime/netpoll.go.html#1640525">errno</a></span>&nbsp;<span class="op" id="1640559">=</span>&nbsp;<span class="ident" id="1640561"><a href="/gostd/runtime/netpoll_epoll.go.html#1649389">netpollopen</a></span><span class="op" id="1640572">(</span><span class="ident" id="1640573"><a href="/gostd/runtime/netpoll.go.html#1640146">fd</a></span><span class="op" id="1640575">,</span>&nbsp;<span class="ident" id="1640577"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640582">}</span><span class="op" id="1640583">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640586">return</span>&nbsp;<span class="ident" id="1640593"><a href="/gostd/runtime/netpoll.go.html#1640178">pd</a></span><span class="op" id="1640595">,</span>&nbsp;<span class="builtintype" id="1640597">int</span><span class="op" id="1640600">(</span><span class="ident" id="1640601"><a href="/gostd/runtime/netpoll.go.html#1640525">errno</a></span><span class="op" id="1640606">)</span><br>
<span class="lineno"></span><span class="op" id="1640608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1640611">func</span>&nbsp;<span class="ident" id="1640616">netpollClose</span><span class="op" id="1640628">(</span><span class="ident" id="1640629">pd</span>&nbsp;<span class="op" id="1640632">*</span><span class="ident" id="1640633"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1640641">)</span>&nbsp;<span class="op" id="1640643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640646">if</span>&nbsp;<span class="op" id="1640649">!</span><span class="ident" id="1640650"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640652">.</span><span class="ident" id="1640653"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1640661">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640665"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1640672">(</span><span class="string" id="1640673">&#34;netpollClose:&nbsp;close&nbsp;w/o&nbsp;unblock&#34;</span><span class="op" id="1640706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640712">if</span>&nbsp;<span class="ident" id="1640715"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640717">.</span><span class="ident" id="1640718"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1640721">!=</span>&nbsp;<span class="num" id="1640724">0</span>&nbsp;<span class="op" id="1640726">&amp;&amp;</span>&nbsp;<span class="ident" id="1640729"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640731">.</span><span class="ident" id="1640732"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1640735">!=</span>&nbsp;<span class="ident" id="1640738"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1640746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640750"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1640757">(</span><span class="string" id="1640758">&#34;netpollClose:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="1640809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640812">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1640815">if</span>&nbsp;<span class="ident" id="1640818"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640820">.</span><span class="ident" id="1640821"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1640824">!=</span>&nbsp;<span class="num" id="1640827">0</span>&nbsp;<span class="op" id="1640829">&amp;&amp;</span>&nbsp;<span class="ident" id="1640832"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640834">.</span><span class="ident" id="1640835"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1640838">!=</span>&nbsp;<span class="ident" id="1640841"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1640849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640853"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1640860">(</span><span class="string" id="1640861">&#34;netpollClose:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="1640911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640917"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1640920">(</span><span class="keyword" id="1640921">func</span><span class="op" id="1640925">(</span><span class="op" id="1640926">)</span>&nbsp;<span class="op" id="1640928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640932"><a href="/gostd/runtime/netpoll_epoll.go.html#1649623">netpollclose</a></span><span class="op" id="1640944">(</span><span class="builtintype" id="1640945">uintptr</span><span class="op" id="1640952">(</span><span class="ident" id="1640953"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640955">.</span><span class="ident" id="1640956"><a href="/gostd/runtime/netpoll.go.html#1639223">fd</a></span><span class="op" id="1640958">)</span><span class="op" id="1640959">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1640962">}</span><span class="op" id="1640963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1640966"><a href="/gostd/runtime/netpoll.go.html#1640060">pollcache</a></span><span class="op" id="1640975">.</span><span class="ident" id="1640976"><a href="/gostd/runtime/netpoll.go.html#1641008">free</a></span><span class="op" id="1640980">(</span><span class="ident" id="1640981"><a href="/gostd/runtime/netpoll.go.html#1640629">pd</a></span><span class="op" id="1640983">)</span><br>
<span class="lineno"></span><span class="op" id="1640985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1640988">func</span>&nbsp;<span class="op" id="1640993">(</span><span class="ident" id="1640994">c</span>&nbsp;<span class="op" id="1640996">*</span><span class="ident" id="1640997"><a href="/gostd/runtime/netpoll.go.html#1639727">pollCache</a></span><span class="op" id="1641006">)</span>&nbsp;<span class="ident" id="1641008">free</span><span class="op" id="1641012">(</span><span class="ident" id="1641013">pd</span>&nbsp;<span class="op" id="1641016">*</span><span class="ident" id="1641017"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1641025">)</span>&nbsp;<span class="op" id="1641027">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641030"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1641034">(</span><span class="op" id="1641035">&amp;</span><span class="ident" id="1641036"><a href="/gostd/runtime/netpoll.go.html#1640994">c</a></span><span class="op" id="1641037">.</span><span class="ident" id="1641038"><a href="/gostd/runtime/netpoll.go.html#1639747">lock</a></span><span class="op" id="1641042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641045"><a href="/gostd/runtime/netpoll.go.html#1641013">pd</a></span><span class="op" id="1641047">.</span><span class="ident" id="1641048"><a href="/gostd/runtime/netpoll.go.html#1638583">link</a></span>&nbsp;<span class="op" id="1641053">=</span>&nbsp;<span class="ident" id="1641055"><a href="/gostd/runtime/netpoll.go.html#1640994">c</a></span><span class="op" id="1641056">.</span><span class="ident" id="1641057"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641064"><a href="/gostd/runtime/netpoll.go.html#1640994">c</a></span><span class="op" id="1641065">.</span><span class="ident" id="1641066"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span>&nbsp;<span class="op" id="1641072">=</span>&nbsp;<span class="ident" id="1641074"><a href="/gostd/runtime/netpoll.go.html#1641013">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641078"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1641084">(</span><span class="op" id="1641085">&amp;</span><span class="ident" id="1641086"><a href="/gostd/runtime/netpoll.go.html#1640994">c</a></span><span class="op" id="1641087">.</span><span class="ident" id="1641088"><a href="/gostd/runtime/netpoll.go.html#1639747">lock</a></span><span class="op" id="1641092">)</span><br>
<span class="lineno"></span><span class="op" id="1641094">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1641097">func</span>&nbsp;<span class="ident" id="1641102">netpollReset</span><span class="op" id="1641114">(</span><span class="ident" id="1641115">pd</span>&nbsp;<span class="op" id="1641118">*</span><span class="ident" id="1641119"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1641127">,</span>&nbsp;<span class="ident" id="1641129">mode</span>&nbsp;<span class="builtintype" id="1641134">int</span><span class="op" id="1641137">)</span>&nbsp;<span class="builtintype" id="1641139">int</span>&nbsp;<span class="op" id="1641143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641146">err</span>&nbsp;<span class="op" id="1641150">:=</span>&nbsp;<span class="ident" id="1641153"><a href="/gostd/runtime/netpoll.go.html#1644870">netpollcheckerr</a></span><span class="op" id="1641168">(</span><span class="ident" id="1641169"><a href="/gostd/runtime/netpoll.go.html#1641115">pd</a></span><span class="op" id="1641171">,</span>&nbsp;<span class="builtintype" id="1641173">int32</span><span class="op" id="1641178">(</span><span class="ident" id="1641179"><a href="/gostd/runtime/netpoll.go.html#1641129">mode</a></span><span class="op" id="1641183">)</span><span class="op" id="1641184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641187">if</span>&nbsp;<span class="ident" id="1641190"><a href="/gostd/runtime/netpoll.go.html#1641146">err</a></span>&nbsp;<span class="op" id="1641194">!=</span>&nbsp;<span class="num" id="1641197">0</span>&nbsp;<span class="op" id="1641199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641203">return</span>&nbsp;<span class="ident" id="1641210"><a href="/gostd/runtime/netpoll.go.html#1641146">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641218">if</span>&nbsp;<span class="ident" id="1641221"><a href="/gostd/runtime/netpoll.go.html#1641129">mode</a></span>&nbsp;<span class="op" id="1641226">==</span>&nbsp;<span class="string" id="1641229">&#39;r&#39;</span>&nbsp;<span class="op" id="1641233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641237"><a href="/gostd/runtime/netpoll.go.html#1641115">pd</a></span><span class="op" id="1641239">.</span><span class="ident" id="1641240"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span>&nbsp;<span class="op" id="1641243">=</span>&nbsp;<span class="num" id="1641245">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641248">}</span>&nbsp;<span class="keyword" id="1641250">else</span>&nbsp;<span class="keyword" id="1641255">if</span>&nbsp;<span class="ident" id="1641258"><a href="/gostd/runtime/netpoll.go.html#1641129">mode</a></span>&nbsp;<span class="op" id="1641263">==</span>&nbsp;<span class="string" id="1641266">&#39;w&#39;</span>&nbsp;<span class="op" id="1641270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641274"><a href="/gostd/runtime/netpoll.go.html#1641115">pd</a></span><span class="op" id="1641276">.</span><span class="ident" id="1641277"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span>&nbsp;<span class="op" id="1641280">=</span>&nbsp;<span class="num" id="1641282">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641288">return</span>&nbsp;<span class="num" id="1641295">0</span><br>
<span class="lineno"></span><span class="op" id="1641297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641300">func</span>&nbsp;<span class="ident" id="1641305">netpollWait</span><span class="op" id="1641316">(</span><span class="ident" id="1641317">pd</span>&nbsp;<span class="op" id="1641320">*</span><span class="ident" id="1641321"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1641329">,</span>&nbsp;<span class="ident" id="1641331">mode</span>&nbsp;<span class="builtintype" id="1641336">int</span><span class="op" id="1641339">)</span>&nbsp;<span class="builtintype" id="1641341">int</span>&nbsp;<span class="op" id="1641345">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641348">err</span>&nbsp;<span class="op" id="1641352">:=</span>&nbsp;<span class="ident" id="1641355"><a href="/gostd/runtime/netpoll.go.html#1644870">netpollcheckerr</a></span><span class="op" id="1641370">(</span><span class="ident" id="1641371"><a href="/gostd/runtime/netpoll.go.html#1641317">pd</a></span><span class="op" id="1641373">,</span>&nbsp;<span class="builtintype" id="1641375">int32</span><span class="op" id="1641380">(</span><span class="ident" id="1641381"><a href="/gostd/runtime/netpoll.go.html#1641331">mode</a></span><span class="op" id="1641385">)</span><span class="op" id="1641386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641389">if</span>&nbsp;<span class="ident" id="1641392"><a href="/gostd/runtime/netpoll.go.html#1641348">err</a></span>&nbsp;<span class="op" id="1641396">!=</span>&nbsp;<span class="num" id="1641399">0</span>&nbsp;<span class="op" id="1641401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641405">return</span>&nbsp;<span class="ident" id="1641412"><a href="/gostd/runtime/netpoll.go.html#1641348">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641420">//&nbsp;As&nbsp;for&nbsp;now&nbsp;only&nbsp;Solaris&nbsp;uses&nbsp;level-triggered&nbsp;IO.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641473">if</span>&nbsp;<span class="ident" id="1641476"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="1641481">==</span>&nbsp;<span class="string" id="1641484">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1641494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641498"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1641501">(</span><span class="keyword" id="1641502">func</span><span class="op" id="1641506">(</span><span class="op" id="1641507">)</span>&nbsp;<span class="op" id="1641509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641514"><a href="/gostd/runtime/netpoll_epoll.go.html#1649739">netpollarm</a></span><span class="op" id="1641524">(</span><span class="ident" id="1641525"><a href="/gostd/runtime/netpoll.go.html#1641317">pd</a></span><span class="op" id="1641527">,</span>&nbsp;<span class="ident" id="1641529"><a href="/gostd/runtime/netpoll.go.html#1641331">mode</a></span><span class="op" id="1641533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641537">}</span><span class="op" id="1641538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641541">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641544">for</span>&nbsp;<span class="op" id="1641548">!</span><span class="ident" id="1641549"><a href="/gostd/runtime/netpoll.go.html#1645323">netpollblock</a></span><span class="op" id="1641561">(</span><span class="ident" id="1641562"><a href="/gostd/runtime/netpoll.go.html#1641317">pd</a></span><span class="op" id="1641564">,</span>&nbsp;<span class="builtintype" id="1641566">int32</span><span class="op" id="1641571">(</span><span class="ident" id="1641572"><a href="/gostd/runtime/netpoll.go.html#1641331">mode</a></span><span class="op" id="1641576">)</span><span class="op" id="1641577">,</span>&nbsp;<span class="builtintype" id="1641579">false</span><span class="op" id="1641584">)</span>&nbsp;<span class="op" id="1641586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1641590"><a href="/gostd/runtime/netpoll.go.html#1641348">err</a></span>&nbsp;<span class="op" id="1641594">=</span>&nbsp;<span class="ident" id="1641596"><a href="/gostd/runtime/netpoll.go.html#1644870">netpollcheckerr</a></span><span class="op" id="1641611">(</span><span class="ident" id="1641612"><a href="/gostd/runtime/netpoll.go.html#1641317">pd</a></span><span class="op" id="1641614">,</span>&nbsp;<span class="builtintype" id="1641616">int32</span><span class="op" id="1641621">(</span><span class="ident" id="1641622"><a href="/gostd/runtime/netpoll.go.html#1641331">mode</a></span><span class="op" id="1641626">)</span><span class="op" id="1641627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641631">if</span>&nbsp;<span class="ident" id="1641634"><a href="/gostd/runtime/netpoll.go.html#1641348">err</a></span>&nbsp;<span class="op" id="1641638">!=</span>&nbsp;<span class="num" id="1641641">0</span>&nbsp;<span class="op" id="1641643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641648">return</span>&nbsp;<span class="ident" id="1641655"><a href="/gostd/runtime/netpoll.go.html#1641348">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641661">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641665">//&nbsp;Can&nbsp;happen&nbsp;if&nbsp;timeout&nbsp;has&nbsp;fired&nbsp;and&nbsp;unblocked&nbsp;us,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641720">//&nbsp;but&nbsp;before&nbsp;we&nbsp;had&nbsp;a&nbsp;chance&nbsp;to&nbsp;run,&nbsp;timeout&nbsp;has&nbsp;been&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641784">//&nbsp;Pretend&nbsp;it&nbsp;has&nbsp;not&nbsp;happened&nbsp;and&nbsp;retry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1641827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1641830">return</span>&nbsp;<span class="num" id="1641837">0</span><br>
<span class="lineno">160</span><span class="op" id="1641839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641842">func</span>&nbsp;<span class="ident" id="1641847">netpollWaitCanceled</span><span class="op" id="1641866">(</span><span class="ident" id="1641867">pd</span>&nbsp;<span class="op" id="1641870">*</span><span class="ident" id="1641871"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1641879">,</span>&nbsp;<span class="ident" id="1641881">mode</span>&nbsp;<span class="builtintype" id="1641886">int</span><span class="op" id="1641889">)</span>&nbsp;<span class="op" id="1641891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641894">//&nbsp;This&nbsp;function&nbsp;is&nbsp;used&nbsp;only&nbsp;on&nbsp;windows&nbsp;after&nbsp;a&nbsp;failed&nbsp;attempt&nbsp;to&nbsp;cancel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1641969">//&nbsp;a&nbsp;pending&nbsp;async&nbsp;IO&nbsp;operation.&nbsp;Wait&nbsp;for&nbsp;ioready,&nbsp;ignore&nbsp;closing&nbsp;or&nbsp;timeouts.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642049">for</span>&nbsp;<span class="op" id="1642053">!</span><span class="ident" id="1642054"><a href="/gostd/runtime/netpoll.go.html#1645323">netpollblock</a></span><span class="op" id="1642066">(</span><span class="ident" id="1642067"><a href="/gostd/runtime/netpoll.go.html#1641867">pd</a></span><span class="op" id="1642069">,</span>&nbsp;<span class="builtintype" id="1642071">int32</span><span class="op" id="1642076">(</span><span class="ident" id="1642077"><a href="/gostd/runtime/netpoll.go.html#1641881">mode</a></span><span class="op" id="1642081">)</span><span class="op" id="1642082">,</span>&nbsp;<span class="builtintype" id="1642084">true</span><span class="op" id="1642088">)</span>&nbsp;<span class="op" id="1642090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642093">}</span><br>
<span class="lineno"></span><span class="op" id="1642095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1642098">func</span>&nbsp;<span class="ident" id="1642103">netpollSetDeadline</span><span class="op" id="1642121">(</span><span class="ident" id="1642122">pd</span>&nbsp;<span class="op" id="1642125">*</span><span class="ident" id="1642126"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1642134">,</span>&nbsp;<span class="ident" id="1642136">d</span>&nbsp;<span class="builtintype" id="1642138">int64</span><span class="op" id="1642143">,</span>&nbsp;<span class="ident" id="1642145">mode</span>&nbsp;<span class="builtintype" id="1642150">int</span><span class="op" id="1642153">)</span>&nbsp;<span class="op" id="1642155">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642158"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1642162">(</span><span class="op" id="1642163">&amp;</span><span class="ident" id="1642164"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642166">.</span><span class="ident" id="1642167"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1642171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642174">if</span>&nbsp;<span class="ident" id="1642177"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642179">.</span><span class="ident" id="1642180"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1642188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642192"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1642198">(</span><span class="op" id="1642199">&amp;</span><span class="ident" id="1642200"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642202">.</span><span class="ident" id="1642203"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1642207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642211">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642219">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642222"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642224">.</span><span class="ident" id="1642225"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><span class="op" id="1642228">++</span>&nbsp;<span class="comment" id="1642231">//&nbsp;invalidate&nbsp;current&nbsp;timers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1642261">//&nbsp;Reset&nbsp;current&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642287">if</span>&nbsp;<span class="ident" id="1642290"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642292">.</span><span class="ident" id="1642293"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642295">.</span><span class="ident" id="1642296"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642298">!=</span>&nbsp;<span class="builtintype" id="1642301">nil</span>&nbsp;<span class="op" id="1642305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642309"><a href="/gostd/runtime/time.go.html#1759564">deltimer</a></span><span class="op" id="1642317">(</span><span class="op" id="1642318">&amp;</span><span class="ident" id="1642319"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642321">.</span><span class="ident" id="1642322"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642328"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642330">.</span><span class="ident" id="1642331"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642333">.</span><span class="ident" id="1642334"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642336">=</span>&nbsp;<span class="builtintype" id="1642338">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642346">if</span>&nbsp;<span class="ident" id="1642349"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642351">.</span><span class="ident" id="1642352"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1642354">.</span><span class="ident" id="1642355"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642357">!=</span>&nbsp;<span class="builtintype" id="1642360">nil</span>&nbsp;<span class="op" id="1642364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642368"><a href="/gostd/runtime/time.go.html#1759564">deltimer</a></span><span class="op" id="1642376">(</span><span class="op" id="1642377">&amp;</span><span class="ident" id="1642378"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642380">.</span><span class="ident" id="1642381"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1642383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642387"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642389">.</span><span class="ident" id="1642390"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1642392">.</span><span class="ident" id="1642393"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642395">=</span>&nbsp;<span class="builtintype" id="1642397">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642402">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1642405">//&nbsp;Setup&nbsp;new&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642427">if</span>&nbsp;<span class="ident" id="1642430"><a href="/gostd/runtime/netpoll.go.html#1642136">d</a></span>&nbsp;<span class="op" id="1642432">!=</span>&nbsp;<span class="num" id="1642435">0</span>&nbsp;<span class="op" id="1642437">&amp;&amp;</span>&nbsp;<span class="ident" id="1642440"><a href="/gostd/runtime/netpoll.go.html#1642136">d</a></span>&nbsp;<span class="op" id="1642442">&lt;=</span>&nbsp;<span class="ident" id="1642445"><a href="/gostd/runtime/stubs.go.html#1743936">nanotime</a></span><span class="op" id="1642453">(</span><span class="op" id="1642454">)</span>&nbsp;<span class="op" id="1642456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642460"><a href="/gostd/runtime/netpoll.go.html#1642136">d</a></span>&nbsp;<span class="op" id="1642462">=</span>&nbsp;<span class="op" id="1642464">-</span><span class="num" id="1642465">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642471">if</span>&nbsp;<span class="ident" id="1642474"><a href="/gostd/runtime/netpoll.go.html#1642145">mode</a></span>&nbsp;<span class="op" id="1642479">==</span>&nbsp;<span class="string" id="1642482">&#39;r&#39;</span>&nbsp;<span class="op" id="1642486">||</span>&nbsp;<span class="ident" id="1642489"><a href="/gostd/runtime/netpoll.go.html#1642145">mode</a></span>&nbsp;<span class="op" id="1642494">==</span>&nbsp;<span class="string" id="1642497">&#39;r&#39;</span><span class="op" id="1642500">+</span><span class="string" id="1642501">&#39;w&#39;</span>&nbsp;<span class="op" id="1642505">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642509"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642511">.</span><span class="ident" id="1642512"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1642515">=</span>&nbsp;<span class="ident" id="1642517"><a href="/gostd/runtime/netpoll.go.html#1642136">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642523">if</span>&nbsp;<span class="ident" id="1642526"><a href="/gostd/runtime/netpoll.go.html#1642145">mode</a></span>&nbsp;<span class="op" id="1642531">==</span>&nbsp;<span class="string" id="1642534">&#39;w&#39;</span>&nbsp;<span class="op" id="1642538">||</span>&nbsp;<span class="ident" id="1642541"><a href="/gostd/runtime/netpoll.go.html#1642145">mode</a></span>&nbsp;<span class="op" id="1642546">==</span>&nbsp;<span class="string" id="1642549">&#39;r&#39;</span><span class="op" id="1642552">+</span><span class="string" id="1642553">&#39;w&#39;</span>&nbsp;<span class="op" id="1642557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642561"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642563">.</span><span class="ident" id="1642564"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1642567">=</span>&nbsp;<span class="ident" id="1642569"><a href="/gostd/runtime/netpoll.go.html#1642136">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642572">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642575">if</span>&nbsp;<span class="ident" id="1642578"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642580">.</span><span class="ident" id="1642581"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1642584">&gt;</span>&nbsp;<span class="num" id="1642586">0</span>&nbsp;<span class="op" id="1642588">&amp;&amp;</span>&nbsp;<span class="ident" id="1642591"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642593">.</span><span class="ident" id="1642594"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1642597">==</span>&nbsp;<span class="ident" id="1642600"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642602">.</span><span class="ident" id="1642603"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1642606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642610"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642612">.</span><span class="ident" id="1642613"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642615">.</span><span class="ident" id="1642616"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642618">=</span>&nbsp;<span class="ident" id="1642620"><a href="/gostd/runtime/netpoll.go.html#1647703">netpollDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642638"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642640">.</span><span class="ident" id="1642641"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642643">.</span><span class="ident" id="1642644"><a href="/gostd/runtime/time.go.html#1757450">when</a></span>&nbsp;<span class="op" id="1642649">=</span>&nbsp;<span class="ident" id="1642651"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642653">.</span><span class="ident" id="1642654"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1642659">//&nbsp;Copy&nbsp;current&nbsp;seq&nbsp;into&nbsp;the&nbsp;timer&nbsp;arg.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1642701">//&nbsp;Timer&nbsp;func&nbsp;will&nbsp;check&nbsp;the&nbsp;seq&nbsp;against&nbsp;current&nbsp;descriptor&nbsp;seq,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1642768">//&nbsp;if&nbsp;they&nbsp;differ&nbsp;the&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642836"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642838">.</span><span class="ident" id="1642839"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642841">.</span><span class="ident" id="1642842"><a href="/gostd/runtime/time.go.html#1757513">arg</a></span>&nbsp;<span class="op" id="1642846">=</span>&nbsp;<span class="ident" id="1642848"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642853"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642855">.</span><span class="ident" id="1642856"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642858">.</span><span class="ident" id="1642859"><a href="/gostd/runtime/time.go.html#1757533">seq</a></span>&nbsp;<span class="op" id="1642863">=</span>&nbsp;<span class="ident" id="1642865"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642867">.</span><span class="ident" id="1642868"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642874"><a href="/gostd/runtime/time.go.html#1758638">addtimer</a></span><span class="op" id="1642882">(</span><span class="op" id="1642883">&amp;</span><span class="ident" id="1642884"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642886">.</span><span class="ident" id="1642887"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1642892">}</span>&nbsp;<span class="keyword" id="1642894">else</span>&nbsp;<span class="op" id="1642899">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1642903">if</span>&nbsp;<span class="ident" id="1642906"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642908">.</span><span class="ident" id="1642909"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1642912">&gt;</span>&nbsp;<span class="num" id="1642914">0</span>&nbsp;<span class="op" id="1642916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642921"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642923">.</span><span class="ident" id="1642924"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642926">.</span><span class="ident" id="1642927"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1642929">=</span>&nbsp;<span class="ident" id="1642931"><a href="/gostd/runtime/netpoll.go.html#1647814">netpollReadDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642954"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642956">.</span><span class="ident" id="1642957"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642959">.</span><span class="ident" id="1642960"><a href="/gostd/runtime/time.go.html#1757450">when</a></span>&nbsp;<span class="op" id="1642965">=</span>&nbsp;<span class="ident" id="1642967"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642969">.</span><span class="ident" id="1642970"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642976"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642978">.</span><span class="ident" id="1642979"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642981">.</span><span class="ident" id="1642982"><a href="/gostd/runtime/time.go.html#1757513">arg</a></span>&nbsp;<span class="op" id="1642986">=</span>&nbsp;<span class="ident" id="1642988"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1642994"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1642996">.</span><span class="ident" id="1642997"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1642999">.</span><span class="ident" id="1643000"><a href="/gostd/runtime/time.go.html#1757533">seq</a></span>&nbsp;<span class="op" id="1643004">=</span>&nbsp;<span class="ident" id="1643006"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643008">.</span><span class="ident" id="1643009"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643016"><a href="/gostd/runtime/time.go.html#1758638">addtimer</a></span><span class="op" id="1643024">(</span><span class="op" id="1643025">&amp;</span><span class="ident" id="1643026"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643028">.</span><span class="ident" id="1643029"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1643031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643039">if</span>&nbsp;<span class="ident" id="1643042"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643044">.</span><span class="ident" id="1643045"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1643048">&gt;</span>&nbsp;<span class="num" id="1643050">0</span>&nbsp;<span class="op" id="1643052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643057"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643059">.</span><span class="ident" id="1643060"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1643062">.</span><span class="ident" id="1643063"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1643065">=</span>&nbsp;<span class="ident" id="1643067"><a href="/gostd/runtime/netpoll.go.html#1647930">netpollWriteDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643091"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643093">.</span><span class="ident" id="1643094"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1643096">.</span><span class="ident" id="1643097"><a href="/gostd/runtime/time.go.html#1757450">when</a></span>&nbsp;<span class="op" id="1643102">=</span>&nbsp;<span class="ident" id="1643104"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643106">.</span><span class="ident" id="1643107"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643113"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643115">.</span><span class="ident" id="1643116"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1643118">.</span><span class="ident" id="1643119"><a href="/gostd/runtime/time.go.html#1757513">arg</a></span>&nbsp;<span class="op" id="1643123">=</span>&nbsp;<span class="ident" id="1643125"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643131"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643133">.</span><span class="ident" id="1643134"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1643136">.</span><span class="ident" id="1643137"><a href="/gostd/runtime/time.go.html#1757533">seq</a></span>&nbsp;<span class="op" id="1643141">=</span>&nbsp;<span class="ident" id="1643143"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643145">.</span><span class="ident" id="1643146"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643153"><a href="/gostd/runtime/time.go.html#1758638">addtimer</a></span><span class="op" id="1643161">(</span><span class="op" id="1643162">&amp;</span><span class="ident" id="1643163"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643165">.</span><span class="ident" id="1643166"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1643168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643175">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1643178">//&nbsp;If&nbsp;we&nbsp;set&nbsp;the&nbsp;new&nbsp;deadline&nbsp;in&nbsp;the&nbsp;past,&nbsp;unblock&nbsp;currently&nbsp;pending&nbsp;IO&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643259">var</span>&nbsp;<span class="ident" id="1643263">rg</span><span class="op" id="1643265">,</span>&nbsp;<span class="ident" id="1643267">wg</span>&nbsp;<span class="op" id="1643270">*</span><span class="ident" id="1643271"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643274"><a href="/gostd/runtime/atomic.go.html#1481731">atomicstorep</a></span><span class="op" id="1643286">(</span><span class="ident" id="1643287"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1643293">.</span><span class="ident" id="1643294">Pointer</span><span class="op" id="1643301">(</span><span class="op" id="1643302">&amp;</span><span class="ident" id="1643303"><a href="/gostd/runtime/netpoll.go.html#1643267">wg</a></span><span class="op" id="1643305">)</span><span class="op" id="1643306">,</span>&nbsp;<span class="builtintype" id="1643308">nil</span><span class="op" id="1643311">)</span>&nbsp;<span class="comment" id="1643313">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;stores&nbsp;to&nbsp;rd/wd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643397">if</span>&nbsp;<span class="ident" id="1643400"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643402">.</span><span class="ident" id="1643403"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1643406">&lt;</span>&nbsp;<span class="num" id="1643408">0</span>&nbsp;<span class="op" id="1643410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643414"><a href="/gostd/runtime/netpoll.go.html#1643263">rg</a></span>&nbsp;<span class="op" id="1643417">=</span>&nbsp;<span class="ident" id="1643419"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1643433">(</span><span class="ident" id="1643434"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643436">,</span>&nbsp;<span class="string" id="1643438">&#39;r&#39;</span><span class="op" id="1643441">,</span>&nbsp;<span class="builtintype" id="1643443">false</span><span class="op" id="1643448">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643454">if</span>&nbsp;<span class="ident" id="1643457"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643459">.</span><span class="ident" id="1643460"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1643463">&lt;</span>&nbsp;<span class="num" id="1643465">0</span>&nbsp;<span class="op" id="1643467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643471"><a href="/gostd/runtime/netpoll.go.html#1643267">wg</a></span>&nbsp;<span class="op" id="1643474">=</span>&nbsp;<span class="ident" id="1643476"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1643490">(</span><span class="ident" id="1643491"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643493">,</span>&nbsp;<span class="string" id="1643495">&#39;w&#39;</span><span class="op" id="1643498">,</span>&nbsp;<span class="builtintype" id="1643500">false</span><span class="op" id="1643505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643511"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1643517">(</span><span class="op" id="1643518">&amp;</span><span class="ident" id="1643519"><a href="/gostd/runtime/netpoll.go.html#1642122">pd</a></span><span class="op" id="1643521">.</span><span class="ident" id="1643522"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1643526">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643529">if</span>&nbsp;<span class="ident" id="1643532"><a href="/gostd/runtime/netpoll.go.html#1643263">rg</a></span>&nbsp;<span class="op" id="1643535">!=</span>&nbsp;<span class="builtintype" id="1643538">nil</span>&nbsp;<span class="op" id="1643542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643546"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1643553">(</span><span class="ident" id="1643554"><a href="/gostd/runtime/netpoll.go.html#1643263">rg</a></span><span class="op" id="1643556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643562">if</span>&nbsp;<span class="ident" id="1643565"><a href="/gostd/runtime/netpoll.go.html#1643267">wg</a></span>&nbsp;<span class="op" id="1643568">!=</span>&nbsp;<span class="builtintype" id="1643571">nil</span>&nbsp;<span class="op" id="1643575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643579"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1643586">(</span><span class="ident" id="1643587"><a href="/gostd/runtime/netpoll.go.html#1643267">wg</a></span><span class="op" id="1643589">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643592">}</span><br>
<span class="lineno"></span><span class="op" id="1643594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1643597">func</span>&nbsp;<span class="ident" id="1643602">netpollUnblock</span><span class="op" id="1643616">(</span><span class="ident" id="1643617">pd</span>&nbsp;<span class="op" id="1643620">*</span><span class="ident" id="1643621"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1643629">)</span>&nbsp;<span class="op" id="1643631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643634"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1643638">(</span><span class="op" id="1643639">&amp;</span><span class="ident" id="1643640"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643642">.</span><span class="ident" id="1643643"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1643647">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643650">if</span>&nbsp;<span class="ident" id="1643653"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643655">.</span><span class="ident" id="1643656"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1643664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643668"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1643675">(</span><span class="string" id="1643676">&#34;netpollUnblock:&nbsp;already&nbsp;closing&#34;</span><span class="op" id="1643709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643715"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643717">.</span><span class="ident" id="1643718"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1643726">=</span>&nbsp;<span class="builtintype" id="1643728">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643734"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643736">.</span><span class="ident" id="1643737"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span><span class="op" id="1643740">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643744">var</span>&nbsp;<span class="ident" id="1643748">rg</span><span class="op" id="1643750">,</span>&nbsp;<span class="ident" id="1643752">wg</span>&nbsp;<span class="op" id="1643755">*</span><span class="ident" id="1643756"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643759"><a href="/gostd/runtime/atomic.go.html#1481731">atomicstorep</a></span><span class="op" id="1643771">(</span><span class="ident" id="1643772"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1643778">.</span><span class="ident" id="1643779">Pointer</span><span class="op" id="1643786">(</span><span class="op" id="1643787">&amp;</span><span class="ident" id="1643788"><a href="/gostd/runtime/netpoll.go.html#1643748">rg</a></span><span class="op" id="1643790">)</span><span class="op" id="1643791">,</span>&nbsp;<span class="builtintype" id="1643793">nil</span><span class="op" id="1643796">)</span>&nbsp;<span class="comment" id="1643798">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;closing&nbsp;and&nbsp;read&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643883"><a href="/gostd/runtime/netpoll.go.html#1643748">rg</a></span>&nbsp;<span class="op" id="1643886">=</span>&nbsp;<span class="ident" id="1643888"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1643902">(</span><span class="ident" id="1643903"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643905">,</span>&nbsp;<span class="string" id="1643907">&#39;r&#39;</span><span class="op" id="1643910">,</span>&nbsp;<span class="builtintype" id="1643912">false</span><span class="op" id="1643917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643920"><a href="/gostd/runtime/netpoll.go.html#1643752">wg</a></span>&nbsp;<span class="op" id="1643923">=</span>&nbsp;<span class="ident" id="1643925"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1643939">(</span><span class="ident" id="1643940"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643942">,</span>&nbsp;<span class="string" id="1643944">&#39;w&#39;</span><span class="op" id="1643947">,</span>&nbsp;<span class="builtintype" id="1643949">false</span><span class="op" id="1643954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1643957">if</span>&nbsp;<span class="ident" id="1643960"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643962">.</span><span class="ident" id="1643963"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1643965">.</span><span class="ident" id="1643966"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1643968">!=</span>&nbsp;<span class="builtintype" id="1643971">nil</span>&nbsp;<span class="op" id="1643975">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643979"><a href="/gostd/runtime/time.go.html#1759564">deltimer</a></span><span class="op" id="1643987">(</span><span class="op" id="1643988">&amp;</span><span class="ident" id="1643989"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1643991">.</span><span class="ident" id="1643992"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1643994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1643998"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1644000">.</span><span class="ident" id="1644001"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1644003">.</span><span class="ident" id="1644004"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1644006">=</span>&nbsp;<span class="builtintype" id="1644008">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644016">if</span>&nbsp;<span class="ident" id="1644019"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1644021">.</span><span class="ident" id="1644022"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1644024">.</span><span class="ident" id="1644025"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1644027">!=</span>&nbsp;<span class="builtintype" id="1644030">nil</span>&nbsp;<span class="op" id="1644034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644038"><a href="/gostd/runtime/time.go.html#1759564">deltimer</a></span><span class="op" id="1644046">(</span><span class="op" id="1644047">&amp;</span><span class="ident" id="1644048"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1644050">.</span><span class="ident" id="1644051"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1644053">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644057"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1644059">.</span><span class="ident" id="1644060"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1644062">.</span><span class="ident" id="1644063"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1644065">=</span>&nbsp;<span class="builtintype" id="1644067">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644075"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1644081">(</span><span class="op" id="1644082">&amp;</span><span class="ident" id="1644083"><a href="/gostd/runtime/netpoll.go.html#1643617">pd</a></span><span class="op" id="1644085">.</span><span class="ident" id="1644086"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1644090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644093">if</span>&nbsp;<span class="ident" id="1644096"><a href="/gostd/runtime/netpoll.go.html#1643748">rg</a></span>&nbsp;<span class="op" id="1644099">!=</span>&nbsp;<span class="builtintype" id="1644102">nil</span>&nbsp;<span class="op" id="1644106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644110"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1644117">(</span><span class="ident" id="1644118"><a href="/gostd/runtime/netpoll.go.html#1643748">rg</a></span><span class="op" id="1644120">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644126">if</span>&nbsp;<span class="ident" id="1644129"><a href="/gostd/runtime/netpoll.go.html#1643752">wg</a></span>&nbsp;<span class="op" id="1644132">!=</span>&nbsp;<span class="builtintype" id="1644135">nil</span>&nbsp;<span class="op" id="1644139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644143"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1644150">(</span><span class="ident" id="1644151"><a href="/gostd/runtime/netpoll.go.html#1643752">wg</a></span><span class="op" id="1644153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644156">}</span><br>
<span class="lineno"></span><span class="op" id="1644158">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="1644161">func</span>&nbsp;<span class="ident" id="1644166">netpollfd</span><span class="op" id="1644175">(</span><span class="ident" id="1644176">pd</span>&nbsp;<span class="op" id="1644179">*</span><span class="ident" id="1644180"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644188">)</span>&nbsp;<span class="builtintype" id="1644190">uintptr</span>&nbsp;<span class="op" id="1644198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644201">return</span>&nbsp;<span class="ident" id="1644208"><a href="/gostd/runtime/netpoll.go.html#1644176">pd</a></span><span class="op" id="1644210">.</span><span class="ident" id="1644211"><a href="/gostd/runtime/netpoll.go.html#1639223">fd</a></span><br>
<span class="lineno"></span><span class="op" id="1644214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="1644217">func</span>&nbsp;<span class="ident" id="1644222">netpolluser</span><span class="op" id="1644233">(</span><span class="ident" id="1644234">pd</span>&nbsp;<span class="op" id="1644237">*</span><span class="ident" id="1644238"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644246">)</span>&nbsp;<span class="op" id="1644248">*</span><span class="ident" id="1644249"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1644255">.</span><span class="ident" id="1644256">Pointer</span>&nbsp;<span class="op" id="1644264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644267">return</span>&nbsp;<span class="op" id="1644274">&amp;</span><span class="ident" id="1644275"><a href="/gostd/runtime/netpoll.go.html#1644234">pd</a></span><span class="op" id="1644277">.</span><span class="ident" id="1644278"><a href="/gostd/runtime/netpoll.go.html#1639672">user</a></span><br>
<span class="lineno"></span><span class="op" id="1644283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1644286">func</span>&nbsp;<span class="ident" id="1644291">netpollclosing</span><span class="op" id="1644305">(</span><span class="ident" id="1644306">pd</span>&nbsp;<span class="op" id="1644309">*</span><span class="ident" id="1644310"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644318">)</span>&nbsp;<span class="builtintype" id="1644320">bool</span>&nbsp;<span class="op" id="1644325">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644328">return</span>&nbsp;<span class="ident" id="1644335"><a href="/gostd/runtime/netpoll.go.html#1644306">pd</a></span><span class="op" id="1644337">.</span><span class="ident" id="1644338"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span><br>
<span class="lineno"></span><span class="op" id="1644346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1644349">func</span>&nbsp;<span class="ident" id="1644354">netpolllock</span><span class="op" id="1644365">(</span><span class="ident" id="1644366">pd</span>&nbsp;<span class="op" id="1644369">*</span><span class="ident" id="1644370"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644378">)</span>&nbsp;<span class="op" id="1644380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644383"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1644387">(</span><span class="op" id="1644388">&amp;</span><span class="ident" id="1644389"><a href="/gostd/runtime/netpoll.go.html#1644366">pd</a></span><span class="op" id="1644391">.</span><span class="ident" id="1644392"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1644396">)</span><br>
<span class="lineno">280</span><span class="op" id="1644398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1644401">func</span>&nbsp;<span class="ident" id="1644406">netpollunlock</span><span class="op" id="1644419">(</span><span class="ident" id="1644420">pd</span>&nbsp;<span class="op" id="1644423">*</span><span class="ident" id="1644424"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644432">)</span>&nbsp;<span class="op" id="1644434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644437"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1644443">(</span><span class="op" id="1644444">&amp;</span><span class="ident" id="1644445"><a href="/gostd/runtime/netpoll.go.html#1644420">pd</a></span><span class="op" id="1644447">.</span><span class="ident" id="1644448"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1644452">)</span><br>
<span class="lineno"></span><span class="op" id="1644454">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="1644457">//&nbsp;make&nbsp;pd&nbsp;ready,&nbsp;newly&nbsp;runnable&nbsp;goroutines&nbsp;(if&nbsp;any)&nbsp;are&nbsp;returned&nbsp;in&nbsp;rg/wg</span><br>
<span class="lineno"></span><span class="keyword" id="1644532">func</span>&nbsp;<span class="ident" id="1644537">netpollready</span><span class="op" id="1644549">(</span><span class="ident" id="1644550">gpp</span>&nbsp;<span class="op" id="1644554">*</span><span class="op" id="1644555">*</span><span class="ident" id="1644556"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><span class="op" id="1644557">,</span>&nbsp;<span class="ident" id="1644559">pd</span>&nbsp;<span class="op" id="1644562">*</span><span class="ident" id="1644563"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644571">,</span>&nbsp;<span class="ident" id="1644573">mode</span>&nbsp;<span class="builtintype" id="1644578">int32</span><span class="op" id="1644583">)</span>&nbsp;<span class="op" id="1644585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644588">var</span>&nbsp;<span class="ident" id="1644592">rg</span><span class="op" id="1644594">,</span>&nbsp;<span class="ident" id="1644596">wg</span>&nbsp;<span class="op" id="1644599">*</span><span class="ident" id="1644600"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644603">if</span>&nbsp;<span class="ident" id="1644606"><a href="/gostd/runtime/netpoll.go.html#1644573">mode</a></span>&nbsp;<span class="op" id="1644611">==</span>&nbsp;<span class="string" id="1644614">&#39;r&#39;</span>&nbsp;<span class="op" id="1644618">||</span>&nbsp;<span class="ident" id="1644621"><a href="/gostd/runtime/netpoll.go.html#1644573">mode</a></span>&nbsp;<span class="op" id="1644626">==</span>&nbsp;<span class="string" id="1644629">&#39;r&#39;</span><span class="op" id="1644632">+</span><span class="string" id="1644633">&#39;w&#39;</span>&nbsp;<span class="op" id="1644637">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644641"><a href="/gostd/runtime/netpoll.go.html#1644592">rg</a></span>&nbsp;<span class="op" id="1644644">=</span>&nbsp;<span class="ident" id="1644646"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1644660">(</span><span class="ident" id="1644661"><a href="/gostd/runtime/netpoll.go.html#1644559">pd</a></span><span class="op" id="1644663">,</span>&nbsp;<span class="string" id="1644665">&#39;r&#39;</span><span class="op" id="1644668">,</span>&nbsp;<span class="builtintype" id="1644670">true</span><span class="op" id="1644674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644680">if</span>&nbsp;<span class="ident" id="1644683"><a href="/gostd/runtime/netpoll.go.html#1644573">mode</a></span>&nbsp;<span class="op" id="1644688">==</span>&nbsp;<span class="string" id="1644691">&#39;w&#39;</span>&nbsp;<span class="op" id="1644695">||</span>&nbsp;<span class="ident" id="1644698"><a href="/gostd/runtime/netpoll.go.html#1644573">mode</a></span>&nbsp;<span class="op" id="1644703">==</span>&nbsp;<span class="string" id="1644706">&#39;r&#39;</span><span class="op" id="1644709">+</span><span class="string" id="1644710">&#39;w&#39;</span>&nbsp;<span class="op" id="1644714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644718"><a href="/gostd/runtime/netpoll.go.html#1644596">wg</a></span>&nbsp;<span class="op" id="1644721">=</span>&nbsp;<span class="ident" id="1644723"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1644737">(</span><span class="ident" id="1644738"><a href="/gostd/runtime/netpoll.go.html#1644559">pd</a></span><span class="op" id="1644740">,</span>&nbsp;<span class="string" id="1644742">&#39;w&#39;</span><span class="op" id="1644745">,</span>&nbsp;<span class="builtintype" id="1644747">true</span><span class="op" id="1644751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644754">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644757">if</span>&nbsp;<span class="ident" id="1644760"><a href="/gostd/runtime/netpoll.go.html#1644592">rg</a></span>&nbsp;<span class="op" id="1644763">!=</span>&nbsp;<span class="builtintype" id="1644766">nil</span>&nbsp;<span class="op" id="1644770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644774"><a href="/gostd/runtime/netpoll.go.html#1644592">rg</a></span><span class="op" id="1644776">.</span><span class="ident" id="1644777"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787512">schedlink</a></span>&nbsp;<span class="op" id="1644787">=</span>&nbsp;<span class="op" id="1644789">*</span><span class="ident" id="1644790"><a href="/gostd/runtime/netpoll.go.html#1644550">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644796">*</span><span class="ident" id="1644797"><a href="/gostd/runtime/netpoll.go.html#1644550">gpp</a></span>&nbsp;<span class="op" id="1644801">=</span>&nbsp;<span class="ident" id="1644803"><a href="/gostd/runtime/netpoll.go.html#1644592">rg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644810">if</span>&nbsp;<span class="ident" id="1644813"><a href="/gostd/runtime/netpoll.go.html#1644596">wg</a></span>&nbsp;<span class="op" id="1644816">!=</span>&nbsp;<span class="builtintype" id="1644819">nil</span>&nbsp;<span class="op" id="1644823">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1644827"><a href="/gostd/runtime/netpoll.go.html#1644596">wg</a></span><span class="op" id="1644829">.</span><span class="ident" id="1644830"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787512">schedlink</a></span>&nbsp;<span class="op" id="1644840">=</span>&nbsp;<span class="op" id="1644842">*</span><span class="ident" id="1644843"><a href="/gostd/runtime/netpoll.go.html#1644550">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644849">*</span><span class="ident" id="1644850"><a href="/gostd/runtime/netpoll.go.html#1644550">gpp</a></span>&nbsp;<span class="op" id="1644854">=</span>&nbsp;<span class="ident" id="1644856"><a href="/gostd/runtime/netpoll.go.html#1644596">wg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644860">}</span><br>
<span class="lineno"></span><span class="op" id="1644862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="1644865">func</span>&nbsp;<span class="ident" id="1644870">netpollcheckerr</span><span class="op" id="1644885">(</span><span class="ident" id="1644886">pd</span>&nbsp;<span class="op" id="1644889">*</span><span class="ident" id="1644890"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1644898">,</span>&nbsp;<span class="ident" id="1644900">mode</span>&nbsp;<span class="builtintype" id="1644905">int32</span><span class="op" id="1644910">)</span>&nbsp;<span class="builtintype" id="1644912">int</span>&nbsp;<span class="op" id="1644916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644919">if</span>&nbsp;<span class="ident" id="1644922"><a href="/gostd/runtime/netpoll.go.html#1644886">pd</a></span><span class="op" id="1644924">.</span><span class="ident" id="1644925"><a href="/gostd/runtime/netpoll.go.html#1639240">closing</a></span>&nbsp;<span class="op" id="1644933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644937">return</span>&nbsp;<span class="num" id="1644944">1</span>&nbsp;<span class="comment" id="1644946">//&nbsp;errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1644961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1644964">if</span>&nbsp;<span class="op" id="1644967">(</span><span class="ident" id="1644968"><a href="/gostd/runtime/netpoll.go.html#1644900">mode</a></span>&nbsp;<span class="op" id="1644973">==</span>&nbsp;<span class="string" id="1644976">&#39;r&#39;</span>&nbsp;<span class="op" id="1644980">&amp;&amp;</span>&nbsp;<span class="ident" id="1644983"><a href="/gostd/runtime/netpoll.go.html#1644886">pd</a></span><span class="op" id="1644985">.</span><span class="ident" id="1644986"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1644989">&lt;</span>&nbsp;<span class="num" id="1644991">0</span><span class="op" id="1644992">)</span>&nbsp;<span class="op" id="1644994">||</span>&nbsp;<span class="op" id="1644997">(</span><span class="ident" id="1644998"><a href="/gostd/runtime/netpoll.go.html#1644900">mode</a></span>&nbsp;<span class="op" id="1645003">==</span>&nbsp;<span class="string" id="1645006">&#39;w&#39;</span>&nbsp;<span class="op" id="1645010">&amp;&amp;</span>&nbsp;<span class="ident" id="1645013"><a href="/gostd/runtime/netpoll.go.html#1644886">pd</a></span><span class="op" id="1645015">.</span><span class="ident" id="1645016"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1645019">&lt;</span>&nbsp;<span class="num" id="1645021">0</span><span class="op" id="1645022">)</span>&nbsp;<span class="op" id="1645024">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645028">return</span>&nbsp;<span class="num" id="1645035">2</span>&nbsp;<span class="comment" id="1645037">//&nbsp;errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645055">return</span>&nbsp;<span class="num" id="1645062">0</span><br>
<span class="lineno"></span><span class="op" id="1645064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="1645067">func</span>&nbsp;<span class="ident" id="1645072">netpollblockcommit</span><span class="op" id="1645090">(</span><span class="ident" id="1645091">gp</span>&nbsp;<span class="op" id="1645094">*</span><span class="ident" id="1645095"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><span class="op" id="1645096">,</span>&nbsp;<span class="ident" id="1645098">gpp</span>&nbsp;<span class="ident" id="1645102"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1645108">.</span><span class="ident" id="1645109">Pointer</span><span class="op" id="1645116">)</span>&nbsp;<span class="builtintype" id="1645118">bool</span>&nbsp;<span class="op" id="1645123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645126">return</span>&nbsp;<span class="ident" id="1645133"><a href="/gostd/runtime/stubs.go.html#1744879">casuintptr</a></span><span class="op" id="1645143">(</span><span class="op" id="1645144">(</span><span class="op" id="1645145">*</span><span class="builtintype" id="1645146">uintptr</span><span class="op" id="1645153">)</span><span class="op" id="1645154">(</span><span class="ident" id="1645155"><a href="/gostd/runtime/netpoll.go.html#1645098">gpp</a></span><span class="op" id="1645158">)</span><span class="op" id="1645159">,</span>&nbsp;<span class="ident" id="1645161"><a href="/gostd/runtime/netpoll.go.html#1638474">pdWait</a></span><span class="op" id="1645167">,</span>&nbsp;<span class="builtintype" id="1645169">uintptr</span><span class="op" id="1645176">(</span><span class="ident" id="1645177"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1645183">.</span><span class="ident" id="1645184">Pointer</span><span class="op" id="1645191">(</span><span class="ident" id="1645192"><a href="/gostd/runtime/netpoll.go.html#1645091">gp</a></span><span class="op" id="1645194">)</span><span class="op" id="1645195">)</span><span class="op" id="1645196">)</span><br>
<span class="lineno"></span><span class="op" id="1645198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1645201">//&nbsp;returns&nbsp;true&nbsp;if&nbsp;IO&nbsp;is&nbsp;ready,&nbsp;or&nbsp;false&nbsp;if&nbsp;timedout&nbsp;or&nbsp;closed</span><br>
<span class="lineno">320</span><span class="comment" id="1645264">//&nbsp;waitio&nbsp;-&nbsp;wait&nbsp;only&nbsp;for&nbsp;completed&nbsp;IO,&nbsp;ignore&nbsp;errors</span><br>
<span class="lineno"></span><span class="keyword" id="1645318">func</span>&nbsp;<span class="ident" id="1645323">netpollblock</span><span class="op" id="1645335">(</span><span class="ident" id="1645336">pd</span>&nbsp;<span class="op" id="1645339">*</span><span class="ident" id="1645340"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1645348">,</span>&nbsp;<span class="ident" id="1645350">mode</span>&nbsp;<span class="builtintype" id="1645355">int32</span><span class="op" id="1645360">,</span>&nbsp;<span class="ident" id="1645362">waitio</span>&nbsp;<span class="builtintype" id="1645369">bool</span><span class="op" id="1645373">)</span>&nbsp;<span class="builtintype" id="1645375">bool</span>&nbsp;<span class="op" id="1645380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645383">gpp</span>&nbsp;<span class="op" id="1645387">:=</span>&nbsp;<span class="op" id="1645390">&amp;</span><span class="ident" id="1645391"><a href="/gostd/runtime/netpoll.go.html#1645336">pd</a></span><span class="op" id="1645393">.</span><span class="ident" id="1645394"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645398">if</span>&nbsp;<span class="ident" id="1645401"><a href="/gostd/runtime/netpoll.go.html#1645350">mode</a></span>&nbsp;<span class="op" id="1645406">==</span>&nbsp;<span class="string" id="1645409">&#39;w&#39;</span>&nbsp;<span class="op" id="1645413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645417"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span>&nbsp;<span class="op" id="1645421">=</span>&nbsp;<span class="op" id="1645423">&amp;</span><span class="ident" id="1645424"><a href="/gostd/runtime/netpoll.go.html#1645336">pd</a></span><span class="op" id="1645426">.</span><span class="ident" id="1645427"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1645435">//&nbsp;set&nbsp;the&nbsp;gpp&nbsp;semaphore&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645469">for</span>&nbsp;<span class="op" id="1645473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645477">old</span>&nbsp;<span class="op" id="1645481">:=</span>&nbsp;<span class="op" id="1645484">*</span><span class="ident" id="1645485"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645491">if</span>&nbsp;<span class="ident" id="1645494"><a href="/gostd/runtime/netpoll.go.html#1645477">old</a></span>&nbsp;<span class="op" id="1645498">==</span>&nbsp;<span class="ident" id="1645501"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1645509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645514">*</span><span class="ident" id="1645515"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span>&nbsp;<span class="op" id="1645519">=</span>&nbsp;<span class="num" id="1645521">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645526">return</span>&nbsp;<span class="builtintype" id="1645533">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645544">if</span>&nbsp;<span class="ident" id="1645547"><a href="/gostd/runtime/netpoll.go.html#1645477">old</a></span>&nbsp;<span class="op" id="1645551">!=</span>&nbsp;<span class="num" id="1645554">0</span>&nbsp;<span class="op" id="1645556">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645561"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1645568">(</span><span class="string" id="1645569">&#34;netpollblock:&nbsp;double&nbsp;wait&#34;</span><span class="op" id="1645596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645604">if</span>&nbsp;<span class="ident" id="1645607"><a href="/gostd/runtime/stubs.go.html#1744879">casuintptr</a></span><span class="op" id="1645617">(</span><span class="ident" id="1645618"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span><span class="op" id="1645621">,</span>&nbsp;<span class="num" id="1645623">0</span><span class="op" id="1645624">,</span>&nbsp;<span class="ident" id="1645626"><a href="/gostd/runtime/netpoll.go.html#1638474">pdWait</a></span><span class="op" id="1645632">)</span>&nbsp;<span class="op" id="1645634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645639">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645647">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1645650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1645654">//&nbsp;need&nbsp;to&nbsp;recheck&nbsp;error&nbsp;states&nbsp;after&nbsp;setting&nbsp;gpp&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1645713">//&nbsp;this&nbsp;is&nbsp;necessary&nbsp;because&nbsp;runtime_pollUnblock/runtime_pollSetDeadline/deadlineimpl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1645800">//&nbsp;do&nbsp;the&nbsp;opposite:&nbsp;store&nbsp;to&nbsp;closing/rd/wd,&nbsp;membarrier,&nbsp;load&nbsp;of&nbsp;rg/wg</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1645871">if</span>&nbsp;<span class="ident" id="1645874"><a href="/gostd/runtime/netpoll.go.html#1645362">waitio</a></span>&nbsp;<span class="op" id="1645881">||</span>&nbsp;<span class="ident" id="1645884"><a href="/gostd/runtime/netpoll.go.html#1644870">netpollcheckerr</a></span><span class="op" id="1645899">(</span><span class="ident" id="1645900"><a href="/gostd/runtime/netpoll.go.html#1645336">pd</a></span><span class="op" id="1645902">,</span>&nbsp;<span class="ident" id="1645904"><a href="/gostd/runtime/netpoll.go.html#1645350">mode</a></span><span class="op" id="1645908">)</span>&nbsp;<span class="op" id="1645910">==</span>&nbsp;<span class="num" id="1645913">0</span>&nbsp;<span class="op" id="1645915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645919">f</span>&nbsp;<span class="op" id="1645921">:=</span>&nbsp;<span class="ident" id="1645924"><a href="/gostd/runtime/netpoll.go.html#1645072">netpollblockcommit</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1645945"><a href="/gostd/runtime/proc.go.html#1673271">gopark</a></span><span class="op" id="1645951">(</span><span class="op" id="1645952">*</span><span class="op" id="1645953">*</span><span class="op" id="1645954">(</span><span class="op" id="1645955">*</span><span class="op" id="1645956">*</span><span class="ident" id="1645957"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1645963">.</span><span class="ident" id="1645964">Pointer</span><span class="op" id="1645971">)</span><span class="op" id="1645972">(</span><span class="ident" id="1645973"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1645979">.</span><span class="ident" id="1645980">Pointer</span><span class="op" id="1645987">(</span><span class="op" id="1645988">&amp;</span><span class="ident" id="1645989"><a href="/gostd/runtime/netpoll.go.html#1645919">f</a></span><span class="op" id="1645990">)</span><span class="op" id="1645991">)</span><span class="op" id="1645992">,</span>&nbsp;<span class="ident" id="1645994"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1646000">.</span><span class="ident" id="1646001">Pointer</span><span class="op" id="1646008">(</span><span class="ident" id="1646009"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span><span class="op" id="1646012">)</span><span class="op" id="1646013">,</span>&nbsp;<span class="string" id="1646015">&#34;IO&nbsp;wait&#34;</span><span class="op" id="1646024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646030">//&nbsp;be&nbsp;careful&nbsp;to&nbsp;not&nbsp;lose&nbsp;concurrent&nbsp;READY&nbsp;notification</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646087">old</span>&nbsp;<span class="op" id="1646091">:=</span>&nbsp;<span class="ident" id="1646094"><a href="/gostd/runtime/atomic.go.html#1481263">xchguintptr</a></span><span class="op" id="1646105">(</span><span class="ident" id="1646106"><a href="/gostd/runtime/netpoll.go.html#1645383">gpp</a></span><span class="op" id="1646109">,</span>&nbsp;<span class="num" id="1646111">0</span><span class="op" id="1646112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646115">if</span>&nbsp;<span class="ident" id="1646118"><a href="/gostd/runtime/netpoll.go.html#1646087">old</a></span>&nbsp;<span class="op" id="1646122">&gt;</span>&nbsp;<span class="ident" id="1646124"><a href="/gostd/runtime/netpoll.go.html#1638474">pdWait</a></span>&nbsp;<span class="op" id="1646131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646135"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1646142">(</span><span class="string" id="1646143">&#34;netpollblock:&nbsp;corrupted&nbsp;state&#34;</span><span class="op" id="1646174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646180">return</span>&nbsp;<span class="ident" id="1646187"><a href="/gostd/runtime/netpoll.go.html#1646087">old</a></span>&nbsp;<span class="op" id="1646191">==</span>&nbsp;<span class="ident" id="1646194"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span><br>
<span class="lineno">355</span><span class="op" id="1646202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1646205">func</span>&nbsp;<span class="ident" id="1646210">netpollunblock</span><span class="op" id="1646224">(</span><span class="ident" id="1646225">pd</span>&nbsp;<span class="op" id="1646228">*</span><span class="ident" id="1646229"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1646237">,</span>&nbsp;<span class="ident" id="1646239">mode</span>&nbsp;<span class="builtintype" id="1646244">int32</span><span class="op" id="1646249">,</span>&nbsp;<span class="ident" id="1646251">ioready</span>&nbsp;<span class="builtintype" id="1646259">bool</span><span class="op" id="1646263">)</span>&nbsp;<span class="op" id="1646265">*</span><span class="ident" id="1646266"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span>&nbsp;<span class="op" id="1646268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646271">gpp</span>&nbsp;<span class="op" id="1646275">:=</span>&nbsp;<span class="op" id="1646278">&amp;</span><span class="ident" id="1646279"><a href="/gostd/runtime/netpoll.go.html#1646225">pd</a></span><span class="op" id="1646281">.</span><span class="ident" id="1646282"><a href="/gostd/runtime/netpoll.go.html#1639332">rg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646286">if</span>&nbsp;<span class="ident" id="1646289"><a href="/gostd/runtime/netpoll.go.html#1646239">mode</a></span>&nbsp;<span class="op" id="1646294">==</span>&nbsp;<span class="string" id="1646297">&#39;w&#39;</span>&nbsp;<span class="op" id="1646301">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646305"><a href="/gostd/runtime/netpoll.go.html#1646271">gpp</a></span>&nbsp;<span class="op" id="1646309">=</span>&nbsp;<span class="op" id="1646311">&amp;</span><span class="ident" id="1646312"><a href="/gostd/runtime/netpoll.go.html#1646225">pd</a></span><span class="op" id="1646314">.</span><span class="ident" id="1646315"><a href="/gostd/runtime/netpoll.go.html#1639511">wg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646323">for</span>&nbsp;<span class="op" id="1646327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646331">old</span>&nbsp;<span class="op" id="1646335">:=</span>&nbsp;<span class="op" id="1646338">*</span><span class="ident" id="1646339"><a href="/gostd/runtime/netpoll.go.html#1646271">gpp</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646345">if</span>&nbsp;<span class="ident" id="1646348"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span>&nbsp;<span class="op" id="1646352">==</span>&nbsp;<span class="ident" id="1646355"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1646363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646368">return</span>&nbsp;<span class="builtintype" id="1646375">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646385">if</span>&nbsp;<span class="ident" id="1646388"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span>&nbsp;<span class="op" id="1646392">==</span>&nbsp;<span class="num" id="1646395">0</span>&nbsp;<span class="op" id="1646397">&amp;&amp;</span>&nbsp;<span class="op" id="1646400">!</span><span class="ident" id="1646401"><a href="/gostd/runtime/netpoll.go.html#1646251">ioready</a></span>&nbsp;<span class="op" id="1646409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646414">//&nbsp;Only&nbsp;set&nbsp;READY&nbsp;for&nbsp;ioready.&nbsp;runtime_pollWait</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646465">//&nbsp;will&nbsp;check&nbsp;for&nbsp;timeout/cancel&nbsp;before&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646517">return</span>&nbsp;<span class="builtintype" id="1646524">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646534">var</span>&nbsp;<span class="builtinfunc" id="1646538">new</span>&nbsp;<span class="builtintype" id="1646542">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646552">if</span>&nbsp;<span class="ident" id="1646555"><a href="/gostd/runtime/netpoll.go.html#1646251">ioready</a></span>&nbsp;<span class="op" id="1646563">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1646568"><a href="/gostd/runtime/netpoll.go.html#1646538">new</a></span>&nbsp;<span class="op" id="1646572">=</span>&nbsp;<span class="ident" id="1646574"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646588">if</span>&nbsp;<span class="ident" id="1646591"><a href="/gostd/runtime/stubs.go.html#1744879">casuintptr</a></span><span class="op" id="1646601">(</span><span class="ident" id="1646602"><a href="/gostd/runtime/netpoll.go.html#1646271">gpp</a></span><span class="op" id="1646605">,</span>&nbsp;<span class="ident" id="1646607"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span><span class="op" id="1646610">,</span>&nbsp;<span class="builtinfunc" id="1646612"><a href="/gostd/runtime/netpoll.go.html#1646538">new</a></span><span class="op" id="1646615">)</span>&nbsp;<span class="op" id="1646617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646622">if</span>&nbsp;<span class="ident" id="1646625"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span>&nbsp;<span class="op" id="1646629">==</span>&nbsp;<span class="ident" id="1646632"><a href="/gostd/runtime/netpoll.go.html#1638453">pdReady</a></span>&nbsp;<span class="op" id="1646640">||</span>&nbsp;<span class="ident" id="1646643"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span>&nbsp;<span class="op" id="1646647">==</span>&nbsp;<span class="ident" id="1646650"><a href="/gostd/runtime/netpoll.go.html#1638474">pdWait</a></span>&nbsp;<span class="op" id="1646657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646663"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span>&nbsp;<span class="op" id="1646667">=</span>&nbsp;<span class="num" id="1646669">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646679">return</span>&nbsp;<span class="op" id="1646686">(</span><span class="op" id="1646687">*</span><span class="ident" id="1646688"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><span class="op" id="1646689">)</span><span class="op" id="1646690">(</span><span class="ident" id="1646691"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1646697">.</span><span class="ident" id="1646698">Pointer</span><span class="op" id="1646705">(</span><span class="ident" id="1646706"><a href="/gostd/runtime/netpoll.go.html#1646331">old</a></span><span class="op" id="1646709">)</span><span class="op" id="1646710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646717">}</span><br>
<span class="lineno"></span><span class="op" id="1646719">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="1646722">func</span>&nbsp;<span class="ident" id="1646727">netpolldeadlineimpl</span><span class="op" id="1646746">(</span><span class="ident" id="1646747">pd</span>&nbsp;<span class="op" id="1646750">*</span><span class="ident" id="1646751"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1646759">,</span>&nbsp;<span class="ident" id="1646761">seq</span>&nbsp;<span class="builtintype" id="1646765">uintptr</span><span class="op" id="1646772">,</span>&nbsp;<span class="ident" id="1646774">read</span><span class="op" id="1646778">,</span>&nbsp;<span class="ident" id="1646780">write</span>&nbsp;<span class="builtintype" id="1646786">bool</span><span class="op" id="1646790">)</span>&nbsp;<span class="op" id="1646792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646795"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1646799">(</span><span class="op" id="1646800">&amp;</span><span class="ident" id="1646801"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1646803">.</span><span class="ident" id="1646804"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1646808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646811">//&nbsp;Seq&nbsp;arg&nbsp;is&nbsp;seq&nbsp;when&nbsp;the&nbsp;timer&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646854">//&nbsp;If&nbsp;it&#39;s&nbsp;stale,&nbsp;ignore&nbsp;the&nbsp;timer&nbsp;event.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646897">if</span>&nbsp;<span class="ident" id="1646900"><a href="/gostd/runtime/netpoll.go.html#1646761">seq</a></span>&nbsp;<span class="op" id="1646904">!=</span>&nbsp;<span class="ident" id="1646907"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1646909">.</span><span class="ident" id="1646910"><a href="/gostd/runtime/netpoll.go.html#1639254">seq</a></span>&nbsp;<span class="op" id="1646914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1646918">//&nbsp;The&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1646971"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1646977">(</span><span class="op" id="1646978">&amp;</span><span class="ident" id="1646979"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1646981">.</span><span class="ident" id="1646982"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1646986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1646990">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1646998">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647001">var</span>&nbsp;<span class="ident" id="1647005">rg</span>&nbsp;<span class="op" id="1647008">*</span><span class="ident" id="1647009"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647012">if</span>&nbsp;<span class="ident" id="1647015"><a href="/gostd/runtime/netpoll.go.html#1646774">read</a></span>&nbsp;<span class="op" id="1647020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647024">if</span>&nbsp;<span class="ident" id="1647027"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647029">.</span><span class="ident" id="1647030"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1647033">&lt;=</span>&nbsp;<span class="num" id="1647036">0</span>&nbsp;<span class="op" id="1647038">||</span>&nbsp;<span class="ident" id="1647041"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647043">.</span><span class="ident" id="1647044"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1647046">.</span><span class="ident" id="1647047"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1647049">==</span>&nbsp;<span class="builtintype" id="1647052">nil</span>&nbsp;<span class="op" id="1647056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647061"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1647068">(</span><span class="string" id="1647069">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;read&nbsp;deadline&#34;</span><span class="op" id="1647118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647122">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647126"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647128">.</span><span class="ident" id="1647129"><a href="/gostd/runtime/netpoll.go.html#1639470">rd</a></span>&nbsp;<span class="op" id="1647132">=</span>&nbsp;<span class="op" id="1647134">-</span><span class="num" id="1647135">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647139"><a href="/gostd/runtime/atomic.go.html#1481731">atomicstorep</a></span><span class="op" id="1647151">(</span><span class="ident" id="1647152"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1647158">.</span><span class="ident" id="1647159">Pointer</span><span class="op" id="1647166">(</span><span class="op" id="1647167">&amp;</span><span class="ident" id="1647168"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647170">.</span><span class="ident" id="1647171"><a href="/gostd/runtime/netpoll.go.html#1639402">rt</a></span><span class="op" id="1647173">.</span><span class="ident" id="1647174"><a href="/gostd/runtime/time.go.html#1757478">f</a></span><span class="op" id="1647175">)</span><span class="op" id="1647176">,</span>&nbsp;<span class="builtintype" id="1647178">nil</span><span class="op" id="1647181">)</span>&nbsp;<span class="comment" id="1647183">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;rd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647261"><a href="/gostd/runtime/netpoll.go.html#1647005">rg</a></span>&nbsp;<span class="op" id="1647264">=</span>&nbsp;<span class="ident" id="1647266"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1647280">(</span><span class="ident" id="1647281"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647283">,</span>&nbsp;<span class="string" id="1647285">&#39;r&#39;</span><span class="op" id="1647288">,</span>&nbsp;<span class="builtintype" id="1647290">false</span><span class="op" id="1647295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647301">var</span>&nbsp;<span class="ident" id="1647305">wg</span>&nbsp;<span class="op" id="1647308">*</span><span class="ident" id="1647309"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647312">if</span>&nbsp;<span class="ident" id="1647315"><a href="/gostd/runtime/netpoll.go.html#1646780">write</a></span>&nbsp;<span class="op" id="1647321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647325">if</span>&nbsp;<span class="ident" id="1647328"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647330">.</span><span class="ident" id="1647331"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1647334">&lt;=</span>&nbsp;<span class="num" id="1647337">0</span>&nbsp;<span class="op" id="1647339">||</span>&nbsp;<span class="ident" id="1647342"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647344">.</span><span class="ident" id="1647345"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1647347">.</span><span class="ident" id="1647348"><a href="/gostd/runtime/time.go.html#1757478">f</a></span>&nbsp;<span class="op" id="1647350">==</span>&nbsp;<span class="builtintype" id="1647353">nil</span>&nbsp;<span class="op" id="1647357">&amp;&amp;</span>&nbsp;<span class="op" id="1647360">!</span><span class="ident" id="1647361"><a href="/gostd/runtime/netpoll.go.html#1646774">read</a></span>&nbsp;<span class="op" id="1647366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647371"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1647378">(</span><span class="string" id="1647379">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;write&nbsp;deadline&#34;</span><span class="op" id="1647429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647437"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647439">.</span><span class="ident" id="1647440"><a href="/gostd/runtime/netpoll.go.html#1639630">wd</a></span>&nbsp;<span class="op" id="1647443">=</span>&nbsp;<span class="op" id="1647445">-</span><span class="num" id="1647446">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647450"><a href="/gostd/runtime/atomic.go.html#1481731">atomicstorep</a></span><span class="op" id="1647462">(</span><span class="ident" id="1647463"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1647469">.</span><span class="ident" id="1647470">Pointer</span><span class="op" id="1647477">(</span><span class="op" id="1647478">&amp;</span><span class="ident" id="1647479"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647481">.</span><span class="ident" id="1647482"><a href="/gostd/runtime/netpoll.go.html#1639582">wt</a></span><span class="op" id="1647484">.</span><span class="ident" id="1647485"><a href="/gostd/runtime/time.go.html#1757478">f</a></span><span class="op" id="1647486">)</span><span class="op" id="1647487">,</span>&nbsp;<span class="builtintype" id="1647489">nil</span><span class="op" id="1647492">)</span>&nbsp;<span class="comment" id="1647494">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;wd&nbsp;and&nbsp;load&nbsp;of&nbsp;wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647572"><a href="/gostd/runtime/netpoll.go.html#1647305">wg</a></span>&nbsp;<span class="op" id="1647575">=</span>&nbsp;<span class="ident" id="1647577"><a href="/gostd/runtime/netpoll.go.html#1646210">netpollunblock</a></span><span class="op" id="1647591">(</span><span class="ident" id="1647592"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647594">,</span>&nbsp;<span class="string" id="1647596">&#39;w&#39;</span><span class="op" id="1647599">,</span>&nbsp;<span class="builtintype" id="1647601">false</span><span class="op" id="1647606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647612"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1647618">(</span><span class="op" id="1647619">&amp;</span><span class="ident" id="1647620"><a href="/gostd/runtime/netpoll.go.html#1646747">pd</a></span><span class="op" id="1647622">.</span><span class="ident" id="1647623"><a href="/gostd/runtime/netpoll.go.html#1639174">lock</a></span><span class="op" id="1647627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647630">if</span>&nbsp;<span class="ident" id="1647633"><a href="/gostd/runtime/netpoll.go.html#1647005">rg</a></span>&nbsp;<span class="op" id="1647636">!=</span>&nbsp;<span class="builtintype" id="1647639">nil</span>&nbsp;<span class="op" id="1647643">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647647"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1647654">(</span><span class="ident" id="1647655"><a href="/gostd/runtime/netpoll.go.html#1647005">rg</a></span><span class="op" id="1647657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1647663">if</span>&nbsp;<span class="ident" id="1647666"><a href="/gostd/runtime/netpoll.go.html#1647305">wg</a></span>&nbsp;<span class="op" id="1647669">!=</span>&nbsp;<span class="builtintype" id="1647672">nil</span>&nbsp;<span class="op" id="1647676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647680"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1647687">(</span><span class="ident" id="1647688"><a href="/gostd/runtime/netpoll.go.html#1647305">wg</a></span><span class="op" id="1647690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1647693">}</span><br>
<span class="lineno">420</span><span class="op" id="1647695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1647698">func</span>&nbsp;<span class="ident" id="1647703">netpollDeadline</span><span class="op" id="1647718">(</span><span class="ident" id="1647719">arg</span>&nbsp;<span class="keyword" id="1647723">interface</span><span class="op" id="1647732">{</span><span class="op" id="1647733">}</span><span class="op" id="1647734">,</span>&nbsp;<span class="ident" id="1647736">seq</span>&nbsp;<span class="builtintype" id="1647740">uintptr</span><span class="op" id="1647747">)</span>&nbsp;<span class="op" id="1647749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647752"><a href="/gostd/runtime/netpoll.go.html#1646727">netpolldeadlineimpl</a></span><span class="op" id="1647771">(</span><span class="ident" id="1647772"><a href="/gostd/runtime/netpoll.go.html#1647719">arg</a></span><span class="op" id="1647775">.</span><span class="op" id="1647776">(</span><span class="op" id="1647777">*</span><span class="ident" id="1647778"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1647786">)</span><span class="op" id="1647787">,</span>&nbsp;<span class="ident" id="1647789"><a href="/gostd/runtime/netpoll.go.html#1647736">seq</a></span><span class="op" id="1647792">,</span>&nbsp;<span class="builtintype" id="1647794">true</span><span class="op" id="1647798">,</span>&nbsp;<span class="builtintype" id="1647800">true</span><span class="op" id="1647804">)</span><br>
<span class="lineno"></span><span class="op" id="1647806">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="1647809">func</span>&nbsp;<span class="ident" id="1647814">netpollReadDeadline</span><span class="op" id="1647833">(</span><span class="ident" id="1647834">arg</span>&nbsp;<span class="keyword" id="1647838">interface</span><span class="op" id="1647847">{</span><span class="op" id="1647848">}</span><span class="op" id="1647849">,</span>&nbsp;<span class="ident" id="1647851">seq</span>&nbsp;<span class="builtintype" id="1647855">uintptr</span><span class="op" id="1647862">)</span>&nbsp;<span class="op" id="1647864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647867"><a href="/gostd/runtime/netpoll.go.html#1646727">netpolldeadlineimpl</a></span><span class="op" id="1647886">(</span><span class="ident" id="1647887"><a href="/gostd/runtime/netpoll.go.html#1647834">arg</a></span><span class="op" id="1647890">.</span><span class="op" id="1647891">(</span><span class="op" id="1647892">*</span><span class="ident" id="1647893"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1647901">)</span><span class="op" id="1647902">,</span>&nbsp;<span class="ident" id="1647904"><a href="/gostd/runtime/netpoll.go.html#1647851">seq</a></span><span class="op" id="1647907">,</span>&nbsp;<span class="builtintype" id="1647909">true</span><span class="op" id="1647913">,</span>&nbsp;<span class="builtintype" id="1647915">false</span><span class="op" id="1647920">)</span><br>
<span class="lineno"></span><span class="op" id="1647922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="1647925">func</span>&nbsp;<span class="ident" id="1647930">netpollWriteDeadline</span><span class="op" id="1647950">(</span><span class="ident" id="1647951">arg</span>&nbsp;<span class="keyword" id="1647955">interface</span><span class="op" id="1647964">{</span><span class="op" id="1647965">}</span><span class="op" id="1647966">,</span>&nbsp;<span class="ident" id="1647968">seq</span>&nbsp;<span class="builtintype" id="1647972">uintptr</span><span class="op" id="1647979">)</span>&nbsp;<span class="op" id="1647981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1647984"><a href="/gostd/runtime/netpoll.go.html#1646727">netpolldeadlineimpl</a></span><span class="op" id="1648003">(</span><span class="ident" id="1648004"><a href="/gostd/runtime/netpoll.go.html#1647951">arg</a></span><span class="op" id="1648007">.</span><span class="op" id="1648008">(</span><span class="op" id="1648009">*</span><span class="ident" id="1648010"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1648018">)</span><span class="op" id="1648019">,</span>&nbsp;<span class="ident" id="1648021"><a href="/gostd/runtime/netpoll.go.html#1647968">seq</a></span><span class="op" id="1648024">,</span>&nbsp;<span class="builtintype" id="1648026">false</span><span class="op" id="1648031">,</span>&nbsp;<span class="builtintype" id="1648033">true</span><span class="op" id="1648037">)</span><br>
<span class="lineno"></span><span class="op" id="1648039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648042">func</span>&nbsp;<span class="op" id="1648047">(</span><span class="ident" id="1648048">c</span>&nbsp;<span class="op" id="1648050">*</span><span class="ident" id="1648051"><a href="/gostd/runtime/netpoll.go.html#1639727">pollCache</a></span><span class="op" id="1648060">)</span>&nbsp;<span class="ident" id="1648062">alloc</span><span class="op" id="1648067">(</span><span class="op" id="1648068">)</span>&nbsp;<span class="op" id="1648070">*</span><span class="ident" id="1648071"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span>&nbsp;<span class="op" id="1648080">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648083"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1648087">(</span><span class="op" id="1648088">&amp;</span><span class="ident" id="1648089"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648090">.</span><span class="ident" id="1648091"><a href="/gostd/runtime/netpoll.go.html#1639747">lock</a></span><span class="op" id="1648095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1648098">if</span>&nbsp;<span class="ident" id="1648101"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648102">.</span><span class="ident" id="1648103"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span>&nbsp;<span class="op" id="1648109">==</span>&nbsp;<span class="builtintype" id="1648112">nil</span>&nbsp;<span class="op" id="1648116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1648120">const</span>&nbsp;<span class="ident" id="1648126">pdSize</span>&nbsp;<span class="op" id="1648133">=</span>&nbsp;<span class="ident" id="1648135"><a href="/gostd/runtime/netpoll.go.html#1637142">unsafe</a></span><span class="op" id="1648141">.</span><span class="ident" id="1648142">Sizeof</span><span class="op" id="1648148">(</span><span class="ident" id="1648149"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1648157">{</span><span class="op" id="1648158">}</span><span class="op" id="1648159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648163">n</span>&nbsp;<span class="op" id="1648165">:=</span>&nbsp;<span class="ident" id="1648168"><a href="/gostd/runtime/netpoll.go.html#1638503">pollBlockSize</a></span>&nbsp;<span class="op" id="1648182">/</span>&nbsp;<span class="ident" id="1648184"><a href="/gostd/runtime/netpoll.go.html#1648126">pdSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1648193">if</span>&nbsp;<span class="ident" id="1648196"><a href="/gostd/runtime/netpoll.go.html#1648163">n</a></span>&nbsp;<span class="op" id="1648198">==</span>&nbsp;<span class="num" id="1648201">0</span>&nbsp;<span class="op" id="1648203">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648208"><a href="/gostd/runtime/netpoll.go.html#1648163">n</a></span>&nbsp;<span class="op" id="1648210">=</span>&nbsp;<span class="num" id="1648212">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1648216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1648220">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;non-GC&nbsp;memory&nbsp;because&nbsp;can&nbsp;be&nbsp;referenced</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1648276">//&nbsp;only&nbsp;from&nbsp;epoll/kqueue&nbsp;internals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648315">mem</span>&nbsp;<span class="op" id="1648319">:=</span>&nbsp;<span class="ident" id="1648322"><a href="/gostd/runtime/malloc.go.html#1612082">persistentalloc</a></span><span class="op" id="1648337">(</span><span class="ident" id="1648338"><a href="/gostd/runtime/netpoll.go.html#1648163">n</a></span><span class="op" id="1648339">*</span><span class="ident" id="1648340"><a href="/gostd/runtime/netpoll.go.html#1648126">pdSize</a></span><span class="op" id="1648346">,</span>&nbsp;<span class="num" id="1648348">0</span><span class="op" id="1648349">,</span>&nbsp;<span class="op" id="1648351">&amp;</span><span class="ident" id="1648352"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1648360">.</span><span class="ident" id="1648361"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792858">other_sys</a></span><span class="op" id="1648370">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1648374">for</span>&nbsp;<span class="ident" id="1648378">i</span>&nbsp;<span class="op" id="1648380">:=</span>&nbsp;<span class="builtintype" id="1648383">uintptr</span><span class="op" id="1648390">(</span><span class="num" id="1648391">0</span><span class="op" id="1648392">)</span><span class="op" id="1648393">;</span>&nbsp;<span class="ident" id="1648395"><a href="/gostd/runtime/netpoll.go.html#1648378">i</a></span>&nbsp;<span class="op" id="1648397">&lt;</span>&nbsp;<span class="ident" id="1648399"><a href="/gostd/runtime/netpoll.go.html#1648163">n</a></span><span class="op" id="1648400">;</span>&nbsp;<span class="ident" id="1648402"><a href="/gostd/runtime/netpoll.go.html#1648378">i</a></span><span class="op" id="1648403">++</span>&nbsp;<span class="op" id="1648406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648411">pd</span>&nbsp;<span class="op" id="1648414">:=</span>&nbsp;<span class="op" id="1648417">(</span><span class="op" id="1648418">*</span><span class="ident" id="1648419"><a href="/gostd/runtime/netpoll.go.html#1638564">pollDesc</a></span><span class="op" id="1648427">)</span><span class="op" id="1648428">(</span><span class="ident" id="1648429"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1648432">(</span><span class="ident" id="1648433"><a href="/gostd/runtime/netpoll.go.html#1648315">mem</a></span><span class="op" id="1648436">,</span>&nbsp;<span class="ident" id="1648438"><a href="/gostd/runtime/netpoll.go.html#1648378">i</a></span><span class="op" id="1648439">*</span><span class="ident" id="1648440"><a href="/gostd/runtime/netpoll.go.html#1648126">pdSize</a></span><span class="op" id="1648446">)</span><span class="op" id="1648447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648452"><a href="/gostd/runtime/netpoll.go.html#1648411">pd</a></span><span class="op" id="1648454">.</span><span class="ident" id="1648455"><a href="/gostd/runtime/netpoll.go.html#1638583">link</a></span>&nbsp;<span class="op" id="1648460">=</span>&nbsp;<span class="ident" id="1648462"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648463">.</span><span class="ident" id="1648464"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648473"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648474">.</span><span class="ident" id="1648475"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span>&nbsp;<span class="op" id="1648481">=</span>&nbsp;<span class="ident" id="1648483"><a href="/gostd/runtime/netpoll.go.html#1648411">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1648488">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1648491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648494">pd</span>&nbsp;<span class="op" id="1648497">:=</span>&nbsp;<span class="ident" id="1648500"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648501">.</span><span class="ident" id="1648502"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648509"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648510">.</span><span class="ident" id="1648511"><a href="/gostd/runtime/netpoll.go.html#1639760">first</a></span>&nbsp;<span class="op" id="1648517">=</span>&nbsp;<span class="ident" id="1648519"><a href="/gostd/runtime/netpoll.go.html#1648494">pd</a></span><span class="op" id="1648521">.</span><span class="ident" id="1648522"><a href="/gostd/runtime/netpoll.go.html#1638583">link</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1648528"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1648534">(</span><span class="op" id="1648535">&amp;</span><span class="ident" id="1648536"><a href="/gostd/runtime/netpoll.go.html#1648048">c</a></span><span class="op" id="1648537">.</span><span class="ident" id="1648538"><a href="/gostd/runtime/netpoll.go.html#1639747">lock</a></span><span class="op" id="1648542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1648545">return</span>&nbsp;<span class="ident" id="1648552"><a href="/gostd/runtime/netpoll.go.html#1648494">pd</a></span><br>
<span class="lineno">455</span><span class="op" id="1648555">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
