<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html" class="current">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6350710">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6350765">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6350819">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6350870">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6350944">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6351030">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6351071">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6351103">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6351184">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6351235">//</span><br>
<span class="lineno"></span><span class="comment" id="6351238">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6351323">//</span><br>
<span class="lineno"></span><span class="comment" id="6351326">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6351400">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6351478">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6351553">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6351629">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6351696">//</span><br>
<span class="lineno">20</span><span class="comment" id="6351699">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6351771">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6351804">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6351850">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6351882">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6351936">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6351949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6351964">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6351973">//</span><br>
<span class="lineno"></span><span class="comment" id="6351976">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6351990">//</span><br>
<span class="lineno"></span><span class="comment" id="6351993">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6352018">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6352055">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6352132">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6352197">//</span><br>
<span class="lineno"></span><span class="comment" id="6352200">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6352247">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6352310">//</span><br>
<span class="lineno"></span><span class="comment" id="6352313">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6352361">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6352404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6352442">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6352478">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6352491">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6352500">//</span><br>
<span class="lineno"></span><span class="comment" id="6352503">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6352565">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6352646">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6352695">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6352742">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6352815">//</span><br>
<span class="lineno"></span><span class="comment" id="6352818">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6352889">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6352906">//</span><br>
<span class="lineno">55</span><span class="comment" id="6352909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6352953">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6352980">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6353006">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6353044">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6353069">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6353082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6353091">//</span><br>
<span class="lineno"></span><span class="comment" id="6353094">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6353172">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6353253">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6353279">//</span><br>
<span class="lineno"></span><span class="comment" id="6353282">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6353336">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6353415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6353463">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6353499">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6353530">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6353561">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6353609">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6353626">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6353640">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6353649">//</span><br>
<span class="lineno"></span><span class="comment" id="6353652">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6353664">//</span><br>
<span class="lineno">80</span><span class="comment" id="6353667">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6353741">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6353826">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6353905">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6353979">//</span><br>
<span class="lineno">85</span><span class="comment" id="6353982">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6354011">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6354047">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6354079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354088">//</span><br>
<span class="lineno">90</span><span class="comment" id="6354091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6354126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6354167">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6354205">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6354231">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6354260">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6354286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354295">//</span><br>
<span class="lineno"></span><span class="comment" id="6354298">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6354374">//</span><br>
<span class="lineno">100</span><span class="comment" id="6354377">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6354466">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6354493">//</span><br>
<span class="lineno"></span><span class="comment" id="6354496">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354526">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6354557">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354621">//</span><br>
<span class="lineno"></span><span class="comment" id="6354624">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6354708">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6354781">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6354803">//</span><br>
<span class="lineno"></span><span class="comment" id="6354806">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354843">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354881">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6354919">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6354959">//</span><br>
<span class="lineno"></span><span class="comment" id="6354962">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6355040">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6355118">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6355170">//</span><br>
<span class="lineno"></span><span class="comment" id="6355173">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6355181">//</span><br>
<span class="lineno"></span><span class="comment" id="6355184">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6355262">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6355343">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6355416">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6355455">//</span><br>
<span class="lineno"></span><span class="comment" id="6355458">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6355489">//</span><br>
<span class="lineno">130</span><span class="comment" id="6355492">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6355570">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6355645">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6355718">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6355755">//</span><br>
<span class="lineno">135</span><span class="comment" id="6355758">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6355804">//</span><br>
<span class="lineno"></span><span class="comment" id="6355807">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6355859">//</span><br>
<span class="lineno"></span><span class="comment" id="6355862">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6355948">package</span>&nbsp;<span class="ident" id="6355956">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6355965">import</span>&nbsp;<span class="op" id="6355972">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6355975">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6355984">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6355992">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6355999">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356005">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356016">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356033">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356044">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356055">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6356063">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6356070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6356073">var</span>&nbsp;<span class="op" id="6356077">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356080">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356159">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356236">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356314">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356391">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356421">short</span>&nbsp;<span class="op" id="6356427">=</span>&nbsp;<span class="ident" id="6356429">flag</span><span class="op" id="6356433">.</span><span class="ident" id="6356434">Bool</span><span class="op" id="6356438">(</span><span class="string" id="6356439">&#34;test.short&#34;</span><span class="op" id="6356451">,</span>&nbsp;<span class="builtintype" id="6356453">false</span><span class="op" id="6356458">,</span>&nbsp;<span class="string" id="6356460">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6356497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356501">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356580">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356659">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356746">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356780">outputDir</span>&nbsp;<span class="op" id="6356790">=</span>&nbsp;<span class="ident" id="6356792">flag</span><span class="op" id="6356796">.</span><span class="ident" id="6356797">String</span><span class="op" id="6356803">(</span><span class="string" id="6356804">&#34;test.outputdir&#34;</span><span class="op" id="6356820">,</span>&nbsp;<span class="string" id="6356822">&#34;&#34;</span><span class="op" id="6356824">,</span>&nbsp;<span class="string" id="6356826">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6356864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356868">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356928">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6356945">=</span>&nbsp;<span class="ident" id="6356947">flag</span><span class="op" id="6356951">.</span><span class="ident" id="6356952">Bool</span><span class="op" id="6356956">(</span><span class="string" id="6356957">&#34;test.v&#34;</span><span class="op" id="6356965">,</span>&nbsp;<span class="builtintype" id="6356967">false</span><span class="op" id="6356972">,</span>&nbsp;<span class="string" id="6356974">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6357008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357011">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357028">=</span>&nbsp;<span class="ident" id="6357030">flag</span><span class="op" id="6357034">.</span><span class="ident" id="6357035">String</span><span class="op" id="6357041">(</span><span class="string" id="6357042">&#34;test.coverprofile&#34;</span><span class="op" id="6357061">,</span>&nbsp;<span class="string" id="6357063">&#34;&#34;</span><span class="op" id="6357065">,</span>&nbsp;<span class="string" id="6357067">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6357127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357130">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357147">=</span>&nbsp;<span class="ident" id="6357149">flag</span><span class="op" id="6357153">.</span><span class="ident" id="6357154">String</span><span class="op" id="6357160">(</span><span class="string" id="6357161">&#34;test.run&#34;</span><span class="op" id="6357171">,</span>&nbsp;<span class="string" id="6357173">&#34;&#34;</span><span class="op" id="6357175">,</span>&nbsp;<span class="string" id="6357177">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6357233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357236">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357253">=</span>&nbsp;<span class="ident" id="6357255">flag</span><span class="op" id="6357259">.</span><span class="ident" id="6357260">String</span><span class="op" id="6357266">(</span><span class="string" id="6357267">&#34;test.memprofile&#34;</span><span class="op" id="6357284">,</span>&nbsp;<span class="string" id="6357286">&#34;&#34;</span><span class="op" id="6357288">,</span>&nbsp;<span class="string" id="6357290">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6357348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357351">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6357368">=</span>&nbsp;<span class="ident" id="6357370">flag</span><span class="op" id="6357374">.</span><span class="ident" id="6357375">Int</span><span class="op" id="6357378">(</span><span class="string" id="6357379">&#34;test.memprofilerate&#34;</span><span class="op" id="6357400">,</span>&nbsp;<span class="num" id="6357402">0</span><span class="op" id="6357403">,</span>&nbsp;<span class="string" id="6357405">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6357442">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357445">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357462">=</span>&nbsp;<span class="ident" id="6357464">flag</span><span class="op" id="6357468">.</span><span class="ident" id="6357469">String</span><span class="op" id="6357475">(</span><span class="string" id="6357476">&#34;test.cpuprofile&#34;</span><span class="op" id="6357493">,</span>&nbsp;<span class="string" id="6357495">&#34;&#34;</span><span class="op" id="6357497">,</span>&nbsp;<span class="string" id="6357499">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6357555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357558">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357575">=</span>&nbsp;<span class="ident" id="6357577">flag</span><span class="op" id="6357581">.</span><span class="ident" id="6357582">String</span><span class="op" id="6357588">(</span><span class="string" id="6357589">&#34;test.blockprofile&#34;</span><span class="op" id="6357608">,</span>&nbsp;<span class="string" id="6357610">&#34;&#34;</span><span class="op" id="6357612">,</span>&nbsp;<span class="string" id="6357614">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6357684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357687">blockProfileRate</span>&nbsp;<span class="op" id="6357704">=</span>&nbsp;<span class="ident" id="6357706">flag</span><span class="op" id="6357710">.</span><span class="ident" id="6357711">Int</span><span class="op" id="6357714">(</span><span class="string" id="6357715">&#34;test.blockprofilerate&#34;</span><span class="op" id="6357738">,</span>&nbsp;<span class="num" id="6357740">1</span><span class="op" id="6357741">,</span>&nbsp;<span class="string" id="6357743">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6357789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357792">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357809">=</span>&nbsp;<span class="ident" id="6357811">flag</span><span class="op" id="6357815">.</span><span class="ident" id="6357816">Duration</span><span class="op" id="6357824">(</span><span class="string" id="6357825">&#34;test.timeout&#34;</span><span class="op" id="6357839">,</span>&nbsp;<span class="num" id="6357841">0</span><span class="op" id="6357842">,</span>&nbsp;<span class="string" id="6357844">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6357901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357904">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6357921">=</span>&nbsp;<span class="ident" id="6357923">flag</span><span class="op" id="6357927">.</span><span class="ident" id="6357928">String</span><span class="op" id="6357934">(</span><span class="string" id="6357935">&#34;test.cpu&#34;</span><span class="op" id="6357945">,</span>&nbsp;<span class="string" id="6357947">&#34;&#34;</span><span class="op" id="6357949">,</span>&nbsp;<span class="string" id="6357951">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6358012">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358015">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6358032">=</span>&nbsp;<span class="ident" id="6358034">flag</span><span class="op" id="6358038">.</span><span class="ident" id="6358039">Int</span><span class="op" id="6358042">(</span><span class="string" id="6358043">&#34;test.parallel&#34;</span><span class="op" id="6358058">,</span>&nbsp;<span class="ident" id="6358060">runtime</span><span class="op" id="6358067">.</span><span class="ident" id="6358068">GOMAXPROCS</span><span class="op" id="6358078">(</span><span class="num" id="6358079">0</span><span class="op" id="6358080">)</span><span class="op" id="6358081">,</span>&nbsp;<span class="string" id="6358083">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6358109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358113">haveExamples</span>&nbsp;<span class="builtintype" id="6358126">bool</span>&nbsp;<span class="comment" id="6358131">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358156">cpuList</span>&nbsp;<span class="op" id="6358164">[</span><span class="op" id="6358165">]</span><span class="builtintype" id="6358166">int</span><br>
<span class="lineno">185</span><span class="op" id="6358170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358173">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6358229">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6358272">type</span>&nbsp;<span class="ident" id="6358277">common</span>&nbsp;<span class="keyword" id="6358284">struct</span>&nbsp;<span class="op" id="6358291">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358294">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6358303">sync</span><span class="op" id="6358307">.</span><span class="ident" id="6358308">RWMutex</span>&nbsp;<span class="comment" id="6358316">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358345">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6358354">[</span><span class="op" id="6358355">]</span><span class="builtintype" id="6358356">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6358367">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358410">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6358419">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6358432">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358466">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6358475">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6358488">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358528">finished</span>&nbsp;<span class="builtintype" id="6358537">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358544">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6358553">time</span><span class="op" id="6358557">.</span><span class="ident" id="6358558">Time</span>&nbsp;<span class="comment" id="6358563">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358598">duration</span>&nbsp;<span class="ident" id="6358607">time</span><span class="op" id="6358611">.</span><span class="ident" id="6358612">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358622">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6358631">interface</span><span class="op" id="6358640">{</span><span class="op" id="6358641">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6358648">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358692">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6358701">chan</span>&nbsp;<span class="keyword" id="6358706">interface</span><span class="op" id="6358715">{</span><span class="op" id="6358716">}</span>&nbsp;<span class="comment" id="6358718">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6358746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358749">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6358803">func</span>&nbsp;<span class="ident" id="6358808">Short</span><span class="op" id="6358813">(</span><span class="op" id="6358814">)</span>&nbsp;<span class="builtintype" id="6358816">bool</span>&nbsp;<span class="op" id="6358821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358824">return</span>&nbsp;<span class="op" id="6358831">*</span><span class="ident" id="6358832">short</span><br>
<span class="lineno">205</span><span class="op" id="6358838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358841">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6358893">func</span>&nbsp;<span class="ident" id="6358898">Verbose</span><span class="op" id="6358905">(</span><span class="op" id="6358906">)</span>&nbsp;<span class="builtintype" id="6358908">bool</span>&nbsp;<span class="op" id="6358913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358916">return</span>&nbsp;<span class="op" id="6358923">*</span><span class="ident" id="6358924">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6358931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358934">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6359006">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6359086">func</span>&nbsp;<span class="ident" id="6359091">decorate</span><span class="op" id="6359099">(</span><span class="ident" id="6359100">s</span>&nbsp;<span class="builtintype" id="6359102">string</span><span class="op" id="6359108">)</span>&nbsp;<span class="builtintype" id="6359110">string</span>&nbsp;<span class="op" id="6359117">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359120">_</span><span class="op" id="6359121">,</span>&nbsp;<span class="ident" id="6359123">file</span><span class="op" id="6359127">,</span>&nbsp;<span class="ident" id="6359129">line</span><span class="op" id="6359133">,</span>&nbsp;<span class="ident" id="6359135">ok</span>&nbsp;<span class="op" id="6359138">:=</span>&nbsp;<span class="ident" id="6359141">runtime</span><span class="op" id="6359148">.</span><span class="ident" id="6359149">Caller</span><span class="op" id="6359155">(</span><span class="num" id="6359156">3</span><span class="op" id="6359157">)</span>&nbsp;<span class="comment" id="6359159">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359197">if</span>&nbsp;<span class="ident" id="6359200">ok</span>&nbsp;<span class="op" id="6359203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359207">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359260">if</span>&nbsp;<span class="ident" id="6359263">index</span>&nbsp;<span class="op" id="6359269">:=</span>&nbsp;<span class="ident" id="6359272">strings</span><span class="op" id="6359279">.</span><span class="ident" id="6359280">LastIndex</span><span class="op" id="6359289">(</span><span class="ident" id="6359290">file</span><span class="op" id="6359294">,</span>&nbsp;<span class="string" id="6359296">&#34;/&#34;</span><span class="op" id="6359299">)</span><span class="op" id="6359300">;</span>&nbsp;<span class="ident" id="6359302">index</span>&nbsp;<span class="op" id="6359308">&gt;=</span>&nbsp;<span class="num" id="6359311">0</span>&nbsp;<span class="op" id="6359313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359318">file</span>&nbsp;<span class="op" id="6359323">=</span>&nbsp;<span class="ident" id="6359325">file</span><span class="op" id="6359329">[</span><span class="ident" id="6359330">index</span><span class="op" id="6359335">+</span><span class="num" id="6359336">1</span><span class="op" id="6359337">:</span><span class="op" id="6359338">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359342">}</span>&nbsp;<span class="keyword" id="6359344">else</span>&nbsp;<span class="keyword" id="6359349">if</span>&nbsp;<span class="ident" id="6359352">index</span>&nbsp;<span class="op" id="6359358">=</span>&nbsp;<span class="ident" id="6359360">strings</span><span class="op" id="6359367">.</span><span class="ident" id="6359368">LastIndex</span><span class="op" id="6359377">(</span><span class="ident" id="6359378">file</span><span class="op" id="6359382">,</span>&nbsp;<span class="string" id="6359384">&#34;\\&#34;</span><span class="op" id="6359388">)</span><span class="op" id="6359389">;</span>&nbsp;<span class="ident" id="6359391">index</span>&nbsp;<span class="op" id="6359397">&gt;=</span>&nbsp;<span class="num" id="6359400">0</span>&nbsp;<span class="op" id="6359402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359407">file</span>&nbsp;<span class="op" id="6359412">=</span>&nbsp;<span class="ident" id="6359414">file</span><span class="op" id="6359418">[</span><span class="ident" id="6359419">index</span><span class="op" id="6359424">+</span><span class="num" id="6359425">1</span><span class="op" id="6359426">:</span><span class="op" id="6359427">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359434">}</span>&nbsp;<span class="keyword" id="6359436">else</span>&nbsp;<span class="op" id="6359441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359445">file</span>&nbsp;<span class="op" id="6359450">=</span>&nbsp;<span class="string" id="6359452">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359460">line</span>&nbsp;<span class="op" id="6359465">=</span>&nbsp;<span class="num" id="6359467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359473">buf</span>&nbsp;<span class="op" id="6359477">:=</span>&nbsp;<span class="builtinfunc" id="6359480">new</span><span class="op" id="6359483">(</span><span class="ident" id="6359484">bytes</span><span class="op" id="6359489">.</span><span class="ident" id="6359490">Buffer</span><span class="op" id="6359496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359499">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359544">buf</span><span class="op" id="6359547">.</span><span class="ident" id="6359548">WriteByte</span><span class="op" id="6359557">(</span><span class="string" id="6359558">&#39;\t&#39;</span><span class="op" id="6359562">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359565">fmt</span><span class="op" id="6359568">.</span><span class="ident" id="6359569">Fprintf</span><span class="op" id="6359576">(</span><span class="ident" id="6359577">buf</span><span class="op" id="6359580">,</span>&nbsp;<span class="string" id="6359582">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6359591">,</span>&nbsp;<span class="ident" id="6359593">file</span><span class="op" id="6359597">,</span>&nbsp;<span class="ident" id="6359599">line</span><span class="op" id="6359603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359606">lines</span>&nbsp;<span class="op" id="6359612">:=</span>&nbsp;<span class="ident" id="6359615">strings</span><span class="op" id="6359622">.</span><span class="ident" id="6359623">Split</span><span class="op" id="6359628">(</span><span class="ident" id="6359629">s</span><span class="op" id="6359630">,</span>&nbsp;<span class="string" id="6359632">&#34;\n&#34;</span><span class="op" id="6359636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359639">if</span>&nbsp;<span class="ident" id="6359642">l</span>&nbsp;<span class="op" id="6359644">:=</span>&nbsp;<span class="builtinfunc" id="6359647">len</span><span class="op" id="6359650">(</span><span class="ident" id="6359651">lines</span><span class="op" id="6359656">)</span><span class="op" id="6359657">;</span>&nbsp;<span class="ident" id="6359659">l</span>&nbsp;<span class="op" id="6359661">&gt;</span>&nbsp;<span class="num" id="6359663">1</span>&nbsp;<span class="op" id="6359665">&amp;&amp;</span>&nbsp;<span class="ident" id="6359668">lines</span><span class="op" id="6359673">[</span><span class="ident" id="6359674">l</span><span class="op" id="6359675">-</span><span class="num" id="6359676">1</span><span class="op" id="6359677">]</span>&nbsp;<span class="op" id="6359679">==</span>&nbsp;<span class="string" id="6359682">&#34;&#34;</span>&nbsp;<span class="op" id="6359685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359689">lines</span>&nbsp;<span class="op" id="6359695">=</span>&nbsp;<span class="ident" id="6359697">lines</span><span class="op" id="6359702">[</span><span class="op" id="6359703">:</span><span class="ident" id="6359704">l</span><span class="op" id="6359705">-</span><span class="num" id="6359706">1</span><span class="op" id="6359707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359710">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359713">for</span>&nbsp;<span class="ident" id="6359717">i</span><span class="op" id="6359718">,</span>&nbsp;<span class="ident" id="6359720">line</span>&nbsp;<span class="op" id="6359725">:=</span>&nbsp;<span class="keyword" id="6359728">range</span>&nbsp;<span class="ident" id="6359734">lines</span>&nbsp;<span class="op" id="6359740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359744">if</span>&nbsp;<span class="ident" id="6359747">i</span>&nbsp;<span class="op" id="6359749">&gt;</span>&nbsp;<span class="num" id="6359751">0</span>&nbsp;<span class="op" id="6359753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359758">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359819">buf</span><span class="op" id="6359822">.</span><span class="ident" id="6359823">WriteString</span><span class="op" id="6359834">(</span><span class="string" id="6359835">&#34;\n\t\t&#34;</span><span class="op" id="6359843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359847">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359851">buf</span><span class="op" id="6359854">.</span><span class="ident" id="6359855">WriteString</span><span class="op" id="6359866">(</span><span class="ident" id="6359867">line</span><span class="op" id="6359871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359877">buf</span><span class="op" id="6359880">.</span><span class="ident" id="6359881">WriteByte</span><span class="op" id="6359890">(</span><span class="string" id="6359891">&#39;\n&#39;</span><span class="op" id="6359895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359898">return</span>&nbsp;<span class="ident" id="6359905">buf</span><span class="op" id="6359908">.</span><span class="ident" id="6359909">String</span><span class="op" id="6359915">(</span><span class="op" id="6359916">)</span><br>
<span class="lineno"></span><span class="op" id="6359918">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6359921">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6359990">func</span>&nbsp;<span class="ident" id="6359995">fmtDuration</span><span class="op" id="6360006">(</span><span class="ident" id="6360007">d</span>&nbsp;<span class="ident" id="6360009">time</span><span class="op" id="6360013">.</span><span class="ident" id="6360014">Duration</span><span class="op" id="6360022">)</span>&nbsp;<span class="builtintype" id="6360024">string</span>&nbsp;<span class="op" id="6360031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360034">return</span>&nbsp;<span class="ident" id="6360041">fmt</span><span class="op" id="6360044">.</span><span class="ident" id="6360045">Sprintf</span><span class="op" id="6360052">(</span><span class="string" id="6360053">&#34;%.2fs&#34;</span><span class="op" id="6360060">,</span>&nbsp;<span class="ident" id="6360062">d</span><span class="op" id="6360063">.</span><span class="ident" id="6360064">Seconds</span><span class="op" id="6360071">(</span><span class="op" id="6360072">)</span><span class="op" id="6360073">)</span><br>
<span class="lineno"></span><span class="op" id="6360075">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6360078">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6360120">type</span>&nbsp;<span class="ident" id="6360125">TB</span>&nbsp;<span class="keyword" id="6360128">interface</span>&nbsp;<span class="op" id="6360138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360141">Error</span><span class="op" id="6360146">(</span><span class="ident" id="6360147">args</span>&nbsp;<span class="op" id="6360152">...</span><span class="keyword" id="6360155">interface</span><span class="op" id="6360164">{</span><span class="op" id="6360165">}</span><span class="op" id="6360166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360169">Errorf</span><span class="op" id="6360175">(</span><span class="ident" id="6360176">format</span>&nbsp;<span class="builtintype" id="6360183">string</span><span class="op" id="6360189">,</span>&nbsp;<span class="ident" id="6360191">args</span>&nbsp;<span class="op" id="6360196">...</span><span class="keyword" id="6360199">interface</span><span class="op" id="6360208">{</span><span class="op" id="6360209">}</span><span class="op" id="6360210">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360213">Fail</span><span class="op" id="6360217">(</span><span class="op" id="6360218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360221">FailNow</span><span class="op" id="6360228">(</span><span class="op" id="6360229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360232">Failed</span><span class="op" id="6360238">(</span><span class="op" id="6360239">)</span>&nbsp;<span class="builtintype" id="6360241">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360247">Fatal</span><span class="op" id="6360252">(</span><span class="ident" id="6360253">args</span>&nbsp;<span class="op" id="6360258">...</span><span class="keyword" id="6360261">interface</span><span class="op" id="6360270">{</span><span class="op" id="6360271">}</span><span class="op" id="6360272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360275">Fatalf</span><span class="op" id="6360281">(</span><span class="ident" id="6360282">format</span>&nbsp;<span class="builtintype" id="6360289">string</span><span class="op" id="6360295">,</span>&nbsp;<span class="ident" id="6360297">args</span>&nbsp;<span class="op" id="6360302">...</span><span class="keyword" id="6360305">interface</span><span class="op" id="6360314">{</span><span class="op" id="6360315">}</span><span class="op" id="6360316">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360319">Log</span><span class="op" id="6360322">(</span><span class="ident" id="6360323">args</span>&nbsp;<span class="op" id="6360328">...</span><span class="keyword" id="6360331">interface</span><span class="op" id="6360340">{</span><span class="op" id="6360341">}</span><span class="op" id="6360342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360345">Logf</span><span class="op" id="6360349">(</span><span class="ident" id="6360350">format</span>&nbsp;<span class="builtintype" id="6360357">string</span><span class="op" id="6360363">,</span>&nbsp;<span class="ident" id="6360365">args</span>&nbsp;<span class="op" id="6360370">...</span><span class="keyword" id="6360373">interface</span><span class="op" id="6360382">{</span><span class="op" id="6360383">}</span><span class="op" id="6360384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360387">Skip</span><span class="op" id="6360391">(</span><span class="ident" id="6360392">args</span>&nbsp;<span class="op" id="6360397">...</span><span class="keyword" id="6360400">interface</span><span class="op" id="6360409">{</span><span class="op" id="6360410">}</span><span class="op" id="6360411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360414">SkipNow</span><span class="op" id="6360421">(</span><span class="op" id="6360422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360425">Skipf</span><span class="op" id="6360430">(</span><span class="ident" id="6360431">format</span>&nbsp;<span class="builtintype" id="6360438">string</span><span class="op" id="6360444">,</span>&nbsp;<span class="ident" id="6360446">args</span>&nbsp;<span class="op" id="6360451">...</span><span class="keyword" id="6360454">interface</span><span class="op" id="6360463">{</span><span class="op" id="6360464">}</span><span class="op" id="6360465">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360468">Skipped</span><span class="op" id="6360475">(</span><span class="op" id="6360476">)</span>&nbsp;<span class="builtintype" id="6360478">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6360485">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6360540">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6360593">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360625">private</span><span class="op" id="6360632">(</span><span class="op" id="6360633">)</span><br>
<span class="lineno"></span><span class="op" id="6360635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6360638">var</span>&nbsp;<span class="ident" id="6360642">_</span>&nbsp;<span class="ident" id="6360644">TB</span>&nbsp;<span class="op" id="6360647">=</span>&nbsp;<span class="op" id="6360649">(</span><span class="op" id="6360650">*</span><span class="ident" id="6360651">T</span><span class="op" id="6360652">)</span><span class="op" id="6360653">(</span><span class="ident" id="6360654">nil</span><span class="op" id="6360657">)</span><br>
<span class="lineno"></span><span class="keyword" id="6360659">var</span>&nbsp;<span class="ident" id="6360663">_</span>&nbsp;<span class="ident" id="6360665">TB</span>&nbsp;<span class="op" id="6360668">=</span>&nbsp;<span class="op" id="6360670">(</span><span class="op" id="6360671">*</span><span class="ident" id="6360672">B</span><span class="op" id="6360673">)</span><span class="op" id="6360674">(</span><span class="ident" id="6360675">nil</span><span class="op" id="6360678">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6360681">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6360775">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6360856">type</span>&nbsp;<span class="ident" id="6360861">T</span>&nbsp;<span class="keyword" id="6360863">struct</span>&nbsp;<span class="op" id="6360870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360873">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360881">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6360895">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6360905">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360923">startParallel</span>&nbsp;<span class="keyword" id="6360937">chan</span>&nbsp;<span class="builtintype" id="6360942">bool</span>&nbsp;<span class="comment" id="6360947">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6360984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6360987">func</span>&nbsp;<span class="op" id="6360992">(</span><span class="ident" id="6360993">c</span>&nbsp;<span class="op" id="6360995">*</span><span class="ident" id="6360996">common</span><span class="op" id="6361002">)</span>&nbsp;<span class="ident" id="6361004">private</span><span class="op" id="6361011">(</span><span class="op" id="6361012">)</span>&nbsp;<span class="op" id="6361014">{</span><span class="op" id="6361015">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6361018">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6361087">func</span>&nbsp;<span class="op" id="6361092">(</span><span class="ident" id="6361093">c</span>&nbsp;<span class="op" id="6361095">*</span><span class="ident" id="6361096">common</span><span class="op" id="6361102">)</span>&nbsp;<span class="ident" id="6361104">Fail</span><span class="op" id="6361108">(</span><span class="op" id="6361109">)</span>&nbsp;<span class="op" id="6361111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361114">c</span><span class="op" id="6361115">.</span><span class="ident" id="6361116">mu</span><span class="op" id="6361118">.</span><span class="ident" id="6361119">Lock</span><span class="op" id="6361123">(</span><span class="op" id="6361124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361127">defer</span>&nbsp;<span class="ident" id="6361133">c</span><span class="op" id="6361134">.</span><span class="ident" id="6361135">mu</span><span class="op" id="6361137">.</span><span class="ident" id="6361138">Unlock</span><span class="op" id="6361144">(</span><span class="op" id="6361145">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361148">c</span><span class="op" id="6361149">.</span><span class="ident" id="6361150">failed</span>&nbsp;<span class="op" id="6361157">=</span>&nbsp;<span class="builtintype" id="6361159">true</span><br>
<span class="lineno"></span><span class="op" id="6361164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6361167">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6361218">func</span>&nbsp;<span class="op" id="6361223">(</span><span class="ident" id="6361224">c</span>&nbsp;<span class="op" id="6361226">*</span><span class="ident" id="6361227">common</span><span class="op" id="6361233">)</span>&nbsp;<span class="ident" id="6361235">Failed</span><span class="op" id="6361241">(</span><span class="op" id="6361242">)</span>&nbsp;<span class="builtintype" id="6361244">bool</span>&nbsp;<span class="op" id="6361249">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361252">c</span><span class="op" id="6361253">.</span><span class="ident" id="6361254">mu</span><span class="op" id="6361256">.</span><span class="ident" id="6361257">RLock</span><span class="op" id="6361262">(</span><span class="op" id="6361263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361266">defer</span>&nbsp;<span class="ident" id="6361272">c</span><span class="op" id="6361273">.</span><span class="ident" id="6361274">mu</span><span class="op" id="6361276">.</span><span class="ident" id="6361277">RUnlock</span><span class="op" id="6361284">(</span><span class="op" id="6361285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361288">return</span>&nbsp;<span class="ident" id="6361295">c</span><span class="op" id="6361296">.</span><span class="ident" id="6361297">failed</span><br>
<span class="lineno"></span><span class="op" id="6361304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6361307">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6361379">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6361437">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6361494">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6361551">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6361609">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6361636">func</span>&nbsp;<span class="op" id="6361641">(</span><span class="ident" id="6361642">c</span>&nbsp;<span class="op" id="6361644">*</span><span class="ident" id="6361645">common</span><span class="op" id="6361651">)</span>&nbsp;<span class="ident" id="6361653">FailNow</span><span class="op" id="6361660">(</span><span class="op" id="6361661">)</span>&nbsp;<span class="op" id="6361663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361666">c</span><span class="op" id="6361667">.</span><span class="ident" id="6361668">Fail</span><span class="op" id="6361672">(</span><span class="op" id="6361673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361677">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361735">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361790">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361851">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361914">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361918">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361960">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361964">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361985">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362008">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362029">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362033">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362095">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362157">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362219">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362288">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362357">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362429">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362493">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362557">c</span><span class="op" id="6362558">.</span><span class="ident" id="6362559">finished</span>&nbsp;<span class="op" id="6362568">=</span>&nbsp;<span class="builtintype" id="6362570">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362576">runtime</span><span class="op" id="6362583">.</span><span class="ident" id="6362584">Goexit</span><span class="op" id="6362590">(</span><span class="op" id="6362591">)</span><br>
<span class="lineno">330</span><span class="op" id="6362593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6362596">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6362662">func</span>&nbsp;<span class="op" id="6362667">(</span><span class="ident" id="6362668">c</span>&nbsp;<span class="op" id="6362670">*</span><span class="ident" id="6362671">common</span><span class="op" id="6362677">)</span>&nbsp;<span class="ident" id="6362679">log</span><span class="op" id="6362682">(</span><span class="ident" id="6362683">s</span>&nbsp;<span class="builtintype" id="6362685">string</span><span class="op" id="6362691">)</span>&nbsp;<span class="op" id="6362693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362696">c</span><span class="op" id="6362697">.</span><span class="ident" id="6362698">mu</span><span class="op" id="6362700">.</span><span class="ident" id="6362701">Lock</span><span class="op" id="6362705">(</span><span class="op" id="6362706">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362709">defer</span>&nbsp;<span class="ident" id="6362715">c</span><span class="op" id="6362716">.</span><span class="ident" id="6362717">mu</span><span class="op" id="6362719">.</span><span class="ident" id="6362720">Unlock</span><span class="op" id="6362726">(</span><span class="op" id="6362727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362730">c</span><span class="op" id="6362731">.</span><span class="ident" id="6362732">output</span>&nbsp;<span class="op" id="6362739">=</span>&nbsp;<span class="builtinfunc" id="6362741">append</span><span class="op" id="6362747">(</span><span class="ident" id="6362748">c</span><span class="op" id="6362749">.</span><span class="ident" id="6362750">output</span><span class="op" id="6362756">,</span>&nbsp;<span class="ident" id="6362758">decorate</span><span class="op" id="6362766">(</span><span class="ident" id="6362767">s</span><span class="op" id="6362768">)</span><span class="op" id="6362769">...</span><span class="op" id="6362772">)</span><br>
<span class="lineno"></span><span class="op" id="6362774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6362777">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6362854">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6362929">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6362975">func</span>&nbsp;<span class="op" id="6362980">(</span><span class="ident" id="6362981">c</span>&nbsp;<span class="op" id="6362983">*</span><span class="ident" id="6362984">common</span><span class="op" id="6362990">)</span>&nbsp;<span class="ident" id="6362992">Log</span><span class="op" id="6362995">(</span><span class="ident" id="6362996">args</span>&nbsp;<span class="op" id="6363001">...</span><span class="keyword" id="6363004">interface</span><span class="op" id="6363013">{</span><span class="op" id="6363014">}</span><span class="op" id="6363015">)</span>&nbsp;<span class="op" id="6363017">{</span>&nbsp;<span class="ident" id="6363019">c</span><span class="op" id="6363020">.</span><span class="ident" id="6363021">log</span><span class="op" id="6363024">(</span><span class="ident" id="6363025">fmt</span><span class="op" id="6363028">.</span><span class="ident" id="6363029">Sprintln</span><span class="op" id="6363037">(</span><span class="ident" id="6363038">args</span><span class="op" id="6363042">...</span><span class="op" id="6363045">)</span><span class="op" id="6363046">)</span>&nbsp;<span class="op" id="6363048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363051">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6363127">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6363202">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6363248">func</span>&nbsp;<span class="op" id="6363253">(</span><span class="ident" id="6363254">c</span>&nbsp;<span class="op" id="6363256">*</span><span class="ident" id="6363257">common</span><span class="op" id="6363263">)</span>&nbsp;<span class="ident" id="6363265">Logf</span><span class="op" id="6363269">(</span><span class="ident" id="6363270">format</span>&nbsp;<span class="builtintype" id="6363277">string</span><span class="op" id="6363283">,</span>&nbsp;<span class="ident" id="6363285">args</span>&nbsp;<span class="op" id="6363290">...</span><span class="keyword" id="6363293">interface</span><span class="op" id="6363302">{</span><span class="op" id="6363303">}</span><span class="op" id="6363304">)</span>&nbsp;<span class="op" id="6363306">{</span>&nbsp;<span class="ident" id="6363308">c</span><span class="op" id="6363309">.</span><span class="ident" id="6363310">log</span><span class="op" id="6363313">(</span><span class="ident" id="6363314">fmt</span><span class="op" id="6363317">.</span><span class="ident" id="6363318">Sprintf</span><span class="op" id="6363325">(</span><span class="ident" id="6363326">format</span><span class="op" id="6363332">,</span>&nbsp;<span class="ident" id="6363334">args</span><span class="op" id="6363338">...</span><span class="op" id="6363341">)</span><span class="op" id="6363342">)</span>&nbsp;<span class="op" id="6363344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363347">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6363395">func</span>&nbsp;<span class="op" id="6363400">(</span><span class="ident" id="6363401">c</span>&nbsp;<span class="op" id="6363403">*</span><span class="ident" id="6363404">common</span><span class="op" id="6363410">)</span>&nbsp;<span class="ident" id="6363412">Error</span><span class="op" id="6363417">(</span><span class="ident" id="6363418">args</span>&nbsp;<span class="op" id="6363423">...</span><span class="keyword" id="6363426">interface</span><span class="op" id="6363435">{</span><span class="op" id="6363436">}</span><span class="op" id="6363437">)</span>&nbsp;<span class="op" id="6363439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363442">c</span><span class="op" id="6363443">.</span><span class="ident" id="6363444">log</span><span class="op" id="6363447">(</span><span class="ident" id="6363448">fmt</span><span class="op" id="6363451">.</span><span class="ident" id="6363452">Sprintln</span><span class="op" id="6363460">(</span><span class="ident" id="6363461">args</span><span class="op" id="6363465">...</span><span class="op" id="6363468">)</span><span class="op" id="6363469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363472">c</span><span class="op" id="6363473">.</span><span class="ident" id="6363474">Fail</span><span class="op" id="6363478">(</span><span class="op" id="6363479">)</span><br>
<span class="lineno"></span><span class="op" id="6363481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6363484">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6363534">func</span>&nbsp;<span class="op" id="6363539">(</span><span class="ident" id="6363540">c</span>&nbsp;<span class="op" id="6363542">*</span><span class="ident" id="6363543">common</span><span class="op" id="6363549">)</span>&nbsp;<span class="ident" id="6363551">Errorf</span><span class="op" id="6363557">(</span><span class="ident" id="6363558">format</span>&nbsp;<span class="builtintype" id="6363565">string</span><span class="op" id="6363571">,</span>&nbsp;<span class="ident" id="6363573">args</span>&nbsp;<span class="op" id="6363578">...</span><span class="keyword" id="6363581">interface</span><span class="op" id="6363590">{</span><span class="op" id="6363591">}</span><span class="op" id="6363592">)</span>&nbsp;<span class="op" id="6363594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363597">c</span><span class="op" id="6363598">.</span><span class="ident" id="6363599">log</span><span class="op" id="6363602">(</span><span class="ident" id="6363603">fmt</span><span class="op" id="6363606">.</span><span class="ident" id="6363607">Sprintf</span><span class="op" id="6363614">(</span><span class="ident" id="6363615">format</span><span class="op" id="6363621">,</span>&nbsp;<span class="ident" id="6363623">args</span><span class="op" id="6363627">...</span><span class="op" id="6363630">)</span><span class="op" id="6363631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363634">c</span><span class="op" id="6363635">.</span><span class="ident" id="6363636">Fail</span><span class="op" id="6363640">(</span><span class="op" id="6363641">)</span><br>
<span class="lineno"></span><span class="op" id="6363643">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6363646">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6363697">func</span>&nbsp;<span class="op" id="6363702">(</span><span class="ident" id="6363703">c</span>&nbsp;<span class="op" id="6363705">*</span><span class="ident" id="6363706">common</span><span class="op" id="6363712">)</span>&nbsp;<span class="ident" id="6363714">Fatal</span><span class="op" id="6363719">(</span><span class="ident" id="6363720">args</span>&nbsp;<span class="op" id="6363725">...</span><span class="keyword" id="6363728">interface</span><span class="op" id="6363737">{</span><span class="op" id="6363738">}</span><span class="op" id="6363739">)</span>&nbsp;<span class="op" id="6363741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363744">c</span><span class="op" id="6363745">.</span><span class="ident" id="6363746">log</span><span class="op" id="6363749">(</span><span class="ident" id="6363750">fmt</span><span class="op" id="6363753">.</span><span class="ident" id="6363754">Sprintln</span><span class="op" id="6363762">(</span><span class="ident" id="6363763">args</span><span class="op" id="6363767">...</span><span class="op" id="6363770">)</span><span class="op" id="6363771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363774">c</span><span class="op" id="6363775">.</span><span class="ident" id="6363776">FailNow</span><span class="op" id="6363783">(</span><span class="op" id="6363784">)</span><br>
<span class="lineno">365</span><span class="op" id="6363786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363789">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6363842">func</span>&nbsp;<span class="op" id="6363847">(</span><span class="ident" id="6363848">c</span>&nbsp;<span class="op" id="6363850">*</span><span class="ident" id="6363851">common</span><span class="op" id="6363857">)</span>&nbsp;<span class="ident" id="6363859">Fatalf</span><span class="op" id="6363865">(</span><span class="ident" id="6363866">format</span>&nbsp;<span class="builtintype" id="6363873">string</span><span class="op" id="6363879">,</span>&nbsp;<span class="ident" id="6363881">args</span>&nbsp;<span class="op" id="6363886">...</span><span class="keyword" id="6363889">interface</span><span class="op" id="6363898">{</span><span class="op" id="6363899">}</span><span class="op" id="6363900">)</span>&nbsp;<span class="op" id="6363902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363905">c</span><span class="op" id="6363906">.</span><span class="ident" id="6363907">log</span><span class="op" id="6363910">(</span><span class="ident" id="6363911">fmt</span><span class="op" id="6363914">.</span><span class="ident" id="6363915">Sprintf</span><span class="op" id="6363922">(</span><span class="ident" id="6363923">format</span><span class="op" id="6363929">,</span>&nbsp;<span class="ident" id="6363931">args</span><span class="op" id="6363935">...</span><span class="op" id="6363938">)</span><span class="op" id="6363939">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363942">c</span><span class="op" id="6363943">.</span><span class="ident" id="6363944">FailNow</span><span class="op" id="6363951">(</span><span class="op" id="6363952">)</span><br>
<span class="lineno"></span><span class="op" id="6363954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363957">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6364007">func</span>&nbsp;<span class="op" id="6364012">(</span><span class="ident" id="6364013">c</span>&nbsp;<span class="op" id="6364015">*</span><span class="ident" id="6364016">common</span><span class="op" id="6364022">)</span>&nbsp;<span class="ident" id="6364024">Skip</span><span class="op" id="6364028">(</span><span class="ident" id="6364029">args</span>&nbsp;<span class="op" id="6364034">...</span><span class="keyword" id="6364037">interface</span><span class="op" id="6364046">{</span><span class="op" id="6364047">}</span><span class="op" id="6364048">)</span>&nbsp;<span class="op" id="6364050">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364053">c</span><span class="op" id="6364054">.</span><span class="ident" id="6364055">log</span><span class="op" id="6364058">(</span><span class="ident" id="6364059">fmt</span><span class="op" id="6364062">.</span><span class="ident" id="6364063">Sprintln</span><span class="op" id="6364071">(</span><span class="ident" id="6364072">args</span><span class="op" id="6364076">...</span><span class="op" id="6364079">)</span><span class="op" id="6364080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364083">c</span><span class="op" id="6364084">.</span><span class="ident" id="6364085">SkipNow</span><span class="op" id="6364092">(</span><span class="op" id="6364093">)</span><br>
<span class="lineno"></span><span class="op" id="6364095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364098">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6364150">func</span>&nbsp;<span class="op" id="6364155">(</span><span class="ident" id="6364156">c</span>&nbsp;<span class="op" id="6364158">*</span><span class="ident" id="6364159">common</span><span class="op" id="6364165">)</span>&nbsp;<span class="ident" id="6364167">Skipf</span><span class="op" id="6364172">(</span><span class="ident" id="6364173">format</span>&nbsp;<span class="builtintype" id="6364180">string</span><span class="op" id="6364186">,</span>&nbsp;<span class="ident" id="6364188">args</span>&nbsp;<span class="op" id="6364193">...</span><span class="keyword" id="6364196">interface</span><span class="op" id="6364205">{</span><span class="op" id="6364206">}</span><span class="op" id="6364207">)</span>&nbsp;<span class="op" id="6364209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364212">c</span><span class="op" id="6364213">.</span><span class="ident" id="6364214">log</span><span class="op" id="6364217">(</span><span class="ident" id="6364218">fmt</span><span class="op" id="6364221">.</span><span class="ident" id="6364222">Sprintf</span><span class="op" id="6364229">(</span><span class="ident" id="6364230">format</span><span class="op" id="6364236">,</span>&nbsp;<span class="ident" id="6364238">args</span><span class="op" id="6364242">...</span><span class="op" id="6364245">)</span><span class="op" id="6364246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364249">c</span><span class="op" id="6364250">.</span><span class="ident" id="6364251">SkipNow</span><span class="op" id="6364258">(</span><span class="op" id="6364259">)</span><br>
<span class="lineno"></span><span class="op" id="6364261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6364264">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6364338">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6364414">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6364486">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6364561">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6364588">func</span>&nbsp;<span class="op" id="6364593">(</span><span class="ident" id="6364594">c</span>&nbsp;<span class="op" id="6364596">*</span><span class="ident" id="6364597">common</span><span class="op" id="6364603">)</span>&nbsp;<span class="ident" id="6364605">SkipNow</span><span class="op" id="6364612">(</span><span class="op" id="6364613">)</span>&nbsp;<span class="op" id="6364615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364618">c</span><span class="op" id="6364619">.</span><span class="ident" id="6364620">skip</span><span class="op" id="6364624">(</span><span class="op" id="6364625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364628">c</span><span class="op" id="6364629">.</span><span class="ident" id="6364630">finished</span>&nbsp;<span class="op" id="6364639">=</span>&nbsp;<span class="builtintype" id="6364641">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364647">runtime</span><span class="op" id="6364654">.</span><span class="ident" id="6364655">Goexit</span><span class="op" id="6364661">(</span><span class="op" id="6364662">)</span><br>
<span class="lineno"></span><span class="op" id="6364664">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6364667">func</span>&nbsp;<span class="op" id="6364672">(</span><span class="ident" id="6364673">c</span>&nbsp;<span class="op" id="6364675">*</span><span class="ident" id="6364676">common</span><span class="op" id="6364682">)</span>&nbsp;<span class="ident" id="6364684">skip</span><span class="op" id="6364688">(</span><span class="op" id="6364689">)</span>&nbsp;<span class="op" id="6364691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364694">c</span><span class="op" id="6364695">.</span><span class="ident" id="6364696">mu</span><span class="op" id="6364698">.</span><span class="ident" id="6364699">Lock</span><span class="op" id="6364703">(</span><span class="op" id="6364704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364707">defer</span>&nbsp;<span class="ident" id="6364713">c</span><span class="op" id="6364714">.</span><span class="ident" id="6364715">mu</span><span class="op" id="6364717">.</span><span class="ident" id="6364718">Unlock</span><span class="op" id="6364724">(</span><span class="op" id="6364725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364728">c</span><span class="op" id="6364729">.</span><span class="ident" id="6364730">skipped</span>&nbsp;<span class="op" id="6364738">=</span>&nbsp;<span class="builtintype" id="6364740">true</span><br>
<span class="lineno">400</span><span class="op" id="6364745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364748">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6364797">func</span>&nbsp;<span class="op" id="6364802">(</span><span class="ident" id="6364803">c</span>&nbsp;<span class="op" id="6364805">*</span><span class="ident" id="6364806">common</span><span class="op" id="6364812">)</span>&nbsp;<span class="ident" id="6364814">Skipped</span><span class="op" id="6364821">(</span><span class="op" id="6364822">)</span>&nbsp;<span class="builtintype" id="6364824">bool</span>&nbsp;<span class="op" id="6364829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364832">c</span><span class="op" id="6364833">.</span><span class="ident" id="6364834">mu</span><span class="op" id="6364836">.</span><span class="ident" id="6364837">RLock</span><span class="op" id="6364842">(</span><span class="op" id="6364843">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364846">defer</span>&nbsp;<span class="ident" id="6364852">c</span><span class="op" id="6364853">.</span><span class="ident" id="6364854">mu</span><span class="op" id="6364856">.</span><span class="ident" id="6364857">RUnlock</span><span class="op" id="6364864">(</span><span class="op" id="6364865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364868">return</span>&nbsp;<span class="ident" id="6364875">c</span><span class="op" id="6364876">.</span><span class="ident" id="6364877">skipped</span><br>
<span class="lineno"></span><span class="op" id="6364885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364888">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6364969">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6364994">func</span>&nbsp;<span class="op" id="6364999">(</span><span class="ident" id="6365000">t</span>&nbsp;<span class="op" id="6365002">*</span><span class="ident" id="6365003">T</span><span class="op" id="6365004">)</span>&nbsp;<span class="ident" id="6365006">Parallel</span><span class="op" id="6365014">(</span><span class="op" id="6365015">)</span>&nbsp;<span class="op" id="6365017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365020">t</span><span class="op" id="6365021">.</span><span class="ident" id="6365022">signal</span>&nbsp;<span class="op" id="6365029">&lt;-</span>&nbsp;<span class="op" id="6365032">(</span><span class="op" id="6365033">*</span><span class="ident" id="6365034">T</span><span class="op" id="6365035">)</span><span class="op" id="6365036">(</span><span class="ident" id="6365037">nil</span><span class="op" id="6365040">)</span>&nbsp;<span class="comment" id="6365042">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365072">&lt;-</span><span class="ident" id="6365074">t</span><span class="op" id="6365075">.</span><span class="ident" id="6365076">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6365094">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365130">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365205">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365280">t</span><span class="op" id="6365281">.</span><span class="ident" id="6365282">start</span>&nbsp;<span class="op" id="6365288">=</span>&nbsp;<span class="ident" id="6365290">time</span><span class="op" id="6365294">.</span><span class="ident" id="6365295">Now</span><span class="op" id="6365298">(</span><span class="op" id="6365299">)</span><br>
<span class="lineno"></span><span class="op" id="6365301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365304">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6365393">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6365422">type</span>&nbsp;<span class="ident" id="6365427">InternalTest</span>&nbsp;<span class="keyword" id="6365440">struct</span>&nbsp;<span class="op" id="6365447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365450">Name</span>&nbsp;<span class="builtintype" id="6365455">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365463">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6365468">func</span><span class="op" id="6365472">(</span><span class="op" id="6365473">*</span><span class="ident" id="6365474">T</span><span class="op" id="6365475">)</span><br>
<span class="lineno"></span><span class="op" id="6365477">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6365480">func</span>&nbsp;<span class="ident" id="6365485">tRunner</span><span class="op" id="6365492">(</span><span class="ident" id="6365493">t</span>&nbsp;<span class="op" id="6365495">*</span><span class="ident" id="6365496">T</span><span class="op" id="6365497">,</span>&nbsp;<span class="ident" id="6365499">test</span>&nbsp;<span class="op" id="6365504">*</span><span class="ident" id="6365505">InternalTest</span><span class="op" id="6365517">)</span>&nbsp;<span class="op" id="6365519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365522">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365580">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365638">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365697">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365740">defer</span>&nbsp;<span class="keyword" id="6365746">func</span><span class="op" id="6365750">(</span><span class="op" id="6365751">)</span>&nbsp;<span class="op" id="6365753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365757">t</span><span class="op" id="6365758">.</span><span class="ident" id="6365759">duration</span>&nbsp;<span class="op" id="6365768">=</span>&nbsp;<span class="ident" id="6365770">time</span><span class="op" id="6365774">.</span><span class="ident" id="6365775">Now</span><span class="op" id="6365778">(</span><span class="op" id="6365779">)</span><span class="op" id="6365780">.</span><span class="ident" id="6365781">Sub</span><span class="op" id="6365784">(</span><span class="ident" id="6365785">t</span><span class="op" id="6365786">.</span><span class="ident" id="6365787">start</span><span class="op" id="6365792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365796">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365859">err</span>&nbsp;<span class="op" id="6365863">:=</span>&nbsp;<span class="builtinfunc" id="6365866">recover</span><span class="op" id="6365873">(</span><span class="op" id="6365874">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365878">if</span>&nbsp;<span class="op" id="6365881">!</span><span class="ident" id="6365882">t</span><span class="op" id="6365883">.</span><span class="ident" id="6365884">finished</span>&nbsp;<span class="op" id="6365893">&amp;&amp;</span>&nbsp;<span class="ident" id="6365896">err</span>&nbsp;<span class="op" id="6365900">==</span>&nbsp;<span class="ident" id="6365903">nil</span>&nbsp;<span class="op" id="6365907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365912">err</span>&nbsp;<span class="op" id="6365916">=</span>&nbsp;<span class="ident" id="6365918">fmt</span><span class="op" id="6365921">.</span><span class="ident" id="6365922">Errorf</span><span class="op" id="6365928">(</span><span class="string" id="6365929">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6365973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365981">if</span>&nbsp;<span class="ident" id="6365984">err</span>&nbsp;<span class="op" id="6365988">!=</span>&nbsp;<span class="ident" id="6365991">nil</span>&nbsp;<span class="op" id="6365995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366000">t</span><span class="op" id="6366001">.</span><span class="ident" id="6366002">Fail</span><span class="op" id="6366006">(</span><span class="op" id="6366007">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366012">t</span><span class="op" id="6366013">.</span><span class="ident" id="6366014">report</span><span class="op" id="6366020">(</span><span class="op" id="6366021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6366026">panic</span><span class="op" id="6366031">(</span><span class="ident" id="6366032">err</span><span class="op" id="6366035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366043">t</span><span class="op" id="6366044">.</span><span class="ident" id="6366045">signal</span>&nbsp;<span class="op" id="6366052">&lt;-</span>&nbsp;<span class="ident" id="6366055">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366058">}</span><span class="op" id="6366059">(</span><span class="op" id="6366060">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366064">t</span><span class="op" id="6366065">.</span><span class="ident" id="6366066">start</span>&nbsp;<span class="op" id="6366072">=</span>&nbsp;<span class="ident" id="6366074">time</span><span class="op" id="6366078">.</span><span class="ident" id="6366079">Now</span><span class="op" id="6366082">(</span><span class="op" id="6366083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366086">test</span><span class="op" id="6366090">.</span><span class="ident" id="6366091">F</span><span class="op" id="6366092">(</span><span class="ident" id="6366093">t</span><span class="op" id="6366094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366097">t</span><span class="op" id="6366098">.</span><span class="ident" id="6366099">finished</span>&nbsp;<span class="op" id="6366108">=</span>&nbsp;<span class="builtintype" id="6366110">true</span><br>
<span class="lineno"></span><span class="op" id="6366115">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6366118">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6366211">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6366240">func</span>&nbsp;<span class="ident" id="6366245">Main</span><span class="op" id="6366249">(</span><span class="ident" id="6366250">matchString</span>&nbsp;<span class="keyword" id="6366262">func</span><span class="op" id="6366266">(</span><span class="ident" id="6366267">pat</span><span class="op" id="6366270">,</span>&nbsp;<span class="ident" id="6366272">str</span>&nbsp;<span class="builtintype" id="6366276">string</span><span class="op" id="6366282">)</span>&nbsp;<span class="op" id="6366284">(</span><span class="builtintype" id="6366285">bool</span><span class="op" id="6366289">,</span>&nbsp;<span class="builtintype" id="6366291">error</span><span class="op" id="6366296">)</span><span class="op" id="6366297">,</span>&nbsp;<span class="ident" id="6366299">tests</span>&nbsp;<span class="op" id="6366305">[</span><span class="op" id="6366306">]</span><span class="ident" id="6366307">InternalTest</span><span class="op" id="6366319">,</span>&nbsp;<span class="ident" id="6366321">benchmarks</span>&nbsp;<span class="op" id="6366332">[</span><span class="op" id="6366333">]</span><span class="ident" id="6366334">InternalBenchmark</span><span class="op" id="6366351">,</span>&nbsp;<span class="ident" id="6366353">examples</span>&nbsp;<span class="op" id="6366362">[</span><span class="op" id="6366363">]</span><span class="ident" id="6366364">InternalExample</span><span class="op" id="6366379">)</span>&nbsp;<span class="op" id="6366381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366384">os</span><span class="op" id="6366386">.</span><span class="ident" id="6366387">Exit</span><span class="op" id="6366391">(</span><span class="ident" id="6366392">MainStart</span><span class="op" id="6366401">(</span><span class="ident" id="6366402">matchString</span><span class="op" id="6366413">,</span>&nbsp;<span class="ident" id="6366415">tests</span><span class="op" id="6366420">,</span>&nbsp;<span class="ident" id="6366422">benchmarks</span><span class="op" id="6366432">,</span>&nbsp;<span class="ident" id="6366434">examples</span><span class="op" id="6366442">)</span><span class="op" id="6366443">.</span><span class="ident" id="6366444">Run</span><span class="op" id="6366447">(</span><span class="op" id="6366448">)</span><span class="op" id="6366449">)</span><br>
<span class="lineno">455</span><span class="op" id="6366451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6366454">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6366524">type</span>&nbsp;<span class="ident" id="6366529">M</span>&nbsp;<span class="keyword" id="6366531">struct</span>&nbsp;<span class="op" id="6366538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366541">matchString</span>&nbsp;<span class="keyword" id="6366553">func</span><span class="op" id="6366557">(</span><span class="ident" id="6366558">pat</span><span class="op" id="6366561">,</span>&nbsp;<span class="ident" id="6366563">str</span>&nbsp;<span class="builtintype" id="6366567">string</span><span class="op" id="6366573">)</span>&nbsp;<span class="op" id="6366575">(</span><span class="builtintype" id="6366576">bool</span><span class="op" id="6366580">,</span>&nbsp;<span class="builtintype" id="6366582">error</span><span class="op" id="6366587">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366590">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366602">[</span><span class="op" id="6366603">]</span><span class="ident" id="6366604">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366618">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6366630">[</span><span class="op" id="6366631">]</span><span class="ident" id="6366632">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366651">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6366663">[</span><span class="op" id="6366664">]</span><span class="ident" id="6366665">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6366681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6366684">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6366747">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6366843">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6366895">func</span>&nbsp;<span class="ident" id="6366900">MainStart</span><span class="op" id="6366909">(</span><span class="ident" id="6366910">matchString</span>&nbsp;<span class="keyword" id="6366922">func</span><span class="op" id="6366926">(</span><span class="ident" id="6366927">pat</span><span class="op" id="6366930">,</span>&nbsp;<span class="ident" id="6366932">str</span>&nbsp;<span class="builtintype" id="6366936">string</span><span class="op" id="6366942">)</span>&nbsp;<span class="op" id="6366944">(</span><span class="builtintype" id="6366945">bool</span><span class="op" id="6366949">,</span>&nbsp;<span class="builtintype" id="6366951">error</span><span class="op" id="6366956">)</span><span class="op" id="6366957">,</span>&nbsp;<span class="ident" id="6366959">tests</span>&nbsp;<span class="op" id="6366965">[</span><span class="op" id="6366966">]</span><span class="ident" id="6366967">InternalTest</span><span class="op" id="6366979">,</span>&nbsp;<span class="ident" id="6366981">benchmarks</span>&nbsp;<span class="op" id="6366992">[</span><span class="op" id="6366993">]</span><span class="ident" id="6366994">InternalBenchmark</span><span class="op" id="6367011">,</span>&nbsp;<span class="ident" id="6367013">examples</span>&nbsp;<span class="op" id="6367022">[</span><span class="op" id="6367023">]</span><span class="ident" id="6367024">InternalExample</span><span class="op" id="6367039">)</span>&nbsp;<span class="op" id="6367041">*</span><span class="ident" id="6367042">M</span>&nbsp;<span class="op" id="6367044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367047">return</span>&nbsp;<span class="op" id="6367054">&amp;</span><span class="ident" id="6367055">M</span><span class="op" id="6367056">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367060">matchString</span><span class="op" id="6367071">:</span>&nbsp;<span class="ident" id="6367073">matchString</span><span class="op" id="6367084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367088">tests</span><span class="op" id="6367093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367101">tests</span><span class="op" id="6367106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367110">benchmarks</span><span class="op" id="6367120">:</span>&nbsp;&nbsp;<span class="ident" id="6367123">benchmarks</span><span class="op" id="6367133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367137">examples</span><span class="op" id="6367145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6367150">examples</span><span class="op" id="6367158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367161">}</span><br>
<span class="lineno">475</span><span class="op" id="6367163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367166">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6367233">func</span>&nbsp;<span class="op" id="6367238">(</span><span class="ident" id="6367239">m</span>&nbsp;<span class="op" id="6367241">*</span><span class="ident" id="6367242">M</span><span class="op" id="6367243">)</span>&nbsp;<span class="ident" id="6367245">Run</span><span class="op" id="6367248">(</span><span class="op" id="6367249">)</span>&nbsp;<span class="builtintype" id="6367251">int</span>&nbsp;<span class="op" id="6367255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367258">flag</span><span class="op" id="6367262">.</span><span class="ident" id="6367263">Parse</span><span class="op" id="6367268">(</span><span class="op" id="6367269">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367272">parseCpuList</span><span class="op" id="6367284">(</span><span class="op" id="6367285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367289">before</span><span class="op" id="6367295">(</span><span class="op" id="6367296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367299">startAlarm</span><span class="op" id="6367309">(</span><span class="op" id="6367310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367313">haveExamples</span>&nbsp;<span class="op" id="6367326">=</span>&nbsp;<span class="builtinfunc" id="6367328">len</span><span class="op" id="6367331">(</span><span class="ident" id="6367332">m</span><span class="op" id="6367333">.</span><span class="ident" id="6367334">examples</span><span class="op" id="6367342">)</span>&nbsp;<span class="op" id="6367344">&gt;</span>&nbsp;<span class="num" id="6367346">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367349">testOk</span>&nbsp;<span class="op" id="6367356">:=</span>&nbsp;<span class="ident" id="6367359">RunTests</span><span class="op" id="6367367">(</span><span class="ident" id="6367368">m</span><span class="op" id="6367369">.</span><span class="ident" id="6367370">matchString</span><span class="op" id="6367381">,</span>&nbsp;<span class="ident" id="6367383">m</span><span class="op" id="6367384">.</span><span class="ident" id="6367385">tests</span><span class="op" id="6367390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367393">exampleOk</span>&nbsp;<span class="op" id="6367403">:=</span>&nbsp;<span class="ident" id="6367406">RunExamples</span><span class="op" id="6367417">(</span><span class="ident" id="6367418">m</span><span class="op" id="6367419">.</span><span class="ident" id="6367420">matchString</span><span class="op" id="6367431">,</span>&nbsp;<span class="ident" id="6367433">m</span><span class="op" id="6367434">.</span><span class="ident" id="6367435">examples</span><span class="op" id="6367443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367446">stopAlarm</span><span class="op" id="6367455">(</span><span class="op" id="6367456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367459">if</span>&nbsp;<span class="op" id="6367462">!</span><span class="ident" id="6367463">testOk</span>&nbsp;<span class="op" id="6367470">||</span>&nbsp;<span class="op" id="6367473">!</span><span class="ident" id="6367474">exampleOk</span>&nbsp;<span class="op" id="6367484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367488">fmt</span><span class="op" id="6367491">.</span><span class="ident" id="6367492">Println</span><span class="op" id="6367499">(</span><span class="string" id="6367500">&#34;FAIL&#34;</span><span class="op" id="6367506">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367510">after</span><span class="op" id="6367515">(</span><span class="op" id="6367516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367520">return</span>&nbsp;<span class="num" id="6367527">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367533">fmt</span><span class="op" id="6367536">.</span><span class="ident" id="6367537">Println</span><span class="op" id="6367544">(</span><span class="string" id="6367545">&#34;PASS&#34;</span><span class="op" id="6367551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367554">RunBenchmarks</span><span class="op" id="6367567">(</span><span class="ident" id="6367568">m</span><span class="op" id="6367569">.</span><span class="ident" id="6367570">matchString</span><span class="op" id="6367581">,</span>&nbsp;<span class="ident" id="6367583">m</span><span class="op" id="6367584">.</span><span class="ident" id="6367585">benchmarks</span><span class="op" id="6367595">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367598">after</span><span class="op" id="6367603">(</span><span class="op" id="6367604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367607">return</span>&nbsp;<span class="num" id="6367614">0</span><br>
<span class="lineno"></span><span class="op" id="6367616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6367619">func</span>&nbsp;<span class="op" id="6367624">(</span><span class="ident" id="6367625">t</span>&nbsp;<span class="op" id="6367627">*</span><span class="ident" id="6367628">T</span><span class="op" id="6367629">)</span>&nbsp;<span class="ident" id="6367631">report</span><span class="op" id="6367637">(</span><span class="op" id="6367638">)</span>&nbsp;<span class="op" id="6367640">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367643">dstr</span>&nbsp;<span class="op" id="6367648">:=</span>&nbsp;<span class="ident" id="6367651">fmtDuration</span><span class="op" id="6367662">(</span><span class="ident" id="6367663">t</span><span class="op" id="6367664">.</span><span class="ident" id="6367665">duration</span><span class="op" id="6367673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367676">format</span>&nbsp;<span class="op" id="6367683">:=</span>&nbsp;<span class="string" id="6367686">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367709">if</span>&nbsp;<span class="ident" id="6367712">t</span><span class="op" id="6367713">.</span><span class="ident" id="6367714">Failed</span><span class="op" id="6367720">(</span><span class="op" id="6367721">)</span>&nbsp;<span class="op" id="6367723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367727">fmt</span><span class="op" id="6367730">.</span><span class="ident" id="6367731">Printf</span><span class="op" id="6367737">(</span><span class="ident" id="6367738">format</span><span class="op" id="6367744">,</span>&nbsp;<span class="string" id="6367746">&#34;FAIL&#34;</span><span class="op" id="6367752">,</span>&nbsp;<span class="ident" id="6367754">t</span><span class="op" id="6367755">.</span><span class="ident" id="6367756">name</span><span class="op" id="6367760">,</span>&nbsp;<span class="ident" id="6367762">dstr</span><span class="op" id="6367766">,</span>&nbsp;<span class="ident" id="6367768">t</span><span class="op" id="6367769">.</span><span class="ident" id="6367770">output</span><span class="op" id="6367776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367779">}</span>&nbsp;<span class="keyword" id="6367781">else</span>&nbsp;<span class="keyword" id="6367786">if</span>&nbsp;<span class="op" id="6367789">*</span><span class="ident" id="6367790">chatty</span>&nbsp;<span class="op" id="6367797">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367801">if</span>&nbsp;<span class="ident" id="6367804">t</span><span class="op" id="6367805">.</span><span class="ident" id="6367806">Skipped</span><span class="op" id="6367813">(</span><span class="op" id="6367814">)</span>&nbsp;<span class="op" id="6367816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367821">fmt</span><span class="op" id="6367824">.</span><span class="ident" id="6367825">Printf</span><span class="op" id="6367831">(</span><span class="ident" id="6367832">format</span><span class="op" id="6367838">,</span>&nbsp;<span class="string" id="6367840">&#34;SKIP&#34;</span><span class="op" id="6367846">,</span>&nbsp;<span class="ident" id="6367848">t</span><span class="op" id="6367849">.</span><span class="ident" id="6367850">name</span><span class="op" id="6367854">,</span>&nbsp;<span class="ident" id="6367856">dstr</span><span class="op" id="6367860">,</span>&nbsp;<span class="ident" id="6367862">t</span><span class="op" id="6367863">.</span><span class="ident" id="6367864">output</span><span class="op" id="6367870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367874">}</span>&nbsp;<span class="keyword" id="6367876">else</span>&nbsp;<span class="op" id="6367881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367886">fmt</span><span class="op" id="6367889">.</span><span class="ident" id="6367890">Printf</span><span class="op" id="6367896">(</span><span class="ident" id="6367897">format</span><span class="op" id="6367903">,</span>&nbsp;<span class="string" id="6367905">&#34;PASS&#34;</span><span class="op" id="6367911">,</span>&nbsp;<span class="ident" id="6367913">t</span><span class="op" id="6367914">.</span><span class="ident" id="6367915">name</span><span class="op" id="6367919">,</span>&nbsp;<span class="ident" id="6367921">dstr</span><span class="op" id="6367925">,</span>&nbsp;<span class="ident" id="6367927">t</span><span class="op" id="6367928">.</span><span class="ident" id="6367929">output</span><span class="op" id="6367935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367939">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367942">}</span><br>
<span class="lineno"></span><span class="op" id="6367944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6367947">func</span>&nbsp;<span class="ident" id="6367952">RunTests</span><span class="op" id="6367960">(</span><span class="ident" id="6367961">matchString</span>&nbsp;<span class="keyword" id="6367973">func</span><span class="op" id="6367977">(</span><span class="ident" id="6367978">pat</span><span class="op" id="6367981">,</span>&nbsp;<span class="ident" id="6367983">str</span>&nbsp;<span class="builtintype" id="6367987">string</span><span class="op" id="6367993">)</span>&nbsp;<span class="op" id="6367995">(</span><span class="builtintype" id="6367996">bool</span><span class="op" id="6368000">,</span>&nbsp;<span class="builtintype" id="6368002">error</span><span class="op" id="6368007">)</span><span class="op" id="6368008">,</span>&nbsp;<span class="ident" id="6368010">tests</span>&nbsp;<span class="op" id="6368016">[</span><span class="op" id="6368017">]</span><span class="ident" id="6368018">InternalTest</span><span class="op" id="6368030">)</span>&nbsp;<span class="op" id="6368032">(</span><span class="ident" id="6368033">ok</span>&nbsp;<span class="builtintype" id="6368036">bool</span><span class="op" id="6368040">)</span>&nbsp;<span class="op" id="6368042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368045">ok</span>&nbsp;<span class="op" id="6368048">=</span>&nbsp;<span class="builtintype" id="6368050">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368056">if</span>&nbsp;<span class="builtinfunc" id="6368059">len</span><span class="op" id="6368062">(</span><span class="ident" id="6368063">tests</span><span class="op" id="6368068">)</span>&nbsp;<span class="op" id="6368070">==</span>&nbsp;<span class="num" id="6368073">0</span>&nbsp;<span class="op" id="6368075">&amp;&amp;</span>&nbsp;<span class="op" id="6368078">!</span><span class="ident" id="6368079">haveExamples</span>&nbsp;<span class="op" id="6368092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368096">fmt</span><span class="op" id="6368099">.</span><span class="ident" id="6368100">Fprintln</span><span class="op" id="6368108">(</span><span class="ident" id="6368109">os</span><span class="op" id="6368111">.</span><span class="ident" id="6368112">Stderr</span><span class="op" id="6368118">,</span>&nbsp;<span class="string" id="6368120">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6368155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368159">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368170">for</span>&nbsp;<span class="ident" id="6368174">_</span><span class="op" id="6368175">,</span>&nbsp;<span class="ident" id="6368177">procs</span>&nbsp;<span class="op" id="6368183">:=</span>&nbsp;<span class="keyword" id="6368186">range</span>&nbsp;<span class="ident" id="6368192">cpuList</span>&nbsp;<span class="op" id="6368200">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368204">runtime</span><span class="op" id="6368211">.</span><span class="ident" id="6368212">GOMAXPROCS</span><span class="op" id="6368222">(</span><span class="ident" id="6368223">procs</span><span class="op" id="6368228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368232">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368291">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368374">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368447">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368535">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368566">var</span>&nbsp;<span class="ident" id="6368570">collector</span>&nbsp;<span class="op" id="6368580">=</span>&nbsp;<span class="builtinfunc" id="6368582">make</span><span class="op" id="6368586">(</span><span class="keyword" id="6368587">chan</span>&nbsp;<span class="keyword" id="6368592">interface</span><span class="op" id="6368601">{</span><span class="op" id="6368602">}</span><span class="op" id="6368603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368608">numParallel</span>&nbsp;<span class="op" id="6368620">:=</span>&nbsp;<span class="num" id="6368623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368627">startParallel</span>&nbsp;<span class="op" id="6368641">:=</span>&nbsp;<span class="builtinfunc" id="6368644">make</span><span class="op" id="6368648">(</span><span class="keyword" id="6368649">chan</span>&nbsp;<span class="builtintype" id="6368654">bool</span><span class="op" id="6368658">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368663">for</span>&nbsp;<span class="ident" id="6368667">i</span>&nbsp;<span class="op" id="6368669">:=</span>&nbsp;<span class="num" id="6368672">0</span><span class="op" id="6368673">;</span>&nbsp;<span class="ident" id="6368675">i</span>&nbsp;<span class="op" id="6368677">&lt;</span>&nbsp;<span class="builtinfunc" id="6368679">len</span><span class="op" id="6368682">(</span><span class="ident" id="6368683">tests</span><span class="op" id="6368688">)</span><span class="op" id="6368689">;</span>&nbsp;<span class="ident" id="6368691">i</span><span class="op" id="6368692">++</span>&nbsp;<span class="op" id="6368695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368700">matched</span><span class="op" id="6368707">,</span>&nbsp;<span class="ident" id="6368709">err</span>&nbsp;<span class="op" id="6368713">:=</span>&nbsp;<span class="ident" id="6368716">matchString</span><span class="op" id="6368727">(</span><span class="op" id="6368728">*</span><span class="ident" id="6368729">match</span><span class="op" id="6368734">,</span>&nbsp;<span class="ident" id="6368736">tests</span><span class="op" id="6368741">[</span><span class="ident" id="6368742">i</span><span class="op" id="6368743">]</span><span class="op" id="6368744">.</span><span class="ident" id="6368745">Name</span><span class="op" id="6368749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368754">if</span>&nbsp;<span class="ident" id="6368757">err</span>&nbsp;<span class="op" id="6368761">!=</span>&nbsp;<span class="ident" id="6368764">nil</span>&nbsp;<span class="op" id="6368768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368774">fmt</span><span class="op" id="6368777">.</span><span class="ident" id="6368778">Fprintf</span><span class="op" id="6368785">(</span><span class="ident" id="6368786">os</span><span class="op" id="6368788">.</span><span class="ident" id="6368789">Stderr</span><span class="op" id="6368795">,</span>&nbsp;<span class="string" id="6368797">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6368842">,</span>&nbsp;<span class="ident" id="6368844">err</span><span class="op" id="6368847">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368853">os</span><span class="op" id="6368855">.</span><span class="ident" id="6368856">Exit</span><span class="op" id="6368860">(</span><span class="num" id="6368861">1</span><span class="op" id="6368862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368872">if</span>&nbsp;<span class="op" id="6368875">!</span><span class="ident" id="6368876">matched</span>&nbsp;<span class="op" id="6368884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368890">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368902">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368907">testName</span>&nbsp;<span class="op" id="6368916">:=</span>&nbsp;<span class="ident" id="6368919">tests</span><span class="op" id="6368924">[</span><span class="ident" id="6368925">i</span><span class="op" id="6368926">]</span><span class="op" id="6368927">.</span><span class="ident" id="6368928">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368936">if</span>&nbsp;<span class="ident" id="6368939">procs</span>&nbsp;<span class="op" id="6368945">!=</span>&nbsp;<span class="num" id="6368948">1</span>&nbsp;<span class="op" id="6368950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368956">testName</span>&nbsp;<span class="op" id="6368965">=</span>&nbsp;<span class="ident" id="6368967">fmt</span><span class="op" id="6368970">.</span><span class="ident" id="6368971">Sprintf</span><span class="op" id="6368978">(</span><span class="string" id="6368979">&#34;%s-%d&#34;</span><span class="op" id="6368986">,</span>&nbsp;<span class="ident" id="6368988">tests</span><span class="op" id="6368993">[</span><span class="ident" id="6368994">i</span><span class="op" id="6368995">]</span><span class="op" id="6368996">.</span><span class="ident" id="6368997">Name</span><span class="op" id="6369001">,</span>&nbsp;<span class="ident" id="6369003">procs</span><span class="op" id="6369008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369018">t</span>&nbsp;<span class="op" id="6369020">:=</span>&nbsp;<span class="op" id="6369023">&amp;</span><span class="ident" id="6369024">T</span><span class="op" id="6369025">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369031">common</span><span class="op" id="6369037">:</span>&nbsp;<span class="ident" id="6369039">common</span><span class="op" id="6369045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369052">signal</span><span class="op" id="6369058">:</span>&nbsp;<span class="builtinfunc" id="6369060">make</span><span class="op" id="6369064">(</span><span class="keyword" id="6369065">chan</span>&nbsp;<span class="keyword" id="6369070">interface</span><span class="op" id="6369079">{</span><span class="op" id="6369080">}</span><span class="op" id="6369081">)</span><span class="op" id="6369082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369088">}</span><span class="op" id="6369089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369095">name</span><span class="op" id="6369099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6369110">testName</span><span class="op" id="6369118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369124">startParallel</span><span class="op" id="6369137">:</span>&nbsp;<span class="ident" id="6369139">startParallel</span><span class="op" id="6369152">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369162">t</span><span class="op" id="6369163">.</span><span class="ident" id="6369164">self</span>&nbsp;<span class="op" id="6369169">=</span>&nbsp;<span class="ident" id="6369171">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369176">if</span>&nbsp;<span class="op" id="6369179">*</span><span class="ident" id="6369180">chatty</span>&nbsp;<span class="op" id="6369187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369193">fmt</span><span class="op" id="6369196">.</span><span class="ident" id="6369197">Printf</span><span class="op" id="6369203">(</span><span class="string" id="6369204">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6369218">,</span>&nbsp;<span class="ident" id="6369220">t</span><span class="op" id="6369221">.</span><span class="ident" id="6369222">name</span><span class="op" id="6369226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369231">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369236">go</span>&nbsp;<span class="ident" id="6369239">tRunner</span><span class="op" id="6369246">(</span><span class="ident" id="6369247">t</span><span class="op" id="6369248">,</span>&nbsp;<span class="op" id="6369250">&amp;</span><span class="ident" id="6369251">tests</span><span class="op" id="6369256">[</span><span class="ident" id="6369257">i</span><span class="op" id="6369258">]</span><span class="op" id="6369259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369264">out</span>&nbsp;<span class="op" id="6369268">:=</span>&nbsp;<span class="op" id="6369271">(</span><span class="op" id="6369272">&lt;-</span><span class="ident" id="6369274">t</span><span class="op" id="6369275">.</span><span class="ident" id="6369276">signal</span><span class="op" id="6369282">)</span><span class="op" id="6369283">.</span><span class="op" id="6369284">(</span><span class="op" id="6369285">*</span><span class="ident" id="6369286">T</span><span class="op" id="6369287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369292">if</span>&nbsp;<span class="ident" id="6369295">out</span>&nbsp;<span class="op" id="6369299">==</span>&nbsp;<span class="ident" id="6369302">nil</span>&nbsp;<span class="op" id="6369306">{</span>&nbsp;<span class="comment" id="6369308">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369329">go</span>&nbsp;<span class="keyword" id="6369332">func</span><span class="op" id="6369336">(</span><span class="op" id="6369337">)</span>&nbsp;<span class="op" id="6369339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369346">collector</span>&nbsp;<span class="op" id="6369356">&lt;-</span>&nbsp;<span class="op" id="6369359">&lt;-</span><span class="ident" id="6369361">t</span><span class="op" id="6369362">.</span><span class="ident" id="6369363">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369374">}</span><span class="op" id="6369375">(</span><span class="op" id="6369376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369382">numParallel</span><span class="op" id="6369393">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369400">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369417">t</span><span class="op" id="6369418">.</span><span class="ident" id="6369419">report</span><span class="op" id="6369425">(</span><span class="op" id="6369426">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369431">ok</span>&nbsp;<span class="op" id="6369434">=</span>&nbsp;<span class="ident" id="6369436">ok</span>&nbsp;<span class="op" id="6369439">&amp;&amp;</span>&nbsp;<span class="op" id="6369442">!</span><span class="ident" id="6369443">out</span><span class="op" id="6369446">.</span><span class="ident" id="6369447">Failed</span><span class="op" id="6369453">(</span><span class="op" id="6369454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369463">running</span>&nbsp;<span class="op" id="6369471">:=</span>&nbsp;<span class="num" id="6369474">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369478">for</span>&nbsp;<span class="ident" id="6369482">numParallel</span><span class="op" id="6369493">+</span><span class="ident" id="6369494">running</span>&nbsp;<span class="op" id="6369502">&gt;</span>&nbsp;<span class="num" id="6369504">0</span>&nbsp;<span class="op" id="6369506">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369511">if</span>&nbsp;<span class="ident" id="6369514">running</span>&nbsp;<span class="op" id="6369522">&lt;</span>&nbsp;<span class="op" id="6369524">*</span><span class="ident" id="6369525">parallel</span>&nbsp;<span class="op" id="6369534">&amp;&amp;</span>&nbsp;<span class="ident" id="6369537">numParallel</span>&nbsp;<span class="op" id="6369549">&gt;</span>&nbsp;<span class="num" id="6369551">0</span>&nbsp;<span class="op" id="6369553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369559">startParallel</span>&nbsp;<span class="op" id="6369573">&lt;-</span>&nbsp;<span class="builtintype" id="6369576">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369585">running</span><span class="op" id="6369592">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369599">numParallel</span><span class="op" id="6369610">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369617">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369634">t</span>&nbsp;<span class="op" id="6369636">:=</span>&nbsp;<span class="op" id="6369639">(</span><span class="op" id="6369640">&lt;-</span><span class="ident" id="6369642">collector</span><span class="op" id="6369651">)</span><span class="op" id="6369652">.</span><span class="op" id="6369653">(</span><span class="op" id="6369654">*</span><span class="ident" id="6369655">T</span><span class="op" id="6369656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369661">t</span><span class="op" id="6369662">.</span><span class="ident" id="6369663">report</span><span class="op" id="6369669">(</span><span class="op" id="6369670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369675">ok</span>&nbsp;<span class="op" id="6369678">=</span>&nbsp;<span class="ident" id="6369680">ok</span>&nbsp;<span class="op" id="6369683">&amp;&amp;</span>&nbsp;<span class="op" id="6369686">!</span><span class="ident" id="6369687">t</span><span class="op" id="6369688">.</span><span class="ident" id="6369689">Failed</span><span class="op" id="6369695">(</span><span class="op" id="6369696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369701">running</span><span class="op" id="6369708">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369719">return</span><br>
<span class="lineno"></span><span class="op" id="6369726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6369729">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6369764">func</span>&nbsp;<span class="ident" id="6369769">before</span><span class="op" id="6369775">(</span><span class="op" id="6369776">)</span>&nbsp;<span class="op" id="6369778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369781">if</span>&nbsp;<span class="op" id="6369784">*</span><span class="ident" id="6369785">memProfileRate</span>&nbsp;<span class="op" id="6369800">&gt;</span>&nbsp;<span class="num" id="6369802">0</span>&nbsp;<span class="op" id="6369804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369808">runtime</span><span class="op" id="6369815">.</span><span class="ident" id="6369816">MemProfileRate</span>&nbsp;<span class="op" id="6369831">=</span>&nbsp;<span class="op" id="6369833">*</span><span class="ident" id="6369834">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369850">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369853">if</span>&nbsp;<span class="op" id="6369856">*</span><span class="ident" id="6369857">cpuProfile</span>&nbsp;<span class="op" id="6369868">!=</span>&nbsp;<span class="string" id="6369871">&#34;&#34;</span>&nbsp;<span class="op" id="6369874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369878">f</span><span class="op" id="6369879">,</span>&nbsp;<span class="ident" id="6369881">err</span>&nbsp;<span class="op" id="6369885">:=</span>&nbsp;<span class="ident" id="6369888">os</span><span class="op" id="6369890">.</span><span class="ident" id="6369891">Create</span><span class="op" id="6369897">(</span><span class="ident" id="6369898">toOutputDir</span><span class="op" id="6369909">(</span><span class="op" id="6369910">*</span><span class="ident" id="6369911">cpuProfile</span><span class="op" id="6369921">)</span><span class="op" id="6369922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369926">if</span>&nbsp;<span class="ident" id="6369929">err</span>&nbsp;<span class="op" id="6369933">!=</span>&nbsp;<span class="ident" id="6369936">nil</span>&nbsp;<span class="op" id="6369940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369945">fmt</span><span class="op" id="6369948">.</span><span class="ident" id="6369949">Fprintf</span><span class="op" id="6369956">(</span><span class="ident" id="6369957">os</span><span class="op" id="6369959">.</span><span class="ident" id="6369960">Stderr</span><span class="op" id="6369966">,</span>&nbsp;<span class="string" id="6369968">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6369981">,</span>&nbsp;<span class="ident" id="6369983">err</span><span class="op" id="6369986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369991">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370004">if</span>&nbsp;<span class="ident" id="6370007">err</span>&nbsp;<span class="op" id="6370011">:=</span>&nbsp;<span class="ident" id="6370014">pprof</span><span class="op" id="6370019">.</span><span class="ident" id="6370020">StartCPUProfile</span><span class="op" id="6370035">(</span><span class="ident" id="6370036">f</span><span class="op" id="6370037">)</span><span class="op" id="6370038">;</span>&nbsp;<span class="ident" id="6370040">err</span>&nbsp;<span class="op" id="6370044">!=</span>&nbsp;<span class="ident" id="6370047">nil</span>&nbsp;<span class="op" id="6370051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370056">fmt</span><span class="op" id="6370059">.</span><span class="ident" id="6370060">Fprintf</span><span class="op" id="6370067">(</span><span class="ident" id="6370068">os</span><span class="op" id="6370070">.</span><span class="ident" id="6370071">Stderr</span><span class="op" id="6370077">,</span>&nbsp;<span class="string" id="6370079">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6370117">,</span>&nbsp;<span class="ident" id="6370119">err</span><span class="op" id="6370122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370127">f</span><span class="op" id="6370128">.</span><span class="ident" id="6370129">Close</span><span class="op" id="6370134">(</span><span class="op" id="6370135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370140">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370153">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370222">if</span>&nbsp;<span class="op" id="6370225">*</span><span class="ident" id="6370226">blockProfile</span>&nbsp;<span class="op" id="6370239">!=</span>&nbsp;<span class="string" id="6370242">&#34;&#34;</span>&nbsp;<span class="op" id="6370245">&amp;&amp;</span>&nbsp;<span class="op" id="6370248">*</span><span class="ident" id="6370249">blockProfileRate</span>&nbsp;<span class="op" id="6370266">&gt;=</span>&nbsp;<span class="num" id="6370269">0</span>&nbsp;<span class="op" id="6370271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370275">runtime</span><span class="op" id="6370282">.</span><span class="ident" id="6370283">SetBlockProfileRate</span><span class="op" id="6370302">(</span><span class="op" id="6370303">*</span><span class="ident" id="6370304">blockProfileRate</span><span class="op" id="6370320">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370326">if</span>&nbsp;<span class="op" id="6370329">*</span><span class="ident" id="6370330">coverProfile</span>&nbsp;<span class="op" id="6370343">!=</span>&nbsp;<span class="string" id="6370346">&#34;&#34;</span>&nbsp;<span class="op" id="6370349">&amp;&amp;</span>&nbsp;<span class="ident" id="6370352">cover</span><span class="op" id="6370357">.</span><span class="ident" id="6370358">Mode</span>&nbsp;<span class="op" id="6370363">==</span>&nbsp;<span class="string" id="6370366">&#34;&#34;</span>&nbsp;<span class="op" id="6370369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370373">fmt</span><span class="op" id="6370376">.</span><span class="ident" id="6370377">Fprintf</span><span class="op" id="6370384">(</span><span class="ident" id="6370385">os</span><span class="op" id="6370387">.</span><span class="ident" id="6370388">Stderr</span><span class="op" id="6370394">,</span>&nbsp;<span class="string" id="6370396">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6370494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370498">os</span><span class="op" id="6370500">.</span><span class="ident" id="6370501">Exit</span><span class="op" id="6370505">(</span><span class="num" id="6370506">2</span><span class="op" id="6370507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370510">}</span><br>
<span class="lineno">610</span><span class="op" id="6370512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6370515">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6370548">func</span>&nbsp;<span class="ident" id="6370553">after</span><span class="op" id="6370558">(</span><span class="op" id="6370559">)</span>&nbsp;<span class="op" id="6370561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370564">if</span>&nbsp;<span class="op" id="6370567">*</span><span class="ident" id="6370568">cpuProfile</span>&nbsp;<span class="op" id="6370579">!=</span>&nbsp;<span class="string" id="6370582">&#34;&#34;</span>&nbsp;<span class="op" id="6370585">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370589">pprof</span><span class="op" id="6370594">.</span><span class="ident" id="6370595">StopCPUProfile</span><span class="op" id="6370609">(</span><span class="op" id="6370610">)</span>&nbsp;<span class="comment" id="6370612">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370643">if</span>&nbsp;<span class="op" id="6370646">*</span><span class="ident" id="6370647">memProfile</span>&nbsp;<span class="op" id="6370658">!=</span>&nbsp;<span class="string" id="6370661">&#34;&#34;</span>&nbsp;<span class="op" id="6370664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370668">f</span><span class="op" id="6370669">,</span>&nbsp;<span class="ident" id="6370671">err</span>&nbsp;<span class="op" id="6370675">:=</span>&nbsp;<span class="ident" id="6370678">os</span><span class="op" id="6370680">.</span><span class="ident" id="6370681">Create</span><span class="op" id="6370687">(</span><span class="ident" id="6370688">toOutputDir</span><span class="op" id="6370699">(</span><span class="op" id="6370700">*</span><span class="ident" id="6370701">memProfile</span><span class="op" id="6370711">)</span><span class="op" id="6370712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370716">if</span>&nbsp;<span class="ident" id="6370719">err</span>&nbsp;<span class="op" id="6370723">!=</span>&nbsp;<span class="ident" id="6370726">nil</span>&nbsp;<span class="op" id="6370730">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370735">fmt</span><span class="op" id="6370738">.</span><span class="ident" id="6370739">Fprintf</span><span class="op" id="6370746">(</span><span class="ident" id="6370747">os</span><span class="op" id="6370749">.</span><span class="ident" id="6370750">Stderr</span><span class="op" id="6370756">,</span>&nbsp;<span class="string" id="6370758">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6370773">,</span>&nbsp;<span class="ident" id="6370775">err</span><span class="op" id="6370778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370783">os</span><span class="op" id="6370785">.</span><span class="ident" id="6370786">Exit</span><span class="op" id="6370790">(</span><span class="num" id="6370791">2</span><span class="op" id="6370792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370800">runtime</span><span class="op" id="6370807">.</span><span class="ident" id="6370808">GC</span><span class="op" id="6370810">(</span><span class="op" id="6370811">)</span>&nbsp;<span class="comment" id="6370813">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370845">if</span>&nbsp;<span class="ident" id="6370848">err</span>&nbsp;<span class="op" id="6370852">=</span>&nbsp;<span class="ident" id="6370854">pprof</span><span class="op" id="6370859">.</span><span class="ident" id="6370860">WriteHeapProfile</span><span class="op" id="6370876">(</span><span class="ident" id="6370877">f</span><span class="op" id="6370878">)</span><span class="op" id="6370879">;</span>&nbsp;<span class="ident" id="6370881">err</span>&nbsp;<span class="op" id="6370885">!=</span>&nbsp;<span class="ident" id="6370888">nil</span>&nbsp;<span class="op" id="6370892">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370897">fmt</span><span class="op" id="6370900">.</span><span class="ident" id="6370901">Fprintf</span><span class="op" id="6370908">(</span><span class="ident" id="6370909">os</span><span class="op" id="6370911">.</span><span class="ident" id="6370912">Stderr</span><span class="op" id="6370918">,</span>&nbsp;<span class="string" id="6370920">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6370951">,</span>&nbsp;<span class="op" id="6370953">*</span><span class="ident" id="6370954">memProfile</span><span class="op" id="6370964">,</span>&nbsp;<span class="ident" id="6370966">err</span><span class="op" id="6370969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370974">os</span><span class="op" id="6370976">.</span><span class="ident" id="6370977">Exit</span><span class="op" id="6370981">(</span><span class="num" id="6370982">2</span><span class="op" id="6370983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370991">f</span><span class="op" id="6370992">.</span><span class="ident" id="6370993">Close</span><span class="op" id="6370998">(</span><span class="op" id="6370999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371002">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371005">if</span>&nbsp;<span class="op" id="6371008">*</span><span class="ident" id="6371009">blockProfile</span>&nbsp;<span class="op" id="6371022">!=</span>&nbsp;<span class="string" id="6371025">&#34;&#34;</span>&nbsp;<span class="op" id="6371028">&amp;&amp;</span>&nbsp;<span class="op" id="6371031">*</span><span class="ident" id="6371032">blockProfileRate</span>&nbsp;<span class="op" id="6371049">&gt;=</span>&nbsp;<span class="num" id="6371052">0</span>&nbsp;<span class="op" id="6371054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371058">f</span><span class="op" id="6371059">,</span>&nbsp;<span class="ident" id="6371061">err</span>&nbsp;<span class="op" id="6371065">:=</span>&nbsp;<span class="ident" id="6371068">os</span><span class="op" id="6371070">.</span><span class="ident" id="6371071">Create</span><span class="op" id="6371077">(</span><span class="ident" id="6371078">toOutputDir</span><span class="op" id="6371089">(</span><span class="op" id="6371090">*</span><span class="ident" id="6371091">blockProfile</span><span class="op" id="6371103">)</span><span class="op" id="6371104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371108">if</span>&nbsp;<span class="ident" id="6371111">err</span>&nbsp;<span class="op" id="6371115">!=</span>&nbsp;<span class="ident" id="6371118">nil</span>&nbsp;<span class="op" id="6371122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371127">fmt</span><span class="op" id="6371130">.</span><span class="ident" id="6371131">Fprintf</span><span class="op" id="6371138">(</span><span class="ident" id="6371139">os</span><span class="op" id="6371141">.</span><span class="ident" id="6371142">Stderr</span><span class="op" id="6371148">,</span>&nbsp;<span class="string" id="6371150">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6371165">,</span>&nbsp;<span class="ident" id="6371167">err</span><span class="op" id="6371170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371175">os</span><span class="op" id="6371177">.</span><span class="ident" id="6371178">Exit</span><span class="op" id="6371182">(</span><span class="num" id="6371183">2</span><span class="op" id="6371184">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371192">if</span>&nbsp;<span class="ident" id="6371195">err</span>&nbsp;<span class="op" id="6371199">=</span>&nbsp;<span class="ident" id="6371201">pprof</span><span class="op" id="6371206">.</span><span class="ident" id="6371207">Lookup</span><span class="op" id="6371213">(</span><span class="string" id="6371214">&#34;block&#34;</span><span class="op" id="6371221">)</span><span class="op" id="6371222">.</span><span class="ident" id="6371223">WriteTo</span><span class="op" id="6371230">(</span><span class="ident" id="6371231">f</span><span class="op" id="6371232">,</span>&nbsp;<span class="num" id="6371234">0</span><span class="op" id="6371235">)</span><span class="op" id="6371236">;</span>&nbsp;<span class="ident" id="6371238">err</span>&nbsp;<span class="op" id="6371242">!=</span>&nbsp;<span class="ident" id="6371245">nil</span>&nbsp;<span class="op" id="6371249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371254">fmt</span><span class="op" id="6371257">.</span><span class="ident" id="6371258">Fprintf</span><span class="op" id="6371265">(</span><span class="ident" id="6371266">os</span><span class="op" id="6371268">.</span><span class="ident" id="6371269">Stderr</span><span class="op" id="6371275">,</span>&nbsp;<span class="string" id="6371277">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6371308">,</span>&nbsp;<span class="op" id="6371310">*</span><span class="ident" id="6371311">blockProfile</span><span class="op" id="6371323">,</span>&nbsp;<span class="ident" id="6371325">err</span><span class="op" id="6371328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371333">os</span><span class="op" id="6371335">.</span><span class="ident" id="6371336">Exit</span><span class="op" id="6371340">(</span><span class="num" id="6371341">2</span><span class="op" id="6371342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371346">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371350">f</span><span class="op" id="6371351">.</span><span class="ident" id="6371352">Close</span><span class="op" id="6371357">(</span><span class="op" id="6371358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371364">if</span>&nbsp;<span class="ident" id="6371367">cover</span><span class="op" id="6371372">.</span><span class="ident" id="6371373">Mode</span>&nbsp;<span class="op" id="6371378">!=</span>&nbsp;<span class="string" id="6371381">&#34;&#34;</span>&nbsp;<span class="op" id="6371384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371388">coverReport</span><span class="op" id="6371399">(</span><span class="op" id="6371400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371403">}</span><br>
<span class="lineno">645</span><span class="op" id="6371405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6371408">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6371483">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6371543">func</span>&nbsp;<span class="ident" id="6371548">toOutputDir</span><span class="op" id="6371559">(</span><span class="ident" id="6371560">path</span>&nbsp;<span class="builtintype" id="6371565">string</span><span class="op" id="6371571">)</span>&nbsp;<span class="builtintype" id="6371573">string</span>&nbsp;<span class="op" id="6371580">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371583">if</span>&nbsp;<span class="op" id="6371586">*</span><span class="ident" id="6371587">outputDir</span>&nbsp;<span class="op" id="6371597">==</span>&nbsp;<span class="string" id="6371600">&#34;&#34;</span>&nbsp;<span class="op" id="6371603">||</span>&nbsp;<span class="ident" id="6371606">path</span>&nbsp;<span class="op" id="6371611">==</span>&nbsp;<span class="string" id="6371614">&#34;&#34;</span>&nbsp;<span class="op" id="6371617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371621">return</span>&nbsp;<span class="ident" id="6371628">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371637">if</span>&nbsp;<span class="ident" id="6371640">runtime</span><span class="op" id="6371647">.</span><span class="ident" id="6371648">GOOS</span>&nbsp;<span class="op" id="6371653">==</span>&nbsp;<span class="string" id="6371656">&#34;windows&#34;</span>&nbsp;<span class="op" id="6371666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371670">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371736">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371789">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371852">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371921">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371980">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372049">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372087">if</span>&nbsp;<span class="builtinfunc" id="6372090">len</span><span class="op" id="6372093">(</span><span class="ident" id="6372094">path</span><span class="op" id="6372098">)</span>&nbsp;<span class="op" id="6372100">&gt;=</span>&nbsp;<span class="num" id="6372103">2</span>&nbsp;<span class="op" id="6372105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372110">letter</span><span class="op" id="6372116">,</span>&nbsp;<span class="ident" id="6372118">colon</span>&nbsp;<span class="op" id="6372124">:=</span>&nbsp;<span class="ident" id="6372127">path</span><span class="op" id="6372131">[</span><span class="num" id="6372132">0</span><span class="op" id="6372133">]</span><span class="op" id="6372134">,</span>&nbsp;<span class="ident" id="6372136">path</span><span class="op" id="6372140">[</span><span class="num" id="6372141">1</span><span class="op" id="6372142">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372147">if</span>&nbsp;<span class="op" id="6372150">(</span><span class="string" id="6372151">&#39;a&#39;</span>&nbsp;<span class="op" id="6372155">&lt;=</span>&nbsp;<span class="ident" id="6372158">letter</span>&nbsp;<span class="op" id="6372165">&amp;&amp;</span>&nbsp;<span class="ident" id="6372168">letter</span>&nbsp;<span class="op" id="6372175">&lt;=</span>&nbsp;<span class="string" id="6372178">&#39;z&#39;</span>&nbsp;<span class="op" id="6372182">||</span>&nbsp;<span class="string" id="6372185">&#39;A&#39;</span>&nbsp;<span class="op" id="6372189">&lt;=</span>&nbsp;<span class="ident" id="6372192">letter</span>&nbsp;<span class="op" id="6372199">&amp;&amp;</span>&nbsp;<span class="ident" id="6372202">letter</span>&nbsp;<span class="op" id="6372209">&lt;=</span>&nbsp;<span class="string" id="6372212">&#39;Z&#39;</span><span class="op" id="6372215">)</span>&nbsp;<span class="op" id="6372217">&amp;&amp;</span>&nbsp;<span class="ident" id="6372220">colon</span>&nbsp;<span class="op" id="6372226">==</span>&nbsp;<span class="string" id="6372229">&#39;:&#39;</span>&nbsp;<span class="op" id="6372233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6372239">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372313">return</span>&nbsp;<span class="ident" id="6372320">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372338">if</span>&nbsp;<span class="ident" id="6372341">os</span><span class="op" id="6372343">.</span><span class="ident" id="6372344">IsPathSeparator</span><span class="op" id="6372359">(</span><span class="ident" id="6372360">path</span><span class="op" id="6372364">[</span><span class="num" id="6372365">0</span><span class="op" id="6372366">]</span><span class="op" id="6372367">)</span>&nbsp;<span class="op" id="6372369">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372373">return</span>&nbsp;<span class="ident" id="6372380">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372389">return</span>&nbsp;<span class="ident" id="6372396">fmt</span><span class="op" id="6372399">.</span><span class="ident" id="6372400">Sprintf</span><span class="op" id="6372407">(</span><span class="string" id="6372408">&#34;%s%c%s&#34;</span><span class="op" id="6372416">,</span>&nbsp;<span class="op" id="6372418">*</span><span class="ident" id="6372419">outputDir</span><span class="op" id="6372428">,</span>&nbsp;<span class="ident" id="6372430">os</span><span class="op" id="6372432">.</span><span class="ident" id="6372433">PathSeparator</span><span class="op" id="6372446">,</span>&nbsp;<span class="ident" id="6372448">path</span><span class="op" id="6372452">)</span><br>
<span class="lineno"></span><span class="op" id="6372454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6372457">var</span>&nbsp;<span class="ident" id="6372461">timer</span>&nbsp;<span class="op" id="6372467">*</span><span class="ident" id="6372468">time</span><span class="op" id="6372472">.</span><span class="ident" id="6372473">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372480">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6372524">func</span>&nbsp;<span class="ident" id="6372529">startAlarm</span><span class="op" id="6372539">(</span><span class="op" id="6372540">)</span>&nbsp;<span class="op" id="6372542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372545">if</span>&nbsp;<span class="op" id="6372548">*</span><span class="ident" id="6372549">timeout</span>&nbsp;<span class="op" id="6372557">&gt;</span>&nbsp;<span class="num" id="6372559">0</span>&nbsp;<span class="op" id="6372561">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372565">timer</span>&nbsp;<span class="op" id="6372571">=</span>&nbsp;<span class="ident" id="6372573">time</span><span class="op" id="6372577">.</span><span class="ident" id="6372578">AfterFunc</span><span class="op" id="6372587">(</span><span class="op" id="6372588">*</span><span class="ident" id="6372589">timeout</span><span class="op" id="6372596">,</span>&nbsp;<span class="keyword" id="6372598">func</span><span class="op" id="6372602">(</span><span class="op" id="6372603">)</span>&nbsp;<span class="op" id="6372605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6372610">panic</span><span class="op" id="6372615">(</span><span class="ident" id="6372616">fmt</span><span class="op" id="6372619">.</span><span class="ident" id="6372620">Sprintf</span><span class="op" id="6372627">(</span><span class="string" id="6372628">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6372653">,</span>&nbsp;<span class="op" id="6372655">*</span><span class="ident" id="6372656">timeout</span><span class="op" id="6372663">)</span><span class="op" id="6372664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372668">}</span><span class="op" id="6372669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372672">}</span><br>
<span class="lineno"></span><span class="op" id="6372674">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6372677">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6372711">func</span>&nbsp;<span class="ident" id="6372716">stopAlarm</span><span class="op" id="6372725">(</span><span class="op" id="6372726">)</span>&nbsp;<span class="op" id="6372728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372731">if</span>&nbsp;<span class="op" id="6372734">*</span><span class="ident" id="6372735">timeout</span>&nbsp;<span class="op" id="6372743">&gt;</span>&nbsp;<span class="num" id="6372745">0</span>&nbsp;<span class="op" id="6372747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372751">timer</span><span class="op" id="6372756">.</span><span class="ident" id="6372757">Stop</span><span class="op" id="6372761">(</span><span class="op" id="6372762">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372765">}</span><br>
<span class="lineno"></span><span class="op" id="6372767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372770">func</span>&nbsp;<span class="ident" id="6372775">parseCpuList</span><span class="op" id="6372787">(</span><span class="op" id="6372788">)</span>&nbsp;<span class="op" id="6372790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372793">for</span>&nbsp;<span class="ident" id="6372797">_</span><span class="op" id="6372798">,</span>&nbsp;<span class="ident" id="6372800">val</span>&nbsp;<span class="op" id="6372804">:=</span>&nbsp;<span class="keyword" id="6372807">range</span>&nbsp;<span class="ident" id="6372813">strings</span><span class="op" id="6372820">.</span><span class="ident" id="6372821">Split</span><span class="op" id="6372826">(</span><span class="op" id="6372827">*</span><span class="ident" id="6372828">cpuListStr</span><span class="op" id="6372838">,</span>&nbsp;<span class="string" id="6372840">&#34;,&#34;</span><span class="op" id="6372843">)</span>&nbsp;<span class="op" id="6372845">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372849">val</span>&nbsp;<span class="op" id="6372853">=</span>&nbsp;<span class="ident" id="6372855">strings</span><span class="op" id="6372862">.</span><span class="ident" id="6372863">TrimSpace</span><span class="op" id="6372872">(</span><span class="ident" id="6372873">val</span><span class="op" id="6372876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372880">if</span>&nbsp;<span class="ident" id="6372883">val</span>&nbsp;<span class="op" id="6372887">==</span>&nbsp;<span class="string" id="6372890">&#34;&#34;</span>&nbsp;<span class="op" id="6372893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372898">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372913">cpu</span><span class="op" id="6372916">,</span>&nbsp;<span class="ident" id="6372918">err</span>&nbsp;<span class="op" id="6372922">:=</span>&nbsp;<span class="ident" id="6372925">strconv</span><span class="op" id="6372932">.</span><span class="ident" id="6372933">Atoi</span><span class="op" id="6372937">(</span><span class="ident" id="6372938">val</span><span class="op" id="6372941">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372945">if</span>&nbsp;<span class="ident" id="6372948">err</span>&nbsp;<span class="op" id="6372952">!=</span>&nbsp;<span class="ident" id="6372955">nil</span>&nbsp;<span class="op" id="6372959">||</span>&nbsp;<span class="ident" id="6372962">cpu</span>&nbsp;<span class="op" id="6372966">&lt;=</span>&nbsp;<span class="num" id="6372969">0</span>&nbsp;<span class="op" id="6372971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372976">fmt</span><span class="op" id="6372979">.</span><span class="ident" id="6372980">Fprintf</span><span class="op" id="6372987">(</span><span class="ident" id="6372988">os</span><span class="op" id="6372990">.</span><span class="ident" id="6372991">Stderr</span><span class="op" id="6372997">,</span>&nbsp;<span class="string" id="6372999">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6373042">,</span>&nbsp;<span class="ident" id="6373044">val</span><span class="op" id="6373047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373052">os</span><span class="op" id="6373054">.</span><span class="ident" id="6373055">Exit</span><span class="op" id="6373059">(</span><span class="num" id="6373060">1</span><span class="op" id="6373061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373069">cpuList</span>&nbsp;<span class="op" id="6373077">=</span>&nbsp;<span class="builtinfunc" id="6373079">append</span><span class="op" id="6373085">(</span><span class="ident" id="6373086">cpuList</span><span class="op" id="6373093">,</span>&nbsp;<span class="ident" id="6373095">cpu</span><span class="op" id="6373098">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373104">if</span>&nbsp;<span class="ident" id="6373107">cpuList</span>&nbsp;<span class="op" id="6373115">==</span>&nbsp;<span class="ident" id="6373118">nil</span>&nbsp;<span class="op" id="6373122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373126">cpuList</span>&nbsp;<span class="op" id="6373134">=</span>&nbsp;<span class="builtinfunc" id="6373136">append</span><span class="op" id="6373142">(</span><span class="ident" id="6373143">cpuList</span><span class="op" id="6373150">,</span>&nbsp;<span class="ident" id="6373152">runtime</span><span class="op" id="6373159">.</span><span class="ident" id="6373160">GOMAXPROCS</span><span class="op" id="6373170">(</span><span class="op" id="6373171">-</span><span class="num" id="6373172">1</span><span class="op" id="6373173">)</span><span class="op" id="6373174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373177">}</span><br>
<span class="lineno"></span><span class="op" id="6373179">}</span>
</div>
</body>
</html>
