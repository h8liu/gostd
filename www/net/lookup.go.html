<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1454058">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1454114">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1454168">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1454219">package</span>&nbsp;<span class="ident" id="1454227">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1454232">import</span>&nbsp;<span class="string" id="1454239">&#34;time&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454247">//&nbsp;protocols&nbsp;contains&nbsp;minimal&nbsp;mappings&nbsp;between&nbsp;internet&nbsp;protocol</span><br>
<span class="lineno">10</span><span class="comment" id="1454312">//&nbsp;names&nbsp;and&nbsp;numbers&nbsp;for&nbsp;platforms&nbsp;that&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;complete&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1454382">//&nbsp;protocol&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="1454403">//</span><br>
<span class="lineno"></span><span class="comment" id="1454406">//&nbsp;See&nbsp;http://www.iana.org/assignments/protocol-numbers</span><br>
<span class="lineno"></span><span class="keyword" id="1454462">var</span>&nbsp;<span class="ident" id="1454466">protocols</span>&nbsp;<span class="op" id="1454476">=</span>&nbsp;<span class="keyword" id="1454478">map</span><span class="op" id="1454481">[</span><span class="builtintype" id="1454482">string</span><span class="op" id="1454488">]</span><span class="builtintype" id="1454489">int</span><span class="op" id="1454492">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454495">&#34;icmp&#34;</span><span class="op" id="1454501">:</span>&nbsp;<span class="num" id="1454503">1</span><span class="op" id="1454504">,</span>&nbsp;<span class="string" id="1454506">&#34;ICMP&#34;</span><span class="op" id="1454512">:</span>&nbsp;<span class="num" id="1454514">1</span><span class="op" id="1454515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454518">&#34;igmp&#34;</span><span class="op" id="1454524">:</span>&nbsp;<span class="num" id="1454526">2</span><span class="op" id="1454527">,</span>&nbsp;<span class="string" id="1454529">&#34;IGMP&#34;</span><span class="op" id="1454535">:</span>&nbsp;<span class="num" id="1454537">2</span><span class="op" id="1454538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454541">&#34;tcp&#34;</span><span class="op" id="1454546">:</span>&nbsp;<span class="num" id="1454548">6</span><span class="op" id="1454549">,</span>&nbsp;<span class="string" id="1454551">&#34;TCP&#34;</span><span class="op" id="1454556">:</span>&nbsp;<span class="num" id="1454558">6</span><span class="op" id="1454559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454562">&#34;udp&#34;</span><span class="op" id="1454567">:</span>&nbsp;<span class="num" id="1454569">17</span><span class="op" id="1454571">,</span>&nbsp;<span class="string" id="1454573">&#34;UDP&#34;</span><span class="op" id="1454578">:</span>&nbsp;<span class="num" id="1454580">17</span><span class="op" id="1454582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454585">&#34;ipv6-icmp&#34;</span><span class="op" id="1454596">:</span>&nbsp;<span class="num" id="1454598">58</span><span class="op" id="1454600">,</span>&nbsp;<span class="string" id="1454602">&#34;IPV6-ICMP&#34;</span><span class="op" id="1454613">:</span>&nbsp;<span class="num" id="1454615">58</span><span class="op" id="1454617">,</span>&nbsp;<span class="string" id="1454619">&#34;IPv6-ICMP&#34;</span><span class="op" id="1454630">:</span>&nbsp;<span class="num" id="1454632">58</span><span class="op" id="1454634">,</span><br>
<span class="lineno">20</span><span class="op" id="1454636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454639">//&nbsp;LookupHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;given&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="1454703">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="1454752">func</span>&nbsp;<span class="ident" id="1454757">LookupHost</span><span class="op" id="1454767">(</span><span class="ident" id="1454768">host</span>&nbsp;<span class="builtintype" id="1454773">string</span><span class="op" id="1454779">)</span>&nbsp;<span class="op" id="1454781">(</span><span class="ident" id="1454782">addrs</span>&nbsp;<span class="op" id="1454788">[</span><span class="op" id="1454789">]</span><span class="builtintype" id="1454790">string</span><span class="op" id="1454796">,</span>&nbsp;<span class="ident" id="1454798">err</span>&nbsp;<span class="builtintype" id="1454802">error</span><span class="op" id="1454807">)</span>&nbsp;<span class="op" id="1454809">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1454812">return</span>&nbsp;<span class="ident" id="1454819"><a href="/net/lookup_unix.go.html#1459822">lookupHost</a></span><span class="op" id="1454829">(</span><span class="ident" id="1454830"><a href="/net/lookup.go.html#1454768">host</a></span><span class="op" id="1454834">)</span><br>
<span class="lineno"></span><span class="op" id="1454836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454839">//&nbsp;LookupIP&nbsp;looks&nbsp;up&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="1454891">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno">30</span><span class="keyword" id="1454954">func</span>&nbsp;<span class="ident" id="1454959">LookupIP</span><span class="op" id="1454967">(</span><span class="ident" id="1454968">host</span>&nbsp;<span class="builtintype" id="1454973">string</span><span class="op" id="1454979">)</span>&nbsp;<span class="op" id="1454981">(</span><span class="ident" id="1454982">addrs</span>&nbsp;<span class="op" id="1454988">[</span><span class="op" id="1454989">]</span><span class="ident" id="1454990"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1454992">,</span>&nbsp;<span class="ident" id="1454994">err</span>&nbsp;<span class="builtintype" id="1454998">error</span><span class="op" id="1455003">)</span>&nbsp;<span class="op" id="1455005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455008">return</span>&nbsp;<span class="ident" id="1455015"><a href="/net/lookup.go.html#1455243">lookupIPMerge</a></span><span class="op" id="1455028">(</span><span class="ident" id="1455029"><a href="/net/lookup.go.html#1454968">host</a></span><span class="op" id="1455033">)</span><br>
<span class="lineno"></span><span class="op" id="1455035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1455038">var</span>&nbsp;<span class="ident" id="1455042">lookupGroup</span>&nbsp;<span class="ident" id="1455054"><a href="/net/singleflight.go.html#1486295">singleflight</a></span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1455068">//&nbsp;lookupIPMerge&nbsp;wraps&nbsp;lookupIP,&nbsp;but&nbsp;makes&nbsp;sure&nbsp;that&nbsp;for&nbsp;any&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="1455135">//&nbsp;host,&nbsp;only&nbsp;one&nbsp;lookup&nbsp;is&nbsp;in-flight&nbsp;at&nbsp;a&nbsp;time.&nbsp;The&nbsp;returned&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1455204">//&nbsp;is&nbsp;always&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="keyword" id="1455238">func</span>&nbsp;<span class="ident" id="1455243">lookupIPMerge</span><span class="op" id="1455256">(</span><span class="ident" id="1455257">host</span>&nbsp;<span class="builtintype" id="1455262">string</span><span class="op" id="1455268">)</span>&nbsp;<span class="op" id="1455270">(</span><span class="ident" id="1455271">addrs</span>&nbsp;<span class="op" id="1455277">[</span><span class="op" id="1455278">]</span><span class="ident" id="1455279"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1455281">,</span>&nbsp;<span class="ident" id="1455283">err</span>&nbsp;<span class="builtintype" id="1455287">error</span><span class="op" id="1455292">)</span>&nbsp;<span class="op" id="1455294">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1455297">addrsi</span><span class="op" id="1455303">,</span>&nbsp;<span class="ident" id="1455305"><a href="/net/lookup.go.html#1455283">err</a></span><span class="op" id="1455308">,</span>&nbsp;<span class="ident" id="1455310">shared</span>&nbsp;<span class="op" id="1455317">:=</span>&nbsp;<span class="ident" id="1455320"><a href="/net/lookup.go.html#1455042">lookupGroup</a></span><span class="op" id="1455331">.</span><span class="ident" id="1455332">Do</span><span class="op" id="1455334">(</span><span class="ident" id="1455335"><a href="/net/lookup.go.html#1455257">host</a></span><span class="op" id="1455339">,</span>&nbsp;<span class="keyword" id="1455341">func</span><span class="op" id="1455345">(</span><span class="op" id="1455346">)</span>&nbsp;<span class="op" id="1455348">(</span><span class="keyword" id="1455349">interface</span><span class="op" id="1455358">{</span><span class="op" id="1455359">}</span><span class="op" id="1455360">,</span>&nbsp;<span class="builtintype" id="1455362">error</span><span class="op" id="1455367">)</span>&nbsp;<span class="op" id="1455369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455373">return</span>&nbsp;<span class="ident" id="1455380"><a href="/net/lookup_unix.go.html#1459978">lookupIP</a></span><span class="op" id="1455388">(</span><span class="ident" id="1455389"><a href="/net/lookup.go.html#1455257">host</a></span><span class="op" id="1455393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1455396">}</span><span class="op" id="1455397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455400">return</span>&nbsp;<span class="ident" id="1455407"><a href="/net/lookup.go.html#1455555">lookupIPReturn</a></span><span class="op" id="1455421">(</span><span class="ident" id="1455422"><a href="/net/lookup.go.html#1455297">addrsi</a></span><span class="op" id="1455428">,</span>&nbsp;<span class="ident" id="1455430"><a href="/net/lookup.go.html#1455283">err</a></span><span class="op" id="1455433">,</span>&nbsp;<span class="ident" id="1455435"><a href="/net/lookup.go.html#1455310">shared</a></span><span class="op" id="1455441">)</span><br>
<span class="lineno"></span><span class="op" id="1455443">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1455446">//&nbsp;lookupIPReturn&nbsp;turns&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;singleflight.Do&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="1455514">//&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="keyword" id="1455550">func</span>&nbsp;<span class="ident" id="1455555">lookupIPReturn</span><span class="op" id="1455569">(</span><span class="ident" id="1455570">addrsi</span>&nbsp;<span class="keyword" id="1455577">interface</span><span class="op" id="1455586">{</span><span class="op" id="1455587">}</span><span class="op" id="1455588">,</span>&nbsp;<span class="ident" id="1455590">err</span>&nbsp;<span class="builtintype" id="1455594">error</span><span class="op" id="1455599">,</span>&nbsp;<span class="ident" id="1455601">shared</span>&nbsp;<span class="builtintype" id="1455608">bool</span><span class="op" id="1455612">)</span>&nbsp;<span class="op" id="1455614">(</span><span class="op" id="1455615">[</span><span class="op" id="1455616">]</span><span class="ident" id="1455617"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1455619">,</span>&nbsp;<span class="builtintype" id="1455621">error</span><span class="op" id="1455626">)</span>&nbsp;<span class="op" id="1455628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455631">if</span>&nbsp;<span class="ident" id="1455634"><a href="/net/lookup.go.html#1455590">err</a></span>&nbsp;<span class="op" id="1455638">!=</span>&nbsp;<span class="ident" id="1455641">nil</span>&nbsp;<span class="op" id="1455645">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455649">return</span>&nbsp;<span class="ident" id="1455656">nil</span><span class="op" id="1455659">,</span>&nbsp;<span class="ident" id="1455661"><a href="/net/lookup.go.html#1455590">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1455666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1455669">addrs</span>&nbsp;<span class="op" id="1455675">:=</span>&nbsp;<span class="ident" id="1455678"><a href="/net/lookup.go.html#1455570">addrsi</a></span><span class="op" id="1455684">.</span><span class="op" id="1455685">(</span><span class="op" id="1455686">[</span><span class="op" id="1455687">]</span><span class="ident" id="1455688"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1455690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455693">if</span>&nbsp;<span class="ident" id="1455696"><a href="/net/lookup.go.html#1455601">shared</a></span>&nbsp;<span class="op" id="1455703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1455707">clone</span>&nbsp;<span class="op" id="1455713">:=</span>&nbsp;<span class="builtinfunc" id="1455716">make</span><span class="op" id="1455720">(</span><span class="op" id="1455721">[</span><span class="op" id="1455722">]</span><span class="ident" id="1455723"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1455725">,</span>&nbsp;<span class="builtinfunc" id="1455727">len</span><span class="op" id="1455730">(</span><span class="ident" id="1455731"><a href="/net/lookup.go.html#1455669">addrs</a></span><span class="op" id="1455736">)</span><span class="op" id="1455737">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1455741">copy</span><span class="op" id="1455745">(</span><span class="ident" id="1455746"><a href="/net/lookup.go.html#1455707">clone</a></span><span class="op" id="1455751">,</span>&nbsp;<span class="ident" id="1455753"><a href="/net/lookup.go.html#1455669">addrs</a></span><span class="op" id="1455758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1455762"><a href="/net/lookup.go.html#1455669">addrs</a></span>&nbsp;<span class="op" id="1455768">=</span>&nbsp;<span class="ident" id="1455770"><a href="/net/lookup.go.html#1455707">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1455777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455780">return</span>&nbsp;<span class="ident" id="1455787"><a href="/net/lookup.go.html#1455669">addrs</a></span><span class="op" id="1455792">,</span>&nbsp;<span class="ident" id="1455794">nil</span><br>
<span class="lineno"></span><span class="op" id="1455798">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1455801">//&nbsp;lookupIPDeadline&nbsp;looks&nbsp;up&nbsp;a&nbsp;hostname&nbsp;with&nbsp;a&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="1455858">func</span>&nbsp;<span class="ident" id="1455863">lookupIPDeadline</span><span class="op" id="1455879">(</span><span class="ident" id="1455880">host</span>&nbsp;<span class="builtintype" id="1455885">string</span><span class="op" id="1455891">,</span>&nbsp;<span class="ident" id="1455893">deadline</span>&nbsp;<span class="ident" id="1455902"><a href="/net/lookup.go.html#1454239">time</a></span><span class="op" id="1455906">.</span><span class="ident" id="1455907">Time</span><span class="op" id="1455911">)</span>&nbsp;<span class="op" id="1455913">(</span><span class="ident" id="1455914">addrs</span>&nbsp;<span class="op" id="1455920">[</span><span class="op" id="1455921">]</span><span class="ident" id="1455922"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1455924">,</span>&nbsp;<span class="ident" id="1455926">err</span>&nbsp;<span class="builtintype" id="1455930">error</span><span class="op" id="1455935">)</span>&nbsp;<span class="op" id="1455937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455940">if</span>&nbsp;<span class="ident" id="1455943"><a href="/net/lookup.go.html#1455893">deadline</a></span><span class="op" id="1455951">.</span><span class="ident" id="1455952">IsZero</span><span class="op" id="1455958">(</span><span class="op" id="1455959">)</span>&nbsp;<span class="op" id="1455961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1455965">return</span>&nbsp;<span class="ident" id="1455972"><a href="/net/lookup.go.html#1455243">lookupIPMerge</a></span><span class="op" id="1455985">(</span><span class="ident" id="1455986"><a href="/net/lookup.go.html#1455880">host</a></span><span class="op" id="1455990">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1455993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1455997">//&nbsp;We&nbsp;could&nbsp;push&nbsp;the&nbsp;deadline&nbsp;down&nbsp;into&nbsp;the&nbsp;name&nbsp;resolution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456058">//&nbsp;functions.&nbsp;&nbsp;However,&nbsp;the&nbsp;most&nbsp;commonly&nbsp;used&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456121">//&nbsp;calls&nbsp;getaddrinfo,&nbsp;which&nbsp;has&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456167">timeout</span>&nbsp;<span class="op" id="1456175">:=</span>&nbsp;<span class="ident" id="1456178"><a href="/net/lookup.go.html#1455893">deadline</a></span><span class="op" id="1456186">.</span><span class="ident" id="1456187">Sub</span><span class="op" id="1456190">(</span><span class="ident" id="1456191"><a href="/net/lookup.go.html#1454239">time</a></span><span class="op" id="1456195">.</span><span class="ident" id="1456196">Now</span><span class="op" id="1456199">(</span><span class="op" id="1456200">)</span><span class="op" id="1456201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456204">if</span>&nbsp;<span class="ident" id="1456207"><a href="/net/lookup.go.html#1456167">timeout</a></span>&nbsp;<span class="op" id="1456215">&lt;=</span>&nbsp;<span class="num" id="1456218">0</span>&nbsp;<span class="op" id="1456220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456224">return</span>&nbsp;<span class="ident" id="1456231">nil</span><span class="op" id="1456234">,</span>&nbsp;<span class="ident" id="1456236"><a href="/net/net.go.html#1472112">errTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1456248">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456251">t</span>&nbsp;<span class="op" id="1456253">:=</span>&nbsp;<span class="ident" id="1456256"><a href="/net/lookup.go.html#1454239">time</a></span><span class="op" id="1456260">.</span><span class="ident" id="1456261">NewTimer</span><span class="op" id="1456269">(</span><span class="ident" id="1456270"><a href="/net/lookup.go.html#1456167">timeout</a></span><span class="op" id="1456277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456280">defer</span>&nbsp;<span class="ident" id="1456286"><a href="/net/lookup.go.html#1456251">t</a></span><span class="op" id="1456287">.</span><span class="ident" id="1456288">Stop</span><span class="op" id="1456292">(</span><span class="op" id="1456293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456297">ch</span>&nbsp;<span class="op" id="1456300">:=</span>&nbsp;<span class="ident" id="1456303"><a href="/net/lookup.go.html#1455042">lookupGroup</a></span><span class="op" id="1456314">.</span><span class="ident" id="1456315">DoChan</span><span class="op" id="1456321">(</span><span class="ident" id="1456322"><a href="/net/lookup.go.html#1455880">host</a></span><span class="op" id="1456326">,</span>&nbsp;<span class="keyword" id="1456328">func</span><span class="op" id="1456332">(</span><span class="op" id="1456333">)</span>&nbsp;<span class="op" id="1456335">(</span><span class="keyword" id="1456336">interface</span><span class="op" id="1456345">{</span><span class="op" id="1456346">}</span><span class="op" id="1456347">,</span>&nbsp;<span class="builtintype" id="1456349">error</span><span class="op" id="1456354">)</span>&nbsp;<span class="op" id="1456356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456360">return</span>&nbsp;<span class="ident" id="1456367"><a href="/net/lookup_unix.go.html#1459978">lookupIP</a></span><span class="op" id="1456375">(</span><span class="ident" id="1456376"><a href="/net/lookup.go.html#1455880">host</a></span><span class="op" id="1456380">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1456383">}</span><span class="op" id="1456384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456388">select</span>&nbsp;<span class="op" id="1456395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456398">case</span>&nbsp;<span class="op" id="1456403">&lt;-</span><span class="ident" id="1456405"><a href="/net/lookup.go.html#1456251">t</a></span><span class="op" id="1456406">.</span><span class="ident" id="1456407">C</span><span class="op" id="1456408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456412">//&nbsp;The&nbsp;DNS&nbsp;lookup&nbsp;timed&nbsp;out&nbsp;for&nbsp;some&nbsp;reason.&nbsp;&nbsp;Force</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456466">//&nbsp;future&nbsp;requests&nbsp;to&nbsp;start&nbsp;the&nbsp;DNS&nbsp;lookup&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456517">//&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for&nbsp;the&nbsp;current&nbsp;lookup&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1456568">//&nbsp;complete.&nbsp;&nbsp;See&nbsp;issue&nbsp;8602.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1456600"><a href="/net/lookup.go.html#1455042">lookupGroup</a></span><span class="op" id="1456611">.</span><span class="ident" id="1456612">Forget</span><span class="op" id="1456618">(</span><span class="ident" id="1456619"><a href="/net/lookup.go.html#1455880">host</a></span><span class="op" id="1456623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456628">return</span>&nbsp;<span class="ident" id="1456635">nil</span><span class="op" id="1456638">,</span>&nbsp;<span class="ident" id="1456640"><a href="/net/net.go.html#1472112">errTimeout</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456653">case</span>&nbsp;<span class="ident" id="1456658">r</span>&nbsp;<span class="op" id="1456660">:=</span>&nbsp;<span class="op" id="1456663">&lt;-</span><span class="ident" id="1456665"><a href="/net/lookup.go.html#1456297">ch</a></span><span class="op" id="1456667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456671">return</span>&nbsp;<span class="ident" id="1456678"><a href="/net/lookup.go.html#1455555">lookupIPReturn</a></span><span class="op" id="1456692">(</span><span class="ident" id="1456693"><a href="/net/lookup.go.html#1456658">r</a></span><span class="op" id="1456694">.</span><span class="ident" id="1456695">v</span><span class="op" id="1456696">,</span>&nbsp;<span class="ident" id="1456698"><a href="/net/lookup.go.html#1456658">r</a></span><span class="op" id="1456699">.</span><span class="ident" id="1456700">err</span><span class="op" id="1456703">,</span>&nbsp;<span class="ident" id="1456705"><a href="/net/lookup.go.html#1456658">r</a></span><span class="op" id="1456706">.</span><span class="ident" id="1456707">shared</span><span class="op" id="1456713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1456716">}</span><br>
<span class="lineno">95</span><span class="op" id="1456718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456721">//&nbsp;LookupPort&nbsp;looks&nbsp;up&nbsp;the&nbsp;port&nbsp;for&nbsp;the&nbsp;given&nbsp;network&nbsp;and&nbsp;service.</span><br>
<span class="lineno"></span><span class="keyword" id="1456788">func</span>&nbsp;<span class="ident" id="1456793">LookupPort</span><span class="op" id="1456803">(</span><span class="ident" id="1456804">network</span><span class="op" id="1456811">,</span>&nbsp;<span class="ident" id="1456813">service</span>&nbsp;<span class="builtintype" id="1456821">string</span><span class="op" id="1456827">)</span>&nbsp;<span class="op" id="1456829">(</span><span class="ident" id="1456830">port</span>&nbsp;<span class="builtintype" id="1456835">int</span><span class="op" id="1456838">,</span>&nbsp;<span class="ident" id="1456840">err</span>&nbsp;<span class="builtintype" id="1456844">error</span><span class="op" id="1456849">)</span>&nbsp;<span class="op" id="1456851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1456854">return</span>&nbsp;<span class="ident" id="1456861"><a href="/net/lookup_unix.go.html#1460124">lookupPort</a></span><span class="op" id="1456871">(</span><span class="ident" id="1456872"><a href="/net/lookup.go.html#1456804">network</a></span><span class="op" id="1456879">,</span>&nbsp;<span class="ident" id="1456881"><a href="/net/lookup.go.html#1456813">service</a></span><span class="op" id="1456888">)</span><br>
<span class="lineno">100</span><span class="op" id="1456890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456893">//&nbsp;LookupCNAME&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;DNS&nbsp;host&nbsp;for&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="1456959">//&nbsp;Callers&nbsp;that&nbsp;do&nbsp;not&nbsp;care&nbsp;about&nbsp;the&nbsp;canonical&nbsp;name&nbsp;can&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="1457021">//&nbsp;LookupHost&nbsp;or&nbsp;LookupIP&nbsp;directly;&nbsp;both&nbsp;take&nbsp;care&nbsp;of&nbsp;resolving</span><br>
<span class="lineno">105</span><span class="comment" id="1457085">//&nbsp;the&nbsp;canonical&nbsp;name&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;lookup.</span><br>
<span class="lineno"></span><span class="keyword" id="1457130">func</span>&nbsp;<span class="ident" id="1457135">LookupCNAME</span><span class="op" id="1457146">(</span><span class="ident" id="1457147">name</span>&nbsp;<span class="builtintype" id="1457152">string</span><span class="op" id="1457158">)</span>&nbsp;<span class="op" id="1457160">(</span><span class="ident" id="1457161">cname</span>&nbsp;<span class="builtintype" id="1457167">string</span><span class="op" id="1457173">,</span>&nbsp;<span class="ident" id="1457175">err</span>&nbsp;<span class="builtintype" id="1457179">error</span><span class="op" id="1457184">)</span>&nbsp;<span class="op" id="1457186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457189">return</span>&nbsp;<span class="ident" id="1457196"><a href="/net/lookup_unix.go.html#1460308">lookupCNAME</a></span><span class="op" id="1457207">(</span><span class="ident" id="1457208"><a href="/net/lookup.go.html#1457147">name</a></span><span class="op" id="1457212">)</span><br>
<span class="lineno"></span><span class="op" id="1457214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1457217">//&nbsp;LookupSRV&nbsp;tries&nbsp;to&nbsp;resolve&nbsp;an&nbsp;SRV&nbsp;query&nbsp;of&nbsp;the&nbsp;given&nbsp;service,</span><br>
<span class="lineno"></span><span class="comment" id="1457282">//&nbsp;protocol,&nbsp;and&nbsp;domain&nbsp;name.&nbsp;&nbsp;The&nbsp;proto&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;or&nbsp;&#34;udp&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1457342">//&nbsp;The&nbsp;returned&nbsp;records&nbsp;are&nbsp;sorted&nbsp;by&nbsp;priority&nbsp;and&nbsp;randomized</span><br>
<span class="lineno"></span><span class="comment" id="1457404">//&nbsp;by&nbsp;weight&nbsp;within&nbsp;a&nbsp;priority.</span><br>
<span class="lineno"></span><span class="comment" id="1457436">//</span><br>
<span class="lineno">115</span><span class="comment" id="1457439">//&nbsp;LookupSRV&nbsp;constructs&nbsp;the&nbsp;DNS&nbsp;name&nbsp;to&nbsp;look&nbsp;up&nbsp;following&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="comment" id="1457507">//&nbsp;That&nbsp;is,&nbsp;it&nbsp;looks&nbsp;up&nbsp;_service._proto.name.&nbsp;&nbsp;To&nbsp;accommodate&nbsp;services</span><br>
<span class="lineno"></span><span class="comment" id="1457578">//&nbsp;publishing&nbsp;SRV&nbsp;records&nbsp;under&nbsp;non-standard&nbsp;names,&nbsp;if&nbsp;both&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="1457646">//&nbsp;and&nbsp;proto&nbsp;are&nbsp;empty&nbsp;strings,&nbsp;LookupSRV&nbsp;looks&nbsp;up&nbsp;name&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1457712">func</span>&nbsp;<span class="ident" id="1457717">LookupSRV</span><span class="op" id="1457726">(</span><span class="ident" id="1457727">service</span><span class="op" id="1457734">,</span>&nbsp;<span class="ident" id="1457736">proto</span><span class="op" id="1457741">,</span>&nbsp;<span class="ident" id="1457743">name</span>&nbsp;<span class="builtintype" id="1457748">string</span><span class="op" id="1457754">)</span>&nbsp;<span class="op" id="1457756">(</span><span class="ident" id="1457757">cname</span>&nbsp;<span class="builtintype" id="1457763">string</span><span class="op" id="1457769">,</span>&nbsp;<span class="ident" id="1457771">addrs</span>&nbsp;<span class="op" id="1457777">[</span><span class="op" id="1457778">]</span><span class="op" id="1457779">*</span><span class="ident" id="1457780"><a href="/net/dnsclient.go.html#1343670">SRV</a></span><span class="op" id="1457783">,</span>&nbsp;<span class="ident" id="1457785">err</span>&nbsp;<span class="builtintype" id="1457789">error</span><span class="op" id="1457794">)</span>&nbsp;<span class="op" id="1457796">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457799">return</span>&nbsp;<span class="ident" id="1457806"><a href="/net/lookup_unix.go.html#1460465">lookupSRV</a></span><span class="op" id="1457815">(</span><span class="ident" id="1457816"><a href="/net/lookup.go.html#1457727">service</a></span><span class="op" id="1457823">,</span>&nbsp;<span class="ident" id="1457825"><a href="/net/lookup.go.html#1457736">proto</a></span><span class="op" id="1457830">,</span>&nbsp;<span class="ident" id="1457832"><a href="/net/lookup.go.html#1457743">name</a></span><span class="op" id="1457836">)</span><br>
<span class="lineno"></span><span class="op" id="1457838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457841">//&nbsp;LookupMX&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;MX&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name&nbsp;sorted&nbsp;by&nbsp;preference.</span><br>
<span class="lineno"></span><span class="keyword" id="1457928">func</span>&nbsp;<span class="ident" id="1457933">LookupMX</span><span class="op" id="1457941">(</span><span class="ident" id="1457942">name</span>&nbsp;<span class="builtintype" id="1457947">string</span><span class="op" id="1457953">)</span>&nbsp;<span class="op" id="1457955">(</span><span class="ident" id="1457956">mx</span>&nbsp;<span class="op" id="1457959">[</span><span class="op" id="1457960">]</span><span class="op" id="1457961">*</span><span class="ident" id="1457962"><a href="/net/dnsclient.go.html#1344955">MX</a></span><span class="op" id="1457964">,</span>&nbsp;<span class="ident" id="1457966">err</span>&nbsp;<span class="builtintype" id="1457970">error</span><span class="op" id="1457975">)</span>&nbsp;<span class="op" id="1457977">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1457980">return</span>&nbsp;<span class="ident" id="1457987"><a href="/net/lookup_unix.go.html#1460980">lookupMX</a></span><span class="op" id="1457995">(</span><span class="ident" id="1457996"><a href="/net/lookup.go.html#1457942">name</a></span><span class="op" id="1458000">)</span><br>
<span class="lineno"></span><span class="op" id="1458002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458005">//&nbsp;LookupNS&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;NS&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="1458071">func</span>&nbsp;<span class="ident" id="1458076">LookupNS</span><span class="op" id="1458084">(</span><span class="ident" id="1458085">name</span>&nbsp;<span class="builtintype" id="1458090">string</span><span class="op" id="1458096">)</span>&nbsp;<span class="op" id="1458098">(</span><span class="ident" id="1458099">ns</span>&nbsp;<span class="op" id="1458102">[</span><span class="op" id="1458103">]</span><span class="op" id="1458104">*</span><span class="ident" id="1458105"><a href="/net/dnsclient.go.html#1345477">NS</a></span><span class="op" id="1458107">,</span>&nbsp;<span class="ident" id="1458109">err</span>&nbsp;<span class="builtintype" id="1458113">error</span><span class="op" id="1458118">)</span>&nbsp;<span class="op" id="1458120">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458123">return</span>&nbsp;<span class="ident" id="1458130"><a href="/net/lookup_unix.go.html#1461249">lookupNS</a></span><span class="op" id="1458138">(</span><span class="ident" id="1458139"><a href="/net/lookup.go.html#1458085">name</a></span><span class="op" id="1458143">)</span><br>
<span class="lineno"></span><span class="op" id="1458145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458148">//&nbsp;LookupTXT&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;TXT&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="1458216">func</span>&nbsp;<span class="ident" id="1458221">LookupTXT</span><span class="op" id="1458230">(</span><span class="ident" id="1458231">name</span>&nbsp;<span class="builtintype" id="1458236">string</span><span class="op" id="1458242">)</span>&nbsp;<span class="op" id="1458244">(</span><span class="ident" id="1458245">txt</span>&nbsp;<span class="op" id="1458249">[</span><span class="op" id="1458250">]</span><span class="builtintype" id="1458251">string</span><span class="op" id="1458257">,</span>&nbsp;<span class="ident" id="1458259">err</span>&nbsp;<span class="builtintype" id="1458263">error</span><span class="op" id="1458268">)</span>&nbsp;<span class="op" id="1458270">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458273">return</span>&nbsp;<span class="ident" id="1458280"><a href="/net/lookup_unix.go.html#1461489">lookupTXT</a></span><span class="op" id="1458289">(</span><span class="ident" id="1458290"><a href="/net/lookup.go.html#1458231">name</a></span><span class="op" id="1458294">)</span><br>
<span class="lineno"></span><span class="op" id="1458296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458299">//&nbsp;LookupAddr&nbsp;performs&nbsp;a&nbsp;reverse&nbsp;lookup&nbsp;for&nbsp;the&nbsp;given&nbsp;address,&nbsp;returning&nbsp;a&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="1458379">//&nbsp;of&nbsp;names&nbsp;mapping&nbsp;to&nbsp;that&nbsp;address.</span><br>
<span class="lineno">140</span><span class="keyword" id="1458416">func</span>&nbsp;<span class="ident" id="1458421">LookupAddr</span><span class="op" id="1458431">(</span><span class="ident" id="1458432">addr</span>&nbsp;<span class="builtintype" id="1458437">string</span><span class="op" id="1458443">)</span>&nbsp;<span class="op" id="1458445">(</span><span class="ident" id="1458446">name</span>&nbsp;<span class="op" id="1458451">[</span><span class="op" id="1458452">]</span><span class="builtintype" id="1458453">string</span><span class="op" id="1458459">,</span>&nbsp;<span class="ident" id="1458461">err</span>&nbsp;<span class="builtintype" id="1458465">error</span><span class="op" id="1458470">)</span>&nbsp;<span class="op" id="1458472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1458475">return</span>&nbsp;<span class="ident" id="1458482"><a href="/net/lookup_unix.go.html#1461728">lookupAddr</a></span><span class="op" id="1458492">(</span><span class="ident" id="1458493"><a href="/net/lookup.go.html#1458432">addr</a></span><span class="op" id="1458497">)</span><br>
<span class="lineno"></span><span class="op" id="1458499">}</span>
</div>
</body>
</html>
