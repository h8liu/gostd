<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6408010">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6408066">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6408120">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6408171">package</span>&nbsp;<span class="ident" id="6408179">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408188">import</span>&nbsp;<span class="op" id="6408195">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408198">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408207">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408224">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408234">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408241">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408247">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408260">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408267">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408278">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6408289">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6408299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6408302">type</span>&nbsp;<span class="ident" id="6408307">Args</span>&nbsp;<span class="keyword" id="6408312">struct</span>&nbsp;<span class="op" id="6408319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408322">A</span><span class="op" id="6408323">,</span>&nbsp;<span class="ident" id="6408325">B</span>&nbsp;<span class="builtintype" id="6408327">int</span><br>
<span class="lineno"></span><span class="op" id="6408331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408334">type</span>&nbsp;<span class="ident" id="6408339">Reply</span>&nbsp;<span class="keyword" id="6408345">struct</span>&nbsp;<span class="op" id="6408352">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408355">C</span>&nbsp;<span class="builtintype" id="6408357">int</span><br>
<span class="lineno"></span><span class="op" id="6408361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408364">type</span>&nbsp;<span class="ident" id="6408369">Arith</span>&nbsp;<span class="builtintype" id="6408375">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6408380">type</span>&nbsp;<span class="ident" id="6408385">ArithAddResp</span>&nbsp;<span class="keyword" id="6408398">struct</span>&nbsp;<span class="op" id="6408405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408408">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6408415">interface</span><span class="op" id="6408424">{</span><span class="op" id="6408425">}</span>&nbsp;<span class="string" id="6408427">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408440">Result</span>&nbsp;<span class="ident" id="6408447">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6408459">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408476">Error</span>&nbsp;&nbsp;<span class="keyword" id="6408483">interface</span><span class="op" id="6408492">{</span><span class="op" id="6408493">}</span>&nbsp;<span class="string" id="6408495">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6408510">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6408513">func</span>&nbsp;<span class="op" id="6408518">(</span><span class="ident" id="6408519">t</span>&nbsp;<span class="op" id="6408521">*</span><span class="ident" id="6408522">Arith</span><span class="op" id="6408527">)</span>&nbsp;<span class="ident" id="6408529">Add</span><span class="op" id="6408532">(</span><span class="ident" id="6408533">args</span>&nbsp;<span class="op" id="6408538">*</span><span class="ident" id="6408539">Args</span><span class="op" id="6408543">,</span>&nbsp;<span class="ident" id="6408545">reply</span>&nbsp;<span class="op" id="6408551">*</span><span class="ident" id="6408552">Reply</span><span class="op" id="6408557">)</span>&nbsp;<span class="builtintype" id="6408559">error</span>&nbsp;<span class="op" id="6408565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408568">reply</span><span class="op" id="6408573">.</span><span class="ident" id="6408574">C</span>&nbsp;<span class="op" id="6408576">=</span>&nbsp;<span class="ident" id="6408578">args</span><span class="op" id="6408582">.</span><span class="ident" id="6408583">A</span>&nbsp;<span class="op" id="6408585">+</span>&nbsp;<span class="ident" id="6408587">args</span><span class="op" id="6408591">.</span><span class="ident" id="6408592">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408595">return</span>&nbsp;<span class="ident" id="6408602">nil</span><br>
<span class="lineno"></span><span class="op" id="6408606">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6408609">func</span>&nbsp;<span class="op" id="6408614">(</span><span class="ident" id="6408615">t</span>&nbsp;<span class="op" id="6408617">*</span><span class="ident" id="6408618">Arith</span><span class="op" id="6408623">)</span>&nbsp;<span class="ident" id="6408625">Mul</span><span class="op" id="6408628">(</span><span class="ident" id="6408629">args</span>&nbsp;<span class="op" id="6408634">*</span><span class="ident" id="6408635">Args</span><span class="op" id="6408639">,</span>&nbsp;<span class="ident" id="6408641">reply</span>&nbsp;<span class="op" id="6408647">*</span><span class="ident" id="6408648">Reply</span><span class="op" id="6408653">)</span>&nbsp;<span class="builtintype" id="6408655">error</span>&nbsp;<span class="op" id="6408661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408664">reply</span><span class="op" id="6408669">.</span><span class="ident" id="6408670">C</span>&nbsp;<span class="op" id="6408672">=</span>&nbsp;<span class="ident" id="6408674">args</span><span class="op" id="6408678">.</span><span class="ident" id="6408679">A</span>&nbsp;<span class="op" id="6408681">*</span>&nbsp;<span class="ident" id="6408683">args</span><span class="op" id="6408687">.</span><span class="ident" id="6408688">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408691">return</span>&nbsp;<span class="ident" id="6408698">nil</span><br>
<span class="lineno"></span><span class="op" id="6408702">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6408705">func</span>&nbsp;<span class="op" id="6408710">(</span><span class="ident" id="6408711">t</span>&nbsp;<span class="op" id="6408713">*</span><span class="ident" id="6408714">Arith</span><span class="op" id="6408719">)</span>&nbsp;<span class="ident" id="6408721">Div</span><span class="op" id="6408724">(</span><span class="ident" id="6408725">args</span>&nbsp;<span class="op" id="6408730">*</span><span class="ident" id="6408731">Args</span><span class="op" id="6408735">,</span>&nbsp;<span class="ident" id="6408737">reply</span>&nbsp;<span class="op" id="6408743">*</span><span class="ident" id="6408744">Reply</span><span class="op" id="6408749">)</span>&nbsp;<span class="builtintype" id="6408751">error</span>&nbsp;<span class="op" id="6408757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408760">if</span>&nbsp;<span class="ident" id="6408763">args</span><span class="op" id="6408767">.</span><span class="ident" id="6408768">B</span>&nbsp;<span class="op" id="6408770">==</span>&nbsp;<span class="num" id="6408773">0</span>&nbsp;<span class="op" id="6408775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408779">return</span>&nbsp;<span class="ident" id="6408786">errors</span><span class="op" id="6408792">.</span><span class="ident" id="6408793">New</span><span class="op" id="6408796">(</span><span class="string" id="6408797">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6408813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6408816">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408819">reply</span><span class="op" id="6408824">.</span><span class="ident" id="6408825">C</span>&nbsp;<span class="op" id="6408827">=</span>&nbsp;<span class="ident" id="6408829">args</span><span class="op" id="6408833">.</span><span class="ident" id="6408834">A</span>&nbsp;<span class="op" id="6408836">/</span>&nbsp;<span class="ident" id="6408838">args</span><span class="op" id="6408842">.</span><span class="ident" id="6408843">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408846">return</span>&nbsp;<span class="ident" id="6408853">nil</span><br>
<span class="lineno"></span><span class="op" id="6408857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408860">func</span>&nbsp;<span class="op" id="6408865">(</span><span class="ident" id="6408866">t</span>&nbsp;<span class="op" id="6408868">*</span><span class="ident" id="6408869">Arith</span><span class="op" id="6408874">)</span>&nbsp;<span class="ident" id="6408876">Error</span><span class="op" id="6408881">(</span><span class="ident" id="6408882">args</span>&nbsp;<span class="op" id="6408887">*</span><span class="ident" id="6408888">Args</span><span class="op" id="6408892">,</span>&nbsp;<span class="ident" id="6408894">reply</span>&nbsp;<span class="op" id="6408900">*</span><span class="ident" id="6408901">Reply</span><span class="op" id="6408906">)</span>&nbsp;<span class="builtintype" id="6408908">error</span>&nbsp;<span class="op" id="6408914">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6408917">panic</span><span class="op" id="6408922">(</span><span class="string" id="6408923">&#34;ERROR&#34;</span><span class="op" id="6408930">)</span><br>
<span class="lineno"></span><span class="op" id="6408932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408935">func</span>&nbsp;<span class="ident" id="6408940">init</span><span class="op" id="6408944">(</span><span class="op" id="6408945">)</span>&nbsp;<span class="op" id="6408947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408950">rpc</span><span class="op" id="6408953">.</span><span class="ident" id="6408954">Register</span><span class="op" id="6408962">(</span><span class="builtinfunc" id="6408963">new</span><span class="op" id="6408966">(</span><span class="ident" id="6408967">Arith</span><span class="op" id="6408972">)</span><span class="op" id="6408973">)</span><br>
<span class="lineno">60</span><span class="op" id="6408975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408978">func</span>&nbsp;<span class="ident" id="6408983">TestServerNoParams</span><span class="op" id="6409001">(</span><span class="ident" id="6409002">t</span>&nbsp;<span class="op" id="6409004">*</span><span class="ident" id="6409005">testing</span><span class="op" id="6409012">.</span><span class="ident" id="6409013">T</span><span class="op" id="6409014">)</span>&nbsp;<span class="op" id="6409016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409019">cli</span><span class="op" id="6409022">,</span>&nbsp;<span class="ident" id="6409024">srv</span>&nbsp;<span class="op" id="6409028">:=</span>&nbsp;<span class="ident" id="6409031">net</span><span class="op" id="6409034">.</span><span class="ident" id="6409035">Pipe</span><span class="op" id="6409039">(</span><span class="op" id="6409040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409043">defer</span>&nbsp;<span class="ident" id="6409049">cli</span><span class="op" id="6409052">.</span><span class="ident" id="6409053">Close</span><span class="op" id="6409058">(</span><span class="op" id="6409059">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409062">go</span>&nbsp;<span class="ident" id="6409065">ServeConn</span><span class="op" id="6409074">(</span><span class="ident" id="6409075">srv</span><span class="op" id="6409078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409081">dec</span>&nbsp;<span class="op" id="6409085">:=</span>&nbsp;<span class="ident" id="6409088">json</span><span class="op" id="6409092">.</span><span class="ident" id="6409093">NewDecoder</span><span class="op" id="6409103">(</span><span class="ident" id="6409104">cli</span><span class="op" id="6409107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409111">fmt</span><span class="op" id="6409114">.</span><span class="ident" id="6409115">Fprintf</span><span class="op" id="6409122">(</span><span class="ident" id="6409123">cli</span><span class="op" id="6409126">,</span>&nbsp;<span class="string" id="6409128">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="6409166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409169">var</span>&nbsp;<span class="ident" id="6409173">resp</span>&nbsp;<span class="ident" id="6409178">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409192">if</span>&nbsp;<span class="ident" id="6409195">err</span>&nbsp;<span class="op" id="6409199">:=</span>&nbsp;<span class="ident" id="6409202">dec</span><span class="op" id="6409205">.</span><span class="ident" id="6409206">Decode</span><span class="op" id="6409212">(</span><span class="op" id="6409213">&amp;</span><span class="ident" id="6409214">resp</span><span class="op" id="6409218">)</span><span class="op" id="6409219">;</span>&nbsp;<span class="ident" id="6409221">err</span>&nbsp;<span class="op" id="6409225">!=</span>&nbsp;<span class="ident" id="6409228">nil</span>&nbsp;<span class="op" id="6409232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409236">t</span><span class="op" id="6409237">.</span><span class="ident" id="6409238">Fatalf</span><span class="op" id="6409244">(</span><span class="string" id="6409245">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="6409273">,</span>&nbsp;<span class="ident" id="6409275">err</span><span class="op" id="6409278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409284">if</span>&nbsp;<span class="ident" id="6409287">resp</span><span class="op" id="6409291">.</span><span class="ident" id="6409292">Error</span>&nbsp;<span class="op" id="6409298">==</span>&nbsp;<span class="ident" id="6409301">nil</span>&nbsp;<span class="op" id="6409305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409309">t</span><span class="op" id="6409310">.</span><span class="ident" id="6409311">Fatalf</span><span class="op" id="6409317">(</span><span class="string" id="6409318">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6409343">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409346">}</span><br>
<span class="lineno"></span><span class="op" id="6409348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6409351">func</span>&nbsp;<span class="ident" id="6409356">TestServerEmptyMessage</span><span class="op" id="6409378">(</span><span class="ident" id="6409379">t</span>&nbsp;<span class="op" id="6409381">*</span><span class="ident" id="6409382">testing</span><span class="op" id="6409389">.</span><span class="ident" id="6409390">T</span><span class="op" id="6409391">)</span>&nbsp;<span class="op" id="6409393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409396">cli</span><span class="op" id="6409399">,</span>&nbsp;<span class="ident" id="6409401">srv</span>&nbsp;<span class="op" id="6409405">:=</span>&nbsp;<span class="ident" id="6409408">net</span><span class="op" id="6409411">.</span><span class="ident" id="6409412">Pipe</span><span class="op" id="6409416">(</span><span class="op" id="6409417">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409420">defer</span>&nbsp;<span class="ident" id="6409426">cli</span><span class="op" id="6409429">.</span><span class="ident" id="6409430">Close</span><span class="op" id="6409435">(</span><span class="op" id="6409436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409439">go</span>&nbsp;<span class="ident" id="6409442">ServeConn</span><span class="op" id="6409451">(</span><span class="ident" id="6409452">srv</span><span class="op" id="6409455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409458">dec</span>&nbsp;<span class="op" id="6409462">:=</span>&nbsp;<span class="ident" id="6409465">json</span><span class="op" id="6409469">.</span><span class="ident" id="6409470">NewDecoder</span><span class="op" id="6409480">(</span><span class="ident" id="6409481">cli</span><span class="op" id="6409484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409488">fmt</span><span class="op" id="6409491">.</span><span class="ident" id="6409492">Fprintf</span><span class="op" id="6409499">(</span><span class="ident" id="6409500">cli</span><span class="op" id="6409503">,</span>&nbsp;<span class="string" id="6409505">&#34;{}&#34;</span><span class="op" id="6409509">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409512">var</span>&nbsp;<span class="ident" id="6409516">resp</span>&nbsp;<span class="ident" id="6409521">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409535">if</span>&nbsp;<span class="ident" id="6409538">err</span>&nbsp;<span class="op" id="6409542">:=</span>&nbsp;<span class="ident" id="6409545">dec</span><span class="op" id="6409548">.</span><span class="ident" id="6409549">Decode</span><span class="op" id="6409555">(</span><span class="op" id="6409556">&amp;</span><span class="ident" id="6409557">resp</span><span class="op" id="6409561">)</span><span class="op" id="6409562">;</span>&nbsp;<span class="ident" id="6409564">err</span>&nbsp;<span class="op" id="6409568">!=</span>&nbsp;<span class="ident" id="6409571">nil</span>&nbsp;<span class="op" id="6409575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409579">t</span><span class="op" id="6409580">.</span><span class="ident" id="6409581">Fatalf</span><span class="op" id="6409587">(</span><span class="string" id="6409588">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="6409612">,</span>&nbsp;<span class="ident" id="6409614">err</span><span class="op" id="6409617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409623">if</span>&nbsp;<span class="ident" id="6409626">resp</span><span class="op" id="6409630">.</span><span class="ident" id="6409631">Error</span>&nbsp;<span class="op" id="6409637">==</span>&nbsp;<span class="ident" id="6409640">nil</span>&nbsp;<span class="op" id="6409644">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409648">t</span><span class="op" id="6409649">.</span><span class="ident" id="6409650">Fatalf</span><span class="op" id="6409656">(</span><span class="string" id="6409657">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6409682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409685">}</span><br>
<span class="lineno"></span><span class="op" id="6409687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6409690">func</span>&nbsp;<span class="ident" id="6409695">TestServer</span><span class="op" id="6409705">(</span><span class="ident" id="6409706">t</span>&nbsp;<span class="op" id="6409708">*</span><span class="ident" id="6409709">testing</span><span class="op" id="6409716">.</span><span class="ident" id="6409717">T</span><span class="op" id="6409718">)</span>&nbsp;<span class="op" id="6409720">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409723">cli</span><span class="op" id="6409726">,</span>&nbsp;<span class="ident" id="6409728">srv</span>&nbsp;<span class="op" id="6409732">:=</span>&nbsp;<span class="ident" id="6409735">net</span><span class="op" id="6409738">.</span><span class="ident" id="6409739">Pipe</span><span class="op" id="6409743">(</span><span class="op" id="6409744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409747">defer</span>&nbsp;<span class="ident" id="6409753">cli</span><span class="op" id="6409756">.</span><span class="ident" id="6409757">Close</span><span class="op" id="6409762">(</span><span class="op" id="6409763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409766">go</span>&nbsp;<span class="ident" id="6409769">ServeConn</span><span class="op" id="6409778">(</span><span class="ident" id="6409779">srv</span><span class="op" id="6409782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409785">dec</span>&nbsp;<span class="op" id="6409789">:=</span>&nbsp;<span class="ident" id="6409792">json</span><span class="op" id="6409796">.</span><span class="ident" id="6409797">NewDecoder</span><span class="op" id="6409807">(</span><span class="ident" id="6409808">cli</span><span class="op" id="6409811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6409815">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409872">for</span>&nbsp;<span class="ident" id="6409876">i</span>&nbsp;<span class="op" id="6409878">:=</span>&nbsp;<span class="num" id="6409881">0</span><span class="op" id="6409882">;</span>&nbsp;<span class="ident" id="6409884">i</span>&nbsp;<span class="op" id="6409886">&lt;</span>&nbsp;<span class="num" id="6409888">10</span><span class="op" id="6409890">;</span>&nbsp;<span class="ident" id="6409892">i</span><span class="op" id="6409893">++</span>&nbsp;<span class="op" id="6409896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409900">fmt</span><span class="op" id="6409903">.</span><span class="ident" id="6409904">Fprintf</span><span class="op" id="6409911">(</span><span class="ident" id="6409912">cli</span><span class="op" id="6409915">,</span>&nbsp;<span class="string" id="6409917">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="6409990">,</span>&nbsp;<span class="ident" id="6409992">i</span><span class="op" id="6409993">,</span>&nbsp;<span class="ident" id="6409995">i</span><span class="op" id="6409996">,</span>&nbsp;<span class="ident" id="6409998">i</span><span class="op" id="6409999">+</span><span class="num" id="6410000">1</span><span class="op" id="6410001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410005">var</span>&nbsp;<span class="ident" id="6410009">resp</span>&nbsp;<span class="ident" id="6410014">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410029">err</span>&nbsp;<span class="op" id="6410033">:=</span>&nbsp;<span class="ident" id="6410036">dec</span><span class="op" id="6410039">.</span><span class="ident" id="6410040">Decode</span><span class="op" id="6410046">(</span><span class="op" id="6410047">&amp;</span><span class="ident" id="6410048">resp</span><span class="op" id="6410052">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410056">if</span>&nbsp;<span class="ident" id="6410059">err</span>&nbsp;<span class="op" id="6410063">!=</span>&nbsp;<span class="ident" id="6410066">nil</span>&nbsp;<span class="op" id="6410070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410075">t</span><span class="op" id="6410076">.</span><span class="ident" id="6410077">Fatalf</span><span class="op" id="6410083">(</span><span class="string" id="6410084">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="6410096">,</span>&nbsp;<span class="ident" id="6410098">err</span><span class="op" id="6410101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410109">if</span>&nbsp;<span class="ident" id="6410112">resp</span><span class="op" id="6410116">.</span><span class="ident" id="6410117">Error</span>&nbsp;<span class="op" id="6410123">!=</span>&nbsp;<span class="ident" id="6410126">nil</span>&nbsp;<span class="op" id="6410130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410135">t</span><span class="op" id="6410136">.</span><span class="ident" id="6410137">Fatalf</span><span class="op" id="6410143">(</span><span class="string" id="6410144">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="6410160">,</span>&nbsp;<span class="ident" id="6410162">resp</span><span class="op" id="6410166">.</span><span class="ident" id="6410167">Error</span><span class="op" id="6410172">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410180">if</span>&nbsp;<span class="ident" id="6410183">resp</span><span class="op" id="6410187">.</span><span class="ident" id="6410188">Id</span><span class="op" id="6410190">.</span><span class="op" id="6410191">(</span><span class="builtintype" id="6410192">string</span><span class="op" id="6410198">)</span>&nbsp;<span class="op" id="6410200">!=</span>&nbsp;<span class="builtintype" id="6410203">string</span><span class="op" id="6410209">(</span><span class="ident" id="6410210">i</span><span class="op" id="6410211">)</span>&nbsp;<span class="op" id="6410213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410218">t</span><span class="op" id="6410219">.</span><span class="ident" id="6410220">Fatalf</span><span class="op" id="6410226">(</span><span class="string" id="6410227">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6410252">,</span>&nbsp;<span class="ident" id="6410254">resp</span><span class="op" id="6410258">.</span><span class="ident" id="6410259">Id</span><span class="op" id="6410261">.</span><span class="op" id="6410262">(</span><span class="builtintype" id="6410263">string</span><span class="op" id="6410269">)</span><span class="op" id="6410270">,</span>&nbsp;<span class="builtintype" id="6410272">string</span><span class="op" id="6410278">(</span><span class="ident" id="6410279">i</span><span class="op" id="6410280">)</span><span class="op" id="6410281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410289">if</span>&nbsp;<span class="ident" id="6410292">resp</span><span class="op" id="6410296">.</span><span class="ident" id="6410297">Result</span><span class="op" id="6410303">.</span><span class="ident" id="6410304">C</span>&nbsp;<span class="op" id="6410306">!=</span>&nbsp;<span class="num" id="6410309">2</span><span class="op" id="6410310">*</span><span class="ident" id="6410311">i</span><span class="op" id="6410312">+</span><span class="num" id="6410313">1</span>&nbsp;<span class="op" id="6410315">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410320">t</span><span class="op" id="6410321">.</span><span class="ident" id="6410322">Fatalf</span><span class="op" id="6410328">(</span><span class="string" id="6410329">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="6410357">,</span>&nbsp;<span class="ident" id="6410359">i</span><span class="op" id="6410360">,</span>&nbsp;<span class="ident" id="6410362">i</span><span class="op" id="6410363">+</span><span class="num" id="6410364">1</span><span class="op" id="6410365">,</span>&nbsp;<span class="ident" id="6410367">resp</span><span class="op" id="6410371">.</span><span class="ident" id="6410372">Result</span><span class="op" id="6410378">.</span><span class="ident" id="6410379">C</span><span class="op" id="6410380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410387">}</span><br>
<span class="lineno"></span><span class="op" id="6410389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6410392">func</span>&nbsp;<span class="ident" id="6410397">TestClient</span><span class="op" id="6410407">(</span><span class="ident" id="6410408">t</span>&nbsp;<span class="op" id="6410410">*</span><span class="ident" id="6410411">testing</span><span class="op" id="6410418">.</span><span class="ident" id="6410419">T</span><span class="op" id="6410420">)</span>&nbsp;<span class="op" id="6410422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410425">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410474">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410506">cli</span><span class="op" id="6410509">,</span>&nbsp;<span class="ident" id="6410511">srv</span>&nbsp;<span class="op" id="6410515">:=</span>&nbsp;<span class="ident" id="6410518">net</span><span class="op" id="6410521">.</span><span class="ident" id="6410522">Pipe</span><span class="op" id="6410526">(</span><span class="op" id="6410527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410530">go</span>&nbsp;<span class="ident" id="6410533">ServeConn</span><span class="op" id="6410542">(</span><span class="ident" id="6410543">srv</span><span class="op" id="6410546">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410550">client</span>&nbsp;<span class="op" id="6410557">:=</span>&nbsp;<span class="ident" id="6410560">NewClient</span><span class="op" id="6410569">(</span><span class="ident" id="6410570">cli</span><span class="op" id="6410573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410576">defer</span>&nbsp;<span class="ident" id="6410582">client</span><span class="op" id="6410588">.</span><span class="ident" id="6410589">Close</span><span class="op" id="6410594">(</span><span class="op" id="6410595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410599">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410621">args</span>&nbsp;<span class="op" id="6410626">:=</span>&nbsp;<span class="op" id="6410629">&amp;</span><span class="ident" id="6410630">Args</span><span class="op" id="6410634">{</span><span class="num" id="6410635">7</span><span class="op" id="6410636">,</span>&nbsp;<span class="num" id="6410638">8</span><span class="op" id="6410639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410642">reply</span>&nbsp;<span class="op" id="6410648">:=</span>&nbsp;<span class="builtinfunc" id="6410651">new</span><span class="op" id="6410654">(</span><span class="ident" id="6410655">Reply</span><span class="op" id="6410660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410663">err</span>&nbsp;<span class="op" id="6410667">:=</span>&nbsp;<span class="ident" id="6410670">client</span><span class="op" id="6410676">.</span><span class="ident" id="6410677">Call</span><span class="op" id="6410681">(</span><span class="string" id="6410682">&#34;Arith.Add&#34;</span><span class="op" id="6410693">,</span>&nbsp;<span class="ident" id="6410695">args</span><span class="op" id="6410699">,</span>&nbsp;<span class="ident" id="6410701">reply</span><span class="op" id="6410706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410709">if</span>&nbsp;<span class="ident" id="6410712">err</span>&nbsp;<span class="op" id="6410716">!=</span>&nbsp;<span class="ident" id="6410719">nil</span>&nbsp;<span class="op" id="6410723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410727">t</span><span class="op" id="6410728">.</span><span class="ident" id="6410729">Errorf</span><span class="op" id="6410735">(</span><span class="string" id="6410736">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6410778">,</span>&nbsp;<span class="ident" id="6410780">err</span><span class="op" id="6410783">.</span><span class="ident" id="6410784">Error</span><span class="op" id="6410789">(</span><span class="op" id="6410790">)</span><span class="op" id="6410791">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410797">if</span>&nbsp;<span class="ident" id="6410800">reply</span><span class="op" id="6410805">.</span><span class="ident" id="6410806">C</span>&nbsp;<span class="op" id="6410808">!=</span>&nbsp;<span class="ident" id="6410811">args</span><span class="op" id="6410815">.</span><span class="ident" id="6410816">A</span><span class="op" id="6410817">+</span><span class="ident" id="6410818">args</span><span class="op" id="6410822">.</span><span class="ident" id="6410823">B</span>&nbsp;<span class="op" id="6410825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410829">t</span><span class="op" id="6410830">.</span><span class="ident" id="6410831">Errorf</span><span class="op" id="6410837">(</span><span class="string" id="6410838">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6410863">,</span>&nbsp;<span class="ident" id="6410865">reply</span><span class="op" id="6410870">.</span><span class="ident" id="6410871">C</span><span class="op" id="6410872">,</span>&nbsp;<span class="ident" id="6410874">args</span><span class="op" id="6410878">.</span><span class="ident" id="6410879">A</span><span class="op" id="6410880">+</span><span class="ident" id="6410881">args</span><span class="op" id="6410885">.</span><span class="ident" id="6410886">B</span><span class="op" id="6410887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410894">args</span>&nbsp;<span class="op" id="6410899">=</span>&nbsp;<span class="op" id="6410901">&amp;</span><span class="ident" id="6410902">Args</span><span class="op" id="6410906">{</span><span class="num" id="6410907">7</span><span class="op" id="6410908">,</span>&nbsp;<span class="num" id="6410910">8</span><span class="op" id="6410911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410914">reply</span>&nbsp;<span class="op" id="6410920">=</span>&nbsp;<span class="builtinfunc" id="6410922">new</span><span class="op" id="6410925">(</span><span class="ident" id="6410926">Reply</span><span class="op" id="6410931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410934">err</span>&nbsp;<span class="op" id="6410938">=</span>&nbsp;<span class="ident" id="6410940">client</span><span class="op" id="6410946">.</span><span class="ident" id="6410947">Call</span><span class="op" id="6410951">(</span><span class="string" id="6410952">&#34;Arith.Mul&#34;</span><span class="op" id="6410963">,</span>&nbsp;<span class="ident" id="6410965">args</span><span class="op" id="6410969">,</span>&nbsp;<span class="ident" id="6410971">reply</span><span class="op" id="6410976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410979">if</span>&nbsp;<span class="ident" id="6410982">err</span>&nbsp;<span class="op" id="6410986">!=</span>&nbsp;<span class="ident" id="6410989">nil</span>&nbsp;<span class="op" id="6410993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410997">t</span><span class="op" id="6410998">.</span><span class="ident" id="6410999">Errorf</span><span class="op" id="6411005">(</span><span class="string" id="6411006">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6411048">,</span>&nbsp;<span class="ident" id="6411050">err</span><span class="op" id="6411053">.</span><span class="ident" id="6411054">Error</span><span class="op" id="6411059">(</span><span class="op" id="6411060">)</span><span class="op" id="6411061">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411067">if</span>&nbsp;<span class="ident" id="6411070">reply</span><span class="op" id="6411075">.</span><span class="ident" id="6411076">C</span>&nbsp;<span class="op" id="6411078">!=</span>&nbsp;<span class="ident" id="6411081">args</span><span class="op" id="6411085">.</span><span class="ident" id="6411086">A</span><span class="op" id="6411087">*</span><span class="ident" id="6411088">args</span><span class="op" id="6411092">.</span><span class="ident" id="6411093">B</span>&nbsp;<span class="op" id="6411095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411099">t</span><span class="op" id="6411100">.</span><span class="ident" id="6411101">Errorf</span><span class="op" id="6411107">(</span><span class="string" id="6411108">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6411133">,</span>&nbsp;<span class="ident" id="6411135">reply</span><span class="op" id="6411140">.</span><span class="ident" id="6411141">C</span><span class="op" id="6411142">,</span>&nbsp;<span class="ident" id="6411144">args</span><span class="op" id="6411148">.</span><span class="ident" id="6411149">A</span><span class="op" id="6411150">*</span><span class="ident" id="6411151">args</span><span class="op" id="6411155">.</span><span class="ident" id="6411156">B</span><span class="op" id="6411157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411164">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411182">args</span>&nbsp;<span class="op" id="6411187">=</span>&nbsp;<span class="op" id="6411189">&amp;</span><span class="ident" id="6411190">Args</span><span class="op" id="6411194">{</span><span class="num" id="6411195">7</span><span class="op" id="6411196">,</span>&nbsp;<span class="num" id="6411198">8</span><span class="op" id="6411199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411202">mulReply</span>&nbsp;<span class="op" id="6411211">:=</span>&nbsp;<span class="builtinfunc" id="6411214">new</span><span class="op" id="6411217">(</span><span class="ident" id="6411218">Reply</span><span class="op" id="6411223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411226">mulCall</span>&nbsp;<span class="op" id="6411234">:=</span>&nbsp;<span class="ident" id="6411237">client</span><span class="op" id="6411243">.</span><span class="ident" id="6411244">Go</span><span class="op" id="6411246">(</span><span class="string" id="6411247">&#34;Arith.Mul&#34;</span><span class="op" id="6411258">,</span>&nbsp;<span class="ident" id="6411260">args</span><span class="op" id="6411264">,</span>&nbsp;<span class="ident" id="6411266">mulReply</span><span class="op" id="6411274">,</span>&nbsp;<span class="ident" id="6411276">nil</span><span class="op" id="6411279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411282">addReply</span>&nbsp;<span class="op" id="6411291">:=</span>&nbsp;<span class="builtinfunc" id="6411294">new</span><span class="op" id="6411297">(</span><span class="ident" id="6411298">Reply</span><span class="op" id="6411303">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411306">addCall</span>&nbsp;<span class="op" id="6411314">:=</span>&nbsp;<span class="ident" id="6411317">client</span><span class="op" id="6411323">.</span><span class="ident" id="6411324">Go</span><span class="op" id="6411326">(</span><span class="string" id="6411327">&#34;Arith.Add&#34;</span><span class="op" id="6411338">,</span>&nbsp;<span class="ident" id="6411340">args</span><span class="op" id="6411344">,</span>&nbsp;<span class="ident" id="6411346">addReply</span><span class="op" id="6411354">,</span>&nbsp;<span class="ident" id="6411356">nil</span><span class="op" id="6411359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411363">addCall</span>&nbsp;<span class="op" id="6411371">=</span>&nbsp;<span class="op" id="6411373">&lt;-</span><span class="ident" id="6411375">addCall</span><span class="op" id="6411382">.</span><span class="ident" id="6411383">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411389">if</span>&nbsp;<span class="ident" id="6411392">addCall</span><span class="op" id="6411399">.</span><span class="ident" id="6411400">Error</span>&nbsp;<span class="op" id="6411406">!=</span>&nbsp;<span class="ident" id="6411409">nil</span>&nbsp;<span class="op" id="6411413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411417">t</span><span class="op" id="6411418">.</span><span class="ident" id="6411419">Errorf</span><span class="op" id="6411425">(</span><span class="string" id="6411426">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6411468">,</span>&nbsp;<span class="ident" id="6411470">addCall</span><span class="op" id="6411477">.</span><span class="ident" id="6411478">Error</span><span class="op" id="6411483">.</span><span class="ident" id="6411484">Error</span><span class="op" id="6411489">(</span><span class="op" id="6411490">)</span><span class="op" id="6411491">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411497">if</span>&nbsp;<span class="ident" id="6411500">addReply</span><span class="op" id="6411508">.</span><span class="ident" id="6411509">C</span>&nbsp;<span class="op" id="6411511">!=</span>&nbsp;<span class="ident" id="6411514">args</span><span class="op" id="6411518">.</span><span class="ident" id="6411519">A</span><span class="op" id="6411520">+</span><span class="ident" id="6411521">args</span><span class="op" id="6411525">.</span><span class="ident" id="6411526">B</span>&nbsp;<span class="op" id="6411528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411532">t</span><span class="op" id="6411533">.</span><span class="ident" id="6411534">Errorf</span><span class="op" id="6411540">(</span><span class="string" id="6411541">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6411566">,</span>&nbsp;<span class="ident" id="6411568">addReply</span><span class="op" id="6411576">.</span><span class="ident" id="6411577">C</span><span class="op" id="6411578">,</span>&nbsp;<span class="ident" id="6411580">args</span><span class="op" id="6411584">.</span><span class="ident" id="6411585">A</span><span class="op" id="6411586">+</span><span class="ident" id="6411587">args</span><span class="op" id="6411591">.</span><span class="ident" id="6411592">B</span><span class="op" id="6411593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411600">mulCall</span>&nbsp;<span class="op" id="6411608">=</span>&nbsp;<span class="op" id="6411610">&lt;-</span><span class="ident" id="6411612">mulCall</span><span class="op" id="6411619">.</span><span class="ident" id="6411620">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411626">if</span>&nbsp;<span class="ident" id="6411629">mulCall</span><span class="op" id="6411636">.</span><span class="ident" id="6411637">Error</span>&nbsp;<span class="op" id="6411643">!=</span>&nbsp;<span class="ident" id="6411646">nil</span>&nbsp;<span class="op" id="6411650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411654">t</span><span class="op" id="6411655">.</span><span class="ident" id="6411656">Errorf</span><span class="op" id="6411662">(</span><span class="string" id="6411663">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6411705">,</span>&nbsp;<span class="ident" id="6411707">mulCall</span><span class="op" id="6411714">.</span><span class="ident" id="6411715">Error</span><span class="op" id="6411720">.</span><span class="ident" id="6411721">Error</span><span class="op" id="6411726">(</span><span class="op" id="6411727">)</span><span class="op" id="6411728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411734">if</span>&nbsp;<span class="ident" id="6411737">mulReply</span><span class="op" id="6411745">.</span><span class="ident" id="6411746">C</span>&nbsp;<span class="op" id="6411748">!=</span>&nbsp;<span class="ident" id="6411751">args</span><span class="op" id="6411755">.</span><span class="ident" id="6411756">A</span><span class="op" id="6411757">*</span><span class="ident" id="6411758">args</span><span class="op" id="6411762">.</span><span class="ident" id="6411763">B</span>&nbsp;<span class="op" id="6411765">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411769">t</span><span class="op" id="6411770">.</span><span class="ident" id="6411771">Errorf</span><span class="op" id="6411777">(</span><span class="string" id="6411778">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6411803">,</span>&nbsp;<span class="ident" id="6411805">mulReply</span><span class="op" id="6411813">.</span><span class="ident" id="6411814">C</span><span class="op" id="6411815">,</span>&nbsp;<span class="ident" id="6411817">args</span><span class="op" id="6411821">.</span><span class="ident" id="6411822">A</span><span class="op" id="6411823">*</span><span class="ident" id="6411824">args</span><span class="op" id="6411828">.</span><span class="ident" id="6411829">B</span><span class="op" id="6411830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411837">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411852">args</span>&nbsp;<span class="op" id="6411857">=</span>&nbsp;<span class="op" id="6411859">&amp;</span><span class="ident" id="6411860">Args</span><span class="op" id="6411864">{</span><span class="num" id="6411865">7</span><span class="op" id="6411866">,</span>&nbsp;<span class="num" id="6411868">0</span><span class="op" id="6411869">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411872">reply</span>&nbsp;<span class="op" id="6411878">=</span>&nbsp;<span class="builtinfunc" id="6411880">new</span><span class="op" id="6411883">(</span><span class="ident" id="6411884">Reply</span><span class="op" id="6411889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411892">err</span>&nbsp;<span class="op" id="6411896">=</span>&nbsp;<span class="ident" id="6411898">client</span><span class="op" id="6411904">.</span><span class="ident" id="6411905">Call</span><span class="op" id="6411909">(</span><span class="string" id="6411910">&#34;Arith.Div&#34;</span><span class="op" id="6411921">,</span>&nbsp;<span class="ident" id="6411923">args</span><span class="op" id="6411927">,</span>&nbsp;<span class="ident" id="6411929">reply</span><span class="op" id="6411934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411937">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411970">if</span>&nbsp;<span class="ident" id="6411973">err</span>&nbsp;<span class="op" id="6411977">==</span>&nbsp;<span class="ident" id="6411980">nil</span>&nbsp;<span class="op" id="6411984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411988">t</span><span class="op" id="6411989">.</span><span class="ident" id="6411990">Error</span><span class="op" id="6411995">(</span><span class="string" id="6411996">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6412017">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412020">}</span>&nbsp;<span class="keyword" id="6412022">else</span>&nbsp;<span class="keyword" id="6412027">if</span>&nbsp;<span class="ident" id="6412030">err</span><span class="op" id="6412033">.</span><span class="ident" id="6412034">Error</span><span class="op" id="6412039">(</span><span class="op" id="6412040">)</span>&nbsp;<span class="op" id="6412042">!=</span>&nbsp;<span class="string" id="6412045">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6412062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412066">t</span><span class="op" id="6412067">.</span><span class="ident" id="6412068">Error</span><span class="op" id="6412073">(</span><span class="string" id="6412074">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6412115">,</span>&nbsp;<span class="ident" id="6412117">err</span><span class="op" id="6412120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412123">}</span><br>
<span class="lineno"></span><span class="op" id="6412125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="6412128">func</span>&nbsp;<span class="ident" id="6412133">TestMalformedInput</span><span class="op" id="6412151">(</span><span class="ident" id="6412152">t</span>&nbsp;<span class="op" id="6412154">*</span><span class="ident" id="6412155">testing</span><span class="op" id="6412162">.</span><span class="ident" id="6412163">T</span><span class="op" id="6412164">)</span>&nbsp;<span class="op" id="6412166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412169">cli</span><span class="op" id="6412172">,</span>&nbsp;<span class="ident" id="6412174">srv</span>&nbsp;<span class="op" id="6412178">:=</span>&nbsp;<span class="ident" id="6412181">net</span><span class="op" id="6412184">.</span><span class="ident" id="6412185">Pipe</span><span class="op" id="6412189">(</span><span class="op" id="6412190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412193">go</span>&nbsp;<span class="ident" id="6412196">cli</span><span class="op" id="6412199">.</span><span class="ident" id="6412200">Write</span><span class="op" id="6412205">(</span><span class="op" id="6412206">[</span><span class="op" id="6412207">]</span><span class="builtintype" id="6412208">byte</span><span class="op" id="6412212">(</span><span class="string" id="6412213">`{id:1}`</span><span class="op" id="6412221">)</span><span class="op" id="6412222">)</span>&nbsp;<span class="comment" id="6412224">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412241">ServeConn</span><span class="op" id="6412250">(</span><span class="ident" id="6412251">srv</span><span class="op" id="6412254">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6412272">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6412297">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6412300">func</span>&nbsp;<span class="ident" id="6412305">TestMalformedOutput</span><span class="op" id="6412324">(</span><span class="ident" id="6412325">t</span>&nbsp;<span class="op" id="6412327">*</span><span class="ident" id="6412328">testing</span><span class="op" id="6412335">.</span><span class="ident" id="6412336">T</span><span class="op" id="6412337">)</span>&nbsp;<span class="op" id="6412339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412342">cli</span><span class="op" id="6412345">,</span>&nbsp;<span class="ident" id="6412347">srv</span>&nbsp;<span class="op" id="6412351">:=</span>&nbsp;<span class="ident" id="6412354">net</span><span class="op" id="6412357">.</span><span class="ident" id="6412358">Pipe</span><span class="op" id="6412362">(</span><span class="op" id="6412363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412366">go</span>&nbsp;<span class="ident" id="6412369">srv</span><span class="op" id="6412372">.</span><span class="ident" id="6412373">Write</span><span class="op" id="6412378">(</span><span class="op" id="6412379">[</span><span class="op" id="6412380">]</span><span class="builtintype" id="6412381">byte</span><span class="op" id="6412385">(</span><span class="string" id="6412386">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="6412423">)</span><span class="op" id="6412424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412427">go</span>&nbsp;<span class="ident" id="6412430">ioutil</span><span class="op" id="6412436">.</span><span class="ident" id="6412437">ReadAll</span><span class="op" id="6412444">(</span><span class="ident" id="6412445">srv</span><span class="op" id="6412448">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412452">client</span>&nbsp;<span class="op" id="6412459">:=</span>&nbsp;<span class="ident" id="6412462">NewClient</span><span class="op" id="6412471">(</span><span class="ident" id="6412472">cli</span><span class="op" id="6412475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412478">defer</span>&nbsp;<span class="ident" id="6412484">client</span><span class="op" id="6412490">.</span><span class="ident" id="6412491">Close</span><span class="op" id="6412496">(</span><span class="op" id="6412497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412501">args</span>&nbsp;<span class="op" id="6412506">:=</span>&nbsp;<span class="op" id="6412509">&amp;</span><span class="ident" id="6412510">Args</span><span class="op" id="6412514">{</span><span class="num" id="6412515">7</span><span class="op" id="6412516">,</span>&nbsp;<span class="num" id="6412518">8</span><span class="op" id="6412519">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412522">reply</span>&nbsp;<span class="op" id="6412528">:=</span>&nbsp;<span class="builtinfunc" id="6412531">new</span><span class="op" id="6412534">(</span><span class="ident" id="6412535">Reply</span><span class="op" id="6412540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412543">err</span>&nbsp;<span class="op" id="6412547">:=</span>&nbsp;<span class="ident" id="6412550">client</span><span class="op" id="6412556">.</span><span class="ident" id="6412557">Call</span><span class="op" id="6412561">(</span><span class="string" id="6412562">&#34;Arith.Add&#34;</span><span class="op" id="6412573">,</span>&nbsp;<span class="ident" id="6412575">args</span><span class="op" id="6412579">,</span>&nbsp;<span class="ident" id="6412581">reply</span><span class="op" id="6412586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412589">if</span>&nbsp;<span class="ident" id="6412592">err</span>&nbsp;<span class="op" id="6412596">==</span>&nbsp;<span class="ident" id="6412599">nil</span>&nbsp;<span class="op" id="6412603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412607">t</span><span class="op" id="6412608">.</span><span class="ident" id="6412609">Error</span><span class="op" id="6412614">(</span><span class="string" id="6412615">&#34;expected&nbsp;error&#34;</span><span class="op" id="6412631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412634">}</span><br>
<span class="lineno">205</span><span class="op" id="6412636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6412639">func</span>&nbsp;<span class="ident" id="6412644">TestServerErrorHasNullResult</span><span class="op" id="6412672">(</span><span class="ident" id="6412673">t</span>&nbsp;<span class="op" id="6412675">*</span><span class="ident" id="6412676">testing</span><span class="op" id="6412683">.</span><span class="ident" id="6412684">T</span><span class="op" id="6412685">)</span>&nbsp;<span class="op" id="6412687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412690">var</span>&nbsp;<span class="ident" id="6412694">out</span>&nbsp;<span class="ident" id="6412698">bytes</span><span class="op" id="6412703">.</span><span class="ident" id="6412704">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412712">sc</span>&nbsp;<span class="op" id="6412715">:=</span>&nbsp;<span class="ident" id="6412718">NewServerCodec</span><span class="op" id="6412732">(</span><span class="keyword" id="6412733">struct</span>&nbsp;<span class="op" id="6412740">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412744">io</span><span class="op" id="6412746">.</span><span class="ident" id="6412747">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412756">io</span><span class="op" id="6412758">.</span><span class="ident" id="6412759">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412768">io</span><span class="op" id="6412770">.</span><span class="ident" id="6412771">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412779">}</span><span class="op" id="6412780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412784">Reader</span><span class="op" id="6412790">:</span>&nbsp;<span class="ident" id="6412792">strings</span><span class="op" id="6412799">.</span><span class="ident" id="6412800">NewReader</span><span class="op" id="6412809">(</span><span class="string" id="6412810">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="6412862">)</span><span class="op" id="6412863">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412867">Writer</span><span class="op" id="6412873">:</span>&nbsp;<span class="op" id="6412875">&amp;</span><span class="ident" id="6412876">out</span><span class="op" id="6412879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412883">Closer</span><span class="op" id="6412889">:</span>&nbsp;<span class="ident" id="6412891">ioutil</span><span class="op" id="6412897">.</span><span class="ident" id="6412898">NopCloser</span><span class="op" id="6412907">(</span><span class="ident" id="6412908">nil</span><span class="op" id="6412911">)</span><span class="op" id="6412912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412915">}</span><span class="op" id="6412916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412919">r</span>&nbsp;<span class="op" id="6412921">:=</span>&nbsp;<span class="builtinfunc" id="6412924">new</span><span class="op" id="6412927">(</span><span class="ident" id="6412928">rpc</span><span class="op" id="6412931">.</span><span class="ident" id="6412932">Request</span><span class="op" id="6412939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412942">if</span>&nbsp;<span class="ident" id="6412945">err</span>&nbsp;<span class="op" id="6412949">:=</span>&nbsp;<span class="ident" id="6412952">sc</span><span class="op" id="6412954">.</span><span class="ident" id="6412955">ReadRequestHeader</span><span class="op" id="6412972">(</span><span class="ident" id="6412973">r</span><span class="op" id="6412974">)</span><span class="op" id="6412975">;</span>&nbsp;<span class="ident" id="6412977">err</span>&nbsp;<span class="op" id="6412981">!=</span>&nbsp;<span class="ident" id="6412984">nil</span>&nbsp;<span class="op" id="6412988">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412992">t</span><span class="op" id="6412993">.</span><span class="ident" id="6412994">Fatal</span><span class="op" id="6412999">(</span><span class="ident" id="6413000">err</span><span class="op" id="6413003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413009">const</span>&nbsp;<span class="ident" id="6413015">valueText</span>&nbsp;<span class="op" id="6413025">=</span>&nbsp;<span class="string" id="6413027">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413061">const</span>&nbsp;<span class="ident" id="6413067">errorText</span>&nbsp;<span class="op" id="6413077">=</span>&nbsp;<span class="string" id="6413079">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413093">err</span>&nbsp;<span class="op" id="6413097">:=</span>&nbsp;<span class="ident" id="6413100">sc</span><span class="op" id="6413102">.</span><span class="ident" id="6413103">WriteResponse</span><span class="op" id="6413116">(</span><span class="op" id="6413117">&amp;</span><span class="ident" id="6413118">rpc</span><span class="op" id="6413121">.</span><span class="ident" id="6413122">Response</span><span class="op" id="6413130">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413134">ServiceMethod</span><span class="op" id="6413147">:</span>&nbsp;<span class="string" id="6413149">&#34;Method&#34;</span><span class="op" id="6413157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413161">Seq</span><span class="op" id="6413164">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6413176">1</span><span class="op" id="6413177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413181">Error</span><span class="op" id="6413186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6413196">errorText</span><span class="op" id="6413205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413208">}</span><span class="op" id="6413209">,</span>&nbsp;<span class="ident" id="6413211">valueText</span><span class="op" id="6413220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413223">if</span>&nbsp;<span class="ident" id="6413226">err</span>&nbsp;<span class="op" id="6413230">!=</span>&nbsp;<span class="ident" id="6413233">nil</span>&nbsp;<span class="op" id="6413237">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413241">t</span><span class="op" id="6413242">.</span><span class="ident" id="6413243">Fatal</span><span class="op" id="6413248">(</span><span class="ident" id="6413249">err</span><span class="op" id="6413252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413258">if</span>&nbsp;<span class="op" id="6413261">!</span><span class="ident" id="6413262">strings</span><span class="op" id="6413269">.</span><span class="ident" id="6413270">Contains</span><span class="op" id="6413278">(</span><span class="ident" id="6413279">out</span><span class="op" id="6413282">.</span><span class="ident" id="6413283">String</span><span class="op" id="6413289">(</span><span class="op" id="6413290">)</span><span class="op" id="6413291">,</span>&nbsp;<span class="ident" id="6413293">errorText</span><span class="op" id="6413302">)</span>&nbsp;<span class="op" id="6413304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413308">t</span><span class="op" id="6413309">.</span><span class="ident" id="6413310">Fatalf</span><span class="op" id="6413316">(</span><span class="string" id="6413317">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="6413364">,</span>&nbsp;<span class="ident" id="6413366">errorText</span><span class="op" id="6413375">,</span>&nbsp;<span class="op" id="6413377">&amp;</span><span class="ident" id="6413378">out</span><span class="op" id="6413381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413384">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413387">if</span>&nbsp;<span class="ident" id="6413390">strings</span><span class="op" id="6413397">.</span><span class="ident" id="6413398">Contains</span><span class="op" id="6413406">(</span><span class="ident" id="6413407">out</span><span class="op" id="6413410">.</span><span class="ident" id="6413411">String</span><span class="op" id="6413417">(</span><span class="op" id="6413418">)</span><span class="op" id="6413419">,</span>&nbsp;<span class="ident" id="6413421">valueText</span><span class="op" id="6413430">)</span>&nbsp;<span class="op" id="6413432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413436">t</span><span class="op" id="6413437">.</span><span class="ident" id="6413438">Errorf</span><span class="op" id="6413444">(</span><span class="string" id="6413445">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="6413492">,</span>&nbsp;<span class="op" id="6413494">&amp;</span><span class="ident" id="6413495">out</span><span class="op" id="6413498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413501">}</span><br>
<span class="lineno"></span><span class="op" id="6413503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6413506">func</span>&nbsp;<span class="ident" id="6413511">TestUnexpectedError</span><span class="op" id="6413530">(</span><span class="ident" id="6413531">t</span>&nbsp;<span class="op" id="6413533">*</span><span class="ident" id="6413534">testing</span><span class="op" id="6413541">.</span><span class="ident" id="6413542">T</span><span class="op" id="6413543">)</span>&nbsp;<span class="op" id="6413545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413548">cli</span><span class="op" id="6413551">,</span>&nbsp;<span class="ident" id="6413553">srv</span>&nbsp;<span class="op" id="6413557">:=</span>&nbsp;<span class="ident" id="6413560">myPipe</span><span class="op" id="6413566">(</span><span class="op" id="6413567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413570">go</span>&nbsp;<span class="ident" id="6413573">cli</span><span class="op" id="6413576">.</span><span class="ident" id="6413577">PipeWriter</span><span class="op" id="6413587">.</span><span class="ident" id="6413588">CloseWithError</span><span class="op" id="6413602">(</span><span class="ident" id="6413603">errors</span><span class="op" id="6413609">.</span><span class="ident" id="6413610">New</span><span class="op" id="6413613">(</span><span class="string" id="6413614">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="6413633">)</span><span class="op" id="6413634">)</span>&nbsp;<span class="comment" id="6413636">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413667">ServeConn</span><span class="op" id="6413676">(</span><span class="ident" id="6413677">srv</span><span class="op" id="6413680">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6413733">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6413758">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6413761">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="6413789">func</span>&nbsp;<span class="ident" id="6413794">myPipe</span><span class="op" id="6413800">(</span><span class="op" id="6413801">)</span>&nbsp;<span class="op" id="6413803">(</span><span class="op" id="6413804">*</span><span class="ident" id="6413805">pipe</span><span class="op" id="6413809">,</span>&nbsp;<span class="op" id="6413811">*</span><span class="ident" id="6413812">pipe</span><span class="op" id="6413816">)</span>&nbsp;<span class="op" id="6413818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413821">r1</span><span class="op" id="6413823">,</span>&nbsp;<span class="ident" id="6413825">w1</span>&nbsp;<span class="op" id="6413828">:=</span>&nbsp;<span class="ident" id="6413831">io</span><span class="op" id="6413833">.</span><span class="ident" id="6413834">Pipe</span><span class="op" id="6413838">(</span><span class="op" id="6413839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413842">r2</span><span class="op" id="6413844">,</span>&nbsp;<span class="ident" id="6413846">w2</span>&nbsp;<span class="op" id="6413849">:=</span>&nbsp;<span class="ident" id="6413852">io</span><span class="op" id="6413854">.</span><span class="ident" id="6413855">Pipe</span><span class="op" id="6413859">(</span><span class="op" id="6413860">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413864">return</span>&nbsp;<span class="op" id="6413871">&amp;</span><span class="ident" id="6413872">pipe</span><span class="op" id="6413876">{</span><span class="ident" id="6413877">r1</span><span class="op" id="6413879">,</span>&nbsp;<span class="ident" id="6413881">w2</span><span class="op" id="6413883">}</span><span class="op" id="6413884">,</span>&nbsp;<span class="op" id="6413886">&amp;</span><span class="ident" id="6413887">pipe</span><span class="op" id="6413891">{</span><span class="ident" id="6413892">r2</span><span class="op" id="6413894">,</span>&nbsp;<span class="ident" id="6413896">w1</span><span class="op" id="6413898">}</span><br>
<span class="lineno"></span><span class="op" id="6413900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6413903">type</span>&nbsp;<span class="ident" id="6413908">pipe</span>&nbsp;<span class="keyword" id="6413913">struct</span>&nbsp;<span class="op" id="6413920">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413923">*</span><span class="ident" id="6413924">io</span><span class="op" id="6413926">.</span><span class="ident" id="6413927">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413939">*</span><span class="ident" id="6413940">io</span><span class="op" id="6413942">.</span><span class="ident" id="6413943">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="6413954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6413957">type</span>&nbsp;<span class="ident" id="6413962">pipeAddr</span>&nbsp;<span class="builtintype" id="6413971">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="6413976">func</span>&nbsp;<span class="op" id="6413981">(</span><span class="ident" id="6413982">pipeAddr</span><span class="op" id="6413990">)</span>&nbsp;<span class="ident" id="6413992">Network</span><span class="op" id="6413999">(</span><span class="op" id="6414000">)</span>&nbsp;<span class="builtintype" id="6414002">string</span>&nbsp;<span class="op" id="6414009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414012">return</span>&nbsp;<span class="string" id="6414019">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6414026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="6414029">func</span>&nbsp;<span class="op" id="6414034">(</span><span class="ident" id="6414035">pipeAddr</span><span class="op" id="6414043">)</span>&nbsp;<span class="ident" id="6414045">String</span><span class="op" id="6414051">(</span><span class="op" id="6414052">)</span>&nbsp;<span class="builtintype" id="6414054">string</span>&nbsp;<span class="op" id="6414061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414064">return</span>&nbsp;<span class="string" id="6414071">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6414078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414081">func</span>&nbsp;<span class="op" id="6414086">(</span><span class="ident" id="6414087">p</span>&nbsp;<span class="op" id="6414089">*</span><span class="ident" id="6414090">pipe</span><span class="op" id="6414094">)</span>&nbsp;<span class="ident" id="6414096">Close</span><span class="op" id="6414101">(</span><span class="op" id="6414102">)</span>&nbsp;<span class="builtintype" id="6414104">error</span>&nbsp;<span class="op" id="6414110">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414113">err</span>&nbsp;<span class="op" id="6414117">:=</span>&nbsp;<span class="ident" id="6414120">p</span><span class="op" id="6414121">.</span><span class="ident" id="6414122">PipeReader</span><span class="op" id="6414132">.</span><span class="ident" id="6414133">Close</span><span class="op" id="6414138">(</span><span class="op" id="6414139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414142">err1</span>&nbsp;<span class="op" id="6414147">:=</span>&nbsp;<span class="ident" id="6414150">p</span><span class="op" id="6414151">.</span><span class="ident" id="6414152">PipeWriter</span><span class="op" id="6414162">.</span><span class="ident" id="6414163">Close</span><span class="op" id="6414168">(</span><span class="op" id="6414169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414172">if</span>&nbsp;<span class="ident" id="6414175">err</span>&nbsp;<span class="op" id="6414179">==</span>&nbsp;<span class="ident" id="6414182">nil</span>&nbsp;<span class="op" id="6414186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414190">err</span>&nbsp;<span class="op" id="6414194">=</span>&nbsp;<span class="ident" id="6414196">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414202">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414205">return</span>&nbsp;<span class="ident" id="6414212">err</span><br>
<span class="lineno"></span><span class="op" id="6414216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414219">func</span>&nbsp;<span class="op" id="6414224">(</span><span class="ident" id="6414225">p</span>&nbsp;<span class="op" id="6414227">*</span><span class="ident" id="6414228">pipe</span><span class="op" id="6414232">)</span>&nbsp;<span class="ident" id="6414234">LocalAddr</span><span class="op" id="6414243">(</span><span class="op" id="6414244">)</span>&nbsp;<span class="ident" id="6414246">net</span><span class="op" id="6414249">.</span><span class="ident" id="6414250">Addr</span>&nbsp;<span class="op" id="6414255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414258">return</span>&nbsp;<span class="ident" id="6414265">pipeAddr</span><span class="op" id="6414273">(</span><span class="num" id="6414274">0</span><span class="op" id="6414275">)</span><br>
<span class="lineno">280</span><span class="op" id="6414277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414280">func</span>&nbsp;<span class="op" id="6414285">(</span><span class="ident" id="6414286">p</span>&nbsp;<span class="op" id="6414288">*</span><span class="ident" id="6414289">pipe</span><span class="op" id="6414293">)</span>&nbsp;<span class="ident" id="6414295">RemoteAddr</span><span class="op" id="6414305">(</span><span class="op" id="6414306">)</span>&nbsp;<span class="ident" id="6414308">net</span><span class="op" id="6414311">.</span><span class="ident" id="6414312">Addr</span>&nbsp;<span class="op" id="6414317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414320">return</span>&nbsp;<span class="ident" id="6414327">pipeAddr</span><span class="op" id="6414335">(</span><span class="num" id="6414336">0</span><span class="op" id="6414337">)</span><br>
<span class="lineno"></span><span class="op" id="6414339">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6414342">func</span>&nbsp;<span class="op" id="6414347">(</span><span class="ident" id="6414348">p</span>&nbsp;<span class="op" id="6414350">*</span><span class="ident" id="6414351">pipe</span><span class="op" id="6414355">)</span>&nbsp;<span class="ident" id="6414357">SetTimeout</span><span class="op" id="6414367">(</span><span class="ident" id="6414368">nsec</span>&nbsp;<span class="ident" id="6414373">int64</span><span class="op" id="6414378">)</span>&nbsp;<span class="builtintype" id="6414380">error</span>&nbsp;<span class="op" id="6414386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414389">return</span>&nbsp;<span class="ident" id="6414396">errors</span><span class="op" id="6414402">.</span><span class="ident" id="6414403">New</span><span class="op" id="6414406">(</span><span class="string" id="6414407">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6414443">)</span><br>
<span class="lineno"></span><span class="op" id="6414445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="6414448">func</span>&nbsp;<span class="op" id="6414453">(</span><span class="ident" id="6414454">p</span>&nbsp;<span class="op" id="6414456">*</span><span class="ident" id="6414457">pipe</span><span class="op" id="6414461">)</span>&nbsp;<span class="ident" id="6414463">SetReadTimeout</span><span class="op" id="6414477">(</span><span class="ident" id="6414478">nsec</span>&nbsp;<span class="ident" id="6414483">int64</span><span class="op" id="6414488">)</span>&nbsp;<span class="builtintype" id="6414490">error</span>&nbsp;<span class="op" id="6414496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414499">return</span>&nbsp;<span class="ident" id="6414506">errors</span><span class="op" id="6414512">.</span><span class="ident" id="6414513">New</span><span class="op" id="6414516">(</span><span class="string" id="6414517">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6414553">)</span><br>
<span class="lineno"></span><span class="op" id="6414555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414558">func</span>&nbsp;<span class="op" id="6414563">(</span><span class="ident" id="6414564">p</span>&nbsp;<span class="op" id="6414566">*</span><span class="ident" id="6414567">pipe</span><span class="op" id="6414571">)</span>&nbsp;<span class="ident" id="6414573">SetWriteTimeout</span><span class="op" id="6414588">(</span><span class="ident" id="6414589">nsec</span>&nbsp;<span class="ident" id="6414594">int64</span><span class="op" id="6414599">)</span>&nbsp;<span class="builtintype" id="6414601">error</span>&nbsp;<span class="op" id="6414607">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414610">return</span>&nbsp;<span class="ident" id="6414617">errors</span><span class="op" id="6414623">.</span><span class="ident" id="6414624">New</span><span class="op" id="6414627">(</span><span class="string" id="6414628">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6414664">)</span><br>
<span class="lineno"></span><span class="op" id="6414666">}</span>
</div>
</body>
</html>
