<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6305922">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6305977">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6306031">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6306082">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6306141">//</span><br>
<span class="lineno"></span><span class="comment" id="6306144">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6306223">package</span>&nbsp;<span class="ident" id="6306231">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6306236">import</span>&nbsp;<span class="op" id="6306243">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306246">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306255">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306271">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306281">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306288">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306297">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6306312">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6306317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6306320">var</span>&nbsp;<span class="op" id="6306324">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306327">errNotEnough</span>&nbsp;<span class="op" id="6306340">=</span>&nbsp;<span class="ident" id="6306342"><a href="/image/gif/reader.go.html#6306271">errors</a></span><span class="op" id="6306348">.</span><span class="ident" id="6306349">New</span><span class="op" id="6306352">(</span><span class="string" id="6306353">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6306381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306384">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6306397">=</span>&nbsp;<span class="ident" id="6306399"><a href="/image/gif/reader.go.html#6306271">errors</a></span><span class="op" id="6306405">.</span><span class="ident" id="6306406">New</span><span class="op" id="6306409">(</span><span class="string" id="6306410">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6306436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306439">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6306452">=</span>&nbsp;<span class="ident" id="6306454"><a href="/image/gif/reader.go.html#6306271">errors</a></span><span class="op" id="6306460">.</span><span class="ident" id="6306461">New</span><span class="op" id="6306464">(</span><span class="string" id="6306465">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6306491">)</span><br>
<span class="lineno"></span><span class="op" id="6306493">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6306496">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6306591">type</span>&nbsp;<span class="ident" id="6306596">reader</span>&nbsp;<span class="keyword" id="6306603">interface</span>&nbsp;<span class="op" id="6306613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306616"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6306618">.</span><span class="ident" id="6306619">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306627"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6306629">.</span><span class="ident" id="6306630">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6306641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306644">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6306658">const</span>&nbsp;<span class="op" id="6306664">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306667">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306679">fColorMapFollows</span>&nbsp;<span class="op" id="6306696">=</span>&nbsp;<span class="num" id="6306698">1</span>&nbsp;<span class="op" id="6306700">&lt;&lt;</span>&nbsp;<span class="num" id="6306703">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306707">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306725">ifLocalColorTable</span>&nbsp;<span class="op" id="6306743">=</span>&nbsp;<span class="num" id="6306745">1</span>&nbsp;<span class="op" id="6306747">&lt;&lt;</span>&nbsp;<span class="num" id="6306750">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306753">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306771">=</span>&nbsp;<span class="num" id="6306773">1</span>&nbsp;<span class="op" id="6306775">&lt;&lt;</span>&nbsp;<span class="num" id="6306778">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306781">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6306799">=</span>&nbsp;<span class="num" id="6306801">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306805">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306832">gcTransparentColorSet</span>&nbsp;<span class="op" id="6306854">=</span>&nbsp;<span class="num" id="6306856">1</span>&nbsp;<span class="op" id="6306858">&lt;&lt;</span>&nbsp;<span class="num" id="6306861">0</span><br>
<span class="lineno"></span><span class="op" id="6306863">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6306866">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6306889">const</span>&nbsp;<span class="op" id="6306895">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306898">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306915">=</span>&nbsp;<span class="num" id="6306917">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306923">sImageDescriptor</span>&nbsp;<span class="op" id="6306940">=</span>&nbsp;<span class="num" id="6306942">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306948">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306965">=</span>&nbsp;<span class="num" id="6306967">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6306972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306975">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6306990">const</span>&nbsp;<span class="op" id="6306996">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306999">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307015">=</span>&nbsp;<span class="num" id="6307017">0x01</span>&nbsp;<span class="comment" id="6307022">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307037">eGraphicControl</span>&nbsp;<span class="op" id="6307053">=</span>&nbsp;<span class="num" id="6307055">0xF9</span>&nbsp;<span class="comment" id="6307060">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307080">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307096">=</span>&nbsp;<span class="num" id="6307098">0xFE</span>&nbsp;<span class="comment" id="6307103">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307115">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307131">=</span>&nbsp;<span class="num" id="6307133">0xFF</span>&nbsp;<span class="comment" id="6307138">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6307153">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6307156">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6307206">type</span>&nbsp;<span class="ident" id="6307211">decoder</span>&nbsp;<span class="keyword" id="6307219">struct</span>&nbsp;<span class="op" id="6307226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307229">r</span>&nbsp;<span class="ident" id="6307231"><a href="/image/gif/reader.go.html#6306596">reader</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307240">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307257">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307273">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307281">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307297">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307302">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307318">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307323">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307339">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307345">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307361">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307367">backgroundIndex</span>&nbsp;<span class="builtintype" id="6307383">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307389">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307405">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307410">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307426">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307432">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307456">aspect</span>&nbsp;<span class="builtintype" id="6307463">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307470">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307497">imageFields</span>&nbsp;<span class="builtintype" id="6307509">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307516">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307543">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307563">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307569">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6307589">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307596">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307610">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307625">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307631">globalColorMap</span>&nbsp;<span class="ident" id="6307646"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6307651">.</span><span class="ident" id="6307652">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307662">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307686">delay</span>&nbsp;<span class="op" id="6307692">[</span><span class="op" id="6307693">]</span><span class="builtintype" id="6307694">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307699">image</span>&nbsp;<span class="op" id="6307705">[</span><span class="op" id="6307706">]</span><span class="op" id="6307707">*</span><span class="ident" id="6307708"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6307713">.</span><span class="ident" id="6307714">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307724">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6307730">[</span><span class="num" id="6307731">1024</span><span class="op" id="6307735">]</span><span class="builtintype" id="6307736">byte</span>&nbsp;<span class="comment" id="6307741">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6307790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6307793">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6307860">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6307927">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6307991">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6308061">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6308130">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6308159">type</span>&nbsp;<span class="ident" id="6308164">blockReader</span>&nbsp;<span class="keyword" id="6308176">struct</span>&nbsp;<span class="op" id="6308183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308186">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308192"><a href="/image/gif/reader.go.html#6306596">reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308200">slice</span>&nbsp;<span class="op" id="6308206">[</span><span class="op" id="6308207">]</span><span class="builtintype" id="6308208">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308214">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6308220">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308227">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6308233">[</span><span class="num" id="6308234">256</span><span class="op" id="6308237">]</span><span class="builtintype" id="6308238">byte</span><br>
<span class="lineno"></span><span class="op" id="6308243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6308246">func</span>&nbsp;<span class="op" id="6308251">(</span><span class="ident" id="6308252">b</span>&nbsp;<span class="op" id="6308254">*</span><span class="ident" id="6308255"><a href="/image/gif/reader.go.html#6308164">blockReader</a></span><span class="op" id="6308266">)</span>&nbsp;<span class="ident" id="6308268">Read</span><span class="op" id="6308272">(</span><span class="ident" id="6308273">p</span>&nbsp;<span class="op" id="6308275">[</span><span class="op" id="6308276">]</span><span class="builtintype" id="6308277">byte</span><span class="op" id="6308281">)</span>&nbsp;<span class="op" id="6308283">(</span><span class="builtintype" id="6308284">int</span><span class="op" id="6308287">,</span>&nbsp;<span class="builtintype" id="6308289">error</span><span class="op" id="6308294">)</span>&nbsp;<span class="op" id="6308296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308299">if</span>&nbsp;<span class="ident" id="6308302"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308303">.</span><span class="ident" id="6308304">err</span>&nbsp;<span class="op" id="6308308">!=</span>&nbsp;<span class="ident" id="6308311">nil</span>&nbsp;<span class="op" id="6308315">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308319">return</span>&nbsp;<span class="num" id="6308326">0</span><span class="op" id="6308327">,</span>&nbsp;<span class="ident" id="6308329"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308330">.</span><span class="ident" id="6308331">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308339">if</span>&nbsp;<span class="builtinfunc" id="6308342">len</span><span class="op" id="6308345">(</span><span class="ident" id="6308346"><a href="/image/gif/reader.go.html#6308273">p</a></span><span class="op" id="6308347">)</span>&nbsp;<span class="op" id="6308349">==</span>&nbsp;<span class="num" id="6308352">0</span>&nbsp;<span class="op" id="6308354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308358">return</span>&nbsp;<span class="num" id="6308365">0</span><span class="op" id="6308366">,</span>&nbsp;<span class="ident" id="6308368">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308373">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308376">if</span>&nbsp;<span class="builtinfunc" id="6308379">len</span><span class="op" id="6308382">(</span><span class="ident" id="6308383"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308384">.</span><span class="ident" id="6308385">slice</span><span class="op" id="6308390">)</span>&nbsp;<span class="op" id="6308392">==</span>&nbsp;<span class="num" id="6308395">0</span>&nbsp;<span class="op" id="6308397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308401">var</span>&nbsp;<span class="ident" id="6308405">blockLen</span>&nbsp;<span class="builtintype" id="6308414">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308422"><a href="/image/gif/reader.go.html#6308405">blockLen</a></span><span class="op" id="6308430">,</span>&nbsp;<span class="ident" id="6308432"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308433">.</span><span class="ident" id="6308434">err</span>&nbsp;<span class="op" id="6308438">=</span>&nbsp;<span class="ident" id="6308440"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308441">.</span><span class="ident" id="6308442">r</span><span class="op" id="6308443">.</span><span class="ident" id="6308444">ReadByte</span><span class="op" id="6308452">(</span><span class="op" id="6308453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308457">if</span>&nbsp;<span class="ident" id="6308460"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308461">.</span><span class="ident" id="6308462">err</span>&nbsp;<span class="op" id="6308466">!=</span>&nbsp;<span class="ident" id="6308469">nil</span>&nbsp;<span class="op" id="6308473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308478">return</span>&nbsp;<span class="num" id="6308485">0</span><span class="op" id="6308486">,</span>&nbsp;<span class="ident" id="6308488"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308489">.</span><span class="ident" id="6308490">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308500">if</span>&nbsp;<span class="ident" id="6308503"><a href="/image/gif/reader.go.html#6308405">blockLen</a></span>&nbsp;<span class="op" id="6308512">==</span>&nbsp;<span class="num" id="6308515">0</span>&nbsp;<span class="op" id="6308517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308522"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308523">.</span><span class="ident" id="6308524">err</span>&nbsp;<span class="op" id="6308528">=</span>&nbsp;<span class="ident" id="6308530"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6308532">.</span><span class="ident" id="6308533">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308540">return</span>&nbsp;<span class="num" id="6308547">0</span><span class="op" id="6308548">,</span>&nbsp;<span class="ident" id="6308550"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308551">.</span><span class="ident" id="6308552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308558">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308562"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308563">.</span><span class="ident" id="6308564">slice</span>&nbsp;<span class="op" id="6308570">=</span>&nbsp;<span class="ident" id="6308572"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308573">.</span><span class="ident" id="6308574">tmp</span><span class="op" id="6308577">[</span><span class="num" id="6308578">0</span><span class="op" id="6308579">:</span><span class="ident" id="6308580"><a href="/image/gif/reader.go.html#6308405">blockLen</a></span><span class="op" id="6308588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308592">if</span>&nbsp;<span class="ident" id="6308595">_</span><span class="op" id="6308596">,</span>&nbsp;<span class="ident" id="6308598"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308599">.</span><span class="ident" id="6308600">err</span>&nbsp;<span class="op" id="6308604">=</span>&nbsp;<span class="ident" id="6308606"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6308608">.</span><span class="ident" id="6308609">ReadFull</span><span class="op" id="6308617">(</span><span class="ident" id="6308618"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308619">.</span><span class="ident" id="6308620">r</span><span class="op" id="6308621">,</span>&nbsp;<span class="ident" id="6308623"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308624">.</span><span class="ident" id="6308625">slice</span><span class="op" id="6308630">)</span><span class="op" id="6308631">;</span>&nbsp;<span class="ident" id="6308633"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308634">.</span><span class="ident" id="6308635">err</span>&nbsp;<span class="op" id="6308639">!=</span>&nbsp;<span class="ident" id="6308642">nil</span>&nbsp;<span class="op" id="6308646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308651">return</span>&nbsp;<span class="num" id="6308658">0</span><span class="op" id="6308659">,</span>&nbsp;<span class="ident" id="6308661"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308662">.</span><span class="ident" id="6308663">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308672">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308675">n</span>&nbsp;<span class="op" id="6308677">:=</span>&nbsp;<span class="builtinfunc" id="6308680">copy</span><span class="op" id="6308684">(</span><span class="ident" id="6308685"><a href="/image/gif/reader.go.html#6308273">p</a></span><span class="op" id="6308686">,</span>&nbsp;<span class="ident" id="6308688"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308689">.</span><span class="ident" id="6308690">slice</span><span class="op" id="6308695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308698"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308699">.</span><span class="ident" id="6308700">slice</span>&nbsp;<span class="op" id="6308706">=</span>&nbsp;<span class="ident" id="6308708"><a href="/image/gif/reader.go.html#6308252">b</a></span><span class="op" id="6308709">.</span><span class="ident" id="6308710">slice</span><span class="op" id="6308715">[</span><span class="ident" id="6308716"><a href="/image/gif/reader.go.html#6308675">n</a></span><span class="op" id="6308717">:</span><span class="op" id="6308718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308721">return</span>&nbsp;<span class="ident" id="6308728"><a href="/image/gif/reader.go.html#6308675">n</a></span><span class="op" id="6308729">,</span>&nbsp;<span class="ident" id="6308731">nil</span><br>
<span class="lineno"></span><span class="op" id="6308735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6308738">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6308801">func</span>&nbsp;<span class="op" id="6308806">(</span><span class="ident" id="6308807">d</span>&nbsp;<span class="op" id="6308809">*</span><span class="ident" id="6308810"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6308817">)</span>&nbsp;<span class="ident" id="6308819">decode</span><span class="op" id="6308825">(</span><span class="ident" id="6308826">r</span>&nbsp;<span class="ident" id="6308828"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6308830">.</span><span class="ident" id="6308831">Reader</span><span class="op" id="6308837">,</span>&nbsp;<span class="ident" id="6308839">configOnly</span>&nbsp;<span class="builtintype" id="6308850">bool</span><span class="op" id="6308854">)</span>&nbsp;<span class="builtintype" id="6308856">error</span>&nbsp;<span class="op" id="6308862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6308865">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308915">if</span>&nbsp;<span class="ident" id="6308918">rr</span><span class="op" id="6308920">,</span>&nbsp;<span class="ident" id="6308922">ok</span>&nbsp;<span class="op" id="6308925">:=</span>&nbsp;<span class="ident" id="6308928"><a href="/image/gif/reader.go.html#6308826">r</a></span><span class="op" id="6308929">.</span><span class="op" id="6308930">(</span><span class="ident" id="6308931"><a href="/image/gif/reader.go.html#6306596">reader</a></span><span class="op" id="6308937">)</span><span class="op" id="6308938">;</span>&nbsp;<span class="ident" id="6308940"><a href="/image/gif/reader.go.html#6308922">ok</a></span>&nbsp;<span class="op" id="6308943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308947"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6308948">.</span><span class="ident" id="6308949">r</span>&nbsp;<span class="op" id="6308951">=</span>&nbsp;<span class="ident" id="6308953"><a href="/image/gif/reader.go.html#6308918">rr</a></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308957">}</span>&nbsp;<span class="keyword" id="6308959">else</span>&nbsp;<span class="op" id="6308964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308968"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6308969">.</span><span class="ident" id="6308970">r</span>&nbsp;<span class="op" id="6308972">=</span>&nbsp;<span class="ident" id="6308974"><a href="/image/gif/reader.go.html#6306246">bufio</a></span><span class="op" id="6308979">.</span><span class="ident" id="6308980">NewReader</span><span class="op" id="6308989">(</span><span class="ident" id="6308990"><a href="/image/gif/reader.go.html#6308826">r</a></span><span class="op" id="6308991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308998">err</span>&nbsp;<span class="op" id="6309002">:=</span>&nbsp;<span class="ident" id="6309005"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309006">.</span><span class="ident" id="6309007">readHeaderAndScreenDescriptor</span><span class="op" id="6309036">(</span><span class="op" id="6309037">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309040">if</span>&nbsp;<span class="ident" id="6309043"><a href="/image/gif/reader.go.html#6308998">err</a></span>&nbsp;<span class="op" id="6309047">!=</span>&nbsp;<span class="ident" id="6309050">nil</span>&nbsp;<span class="op" id="6309054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309058">return</span>&nbsp;<span class="ident" id="6309065"><a href="/image/gif/reader.go.html#6308998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309073">if</span>&nbsp;<span class="ident" id="6309076"><a href="/image/gif/reader.go.html#6308839">configOnly</a></span>&nbsp;<span class="op" id="6309087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309091">return</span>&nbsp;<span class="ident" id="6309098">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309107">if</span>&nbsp;<span class="ident" id="6309110"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309111">.</span><span class="ident" id="6309112">headerFields</span><span class="op" id="6309124">&amp;</span><span class="ident" id="6309125"><a href="/image/gif/reader.go.html#6306679">fColorMapFollows</a></span>&nbsp;<span class="op" id="6309142">!=</span>&nbsp;<span class="num" id="6309145">0</span>&nbsp;<span class="op" id="6309147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309151">if</span>&nbsp;<span class="ident" id="6309154"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309155">.</span><span class="ident" id="6309156">globalColorMap</span><span class="op" id="6309170">,</span>&nbsp;<span class="ident" id="6309172"><a href="/image/gif/reader.go.html#6308998">err</a></span>&nbsp;<span class="op" id="6309176">=</span>&nbsp;<span class="ident" id="6309178"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309179">.</span><span class="ident" id="6309180">readColorMap</span><span class="op" id="6309192">(</span><span class="op" id="6309193">)</span><span class="op" id="6309194">;</span>&nbsp;<span class="ident" id="6309196"><a href="/image/gif/reader.go.html#6308998">err</a></span>&nbsp;<span class="op" id="6309200">!=</span>&nbsp;<span class="ident" id="6309203">nil</span>&nbsp;<span class="op" id="6309207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309212">return</span>&nbsp;<span class="ident" id="6309219"><a href="/image/gif/reader.go.html#6308998">err</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309232">for</span>&nbsp;<span class="op" id="6309236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309240">c</span><span class="op" id="6309241">,</span>&nbsp;<span class="ident" id="6309243">err</span>&nbsp;<span class="op" id="6309247">:=</span>&nbsp;<span class="ident" id="6309250"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309251">.</span><span class="ident" id="6309252">r</span><span class="op" id="6309253">.</span><span class="ident" id="6309254">ReadByte</span><span class="op" id="6309262">(</span><span class="op" id="6309263">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309267">if</span>&nbsp;<span class="ident" id="6309270"><a href="/image/gif/reader.go.html#6309243">err</a></span>&nbsp;<span class="op" id="6309274">!=</span>&nbsp;<span class="ident" id="6309277">nil</span>&nbsp;<span class="op" id="6309281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309286">return</span>&nbsp;<span class="ident" id="6309293"><a href="/image/gif/reader.go.html#6309243">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309303">switch</span>&nbsp;<span class="ident" id="6309310"><a href="/image/gif/reader.go.html#6309240">c</a></span>&nbsp;<span class="op" id="6309312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309316">case</span>&nbsp;<span class="ident" id="6309321"><a href="/image/gif/reader.go.html#6306898">sExtension</a></span><span class="op" id="6309331">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309336">if</span>&nbsp;<span class="ident" id="6309339"><a href="/image/gif/reader.go.html#6309243">err</a></span>&nbsp;<span class="op" id="6309343">=</span>&nbsp;<span class="ident" id="6309345"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309346">.</span><span class="ident" id="6309347">readExtension</span><span class="op" id="6309360">(</span><span class="op" id="6309361">)</span><span class="op" id="6309362">;</span>&nbsp;<span class="ident" id="6309364"><a href="/image/gif/reader.go.html#6309243">err</a></span>&nbsp;<span class="op" id="6309368">!=</span>&nbsp;<span class="ident" id="6309371">nil</span>&nbsp;<span class="op" id="6309375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309381">return</span>&nbsp;<span class="ident" id="6309388"><a href="/image/gif/reader.go.html#6309243">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309400">case</span>&nbsp;<span class="ident" id="6309405"><a href="/image/gif/reader.go.html#6306923">sImageDescriptor</a></span><span class="op" id="6309421">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309426">m</span><span class="op" id="6309427">,</span>&nbsp;<span class="ident" id="6309429">err</span>&nbsp;<span class="op" id="6309433">:=</span>&nbsp;<span class="ident" id="6309436"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309437">.</span><span class="ident" id="6309438">newImageFromDescriptor</span><span class="op" id="6309460">(</span><span class="op" id="6309461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309466">if</span>&nbsp;<span class="ident" id="6309469"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6309473">!=</span>&nbsp;<span class="ident" id="6309476">nil</span>&nbsp;<span class="op" id="6309480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309486">return</span>&nbsp;<span class="ident" id="6309493"><a href="/image/gif/reader.go.html#6309429">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309505">useLocalColorMap</span>&nbsp;<span class="op" id="6309522">:=</span>&nbsp;<span class="ident" id="6309525"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309526">.</span><span class="ident" id="6309527">imageFields</span><span class="op" id="6309538">&amp;</span><span class="ident" id="6309539"><a href="/image/gif/reader.go.html#6306679">fColorMapFollows</a></span>&nbsp;<span class="op" id="6309556">!=</span>&nbsp;<span class="num" id="6309559">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309564">if</span>&nbsp;<span class="ident" id="6309567"><a href="/image/gif/reader.go.html#6309505">useLocalColorMap</a></span>&nbsp;<span class="op" id="6309584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309590"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6309591">.</span><span class="ident" id="6309592">Palette</span><span class="op" id="6309599">,</span>&nbsp;<span class="ident" id="6309601"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6309605">=</span>&nbsp;<span class="ident" id="6309607"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309608">.</span><span class="ident" id="6309609">readColorMap</span><span class="op" id="6309621">(</span><span class="op" id="6309622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309628">if</span>&nbsp;<span class="ident" id="6309631"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6309635">!=</span>&nbsp;<span class="ident" id="6309638">nil</span>&nbsp;<span class="op" id="6309642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309649">return</span>&nbsp;<span class="ident" id="6309656"><a href="/image/gif/reader.go.html#6309429">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309664">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309669">}</span>&nbsp;<span class="keyword" id="6309671">else</span>&nbsp;<span class="op" id="6309676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309682"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6309683">.</span><span class="ident" id="6309684">Palette</span>&nbsp;<span class="op" id="6309692">=</span>&nbsp;<span class="ident" id="6309694"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309695">.</span><span class="ident" id="6309696">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309719">if</span>&nbsp;<span class="ident" id="6309722"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309723">.</span><span class="ident" id="6309724">hasTransparentIndex</span>&nbsp;<span class="op" id="6309744">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6309747">int</span><span class="op" id="6309750">(</span><span class="ident" id="6309751"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309752">.</span><span class="ident" id="6309753">transparentIndex</span><span class="op" id="6309769">)</span>&nbsp;<span class="op" id="6309771">&lt;</span>&nbsp;<span class="builtinfunc" id="6309773">len</span><span class="op" id="6309776">(</span><span class="ident" id="6309777"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6309778">.</span><span class="ident" id="6309779">Palette</span><span class="op" id="6309786">)</span>&nbsp;<span class="op" id="6309788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309794">if</span>&nbsp;<span class="op" id="6309797">!</span><span class="ident" id="6309798"><a href="/image/gif/reader.go.html#6309505">useLocalColorMap</a></span>&nbsp;<span class="op" id="6309815">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309822">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309858"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6309859">.</span><span class="ident" id="6309860">Palette</span>&nbsp;<span class="op" id="6309868">=</span>&nbsp;<span class="builtinfunc" id="6309870">append</span><span class="op" id="6309876">(</span><span class="ident" id="6309877"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6309882">.</span><span class="ident" id="6309883">Palette</span><span class="op" id="6309890">(</span><span class="ident" id="6309891">nil</span><span class="op" id="6309894">)</span><span class="op" id="6309895">,</span>&nbsp;<span class="ident" id="6309897"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309898">.</span><span class="ident" id="6309899">globalColorMap</span><span class="op" id="6309913">...</span><span class="op" id="6309916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309928"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6309929">.</span><span class="ident" id="6309930">Palette</span><span class="op" id="6309937">[</span><span class="ident" id="6309938"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309939">.</span><span class="ident" id="6309940">transparentIndex</span><span class="op" id="6309956">]</span>&nbsp;<span class="op" id="6309958">=</span>&nbsp;<span class="ident" id="6309960"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6309965">.</span><span class="ident" id="6309966">RGBA</span><span class="op" id="6309970">{</span><span class="op" id="6309971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309976">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309981">litWidth</span><span class="op" id="6309989">,</span>&nbsp;<span class="ident" id="6309991"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6309995">:=</span>&nbsp;<span class="ident" id="6309998"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6309999">.</span><span class="ident" id="6310000">r</span><span class="op" id="6310001">.</span><span class="ident" id="6310002">ReadByte</span><span class="op" id="6310010">(</span><span class="op" id="6310011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310016">if</span>&nbsp;<span class="ident" id="6310019"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6310023">!=</span>&nbsp;<span class="ident" id="6310026">nil</span>&nbsp;<span class="op" id="6310030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310036">return</span>&nbsp;<span class="ident" id="6310043"><a href="/image/gif/reader.go.html#6309429">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310055">if</span>&nbsp;<span class="ident" id="6310058"><a href="/image/gif/reader.go.html#6309981">litWidth</a></span>&nbsp;<span class="op" id="6310067">&lt;</span>&nbsp;<span class="num" id="6310069">2</span>&nbsp;<span class="op" id="6310071">||</span>&nbsp;<span class="ident" id="6310074"><a href="/image/gif/reader.go.html#6309981">litWidth</a></span>&nbsp;<span class="op" id="6310083">&gt;</span>&nbsp;<span class="num" id="6310085">8</span>&nbsp;<span class="op" id="6310087">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310093">return</span>&nbsp;<span class="ident" id="6310100"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6310103">.</span><span class="ident" id="6310104">Errorf</span><span class="op" id="6310110">(</span><span class="string" id="6310111">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6310155">,</span>&nbsp;<span class="ident" id="6310157"><a href="/image/gif/reader.go.html#6309981">litWidth</a></span><span class="op" id="6310165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310175">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310219">br</span>&nbsp;<span class="op" id="6310222">:=</span>&nbsp;<span class="op" id="6310225">&amp;</span><span class="ident" id="6310226"><a href="/image/gif/reader.go.html#6308164">blockReader</a></span><span class="op" id="6310237">{</span><span class="ident" id="6310238">r</span><span class="op" id="6310239">:</span>&nbsp;<span class="ident" id="6310241"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6310242">.</span><span class="ident" id="6310243">r</span><span class="op" id="6310244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310249">lzwr</span>&nbsp;<span class="op" id="6310254">:=</span>&nbsp;<span class="ident" id="6310257"><a href="/image/gif/reader.go.html#6306255">lzw</a></span><span class="op" id="6310260">.</span><span class="ident" id="6310261">NewReader</span><span class="op" id="6310270">(</span><span class="ident" id="6310271"><a href="/image/gif/reader.go.html#6310219">br</a></span><span class="op" id="6310273">,</span>&nbsp;<span class="ident" id="6310275"><a href="/image/gif/reader.go.html#6306255">lzw</a></span><span class="op" id="6310278">.</span><span class="ident" id="6310279">LSB</span><span class="op" id="6310282">,</span>&nbsp;<span class="builtintype" id="6310284">int</span><span class="op" id="6310287">(</span><span class="ident" id="6310288"><a href="/image/gif/reader.go.html#6309981">litWidth</a></span><span class="op" id="6310296">)</span><span class="op" id="6310297">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310302">defer</span>&nbsp;<span class="ident" id="6310308"><a href="/image/gif/reader.go.html#6310249">lzwr</a></span><span class="op" id="6310312">.</span><span class="ident" id="6310313">Close</span><span class="op" id="6310318">(</span><span class="op" id="6310319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310324">if</span>&nbsp;<span class="ident" id="6310327">_</span><span class="op" id="6310328">,</span>&nbsp;<span class="ident" id="6310330"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6310334">=</span>&nbsp;<span class="ident" id="6310336"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6310338">.</span><span class="ident" id="6310339">ReadFull</span><span class="op" id="6310347">(</span><span class="ident" id="6310348"><a href="/image/gif/reader.go.html#6310249">lzwr</a></span><span class="op" id="6310352">,</span>&nbsp;<span class="ident" id="6310354"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6310355">.</span><span class="ident" id="6310356">Pix</span><span class="op" id="6310359">)</span><span class="op" id="6310360">;</span>&nbsp;<span class="ident" id="6310362"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6310366">!=</span>&nbsp;<span class="ident" id="6310369">nil</span>&nbsp;<span class="op" id="6310373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310379">if</span>&nbsp;<span class="ident" id="6310382"><a href="/image/gif/reader.go.html#6309429">err</a></span>&nbsp;<span class="op" id="6310386">!=</span>&nbsp;<span class="ident" id="6310389"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6310391">.</span><span class="ident" id="6310392">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6310409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310416">return</span>&nbsp;<span class="ident" id="6310423"><a href="/image/gif/reader.go.html#6309429">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310431">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310437">return</span>&nbsp;<span class="ident" id="6310444"><a href="/image/gif/reader.go.html#6306327">errNotEnough</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310465">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310527">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310559">if</span>&nbsp;<span class="ident" id="6310562">n</span><span class="op" id="6310563">,</span>&nbsp;<span class="ident" id="6310565">err</span>&nbsp;<span class="op" id="6310569">:=</span>&nbsp;<span class="ident" id="6310572"><a href="/image/gif/reader.go.html#6310249">lzwr</a></span><span class="op" id="6310576">.</span><span class="ident" id="6310577">Read</span><span class="op" id="6310581">(</span><span class="ident" id="6310582"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6310583">.</span><span class="ident" id="6310584">tmp</span><span class="op" id="6310587">[</span><span class="op" id="6310588">:</span><span class="num" id="6310589">1</span><span class="op" id="6310590">]</span><span class="op" id="6310591">)</span><span class="op" id="6310592">;</span>&nbsp;<span class="ident" id="6310594"><a href="/image/gif/reader.go.html#6310562">n</a></span>&nbsp;<span class="op" id="6310596">!=</span>&nbsp;<span class="num" id="6310599">0</span>&nbsp;<span class="op" id="6310601">||</span>&nbsp;<span class="ident" id="6310604"><a href="/image/gif/reader.go.html#6310565">err</a></span>&nbsp;<span class="op" id="6310608">!=</span>&nbsp;<span class="ident" id="6310611"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6310613">.</span><span class="ident" id="6310614">EOF</span>&nbsp;<span class="op" id="6310618">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310624">if</span>&nbsp;<span class="ident" id="6310627"><a href="/image/gif/reader.go.html#6310565">err</a></span>&nbsp;<span class="op" id="6310631">!=</span>&nbsp;<span class="ident" id="6310634">nil</span>&nbsp;<span class="op" id="6310638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310645">return</span>&nbsp;<span class="ident" id="6310652"><a href="/image/gif/reader.go.html#6310565">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310666">return</span>&nbsp;<span class="ident" id="6310673"><a href="/image/gif/reader.go.html#6306384">errTooMuch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310687">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310692">if</span>&nbsp;<span class="ident" id="6310695">n</span><span class="op" id="6310696">,</span>&nbsp;<span class="ident" id="6310698">err</span>&nbsp;<span class="op" id="6310702">:=</span>&nbsp;<span class="ident" id="6310705"><a href="/image/gif/reader.go.html#6310219">br</a></span><span class="op" id="6310707">.</span><span class="ident" id="6310708">Read</span><span class="op" id="6310712">(</span><span class="ident" id="6310713"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6310714">.</span><span class="ident" id="6310715">tmp</span><span class="op" id="6310718">[</span><span class="op" id="6310719">:</span><span class="num" id="6310720">1</span><span class="op" id="6310721">]</span><span class="op" id="6310722">)</span><span class="op" id="6310723">;</span>&nbsp;<span class="ident" id="6310725"><a href="/image/gif/reader.go.html#6310695">n</a></span>&nbsp;<span class="op" id="6310727">!=</span>&nbsp;<span class="num" id="6310730">0</span>&nbsp;<span class="op" id="6310732">||</span>&nbsp;<span class="ident" id="6310735"><a href="/image/gif/reader.go.html#6310698">err</a></span>&nbsp;<span class="op" id="6310739">!=</span>&nbsp;<span class="ident" id="6310742"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6310744">.</span><span class="ident" id="6310745">EOF</span>&nbsp;<span class="op" id="6310749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310755">if</span>&nbsp;<span class="ident" id="6310758"><a href="/image/gif/reader.go.html#6310698">err</a></span>&nbsp;<span class="op" id="6310762">!=</span>&nbsp;<span class="ident" id="6310765">nil</span>&nbsp;<span class="op" id="6310769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310776">return</span>&nbsp;<span class="ident" id="6310783"><a href="/image/gif/reader.go.html#6310698">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310797">return</span>&nbsp;<span class="ident" id="6310804"><a href="/image/gif/reader.go.html#6306384">errTooMuch</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310824">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310883">if</span>&nbsp;<span class="builtinfunc" id="6310886">len</span><span class="op" id="6310889">(</span><span class="ident" id="6310890"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6310891">.</span><span class="ident" id="6310892">Palette</span><span class="op" id="6310899">)</span>&nbsp;<span class="op" id="6310901">&lt;</span>&nbsp;<span class="num" id="6310903">256</span>&nbsp;<span class="op" id="6310907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310913">for</span>&nbsp;<span class="ident" id="6310917">_</span><span class="op" id="6310918">,</span>&nbsp;<span class="ident" id="6310920">pixel</span>&nbsp;<span class="op" id="6310926">:=</span>&nbsp;<span class="keyword" id="6310929">range</span>&nbsp;<span class="ident" id="6310935"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6310936">.</span><span class="ident" id="6310937">Pix</span>&nbsp;<span class="op" id="6310941">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310948">if</span>&nbsp;<span class="builtintype" id="6310951">int</span><span class="op" id="6310954">(</span><span class="ident" id="6310955"><a href="/image/gif/reader.go.html#6310920">pixel</a></span><span class="op" id="6310960">)</span>&nbsp;<span class="op" id="6310962">&gt;=</span>&nbsp;<span class="builtinfunc" id="6310965">len</span><span class="op" id="6310968">(</span><span class="ident" id="6310969"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6310970">.</span><span class="ident" id="6310971">Palette</span><span class="op" id="6310978">)</span>&nbsp;<span class="op" id="6310980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310988">return</span>&nbsp;<span class="ident" id="6310995"><a href="/image/gif/reader.go.html#6306439">errBadPixel</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311023">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311029">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311070">if</span>&nbsp;<span class="ident" id="6311073"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311074">.</span><span class="ident" id="6311075">imageFields</span><span class="op" id="6311086">&amp;</span><span class="ident" id="6311087"><a href="/image/gif/reader.go.html#6306753">ifInterlace</a></span>&nbsp;<span class="op" id="6311099">!=</span>&nbsp;<span class="num" id="6311102">0</span>&nbsp;<span class="op" id="6311104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311110"><a href="/image/gif/reader.go.html#6315730">uninterlace</a></span><span class="op" id="6311121">(</span><span class="ident" id="6311122"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6311123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311128">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311134"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311135">.</span><span class="ident" id="6311136">image</span>&nbsp;<span class="op" id="6311142">=</span>&nbsp;<span class="builtinfunc" id="6311144">append</span><span class="op" id="6311150">(</span><span class="ident" id="6311151"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311152">.</span><span class="ident" id="6311153">image</span><span class="op" id="6311158">,</span>&nbsp;<span class="ident" id="6311160"><a href="/image/gif/reader.go.html#6309426">m</a></span><span class="op" id="6311161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311166"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311167">.</span><span class="ident" id="6311168">delay</span>&nbsp;<span class="op" id="6311174">=</span>&nbsp;<span class="builtinfunc" id="6311176">append</span><span class="op" id="6311182">(</span><span class="ident" id="6311183"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311184">.</span><span class="ident" id="6311185">delay</span><span class="op" id="6311190">,</span>&nbsp;<span class="ident" id="6311192"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311193">.</span><span class="ident" id="6311194">delayTime</span><span class="op" id="6311203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311208">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311276">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311348">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311409"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311410">.</span><span class="ident" id="6311411">delayTime</span>&nbsp;<span class="op" id="6311421">=</span>&nbsp;<span class="num" id="6311423">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311428"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311429">.</span><span class="ident" id="6311430">hasTransparentIndex</span>&nbsp;<span class="op" id="6311450">=</span>&nbsp;<span class="ident" id="6311452">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311461">case</span>&nbsp;<span class="ident" id="6311466"><a href="/image/gif/reader.go.html#6306948">sTrailer</a></span><span class="op" id="6311474">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311479">if</span>&nbsp;<span class="builtinfunc" id="6311482">len</span><span class="op" id="6311485">(</span><span class="ident" id="6311486"><a href="/image/gif/reader.go.html#6308807">d</a></span><span class="op" id="6311487">.</span><span class="ident" id="6311488">image</span><span class="op" id="6311493">)</span>&nbsp;<span class="op" id="6311495">==</span>&nbsp;<span class="num" id="6311498">0</span>&nbsp;<span class="op" id="6311500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311506">return</span>&nbsp;<span class="ident" id="6311513"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6311515">.</span><span class="ident" id="6311516">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311541">return</span>&nbsp;<span class="ident" id="6311548">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311555">default</span><span class="op" id="6311562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311567">return</span>&nbsp;<span class="ident" id="6311574"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6311577">.</span><span class="ident" id="6311578">Errorf</span><span class="op" id="6311584">(</span><span class="string" id="6311585">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6311618">,</span>&nbsp;<span class="ident" id="6311620"><a href="/image/gif/reader.go.html#6309240">c</a></span><span class="op" id="6311621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311628">}</span><br>
<span class="lineno"></span><span class="op" id="6311630">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6311633">func</span>&nbsp;<span class="op" id="6311638">(</span><span class="ident" id="6311639">d</span>&nbsp;<span class="op" id="6311641">*</span><span class="ident" id="6311642"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6311649">)</span>&nbsp;<span class="ident" id="6311651">readHeaderAndScreenDescriptor</span><span class="op" id="6311680">(</span><span class="op" id="6311681">)</span>&nbsp;<span class="builtintype" id="6311683">error</span>&nbsp;<span class="op" id="6311689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311692">_</span><span class="op" id="6311693">,</span>&nbsp;<span class="ident" id="6311695">err</span>&nbsp;<span class="op" id="6311699">:=</span>&nbsp;<span class="ident" id="6311702"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6311704">.</span><span class="ident" id="6311705">ReadFull</span><span class="op" id="6311713">(</span><span class="ident" id="6311714"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311715">.</span><span class="ident" id="6311716">r</span><span class="op" id="6311717">,</span>&nbsp;<span class="ident" id="6311719"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311720">.</span><span class="ident" id="6311721">tmp</span><span class="op" id="6311724">[</span><span class="num" id="6311725">0</span><span class="op" id="6311726">:</span><span class="num" id="6311727">13</span><span class="op" id="6311729">]</span><span class="op" id="6311730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311733">if</span>&nbsp;<span class="ident" id="6311736"><a href="/image/gif/reader.go.html#6311695">err</a></span>&nbsp;<span class="op" id="6311740">!=</span>&nbsp;<span class="ident" id="6311743">nil</span>&nbsp;<span class="op" id="6311747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311751">return</span>&nbsp;<span class="ident" id="6311758"><a href="/image/gif/reader.go.html#6311695">err</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311766"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311767">.</span><span class="ident" id="6311768">vers</span>&nbsp;<span class="op" id="6311773">=</span>&nbsp;<span class="builtintype" id="6311775">string</span><span class="op" id="6311781">(</span><span class="ident" id="6311782"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311783">.</span><span class="ident" id="6311784">tmp</span><span class="op" id="6311787">[</span><span class="num" id="6311788">0</span><span class="op" id="6311789">:</span><span class="num" id="6311790">6</span><span class="op" id="6311791">]</span><span class="op" id="6311792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311795">if</span>&nbsp;<span class="ident" id="6311798"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311799">.</span><span class="ident" id="6311800">vers</span>&nbsp;<span class="op" id="6311805">!=</span>&nbsp;<span class="string" id="6311808">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6311817">&amp;&amp;</span>&nbsp;<span class="ident" id="6311820"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311821">.</span><span class="ident" id="6311822">vers</span>&nbsp;<span class="op" id="6311827">!=</span>&nbsp;<span class="string" id="6311830">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6311839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311843">return</span>&nbsp;<span class="ident" id="6311850"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6311853">.</span><span class="ident" id="6311854">Errorf</span><span class="op" id="6311860">(</span><span class="string" id="6311861">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6311893">,</span>&nbsp;<span class="ident" id="6311895"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311896">.</span><span class="ident" id="6311897">vers</span><span class="op" id="6311901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311904">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311907"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311908">.</span><span class="ident" id="6311909">width</span>&nbsp;<span class="op" id="6311915">=</span>&nbsp;<span class="builtintype" id="6311917">int</span><span class="op" id="6311920">(</span><span class="ident" id="6311921"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311922">.</span><span class="ident" id="6311923">tmp</span><span class="op" id="6311926">[</span><span class="num" id="6311927">6</span><span class="op" id="6311928">]</span><span class="op" id="6311929">)</span>&nbsp;<span class="op" id="6311931">+</span>&nbsp;<span class="builtintype" id="6311933">int</span><span class="op" id="6311936">(</span><span class="ident" id="6311937"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311938">.</span><span class="ident" id="6311939">tmp</span><span class="op" id="6311942">[</span><span class="num" id="6311943">7</span><span class="op" id="6311944">]</span><span class="op" id="6311945">)</span><span class="op" id="6311946">&lt;&lt;</span><span class="num" id="6311948">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311951"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311952">.</span><span class="ident" id="6311953">height</span>&nbsp;<span class="op" id="6311960">=</span>&nbsp;<span class="builtintype" id="6311962">int</span><span class="op" id="6311965">(</span><span class="ident" id="6311966"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311967">.</span><span class="ident" id="6311968">tmp</span><span class="op" id="6311971">[</span><span class="num" id="6311972">8</span><span class="op" id="6311973">]</span><span class="op" id="6311974">)</span>&nbsp;<span class="op" id="6311976">+</span>&nbsp;<span class="builtintype" id="6311978">int</span><span class="op" id="6311981">(</span><span class="ident" id="6311982"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311983">.</span><span class="ident" id="6311984">tmp</span><span class="op" id="6311987">[</span><span class="num" id="6311988">9</span><span class="op" id="6311989">]</span><span class="op" id="6311990">)</span><span class="op" id="6311991">&lt;&lt;</span><span class="num" id="6311993">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311996"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6311997">.</span><span class="ident" id="6311998">headerFields</span>&nbsp;<span class="op" id="6312011">=</span>&nbsp;<span class="ident" id="6312013"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312014">.</span><span class="ident" id="6312015">tmp</span><span class="op" id="6312018">[</span><span class="num" id="6312019">10</span><span class="op" id="6312021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312024"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312025">.</span><span class="ident" id="6312026">backgroundIndex</span>&nbsp;<span class="op" id="6312042">=</span>&nbsp;<span class="ident" id="6312044"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312045">.</span><span class="ident" id="6312046">tmp</span><span class="op" id="6312049">[</span><span class="num" id="6312050">11</span><span class="op" id="6312052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312055"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312056">.</span><span class="ident" id="6312057">aspect</span>&nbsp;<span class="op" id="6312064">=</span>&nbsp;<span class="ident" id="6312066"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312067">.</span><span class="ident" id="6312068">tmp</span><span class="op" id="6312071">[</span><span class="num" id="6312072">12</span><span class="op" id="6312074">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312077"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312078">.</span><span class="ident" id="6312079">loopCount</span>&nbsp;<span class="op" id="6312089">=</span>&nbsp;<span class="op" id="6312091">-</span><span class="num" id="6312092">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312095"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312096">.</span><span class="ident" id="6312097">pixelSize</span>&nbsp;<span class="op" id="6312107">=</span>&nbsp;<span class="builtintype" id="6312109">uint</span><span class="op" id="6312113">(</span><span class="ident" id="6312114"><a href="/image/gif/reader.go.html#6311639">d</a></span><span class="op" id="6312115">.</span><span class="ident" id="6312116">headerFields</span><span class="op" id="6312128">&amp;</span><span class="num" id="6312129">7</span><span class="op" id="6312130">)</span>&nbsp;<span class="op" id="6312132">+</span>&nbsp;<span class="num" id="6312134">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312137">return</span>&nbsp;<span class="ident" id="6312144">nil</span><br>
<span class="lineno"></span><span class="op" id="6312148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6312151">func</span>&nbsp;<span class="op" id="6312156">(</span><span class="ident" id="6312157">d</span>&nbsp;<span class="op" id="6312159">*</span><span class="ident" id="6312160"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6312167">)</span>&nbsp;<span class="ident" id="6312169">readColorMap</span><span class="op" id="6312181">(</span><span class="op" id="6312182">)</span>&nbsp;<span class="op" id="6312184">(</span><span class="ident" id="6312185"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6312190">.</span><span class="ident" id="6312191">Palette</span><span class="op" id="6312198">,</span>&nbsp;<span class="builtintype" id="6312200">error</span><span class="op" id="6312205">)</span>&nbsp;<span class="op" id="6312207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312210">if</span>&nbsp;<span class="ident" id="6312213"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312214">.</span><span class="ident" id="6312215">pixelSize</span>&nbsp;<span class="op" id="6312225">&gt;</span>&nbsp;<span class="num" id="6312227">8</span>&nbsp;<span class="op" id="6312229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312233">return</span>&nbsp;<span class="ident" id="6312240">nil</span><span class="op" id="6312243">,</span>&nbsp;<span class="ident" id="6312245"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6312248">.</span><span class="ident" id="6312249">Errorf</span><span class="op" id="6312255">(</span><span class="string" id="6312256">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6312293">,</span>&nbsp;<span class="ident" id="6312295"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312296">.</span><span class="ident" id="6312297">pixelSize</span><span class="op" id="6312306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312312">numColors</span>&nbsp;<span class="op" id="6312322">:=</span>&nbsp;<span class="num" id="6312325">1</span>&nbsp;<span class="op" id="6312327">&lt;&lt;</span>&nbsp;<span class="ident" id="6312330"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312331">.</span><span class="ident" id="6312332">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312343">if</span>&nbsp;<span class="ident" id="6312346"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312347">.</span><span class="ident" id="6312348">imageFields</span><span class="op" id="6312359">&amp;</span><span class="ident" id="6312360"><a href="/image/gif/reader.go.html#6306725">ifLocalColorTable</a></span>&nbsp;<span class="op" id="6312378">!=</span>&nbsp;<span class="num" id="6312381">0</span>&nbsp;<span class="op" id="6312383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312387"><a href="/image/gif/reader.go.html#6312312">numColors</a></span>&nbsp;<span class="op" id="6312397">=</span>&nbsp;<span class="num" id="6312399">1</span>&nbsp;<span class="op" id="6312401">&lt;&lt;</span>&nbsp;<span class="op" id="6312404">(</span><span class="op" id="6312405">(</span><span class="ident" id="6312406"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312407">.</span><span class="ident" id="6312408">imageFields</span>&nbsp;<span class="op" id="6312420">&amp;</span>&nbsp;<span class="ident" id="6312422"><a href="/image/gif/reader.go.html#6306781">ifPixelSizeMask</a></span><span class="op" id="6312437">)</span>&nbsp;<span class="op" id="6312439">+</span>&nbsp;<span class="num" id="6312441">1</span><span class="op" id="6312442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312448">numValues</span>&nbsp;<span class="op" id="6312458">:=</span>&nbsp;<span class="num" id="6312461">3</span>&nbsp;<span class="op" id="6312463">*</span>&nbsp;<span class="ident" id="6312465"><a href="/image/gif/reader.go.html#6312312">numColors</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312476">_</span><span class="op" id="6312477">,</span>&nbsp;<span class="ident" id="6312479">err</span>&nbsp;<span class="op" id="6312483">:=</span>&nbsp;<span class="ident" id="6312486"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6312488">.</span><span class="ident" id="6312489">ReadFull</span><span class="op" id="6312497">(</span><span class="ident" id="6312498"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312499">.</span><span class="ident" id="6312500">r</span><span class="op" id="6312501">,</span>&nbsp;<span class="ident" id="6312503"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312504">.</span><span class="ident" id="6312505">tmp</span><span class="op" id="6312508">[</span><span class="num" id="6312509">0</span><span class="op" id="6312510">:</span><span class="ident" id="6312511"><a href="/image/gif/reader.go.html#6312448">numValues</a></span><span class="op" id="6312520">]</span><span class="op" id="6312521">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312524">if</span>&nbsp;<span class="ident" id="6312527"><a href="/image/gif/reader.go.html#6312479">err</a></span>&nbsp;<span class="op" id="6312531">!=</span>&nbsp;<span class="ident" id="6312534">nil</span>&nbsp;<span class="op" id="6312538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312542">return</span>&nbsp;<span class="ident" id="6312549">nil</span><span class="op" id="6312552">,</span>&nbsp;<span class="ident" id="6312554"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6312557">.</span><span class="ident" id="6312558">Errorf</span><span class="op" id="6312564">(</span><span class="string" id="6312565">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6312599">,</span>&nbsp;<span class="ident" id="6312601"><a href="/image/gif/reader.go.html#6312479">err</a></span><span class="op" id="6312604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312610">colorMap</span>&nbsp;<span class="op" id="6312619">:=</span>&nbsp;<span class="builtinfunc" id="6312622">make</span><span class="op" id="6312626">(</span><span class="ident" id="6312627"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6312632">.</span><span class="ident" id="6312633">Palette</span><span class="op" id="6312640">,</span>&nbsp;<span class="ident" id="6312642"><a href="/image/gif/reader.go.html#6312312">numColors</a></span><span class="op" id="6312651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312654">j</span>&nbsp;<span class="op" id="6312656">:=</span>&nbsp;<span class="num" id="6312659">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312662">for</span>&nbsp;<span class="ident" id="6312666">i</span>&nbsp;<span class="op" id="6312668">:=</span>&nbsp;<span class="keyword" id="6312671">range</span>&nbsp;<span class="ident" id="6312677"><a href="/image/gif/reader.go.html#6312610">colorMap</a></span>&nbsp;<span class="op" id="6312686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312690"><a href="/image/gif/reader.go.html#6312610">colorMap</a></span><span class="op" id="6312698">[</span><span class="ident" id="6312699"><a href="/image/gif/reader.go.html#6312666">i</a></span><span class="op" id="6312700">]</span>&nbsp;<span class="op" id="6312702">=</span>&nbsp;<span class="ident" id="6312704"><a href="/image/gif/reader.go.html#6306297">color</a></span><span class="op" id="6312709">.</span><span class="ident" id="6312710">RGBA</span><span class="op" id="6312714">{</span><span class="ident" id="6312715"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312716">.</span><span class="ident" id="6312717">tmp</span><span class="op" id="6312720">[</span><span class="ident" id="6312721"><a href="/image/gif/reader.go.html#6312654">j</a></span><span class="op" id="6312722">+</span><span class="num" id="6312723">0</span><span class="op" id="6312724">]</span><span class="op" id="6312725">,</span>&nbsp;<span class="ident" id="6312727"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312728">.</span><span class="ident" id="6312729">tmp</span><span class="op" id="6312732">[</span><span class="ident" id="6312733"><a href="/image/gif/reader.go.html#6312654">j</a></span><span class="op" id="6312734">+</span><span class="num" id="6312735">1</span><span class="op" id="6312736">]</span><span class="op" id="6312737">,</span>&nbsp;<span class="ident" id="6312739"><a href="/image/gif/reader.go.html#6312157">d</a></span><span class="op" id="6312740">.</span><span class="ident" id="6312741">tmp</span><span class="op" id="6312744">[</span><span class="ident" id="6312745"><a href="/image/gif/reader.go.html#6312654">j</a></span><span class="op" id="6312746">+</span><span class="num" id="6312747">2</span><span class="op" id="6312748">]</span><span class="op" id="6312749">,</span>&nbsp;<span class="num" id="6312751">0xFF</span><span class="op" id="6312755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312759"><a href="/image/gif/reader.go.html#6312654">j</a></span>&nbsp;<span class="op" id="6312761">+=</span>&nbsp;<span class="num" id="6312764">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312770">return</span>&nbsp;<span class="ident" id="6312777"><a href="/image/gif/reader.go.html#6312610">colorMap</a></span><span class="op" id="6312785">,</span>&nbsp;<span class="ident" id="6312787">nil</span><br>
<span class="lineno">295</span><span class="op" id="6312791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6312794">func</span>&nbsp;<span class="op" id="6312799">(</span><span class="ident" id="6312800">d</span>&nbsp;<span class="op" id="6312802">*</span><span class="ident" id="6312803"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6312810">)</span>&nbsp;<span class="ident" id="6312812">readExtension</span><span class="op" id="6312825">(</span><span class="op" id="6312826">)</span>&nbsp;<span class="builtintype" id="6312828">error</span>&nbsp;<span class="op" id="6312834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312837">extension</span><span class="op" id="6312846">,</span>&nbsp;<span class="ident" id="6312848">err</span>&nbsp;<span class="op" id="6312852">:=</span>&nbsp;<span class="ident" id="6312855"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6312856">.</span><span class="ident" id="6312857">r</span><span class="op" id="6312858">.</span><span class="ident" id="6312859">ReadByte</span><span class="op" id="6312867">(</span><span class="op" id="6312868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312871">if</span>&nbsp;<span class="ident" id="6312874"><a href="/image/gif/reader.go.html#6312848">err</a></span>&nbsp;<span class="op" id="6312878">!=</span>&nbsp;<span class="ident" id="6312881">nil</span>&nbsp;<span class="op" id="6312885">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312889">return</span>&nbsp;<span class="ident" id="6312896"><a href="/image/gif/reader.go.html#6312848">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312904">size</span>&nbsp;<span class="op" id="6312909">:=</span>&nbsp;<span class="num" id="6312912">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312915">switch</span>&nbsp;<span class="ident" id="6312922"><a href="/image/gif/reader.go.html#6312837">extension</a></span>&nbsp;<span class="op" id="6312932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312935">case</span>&nbsp;<span class="ident" id="6312940"><a href="/image/gif/reader.go.html#6306999">eText</a></span><span class="op" id="6312945">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312949"><a href="/image/gif/reader.go.html#6312904">size</a></span>&nbsp;<span class="op" id="6312954">=</span>&nbsp;<span class="num" id="6312956">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312960">case</span>&nbsp;<span class="ident" id="6312965"><a href="/image/gif/reader.go.html#6307037">eGraphicControl</a></span><span class="op" id="6312980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312984">return</span>&nbsp;<span class="ident" id="6312991"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6312992">.</span><span class="ident" id="6312993">readGraphicControl</span><span class="op" id="6313011">(</span><span class="op" id="6313012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313015">case</span>&nbsp;<span class="ident" id="6313020"><a href="/image/gif/reader.go.html#6307080">eComment</a></span><span class="op" id="6313028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313032">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313069">case</span>&nbsp;<span class="ident" id="6313074"><a href="/image/gif/reader.go.html#6307115">eApplication</a></span><span class="op" id="6313086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313090">b</span><span class="op" id="6313091">,</span>&nbsp;<span class="ident" id="6313093">err</span>&nbsp;<span class="op" id="6313097">:=</span>&nbsp;<span class="ident" id="6313100"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313101">.</span><span class="ident" id="6313102">r</span><span class="op" id="6313103">.</span><span class="ident" id="6313104">ReadByte</span><span class="op" id="6313112">(</span><span class="op" id="6313113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313117">if</span>&nbsp;<span class="ident" id="6313120"><a href="/image/gif/reader.go.html#6313093">err</a></span>&nbsp;<span class="op" id="6313124">!=</span>&nbsp;<span class="ident" id="6313127">nil</span>&nbsp;<span class="op" id="6313131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313136">return</span>&nbsp;<span class="ident" id="6313143"><a href="/image/gif/reader.go.html#6313093">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313149">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313153">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313217"><a href="/image/gif/reader.go.html#6312904">size</a></span>&nbsp;<span class="op" id="6313222">=</span>&nbsp;<span class="builtintype" id="6313224">int</span><span class="op" id="6313227">(</span><span class="ident" id="6313228"><a href="/image/gif/reader.go.html#6313090">b</a></span><span class="op" id="6313229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313232">default</span><span class="op" id="6313239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313243">return</span>&nbsp;<span class="ident" id="6313250"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6313253">.</span><span class="ident" id="6313254">Errorf</span><span class="op" id="6313260">(</span><span class="string" id="6313261">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6313292">,</span>&nbsp;<span class="ident" id="6313294"><a href="/image/gif/reader.go.html#6312837">extension</a></span><span class="op" id="6313303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313306">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313309">if</span>&nbsp;<span class="ident" id="6313312"><a href="/image/gif/reader.go.html#6312904">size</a></span>&nbsp;<span class="op" id="6313317">&gt;</span>&nbsp;<span class="num" id="6313319">0</span>&nbsp;<span class="op" id="6313321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313325">if</span>&nbsp;<span class="ident" id="6313328">_</span><span class="op" id="6313329">,</span>&nbsp;<span class="ident" id="6313331">err</span>&nbsp;<span class="op" id="6313335">:=</span>&nbsp;<span class="ident" id="6313338"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6313340">.</span><span class="ident" id="6313341">ReadFull</span><span class="op" id="6313349">(</span><span class="ident" id="6313350"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313351">.</span><span class="ident" id="6313352">r</span><span class="op" id="6313353">,</span>&nbsp;<span class="ident" id="6313355"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313356">.</span><span class="ident" id="6313357">tmp</span><span class="op" id="6313360">[</span><span class="num" id="6313361">0</span><span class="op" id="6313362">:</span><span class="ident" id="6313363"><a href="/image/gif/reader.go.html#6312904">size</a></span><span class="op" id="6313367">]</span><span class="op" id="6313368">)</span><span class="op" id="6313369">;</span>&nbsp;<span class="ident" id="6313371"><a href="/image/gif/reader.go.html#6313331">err</a></span>&nbsp;<span class="op" id="6313375">!=</span>&nbsp;<span class="ident" id="6313378">nil</span>&nbsp;<span class="op" id="6313382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313387">return</span>&nbsp;<span class="ident" id="6313394"><a href="/image/gif/reader.go.html#6313331">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313403">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313407">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313482">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313523">if</span>&nbsp;<span class="ident" id="6313526"><a href="/image/gif/reader.go.html#6312837">extension</a></span>&nbsp;<span class="op" id="6313536">==</span>&nbsp;<span class="ident" id="6313539"><a href="/image/gif/reader.go.html#6307115">eApplication</a></span>&nbsp;<span class="op" id="6313552">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6313555">string</span><span class="op" id="6313561">(</span><span class="ident" id="6313562"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313563">.</span><span class="ident" id="6313564">tmp</span><span class="op" id="6313567">[</span><span class="op" id="6313568">:</span><span class="ident" id="6313569"><a href="/image/gif/reader.go.html#6312904">size</a></span><span class="op" id="6313573">]</span><span class="op" id="6313574">)</span>&nbsp;<span class="op" id="6313576">==</span>&nbsp;<span class="string" id="6313579">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6313593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313597">n</span><span class="op" id="6313598">,</span>&nbsp;<span class="ident" id="6313600">err</span>&nbsp;<span class="op" id="6313604">:=</span>&nbsp;<span class="ident" id="6313607"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313608">.</span><span class="ident" id="6313609">readBlock</span><span class="op" id="6313618">(</span><span class="op" id="6313619">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313623">if</span>&nbsp;<span class="ident" id="6313626"><a href="/image/gif/reader.go.html#6313597">n</a></span>&nbsp;<span class="op" id="6313628">==</span>&nbsp;<span class="num" id="6313631">0</span>&nbsp;<span class="op" id="6313633">||</span>&nbsp;<span class="ident" id="6313636"><a href="/image/gif/reader.go.html#6313600">err</a></span>&nbsp;<span class="op" id="6313640">!=</span>&nbsp;<span class="ident" id="6313643">nil</span>&nbsp;<span class="op" id="6313647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313652">return</span>&nbsp;<span class="ident" id="6313659"><a href="/image/gif/reader.go.html#6313600">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313669">if</span>&nbsp;<span class="ident" id="6313672"><a href="/image/gif/reader.go.html#6313597">n</a></span>&nbsp;<span class="op" id="6313674">==</span>&nbsp;<span class="num" id="6313677">3</span>&nbsp;<span class="op" id="6313679">&amp;&amp;</span>&nbsp;<span class="ident" id="6313682"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313683">.</span><span class="ident" id="6313684">tmp</span><span class="op" id="6313687">[</span><span class="num" id="6313688">0</span><span class="op" id="6313689">]</span>&nbsp;<span class="op" id="6313691">==</span>&nbsp;<span class="num" id="6313694">1</span>&nbsp;<span class="op" id="6313696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313701"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313702">.</span><span class="ident" id="6313703">loopCount</span>&nbsp;<span class="op" id="6313713">=</span>&nbsp;<span class="builtintype" id="6313715">int</span><span class="op" id="6313718">(</span><span class="ident" id="6313719"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313720">.</span><span class="ident" id="6313721">tmp</span><span class="op" id="6313724">[</span><span class="num" id="6313725">1</span><span class="op" id="6313726">]</span><span class="op" id="6313727">)</span>&nbsp;<span class="op" id="6313729">|</span>&nbsp;<span class="builtintype" id="6313731">int</span><span class="op" id="6313734">(</span><span class="ident" id="6313735"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313736">.</span><span class="ident" id="6313737">tmp</span><span class="op" id="6313740">[</span><span class="num" id="6313741">2</span><span class="op" id="6313742">]</span><span class="op" id="6313743">)</span><span class="op" id="6313744">&lt;&lt;</span><span class="num" id="6313746">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313756">for</span>&nbsp;<span class="op" id="6313760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313764">n</span><span class="op" id="6313765">,</span>&nbsp;<span class="ident" id="6313767">err</span>&nbsp;<span class="op" id="6313771">:=</span>&nbsp;<span class="ident" id="6313774"><a href="/image/gif/reader.go.html#6312800">d</a></span><span class="op" id="6313775">.</span><span class="ident" id="6313776">readBlock</span><span class="op" id="6313785">(</span><span class="op" id="6313786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313790">if</span>&nbsp;<span class="ident" id="6313793"><a href="/image/gif/reader.go.html#6313764">n</a></span>&nbsp;<span class="op" id="6313795">==</span>&nbsp;<span class="num" id="6313798">0</span>&nbsp;<span class="op" id="6313800">||</span>&nbsp;<span class="ident" id="6313803"><a href="/image/gif/reader.go.html#6313767">err</a></span>&nbsp;<span class="op" id="6313807">!=</span>&nbsp;<span class="ident" id="6313810">nil</span>&nbsp;<span class="op" id="6313814">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313819">return</span>&nbsp;<span class="ident" id="6313826"><a href="/image/gif/reader.go.html#6313767">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313835">}</span><br>
<span class="lineno"></span><span class="op" id="6313837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6313840">func</span>&nbsp;<span class="op" id="6313845">(</span><span class="ident" id="6313846">d</span>&nbsp;<span class="op" id="6313848">*</span><span class="ident" id="6313849"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6313856">)</span>&nbsp;<span class="ident" id="6313858">readGraphicControl</span><span class="op" id="6313876">(</span><span class="op" id="6313877">)</span>&nbsp;<span class="builtintype" id="6313879">error</span>&nbsp;<span class="op" id="6313885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313888">if</span>&nbsp;<span class="ident" id="6313891">_</span><span class="op" id="6313892">,</span>&nbsp;<span class="ident" id="6313894">err</span>&nbsp;<span class="op" id="6313898">:=</span>&nbsp;<span class="ident" id="6313901"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6313903">.</span><span class="ident" id="6313904">ReadFull</span><span class="op" id="6313912">(</span><span class="ident" id="6313913"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6313914">.</span><span class="ident" id="6313915">r</span><span class="op" id="6313916">,</span>&nbsp;<span class="ident" id="6313918"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6313919">.</span><span class="ident" id="6313920">tmp</span><span class="op" id="6313923">[</span><span class="num" id="6313924">0</span><span class="op" id="6313925">:</span><span class="num" id="6313926">6</span><span class="op" id="6313927">]</span><span class="op" id="6313928">)</span><span class="op" id="6313929">;</span>&nbsp;<span class="ident" id="6313931"><a href="/image/gif/reader.go.html#6313894">err</a></span>&nbsp;<span class="op" id="6313935">!=</span>&nbsp;<span class="ident" id="6313938">nil</span>&nbsp;<span class="op" id="6313942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313946">return</span>&nbsp;<span class="ident" id="6313953"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6313956">.</span><span class="ident" id="6313957">Errorf</span><span class="op" id="6313963">(</span><span class="string" id="6313964">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6314001">,</span>&nbsp;<span class="ident" id="6314003"><a href="/image/gif/reader.go.html#6313894">err</a></span><span class="op" id="6314006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314012"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314013">.</span><span class="ident" id="6314014">flags</span>&nbsp;<span class="op" id="6314020">=</span>&nbsp;<span class="ident" id="6314022"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314023">.</span><span class="ident" id="6314024">tmp</span><span class="op" id="6314027">[</span><span class="num" id="6314028">1</span><span class="op" id="6314029">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314032"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314033">.</span><span class="ident" id="6314034">delayTime</span>&nbsp;<span class="op" id="6314044">=</span>&nbsp;<span class="builtintype" id="6314046">int</span><span class="op" id="6314049">(</span><span class="ident" id="6314050"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314051">.</span><span class="ident" id="6314052">tmp</span><span class="op" id="6314055">[</span><span class="num" id="6314056">2</span><span class="op" id="6314057">]</span><span class="op" id="6314058">)</span>&nbsp;<span class="op" id="6314060">|</span>&nbsp;<span class="builtintype" id="6314062">int</span><span class="op" id="6314065">(</span><span class="ident" id="6314066"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314067">.</span><span class="ident" id="6314068">tmp</span><span class="op" id="6314071">[</span><span class="num" id="6314072">3</span><span class="op" id="6314073">]</span><span class="op" id="6314074">)</span><span class="op" id="6314075">&lt;&lt;</span><span class="num" id="6314077">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314080">if</span>&nbsp;<span class="ident" id="6314083"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314084">.</span><span class="ident" id="6314085">flags</span><span class="op" id="6314090">&amp;</span><span class="ident" id="6314091"><a href="/image/gif/reader.go.html#6306832">gcTransparentColorSet</a></span>&nbsp;<span class="op" id="6314113">!=</span>&nbsp;<span class="num" id="6314116">0</span>&nbsp;<span class="op" id="6314118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314122"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314123">.</span><span class="ident" id="6314124">transparentIndex</span>&nbsp;<span class="op" id="6314141">=</span>&nbsp;<span class="ident" id="6314143"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314144">.</span><span class="ident" id="6314145">tmp</span><span class="op" id="6314148">[</span><span class="num" id="6314149">4</span><span class="op" id="6314150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314154"><a href="/image/gif/reader.go.html#6313846">d</a></span><span class="op" id="6314155">.</span><span class="ident" id="6314156">hasTransparentIndex</span>&nbsp;<span class="op" id="6314176">=</span>&nbsp;<span class="ident" id="6314178">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314184">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314187">return</span>&nbsp;<span class="ident" id="6314194">nil</span><br>
<span class="lineno"></span><span class="op" id="6314198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6314201">func</span>&nbsp;<span class="op" id="6314206">(</span><span class="ident" id="6314207">d</span>&nbsp;<span class="op" id="6314209">*</span><span class="ident" id="6314210"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6314217">)</span>&nbsp;<span class="ident" id="6314219">newImageFromDescriptor</span><span class="op" id="6314241">(</span><span class="op" id="6314242">)</span>&nbsp;<span class="op" id="6314244">(</span><span class="op" id="6314245">*</span><span class="ident" id="6314246"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6314251">.</span><span class="ident" id="6314252">Paletted</span><span class="op" id="6314260">,</span>&nbsp;<span class="builtintype" id="6314262">error</span><span class="op" id="6314267">)</span>&nbsp;<span class="op" id="6314269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314272">if</span>&nbsp;<span class="ident" id="6314275">_</span><span class="op" id="6314276">,</span>&nbsp;<span class="ident" id="6314278">err</span>&nbsp;<span class="op" id="6314282">:=</span>&nbsp;<span class="ident" id="6314285"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6314287">.</span><span class="ident" id="6314288">ReadFull</span><span class="op" id="6314296">(</span><span class="ident" id="6314297"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314298">.</span><span class="ident" id="6314299">r</span><span class="op" id="6314300">,</span>&nbsp;<span class="ident" id="6314302"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314303">.</span><span class="ident" id="6314304">tmp</span><span class="op" id="6314307">[</span><span class="num" id="6314308">0</span><span class="op" id="6314309">:</span><span class="num" id="6314310">9</span><span class="op" id="6314311">]</span><span class="op" id="6314312">)</span><span class="op" id="6314313">;</span>&nbsp;<span class="ident" id="6314315"><a href="/image/gif/reader.go.html#6314278">err</a></span>&nbsp;<span class="op" id="6314319">!=</span>&nbsp;<span class="ident" id="6314322">nil</span>&nbsp;<span class="op" id="6314326">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314330">return</span>&nbsp;<span class="ident" id="6314337">nil</span><span class="op" id="6314340">,</span>&nbsp;<span class="ident" id="6314342"><a href="/image/gif/reader.go.html#6306281">fmt</a></span><span class="op" id="6314345">.</span><span class="ident" id="6314346">Errorf</span><span class="op" id="6314352">(</span><span class="string" id="6314353">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6314391">,</span>&nbsp;<span class="ident" id="6314393"><a href="/image/gif/reader.go.html#6314278">err</a></span><span class="op" id="6314396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314402">left</span>&nbsp;<span class="op" id="6314407">:=</span>&nbsp;<span class="builtintype" id="6314410">int</span><span class="op" id="6314413">(</span><span class="ident" id="6314414"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314415">.</span><span class="ident" id="6314416">tmp</span><span class="op" id="6314419">[</span><span class="num" id="6314420">0</span><span class="op" id="6314421">]</span><span class="op" id="6314422">)</span>&nbsp;<span class="op" id="6314424">+</span>&nbsp;<span class="builtintype" id="6314426">int</span><span class="op" id="6314429">(</span><span class="ident" id="6314430"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314431">.</span><span class="ident" id="6314432">tmp</span><span class="op" id="6314435">[</span><span class="num" id="6314436">1</span><span class="op" id="6314437">]</span><span class="op" id="6314438">)</span><span class="op" id="6314439">&lt;&lt;</span><span class="num" id="6314441">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314444">top</span>&nbsp;<span class="op" id="6314448">:=</span>&nbsp;<span class="builtintype" id="6314451">int</span><span class="op" id="6314454">(</span><span class="ident" id="6314455"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314456">.</span><span class="ident" id="6314457">tmp</span><span class="op" id="6314460">[</span><span class="num" id="6314461">2</span><span class="op" id="6314462">]</span><span class="op" id="6314463">)</span>&nbsp;<span class="op" id="6314465">+</span>&nbsp;<span class="builtintype" id="6314467">int</span><span class="op" id="6314470">(</span><span class="ident" id="6314471"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314472">.</span><span class="ident" id="6314473">tmp</span><span class="op" id="6314476">[</span><span class="num" id="6314477">3</span><span class="op" id="6314478">]</span><span class="op" id="6314479">)</span><span class="op" id="6314480">&lt;&lt;</span><span class="num" id="6314482">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314485">width</span>&nbsp;<span class="op" id="6314491">:=</span>&nbsp;<span class="builtintype" id="6314494">int</span><span class="op" id="6314497">(</span><span class="ident" id="6314498"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314499">.</span><span class="ident" id="6314500">tmp</span><span class="op" id="6314503">[</span><span class="num" id="6314504">4</span><span class="op" id="6314505">]</span><span class="op" id="6314506">)</span>&nbsp;<span class="op" id="6314508">+</span>&nbsp;<span class="builtintype" id="6314510">int</span><span class="op" id="6314513">(</span><span class="ident" id="6314514"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314515">.</span><span class="ident" id="6314516">tmp</span><span class="op" id="6314519">[</span><span class="num" id="6314520">5</span><span class="op" id="6314521">]</span><span class="op" id="6314522">)</span><span class="op" id="6314523">&lt;&lt;</span><span class="num" id="6314525">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314528">height</span>&nbsp;<span class="op" id="6314535">:=</span>&nbsp;<span class="builtintype" id="6314538">int</span><span class="op" id="6314541">(</span><span class="ident" id="6314542"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314543">.</span><span class="ident" id="6314544">tmp</span><span class="op" id="6314547">[</span><span class="num" id="6314548">6</span><span class="op" id="6314549">]</span><span class="op" id="6314550">)</span>&nbsp;<span class="op" id="6314552">+</span>&nbsp;<span class="builtintype" id="6314554">int</span><span class="op" id="6314557">(</span><span class="ident" id="6314558"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314559">.</span><span class="ident" id="6314560">tmp</span><span class="op" id="6314563">[</span><span class="num" id="6314564">7</span><span class="op" id="6314565">]</span><span class="op" id="6314566">)</span><span class="op" id="6314567">&lt;&lt;</span><span class="num" id="6314569">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314572"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314573">.</span><span class="ident" id="6314574">imageFields</span>&nbsp;<span class="op" id="6314586">=</span>&nbsp;<span class="ident" id="6314588"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314589">.</span><span class="ident" id="6314590">tmp</span><span class="op" id="6314593">[</span><span class="num" id="6314594">8</span><span class="op" id="6314595">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6314599">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6314656">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6314718">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314776">bounds</span>&nbsp;<span class="op" id="6314783">:=</span>&nbsp;<span class="ident" id="6314786"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6314791">.</span><span class="ident" id="6314792">Rect</span><span class="op" id="6314796">(</span><span class="ident" id="6314797"><a href="/image/gif/reader.go.html#6314402">left</a></span><span class="op" id="6314801">,</span>&nbsp;<span class="ident" id="6314803"><a href="/image/gif/reader.go.html#6314444">top</a></span><span class="op" id="6314806">,</span>&nbsp;<span class="ident" id="6314808"><a href="/image/gif/reader.go.html#6314402">left</a></span><span class="op" id="6314812">+</span><span class="ident" id="6314813"><a href="/image/gif/reader.go.html#6314485">width</a></span><span class="op" id="6314818">,</span>&nbsp;<span class="ident" id="6314820"><a href="/image/gif/reader.go.html#6314444">top</a></span><span class="op" id="6314823">+</span><span class="ident" id="6314824"><a href="/image/gif/reader.go.html#6314528">height</a></span><span class="op" id="6314830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314833">if</span>&nbsp;<span class="ident" id="6314836"><a href="/image/gif/reader.go.html#6314776">bounds</a></span>&nbsp;<span class="op" id="6314843">!=</span>&nbsp;<span class="ident" id="6314846"><a href="/image/gif/reader.go.html#6314776">bounds</a></span><span class="op" id="6314852">.</span><span class="ident" id="6314853">Intersect</span><span class="op" id="6314862">(</span><span class="ident" id="6314863"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6314868">.</span><span class="ident" id="6314869">Rect</span><span class="op" id="6314873">(</span><span class="num" id="6314874">0</span><span class="op" id="6314875">,</span>&nbsp;<span class="num" id="6314877">0</span><span class="op" id="6314878">,</span>&nbsp;<span class="ident" id="6314880"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314881">.</span><span class="ident" id="6314882">width</span><span class="op" id="6314887">,</span>&nbsp;<span class="ident" id="6314889"><a href="/image/gif/reader.go.html#6314207">d</a></span><span class="op" id="6314890">.</span><span class="ident" id="6314891">height</span><span class="op" id="6314897">)</span><span class="op" id="6314898">)</span>&nbsp;<span class="op" id="6314900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314904">return</span>&nbsp;<span class="ident" id="6314911">nil</span><span class="op" id="6314914">,</span>&nbsp;<span class="ident" id="6314916"><a href="/image/gif/reader.go.html#6306271">errors</a></span><span class="op" id="6314922">.</span><span class="ident" id="6314923">New</span><span class="op" id="6314926">(</span><span class="string" id="6314927">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6314971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314974">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314977">return</span>&nbsp;<span class="ident" id="6314984"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6314989">.</span><span class="ident" id="6314990">NewPaletted</span><span class="op" id="6315001">(</span><span class="ident" id="6315002"><a href="/image/gif/reader.go.html#6314776">bounds</a></span><span class="op" id="6315008">,</span>&nbsp;<span class="ident" id="6315010">nil</span><span class="op" id="6315013">)</span><span class="op" id="6315014">,</span>&nbsp;<span class="ident" id="6315016">nil</span><br>
<span class="lineno"></span><span class="op" id="6315020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6315023">func</span>&nbsp;<span class="op" id="6315028">(</span><span class="ident" id="6315029">d</span>&nbsp;<span class="op" id="6315031">*</span><span class="ident" id="6315032"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><span class="op" id="6315039">)</span>&nbsp;<span class="ident" id="6315041">readBlock</span><span class="op" id="6315050">(</span><span class="op" id="6315051">)</span>&nbsp;<span class="op" id="6315053">(</span><span class="builtintype" id="6315054">int</span><span class="op" id="6315057">,</span>&nbsp;<span class="builtintype" id="6315059">error</span><span class="op" id="6315064">)</span>&nbsp;<span class="op" id="6315066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315069">n</span><span class="op" id="6315070">,</span>&nbsp;<span class="ident" id="6315072">err</span>&nbsp;<span class="op" id="6315076">:=</span>&nbsp;<span class="ident" id="6315079"><a href="/image/gif/reader.go.html#6315029">d</a></span><span class="op" id="6315080">.</span><span class="ident" id="6315081">r</span><span class="op" id="6315082">.</span><span class="ident" id="6315083">ReadByte</span><span class="op" id="6315091">(</span><span class="op" id="6315092">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315095">if</span>&nbsp;<span class="ident" id="6315098"><a href="/image/gif/reader.go.html#6315069">n</a></span>&nbsp;<span class="op" id="6315100">==</span>&nbsp;<span class="num" id="6315103">0</span>&nbsp;<span class="op" id="6315105">||</span>&nbsp;<span class="ident" id="6315108"><a href="/image/gif/reader.go.html#6315072">err</a></span>&nbsp;<span class="op" id="6315112">!=</span>&nbsp;<span class="ident" id="6315115">nil</span>&nbsp;<span class="op" id="6315119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315123">return</span>&nbsp;<span class="num" id="6315130">0</span><span class="op" id="6315131">,</span>&nbsp;<span class="ident" id="6315133"><a href="/image/gif/reader.go.html#6315072">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315141">return</span>&nbsp;<span class="ident" id="6315148"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6315150">.</span><span class="ident" id="6315151">ReadFull</span><span class="op" id="6315159">(</span><span class="ident" id="6315160"><a href="/image/gif/reader.go.html#6315029">d</a></span><span class="op" id="6315161">.</span><span class="ident" id="6315162">r</span><span class="op" id="6315163">,</span>&nbsp;<span class="ident" id="6315165"><a href="/image/gif/reader.go.html#6315029">d</a></span><span class="op" id="6315166">.</span><span class="ident" id="6315167">tmp</span><span class="op" id="6315170">[</span><span class="num" id="6315171">0</span><span class="op" id="6315172">:</span><span class="ident" id="6315173"><a href="/image/gif/reader.go.html#6315069">n</a></span><span class="op" id="6315174">]</span><span class="op" id="6315175">)</span><br>
<span class="lineno"></span><span class="op" id="6315177">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6315180">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6315257">type</span>&nbsp;<span class="ident" id="6315262">interlaceScan</span>&nbsp;<span class="keyword" id="6315276">struct</span>&nbsp;<span class="op" id="6315283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315286">skip</span><span class="op" id="6315290">,</span>&nbsp;<span class="ident" id="6315292">start</span>&nbsp;<span class="builtintype" id="6315298">int</span><br>
<span class="lineno"></span><span class="op" id="6315302">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6315305">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6315376">var</span>&nbsp;<span class="ident" id="6315380">interlacing</span>&nbsp;<span class="op" id="6315392">=</span>&nbsp;<span class="op" id="6315394">[</span><span class="op" id="6315395">]</span><span class="ident" id="6315396"><a href="/image/gif/reader.go.html#6315262">interlaceScan</a></span><span class="op" id="6315409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315412">{</span><span class="num" id="6315413">8</span><span class="op" id="6315414">,</span>&nbsp;<span class="num" id="6315416">0</span><span class="op" id="6315417">}</span><span class="op" id="6315418">,</span>&nbsp;<span class="comment" id="6315420">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315471">{</span><span class="num" id="6315472">8</span><span class="op" id="6315473">,</span>&nbsp;<span class="num" id="6315475">4</span><span class="op" id="6315476">}</span><span class="op" id="6315477">,</span>&nbsp;<span class="comment" id="6315479">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315530">{</span><span class="num" id="6315531">4</span><span class="op" id="6315532">,</span>&nbsp;<span class="num" id="6315534">2</span><span class="op" id="6315535">}</span><span class="op" id="6315536">,</span>&nbsp;<span class="comment" id="6315538">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315589">{</span><span class="num" id="6315590">2</span><span class="op" id="6315591">,</span>&nbsp;<span class="num" id="6315593">1</span><span class="op" id="6315594">}</span><span class="op" id="6315595">,</span>&nbsp;<span class="comment" id="6315597">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6315647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6315650">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6315725">func</span>&nbsp;<span class="ident" id="6315730">uninterlace</span><span class="op" id="6315741">(</span><span class="ident" id="6315742">m</span>&nbsp;<span class="op" id="6315744">*</span><span class="ident" id="6315745"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6315750">.</span><span class="ident" id="6315751">Paletted</span><span class="op" id="6315759">)</span>&nbsp;<span class="op" id="6315761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315764">var</span>&nbsp;<span class="ident" id="6315768">nPix</span>&nbsp;<span class="op" id="6315773">[</span><span class="op" id="6315774">]</span><span class="builtintype" id="6315775">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315782">dx</span>&nbsp;<span class="op" id="6315785">:=</span>&nbsp;<span class="ident" id="6315788"><a href="/image/gif/reader.go.html#6315742">m</a></span><span class="op" id="6315789">.</span><span class="ident" id="6315790">Bounds</span><span class="op" id="6315796">(</span><span class="op" id="6315797">)</span><span class="op" id="6315798">.</span><span class="ident" id="6315799">Dx</span><span class="op" id="6315801">(</span><span class="op" id="6315802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315805">dy</span>&nbsp;<span class="op" id="6315808">:=</span>&nbsp;<span class="ident" id="6315811"><a href="/image/gif/reader.go.html#6315742">m</a></span><span class="op" id="6315812">.</span><span class="ident" id="6315813">Bounds</span><span class="op" id="6315819">(</span><span class="op" id="6315820">)</span><span class="op" id="6315821">.</span><span class="ident" id="6315822">Dy</span><span class="op" id="6315824">(</span><span class="op" id="6315825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315828"><a href="/image/gif/reader.go.html#6315768">nPix</a></span>&nbsp;<span class="op" id="6315833">=</span>&nbsp;<span class="builtinfunc" id="6315835">make</span><span class="op" id="6315839">(</span><span class="op" id="6315840">[</span><span class="op" id="6315841">]</span><span class="builtintype" id="6315842">uint8</span><span class="op" id="6315847">,</span>&nbsp;<span class="ident" id="6315849"><a href="/image/gif/reader.go.html#6315782">dx</a></span><span class="op" id="6315851">*</span><span class="ident" id="6315852"><a href="/image/gif/reader.go.html#6315805">dy</a></span><span class="op" id="6315854">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315857">offset</span>&nbsp;<span class="op" id="6315864">:=</span>&nbsp;<span class="num" id="6315867">0</span>&nbsp;<span class="comment" id="6315869">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315923">for</span>&nbsp;<span class="ident" id="6315927">_</span><span class="op" id="6315928">,</span>&nbsp;<span class="ident" id="6315930">pass</span>&nbsp;<span class="op" id="6315935">:=</span>&nbsp;<span class="keyword" id="6315938">range</span>&nbsp;<span class="ident" id="6315944"><a href="/image/gif/reader.go.html#6315380">interlacing</a></span>&nbsp;<span class="op" id="6315956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315960">nOffset</span>&nbsp;<span class="op" id="6315968">:=</span>&nbsp;<span class="ident" id="6315971"><a href="/image/gif/reader.go.html#6315930">pass</a></span><span class="op" id="6315975">.</span><span class="ident" id="6315976">start</span>&nbsp;<span class="op" id="6315982">*</span>&nbsp;<span class="ident" id="6315984"><a href="/image/gif/reader.go.html#6315782">dx</a></span>&nbsp;<span class="comment" id="6315987">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316037">for</span>&nbsp;<span class="ident" id="6316041">y</span>&nbsp;<span class="op" id="6316043">:=</span>&nbsp;<span class="ident" id="6316046"><a href="/image/gif/reader.go.html#6315930">pass</a></span><span class="op" id="6316050">.</span><span class="ident" id="6316051">start</span><span class="op" id="6316056">;</span>&nbsp;<span class="ident" id="6316058"><a href="/image/gif/reader.go.html#6316041">y</a></span>&nbsp;<span class="op" id="6316060">&lt;</span>&nbsp;<span class="ident" id="6316062"><a href="/image/gif/reader.go.html#6315805">dy</a></span><span class="op" id="6316064">;</span>&nbsp;<span class="ident" id="6316066"><a href="/image/gif/reader.go.html#6316041">y</a></span>&nbsp;<span class="op" id="6316068">+=</span>&nbsp;<span class="ident" id="6316071"><a href="/image/gif/reader.go.html#6315930">pass</a></span><span class="op" id="6316075">.</span><span class="ident" id="6316076">skip</span>&nbsp;<span class="op" id="6316081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6316086">copy</span><span class="op" id="6316090">(</span><span class="ident" id="6316091"><a href="/image/gif/reader.go.html#6315768">nPix</a></span><span class="op" id="6316095">[</span><span class="ident" id="6316096"><a href="/image/gif/reader.go.html#6315960">nOffset</a></span><span class="op" id="6316103">:</span><span class="ident" id="6316104"><a href="/image/gif/reader.go.html#6315960">nOffset</a></span><span class="op" id="6316111">+</span><span class="ident" id="6316112"><a href="/image/gif/reader.go.html#6315782">dx</a></span><span class="op" id="6316114">]</span><span class="op" id="6316115">,</span>&nbsp;<span class="ident" id="6316117"><a href="/image/gif/reader.go.html#6315742">m</a></span><span class="op" id="6316118">.</span><span class="ident" id="6316119">Pix</span><span class="op" id="6316122">[</span><span class="ident" id="6316123"><a href="/image/gif/reader.go.html#6315857">offset</a></span><span class="op" id="6316129">:</span><span class="ident" id="6316130"><a href="/image/gif/reader.go.html#6315857">offset</a></span><span class="op" id="6316136">+</span><span class="ident" id="6316137"><a href="/image/gif/reader.go.html#6315782">dx</a></span><span class="op" id="6316139">]</span><span class="op" id="6316140">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316145"><a href="/image/gif/reader.go.html#6315857">offset</a></span>&nbsp;<span class="op" id="6316152">+=</span>&nbsp;<span class="ident" id="6316155"><a href="/image/gif/reader.go.html#6315782">dx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316161"><a href="/image/gif/reader.go.html#6315960">nOffset</a></span>&nbsp;<span class="op" id="6316169">+=</span>&nbsp;<span class="ident" id="6316172"><a href="/image/gif/reader.go.html#6315782">dx</a></span>&nbsp;<span class="op" id="6316175">*</span>&nbsp;<span class="ident" id="6316177"><a href="/image/gif/reader.go.html#6315930">pass</a></span><span class="op" id="6316181">.</span><span class="ident" id="6316182">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316195"><a href="/image/gif/reader.go.html#6315742">m</a></span><span class="op" id="6316196">.</span><span class="ident" id="6316197">Pix</span>&nbsp;<span class="op" id="6316201">=</span>&nbsp;<span class="ident" id="6316203"><a href="/image/gif/reader.go.html#6315768">nPix</a></span><br>
<span class="lineno">415</span><span class="op" id="6316208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316211">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6316277">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6316305">func</span>&nbsp;<span class="ident" id="6316310">Decode</span><span class="op" id="6316316">(</span><span class="ident" id="6316317">r</span>&nbsp;<span class="ident" id="6316319"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6316321">.</span><span class="ident" id="6316322">Reader</span><span class="op" id="6316328">)</span>&nbsp;<span class="op" id="6316330">(</span><span class="ident" id="6316331"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6316336">.</span><span class="ident" id="6316337">Image</span><span class="op" id="6316342">,</span>&nbsp;<span class="builtintype" id="6316344">error</span><span class="op" id="6316349">)</span>&nbsp;<span class="op" id="6316351">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316354">var</span>&nbsp;<span class="ident" id="6316358">d</span>&nbsp;<span class="ident" id="6316360"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316369">if</span>&nbsp;<span class="ident" id="6316372">err</span>&nbsp;<span class="op" id="6316376">:=</span>&nbsp;<span class="ident" id="6316379"><a href="/image/gif/reader.go.html#6316358">d</a></span><span class="op" id="6316380">.</span><span class="ident" id="6316381">decode</span><span class="op" id="6316387">(</span><span class="ident" id="6316388"><a href="/image/gif/reader.go.html#6316317">r</a></span><span class="op" id="6316389">,</span>&nbsp;<span class="ident" id="6316391">false</span><span class="op" id="6316396">)</span><span class="op" id="6316397">;</span>&nbsp;<span class="ident" id="6316399"><a href="/image/gif/reader.go.html#6316372">err</a></span>&nbsp;<span class="op" id="6316403">!=</span>&nbsp;<span class="ident" id="6316406">nil</span>&nbsp;<span class="op" id="6316410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316414">return</span>&nbsp;<span class="ident" id="6316421">nil</span><span class="op" id="6316424">,</span>&nbsp;<span class="ident" id="6316426"><a href="/image/gif/reader.go.html#6316372">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316434">return</span>&nbsp;<span class="ident" id="6316441"><a href="/image/gif/reader.go.html#6316358">d</a></span><span class="op" id="6316442">.</span><span class="ident" id="6316443">image</span><span class="op" id="6316448">[</span><span class="num" id="6316449">0</span><span class="op" id="6316450">]</span><span class="op" id="6316451">,</span>&nbsp;<span class="ident" id="6316453">nil</span><br>
<span class="lineno">425</span><span class="op" id="6316457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316460">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6316529">type</span>&nbsp;<span class="ident" id="6316534">GIF</span>&nbsp;<span class="keyword" id="6316538">struct</span>&nbsp;<span class="op" id="6316545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316548">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316558">[</span><span class="op" id="6316559">]</span><span class="op" id="6316560">*</span><span class="ident" id="6316561"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6316566">.</span><span class="ident" id="6316567">Paletted</span>&nbsp;<span class="comment" id="6316576">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316603">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316613">[</span><span class="op" id="6316614">]</span><span class="builtintype" id="6316615">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316631">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316701">LoopCount</span>&nbsp;<span class="builtintype" id="6316711">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316729">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6316748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316751">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6316823">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6316850">func</span>&nbsp;<span class="ident" id="6316855">DecodeAll</span><span class="op" id="6316864">(</span><span class="ident" id="6316865">r</span>&nbsp;<span class="ident" id="6316867"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6316869">.</span><span class="ident" id="6316870">Reader</span><span class="op" id="6316876">)</span>&nbsp;<span class="op" id="6316878">(</span><span class="op" id="6316879">*</span><span class="ident" id="6316880"><a href="/image/gif/reader.go.html#6316534">GIF</a></span><span class="op" id="6316883">,</span>&nbsp;<span class="builtintype" id="6316885">error</span><span class="op" id="6316890">)</span>&nbsp;<span class="op" id="6316892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316895">var</span>&nbsp;<span class="ident" id="6316899">d</span>&nbsp;<span class="ident" id="6316901"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316910">if</span>&nbsp;<span class="ident" id="6316913">err</span>&nbsp;<span class="op" id="6316917">:=</span>&nbsp;<span class="ident" id="6316920"><a href="/image/gif/reader.go.html#6316899">d</a></span><span class="op" id="6316921">.</span><span class="ident" id="6316922">decode</span><span class="op" id="6316928">(</span><span class="ident" id="6316929"><a href="/image/gif/reader.go.html#6316865">r</a></span><span class="op" id="6316930">,</span>&nbsp;<span class="ident" id="6316932">false</span><span class="op" id="6316937">)</span><span class="op" id="6316938">;</span>&nbsp;<span class="ident" id="6316940"><a href="/image/gif/reader.go.html#6316913">err</a></span>&nbsp;<span class="op" id="6316944">!=</span>&nbsp;<span class="ident" id="6316947">nil</span>&nbsp;<span class="op" id="6316951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316955">return</span>&nbsp;<span class="ident" id="6316962">nil</span><span class="op" id="6316965">,</span>&nbsp;<span class="ident" id="6316967"><a href="/image/gif/reader.go.html#6316913">err</a></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316975">gif</span>&nbsp;<span class="op" id="6316979">:=</span>&nbsp;<span class="op" id="6316982">&amp;</span><span class="ident" id="6316983"><a href="/image/gif/reader.go.html#6316534">GIF</a></span><span class="op" id="6316986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316990">Image</span><span class="op" id="6316995">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317001"><a href="/image/gif/reader.go.html#6316899">d</a></span><span class="op" id="6317002">.</span><span class="ident" id="6317003">image</span><span class="op" id="6317008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317012">LoopCount</span><span class="op" id="6317021">:</span>&nbsp;<span class="ident" id="6317023"><a href="/image/gif/reader.go.html#6316899">d</a></span><span class="op" id="6317024">.</span><span class="ident" id="6317025">loopCount</span><span class="op" id="6317034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317038">Delay</span><span class="op" id="6317043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317049"><a href="/image/gif/reader.go.html#6316899">d</a></span><span class="op" id="6317050">.</span><span class="ident" id="6317051">delay</span><span class="op" id="6317056">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317062">return</span>&nbsp;<span class="ident" id="6317069"><a href="/image/gif/reader.go.html#6316975">gif</a></span><span class="op" id="6317072">,</span>&nbsp;<span class="ident" id="6317074">nil</span><br>
<span class="lineno"></span><span class="op" id="6317078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317081">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6317158">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6317196">func</span>&nbsp;<span class="ident" id="6317201">DecodeConfig</span><span class="op" id="6317213">(</span><span class="ident" id="6317214">r</span>&nbsp;<span class="ident" id="6317216"><a href="/image/gif/reader.go.html#6306312">io</a></span><span class="op" id="6317218">.</span><span class="ident" id="6317219">Reader</span><span class="op" id="6317225">)</span>&nbsp;<span class="op" id="6317227">(</span><span class="ident" id="6317228"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6317233">.</span><span class="ident" id="6317234">Config</span><span class="op" id="6317240">,</span>&nbsp;<span class="builtintype" id="6317242">error</span><span class="op" id="6317247">)</span>&nbsp;<span class="op" id="6317249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317252">var</span>&nbsp;<span class="ident" id="6317256">d</span>&nbsp;<span class="ident" id="6317258"><a href="/image/gif/reader.go.html#6307211">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317267">if</span>&nbsp;<span class="ident" id="6317270">err</span>&nbsp;<span class="op" id="6317274">:=</span>&nbsp;<span class="ident" id="6317277"><a href="/image/gif/reader.go.html#6317256">d</a></span><span class="op" id="6317278">.</span><span class="ident" id="6317279">decode</span><span class="op" id="6317285">(</span><span class="ident" id="6317286"><a href="/image/gif/reader.go.html#6317214">r</a></span><span class="op" id="6317287">,</span>&nbsp;<span class="ident" id="6317289">true</span><span class="op" id="6317293">)</span><span class="op" id="6317294">;</span>&nbsp;<span class="ident" id="6317296"><a href="/image/gif/reader.go.html#6317270">err</a></span>&nbsp;<span class="op" id="6317300">!=</span>&nbsp;<span class="ident" id="6317303">nil</span>&nbsp;<span class="op" id="6317307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317311">return</span>&nbsp;<span class="ident" id="6317318"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6317323">.</span><span class="ident" id="6317324">Config</span><span class="op" id="6317330">{</span><span class="op" id="6317331">}</span><span class="op" id="6317332">,</span>&nbsp;<span class="ident" id="6317334"><a href="/image/gif/reader.go.html#6317270">err</a></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317342">return</span>&nbsp;<span class="ident" id="6317349"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6317354">.</span><span class="ident" id="6317355">Config</span><span class="op" id="6317361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317365">ColorModel</span><span class="op" id="6317375">:</span>&nbsp;<span class="ident" id="6317377"><a href="/image/gif/reader.go.html#6317256">d</a></span><span class="op" id="6317378">.</span><span class="ident" id="6317379">globalColorMap</span><span class="op" id="6317393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317397">Width</span><span class="op" id="6317402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317409"><a href="/image/gif/reader.go.html#6317256">d</a></span><span class="op" id="6317410">.</span><span class="ident" id="6317411">width</span><span class="op" id="6317416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317420">Height</span><span class="op" id="6317426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317432"><a href="/image/gif/reader.go.html#6317256">d</a></span><span class="op" id="6317433">.</span><span class="ident" id="6317434">height</span><span class="op" id="6317440">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317443">}</span><span class="op" id="6317444">,</span>&nbsp;<span class="ident" id="6317446">nil</span><br>
<span class="lineno"></span><span class="op" id="6317450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317453">func</span>&nbsp;<span class="ident" id="6317458">init</span><span class="op" id="6317462">(</span><span class="op" id="6317463">)</span>&nbsp;<span class="op" id="6317465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317468"><a href="/image/gif/reader.go.html#6306288">image</a></span><span class="op" id="6317473">.</span><span class="ident" id="6317474">RegisterFormat</span><span class="op" id="6317488">(</span><span class="string" id="6317489">&#34;gif&#34;</span><span class="op" id="6317494">,</span>&nbsp;<span class="string" id="6317496">&#34;GIF8?a&#34;</span><span class="op" id="6317504">,</span>&nbsp;<span class="ident" id="6317506"><a href="/image/gif/reader.go.html#6316310">Decode</a></span><span class="op" id="6317512">,</span>&nbsp;<span class="ident" id="6317514"><a href="/image/gif/reader.go.html#6317201">DecodeConfig</a></span><span class="op" id="6317526">)</span><br>
<span class="lineno">465</span><span class="op" id="6317528">}</span>
</div>
</body>
</html>
