<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5492313">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5492369">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5492423">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5492474">package</span>&nbsp;<span class="ident" id="5492482">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492490">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5492568">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5492648">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5492725">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5492796">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5492870">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5492937">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5493005">func</span>&nbsp;<span class="op" id="5493010">(</span><span class="ident" id="5493011">re</span>&nbsp;<span class="op" id="5493014">*</span><span class="ident" id="5493015">Regexp</span><span class="op" id="5493021">)</span>&nbsp;<span class="ident" id="5493023">Simplify</span><span class="op" id="5493031">(</span><span class="op" id="5493032">)</span>&nbsp;<span class="op" id="5493034">*</span><span class="ident" id="5493035">Regexp</span>&nbsp;<span class="op" id="5493042">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493045">if</span>&nbsp;<span class="ident" id="5493048">re</span>&nbsp;<span class="op" id="5493051">==</span>&nbsp;<span class="ident" id="5493054">nil</span>&nbsp;<span class="op" id="5493058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493062">return</span>&nbsp;<span class="ident" id="5493069">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493077">switch</span>&nbsp;<span class="ident" id="5493084">re</span><span class="op" id="5493086">.</span><span class="ident" id="5493087">Op</span>&nbsp;<span class="op" id="5493090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493093">case</span>&nbsp;<span class="ident" id="5493098">OpCapture</span><span class="op" id="5493107">,</span>&nbsp;<span class="ident" id="5493109">OpConcat</span><span class="op" id="5493117">,</span>&nbsp;<span class="ident" id="5493119">OpAlternate</span><span class="op" id="5493130">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493134">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493198">nre</span>&nbsp;<span class="op" id="5493202">:=</span>&nbsp;<span class="ident" id="5493205">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493210">for</span>&nbsp;<span class="ident" id="5493214">i</span><span class="op" id="5493215">,</span>&nbsp;<span class="ident" id="5493217">sub</span>&nbsp;<span class="op" id="5493221">:=</span>&nbsp;<span class="keyword" id="5493224">range</span>&nbsp;<span class="ident" id="5493230">re</span><span class="op" id="5493232">.</span><span class="ident" id="5493233">Sub</span>&nbsp;<span class="op" id="5493237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493242">nsub</span>&nbsp;<span class="op" id="5493247">:=</span>&nbsp;<span class="ident" id="5493250">sub</span><span class="op" id="5493253">.</span><span class="ident" id="5493254">Simplify</span><span class="op" id="5493262">(</span><span class="op" id="5493263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493268">if</span>&nbsp;<span class="ident" id="5493271">nre</span>&nbsp;<span class="op" id="5493275">==</span>&nbsp;<span class="ident" id="5493278">re</span>&nbsp;<span class="op" id="5493281">&amp;&amp;</span>&nbsp;<span class="ident" id="5493284">nsub</span>&nbsp;<span class="op" id="5493289">!=</span>&nbsp;<span class="ident" id="5493292">sub</span>&nbsp;<span class="op" id="5493296">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493302">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493323">nre</span>&nbsp;<span class="op" id="5493327">=</span>&nbsp;<span class="builtinfunc" id="5493329">new</span><span class="op" id="5493332">(</span><span class="ident" id="5493333">Regexp</span><span class="op" id="5493339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493345">*</span><span class="ident" id="5493346">nre</span>&nbsp;<span class="op" id="5493350">=</span>&nbsp;<span class="op" id="5493352">*</span><span class="ident" id="5493353">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493360">nre</span><span class="op" id="5493363">.</span><span class="ident" id="5493364">Rune</span>&nbsp;<span class="op" id="5493369">=</span>&nbsp;<span class="ident" id="5493371">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493379">nre</span><span class="op" id="5493382">.</span><span class="ident" id="5493383">Sub</span>&nbsp;<span class="op" id="5493387">=</span>&nbsp;<span class="builtinfunc" id="5493389">append</span><span class="op" id="5493395">(</span><span class="ident" id="5493396">nre</span><span class="op" id="5493399">.</span><span class="ident" id="5493400">Sub0</span><span class="op" id="5493404">[</span><span class="op" id="5493405">:</span><span class="num" id="5493406">0</span><span class="op" id="5493407">]</span><span class="op" id="5493408">,</span>&nbsp;<span class="ident" id="5493410">re</span><span class="op" id="5493412">.</span><span class="ident" id="5493413">Sub</span><span class="op" id="5493416">[</span><span class="op" id="5493417">:</span><span class="ident" id="5493418">i</span><span class="op" id="5493419">]</span><span class="op" id="5493420">...</span><span class="op" id="5493423">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493433">if</span>&nbsp;<span class="ident" id="5493436">nre</span>&nbsp;<span class="op" id="5493440">!=</span>&nbsp;<span class="ident" id="5493443">re</span>&nbsp;<span class="op" id="5493446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493452">nre</span><span class="op" id="5493455">.</span><span class="ident" id="5493456">Sub</span>&nbsp;<span class="op" id="5493460">=</span>&nbsp;<span class="builtinfunc" id="5493462">append</span><span class="op" id="5493468">(</span><span class="ident" id="5493469">nre</span><span class="op" id="5493472">.</span><span class="ident" id="5493473">Sub</span><span class="op" id="5493476">,</span>&nbsp;<span class="ident" id="5493478">nsub</span><span class="op" id="5493482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493491">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493495">return</span>&nbsp;<span class="ident" id="5493502">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493508">case</span>&nbsp;<span class="ident" id="5493513">OpStar</span><span class="op" id="5493519">,</span>&nbsp;<span class="ident" id="5493521">OpPlus</span><span class="op" id="5493527">,</span>&nbsp;<span class="ident" id="5493529">OpQuest</span><span class="op" id="5493536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493540">sub</span>&nbsp;<span class="op" id="5493544">:=</span>&nbsp;<span class="ident" id="5493547">re</span><span class="op" id="5493549">.</span><span class="ident" id="5493550">Sub</span><span class="op" id="5493553">[</span><span class="num" id="5493554">0</span><span class="op" id="5493555">]</span><span class="op" id="5493556">.</span><span class="ident" id="5493557">Simplify</span><span class="op" id="5493565">(</span><span class="op" id="5493566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493570">return</span>&nbsp;<span class="ident" id="5493577">simplify1</span><span class="op" id="5493586">(</span><span class="ident" id="5493587">re</span><span class="op" id="5493589">.</span><span class="ident" id="5493590">Op</span><span class="op" id="5493592">,</span>&nbsp;<span class="ident" id="5493594">re</span><span class="op" id="5493596">.</span><span class="ident" id="5493597">Flags</span><span class="op" id="5493602">,</span>&nbsp;<span class="ident" id="5493604">sub</span><span class="op" id="5493607">,</span>&nbsp;<span class="ident" id="5493609">re</span><span class="op" id="5493611">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493615">case</span>&nbsp;<span class="ident" id="5493620">OpRepeat</span><span class="op" id="5493628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493632">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493689">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493731">if</span>&nbsp;<span class="ident" id="5493734">re</span><span class="op" id="5493736">.</span><span class="ident" id="5493737">Min</span>&nbsp;<span class="op" id="5493741">==</span>&nbsp;<span class="num" id="5493744">0</span>&nbsp;<span class="op" id="5493746">&amp;&amp;</span>&nbsp;<span class="ident" id="5493749">re</span><span class="op" id="5493751">.</span><span class="ident" id="5493752">Max</span>&nbsp;<span class="op" id="5493756">==</span>&nbsp;<span class="num" id="5493759">0</span>&nbsp;<span class="op" id="5493761">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493766">return</span>&nbsp;<span class="op" id="5493773">&amp;</span><span class="ident" id="5493774">Regexp</span><span class="op" id="5493780">{</span><span class="ident" id="5493781">Op</span><span class="op" id="5493783">:</span>&nbsp;<span class="ident" id="5493785">OpEmptyMatch</span><span class="op" id="5493797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493806">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493827">sub</span>&nbsp;<span class="op" id="5493831">:=</span>&nbsp;<span class="ident" id="5493834">re</span><span class="op" id="5493836">.</span><span class="ident" id="5493837">Sub</span><span class="op" id="5493840">[</span><span class="num" id="5493841">0</span><span class="op" id="5493842">]</span><span class="op" id="5493843">.</span><span class="ident" id="5493844">Simplify</span><span class="op" id="5493852">(</span><span class="op" id="5493853">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493858">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493900">if</span>&nbsp;<span class="ident" id="5493903">re</span><span class="op" id="5493905">.</span><span class="ident" id="5493906">Max</span>&nbsp;<span class="op" id="5493910">==</span>&nbsp;<span class="op" id="5493913">-</span><span class="num" id="5493914">1</span>&nbsp;<span class="op" id="5493916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493921">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493954">if</span>&nbsp;<span class="ident" id="5493957">re</span><span class="op" id="5493959">.</span><span class="ident" id="5493960">Min</span>&nbsp;<span class="op" id="5493964">==</span>&nbsp;<span class="num" id="5493967">0</span>&nbsp;<span class="op" id="5493969">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493975">return</span>&nbsp;<span class="ident" id="5493982">simplify1</span><span class="op" id="5493991">(</span><span class="ident" id="5493992">OpStar</span><span class="op" id="5493998">,</span>&nbsp;<span class="ident" id="5494000">re</span><span class="op" id="5494002">.</span><span class="ident" id="5494003">Flags</span><span class="op" id="5494008">,</span>&nbsp;<span class="ident" id="5494010">sub</span><span class="op" id="5494013">,</span>&nbsp;<span class="ident" id="5494015">nil</span><span class="op" id="5494018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494029">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494062">if</span>&nbsp;<span class="ident" id="5494065">re</span><span class="op" id="5494067">.</span><span class="ident" id="5494068">Min</span>&nbsp;<span class="op" id="5494072">==</span>&nbsp;<span class="num" id="5494075">1</span>&nbsp;<span class="op" id="5494077">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494083">return</span>&nbsp;<span class="ident" id="5494090">simplify1</span><span class="op" id="5494099">(</span><span class="ident" id="5494100">OpPlus</span><span class="op" id="5494106">,</span>&nbsp;<span class="ident" id="5494108">re</span><span class="op" id="5494110">.</span><span class="ident" id="5494111">Flags</span><span class="op" id="5494116">,</span>&nbsp;<span class="ident" id="5494118">sub</span><span class="op" id="5494121">,</span>&nbsp;<span class="ident" id="5494123">nil</span><span class="op" id="5494126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494137">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494173">nre</span>&nbsp;<span class="op" id="5494177">:=</span>&nbsp;<span class="op" id="5494180">&amp;</span><span class="ident" id="5494181">Regexp</span><span class="op" id="5494187">{</span><span class="ident" id="5494188">Op</span><span class="op" id="5494190">:</span>&nbsp;<span class="ident" id="5494192">OpConcat</span><span class="op" id="5494200">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494205">nre</span><span class="op" id="5494208">.</span><span class="ident" id="5494209">Sub</span>&nbsp;<span class="op" id="5494213">=</span>&nbsp;<span class="ident" id="5494215">nre</span><span class="op" id="5494218">.</span><span class="ident" id="5494219">Sub0</span><span class="op" id="5494223">[</span><span class="op" id="5494224">:</span><span class="num" id="5494225">0</span><span class="op" id="5494226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494231">for</span>&nbsp;<span class="ident" id="5494235">i</span>&nbsp;<span class="op" id="5494237">:=</span>&nbsp;<span class="num" id="5494240">0</span><span class="op" id="5494241">;</span>&nbsp;<span class="ident" id="5494243">i</span>&nbsp;<span class="op" id="5494245">&lt;</span>&nbsp;<span class="ident" id="5494247">re</span><span class="op" id="5494249">.</span><span class="ident" id="5494250">Min</span><span class="op" id="5494253">-</span><span class="num" id="5494254">1</span><span class="op" id="5494255">;</span>&nbsp;<span class="ident" id="5494257">i</span><span class="op" id="5494258">++</span>&nbsp;<span class="op" id="5494261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494267">nre</span><span class="op" id="5494270">.</span><span class="ident" id="5494271">Sub</span>&nbsp;<span class="op" id="5494275">=</span>&nbsp;<span class="builtinfunc" id="5494277">append</span><span class="op" id="5494283">(</span><span class="ident" id="5494284">nre</span><span class="op" id="5494287">.</span><span class="ident" id="5494288">Sub</span><span class="op" id="5494291">,</span>&nbsp;<span class="ident" id="5494293">sub</span><span class="op" id="5494296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494306">nre</span><span class="op" id="5494309">.</span><span class="ident" id="5494310">Sub</span>&nbsp;<span class="op" id="5494314">=</span>&nbsp;<span class="builtinfunc" id="5494316">append</span><span class="op" id="5494322">(</span><span class="ident" id="5494323">nre</span><span class="op" id="5494326">.</span><span class="ident" id="5494327">Sub</span><span class="op" id="5494330">,</span>&nbsp;<span class="ident" id="5494332">simplify1</span><span class="op" id="5494341">(</span><span class="ident" id="5494342">OpPlus</span><span class="op" id="5494348">,</span>&nbsp;<span class="ident" id="5494350">re</span><span class="op" id="5494352">.</span><span class="ident" id="5494353">Flags</span><span class="op" id="5494358">,</span>&nbsp;<span class="ident" id="5494360">sub</span><span class="op" id="5494363">,</span>&nbsp;<span class="ident" id="5494365">nil</span><span class="op" id="5494368">)</span><span class="op" id="5494369">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494374">return</span>&nbsp;<span class="ident" id="5494381">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494392">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494431">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494466">if</span>&nbsp;<span class="ident" id="5494469">re</span><span class="op" id="5494471">.</span><span class="ident" id="5494472">Min</span>&nbsp;<span class="op" id="5494476">==</span>&nbsp;<span class="num" id="5494479">1</span>&nbsp;<span class="op" id="5494481">&amp;&amp;</span>&nbsp;<span class="ident" id="5494484">re</span><span class="op" id="5494486">.</span><span class="ident" id="5494487">Max</span>&nbsp;<span class="op" id="5494491">==</span>&nbsp;<span class="num" id="5494494">1</span>&nbsp;<span class="op" id="5494496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494501">return</span>&nbsp;<span class="ident" id="5494508">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494519">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494584">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494650">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494688">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494719">var</span>&nbsp;<span class="ident" id="5494723">prefix</span>&nbsp;<span class="op" id="5494730">*</span><span class="ident" id="5494731">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494740">if</span>&nbsp;<span class="ident" id="5494743">re</span><span class="op" id="5494745">.</span><span class="ident" id="5494746">Min</span>&nbsp;<span class="op" id="5494750">&gt;</span>&nbsp;<span class="num" id="5494752">0</span>&nbsp;<span class="op" id="5494754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494759">prefix</span>&nbsp;<span class="op" id="5494766">=</span>&nbsp;<span class="op" id="5494768">&amp;</span><span class="ident" id="5494769">Regexp</span><span class="op" id="5494775">{</span><span class="ident" id="5494776">Op</span><span class="op" id="5494778">:</span>&nbsp;<span class="ident" id="5494780">OpConcat</span><span class="op" id="5494788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494793">prefix</span><span class="op" id="5494799">.</span><span class="ident" id="5494800">Sub</span>&nbsp;<span class="op" id="5494804">=</span>&nbsp;<span class="ident" id="5494806">prefix</span><span class="op" id="5494812">.</span><span class="ident" id="5494813">Sub0</span><span class="op" id="5494817">[</span><span class="op" id="5494818">:</span><span class="num" id="5494819">0</span><span class="op" id="5494820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494825">for</span>&nbsp;<span class="ident" id="5494829">i</span>&nbsp;<span class="op" id="5494831">:=</span>&nbsp;<span class="num" id="5494834">0</span><span class="op" id="5494835">;</span>&nbsp;<span class="ident" id="5494837">i</span>&nbsp;<span class="op" id="5494839">&lt;</span>&nbsp;<span class="ident" id="5494841">re</span><span class="op" id="5494843">.</span><span class="ident" id="5494844">Min</span><span class="op" id="5494847">;</span>&nbsp;<span class="ident" id="5494849">i</span><span class="op" id="5494850">++</span>&nbsp;<span class="op" id="5494853">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494859">prefix</span><span class="op" id="5494865">.</span><span class="ident" id="5494866">Sub</span>&nbsp;<span class="op" id="5494870">=</span>&nbsp;<span class="builtinfunc" id="5494872">append</span><span class="op" id="5494878">(</span><span class="ident" id="5494879">prefix</span><span class="op" id="5494885">.</span><span class="ident" id="5494886">Sub</span><span class="op" id="5494889">,</span>&nbsp;<span class="ident" id="5494891">sub</span><span class="op" id="5494894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494908">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494951">if</span>&nbsp;<span class="ident" id="5494954">re</span><span class="op" id="5494956">.</span><span class="ident" id="5494957">Max</span>&nbsp;<span class="op" id="5494961">&gt;</span>&nbsp;<span class="ident" id="5494963">re</span><span class="op" id="5494965">.</span><span class="ident" id="5494966">Min</span>&nbsp;<span class="op" id="5494970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494975">suffix</span>&nbsp;<span class="op" id="5494982">:=</span>&nbsp;<span class="ident" id="5494985">simplify1</span><span class="op" id="5494994">(</span><span class="ident" id="5494995">OpQuest</span><span class="op" id="5495002">,</span>&nbsp;<span class="ident" id="5495004">re</span><span class="op" id="5495006">.</span><span class="ident" id="5495007">Flags</span><span class="op" id="5495012">,</span>&nbsp;<span class="ident" id="5495014">sub</span><span class="op" id="5495017">,</span>&nbsp;<span class="ident" id="5495019">nil</span><span class="op" id="5495022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495027">for</span>&nbsp;<span class="ident" id="5495031">i</span>&nbsp;<span class="op" id="5495033">:=</span>&nbsp;<span class="ident" id="5495036">re</span><span class="op" id="5495038">.</span><span class="ident" id="5495039">Min</span>&nbsp;<span class="op" id="5495043">+</span>&nbsp;<span class="num" id="5495045">1</span><span class="op" id="5495046">;</span>&nbsp;<span class="ident" id="5495048">i</span>&nbsp;<span class="op" id="5495050">&lt;</span>&nbsp;<span class="ident" id="5495052">re</span><span class="op" id="5495054">.</span><span class="ident" id="5495055">Max</span><span class="op" id="5495058">;</span>&nbsp;<span class="ident" id="5495060">i</span><span class="op" id="5495061">++</span>&nbsp;<span class="op" id="5495064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495070">nre2</span>&nbsp;<span class="op" id="5495075">:=</span>&nbsp;<span class="op" id="5495078">&amp;</span><span class="ident" id="5495079">Regexp</span><span class="op" id="5495085">{</span><span class="ident" id="5495086">Op</span><span class="op" id="5495088">:</span>&nbsp;<span class="ident" id="5495090">OpConcat</span><span class="op" id="5495098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495104">nre2</span><span class="op" id="5495108">.</span><span class="ident" id="5495109">Sub</span>&nbsp;<span class="op" id="5495113">=</span>&nbsp;<span class="builtinfunc" id="5495115">append</span><span class="op" id="5495121">(</span><span class="ident" id="5495122">nre2</span><span class="op" id="5495126">.</span><span class="ident" id="5495127">Sub0</span><span class="op" id="5495131">[</span><span class="op" id="5495132">:</span><span class="num" id="5495133">0</span><span class="op" id="5495134">]</span><span class="op" id="5495135">,</span>&nbsp;<span class="ident" id="5495137">sub</span><span class="op" id="5495140">,</span>&nbsp;<span class="ident" id="5495142">suffix</span><span class="op" id="5495148">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495154">suffix</span>&nbsp;<span class="op" id="5495161">=</span>&nbsp;<span class="ident" id="5495163">simplify1</span><span class="op" id="5495172">(</span><span class="ident" id="5495173">OpQuest</span><span class="op" id="5495180">,</span>&nbsp;<span class="ident" id="5495182">re</span><span class="op" id="5495184">.</span><span class="ident" id="5495185">Flags</span><span class="op" id="5495190">,</span>&nbsp;<span class="ident" id="5495192">nre2</span><span class="op" id="5495196">,</span>&nbsp;<span class="ident" id="5495198">nil</span><span class="op" id="5495201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495211">if</span>&nbsp;<span class="ident" id="5495214">prefix</span>&nbsp;<span class="op" id="5495221">==</span>&nbsp;<span class="ident" id="5495224">nil</span>&nbsp;<span class="op" id="5495228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495234">return</span>&nbsp;<span class="ident" id="5495241">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495251">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495256">prefix</span><span class="op" id="5495262">.</span><span class="ident" id="5495263">Sub</span>&nbsp;<span class="op" id="5495267">=</span>&nbsp;<span class="builtinfunc" id="5495269">append</span><span class="op" id="5495275">(</span><span class="ident" id="5495276">prefix</span><span class="op" id="5495282">.</span><span class="ident" id="5495283">Sub</span><span class="op" id="5495286">,</span>&nbsp;<span class="ident" id="5495288">suffix</span><span class="op" id="5495294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495302">if</span>&nbsp;<span class="ident" id="5495305">prefix</span>&nbsp;<span class="op" id="5495312">!=</span>&nbsp;<span class="ident" id="5495315">nil</span>&nbsp;<span class="op" id="5495319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495324">return</span>&nbsp;<span class="ident" id="5495331">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495340">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495345">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495404">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495437">return</span>&nbsp;<span class="op" id="5495444">&amp;</span><span class="ident" id="5495445">Regexp</span><span class="op" id="5495451">{</span><span class="ident" id="5495452">Op</span><span class="op" id="5495454">:</span>&nbsp;<span class="ident" id="5495456">OpNoMatch</span><span class="op" id="5495465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495468">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495472">return</span>&nbsp;<span class="ident" id="5495479">re</span><br>
<span class="lineno"></span><span class="op" id="5495482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5495485">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5495540">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5495604">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5495621">//</span><br>
<span class="lineno"></span><span class="comment" id="5495624">//&nbsp;&nbsp;&nbsp;&nbsp;Regexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5495668">//</span><br>
<span class="lineno">125</span><span class="comment" id="5495671">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5495727">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5495786">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5495848">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5495871">//</span><br>
<span class="lineno">130</span><span class="comment" id="5495874">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5495942">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5496000">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5496063">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5496087">func</span>&nbsp;<span class="ident" id="5496092">simplify1</span><span class="op" id="5496101">(</span><span class="ident" id="5496102">op</span>&nbsp;<span class="ident" id="5496105">Op</span><span class="op" id="5496107">,</span>&nbsp;<span class="ident" id="5496109">flags</span>&nbsp;<span class="ident" id="5496115">Flags</span><span class="op" id="5496120">,</span>&nbsp;<span class="ident" id="5496122">sub</span><span class="op" id="5496125">,</span>&nbsp;<span class="ident" id="5496127">re</span>&nbsp;<span class="op" id="5496130">*</span><span class="ident" id="5496131">Regexp</span><span class="op" id="5496137">)</span>&nbsp;<span class="op" id="5496139">*</span><span class="ident" id="5496140">Regexp</span>&nbsp;<span class="op" id="5496147">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496150">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496203">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496250">if</span>&nbsp;<span class="ident" id="5496253">sub</span><span class="op" id="5496256">.</span><span class="ident" id="5496257">Op</span>&nbsp;<span class="op" id="5496260">==</span>&nbsp;<span class="ident" id="5496263">OpEmptyMatch</span>&nbsp;<span class="op" id="5496276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496280">return</span>&nbsp;<span class="ident" id="5496287">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496292">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5496295">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496348">if</span>&nbsp;<span class="ident" id="5496351">op</span>&nbsp;<span class="op" id="5496354">==</span>&nbsp;<span class="ident" id="5496357">sub</span><span class="op" id="5496360">.</span><span class="ident" id="5496361">Op</span>&nbsp;<span class="op" id="5496364">&amp;&amp;</span>&nbsp;<span class="ident" id="5496367">flags</span><span class="op" id="5496372">&amp;</span><span class="ident" id="5496373">NonGreedy</span>&nbsp;<span class="op" id="5496383">==</span>&nbsp;<span class="ident" id="5496386">sub</span><span class="op" id="5496389">.</span><span class="ident" id="5496390">Flags</span><span class="op" id="5496395">&amp;</span><span class="ident" id="5496396">NonGreedy</span>&nbsp;<span class="op" id="5496406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496410">return</span>&nbsp;<span class="ident" id="5496417">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496425">if</span>&nbsp;<span class="ident" id="5496428">re</span>&nbsp;<span class="op" id="5496431">!=</span>&nbsp;<span class="ident" id="5496434">nil</span>&nbsp;<span class="op" id="5496438">&amp;&amp;</span>&nbsp;<span class="ident" id="5496441">re</span><span class="op" id="5496443">.</span><span class="ident" id="5496444">Op</span>&nbsp;<span class="op" id="5496447">==</span>&nbsp;<span class="ident" id="5496450">op</span>&nbsp;<span class="op" id="5496453">&amp;&amp;</span>&nbsp;<span class="ident" id="5496456">re</span><span class="op" id="5496458">.</span><span class="ident" id="5496459">Flags</span><span class="op" id="5496464">&amp;</span><span class="ident" id="5496465">NonGreedy</span>&nbsp;<span class="op" id="5496475">==</span>&nbsp;<span class="ident" id="5496478">flags</span><span class="op" id="5496483">&amp;</span><span class="ident" id="5496484">NonGreedy</span>&nbsp;<span class="op" id="5496494">&amp;&amp;</span>&nbsp;<span class="ident" id="5496497">sub</span>&nbsp;<span class="op" id="5496501">==</span>&nbsp;<span class="ident" id="5496504">re</span><span class="op" id="5496506">.</span><span class="ident" id="5496507">Sub</span><span class="op" id="5496510">[</span><span class="num" id="5496511">0</span><span class="op" id="5496512">]</span>&nbsp;<span class="op" id="5496514">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496518">return</span>&nbsp;<span class="ident" id="5496525">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496533">re</span>&nbsp;<span class="op" id="5496536">=</span>&nbsp;<span class="op" id="5496538">&amp;</span><span class="ident" id="5496539">Regexp</span><span class="op" id="5496545">{</span><span class="ident" id="5496546">Op</span><span class="op" id="5496548">:</span>&nbsp;<span class="ident" id="5496550">op</span><span class="op" id="5496552">,</span>&nbsp;<span class="ident" id="5496554">Flags</span><span class="op" id="5496559">:</span>&nbsp;<span class="ident" id="5496561">flags</span><span class="op" id="5496566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496569">re</span><span class="op" id="5496571">.</span><span class="ident" id="5496572">Sub</span>&nbsp;<span class="op" id="5496576">=</span>&nbsp;<span class="builtinfunc" id="5496578">append</span><span class="op" id="5496584">(</span><span class="ident" id="5496585">re</span><span class="op" id="5496587">.</span><span class="ident" id="5496588">Sub0</span><span class="op" id="5496592">[</span><span class="op" id="5496593">:</span><span class="num" id="5496594">0</span><span class="op" id="5496595">]</span><span class="op" id="5496596">,</span>&nbsp;<span class="ident" id="5496598">sub</span><span class="op" id="5496601">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5496604">return</span>&nbsp;<span class="ident" id="5496611">re</span><br>
<span class="lineno"></span><span class="op" id="5496614">}</span>
</div>
</body>
</html>
