<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1915899">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1915954">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1916008">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1916059">package</span>&nbsp;<span class="ident" id="1916067">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1916076">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;implementation&nbsp;of&nbsp;Go&nbsp;select&nbsp;statements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1916143">import</span>&nbsp;<span class="string" id="1916150">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1916160">const</span>&nbsp;<span class="op" id="1916166">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916169">debugSelect</span>&nbsp;<span class="op" id="1916181">=</span>&nbsp;<span class="ident" id="1916183">false</span><br>
<span class="lineno"></span><span class="op" id="1916189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1916192">var</span>&nbsp;<span class="op" id="1916196">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916199">chansendpc</span>&nbsp;<span class="op" id="1916210">=</span>&nbsp;<span class="ident" id="1916212"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1916218">(</span><span class="ident" id="1916219"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1916227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916230">chanrecvpc</span>&nbsp;<span class="op" id="1916241">=</span>&nbsp;<span class="ident" id="1916243"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1916249">(</span><span class="ident" id="1916250"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1916258">)</span><br>
<span class="lineno"></span><span class="op" id="1916260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="1916263">func</span>&nbsp;<span class="ident" id="1916268">selectsize</span><span class="op" id="1916278">(</span><span class="ident" id="1916279">size</span>&nbsp;<span class="builtintype" id="1916284">uintptr</span><span class="op" id="1916291">)</span>&nbsp;<span class="builtintype" id="1916293">uintptr</span>&nbsp;<span class="op" id="1916301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916304">selsize</span>&nbsp;<span class="op" id="1916312">:=</span>&nbsp;<span class="ident" id="1916315"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916321">.</span><span class="ident" id="1916322">Sizeof</span><span class="op" id="1916328">(</span><span class="ident" id="1916329"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916336">{</span><span class="op" id="1916337">}</span><span class="op" id="1916338">)</span>&nbsp;<span class="op" id="1916340">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916344">(</span><span class="ident" id="1916345"><a href="/runtime/select.go.html#1916279">size</a></span><span class="op" id="1916349">-</span><span class="num" id="1916350">1</span><span class="op" id="1916351">)</span><span class="op" id="1916352">*</span><span class="ident" id="1916353"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916359">.</span><span class="ident" id="1916360">Sizeof</span><span class="op" id="1916366">(</span><span class="ident" id="1916367"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916374">{</span><span class="op" id="1916375">}</span><span class="op" id="1916376">.</span><span class="ident" id="1916377">scase</span><span class="op" id="1916382">[</span><span class="num" id="1916383">0</span><span class="op" id="1916384">]</span><span class="op" id="1916385">)</span>&nbsp;<span class="op" id="1916387">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916391"><a href="/runtime/select.go.html#1916279">size</a></span><span class="op" id="1916395">*</span><span class="ident" id="1916396"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916402">.</span><span class="ident" id="1916403">Sizeof</span><span class="op" id="1916409">(</span><span class="op" id="1916410">*</span><span class="ident" id="1916411"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916418">{</span><span class="op" id="1916419">}</span><span class="op" id="1916420">.</span><span class="ident" id="1916421">lockorder</span><span class="op" id="1916430">)</span>&nbsp;<span class="op" id="1916432">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916436"><a href="/runtime/select.go.html#1916279">size</a></span><span class="op" id="1916440">*</span><span class="ident" id="1916441"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916447">.</span><span class="ident" id="1916448">Sizeof</span><span class="op" id="1916454">(</span><span class="op" id="1916455">*</span><span class="ident" id="1916456"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916463">{</span><span class="op" id="1916464">}</span><span class="op" id="1916465">.</span><span class="ident" id="1916466">pollorder</span><span class="op" id="1916475">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916478">return</span>&nbsp;<span class="ident" id="1916485"><a href="/runtime/malloc.go.html#1838486">round</a></span><span class="op" id="1916490">(</span><span class="ident" id="1916491"><a href="/runtime/select.go.html#1916304">selsize</a></span><span class="op" id="1916498">,</span>&nbsp;<span class="ident" id="1916500"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021804">_Int64Align</a></span><span class="op" id="1916511">)</span><br>
<span class="lineno"></span><span class="op" id="1916513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1916516">func</span>&nbsp;<span class="ident" id="1916521">newselect</span><span class="op" id="1916530">(</span><span class="ident" id="1916531">sel</span>&nbsp;<span class="op" id="1916535">*</span><span class="ident" id="1916536"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916543">,</span>&nbsp;<span class="ident" id="1916545">selsize</span>&nbsp;<span class="ident" id="1916553">int64</span><span class="op" id="1916558">,</span>&nbsp;<span class="ident" id="1916560">size</span>&nbsp;<span class="builtintype" id="1916565">int32</span><span class="op" id="1916570">)</span>&nbsp;<span class="op" id="1916572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1916575">if</span>&nbsp;<span class="ident" id="1916578"><a href="/runtime/select.go.html#1916545">selsize</a></span>&nbsp;<span class="op" id="1916586">!=</span>&nbsp;<span class="ident" id="1916589">int64</span><span class="op" id="1916594">(</span><span class="ident" id="1916595"><a href="/runtime/select.go.html#1916268">selectsize</a></span><span class="op" id="1916605">(</span><span class="builtintype" id="1916606">uintptr</span><span class="op" id="1916613">(</span><span class="ident" id="1916614"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1916618">)</span><span class="op" id="1916619">)</span><span class="op" id="1916620">)</span>&nbsp;<span class="op" id="1916622">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1916626">print</span><span class="op" id="1916631">(</span><span class="string" id="1916632">&#34;runtime:&nbsp;bad&nbsp;select&nbsp;size&nbsp;&#34;</span><span class="op" id="1916659">,</span>&nbsp;<span class="ident" id="1916661"><a href="/runtime/select.go.html#1916545">selsize</a></span><span class="op" id="1916668">,</span>&nbsp;<span class="string" id="1916670">&#34;,&nbsp;want&nbsp;&#34;</span><span class="op" id="1916679">,</span>&nbsp;<span class="ident" id="1916681"><a href="/runtime/select.go.html#1916268">selectsize</a></span><span class="op" id="1916691">(</span><span class="builtintype" id="1916692">uintptr</span><span class="op" id="1916699">(</span><span class="ident" id="1916700"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1916704">)</span><span class="op" id="1916705">)</span><span class="op" id="1916706">,</span>&nbsp;<span class="string" id="1916708">&#34;\n&#34;</span><span class="op" id="1916712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916716"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1916723">(</span><span class="string" id="1916724">&#34;bad&nbsp;select&nbsp;size&#34;</span><span class="op" id="1916741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1916744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916747"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916750">.</span><span class="ident" id="1916751">tcase</span>&nbsp;<span class="op" id="1916757">=</span>&nbsp;<span class="builtintype" id="1916759">uint16</span><span class="op" id="1916765">(</span><span class="ident" id="1916766"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1916770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916773"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916776">.</span><span class="ident" id="1916777">ncase</span>&nbsp;<span class="op" id="1916783">=</span>&nbsp;<span class="num" id="1916785">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916788"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916791">.</span><span class="ident" id="1916792">lockorder</span>&nbsp;<span class="op" id="1916802">=</span>&nbsp;<span class="op" id="1916804">(</span><span class="op" id="1916805">*</span><span class="op" id="1916806">*</span><span class="ident" id="1916807"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1916812">)</span><span class="op" id="1916813">(</span><span class="ident" id="1916814"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1916817">(</span><span class="ident" id="1916818"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916824">.</span><span class="ident" id="1916825">Pointer</span><span class="op" id="1916832">(</span><span class="op" id="1916833">&amp;</span><span class="ident" id="1916834"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916837">.</span><span class="ident" id="1916838">scase</span><span class="op" id="1916843">)</span><span class="op" id="1916844">,</span>&nbsp;<span class="builtintype" id="1916846">uintptr</span><span class="op" id="1916853">(</span><span class="ident" id="1916854"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1916858">)</span><span class="op" id="1916859">*</span><span class="ident" id="1916860"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916866">.</span><span class="ident" id="1916867">Sizeof</span><span class="op" id="1916873">(</span><span class="ident" id="1916874"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916881">{</span><span class="op" id="1916882">}</span><span class="op" id="1916883">.</span><span class="ident" id="1916884">scase</span><span class="op" id="1916889">[</span><span class="num" id="1916890">0</span><span class="op" id="1916891">]</span><span class="op" id="1916892">)</span><span class="op" id="1916893">)</span><span class="op" id="1916894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1916897"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916900">.</span><span class="ident" id="1916901">pollorder</span>&nbsp;<span class="op" id="1916911">=</span>&nbsp;<span class="op" id="1916913">(</span><span class="op" id="1916914">*</span><span class="builtintype" id="1916915">uint16</span><span class="op" id="1916921">)</span><span class="op" id="1916922">(</span><span class="ident" id="1916923"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1916926">(</span><span class="ident" id="1916927"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916933">.</span><span class="ident" id="1916934">Pointer</span><span class="op" id="1916941">(</span><span class="ident" id="1916942"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1916945">.</span><span class="ident" id="1916946">lockorder</span><span class="op" id="1916955">)</span><span class="op" id="1916956">,</span>&nbsp;<span class="builtintype" id="1916958">uintptr</span><span class="op" id="1916965">(</span><span class="ident" id="1916966"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1916970">)</span><span class="op" id="1916971">*</span><span class="ident" id="1916972"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1916978">.</span><span class="ident" id="1916979">Sizeof</span><span class="op" id="1916985">(</span><span class="op" id="1916986">*</span><span class="ident" id="1916987"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1916994">{</span><span class="op" id="1916995">}</span><span class="op" id="1916996">.</span><span class="ident" id="1916997">lockorder</span><span class="op" id="1917006">)</span><span class="op" id="1917007">)</span><span class="op" id="1917008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1917012">if</span>&nbsp;<span class="ident" id="1917015"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1917027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1917031">print</span><span class="op" id="1917036">(</span><span class="string" id="1917037">&#34;newselect&nbsp;s=&#34;</span><span class="op" id="1917051">,</span>&nbsp;<span class="ident" id="1917053"><a href="/runtime/select.go.html#1916531">sel</a></span><span class="op" id="1917056">,</span>&nbsp;<span class="string" id="1917058">&#34;&nbsp;size=&#34;</span><span class="op" id="1917066">,</span>&nbsp;<span class="ident" id="1917068"><a href="/runtime/select.go.html#1916560">size</a></span><span class="op" id="1917072">,</span>&nbsp;<span class="string" id="1917074">&#34;\n&#34;</span><span class="op" id="1917078">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1917081">}</span><br>
<span class="lineno"></span><span class="op" id="1917083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1917086">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1917099">func</span>&nbsp;<span class="ident" id="1917104">selectsend</span><span class="op" id="1917114">(</span><span class="ident" id="1917115">sel</span>&nbsp;<span class="op" id="1917119">*</span><span class="ident" id="1917120"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1917127">,</span>&nbsp;<span class="ident" id="1917129">c</span>&nbsp;<span class="op" id="1917131">*</span><span class="ident" id="1917132"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1917137">,</span>&nbsp;<span class="ident" id="1917139">elem</span>&nbsp;<span class="ident" id="1917144"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917150">.</span><span class="ident" id="1917151">Pointer</span><span class="op" id="1917158">)</span>&nbsp;<span class="op" id="1917160">(</span><span class="ident" id="1917161">selected</span>&nbsp;<span class="builtintype" id="1917170">bool</span><span class="op" id="1917174">)</span>&nbsp;<span class="op" id="1917176">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1917179">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1917208">if</span>&nbsp;<span class="ident" id="1917211"><a href="/runtime/select.go.html#1917129">c</a></span>&nbsp;<span class="op" id="1917213">!=</span>&nbsp;<span class="ident" id="1917216">nil</span>&nbsp;<span class="op" id="1917220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917224"><a href="/runtime/select.go.html#1917420">selectsendImpl</a></span><span class="op" id="1917238">(</span><span class="ident" id="1917239"><a href="/runtime/select.go.html#1917115">sel</a></span><span class="op" id="1917242">,</span>&nbsp;<span class="ident" id="1917244"><a href="/runtime/select.go.html#1917129">c</a></span><span class="op" id="1917245">,</span>&nbsp;<span class="ident" id="1917247"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1917258">(</span><span class="ident" id="1917259"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917265">.</span><span class="ident" id="1917266">Pointer</span><span class="op" id="1917273">(</span><span class="op" id="1917274">&amp;</span><span class="ident" id="1917275"><a href="/runtime/select.go.html#1917115">sel</a></span><span class="op" id="1917278">)</span><span class="op" id="1917279">)</span><span class="op" id="1917280">,</span>&nbsp;<span class="ident" id="1917282"><a href="/runtime/select.go.html#1917139">elem</a></span><span class="op" id="1917286">,</span>&nbsp;<span class="builtintype" id="1917288">uintptr</span><span class="op" id="1917295">(</span><span class="ident" id="1917296"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917302">.</span><span class="ident" id="1917303">Pointer</span><span class="op" id="1917310">(</span><span class="op" id="1917311">&amp;</span><span class="ident" id="1917312"><a href="/runtime/select.go.html#1917161">selected</a></span><span class="op" id="1917320">)</span><span class="op" id="1917321">)</span><span class="op" id="1917322">-</span><span class="builtintype" id="1917323">uintptr</span><span class="op" id="1917330">(</span><span class="ident" id="1917331"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917337">.</span><span class="ident" id="1917338">Pointer</span><span class="op" id="1917345">(</span><span class="op" id="1917346">&amp;</span><span class="ident" id="1917347"><a href="/runtime/select.go.html#1917115">sel</a></span><span class="op" id="1917350">)</span><span class="op" id="1917351">)</span><span class="op" id="1917352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1917355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1917358">return</span><br>
<span class="lineno">50</span><span class="op" id="1917365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1917368">//&nbsp;cut&nbsp;in&nbsp;half&nbsp;to&nbsp;give&nbsp;stack&nbsp;a&nbsp;chance&nbsp;to&nbsp;split</span><br>
<span class="lineno"></span><span class="keyword" id="1917415">func</span>&nbsp;<span class="ident" id="1917420">selectsendImpl</span><span class="op" id="1917434">(</span><span class="ident" id="1917435">sel</span>&nbsp;<span class="op" id="1917439">*</span><span class="ident" id="1917440"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1917447">,</span>&nbsp;<span class="ident" id="1917449">c</span>&nbsp;<span class="op" id="1917451">*</span><span class="ident" id="1917452"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1917457">,</span>&nbsp;<span class="ident" id="1917459">pc</span>&nbsp;<span class="builtintype" id="1917462">uintptr</span><span class="op" id="1917469">,</span>&nbsp;<span class="ident" id="1917471">elem</span>&nbsp;<span class="ident" id="1917476"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917482">.</span><span class="ident" id="1917483">Pointer</span><span class="op" id="1917490">,</span>&nbsp;<span class="ident" id="1917492">so</span>&nbsp;<span class="builtintype" id="1917495">uintptr</span><span class="op" id="1917502">)</span>&nbsp;<span class="op" id="1917504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917507">i</span>&nbsp;<span class="op" id="1917509">:=</span>&nbsp;<span class="ident" id="1917512"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917515">.</span><span class="ident" id="1917516">ncase</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1917523">if</span>&nbsp;<span class="ident" id="1917526"><a href="/runtime/select.go.html#1917507">i</a></span>&nbsp;<span class="op" id="1917528">&gt;=</span>&nbsp;<span class="ident" id="1917531"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917534">.</span><span class="ident" id="1917535">tcase</span>&nbsp;<span class="op" id="1917541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917545"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1917552">(</span><span class="string" id="1917553">&#34;selectsend:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="1917581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1917584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917587"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917590">.</span><span class="ident" id="1917591">ncase</span>&nbsp;<span class="op" id="1917597">=</span>&nbsp;<span class="ident" id="1917599"><a href="/runtime/select.go.html#1917507">i</a></span>&nbsp;<span class="op" id="1917601">+</span>&nbsp;<span class="num" id="1917603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917606">cas</span>&nbsp;<span class="op" id="1917610">:=</span>&nbsp;<span class="op" id="1917613">(</span><span class="op" id="1917614">*</span><span class="ident" id="1917615"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><span class="op" id="1917620">)</span><span class="op" id="1917621">(</span><span class="ident" id="1917622"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1917625">(</span><span class="ident" id="1917626"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917632">.</span><span class="ident" id="1917633">Pointer</span><span class="op" id="1917640">(</span><span class="op" id="1917641">&amp;</span><span class="ident" id="1917642"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917645">.</span><span class="ident" id="1917646">scase</span><span class="op" id="1917651">)</span><span class="op" id="1917652">,</span>&nbsp;<span class="builtintype" id="1917654">uintptr</span><span class="op" id="1917661">(</span><span class="ident" id="1917662"><a href="/runtime/select.go.html#1917507">i</a></span><span class="op" id="1917663">)</span><span class="op" id="1917664">*</span><span class="ident" id="1917665"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917671">.</span><span class="ident" id="1917672">Sizeof</span><span class="op" id="1917678">(</span><span class="ident" id="1917679"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917682">.</span><span class="ident" id="1917683">scase</span><span class="op" id="1917688">[</span><span class="num" id="1917689">0</span><span class="op" id="1917690">]</span><span class="op" id="1917691">)</span><span class="op" id="1917692">)</span><span class="op" id="1917693">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917697"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917700">.</span><span class="ident" id="1917701">pc</span>&nbsp;<span class="op" id="1917704">=</span>&nbsp;<span class="ident" id="1917706"><a href="/runtime/select.go.html#1917459">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917710"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917713">.</span><span class="ident" id="1917714">_chan</span>&nbsp;<span class="op" id="1917720">=</span>&nbsp;<span class="ident" id="1917722"><a href="/runtime/select.go.html#1917449">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917725"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917728">.</span><span class="ident" id="1917729">so</span>&nbsp;<span class="op" id="1917732">=</span>&nbsp;<span class="builtintype" id="1917734">uint16</span><span class="op" id="1917740">(</span><span class="ident" id="1917741"><a href="/runtime/select.go.html#1917492">so</a></span><span class="op" id="1917743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917746"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917749">.</span><span class="ident" id="1917750">kind</span>&nbsp;<span class="op" id="1917755">=</span>&nbsp;<span class="ident" id="1917757"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026782">_CaseSend</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1917768"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917771">.</span><span class="ident" id="1917772">elem</span>&nbsp;<span class="op" id="1917777">=</span>&nbsp;<span class="ident" id="1917779"><a href="/runtime/select.go.html#1917471">elem</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1917786">if</span>&nbsp;<span class="ident" id="1917789"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1917801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1917805">print</span><span class="op" id="1917810">(</span><span class="string" id="1917811">&#34;selectsend&nbsp;s=&#34;</span><span class="op" id="1917826">,</span>&nbsp;<span class="ident" id="1917828"><a href="/runtime/select.go.html#1917435">sel</a></span><span class="op" id="1917831">,</span>&nbsp;<span class="string" id="1917833">&#34;&nbsp;pc=&#34;</span><span class="op" id="1917839">,</span>&nbsp;<span class="ident" id="1917841"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1917844">(</span><span class="ident" id="1917845"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917848">.</span><span class="ident" id="1917849">pc</span><span class="op" id="1917851">)</span><span class="op" id="1917852">,</span>&nbsp;<span class="string" id="1917854">&#34;&nbsp;chan=&#34;</span><span class="op" id="1917862">,</span>&nbsp;<span class="ident" id="1917864"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917867">.</span><span class="ident" id="1917868">_chan</span><span class="op" id="1917873">,</span>&nbsp;<span class="string" id="1917875">&#34;&nbsp;so=&#34;</span><span class="op" id="1917881">,</span>&nbsp;<span class="ident" id="1917883"><a href="/runtime/select.go.html#1917606">cas</a></span><span class="op" id="1917886">.</span><span class="ident" id="1917887">so</span><span class="op" id="1917889">,</span>&nbsp;<span class="string" id="1917891">&#34;\n&#34;</span><span class="op" id="1917895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1917898">}</span><br>
<span class="lineno">70</span><span class="op" id="1917900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1917903">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1917916">func</span>&nbsp;<span class="ident" id="1917921">selectrecv</span><span class="op" id="1917931">(</span><span class="ident" id="1917932">sel</span>&nbsp;<span class="op" id="1917936">*</span><span class="ident" id="1917937"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1917944">,</span>&nbsp;<span class="ident" id="1917946">c</span>&nbsp;<span class="op" id="1917948">*</span><span class="ident" id="1917949"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1917954">,</span>&nbsp;<span class="ident" id="1917956">elem</span>&nbsp;<span class="ident" id="1917961"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1917967">.</span><span class="ident" id="1917968">Pointer</span><span class="op" id="1917975">)</span>&nbsp;<span class="op" id="1917977">(</span><span class="ident" id="1917978">selected</span>&nbsp;<span class="builtintype" id="1917987">bool</span><span class="op" id="1917991">)</span>&nbsp;<span class="op" id="1917993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1917996">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918025">if</span>&nbsp;<span class="ident" id="1918028"><a href="/runtime/select.go.html#1917946">c</a></span>&nbsp;<span class="op" id="1918030">!=</span>&nbsp;<span class="ident" id="1918033">nil</span>&nbsp;<span class="op" id="1918037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918041"><a href="/runtime/select.go.html#1918504">selectrecvImpl</a></span><span class="op" id="1918055">(</span><span class="ident" id="1918056"><a href="/runtime/select.go.html#1917932">sel</a></span><span class="op" id="1918059">,</span>&nbsp;<span class="ident" id="1918061"><a href="/runtime/select.go.html#1917946">c</a></span><span class="op" id="1918062">,</span>&nbsp;<span class="ident" id="1918064"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1918075">(</span><span class="ident" id="1918076"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918082">.</span><span class="ident" id="1918083">Pointer</span><span class="op" id="1918090">(</span><span class="op" id="1918091">&amp;</span><span class="ident" id="1918092"><a href="/runtime/select.go.html#1917932">sel</a></span><span class="op" id="1918095">)</span><span class="op" id="1918096">)</span><span class="op" id="1918097">,</span>&nbsp;<span class="ident" id="1918099"><a href="/runtime/select.go.html#1917956">elem</a></span><span class="op" id="1918103">,</span>&nbsp;<span class="ident" id="1918105">nil</span><span class="op" id="1918108">,</span>&nbsp;<span class="builtintype" id="1918110">uintptr</span><span class="op" id="1918117">(</span><span class="ident" id="1918118"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918124">.</span><span class="ident" id="1918125">Pointer</span><span class="op" id="1918132">(</span><span class="op" id="1918133">&amp;</span><span class="ident" id="1918134"><a href="/runtime/select.go.html#1917978">selected</a></span><span class="op" id="1918142">)</span><span class="op" id="1918143">)</span><span class="op" id="1918144">-</span><span class="builtintype" id="1918145">uintptr</span><span class="op" id="1918152">(</span><span class="ident" id="1918153"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918159">.</span><span class="ident" id="1918160">Pointer</span><span class="op" id="1918167">(</span><span class="op" id="1918168">&amp;</span><span class="ident" id="1918169"><a href="/runtime/select.go.html#1917932">sel</a></span><span class="op" id="1918172">)</span><span class="op" id="1918173">)</span><span class="op" id="1918174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1918177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918180">return</span><br>
<span class="lineno"></span><span class="op" id="1918187">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="1918190">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1918203">func</span>&nbsp;<span class="ident" id="1918208">selectrecv2</span><span class="op" id="1918219">(</span><span class="ident" id="1918220">sel</span>&nbsp;<span class="op" id="1918224">*</span><span class="ident" id="1918225"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1918232">,</span>&nbsp;<span class="ident" id="1918234">c</span>&nbsp;<span class="op" id="1918236">*</span><span class="ident" id="1918237"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1918242">,</span>&nbsp;<span class="ident" id="1918244">elem</span>&nbsp;<span class="ident" id="1918249"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918255">.</span><span class="ident" id="1918256">Pointer</span><span class="op" id="1918263">,</span>&nbsp;<span class="ident" id="1918265">received</span>&nbsp;<span class="op" id="1918274">*</span><span class="builtintype" id="1918275">bool</span><span class="op" id="1918279">)</span>&nbsp;<span class="op" id="1918281">(</span><span class="ident" id="1918282">selected</span>&nbsp;<span class="builtintype" id="1918291">bool</span><span class="op" id="1918295">)</span>&nbsp;<span class="op" id="1918297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1918300">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918329">if</span>&nbsp;<span class="ident" id="1918332"><a href="/runtime/select.go.html#1918234">c</a></span>&nbsp;<span class="op" id="1918334">!=</span>&nbsp;<span class="ident" id="1918337">nil</span>&nbsp;<span class="op" id="1918341">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918345"><a href="/runtime/select.go.html#1918504">selectrecvImpl</a></span><span class="op" id="1918359">(</span><span class="ident" id="1918360"><a href="/runtime/select.go.html#1918220">sel</a></span><span class="op" id="1918363">,</span>&nbsp;<span class="ident" id="1918365"><a href="/runtime/select.go.html#1918234">c</a></span><span class="op" id="1918366">,</span>&nbsp;<span class="ident" id="1918368"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1918379">(</span><span class="ident" id="1918380"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918386">.</span><span class="ident" id="1918387">Pointer</span><span class="op" id="1918394">(</span><span class="op" id="1918395">&amp;</span><span class="ident" id="1918396"><a href="/runtime/select.go.html#1918220">sel</a></span><span class="op" id="1918399">)</span><span class="op" id="1918400">)</span><span class="op" id="1918401">,</span>&nbsp;<span class="ident" id="1918403"><a href="/runtime/select.go.html#1918244">elem</a></span><span class="op" id="1918407">,</span>&nbsp;<span class="ident" id="1918409"><a href="/runtime/select.go.html#1918265">received</a></span><span class="op" id="1918417">,</span>&nbsp;<span class="builtintype" id="1918419">uintptr</span><span class="op" id="1918426">(</span><span class="ident" id="1918427"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918433">.</span><span class="ident" id="1918434">Pointer</span><span class="op" id="1918441">(</span><span class="op" id="1918442">&amp;</span><span class="ident" id="1918443"><a href="/runtime/select.go.html#1918282">selected</a></span><span class="op" id="1918451">)</span><span class="op" id="1918452">)</span><span class="op" id="1918453">-</span><span class="builtintype" id="1918454">uintptr</span><span class="op" id="1918461">(</span><span class="ident" id="1918462"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918468">.</span><span class="ident" id="1918469">Pointer</span><span class="op" id="1918476">(</span><span class="op" id="1918477">&amp;</span><span class="ident" id="1918478"><a href="/runtime/select.go.html#1918220">sel</a></span><span class="op" id="1918481">)</span><span class="op" id="1918482">)</span><span class="op" id="1918483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1918486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918489">return</span><br>
<span class="lineno"></span><span class="op" id="1918496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1918499">func</span>&nbsp;<span class="ident" id="1918504">selectrecvImpl</span><span class="op" id="1918518">(</span><span class="ident" id="1918519">sel</span>&nbsp;<span class="op" id="1918523">*</span><span class="ident" id="1918524"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1918531">,</span>&nbsp;<span class="ident" id="1918533">c</span>&nbsp;<span class="op" id="1918535">*</span><span class="ident" id="1918536"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1918541">,</span>&nbsp;<span class="ident" id="1918543">pc</span>&nbsp;<span class="builtintype" id="1918546">uintptr</span><span class="op" id="1918553">,</span>&nbsp;<span class="ident" id="1918555">elem</span>&nbsp;<span class="ident" id="1918560"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918566">.</span><span class="ident" id="1918567">Pointer</span><span class="op" id="1918574">,</span>&nbsp;<span class="ident" id="1918576">received</span>&nbsp;<span class="op" id="1918585">*</span><span class="builtintype" id="1918586">bool</span><span class="op" id="1918590">,</span>&nbsp;<span class="ident" id="1918592">so</span>&nbsp;<span class="builtintype" id="1918595">uintptr</span><span class="op" id="1918602">)</span>&nbsp;<span class="op" id="1918604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918607">i</span>&nbsp;<span class="op" id="1918609">:=</span>&nbsp;<span class="ident" id="1918612"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918615">.</span><span class="ident" id="1918616">ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918623">if</span>&nbsp;<span class="ident" id="1918626"><a href="/runtime/select.go.html#1918607">i</a></span>&nbsp;<span class="op" id="1918628">&gt;=</span>&nbsp;<span class="ident" id="1918631"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918634">.</span><span class="ident" id="1918635">tcase</span>&nbsp;<span class="op" id="1918641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918645"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1918652">(</span><span class="string" id="1918653">&#34;selectrecv:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="1918681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1918684">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918687"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918690">.</span><span class="ident" id="1918691">ncase</span>&nbsp;<span class="op" id="1918697">=</span>&nbsp;<span class="ident" id="1918699"><a href="/runtime/select.go.html#1918607">i</a></span>&nbsp;<span class="op" id="1918701">+</span>&nbsp;<span class="num" id="1918703">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918706">cas</span>&nbsp;<span class="op" id="1918710">:=</span>&nbsp;<span class="op" id="1918713">(</span><span class="op" id="1918714">*</span><span class="ident" id="1918715"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><span class="op" id="1918720">)</span><span class="op" id="1918721">(</span><span class="ident" id="1918722"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1918725">(</span><span class="ident" id="1918726"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918732">.</span><span class="ident" id="1918733">Pointer</span><span class="op" id="1918740">(</span><span class="op" id="1918741">&amp;</span><span class="ident" id="1918742"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918745">.</span><span class="ident" id="1918746">scase</span><span class="op" id="1918751">)</span><span class="op" id="1918752">,</span>&nbsp;<span class="builtintype" id="1918754">uintptr</span><span class="op" id="1918761">(</span><span class="ident" id="1918762"><a href="/runtime/select.go.html#1918607">i</a></span><span class="op" id="1918763">)</span><span class="op" id="1918764">*</span><span class="ident" id="1918765"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1918771">.</span><span class="ident" id="1918772">Sizeof</span><span class="op" id="1918778">(</span><span class="ident" id="1918779"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918782">.</span><span class="ident" id="1918783">scase</span><span class="op" id="1918788">[</span><span class="num" id="1918789">0</span><span class="op" id="1918790">]</span><span class="op" id="1918791">)</span><span class="op" id="1918792">)</span><span class="op" id="1918793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918796"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918799">.</span><span class="ident" id="1918800">pc</span>&nbsp;<span class="op" id="1918803">=</span>&nbsp;<span class="ident" id="1918805"><a href="/runtime/select.go.html#1918543">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918809"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918812">.</span><span class="ident" id="1918813">_chan</span>&nbsp;<span class="op" id="1918819">=</span>&nbsp;<span class="ident" id="1918821"><a href="/runtime/select.go.html#1918533">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918824"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918827">.</span><span class="ident" id="1918828">so</span>&nbsp;<span class="op" id="1918831">=</span>&nbsp;<span class="builtintype" id="1918833">uint16</span><span class="op" id="1918839">(</span><span class="ident" id="1918840"><a href="/runtime/select.go.html#1918592">so</a></span><span class="op" id="1918842">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918845"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918848">.</span><span class="ident" id="1918849">kind</span>&nbsp;<span class="op" id="1918854">=</span>&nbsp;<span class="ident" id="1918856"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026762">_CaseRecv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918867"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918870">.</span><span class="ident" id="1918871">elem</span>&nbsp;<span class="op" id="1918876">=</span>&nbsp;<span class="ident" id="1918878"><a href="/runtime/select.go.html#1918555">elem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1918884"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918887">.</span><span class="ident" id="1918888">receivedp</span>&nbsp;<span class="op" id="1918898">=</span>&nbsp;<span class="ident" id="1918900"><a href="/runtime/select.go.html#1918576">received</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1918911">if</span>&nbsp;<span class="ident" id="1918914"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1918926">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1918930">print</span><span class="op" id="1918935">(</span><span class="string" id="1918936">&#34;selectrecv&nbsp;s=&#34;</span><span class="op" id="1918951">,</span>&nbsp;<span class="ident" id="1918953"><a href="/runtime/select.go.html#1918519">sel</a></span><span class="op" id="1918956">,</span>&nbsp;<span class="string" id="1918958">&#34;&nbsp;pc=&#34;</span><span class="op" id="1918964">,</span>&nbsp;<span class="ident" id="1918966"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1918969">(</span><span class="ident" id="1918970"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918973">.</span><span class="ident" id="1918974">pc</span><span class="op" id="1918976">)</span><span class="op" id="1918977">,</span>&nbsp;<span class="string" id="1918979">&#34;&nbsp;chan=&#34;</span><span class="op" id="1918987">,</span>&nbsp;<span class="ident" id="1918989"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1918992">.</span><span class="ident" id="1918993">_chan</span><span class="op" id="1918998">,</span>&nbsp;<span class="string" id="1919000">&#34;&nbsp;so=&#34;</span><span class="op" id="1919006">,</span>&nbsp;<span class="ident" id="1919008"><a href="/runtime/select.go.html#1918706">cas</a></span><span class="op" id="1919011">.</span><span class="ident" id="1919012">so</span><span class="op" id="1919014">,</span>&nbsp;<span class="string" id="1919016">&#34;\n&#34;</span><span class="op" id="1919020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1919023">}</span><br>
<span class="lineno"></span><span class="op" id="1919025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1919028">//go:nosplit</span><br>
<span class="lineno">110</span><span class="keyword" id="1919041">func</span>&nbsp;<span class="ident" id="1919046">selectdefault</span><span class="op" id="1919059">(</span><span class="ident" id="1919060">sel</span>&nbsp;<span class="op" id="1919064">*</span><span class="ident" id="1919065"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1919072">)</span>&nbsp;<span class="op" id="1919074">(</span><span class="ident" id="1919075">selected</span>&nbsp;<span class="builtintype" id="1919084">bool</span><span class="op" id="1919088">)</span>&nbsp;<span class="op" id="1919090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919093"><a href="/runtime/select.go.html#1919233">selectdefaultImpl</a></span><span class="op" id="1919110">(</span><span class="ident" id="1919111"><a href="/runtime/select.go.html#1919060">sel</a></span><span class="op" id="1919114">,</span>&nbsp;<span class="ident" id="1919116"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1919127">(</span><span class="ident" id="1919128"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919134">.</span><span class="ident" id="1919135">Pointer</span><span class="op" id="1919142">(</span><span class="op" id="1919143">&amp;</span><span class="ident" id="1919144"><a href="/runtime/select.go.html#1919060">sel</a></span><span class="op" id="1919147">)</span><span class="op" id="1919148">)</span><span class="op" id="1919149">,</span>&nbsp;<span class="builtintype" id="1919151">uintptr</span><span class="op" id="1919158">(</span><span class="ident" id="1919159"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919165">.</span><span class="ident" id="1919166">Pointer</span><span class="op" id="1919173">(</span><span class="op" id="1919174">&amp;</span><span class="ident" id="1919175"><a href="/runtime/select.go.html#1919075">selected</a></span><span class="op" id="1919183">)</span><span class="op" id="1919184">)</span><span class="op" id="1919185">-</span><span class="builtintype" id="1919186">uintptr</span><span class="op" id="1919193">(</span><span class="ident" id="1919194"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919200">.</span><span class="ident" id="1919201">Pointer</span><span class="op" id="1919208">(</span><span class="op" id="1919209">&amp;</span><span class="ident" id="1919210"><a href="/runtime/select.go.html#1919060">sel</a></span><span class="op" id="1919213">)</span><span class="op" id="1919214">)</span><span class="op" id="1919215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919218">return</span><br>
<span class="lineno"></span><span class="op" id="1919225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="1919228">func</span>&nbsp;<span class="ident" id="1919233">selectdefaultImpl</span><span class="op" id="1919250">(</span><span class="ident" id="1919251">sel</span>&nbsp;<span class="op" id="1919255">*</span><span class="ident" id="1919256"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1919263">,</span>&nbsp;<span class="ident" id="1919265">callerpc</span>&nbsp;<span class="builtintype" id="1919274">uintptr</span><span class="op" id="1919281">,</span>&nbsp;<span class="ident" id="1919283">so</span>&nbsp;<span class="builtintype" id="1919286">uintptr</span><span class="op" id="1919293">)</span>&nbsp;<span class="op" id="1919295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919298">i</span>&nbsp;<span class="op" id="1919300">:=</span>&nbsp;<span class="ident" id="1919303"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919306">.</span><span class="ident" id="1919307">ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919314">if</span>&nbsp;<span class="ident" id="1919317"><a href="/runtime/select.go.html#1919298">i</a></span>&nbsp;<span class="op" id="1919319">&gt;=</span>&nbsp;<span class="ident" id="1919322"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919325">.</span><span class="ident" id="1919326">tcase</span>&nbsp;<span class="op" id="1919332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919336"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1919343">(</span><span class="string" id="1919344">&#34;selectdefault:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="1919375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1919378">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919381"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919384">.</span><span class="ident" id="1919385">ncase</span>&nbsp;<span class="op" id="1919391">=</span>&nbsp;<span class="ident" id="1919393"><a href="/runtime/select.go.html#1919298">i</a></span>&nbsp;<span class="op" id="1919395">+</span>&nbsp;<span class="num" id="1919397">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919400">cas</span>&nbsp;<span class="op" id="1919404">:=</span>&nbsp;<span class="op" id="1919407">(</span><span class="op" id="1919408">*</span><span class="ident" id="1919409"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><span class="op" id="1919414">)</span><span class="op" id="1919415">(</span><span class="ident" id="1919416"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1919419">(</span><span class="ident" id="1919420"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919426">.</span><span class="ident" id="1919427">Pointer</span><span class="op" id="1919434">(</span><span class="op" id="1919435">&amp;</span><span class="ident" id="1919436"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919439">.</span><span class="ident" id="1919440">scase</span><span class="op" id="1919445">)</span><span class="op" id="1919446">,</span>&nbsp;<span class="builtintype" id="1919448">uintptr</span><span class="op" id="1919455">(</span><span class="ident" id="1919456"><a href="/runtime/select.go.html#1919298">i</a></span><span class="op" id="1919457">)</span><span class="op" id="1919458">*</span><span class="ident" id="1919459"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919465">.</span><span class="ident" id="1919466">Sizeof</span><span class="op" id="1919472">(</span><span class="ident" id="1919473"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919476">.</span><span class="ident" id="1919477">scase</span><span class="op" id="1919482">[</span><span class="num" id="1919483">0</span><span class="op" id="1919484">]</span><span class="op" id="1919485">)</span><span class="op" id="1919486">)</span><span class="op" id="1919487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919490"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919493">.</span><span class="ident" id="1919494">pc</span>&nbsp;<span class="op" id="1919497">=</span>&nbsp;<span class="ident" id="1919499"><a href="/runtime/select.go.html#1919265">callerpc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919509"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919512">.</span><span class="ident" id="1919513">_chan</span>&nbsp;<span class="op" id="1919519">=</span>&nbsp;<span class="ident" id="1919521">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919526"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919529">.</span><span class="ident" id="1919530">so</span>&nbsp;<span class="op" id="1919533">=</span>&nbsp;<span class="builtintype" id="1919535">uint16</span><span class="op" id="1919541">(</span><span class="ident" id="1919542"><a href="/runtime/select.go.html#1919283">so</a></span><span class="op" id="1919544">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919547"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919550">.</span><span class="ident" id="1919551">kind</span>&nbsp;<span class="op" id="1919556">=</span>&nbsp;<span class="ident" id="1919558"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026802">_CaseDefault</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919573">if</span>&nbsp;<span class="ident" id="1919576"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1919588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1919592">print</span><span class="op" id="1919597">(</span><span class="string" id="1919598">&#34;selectdefault&nbsp;s=&#34;</span><span class="op" id="1919616">,</span>&nbsp;<span class="ident" id="1919618"><a href="/runtime/select.go.html#1919251">sel</a></span><span class="op" id="1919621">,</span>&nbsp;<span class="string" id="1919623">&#34;&nbsp;pc=&#34;</span><span class="op" id="1919629">,</span>&nbsp;<span class="ident" id="1919631"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1919634">(</span><span class="ident" id="1919635"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919638">.</span><span class="ident" id="1919639">pc</span><span class="op" id="1919641">)</span><span class="op" id="1919642">,</span>&nbsp;<span class="string" id="1919644">&#34;&nbsp;so=&#34;</span><span class="op" id="1919650">,</span>&nbsp;<span class="ident" id="1919652"><a href="/runtime/select.go.html#1919400">cas</a></span><span class="op" id="1919655">.</span><span class="ident" id="1919656">so</span><span class="op" id="1919658">,</span>&nbsp;<span class="string" id="1919660">&#34;\n&#34;</span><span class="op" id="1919664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1919667">}</span><br>
<span class="lineno">130</span><span class="op" id="1919669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1919672">func</span>&nbsp;<span class="ident" id="1919677">sellock</span><span class="op" id="1919684">(</span><span class="ident" id="1919685">sel</span>&nbsp;<span class="op" id="1919689">*</span><span class="ident" id="1919690"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1919697">)</span>&nbsp;<span class="op" id="1919699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919702">lockslice</span>&nbsp;<span class="op" id="1919712">:=</span>&nbsp;<span class="ident" id="1919715"><a href="/runtime/slice.go.html#1943323">sliceStruct</a></span><span class="op" id="1919726">{</span><span class="ident" id="1919727"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919733">.</span><span class="ident" id="1919734">Pointer</span><span class="op" id="1919741">(</span><span class="ident" id="1919742"><a href="/runtime/select.go.html#1919685">sel</a></span><span class="op" id="1919745">.</span><span class="ident" id="1919746">lockorder</span><span class="op" id="1919755">)</span><span class="op" id="1919756">,</span>&nbsp;<span class="builtintype" id="1919758">int</span><span class="op" id="1919761">(</span><span class="ident" id="1919762"><a href="/runtime/select.go.html#1919685">sel</a></span><span class="op" id="1919765">.</span><span class="ident" id="1919766">ncase</span><span class="op" id="1919771">)</span><span class="op" id="1919772">,</span>&nbsp;<span class="builtintype" id="1919774">int</span><span class="op" id="1919777">(</span><span class="ident" id="1919778"><a href="/runtime/select.go.html#1919685">sel</a></span><span class="op" id="1919781">.</span><span class="ident" id="1919782">ncase</span><span class="op" id="1919787">)</span><span class="op" id="1919788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919791">lockorder</span>&nbsp;<span class="op" id="1919801">:=</span>&nbsp;<span class="op" id="1919804">*</span><span class="op" id="1919805">(</span><span class="op" id="1919806">*</span><span class="op" id="1919807">[</span><span class="op" id="1919808">]</span><span class="op" id="1919809">*</span><span class="ident" id="1919810"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1919815">)</span><span class="op" id="1919816">(</span><span class="ident" id="1919817"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1919823">.</span><span class="ident" id="1919824">Pointer</span><span class="op" id="1919831">(</span><span class="op" id="1919832">&amp;</span><span class="ident" id="1919833"><a href="/runtime/select.go.html#1919702">lockslice</a></span><span class="op" id="1919842">)</span><span class="op" id="1919843">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919846">var</span>&nbsp;<span class="ident" id="1919850">c</span>&nbsp;<span class="op" id="1919852">*</span><span class="ident" id="1919853"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919860">for</span>&nbsp;<span class="ident" id="1919864">_</span><span class="op" id="1919865">,</span>&nbsp;<span class="ident" id="1919867">c0</span>&nbsp;<span class="op" id="1919870">:=</span>&nbsp;<span class="keyword" id="1919873">range</span>&nbsp;<span class="ident" id="1919879"><a href="/runtime/select.go.html#1919791">lockorder</a></span>&nbsp;<span class="op" id="1919889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1919893">if</span>&nbsp;<span class="ident" id="1919896"><a href="/runtime/select.go.html#1919867">c0</a></span>&nbsp;<span class="op" id="1919899">!=</span>&nbsp;<span class="ident" id="1919902">nil</span>&nbsp;<span class="op" id="1919906">&amp;&amp;</span>&nbsp;<span class="ident" id="1919909"><a href="/runtime/select.go.html#1919867">c0</a></span>&nbsp;<span class="op" id="1919912">!=</span>&nbsp;<span class="ident" id="1919915"><a href="/runtime/select.go.html#1919850">c</a></span>&nbsp;<span class="op" id="1919917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919922"><a href="/runtime/select.go.html#1919850">c</a></span>&nbsp;<span class="op" id="1919924">=</span>&nbsp;<span class="ident" id="1919926"><a href="/runtime/select.go.html#1919867">c0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1919932"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1919936">(</span><span class="op" id="1919937">&amp;</span><span class="ident" id="1919938"><a href="/runtime/select.go.html#1919850">c</a></span><span class="op" id="1919939">.</span><span class="ident" id="1919940">lock</span><span class="op" id="1919944">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1919948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1919951">}</span><br>
<span class="lineno"></span><span class="op" id="1919953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1919956">func</span>&nbsp;<span class="ident" id="1919961">selunlock</span><span class="op" id="1919970">(</span><span class="ident" id="1919971">sel</span>&nbsp;<span class="op" id="1919975">*</span><span class="ident" id="1919976"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1919983">)</span>&nbsp;<span class="op" id="1919985">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1919988">//&nbsp;We&nbsp;must&nbsp;be&nbsp;very&nbsp;careful&nbsp;here&nbsp;to&nbsp;not&nbsp;touch&nbsp;sel&nbsp;after&nbsp;we&nbsp;have&nbsp;unlocked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920061">//&nbsp;the&nbsp;last&nbsp;lock,&nbsp;because&nbsp;sel&nbsp;can&nbsp;be&nbsp;freed&nbsp;right&nbsp;after&nbsp;the&nbsp;last&nbsp;unlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920134">//&nbsp;Consider&nbsp;the&nbsp;following&nbsp;situation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920172">//&nbsp;First&nbsp;M&nbsp;calls&nbsp;runtimepark()&nbsp;in&nbsp;runtimeselectgo()&nbsp;passing&nbsp;the&nbsp;sel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920246">//&nbsp;Once&nbsp;runtimepark()&nbsp;has&nbsp;unlocked&nbsp;the&nbsp;last&nbsp;lock,&nbsp;another&nbsp;M&nbsp;makes</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920315">//&nbsp;the&nbsp;G&nbsp;that&nbsp;calls&nbsp;select&nbsp;runnable&nbsp;again&nbsp;and&nbsp;schedules&nbsp;it&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920390">//&nbsp;When&nbsp;the&nbsp;G&nbsp;runs&nbsp;on&nbsp;another&nbsp;M,&nbsp;it&nbsp;locks&nbsp;all&nbsp;the&nbsp;locks&nbsp;and&nbsp;frees&nbsp;sel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920462">//&nbsp;Now&nbsp;if&nbsp;the&nbsp;first&nbsp;M&nbsp;touches&nbsp;sel,&nbsp;it&nbsp;will&nbsp;access&nbsp;freed&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920527">n</span>&nbsp;<span class="op" id="1920529">:=</span>&nbsp;<span class="builtintype" id="1920532">int</span><span class="op" id="1920535">(</span><span class="ident" id="1920536"><a href="/runtime/select.go.html#1919971">sel</a></span><span class="op" id="1920539">.</span><span class="ident" id="1920540">ncase</span><span class="op" id="1920545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920548">r</span>&nbsp;<span class="op" id="1920550">:=</span>&nbsp;<span class="num" id="1920553">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920556">lockslice</span>&nbsp;<span class="op" id="1920566">:=</span>&nbsp;<span class="ident" id="1920569"><a href="/runtime/slice.go.html#1943323">sliceStruct</a></span><span class="op" id="1920580">{</span><span class="ident" id="1920581"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1920587">.</span><span class="ident" id="1920588">Pointer</span><span class="op" id="1920595">(</span><span class="ident" id="1920596"><a href="/runtime/select.go.html#1919971">sel</a></span><span class="op" id="1920599">.</span><span class="ident" id="1920600">lockorder</span><span class="op" id="1920609">)</span><span class="op" id="1920610">,</span>&nbsp;<span class="ident" id="1920612"><a href="/runtime/select.go.html#1920527">n</a></span><span class="op" id="1920613">,</span>&nbsp;<span class="ident" id="1920615"><a href="/runtime/select.go.html#1920527">n</a></span><span class="op" id="1920616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920619">lockorder</span>&nbsp;<span class="op" id="1920629">:=</span>&nbsp;<span class="op" id="1920632">*</span><span class="op" id="1920633">(</span><span class="op" id="1920634">*</span><span class="op" id="1920635">[</span><span class="op" id="1920636">]</span><span class="op" id="1920637">*</span><span class="ident" id="1920638"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1920643">)</span><span class="op" id="1920644">(</span><span class="ident" id="1920645"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1920651">.</span><span class="ident" id="1920652">Pointer</span><span class="op" id="1920659">(</span><span class="op" id="1920660">&amp;</span><span class="ident" id="1920661"><a href="/runtime/select.go.html#1920556">lockslice</a></span><span class="op" id="1920670">)</span><span class="op" id="1920671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1920674">//&nbsp;skip&nbsp;the&nbsp;default&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1920700">if</span>&nbsp;<span class="ident" id="1920703"><a href="/runtime/select.go.html#1920527">n</a></span>&nbsp;<span class="op" id="1920705">&gt;</span>&nbsp;<span class="num" id="1920707">0</span>&nbsp;<span class="op" id="1920709">&amp;&amp;</span>&nbsp;<span class="ident" id="1920712"><a href="/runtime/select.go.html#1920619">lockorder</a></span><span class="op" id="1920721">[</span><span class="num" id="1920722">0</span><span class="op" id="1920723">]</span>&nbsp;<span class="op" id="1920725">==</span>&nbsp;<span class="ident" id="1920728">nil</span>&nbsp;<span class="op" id="1920732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920736"><a href="/runtime/select.go.html#1920548">r</a></span>&nbsp;<span class="op" id="1920738">=</span>&nbsp;<span class="num" id="1920740">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1920743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1920746">for</span>&nbsp;<span class="ident" id="1920750">i</span>&nbsp;<span class="op" id="1920752">:=</span>&nbsp;<span class="ident" id="1920755"><a href="/runtime/select.go.html#1920527">n</a></span>&nbsp;<span class="op" id="1920757">-</span>&nbsp;<span class="num" id="1920759">1</span><span class="op" id="1920760">;</span>&nbsp;<span class="ident" id="1920762"><a href="/runtime/select.go.html#1920750">i</a></span>&nbsp;<span class="op" id="1920764">&gt;=</span>&nbsp;<span class="ident" id="1920767"><a href="/runtime/select.go.html#1920548">r</a></span><span class="op" id="1920768">;</span>&nbsp;<span class="ident" id="1920770"><a href="/runtime/select.go.html#1920750">i</a></span><span class="op" id="1920771">--</span>&nbsp;<span class="op" id="1920774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920778">c</span>&nbsp;<span class="op" id="1920780">:=</span>&nbsp;<span class="ident" id="1920783"><a href="/runtime/select.go.html#1920619">lockorder</a></span><span class="op" id="1920792">[</span><span class="ident" id="1920793"><a href="/runtime/select.go.html#1920750">i</a></span><span class="op" id="1920794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1920798">if</span>&nbsp;<span class="ident" id="1920801"><a href="/runtime/select.go.html#1920750">i</a></span>&nbsp;<span class="op" id="1920803">&gt;</span>&nbsp;<span class="num" id="1920805">0</span>&nbsp;<span class="op" id="1920807">&amp;&amp;</span>&nbsp;<span class="ident" id="1920810"><a href="/runtime/select.go.html#1920778">c</a></span>&nbsp;<span class="op" id="1920812">==</span>&nbsp;<span class="ident" id="1920815"><a href="/runtime/select.go.html#1920619">lockorder</a></span><span class="op" id="1920824">[</span><span class="ident" id="1920825"><a href="/runtime/select.go.html#1920750">i</a></span><span class="op" id="1920826">-</span><span class="num" id="1920827">1</span><span class="op" id="1920828">]</span>&nbsp;<span class="op" id="1920830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1920835">continue</span>&nbsp;<span class="comment" id="1920844">//&nbsp;will&nbsp;unlock&nbsp;it&nbsp;on&nbsp;the&nbsp;next&nbsp;iteration</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1920886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920890"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1920896">(</span><span class="op" id="1920897">&amp;</span><span class="ident" id="1920898"><a href="/runtime/select.go.html#1920778">c</a></span><span class="op" id="1920899">.</span><span class="ident" id="1920900">lock</span><span class="op" id="1920904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1920907">}</span><br>
<span class="lineno"></span><span class="op" id="1920909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="1920912">func</span>&nbsp;<span class="ident" id="1920917">selparkcommit</span><span class="op" id="1920930">(</span><span class="ident" id="1920931">gp</span>&nbsp;<span class="op" id="1920934">*</span><span class="ident" id="1920935"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1920936">,</span>&nbsp;<span class="ident" id="1920938">sel</span>&nbsp;<span class="op" id="1920942">*</span><span class="ident" id="1920943"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1920950">)</span>&nbsp;<span class="builtintype" id="1920952">bool</span>&nbsp;<span class="op" id="1920957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1920960"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1920969">(</span><span class="ident" id="1920970"><a href="/runtime/select.go.html#1920938">sel</a></span><span class="op" id="1920973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1920976">return</span>&nbsp;<span class="ident" id="1920983">true</span><br>
<span class="lineno"></span><span class="op" id="1920988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="1920991">func</span>&nbsp;<span class="ident" id="1920996">block</span><span class="op" id="1921001">(</span><span class="op" id="1921002">)</span>&nbsp;<span class="op" id="1921004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921007"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1921013">(</span><span class="ident" id="1921014">nil</span><span class="op" id="1921017">,</span>&nbsp;<span class="ident" id="1921019">nil</span><span class="op" id="1921022">,</span>&nbsp;<span class="string" id="1921024">&#34;select&nbsp;(no&nbsp;cases)&#34;</span><span class="op" id="1921043">)</span>&nbsp;<span class="comment" id="1921045">//&nbsp;forever</span><br>
<span class="lineno"></span><span class="op" id="1921056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1921059">//&nbsp;overwrites&nbsp;return&nbsp;pc&nbsp;on&nbsp;stack&nbsp;to&nbsp;signal&nbsp;which&nbsp;case&nbsp;of&nbsp;the&nbsp;select</span><br>
<span class="lineno">180</span><span class="comment" id="1921127">//&nbsp;to&nbsp;run,&nbsp;so&nbsp;cannot&nbsp;appear&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1921184">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1921197">func</span>&nbsp;<span class="ident" id="1921202">selectgo</span><span class="op" id="1921210">(</span><span class="ident" id="1921211">sel</span>&nbsp;<span class="op" id="1921215">*</span><span class="ident" id="1921216"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1921223">)</span>&nbsp;<span class="op" id="1921225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921228">pc</span><span class="op" id="1921230">,</span>&nbsp;<span class="ident" id="1921232">offset</span>&nbsp;<span class="op" id="1921239">:=</span>&nbsp;<span class="ident" id="1921242"><a href="/runtime/select.go.html#1921450">selectgoImpl</a></span><span class="op" id="1921254">(</span><span class="ident" id="1921255"><a href="/runtime/select.go.html#1921211">sel</a></span><span class="op" id="1921258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1921261">*</span><span class="op" id="1921262">(</span><span class="op" id="1921263">*</span><span class="builtintype" id="1921264">bool</span><span class="op" id="1921268">)</span><span class="op" id="1921269">(</span><span class="ident" id="1921270"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1921273">(</span><span class="ident" id="1921274"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1921280">.</span><span class="ident" id="1921281">Pointer</span><span class="op" id="1921288">(</span><span class="op" id="1921289">&amp;</span><span class="ident" id="1921290"><a href="/runtime/select.go.html#1921211">sel</a></span><span class="op" id="1921293">)</span><span class="op" id="1921294">,</span>&nbsp;<span class="builtintype" id="1921296">uintptr</span><span class="op" id="1921303">(</span><span class="ident" id="1921304"><a href="/runtime/select.go.html#1921232">offset</a></span><span class="op" id="1921310">)</span><span class="op" id="1921311">)</span><span class="op" id="1921312">)</span>&nbsp;<span class="op" id="1921314">=</span>&nbsp;<span class="ident" id="1921316">true</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921322"><a href="/runtime/stubs.go.html#1975091">setcallerpc</a></span><span class="op" id="1921333">(</span><span class="ident" id="1921334"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1921340">.</span><span class="ident" id="1921341">Pointer</span><span class="op" id="1921348">(</span><span class="op" id="1921349">&amp;</span><span class="ident" id="1921350"><a href="/runtime/select.go.html#1921211">sel</a></span><span class="op" id="1921353">)</span><span class="op" id="1921354">,</span>&nbsp;<span class="ident" id="1921356"><a href="/runtime/select.go.html#1921228">pc</a></span><span class="op" id="1921358">)</span><br>
<span class="lineno"></span><span class="op" id="1921360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1921363">//&nbsp;selectgoImpl&nbsp;returns&nbsp;scase.pc&nbsp;and&nbsp;scase.so&nbsp;for&nbsp;the&nbsp;select</span><br>
<span class="lineno"></span><span class="comment" id="1921424">//&nbsp;case&nbsp;which&nbsp;fired.</span><br>
<span class="lineno">190</span><span class="keyword" id="1921445">func</span>&nbsp;<span class="ident" id="1921450">selectgoImpl</span><span class="op" id="1921462">(</span><span class="ident" id="1921463">sel</span>&nbsp;<span class="op" id="1921467">*</span><span class="ident" id="1921468"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1921475">)</span>&nbsp;<span class="op" id="1921477">(</span><span class="builtintype" id="1921478">uintptr</span><span class="op" id="1921485">,</span>&nbsp;<span class="builtintype" id="1921487">uint16</span><span class="op" id="1921493">)</span>&nbsp;<span class="op" id="1921495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1921498">if</span>&nbsp;<span class="ident" id="1921501"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1921513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1921517">print</span><span class="op" id="1921522">(</span><span class="string" id="1921523">&#34;select:&nbsp;sel=&#34;</span><span class="op" id="1921537">,</span>&nbsp;<span class="ident" id="1921539"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1921542">,</span>&nbsp;<span class="string" id="1921544">&#34;\n&#34;</span><span class="op" id="1921548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1921551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921555">scaseslice</span>&nbsp;<span class="op" id="1921566">:=</span>&nbsp;<span class="ident" id="1921569"><a href="/runtime/slice.go.html#1943323">sliceStruct</a></span><span class="op" id="1921580">{</span><span class="ident" id="1921581"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1921587">.</span><span class="ident" id="1921588">Pointer</span><span class="op" id="1921595">(</span><span class="op" id="1921596">&amp;</span><span class="ident" id="1921597"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1921600">.</span><span class="ident" id="1921601">scase</span><span class="op" id="1921606">)</span><span class="op" id="1921607">,</span>&nbsp;<span class="builtintype" id="1921609">int</span><span class="op" id="1921612">(</span><span class="ident" id="1921613"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1921616">.</span><span class="ident" id="1921617">ncase</span><span class="op" id="1921622">)</span><span class="op" id="1921623">,</span>&nbsp;<span class="builtintype" id="1921625">int</span><span class="op" id="1921628">(</span><span class="ident" id="1921629"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1921632">.</span><span class="ident" id="1921633">ncase</span><span class="op" id="1921638">)</span><span class="op" id="1921639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921642">scases</span>&nbsp;<span class="op" id="1921649">:=</span>&nbsp;<span class="op" id="1921652">*</span><span class="op" id="1921653">(</span><span class="op" id="1921654">*</span><span class="op" id="1921655">[</span><span class="op" id="1921656">]</span><span class="ident" id="1921657"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><span class="op" id="1921662">)</span><span class="op" id="1921663">(</span><span class="ident" id="1921664"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1921670">.</span><span class="ident" id="1921671">Pointer</span><span class="op" id="1921678">(</span><span class="op" id="1921679">&amp;</span><span class="ident" id="1921680"><a href="/runtime/select.go.html#1921555">scaseslice</a></span><span class="op" id="1921690">)</span><span class="op" id="1921691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1921695">var</span>&nbsp;<span class="ident" id="1921699">t0</span>&nbsp;<span class="ident" id="1921702">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1921709">if</span>&nbsp;<span class="ident" id="1921712"><a href="/runtime/mprof.go.html#1856178">blockprofilerate</a></span>&nbsp;<span class="op" id="1921729">&gt;</span>&nbsp;<span class="num" id="1921731">0</span>&nbsp;<span class="op" id="1921733">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921737"><a href="/runtime/select.go.html#1921699">t0</a></span>&nbsp;<span class="op" id="1921740">=</span>&nbsp;<span class="ident" id="1921742"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1921750">(</span><span class="op" id="1921751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1921755">for</span>&nbsp;<span class="ident" id="1921759">i</span>&nbsp;<span class="op" id="1921761">:=</span>&nbsp;<span class="num" id="1921764">0</span><span class="op" id="1921765">;</span>&nbsp;<span class="ident" id="1921767"><a href="/runtime/select.go.html#1921759">i</a></span>&nbsp;<span class="op" id="1921769">&lt;</span>&nbsp;<span class="builtintype" id="1921771">int</span><span class="op" id="1921774">(</span><span class="ident" id="1921775"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1921778">.</span><span class="ident" id="1921779">ncase</span><span class="op" id="1921784">)</span><span class="op" id="1921785">;</span>&nbsp;<span class="ident" id="1921787"><a href="/runtime/select.go.html#1921759">i</a></span><span class="op" id="1921788">++</span>&nbsp;<span class="op" id="1921791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1921796"><a href="/runtime/select.go.html#1921642">scases</a></span><span class="op" id="1921802">[</span><span class="ident" id="1921803"><a href="/runtime/select.go.html#1921759">i</a></span><span class="op" id="1921804">]</span><span class="op" id="1921805">.</span><span class="ident" id="1921806">releasetime</span>&nbsp;<span class="op" id="1921818">=</span>&nbsp;<span class="op" id="1921820">-</span><span class="num" id="1921821">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1921825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1921828">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1921832">//&nbsp;The&nbsp;compiler&nbsp;rewrites&nbsp;selects&nbsp;that&nbsp;statically&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1921887">//&nbsp;only&nbsp;0&nbsp;or&nbsp;1&nbsp;cases&nbsp;plus&nbsp;default&nbsp;into&nbsp;simpler&nbsp;constructs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1921947">//&nbsp;The&nbsp;only&nbsp;way&nbsp;we&nbsp;can&nbsp;end&nbsp;up&nbsp;with&nbsp;such&nbsp;small&nbsp;sel.ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922004">//&nbsp;values&nbsp;here&nbsp;is&nbsp;for&nbsp;a&nbsp;larger&nbsp;select&nbsp;in&nbsp;which&nbsp;most&nbsp;channels</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922066">//&nbsp;have&nbsp;been&nbsp;nilled&nbsp;out.&nbsp;&nbsp;The&nbsp;general&nbsp;code&nbsp;handles&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922124">//&nbsp;cases&nbsp;correctly,&nbsp;and&nbsp;they&nbsp;are&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bother</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922184">//&nbsp;optimizing&nbsp;(and&nbsp;needing&nbsp;to&nbsp;test).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922223">//&nbsp;generate&nbsp;permuted&nbsp;order</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922251">pollslice</span>&nbsp;<span class="op" id="1922261">:=</span>&nbsp;<span class="ident" id="1922264"><a href="/runtime/slice.go.html#1943323">sliceStruct</a></span><span class="op" id="1922275">{</span><span class="ident" id="1922276"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1922282">.</span><span class="ident" id="1922283">Pointer</span><span class="op" id="1922290">(</span><span class="ident" id="1922291"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922294">.</span><span class="ident" id="1922295">pollorder</span><span class="op" id="1922304">)</span><span class="op" id="1922305">,</span>&nbsp;<span class="builtintype" id="1922307">int</span><span class="op" id="1922310">(</span><span class="ident" id="1922311"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922314">.</span><span class="ident" id="1922315">ncase</span><span class="op" id="1922320">)</span><span class="op" id="1922321">,</span>&nbsp;<span class="builtintype" id="1922323">int</span><span class="op" id="1922326">(</span><span class="ident" id="1922327"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922330">.</span><span class="ident" id="1922331">ncase</span><span class="op" id="1922336">)</span><span class="op" id="1922337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922340">pollorder</span>&nbsp;<span class="op" id="1922350">:=</span>&nbsp;<span class="op" id="1922353">*</span><span class="op" id="1922354">(</span><span class="op" id="1922355">*</span><span class="op" id="1922356">[</span><span class="op" id="1922357">]</span><span class="builtintype" id="1922358">uint16</span><span class="op" id="1922364">)</span><span class="op" id="1922365">(</span><span class="ident" id="1922366"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1922372">.</span><span class="ident" id="1922373">Pointer</span><span class="op" id="1922380">(</span><span class="op" id="1922381">&amp;</span><span class="ident" id="1922382"><a href="/runtime/select.go.html#1922251">pollslice</a></span><span class="op" id="1922391">)</span><span class="op" id="1922392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1922395">for</span>&nbsp;<span class="ident" id="1922399">i</span>&nbsp;<span class="op" id="1922401">:=</span>&nbsp;<span class="num" id="1922404">0</span><span class="op" id="1922405">;</span>&nbsp;<span class="ident" id="1922407"><a href="/runtime/select.go.html#1922399">i</a></span>&nbsp;<span class="op" id="1922409">&lt;</span>&nbsp;<span class="builtintype" id="1922411">int</span><span class="op" id="1922414">(</span><span class="ident" id="1922415"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922418">.</span><span class="ident" id="1922419">ncase</span><span class="op" id="1922424">)</span><span class="op" id="1922425">;</span>&nbsp;<span class="ident" id="1922427"><a href="/runtime/select.go.html#1922399">i</a></span><span class="op" id="1922428">++</span>&nbsp;<span class="op" id="1922431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922435"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1922444">[</span><span class="ident" id="1922445"><a href="/runtime/select.go.html#1922399">i</a></span><span class="op" id="1922446">]</span>&nbsp;<span class="op" id="1922448">=</span>&nbsp;<span class="builtintype" id="1922450">uint16</span><span class="op" id="1922456">(</span><span class="ident" id="1922457"><a href="/runtime/select.go.html#1922399">i</a></span><span class="op" id="1922458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1922461">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1922464">for</span>&nbsp;<span class="ident" id="1922468">i</span>&nbsp;<span class="op" id="1922470">:=</span>&nbsp;<span class="num" id="1922473">1</span><span class="op" id="1922474">;</span>&nbsp;<span class="ident" id="1922476"><a href="/runtime/select.go.html#1922468">i</a></span>&nbsp;<span class="op" id="1922478">&lt;</span>&nbsp;<span class="builtintype" id="1922480">int</span><span class="op" id="1922483">(</span><span class="ident" id="1922484"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922487">.</span><span class="ident" id="1922488">ncase</span><span class="op" id="1922493">)</span><span class="op" id="1922494">;</span>&nbsp;<span class="ident" id="1922496"><a href="/runtime/select.go.html#1922468">i</a></span><span class="op" id="1922497">++</span>&nbsp;<span class="op" id="1922500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922504">o</span>&nbsp;<span class="op" id="1922506">:=</span>&nbsp;<span class="ident" id="1922509"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1922518">[</span><span class="ident" id="1922519"><a href="/runtime/select.go.html#1922468">i</a></span><span class="op" id="1922520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922524">j</span>&nbsp;<span class="op" id="1922526">:=</span>&nbsp;<span class="builtintype" id="1922529">int</span><span class="op" id="1922532">(</span><span class="ident" id="1922533"><a href="/runtime/stubs.go.html#1972912">fastrand1</a></span><span class="op" id="1922542">(</span><span class="op" id="1922543">)</span><span class="op" id="1922544">)</span>&nbsp;<span class="op" id="1922546">%</span>&nbsp;<span class="op" id="1922548">(</span><span class="ident" id="1922549"><a href="/runtime/select.go.html#1922468">i</a></span>&nbsp;<span class="op" id="1922551">+</span>&nbsp;<span class="num" id="1922553">1</span><span class="op" id="1922554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922558"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1922567">[</span><span class="ident" id="1922568"><a href="/runtime/select.go.html#1922468">i</a></span><span class="op" id="1922569">]</span>&nbsp;<span class="op" id="1922571">=</span>&nbsp;<span class="ident" id="1922573"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1922582">[</span><span class="ident" id="1922583"><a href="/runtime/select.go.html#1922524">j</a></span><span class="op" id="1922584">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922588"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1922597">[</span><span class="ident" id="1922598"><a href="/runtime/select.go.html#1922524">j</a></span><span class="op" id="1922599">]</span>&nbsp;<span class="op" id="1922601">=</span>&nbsp;<span class="ident" id="1922603"><a href="/runtime/select.go.html#1922504">o</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1922606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922610">//&nbsp;sort&nbsp;the&nbsp;cases&nbsp;by&nbsp;Hchan&nbsp;address&nbsp;to&nbsp;get&nbsp;the&nbsp;locking&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1922672">//&nbsp;simple&nbsp;heap&nbsp;sort,&nbsp;to&nbsp;guarantee&nbsp;n&nbsp;log&nbsp;n&nbsp;time&nbsp;and&nbsp;constant&nbsp;stack&nbsp;footprint.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922750">lockslice</span>&nbsp;<span class="op" id="1922760">:=</span>&nbsp;<span class="ident" id="1922763"><a href="/runtime/slice.go.html#1943323">sliceStruct</a></span><span class="op" id="1922774">{</span><span class="ident" id="1922775"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1922781">.</span><span class="ident" id="1922782">Pointer</span><span class="op" id="1922789">(</span><span class="ident" id="1922790"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922793">.</span><span class="ident" id="1922794">lockorder</span><span class="op" id="1922803">)</span><span class="op" id="1922804">,</span>&nbsp;<span class="builtintype" id="1922806">int</span><span class="op" id="1922809">(</span><span class="ident" id="1922810"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922813">.</span><span class="ident" id="1922814">ncase</span><span class="op" id="1922819">)</span><span class="op" id="1922820">,</span>&nbsp;<span class="builtintype" id="1922822">int</span><span class="op" id="1922825">(</span><span class="ident" id="1922826"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922829">.</span><span class="ident" id="1922830">ncase</span><span class="op" id="1922835">)</span><span class="op" id="1922836">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922839">lockorder</span>&nbsp;<span class="op" id="1922849">:=</span>&nbsp;<span class="op" id="1922852">*</span><span class="op" id="1922853">(</span><span class="op" id="1922854">*</span><span class="op" id="1922855">[</span><span class="op" id="1922856">]</span><span class="op" id="1922857">*</span><span class="ident" id="1922858"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1922863">)</span><span class="op" id="1922864">(</span><span class="ident" id="1922865"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1922871">.</span><span class="ident" id="1922872">Pointer</span><span class="op" id="1922879">(</span><span class="op" id="1922880">&amp;</span><span class="ident" id="1922881"><a href="/runtime/select.go.html#1922750">lockslice</a></span><span class="op" id="1922890">)</span><span class="op" id="1922891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1922894">for</span>&nbsp;<span class="ident" id="1922898">i</span>&nbsp;<span class="op" id="1922900">:=</span>&nbsp;<span class="num" id="1922903">0</span><span class="op" id="1922904">;</span>&nbsp;<span class="ident" id="1922906"><a href="/runtime/select.go.html#1922898">i</a></span>&nbsp;<span class="op" id="1922908">&lt;</span>&nbsp;<span class="builtintype" id="1922910">int</span><span class="op" id="1922913">(</span><span class="ident" id="1922914"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1922917">.</span><span class="ident" id="1922918">ncase</span><span class="op" id="1922923">)</span><span class="op" id="1922924">;</span>&nbsp;<span class="ident" id="1922926"><a href="/runtime/select.go.html#1922898">i</a></span><span class="op" id="1922927">++</span>&nbsp;<span class="op" id="1922930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922934">j</span>&nbsp;<span class="op" id="1922936">:=</span>&nbsp;<span class="ident" id="1922939"><a href="/runtime/select.go.html#1922898">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1922943">c</span>&nbsp;<span class="op" id="1922945">:=</span>&nbsp;<span class="ident" id="1922948"><a href="/runtime/select.go.html#1921642">scases</a></span><span class="op" id="1922954">[</span><span class="ident" id="1922955"><a href="/runtime/select.go.html#1922934">j</a></span><span class="op" id="1922956">]</span><span class="op" id="1922957">.</span><span class="ident" id="1922958">_chan</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1922966">for</span>&nbsp;<span class="ident" id="1922970"><a href="/runtime/select.go.html#1922934">j</a></span>&nbsp;<span class="op" id="1922972">&gt;</span>&nbsp;<span class="num" id="1922974">0</span>&nbsp;<span class="op" id="1922976">&amp;&amp;</span>&nbsp;<span class="ident" id="1922979"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1922988">[</span><span class="op" id="1922989">(</span><span class="ident" id="1922990"><a href="/runtime/select.go.html#1922934">j</a></span><span class="op" id="1922991">-</span><span class="num" id="1922992">1</span><span class="op" id="1922993">)</span><span class="op" id="1922994">/</span><span class="num" id="1922995">2</span><span class="op" id="1922996">]</span><span class="op" id="1922997">.</span><span class="ident" id="1922998">sortkey</span><span class="op" id="1923005">(</span><span class="op" id="1923006">)</span>&nbsp;<span class="op" id="1923008">&lt;</span>&nbsp;<span class="ident" id="1923010"><a href="/runtime/select.go.html#1922943">c</a></span><span class="op" id="1923011">.</span><span class="ident" id="1923012">sortkey</span><span class="op" id="1923019">(</span><span class="op" id="1923020">)</span>&nbsp;<span class="op" id="1923022">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923027">k</span>&nbsp;<span class="op" id="1923029">:=</span>&nbsp;<span class="op" id="1923032">(</span><span class="ident" id="1923033"><a href="/runtime/select.go.html#1922934">j</a></span>&nbsp;<span class="op" id="1923035">-</span>&nbsp;<span class="num" id="1923037">1</span><span class="op" id="1923038">)</span>&nbsp;<span class="op" id="1923040">/</span>&nbsp;<span class="num" id="1923042">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923047"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923056">[</span><span class="ident" id="1923057"><a href="/runtime/select.go.html#1922934">j</a></span><span class="op" id="1923058">]</span>&nbsp;<span class="op" id="1923060">=</span>&nbsp;<span class="ident" id="1923062"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923071">[</span><span class="ident" id="1923072"><a href="/runtime/select.go.html#1923027">k</a></span><span class="op" id="1923073">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923078"><a href="/runtime/select.go.html#1922934">j</a></span>&nbsp;<span class="op" id="1923080">=</span>&nbsp;<span class="ident" id="1923082"><a href="/runtime/select.go.html#1923027">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923090"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923099">[</span><span class="ident" id="1923100"><a href="/runtime/select.go.html#1922934">j</a></span><span class="op" id="1923101">]</span>&nbsp;<span class="op" id="1923103">=</span>&nbsp;<span class="ident" id="1923105"><a href="/runtime/select.go.html#1922943">c</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923111">for</span>&nbsp;<span class="ident" id="1923115">i</span>&nbsp;<span class="op" id="1923117">:=</span>&nbsp;<span class="builtintype" id="1923120">int</span><span class="op" id="1923123">(</span><span class="ident" id="1923124"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1923127">.</span><span class="ident" id="1923128">ncase</span><span class="op" id="1923133">)</span>&nbsp;<span class="op" id="1923135">-</span>&nbsp;<span class="num" id="1923137">1</span><span class="op" id="1923138">;</span>&nbsp;<span class="ident" id="1923140"><a href="/runtime/select.go.html#1923115">i</a></span>&nbsp;<span class="op" id="1923142">&gt;=</span>&nbsp;<span class="num" id="1923145">0</span><span class="op" id="1923146">;</span>&nbsp;<span class="ident" id="1923148"><a href="/runtime/select.go.html#1923115">i</a></span><span class="op" id="1923149">--</span>&nbsp;<span class="op" id="1923152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923156">c</span>&nbsp;<span class="op" id="1923158">:=</span>&nbsp;<span class="ident" id="1923161"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923170">[</span><span class="ident" id="1923171"><a href="/runtime/select.go.html#1923115">i</a></span><span class="op" id="1923172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923176"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923185">[</span><span class="ident" id="1923186"><a href="/runtime/select.go.html#1923115">i</a></span><span class="op" id="1923187">]</span>&nbsp;<span class="op" id="1923189">=</span>&nbsp;<span class="ident" id="1923191"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923200">[</span><span class="num" id="1923201">0</span><span class="op" id="1923202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923206">j</span>&nbsp;<span class="op" id="1923208">:=</span>&nbsp;<span class="num" id="1923211">0</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923215">for</span>&nbsp;<span class="op" id="1923219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923224">k</span>&nbsp;<span class="op" id="1923226">:=</span>&nbsp;<span class="ident" id="1923229"><a href="/runtime/select.go.html#1923206">j</a></span><span class="op" id="1923230">*</span><span class="num" id="1923231">2</span>&nbsp;<span class="op" id="1923233">+</span>&nbsp;<span class="num" id="1923235">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923240">if</span>&nbsp;<span class="ident" id="1923243"><a href="/runtime/select.go.html#1923224">k</a></span>&nbsp;<span class="op" id="1923245">&gt;=</span>&nbsp;<span class="ident" id="1923248"><a href="/runtime/select.go.html#1923115">i</a></span>&nbsp;<span class="op" id="1923250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923256">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923265">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923270">if</span>&nbsp;<span class="ident" id="1923273"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923274">+</span><span class="num" id="1923275">1</span>&nbsp;<span class="op" id="1923277">&lt;</span>&nbsp;<span class="ident" id="1923279"><a href="/runtime/select.go.html#1923115">i</a></span>&nbsp;<span class="op" id="1923281">&amp;&amp;</span>&nbsp;<span class="ident" id="1923284"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923293">[</span><span class="ident" id="1923294"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923295">]</span><span class="op" id="1923296">.</span><span class="ident" id="1923297">sortkey</span><span class="op" id="1923304">(</span><span class="op" id="1923305">)</span>&nbsp;<span class="op" id="1923307">&lt;</span>&nbsp;<span class="ident" id="1923309"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923318">[</span><span class="ident" id="1923319"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923320">+</span><span class="num" id="1923321">1</span><span class="op" id="1923322">]</span><span class="op" id="1923323">.</span><span class="ident" id="1923324">sortkey</span><span class="op" id="1923331">(</span><span class="op" id="1923332">)</span>&nbsp;<span class="op" id="1923334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923340"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923341">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923352">if</span>&nbsp;<span class="ident" id="1923355"><a href="/runtime/select.go.html#1923156">c</a></span><span class="op" id="1923356">.</span><span class="ident" id="1923357">sortkey</span><span class="op" id="1923364">(</span><span class="op" id="1923365">)</span>&nbsp;<span class="op" id="1923367">&lt;</span>&nbsp;<span class="ident" id="1923369"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923378">[</span><span class="ident" id="1923379"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923380">]</span><span class="op" id="1923381">.</span><span class="ident" id="1923382">sortkey</span><span class="op" id="1923389">(</span><span class="op" id="1923390">)</span>&nbsp;<span class="op" id="1923392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923398"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923407">[</span><span class="ident" id="1923408"><a href="/runtime/select.go.html#1923206">j</a></span><span class="op" id="1923409">]</span>&nbsp;<span class="op" id="1923411">=</span>&nbsp;<span class="ident" id="1923413"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923422">[</span><span class="ident" id="1923423"><a href="/runtime/select.go.html#1923224">k</a></span><span class="op" id="1923424">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923430"><a href="/runtime/select.go.html#1923206">j</a></span>&nbsp;<span class="op" id="1923432">=</span>&nbsp;<span class="ident" id="1923434"><a href="/runtime/select.go.html#1923224">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923440">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923457">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923465">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923469"><a href="/runtime/select.go.html#1922839">lockorder</a></span><span class="op" id="1923478">[</span><span class="ident" id="1923479"><a href="/runtime/select.go.html#1923206">j</a></span><span class="op" id="1923480">]</span>&nbsp;<span class="op" id="1923482">=</span>&nbsp;<span class="ident" id="1923484"><a href="/runtime/select.go.html#1923156">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1923490">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i+1&nbsp;&lt;&nbsp;int(sel.ncase);&nbsp;i++&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;lockorder[i].sortkey()&nbsp;&gt;&nbsp;lockorder[i+1].sortkey()&nbsp;{<br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspprint(&#34;i=&#34;,&nbsp;i,&nbsp;&#34;&nbsp;x=&#34;,&nbsp;lockorder[i],&nbsp;&#34;&nbsp;y=&#34;,&nbsp;lockorder[i+1],&nbsp;&#34;\n&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgothrow(&#34;select:&nbsp;broken&nbsp;sort&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*/</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1923712">//&nbsp;lock&nbsp;all&nbsp;the&nbsp;channels&nbsp;involved&nbsp;in&nbsp;the&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923761"><a href="/runtime/select.go.html#1919677">sellock</a></span><span class="op" id="1923768">(</span><span class="ident" id="1923769"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1923772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923776">var</span>&nbsp;<span class="op" id="1923780">(</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923784">gp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1923791">*</span><span class="ident" id="1923792"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923796">done</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1923803">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923812">sg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1923819">*</span><span class="ident" id="1923820"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923828">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1923835">*</span><span class="ident" id="1923836"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923844">k</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1923851">*</span><span class="ident" id="1923852"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923860">sglist</span>&nbsp;<span class="op" id="1923867">*</span><span class="ident" id="1923868"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1923876">sgnext</span>&nbsp;<span class="op" id="1923883">*</span><span class="ident" id="1923884"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1923891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1923894">loop</span><span class="op" id="1923898">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1923901">//&nbsp;pass&nbsp;1&nbsp;-&nbsp;look&nbsp;for&nbsp;something&nbsp;already&nbsp;waiting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923949">var</span>&nbsp;<span class="ident" id="1923953">dfl</span>&nbsp;<span class="op" id="1923957">*</span><span class="ident" id="1923958"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923965">var</span>&nbsp;<span class="ident" id="1923969">cas</span>&nbsp;<span class="op" id="1923973">*</span><span class="ident" id="1923974"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026824">scase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1923981">for</span>&nbsp;<span class="ident" id="1923985">i</span>&nbsp;<span class="op" id="1923987">:=</span>&nbsp;<span class="num" id="1923990">0</span><span class="op" id="1923991">;</span>&nbsp;<span class="ident" id="1923993"><a href="/runtime/select.go.html#1923985">i</a></span>&nbsp;<span class="op" id="1923995">&lt;</span>&nbsp;<span class="builtintype" id="1923997">int</span><span class="op" id="1924000">(</span><span class="ident" id="1924001"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1924004">.</span><span class="ident" id="1924005">ncase</span><span class="op" id="1924010">)</span><span class="op" id="1924011">;</span>&nbsp;<span class="ident" id="1924013"><a href="/runtime/select.go.html#1923985">i</a></span><span class="op" id="1924014">++</span>&nbsp;<span class="op" id="1924017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924021"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1924025">=</span>&nbsp;<span class="op" id="1924027">&amp;</span><span class="ident" id="1924028"><a href="/runtime/select.go.html#1921642">scases</a></span><span class="op" id="1924034">[</span><span class="ident" id="1924035"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1924044">[</span><span class="ident" id="1924045"><a href="/runtime/select.go.html#1923985">i</a></span><span class="op" id="1924046">]</span><span class="op" id="1924047">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924051"><a href="/runtime/select.go.html#1923828">c</a></span>&nbsp;<span class="op" id="1924053">=</span>&nbsp;<span class="ident" id="1924055"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1924058">.</span><span class="ident" id="1924059">_chan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924068">switch</span>&nbsp;<span class="ident" id="1924075"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1924078">.</span><span class="ident" id="1924079">kind</span>&nbsp;<span class="op" id="1924084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924088">case</span>&nbsp;<span class="ident" id="1924093"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026762">_CaseRecv</a></span><span class="op" id="1924102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924107">if</span>&nbsp;<span class="ident" id="1924110"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924111">.</span><span class="ident" id="1924112">dataqsiz</span>&nbsp;<span class="op" id="1924121">&gt;</span>&nbsp;<span class="num" id="1924123">0</span>&nbsp;<span class="op" id="1924125">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924131">if</span>&nbsp;<span class="ident" id="1924134"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924135">.</span><span class="ident" id="1924136">qcount</span>&nbsp;<span class="op" id="1924143">&gt;</span>&nbsp;<span class="num" id="1924145">0</span>&nbsp;<span class="op" id="1924147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924154">goto</span>&nbsp;<span class="ident" id="1924159">asyncrecv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924178">}</span>&nbsp;<span class="keyword" id="1924180">else</span>&nbsp;<span class="op" id="1924185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924191"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1924194">=</span>&nbsp;<span class="ident" id="1924196"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924197">.</span><span class="ident" id="1924198">sendq</span><span class="op" id="1924203">.</span><span class="ident" id="1924204">dequeue</span><span class="op" id="1924211">(</span><span class="op" id="1924212">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924218">if</span>&nbsp;<span class="ident" id="1924221"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1924224">!=</span>&nbsp;<span class="ident" id="1924227">nil</span>&nbsp;<span class="op" id="1924231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924238">goto</span>&nbsp;<span class="ident" id="1924243">syncrecv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924266">if</span>&nbsp;<span class="ident" id="1924269"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924270">.</span><span class="ident" id="1924271">closed</span>&nbsp;<span class="op" id="1924278">!=</span>&nbsp;<span class="num" id="1924281">0</span>&nbsp;<span class="op" id="1924283">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924289">goto</span>&nbsp;<span class="ident" id="1924294">rclose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924309">case</span>&nbsp;<span class="ident" id="1924314"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026782">_CaseSend</a></span><span class="op" id="1924323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924328">if</span>&nbsp;<span class="ident" id="1924331"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1924343">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924349"><a href="/runtime/race0.go.html#1907159">racereadpc</a></span><span class="op" id="1924359">(</span><span class="ident" id="1924360"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1924366">.</span><span class="ident" id="1924367">Pointer</span><span class="op" id="1924374">(</span><span class="ident" id="1924375"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924376">)</span><span class="op" id="1924377">,</span>&nbsp;<span class="ident" id="1924379"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1924382">.</span><span class="ident" id="1924383">pc</span><span class="op" id="1924385">,</span>&nbsp;<span class="ident" id="1924387"><a href="/runtime/select.go.html#1916199">chansendpc</a></span><span class="op" id="1924397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924407">if</span>&nbsp;<span class="ident" id="1924410"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924411">.</span><span class="ident" id="1924412">closed</span>&nbsp;<span class="op" id="1924419">!=</span>&nbsp;<span class="num" id="1924422">0</span>&nbsp;<span class="op" id="1924424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924430">goto</span>&nbsp;<span class="ident" id="1924435">sclose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924445">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924450">if</span>&nbsp;<span class="ident" id="1924453"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924454">.</span><span class="ident" id="1924455">dataqsiz</span>&nbsp;<span class="op" id="1924464">&gt;</span>&nbsp;<span class="num" id="1924466">0</span>&nbsp;<span class="op" id="1924468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924474">if</span>&nbsp;<span class="ident" id="1924477"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924478">.</span><span class="ident" id="1924479">qcount</span>&nbsp;<span class="op" id="1924486">&lt;</span>&nbsp;<span class="ident" id="1924488"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924489">.</span><span class="ident" id="1924490">dataqsiz</span>&nbsp;<span class="op" id="1924499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924506">goto</span>&nbsp;<span class="ident" id="1924511">asyncsend</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924530">}</span>&nbsp;<span class="keyword" id="1924532">else</span>&nbsp;<span class="op" id="1924537">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924543"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1924546">=</span>&nbsp;<span class="ident" id="1924548"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1924549">.</span><span class="ident" id="1924550">recvq</span><span class="op" id="1924555">.</span><span class="ident" id="1924556">dequeue</span><span class="op" id="1924563">(</span><span class="op" id="1924564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924570">if</span>&nbsp;<span class="ident" id="1924573"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1924576">!=</span>&nbsp;<span class="ident" id="1924579">nil</span>&nbsp;<span class="op" id="1924583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924590">goto</span>&nbsp;<span class="ident" id="1924595">syncsend</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924613">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924618">case</span>&nbsp;<span class="ident" id="1924623"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026802">_CaseDefault</a></span><span class="op" id="1924635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924640"><a href="/runtime/select.go.html#1923953">dfl</a></span>&nbsp;<span class="op" id="1924644">=</span>&nbsp;<span class="ident" id="1924646"><a href="/runtime/select.go.html#1923969">cas</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924655">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924659">if</span>&nbsp;<span class="ident" id="1924662"><a href="/runtime/select.go.html#1923953">dfl</a></span>&nbsp;<span class="op" id="1924666">!=</span>&nbsp;<span class="ident" id="1924669">nil</span>&nbsp;<span class="op" id="1924673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924677"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1924686">(</span><span class="ident" id="1924687"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1924690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924694"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1924698">=</span>&nbsp;<span class="ident" id="1924700"><a href="/runtime/select.go.html#1923953">dfl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924706">goto</span>&nbsp;<span class="ident" id="1924711">retc</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1924717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1924721">//&nbsp;pass&nbsp;2&nbsp;-&nbsp;enqueue&nbsp;on&nbsp;all&nbsp;chans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924755"><a href="/runtime/select.go.html#1923784">gp</a></span>&nbsp;<span class="op" id="1924758">=</span>&nbsp;<span class="ident" id="1924760"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1924764">(</span><span class="op" id="1924765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924768"><a href="/runtime/select.go.html#1923796">done</a></span>&nbsp;<span class="op" id="1924773">=</span>&nbsp;<span class="num" id="1924775">0</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1924778">for</span>&nbsp;<span class="ident" id="1924782">i</span>&nbsp;<span class="op" id="1924784">:=</span>&nbsp;<span class="num" id="1924787">0</span><span class="op" id="1924788">;</span>&nbsp;<span class="ident" id="1924790"><a href="/runtime/select.go.html#1924782">i</a></span>&nbsp;<span class="op" id="1924792">&lt;</span>&nbsp;<span class="builtintype" id="1924794">int</span><span class="op" id="1924797">(</span><span class="ident" id="1924798"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1924801">.</span><span class="ident" id="1924802">ncase</span><span class="op" id="1924807">)</span><span class="op" id="1924808">;</span>&nbsp;<span class="ident" id="1924810"><a href="/runtime/select.go.html#1924782">i</a></span><span class="op" id="1924811">++</span>&nbsp;<span class="op" id="1924814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924818"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1924822">=</span>&nbsp;<span class="op" id="1924824">&amp;</span><span class="ident" id="1924825"><a href="/runtime/select.go.html#1921642">scases</a></span><span class="op" id="1924831">[</span><span class="ident" id="1924832"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1924841">[</span><span class="ident" id="1924842"><a href="/runtime/select.go.html#1924782">i</a></span><span class="op" id="1924843">]</span><span class="op" id="1924844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924848"><a href="/runtime/select.go.html#1923828">c</a></span>&nbsp;<span class="op" id="1924850">=</span>&nbsp;<span class="ident" id="1924852"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1924855">.</span><span class="ident" id="1924856">_chan</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924864">sg</span>&nbsp;<span class="op" id="1924867">:=</span>&nbsp;<span class="ident" id="1924870"><a href="/runtime/proc.go.html#1904005">acquireSudog</a></span><span class="op" id="1924882">(</span><span class="op" id="1924883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924887"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1924889">.</span><span class="ident" id="1924890">g</span>&nbsp;<span class="op" id="1924892">=</span>&nbsp;<span class="ident" id="1924894"><a href="/runtime/select.go.html#1923784">gp</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1924899">//&nbsp;Note:&nbsp;selectdone&nbsp;is&nbsp;adjusted&nbsp;for&nbsp;stack&nbsp;copies&nbsp;in&nbsp;stack.c:adjustsudogs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1924974"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1924976">.</span><span class="ident" id="1924977">selectdone</span>&nbsp;<span class="op" id="1924988">=</span>&nbsp;<span class="op" id="1924990">(</span><span class="op" id="1924991">*</span><span class="builtintype" id="1924992">uint32</span><span class="op" id="1924998">)</span><span class="op" id="1924999">(</span><span class="ident" id="1925000"><a href="/runtime/stubs.go.html#1973287">noescape</a></span><span class="op" id="1925008">(</span><span class="ident" id="1925009"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1925015">.</span><span class="ident" id="1925016">Pointer</span><span class="op" id="1925023">(</span><span class="op" id="1925024">&amp;</span><span class="ident" id="1925025"><a href="/runtime/select.go.html#1923796">done</a></span><span class="op" id="1925029">)</span><span class="op" id="1925030">)</span><span class="op" id="1925031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925035"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925037">.</span><span class="ident" id="1925038">elem</span>&nbsp;<span class="op" id="1925043">=</span>&nbsp;<span class="ident" id="1925045"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1925048">.</span><span class="ident" id="1925049">elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925056"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925058">.</span><span class="ident" id="1925059">releasetime</span>&nbsp;<span class="op" id="1925071">=</span>&nbsp;<span class="num" id="1925073">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1925077">if</span>&nbsp;<span class="ident" id="1925080"><a href="/runtime/select.go.html#1921699">t0</a></span>&nbsp;<span class="op" id="1925083">!=</span>&nbsp;<span class="num" id="1925086">0</span>&nbsp;<span class="op" id="1925088">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925093"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925095">.</span><span class="ident" id="1925096">releasetime</span>&nbsp;<span class="op" id="1925108">=</span>&nbsp;<span class="op" id="1925110">-</span><span class="num" id="1925111">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1925115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925119"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925121">.</span><span class="ident" id="1925122">waitlink</span>&nbsp;<span class="op" id="1925131">=</span>&nbsp;<span class="ident" id="1925133"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925135">.</span><span class="ident" id="1925136">waiting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925146"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925148">.</span><span class="ident" id="1925149">waiting</span>&nbsp;<span class="op" id="1925157">=</span>&nbsp;<span class="ident" id="1925159"><a href="/runtime/select.go.html#1924864">sg</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1925165">switch</span>&nbsp;<span class="ident" id="1925172"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1925175">.</span><span class="ident" id="1925176">kind</span>&nbsp;<span class="op" id="1925181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1925185">case</span>&nbsp;<span class="ident" id="1925190"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026762">_CaseRecv</a></span><span class="op" id="1925199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925204"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1925205">.</span><span class="ident" id="1925206">recvq</span><span class="op" id="1925211">.</span><span class="ident" id="1925212">enqueue</span><span class="op" id="1925219">(</span><span class="ident" id="1925220"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1925227">case</span>&nbsp;<span class="ident" id="1925232"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026782">_CaseSend</a></span><span class="op" id="1925241">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925246"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1925247">.</span><span class="ident" id="1925248">sendq</span><span class="op" id="1925253">.</span><span class="ident" id="1925254">enqueue</span><span class="op" id="1925261">(</span><span class="ident" id="1925262"><a href="/runtime/select.go.html#1924864">sg</a></span><span class="op" id="1925264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1925268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1925271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925275">//&nbsp;wait&nbsp;for&nbsp;someone&nbsp;to&nbsp;wake&nbsp;us&nbsp;up</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925310"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925312">.</span><span class="ident" id="1925313">param</span>&nbsp;<span class="op" id="1925319">=</span>&nbsp;<span class="ident" id="1925321">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925326"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1925332">(</span><span class="ident" id="1925333"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1925339">.</span><span class="ident" id="1925340">Pointer</span><span class="op" id="1925347">(</span><span class="ident" id="1925348"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1925354">(</span><span class="ident" id="1925355"><a href="/runtime/select.go.html#1920917">selparkcommit</a></span><span class="op" id="1925368">)</span><span class="op" id="1925369">)</span><span class="op" id="1925370">,</span>&nbsp;<span class="ident" id="1925372"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1925378">.</span><span class="ident" id="1925379">Pointer</span><span class="op" id="1925386">(</span><span class="ident" id="1925387"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1925390">)</span><span class="op" id="1925391">,</span>&nbsp;<span class="string" id="1925393">&#34;select&#34;</span><span class="op" id="1925401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925405">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925428"><a href="/runtime/select.go.html#1919677">sellock</a></span><span class="op" id="1925435">(</span><span class="ident" id="1925436"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1925439">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925442"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1925445">=</span>&nbsp;<span class="op" id="1925447">(</span><span class="op" id="1925448">*</span><span class="ident" id="1925449"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1925454">)</span><span class="op" id="1925455">(</span><span class="ident" id="1925456"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925458">.</span><span class="ident" id="1925459">param</span><span class="op" id="1925464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925467"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925469">.</span><span class="ident" id="1925470">param</span>&nbsp;<span class="op" id="1925476">=</span>&nbsp;<span class="ident" id="1925478">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925484">//&nbsp;pass&nbsp;3&nbsp;-&nbsp;dequeue&nbsp;from&nbsp;unsuccessful&nbsp;chans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925529">//&nbsp;otherwise&nbsp;they&nbsp;stack&nbsp;up&nbsp;on&nbsp;quiet&nbsp;channels</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925575">//&nbsp;record&nbsp;the&nbsp;successful&nbsp;case,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925615">//&nbsp;We&nbsp;singly-linked&nbsp;up&nbsp;the&nbsp;SudoGs&nbsp;in&nbsp;case&nbsp;order,&nbsp;so&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925673">//&nbsp;iterating&nbsp;through&nbsp;the&nbsp;linked&nbsp;list&nbsp;they&nbsp;are&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925738"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1925742">=</span>&nbsp;<span class="ident" id="1925744">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1925749"><a href="/runtime/select.go.html#1923860">sglist</a></span>&nbsp;<span class="op" id="1925756">=</span>&nbsp;<span class="ident" id="1925758"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1925760">.</span><span class="ident" id="1925761">waiting</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925770">//&nbsp;Clear&nbsp;all&nbsp;selectdone&nbsp;and&nbsp;elem&nbsp;before&nbsp;unlinking&nbsp;from&nbsp;gp.waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925838">//&nbsp;They&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;being&nbsp;put&nbsp;back&nbsp;into&nbsp;the&nbsp;sudog&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925907">//&nbsp;Clear&nbsp;before&nbsp;unlinking,&nbsp;because&nbsp;if&nbsp;a&nbsp;stack&nbsp;copy&nbsp;happens&nbsp;after&nbsp;the&nbsp;unlink,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1925985">//&nbsp;they&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;they&nbsp;will&nbsp;be&nbsp;left&nbsp;pointing&nbsp;to&nbsp;the&nbsp;old&nbsp;stack,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1926060">//&nbsp;which&nbsp;creates&nbsp;dangling&nbsp;pointers,&nbsp;which&nbsp;may&nbsp;be&nbsp;detected&nbsp;by&nbsp;the</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1926126">//&nbsp;garbage&nbsp;collector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926149">for</span>&nbsp;<span class="ident" id="1926153">sg1</span>&nbsp;<span class="op" id="1926157">:=</span>&nbsp;<span class="ident" id="1926160"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1926162">.</span><span class="ident" id="1926163">waiting</span><span class="op" id="1926170">;</span>&nbsp;<span class="ident" id="1926172"><a href="/runtime/select.go.html#1926153">sg1</a></span>&nbsp;<span class="op" id="1926176">!=</span>&nbsp;<span class="ident" id="1926179">nil</span><span class="op" id="1926182">;</span>&nbsp;<span class="ident" id="1926184"><a href="/runtime/select.go.html#1926153">sg1</a></span>&nbsp;<span class="op" id="1926188">=</span>&nbsp;<span class="ident" id="1926190"><a href="/runtime/select.go.html#1926153">sg1</a></span><span class="op" id="1926193">.</span><span class="ident" id="1926194">waitlink</span>&nbsp;<span class="op" id="1926203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926207"><a href="/runtime/select.go.html#1926153">sg1</a></span><span class="op" id="1926210">.</span><span class="ident" id="1926211">selectdone</span>&nbsp;<span class="op" id="1926222">=</span>&nbsp;<span class="ident" id="1926224">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926230"><a href="/runtime/select.go.html#1926153">sg1</a></span><span class="op" id="1926233">.</span><span class="ident" id="1926234">elem</span>&nbsp;<span class="op" id="1926239">=</span>&nbsp;<span class="ident" id="1926241">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926246">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926249"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1926251">.</span><span class="ident" id="1926252">waiting</span>&nbsp;<span class="op" id="1926260">=</span>&nbsp;<span class="ident" id="1926262">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926267">for</span>&nbsp;<span class="ident" id="1926271">i</span>&nbsp;<span class="op" id="1926273">:=</span>&nbsp;<span class="builtintype" id="1926276">int</span><span class="op" id="1926279">(</span><span class="ident" id="1926280"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1926283">.</span><span class="ident" id="1926284">ncase</span><span class="op" id="1926289">)</span>&nbsp;<span class="op" id="1926291">-</span>&nbsp;<span class="num" id="1926293">1</span><span class="op" id="1926294">;</span>&nbsp;<span class="ident" id="1926296"><a href="/runtime/select.go.html#1926271">i</a></span>&nbsp;<span class="op" id="1926298">&gt;=</span>&nbsp;<span class="num" id="1926301">0</span><span class="op" id="1926302">;</span>&nbsp;<span class="ident" id="1926304"><a href="/runtime/select.go.html#1926271">i</a></span><span class="op" id="1926305">--</span>&nbsp;<span class="op" id="1926308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926312"><a href="/runtime/select.go.html#1923844">k</a></span>&nbsp;<span class="op" id="1926314">=</span>&nbsp;<span class="op" id="1926316">&amp;</span><span class="ident" id="1926317"><a href="/runtime/select.go.html#1921642">scases</a></span><span class="op" id="1926323">[</span><span class="ident" id="1926324"><a href="/runtime/select.go.html#1922340">pollorder</a></span><span class="op" id="1926333">[</span><span class="ident" id="1926334"><a href="/runtime/select.go.html#1926271">i</a></span><span class="op" id="1926335">]</span><span class="op" id="1926336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926340">if</span>&nbsp;<span class="ident" id="1926343"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926349">.</span><span class="ident" id="1926350">releasetime</span>&nbsp;<span class="op" id="1926362">&gt;</span>&nbsp;<span class="num" id="1926364">0</span>&nbsp;<span class="op" id="1926366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926371"><a href="/runtime/select.go.html#1923844">k</a></span><span class="op" id="1926372">.</span><span class="ident" id="1926373">releasetime</span>&nbsp;<span class="op" id="1926385">=</span>&nbsp;<span class="ident" id="1926387"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926393">.</span><span class="ident" id="1926394">releasetime</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926412">if</span>&nbsp;<span class="ident" id="1926415"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1926418">==</span>&nbsp;<span class="ident" id="1926421"><a href="/runtime/select.go.html#1923860">sglist</a></span>&nbsp;<span class="op" id="1926428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926433"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1926437">=</span>&nbsp;<span class="ident" id="1926439"><a href="/runtime/select.go.html#1923844">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926443">}</span>&nbsp;<span class="keyword" id="1926445">else</span>&nbsp;<span class="op" id="1926450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926455"><a href="/runtime/select.go.html#1923828">c</a></span>&nbsp;<span class="op" id="1926457">=</span>&nbsp;<span class="ident" id="1926459"><a href="/runtime/select.go.html#1923844">k</a></span><span class="op" id="1926460">.</span><span class="ident" id="1926461">_chan</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926470">if</span>&nbsp;<span class="ident" id="1926473"><a href="/runtime/select.go.html#1923844">k</a></span><span class="op" id="1926474">.</span><span class="ident" id="1926475">kind</span>&nbsp;<span class="op" id="1926480">==</span>&nbsp;<span class="ident" id="1926483"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026782">_CaseSend</a></span>&nbsp;<span class="op" id="1926493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926499"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1926500">.</span><span class="ident" id="1926501">sendq</span><span class="op" id="1926506">.</span><span class="ident" id="1926507">dequeueSudoG</span><span class="op" id="1926519">(</span><span class="ident" id="1926520"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926531">}</span>&nbsp;<span class="keyword" id="1926533">else</span>&nbsp;<span class="op" id="1926538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926544"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1926545">.</span><span class="ident" id="1926546">recvq</span><span class="op" id="1926551">.</span><span class="ident" id="1926552">dequeueSudoG</span><span class="op" id="1926564">(</span><span class="ident" id="1926565"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926576">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926584"><a href="/runtime/select.go.html#1923876">sgnext</a></span>&nbsp;<span class="op" id="1926591">=</span>&nbsp;<span class="ident" id="1926593"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926599">.</span><span class="ident" id="1926600">waitlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926611"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926617">.</span><span class="ident" id="1926618">waitlink</span>&nbsp;<span class="op" id="1926627">=</span>&nbsp;<span class="ident" id="1926629">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926635"><a href="/runtime/proc.go.html#1904735">releaseSudog</a></span><span class="op" id="1926647">(</span><span class="ident" id="1926648"><a href="/runtime/select.go.html#1923860">sglist</a></span><span class="op" id="1926654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926658"><a href="/runtime/select.go.html#1923860">sglist</a></span>&nbsp;<span class="op" id="1926665">=</span>&nbsp;<span class="ident" id="1926667"><a href="/runtime/select.go.html#1923876">sgnext</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926679">if</span>&nbsp;<span class="ident" id="1926682"><a href="/runtime/select.go.html#1923969">cas</a></span>&nbsp;<span class="op" id="1926686">==</span>&nbsp;<span class="ident" id="1926689">nil</span>&nbsp;<span class="op" id="1926693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926697">goto</span>&nbsp;<span class="ident" id="1926702">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926708">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926712"><a href="/runtime/select.go.html#1923828">c</a></span>&nbsp;<span class="op" id="1926714">=</span>&nbsp;<span class="ident" id="1926716"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926719">.</span><span class="ident" id="1926720">_chan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926728">if</span>&nbsp;<span class="ident" id="1926731"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1926732">.</span><span class="ident" id="1926733">dataqsiz</span>&nbsp;<span class="op" id="1926742">&gt;</span>&nbsp;<span class="num" id="1926744">0</span>&nbsp;<span class="op" id="1926746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1926750"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1926757">(</span><span class="string" id="1926758">&#34;selectgo:&nbsp;shouldn&#39;t&nbsp;happen&#34;</span><span class="op" id="1926786">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926793">if</span>&nbsp;<span class="ident" id="1926796"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1926808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1926812">print</span><span class="op" id="1926817">(</span><span class="string" id="1926818">&#34;wait-return:&nbsp;sel=&#34;</span><span class="op" id="1926837">,</span>&nbsp;<span class="ident" id="1926839"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1926842">,</span>&nbsp;<span class="string" id="1926844">&#34;&nbsp;c=&#34;</span><span class="op" id="1926849">,</span>&nbsp;<span class="ident" id="1926851"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1926852">,</span>&nbsp;<span class="string" id="1926854">&#34;&nbsp;cas=&#34;</span><span class="op" id="1926861">,</span>&nbsp;<span class="ident" id="1926863"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926866">,</span>&nbsp;<span class="string" id="1926868">&#34;&nbsp;kind=&#34;</span><span class="op" id="1926876">,</span>&nbsp;<span class="ident" id="1926878"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926881">.</span><span class="ident" id="1926882">kind</span><span class="op" id="1926886">,</span>&nbsp;<span class="string" id="1926888">&#34;\n&#34;</span><span class="op" id="1926892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926895">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926899">if</span>&nbsp;<span class="ident" id="1926902"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926905">.</span><span class="ident" id="1926906">kind</span>&nbsp;<span class="op" id="1926911">==</span>&nbsp;<span class="ident" id="1926914"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026762">_CaseRecv</a></span>&nbsp;<span class="op" id="1926924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926928">if</span>&nbsp;<span class="ident" id="1926931"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926934">.</span><span class="ident" id="1926935">receivedp</span>&nbsp;<span class="op" id="1926945">!=</span>&nbsp;<span class="ident" id="1926948">nil</span>&nbsp;<span class="op" id="1926952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926957">*</span><span class="ident" id="1926958"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1926961">.</span><span class="ident" id="1926962">receivedp</span>&nbsp;<span class="op" id="1926972">=</span>&nbsp;<span class="ident" id="1926974">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926981">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1926984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1926988">if</span>&nbsp;<span class="ident" id="1926991"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1927003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927007">if</span>&nbsp;<span class="ident" id="1927010"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927013">.</span><span class="ident" id="1927014">kind</span>&nbsp;<span class="op" id="1927019">==</span>&nbsp;<span class="ident" id="1927022"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026762">_CaseRecv</a></span>&nbsp;<span class="op" id="1927032">&amp;&amp;</span>&nbsp;<span class="ident" id="1927035"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927038">.</span><span class="ident" id="1927039">elem</span>&nbsp;<span class="op" id="1927044">!=</span>&nbsp;<span class="ident" id="1927047">nil</span>&nbsp;<span class="op" id="1927051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927056"><a href="/runtime/race0.go.html#1906679">raceWriteObjectPC</a></span><span class="op" id="1927073">(</span><span class="ident" id="1927074"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927075">.</span><span class="ident" id="1927076">elemtype</span><span class="op" id="1927084">,</span>&nbsp;<span class="ident" id="1927086"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927089">.</span><span class="ident" id="1927090">elem</span><span class="op" id="1927094">,</span>&nbsp;<span class="ident" id="1927096"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927099">.</span><span class="ident" id="1927100">pc</span><span class="op" id="1927102">,</span>&nbsp;<span class="ident" id="1927104"><a href="/runtime/select.go.html#1916230">chanrecvpc</a></span><span class="op" id="1927114">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927118">}</span>&nbsp;<span class="keyword" id="1927120">else</span>&nbsp;<span class="keyword" id="1927125">if</span>&nbsp;<span class="ident" id="1927128"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927131">.</span><span class="ident" id="1927132">kind</span>&nbsp;<span class="op" id="1927137">==</span>&nbsp;<span class="ident" id="1927140"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026782">_CaseSend</a></span>&nbsp;<span class="op" id="1927150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927155"><a href="/runtime/race0.go.html#1906583">raceReadObjectPC</a></span><span class="op" id="1927171">(</span><span class="ident" id="1927172"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927173">.</span><span class="ident" id="1927174">elemtype</span><span class="op" id="1927182">,</span>&nbsp;<span class="ident" id="1927184"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927187">.</span><span class="ident" id="1927188">elem</span><span class="op" id="1927192">,</span>&nbsp;<span class="ident" id="1927194"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927197">.</span><span class="ident" id="1927198">pc</span><span class="op" id="1927200">,</span>&nbsp;<span class="ident" id="1927202"><a href="/runtime/select.go.html#1916199">chansendpc</a></span><span class="op" id="1927212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927223"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1927232">(</span><span class="ident" id="1927233"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1927236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927239">goto</span>&nbsp;<span class="ident" id="1927244">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1927250">asyncrecv</span><span class="op" id="1927259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1927262">//&nbsp;can&nbsp;receive&nbsp;from&nbsp;buffer</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927290">if</span>&nbsp;<span class="ident" id="1927293"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1927305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927309">if</span>&nbsp;<span class="ident" id="1927312"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927315">.</span><span class="ident" id="1927316">elem</span>&nbsp;<span class="op" id="1927321">!=</span>&nbsp;<span class="ident" id="1927324">nil</span>&nbsp;<span class="op" id="1927328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927333"><a href="/runtime/race0.go.html#1906679">raceWriteObjectPC</a></span><span class="op" id="1927350">(</span><span class="ident" id="1927351"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927352">.</span><span class="ident" id="1927353">elemtype</span><span class="op" id="1927361">,</span>&nbsp;<span class="ident" id="1927363"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927366">.</span><span class="ident" id="1927367">elem</span><span class="op" id="1927371">,</span>&nbsp;<span class="ident" id="1927373"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927376">.</span><span class="ident" id="1927377">pc</span><span class="op" id="1927379">,</span>&nbsp;<span class="ident" id="1927381"><a href="/runtime/select.go.html#1916230">chanrecvpc</a></span><span class="op" id="1927391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927399"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1927410">(</span><span class="ident" id="1927411"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1927418">(</span><span class="ident" id="1927419"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927420">,</span>&nbsp;<span class="ident" id="1927422"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927423">.</span><span class="ident" id="1927424">recvx</span><span class="op" id="1927429">)</span><span class="op" id="1927430">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927434"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1927445">(</span><span class="ident" id="1927446"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1927453">(</span><span class="ident" id="1927454"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927455">,</span>&nbsp;<span class="ident" id="1927457"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927458">.</span><span class="ident" id="1927459">recvx</span><span class="op" id="1927464">)</span><span class="op" id="1927465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927471">if</span>&nbsp;<span class="ident" id="1927474"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927477">.</span><span class="ident" id="1927478">receivedp</span>&nbsp;<span class="op" id="1927488">!=</span>&nbsp;<span class="ident" id="1927491">nil</span>&nbsp;<span class="op" id="1927495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927499">*</span><span class="ident" id="1927500"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927503">.</span><span class="ident" id="1927504">receivedp</span>&nbsp;<span class="op" id="1927514">=</span>&nbsp;<span class="ident" id="1927516">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927522">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927525">if</span>&nbsp;<span class="ident" id="1927528"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927531">.</span><span class="ident" id="1927532">elem</span>&nbsp;<span class="op" id="1927537">!=</span>&nbsp;<span class="ident" id="1927540">nil</span>&nbsp;<span class="op" id="1927544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927548"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1927555">(</span><span class="ident" id="1927556"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1927559">.</span><span class="ident" id="1927560">elem</span><span class="op" id="1927564">,</span>&nbsp;<span class="ident" id="1927566"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1927573">(</span><span class="ident" id="1927574"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927575">,</span>&nbsp;<span class="ident" id="1927577"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927578">.</span><span class="ident" id="1927579">recvx</span><span class="op" id="1927584">)</span><span class="op" id="1927585">,</span>&nbsp;<span class="builtintype" id="1927587">uintptr</span><span class="op" id="1927594">(</span><span class="ident" id="1927595"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927596">.</span><span class="ident" id="1927597">elemsize</span><span class="op" id="1927605">)</span><span class="op" id="1927606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927612"><a href="/runtime/stubs.go.html#1972552">memclr</a></span><span class="op" id="1927618">(</span><span class="ident" id="1927619"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1927626">(</span><span class="ident" id="1927627"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927628">,</span>&nbsp;<span class="ident" id="1927630"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927631">.</span><span class="ident" id="1927632">recvx</span><span class="op" id="1927637">)</span><span class="op" id="1927638">,</span>&nbsp;<span class="builtintype" id="1927640">uintptr</span><span class="op" id="1927647">(</span><span class="ident" id="1927648"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927649">.</span><span class="ident" id="1927650">elemsize</span><span class="op" id="1927658">)</span><span class="op" id="1927659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927662"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927663">.</span><span class="ident" id="1927664">recvx</span><span class="op" id="1927669">++</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927673">if</span>&nbsp;<span class="ident" id="1927676"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927677">.</span><span class="ident" id="1927678">recvx</span>&nbsp;<span class="op" id="1927684">==</span>&nbsp;<span class="ident" id="1927687"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927688">.</span><span class="ident" id="1927689">dataqsiz</span>&nbsp;<span class="op" id="1927698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927702"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927703">.</span><span class="ident" id="1927704">recvx</span>&nbsp;<span class="op" id="1927710">=</span>&nbsp;<span class="num" id="1927712">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927718"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927719">.</span><span class="ident" id="1927720">qcount</span><span class="op" id="1927726">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927730"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1927733">=</span>&nbsp;<span class="ident" id="1927735"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927736">.</span><span class="ident" id="1927737">sendq</span><span class="op" id="1927742">.</span><span class="ident" id="1927743">dequeue</span><span class="op" id="1927750">(</span><span class="op" id="1927751">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927754">if</span>&nbsp;<span class="ident" id="1927757"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1927760">!=</span>&nbsp;<span class="ident" id="1927763">nil</span>&nbsp;<span class="op" id="1927767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927771"><a href="/runtime/select.go.html#1923784">gp</a></span>&nbsp;<span class="op" id="1927774">=</span>&nbsp;<span class="ident" id="1927776"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1927778">.</span><span class="ident" id="1927779">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927783"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1927792">(</span><span class="ident" id="1927793"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1927796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927800">if</span>&nbsp;<span class="ident" id="1927803"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1927805">.</span><span class="ident" id="1927806">releasetime</span>&nbsp;<span class="op" id="1927818">!=</span>&nbsp;<span class="num" id="1927821">0</span>&nbsp;<span class="op" id="1927823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927828"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1927830">.</span><span class="ident" id="1927831">releasetime</span>&nbsp;<span class="op" id="1927843">=</span>&nbsp;<span class="ident" id="1927845"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1927853">(</span><span class="op" id="1927854">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927862"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1927869">(</span><span class="ident" id="1927870"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1927872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927875">}</span>&nbsp;<span class="keyword" id="1927877">else</span>&nbsp;<span class="op" id="1927882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927886"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1927895">(</span><span class="ident" id="1927896"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1927899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1927902">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927905">goto</span>&nbsp;<span class="ident" id="1927910">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1927916">asyncsend</span><span class="op" id="1927925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1927928">//&nbsp;can&nbsp;send&nbsp;to&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1927951">if</span>&nbsp;<span class="ident" id="1927954"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1927966">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1927970"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1927981">(</span><span class="ident" id="1927982"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1927989">(</span><span class="ident" id="1927990"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927991">,</span>&nbsp;<span class="ident" id="1927993"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1927994">.</span><span class="ident" id="1927995">sendx</span><span class="op" id="1928000">)</span><span class="op" id="1928001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928005"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1928016">(</span><span class="ident" id="1928017"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1928024">(</span><span class="ident" id="1928025"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928026">,</span>&nbsp;<span class="ident" id="1928028"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928029">.</span><span class="ident" id="1928030">sendx</span><span class="op" id="1928035">)</span><span class="op" id="1928036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928040"><a href="/runtime/race0.go.html#1906583">raceReadObjectPC</a></span><span class="op" id="1928056">(</span><span class="ident" id="1928057"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928058">.</span><span class="ident" id="1928059">elemtype</span><span class="op" id="1928067">,</span>&nbsp;<span class="ident" id="1928069"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928072">.</span><span class="ident" id="1928073">elem</span><span class="op" id="1928077">,</span>&nbsp;<span class="ident" id="1928079"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928082">.</span><span class="ident" id="1928083">pc</span><span class="op" id="1928085">,</span>&nbsp;<span class="ident" id="1928087"><a href="/runtime/select.go.html#1916199">chansendpc</a></span><span class="op" id="1928097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928103"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1928110">(</span><span class="ident" id="1928111"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1928118">(</span><span class="ident" id="1928119"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928120">,</span>&nbsp;<span class="ident" id="1928122"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928123">.</span><span class="ident" id="1928124">sendx</span><span class="op" id="1928129">)</span><span class="op" id="1928130">,</span>&nbsp;<span class="ident" id="1928132"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928135">.</span><span class="ident" id="1928136">elem</span><span class="op" id="1928140">,</span>&nbsp;<span class="builtintype" id="1928142">uintptr</span><span class="op" id="1928149">(</span><span class="ident" id="1928150"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928151">.</span><span class="ident" id="1928152">elemsize</span><span class="op" id="1928160">)</span><span class="op" id="1928161">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928164"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928165">.</span><span class="ident" id="1928166">sendx</span><span class="op" id="1928171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928175">if</span>&nbsp;<span class="ident" id="1928178"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928179">.</span><span class="ident" id="1928180">sendx</span>&nbsp;<span class="op" id="1928186">==</span>&nbsp;<span class="ident" id="1928189"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928190">.</span><span class="ident" id="1928191">dataqsiz</span>&nbsp;<span class="op" id="1928200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928204"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928205">.</span><span class="ident" id="1928206">sendx</span>&nbsp;<span class="op" id="1928212">=</span>&nbsp;<span class="num" id="1928214">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928220"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928221">.</span><span class="ident" id="1928222">qcount</span><span class="op" id="1928228">++</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928232"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1928235">=</span>&nbsp;<span class="ident" id="1928237"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928238">.</span><span class="ident" id="1928239">recvq</span><span class="op" id="1928244">.</span><span class="ident" id="1928245">dequeue</span><span class="op" id="1928252">(</span><span class="op" id="1928253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928256">if</span>&nbsp;<span class="ident" id="1928259"><a href="/runtime/select.go.html#1923812">sg</a></span>&nbsp;<span class="op" id="1928262">!=</span>&nbsp;<span class="ident" id="1928265">nil</span>&nbsp;<span class="op" id="1928269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928273"><a href="/runtime/select.go.html#1923784">gp</a></span>&nbsp;<span class="op" id="1928276">=</span>&nbsp;<span class="ident" id="1928278"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928280">.</span><span class="ident" id="1928281">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928285"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1928294">(</span><span class="ident" id="1928295"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1928298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928302">if</span>&nbsp;<span class="ident" id="1928305"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928307">.</span><span class="ident" id="1928308">releasetime</span>&nbsp;<span class="op" id="1928320">!=</span>&nbsp;<span class="num" id="1928323">0</span>&nbsp;<span class="op" id="1928325">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928330"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928332">.</span><span class="ident" id="1928333">releasetime</span>&nbsp;<span class="op" id="1928345">=</span>&nbsp;<span class="ident" id="1928347"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1928355">(</span><span class="op" id="1928356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928364"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1928371">(</span><span class="ident" id="1928372"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1928374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928377">}</span>&nbsp;<span class="keyword" id="1928379">else</span>&nbsp;<span class="op" id="1928384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928388"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1928397">(</span><span class="ident" id="1928398"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1928401">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928407">goto</span>&nbsp;<span class="ident" id="1928412">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1928418">syncrecv</span><span class="op" id="1928426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1928429">//&nbsp;can&nbsp;receive&nbsp;from&nbsp;sleeping&nbsp;sender&nbsp;(sg)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928471">if</span>&nbsp;<span class="ident" id="1928474"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1928486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928490">if</span>&nbsp;<span class="ident" id="1928493"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928496">.</span><span class="ident" id="1928497">elem</span>&nbsp;<span class="op" id="1928502">!=</span>&nbsp;<span class="ident" id="1928505">nil</span>&nbsp;<span class="op" id="1928509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928514"><a href="/runtime/race0.go.html#1906679">raceWriteObjectPC</a></span><span class="op" id="1928531">(</span><span class="ident" id="1928532"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928533">.</span><span class="ident" id="1928534">elemtype</span><span class="op" id="1928542">,</span>&nbsp;<span class="ident" id="1928544"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928547">.</span><span class="ident" id="1928548">elem</span><span class="op" id="1928552">,</span>&nbsp;<span class="ident" id="1928554"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928557">.</span><span class="ident" id="1928558">pc</span><span class="op" id="1928560">,</span>&nbsp;<span class="ident" id="1928562"><a href="/runtime/select.go.html#1916230">chanrecvpc</a></span><span class="op" id="1928572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928580"><a href="/runtime/chan.go.html#1736215">racesync</a></span><span class="op" id="1928588">(</span><span class="ident" id="1928589"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928590">,</span>&nbsp;<span class="ident" id="1928592"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928594">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928600"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1928609">(</span><span class="ident" id="1928610"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1928613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928616">if</span>&nbsp;<span class="ident" id="1928619"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1928631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1928635">print</span><span class="op" id="1928640">(</span><span class="string" id="1928641">&#34;syncrecv:&nbsp;sel=&#34;</span><span class="op" id="1928657">,</span>&nbsp;<span class="ident" id="1928659"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1928662">,</span>&nbsp;<span class="string" id="1928664">&#34;&nbsp;c=&#34;</span><span class="op" id="1928669">,</span>&nbsp;<span class="ident" id="1928671"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928672">,</span>&nbsp;<span class="string" id="1928674">&#34;\n&#34;</span><span class="op" id="1928678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928681">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928684">if</span>&nbsp;<span class="ident" id="1928687"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928690">.</span><span class="ident" id="1928691">receivedp</span>&nbsp;<span class="op" id="1928701">!=</span>&nbsp;<span class="ident" id="1928704">nil</span>&nbsp;<span class="op" id="1928708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928712">*</span><span class="ident" id="1928713"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928716">.</span><span class="ident" id="1928717">receivedp</span>&nbsp;<span class="op" id="1928727">=</span>&nbsp;<span class="ident" id="1928729">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928738">if</span>&nbsp;<span class="ident" id="1928741"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928744">.</span><span class="ident" id="1928745">elem</span>&nbsp;<span class="op" id="1928750">!=</span>&nbsp;<span class="ident" id="1928753">nil</span>&nbsp;<span class="op" id="1928757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928761"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1928768">(</span><span class="ident" id="1928769"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1928772">.</span><span class="ident" id="1928773">elem</span><span class="op" id="1928777">,</span>&nbsp;<span class="ident" id="1928779"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928781">.</span><span class="ident" id="1928782">elem</span><span class="op" id="1928786">,</span>&nbsp;<span class="builtintype" id="1928788">uintptr</span><span class="op" id="1928795">(</span><span class="ident" id="1928796"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1928797">.</span><span class="ident" id="1928798">elemsize</span><span class="op" id="1928806">)</span><span class="op" id="1928807">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928813"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928815">.</span><span class="ident" id="1928816">elem</span>&nbsp;<span class="op" id="1928821">=</span>&nbsp;<span class="ident" id="1928823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928828"><a href="/runtime/select.go.html#1923784">gp</a></span>&nbsp;<span class="op" id="1928831">=</span>&nbsp;<span class="ident" id="1928833"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928835">.</span><span class="ident" id="1928836">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928839"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1928841">.</span><span class="ident" id="1928842">param</span>&nbsp;<span class="op" id="1928848">=</span>&nbsp;<span class="ident" id="1928850"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1928856">.</span><span class="ident" id="1928857">Pointer</span><span class="op" id="1928864">(</span><span class="ident" id="1928865"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928870">if</span>&nbsp;<span class="ident" id="1928873"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928875">.</span><span class="ident" id="1928876">releasetime</span>&nbsp;<span class="op" id="1928888">!=</span>&nbsp;<span class="num" id="1928891">0</span>&nbsp;<span class="op" id="1928893">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928897"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1928899">.</span><span class="ident" id="1928900">releasetime</span>&nbsp;<span class="op" id="1928912">=</span>&nbsp;<span class="ident" id="1928914"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1928922">(</span><span class="op" id="1928923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1928926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928929"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1928936">(</span><span class="ident" id="1928937"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1928939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1928942">goto</span>&nbsp;<span class="ident" id="1928947">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="ident" id="1928953">rclose</span><span class="op" id="1928959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1928962">//&nbsp;read&nbsp;at&nbsp;end&nbsp;of&nbsp;closed&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1928996"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1929005">(</span><span class="ident" id="1929006"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1929009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929012">if</span>&nbsp;<span class="ident" id="1929015"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929018">.</span><span class="ident" id="1929019">receivedp</span>&nbsp;<span class="op" id="1929029">!=</span>&nbsp;<span class="ident" id="1929032">nil</span>&nbsp;<span class="op" id="1929036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929040">*</span><span class="ident" id="1929041"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929044">.</span><span class="ident" id="1929045">receivedp</span>&nbsp;<span class="op" id="1929055">=</span>&nbsp;<span class="ident" id="1929057">false</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929067">if</span>&nbsp;<span class="ident" id="1929070"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929073">.</span><span class="ident" id="1929074">elem</span>&nbsp;<span class="op" id="1929079">!=</span>&nbsp;<span class="ident" id="1929082">nil</span>&nbsp;<span class="op" id="1929086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929090"><a href="/runtime/stubs.go.html#1972552">memclr</a></span><span class="op" id="1929096">(</span><span class="ident" id="1929097"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929100">.</span><span class="ident" id="1929101">elem</span><span class="op" id="1929105">,</span>&nbsp;<span class="builtintype" id="1929107">uintptr</span><span class="op" id="1929114">(</span><span class="ident" id="1929115"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929116">.</span><span class="ident" id="1929117">elemsize</span><span class="op" id="1929125">)</span><span class="op" id="1929126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929132">if</span>&nbsp;<span class="ident" id="1929135"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1929147">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929151"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1929162">(</span><span class="ident" id="1929163"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1929169">.</span><span class="ident" id="1929170">Pointer</span><span class="op" id="1929177">(</span><span class="ident" id="1929178"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929179">)</span><span class="op" id="1929180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929186">goto</span>&nbsp;<span class="ident" id="1929191">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1929197">syncsend</span><span class="op" id="1929205">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1929208">//&nbsp;can&nbsp;send&nbsp;to&nbsp;sleeping&nbsp;receiver&nbsp;(sg)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929247">if</span>&nbsp;<span class="ident" id="1929250"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1929262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929266"><a href="/runtime/race0.go.html#1906583">raceReadObjectPC</a></span><span class="op" id="1929282">(</span><span class="ident" id="1929283"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929284">.</span><span class="ident" id="1929285">elemtype</span><span class="op" id="1929293">,</span>&nbsp;<span class="ident" id="1929295"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929298">.</span><span class="ident" id="1929299">elem</span><span class="op" id="1929303">,</span>&nbsp;<span class="ident" id="1929305"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929308">.</span><span class="ident" id="1929309">pc</span><span class="op" id="1929311">,</span>&nbsp;<span class="ident" id="1929313"><a href="/runtime/select.go.html#1916199">chansendpc</a></span><span class="op" id="1929323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929327"><a href="/runtime/chan.go.html#1736215">racesync</a></span><span class="op" id="1929335">(</span><span class="ident" id="1929336"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929337">,</span>&nbsp;<span class="ident" id="1929339"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929344">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929347"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1929356">(</span><span class="ident" id="1929357"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1929360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929363">if</span>&nbsp;<span class="ident" id="1929366"><a href="/runtime/select.go.html#1916169">debugSelect</a></span>&nbsp;<span class="op" id="1929378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1929382">print</span><span class="op" id="1929387">(</span><span class="string" id="1929388">&#34;syncsend:&nbsp;sel=&#34;</span><span class="op" id="1929404">,</span>&nbsp;<span class="ident" id="1929406"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1929409">,</span>&nbsp;<span class="string" id="1929411">&#34;&nbsp;c=&#34;</span><span class="op" id="1929416">,</span>&nbsp;<span class="ident" id="1929418"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929419">,</span>&nbsp;<span class="string" id="1929421">&#34;\n&#34;</span><span class="op" id="1929425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929431">if</span>&nbsp;<span class="ident" id="1929434"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929436">.</span><span class="ident" id="1929437">elem</span>&nbsp;<span class="op" id="1929442">!=</span>&nbsp;<span class="ident" id="1929445">nil</span>&nbsp;<span class="op" id="1929449">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929453"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1929460">(</span><span class="ident" id="1929461"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929463">.</span><span class="ident" id="1929464">elem</span><span class="op" id="1929468">,</span>&nbsp;<span class="ident" id="1929470"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929473">.</span><span class="ident" id="1929474">elem</span><span class="op" id="1929478">,</span>&nbsp;<span class="builtintype" id="1929480">uintptr</span><span class="op" id="1929487">(</span><span class="ident" id="1929488"><a href="/runtime/select.go.html#1923828">c</a></span><span class="op" id="1929489">.</span><span class="ident" id="1929490">elemsize</span><span class="op" id="1929498">)</span><span class="op" id="1929499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929505"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929507">.</span><span class="ident" id="1929508">elem</span>&nbsp;<span class="op" id="1929513">=</span>&nbsp;<span class="ident" id="1929515">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929520"><a href="/runtime/select.go.html#1923784">gp</a></span>&nbsp;<span class="op" id="1929523">=</span>&nbsp;<span class="ident" id="1929525"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929527">.</span><span class="ident" id="1929528">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929531"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1929533">.</span><span class="ident" id="1929534">param</span>&nbsp;<span class="op" id="1929540">=</span>&nbsp;<span class="ident" id="1929542"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1929548">.</span><span class="ident" id="1929549">Pointer</span><span class="op" id="1929556">(</span><span class="ident" id="1929557"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929559">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929562">if</span>&nbsp;<span class="ident" id="1929565"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929567">.</span><span class="ident" id="1929568">releasetime</span>&nbsp;<span class="op" id="1929580">!=</span>&nbsp;<span class="num" id="1929583">0</span>&nbsp;<span class="op" id="1929585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929589"><a href="/runtime/select.go.html#1923812">sg</a></span><span class="op" id="1929591">.</span><span class="ident" id="1929592">releasetime</span>&nbsp;<span class="op" id="1929604">=</span>&nbsp;<span class="ident" id="1929606"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1929614">(</span><span class="op" id="1929615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929621"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1929628">(</span><span class="ident" id="1929629"><a href="/runtime/select.go.html#1923784">gp</a></span><span class="op" id="1929631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">565</span><span class="ident" id="1929634">retc</span><span class="op" id="1929638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929641">if</span>&nbsp;<span class="ident" id="1929644"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929647">.</span><span class="ident" id="1929648">releasetime</span>&nbsp;<span class="op" id="1929660">&gt;</span>&nbsp;<span class="num" id="1929662">0</span>&nbsp;<span class="op" id="1929664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929668"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1929678">(</span><span class="ident" id="1929679"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929682">.</span><span class="ident" id="1929683">releasetime</span><span class="op" id="1929694">-</span><span class="ident" id="1929695"><a href="/runtime/select.go.html#1921699">t0</a></span><span class="op" id="1929697">,</span>&nbsp;<span class="num" id="1929699">2</span><span class="op" id="1929700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1929703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929706">return</span>&nbsp;<span class="ident" id="1929713"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929716">.</span><span class="ident" id="1929717">pc</span><span class="op" id="1929719">,</span>&nbsp;<span class="ident" id="1929721"><a href="/runtime/select.go.html#1923969">cas</a></span><span class="op" id="1929724">.</span><span class="ident" id="1929725">so</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="ident" id="1929729">sclose</span><span class="op" id="1929735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1929738">//&nbsp;send&nbsp;on&nbsp;closed&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1929765"><a href="/runtime/select.go.html#1919961">selunlock</a></span><span class="op" id="1929774">(</span><span class="ident" id="1929775"><a href="/runtime/select.go.html#1921463">sel</a></span><span class="op" id="1929778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1929781">panic</span><span class="op" id="1929786">(</span><span class="string" id="1929787">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1929811">)</span><br>
<span class="lineno">575</span><span class="op" id="1929813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1929816">func</span>&nbsp;<span class="op" id="1929821">(</span><span class="ident" id="1929822">c</span>&nbsp;<span class="op" id="1929824">*</span><span class="ident" id="1929825"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1929830">)</span>&nbsp;<span class="ident" id="1929832">sortkey</span><span class="op" id="1929839">(</span><span class="op" id="1929840">)</span>&nbsp;<span class="builtintype" id="1929842">uintptr</span>&nbsp;<span class="op" id="1929850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1929853">//&nbsp;TODO(khr):&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;moving&nbsp;garbage&nbsp;collector,&nbsp;we&#39;ll&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1929921">//&nbsp;change&nbsp;this&nbsp;function.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1929947">return</span>&nbsp;<span class="builtintype" id="1929954">uintptr</span><span class="op" id="1929961">(</span><span class="ident" id="1929962"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1929968">.</span><span class="ident" id="1929969">Pointer</span><span class="op" id="1929976">(</span><span class="ident" id="1929977"><a href="/runtime/select.go.html#1929822">c</a></span><span class="op" id="1929978">)</span><span class="op" id="1929979">)</span><br>
<span class="lineno"></span><span class="op" id="1929981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1929984">//&nbsp;A&nbsp;runtimeSelect&nbsp;is&nbsp;a&nbsp;single&nbsp;case&nbsp;passed&nbsp;to&nbsp;rselect.</span><br>
<span class="lineno"></span><span class="comment" id="1930039">//&nbsp;This&nbsp;must&nbsp;match&nbsp;../reflect/value.go:/runtimeSelect</span><br>
<span class="lineno">585</span><span class="keyword" id="1930093">type</span>&nbsp;<span class="ident" id="1930098">runtimeSelect</span>&nbsp;<span class="keyword" id="1930112">struct</span>&nbsp;<span class="op" id="1930119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930122">dir</span>&nbsp;<span class="ident" id="1930126"><a href="/runtime/select.go.html#1930366">selectDir</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930137">typ</span>&nbsp;<span class="ident" id="1930141"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1930147">.</span><span class="ident" id="1930148">Pointer</span>&nbsp;<span class="comment" id="1930156">//&nbsp;channel&nbsp;type&nbsp;(not&nbsp;used&nbsp;here)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930189">ch</span>&nbsp;&nbsp;<span class="op" id="1930193">*</span><span class="ident" id="1930194"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1930208">//&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930220">val</span>&nbsp;<span class="ident" id="1930224"><a href="/runtime/select.go.html#1916150">unsafe</a></span><span class="op" id="1930230">.</span><span class="ident" id="1930231">Pointer</span>&nbsp;<span class="comment" id="1930239">//&nbsp;ptr&nbsp;to&nbsp;data&nbsp;(SendDir)&nbsp;or&nbsp;ptr&nbsp;to&nbsp;receive&nbsp;buffer&nbsp;(RecvDir)</span><br>
<span class="lineno">590</span><span class="op" id="1930299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1930302">//&nbsp;These&nbsp;values&nbsp;must&nbsp;match&nbsp;../reflect/value.go:/SelectDir.</span><br>
<span class="lineno"></span><span class="keyword" id="1930361">type</span>&nbsp;<span class="ident" id="1930366">selectDir</span>&nbsp;<span class="builtintype" id="1930376">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="keyword" id="1930381">const</span>&nbsp;<span class="op" id="1930387">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930390">_</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1930404"><a href="/runtime/select.go.html#1930366">selectDir</a></span>&nbsp;<span class="op" id="1930414">=</span>&nbsp;<span class="ident" id="1930416">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930422">selectSend</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1930446">//&nbsp;case&nbsp;Chan&nbsp;&lt;-&nbsp;Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930468">selectRecv</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1930492">//&nbsp;case&nbsp;&lt;-Chan:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930509">selectDefault</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1930533">//&nbsp;default</span><br>
<span class="lineno">600</span><span class="op" id="1930544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1930547">func</span>&nbsp;<span class="ident" id="1930552">reflect_rselect</span><span class="op" id="1930567">(</span><span class="ident" id="1930568">cases</span>&nbsp;<span class="op" id="1930574">[</span><span class="op" id="1930575">]</span><span class="ident" id="1930576"><a href="/runtime/select.go.html#1930098">runtimeSelect</a></span><span class="op" id="1930589">)</span>&nbsp;<span class="op" id="1930591">(</span><span class="ident" id="1930592">chosen</span>&nbsp;<span class="builtintype" id="1930599">int</span><span class="op" id="1930602">,</span>&nbsp;<span class="ident" id="1930604">recvOK</span>&nbsp;<span class="builtintype" id="1930611">bool</span><span class="op" id="1930615">)</span>&nbsp;<span class="op" id="1930617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1930620">//&nbsp;flagNoScan&nbsp;is&nbsp;safe&nbsp;here,&nbsp;because&nbsp;all&nbsp;objects&nbsp;are&nbsp;also&nbsp;referenced&nbsp;from&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930701">size</span>&nbsp;<span class="op" id="1930706">:=</span>&nbsp;<span class="ident" id="1930709"><a href="/runtime/select.go.html#1916268">selectsize</a></span><span class="op" id="1930719">(</span><span class="builtintype" id="1930720">uintptr</span><span class="op" id="1930727">(</span><span class="builtinfunc" id="1930728">len</span><span class="op" id="1930731">(</span><span class="ident" id="1930732"><a href="/runtime/select.go.html#1930568">cases</a></span><span class="op" id="1930737">)</span><span class="op" id="1930738">)</span><span class="op" id="1930739">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930742">sel</span>&nbsp;<span class="op" id="1930746">:=</span>&nbsp;<span class="op" id="1930749">(</span><span class="op" id="1930750">*</span><span class="ident" id="1930751"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026954">_select</a></span><span class="op" id="1930758">)</span><span class="op" id="1930759">(</span><span class="ident" id="1930760"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1930768">(</span><span class="ident" id="1930769"><a href="/runtime/select.go.html#1930701">size</a></span><span class="op" id="1930773">,</span>&nbsp;<span class="ident" id="1930775">nil</span><span class="op" id="1930778">,</span>&nbsp;<span class="ident" id="1930780"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><span class="op" id="1930790">)</span><span class="op" id="1930791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930794"><a href="/runtime/select.go.html#1916521">newselect</a></span><span class="op" id="1930803">(</span><span class="ident" id="1930804"><a href="/runtime/select.go.html#1930742">sel</a></span><span class="op" id="1930807">,</span>&nbsp;<span class="ident" id="1930809">int64</span><span class="op" id="1930814">(</span><span class="ident" id="1930815"><a href="/runtime/select.go.html#1930701">size</a></span><span class="op" id="1930819">)</span><span class="op" id="1930820">,</span>&nbsp;<span class="builtintype" id="1930822">int32</span><span class="op" id="1930827">(</span><span class="builtinfunc" id="1930828">len</span><span class="op" id="1930831">(</span><span class="ident" id="1930832"><a href="/runtime/select.go.html#1930568">cases</a></span><span class="op" id="1930837">)</span><span class="op" id="1930838">)</span><span class="op" id="1930839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930842">r</span>&nbsp;<span class="op" id="1930844">:=</span>&nbsp;<span class="builtinfunc" id="1930847">new</span><span class="op" id="1930850">(</span><span class="builtintype" id="1930851">bool</span><span class="op" id="1930855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1930858">for</span>&nbsp;<span class="ident" id="1930862">i</span>&nbsp;<span class="op" id="1930864">:=</span>&nbsp;<span class="keyword" id="1930867">range</span>&nbsp;<span class="ident" id="1930873"><a href="/runtime/select.go.html#1930568">cases</a></span>&nbsp;<span class="op" id="1930879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930883">rc</span>&nbsp;<span class="op" id="1930886">:=</span>&nbsp;<span class="op" id="1930889">&amp;</span><span class="ident" id="1930890"><a href="/runtime/select.go.html#1930568">cases</a></span><span class="op" id="1930895">[</span><span class="ident" id="1930896"><a href="/runtime/select.go.html#1930862">i</a></span><span class="op" id="1930897">]</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1930901">switch</span>&nbsp;<span class="ident" id="1930908"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1930910">.</span><span class="ident" id="1930911">dir</span>&nbsp;<span class="op" id="1930915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1930919">case</span>&nbsp;<span class="ident" id="1930924"><a href="/runtime/select.go.html#1930509">selectDefault</a></span><span class="op" id="1930937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1930942"><a href="/runtime/select.go.html#1919233">selectdefaultImpl</a></span><span class="op" id="1930959">(</span><span class="ident" id="1930960"><a href="/runtime/select.go.html#1930742">sel</a></span><span class="op" id="1930963">,</span>&nbsp;<span class="builtintype" id="1930965">uintptr</span><span class="op" id="1930972">(</span><span class="ident" id="1930973"><a href="/runtime/select.go.html#1930862">i</a></span><span class="op" id="1930974">)</span><span class="op" id="1930975">,</span>&nbsp;<span class="num" id="1930977">0</span><span class="op" id="1930978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1930982">case</span>&nbsp;<span class="ident" id="1930987"><a href="/runtime/select.go.html#1930422">selectSend</a></span><span class="op" id="1930997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931002">if</span>&nbsp;<span class="ident" id="1931005"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931007">.</span><span class="ident" id="1931008">ch</span>&nbsp;<span class="op" id="1931011">==</span>&nbsp;<span class="ident" id="1931014">nil</span>&nbsp;<span class="op" id="1931018">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931024">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931038"><a href="/runtime/select.go.html#1917420">selectsendImpl</a></span><span class="op" id="1931052">(</span><span class="ident" id="1931053"><a href="/runtime/select.go.html#1930742">sel</a></span><span class="op" id="1931056">,</span>&nbsp;<span class="ident" id="1931058"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931060">.</span><span class="ident" id="1931061">ch</span><span class="op" id="1931063">,</span>&nbsp;<span class="builtintype" id="1931065">uintptr</span><span class="op" id="1931072">(</span><span class="ident" id="1931073"><a href="/runtime/select.go.html#1930862">i</a></span><span class="op" id="1931074">)</span><span class="op" id="1931075">,</span>&nbsp;<span class="ident" id="1931077"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931079">.</span><span class="ident" id="1931080">val</span><span class="op" id="1931083">,</span>&nbsp;<span class="num" id="1931085">0</span><span class="op" id="1931086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931090">case</span>&nbsp;<span class="ident" id="1931095"><a href="/runtime/select.go.html#1930468">selectRecv</a></span><span class="op" id="1931105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931110">if</span>&nbsp;<span class="ident" id="1931113"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931115">.</span><span class="ident" id="1931116">ch</span>&nbsp;<span class="op" id="1931119">==</span>&nbsp;<span class="ident" id="1931122">nil</span>&nbsp;<span class="op" id="1931126">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931132">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931146"><a href="/runtime/select.go.html#1918504">selectrecvImpl</a></span><span class="op" id="1931160">(</span><span class="ident" id="1931161"><a href="/runtime/select.go.html#1930742">sel</a></span><span class="op" id="1931164">,</span>&nbsp;<span class="ident" id="1931166"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931168">.</span><span class="ident" id="1931169">ch</span><span class="op" id="1931171">,</span>&nbsp;<span class="builtintype" id="1931173">uintptr</span><span class="op" id="1931180">(</span><span class="ident" id="1931181"><a href="/runtime/select.go.html#1930862">i</a></span><span class="op" id="1931182">)</span><span class="op" id="1931183">,</span>&nbsp;<span class="ident" id="1931185"><a href="/runtime/select.go.html#1930883">rc</a></span><span class="op" id="1931187">.</span><span class="ident" id="1931188">val</span><span class="op" id="1931191">,</span>&nbsp;<span class="ident" id="1931193"><a href="/runtime/select.go.html#1930842">r</a></span><span class="op" id="1931194">,</span>&nbsp;<span class="num" id="1931196">0</span><span class="op" id="1931197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931204">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931208">pc</span><span class="op" id="1931210">,</span>&nbsp;<span class="ident" id="1931212">_</span>&nbsp;<span class="op" id="1931214">:=</span>&nbsp;<span class="ident" id="1931217"><a href="/runtime/select.go.html#1921450">selectgoImpl</a></span><span class="op" id="1931229">(</span><span class="ident" id="1931230"><a href="/runtime/select.go.html#1930742">sel</a></span><span class="op" id="1931233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931236"><a href="/runtime/select.go.html#1930592">chosen</a></span>&nbsp;<span class="op" id="1931243">=</span>&nbsp;<span class="builtintype" id="1931245">int</span><span class="op" id="1931248">(</span><span class="ident" id="1931249"><a href="/runtime/select.go.html#1931208">pc</a></span><span class="op" id="1931251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931254"><a href="/runtime/select.go.html#1930604">recvOK</a></span>&nbsp;<span class="op" id="1931261">=</span>&nbsp;<span class="op" id="1931263">*</span><span class="ident" id="1931264"><a href="/runtime/select.go.html#1930842">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931267">return</span><br>
<span class="lineno">630</span><span class="op" id="1931274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1931277">func</span>&nbsp;<span class="op" id="1931282">(</span><span class="ident" id="1931283">q</span>&nbsp;<span class="op" id="1931285">*</span><span class="ident" id="1931286"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026538">waitq</a></span><span class="op" id="1931291">)</span>&nbsp;<span class="ident" id="1931293">dequeueSudoG</span><span class="op" id="1931305">(</span><span class="ident" id="1931306">s</span>&nbsp;<span class="op" id="1931308">*</span><span class="ident" id="1931309"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1931314">)</span>&nbsp;<span class="op" id="1931316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931319">var</span>&nbsp;<span class="ident" id="1931323">prevsgp</span>&nbsp;<span class="op" id="1931331">*</span><span class="ident" id="1931332"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931339">l</span>&nbsp;<span class="op" id="1931341">:=</span>&nbsp;<span class="op" id="1931344">&amp;</span><span class="ident" id="1931345"><a href="/runtime/select.go.html#1931283">q</a></span><span class="op" id="1931346">.</span><span class="ident" id="1931347">first</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931354">for</span>&nbsp;<span class="op" id="1931358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931362">sgp</span>&nbsp;<span class="op" id="1931366">:=</span>&nbsp;<span class="op" id="1931369">*</span><span class="ident" id="1931370"><a href="/runtime/select.go.html#1931339">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931374">if</span>&nbsp;<span class="ident" id="1931377"><a href="/runtime/select.go.html#1931362">sgp</a></span>&nbsp;<span class="op" id="1931381">==</span>&nbsp;<span class="ident" id="1931384">nil</span>&nbsp;<span class="op" id="1931388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931402">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931406">if</span>&nbsp;<span class="ident" id="1931409"><a href="/runtime/select.go.html#1931362">sgp</a></span>&nbsp;<span class="op" id="1931413">==</span>&nbsp;<span class="ident" id="1931416"><a href="/runtime/select.go.html#1931306">s</a></span>&nbsp;<span class="op" id="1931418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931423">*</span><span class="ident" id="1931424"><a href="/runtime/select.go.html#1931339">l</a></span>&nbsp;<span class="op" id="1931426">=</span>&nbsp;<span class="ident" id="1931428"><a href="/runtime/select.go.html#1931362">sgp</a></span><span class="op" id="1931431">.</span><span class="ident" id="1931432">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931440">if</span>&nbsp;<span class="ident" id="1931443"><a href="/runtime/select.go.html#1931283">q</a></span><span class="op" id="1931444">.</span><span class="ident" id="1931445">last</span>&nbsp;<span class="op" id="1931450">==</span>&nbsp;<span class="ident" id="1931453"><a href="/runtime/select.go.html#1931362">sgp</a></span>&nbsp;<span class="op" id="1931457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931463"><a href="/runtime/select.go.html#1931283">q</a></span><span class="op" id="1931464">.</span><span class="ident" id="1931465">last</span>&nbsp;<span class="op" id="1931470">=</span>&nbsp;<span class="ident" id="1931472"><a href="/runtime/select.go.html#1931323">prevsgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931483">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931488"><a href="/runtime/select.go.html#1931306">s</a></span><span class="op" id="1931489">.</span><span class="ident" id="1931490">next</span>&nbsp;<span class="op" id="1931495">=</span>&nbsp;<span class="ident" id="1931497">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1931504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931517"><a href="/runtime/select.go.html#1931339">l</a></span>&nbsp;<span class="op" id="1931519">=</span>&nbsp;<span class="op" id="1931521">&amp;</span><span class="ident" id="1931522"><a href="/runtime/select.go.html#1931362">sgp</a></span><span class="op" id="1931525">.</span><span class="ident" id="1931526">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1931533"><a href="/runtime/select.go.html#1931323">prevsgp</a></span>&nbsp;<span class="op" id="1931541">=</span>&nbsp;<span class="ident" id="1931543"><a href="/runtime/select.go.html#1931362">sgp</a></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1931548">}</span><br>
<span class="lineno"></span><span class="op" id="1931550">}</span>
</div>
</body>
</html>
