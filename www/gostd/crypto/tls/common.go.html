<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4502241">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4502296">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4502350">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4502401">package</span>&nbsp;<span class="ident" id="4502409">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4502414">import</span>&nbsp;<span class="op" id="4502421">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502424">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502442">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502452">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502467">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502482">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502489">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502495">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502507">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502518">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4502526">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4502533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4502536">const</span>&nbsp;<span class="op" id="4502542">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502545">VersionSSL30</span>&nbsp;<span class="op" id="4502558">=</span>&nbsp;<span class="num" id="4502560">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502568">VersionTLS10</span>&nbsp;<span class="op" id="4502581">=</span>&nbsp;<span class="num" id="4502583">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502591">VersionTLS11</span>&nbsp;<span class="op" id="4502604">=</span>&nbsp;<span class="num" id="4502606">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502614">VersionTLS12</span>&nbsp;<span class="op" id="4502627">=</span>&nbsp;<span class="num" id="4502629">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4502636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4502639">const</span>&nbsp;<span class="op" id="4502645">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502648">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502664">=</span>&nbsp;<span class="num" id="4502666">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502679">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502716">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4502732">=</span>&nbsp;<span class="num" id="4502734">16384</span>&nbsp;<span class="op" id="4502740">+</span>&nbsp;<span class="num" id="4502742">2048</span>&nbsp;<span class="comment" id="4502747">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502785">recordHeaderLen</span>&nbsp;<span class="op" id="4502801">=</span>&nbsp;<span class="num" id="4502803">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502816">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502841">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502857">=</span>&nbsp;<span class="num" id="4502859">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502872">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502930">minVersion</span>&nbsp;<span class="op" id="4502941">=</span>&nbsp;<span class="ident" id="4502943">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502957">maxVersion</span>&nbsp;<span class="op" id="4502968">=</span>&nbsp;<span class="ident" id="4502970">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4502983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502986">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4503007">type</span>&nbsp;<span class="ident" id="4503012">recordType</span>&nbsp;<span class="builtintype" id="4503023">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4503030">const</span>&nbsp;<span class="op" id="4503036">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503039">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4503066">recordType</span>&nbsp;<span class="op" id="4503077">=</span>&nbsp;<span class="num" id="4503079">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503083">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503110">recordType</span>&nbsp;<span class="op" id="4503121">=</span>&nbsp;<span class="num" id="4503123">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503127">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503154">recordType</span>&nbsp;<span class="op" id="4503165">=</span>&nbsp;<span class="num" id="4503167">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503171">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4503198">recordType</span>&nbsp;<span class="op" id="4503209">=</span>&nbsp;<span class="num" id="4503211">23</span><br>
<span class="lineno">45</span><span class="op" id="4503214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503217">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4503249">const</span>&nbsp;<span class="op" id="4503255">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503258">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503281">uint8</span>&nbsp;<span class="op" id="4503287">=</span>&nbsp;<span class="num" id="4503289">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503292">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503315">uint8</span>&nbsp;<span class="op" id="4503321">=</span>&nbsp;<span class="num" id="4503323">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503326">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503349">uint8</span>&nbsp;<span class="op" id="4503355">=</span>&nbsp;<span class="num" id="4503357">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503360">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503383">uint8</span>&nbsp;<span class="op" id="4503389">=</span>&nbsp;<span class="num" id="4503391">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503395">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4503418">uint8</span>&nbsp;<span class="op" id="4503424">=</span>&nbsp;<span class="num" id="4503426">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503430">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4503453">uint8</span>&nbsp;<span class="op" id="4503459">=</span>&nbsp;<span class="num" id="4503461">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503465">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503488">uint8</span>&nbsp;<span class="op" id="4503494">=</span>&nbsp;<span class="num" id="4503496">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503500">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4503523">uint8</span>&nbsp;<span class="op" id="4503529">=</span>&nbsp;<span class="num" id="4503531">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503535">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4503558">uint8</span>&nbsp;<span class="op" id="4503564">=</span>&nbsp;<span class="num" id="4503566">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503570">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503593">uint8</span>&nbsp;<span class="op" id="4503599">=</span>&nbsp;<span class="num" id="4503601">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503605">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4503628">uint8</span>&nbsp;<span class="op" id="4503634">=</span>&nbsp;<span class="num" id="4503636">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503640">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503663">uint8</span>&nbsp;<span class="op" id="4503669">=</span>&nbsp;<span class="num" id="4503671">67</span>&nbsp;<span class="comment" id="4503674">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4503695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503698">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4503724">const</span>&nbsp;<span class="op" id="4503730">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503733">compressionNone</span>&nbsp;<span class="builtintype" id="4503749">uint8</span>&nbsp;<span class="op" id="4503755">=</span>&nbsp;<span class="num" id="4503757">0</span><br>
<span class="lineno"></span><span class="op" id="4503759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503762">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4503787">const</span>&nbsp;<span class="op" id="4503793">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503796">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503825">uint16</span>&nbsp;<span class="op" id="4503832">=</span>&nbsp;<span class="num" id="4503834">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503837">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503866">uint16</span>&nbsp;<span class="op" id="4503873">=</span>&nbsp;<span class="num" id="4503875">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503878">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503907">uint16</span>&nbsp;<span class="op" id="4503914">=</span>&nbsp;<span class="num" id="4503916">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503920">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4503949">uint16</span>&nbsp;<span class="op" id="4503956">=</span>&nbsp;<span class="num" id="4503958">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503962">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4503991">uint16</span>&nbsp;<span class="op" id="4503998">=</span>&nbsp;<span class="num" id="4504000">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504004">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4504033">uint16</span>&nbsp;<span class="op" id="4504040">=</span>&nbsp;<span class="num" id="4504042">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504046">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4504075">uint16</span>&nbsp;<span class="op" id="4504082">=</span>&nbsp;<span class="num" id="4504084">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504088">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4504117">uint16</span>&nbsp;<span class="op" id="4504124">=</span>&nbsp;<span class="num" id="4504126">13172</span>&nbsp;<span class="comment" id="4504132">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504154">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4504183">uint16</span>&nbsp;<span class="op" id="4504190">=</span>&nbsp;<span class="num" id="4504192">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4504199">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4504202">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4504239">const</span>&nbsp;<span class="op" id="4504245">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504248">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4504266">uint16</span>&nbsp;<span class="op" id="4504273">=</span>&nbsp;<span class="num" id="4504275">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4504282">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4504285">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4504355">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4504441">type</span>&nbsp;<span class="ident" id="4504446">CurveID</span>&nbsp;<span class="builtintype" id="4504454">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4504462">const</span>&nbsp;<span class="op" id="4504468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504471">CurveP256</span>&nbsp;<span class="ident" id="4504481">CurveID</span>&nbsp;<span class="op" id="4504489">=</span>&nbsp;<span class="num" id="4504491">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504495">CurveP384</span>&nbsp;<span class="ident" id="4504505">CurveID</span>&nbsp;<span class="op" id="4504513">=</span>&nbsp;<span class="num" id="4504515">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504519">CurveP521</span>&nbsp;<span class="ident" id="4504529">CurveID</span>&nbsp;<span class="op" id="4504537">=</span>&nbsp;<span class="num" id="4504539">25</span><br>
<span class="lineno"></span><span class="op" id="4504542">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4504545">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4504581">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4504667">const</span>&nbsp;<span class="op" id="4504673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504676">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4504700">uint8</span>&nbsp;<span class="op" id="4504706">=</span>&nbsp;<span class="num" id="4504708">0</span><br>
<span class="lineno">100</span><span class="op" id="4504710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4504713">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4504753">const</span>&nbsp;<span class="op" id="4504759">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504762">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4504777">uint8</span>&nbsp;<span class="op" id="4504783">=</span>&nbsp;<span class="num" id="4504785">1</span><br>
<span class="lineno">105</span><span class="op" id="4504787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4504790">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4504839">const</span>&nbsp;<span class="op" id="4504845">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504848">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504867">=</span>&nbsp;<span class="num" id="4504869">1</span>&nbsp;<span class="comment" id="4504871">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504911">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504930">=</span>&nbsp;<span class="num" id="4504932">2</span>&nbsp;<span class="comment" id="4504934">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504973">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4504992">=</span>&nbsp;<span class="num" id="4504994">3</span>&nbsp;<span class="comment" id="4504996">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505041">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4505060">=</span>&nbsp;<span class="num" id="4505062">4</span>&nbsp;<span class="comment" id="4505064">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505110">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505146">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505169">=</span>&nbsp;<span class="num" id="4505171">64</span>&nbsp;<span class="comment" id="4505174">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505251">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4505274">=</span>&nbsp;<span class="num" id="4505276">65</span>&nbsp;<span class="comment" id="4505279">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505353">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4505376">=</span>&nbsp;<span class="num" id="4505378">66</span>&nbsp;<span class="comment" id="4505381">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505458">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4505504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4505507">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4505567">const</span>&nbsp;<span class="op" id="4505573">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505576">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4505587">uint8</span>&nbsp;<span class="op" id="4505593">=</span>&nbsp;<span class="num" id="4505595">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505598">hashSHA256</span>&nbsp;<span class="builtintype" id="4505609">uint8</span>&nbsp;<span class="op" id="4505615">=</span>&nbsp;<span class="num" id="4505617">4</span><br>
<span class="lineno"></span><span class="op" id="4505619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4505622">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4505688">const</span>&nbsp;<span class="op" id="4505694">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505697">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4505712">uint8</span>&nbsp;<span class="op" id="4505718">=</span>&nbsp;<span class="num" id="4505720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505723">signatureECDSA</span>&nbsp;<span class="builtintype" id="4505738">uint8</span>&nbsp;<span class="op" id="4505744">=</span>&nbsp;<span class="num" id="4505746">3</span><br>
<span class="lineno"></span><span class="op" id="4505748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4505751">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4505830">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4505858">type</span>&nbsp;<span class="ident" id="4505863">signatureAndHash</span>&nbsp;<span class="keyword" id="4505880">struct</span>&nbsp;<span class="op" id="4505887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505890">hash</span><span class="op" id="4505894">,</span>&nbsp;<span class="ident" id="4505896">signature</span>&nbsp;<span class="builtintype" id="4505906">uint8</span><br>
<span class="lineno"></span><span class="op" id="4505912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4505915">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4505993">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4506060">var</span>&nbsp;<span class="ident" id="4506064">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4506096">=</span>&nbsp;<span class="op" id="4506098">[</span><span class="op" id="4506099">]</span><span class="ident" id="4506100">signatureAndHash</span><span class="op" id="4506116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506119">{</span><span class="ident" id="4506120">hashSHA256</span><span class="op" id="4506130">,</span>&nbsp;<span class="ident" id="4506132">signatureRSA</span><span class="op" id="4506144">}</span><span class="op" id="4506145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506148">{</span><span class="ident" id="4506149">hashSHA256</span><span class="op" id="4506159">,</span>&nbsp;<span class="ident" id="4506161">signatureECDSA</span><span class="op" id="4506175">}</span><span class="op" id="4506176">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506179">{</span><span class="ident" id="4506180">hashSHA1</span><span class="op" id="4506188">,</span>&nbsp;<span class="ident" id="4506190">signatureRSA</span><span class="op" id="4506202">}</span><span class="op" id="4506203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506206">{</span><span class="ident" id="4506207">hashSHA1</span><span class="op" id="4506215">,</span>&nbsp;<span class="ident" id="4506217">signatureECDSA</span><span class="op" id="4506231">}</span><span class="op" id="4506232">,</span><br>
<span class="lineno"></span><span class="op" id="4506234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4506237">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4506311">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4506376">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4506399">var</span>&nbsp;<span class="ident" id="4506403">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4506442">=</span>&nbsp;<span class="op" id="4506444">[</span><span class="op" id="4506445">]</span><span class="ident" id="4506446">signatureAndHash</span><span class="op" id="4506462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506465">{</span><span class="ident" id="4506466">hashSHA256</span><span class="op" id="4506476">,</span>&nbsp;<span class="ident" id="4506478">signatureRSA</span><span class="op" id="4506490">}</span><span class="op" id="4506491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506494">{</span><span class="ident" id="4506495">hashSHA256</span><span class="op" id="4506505">,</span>&nbsp;<span class="ident" id="4506507">signatureECDSA</span><span class="op" id="4506521">}</span><span class="op" id="4506522">,</span><br>
<span class="lineno">155</span><span class="op" id="4506524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4506527">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4506594">type</span>&nbsp;<span class="ident" id="4506599">ConnectionState</span>&nbsp;<span class="keyword" id="4506615">struct</span>&nbsp;<span class="op" id="4506622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506625">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4506652">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4506674">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506733">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4506760">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4506782">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506812">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4506839">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4506861">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506910">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4506937">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4506959">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507015">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4507042">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4507064">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507118">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4507145">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4507167">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507216">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4507243">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4507265">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507328">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4507355">[</span><span class="op" id="4507356">]</span><span class="op" id="4507357">*</span><span class="ident" id="4507358">x509</span><span class="op" id="4507362">.</span><span class="ident" id="4507363">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4507377">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507424">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4507451">[</span><span class="op" id="4507452">]</span><span class="op" id="4507453">[</span><span class="op" id="4507454">]</span><span class="op" id="4507455">*</span><span class="ident" id="4507456">x509</span><span class="op" id="4507460">.</span><span class="ident" id="4507461">Certificate</span>&nbsp;<span class="comment" id="4507473">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507522">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507593">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507659">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507719">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507792">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507858">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507892">TLSUnique</span>&nbsp;<span class="op" id="4507902">[</span><span class="op" id="4507903">]</span><span class="builtintype" id="4507904">byte</span><br>
<span class="lineno"></span><span class="op" id="4507909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507912">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4507977">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4508007">type</span>&nbsp;<span class="ident" id="4508012">ClientAuthType</span>&nbsp;<span class="builtintype" id="4508027">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4508032">const</span>&nbsp;<span class="op" id="4508038">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508041">NoClientCert</span>&nbsp;<span class="ident" id="4508054">ClientAuthType</span>&nbsp;<span class="op" id="4508069">=</span>&nbsp;<span class="ident" id="4508071">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508077">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508096">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508118">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508143">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4508170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4508173">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4508246">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4508259">type</span>&nbsp;<span class="ident" id="4508264">ClientSessionState</span>&nbsp;<span class="keyword" id="4508283">struct</span>&nbsp;<span class="op" id="4508290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508293">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508312">[</span><span class="op" id="4508313">]</span><span class="builtintype" id="4508314">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508332">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508393">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4508412">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508432">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508479">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4508498">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508518">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508561">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508580">[</span><span class="op" id="4508581">]</span><span class="builtintype" id="4508582">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508600">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508657">serverCertificates</span>&nbsp;<span class="op" id="4508676">[</span><span class="op" id="4508677">]</span><span class="op" id="4508678">*</span><span class="ident" id="4508679">x509</span><span class="op" id="4508683">.</span><span class="ident" id="4508684">Certificate</span>&nbsp;<span class="comment" id="4508696">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4508741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4508744">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4508824">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4508903">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4508977">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4508992">type</span>&nbsp;<span class="ident" id="4508997">ClientSessionCache</span>&nbsp;<span class="keyword" id="4509016">interface</span>&nbsp;<span class="op" id="4509026">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509029">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509102">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509146">Get</span><span class="op" id="4509149">(</span><span class="ident" id="4509150">sessionKey</span>&nbsp;<span class="builtintype" id="4509161">string</span><span class="op" id="4509167">)</span>&nbsp;<span class="op" id="4509169">(</span><span class="ident" id="4509170">session</span>&nbsp;<span class="op" id="4509178">*</span><span class="ident" id="4509179">ClientSessionState</span><span class="op" id="4509197">,</span>&nbsp;<span class="ident" id="4509199">ok</span>&nbsp;<span class="builtintype" id="4509202">bool</span><span class="op" id="4509206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509210">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509279">Put</span><span class="op" id="4509282">(</span><span class="ident" id="4509283">sessionKey</span>&nbsp;<span class="builtintype" id="4509294">string</span><span class="op" id="4509300">,</span>&nbsp;<span class="ident" id="4509302">cs</span>&nbsp;<span class="op" id="4509305">*</span><span class="ident" id="4509306">ClientSessionState</span><span class="op" id="4509324">)</span><br>
<span class="lineno"></span><span class="op" id="4509326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509329">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4509408">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4509471">type</span>&nbsp;<span class="ident" id="4509476">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4509492">struct</span>&nbsp;<span class="op" id="4509499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509502">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509572">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509603">CipherSuites</span>&nbsp;<span class="op" id="4509616">[</span><span class="op" id="4509617">]</span><span class="builtintype" id="4509618">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509627">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509699">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509770">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509799">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509852">ServerName</span>&nbsp;<span class="builtintype" id="4509863">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509872">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509943">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510008">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510041">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510096">SupportedCurves</span>&nbsp;<span class="op" id="4510112">[</span><span class="op" id="4510113">]</span><span class="ident" id="4510114">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510124">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510193">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510266">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510289">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510344">SupportedPoints</span>&nbsp;<span class="op" id="4510360">[</span><span class="op" id="4510361">]</span><span class="builtintype" id="4510362">uint8</span><br>
<span class="lineno"></span><span class="op" id="4510368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510371">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4510438">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4510500">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4510567">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4510581">type</span>&nbsp;<span class="ident" id="4510586">Config</span>&nbsp;<span class="keyword" id="4510593">struct</span>&nbsp;<span class="op" id="4510600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510603">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510672">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510744">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510761">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510821">Rand</span>&nbsp;<span class="ident" id="4510826">io</span><span class="op" id="4510828">.</span><span class="ident" id="4510829">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510838">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510914">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510953">Time</span>&nbsp;<span class="keyword" id="4510958">func</span><span class="op" id="4510962">(</span><span class="op" id="4510963">)</span>&nbsp;<span class="ident" id="4510965">time</span><span class="op" id="4510969">.</span><span class="ident" id="4510970">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510977">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511034">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511086">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511151">Certificates</span>&nbsp;<span class="op" id="4511164">[</span><span class="op" id="4511165">]</span><span class="ident" id="4511166">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511180">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511248">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511314">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511383">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511421">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511491">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511516">NameToCertificate</span>&nbsp;<span class="keyword" id="4511534">map</span><span class="op" id="4511537">[</span><span class="builtintype" id="4511538">string</span><span class="op" id="4511544">]</span><span class="op" id="4511545">*</span><span class="ident" id="4511546">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511560">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511620">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511691">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511747">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511819">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511829">GetCertificate</span>&nbsp;<span class="keyword" id="4511844">func</span><span class="op" id="4511848">(</span><span class="ident" id="4511849">clientHello</span>&nbsp;<span class="op" id="4511861">*</span><span class="ident" id="4511862">ClientHelloInfo</span><span class="op" id="4511877">)</span>&nbsp;<span class="op" id="4511879">(</span><span class="op" id="4511880">*</span><span class="ident" id="4511881">Certificate</span><span class="op" id="4511892">,</span>&nbsp;<span class="builtintype" id="4511894">error</span><span class="op" id="4511899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511903">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511963">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512020">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512076">RootCAs</span>&nbsp;<span class="op" id="4512084">*</span><span class="ident" id="4512085">x509</span><span class="op" id="4512089">.</span><span class="ident" id="4512090">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512101">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512169">NextProtos</span>&nbsp;<span class="op" id="4512180">[</span><span class="op" id="4512181">]</span><span class="builtintype" id="4512182">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512191">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512253">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512326">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512384">ServerName</span>&nbsp;<span class="builtintype" id="4512395">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512404">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512454">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512514">ClientAuth</span>&nbsp;<span class="ident" id="4512525">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512542">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512604">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512668">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512701">ClientCAs</span>&nbsp;<span class="op" id="4512711">*</span><span class="ident" id="4512712">x509</span><span class="op" id="4512716">.</span><span class="ident" id="4512717">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512728">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512790">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512836">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512899">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512966">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513033">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513075">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4513094">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513101">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513172">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513243">CipherSuites</span>&nbsp;<span class="op" id="4513256">[</span><span class="op" id="4513257">]</span><span class="builtintype" id="4513258">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513267">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513336">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513408">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513479">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513531">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4513556">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513563">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513635">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513661">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4513684">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513691">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513754">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513816">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513867">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513871">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513941">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514000">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514063">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514111">SessionTicketKey</span>&nbsp;<span class="op" id="4514128">[</span><span class="num" id="4514129">32</span><span class="op" id="4514131">]</span><span class="builtintype" id="4514132">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514139">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514213">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514229">ClientSessionCache</span>&nbsp;<span class="ident" id="4514248">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514269">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514341">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514390">MinVersion</span>&nbsp;<span class="builtintype" id="4514401">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514410">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514482">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514555">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514587">MaxVersion</span>&nbsp;<span class="builtintype" id="4514598">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514607">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514678">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514750">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514763">CurvePreferences</span>&nbsp;<span class="op" id="4514780">[</span><span class="op" id="4514781">]</span><span class="ident" id="4514782">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514792">serverInitOnce</span>&nbsp;<span class="ident" id="4514807">sync</span><span class="op" id="4514811">.</span><span class="ident" id="4514812">Once</span>&nbsp;<span class="comment" id="4514817">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4514856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4514859">func</span>&nbsp;<span class="op" id="4514864">(</span><span class="ident" id="4514865">c</span>&nbsp;<span class="op" id="4514867">*</span><span class="ident" id="4514868">Config</span><span class="op" id="4514874">)</span>&nbsp;<span class="ident" id="4514876">serverInit</span><span class="op" id="4514886">(</span><span class="op" id="4514887">)</span>&nbsp;<span class="op" id="4514889">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514892">if</span>&nbsp;<span class="ident" id="4514895">c</span><span class="op" id="4514896">.</span><span class="ident" id="4514897">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4514920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4514932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4514936">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515000">for</span>&nbsp;<span class="ident" id="4515004">_</span><span class="op" id="4515005">,</span>&nbsp;<span class="ident" id="4515007">b</span>&nbsp;<span class="op" id="4515009">:=</span>&nbsp;<span class="keyword" id="4515012">range</span>&nbsp;<span class="ident" id="4515018">c</span><span class="op" id="4515019">.</span><span class="ident" id="4515020">SessionTicketKey</span>&nbsp;<span class="op" id="4515037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515041">if</span>&nbsp;<span class="ident" id="4515044">b</span>&nbsp;<span class="op" id="4515046">!=</span>&nbsp;<span class="num" id="4515049">0</span>&nbsp;<span class="op" id="4515051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515068">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515072">if</span>&nbsp;<span class="ident" id="4515075">_</span><span class="op" id="4515076">,</span>&nbsp;<span class="ident" id="4515078">err</span>&nbsp;<span class="op" id="4515082">:=</span>&nbsp;<span class="ident" id="4515085">io</span><span class="op" id="4515087">.</span><span class="ident" id="4515088">ReadFull</span><span class="op" id="4515096">(</span><span class="ident" id="4515097">c</span><span class="op" id="4515098">.</span><span class="ident" id="4515099">rand</span><span class="op" id="4515103">(</span><span class="op" id="4515104">)</span><span class="op" id="4515105">,</span>&nbsp;<span class="ident" id="4515107">c</span><span class="op" id="4515108">.</span><span class="ident" id="4515109">SessionTicketKey</span><span class="op" id="4515125">[</span><span class="op" id="4515126">:</span><span class="op" id="4515127">]</span><span class="op" id="4515128">)</span><span class="op" id="4515129">;</span>&nbsp;<span class="ident" id="4515131">err</span>&nbsp;<span class="op" id="4515135">!=</span>&nbsp;<span class="ident" id="4515138">nil</span>&nbsp;<span class="op" id="4515142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515146">c</span><span class="op" id="4515147">.</span><span class="ident" id="4515148">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4515171">=</span>&nbsp;<span class="builtintype" id="4515173">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515179">}</span><br>
<span class="lineno"></span><span class="op" id="4515181">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4515184">func</span>&nbsp;<span class="op" id="4515189">(</span><span class="ident" id="4515190">c</span>&nbsp;<span class="op" id="4515192">*</span><span class="ident" id="4515193">Config</span><span class="op" id="4515199">)</span>&nbsp;<span class="ident" id="4515201">rand</span><span class="op" id="4515205">(</span><span class="op" id="4515206">)</span>&nbsp;<span class="ident" id="4515208">io</span><span class="op" id="4515210">.</span><span class="ident" id="4515211">Reader</span>&nbsp;<span class="op" id="4515218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515221">r</span>&nbsp;<span class="op" id="4515223">:=</span>&nbsp;<span class="ident" id="4515226">c</span><span class="op" id="4515227">.</span><span class="ident" id="4515228">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515234">if</span>&nbsp;<span class="ident" id="4515237">r</span>&nbsp;<span class="op" id="4515239">==</span>&nbsp;<span class="ident" id="4515242">nil</span>&nbsp;<span class="op" id="4515246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515250">return</span>&nbsp;<span class="ident" id="4515257">rand</span><span class="op" id="4515261">.</span><span class="ident" id="4515262">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515273">return</span>&nbsp;<span class="ident" id="4515280">r</span><br>
<span class="lineno"></span><span class="op" id="4515282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4515285">func</span>&nbsp;<span class="op" id="4515290">(</span><span class="ident" id="4515291">c</span>&nbsp;<span class="op" id="4515293">*</span><span class="ident" id="4515294">Config</span><span class="op" id="4515300">)</span>&nbsp;<span class="ident" id="4515302">time</span><span class="op" id="4515306">(</span><span class="op" id="4515307">)</span>&nbsp;<span class="ident" id="4515309">time</span><span class="op" id="4515313">.</span><span class="ident" id="4515314">Time</span>&nbsp;<span class="op" id="4515319">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515322">t</span>&nbsp;<span class="op" id="4515324">:=</span>&nbsp;<span class="ident" id="4515327">c</span><span class="op" id="4515328">.</span><span class="ident" id="4515329">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515335">if</span>&nbsp;<span class="ident" id="4515338">t</span>&nbsp;<span class="op" id="4515340">==</span>&nbsp;<span class="ident" id="4515343">nil</span>&nbsp;<span class="op" id="4515347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515351">t</span>&nbsp;<span class="op" id="4515353">=</span>&nbsp;<span class="ident" id="4515355">time</span><span class="op" id="4515359">.</span><span class="ident" id="4515360">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515368">return</span>&nbsp;<span class="ident" id="4515375">t</span><span class="op" id="4515376">(</span><span class="op" id="4515377">)</span><br>
<span class="lineno">380</span><span class="op" id="4515379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4515382">func</span>&nbsp;<span class="op" id="4515387">(</span><span class="ident" id="4515388">c</span>&nbsp;<span class="op" id="4515390">*</span><span class="ident" id="4515391">Config</span><span class="op" id="4515397">)</span>&nbsp;<span class="ident" id="4515399">cipherSuites</span><span class="op" id="4515411">(</span><span class="op" id="4515412">)</span>&nbsp;<span class="op" id="4515414">[</span><span class="op" id="4515415">]</span><span class="builtintype" id="4515416">uint16</span>&nbsp;<span class="op" id="4515423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515426">s</span>&nbsp;<span class="op" id="4515428">:=</span>&nbsp;<span class="ident" id="4515431">c</span><span class="op" id="4515432">.</span><span class="ident" id="4515433">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515447">if</span>&nbsp;<span class="ident" id="4515450">s</span>&nbsp;<span class="op" id="4515452">==</span>&nbsp;<span class="ident" id="4515455">nil</span>&nbsp;<span class="op" id="4515459">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4515463">s</span>&nbsp;<span class="op" id="4515465">=</span>&nbsp;<span class="ident" id="4515467">defaultCipherSuites</span><span class="op" id="4515486">(</span><span class="op" id="4515487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515493">return</span>&nbsp;<span class="ident" id="4515500">s</span><br>
<span class="lineno"></span><span class="op" id="4515502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4515505">func</span>&nbsp;<span class="op" id="4515510">(</span><span class="ident" id="4515511">c</span>&nbsp;<span class="op" id="4515513">*</span><span class="ident" id="4515514">Config</span><span class="op" id="4515520">)</span>&nbsp;<span class="ident" id="4515522">minVersion</span><span class="op" id="4515532">(</span><span class="op" id="4515533">)</span>&nbsp;<span class="builtintype" id="4515535">uint16</span>&nbsp;<span class="op" id="4515542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515545">if</span>&nbsp;<span class="ident" id="4515548">c</span>&nbsp;<span class="op" id="4515550">==</span>&nbsp;<span class="ident" id="4515553">nil</span>&nbsp;<span class="op" id="4515557">||</span>&nbsp;<span class="ident" id="4515560">c</span><span class="op" id="4515561">.</span><span class="ident" id="4515562">MinVersion</span>&nbsp;<span class="op" id="4515573">==</span>&nbsp;<span class="num" id="4515576">0</span>&nbsp;<span class="op" id="4515578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515582">return</span>&nbsp;<span class="ident" id="4515589">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515604">return</span>&nbsp;<span class="ident" id="4515611">c</span><span class="op" id="4515612">.</span><span class="ident" id="4515613">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4515624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4515627">func</span>&nbsp;<span class="op" id="4515632">(</span><span class="ident" id="4515633">c</span>&nbsp;<span class="op" id="4515635">*</span><span class="ident" id="4515636">Config</span><span class="op" id="4515642">)</span>&nbsp;<span class="ident" id="4515644">maxVersion</span><span class="op" id="4515654">(</span><span class="op" id="4515655">)</span>&nbsp;<span class="builtintype" id="4515657">uint16</span>&nbsp;<span class="op" id="4515664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515667">if</span>&nbsp;<span class="ident" id="4515670">c</span>&nbsp;<span class="op" id="4515672">==</span>&nbsp;<span class="ident" id="4515675">nil</span>&nbsp;<span class="op" id="4515679">||</span>&nbsp;<span class="ident" id="4515682">c</span><span class="op" id="4515683">.</span><span class="ident" id="4515684">MaxVersion</span>&nbsp;<span class="op" id="4515695">==</span>&nbsp;<span class="num" id="4515698">0</span>&nbsp;<span class="op" id="4515700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515704">return</span>&nbsp;<span class="ident" id="4515711">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515726">return</span>&nbsp;<span class="ident" id="4515733">c</span><span class="op" id="4515734">.</span><span class="ident" id="4515735">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4515746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4515749">var</span>&nbsp;<span class="ident" id="4515753">defaultCurvePreferences</span>&nbsp;<span class="op" id="4515777">=</span>&nbsp;<span class="op" id="4515779">[</span><span class="op" id="4515780">]</span><span class="ident" id="4515781">CurveID</span><span class="op" id="4515788">{</span><span class="ident" id="4515789">CurveP256</span><span class="op" id="4515798">,</span>&nbsp;<span class="ident" id="4515800">CurveP384</span><span class="op" id="4515809">,</span>&nbsp;<span class="ident" id="4515811">CurveP521</span><span class="op" id="4515820">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4515823">func</span>&nbsp;<span class="op" id="4515828">(</span><span class="ident" id="4515829">c</span>&nbsp;<span class="op" id="4515831">*</span><span class="ident" id="4515832">Config</span><span class="op" id="4515838">)</span>&nbsp;<span class="ident" id="4515840">curvePreferences</span><span class="op" id="4515856">(</span><span class="op" id="4515857">)</span>&nbsp;<span class="op" id="4515859">[</span><span class="op" id="4515860">]</span><span class="ident" id="4515861">CurveID</span>&nbsp;<span class="op" id="4515869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515872">if</span>&nbsp;<span class="ident" id="4515875">c</span>&nbsp;<span class="op" id="4515877">==</span>&nbsp;<span class="ident" id="4515880">nil</span>&nbsp;<span class="op" id="4515884">||</span>&nbsp;<span class="builtinfunc" id="4515887">len</span><span class="op" id="4515890">(</span><span class="ident" id="4515891">c</span><span class="op" id="4515892">.</span><span class="ident" id="4515893">CurvePreferences</span><span class="op" id="4515909">)</span>&nbsp;<span class="op" id="4515911">==</span>&nbsp;<span class="num" id="4515914">0</span>&nbsp;<span class="op" id="4515916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515920">return</span>&nbsp;<span class="ident" id="4515927">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4515952">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4515955">return</span>&nbsp;<span class="ident" id="4515962">c</span><span class="op" id="4515963">.</span><span class="ident" id="4515964">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4515981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4515984">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4516058">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4516082">func</span>&nbsp;<span class="op" id="4516087">(</span><span class="ident" id="4516088">c</span>&nbsp;<span class="op" id="4516090">*</span><span class="ident" id="4516091">Config</span><span class="op" id="4516097">)</span>&nbsp;<span class="ident" id="4516099">mutualVersion</span><span class="op" id="4516112">(</span><span class="ident" id="4516113">vers</span>&nbsp;<span class="builtintype" id="4516118">uint16</span><span class="op" id="4516124">)</span>&nbsp;<span class="op" id="4516126">(</span><span class="builtintype" id="4516127">uint16</span><span class="op" id="4516133">,</span>&nbsp;<span class="builtintype" id="4516135">bool</span><span class="op" id="4516139">)</span>&nbsp;<span class="op" id="4516141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516144">minVersion</span>&nbsp;<span class="op" id="4516155">:=</span>&nbsp;<span class="ident" id="4516158">c</span><span class="op" id="4516159">.</span><span class="ident" id="4516160">minVersion</span><span class="op" id="4516170">(</span><span class="op" id="4516171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516174">maxVersion</span>&nbsp;<span class="op" id="4516185">:=</span>&nbsp;<span class="ident" id="4516188">c</span><span class="op" id="4516189">.</span><span class="ident" id="4516190">maxVersion</span><span class="op" id="4516200">(</span><span class="op" id="4516201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516205">if</span>&nbsp;<span class="ident" id="4516208">vers</span>&nbsp;<span class="op" id="4516213">&lt;</span>&nbsp;<span class="ident" id="4516215">minVersion</span>&nbsp;<span class="op" id="4516226">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516230">return</span>&nbsp;<span class="num" id="4516237">0</span><span class="op" id="4516238">,</span>&nbsp;<span class="builtintype" id="4516240">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516250">if</span>&nbsp;<span class="ident" id="4516253">vers</span>&nbsp;<span class="op" id="4516258">&gt;</span>&nbsp;<span class="ident" id="4516260">maxVersion</span>&nbsp;<span class="op" id="4516271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516275">vers</span>&nbsp;<span class="op" id="4516280">=</span>&nbsp;<span class="ident" id="4516282">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516294">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516297">return</span>&nbsp;<span class="ident" id="4516304">vers</span><span class="op" id="4516308">,</span>&nbsp;<span class="builtintype" id="4516310">true</span><br>
<span class="lineno"></span><span class="op" id="4516315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4516318">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4516396">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4516450">func</span>&nbsp;<span class="op" id="4516455">(</span><span class="ident" id="4516456">c</span>&nbsp;<span class="op" id="4516458">*</span><span class="ident" id="4516459">Config</span><span class="op" id="4516465">)</span>&nbsp;<span class="ident" id="4516467">getCertificate</span><span class="op" id="4516481">(</span><span class="ident" id="4516482">clientHello</span>&nbsp;<span class="op" id="4516494">*</span><span class="ident" id="4516495">ClientHelloInfo</span><span class="op" id="4516510">)</span>&nbsp;<span class="op" id="4516512">(</span><span class="op" id="4516513">*</span><span class="ident" id="4516514">Certificate</span><span class="op" id="4516525">,</span>&nbsp;<span class="builtintype" id="4516527">error</span><span class="op" id="4516532">)</span>&nbsp;<span class="op" id="4516534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516537">if</span>&nbsp;<span class="ident" id="4516540">c</span><span class="op" id="4516541">.</span><span class="ident" id="4516542">GetCertificate</span>&nbsp;<span class="op" id="4516557">!=</span>&nbsp;<span class="ident" id="4516560">nil</span>&nbsp;<span class="op" id="4516564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516568">cert</span><span class="op" id="4516572">,</span>&nbsp;<span class="ident" id="4516574">err</span>&nbsp;<span class="op" id="4516578">:=</span>&nbsp;<span class="ident" id="4516581">c</span><span class="op" id="4516582">.</span><span class="ident" id="4516583">GetCertificate</span><span class="op" id="4516597">(</span><span class="ident" id="4516598">clientHello</span><span class="op" id="4516609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516613">if</span>&nbsp;<span class="ident" id="4516616">cert</span>&nbsp;<span class="op" id="4516621">!=</span>&nbsp;<span class="ident" id="4516624">nil</span>&nbsp;<span class="op" id="4516628">||</span>&nbsp;<span class="ident" id="4516631">err</span>&nbsp;<span class="op" id="4516635">!=</span>&nbsp;<span class="ident" id="4516638">nil</span>&nbsp;<span class="op" id="4516642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516647">return</span>&nbsp;<span class="ident" id="4516654">cert</span><span class="op" id="4516658">,</span>&nbsp;<span class="ident" id="4516660">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516673">if</span>&nbsp;<span class="builtinfunc" id="4516676">len</span><span class="op" id="4516679">(</span><span class="ident" id="4516680">c</span><span class="op" id="4516681">.</span><span class="ident" id="4516682">Certificates</span><span class="op" id="4516694">)</span>&nbsp;<span class="op" id="4516696">==</span>&nbsp;<span class="num" id="4516699">1</span>&nbsp;<span class="op" id="4516701">||</span>&nbsp;<span class="ident" id="4516704">c</span><span class="op" id="4516705">.</span><span class="ident" id="4516706">NameToCertificate</span>&nbsp;<span class="op" id="4516724">==</span>&nbsp;<span class="ident" id="4516727">nil</span>&nbsp;<span class="op" id="4516731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4516735">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516793">return</span>&nbsp;<span class="op" id="4516800">&amp;</span><span class="ident" id="4516801">c</span><span class="op" id="4516802">.</span><span class="ident" id="4516803">Certificates</span><span class="op" id="4516815">[</span><span class="num" id="4516816">0</span><span class="op" id="4516817">]</span><span class="op" id="4516818">,</span>&nbsp;<span class="ident" id="4516820">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516829">name</span>&nbsp;<span class="op" id="4516834">:=</span>&nbsp;<span class="ident" id="4516837">strings</span><span class="op" id="4516844">.</span><span class="ident" id="4516845">ToLower</span><span class="op" id="4516852">(</span><span class="ident" id="4516853">clientHello</span><span class="op" id="4516864">.</span><span class="ident" id="4516865">ServerName</span><span class="op" id="4516875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516878">for</span>&nbsp;<span class="builtinfunc" id="4516882">len</span><span class="op" id="4516885">(</span><span class="ident" id="4516886">name</span><span class="op" id="4516890">)</span>&nbsp;<span class="op" id="4516892">&gt;</span>&nbsp;<span class="num" id="4516894">0</span>&nbsp;<span class="op" id="4516896">&amp;&amp;</span>&nbsp;<span class="ident" id="4516899">name</span><span class="op" id="4516903">[</span><span class="builtinfunc" id="4516904">len</span><span class="op" id="4516907">(</span><span class="ident" id="4516908">name</span><span class="op" id="4516912">)</span><span class="op" id="4516913">-</span><span class="num" id="4516914">1</span><span class="op" id="4516915">]</span>&nbsp;<span class="op" id="4516917">==</span>&nbsp;<span class="string" id="4516920">&#39;.&#39;</span>&nbsp;<span class="op" id="4516924">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4516928">name</span>&nbsp;<span class="op" id="4516933">=</span>&nbsp;<span class="ident" id="4516935">name</span><span class="op" id="4516939">[</span><span class="op" id="4516940">:</span><span class="builtinfunc" id="4516941">len</span><span class="op" id="4516944">(</span><span class="ident" id="4516945">name</span><span class="op" id="4516949">)</span><span class="op" id="4516950">-</span><span class="num" id="4516951">1</span><span class="op" id="4516952">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4516955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4516959">if</span>&nbsp;<span class="ident" id="4516962">cert</span><span class="op" id="4516966">,</span>&nbsp;<span class="ident" id="4516968">ok</span>&nbsp;<span class="op" id="4516971">:=</span>&nbsp;<span class="ident" id="4516974">c</span><span class="op" id="4516975">.</span><span class="ident" id="4516976">NameToCertificate</span><span class="op" id="4516993">[</span><span class="ident" id="4516994">name</span><span class="op" id="4516998">]</span><span class="op" id="4516999">;</span>&nbsp;<span class="ident" id="4517001">ok</span>&nbsp;<span class="op" id="4517004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517008">return</span>&nbsp;<span class="ident" id="4517015">cert</span><span class="op" id="4517019">,</span>&nbsp;<span class="ident" id="4517021">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517030">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517097">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517108">labels</span>&nbsp;<span class="op" id="4517115">:=</span>&nbsp;<span class="ident" id="4517118">strings</span><span class="op" id="4517125">.</span><span class="ident" id="4517126">Split</span><span class="op" id="4517131">(</span><span class="ident" id="4517132">name</span><span class="op" id="4517136">,</span>&nbsp;<span class="string" id="4517138">&#34;.&#34;</span><span class="op" id="4517141">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517144">for</span>&nbsp;<span class="ident" id="4517148">i</span>&nbsp;<span class="op" id="4517150">:=</span>&nbsp;<span class="keyword" id="4517153">range</span>&nbsp;<span class="ident" id="4517159">labels</span>&nbsp;<span class="op" id="4517166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517170">labels</span><span class="op" id="4517176">[</span><span class="ident" id="4517177">i</span><span class="op" id="4517178">]</span>&nbsp;<span class="op" id="4517180">=</span>&nbsp;<span class="string" id="4517182">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517188">candidate</span>&nbsp;<span class="op" id="4517198">:=</span>&nbsp;<span class="ident" id="4517201">strings</span><span class="op" id="4517208">.</span><span class="ident" id="4517209">Join</span><span class="op" id="4517213">(</span><span class="ident" id="4517214">labels</span><span class="op" id="4517220">,</span>&nbsp;<span class="string" id="4517222">&#34;.&#34;</span><span class="op" id="4517225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517229">if</span>&nbsp;<span class="ident" id="4517232">cert</span><span class="op" id="4517236">,</span>&nbsp;<span class="ident" id="4517238">ok</span>&nbsp;<span class="op" id="4517241">:=</span>&nbsp;<span class="ident" id="4517244">c</span><span class="op" id="4517245">.</span><span class="ident" id="4517246">NameToCertificate</span><span class="op" id="4517263">[</span><span class="ident" id="4517264">candidate</span><span class="op" id="4517273">]</span><span class="op" id="4517274">;</span>&nbsp;<span class="ident" id="4517276">ok</span>&nbsp;<span class="op" id="4517279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517284">return</span>&nbsp;<span class="ident" id="4517291">cert</span><span class="op" id="4517295">,</span>&nbsp;<span class="ident" id="4517297">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4517310">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517364">return</span>&nbsp;<span class="op" id="4517371">&amp;</span><span class="ident" id="4517372">c</span><span class="op" id="4517373">.</span><span class="ident" id="4517374">Certificates</span><span class="op" id="4517386">[</span><span class="num" id="4517387">0</span><span class="op" id="4517388">]</span><span class="op" id="4517389">,</span>&nbsp;<span class="ident" id="4517391">nil</span><br>
<span class="lineno">465</span><span class="op" id="4517395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4517398">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4517477">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4517552">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4517569">func</span>&nbsp;<span class="op" id="4517574">(</span><span class="ident" id="4517575">c</span>&nbsp;<span class="op" id="4517577">*</span><span class="ident" id="4517578">Config</span><span class="op" id="4517584">)</span>&nbsp;<span class="ident" id="4517586">BuildNameToCertificate</span><span class="op" id="4517608">(</span><span class="op" id="4517609">)</span>&nbsp;<span class="op" id="4517611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517614">c</span><span class="op" id="4517615">.</span><span class="ident" id="4517616">NameToCertificate</span>&nbsp;<span class="op" id="4517634">=</span>&nbsp;<span class="builtinfunc" id="4517636">make</span><span class="op" id="4517640">(</span><span class="keyword" id="4517641">map</span><span class="op" id="4517644">[</span><span class="builtintype" id="4517645">string</span><span class="op" id="4517651">]</span><span class="op" id="4517652">*</span><span class="ident" id="4517653">Certificate</span><span class="op" id="4517664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517667">for</span>&nbsp;<span class="ident" id="4517671">i</span>&nbsp;<span class="op" id="4517673">:=</span>&nbsp;<span class="keyword" id="4517676">range</span>&nbsp;<span class="ident" id="4517682">c</span><span class="op" id="4517683">.</span><span class="ident" id="4517684">Certificates</span>&nbsp;<span class="op" id="4517697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517701">cert</span>&nbsp;<span class="op" id="4517706">:=</span>&nbsp;<span class="op" id="4517709">&amp;</span><span class="ident" id="4517710">c</span><span class="op" id="4517711">.</span><span class="ident" id="4517712">Certificates</span><span class="op" id="4517724">[</span><span class="ident" id="4517725">i</span><span class="op" id="4517726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517730">x509Cert</span><span class="op" id="4517738">,</span>&nbsp;<span class="ident" id="4517740">err</span>&nbsp;<span class="op" id="4517744">:=</span>&nbsp;<span class="ident" id="4517747">x509</span><span class="op" id="4517751">.</span><span class="ident" id="4517752">ParseCertificate</span><span class="op" id="4517768">(</span><span class="ident" id="4517769">cert</span><span class="op" id="4517773">.</span><span class="ident" id="4517774">Certificate</span><span class="op" id="4517785">[</span><span class="num" id="4517786">0</span><span class="op" id="4517787">]</span><span class="op" id="4517788">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517792">if</span>&nbsp;<span class="ident" id="4517795">err</span>&nbsp;<span class="op" id="4517799">!=</span>&nbsp;<span class="ident" id="4517802">nil</span>&nbsp;<span class="op" id="4517806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517811">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517826">if</span>&nbsp;<span class="builtinfunc" id="4517829">len</span><span class="op" id="4517832">(</span><span class="ident" id="4517833">x509Cert</span><span class="op" id="4517841">.</span><span class="ident" id="4517842">Subject</span><span class="op" id="4517849">.</span><span class="ident" id="4517850">CommonName</span><span class="op" id="4517860">)</span>&nbsp;<span class="op" id="4517862">&gt;</span>&nbsp;<span class="num" id="4517864">0</span>&nbsp;<span class="op" id="4517866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517871">c</span><span class="op" id="4517872">.</span><span class="ident" id="4517873">NameToCertificate</span><span class="op" id="4517890">[</span><span class="ident" id="4517891">x509Cert</span><span class="op" id="4517899">.</span><span class="ident" id="4517900">Subject</span><span class="op" id="4517907">.</span><span class="ident" id="4517908">CommonName</span><span class="op" id="4517918">]</span>&nbsp;<span class="op" id="4517920">=</span>&nbsp;<span class="ident" id="4517922">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4517929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4517933">for</span>&nbsp;<span class="ident" id="4517937">_</span><span class="op" id="4517938">,</span>&nbsp;<span class="ident" id="4517940">san</span>&nbsp;<span class="op" id="4517944">:=</span>&nbsp;<span class="keyword" id="4517947">range</span>&nbsp;<span class="ident" id="4517953">x509Cert</span><span class="op" id="4517961">.</span><span class="ident" id="4517962">DNSNames</span>&nbsp;<span class="op" id="4517971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4517976">c</span><span class="op" id="4517977">.</span><span class="ident" id="4517978">NameToCertificate</span><span class="op" id="4517995">[</span><span class="ident" id="4517996">san</span><span class="op" id="4517999">]</span>&nbsp;<span class="op" id="4518001">=</span>&nbsp;<span class="ident" id="4518003">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4518013">}</span><br>
<span class="lineno">485</span><span class="op" id="4518015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4518018">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4518087">type</span>&nbsp;<span class="ident" id="4518092">Certificate</span>&nbsp;<span class="keyword" id="4518104">struct</span>&nbsp;<span class="op" id="4518111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518114">Certificate</span>&nbsp;<span class="op" id="4518126">[</span><span class="op" id="4518127">]</span><span class="op" id="4518128">[</span><span class="op" id="4518129">]</span><span class="builtintype" id="4518130">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518136">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518208">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518269">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518339">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518409">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518438">PrivateKey</span>&nbsp;<span class="ident" id="4518449">crypto</span><span class="op" id="4518455">.</span><span class="ident" id="4518456">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518468">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518539">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518571">OCSPStaple</span>&nbsp;<span class="op" id="4518582">[</span><span class="op" id="4518583">]</span><span class="builtintype" id="4518584">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518590">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518656">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518724">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4518796">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518843">Leaf</span>&nbsp;<span class="op" id="4518848">*</span><span class="ident" id="4518849">x509</span><span class="op" id="4518853">.</span><span class="ident" id="4518854">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4518866">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4518869">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4518886">type</span>&nbsp;<span class="ident" id="4518891">record</span>&nbsp;<span class="keyword" id="4518898">struct</span>&nbsp;<span class="op" id="4518905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518908">contentType</span>&nbsp;&nbsp;<span class="ident" id="4518921">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518933">major</span><span class="op" id="4518938">,</span>&nbsp;<span class="ident" id="4518940">minor</span>&nbsp;<span class="builtintype" id="4518946">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4518953">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518966">[</span><span class="op" id="4518967">]</span><span class="builtintype" id="4518968">byte</span><br>
<span class="lineno"></span><span class="op" id="4518973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4518976">type</span>&nbsp;<span class="ident" id="4518981">handshakeMessage</span>&nbsp;<span class="keyword" id="4518998">interface</span>&nbsp;<span class="op" id="4519008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519011">marshal</span><span class="op" id="4519018">(</span><span class="op" id="4519019">)</span>&nbsp;<span class="op" id="4519021">[</span><span class="op" id="4519022">]</span><span class="builtintype" id="4519023">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519029">unmarshal</span><span class="op" id="4519038">(</span><span class="op" id="4519039">[</span><span class="op" id="4519040">]</span><span class="builtintype" id="4519041">byte</span><span class="op" id="4519045">)</span>&nbsp;<span class="builtintype" id="4519047">bool</span><br>
<span class="lineno"></span><span class="op" id="4519052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4519055">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4519130">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4519151">type</span>&nbsp;<span class="ident" id="4519156">lruSessionCache</span>&nbsp;<span class="keyword" id="4519172">struct</span>&nbsp;<span class="op" id="4519179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519182">sync</span><span class="op" id="4519186">.</span><span class="ident" id="4519187">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519195">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519204">map</span><span class="op" id="4519207">[</span><span class="builtintype" id="4519208">string</span><span class="op" id="4519214">]</span><span class="op" id="4519215">*</span><span class="ident" id="4519216">list</span><span class="op" id="4519220">.</span><span class="ident" id="4519221">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519230">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519239">*</span><span class="ident" id="4519240">list</span><span class="op" id="4519244">.</span><span class="ident" id="4519245">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519251">capacity</span>&nbsp;<span class="builtintype" id="4519260">int</span><br>
<span class="lineno"></span><span class="op" id="4519264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4519267">type</span>&nbsp;<span class="ident" id="4519272">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4519293">struct</span>&nbsp;<span class="op" id="4519300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519303">sessionKey</span>&nbsp;<span class="builtintype" id="4519314">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519322">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519333">*</span><span class="ident" id="4519334">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4519353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4519356">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4519428">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4519506">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4519526">func</span>&nbsp;<span class="ident" id="4519531">NewLRUClientSessionCache</span><span class="op" id="4519555">(</span><span class="ident" id="4519556">capacity</span>&nbsp;<span class="builtintype" id="4519565">int</span><span class="op" id="4519568">)</span>&nbsp;<span class="ident" id="4519570">ClientSessionCache</span>&nbsp;<span class="op" id="4519589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519592">const</span>&nbsp;<span class="ident" id="4519598">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4519626">=</span>&nbsp;<span class="num" id="4519628">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519633">if</span>&nbsp;<span class="ident" id="4519636">capacity</span>&nbsp;<span class="op" id="4519645">&lt;</span>&nbsp;<span class="num" id="4519647">1</span>&nbsp;<span class="op" id="4519649">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519653">capacity</span>&nbsp;<span class="op" id="4519662">=</span>&nbsp;<span class="ident" id="4519664">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4519693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519696">return</span>&nbsp;<span class="op" id="4519703">&amp;</span><span class="ident" id="4519704">lruSessionCache</span><span class="op" id="4519719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519723">m</span><span class="op" id="4519724">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4519733">make</span><span class="op" id="4519737">(</span><span class="keyword" id="4519738">map</span><span class="op" id="4519741">[</span><span class="builtintype" id="4519742">string</span><span class="op" id="4519748">]</span><span class="op" id="4519749">*</span><span class="ident" id="4519750">list</span><span class="op" id="4519754">.</span><span class="ident" id="4519755">Element</span><span class="op" id="4519762">)</span><span class="op" id="4519763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519767">q</span><span class="op" id="4519768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519777">list</span><span class="op" id="4519781">.</span><span class="ident" id="4519782">New</span><span class="op" id="4519785">(</span><span class="op" id="4519786">)</span><span class="op" id="4519787">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519791">capacity</span><span class="op" id="4519799">:</span>&nbsp;<span class="ident" id="4519801">capacity</span><span class="op" id="4519809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4519812">}</span><br>
<span class="lineno"></span><span class="op" id="4519814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4519817">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4519878">func</span>&nbsp;<span class="op" id="4519883">(</span><span class="ident" id="4519884">c</span>&nbsp;<span class="op" id="4519886">*</span><span class="ident" id="4519887">lruSessionCache</span><span class="op" id="4519902">)</span>&nbsp;<span class="ident" id="4519904">Put</span><span class="op" id="4519907">(</span><span class="ident" id="4519908">sessionKey</span>&nbsp;<span class="builtintype" id="4519919">string</span><span class="op" id="4519925">,</span>&nbsp;<span class="ident" id="4519927">cs</span>&nbsp;<span class="op" id="4519930">*</span><span class="ident" id="4519931">ClientSessionState</span><span class="op" id="4519949">)</span>&nbsp;<span class="op" id="4519951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4519954">c</span><span class="op" id="4519955">.</span><span class="ident" id="4519956">Lock</span><span class="op" id="4519960">(</span><span class="op" id="4519961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519964">defer</span>&nbsp;<span class="ident" id="4519970">c</span><span class="op" id="4519971">.</span><span class="ident" id="4519972">Unlock</span><span class="op" id="4519978">(</span><span class="op" id="4519979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4519983">if</span>&nbsp;<span class="ident" id="4519986">elem</span><span class="op" id="4519990">,</span>&nbsp;<span class="ident" id="4519992">ok</span>&nbsp;<span class="op" id="4519995">:=</span>&nbsp;<span class="ident" id="4519998">c</span><span class="op" id="4519999">.</span><span class="ident" id="4520000">m</span><span class="op" id="4520001">[</span><span class="ident" id="4520002">sessionKey</span><span class="op" id="4520012">]</span><span class="op" id="4520013">;</span>&nbsp;<span class="ident" id="4520015">ok</span>&nbsp;<span class="op" id="4520018">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520022">entry</span>&nbsp;<span class="op" id="4520028">:=</span>&nbsp;<span class="ident" id="4520031">elem</span><span class="op" id="4520035">.</span><span class="ident" id="4520036">Value</span><span class="op" id="4520041">.</span><span class="op" id="4520042">(</span><span class="op" id="4520043">*</span><span class="ident" id="4520044">lruSessionCacheEntry</span><span class="op" id="4520064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520068">entry</span><span class="op" id="4520073">.</span><span class="ident" id="4520074">state</span>&nbsp;<span class="op" id="4520080">=</span>&nbsp;<span class="ident" id="4520082">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520087">c</span><span class="op" id="4520088">.</span><span class="ident" id="4520089">q</span><span class="op" id="4520090">.</span><span class="ident" id="4520091">MoveToFront</span><span class="op" id="4520102">(</span><span class="ident" id="4520103">elem</span><span class="op" id="4520107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520111">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4520119">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520123">if</span>&nbsp;<span class="ident" id="4520126">c</span><span class="op" id="4520127">.</span><span class="ident" id="4520128">q</span><span class="op" id="4520129">.</span><span class="ident" id="4520130">Len</span><span class="op" id="4520133">(</span><span class="op" id="4520134">)</span>&nbsp;<span class="op" id="4520136">&lt;</span>&nbsp;<span class="ident" id="4520138">c</span><span class="op" id="4520139">.</span><span class="ident" id="4520140">capacity</span>&nbsp;<span class="op" id="4520149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520153">entry</span>&nbsp;<span class="op" id="4520159">:=</span>&nbsp;<span class="op" id="4520162">&amp;</span><span class="ident" id="4520163">lruSessionCacheEntry</span><span class="op" id="4520183">{</span><span class="ident" id="4520184">sessionKey</span><span class="op" id="4520194">,</span>&nbsp;<span class="ident" id="4520196">cs</span><span class="op" id="4520198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520202">c</span><span class="op" id="4520203">.</span><span class="ident" id="4520204">m</span><span class="op" id="4520205">[</span><span class="ident" id="4520206">sessionKey</span><span class="op" id="4520216">]</span>&nbsp;<span class="op" id="4520218">=</span>&nbsp;<span class="ident" id="4520220">c</span><span class="op" id="4520221">.</span><span class="ident" id="4520222">q</span><span class="op" id="4520223">.</span><span class="ident" id="4520224">PushFront</span><span class="op" id="4520233">(</span><span class="ident" id="4520234">entry</span><span class="op" id="4520239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520243">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4520251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520255">elem</span>&nbsp;<span class="op" id="4520260">:=</span>&nbsp;<span class="ident" id="4520263">c</span><span class="op" id="4520264">.</span><span class="ident" id="4520265">q</span><span class="op" id="4520266">.</span><span class="ident" id="4520267">Back</span><span class="op" id="4520271">(</span><span class="op" id="4520272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520275">entry</span>&nbsp;<span class="op" id="4520281">:=</span>&nbsp;<span class="ident" id="4520284">elem</span><span class="op" id="4520288">.</span><span class="ident" id="4520289">Value</span><span class="op" id="4520294">.</span><span class="op" id="4520295">(</span><span class="op" id="4520296">*</span><span class="ident" id="4520297">lruSessionCacheEntry</span><span class="op" id="4520317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4520320">delete</span><span class="op" id="4520326">(</span><span class="ident" id="4520327">c</span><span class="op" id="4520328">.</span><span class="ident" id="4520329">m</span><span class="op" id="4520330">,</span>&nbsp;<span class="ident" id="4520332">entry</span><span class="op" id="4520337">.</span><span class="ident" id="4520338">sessionKey</span><span class="op" id="4520348">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520351">entry</span><span class="op" id="4520356">.</span><span class="ident" id="4520357">sessionKey</span>&nbsp;<span class="op" id="4520368">=</span>&nbsp;<span class="ident" id="4520370">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520382">entry</span><span class="op" id="4520387">.</span><span class="ident" id="4520388">state</span>&nbsp;<span class="op" id="4520394">=</span>&nbsp;<span class="ident" id="4520396">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520400">c</span><span class="op" id="4520401">.</span><span class="ident" id="4520402">q</span><span class="op" id="4520403">.</span><span class="ident" id="4520404">MoveToFront</span><span class="op" id="4520415">(</span><span class="ident" id="4520416">elem</span><span class="op" id="4520420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520423">c</span><span class="op" id="4520424">.</span><span class="ident" id="4520425">m</span><span class="op" id="4520426">[</span><span class="ident" id="4520427">sessionKey</span><span class="op" id="4520437">]</span>&nbsp;<span class="op" id="4520439">=</span>&nbsp;<span class="ident" id="4520441">elem</span><br>
<span class="lineno"></span><span class="op" id="4520446">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4520449">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4520525">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4520571">func</span>&nbsp;<span class="op" id="4520576">(</span><span class="ident" id="4520577">c</span>&nbsp;<span class="op" id="4520579">*</span><span class="ident" id="4520580">lruSessionCache</span><span class="op" id="4520595">)</span>&nbsp;<span class="ident" id="4520597">Get</span><span class="op" id="4520600">(</span><span class="ident" id="4520601">sessionKey</span>&nbsp;<span class="builtintype" id="4520612">string</span><span class="op" id="4520618">)</span>&nbsp;<span class="op" id="4520620">(</span><span class="op" id="4520621">*</span><span class="ident" id="4520622">ClientSessionState</span><span class="op" id="4520640">,</span>&nbsp;<span class="builtintype" id="4520642">bool</span><span class="op" id="4520646">)</span>&nbsp;<span class="op" id="4520648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520651">c</span><span class="op" id="4520652">.</span><span class="ident" id="4520653">Lock</span><span class="op" id="4520657">(</span><span class="op" id="4520658">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520661">defer</span>&nbsp;<span class="ident" id="4520667">c</span><span class="op" id="4520668">.</span><span class="ident" id="4520669">Unlock</span><span class="op" id="4520675">(</span><span class="op" id="4520676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520680">if</span>&nbsp;<span class="ident" id="4520683">elem</span><span class="op" id="4520687">,</span>&nbsp;<span class="ident" id="4520689">ok</span>&nbsp;<span class="op" id="4520692">:=</span>&nbsp;<span class="ident" id="4520695">c</span><span class="op" id="4520696">.</span><span class="ident" id="4520697">m</span><span class="op" id="4520698">[</span><span class="ident" id="4520699">sessionKey</span><span class="op" id="4520709">]</span><span class="op" id="4520710">;</span>&nbsp;<span class="ident" id="4520712">ok</span>&nbsp;<span class="op" id="4520715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520719">c</span><span class="op" id="4520720">.</span><span class="ident" id="4520721">q</span><span class="op" id="4520722">.</span><span class="ident" id="4520723">MoveToFront</span><span class="op" id="4520734">(</span><span class="ident" id="4520735">elem</span><span class="op" id="4520739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520743">return</span>&nbsp;<span class="ident" id="4520750">elem</span><span class="op" id="4520754">.</span><span class="ident" id="4520755">Value</span><span class="op" id="4520760">.</span><span class="op" id="4520761">(</span><span class="op" id="4520762">*</span><span class="ident" id="4520763">lruSessionCacheEntry</span><span class="op" id="4520783">)</span><span class="op" id="4520784">.</span><span class="ident" id="4520785">state</span><span class="op" id="4520790">,</span>&nbsp;<span class="builtintype" id="4520792">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4520798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4520801">return</span>&nbsp;<span class="ident" id="4520808">nil</span><span class="op" id="4520811">,</span>&nbsp;<span class="builtintype" id="4520813">false</span><br>
<span class="lineno"></span><span class="op" id="4520819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4520822">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4520895">type</span>&nbsp;<span class="ident" id="4520900">dsaSignature</span>&nbsp;<span class="keyword" id="4520913">struct</span>&nbsp;<span class="op" id="4520920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4520923">R</span><span class="op" id="4520924">,</span>&nbsp;<span class="ident" id="4520926">S</span>&nbsp;<span class="op" id="4520928">*</span><span class="ident" id="4520929">big</span><span class="op" id="4520932">.</span><span class="ident" id="4520933">Int</span><br>
<span class="lineno"></span><span class="op" id="4520937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4520940">type</span>&nbsp;<span class="ident" id="4520945">ecdsaSignature</span>&nbsp;<span class="ident" id="4520960">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4520974">var</span>&nbsp;<span class="ident" id="4520978">emptyConfig</span>&nbsp;<span class="ident" id="4520990">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4520998">func</span>&nbsp;<span class="ident" id="4521003">defaultConfig</span><span class="op" id="4521016">(</span><span class="op" id="4521017">)</span>&nbsp;<span class="op" id="4521019">*</span><span class="ident" id="4521020">Config</span>&nbsp;<span class="op" id="4521027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521030">return</span>&nbsp;<span class="op" id="4521037">&amp;</span><span class="ident" id="4521038">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4521050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521053">var</span>&nbsp;<span class="op" id="4521057">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521060">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521083">sync</span><span class="op" id="4521087">.</span><span class="ident" id="4521088">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521094">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4521117">[</span><span class="op" id="4521118">]</span><span class="builtintype" id="4521119">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4521126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521129">func</span>&nbsp;<span class="ident" id="4521134">defaultCipherSuites</span><span class="op" id="4521153">(</span><span class="op" id="4521154">)</span>&nbsp;<span class="op" id="4521156">[</span><span class="op" id="4521157">]</span><span class="builtintype" id="4521158">uint16</span>&nbsp;<span class="op" id="4521165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521168">once</span><span class="op" id="4521172">.</span><span class="ident" id="4521173">Do</span><span class="op" id="4521175">(</span><span class="ident" id="4521176">initDefaultCipherSuites</span><span class="op" id="4521199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521202">return</span>&nbsp;<span class="ident" id="4521209">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4521232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521235">func</span>&nbsp;<span class="ident" id="4521240">initDefaultCipherSuites</span><span class="op" id="4521263">(</span><span class="op" id="4521264">)</span>&nbsp;<span class="op" id="4521266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521269">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4521292">=</span>&nbsp;<span class="builtinfunc" id="4521294">make</span><span class="op" id="4521298">(</span><span class="op" id="4521299">[</span><span class="op" id="4521300">]</span><span class="builtintype" id="4521301">uint16</span><span class="op" id="4521307">,</span>&nbsp;<span class="builtinfunc" id="4521309">len</span><span class="op" id="4521312">(</span><span class="ident" id="4521313">cipherSuites</span><span class="op" id="4521325">)</span><span class="op" id="4521326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521329">for</span>&nbsp;<span class="ident" id="4521333">i</span><span class="op" id="4521334">,</span>&nbsp;<span class="ident" id="4521336">suite</span>&nbsp;<span class="op" id="4521342">:=</span>&nbsp;<span class="keyword" id="4521345">range</span>&nbsp;<span class="ident" id="4521351">cipherSuites</span>&nbsp;<span class="op" id="4521364">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4521368">varDefaultCipherSuites</span><span class="op" id="4521390">[</span><span class="ident" id="4521391">i</span><span class="op" id="4521392">]</span>&nbsp;<span class="op" id="4521394">=</span>&nbsp;<span class="ident" id="4521396">suite</span><span class="op" id="4521401">.</span><span class="ident" id="4521402">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4521406">}</span><br>
<span class="lineno"></span><span class="op" id="4521408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521411">func</span>&nbsp;<span class="ident" id="4521416">unexpectedMessageError</span><span class="op" id="4521438">(</span><span class="ident" id="4521439">wanted</span><span class="op" id="4521445">,</span>&nbsp;<span class="ident" id="4521447">got</span>&nbsp;<span class="keyword" id="4521451">interface</span><span class="op" id="4521460">{</span><span class="op" id="4521461">}</span><span class="op" id="4521462">)</span>&nbsp;<span class="builtintype" id="4521464">error</span>&nbsp;<span class="op" id="4521470">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4521473">return</span>&nbsp;<span class="ident" id="4521480">fmt</span><span class="op" id="4521483">.</span><span class="ident" id="4521484">Errorf</span><span class="op" id="4521490">(</span><span class="string" id="4521491">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4521566">,</span>&nbsp;<span class="ident" id="4521568">got</span><span class="op" id="4521571">,</span>&nbsp;<span class="ident" id="4521573">wanted</span><span class="op" id="4521579">)</span><br>
<span class="lineno"></span><span class="op" id="4521581">}</span>
</div>
</body>
</html>
