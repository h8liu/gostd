<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8093767">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8093822">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8093876">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8093927">package</span>&nbsp;<span class="ident" id="8093935">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8093946">import</span>&nbsp;<span class="op" id="8093953">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8093956">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8093965">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8093982">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8093989">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8093995">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8094008">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8094025">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8094031">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8094042">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8094053">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8094063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8094066">func</span>&nbsp;<span class="ident" id="8094071">TestBoundaryLine</span><span class="op" id="8094087">(</span><span class="ident" id="8094088">t</span>&nbsp;<span class="op" id="8094090">*</span><span class="ident" id="8094091">testing</span><span class="op" id="8094098">.</span><span class="ident" id="8094099">T</span><span class="op" id="8094100">)</span>&nbsp;<span class="op" id="8094102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094105">mr</span>&nbsp;<span class="op" id="8094108">:=</span>&nbsp;<span class="ident" id="8094111">NewReader</span><span class="op" id="8094120">(</span><span class="ident" id="8094121">strings</span><span class="op" id="8094128">.</span><span class="ident" id="8094129">NewReader</span><span class="op" id="8094138">(</span><span class="string" id="8094139">&#34;&#34;</span><span class="op" id="8094141">)</span><span class="op" id="8094142">,</span>&nbsp;<span class="string" id="8094144">&#34;myBoundary&#34;</span><span class="op" id="8094156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094159">if</span>&nbsp;<span class="op" id="8094162">!</span><span class="ident" id="8094163">mr</span><span class="op" id="8094165">.</span><span class="ident" id="8094166">isBoundaryDelimiterLine</span><span class="op" id="8094189">(</span><span class="op" id="8094190">[</span><span class="op" id="8094191">]</span><span class="builtintype" id="8094192">byte</span><span class="op" id="8094196">(</span><span class="string" id="8094197">&#34;--myBoundary\r\n&#34;</span><span class="op" id="8094215">)</span><span class="op" id="8094216">)</span>&nbsp;<span class="op" id="8094218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094222">t</span><span class="op" id="8094223">.</span><span class="ident" id="8094224">Error</span><span class="op" id="8094229">(</span><span class="string" id="8094230">&#34;expected&#34;</span><span class="op" id="8094240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094243">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094246">if</span>&nbsp;<span class="op" id="8094249">!</span><span class="ident" id="8094250">mr</span><span class="op" id="8094252">.</span><span class="ident" id="8094253">isBoundaryDelimiterLine</span><span class="op" id="8094276">(</span><span class="op" id="8094277">[</span><span class="op" id="8094278">]</span><span class="builtintype" id="8094279">byte</span><span class="op" id="8094283">(</span><span class="string" id="8094284">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="8094303">)</span><span class="op" id="8094304">)</span>&nbsp;<span class="op" id="8094306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094310">t</span><span class="op" id="8094311">.</span><span class="ident" id="8094312">Error</span><span class="op" id="8094317">(</span><span class="string" id="8094318">&#34;expected&#34;</span><span class="op" id="8094328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094334">if</span>&nbsp;<span class="op" id="8094337">!</span><span class="ident" id="8094338">mr</span><span class="op" id="8094340">.</span><span class="ident" id="8094341">isBoundaryDelimiterLine</span><span class="op" id="8094364">(</span><span class="op" id="8094365">[</span><span class="op" id="8094366">]</span><span class="builtintype" id="8094367">byte</span><span class="op" id="8094371">(</span><span class="string" id="8094372">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="8094389">)</span><span class="op" id="8094390">)</span>&nbsp;<span class="op" id="8094392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094396">t</span><span class="op" id="8094397">.</span><span class="ident" id="8094398">Error</span><span class="op" id="8094403">(</span><span class="string" id="8094404">&#34;expected&#34;</span><span class="op" id="8094414">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094420">if</span>&nbsp;<span class="ident" id="8094423">mr</span><span class="op" id="8094425">.</span><span class="ident" id="8094426">isBoundaryDelimiterLine</span><span class="op" id="8094449">(</span><span class="op" id="8094450">[</span><span class="op" id="8094451">]</span><span class="builtintype" id="8094452">byte</span><span class="op" id="8094456">(</span><span class="string" id="8094457">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="8094480">)</span><span class="op" id="8094481">)</span>&nbsp;<span class="op" id="8094483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094487">t</span><span class="op" id="8094488">.</span><span class="ident" id="8094489">Error</span><span class="op" id="8094494">(</span><span class="string" id="8094495">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8094510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094516">if</span>&nbsp;<span class="ident" id="8094519">mr</span><span class="op" id="8094521">.</span><span class="ident" id="8094522">isBoundaryDelimiterLine</span><span class="op" id="8094545">(</span><span class="op" id="8094546">[</span><span class="op" id="8094547">]</span><span class="builtintype" id="8094548">byte</span><span class="op" id="8094552">(</span><span class="string" id="8094553">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="8094575">)</span><span class="op" id="8094576">)</span>&nbsp;<span class="op" id="8094578">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094582">t</span><span class="op" id="8094583">.</span><span class="ident" id="8094584">Error</span><span class="op" id="8094589">(</span><span class="string" id="8094590">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8094605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094608">}</span><br>
<span class="lineno"></span><span class="op" id="8094610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094613">func</span>&nbsp;<span class="ident" id="8094618">escapeString</span><span class="op" id="8094630">(</span><span class="ident" id="8094631">v</span>&nbsp;<span class="builtintype" id="8094633">string</span><span class="op" id="8094639">)</span>&nbsp;<span class="builtintype" id="8094641">string</span>&nbsp;<span class="op" id="8094648">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094651">bytes</span><span class="op" id="8094656">,</span>&nbsp;<span class="ident" id="8094658">_</span>&nbsp;<span class="op" id="8094660">:=</span>&nbsp;<span class="ident" id="8094663">json</span><span class="op" id="8094667">.</span><span class="ident" id="8094668">Marshal</span><span class="op" id="8094675">(</span><span class="ident" id="8094676">v</span><span class="op" id="8094677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094680">return</span>&nbsp;<span class="builtintype" id="8094687">string</span><span class="op" id="8094693">(</span><span class="ident" id="8094694">bytes</span><span class="op" id="8094699">)</span><br>
<span class="lineno"></span><span class="op" id="8094701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094704">func</span>&nbsp;<span class="ident" id="8094709">expectEq</span><span class="op" id="8094717">(</span><span class="ident" id="8094718">t</span>&nbsp;<span class="op" id="8094720">*</span><span class="ident" id="8094721">testing</span><span class="op" id="8094728">.</span><span class="ident" id="8094729">T</span><span class="op" id="8094730">,</span>&nbsp;<span class="ident" id="8094732">expected</span><span class="op" id="8094740">,</span>&nbsp;<span class="ident" id="8094742">actual</span><span class="op" id="8094748">,</span>&nbsp;<span class="ident" id="8094750">what</span>&nbsp;<span class="builtintype" id="8094755">string</span><span class="op" id="8094761">)</span>&nbsp;<span class="op" id="8094763">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094766">if</span>&nbsp;<span class="ident" id="8094769">expected</span>&nbsp;<span class="op" id="8094778">==</span>&nbsp;<span class="ident" id="8094781">actual</span>&nbsp;<span class="op" id="8094788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8094792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8094800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094803">t</span><span class="op" id="8094804">.</span><span class="ident" id="8094805">Errorf</span><span class="op" id="8094811">(</span><span class="string" id="8094812">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="8094880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8094884">what</span><span class="op" id="8094888">,</span>&nbsp;<span class="ident" id="8094890">escapeString</span><span class="op" id="8094902">(</span><span class="ident" id="8094903">actual</span><span class="op" id="8094909">)</span><span class="op" id="8094910">,</span>&nbsp;<span class="builtinfunc" id="8094912">len</span><span class="op" id="8094915">(</span><span class="ident" id="8094916">actual</span><span class="op" id="8094922">)</span><span class="op" id="8094923">,</span>&nbsp;<span class="ident" id="8094925">escapeString</span><span class="op" id="8094937">(</span><span class="ident" id="8094938">expected</span><span class="op" id="8094946">)</span><span class="op" id="8094947">,</span>&nbsp;<span class="builtinfunc" id="8094949">len</span><span class="op" id="8094952">(</span><span class="ident" id="8094953">expected</span><span class="op" id="8094961">)</span><span class="op" id="8094962">)</span><br>
<span class="lineno">50</span><span class="op" id="8094964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8094967">func</span>&nbsp;<span class="ident" id="8094972">TestNameAccessors</span><span class="op" id="8094989">(</span><span class="ident" id="8094990">t</span>&nbsp;<span class="op" id="8094992">*</span><span class="ident" id="8094993">testing</span><span class="op" id="8095000">.</span><span class="ident" id="8095001">T</span><span class="op" id="8095002">)</span>&nbsp;<span class="op" id="8095004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095007">tests</span>&nbsp;<span class="op" id="8095013">:=</span>&nbsp;<span class="op" id="8095016">[</span><span class="op" id="8095017">...</span><span class="op" id="8095020">]</span><span class="op" id="8095021">[</span><span class="num" id="8095022">3</span><span class="op" id="8095023">]</span><span class="builtintype" id="8095024">string</span><span class="op" id="8095030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095034">{</span><span class="string" id="8095035">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8095058">,</span>&nbsp;<span class="string" id="8095060">&#34;foo&#34;</span><span class="op" id="8095065">,</span>&nbsp;<span class="string" id="8095067">&#34;&#34;</span><span class="op" id="8095069">}</span><span class="op" id="8095070">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095074">{</span><span class="string" id="8095075">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="8095098">,</span>&nbsp;<span class="string" id="8095100">&#34;foo&#34;</span><span class="op" id="8095105">,</span>&nbsp;<span class="string" id="8095107">&#34;&#34;</span><span class="op" id="8095109">}</span><span class="op" id="8095110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095114">{</span><span class="string" id="8095115">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="8095137">,</span>&nbsp;<span class="string" id="8095139">&#34;foo&#34;</span><span class="op" id="8095144">,</span>&nbsp;<span class="string" id="8095146">&#34;&#34;</span><span class="op" id="8095148">}</span><span class="op" id="8095149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095153">{</span><span class="string" id="8095154">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8095179">,</span>&nbsp;<span class="string" id="8095181">&#34;foo&#34;</span><span class="op" id="8095186">,</span>&nbsp;<span class="string" id="8095188">&#34;&#34;</span><span class="op" id="8095190">}</span><span class="op" id="8095191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095195">{</span><span class="string" id="8095196">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8095221">,</span>&nbsp;<span class="string" id="8095223">&#34;foo&#34;</span><span class="op" id="8095228">,</span>&nbsp;<span class="string" id="8095230">&#34;&#34;</span><span class="op" id="8095232">}</span><span class="op" id="8095233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095237">{</span><span class="string" id="8095238">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="8095261">,</span>&nbsp;<span class="string" id="8095263">&#34;foo&#34;</span><span class="op" id="8095268">,</span>&nbsp;<span class="string" id="8095270">&#34;&#34;</span><span class="op" id="8095272">}</span><span class="op" id="8095273">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095277">{</span><span class="string" id="8095278">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8095331">,</span>&nbsp;<span class="string" id="8095333">&#34;foo&#34;</span><span class="op" id="8095338">,</span>&nbsp;<span class="string" id="8095340">&#34;foo.txt&#34;</span><span class="op" id="8095349">}</span><span class="op" id="8095350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095354">{</span><span class="string" id="8095355">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8095412">,</span>&nbsp;<span class="string" id="8095414">&#34;&#34;</span><span class="op" id="8095416">,</span>&nbsp;<span class="string" id="8095418">&#34;bar.txt&#34;</span><span class="op" id="8095427">}</span><span class="op" id="8095428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8095434">for</span>&nbsp;<span class="ident" id="8095438">i</span><span class="op" id="8095439">,</span>&nbsp;<span class="ident" id="8095441">test</span>&nbsp;<span class="op" id="8095446">:=</span>&nbsp;<span class="keyword" id="8095449">range</span>&nbsp;<span class="ident" id="8095455">tests</span>&nbsp;<span class="op" id="8095461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095465">p</span>&nbsp;<span class="op" id="8095467">:=</span>&nbsp;<span class="op" id="8095470">&amp;</span><span class="ident" id="8095471">Part</span><span class="op" id="8095475">{</span><span class="ident" id="8095476">Header</span><span class="op" id="8095482">:</span>&nbsp;<span class="builtinfunc" id="8095484">make</span><span class="op" id="8095488">(</span><span class="keyword" id="8095489">map</span><span class="op" id="8095492">[</span><span class="builtintype" id="8095493">string</span><span class="op" id="8095499">]</span><span class="op" id="8095500">[</span><span class="op" id="8095501">]</span><span class="builtintype" id="8095502">string</span><span class="op" id="8095508">)</span><span class="op" id="8095509">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095513">p</span><span class="op" id="8095514">.</span><span class="ident" id="8095515">Header</span><span class="op" id="8095521">.</span><span class="ident" id="8095522">Set</span><span class="op" id="8095525">(</span><span class="string" id="8095526">&#34;Content-Disposition&#34;</span><span class="op" id="8095547">,</span>&nbsp;<span class="ident" id="8095549">test</span><span class="op" id="8095553">[</span><span class="num" id="8095554">0</span><span class="op" id="8095555">]</span><span class="op" id="8095556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8095560">if</span>&nbsp;<span class="ident" id="8095563">g</span><span class="op" id="8095564">,</span>&nbsp;<span class="ident" id="8095566">e</span>&nbsp;<span class="op" id="8095568">:=</span>&nbsp;<span class="ident" id="8095571">p</span><span class="op" id="8095572">.</span><span class="ident" id="8095573">FormName</span><span class="op" id="8095581">(</span><span class="op" id="8095582">)</span><span class="op" id="8095583">,</span>&nbsp;<span class="ident" id="8095585">test</span><span class="op" id="8095589">[</span><span class="num" id="8095590">1</span><span class="op" id="8095591">]</span><span class="op" id="8095592">;</span>&nbsp;<span class="ident" id="8095594">g</span>&nbsp;<span class="op" id="8095596">!=</span>&nbsp;<span class="ident" id="8095599">e</span>&nbsp;<span class="op" id="8095601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095606">t</span><span class="op" id="8095607">.</span><span class="ident" id="8095608">Errorf</span><span class="op" id="8095614">(</span><span class="string" id="8095615">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8095650">,</span>&nbsp;<span class="ident" id="8095652">i</span><span class="op" id="8095653">,</span>&nbsp;<span class="ident" id="8095655">g</span><span class="op" id="8095656">,</span>&nbsp;<span class="ident" id="8095658">e</span><span class="op" id="8095659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8095667">if</span>&nbsp;<span class="ident" id="8095670">g</span><span class="op" id="8095671">,</span>&nbsp;<span class="ident" id="8095673">e</span>&nbsp;<span class="op" id="8095675">:=</span>&nbsp;<span class="ident" id="8095678">p</span><span class="op" id="8095679">.</span><span class="ident" id="8095680">FileName</span><span class="op" id="8095688">(</span><span class="op" id="8095689">)</span><span class="op" id="8095690">,</span>&nbsp;<span class="ident" id="8095692">test</span><span class="op" id="8095696">[</span><span class="num" id="8095697">2</span><span class="op" id="8095698">]</span><span class="op" id="8095699">;</span>&nbsp;<span class="ident" id="8095701">g</span>&nbsp;<span class="op" id="8095703">!=</span>&nbsp;<span class="ident" id="8095706">e</span>&nbsp;<span class="op" id="8095708">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095713">t</span><span class="op" id="8095714">.</span><span class="ident" id="8095715">Errorf</span><span class="op" id="8095721">(</span><span class="string" id="8095722">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8095757">,</span>&nbsp;<span class="ident" id="8095759">i</span><span class="op" id="8095760">,</span>&nbsp;<span class="ident" id="8095762">g</span><span class="op" id="8095763">,</span>&nbsp;<span class="ident" id="8095765">e</span><span class="op" id="8095766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8095773">}</span><br>
<span class="lineno"></span><span class="op" id="8095775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8095778">var</span>&nbsp;<span class="ident" id="8095782">longLine</span>&nbsp;<span class="op" id="8095791">=</span>&nbsp;<span class="ident" id="8095793">strings</span><span class="op" id="8095800">.</span><span class="ident" id="8095801">Repeat</span><span class="op" id="8095807">(</span><span class="string" id="8095808">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="8095828">,</span>&nbsp;<span class="op" id="8095830">(</span><span class="num" id="8095831">1</span><span class="op" id="8095832">&lt;&lt;</span><span class="num" id="8095834">20</span><span class="op" id="8095836">)</span><span class="op" id="8095837">/</span><span class="num" id="8095838">8</span><span class="op" id="8095839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8095842">func</span>&nbsp;<span class="ident" id="8095847">testMultipartBody</span><span class="op" id="8095864">(</span><span class="ident" id="8095865">sep</span>&nbsp;<span class="builtintype" id="8095869">string</span><span class="op" id="8095875">)</span>&nbsp;<span class="builtintype" id="8095877">string</span>&nbsp;<span class="op" id="8095884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8095887">testBody</span>&nbsp;<span class="op" id="8095896">:=</span>&nbsp;<span class="string" id="8095899">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096256">testBody</span>&nbsp;<span class="op" id="8096265">=</span>&nbsp;<span class="ident" id="8096267">strings</span><span class="op" id="8096274">.</span><span class="ident" id="8096275">Replace</span><span class="op" id="8096282">(</span><span class="ident" id="8096283">testBody</span><span class="op" id="8096291">,</span>&nbsp;<span class="string" id="8096293">&#34;\n&#34;</span><span class="op" id="8096297">,</span>&nbsp;<span class="ident" id="8096299">sep</span><span class="op" id="8096302">,</span>&nbsp;<span class="op" id="8096304">-</span><span class="num" id="8096305">1</span><span class="op" id="8096306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096309">return</span>&nbsp;<span class="ident" id="8096316">strings</span><span class="op" id="8096323">.</span><span class="ident" id="8096324">Replace</span><span class="op" id="8096331">(</span><span class="ident" id="8096332">testBody</span><span class="op" id="8096340">,</span>&nbsp;<span class="string" id="8096342">&#34;[longline]&#34;</span><span class="op" id="8096354">,</span>&nbsp;<span class="ident" id="8096356">longLine</span><span class="op" id="8096364">,</span>&nbsp;<span class="num" id="8096366">1</span><span class="op" id="8096367">)</span><br>
<span class="lineno">110</span><span class="op" id="8096369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096372">func</span>&nbsp;<span class="ident" id="8096377">TestMultipart</span><span class="op" id="8096390">(</span><span class="ident" id="8096391">t</span>&nbsp;<span class="op" id="8096393">*</span><span class="ident" id="8096394">testing</span><span class="op" id="8096401">.</span><span class="ident" id="8096402">T</span><span class="op" id="8096403">)</span>&nbsp;<span class="op" id="8096405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096408">bodyReader</span>&nbsp;<span class="op" id="8096419">:=</span>&nbsp;<span class="ident" id="8096422">strings</span><span class="op" id="8096429">.</span><span class="ident" id="8096430">NewReader</span><span class="op" id="8096439">(</span><span class="ident" id="8096440">testMultipartBody</span><span class="op" id="8096457">(</span><span class="string" id="8096458">&#34;\r\n&#34;</span><span class="op" id="8096464">)</span><span class="op" id="8096465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096468">testMultipart</span><span class="op" id="8096481">(</span><span class="ident" id="8096482">t</span><span class="op" id="8096483">,</span>&nbsp;<span class="ident" id="8096485">bodyReader</span><span class="op" id="8096495">,</span>&nbsp;<span class="builtintype" id="8096497">false</span><span class="op" id="8096502">)</span><br>
<span class="lineno">115</span><span class="op" id="8096504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096507">func</span>&nbsp;<span class="ident" id="8096512">TestMultipartOnlyNewlines</span><span class="op" id="8096537">(</span><span class="ident" id="8096538">t</span>&nbsp;<span class="op" id="8096540">*</span><span class="ident" id="8096541">testing</span><span class="op" id="8096548">.</span><span class="ident" id="8096549">T</span><span class="op" id="8096550">)</span>&nbsp;<span class="op" id="8096552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096555">bodyReader</span>&nbsp;<span class="op" id="8096566">:=</span>&nbsp;<span class="ident" id="8096569">strings</span><span class="op" id="8096576">.</span><span class="ident" id="8096577">NewReader</span><span class="op" id="8096586">(</span><span class="ident" id="8096587">testMultipartBody</span><span class="op" id="8096604">(</span><span class="string" id="8096605">&#34;\n&#34;</span><span class="op" id="8096609">)</span><span class="op" id="8096610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096613">testMultipart</span><span class="op" id="8096626">(</span><span class="ident" id="8096627">t</span><span class="op" id="8096628">,</span>&nbsp;<span class="ident" id="8096630">bodyReader</span><span class="op" id="8096640">,</span>&nbsp;<span class="builtintype" id="8096642">true</span><span class="op" id="8096646">)</span><br>
<span class="lineno">120</span><span class="op" id="8096648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096651">func</span>&nbsp;<span class="ident" id="8096656">TestMultipartSlowInput</span><span class="op" id="8096678">(</span><span class="ident" id="8096679">t</span>&nbsp;<span class="op" id="8096681">*</span><span class="ident" id="8096682">testing</span><span class="op" id="8096689">.</span><span class="ident" id="8096690">T</span><span class="op" id="8096691">)</span>&nbsp;<span class="op" id="8096693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096696">bodyReader</span>&nbsp;<span class="op" id="8096707">:=</span>&nbsp;<span class="ident" id="8096710">strings</span><span class="op" id="8096717">.</span><span class="ident" id="8096718">NewReader</span><span class="op" id="8096727">(</span><span class="ident" id="8096728">testMultipartBody</span><span class="op" id="8096745">(</span><span class="string" id="8096746">&#34;\r\n&#34;</span><span class="op" id="8096752">)</span><span class="op" id="8096753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096756">testMultipart</span><span class="op" id="8096769">(</span><span class="ident" id="8096770">t</span><span class="op" id="8096771">,</span>&nbsp;<span class="op" id="8096773">&amp;</span><span class="ident" id="8096774">slowReader</span><span class="op" id="8096784">{</span><span class="ident" id="8096785">bodyReader</span><span class="op" id="8096795">}</span><span class="op" id="8096796">,</span>&nbsp;<span class="builtintype" id="8096798">false</span><span class="op" id="8096803">)</span><br>
<span class="lineno">125</span><span class="op" id="8096805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096808">func</span>&nbsp;<span class="ident" id="8096813">testMultipart</span><span class="op" id="8096826">(</span><span class="ident" id="8096827">t</span>&nbsp;<span class="op" id="8096829">*</span><span class="ident" id="8096830">testing</span><span class="op" id="8096837">.</span><span class="ident" id="8096838">T</span><span class="op" id="8096839">,</span>&nbsp;<span class="ident" id="8096841">r</span>&nbsp;<span class="ident" id="8096843">io</span><span class="op" id="8096845">.</span><span class="ident" id="8096846">Reader</span><span class="op" id="8096852">,</span>&nbsp;<span class="ident" id="8096854">onlyNewlines</span>&nbsp;<span class="builtintype" id="8096867">bool</span><span class="op" id="8096871">)</span>&nbsp;<span class="op" id="8096873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096876">reader</span>&nbsp;<span class="op" id="8096883">:=</span>&nbsp;<span class="ident" id="8096886">NewReader</span><span class="op" id="8096895">(</span><span class="ident" id="8096896">r</span><span class="op" id="8096897">,</span>&nbsp;<span class="string" id="8096899">&#34;MyBoundary&#34;</span><span class="op" id="8096911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096914">buf</span>&nbsp;<span class="op" id="8096918">:=</span>&nbsp;<span class="builtinfunc" id="8096921">new</span><span class="op" id="8096924">(</span><span class="ident" id="8096925">bytes</span><span class="op" id="8096930">.</span><span class="ident" id="8096931">Buffer</span><span class="op" id="8096937">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8096941">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096951">part</span><span class="op" id="8096955">,</span>&nbsp;<span class="ident" id="8096957">err</span>&nbsp;<span class="op" id="8096961">:=</span>&nbsp;<span class="ident" id="8096964">reader</span><span class="op" id="8096970">.</span><span class="ident" id="8096971">NextPart</span><span class="op" id="8096979">(</span><span class="op" id="8096980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096983">if</span>&nbsp;<span class="ident" id="8096986">part</span>&nbsp;<span class="op" id="8096991">==</span>&nbsp;<span class="ident" id="8096994">nil</span>&nbsp;<span class="op" id="8096998">||</span>&nbsp;<span class="ident" id="8097001">err</span>&nbsp;<span class="op" id="8097005">!=</span>&nbsp;<span class="ident" id="8097008">nil</span>&nbsp;<span class="op" id="8097012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097016">t</span><span class="op" id="8097017">.</span><span class="ident" id="8097018">Error</span><span class="op" id="8097023">(</span><span class="string" id="8097024">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="8097040">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097055">if</span>&nbsp;<span class="ident" id="8097058">x</span>&nbsp;<span class="op" id="8097060">:=</span>&nbsp;<span class="ident" id="8097063">part</span><span class="op" id="8097067">.</span><span class="ident" id="8097068">Header</span><span class="op" id="8097074">.</span><span class="ident" id="8097075">Get</span><span class="op" id="8097078">(</span><span class="string" id="8097079">&#34;Header1&#34;</span><span class="op" id="8097088">)</span><span class="op" id="8097089">;</span>&nbsp;<span class="ident" id="8097091">x</span>&nbsp;<span class="op" id="8097093">!=</span>&nbsp;<span class="string" id="8097096">&#34;value1&#34;</span>&nbsp;<span class="op" id="8097105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097109">t</span><span class="op" id="8097110">.</span><span class="ident" id="8097111">Errorf</span><span class="op" id="8097117">(</span><span class="string" id="8097118">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8097153">,</span>&nbsp;<span class="string" id="8097155">&#34;Header1&#34;</span><span class="op" id="8097164">,</span>&nbsp;<span class="ident" id="8097166">x</span><span class="op" id="8097167">,</span>&nbsp;<span class="string" id="8097169">&#34;value1&#34;</span><span class="op" id="8097177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097180">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097183">if</span>&nbsp;<span class="ident" id="8097186">x</span>&nbsp;<span class="op" id="8097188">:=</span>&nbsp;<span class="ident" id="8097191">part</span><span class="op" id="8097195">.</span><span class="ident" id="8097196">Header</span><span class="op" id="8097202">.</span><span class="ident" id="8097203">Get</span><span class="op" id="8097206">(</span><span class="string" id="8097207">&#34;foo-bar&#34;</span><span class="op" id="8097216">)</span><span class="op" id="8097217">;</span>&nbsp;<span class="ident" id="8097219">x</span>&nbsp;<span class="op" id="8097221">!=</span>&nbsp;<span class="string" id="8097224">&#34;baz&#34;</span>&nbsp;<span class="op" id="8097230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097234">t</span><span class="op" id="8097235">.</span><span class="ident" id="8097236">Errorf</span><span class="op" id="8097242">(</span><span class="string" id="8097243">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8097278">,</span>&nbsp;<span class="string" id="8097280">&#34;foo-bar&#34;</span><span class="op" id="8097289">,</span>&nbsp;<span class="ident" id="8097291">x</span><span class="op" id="8097292">,</span>&nbsp;<span class="string" id="8097294">&#34;baz&#34;</span><span class="op" id="8097299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097305">if</span>&nbsp;<span class="ident" id="8097308">x</span>&nbsp;<span class="op" id="8097310">:=</span>&nbsp;<span class="ident" id="8097313">part</span><span class="op" id="8097317">.</span><span class="ident" id="8097318">Header</span><span class="op" id="8097324">.</span><span class="ident" id="8097325">Get</span><span class="op" id="8097328">(</span><span class="string" id="8097329">&#34;Foo-Bar&#34;</span><span class="op" id="8097338">)</span><span class="op" id="8097339">;</span>&nbsp;<span class="ident" id="8097341">x</span>&nbsp;<span class="op" id="8097343">!=</span>&nbsp;<span class="string" id="8097346">&#34;baz&#34;</span>&nbsp;<span class="op" id="8097352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097356">t</span><span class="op" id="8097357">.</span><span class="ident" id="8097358">Errorf</span><span class="op" id="8097364">(</span><span class="string" id="8097365">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8097400">,</span>&nbsp;<span class="string" id="8097402">&#34;Foo-Bar&#34;</span><span class="op" id="8097411">,</span>&nbsp;<span class="ident" id="8097413">x</span><span class="op" id="8097414">,</span>&nbsp;<span class="string" id="8097416">&#34;baz&#34;</span><span class="op" id="8097421">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097427">buf</span><span class="op" id="8097430">.</span><span class="ident" id="8097431">Reset</span><span class="op" id="8097436">(</span><span class="op" id="8097437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097440">if</span>&nbsp;<span class="ident" id="8097443">_</span><span class="op" id="8097444">,</span>&nbsp;<span class="ident" id="8097446">err</span>&nbsp;<span class="op" id="8097450">:=</span>&nbsp;<span class="ident" id="8097453">io</span><span class="op" id="8097455">.</span><span class="ident" id="8097456">Copy</span><span class="op" id="8097460">(</span><span class="ident" id="8097461">buf</span><span class="op" id="8097464">,</span>&nbsp;<span class="ident" id="8097466">part</span><span class="op" id="8097470">)</span><span class="op" id="8097471">;</span>&nbsp;<span class="ident" id="8097473">err</span>&nbsp;<span class="op" id="8097477">!=</span>&nbsp;<span class="ident" id="8097480">nil</span>&nbsp;<span class="op" id="8097484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097488">t</span><span class="op" id="8097489">.</span><span class="ident" id="8097490">Errorf</span><span class="op" id="8097496">(</span><span class="string" id="8097497">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8097514">,</span>&nbsp;<span class="ident" id="8097516">err</span><span class="op" id="8097519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097522">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097526">adjustNewlines</span>&nbsp;<span class="op" id="8097541">:=</span>&nbsp;<span class="keyword" id="8097544">func</span><span class="op" id="8097548">(</span><span class="ident" id="8097549">s</span>&nbsp;<span class="builtintype" id="8097551">string</span><span class="op" id="8097557">)</span>&nbsp;<span class="builtintype" id="8097559">string</span>&nbsp;<span class="op" id="8097566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097570">if</span>&nbsp;<span class="ident" id="8097573">onlyNewlines</span>&nbsp;<span class="op" id="8097586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097591">return</span>&nbsp;<span class="ident" id="8097598">strings</span><span class="op" id="8097605">.</span><span class="ident" id="8097606">Replace</span><span class="op" id="8097613">(</span><span class="ident" id="8097614">s</span><span class="op" id="8097615">,</span>&nbsp;<span class="string" id="8097617">&#34;\r\n&#34;</span><span class="op" id="8097623">,</span>&nbsp;<span class="string" id="8097625">&#34;\n&#34;</span><span class="op" id="8097629">,</span>&nbsp;<span class="op" id="8097631">-</span><span class="num" id="8097632">1</span><span class="op" id="8097633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097637">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097641">return</span>&nbsp;<span class="ident" id="8097648">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097655">expectEq</span><span class="op" id="8097663">(</span><span class="ident" id="8097664">t</span><span class="op" id="8097665">,</span>&nbsp;<span class="ident" id="8097667">adjustNewlines</span><span class="op" id="8097681">(</span><span class="string" id="8097682">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="8097704">)</span><span class="op" id="8097705">,</span>&nbsp;<span class="ident" id="8097707">buf</span><span class="op" id="8097710">.</span><span class="ident" id="8097711">String</span><span class="op" id="8097717">(</span><span class="op" id="8097718">)</span><span class="op" id="8097719">,</span>&nbsp;<span class="string" id="8097721">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="8097742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8097746">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097756">part</span><span class="op" id="8097760">,</span>&nbsp;<span class="ident" id="8097762">err</span>&nbsp;<span class="op" id="8097766">=</span>&nbsp;<span class="ident" id="8097768">reader</span><span class="op" id="8097774">.</span><span class="ident" id="8097775">NextPart</span><span class="op" id="8097783">(</span><span class="op" id="8097784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097787">if</span>&nbsp;<span class="ident" id="8097790">err</span>&nbsp;<span class="op" id="8097794">!=</span>&nbsp;<span class="ident" id="8097797">nil</span>&nbsp;<span class="op" id="8097801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097805">t</span><span class="op" id="8097806">.</span><span class="ident" id="8097807">Fatalf</span><span class="op" id="8097813">(</span><span class="string" id="8097814">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="8097839">,</span>&nbsp;<span class="ident" id="8097841">err</span><span class="op" id="8097844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097848">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097859">if</span>&nbsp;<span class="ident" id="8097862">e</span><span class="op" id="8097863">,</span>&nbsp;<span class="ident" id="8097865">g</span>&nbsp;<span class="op" id="8097867">:=</span>&nbsp;<span class="string" id="8097870">&#34;bigsection&#34;</span><span class="op" id="8097882">,</span>&nbsp;<span class="ident" id="8097884">part</span><span class="op" id="8097888">.</span><span class="ident" id="8097889">Header</span><span class="op" id="8097895">.</span><span class="ident" id="8097896">Get</span><span class="op" id="8097899">(</span><span class="string" id="8097900">&#34;name&#34;</span><span class="op" id="8097906">)</span><span class="op" id="8097907">;</span>&nbsp;<span class="ident" id="8097909">e</span>&nbsp;<span class="op" id="8097911">!=</span>&nbsp;<span class="ident" id="8097914">g</span>&nbsp;<span class="op" id="8097916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097920">t</span><span class="op" id="8097921">.</span><span class="ident" id="8097922">Errorf</span><span class="op" id="8097928">(</span><span class="string" id="8097929">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8097971">,</span>&nbsp;<span class="ident" id="8097973">e</span><span class="op" id="8097974">,</span>&nbsp;<span class="ident" id="8097976">g</span><span class="op" id="8097977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097983">buf</span><span class="op" id="8097986">.</span><span class="ident" id="8097987">Reset</span><span class="op" id="8097992">(</span><span class="op" id="8097993">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097996">if</span>&nbsp;<span class="ident" id="8097999">_</span><span class="op" id="8098000">,</span>&nbsp;<span class="ident" id="8098002">err</span>&nbsp;<span class="op" id="8098006">:=</span>&nbsp;<span class="ident" id="8098009">io</span><span class="op" id="8098011">.</span><span class="ident" id="8098012">Copy</span><span class="op" id="8098016">(</span><span class="ident" id="8098017">buf</span><span class="op" id="8098020">,</span>&nbsp;<span class="ident" id="8098022">part</span><span class="op" id="8098026">)</span><span class="op" id="8098027">;</span>&nbsp;<span class="ident" id="8098029">err</span>&nbsp;<span class="op" id="8098033">!=</span>&nbsp;<span class="ident" id="8098036">nil</span>&nbsp;<span class="op" id="8098040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098044">t</span><span class="op" id="8098045">.</span><span class="ident" id="8098046">Errorf</span><span class="op" id="8098052">(</span><span class="string" id="8098053">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8098070">,</span>&nbsp;<span class="ident" id="8098072">err</span><span class="op" id="8098075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098081">s</span>&nbsp;<span class="op" id="8098083">:=</span>&nbsp;<span class="ident" id="8098086">buf</span><span class="op" id="8098089">.</span><span class="ident" id="8098090">String</span><span class="op" id="8098096">(</span><span class="op" id="8098097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098100">if</span>&nbsp;<span class="builtinfunc" id="8098103">len</span><span class="op" id="8098106">(</span><span class="ident" id="8098107">s</span><span class="op" id="8098108">)</span>&nbsp;<span class="op" id="8098110">!=</span>&nbsp;<span class="builtinfunc" id="8098113">len</span><span class="op" id="8098116">(</span><span class="ident" id="8098117">longLine</span><span class="op" id="8098125">)</span>&nbsp;<span class="op" id="8098127">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098131">t</span><span class="op" id="8098132">.</span><span class="ident" id="8098133">Errorf</span><span class="op" id="8098139">(</span><span class="string" id="8098140">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="8098199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8098204">len</span><span class="op" id="8098207">(</span><span class="ident" id="8098208">longLine</span><span class="op" id="8098216">)</span><span class="op" id="8098217">,</span>&nbsp;<span class="builtinfunc" id="8098219">len</span><span class="op" id="8098222">(</span><span class="ident" id="8098223">s</span><span class="op" id="8098224">)</span><span class="op" id="8098225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098231">if</span>&nbsp;<span class="ident" id="8098234">s</span>&nbsp;<span class="op" id="8098236">!=</span>&nbsp;<span class="ident" id="8098239">longLine</span>&nbsp;<span class="op" id="8098248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098252">t</span><span class="op" id="8098253">.</span><span class="ident" id="8098254">Errorf</span><span class="op" id="8098260">(</span><span class="string" id="8098261">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="8098291">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8098298">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098308">part</span><span class="op" id="8098312">,</span>&nbsp;<span class="ident" id="8098314">err</span>&nbsp;<span class="op" id="8098318">=</span>&nbsp;<span class="ident" id="8098320">reader</span><span class="op" id="8098326">.</span><span class="ident" id="8098327">NextPart</span><span class="op" id="8098335">(</span><span class="op" id="8098336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098339">if</span>&nbsp;<span class="ident" id="8098342">part</span>&nbsp;<span class="op" id="8098347">==</span>&nbsp;<span class="ident" id="8098350">nil</span>&nbsp;<span class="op" id="8098354">||</span>&nbsp;<span class="ident" id="8098357">err</span>&nbsp;<span class="op" id="8098361">!=</span>&nbsp;<span class="ident" id="8098364">nil</span>&nbsp;<span class="op" id="8098368">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098372">t</span><span class="op" id="8098373">.</span><span class="ident" id="8098374">Error</span><span class="op" id="8098379">(</span><span class="string" id="8098380">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="8098396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098411">if</span>&nbsp;<span class="ident" id="8098414">part</span><span class="op" id="8098418">.</span><span class="ident" id="8098419">Header</span><span class="op" id="8098425">.</span><span class="ident" id="8098426">Get</span><span class="op" id="8098429">(</span><span class="string" id="8098430">&#34;foo-bar&#34;</span><span class="op" id="8098439">)</span>&nbsp;<span class="op" id="8098441">!=</span>&nbsp;<span class="string" id="8098444">&#34;bazb&#34;</span>&nbsp;<span class="op" id="8098451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098455">t</span><span class="op" id="8098456">.</span><span class="ident" id="8098457">Error</span><span class="op" id="8098462">(</span><span class="string" id="8098463">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="8098487">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098493">buf</span><span class="op" id="8098496">.</span><span class="ident" id="8098497">Reset</span><span class="op" id="8098502">(</span><span class="op" id="8098503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098506">if</span>&nbsp;<span class="ident" id="8098509">_</span><span class="op" id="8098510">,</span>&nbsp;<span class="ident" id="8098512">err</span>&nbsp;<span class="op" id="8098516">:=</span>&nbsp;<span class="ident" id="8098519">io</span><span class="op" id="8098521">.</span><span class="ident" id="8098522">Copy</span><span class="op" id="8098526">(</span><span class="ident" id="8098527">buf</span><span class="op" id="8098530">,</span>&nbsp;<span class="ident" id="8098532">part</span><span class="op" id="8098536">)</span><span class="op" id="8098537">;</span>&nbsp;<span class="ident" id="8098539">err</span>&nbsp;<span class="op" id="8098543">!=</span>&nbsp;<span class="ident" id="8098546">nil</span>&nbsp;<span class="op" id="8098550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098554">t</span><span class="op" id="8098555">.</span><span class="ident" id="8098556">Errorf</span><span class="op" id="8098562">(</span><span class="string" id="8098563">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8098580">,</span>&nbsp;<span class="ident" id="8098582">err</span><span class="op" id="8098585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098588">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098591">expectEq</span><span class="op" id="8098599">(</span><span class="ident" id="8098600">t</span><span class="op" id="8098601">,</span>&nbsp;<span class="ident" id="8098603">adjustNewlines</span><span class="op" id="8098617">(</span><span class="string" id="8098618">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="8098683">)</span><span class="op" id="8098684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098688">buf</span><span class="op" id="8098691">.</span><span class="ident" id="8098692">String</span><span class="op" id="8098698">(</span><span class="op" id="8098699">)</span><span class="op" id="8098700">,</span>&nbsp;<span class="string" id="8098702">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="8098718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8098722">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098732">part</span><span class="op" id="8098736">,</span>&nbsp;<span class="ident" id="8098738">err</span>&nbsp;<span class="op" id="8098742">=</span>&nbsp;<span class="ident" id="8098744">reader</span><span class="op" id="8098750">.</span><span class="ident" id="8098751">NextPart</span><span class="op" id="8098759">(</span><span class="op" id="8098760">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098763">if</span>&nbsp;<span class="ident" id="8098766">part</span>&nbsp;<span class="op" id="8098771">==</span>&nbsp;<span class="ident" id="8098774">nil</span>&nbsp;<span class="op" id="8098778">||</span>&nbsp;<span class="ident" id="8098781">err</span>&nbsp;<span class="op" id="8098785">!=</span>&nbsp;<span class="ident" id="8098788">nil</span>&nbsp;<span class="op" id="8098792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098796">t</span><span class="op" id="8098797">.</span><span class="ident" id="8098798">Error</span><span class="op" id="8098803">(</span><span class="string" id="8098804">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="8098836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098840">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8098852">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098875">part</span><span class="op" id="8098879">,</span>&nbsp;<span class="ident" id="8098881">err</span>&nbsp;<span class="op" id="8098885">=</span>&nbsp;<span class="ident" id="8098887">reader</span><span class="op" id="8098893">.</span><span class="ident" id="8098894">NextPart</span><span class="op" id="8098902">(</span><span class="op" id="8098903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098906">if</span>&nbsp;<span class="ident" id="8098909">part</span>&nbsp;<span class="op" id="8098914">!=</span>&nbsp;<span class="ident" id="8098917">nil</span>&nbsp;<span class="op" id="8098921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098925">t</span><span class="op" id="8098926">.</span><span class="ident" id="8098927">Error</span><span class="op" id="8098932">(</span><span class="string" id="8098933">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="8098962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098965">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098968">if</span>&nbsp;<span class="ident" id="8098971">err</span>&nbsp;<span class="op" id="8098975">!=</span>&nbsp;<span class="ident" id="8098978">io</span><span class="op" id="8098980">.</span><span class="ident" id="8098981">EOF</span>&nbsp;<span class="op" id="8098985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098989">t</span><span class="op" id="8098990">.</span><span class="ident" id="8098991">Errorf</span><span class="op" id="8098997">(</span><span class="string" id="8098998">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8099037">,</span>&nbsp;<span class="ident" id="8099039">err</span><span class="op" id="8099042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099045">}</span><br>
<span class="lineno"></span><span class="op" id="8099047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8099050">func</span>&nbsp;<span class="ident" id="8099055">TestVariousTextLineEndings</span><span class="op" id="8099081">(</span><span class="ident" id="8099082">t</span>&nbsp;<span class="op" id="8099084">*</span><span class="ident" id="8099085">testing</span><span class="op" id="8099092">.</span><span class="ident" id="8099093">T</span><span class="op" id="8099094">)</span>&nbsp;<span class="op" id="8099096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099099">tests</span>&nbsp;<span class="op" id="8099105">:=</span>&nbsp;<span class="op" id="8099108">[</span><span class="op" id="8099109">...</span><span class="op" id="8099112">]</span><span class="builtintype" id="8099113">string</span><span class="op" id="8099119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099123">&#34;Foo\nBar&#34;</span><span class="op" id="8099133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099137">&#34;Foo\nBar\n&#34;</span><span class="op" id="8099149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099153">&#34;Foo\r\nBar&#34;</span><span class="op" id="8099165">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099169">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="8099185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099189">&#34;Foo\rBar&#34;</span><span class="op" id="8099199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099203">&#34;Foo\rBar\r&#34;</span><span class="op" id="8099215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099219">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="8099265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099268">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099272">for</span>&nbsp;<span class="ident" id="8099276">testNum</span><span class="op" id="8099283">,</span>&nbsp;<span class="ident" id="8099285">expectedBody</span>&nbsp;<span class="op" id="8099298">:=</span>&nbsp;<span class="keyword" id="8099301">range</span>&nbsp;<span class="ident" id="8099307">tests</span>&nbsp;<span class="op" id="8099313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099317">body</span>&nbsp;<span class="op" id="8099322">:=</span>&nbsp;<span class="string" id="8099325">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="8099342">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099347">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8099400">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099405">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8099412">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099417">expectedBody</span>&nbsp;<span class="op" id="8099430">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8099435">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099460">bodyReader</span>&nbsp;<span class="op" id="8099471">:=</span>&nbsp;<span class="ident" id="8099474">strings</span><span class="op" id="8099481">.</span><span class="ident" id="8099482">NewReader</span><span class="op" id="8099491">(</span><span class="ident" id="8099492">body</span><span class="op" id="8099496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099501">reader</span>&nbsp;<span class="op" id="8099508">:=</span>&nbsp;<span class="ident" id="8099511">NewReader</span><span class="op" id="8099520">(</span><span class="ident" id="8099521">bodyReader</span><span class="op" id="8099531">,</span>&nbsp;<span class="string" id="8099533">&#34;BOUNDARY&#34;</span><span class="op" id="8099543">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099547">buf</span>&nbsp;<span class="op" id="8099551">:=</span>&nbsp;<span class="builtinfunc" id="8099554">new</span><span class="op" id="8099557">(</span><span class="ident" id="8099558">bytes</span><span class="op" id="8099563">.</span><span class="ident" id="8099564">Buffer</span><span class="op" id="8099570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099574">part</span><span class="op" id="8099578">,</span>&nbsp;<span class="ident" id="8099580">err</span>&nbsp;<span class="op" id="8099584">:=</span>&nbsp;<span class="ident" id="8099587">reader</span><span class="op" id="8099593">.</span><span class="ident" id="8099594">NextPart</span><span class="op" id="8099602">(</span><span class="op" id="8099603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099607">if</span>&nbsp;<span class="ident" id="8099610">part</span>&nbsp;<span class="op" id="8099615">==</span>&nbsp;<span class="ident" id="8099618">nil</span>&nbsp;<span class="op" id="8099622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099627">t</span><span class="op" id="8099628">.</span><span class="ident" id="8099629">Errorf</span><span class="op" id="8099635">(</span><span class="string" id="8099636">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="8099669">,</span>&nbsp;<span class="ident" id="8099671">testNum</span><span class="op" id="8099678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099683">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099698">if</span>&nbsp;<span class="ident" id="8099701">err</span>&nbsp;<span class="op" id="8099705">!=</span>&nbsp;<span class="ident" id="8099708">nil</span>&nbsp;<span class="op" id="8099712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099717">t</span><span class="op" id="8099718">.</span><span class="ident" id="8099719">Errorf</span><span class="op" id="8099725">(</span><span class="string" id="8099726">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8099759">,</span>&nbsp;<span class="ident" id="8099761">testNum</span><span class="op" id="8099768">,</span>&nbsp;<span class="ident" id="8099770">err</span><span class="op" id="8099773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099778">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099789">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099793">written</span><span class="op" id="8099800">,</span>&nbsp;<span class="ident" id="8099802">err</span>&nbsp;<span class="op" id="8099806">:=</span>&nbsp;<span class="ident" id="8099809">io</span><span class="op" id="8099811">.</span><span class="ident" id="8099812">Copy</span><span class="op" id="8099816">(</span><span class="ident" id="8099817">buf</span><span class="op" id="8099820">,</span>&nbsp;<span class="ident" id="8099822">part</span><span class="op" id="8099826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099830">expectEq</span><span class="op" id="8099838">(</span><span class="ident" id="8099839">t</span><span class="op" id="8099840">,</span>&nbsp;<span class="ident" id="8099842">expectedBody</span><span class="op" id="8099854">,</span>&nbsp;<span class="ident" id="8099856">buf</span><span class="op" id="8099859">.</span><span class="ident" id="8099860">String</span><span class="op" id="8099866">(</span><span class="op" id="8099867">)</span><span class="op" id="8099868">,</span>&nbsp;<span class="ident" id="8099870">fmt</span><span class="op" id="8099873">.</span><span class="ident" id="8099874">Sprintf</span><span class="op" id="8099881">(</span><span class="string" id="8099882">&#34;test&nbsp;%d&#34;</span><span class="op" id="8099891">,</span>&nbsp;<span class="ident" id="8099893">testNum</span><span class="op" id="8099900">)</span><span class="op" id="8099901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099905">if</span>&nbsp;<span class="ident" id="8099908">err</span>&nbsp;<span class="op" id="8099912">!=</span>&nbsp;<span class="ident" id="8099915">nil</span>&nbsp;<span class="op" id="8099919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099924">t</span><span class="op" id="8099925">.</span><span class="ident" id="8099926">Errorf</span><span class="op" id="8099932">(</span><span class="string" id="8099933">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="8099978">,</span>&nbsp;<span class="ident" id="8099980">written</span><span class="op" id="8099987">,</span>&nbsp;<span class="ident" id="8099989">err</span><span class="op" id="8099992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099996">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100001">part</span><span class="op" id="8100005">,</span>&nbsp;<span class="ident" id="8100007">err</span>&nbsp;<span class="op" id="8100011">=</span>&nbsp;<span class="ident" id="8100013">reader</span><span class="op" id="8100019">.</span><span class="ident" id="8100020">NextPart</span><span class="op" id="8100028">(</span><span class="op" id="8100029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100033">if</span>&nbsp;<span class="ident" id="8100036">part</span>&nbsp;<span class="op" id="8100041">!=</span>&nbsp;<span class="ident" id="8100044">nil</span>&nbsp;<span class="op" id="8100048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100053">t</span><span class="op" id="8100054">.</span><span class="ident" id="8100055">Errorf</span><span class="op" id="8100061">(</span><span class="string" id="8100062">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="8100090">,</span>&nbsp;<span class="ident" id="8100092">testNum</span><span class="op" id="8100099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100103">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100107">if</span>&nbsp;<span class="ident" id="8100110">err</span>&nbsp;<span class="op" id="8100114">!=</span>&nbsp;<span class="ident" id="8100117">io</span><span class="op" id="8100119">.</span><span class="ident" id="8100120">EOF</span>&nbsp;<span class="op" id="8100124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100129">t</span><span class="op" id="8100130">.</span><span class="ident" id="8100131">Errorf</span><span class="op" id="8100137">(</span><span class="string" id="8100138">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8100174">,</span>&nbsp;<span class="ident" id="8100176">testNum</span><span class="op" id="8100183">,</span>&nbsp;<span class="ident" id="8100185">err</span><span class="op" id="8100188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100196">}</span><br>
<span class="lineno">260</span><span class="op" id="8100198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100201">type</span>&nbsp;<span class="ident" id="8100206">maliciousReader</span>&nbsp;<span class="keyword" id="8100222">struct</span>&nbsp;<span class="op" id="8100229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100232">t</span>&nbsp;<span class="op" id="8100234">*</span><span class="ident" id="8100235">testing</span><span class="op" id="8100242">.</span><span class="ident" id="8100243">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100246">n</span>&nbsp;<span class="builtintype" id="8100248">int</span><br>
<span class="lineno">265</span><span class="op" id="8100252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100255">const</span>&nbsp;<span class="ident" id="8100261">maxReadThreshold</span>&nbsp;<span class="op" id="8100278">=</span>&nbsp;<span class="num" id="8100280">1</span>&nbsp;<span class="op" id="8100282">&lt;&lt;</span>&nbsp;<span class="num" id="8100285">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100289">func</span>&nbsp;<span class="op" id="8100294">(</span><span class="ident" id="8100295">mr</span>&nbsp;<span class="op" id="8100298">*</span><span class="ident" id="8100299">maliciousReader</span><span class="op" id="8100314">)</span>&nbsp;<span class="ident" id="8100316">Read</span><span class="op" id="8100320">(</span><span class="ident" id="8100321">b</span>&nbsp;<span class="op" id="8100323">[</span><span class="op" id="8100324">]</span><span class="builtintype" id="8100325">byte</span><span class="op" id="8100329">)</span>&nbsp;<span class="op" id="8100331">(</span><span class="ident" id="8100332">n</span>&nbsp;<span class="builtintype" id="8100334">int</span><span class="op" id="8100337">,</span>&nbsp;<span class="ident" id="8100339">err</span>&nbsp;<span class="builtintype" id="8100343">error</span><span class="op" id="8100348">)</span>&nbsp;<span class="op" id="8100350">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100353">mr</span><span class="op" id="8100355">.</span><span class="ident" id="8100356">n</span>&nbsp;<span class="op" id="8100358">+=</span>&nbsp;<span class="builtinfunc" id="8100361">len</span><span class="op" id="8100364">(</span><span class="ident" id="8100365">b</span><span class="op" id="8100366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100369">if</span>&nbsp;<span class="ident" id="8100372">mr</span><span class="op" id="8100374">.</span><span class="ident" id="8100375">n</span>&nbsp;<span class="op" id="8100377">&gt;=</span>&nbsp;<span class="ident" id="8100380">maxReadThreshold</span>&nbsp;<span class="op" id="8100397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100401">mr</span><span class="op" id="8100403">.</span><span class="ident" id="8100404">t</span><span class="op" id="8100405">.</span><span class="ident" id="8100406">Fatal</span><span class="op" id="8100411">(</span><span class="string" id="8100412">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="8100431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100435">return</span>&nbsp;<span class="num" id="8100442">0</span><span class="op" id="8100443">,</span>&nbsp;<span class="ident" id="8100445">io</span><span class="op" id="8100447">.</span><span class="ident" id="8100448">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100453">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100456">return</span>&nbsp;<span class="builtinfunc" id="8100463">len</span><span class="op" id="8100466">(</span><span class="ident" id="8100467">b</span><span class="op" id="8100468">)</span><span class="op" id="8100469">,</span>&nbsp;<span class="ident" id="8100471">nil</span><br>
<span class="lineno"></span><span class="op" id="8100475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100478">func</span>&nbsp;<span class="ident" id="8100483">TestLineLimit</span><span class="op" id="8100496">(</span><span class="ident" id="8100497">t</span>&nbsp;<span class="op" id="8100499">*</span><span class="ident" id="8100500">testing</span><span class="op" id="8100507">.</span><span class="ident" id="8100508">T</span><span class="op" id="8100509">)</span>&nbsp;<span class="op" id="8100511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100514">mr</span>&nbsp;<span class="op" id="8100517">:=</span>&nbsp;<span class="op" id="8100520">&amp;</span><span class="ident" id="8100521">maliciousReader</span><span class="op" id="8100536">{</span><span class="ident" id="8100537">t</span><span class="op" id="8100538">:</span>&nbsp;<span class="ident" id="8100540">t</span><span class="op" id="8100541">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100544">r</span>&nbsp;<span class="op" id="8100546">:=</span>&nbsp;<span class="ident" id="8100549">NewReader</span><span class="op" id="8100558">(</span><span class="ident" id="8100559">mr</span><span class="op" id="8100561">,</span>&nbsp;<span class="string" id="8100563">&#34;fooBoundary&#34;</span><span class="op" id="8100576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100579">part</span><span class="op" id="8100583">,</span>&nbsp;<span class="ident" id="8100585">err</span>&nbsp;<span class="op" id="8100589">:=</span>&nbsp;<span class="ident" id="8100592">r</span><span class="op" id="8100593">.</span><span class="ident" id="8100594">NextPart</span><span class="op" id="8100602">(</span><span class="op" id="8100603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100606">if</span>&nbsp;<span class="ident" id="8100609">part</span>&nbsp;<span class="op" id="8100614">!=</span>&nbsp;<span class="ident" id="8100617">nil</span>&nbsp;<span class="op" id="8100621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100625">t</span><span class="op" id="8100626">.</span><span class="ident" id="8100627">Errorf</span><span class="op" id="8100633">(</span><span class="string" id="8100634">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="8100656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100659">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100662">if</span>&nbsp;<span class="ident" id="8100665">err</span>&nbsp;<span class="op" id="8100669">==</span>&nbsp;<span class="ident" id="8100672">nil</span>&nbsp;<span class="op" id="8100676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100680">t</span><span class="op" id="8100681">.</span><span class="ident" id="8100682">Errorf</span><span class="op" id="8100688">(</span><span class="string" id="8100689">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="8100708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100714">if</span>&nbsp;<span class="ident" id="8100717">mr</span><span class="op" id="8100719">.</span><span class="ident" id="8100720">n</span>&nbsp;<span class="op" id="8100722">&gt;=</span>&nbsp;<span class="ident" id="8100725">maxReadThreshold</span>&nbsp;<span class="op" id="8100742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100746">t</span><span class="op" id="8100747">.</span><span class="ident" id="8100748">Errorf</span><span class="op" id="8100754">(</span><span class="string" id="8100755">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8100793">,</span>&nbsp;<span class="ident" id="8100795">maxReadThreshold</span><span class="op" id="8100811">,</span>&nbsp;<span class="ident" id="8100813">mr</span><span class="op" id="8100815">.</span><span class="ident" id="8100816">n</span><span class="op" id="8100817">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100820">}</span><br>
<span class="lineno"></span><span class="op" id="8100822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100825">func</span>&nbsp;<span class="ident" id="8100830">TestMultipartTruncated</span><span class="op" id="8100852">(</span><span class="ident" id="8100853">t</span>&nbsp;<span class="op" id="8100855">*</span><span class="ident" id="8100856">testing</span><span class="op" id="8100863">.</span><span class="ident" id="8100864">T</span><span class="op" id="8100865">)</span>&nbsp;<span class="op" id="8100867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100870">testBody</span>&nbsp;<span class="op" id="8100879">:=</span>&nbsp;<span class="string" id="8100882">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100989">body</span>&nbsp;<span class="op" id="8100994">:=</span>&nbsp;<span class="ident" id="8100997">strings</span><span class="op" id="8101004">.</span><span class="ident" id="8101005">Replace</span><span class="op" id="8101012">(</span><span class="ident" id="8101013">testBody</span><span class="op" id="8101021">,</span>&nbsp;<span class="string" id="8101023">&#34;\n&#34;</span><span class="op" id="8101027">,</span>&nbsp;<span class="string" id="8101029">&#34;\r\n&#34;</span><span class="op" id="8101035">,</span>&nbsp;<span class="op" id="8101037">-</span><span class="num" id="8101038">1</span><span class="op" id="8101039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101042">bodyReader</span>&nbsp;<span class="op" id="8101053">:=</span>&nbsp;<span class="ident" id="8101056">strings</span><span class="op" id="8101063">.</span><span class="ident" id="8101064">NewReader</span><span class="op" id="8101073">(</span><span class="ident" id="8101074">body</span><span class="op" id="8101078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101081">r</span>&nbsp;<span class="op" id="8101083">:=</span>&nbsp;<span class="ident" id="8101086">NewReader</span><span class="op" id="8101095">(</span><span class="ident" id="8101096">bodyReader</span><span class="op" id="8101106">,</span>&nbsp;<span class="string" id="8101108">&#34;MyBoundary&#34;</span><span class="op" id="8101120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101124">part</span><span class="op" id="8101128">,</span>&nbsp;<span class="ident" id="8101130">err</span>&nbsp;<span class="op" id="8101134">:=</span>&nbsp;<span class="ident" id="8101137">r</span><span class="op" id="8101138">.</span><span class="ident" id="8101139">NextPart</span><span class="op" id="8101147">(</span><span class="op" id="8101148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101151">if</span>&nbsp;<span class="ident" id="8101154">err</span>&nbsp;<span class="op" id="8101158">!=</span>&nbsp;<span class="ident" id="8101161">nil</span>&nbsp;<span class="op" id="8101165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101169">t</span><span class="op" id="8101170">.</span><span class="ident" id="8101171">Fatalf</span><span class="op" id="8101177">(</span><span class="string" id="8101178">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8101197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101203">_</span><span class="op" id="8101204">,</span>&nbsp;<span class="ident" id="8101206">err</span>&nbsp;<span class="op" id="8101210">=</span>&nbsp;<span class="ident" id="8101212">io</span><span class="op" id="8101214">.</span><span class="ident" id="8101215">Copy</span><span class="op" id="8101219">(</span><span class="ident" id="8101220">ioutil</span><span class="op" id="8101226">.</span><span class="ident" id="8101227">Discard</span><span class="op" id="8101234">,</span>&nbsp;<span class="ident" id="8101236">part</span><span class="op" id="8101240">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101243">if</span>&nbsp;<span class="ident" id="8101246">err</span>&nbsp;<span class="op" id="8101250">!=</span>&nbsp;<span class="ident" id="8101253">io</span><span class="op" id="8101255">.</span><span class="ident" id="8101256">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8101273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101277">t</span><span class="op" id="8101278">.</span><span class="ident" id="8101279">Fatalf</span><span class="op" id="8101285">(</span><span class="string" id="8101286">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8101330">,</span>&nbsp;<span class="ident" id="8101332">err</span><span class="op" id="8101335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101338">}</span><br>
<span class="lineno"></span><span class="op" id="8101340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8101343">type</span>&nbsp;<span class="ident" id="8101348">slowReader</span>&nbsp;<span class="keyword" id="8101359">struct</span>&nbsp;<span class="op" id="8101366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101369">r</span>&nbsp;<span class="ident" id="8101371">io</span><span class="op" id="8101373">.</span><span class="ident" id="8101374">Reader</span><br>
<span class="lineno"></span><span class="op" id="8101381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8101384">func</span>&nbsp;<span class="op" id="8101389">(</span><span class="ident" id="8101390">s</span>&nbsp;<span class="op" id="8101392">*</span><span class="ident" id="8101393">slowReader</span><span class="op" id="8101403">)</span>&nbsp;<span class="ident" id="8101405">Read</span><span class="op" id="8101409">(</span><span class="ident" id="8101410">p</span>&nbsp;<span class="op" id="8101412">[</span><span class="op" id="8101413">]</span><span class="builtintype" id="8101414">byte</span><span class="op" id="8101418">)</span>&nbsp;<span class="op" id="8101420">(</span><span class="builtintype" id="8101421">int</span><span class="op" id="8101424">,</span>&nbsp;<span class="builtintype" id="8101426">error</span><span class="op" id="8101431">)</span>&nbsp;<span class="op" id="8101433">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101436">if</span>&nbsp;<span class="builtinfunc" id="8101439">len</span><span class="op" id="8101442">(</span><span class="ident" id="8101443">p</span><span class="op" id="8101444">)</span>&nbsp;<span class="op" id="8101446">==</span>&nbsp;<span class="num" id="8101449">0</span>&nbsp;<span class="op" id="8101451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101455">return</span>&nbsp;<span class="ident" id="8101462">s</span><span class="op" id="8101463">.</span><span class="ident" id="8101464">r</span><span class="op" id="8101465">.</span><span class="ident" id="8101466">Read</span><span class="op" id="8101470">(</span><span class="ident" id="8101471">p</span><span class="op" id="8101472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101478">return</span>&nbsp;<span class="ident" id="8101485">s</span><span class="op" id="8101486">.</span><span class="ident" id="8101487">r</span><span class="op" id="8101488">.</span><span class="ident" id="8101489">Read</span><span class="op" id="8101493">(</span><span class="ident" id="8101494">p</span><span class="op" id="8101495">[</span><span class="op" id="8101496">:</span><span class="num" id="8101497">1</span><span class="op" id="8101498">]</span><span class="op" id="8101499">)</span><br>
<span class="lineno"></span><span class="op" id="8101501">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8101504">func</span>&nbsp;<span class="ident" id="8101509">TestLineContinuation</span><span class="op" id="8101529">(</span><span class="ident" id="8101530">t</span>&nbsp;<span class="op" id="8101532">*</span><span class="ident" id="8101533">testing</span><span class="op" id="8101540">.</span><span class="ident" id="8101541">T</span><span class="op" id="8101542">)</span>&nbsp;<span class="op" id="8101544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101547">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101623">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101635">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101702">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101763">testBody</span>&nbsp;<span class="op" id="8101772">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8101777">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102273">r</span>&nbsp;<span class="op" id="8102275">:=</span>&nbsp;<span class="ident" id="8102278">NewReader</span><span class="op" id="8102287">(</span><span class="ident" id="8102288">strings</span><span class="op" id="8102295">.</span><span class="ident" id="8102296">NewReader</span><span class="op" id="8102305">(</span><span class="ident" id="8102306">testBody</span><span class="op" id="8102314">)</span><span class="op" id="8102315">,</span>&nbsp;<span class="string" id="8102317">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="8102341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102345">for</span>&nbsp;<span class="ident" id="8102349">i</span>&nbsp;<span class="op" id="8102351">:=</span>&nbsp;<span class="num" id="8102354">0</span><span class="op" id="8102355">;</span>&nbsp;<span class="ident" id="8102357">i</span>&nbsp;<span class="op" id="8102359">&lt;</span>&nbsp;<span class="num" id="8102361">2</span><span class="op" id="8102362">;</span>&nbsp;<span class="ident" id="8102364">i</span><span class="op" id="8102365">++</span>&nbsp;<span class="op" id="8102368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102372">part</span><span class="op" id="8102376">,</span>&nbsp;<span class="ident" id="8102378">err</span>&nbsp;<span class="op" id="8102382">:=</span>&nbsp;<span class="ident" id="8102385">r</span><span class="op" id="8102386">.</span><span class="ident" id="8102387">NextPart</span><span class="op" id="8102395">(</span><span class="op" id="8102396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102400">if</span>&nbsp;<span class="ident" id="8102403">err</span>&nbsp;<span class="op" id="8102407">!=</span>&nbsp;<span class="ident" id="8102410">nil</span>&nbsp;<span class="op" id="8102414">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102419">t</span><span class="op" id="8102420">.</span><span class="ident" id="8102421">Fatalf</span><span class="op" id="8102427">(</span><span class="string" id="8102428">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8102447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102455">var</span>&nbsp;<span class="ident" id="8102459">buf</span>&nbsp;<span class="ident" id="8102463">bytes</span><span class="op" id="8102468">.</span><span class="ident" id="8102469">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102478">n</span><span class="op" id="8102479">,</span>&nbsp;<span class="ident" id="8102481">err</span>&nbsp;<span class="op" id="8102485">:=</span>&nbsp;<span class="ident" id="8102488">io</span><span class="op" id="8102490">.</span><span class="ident" id="8102491">Copy</span><span class="op" id="8102495">(</span><span class="op" id="8102496">&amp;</span><span class="ident" id="8102497">buf</span><span class="op" id="8102500">,</span>&nbsp;<span class="ident" id="8102502">part</span><span class="op" id="8102506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102510">if</span>&nbsp;<span class="ident" id="8102513">err</span>&nbsp;<span class="op" id="8102517">!=</span>&nbsp;<span class="ident" id="8102520">nil</span>&nbsp;<span class="op" id="8102524">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102529">t</span><span class="op" id="8102530">.</span><span class="ident" id="8102531">Errorf</span><span class="op" id="8102537">(</span><span class="string" id="8102538">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="8102579">,</span>&nbsp;<span class="ident" id="8102581">err</span><span class="op" id="8102584">,</span>&nbsp;<span class="ident" id="8102586">buf</span><span class="op" id="8102589">.</span><span class="ident" id="8102590">String</span><span class="op" id="8102596">(</span><span class="op" id="8102597">)</span><span class="op" id="8102598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102606">if</span>&nbsp;<span class="ident" id="8102609">n</span>&nbsp;<span class="op" id="8102611">&lt;=</span>&nbsp;<span class="num" id="8102614">0</span>&nbsp;<span class="op" id="8102616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102621">t</span><span class="op" id="8102622">.</span><span class="ident" id="8102623">Errorf</span><span class="op" id="8102629">(</span><span class="string" id="8102630">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="8102658">,</span>&nbsp;<span class="ident" id="8102660">n</span><span class="op" id="8102661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102665">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102668">}</span><br>
<span class="lineno"></span><span class="op" id="8102670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8102673">func</span>&nbsp;<span class="ident" id="8102678">TestQuotedPrintableEncoding</span><span class="op" id="8102705">(</span><span class="ident" id="8102706">t</span>&nbsp;<span class="op" id="8102708">*</span><span class="ident" id="8102709">testing</span><span class="op" id="8102716">.</span><span class="ident" id="8102717">T</span><span class="op" id="8102718">)</span>&nbsp;<span class="op" id="8102720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8102723">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102761">body</span>&nbsp;<span class="op" id="8102766">:=</span>&nbsp;<span class="string" id="8102769">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103503">r</span>&nbsp;<span class="op" id="8103505">:=</span>&nbsp;<span class="ident" id="8103508">NewReader</span><span class="op" id="8103517">(</span><span class="ident" id="8103518">strings</span><span class="op" id="8103525">.</span><span class="ident" id="8103526">NewReader</span><span class="op" id="8103535">(</span><span class="ident" id="8103536">body</span><span class="op" id="8103540">)</span><span class="op" id="8103541">,</span>&nbsp;<span class="string" id="8103543">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="8103573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103576">part</span><span class="op" id="8103580">,</span>&nbsp;<span class="ident" id="8103582">err</span>&nbsp;<span class="op" id="8103586">:=</span>&nbsp;<span class="ident" id="8103589">r</span><span class="op" id="8103590">.</span><span class="ident" id="8103591">NextPart</span><span class="op" id="8103599">(</span><span class="op" id="8103600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103603">if</span>&nbsp;<span class="ident" id="8103606">err</span>&nbsp;<span class="op" id="8103610">!=</span>&nbsp;<span class="ident" id="8103613">nil</span>&nbsp;<span class="op" id="8103617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103621">t</span><span class="op" id="8103622">.</span><span class="ident" id="8103623">Fatal</span><span class="op" id="8103628">(</span><span class="ident" id="8103629">err</span><span class="op" id="8103632">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103638">if</span>&nbsp;<span class="ident" id="8103641">te</span><span class="op" id="8103643">,</span>&nbsp;<span class="ident" id="8103645">ok</span>&nbsp;<span class="op" id="8103648">:=</span>&nbsp;<span class="ident" id="8103651">part</span><span class="op" id="8103655">.</span><span class="ident" id="8103656">Header</span><span class="op" id="8103662">[</span><span class="string" id="8103663">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="8103690">]</span><span class="op" id="8103691">;</span>&nbsp;<span class="ident" id="8103693">ok</span>&nbsp;<span class="op" id="8103696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103700">t</span><span class="op" id="8103701">.</span><span class="ident" id="8103702">Errorf</span><span class="op" id="8103708">(</span><span class="string" id="8103709">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8103753">,</span>&nbsp;<span class="ident" id="8103755">te</span><span class="op" id="8103757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103763">var</span>&nbsp;<span class="ident" id="8103767">buf</span>&nbsp;<span class="ident" id="8103771">bytes</span><span class="op" id="8103776">.</span><span class="ident" id="8103777">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103785">_</span><span class="op" id="8103786">,</span>&nbsp;<span class="ident" id="8103788">err</span>&nbsp;<span class="op" id="8103792">=</span>&nbsp;<span class="ident" id="8103794">io</span><span class="op" id="8103796">.</span><span class="ident" id="8103797">Copy</span><span class="op" id="8103801">(</span><span class="op" id="8103802">&amp;</span><span class="ident" id="8103803">buf</span><span class="op" id="8103806">,</span>&nbsp;<span class="ident" id="8103808">part</span><span class="op" id="8103812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103815">if</span>&nbsp;<span class="ident" id="8103818">err</span>&nbsp;<span class="op" id="8103822">!=</span>&nbsp;<span class="ident" id="8103825">nil</span>&nbsp;<span class="op" id="8103829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103833">t</span><span class="op" id="8103834">.</span><span class="ident" id="8103835">Error</span><span class="op" id="8103840">(</span><span class="ident" id="8103841">err</span><span class="op" id="8103844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103850">got</span>&nbsp;<span class="op" id="8103854">:=</span>&nbsp;<span class="ident" id="8103857">buf</span><span class="op" id="8103860">.</span><span class="ident" id="8103861">String</span><span class="op" id="8103867">(</span><span class="op" id="8103868">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103871">want</span>&nbsp;<span class="op" id="8103876">:=</span>&nbsp;<span class="string" id="8103879">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104236">if</span>&nbsp;<span class="ident" id="8104239">got</span>&nbsp;<span class="op" id="8104243">!=</span>&nbsp;<span class="ident" id="8104246">want</span>&nbsp;<span class="op" id="8104251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104255">t</span><span class="op" id="8104256">.</span><span class="ident" id="8104257">Errorf</span><span class="op" id="8104263">(</span><span class="string" id="8104264">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="8104303">,</span>&nbsp;<span class="ident" id="8104305">got</span><span class="op" id="8104308">,</span>&nbsp;<span class="ident" id="8104310">want</span><span class="op" id="8104314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104317">}</span><br>
<span class="lineno"></span><span class="op" id="8104319">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="8104322">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="8104395">func</span>&nbsp;<span class="ident" id="8104400">TestNested</span><span class="op" id="8104410">(</span><span class="ident" id="8104411">t</span>&nbsp;<span class="op" id="8104413">*</span><span class="ident" id="8104414">testing</span><span class="op" id="8104421">.</span><span class="ident" id="8104422">T</span><span class="op" id="8104423">)</span>&nbsp;<span class="op" id="8104425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8104428">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8104488">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104535">f</span><span class="op" id="8104536">,</span>&nbsp;<span class="ident" id="8104538">err</span>&nbsp;<span class="op" id="8104542">:=</span>&nbsp;<span class="ident" id="8104545">os</span><span class="op" id="8104547">.</span><span class="ident" id="8104548">Open</span><span class="op" id="8104552">(</span><span class="string" id="8104553">&#34;testdata/nested-mime&#34;</span><span class="op" id="8104575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104578">if</span>&nbsp;<span class="ident" id="8104581">err</span>&nbsp;<span class="op" id="8104585">!=</span>&nbsp;<span class="ident" id="8104588">nil</span>&nbsp;<span class="op" id="8104592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104596">t</span><span class="op" id="8104597">.</span><span class="ident" id="8104598">Fatal</span><span class="op" id="8104603">(</span><span class="ident" id="8104604">err</span><span class="op" id="8104607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104613">defer</span>&nbsp;<span class="ident" id="8104619">f</span><span class="op" id="8104620">.</span><span class="ident" id="8104621">Close</span><span class="op" id="8104626">(</span><span class="op" id="8104627">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104630">mr</span>&nbsp;<span class="op" id="8104633">:=</span>&nbsp;<span class="ident" id="8104636">NewReader</span><span class="op" id="8104645">(</span><span class="ident" id="8104646">f</span><span class="op" id="8104647">,</span>&nbsp;<span class="string" id="8104649">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="8104679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104682">p</span><span class="op" id="8104683">,</span>&nbsp;<span class="ident" id="8104685">err</span>&nbsp;<span class="op" id="8104689">:=</span>&nbsp;<span class="ident" id="8104692">mr</span><span class="op" id="8104694">.</span><span class="ident" id="8104695">NextPart</span><span class="op" id="8104703">(</span><span class="op" id="8104704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104707">if</span>&nbsp;<span class="ident" id="8104710">err</span>&nbsp;<span class="op" id="8104714">!=</span>&nbsp;<span class="ident" id="8104717">nil</span>&nbsp;<span class="op" id="8104721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104725">t</span><span class="op" id="8104726">.</span><span class="ident" id="8104727">Fatalf</span><span class="op" id="8104733">(</span><span class="string" id="8104734">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="8104781">,</span>&nbsp;<span class="ident" id="8104783">err</span><span class="op" id="8104786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104789">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8104793">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104876">mr2</span>&nbsp;<span class="op" id="8104880">:=</span>&nbsp;<span class="ident" id="8104883">NewReader</span><span class="op" id="8104892">(</span><span class="ident" id="8104893">p</span><span class="op" id="8104894">,</span>&nbsp;<span class="string" id="8104896">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="8104926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104929">p</span><span class="op" id="8104930">,</span>&nbsp;<span class="ident" id="8104932">err</span>&nbsp;<span class="op" id="8104936">=</span>&nbsp;<span class="ident" id="8104938">mr2</span><span class="op" id="8104941">.</span><span class="ident" id="8104942">NextPart</span><span class="op" id="8104950">(</span><span class="op" id="8104951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104954">if</span>&nbsp;<span class="ident" id="8104957">err</span>&nbsp;<span class="op" id="8104961">!=</span>&nbsp;<span class="ident" id="8104964">nil</span>&nbsp;<span class="op" id="8104968">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104972">t</span><span class="op" id="8104973">.</span><span class="ident" id="8104974">Fatalf</span><span class="op" id="8104980">(</span><span class="string" id="8104981">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8105010">,</span>&nbsp;<span class="ident" id="8105012">err</span><span class="op" id="8105015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105021">if</span>&nbsp;<span class="ident" id="8105024">b</span><span class="op" id="8105025">,</span>&nbsp;<span class="ident" id="8105027">err</span>&nbsp;<span class="op" id="8105031">:=</span>&nbsp;<span class="ident" id="8105034">ioutil</span><span class="op" id="8105040">.</span><span class="ident" id="8105041">ReadAll</span><span class="op" id="8105048">(</span><span class="ident" id="8105049">p</span><span class="op" id="8105050">)</span><span class="op" id="8105051">;</span>&nbsp;<span class="builtintype" id="8105053">string</span><span class="op" id="8105059">(</span><span class="ident" id="8105060">b</span><span class="op" id="8105061">)</span>&nbsp;<span class="op" id="8105063">!=</span>&nbsp;<span class="string" id="8105066">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="8105079">||</span>&nbsp;<span class="ident" id="8105082">err</span>&nbsp;<span class="op" id="8105086">!=</span>&nbsp;<span class="ident" id="8105089">nil</span>&nbsp;<span class="op" id="8105093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105097">t</span><span class="op" id="8105098">.</span><span class="ident" id="8105099">Fatalf</span><span class="op" id="8105105">(</span><span class="string" id="8105106">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8105143">,</span>&nbsp;<span class="ident" id="8105145">b</span><span class="op" id="8105146">,</span>&nbsp;<span class="ident" id="8105148">err</span><span class="op" id="8105151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105154">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105157">p</span><span class="op" id="8105158">,</span>&nbsp;<span class="ident" id="8105160">err</span>&nbsp;<span class="op" id="8105164">=</span>&nbsp;<span class="ident" id="8105166">mr2</span><span class="op" id="8105169">.</span><span class="ident" id="8105170">NextPart</span><span class="op" id="8105178">(</span><span class="op" id="8105179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105182">if</span>&nbsp;<span class="ident" id="8105185">err</span>&nbsp;<span class="op" id="8105189">!=</span>&nbsp;<span class="ident" id="8105192">nil</span>&nbsp;<span class="op" id="8105196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105200">t</span><span class="op" id="8105201">.</span><span class="ident" id="8105202">Fatalf</span><span class="op" id="8105208">(</span><span class="string" id="8105209">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8105237">,</span>&nbsp;<span class="ident" id="8105239">err</span><span class="op" id="8105242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105248">if</span>&nbsp;<span class="ident" id="8105251">b</span><span class="op" id="8105252">,</span>&nbsp;<span class="ident" id="8105254">err</span>&nbsp;<span class="op" id="8105258">:=</span>&nbsp;<span class="ident" id="8105261">ioutil</span><span class="op" id="8105267">.</span><span class="ident" id="8105268">ReadAll</span><span class="op" id="8105275">(</span><span class="ident" id="8105276">p</span><span class="op" id="8105277">)</span><span class="op" id="8105278">;</span>&nbsp;<span class="builtintype" id="8105280">string</span><span class="op" id="8105286">(</span><span class="ident" id="8105287">b</span><span class="op" id="8105288">)</span>&nbsp;<span class="op" id="8105290">!=</span>&nbsp;<span class="string" id="8105293">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="8105311">||</span>&nbsp;<span class="ident" id="8105314">err</span>&nbsp;<span class="op" id="8105318">!=</span>&nbsp;<span class="ident" id="8105321">nil</span>&nbsp;<span class="op" id="8105325">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105329">t</span><span class="op" id="8105330">.</span><span class="ident" id="8105331">Fatalf</span><span class="op" id="8105337">(</span><span class="string" id="8105338">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8105374">,</span>&nbsp;<span class="ident" id="8105376">b</span><span class="op" id="8105377">,</span>&nbsp;<span class="ident" id="8105379">err</span><span class="op" id="8105382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105389">p</span><span class="op" id="8105390">,</span>&nbsp;<span class="ident" id="8105392">err</span>&nbsp;<span class="op" id="8105396">=</span>&nbsp;<span class="ident" id="8105398">mr2</span><span class="op" id="8105401">.</span><span class="ident" id="8105402">NextPart</span><span class="op" id="8105410">(</span><span class="op" id="8105411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105414">if</span>&nbsp;<span class="ident" id="8105417">err</span>&nbsp;<span class="op" id="8105421">!=</span>&nbsp;<span class="ident" id="8105424">io</span><span class="op" id="8105426">.</span><span class="ident" id="8105427">EOF</span>&nbsp;<span class="op" id="8105431">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105435">t</span><span class="op" id="8105436">.</span><span class="ident" id="8105437">Fatalf</span><span class="op" id="8105443">(</span><span class="string" id="8105444">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8105484">,</span>&nbsp;<span class="ident" id="8105486">err</span><span class="op" id="8105489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8105496">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105565">_</span><span class="op" id="8105566">,</span>&nbsp;<span class="ident" id="8105568">err</span>&nbsp;<span class="op" id="8105572">=</span>&nbsp;<span class="ident" id="8105574">mr</span><span class="op" id="8105576">.</span><span class="ident" id="8105577">NextPart</span><span class="op" id="8105585">(</span><span class="op" id="8105586">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105589">if</span>&nbsp;<span class="ident" id="8105592">err</span>&nbsp;<span class="op" id="8105596">!=</span>&nbsp;<span class="ident" id="8105599">nil</span>&nbsp;<span class="op" id="8105603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105607">t</span><span class="op" id="8105608">.</span><span class="ident" id="8105609">Fatalf</span><span class="op" id="8105615">(</span><span class="string" id="8105616">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="8105667">,</span>&nbsp;<span class="ident" id="8105669">err</span><span class="op" id="8105672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105679">_</span><span class="op" id="8105680">,</span>&nbsp;<span class="ident" id="8105682">err</span>&nbsp;<span class="op" id="8105686">=</span>&nbsp;<span class="ident" id="8105688">mr</span><span class="op" id="8105690">.</span><span class="ident" id="8105691">NextPart</span><span class="op" id="8105699">(</span><span class="op" id="8105700">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105703">if</span>&nbsp;<span class="ident" id="8105706">err</span>&nbsp;<span class="op" id="8105710">!=</span>&nbsp;<span class="ident" id="8105713">io</span><span class="op" id="8105715">.</span><span class="ident" id="8105716">EOF</span>&nbsp;<span class="op" id="8105720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105724">t</span><span class="op" id="8105725">.</span><span class="ident" id="8105726">Fatalf</span><span class="op" id="8105732">(</span><span class="string" id="8105733">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8105773">,</span>&nbsp;<span class="ident" id="8105775">err</span><span class="op" id="8105778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105781">}</span><br>
<span class="lineno"></span><span class="op" id="8105783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="8105786">type</span>&nbsp;<span class="ident" id="8105791">headerBody</span>&nbsp;<span class="keyword" id="8105802">struct</span>&nbsp;<span class="op" id="8105809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105812">header</span>&nbsp;<span class="ident" id="8105819">textproto</span><span class="op" id="8105828">.</span><span class="ident" id="8105829">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105841">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8105848">string</span><br>
<span class="lineno"></span><span class="op" id="8105855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8105858">func</span>&nbsp;<span class="ident" id="8105863">formData</span><span class="op" id="8105871">(</span><span class="ident" id="8105872">key</span><span class="op" id="8105875">,</span>&nbsp;<span class="ident" id="8105877">value</span>&nbsp;<span class="builtintype" id="8105883">string</span><span class="op" id="8105889">)</span>&nbsp;<span class="ident" id="8105891">headerBody</span>&nbsp;<span class="op" id="8105902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105905">return</span>&nbsp;<span class="ident" id="8105912">headerBody</span><span class="op" id="8105922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105926">textproto</span><span class="op" id="8105935">.</span><span class="ident" id="8105936">MIMEHeader</span><span class="op" id="8105946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8105951">&#34;Content-Type&#34;</span><span class="op" id="8105965">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105974">{</span><span class="string" id="8105975">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="8106007">}</span><span class="op" id="8106008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106013">&#34;Content-Disposition&#34;</span><span class="op" id="8106034">:</span>&nbsp;<span class="op" id="8106036">{</span><span class="string" id="8106037">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="8106056">+</span>&nbsp;<span class="ident" id="8106058">key</span><span class="op" id="8106061">}</span><span class="op" id="8106062">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106066">}</span><span class="op" id="8106067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106071">value</span><span class="op" id="8106076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106079">}</span><br>
<span class="lineno"></span><span class="op" id="8106081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="8106084">type</span>&nbsp;<span class="ident" id="8106089">parseTest</span>&nbsp;<span class="keyword" id="8106099">struct</span>&nbsp;<span class="op" id="8106106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106109">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8106117">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106125">in</span><span class="op" id="8106127">,</span>&nbsp;<span class="ident" id="8106129">sep</span>&nbsp;<span class="builtintype" id="8106133">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106141">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106149">[</span><span class="op" id="8106150">]</span><span class="ident" id="8106151">headerBody</span><br>
<span class="lineno"></span><span class="op" id="8106162">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8106165">var</span>&nbsp;<span class="ident" id="8106169">parseTests</span>&nbsp;<span class="op" id="8106180">=</span>&nbsp;<span class="op" id="8106182">[</span><span class="op" id="8106183">]</span><span class="ident" id="8106184">parseTest</span><span class="op" id="8106193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106196">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106266">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106335">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106401">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106464">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8106530">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106597">name</span><span class="op" id="8106601">:</span>&nbsp;<span class="string" id="8106603">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="8106620">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106624">sep</span><span class="op" id="8106627">:</span>&nbsp;&nbsp;<span class="string" id="8106630">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="8106660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106664">in</span><span class="op" id="8106666">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8106670">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="8108578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108582">want</span><span class="op" id="8108586">:</span>&nbsp;<span class="op" id="8108588">[</span><span class="op" id="8108589">]</span><span class="ident" id="8108590">headerBody</span><span class="op" id="8108600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108605">formData</span><span class="op" id="8108613">(</span><span class="string" id="8108614">&#34;otherEmpty1&#34;</span><span class="op" id="8108627">,</span>&nbsp;<span class="string" id="8108629">&#34;&#34;</span><span class="op" id="8108631">)</span><span class="op" id="8108632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108637">formData</span><span class="op" id="8108645">(</span><span class="string" id="8108646">&#34;otherFoo1&#34;</span><span class="op" id="8108657">,</span>&nbsp;<span class="string" id="8108659">&#34;foo&#34;</span><span class="op" id="8108664">)</span><span class="op" id="8108665">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108670">formData</span><span class="op" id="8108678">(</span><span class="string" id="8108679">&#34;otherFoo2&#34;</span><span class="op" id="8108690">,</span>&nbsp;<span class="string" id="8108692">&#34;foo&#34;</span><span class="op" id="8108697">)</span><span class="op" id="8108698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108703">formData</span><span class="op" id="8108711">(</span><span class="string" id="8108712">&#34;otherEmpty2&#34;</span><span class="op" id="8108725">,</span>&nbsp;<span class="string" id="8108727">&#34;&#34;</span><span class="op" id="8108729">)</span><span class="op" id="8108730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108735">formData</span><span class="op" id="8108743">(</span><span class="string" id="8108744">&#34;otherRepeatFoo&#34;</span><span class="op" id="8108760">,</span>&nbsp;<span class="string" id="8108762">&#34;foo&#34;</span><span class="op" id="8108767">)</span><span class="op" id="8108768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108773">formData</span><span class="op" id="8108781">(</span><span class="string" id="8108782">&#34;otherRepeatFoo&#34;</span><span class="op" id="8108798">,</span>&nbsp;<span class="string" id="8108800">&#34;foo&#34;</span><span class="op" id="8108805">)</span><span class="op" id="8108806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108811">formData</span><span class="op" id="8108819">(</span><span class="string" id="8108820">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8108838">,</span>&nbsp;<span class="string" id="8108840">&#34;&#34;</span><span class="op" id="8108842">)</span><span class="op" id="8108843">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108848">formData</span><span class="op" id="8108856">(</span><span class="string" id="8108857">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8108875">,</span>&nbsp;<span class="string" id="8108877">&#34;&#34;</span><span class="op" id="8108879">)</span><span class="op" id="8108880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108885">formData</span><span class="op" id="8108893">(</span><span class="string" id="8108894">&#34;submit&#34;</span><span class="op" id="8108902">,</span>&nbsp;<span class="string" id="8108904">&#34;Submit&#34;</span><span class="op" id="8108912">)</span><span class="op" id="8108913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108918">{</span><span class="ident" id="8108919">textproto</span><span class="op" id="8108928">.</span><span class="ident" id="8108929">MIMEHeader</span><span class="op" id="8108939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8108945">&#34;Content-Type&#34;</span><span class="op" id="8108959">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108968">{</span><span class="string" id="8108969">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="8109185">}</span><span class="op" id="8109186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8109192">&#34;Content-Disposition&#34;</span><span class="op" id="8109213">:</span>&nbsp;<span class="op" id="8109215">{</span><span class="string" id="8109216">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="8109261">}</span><span class="op" id="8109262">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109267">}</span><span class="op" id="8109268">,</span>&nbsp;<span class="string" id="8109270">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="8109517">}</span><span class="op" id="8109518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109522">}</span><span class="op" id="8109523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109526">}</span><span class="op" id="8109527">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8109531">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109607">name</span><span class="op" id="8109611">:</span>&nbsp;<span class="string" id="8109613">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="8109644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109648">sep</span><span class="op" id="8109651">:</span>&nbsp;&nbsp;<span class="string" id="8109654">&#34;abc&#34;</span><span class="op" id="8109659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109663">in</span><span class="op" id="8109665">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8109669">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="8109703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109707">want</span><span class="op" id="8109711">:</span>&nbsp;<span class="op" id="8109713">[</span><span class="op" id="8109714">]</span><span class="ident" id="8109715">headerBody</span><span class="op" id="8109725">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109730">{</span><span class="ident" id="8109731">textproto</span><span class="op" id="8109740">.</span><span class="ident" id="8109741">MIMEHeader</span><span class="op" id="8109751">{</span><span class="string" id="8109752">&#34;Foo&#34;</span><span class="op" id="8109757">:</span>&nbsp;<span class="op" id="8109759">{</span><span class="string" id="8109760">&#34;bar&#34;</span><span class="op" id="8109765">}</span><span class="op" id="8109766">}</span><span class="op" id="8109767">,</span>&nbsp;<span class="string" id="8109769">&#34;&#34;</span><span class="op" id="8109771">}</span><span class="op" id="8109772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109776">}</span><span class="op" id="8109777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109780">}</span><span class="op" id="8109781">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8109785">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109865">name</span><span class="op" id="8109869">:</span>&nbsp;<span class="string" id="8109871">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="8109906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109910">sep</span><span class="op" id="8109913">:</span>&nbsp;&nbsp;<span class="string" id="8109916">&#34;abc&#34;</span><span class="op" id="8109921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109925">in</span><span class="op" id="8109927">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8109931">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="8109969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109973">want</span><span class="op" id="8109977">:</span>&nbsp;<span class="op" id="8109979">[</span><span class="op" id="8109980">]</span><span class="ident" id="8109981">headerBody</span><span class="op" id="8109991">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109996">{</span><span class="ident" id="8109997">textproto</span><span class="op" id="8110006">.</span><span class="ident" id="8110007">MIMEHeader</span><span class="op" id="8110017">{</span><span class="string" id="8110018">&#34;Foo&#34;</span><span class="op" id="8110023">:</span>&nbsp;<span class="op" id="8110025">{</span><span class="string" id="8110026">&#34;bar&#34;</span><span class="op" id="8110031">}</span><span class="op" id="8110032">}</span><span class="op" id="8110033">,</span>&nbsp;<span class="string" id="8110035">&#34;&#34;</span><span class="op" id="8110037">}</span><span class="op" id="8110038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110042">}</span><span class="op" id="8110043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110046">}</span><span class="op" id="8110047">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8110051">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110077">name</span><span class="op" id="8110081">:</span>&nbsp;<span class="string" id="8110083">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="8110101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110105">sep</span><span class="op" id="8110108">:</span>&nbsp;&nbsp;<span class="string" id="8110111">&#34;abc&#34;</span><span class="op" id="8110116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110120">in</span><span class="op" id="8110122">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8110126">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="8110187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110191">want</span><span class="op" id="8110195">:</span>&nbsp;<span class="op" id="8110197">[</span><span class="op" id="8110198">]</span><span class="ident" id="8110199">headerBody</span><span class="op" id="8110209">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110214">{</span><span class="ident" id="8110215">textproto</span><span class="op" id="8110224">.</span><span class="ident" id="8110225">MIMEHeader</span><span class="op" id="8110235">{</span><span class="string" id="8110236">&#34;Foo&#34;</span><span class="op" id="8110241">:</span>&nbsp;<span class="op" id="8110243">{</span><span class="string" id="8110244">&#34;bar&#34;</span><span class="op" id="8110249">}</span><span class="op" id="8110250">}</span><span class="op" id="8110251">,</span>&nbsp;<span class="string" id="8110253">&#34;&#34;</span><span class="op" id="8110255">}</span><span class="op" id="8110256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110261">{</span><span class="ident" id="8110262">textproto</span><span class="op" id="8110271">.</span><span class="ident" id="8110272">MIMEHeader</span><span class="op" id="8110282">{</span><span class="string" id="8110283">&#34;Foo2&#34;</span><span class="op" id="8110289">:</span>&nbsp;<span class="op" id="8110291">{</span><span class="string" id="8110292">&#34;bar2&#34;</span><span class="op" id="8110298">}</span><span class="op" id="8110299">}</span><span class="op" id="8110300">,</span>&nbsp;<span class="string" id="8110302">&#34;&#34;</span><span class="op" id="8110304">}</span><span class="op" id="8110305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110309">}</span><span class="op" id="8110310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110313">}</span><span class="op" id="8110314">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8110318">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110380">name</span><span class="op" id="8110384">:</span>&nbsp;<span class="string" id="8110386">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="8110414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110418">sep</span><span class="op" id="8110421">:</span>&nbsp;&nbsp;<span class="string" id="8110424">&#34;abc&#34;</span><span class="op" id="8110429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110433">in</span><span class="op" id="8110435">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8110439">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="8110477">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110481">want</span><span class="op" id="8110485">:</span>&nbsp;<span class="op" id="8110487">[</span><span class="op" id="8110488">]</span><span class="ident" id="8110489">headerBody</span><span class="op" id="8110499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110504">{</span><span class="ident" id="8110505">textproto</span><span class="op" id="8110514">.</span><span class="ident" id="8110515">MIMEHeader</span><span class="op" id="8110525">{</span><span class="string" id="8110526">&#34;Foo&#34;</span><span class="op" id="8110531">:</span>&nbsp;<span class="op" id="8110533">{</span><span class="string" id="8110534">&#34;bar&#34;</span><span class="op" id="8110539">}</span><span class="op" id="8110540">}</span><span class="op" id="8110541">,</span>&nbsp;<span class="string" id="8110543">&#34;&#34;</span><span class="op" id="8110545">}</span><span class="op" id="8110546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110550">}</span><span class="op" id="8110551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110554">}</span><span class="op" id="8110555">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8110559">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110623">name</span><span class="op" id="8110627">:</span>&nbsp;<span class="string" id="8110629">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="8110657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110661">sep</span><span class="op" id="8110664">:</span>&nbsp;&nbsp;<span class="string" id="8110667">&#34;abc&#34;</span><span class="op" id="8110672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110676">in</span><span class="op" id="8110678">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8110682">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="8110719">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110723">want</span><span class="op" id="8110727">:</span>&nbsp;<span class="op" id="8110729">[</span><span class="op" id="8110730">]</span><span class="ident" id="8110731">headerBody</span><span class="op" id="8110741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110746">{</span><span class="ident" id="8110747">textproto</span><span class="op" id="8110756">.</span><span class="ident" id="8110757">MIMEHeader</span><span class="op" id="8110767">{</span><span class="string" id="8110768">&#34;Foo&#34;</span><span class="op" id="8110773">:</span>&nbsp;<span class="op" id="8110775">{</span><span class="string" id="8110776">&#34;bar&#34;</span><span class="op" id="8110781">}</span><span class="op" id="8110782">}</span><span class="op" id="8110783">,</span>&nbsp;<span class="string" id="8110785">&#34;&#34;</span><span class="op" id="8110787">}</span><span class="op" id="8110788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110792">}</span><span class="op" id="8110793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110796">}</span><span class="op" id="8110797">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8110801">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110854">name</span><span class="op" id="8110858">:</span>&nbsp;<span class="string" id="8110860">&#34;no&nbsp;parts&#34;</span><span class="op" id="8110870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110874">sep</span><span class="op" id="8110877">:</span>&nbsp;&nbsp;<span class="string" id="8110880">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="8110920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110924">in</span><span class="op" id="8110926">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8110930">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="8110978">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110982">want</span><span class="op" id="8110986">:</span>&nbsp;<span class="op" id="8110988">[</span><span class="op" id="8110989">]</span><span class="ident" id="8110990">headerBody</span><span class="op" id="8111000">{</span><span class="op" id="8111001">}</span><span class="op" id="8111002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111005">}</span><span class="op" id="8111006">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111010">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111091">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111095">name</span><span class="op" id="8111099">:</span>&nbsp;<span class="string" id="8111101">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="8111125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111129">sep</span><span class="op" id="8111132">:</span>&nbsp;&nbsp;<span class="string" id="8111135">&#34;sep&#34;</span><span class="op" id="8111140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111144">in</span><span class="op" id="8111146">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8111150">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="8111197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111201">want</span><span class="op" id="8111205">:</span>&nbsp;<span class="op" id="8111207">[</span><span class="op" id="8111208">]</span><span class="ident" id="8111209">headerBody</span><span class="op" id="8111219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111224">{</span><span class="ident" id="8111225">textproto</span><span class="op" id="8111234">.</span><span class="ident" id="8111235">MIMEHeader</span><span class="op" id="8111245">{</span><span class="string" id="8111246">&#34;Foo&#34;</span><span class="op" id="8111251">:</span>&nbsp;<span class="op" id="8111253">{</span><span class="string" id="8111254">&#34;bar&#34;</span><span class="op" id="8111259">}</span><span class="op" id="8111260">}</span><span class="op" id="8111261">,</span>&nbsp;<span class="string" id="8111263">&#34;--sepFAKE&#34;</span><span class="op" id="8111274">}</span><span class="op" id="8111275">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111279">}</span><span class="op" id="8111280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111283">}</span><span class="op" id="8111284">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111288">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111349">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111353">name</span><span class="op" id="8111357">:</span>&nbsp;<span class="string" id="8111359">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="8111385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111389">sep</span><span class="op" id="8111392">:</span>&nbsp;&nbsp;<span class="string" id="8111395">&#34;sep&#34;</span><span class="op" id="8111400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111404">in</span><span class="op" id="8111406">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8111410">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="8111453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111457">want</span><span class="op" id="8111461">:</span>&nbsp;<span class="op" id="8111463">[</span><span class="op" id="8111464">]</span><span class="ident" id="8111465">headerBody</span><span class="op" id="8111475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111480">{</span><span class="ident" id="8111481">textproto</span><span class="op" id="8111490">.</span><span class="ident" id="8111491">MIMEHeader</span><span class="op" id="8111501">{</span><span class="string" id="8111502">&#34;Foo&#34;</span><span class="op" id="8111507">:</span>&nbsp;<span class="op" id="8111509">{</span><span class="string" id="8111510">&#34;bar&#34;</span><span class="op" id="8111515">}</span><span class="op" id="8111516">}</span><span class="op" id="8111517">,</span>&nbsp;<span class="string" id="8111519">&#34;text&#34;</span><span class="op" id="8111525">}</span><span class="op" id="8111526">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111530">}</span><span class="op" id="8111531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111534">}</span><span class="op" id="8111535">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111539">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111570">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111574">name</span><span class="op" id="8111578">:</span>&nbsp;<span class="string" id="8111580">&#34;leading&nbsp;line&#34;</span><span class="op" id="8111594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111598">sep</span><span class="op" id="8111601">:</span>&nbsp;&nbsp;<span class="string" id="8111604">&#34;MyBoundary&#34;</span><span class="op" id="8111616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111620">in</span><span class="op" id="8111622">:</span>&nbsp;<span class="ident" id="8111624">strings</span><span class="op" id="8111631">.</span><span class="ident" id="8111632">Replace</span><span class="op" id="8111639">(</span><span class="string" id="8111640">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="8111733">,</span>&nbsp;<span class="string" id="8111735">&#34;\n&#34;</span><span class="op" id="8111739">,</span>&nbsp;<span class="string" id="8111741">&#34;\r\n&#34;</span><span class="op" id="8111747">,</span>&nbsp;<span class="op" id="8111749">-</span><span class="num" id="8111750">1</span><span class="op" id="8111751">)</span><span class="op" id="8111752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111756">want</span><span class="op" id="8111760">:</span>&nbsp;<span class="op" id="8111762">[</span><span class="op" id="8111763">]</span><span class="ident" id="8111764">headerBody</span><span class="op" id="8111774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111779">{</span><span class="ident" id="8111780">textproto</span><span class="op" id="8111789">.</span><span class="ident" id="8111790">MIMEHeader</span><span class="op" id="8111800">{</span><span class="string" id="8111801">&#34;Foo&#34;</span><span class="op" id="8111806">:</span>&nbsp;<span class="op" id="8111808">{</span><span class="string" id="8111809">&#34;bar&#34;</span><span class="op" id="8111814">}</span><span class="op" id="8111815">}</span><span class="op" id="8111816">,</span>&nbsp;<span class="string" id="8111818">&#34;&#34;</span><span class="op" id="8111820">}</span><span class="op" id="8111821">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111825">}</span><span class="op" id="8111826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111829">}</span><span class="op" id="8111830">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111834">roundTripParseTest</span><span class="op" id="8111852">(</span><span class="op" id="8111853">)</span><span class="op" id="8111854">,</span><br>
<span class="lineno"></span><span class="op" id="8111856">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="8111859">func</span>&nbsp;<span class="ident" id="8111864">TestParse</span><span class="op" id="8111873">(</span><span class="ident" id="8111874">t</span>&nbsp;<span class="op" id="8111876">*</span><span class="ident" id="8111877">testing</span><span class="op" id="8111884">.</span><span class="ident" id="8111885">T</span><span class="op" id="8111886">)</span>&nbsp;<span class="op" id="8111888">{</span><br>
<span class="lineno"></span><span class="ident" id="8111890">Cases</span><span class="op" id="8111895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111898">for</span>&nbsp;<span class="ident" id="8111902">_</span><span class="op" id="8111903">,</span>&nbsp;<span class="ident" id="8111905">tt</span>&nbsp;<span class="op" id="8111908">:=</span>&nbsp;<span class="keyword" id="8111911">range</span>&nbsp;<span class="ident" id="8111917">parseTests</span>&nbsp;<span class="op" id="8111928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111932">r</span>&nbsp;<span class="op" id="8111934">:=</span>&nbsp;<span class="ident" id="8111937">NewReader</span><span class="op" id="8111946">(</span><span class="ident" id="8111947">strings</span><span class="op" id="8111954">.</span><span class="ident" id="8111955">NewReader</span><span class="op" id="8111964">(</span><span class="ident" id="8111965">tt</span><span class="op" id="8111967">.</span><span class="ident" id="8111968">in</span><span class="op" id="8111970">)</span><span class="op" id="8111971">,</span>&nbsp;<span class="ident" id="8111973">tt</span><span class="op" id="8111975">.</span><span class="ident" id="8111976">sep</span><span class="op" id="8111979">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111983">got</span>&nbsp;<span class="op" id="8111987">:=</span>&nbsp;<span class="op" id="8111990">[</span><span class="op" id="8111991">]</span><span class="ident" id="8111992">headerBody</span><span class="op" id="8112002">{</span><span class="op" id="8112003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112007">for</span>&nbsp;<span class="op" id="8112011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112016">p</span><span class="op" id="8112017">,</span>&nbsp;<span class="ident" id="8112019">err</span>&nbsp;<span class="op" id="8112023">:=</span>&nbsp;<span class="ident" id="8112026">r</span><span class="op" id="8112027">.</span><span class="ident" id="8112028">NextPart</span><span class="op" id="8112036">(</span><span class="op" id="8112037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112042">if</span>&nbsp;<span class="ident" id="8112045">err</span>&nbsp;<span class="op" id="8112049">==</span>&nbsp;<span class="ident" id="8112052">io</span><span class="op" id="8112054">.</span><span class="ident" id="8112055">EOF</span>&nbsp;<span class="op" id="8112059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112065">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112079">if</span>&nbsp;<span class="ident" id="8112082">err</span>&nbsp;<span class="op" id="8112086">!=</span>&nbsp;<span class="ident" id="8112089">nil</span>&nbsp;<span class="op" id="8112093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112099">t</span><span class="op" id="8112100">.</span><span class="ident" id="8112101">Errorf</span><span class="op" id="8112107">(</span><span class="string" id="8112108">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="8112134">,</span>&nbsp;<span class="ident" id="8112136">tt</span><span class="op" id="8112138">.</span><span class="ident" id="8112139">name</span><span class="op" id="8112143">,</span>&nbsp;<span class="ident" id="8112145">err</span><span class="op" id="8112148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112154">continue</span>&nbsp;<span class="ident" id="8112163">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112172">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112177">pbody</span><span class="op" id="8112182">,</span>&nbsp;<span class="ident" id="8112184">err</span>&nbsp;<span class="op" id="8112188">:=</span>&nbsp;<span class="ident" id="8112191">ioutil</span><span class="op" id="8112197">.</span><span class="ident" id="8112198">ReadAll</span><span class="op" id="8112205">(</span><span class="ident" id="8112206">p</span><span class="op" id="8112207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112212">if</span>&nbsp;<span class="ident" id="8112215">err</span>&nbsp;<span class="op" id="8112219">!=</span>&nbsp;<span class="ident" id="8112222">nil</span>&nbsp;<span class="op" id="8112226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112232">t</span><span class="op" id="8112233">.</span><span class="ident" id="8112234">Errorf</span><span class="op" id="8112240">(</span><span class="string" id="8112241">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8112277">,</span>&nbsp;<span class="ident" id="8112279">tt</span><span class="op" id="8112281">.</span><span class="ident" id="8112282">name</span><span class="op" id="8112286">,</span>&nbsp;<span class="ident" id="8112288">err</span><span class="op" id="8112291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112297">continue</span>&nbsp;<span class="ident" id="8112306">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112315">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112320">got</span>&nbsp;<span class="op" id="8112324">=</span>&nbsp;<span class="builtinfunc" id="8112326">append</span><span class="op" id="8112332">(</span><span class="ident" id="8112333">got</span><span class="op" id="8112336">,</span>&nbsp;<span class="ident" id="8112338">headerBody</span><span class="op" id="8112348">{</span><span class="ident" id="8112349">p</span><span class="op" id="8112350">.</span><span class="ident" id="8112351">Header</span><span class="op" id="8112357">,</span>&nbsp;<span class="builtintype" id="8112359">string</span><span class="op" id="8112365">(</span><span class="ident" id="8112366">pbody</span><span class="op" id="8112371">)</span><span class="op" id="8112372">}</span><span class="op" id="8112373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112381">if</span>&nbsp;<span class="op" id="8112384">!</span><span class="ident" id="8112385">reflect</span><span class="op" id="8112392">.</span><span class="ident" id="8112393">DeepEqual</span><span class="op" id="8112402">(</span><span class="ident" id="8112403">tt</span><span class="op" id="8112405">.</span><span class="ident" id="8112406">want</span><span class="op" id="8112410">,</span>&nbsp;<span class="ident" id="8112412">got</span><span class="op" id="8112415">)</span>&nbsp;<span class="op" id="8112417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112422">t</span><span class="op" id="8112423">.</span><span class="ident" id="8112424">Errorf</span><span class="op" id="8112430">(</span><span class="string" id="8112431">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8112461">,</span>&nbsp;<span class="ident" id="8112463">tt</span><span class="op" id="8112465">.</span><span class="ident" id="8112466">name</span><span class="op" id="8112470">,</span>&nbsp;<span class="ident" id="8112472">got</span><span class="op" id="8112475">,</span>&nbsp;<span class="ident" id="8112477">tt</span><span class="op" id="8112479">.</span><span class="ident" id="8112480">want</span><span class="op" id="8112484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112489">if</span>&nbsp;<span class="builtinfunc" id="8112492">len</span><span class="op" id="8112495">(</span><span class="ident" id="8112496">tt</span><span class="op" id="8112498">.</span><span class="ident" id="8112499">want</span><span class="op" id="8112503">)</span>&nbsp;<span class="op" id="8112505">!=</span>&nbsp;<span class="builtinfunc" id="8112508">len</span><span class="op" id="8112511">(</span><span class="ident" id="8112512">got</span><span class="op" id="8112515">)</span>&nbsp;<span class="op" id="8112517">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112523">t</span><span class="op" id="8112524">.</span><span class="ident" id="8112525">Errorf</span><span class="op" id="8112531">(</span><span class="string" id="8112532">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8112564">,</span>&nbsp;<span class="ident" id="8112566">tt</span><span class="op" id="8112568">.</span><span class="ident" id="8112569">name</span><span class="op" id="8112573">,</span>&nbsp;<span class="builtinfunc" id="8112575">len</span><span class="op" id="8112578">(</span><span class="ident" id="8112579">got</span><span class="op" id="8112582">)</span><span class="op" id="8112583">,</span>&nbsp;<span class="builtinfunc" id="8112585">len</span><span class="op" id="8112588">(</span><span class="ident" id="8112589">tt</span><span class="op" id="8112591">.</span><span class="ident" id="8112592">want</span><span class="op" id="8112596">)</span><span class="op" id="8112597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112602">}</span>&nbsp;<span class="keyword" id="8112604">else</span>&nbsp;<span class="keyword" id="8112609">if</span>&nbsp;<span class="builtinfunc" id="8112612">len</span><span class="op" id="8112615">(</span><span class="ident" id="8112616">got</span><span class="op" id="8112619">)</span>&nbsp;<span class="op" id="8112621">&gt;</span>&nbsp;<span class="num" id="8112623">1</span>&nbsp;<span class="op" id="8112625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112631">for</span>&nbsp;<span class="ident" id="8112635">pi</span><span class="op" id="8112637">,</span>&nbsp;<span class="ident" id="8112639">wantPart</span>&nbsp;<span class="op" id="8112648">:=</span>&nbsp;<span class="keyword" id="8112651">range</span>&nbsp;<span class="ident" id="8112657">tt</span><span class="op" id="8112659">.</span><span class="ident" id="8112660">want</span>&nbsp;<span class="op" id="8112665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112672">if</span>&nbsp;<span class="op" id="8112675">!</span><span class="ident" id="8112676">reflect</span><span class="op" id="8112683">.</span><span class="ident" id="8112684">DeepEqual</span><span class="op" id="8112693">(</span><span class="ident" id="8112694">wantPart</span><span class="op" id="8112702">,</span>&nbsp;<span class="ident" id="8112704">got</span><span class="op" id="8112707">[</span><span class="ident" id="8112708">pi</span><span class="op" id="8112710">]</span><span class="op" id="8112711">)</span>&nbsp;<span class="op" id="8112713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112721">t</span><span class="op" id="8112722">.</span><span class="ident" id="8112723">Errorf</span><span class="op" id="8112729">(</span><span class="string" id="8112730">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8112769">,</span>&nbsp;<span class="ident" id="8112771">tt</span><span class="op" id="8112773">.</span><span class="ident" id="8112774">name</span><span class="op" id="8112778">,</span>&nbsp;<span class="ident" id="8112780">pi</span><span class="op" id="8112782">,</span>&nbsp;<span class="ident" id="8112784">got</span><span class="op" id="8112787">[</span><span class="ident" id="8112788">pi</span><span class="op" id="8112790">]</span><span class="op" id="8112791">,</span>&nbsp;<span class="ident" id="8112793">wantPart</span><span class="op" id="8112801">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112826">}</span><br>
<span class="lineno">605</span><span class="op" id="8112828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8112831">func</span>&nbsp;<span class="ident" id="8112836">roundTripParseTest</span><span class="op" id="8112854">(</span><span class="op" id="8112855">)</span>&nbsp;<span class="ident" id="8112857">parseTest</span>&nbsp;<span class="op" id="8112867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112870">t</span>&nbsp;<span class="op" id="8112872">:=</span>&nbsp;<span class="ident" id="8112875">parseTest</span><span class="op" id="8112884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112888">name</span><span class="op" id="8112892">:</span>&nbsp;<span class="string" id="8112894">&#34;round&nbsp;trip&#34;</span><span class="op" id="8112906">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112910">want</span><span class="op" id="8112914">:</span>&nbsp;<span class="op" id="8112916">[</span><span class="op" id="8112917">]</span><span class="ident" id="8112918">headerBody</span><span class="op" id="8112928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112933">formData</span><span class="op" id="8112941">(</span><span class="string" id="8112942">&#34;empty&#34;</span><span class="op" id="8112949">,</span>&nbsp;<span class="string" id="8112951">&#34;&#34;</span><span class="op" id="8112953">)</span><span class="op" id="8112954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112959">formData</span><span class="op" id="8112967">(</span><span class="string" id="8112968">&#34;lf&#34;</span><span class="op" id="8112972">,</span>&nbsp;<span class="string" id="8112974">&#34;\n&#34;</span><span class="op" id="8112978">)</span><span class="op" id="8112979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112984">formData</span><span class="op" id="8112992">(</span><span class="string" id="8112993">&#34;cr&#34;</span><span class="op" id="8112997">,</span>&nbsp;<span class="string" id="8112999">&#34;\r&#34;</span><span class="op" id="8113003">)</span><span class="op" id="8113004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113009">formData</span><span class="op" id="8113017">(</span><span class="string" id="8113018">&#34;crlf&#34;</span><span class="op" id="8113024">,</span>&nbsp;<span class="string" id="8113026">&#34;\r\n&#34;</span><span class="op" id="8113032">)</span><span class="op" id="8113033">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113038">formData</span><span class="op" id="8113046">(</span><span class="string" id="8113047">&#34;foo&#34;</span><span class="op" id="8113052">,</span>&nbsp;<span class="string" id="8113054">&#34;bar&#34;</span><span class="op" id="8113059">)</span><span class="op" id="8113060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113064">}</span><span class="op" id="8113065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113071">var</span>&nbsp;<span class="ident" id="8113075">buf</span>&nbsp;<span class="ident" id="8113079">bytes</span><span class="op" id="8113084">.</span><span class="ident" id="8113085">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113093">w</span>&nbsp;<span class="op" id="8113095">:=</span>&nbsp;<span class="ident" id="8113098">NewWriter</span><span class="op" id="8113107">(</span><span class="op" id="8113108">&amp;</span><span class="ident" id="8113109">buf</span><span class="op" id="8113112">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113115">for</span>&nbsp;<span class="ident" id="8113119">_</span><span class="op" id="8113120">,</span>&nbsp;<span class="ident" id="8113122">p</span>&nbsp;<span class="op" id="8113124">:=</span>&nbsp;<span class="keyword" id="8113127">range</span>&nbsp;<span class="ident" id="8113133">t</span><span class="op" id="8113134">.</span><span class="ident" id="8113135">want</span>&nbsp;<span class="op" id="8113140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113144">pw</span><span class="op" id="8113146">,</span>&nbsp;<span class="ident" id="8113148">err</span>&nbsp;<span class="op" id="8113152">:=</span>&nbsp;<span class="ident" id="8113155">w</span><span class="op" id="8113156">.</span><span class="ident" id="8113157">CreatePart</span><span class="op" id="8113167">(</span><span class="ident" id="8113168">p</span><span class="op" id="8113169">.</span><span class="ident" id="8113170">header</span><span class="op" id="8113176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113180">if</span>&nbsp;<span class="ident" id="8113183">err</span>&nbsp;<span class="op" id="8113187">!=</span>&nbsp;<span class="ident" id="8113190">nil</span>&nbsp;<span class="op" id="8113194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8113199">panic</span><span class="op" id="8113204">(</span><span class="ident" id="8113205">err</span><span class="op" id="8113208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113212">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113216">_</span><span class="op" id="8113217">,</span>&nbsp;<span class="ident" id="8113219">err</span>&nbsp;<span class="op" id="8113223">=</span>&nbsp;<span class="ident" id="8113225">pw</span><span class="op" id="8113227">.</span><span class="ident" id="8113228">Write</span><span class="op" id="8113233">(</span><span class="op" id="8113234">[</span><span class="op" id="8113235">]</span><span class="builtintype" id="8113236">byte</span><span class="op" id="8113240">(</span><span class="ident" id="8113241">p</span><span class="op" id="8113242">.</span><span class="ident" id="8113243">body</span><span class="op" id="8113247">)</span><span class="op" id="8113248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113252">if</span>&nbsp;<span class="ident" id="8113255">err</span>&nbsp;<span class="op" id="8113259">!=</span>&nbsp;<span class="ident" id="8113262">nil</span>&nbsp;<span class="op" id="8113266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8113271">panic</span><span class="op" id="8113276">(</span><span class="ident" id="8113277">err</span><span class="op" id="8113280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113287">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113290">w</span><span class="op" id="8113291">.</span><span class="ident" id="8113292">Close</span><span class="op" id="8113297">(</span><span class="op" id="8113298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113301">t</span><span class="op" id="8113302">.</span><span class="ident" id="8113303">in</span>&nbsp;<span class="op" id="8113306">=</span>&nbsp;<span class="ident" id="8113308">buf</span><span class="op" id="8113311">.</span><span class="ident" id="8113312">String</span><span class="op" id="8113318">(</span><span class="op" id="8113319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113322">t</span><span class="op" id="8113323">.</span><span class="ident" id="8113324">sep</span>&nbsp;<span class="op" id="8113328">=</span>&nbsp;<span class="ident" id="8113330">w</span><span class="op" id="8113331">.</span><span class="ident" id="8113332">Boundary</span><span class="op" id="8113340">(</span><span class="op" id="8113341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113344">return</span>&nbsp;<span class="ident" id="8113351">t</span><br>
<span class="lineno"></span><span class="op" id="8113353">}</span>
</div>
</body>
</html>
