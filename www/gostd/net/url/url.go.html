<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4073427">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4073482">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4073536">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4073587">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="4073645">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="4073662">package</span>&nbsp;<span class="ident" id="4073670">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4073675">import</span>&nbsp;<span class="op" id="4073682">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073685">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073694">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073704">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073712">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073723">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4073733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073736">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4073804">type</span>&nbsp;<span class="ident" id="4073809">Error</span>&nbsp;<span class="keyword" id="4073815">struct</span>&nbsp;<span class="op" id="4073822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073825">Op</span>&nbsp;&nbsp;<span class="builtintype" id="4073829">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073837">URL</span>&nbsp;<span class="builtintype" id="4073841">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073849">Err</span>&nbsp;<span class="builtintype" id="4073853">error</span><br>
<span class="lineno"></span><span class="op" id="4073859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4073862">func</span>&nbsp;<span class="op" id="4073867">(</span><span class="ident" id="4073868">e</span>&nbsp;<span class="op" id="4073870">*</span><span class="ident" id="4073871">Error</span><span class="op" id="4073876">)</span>&nbsp;<span class="ident" id="4073878">Error</span><span class="op" id="4073883">(</span><span class="op" id="4073884">)</span>&nbsp;<span class="builtintype" id="4073886">string</span>&nbsp;<span class="op" id="4073893">{</span>&nbsp;<span class="keyword" id="4073895">return</span>&nbsp;<span class="ident" id="4073902">e</span><span class="op" id="4073903">.</span><span class="ident" id="4073904">Op</span>&nbsp;<span class="op" id="4073907">+</span>&nbsp;<span class="string" id="4073909">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4073913">+</span>&nbsp;<span class="ident" id="4073915">e</span><span class="op" id="4073916">.</span><span class="ident" id="4073917">URL</span>&nbsp;<span class="op" id="4073921">+</span>&nbsp;<span class="string" id="4073923">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4073928">+</span>&nbsp;<span class="ident" id="4073930">e</span><span class="op" id="4073931">.</span><span class="ident" id="4073932">Err</span><span class="op" id="4073935">.</span><span class="ident" id="4073936">Error</span><span class="op" id="4073941">(</span><span class="op" id="4073942">)</span>&nbsp;<span class="op" id="4073944">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4073947">func</span>&nbsp;<span class="ident" id="4073952">ishex</span><span class="op" id="4073957">(</span><span class="ident" id="4073958">c</span>&nbsp;<span class="builtintype" id="4073960">byte</span><span class="op" id="4073964">)</span>&nbsp;<span class="builtintype" id="4073966">bool</span>&nbsp;<span class="op" id="4073971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073974">switch</span>&nbsp;<span class="op" id="4073981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073984">case</span>&nbsp;<span class="string" id="4073989">&#39;0&#39;</span>&nbsp;<span class="op" id="4073993">&lt;=</span>&nbsp;<span class="ident" id="4073996">c</span>&nbsp;<span class="op" id="4073998">&amp;&amp;</span>&nbsp;<span class="ident" id="4074001">c</span>&nbsp;<span class="op" id="4074003">&lt;=</span>&nbsp;<span class="string" id="4074006">&#39;9&#39;</span><span class="op" id="4074009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074013">return</span>&nbsp;<span class="builtintype" id="4074020">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074026">case</span>&nbsp;<span class="string" id="4074031">&#39;a&#39;</span>&nbsp;<span class="op" id="4074035">&lt;=</span>&nbsp;<span class="ident" id="4074038">c</span>&nbsp;<span class="op" id="4074040">&amp;&amp;</span>&nbsp;<span class="ident" id="4074043">c</span>&nbsp;<span class="op" id="4074045">&lt;=</span>&nbsp;<span class="string" id="4074048">&#39;f&#39;</span><span class="op" id="4074051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074055">return</span>&nbsp;<span class="builtintype" id="4074062">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074068">case</span>&nbsp;<span class="string" id="4074073">&#39;A&#39;</span>&nbsp;<span class="op" id="4074077">&lt;=</span>&nbsp;<span class="ident" id="4074080">c</span>&nbsp;<span class="op" id="4074082">&amp;&amp;</span>&nbsp;<span class="ident" id="4074085">c</span>&nbsp;<span class="op" id="4074087">&lt;=</span>&nbsp;<span class="string" id="4074090">&#39;F&#39;</span><span class="op" id="4074093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074097">return</span>&nbsp;<span class="builtintype" id="4074104">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074110">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074113">return</span>&nbsp;<span class="builtintype" id="4074120">false</span><br>
<span class="lineno"></span><span class="op" id="4074126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074129">func</span>&nbsp;<span class="ident" id="4074134">unhex</span><span class="op" id="4074139">(</span><span class="ident" id="4074140">c</span>&nbsp;<span class="builtintype" id="4074142">byte</span><span class="op" id="4074146">)</span>&nbsp;<span class="builtintype" id="4074148">byte</span>&nbsp;<span class="op" id="4074153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074156">switch</span>&nbsp;<span class="op" id="4074163">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074166">case</span>&nbsp;<span class="string" id="4074171">&#39;0&#39;</span>&nbsp;<span class="op" id="4074175">&lt;=</span>&nbsp;<span class="ident" id="4074178">c</span>&nbsp;<span class="op" id="4074180">&amp;&amp;</span>&nbsp;<span class="ident" id="4074183">c</span>&nbsp;<span class="op" id="4074185">&lt;=</span>&nbsp;<span class="string" id="4074188">&#39;9&#39;</span><span class="op" id="4074191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074195">return</span>&nbsp;<span class="ident" id="4074202">c</span>&nbsp;<span class="op" id="4074204">-</span>&nbsp;<span class="string" id="4074206">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074211">case</span>&nbsp;<span class="string" id="4074216">&#39;a&#39;</span>&nbsp;<span class="op" id="4074220">&lt;=</span>&nbsp;<span class="ident" id="4074223">c</span>&nbsp;<span class="op" id="4074225">&amp;&amp;</span>&nbsp;<span class="ident" id="4074228">c</span>&nbsp;<span class="op" id="4074230">&lt;=</span>&nbsp;<span class="string" id="4074233">&#39;f&#39;</span><span class="op" id="4074236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074240">return</span>&nbsp;<span class="ident" id="4074247">c</span>&nbsp;<span class="op" id="4074249">-</span>&nbsp;<span class="string" id="4074251">&#39;a&#39;</span>&nbsp;<span class="op" id="4074255">+</span>&nbsp;<span class="num" id="4074257">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074261">case</span>&nbsp;<span class="string" id="4074266">&#39;A&#39;</span>&nbsp;<span class="op" id="4074270">&lt;=</span>&nbsp;<span class="ident" id="4074273">c</span>&nbsp;<span class="op" id="4074275">&amp;&amp;</span>&nbsp;<span class="ident" id="4074278">c</span>&nbsp;<span class="op" id="4074280">&lt;=</span>&nbsp;<span class="string" id="4074283">&#39;F&#39;</span><span class="op" id="4074286">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074290">return</span>&nbsp;<span class="ident" id="4074297">c</span>&nbsp;<span class="op" id="4074299">-</span>&nbsp;<span class="string" id="4074301">&#39;A&#39;</span>&nbsp;<span class="op" id="4074305">+</span>&nbsp;<span class="num" id="4074307">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074314">return</span>&nbsp;<span class="num" id="4074321">0</span><br>
<span class="lineno"></span><span class="op" id="4074323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="4074326">type</span>&nbsp;<span class="ident" id="4074331">encoding</span>&nbsp;<span class="builtintype" id="4074340">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074345">const</span>&nbsp;<span class="op" id="4074351">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074354">encodePath</span>&nbsp;<span class="ident" id="4074365">encoding</span>&nbsp;<span class="op" id="4074374">=</span>&nbsp;<span class="num" id="4074376">1</span>&nbsp;<span class="op" id="4074378">+</span>&nbsp;<span class="ident" id="4074380">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074386">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074406">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074428">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="4074443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074446">type</span>&nbsp;<span class="ident" id="4074451">EscapeError</span>&nbsp;<span class="builtintype" id="4074463">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4074471">func</span>&nbsp;<span class="op" id="4074476">(</span><span class="ident" id="4074477">e</span>&nbsp;<span class="ident" id="4074479">EscapeError</span><span class="op" id="4074490">)</span>&nbsp;<span class="ident" id="4074492">Error</span><span class="op" id="4074497">(</span><span class="op" id="4074498">)</span>&nbsp;<span class="builtintype" id="4074500">string</span>&nbsp;<span class="op" id="4074507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074510">return</span>&nbsp;<span class="string" id="4074517">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="4074539">+</span>&nbsp;<span class="ident" id="4074541">strconv</span><span class="op" id="4074548">.</span><span class="ident" id="4074549">Quote</span><span class="op" id="4074554">(</span><span class="builtintype" id="4074555">string</span><span class="op" id="4074561">(</span><span class="ident" id="4074562">e</span><span class="op" id="4074563">)</span><span class="op" id="4074564">)</span><br>
<span class="lineno"></span><span class="op" id="4074566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4074569">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4074634">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="4074687">func</span>&nbsp;<span class="ident" id="4074692">shouldEscape</span><span class="op" id="4074704">(</span><span class="ident" id="4074705">c</span>&nbsp;<span class="builtintype" id="4074707">byte</span><span class="op" id="4074711">,</span>&nbsp;<span class="ident" id="4074713">mode</span>&nbsp;<span class="ident" id="4074718">encoding</span><span class="op" id="4074726">)</span>&nbsp;<span class="builtintype" id="4074728">bool</span>&nbsp;<span class="op" id="4074733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074736">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074779">if</span>&nbsp;<span class="string" id="4074782">&#39;A&#39;</span>&nbsp;<span class="op" id="4074786">&lt;=</span>&nbsp;<span class="ident" id="4074789">c</span>&nbsp;<span class="op" id="4074791">&amp;&amp;</span>&nbsp;<span class="ident" id="4074794">c</span>&nbsp;<span class="op" id="4074796">&lt;=</span>&nbsp;<span class="string" id="4074799">&#39;Z&#39;</span>&nbsp;<span class="op" id="4074803">||</span>&nbsp;<span class="string" id="4074806">&#39;a&#39;</span>&nbsp;<span class="op" id="4074810">&lt;=</span>&nbsp;<span class="ident" id="4074813">c</span>&nbsp;<span class="op" id="4074815">&amp;&amp;</span>&nbsp;<span class="ident" id="4074818">c</span>&nbsp;<span class="op" id="4074820">&lt;=</span>&nbsp;<span class="string" id="4074823">&#39;z&#39;</span>&nbsp;<span class="op" id="4074827">||</span>&nbsp;<span class="string" id="4074830">&#39;0&#39;</span>&nbsp;<span class="op" id="4074834">&lt;=</span>&nbsp;<span class="ident" id="4074837">c</span>&nbsp;<span class="op" id="4074839">&amp;&amp;</span>&nbsp;<span class="ident" id="4074842">c</span>&nbsp;<span class="op" id="4074844">&lt;=</span>&nbsp;<span class="string" id="4074847">&#39;9&#39;</span>&nbsp;<span class="op" id="4074851">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074855">return</span>&nbsp;<span class="builtintype" id="4074862">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074873">switch</span>&nbsp;<span class="ident" id="4074880">c</span>&nbsp;<span class="op" id="4074882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074885">case</span>&nbsp;<span class="string" id="4074890">&#39;-&#39;</span><span class="op" id="4074893">,</span>&nbsp;<span class="string" id="4074895">&#39;_&#39;</span><span class="op" id="4074898">,</span>&nbsp;<span class="string" id="4074900">&#39;.&#39;</span><span class="op" id="4074903">,</span>&nbsp;<span class="string" id="4074905">&#39;~&#39;</span><span class="op" id="4074908">:</span>&nbsp;<span class="comment" id="4074910">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074950">return</span>&nbsp;<span class="builtintype" id="4074957">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074965">case</span>&nbsp;<span class="string" id="4074970">&#39;$&#39;</span><span class="op" id="4074973">,</span>&nbsp;<span class="string" id="4074975">&#39;&amp;&#39;</span><span class="op" id="4074978">,</span>&nbsp;<span class="string" id="4074980">&#39;+&#39;</span><span class="op" id="4074983">,</span>&nbsp;<span class="string" id="4074985">&#39;,&#39;</span><span class="op" id="4074988">,</span>&nbsp;<span class="string" id="4074990">&#39;/&#39;</span><span class="op" id="4074993">,</span>&nbsp;<span class="string" id="4074995">&#39;:&#39;</span><span class="op" id="4074998">,</span>&nbsp;<span class="string" id="4075000">&#39;;&#39;</span><span class="op" id="4075003">,</span>&nbsp;<span class="string" id="4075005">&#39;=&#39;</span><span class="op" id="4075008">,</span>&nbsp;<span class="string" id="4075010">&#39;?&#39;</span><span class="op" id="4075013">,</span>&nbsp;<span class="string" id="4075015">&#39;@&#39;</span><span class="op" id="4075018">:</span>&nbsp;<span class="comment" id="4075020">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075062">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075112">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075162">switch</span>&nbsp;<span class="ident" id="4075169">mode</span>&nbsp;<span class="op" id="4075174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075178">case</span>&nbsp;<span class="ident" id="4075183">encodePath</span><span class="op" id="4075193">:</span>&nbsp;<span class="comment" id="4075195">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075207">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075270">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075326">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075388">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075442">return</span>&nbsp;<span class="ident" id="4075449">c</span>&nbsp;<span class="op" id="4075451">==</span>&nbsp;<span class="string" id="4075454">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075461">case</span>&nbsp;<span class="ident" id="4075466">encodeUserPassword</span><span class="op" id="4075484">:</span>&nbsp;<span class="comment" id="4075486">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075500">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075562">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075620">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075690">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075706">return</span>&nbsp;<span class="ident" id="4075713">c</span>&nbsp;<span class="op" id="4075715">==</span>&nbsp;<span class="string" id="4075718">&#39;@&#39;</span>&nbsp;<span class="op" id="4075722">||</span>&nbsp;<span class="ident" id="4075725">c</span>&nbsp;<span class="op" id="4075727">==</span>&nbsp;<span class="string" id="4075730">&#39;/&#39;</span>&nbsp;<span class="op" id="4075734">||</span>&nbsp;<span class="ident" id="4075737">c</span>&nbsp;<span class="op" id="4075739">==</span>&nbsp;<span class="string" id="4075742">&#39;?&#39;</span>&nbsp;<span class="op" id="4075746">||</span>&nbsp;<span class="ident" id="4075749">c</span>&nbsp;<span class="op" id="4075751">==</span>&nbsp;<span class="string" id="4075754">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075761">case</span>&nbsp;<span class="ident" id="4075766">encodeQueryComponent</span><span class="op" id="4075786">:</span>&nbsp;<span class="comment" id="4075788">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075800">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075855">return</span>&nbsp;<span class="builtintype" id="4075862">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075870">case</span>&nbsp;<span class="ident" id="4075875">encodeFragment</span><span class="op" id="4075889">:</span>&nbsp;<span class="comment" id="4075891">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075903">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075955">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075992">return</span>&nbsp;<span class="builtintype" id="4075999">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076010">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076014">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076051">return</span>&nbsp;<span class="builtintype" id="4076058">true</span><br>
<span class="lineno"></span><span class="op" id="4076063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4076066">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="4076142">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4076217">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="4076269">func</span>&nbsp;<span class="ident" id="4076274">QueryUnescape</span><span class="op" id="4076287">(</span><span class="ident" id="4076288">s</span>&nbsp;<span class="builtintype" id="4076290">string</span><span class="op" id="4076296">)</span>&nbsp;<span class="op" id="4076298">(</span><span class="builtintype" id="4076299">string</span><span class="op" id="4076305">,</span>&nbsp;<span class="builtintype" id="4076307">error</span><span class="op" id="4076312">)</span>&nbsp;<span class="op" id="4076314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076317">return</span>&nbsp;<span class="ident" id="4076324">unescape</span><span class="op" id="4076332">(</span><span class="ident" id="4076333">s</span><span class="op" id="4076334">,</span>&nbsp;<span class="ident" id="4076336">encodeQueryComponent</span><span class="op" id="4076356">)</span><br>
<span class="lineno">115</span><span class="op" id="4076358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076361">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="4076412">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4076467">func</span>&nbsp;<span class="ident" id="4076472">unescape</span><span class="op" id="4076480">(</span><span class="ident" id="4076481">s</span>&nbsp;<span class="builtintype" id="4076483">string</span><span class="op" id="4076489">,</span>&nbsp;<span class="ident" id="4076491">mode</span>&nbsp;<span class="ident" id="4076496">encoding</span><span class="op" id="4076504">)</span>&nbsp;<span class="op" id="4076506">(</span><span class="builtintype" id="4076507">string</span><span class="op" id="4076513">,</span>&nbsp;<span class="builtintype" id="4076515">error</span><span class="op" id="4076520">)</span>&nbsp;<span class="op" id="4076522">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076525">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076570">n</span>&nbsp;<span class="op" id="4076572">:=</span>&nbsp;<span class="num" id="4076575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076578">hasPlus</span>&nbsp;<span class="op" id="4076586">:=</span>&nbsp;<span class="builtintype" id="4076589">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076596">for</span>&nbsp;<span class="ident" id="4076600">i</span>&nbsp;<span class="op" id="4076602">:=</span>&nbsp;<span class="num" id="4076605">0</span><span class="op" id="4076606">;</span>&nbsp;<span class="ident" id="4076608">i</span>&nbsp;<span class="op" id="4076610">&lt;</span>&nbsp;<span class="builtinfunc" id="4076612">len</span><span class="op" id="4076615">(</span><span class="ident" id="4076616">s</span><span class="op" id="4076617">)</span><span class="op" id="4076618">;</span>&nbsp;<span class="op" id="4076620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076624">switch</span>&nbsp;<span class="ident" id="4076631">s</span><span class="op" id="4076632">[</span><span class="ident" id="4076633">i</span><span class="op" id="4076634">]</span>&nbsp;<span class="op" id="4076636">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076640">case</span>&nbsp;<span class="string" id="4076645">&#39;%&#39;</span><span class="op" id="4076648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076653">n</span><span class="op" id="4076654">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076660">if</span>&nbsp;<span class="ident" id="4076663">i</span><span class="op" id="4076664">+</span><span class="num" id="4076665">2</span>&nbsp;<span class="op" id="4076667">&gt;=</span>&nbsp;<span class="builtinfunc" id="4076670">len</span><span class="op" id="4076673">(</span><span class="ident" id="4076674">s</span><span class="op" id="4076675">)</span>&nbsp;<span class="op" id="4076677">||</span>&nbsp;<span class="op" id="4076680">!</span><span class="ident" id="4076681">ishex</span><span class="op" id="4076686">(</span><span class="ident" id="4076687">s</span><span class="op" id="4076688">[</span><span class="ident" id="4076689">i</span><span class="op" id="4076690">+</span><span class="num" id="4076691">1</span><span class="op" id="4076692">]</span><span class="op" id="4076693">)</span>&nbsp;<span class="op" id="4076695">||</span>&nbsp;<span class="op" id="4076698">!</span><span class="ident" id="4076699">ishex</span><span class="op" id="4076704">(</span><span class="ident" id="4076705">s</span><span class="op" id="4076706">[</span><span class="ident" id="4076707">i</span><span class="op" id="4076708">+</span><span class="num" id="4076709">2</span><span class="op" id="4076710">]</span><span class="op" id="4076711">)</span>&nbsp;<span class="op" id="4076713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076719">s</span>&nbsp;<span class="op" id="4076721">=</span>&nbsp;<span class="ident" id="4076723">s</span><span class="op" id="4076724">[</span><span class="ident" id="4076725">i</span><span class="op" id="4076726">:</span><span class="op" id="4076727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076733">if</span>&nbsp;<span class="builtinfunc" id="4076736">len</span><span class="op" id="4076739">(</span><span class="ident" id="4076740">s</span><span class="op" id="4076741">)</span>&nbsp;<span class="op" id="4076743">&gt;</span>&nbsp;<span class="num" id="4076745">3</span>&nbsp;<span class="op" id="4076747">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076754">s</span>&nbsp;<span class="op" id="4076756">=</span>&nbsp;<span class="ident" id="4076758">s</span><span class="op" id="4076759">[</span><span class="num" id="4076760">0</span><span class="op" id="4076761">:</span><span class="num" id="4076762">3</span><span class="op" id="4076763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076775">return</span>&nbsp;<span class="string" id="4076782">&#34;&#34;</span><span class="op" id="4076784">,</span>&nbsp;<span class="ident" id="4076786">EscapeError</span><span class="op" id="4076797">(</span><span class="ident" id="4076798">s</span><span class="op" id="4076799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076809">i</span>&nbsp;<span class="op" id="4076811">+=</span>&nbsp;<span class="num" id="4076814">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076818">case</span>&nbsp;<span class="string" id="4076823">&#39;+&#39;</span><span class="op" id="4076826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076831">hasPlus</span>&nbsp;<span class="op" id="4076839">=</span>&nbsp;<span class="ident" id="4076841">mode</span>&nbsp;<span class="op" id="4076846">==</span>&nbsp;<span class="ident" id="4076849">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076873">i</span><span class="op" id="4076874">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076879">default</span><span class="op" id="4076886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076891">i</span><span class="op" id="4076892">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076904">if</span>&nbsp;<span class="ident" id="4076907">n</span>&nbsp;<span class="op" id="4076909">==</span>&nbsp;<span class="num" id="4076912">0</span>&nbsp;<span class="op" id="4076914">&amp;&amp;</span>&nbsp;<span class="op" id="4076917">!</span><span class="ident" id="4076918">hasPlus</span>&nbsp;<span class="op" id="4076926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076930">return</span>&nbsp;<span class="ident" id="4076937">s</span><span class="op" id="4076938">,</span>&nbsp;<span class="ident" id="4076940">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076949">t</span>&nbsp;<span class="op" id="4076951">:=</span>&nbsp;<span class="builtinfunc" id="4076954">make</span><span class="op" id="4076958">(</span><span class="op" id="4076959">[</span><span class="op" id="4076960">]</span><span class="builtintype" id="4076961">byte</span><span class="op" id="4076965">,</span>&nbsp;<span class="builtinfunc" id="4076967">len</span><span class="op" id="4076970">(</span><span class="ident" id="4076971">s</span><span class="op" id="4076972">)</span><span class="op" id="4076973">-</span><span class="num" id="4076974">2</span><span class="op" id="4076975">*</span><span class="ident" id="4076976">n</span><span class="op" id="4076977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076980">j</span>&nbsp;<span class="op" id="4076982">:=</span>&nbsp;<span class="num" id="4076985">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076988">for</span>&nbsp;<span class="ident" id="4076992">i</span>&nbsp;<span class="op" id="4076994">:=</span>&nbsp;<span class="num" id="4076997">0</span><span class="op" id="4076998">;</span>&nbsp;<span class="ident" id="4077000">i</span>&nbsp;<span class="op" id="4077002">&lt;</span>&nbsp;<span class="builtinfunc" id="4077004">len</span><span class="op" id="4077007">(</span><span class="ident" id="4077008">s</span><span class="op" id="4077009">)</span><span class="op" id="4077010">;</span>&nbsp;<span class="op" id="4077012">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077016">switch</span>&nbsp;<span class="ident" id="4077023">s</span><span class="op" id="4077024">[</span><span class="ident" id="4077025">i</span><span class="op" id="4077026">]</span>&nbsp;<span class="op" id="4077028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077032">case</span>&nbsp;<span class="string" id="4077037">&#39;%&#39;</span><span class="op" id="4077040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077045">t</span><span class="op" id="4077046">[</span><span class="ident" id="4077047">j</span><span class="op" id="4077048">]</span>&nbsp;<span class="op" id="4077050">=</span>&nbsp;<span class="ident" id="4077052">unhex</span><span class="op" id="4077057">(</span><span class="ident" id="4077058">s</span><span class="op" id="4077059">[</span><span class="ident" id="4077060">i</span><span class="op" id="4077061">+</span><span class="num" id="4077062">1</span><span class="op" id="4077063">]</span><span class="op" id="4077064">)</span><span class="op" id="4077065">&lt;&lt;</span><span class="num" id="4077067">4</span>&nbsp;<span class="op" id="4077069">|</span>&nbsp;<span class="ident" id="4077071">unhex</span><span class="op" id="4077076">(</span><span class="ident" id="4077077">s</span><span class="op" id="4077078">[</span><span class="ident" id="4077079">i</span><span class="op" id="4077080">+</span><span class="num" id="4077081">2</span><span class="op" id="4077082">]</span><span class="op" id="4077083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077088">j</span><span class="op" id="4077089">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077095">i</span>&nbsp;<span class="op" id="4077097">+=</span>&nbsp;<span class="num" id="4077100">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077104">case</span>&nbsp;<span class="string" id="4077109">&#39;+&#39;</span><span class="op" id="4077112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077117">if</span>&nbsp;<span class="ident" id="4077120">mode</span>&nbsp;<span class="op" id="4077125">==</span>&nbsp;<span class="ident" id="4077128">encodeQueryComponent</span>&nbsp;<span class="op" id="4077149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077155">t</span><span class="op" id="4077156">[</span><span class="ident" id="4077157">j</span><span class="op" id="4077158">]</span>&nbsp;<span class="op" id="4077160">=</span>&nbsp;<span class="string" id="4077162">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077169">}</span>&nbsp;<span class="keyword" id="4077171">else</span>&nbsp;<span class="op" id="4077176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077182">t</span><span class="op" id="4077183">[</span><span class="ident" id="4077184">j</span><span class="op" id="4077185">]</span>&nbsp;<span class="op" id="4077187">=</span>&nbsp;<span class="string" id="4077189">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077201">j</span><span class="op" id="4077202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077208">i</span><span class="op" id="4077209">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077214">default</span><span class="op" id="4077221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077226">t</span><span class="op" id="4077227">[</span><span class="ident" id="4077228">j</span><span class="op" id="4077229">]</span>&nbsp;<span class="op" id="4077231">=</span>&nbsp;<span class="ident" id="4077233">s</span><span class="op" id="4077234">[</span><span class="ident" id="4077235">i</span><span class="op" id="4077236">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077241">j</span><span class="op" id="4077242">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077248">i</span><span class="op" id="4077249">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077260">return</span>&nbsp;<span class="builtintype" id="4077267">string</span><span class="op" id="4077273">(</span><span class="ident" id="4077274">t</span><span class="op" id="4077275">)</span><span class="op" id="4077276">,</span>&nbsp;<span class="ident" id="4077278">nil</span><br>
<span class="lineno">170</span><span class="op" id="4077282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077285">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="4077346">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="4077369">func</span>&nbsp;<span class="ident" id="4077374">QueryEscape</span><span class="op" id="4077385">(</span><span class="ident" id="4077386">s</span>&nbsp;<span class="builtintype" id="4077388">string</span><span class="op" id="4077394">)</span>&nbsp;<span class="builtintype" id="4077396">string</span>&nbsp;<span class="op" id="4077403">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077406">return</span>&nbsp;<span class="ident" id="4077413">escape</span><span class="op" id="4077419">(</span><span class="ident" id="4077420">s</span><span class="op" id="4077421">,</span>&nbsp;<span class="ident" id="4077423">encodeQueryComponent</span><span class="op" id="4077443">)</span><br>
<span class="lineno"></span><span class="op" id="4077445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4077448">func</span>&nbsp;<span class="ident" id="4077453">escape</span><span class="op" id="4077459">(</span><span class="ident" id="4077460">s</span>&nbsp;<span class="builtintype" id="4077462">string</span><span class="op" id="4077468">,</span>&nbsp;<span class="ident" id="4077470">mode</span>&nbsp;<span class="ident" id="4077475">encoding</span><span class="op" id="4077483">)</span>&nbsp;<span class="builtintype" id="4077485">string</span>&nbsp;<span class="op" id="4077492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077495">spaceCount</span><span class="op" id="4077505">,</span>&nbsp;<span class="ident" id="4077507">hexCount</span>&nbsp;<span class="op" id="4077516">:=</span>&nbsp;<span class="num" id="4077519">0</span><span class="op" id="4077520">,</span>&nbsp;<span class="num" id="4077522">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077525">for</span>&nbsp;<span class="ident" id="4077529">i</span>&nbsp;<span class="op" id="4077531">:=</span>&nbsp;<span class="num" id="4077534">0</span><span class="op" id="4077535">;</span>&nbsp;<span class="ident" id="4077537">i</span>&nbsp;<span class="op" id="4077539">&lt;</span>&nbsp;<span class="builtinfunc" id="4077541">len</span><span class="op" id="4077544">(</span><span class="ident" id="4077545">s</span><span class="op" id="4077546">)</span><span class="op" id="4077547">;</span>&nbsp;<span class="ident" id="4077549">i</span><span class="op" id="4077550">++</span>&nbsp;<span class="op" id="4077553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077557">c</span>&nbsp;<span class="op" id="4077559">:=</span>&nbsp;<span class="ident" id="4077562">s</span><span class="op" id="4077563">[</span><span class="ident" id="4077564">i</span><span class="op" id="4077565">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077569">if</span>&nbsp;<span class="ident" id="4077572">shouldEscape</span><span class="op" id="4077584">(</span><span class="ident" id="4077585">c</span><span class="op" id="4077586">,</span>&nbsp;<span class="ident" id="4077588">mode</span><span class="op" id="4077592">)</span>&nbsp;<span class="op" id="4077594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077599">if</span>&nbsp;<span class="ident" id="4077602">c</span>&nbsp;<span class="op" id="4077604">==</span>&nbsp;<span class="string" id="4077607">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4077611">&amp;&amp;</span>&nbsp;<span class="ident" id="4077614">mode</span>&nbsp;<span class="op" id="4077619">==</span>&nbsp;<span class="ident" id="4077622">encodeQueryComponent</span>&nbsp;<span class="op" id="4077643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077649">spaceCount</span><span class="op" id="4077659">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077665">}</span>&nbsp;<span class="keyword" id="4077667">else</span>&nbsp;<span class="op" id="4077672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077678">hexCount</span><span class="op" id="4077686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077699">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077703">if</span>&nbsp;<span class="ident" id="4077706">spaceCount</span>&nbsp;<span class="op" id="4077717">==</span>&nbsp;<span class="num" id="4077720">0</span>&nbsp;<span class="op" id="4077722">&amp;&amp;</span>&nbsp;<span class="ident" id="4077725">hexCount</span>&nbsp;<span class="op" id="4077734">==</span>&nbsp;<span class="num" id="4077737">0</span>&nbsp;<span class="op" id="4077739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077743">return</span>&nbsp;<span class="ident" id="4077750">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077757">t</span>&nbsp;<span class="op" id="4077759">:=</span>&nbsp;<span class="builtinfunc" id="4077762">make</span><span class="op" id="4077766">(</span><span class="op" id="4077767">[</span><span class="op" id="4077768">]</span><span class="builtintype" id="4077769">byte</span><span class="op" id="4077773">,</span>&nbsp;<span class="builtinfunc" id="4077775">len</span><span class="op" id="4077778">(</span><span class="ident" id="4077779">s</span><span class="op" id="4077780">)</span><span class="op" id="4077781">+</span><span class="num" id="4077782">2</span><span class="op" id="4077783">*</span><span class="ident" id="4077784">hexCount</span><span class="op" id="4077792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077795">j</span>&nbsp;<span class="op" id="4077797">:=</span>&nbsp;<span class="num" id="4077800">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077803">for</span>&nbsp;<span class="ident" id="4077807">i</span>&nbsp;<span class="op" id="4077809">:=</span>&nbsp;<span class="num" id="4077812">0</span><span class="op" id="4077813">;</span>&nbsp;<span class="ident" id="4077815">i</span>&nbsp;<span class="op" id="4077817">&lt;</span>&nbsp;<span class="builtinfunc" id="4077819">len</span><span class="op" id="4077822">(</span><span class="ident" id="4077823">s</span><span class="op" id="4077824">)</span><span class="op" id="4077825">;</span>&nbsp;<span class="ident" id="4077827">i</span><span class="op" id="4077828">++</span>&nbsp;<span class="op" id="4077831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077835">switch</span>&nbsp;<span class="ident" id="4077842">c</span>&nbsp;<span class="op" id="4077844">:=</span>&nbsp;<span class="ident" id="4077847">s</span><span class="op" id="4077848">[</span><span class="ident" id="4077849">i</span><span class="op" id="4077850">]</span><span class="op" id="4077851">;</span>&nbsp;<span class="op" id="4077853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077857">case</span>&nbsp;<span class="ident" id="4077862">c</span>&nbsp;<span class="op" id="4077864">==</span>&nbsp;<span class="string" id="4077867">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4077871">&amp;&amp;</span>&nbsp;<span class="ident" id="4077874">mode</span>&nbsp;<span class="op" id="4077879">==</span>&nbsp;<span class="ident" id="4077882">encodeQueryComponent</span><span class="op" id="4077902">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077907">t</span><span class="op" id="4077908">[</span><span class="ident" id="4077909">j</span><span class="op" id="4077910">]</span>&nbsp;<span class="op" id="4077912">=</span>&nbsp;<span class="string" id="4077914">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077921">j</span><span class="op" id="4077922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077927">case</span>&nbsp;<span class="ident" id="4077932">shouldEscape</span><span class="op" id="4077944">(</span><span class="ident" id="4077945">c</span><span class="op" id="4077946">,</span>&nbsp;<span class="ident" id="4077948">mode</span><span class="op" id="4077952">)</span><span class="op" id="4077953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077958">t</span><span class="op" id="4077959">[</span><span class="ident" id="4077960">j</span><span class="op" id="4077961">]</span>&nbsp;<span class="op" id="4077963">=</span>&nbsp;<span class="string" id="4077965">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077972">t</span><span class="op" id="4077973">[</span><span class="ident" id="4077974">j</span><span class="op" id="4077975">+</span><span class="num" id="4077976">1</span><span class="op" id="4077977">]</span>&nbsp;<span class="op" id="4077979">=</span>&nbsp;<span class="string" id="4077981">&#34;0123456789ABCDEF&#34;</span><span class="op" id="4077999">[</span><span class="ident" id="4078000">c</span><span class="op" id="4078001">&gt;&gt;</span><span class="num" id="4078003">4</span><span class="op" id="4078004">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078009">t</span><span class="op" id="4078010">[</span><span class="ident" id="4078011">j</span><span class="op" id="4078012">+</span><span class="num" id="4078013">2</span><span class="op" id="4078014">]</span>&nbsp;<span class="op" id="4078016">=</span>&nbsp;<span class="string" id="4078018">&#34;0123456789ABCDEF&#34;</span><span class="op" id="4078036">[</span><span class="ident" id="4078037">c</span><span class="op" id="4078038">&amp;</span><span class="num" id="4078039">15</span><span class="op" id="4078041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078046">j</span>&nbsp;<span class="op" id="4078048">+=</span>&nbsp;<span class="num" id="4078051">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078055">default</span><span class="op" id="4078062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078067">t</span><span class="op" id="4078068">[</span><span class="ident" id="4078069">j</span><span class="op" id="4078070">]</span>&nbsp;<span class="op" id="4078072">=</span>&nbsp;<span class="ident" id="4078074">s</span><span class="op" id="4078075">[</span><span class="ident" id="4078076">i</span><span class="op" id="4078077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078082">j</span><span class="op" id="4078083">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078094">return</span>&nbsp;<span class="builtintype" id="4078101">string</span><span class="op" id="4078107">(</span><span class="ident" id="4078108">t</span><span class="op" id="4078109">)</span><br>
<span class="lineno"></span><span class="op" id="4078111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4078114">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="4078179">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4078215">//</span><br>
<span class="lineno"></span><span class="comment" id="4078218">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="4078270">//</span><br>
<span class="lineno">220</span><span class="comment" id="4078273">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="4078349">//</span><br>
<span class="lineno"></span><span class="comment" id="4078352">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="4078388">//</span><br>
<span class="lineno"></span><span class="comment" id="4078391">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="4078471">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="4078552">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="4078636">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="4078721">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4078800">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="4078882">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="4078936">type</span>&nbsp;<span class="ident" id="4078941">URL</span>&nbsp;<span class="keyword" id="4078945">struct</span>&nbsp;<span class="op" id="4078952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078955">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4078964">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078972">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4078981">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4078991">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079015">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079024">*</span><span class="ident" id="4079025">Userinfo</span>&nbsp;<span class="comment" id="4079034">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079072">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4079081">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4079091">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079113">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4079122">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079130">RawQuery</span>&nbsp;<span class="builtintype" id="4079139">string</span>&nbsp;<span class="comment" id="4079146">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079184">Fragment</span>&nbsp;<span class="builtintype" id="4079193">string</span>&nbsp;<span class="comment" id="4079200">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="4079240">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4079243">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="4079303">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4079327">func</span>&nbsp;<span class="ident" id="4079332">User</span><span class="op" id="4079336">(</span><span class="ident" id="4079337">username</span>&nbsp;<span class="builtintype" id="4079346">string</span><span class="op" id="4079352">)</span>&nbsp;<span class="op" id="4079354">*</span><span class="ident" id="4079355">Userinfo</span>&nbsp;<span class="op" id="4079364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079367">return</span>&nbsp;<span class="op" id="4079374">&amp;</span><span class="ident" id="4079375">Userinfo</span><span class="op" id="4079383">{</span><span class="ident" id="4079384">username</span><span class="op" id="4079392">,</span>&nbsp;<span class="string" id="4079394">&#34;&#34;</span><span class="op" id="4079396">,</span>&nbsp;<span class="builtintype" id="4079398">false</span><span class="op" id="4079403">}</span><br>
<span class="lineno">245</span><span class="op" id="4079405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4079408">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="4079476">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="4079493">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="4079558">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="4079612">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="4079675">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4079737">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="4079801">func</span>&nbsp;<span class="ident" id="4079806">UserPassword</span><span class="op" id="4079818">(</span><span class="ident" id="4079819">username</span><span class="op" id="4079827">,</span>&nbsp;<span class="ident" id="4079829">password</span>&nbsp;<span class="builtintype" id="4079838">string</span><span class="op" id="4079844">)</span>&nbsp;<span class="op" id="4079846">*</span><span class="ident" id="4079847">Userinfo</span>&nbsp;<span class="op" id="4079856">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079859">return</span>&nbsp;<span class="op" id="4079866">&amp;</span><span class="ident" id="4079867">Userinfo</span><span class="op" id="4079875">{</span><span class="ident" id="4079876">username</span><span class="op" id="4079884">,</span>&nbsp;<span class="ident" id="4079886">password</span><span class="op" id="4079894">,</span>&nbsp;<span class="builtintype" id="4079896">true</span><span class="op" id="4079900">}</span><br>
<span class="lineno"></span><span class="op" id="4079902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4079905">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4079972">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="4080044">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="4080115">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4080145">type</span>&nbsp;<span class="ident" id="4080150">Userinfo</span>&nbsp;<span class="keyword" id="4080159">struct</span>&nbsp;<span class="op" id="4080166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080169">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4080181">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080189">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4080201">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080209">passwordSet</span>&nbsp;<span class="builtintype" id="4080221">bool</span><br>
<span class="lineno"></span><span class="op" id="4080226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4080229">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="4080263">func</span>&nbsp;<span class="op" id="4080268">(</span><span class="ident" id="4080269">u</span>&nbsp;<span class="op" id="4080271">*</span><span class="ident" id="4080272">Userinfo</span><span class="op" id="4080280">)</span>&nbsp;<span class="ident" id="4080282">Username</span><span class="op" id="4080290">(</span><span class="op" id="4080291">)</span>&nbsp;<span class="builtintype" id="4080293">string</span>&nbsp;<span class="op" id="4080300">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080303">return</span>&nbsp;<span class="ident" id="4080310">u</span><span class="op" id="4080311">.</span><span class="ident" id="4080312">username</span><br>
<span class="lineno"></span><span class="op" id="4080321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4080324">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4080399">func</span>&nbsp;<span class="op" id="4080404">(</span><span class="ident" id="4080405">u</span>&nbsp;<span class="op" id="4080407">*</span><span class="ident" id="4080408">Userinfo</span><span class="op" id="4080416">)</span>&nbsp;<span class="ident" id="4080418">Password</span><span class="op" id="4080426">(</span><span class="op" id="4080427">)</span>&nbsp;<span class="op" id="4080429">(</span><span class="builtintype" id="4080430">string</span><span class="op" id="4080436">,</span>&nbsp;<span class="builtintype" id="4080438">bool</span><span class="op" id="4080442">)</span>&nbsp;<span class="op" id="4080444">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080447">if</span>&nbsp;<span class="ident" id="4080450">u</span><span class="op" id="4080451">.</span><span class="ident" id="4080452">passwordSet</span>&nbsp;<span class="op" id="4080464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080468">return</span>&nbsp;<span class="ident" id="4080475">u</span><span class="op" id="4080476">.</span><span class="ident" id="4080477">password</span><span class="op" id="4080485">,</span>&nbsp;<span class="builtintype" id="4080487">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080496">return</span>&nbsp;<span class="string" id="4080503">&#34;&#34;</span><span class="op" id="4080505">,</span>&nbsp;<span class="builtintype" id="4080507">false</span><br>
<span class="lineno"></span><span class="op" id="4080513">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="4080516">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4080588">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4080617">func</span>&nbsp;<span class="op" id="4080622">(</span><span class="ident" id="4080623">u</span>&nbsp;<span class="op" id="4080625">*</span><span class="ident" id="4080626">Userinfo</span><span class="op" id="4080634">)</span>&nbsp;<span class="ident" id="4080636">String</span><span class="op" id="4080642">(</span><span class="op" id="4080643">)</span>&nbsp;<span class="builtintype" id="4080645">string</span>&nbsp;<span class="op" id="4080652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080655">s</span>&nbsp;<span class="op" id="4080657">:=</span>&nbsp;<span class="ident" id="4080660">escape</span><span class="op" id="4080666">(</span><span class="ident" id="4080667">u</span><span class="op" id="4080668">.</span><span class="ident" id="4080669">username</span><span class="op" id="4080677">,</span>&nbsp;<span class="ident" id="4080679">encodeUserPassword</span><span class="op" id="4080697">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080700">if</span>&nbsp;<span class="ident" id="4080703">u</span><span class="op" id="4080704">.</span><span class="ident" id="4080705">passwordSet</span>&nbsp;<span class="op" id="4080717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080721">s</span>&nbsp;<span class="op" id="4080723">+=</span>&nbsp;<span class="string" id="4080726">&#34;:&#34;</span>&nbsp;<span class="op" id="4080730">+</span>&nbsp;<span class="ident" id="4080732">escape</span><span class="op" id="4080738">(</span><span class="ident" id="4080739">u</span><span class="op" id="4080740">.</span><span class="ident" id="4080741">password</span><span class="op" id="4080749">,</span>&nbsp;<span class="ident" id="4080751">encodeUserPassword</span><span class="op" id="4080769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080775">return</span>&nbsp;<span class="ident" id="4080782">s</span><br>
<span class="lineno"></span><span class="op" id="4080784">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="4080787">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="4080831">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="4080875">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="4080930">func</span>&nbsp;<span class="ident" id="4080935">getscheme</span><span class="op" id="4080944">(</span><span class="ident" id="4080945">rawurl</span>&nbsp;<span class="builtintype" id="4080952">string</span><span class="op" id="4080958">)</span>&nbsp;<span class="op" id="4080960">(</span><span class="ident" id="4080961">scheme</span><span class="op" id="4080967">,</span>&nbsp;<span class="ident" id="4080969">path</span>&nbsp;<span class="builtintype" id="4080974">string</span><span class="op" id="4080980">,</span>&nbsp;<span class="ident" id="4080982">err</span>&nbsp;<span class="builtintype" id="4080986">error</span><span class="op" id="4080991">)</span>&nbsp;<span class="op" id="4080993">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080996">for</span>&nbsp;<span class="ident" id="4081000">i</span>&nbsp;<span class="op" id="4081002">:=</span>&nbsp;<span class="num" id="4081005">0</span><span class="op" id="4081006">;</span>&nbsp;<span class="ident" id="4081008">i</span>&nbsp;<span class="op" id="4081010">&lt;</span>&nbsp;<span class="builtinfunc" id="4081012">len</span><span class="op" id="4081015">(</span><span class="ident" id="4081016">rawurl</span><span class="op" id="4081022">)</span><span class="op" id="4081023">;</span>&nbsp;<span class="ident" id="4081025">i</span><span class="op" id="4081026">++</span>&nbsp;<span class="op" id="4081029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081033">c</span>&nbsp;<span class="op" id="4081035">:=</span>&nbsp;<span class="ident" id="4081038">rawurl</span><span class="op" id="4081044">[</span><span class="ident" id="4081045">i</span><span class="op" id="4081046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081050">switch</span>&nbsp;<span class="op" id="4081057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081061">case</span>&nbsp;<span class="string" id="4081066">&#39;a&#39;</span>&nbsp;<span class="op" id="4081070">&lt;=</span>&nbsp;<span class="ident" id="4081073">c</span>&nbsp;<span class="op" id="4081075">&amp;&amp;</span>&nbsp;<span class="ident" id="4081078">c</span>&nbsp;<span class="op" id="4081080">&lt;=</span>&nbsp;<span class="string" id="4081083">&#39;z&#39;</span>&nbsp;<span class="op" id="4081087">||</span>&nbsp;<span class="string" id="4081090">&#39;A&#39;</span>&nbsp;<span class="op" id="4081094">&lt;=</span>&nbsp;<span class="ident" id="4081097">c</span>&nbsp;<span class="op" id="4081099">&amp;&amp;</span>&nbsp;<span class="ident" id="4081102">c</span>&nbsp;<span class="op" id="4081104">&lt;=</span>&nbsp;<span class="string" id="4081107">&#39;Z&#39;</span><span class="op" id="4081110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081114">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081130">case</span>&nbsp;<span class="string" id="4081135">&#39;0&#39;</span>&nbsp;<span class="op" id="4081139">&lt;=</span>&nbsp;<span class="ident" id="4081142">c</span>&nbsp;<span class="op" id="4081144">&amp;&amp;</span>&nbsp;<span class="ident" id="4081147">c</span>&nbsp;<span class="op" id="4081149">&lt;=</span>&nbsp;<span class="string" id="4081152">&#39;9&#39;</span>&nbsp;<span class="op" id="4081156">||</span>&nbsp;<span class="ident" id="4081159">c</span>&nbsp;<span class="op" id="4081161">==</span>&nbsp;<span class="string" id="4081164">&#39;+&#39;</span>&nbsp;<span class="op" id="4081168">||</span>&nbsp;<span class="ident" id="4081171">c</span>&nbsp;<span class="op" id="4081173">==</span>&nbsp;<span class="string" id="4081176">&#39;-&#39;</span>&nbsp;<span class="op" id="4081180">||</span>&nbsp;<span class="ident" id="4081183">c</span>&nbsp;<span class="op" id="4081185">==</span>&nbsp;<span class="string" id="4081188">&#39;.&#39;</span><span class="op" id="4081191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081196">if</span>&nbsp;<span class="ident" id="4081199">i</span>&nbsp;<span class="op" id="4081201">==</span>&nbsp;<span class="num" id="4081204">0</span>&nbsp;<span class="op" id="4081206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081212">return</span>&nbsp;<span class="string" id="4081219">&#34;&#34;</span><span class="op" id="4081221">,</span>&nbsp;<span class="ident" id="4081223">rawurl</span><span class="op" id="4081229">,</span>&nbsp;<span class="ident" id="4081231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081242">case</span>&nbsp;<span class="ident" id="4081247">c</span>&nbsp;<span class="op" id="4081249">==</span>&nbsp;<span class="string" id="4081252">&#39;:&#39;</span><span class="op" id="4081255">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081260">if</span>&nbsp;<span class="ident" id="4081263">i</span>&nbsp;<span class="op" id="4081265">==</span>&nbsp;<span class="num" id="4081268">0</span>&nbsp;<span class="op" id="4081270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081276">return</span>&nbsp;<span class="string" id="4081283">&#34;&#34;</span><span class="op" id="4081285">,</span>&nbsp;<span class="string" id="4081287">&#34;&#34;</span><span class="op" id="4081289">,</span>&nbsp;<span class="ident" id="4081291">errors</span><span class="op" id="4081297">.</span><span class="ident" id="4081298">New</span><span class="op" id="4081301">(</span><span class="string" id="4081302">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="4081327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081337">return</span>&nbsp;<span class="ident" id="4081344">rawurl</span><span class="op" id="4081350">[</span><span class="num" id="4081351">0</span><span class="op" id="4081352">:</span><span class="ident" id="4081353">i</span><span class="op" id="4081354">]</span><span class="op" id="4081355">,</span>&nbsp;<span class="ident" id="4081357">rawurl</span><span class="op" id="4081363">[</span><span class="ident" id="4081364">i</span><span class="op" id="4081365">+</span><span class="num" id="4081366">1</span><span class="op" id="4081367">:</span><span class="op" id="4081368">]</span><span class="op" id="4081369">,</span>&nbsp;<span class="ident" id="4081371">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081377">default</span><span class="op" id="4081384">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081389">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081437">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081471">return</span>&nbsp;<span class="string" id="4081478">&#34;&#34;</span><span class="op" id="4081480">,</span>&nbsp;<span class="ident" id="4081482">rawurl</span><span class="op" id="4081488">,</span>&nbsp;<span class="ident" id="4081490">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081499">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081502">return</span>&nbsp;<span class="string" id="4081509">&#34;&#34;</span><span class="op" id="4081511">,</span>&nbsp;<span class="ident" id="4081513">rawurl</span><span class="op" id="4081519">,</span>&nbsp;<span class="ident" id="4081521">nil</span><br>
<span class="lineno"></span><span class="op" id="4081525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4081528">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="4081561">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="4081612">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4081637">func</span>&nbsp;<span class="ident" id="4081642">split</span><span class="op" id="4081647">(</span><span class="ident" id="4081648">s</span>&nbsp;<span class="builtintype" id="4081650">string</span><span class="op" id="4081656">,</span>&nbsp;<span class="ident" id="4081658">c</span>&nbsp;<span class="builtintype" id="4081660">string</span><span class="op" id="4081666">,</span>&nbsp;<span class="ident" id="4081668">cutc</span>&nbsp;<span class="builtintype" id="4081673">bool</span><span class="op" id="4081677">)</span>&nbsp;<span class="op" id="4081679">(</span><span class="builtintype" id="4081680">string</span><span class="op" id="4081686">,</span>&nbsp;<span class="builtintype" id="4081688">string</span><span class="op" id="4081694">)</span>&nbsp;<span class="op" id="4081696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081699">i</span>&nbsp;<span class="op" id="4081701">:=</span>&nbsp;<span class="ident" id="4081704">strings</span><span class="op" id="4081711">.</span><span class="ident" id="4081712">Index</span><span class="op" id="4081717">(</span><span class="ident" id="4081718">s</span><span class="op" id="4081719">,</span>&nbsp;<span class="ident" id="4081721">c</span><span class="op" id="4081722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081725">if</span>&nbsp;<span class="ident" id="4081728">i</span>&nbsp;<span class="op" id="4081730">&lt;</span>&nbsp;<span class="num" id="4081732">0</span>&nbsp;<span class="op" id="4081734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081738">return</span>&nbsp;<span class="ident" id="4081745">s</span><span class="op" id="4081746">,</span>&nbsp;<span class="string" id="4081748">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081755">if</span>&nbsp;<span class="ident" id="4081758">cutc</span>&nbsp;<span class="op" id="4081763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081767">return</span>&nbsp;<span class="ident" id="4081774">s</span><span class="op" id="4081775">[</span><span class="num" id="4081776">0</span><span class="op" id="4081777">:</span><span class="ident" id="4081778">i</span><span class="op" id="4081779">]</span><span class="op" id="4081780">,</span>&nbsp;<span class="ident" id="4081782">s</span><span class="op" id="4081783">[</span><span class="ident" id="4081784">i</span><span class="op" id="4081785">+</span><span class="builtinfunc" id="4081786">len</span><span class="op" id="4081789">(</span><span class="ident" id="4081790">c</span><span class="op" id="4081791">)</span><span class="op" id="4081792">:</span><span class="op" id="4081793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081799">return</span>&nbsp;<span class="ident" id="4081806">s</span><span class="op" id="4081807">[</span><span class="num" id="4081808">0</span><span class="op" id="4081809">:</span><span class="ident" id="4081810">i</span><span class="op" id="4081811">]</span><span class="op" id="4081812">,</span>&nbsp;<span class="ident" id="4081814">s</span><span class="op" id="4081815">[</span><span class="ident" id="4081816">i</span><span class="op" id="4081817">:</span><span class="op" id="4081818">]</span><br>
<span class="lineno">330</span><span class="op" id="4081820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4081823">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4081868">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="4081911">func</span>&nbsp;<span class="ident" id="4081916">Parse</span><span class="op" id="4081921">(</span><span class="ident" id="4081922">rawurl</span>&nbsp;<span class="builtintype" id="4081929">string</span><span class="op" id="4081935">)</span>&nbsp;<span class="op" id="4081937">(</span><span class="ident" id="4081938">url</span>&nbsp;<span class="op" id="4081942">*</span><span class="ident" id="4081943">URL</span><span class="op" id="4081946">,</span>&nbsp;<span class="ident" id="4081948">err</span>&nbsp;<span class="builtintype" id="4081952">error</span><span class="op" id="4081957">)</span>&nbsp;<span class="op" id="4081959">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081962">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081980">u</span><span class="op" id="4081981">,</span>&nbsp;<span class="ident" id="4081983">frag</span>&nbsp;<span class="op" id="4081988">:=</span>&nbsp;<span class="ident" id="4081991">split</span><span class="op" id="4081996">(</span><span class="ident" id="4081997">rawurl</span><span class="op" id="4082003">,</span>&nbsp;<span class="string" id="4082005">&#34;#&#34;</span><span class="op" id="4082008">,</span>&nbsp;<span class="builtintype" id="4082010">true</span><span class="op" id="4082014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082017">if</span>&nbsp;<span class="ident" id="4082020">url</span><span class="op" id="4082023">,</span>&nbsp;<span class="ident" id="4082025">err</span>&nbsp;<span class="op" id="4082029">=</span>&nbsp;<span class="ident" id="4082031">parse</span><span class="op" id="4082036">(</span><span class="ident" id="4082037">u</span><span class="op" id="4082038">,</span>&nbsp;<span class="builtintype" id="4082040">false</span><span class="op" id="4082045">)</span><span class="op" id="4082046">;</span>&nbsp;<span class="ident" id="4082048">err</span>&nbsp;<span class="op" id="4082052">!=</span>&nbsp;<span class="ident" id="4082055">nil</span>&nbsp;<span class="op" id="4082059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082063">return</span>&nbsp;<span class="ident" id="4082070">nil</span><span class="op" id="4082073">,</span>&nbsp;<span class="ident" id="4082075">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082080">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082083">if</span>&nbsp;<span class="ident" id="4082086">frag</span>&nbsp;<span class="op" id="4082091">==</span>&nbsp;<span class="string" id="4082094">&#34;&#34;</span>&nbsp;<span class="op" id="4082097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082101">return</span>&nbsp;<span class="ident" id="4082108">url</span><span class="op" id="4082111">,</span>&nbsp;<span class="ident" id="4082113">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082121">if</span>&nbsp;<span class="ident" id="4082124">url</span><span class="op" id="4082127">.</span><span class="ident" id="4082128">Fragment</span><span class="op" id="4082136">,</span>&nbsp;<span class="ident" id="4082138">err</span>&nbsp;<span class="op" id="4082142">=</span>&nbsp;<span class="ident" id="4082144">unescape</span><span class="op" id="4082152">(</span><span class="ident" id="4082153">frag</span><span class="op" id="4082157">,</span>&nbsp;<span class="ident" id="4082159">encodeFragment</span><span class="op" id="4082173">)</span><span class="op" id="4082174">;</span>&nbsp;<span class="ident" id="4082176">err</span>&nbsp;<span class="op" id="4082180">!=</span>&nbsp;<span class="ident" id="4082183">nil</span>&nbsp;<span class="op" id="4082187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082191">return</span>&nbsp;<span class="ident" id="4082198">nil</span><span class="op" id="4082201">,</span>&nbsp;<span class="op" id="4082203">&amp;</span><span class="ident" id="4082204">Error</span><span class="op" id="4082209">{</span><span class="string" id="4082210">&#34;parse&#34;</span><span class="op" id="4082217">,</span>&nbsp;<span class="ident" id="4082219">rawurl</span><span class="op" id="4082225">,</span>&nbsp;<span class="ident" id="4082227">err</span><span class="op" id="4082230">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082236">return</span>&nbsp;<span class="ident" id="4082243">url</span><span class="op" id="4082246">,</span>&nbsp;<span class="ident" id="4082248">nil</span><br>
<span class="lineno"></span><span class="op" id="4082252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4082255">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="4082327">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="4082399">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="4082447">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="4082511">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="4082585">func</span>&nbsp;<span class="ident" id="4082590">ParseRequestURI</span><span class="op" id="4082605">(</span><span class="ident" id="4082606">rawurl</span>&nbsp;<span class="builtintype" id="4082613">string</span><span class="op" id="4082619">)</span>&nbsp;<span class="op" id="4082621">(</span><span class="ident" id="4082622">url</span>&nbsp;<span class="op" id="4082626">*</span><span class="ident" id="4082627">URL</span><span class="op" id="4082630">,</span>&nbsp;<span class="ident" id="4082632">err</span>&nbsp;<span class="builtintype" id="4082636">error</span><span class="op" id="4082641">)</span>&nbsp;<span class="op" id="4082643">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082646">return</span>&nbsp;<span class="ident" id="4082653">parse</span><span class="op" id="4082658">(</span><span class="ident" id="4082659">rawurl</span><span class="op" id="4082665">,</span>&nbsp;<span class="builtintype" id="4082667">true</span><span class="op" id="4082671">)</span><br>
<span class="lineno"></span><span class="op" id="4082673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4082676">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4082740">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="4082819">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="4082899">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="4082966">func</span>&nbsp;<span class="ident" id="4082971">parse</span><span class="op" id="4082976">(</span><span class="ident" id="4082977">rawurl</span>&nbsp;<span class="builtintype" id="4082984">string</span><span class="op" id="4082990">,</span>&nbsp;<span class="ident" id="4082992">viaRequest</span>&nbsp;<span class="builtintype" id="4083003">bool</span><span class="op" id="4083007">)</span>&nbsp;<span class="op" id="4083009">(</span><span class="ident" id="4083010">url</span>&nbsp;<span class="op" id="4083014">*</span><span class="ident" id="4083015">URL</span><span class="op" id="4083018">,</span>&nbsp;<span class="ident" id="4083020">err</span>&nbsp;<span class="builtintype" id="4083024">error</span><span class="op" id="4083029">)</span>&nbsp;<span class="op" id="4083031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083034">var</span>&nbsp;<span class="ident" id="4083038">rest</span>&nbsp;<span class="builtintype" id="4083043">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083052">if</span>&nbsp;<span class="ident" id="4083055">rawurl</span>&nbsp;<span class="op" id="4083062">==</span>&nbsp;<span class="string" id="4083065">&#34;&#34;</span>&nbsp;<span class="op" id="4083068">&amp;&amp;</span>&nbsp;<span class="ident" id="4083071">viaRequest</span>&nbsp;<span class="op" id="4083082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083086">err</span>&nbsp;<span class="op" id="4083090">=</span>&nbsp;<span class="ident" id="4083092">errors</span><span class="op" id="4083098">.</span><span class="ident" id="4083099">New</span><span class="op" id="4083102">(</span><span class="string" id="4083103">&#34;empty&nbsp;url&#34;</span><span class="op" id="4083114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083118">goto</span>&nbsp;<span class="ident" id="4083123">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083133">url</span>&nbsp;<span class="op" id="4083137">=</span>&nbsp;<span class="builtinfunc" id="4083139">new</span><span class="op" id="4083142">(</span><span class="ident" id="4083143">URL</span><span class="op" id="4083146">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083150">if</span>&nbsp;<span class="ident" id="4083153">rawurl</span>&nbsp;<span class="op" id="4083160">==</span>&nbsp;<span class="string" id="4083163">&#34;*&#34;</span>&nbsp;<span class="op" id="4083167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083171">url</span><span class="op" id="4083174">.</span><span class="ident" id="4083175">Path</span>&nbsp;<span class="op" id="4083180">=</span>&nbsp;<span class="string" id="4083182">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083196">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083200">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083256">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083295">if</span>&nbsp;<span class="ident" id="4083298">url</span><span class="op" id="4083301">.</span><span class="ident" id="4083302">Scheme</span><span class="op" id="4083308">,</span>&nbsp;<span class="ident" id="4083310">rest</span><span class="op" id="4083314">,</span>&nbsp;<span class="ident" id="4083316">err</span>&nbsp;<span class="op" id="4083320">=</span>&nbsp;<span class="ident" id="4083322">getscheme</span><span class="op" id="4083331">(</span><span class="ident" id="4083332">rawurl</span><span class="op" id="4083338">)</span><span class="op" id="4083339">;</span>&nbsp;<span class="ident" id="4083341">err</span>&nbsp;<span class="op" id="4083345">!=</span>&nbsp;<span class="ident" id="4083348">nil</span>&nbsp;<span class="op" id="4083352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083356">goto</span>&nbsp;<span class="ident" id="4083361">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083371">url</span><span class="op" id="4083374">.</span><span class="ident" id="4083375">Scheme</span>&nbsp;<span class="op" id="4083382">=</span>&nbsp;<span class="ident" id="4083384">strings</span><span class="op" id="4083391">.</span><span class="ident" id="4083392">ToLower</span><span class="op" id="4083399">(</span><span class="ident" id="4083400">url</span><span class="op" id="4083403">.</span><span class="ident" id="4083404">Scheme</span><span class="op" id="4083410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083414">rest</span><span class="op" id="4083418">,</span>&nbsp;<span class="ident" id="4083420">url</span><span class="op" id="4083423">.</span><span class="ident" id="4083424">RawQuery</span>&nbsp;<span class="op" id="4083433">=</span>&nbsp;<span class="ident" id="4083435">split</span><span class="op" id="4083440">(</span><span class="ident" id="4083441">rest</span><span class="op" id="4083445">,</span>&nbsp;<span class="string" id="4083447">&#34;?&#34;</span><span class="op" id="4083450">,</span>&nbsp;<span class="builtintype" id="4083452">true</span><span class="op" id="4083456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083460">if</span>&nbsp;<span class="op" id="4083463">!</span><span class="ident" id="4083464">strings</span><span class="op" id="4083471">.</span><span class="ident" id="4083472">HasPrefix</span><span class="op" id="4083481">(</span><span class="ident" id="4083482">rest</span><span class="op" id="4083486">,</span>&nbsp;<span class="string" id="4083488">&#34;/&#34;</span><span class="op" id="4083491">)</span>&nbsp;<span class="op" id="4083493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083497">if</span>&nbsp;<span class="ident" id="4083500">url</span><span class="op" id="4083503">.</span><span class="ident" id="4083504">Scheme</span>&nbsp;<span class="op" id="4083511">!=</span>&nbsp;<span class="string" id="4083514">&#34;&#34;</span>&nbsp;<span class="op" id="4083517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083522">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083579">url</span><span class="op" id="4083582">.</span><span class="ident" id="4083583">Opaque</span>&nbsp;<span class="op" id="4083590">=</span>&nbsp;<span class="ident" id="4083592">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083600">return</span>&nbsp;<span class="ident" id="4083607">url</span><span class="op" id="4083610">,</span>&nbsp;<span class="ident" id="4083612">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083622">if</span>&nbsp;<span class="ident" id="4083625">viaRequest</span>&nbsp;<span class="op" id="4083636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083641">err</span>&nbsp;<span class="op" id="4083645">=</span>&nbsp;<span class="ident" id="4083647">errors</span><span class="op" id="4083653">.</span><span class="ident" id="4083654">New</span><span class="op" id="4083657">(</span><span class="string" id="4083658">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="4083683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083688">goto</span>&nbsp;<span class="ident" id="4083693">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083701">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083708">if</span>&nbsp;<span class="op" id="4083711">(</span><span class="ident" id="4083712">url</span><span class="op" id="4083715">.</span><span class="ident" id="4083716">Scheme</span>&nbsp;<span class="op" id="4083723">!=</span>&nbsp;<span class="string" id="4083726">&#34;&#34;</span>&nbsp;<span class="op" id="4083729">||</span>&nbsp;<span class="op" id="4083732">!</span><span class="ident" id="4083733">viaRequest</span>&nbsp;<span class="op" id="4083744">&amp;&amp;</span>&nbsp;<span class="op" id="4083747">!</span><span class="ident" id="4083748">strings</span><span class="op" id="4083755">.</span><span class="ident" id="4083756">HasPrefix</span><span class="op" id="4083765">(</span><span class="ident" id="4083766">rest</span><span class="op" id="4083770">,</span>&nbsp;<span class="string" id="4083772">&#34;///&#34;</span><span class="op" id="4083777">)</span><span class="op" id="4083778">)</span>&nbsp;<span class="op" id="4083780">&amp;&amp;</span>&nbsp;<span class="ident" id="4083783">strings</span><span class="op" id="4083790">.</span><span class="ident" id="4083791">HasPrefix</span><span class="op" id="4083800">(</span><span class="ident" id="4083801">rest</span><span class="op" id="4083805">,</span>&nbsp;<span class="string" id="4083807">&#34;//&#34;</span><span class="op" id="4083811">)</span>&nbsp;<span class="op" id="4083813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083817">var</span>&nbsp;<span class="ident" id="4083821">authority</span>&nbsp;<span class="builtintype" id="4083831">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083840">authority</span><span class="op" id="4083849">,</span>&nbsp;<span class="ident" id="4083851">rest</span>&nbsp;<span class="op" id="4083856">=</span>&nbsp;<span class="ident" id="4083858">split</span><span class="op" id="4083863">(</span><span class="ident" id="4083864">rest</span><span class="op" id="4083868">[</span><span class="num" id="4083869">2</span><span class="op" id="4083870">:</span><span class="op" id="4083871">]</span><span class="op" id="4083872">,</span>&nbsp;<span class="string" id="4083874">&#34;/&#34;</span><span class="op" id="4083877">,</span>&nbsp;<span class="builtintype" id="4083879">false</span><span class="op" id="4083884">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083888">url</span><span class="op" id="4083891">.</span><span class="ident" id="4083892">User</span><span class="op" id="4083896">,</span>&nbsp;<span class="ident" id="4083898">url</span><span class="op" id="4083901">.</span><span class="ident" id="4083902">Host</span><span class="op" id="4083906">,</span>&nbsp;<span class="ident" id="4083908">err</span>&nbsp;<span class="op" id="4083912">=</span>&nbsp;<span class="ident" id="4083914">parseAuthority</span><span class="op" id="4083928">(</span><span class="ident" id="4083929">authority</span><span class="op" id="4083938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083942">if</span>&nbsp;<span class="ident" id="4083945">err</span>&nbsp;<span class="op" id="4083949">!=</span>&nbsp;<span class="ident" id="4083952">nil</span>&nbsp;<span class="op" id="4083956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083961">goto</span>&nbsp;<span class="ident" id="4083966">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083978">if</span>&nbsp;<span class="ident" id="4083981">strings</span><span class="op" id="4083988">.</span><span class="ident" id="4083989">Contains</span><span class="op" id="4083997">(</span><span class="ident" id="4083998">url</span><span class="op" id="4084001">.</span><span class="ident" id="4084002">Host</span><span class="op" id="4084006">,</span>&nbsp;<span class="string" id="4084008">&#34;%&#34;</span><span class="op" id="4084011">)</span>&nbsp;<span class="op" id="4084013">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084018">err</span>&nbsp;<span class="op" id="4084022">=</span>&nbsp;<span class="ident" id="4084024">errors</span><span class="op" id="4084030">.</span><span class="ident" id="4084031">New</span><span class="op" id="4084034">(</span><span class="string" id="4084035">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="4084063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084068">goto</span>&nbsp;<span class="ident" id="4084073">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084087">if</span>&nbsp;<span class="ident" id="4084090">url</span><span class="op" id="4084093">.</span><span class="ident" id="4084094">Path</span><span class="op" id="4084098">,</span>&nbsp;<span class="ident" id="4084100">err</span>&nbsp;<span class="op" id="4084104">=</span>&nbsp;<span class="ident" id="4084106">unescape</span><span class="op" id="4084114">(</span><span class="ident" id="4084115">rest</span><span class="op" id="4084119">,</span>&nbsp;<span class="ident" id="4084121">encodePath</span><span class="op" id="4084131">)</span><span class="op" id="4084132">;</span>&nbsp;<span class="ident" id="4084134">err</span>&nbsp;<span class="op" id="4084138">!=</span>&nbsp;<span class="ident" id="4084141">nil</span>&nbsp;<span class="op" id="4084145">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084149">goto</span>&nbsp;<span class="ident" id="4084154">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084164">return</span>&nbsp;<span class="ident" id="4084171">url</span><span class="op" id="4084174">,</span>&nbsp;<span class="ident" id="4084176">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4084181">Error</span><span class="op" id="4084186">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084189">return</span>&nbsp;<span class="ident" id="4084196">nil</span><span class="op" id="4084199">,</span>&nbsp;<span class="op" id="4084201">&amp;</span><span class="ident" id="4084202">Error</span><span class="op" id="4084207">{</span><span class="string" id="4084208">&#34;parse&#34;</span><span class="op" id="4084215">,</span>&nbsp;<span class="ident" id="4084217">rawurl</span><span class="op" id="4084223">,</span>&nbsp;<span class="ident" id="4084225">err</span><span class="op" id="4084228">}</span><br>
<span class="lineno"></span><span class="op" id="4084230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4084233">func</span>&nbsp;<span class="ident" id="4084238">parseAuthority</span><span class="op" id="4084252">(</span><span class="ident" id="4084253">authority</span>&nbsp;<span class="builtintype" id="4084263">string</span><span class="op" id="4084269">)</span>&nbsp;<span class="op" id="4084271">(</span><span class="ident" id="4084272">user</span>&nbsp;<span class="op" id="4084277">*</span><span class="ident" id="4084278">Userinfo</span><span class="op" id="4084286">,</span>&nbsp;<span class="ident" id="4084288">host</span>&nbsp;<span class="builtintype" id="4084293">string</span><span class="op" id="4084299">,</span>&nbsp;<span class="ident" id="4084301">err</span>&nbsp;<span class="builtintype" id="4084305">error</span><span class="op" id="4084310">)</span>&nbsp;<span class="op" id="4084312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084315">i</span>&nbsp;<span class="op" id="4084317">:=</span>&nbsp;<span class="ident" id="4084320">strings</span><span class="op" id="4084327">.</span><span class="ident" id="4084328">LastIndex</span><span class="op" id="4084337">(</span><span class="ident" id="4084338">authority</span><span class="op" id="4084347">,</span>&nbsp;<span class="string" id="4084349">&#34;@&#34;</span><span class="op" id="4084352">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084355">if</span>&nbsp;<span class="ident" id="4084358">i</span>&nbsp;<span class="op" id="4084360">&lt;</span>&nbsp;<span class="num" id="4084362">0</span>&nbsp;<span class="op" id="4084364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084368">host</span>&nbsp;<span class="op" id="4084373">=</span>&nbsp;<span class="ident" id="4084375">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084387">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084398">userinfo</span><span class="op" id="4084406">,</span>&nbsp;<span class="ident" id="4084408">host</span>&nbsp;<span class="op" id="4084413">:=</span>&nbsp;<span class="ident" id="4084416">authority</span><span class="op" id="4084425">[</span><span class="op" id="4084426">:</span><span class="ident" id="4084427">i</span><span class="op" id="4084428">]</span><span class="op" id="4084429">,</span>&nbsp;<span class="ident" id="4084431">authority</span><span class="op" id="4084440">[</span><span class="ident" id="4084441">i</span><span class="op" id="4084442">+</span><span class="num" id="4084443">1</span><span class="op" id="4084444">:</span><span class="op" id="4084445">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084448">if</span>&nbsp;<span class="ident" id="4084451">strings</span><span class="op" id="4084458">.</span><span class="ident" id="4084459">Index</span><span class="op" id="4084464">(</span><span class="ident" id="4084465">userinfo</span><span class="op" id="4084473">,</span>&nbsp;<span class="string" id="4084475">&#34;:&#34;</span><span class="op" id="4084478">)</span>&nbsp;<span class="op" id="4084480">&lt;</span>&nbsp;<span class="num" id="4084482">0</span>&nbsp;<span class="op" id="4084484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084488">if</span>&nbsp;<span class="ident" id="4084491">userinfo</span><span class="op" id="4084499">,</span>&nbsp;<span class="ident" id="4084501">err</span>&nbsp;<span class="op" id="4084505">=</span>&nbsp;<span class="ident" id="4084507">unescape</span><span class="op" id="4084515">(</span><span class="ident" id="4084516">userinfo</span><span class="op" id="4084524">,</span>&nbsp;<span class="ident" id="4084526">encodeUserPassword</span><span class="op" id="4084544">)</span><span class="op" id="4084545">;</span>&nbsp;<span class="ident" id="4084547">err</span>&nbsp;<span class="op" id="4084551">!=</span>&nbsp;<span class="ident" id="4084554">nil</span>&nbsp;<span class="op" id="4084558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084563">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084576">user</span>&nbsp;<span class="op" id="4084581">=</span>&nbsp;<span class="ident" id="4084583">User</span><span class="op" id="4084587">(</span><span class="ident" id="4084588">userinfo</span><span class="op" id="4084596">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084599">}</span>&nbsp;<span class="keyword" id="4084601">else</span>&nbsp;<span class="op" id="4084606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084610">username</span><span class="op" id="4084618">,</span>&nbsp;<span class="ident" id="4084620">password</span>&nbsp;<span class="op" id="4084629">:=</span>&nbsp;<span class="ident" id="4084632">split</span><span class="op" id="4084637">(</span><span class="ident" id="4084638">userinfo</span><span class="op" id="4084646">,</span>&nbsp;<span class="string" id="4084648">&#34;:&#34;</span><span class="op" id="4084651">,</span>&nbsp;<span class="builtintype" id="4084653">true</span><span class="op" id="4084657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084661">if</span>&nbsp;<span class="ident" id="4084664">username</span><span class="op" id="4084672">,</span>&nbsp;<span class="ident" id="4084674">err</span>&nbsp;<span class="op" id="4084678">=</span>&nbsp;<span class="ident" id="4084680">unescape</span><span class="op" id="4084688">(</span><span class="ident" id="4084689">username</span><span class="op" id="4084697">,</span>&nbsp;<span class="ident" id="4084699">encodeUserPassword</span><span class="op" id="4084717">)</span><span class="op" id="4084718">;</span>&nbsp;<span class="ident" id="4084720">err</span>&nbsp;<span class="op" id="4084724">!=</span>&nbsp;<span class="ident" id="4084727">nil</span>&nbsp;<span class="op" id="4084731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084745">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084749">if</span>&nbsp;<span class="ident" id="4084752">password</span><span class="op" id="4084760">,</span>&nbsp;<span class="ident" id="4084762">err</span>&nbsp;<span class="op" id="4084766">=</span>&nbsp;<span class="ident" id="4084768">unescape</span><span class="op" id="4084776">(</span><span class="ident" id="4084777">password</span><span class="op" id="4084785">,</span>&nbsp;<span class="ident" id="4084787">encodeUserPassword</span><span class="op" id="4084805">)</span><span class="op" id="4084806">;</span>&nbsp;<span class="ident" id="4084808">err</span>&nbsp;<span class="op" id="4084812">!=</span>&nbsp;<span class="ident" id="4084815">nil</span>&nbsp;<span class="op" id="4084819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084824">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084837">user</span>&nbsp;<span class="op" id="4084842">=</span>&nbsp;<span class="ident" id="4084844">UserPassword</span><span class="op" id="4084856">(</span><span class="ident" id="4084857">username</span><span class="op" id="4084865">,</span>&nbsp;<span class="ident" id="4084867">password</span><span class="op" id="4084875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084878">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084881">return</span><br>
<span class="lineno"></span><span class="op" id="4084888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4084891">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="4084946">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="4084991">//</span><br>
<span class="lineno"></span><span class="comment" id="4084994">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="4085011">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="4085057">//</span><br>
<span class="lineno"></span><span class="comment" id="4085060">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="4085117">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="4085155">//</span><br>
<span class="lineno"></span><span class="comment" id="4085158">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="4085208">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="4085255">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="4085300">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="4085343">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="4085400">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="4085453">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="4085509">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="4085558">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="4085606">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="4085657">func</span>&nbsp;<span class="op" id="4085662">(</span><span class="ident" id="4085663">u</span>&nbsp;<span class="op" id="4085665">*</span><span class="ident" id="4085666">URL</span><span class="op" id="4085669">)</span>&nbsp;<span class="ident" id="4085671">String</span><span class="op" id="4085677">(</span><span class="op" id="4085678">)</span>&nbsp;<span class="builtintype" id="4085680">string</span>&nbsp;<span class="op" id="4085687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085690">var</span>&nbsp;<span class="ident" id="4085694">buf</span>&nbsp;<span class="ident" id="4085698">bytes</span><span class="op" id="4085703">.</span><span class="ident" id="4085704">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085712">if</span>&nbsp;<span class="ident" id="4085715">u</span><span class="op" id="4085716">.</span><span class="ident" id="4085717">Scheme</span>&nbsp;<span class="op" id="4085724">!=</span>&nbsp;<span class="string" id="4085727">&#34;&#34;</span>&nbsp;<span class="op" id="4085730">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085734">buf</span><span class="op" id="4085737">.</span><span class="ident" id="4085738">WriteString</span><span class="op" id="4085749">(</span><span class="ident" id="4085750">u</span><span class="op" id="4085751">.</span><span class="ident" id="4085752">Scheme</span><span class="op" id="4085758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085762">buf</span><span class="op" id="4085765">.</span><span class="ident" id="4085766">WriteByte</span><span class="op" id="4085775">(</span><span class="string" id="4085776">&#39;:&#39;</span><span class="op" id="4085779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085785">if</span>&nbsp;<span class="ident" id="4085788">u</span><span class="op" id="4085789">.</span><span class="ident" id="4085790">Opaque</span>&nbsp;<span class="op" id="4085797">!=</span>&nbsp;<span class="string" id="4085800">&#34;&#34;</span>&nbsp;<span class="op" id="4085803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085807">buf</span><span class="op" id="4085810">.</span><span class="ident" id="4085811">WriteString</span><span class="op" id="4085822">(</span><span class="ident" id="4085823">u</span><span class="op" id="4085824">.</span><span class="ident" id="4085825">Opaque</span><span class="op" id="4085831">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4085834">}</span>&nbsp;<span class="keyword" id="4085836">else</span>&nbsp;<span class="op" id="4085841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085845">if</span>&nbsp;<span class="ident" id="4085848">u</span><span class="op" id="4085849">.</span><span class="ident" id="4085850">Scheme</span>&nbsp;<span class="op" id="4085857">!=</span>&nbsp;<span class="string" id="4085860">&#34;&#34;</span>&nbsp;<span class="op" id="4085863">||</span>&nbsp;<span class="ident" id="4085866">u</span><span class="op" id="4085867">.</span><span class="ident" id="4085868">Host</span>&nbsp;<span class="op" id="4085873">!=</span>&nbsp;<span class="string" id="4085876">&#34;&#34;</span>&nbsp;<span class="op" id="4085879">||</span>&nbsp;<span class="ident" id="4085882">u</span><span class="op" id="4085883">.</span><span class="ident" id="4085884">User</span>&nbsp;<span class="op" id="4085889">!=</span>&nbsp;<span class="ident" id="4085892">nil</span>&nbsp;<span class="op" id="4085896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085901">buf</span><span class="op" id="4085904">.</span><span class="ident" id="4085905">WriteString</span><span class="op" id="4085916">(</span><span class="string" id="4085917">&#34;//&#34;</span><span class="op" id="4085921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4085926">if</span>&nbsp;<span class="ident" id="4085929">ui</span>&nbsp;<span class="op" id="4085932">:=</span>&nbsp;<span class="ident" id="4085935">u</span><span class="op" id="4085936">.</span><span class="ident" id="4085937">User</span><span class="op" id="4085941">;</span>&nbsp;<span class="ident" id="4085943">ui</span>&nbsp;<span class="op" id="4085946">!=</span>&nbsp;<span class="ident" id="4085949">nil</span>&nbsp;<span class="op" id="4085953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085959">buf</span><span class="op" id="4085962">.</span><span class="ident" id="4085963">WriteString</span><span class="op" id="4085974">(</span><span class="ident" id="4085975">ui</span><span class="op" id="4085977">.</span><span class="ident" id="4085978">String</span><span class="op" id="4085984">(</span><span class="op" id="4085985">)</span><span class="op" id="4085986">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4085992">buf</span><span class="op" id="4085995">.</span><span class="ident" id="4085996">WriteByte</span><span class="op" id="4086005">(</span><span class="string" id="4086006">&#39;@&#39;</span><span class="op" id="4086009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086019">if</span>&nbsp;<span class="ident" id="4086022">h</span>&nbsp;<span class="op" id="4086024">:=</span>&nbsp;<span class="ident" id="4086027">u</span><span class="op" id="4086028">.</span><span class="ident" id="4086029">Host</span><span class="op" id="4086033">;</span>&nbsp;<span class="ident" id="4086035">h</span>&nbsp;<span class="op" id="4086037">!=</span>&nbsp;<span class="string" id="4086040">&#34;&#34;</span>&nbsp;<span class="op" id="4086043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086049">buf</span><span class="op" id="4086052">.</span><span class="ident" id="4086053">WriteString</span><span class="op" id="4086064">(</span><span class="ident" id="4086065">h</span><span class="op" id="4086066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086071">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086079">if</span>&nbsp;<span class="ident" id="4086082">u</span><span class="op" id="4086083">.</span><span class="ident" id="4086084">Path</span>&nbsp;<span class="op" id="4086089">!=</span>&nbsp;<span class="string" id="4086092">&#34;&#34;</span>&nbsp;<span class="op" id="4086095">&amp;&amp;</span>&nbsp;<span class="ident" id="4086098">u</span><span class="op" id="4086099">.</span><span class="ident" id="4086100">Path</span><span class="op" id="4086104">[</span><span class="num" id="4086105">0</span><span class="op" id="4086106">]</span>&nbsp;<span class="op" id="4086108">!=</span>&nbsp;<span class="string" id="4086111">&#39;/&#39;</span>&nbsp;<span class="op" id="4086115">&amp;&amp;</span>&nbsp;<span class="ident" id="4086118">u</span><span class="op" id="4086119">.</span><span class="ident" id="4086120">Host</span>&nbsp;<span class="op" id="4086125">!=</span>&nbsp;<span class="string" id="4086128">&#34;&#34;</span>&nbsp;<span class="op" id="4086131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086136">buf</span><span class="op" id="4086139">.</span><span class="ident" id="4086140">WriteByte</span><span class="op" id="4086149">(</span><span class="string" id="4086150">&#39;/&#39;</span><span class="op" id="4086153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086161">buf</span><span class="op" id="4086164">.</span><span class="ident" id="4086165">WriteString</span><span class="op" id="4086176">(</span><span class="ident" id="4086177">escape</span><span class="op" id="4086183">(</span><span class="ident" id="4086184">u</span><span class="op" id="4086185">.</span><span class="ident" id="4086186">Path</span><span class="op" id="4086190">,</span>&nbsp;<span class="ident" id="4086192">encodePath</span><span class="op" id="4086202">)</span><span class="op" id="4086203">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086209">if</span>&nbsp;<span class="ident" id="4086212">u</span><span class="op" id="4086213">.</span><span class="ident" id="4086214">RawQuery</span>&nbsp;<span class="op" id="4086223">!=</span>&nbsp;<span class="string" id="4086226">&#34;&#34;</span>&nbsp;<span class="op" id="4086229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086233">buf</span><span class="op" id="4086236">.</span><span class="ident" id="4086237">WriteByte</span><span class="op" id="4086246">(</span><span class="string" id="4086247">&#39;?&#39;</span><span class="op" id="4086250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086254">buf</span><span class="op" id="4086257">.</span><span class="ident" id="4086258">WriteString</span><span class="op" id="4086269">(</span><span class="ident" id="4086270">u</span><span class="op" id="4086271">.</span><span class="ident" id="4086272">RawQuery</span><span class="op" id="4086280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086283">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086286">if</span>&nbsp;<span class="ident" id="4086289">u</span><span class="op" id="4086290">.</span><span class="ident" id="4086291">Fragment</span>&nbsp;<span class="op" id="4086300">!=</span>&nbsp;<span class="string" id="4086303">&#34;&#34;</span>&nbsp;<span class="op" id="4086306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086310">buf</span><span class="op" id="4086313">.</span><span class="ident" id="4086314">WriteByte</span><span class="op" id="4086323">(</span><span class="string" id="4086324">&#39;#&#39;</span><span class="op" id="4086327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086331">buf</span><span class="op" id="4086334">.</span><span class="ident" id="4086335">WriteString</span><span class="op" id="4086346">(</span><span class="ident" id="4086347">escape</span><span class="op" id="4086353">(</span><span class="ident" id="4086354">u</span><span class="op" id="4086355">.</span><span class="ident" id="4086356">Fragment</span><span class="op" id="4086364">,</span>&nbsp;<span class="ident" id="4086366">encodeFragment</span><span class="op" id="4086380">)</span><span class="op" id="4086381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086387">return</span>&nbsp;<span class="ident" id="4086394">buf</span><span class="op" id="4086397">.</span><span class="ident" id="4086398">String</span><span class="op" id="4086404">(</span><span class="op" id="4086405">)</span><br>
<span class="lineno">495</span><span class="op" id="4086407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4086410">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="4086459">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="4086521">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="4086580">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="4086603">type</span>&nbsp;<span class="ident" id="4086608">Values</span>&nbsp;<span class="keyword" id="4086615">map</span><span class="op" id="4086618">[</span><span class="builtintype" id="4086619">string</span><span class="op" id="4086625">]</span><span class="op" id="4086626">[</span><span class="op" id="4086627">]</span><span class="builtintype" id="4086628">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4086636">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4086695">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="4086758">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="4086818">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4086831">func</span>&nbsp;<span class="op" id="4086836">(</span><span class="ident" id="4086837">v</span>&nbsp;<span class="ident" id="4086839">Values</span><span class="op" id="4086845">)</span>&nbsp;<span class="ident" id="4086847">Get</span><span class="op" id="4086850">(</span><span class="ident" id="4086851">key</span>&nbsp;<span class="builtintype" id="4086855">string</span><span class="op" id="4086861">)</span>&nbsp;<span class="builtintype" id="4086863">string</span>&nbsp;<span class="op" id="4086870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086873">if</span>&nbsp;<span class="ident" id="4086876">v</span>&nbsp;<span class="op" id="4086878">==</span>&nbsp;<span class="ident" id="4086881">nil</span>&nbsp;<span class="op" id="4086885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086889">return</span>&nbsp;<span class="string" id="4086896">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4086903">vs</span><span class="op" id="4086905">,</span>&nbsp;<span class="ident" id="4086907">ok</span>&nbsp;<span class="op" id="4086910">:=</span>&nbsp;<span class="ident" id="4086913">v</span><span class="op" id="4086914">[</span><span class="ident" id="4086915">key</span><span class="op" id="4086918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086921">if</span>&nbsp;<span class="op" id="4086924">!</span><span class="ident" id="4086925">ok</span>&nbsp;<span class="op" id="4086928">||</span>&nbsp;<span class="builtinfunc" id="4086931">len</span><span class="op" id="4086934">(</span><span class="ident" id="4086935">vs</span><span class="op" id="4086937">)</span>&nbsp;<span class="op" id="4086939">==</span>&nbsp;<span class="num" id="4086942">0</span>&nbsp;<span class="op" id="4086944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086948">return</span>&nbsp;<span class="string" id="4086955">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4086959">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4086962">return</span>&nbsp;<span class="ident" id="4086969">vs</span><span class="op" id="4086971">[</span><span class="num" id="4086972">0</span><span class="op" id="4086973">]</span><br>
<span class="lineno"></span><span class="op" id="4086975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4086978">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="4087033">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="4087044">func</span>&nbsp;<span class="op" id="4087049">(</span><span class="ident" id="4087050">v</span>&nbsp;<span class="ident" id="4087052">Values</span><span class="op" id="4087058">)</span>&nbsp;<span class="ident" id="4087060">Set</span><span class="op" id="4087063">(</span><span class="ident" id="4087064">key</span><span class="op" id="4087067">,</span>&nbsp;<span class="ident" id="4087069">value</span>&nbsp;<span class="builtintype" id="4087075">string</span><span class="op" id="4087081">)</span>&nbsp;<span class="op" id="4087083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087086">v</span><span class="op" id="4087087">[</span><span class="ident" id="4087088">key</span><span class="op" id="4087091">]</span>&nbsp;<span class="op" id="4087093">=</span>&nbsp;<span class="op" id="4087095">[</span><span class="op" id="4087096">]</span><span class="builtintype" id="4087097">string</span><span class="op" id="4087103">{</span><span class="ident" id="4087104">value</span><span class="op" id="4087109">}</span><br>
<span class="lineno"></span><span class="op" id="4087111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4087114">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="4087171">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4087202">func</span>&nbsp;<span class="op" id="4087207">(</span><span class="ident" id="4087208">v</span>&nbsp;<span class="ident" id="4087210">Values</span><span class="op" id="4087216">)</span>&nbsp;<span class="ident" id="4087218">Add</span><span class="op" id="4087221">(</span><span class="ident" id="4087222">key</span><span class="op" id="4087225">,</span>&nbsp;<span class="ident" id="4087227">value</span>&nbsp;<span class="builtintype" id="4087233">string</span><span class="op" id="4087239">)</span>&nbsp;<span class="op" id="4087241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087244">v</span><span class="op" id="4087245">[</span><span class="ident" id="4087246">key</span><span class="op" id="4087249">]</span>&nbsp;<span class="op" id="4087251">=</span>&nbsp;<span class="builtinfunc" id="4087253">append</span><span class="op" id="4087259">(</span><span class="ident" id="4087260">v</span><span class="op" id="4087261">[</span><span class="ident" id="4087262">key</span><span class="op" id="4087265">]</span><span class="op" id="4087266">,</span>&nbsp;<span class="ident" id="4087268">value</span><span class="op" id="4087273">)</span><br>
<span class="lineno"></span><span class="op" id="4087275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4087278">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4087325">func</span>&nbsp;<span class="op" id="4087330">(</span><span class="ident" id="4087331">v</span>&nbsp;<span class="ident" id="4087333">Values</span><span class="op" id="4087339">)</span>&nbsp;<span class="ident" id="4087341">Del</span><span class="op" id="4087344">(</span><span class="ident" id="4087345">key</span>&nbsp;<span class="builtintype" id="4087349">string</span><span class="op" id="4087355">)</span>&nbsp;<span class="op" id="4087357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4087360">delete</span><span class="op" id="4087366">(</span><span class="ident" id="4087367">v</span><span class="op" id="4087368">,</span>&nbsp;<span class="ident" id="4087370">key</span><span class="op" id="4087373">)</span><br>
<span class="lineno"></span><span class="op" id="4087375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4087378">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4087440">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4087492">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4087554">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4087626">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="4087650">func</span>&nbsp;<span class="ident" id="4087655">ParseQuery</span><span class="op" id="4087665">(</span><span class="ident" id="4087666">query</span>&nbsp;<span class="builtintype" id="4087672">string</span><span class="op" id="4087678">)</span>&nbsp;<span class="op" id="4087680">(</span><span class="ident" id="4087681">m</span>&nbsp;<span class="ident" id="4087683">Values</span><span class="op" id="4087689">,</span>&nbsp;<span class="ident" id="4087691">err</span>&nbsp;<span class="builtintype" id="4087695">error</span><span class="op" id="4087700">)</span>&nbsp;<span class="op" id="4087702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087705">m</span>&nbsp;<span class="op" id="4087707">=</span>&nbsp;<span class="builtinfunc" id="4087709">make</span><span class="op" id="4087713">(</span><span class="ident" id="4087714">Values</span><span class="op" id="4087720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087723">err</span>&nbsp;<span class="op" id="4087727">=</span>&nbsp;<span class="ident" id="4087729">parseQuery</span><span class="op" id="4087739">(</span><span class="ident" id="4087740">m</span><span class="op" id="4087741">,</span>&nbsp;<span class="ident" id="4087743">query</span><span class="op" id="4087748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087751">return</span><br>
<span class="lineno"></span><span class="op" id="4087758">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="4087761">func</span>&nbsp;<span class="ident" id="4087766">parseQuery</span><span class="op" id="4087776">(</span><span class="ident" id="4087777">m</span>&nbsp;<span class="ident" id="4087779">Values</span><span class="op" id="4087785">,</span>&nbsp;<span class="ident" id="4087787">query</span>&nbsp;<span class="builtintype" id="4087793">string</span><span class="op" id="4087799">)</span>&nbsp;<span class="op" id="4087801">(</span><span class="ident" id="4087802">err</span>&nbsp;<span class="builtintype" id="4087806">error</span><span class="op" id="4087811">)</span>&nbsp;<span class="op" id="4087813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087816">for</span>&nbsp;<span class="ident" id="4087820">query</span>&nbsp;<span class="op" id="4087826">!=</span>&nbsp;<span class="string" id="4087829">&#34;&#34;</span>&nbsp;<span class="op" id="4087832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087836">key</span>&nbsp;<span class="op" id="4087840">:=</span>&nbsp;<span class="ident" id="4087843">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087851">if</span>&nbsp;<span class="ident" id="4087854">i</span>&nbsp;<span class="op" id="4087856">:=</span>&nbsp;<span class="ident" id="4087859">strings</span><span class="op" id="4087866">.</span><span class="ident" id="4087867">IndexAny</span><span class="op" id="4087875">(</span><span class="ident" id="4087876">key</span><span class="op" id="4087879">,</span>&nbsp;<span class="string" id="4087881">&#34;&amp;;&#34;</span><span class="op" id="4087885">)</span><span class="op" id="4087886">;</span>&nbsp;<span class="ident" id="4087888">i</span>&nbsp;<span class="op" id="4087890">&gt;=</span>&nbsp;<span class="num" id="4087893">0</span>&nbsp;<span class="op" id="4087895">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087900">key</span><span class="op" id="4087903">,</span>&nbsp;<span class="ident" id="4087905">query</span>&nbsp;<span class="op" id="4087911">=</span>&nbsp;<span class="ident" id="4087913">key</span><span class="op" id="4087916">[</span><span class="op" id="4087917">:</span><span class="ident" id="4087918">i</span><span class="op" id="4087919">]</span><span class="op" id="4087920">,</span>&nbsp;<span class="ident" id="4087922">key</span><span class="op" id="4087925">[</span><span class="ident" id="4087926">i</span><span class="op" id="4087927">+</span><span class="num" id="4087928">1</span><span class="op" id="4087929">:</span><span class="op" id="4087930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087934">}</span>&nbsp;<span class="keyword" id="4087936">else</span>&nbsp;<span class="op" id="4087941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087946">query</span>&nbsp;<span class="op" id="4087952">=</span>&nbsp;<span class="string" id="4087954">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087963">if</span>&nbsp;<span class="ident" id="4087966">key</span>&nbsp;<span class="op" id="4087970">==</span>&nbsp;<span class="string" id="4087973">&#34;&#34;</span>&nbsp;<span class="op" id="4087976">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4087981">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4087992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4087996">value</span>&nbsp;<span class="op" id="4088002">:=</span>&nbsp;<span class="string" id="4088005">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088010">if</span>&nbsp;<span class="ident" id="4088013">i</span>&nbsp;<span class="op" id="4088015">:=</span>&nbsp;<span class="ident" id="4088018">strings</span><span class="op" id="4088025">.</span><span class="ident" id="4088026">Index</span><span class="op" id="4088031">(</span><span class="ident" id="4088032">key</span><span class="op" id="4088035">,</span>&nbsp;<span class="string" id="4088037">&#34;=&#34;</span><span class="op" id="4088040">)</span><span class="op" id="4088041">;</span>&nbsp;<span class="ident" id="4088043">i</span>&nbsp;<span class="op" id="4088045">&gt;=</span>&nbsp;<span class="num" id="4088048">0</span>&nbsp;<span class="op" id="4088050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088055">key</span><span class="op" id="4088058">,</span>&nbsp;<span class="ident" id="4088060">value</span>&nbsp;<span class="op" id="4088066">=</span>&nbsp;<span class="ident" id="4088068">key</span><span class="op" id="4088071">[</span><span class="op" id="4088072">:</span><span class="ident" id="4088073">i</span><span class="op" id="4088074">]</span><span class="op" id="4088075">,</span>&nbsp;<span class="ident" id="4088077">key</span><span class="op" id="4088080">[</span><span class="ident" id="4088081">i</span><span class="op" id="4088082">+</span><span class="num" id="4088083">1</span><span class="op" id="4088084">:</span><span class="op" id="4088085">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088093">key</span><span class="op" id="4088096">,</span>&nbsp;<span class="ident" id="4088098">err1</span>&nbsp;<span class="op" id="4088103">:=</span>&nbsp;<span class="ident" id="4088106">QueryUnescape</span><span class="op" id="4088119">(</span><span class="ident" id="4088120">key</span><span class="op" id="4088123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088127">if</span>&nbsp;<span class="ident" id="4088130">err1</span>&nbsp;<span class="op" id="4088135">!=</span>&nbsp;<span class="ident" id="4088138">nil</span>&nbsp;<span class="op" id="4088142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088147">if</span>&nbsp;<span class="ident" id="4088150">err</span>&nbsp;<span class="op" id="4088154">==</span>&nbsp;<span class="ident" id="4088157">nil</span>&nbsp;<span class="op" id="4088161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088167">err</span>&nbsp;<span class="op" id="4088171">=</span>&nbsp;<span class="ident" id="4088173">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088186">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088201">value</span><span class="op" id="4088206">,</span>&nbsp;<span class="ident" id="4088208">err1</span>&nbsp;<span class="op" id="4088213">=</span>&nbsp;<span class="ident" id="4088215">QueryUnescape</span><span class="op" id="4088228">(</span><span class="ident" id="4088229">value</span><span class="op" id="4088234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088238">if</span>&nbsp;<span class="ident" id="4088241">err1</span>&nbsp;<span class="op" id="4088246">!=</span>&nbsp;<span class="ident" id="4088249">nil</span>&nbsp;<span class="op" id="4088253">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088258">if</span>&nbsp;<span class="ident" id="4088261">err</span>&nbsp;<span class="op" id="4088265">==</span>&nbsp;<span class="ident" id="4088268">nil</span>&nbsp;<span class="op" id="4088272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088278">err</span>&nbsp;<span class="op" id="4088282">=</span>&nbsp;<span class="ident" id="4088284">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088297">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088308">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088312">m</span><span class="op" id="4088313">[</span><span class="ident" id="4088314">key</span><span class="op" id="4088317">]</span>&nbsp;<span class="op" id="4088319">=</span>&nbsp;<span class="builtinfunc" id="4088321">append</span><span class="op" id="4088327">(</span><span class="ident" id="4088328">m</span><span class="op" id="4088329">[</span><span class="ident" id="4088330">key</span><span class="op" id="4088333">]</span><span class="op" id="4088334">,</span>&nbsp;<span class="ident" id="4088336">value</span><span class="op" id="4088341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088347">return</span>&nbsp;<span class="ident" id="4088354">err</span><br>
<span class="lineno"></span><span class="op" id="4088358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="4088361">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4088416">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4088455">func</span>&nbsp;<span class="op" id="4088460">(</span><span class="ident" id="4088461">v</span>&nbsp;<span class="ident" id="4088463">Values</span><span class="op" id="4088469">)</span>&nbsp;<span class="ident" id="4088471">Encode</span><span class="op" id="4088477">(</span><span class="op" id="4088478">)</span>&nbsp;<span class="builtintype" id="4088480">string</span>&nbsp;<span class="op" id="4088487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088490">if</span>&nbsp;<span class="ident" id="4088493">v</span>&nbsp;<span class="op" id="4088495">==</span>&nbsp;<span class="ident" id="4088498">nil</span>&nbsp;<span class="op" id="4088502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088506">return</span>&nbsp;<span class="string" id="4088513">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088520">var</span>&nbsp;<span class="ident" id="4088524">buf</span>&nbsp;<span class="ident" id="4088528">bytes</span><span class="op" id="4088533">.</span><span class="ident" id="4088534">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088542">keys</span>&nbsp;<span class="op" id="4088547">:=</span>&nbsp;<span class="builtinfunc" id="4088550">make</span><span class="op" id="4088554">(</span><span class="op" id="4088555">[</span><span class="op" id="4088556">]</span><span class="builtintype" id="4088557">string</span><span class="op" id="4088563">,</span>&nbsp;<span class="num" id="4088565">0</span><span class="op" id="4088566">,</span>&nbsp;<span class="builtinfunc" id="4088568">len</span><span class="op" id="4088571">(</span><span class="ident" id="4088572">v</span><span class="op" id="4088573">)</span><span class="op" id="4088574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088577">for</span>&nbsp;<span class="ident" id="4088581">k</span>&nbsp;<span class="op" id="4088583">:=</span>&nbsp;<span class="keyword" id="4088586">range</span>&nbsp;<span class="ident" id="4088592">v</span>&nbsp;<span class="op" id="4088594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088598">keys</span>&nbsp;<span class="op" id="4088603">=</span>&nbsp;<span class="builtinfunc" id="4088605">append</span><span class="op" id="4088611">(</span><span class="ident" id="4088612">keys</span><span class="op" id="4088616">,</span>&nbsp;<span class="ident" id="4088618">k</span><span class="op" id="4088619">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088625">sort</span><span class="op" id="4088629">.</span><span class="ident" id="4088630">Strings</span><span class="op" id="4088637">(</span><span class="ident" id="4088638">keys</span><span class="op" id="4088642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088645">for</span>&nbsp;<span class="ident" id="4088649">_</span><span class="op" id="4088650">,</span>&nbsp;<span class="ident" id="4088652">k</span>&nbsp;<span class="op" id="4088654">:=</span>&nbsp;<span class="keyword" id="4088657">range</span>&nbsp;<span class="ident" id="4088663">keys</span>&nbsp;<span class="op" id="4088668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088672">vs</span>&nbsp;<span class="op" id="4088675">:=</span>&nbsp;<span class="ident" id="4088678">v</span><span class="op" id="4088679">[</span><span class="ident" id="4088680">k</span><span class="op" id="4088681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088685">prefix</span>&nbsp;<span class="op" id="4088692">:=</span>&nbsp;<span class="ident" id="4088695">QueryEscape</span><span class="op" id="4088706">(</span><span class="ident" id="4088707">k</span><span class="op" id="4088708">)</span>&nbsp;<span class="op" id="4088710">+</span>&nbsp;<span class="string" id="4088712">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088718">for</span>&nbsp;<span class="ident" id="4088722">_</span><span class="op" id="4088723">,</span>&nbsp;<span class="ident" id="4088725">v</span>&nbsp;<span class="op" id="4088727">:=</span>&nbsp;<span class="keyword" id="4088730">range</span>&nbsp;<span class="ident" id="4088736">vs</span>&nbsp;<span class="op" id="4088739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088744">if</span>&nbsp;<span class="ident" id="4088747">buf</span><span class="op" id="4088750">.</span><span class="ident" id="4088751">Len</span><span class="op" id="4088754">(</span><span class="op" id="4088755">)</span>&nbsp;<span class="op" id="4088757">&gt;</span>&nbsp;<span class="num" id="4088759">0</span>&nbsp;<span class="op" id="4088761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088767">buf</span><span class="op" id="4088770">.</span><span class="ident" id="4088771">WriteByte</span><span class="op" id="4088780">(</span><span class="string" id="4088781">&#39;&amp;&#39;</span><span class="op" id="4088784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088794">buf</span><span class="op" id="4088797">.</span><span class="ident" id="4088798">WriteString</span><span class="op" id="4088809">(</span><span class="ident" id="4088810">prefix</span><span class="op" id="4088816">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4088821">buf</span><span class="op" id="4088824">.</span><span class="ident" id="4088825">WriteString</span><span class="op" id="4088836">(</span><span class="ident" id="4088837">QueryEscape</span><span class="op" id="4088848">(</span><span class="ident" id="4088849">v</span><span class="op" id="4088850">)</span><span class="op" id="4088851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4088858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4088861">return</span>&nbsp;<span class="ident" id="4088868">buf</span><span class="op" id="4088871">.</span><span class="ident" id="4088872">String</span><span class="op" id="4088878">(</span><span class="op" id="4088879">)</span><br>
<span class="lineno"></span><span class="op" id="4088881">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="4088884">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="4088951">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="4088982">func</span>&nbsp;<span class="ident" id="4088987">resolvePath</span><span class="op" id="4088998">(</span><span class="ident" id="4088999">base</span><span class="op" id="4089003">,</span>&nbsp;<span class="ident" id="4089005">ref</span>&nbsp;<span class="builtintype" id="4089009">string</span><span class="op" id="4089015">)</span>&nbsp;<span class="builtintype" id="4089017">string</span>&nbsp;<span class="op" id="4089024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089027">var</span>&nbsp;<span class="ident" id="4089031">full</span>&nbsp;<span class="builtintype" id="4089036">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089044">if</span>&nbsp;<span class="ident" id="4089047">ref</span>&nbsp;<span class="op" id="4089051">==</span>&nbsp;<span class="string" id="4089054">&#34;&#34;</span>&nbsp;<span class="op" id="4089057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089061">full</span>&nbsp;<span class="op" id="4089066">=</span>&nbsp;<span class="ident" id="4089068">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089074">}</span>&nbsp;<span class="keyword" id="4089076">else</span>&nbsp;<span class="keyword" id="4089081">if</span>&nbsp;<span class="ident" id="4089084">ref</span><span class="op" id="4089087">[</span><span class="num" id="4089088">0</span><span class="op" id="4089089">]</span>&nbsp;<span class="op" id="4089091">!=</span>&nbsp;<span class="string" id="4089094">&#39;/&#39;</span>&nbsp;<span class="op" id="4089098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089102">i</span>&nbsp;<span class="op" id="4089104">:=</span>&nbsp;<span class="ident" id="4089107">strings</span><span class="op" id="4089114">.</span><span class="ident" id="4089115">LastIndex</span><span class="op" id="4089124">(</span><span class="ident" id="4089125">base</span><span class="op" id="4089129">,</span>&nbsp;<span class="string" id="4089131">&#34;/&#34;</span><span class="op" id="4089134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089138">full</span>&nbsp;<span class="op" id="4089143">=</span>&nbsp;<span class="ident" id="4089145">base</span><span class="op" id="4089149">[</span><span class="op" id="4089150">:</span><span class="ident" id="4089151">i</span><span class="op" id="4089152">+</span><span class="num" id="4089153">1</span><span class="op" id="4089154">]</span>&nbsp;<span class="op" id="4089156">+</span>&nbsp;<span class="ident" id="4089158">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089163">}</span>&nbsp;<span class="keyword" id="4089165">else</span>&nbsp;<span class="op" id="4089170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089174">full</span>&nbsp;<span class="op" id="4089179">=</span>&nbsp;<span class="ident" id="4089181">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089189">if</span>&nbsp;<span class="ident" id="4089192">full</span>&nbsp;<span class="op" id="4089197">==</span>&nbsp;<span class="string" id="4089200">&#34;&#34;</span>&nbsp;<span class="op" id="4089203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089207">return</span>&nbsp;<span class="string" id="4089214">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089221">var</span>&nbsp;<span class="ident" id="4089225">dst</span>&nbsp;<span class="op" id="4089229">[</span><span class="op" id="4089230">]</span><span class="builtintype" id="4089231">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089239">src</span>&nbsp;<span class="op" id="4089243">:=</span>&nbsp;<span class="ident" id="4089246">strings</span><span class="op" id="4089253">.</span><span class="ident" id="4089254">Split</span><span class="op" id="4089259">(</span><span class="ident" id="4089260">full</span><span class="op" id="4089264">,</span>&nbsp;<span class="string" id="4089266">&#34;/&#34;</span><span class="op" id="4089269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089272">for</span>&nbsp;<span class="ident" id="4089276">_</span><span class="op" id="4089277">,</span>&nbsp;<span class="ident" id="4089279">elem</span>&nbsp;<span class="op" id="4089284">:=</span>&nbsp;<span class="keyword" id="4089287">range</span>&nbsp;<span class="ident" id="4089293">src</span>&nbsp;<span class="op" id="4089297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089301">switch</span>&nbsp;<span class="ident" id="4089308">elem</span>&nbsp;<span class="op" id="4089313">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089317">case</span>&nbsp;<span class="string" id="4089322">&#34;.&#34;</span><span class="op" id="4089325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4089330">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089340">case</span>&nbsp;<span class="string" id="4089345">&#34;..&#34;</span><span class="op" id="4089349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089354">if</span>&nbsp;<span class="builtinfunc" id="4089357">len</span><span class="op" id="4089360">(</span><span class="ident" id="4089361">dst</span><span class="op" id="4089364">)</span>&nbsp;<span class="op" id="4089366">&gt;</span>&nbsp;<span class="num" id="4089368">0</span>&nbsp;<span class="op" id="4089370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089376">dst</span>&nbsp;<span class="op" id="4089380">=</span>&nbsp;<span class="ident" id="4089382">dst</span><span class="op" id="4089385">[</span><span class="op" id="4089386">:</span><span class="builtinfunc" id="4089387">len</span><span class="op" id="4089390">(</span><span class="ident" id="4089391">dst</span><span class="op" id="4089394">)</span><span class="op" id="4089395">-</span><span class="num" id="4089396">1</span><span class="op" id="4089397">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089406">default</span><span class="op" id="4089413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089418">dst</span>&nbsp;<span class="op" id="4089422">=</span>&nbsp;<span class="builtinfunc" id="4089424">append</span><span class="op" id="4089430">(</span><span class="ident" id="4089431">dst</span><span class="op" id="4089434">,</span>&nbsp;<span class="ident" id="4089436">elem</span><span class="op" id="4089440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089447">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089450">if</span>&nbsp;<span class="ident" id="4089453">last</span>&nbsp;<span class="op" id="4089458">:=</span>&nbsp;<span class="ident" id="4089461">src</span><span class="op" id="4089464">[</span><span class="builtinfunc" id="4089465">len</span><span class="op" id="4089468">(</span><span class="ident" id="4089469">src</span><span class="op" id="4089472">)</span><span class="op" id="4089473">-</span><span class="num" id="4089474">1</span><span class="op" id="4089475">]</span><span class="op" id="4089476">;</span>&nbsp;<span class="ident" id="4089478">last</span>&nbsp;<span class="op" id="4089483">==</span>&nbsp;<span class="string" id="4089486">&#34;.&#34;</span>&nbsp;<span class="op" id="4089490">||</span>&nbsp;<span class="ident" id="4089493">last</span>&nbsp;<span class="op" id="4089498">==</span>&nbsp;<span class="string" id="4089501">&#34;..&#34;</span>&nbsp;<span class="op" id="4089506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4089510">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089551">dst</span>&nbsp;<span class="op" id="4089555">=</span>&nbsp;<span class="builtinfunc" id="4089557">append</span><span class="op" id="4089563">(</span><span class="ident" id="4089564">dst</span><span class="op" id="4089567">,</span>&nbsp;<span class="string" id="4089569">&#34;&#34;</span><span class="op" id="4089571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4089574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089577">return</span>&nbsp;<span class="string" id="4089584">&#34;/&#34;</span>&nbsp;<span class="op" id="4089588">+</span>&nbsp;<span class="ident" id="4089590">strings</span><span class="op" id="4089597">.</span><span class="ident" id="4089598">TrimLeft</span><span class="op" id="4089606">(</span><span class="ident" id="4089607">strings</span><span class="op" id="4089614">.</span><span class="ident" id="4089615">Join</span><span class="op" id="4089619">(</span><span class="ident" id="4089620">dst</span><span class="op" id="4089623">,</span>&nbsp;<span class="string" id="4089625">&#34;/&#34;</span><span class="op" id="4089628">)</span><span class="op" id="4089629">,</span>&nbsp;<span class="string" id="4089631">&#34;/&#34;</span><span class="op" id="4089634">)</span><br>
<span class="lineno">640</span><span class="op" id="4089636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4089639">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="4089685">func</span>&nbsp;<span class="op" id="4089690">(</span><span class="ident" id="4089691">u</span>&nbsp;<span class="op" id="4089693">*</span><span class="ident" id="4089694">URL</span><span class="op" id="4089697">)</span>&nbsp;<span class="ident" id="4089699">IsAbs</span><span class="op" id="4089704">(</span><span class="op" id="4089705">)</span>&nbsp;<span class="builtintype" id="4089707">bool</span>&nbsp;<span class="op" id="4089712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4089715">return</span>&nbsp;<span class="ident" id="4089722">u</span><span class="op" id="4089723">.</span><span class="ident" id="4089724">Scheme</span>&nbsp;<span class="op" id="4089731">!=</span>&nbsp;<span class="string" id="4089734">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="4089737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4089740">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="4089812">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="4089877">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="4089949">func</span>&nbsp;<span class="op" id="4089954">(</span><span class="ident" id="4089955">u</span>&nbsp;<span class="op" id="4089957">*</span><span class="ident" id="4089958">URL</span><span class="op" id="4089961">)</span>&nbsp;<span class="ident" id="4089963">Parse</span><span class="op" id="4089968">(</span><span class="ident" id="4089969">ref</span>&nbsp;<span class="builtintype" id="4089973">string</span><span class="op" id="4089979">)</span>&nbsp;<span class="op" id="4089981">(</span><span class="op" id="4089982">*</span><span class="ident" id="4089983">URL</span><span class="op" id="4089986">,</span>&nbsp;<span class="builtintype" id="4089988">error</span><span class="op" id="4089993">)</span>&nbsp;<span class="op" id="4089995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4089998">refurl</span><span class="op" id="4090004">,</span>&nbsp;<span class="ident" id="4090006">err</span>&nbsp;<span class="op" id="4090010">:=</span>&nbsp;<span class="ident" id="4090013">Parse</span><span class="op" id="4090018">(</span><span class="ident" id="4090019">ref</span><span class="op" id="4090022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090025">if</span>&nbsp;<span class="ident" id="4090028">err</span>&nbsp;<span class="op" id="4090032">!=</span>&nbsp;<span class="ident" id="4090035">nil</span>&nbsp;<span class="op" id="4090039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090043">return</span>&nbsp;<span class="ident" id="4090050">nil</span><span class="op" id="4090053">,</span>&nbsp;<span class="ident" id="4090055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090060">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090063">return</span>&nbsp;<span class="ident" id="4090070">u</span><span class="op" id="4090071">.</span><span class="ident" id="4090072">ResolveReference</span><span class="op" id="4090088">(</span><span class="ident" id="4090089">refurl</span><span class="op" id="4090095">)</span><span class="op" id="4090096">,</span>&nbsp;<span class="ident" id="4090098">nil</span><br>
<span class="lineno"></span><span class="op" id="4090102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4090105">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4090174">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="4090244">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4090315">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4090384">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="4090455">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="4090498">func</span>&nbsp;<span class="op" id="4090503">(</span><span class="ident" id="4090504">u</span>&nbsp;<span class="op" id="4090506">*</span><span class="ident" id="4090507">URL</span><span class="op" id="4090510">)</span>&nbsp;<span class="ident" id="4090512">ResolveReference</span><span class="op" id="4090528">(</span><span class="ident" id="4090529">ref</span>&nbsp;<span class="op" id="4090533">*</span><span class="ident" id="4090534">URL</span><span class="op" id="4090537">)</span>&nbsp;<span class="op" id="4090539">*</span><span class="ident" id="4090540">URL</span>&nbsp;<span class="op" id="4090544">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090547">url</span>&nbsp;<span class="op" id="4090551">:=</span>&nbsp;<span class="op" id="4090554">*</span><span class="ident" id="4090555">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090560">if</span>&nbsp;<span class="ident" id="4090563">ref</span><span class="op" id="4090566">.</span><span class="ident" id="4090567">Scheme</span>&nbsp;<span class="op" id="4090574">==</span>&nbsp;<span class="string" id="4090577">&#34;&#34;</span>&nbsp;<span class="op" id="4090580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090584">url</span><span class="op" id="4090587">.</span><span class="ident" id="4090588">Scheme</span>&nbsp;<span class="op" id="4090595">=</span>&nbsp;<span class="ident" id="4090597">u</span><span class="op" id="4090598">.</span><span class="ident" id="4090599">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090610">if</span>&nbsp;<span class="ident" id="4090613">ref</span><span class="op" id="4090616">.</span><span class="ident" id="4090617">Scheme</span>&nbsp;<span class="op" id="4090624">!=</span>&nbsp;<span class="string" id="4090627">&#34;&#34;</span>&nbsp;<span class="op" id="4090630">||</span>&nbsp;<span class="ident" id="4090633">ref</span><span class="op" id="4090636">.</span><span class="ident" id="4090637">Host</span>&nbsp;<span class="op" id="4090642">!=</span>&nbsp;<span class="string" id="4090645">&#34;&#34;</span>&nbsp;<span class="op" id="4090648">||</span>&nbsp;<span class="ident" id="4090651">ref</span><span class="op" id="4090654">.</span><span class="ident" id="4090655">User</span>&nbsp;<span class="op" id="4090660">!=</span>&nbsp;<span class="ident" id="4090663">nil</span>&nbsp;<span class="op" id="4090667">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4090671">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090715">url</span><span class="op" id="4090718">.</span><span class="ident" id="4090719">Path</span>&nbsp;<span class="op" id="4090724">=</span>&nbsp;<span class="ident" id="4090726">resolvePath</span><span class="op" id="4090737">(</span><span class="ident" id="4090738">ref</span><span class="op" id="4090741">.</span><span class="ident" id="4090742">Path</span><span class="op" id="4090746">,</span>&nbsp;<span class="string" id="4090748">&#34;&#34;</span><span class="op" id="4090750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090754">return</span>&nbsp;<span class="op" id="4090761">&amp;</span><span class="ident" id="4090762">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090770">if</span>&nbsp;<span class="ident" id="4090773">ref</span><span class="op" id="4090776">.</span><span class="ident" id="4090777">Opaque</span>&nbsp;<span class="op" id="4090784">!=</span>&nbsp;<span class="string" id="4090787">&#34;&#34;</span>&nbsp;<span class="op" id="4090790">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090794">url</span><span class="op" id="4090797">.</span><span class="ident" id="4090798">User</span>&nbsp;<span class="op" id="4090803">=</span>&nbsp;<span class="ident" id="4090805">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090811">url</span><span class="op" id="4090814">.</span><span class="ident" id="4090815">Host</span>&nbsp;<span class="op" id="4090820">=</span>&nbsp;<span class="string" id="4090822">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090827">url</span><span class="op" id="4090830">.</span><span class="ident" id="4090831">Path</span>&nbsp;<span class="op" id="4090836">=</span>&nbsp;<span class="string" id="4090838">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090843">return</span>&nbsp;<span class="op" id="4090850">&amp;</span><span class="ident" id="4090851">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090856">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090859">if</span>&nbsp;<span class="ident" id="4090862">ref</span><span class="op" id="4090865">.</span><span class="ident" id="4090866">Path</span>&nbsp;<span class="op" id="4090871">==</span>&nbsp;<span class="string" id="4090874">&#34;&#34;</span>&nbsp;<span class="op" id="4090877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090881">if</span>&nbsp;<span class="ident" id="4090884">ref</span><span class="op" id="4090887">.</span><span class="ident" id="4090888">RawQuery</span>&nbsp;<span class="op" id="4090897">==</span>&nbsp;<span class="string" id="4090900">&#34;&#34;</span>&nbsp;<span class="op" id="4090903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090908">url</span><span class="op" id="4090911">.</span><span class="ident" id="4090912">RawQuery</span>&nbsp;<span class="op" id="4090921">=</span>&nbsp;<span class="ident" id="4090923">u</span><span class="op" id="4090924">.</span><span class="ident" id="4090925">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4090937">if</span>&nbsp;<span class="ident" id="4090940">ref</span><span class="op" id="4090943">.</span><span class="ident" id="4090944">Fragment</span>&nbsp;<span class="op" id="4090953">==</span>&nbsp;<span class="string" id="4090956">&#34;&#34;</span>&nbsp;<span class="op" id="4090959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4090965">url</span><span class="op" id="4090968">.</span><span class="ident" id="4090969">Fragment</span>&nbsp;<span class="op" id="4090978">=</span>&nbsp;<span class="ident" id="4090980">u</span><span class="op" id="4090981">.</span><span class="ident" id="4090982">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4090998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4091004">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091044">url</span><span class="op" id="4091047">.</span><span class="ident" id="4091048">Host</span>&nbsp;<span class="op" id="4091053">=</span>&nbsp;<span class="ident" id="4091055">u</span><span class="op" id="4091056">.</span><span class="ident" id="4091057">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091063">url</span><span class="op" id="4091066">.</span><span class="ident" id="4091067">User</span>&nbsp;<span class="op" id="4091072">=</span>&nbsp;<span class="ident" id="4091074">u</span><span class="op" id="4091075">.</span><span class="ident" id="4091076">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091082">url</span><span class="op" id="4091085">.</span><span class="ident" id="4091086">Path</span>&nbsp;<span class="op" id="4091091">=</span>&nbsp;<span class="ident" id="4091093">resolvePath</span><span class="op" id="4091104">(</span><span class="ident" id="4091105">u</span><span class="op" id="4091106">.</span><span class="ident" id="4091107">Path</span><span class="op" id="4091111">,</span>&nbsp;<span class="ident" id="4091113">ref</span><span class="op" id="4091116">.</span><span class="ident" id="4091117">Path</span><span class="op" id="4091121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091124">return</span>&nbsp;<span class="op" id="4091131">&amp;</span><span class="ident" id="4091132">url</span><br>
<span class="lineno"></span><span class="op" id="4091136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="4091139">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4091202">func</span>&nbsp;<span class="op" id="4091207">(</span><span class="ident" id="4091208">u</span>&nbsp;<span class="op" id="4091210">*</span><span class="ident" id="4091211">URL</span><span class="op" id="4091214">)</span>&nbsp;<span class="ident" id="4091216">Query</span><span class="op" id="4091221">(</span><span class="op" id="4091222">)</span>&nbsp;<span class="ident" id="4091224">Values</span>&nbsp;<span class="op" id="4091231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091234">v</span><span class="op" id="4091235">,</span>&nbsp;<span class="ident" id="4091237">_</span>&nbsp;<span class="op" id="4091239">:=</span>&nbsp;<span class="ident" id="4091242">ParseQuery</span><span class="op" id="4091252">(</span><span class="ident" id="4091253">u</span><span class="op" id="4091254">.</span><span class="ident" id="4091255">RawQuery</span><span class="op" id="4091263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091266">return</span>&nbsp;<span class="ident" id="4091273">v</span><br>
<span class="lineno"></span><span class="op" id="4091275">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="4091278">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="4091339">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="4091394">func</span>&nbsp;<span class="op" id="4091399">(</span><span class="ident" id="4091400">u</span>&nbsp;<span class="op" id="4091402">*</span><span class="ident" id="4091403">URL</span><span class="op" id="4091406">)</span>&nbsp;<span class="ident" id="4091408">RequestURI</span><span class="op" id="4091418">(</span><span class="op" id="4091419">)</span>&nbsp;<span class="builtintype" id="4091421">string</span>&nbsp;<span class="op" id="4091428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091431">result</span>&nbsp;<span class="op" id="4091438">:=</span>&nbsp;<span class="ident" id="4091441">u</span><span class="op" id="4091442">.</span><span class="ident" id="4091443">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091451">if</span>&nbsp;<span class="ident" id="4091454">result</span>&nbsp;<span class="op" id="4091461">==</span>&nbsp;<span class="string" id="4091464">&#34;&#34;</span>&nbsp;<span class="op" id="4091467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091471">result</span>&nbsp;<span class="op" id="4091478">=</span>&nbsp;<span class="ident" id="4091480">escape</span><span class="op" id="4091486">(</span><span class="ident" id="4091487">u</span><span class="op" id="4091488">.</span><span class="ident" id="4091489">Path</span><span class="op" id="4091493">,</span>&nbsp;<span class="ident" id="4091495">encodePath</span><span class="op" id="4091505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091509">if</span>&nbsp;<span class="ident" id="4091512">result</span>&nbsp;<span class="op" id="4091519">==</span>&nbsp;<span class="string" id="4091522">&#34;&#34;</span>&nbsp;<span class="op" id="4091525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091530">result</span>&nbsp;<span class="op" id="4091537">=</span>&nbsp;<span class="string" id="4091539">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091545">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091548">}</span>&nbsp;<span class="keyword" id="4091550">else</span>&nbsp;<span class="op" id="4091555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091559">if</span>&nbsp;<span class="ident" id="4091562">strings</span><span class="op" id="4091569">.</span><span class="ident" id="4091570">HasPrefix</span><span class="op" id="4091579">(</span><span class="ident" id="4091580">result</span><span class="op" id="4091586">,</span>&nbsp;<span class="string" id="4091588">&#34;//&#34;</span><span class="op" id="4091592">)</span>&nbsp;<span class="op" id="4091594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091599">result</span>&nbsp;<span class="op" id="4091606">=</span>&nbsp;<span class="ident" id="4091608">u</span><span class="op" id="4091609">.</span><span class="ident" id="4091610">Scheme</span>&nbsp;<span class="op" id="4091617">+</span>&nbsp;<span class="string" id="4091619">&#34;:&#34;</span>&nbsp;<span class="op" id="4091623">+</span>&nbsp;<span class="ident" id="4091625">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091637">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091640">if</span>&nbsp;<span class="ident" id="4091643">u</span><span class="op" id="4091644">.</span><span class="ident" id="4091645">RawQuery</span>&nbsp;<span class="op" id="4091654">!=</span>&nbsp;<span class="string" id="4091657">&#34;&#34;</span>&nbsp;<span class="op" id="4091660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4091664">result</span>&nbsp;<span class="op" id="4091671">+=</span>&nbsp;<span class="string" id="4091674">&#34;?&#34;</span>&nbsp;<span class="op" id="4091678">+</span>&nbsp;<span class="ident" id="4091680">u</span><span class="op" id="4091681">.</span><span class="ident" id="4091682">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4091692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4091695">return</span>&nbsp;<span class="ident" id="4091702">result</span><br>
<span class="lineno"></span><span class="op" id="4091709">}</span>
</div>
</body>
</html>
