<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6387570">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6387625">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6387679">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6387730">package</span>&nbsp;<span class="ident" id="6387738">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6387743">import</span>&nbsp;<span class="op" id="6387750">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387753">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387762">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387781">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387791">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387799">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387813">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6387819">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6387824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6387827">var</span>&nbsp;<span class="op" id="6387831">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387834">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387847">=</span>&nbsp;<span class="ident" id="6387849"><a href="/archive/zip/reader.go.html#6387781">errors</a></span><span class="op" id="6387855">.</span><span class="ident" id="6387856">New</span><span class="op" id="6387859">(</span><span class="string" id="6387860">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6387887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387890">ErrAlgorithm</span>&nbsp;<span class="op" id="6387903">=</span>&nbsp;<span class="ident" id="6387905"><a href="/archive/zip/reader.go.html#6387781">errors</a></span><span class="op" id="6387911">.</span><span class="ident" id="6387912">New</span><span class="op" id="6387915">(</span><span class="string" id="6387916">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6387956">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387959">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6387972">=</span>&nbsp;<span class="ident" id="6387974"><a href="/archive/zip/reader.go.html#6387781">errors</a></span><span class="op" id="6387980">.</span><span class="ident" id="6387981">New</span><span class="op" id="6387984">(</span><span class="string" id="6387985">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6388006">)</span><br>
<span class="lineno"></span><span class="op" id="6388008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388011">type</span>&nbsp;<span class="ident" id="6388016">Reader</span>&nbsp;<span class="keyword" id="6388023">struct</span>&nbsp;<span class="op" id="6388030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388033">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388041"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6388043">.</span><span class="ident" id="6388044">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388054">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388062">[</span><span class="op" id="6388063">]</span><span class="op" id="6388064">*</span><span class="ident" id="6388065"><a href="/archive/zip/reader.go.html#6388142">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388071">Comment</span>&nbsp;<span class="builtintype" id="6388079">string</span><br>
<span class="lineno"></span><span class="op" id="6388086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388089">type</span>&nbsp;<span class="ident" id="6388094">ReadCloser</span>&nbsp;<span class="keyword" id="6388105">struct</span>&nbsp;<span class="op" id="6388112">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388115">f</span>&nbsp;<span class="op" id="6388117">*</span><span class="ident" id="6388118"><a href="/archive/zip/reader.go.html#6387819">os</a></span><span class="op" id="6388120">.</span><span class="ident" id="6388121">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388127"><a href="/archive/zip/reader.go.html#6388016">Reader</a></span><br>
<span class="lineno"></span><span class="op" id="6388134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388137">type</span>&nbsp;<span class="ident" id="6388142">File</span>&nbsp;<span class="keyword" id="6388147">struct</span>&nbsp;<span class="op" id="6388154">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388157"><a href="/archive/zip/struct.go.html#6404695">FileHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388169">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388182"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6388184">.</span><span class="ident" id="6388185">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388195">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388208">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388215">headerOffset</span>&nbsp;<span class="ident" id="6388228">int64</span><br>
<span class="lineno"></span><span class="op" id="6388234">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6388237">func</span>&nbsp;<span class="op" id="6388242">(</span><span class="ident" id="6388243">f</span>&nbsp;<span class="op" id="6388245">*</span><span class="ident" id="6388246"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6388250">)</span>&nbsp;<span class="ident" id="6388252">hasDataDescriptor</span><span class="op" id="6388269">(</span><span class="op" id="6388270">)</span>&nbsp;<span class="builtintype" id="6388272">bool</span>&nbsp;<span class="op" id="6388277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388280">return</span>&nbsp;<span class="ident" id="6388287"><a href="/archive/zip/reader.go.html#6388243">f</a></span><span class="op" id="6388288">.</span><span class="ident" id="6388289">Flags</span><span class="op" id="6388294">&amp;</span><span class="num" id="6388295">0x8</span>&nbsp;<span class="op" id="6388299">!=</span>&nbsp;<span class="num" id="6388302">0</span><br>
<span class="lineno"></span><span class="op" id="6388304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6388307">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6388387">func</span>&nbsp;<span class="ident" id="6388392">OpenReader</span><span class="op" id="6388402">(</span><span class="ident" id="6388403">name</span>&nbsp;<span class="builtintype" id="6388408">string</span><span class="op" id="6388414">)</span>&nbsp;<span class="op" id="6388416">(</span><span class="op" id="6388417">*</span><span class="ident" id="6388418"><a href="/archive/zip/reader.go.html#6388094">ReadCloser</a></span><span class="op" id="6388428">,</span>&nbsp;<span class="builtintype" id="6388430">error</span><span class="op" id="6388435">)</span>&nbsp;<span class="op" id="6388437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388440">f</span><span class="op" id="6388441">,</span>&nbsp;<span class="ident" id="6388443">err</span>&nbsp;<span class="op" id="6388447">:=</span>&nbsp;<span class="ident" id="6388450"><a href="/archive/zip/reader.go.html#6387819">os</a></span><span class="op" id="6388452">.</span><span class="ident" id="6388453">Open</span><span class="op" id="6388457">(</span><span class="ident" id="6388458"><a href="/archive/zip/reader.go.html#6388403">name</a></span><span class="op" id="6388462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388465">if</span>&nbsp;<span class="ident" id="6388468"><a href="/archive/zip/reader.go.html#6388443">err</a></span>&nbsp;<span class="op" id="6388472">!=</span>&nbsp;<span class="ident" id="6388475">nil</span>&nbsp;<span class="op" id="6388479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388483">return</span>&nbsp;<span class="ident" id="6388490">nil</span><span class="op" id="6388493">,</span>&nbsp;<span class="ident" id="6388495"><a href="/archive/zip/reader.go.html#6388443">err</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388503">fi</span><span class="op" id="6388505">,</span>&nbsp;<span class="ident" id="6388507"><a href="/archive/zip/reader.go.html#6388443">err</a></span>&nbsp;<span class="op" id="6388511">:=</span>&nbsp;<span class="ident" id="6388514"><a href="/archive/zip/reader.go.html#6388440">f</a></span><span class="op" id="6388515">.</span><span class="ident" id="6388516">Stat</span><span class="op" id="6388520">(</span><span class="op" id="6388521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388524">if</span>&nbsp;<span class="ident" id="6388527"><a href="/archive/zip/reader.go.html#6388443">err</a></span>&nbsp;<span class="op" id="6388531">!=</span>&nbsp;<span class="ident" id="6388534">nil</span>&nbsp;<span class="op" id="6388538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388542"><a href="/archive/zip/reader.go.html#6388440">f</a></span><span class="op" id="6388543">.</span><span class="ident" id="6388544">Close</span><span class="op" id="6388549">(</span><span class="op" id="6388550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388554">return</span>&nbsp;<span class="ident" id="6388561">nil</span><span class="op" id="6388564">,</span>&nbsp;<span class="ident" id="6388566"><a href="/archive/zip/reader.go.html#6388443">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388574">r</span>&nbsp;<span class="op" id="6388576">:=</span>&nbsp;<span class="builtinfunc" id="6388579">new</span><span class="op" id="6388582">(</span><span class="ident" id="6388583"><a href="/archive/zip/reader.go.html#6388094">ReadCloser</a></span><span class="op" id="6388593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388596">if</span>&nbsp;<span class="ident" id="6388599">err</span>&nbsp;<span class="op" id="6388603">:=</span>&nbsp;<span class="ident" id="6388606"><a href="/archive/zip/reader.go.html#6388574">r</a></span><span class="op" id="6388607">.</span><span class="ident" id="6388608">init</span><span class="op" id="6388612">(</span><span class="ident" id="6388613"><a href="/archive/zip/reader.go.html#6388440">f</a></span><span class="op" id="6388614">,</span>&nbsp;<span class="ident" id="6388616"><a href="/archive/zip/reader.go.html#6388503">fi</a></span><span class="op" id="6388618">.</span><span class="ident" id="6388619">Size</span><span class="op" id="6388623">(</span><span class="op" id="6388624">)</span><span class="op" id="6388625">)</span><span class="op" id="6388626">;</span>&nbsp;<span class="ident" id="6388628"><a href="/archive/zip/reader.go.html#6388599">err</a></span>&nbsp;<span class="op" id="6388632">!=</span>&nbsp;<span class="ident" id="6388635">nil</span>&nbsp;<span class="op" id="6388639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388643"><a href="/archive/zip/reader.go.html#6388440">f</a></span><span class="op" id="6388644">.</span><span class="ident" id="6388645">Close</span><span class="op" id="6388650">(</span><span class="op" id="6388651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388655">return</span>&nbsp;<span class="ident" id="6388662">nil</span><span class="op" id="6388665">,</span>&nbsp;<span class="ident" id="6388667"><a href="/archive/zip/reader.go.html#6388599">err</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388675"><a href="/archive/zip/reader.go.html#6388574">r</a></span><span class="op" id="6388676">.</span><span class="ident" id="6388677">f</span>&nbsp;<span class="op" id="6388679">=</span>&nbsp;<span class="ident" id="6388681"><a href="/archive/zip/reader.go.html#6388440">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388684">return</span>&nbsp;<span class="ident" id="6388691"><a href="/archive/zip/reader.go.html#6388574">r</a></span><span class="op" id="6388692">,</span>&nbsp;<span class="ident" id="6388694">nil</span><br>
<span class="lineno"></span><span class="op" id="6388698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6388701">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6388771">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6388804">func</span>&nbsp;<span class="ident" id="6388809">NewReader</span><span class="op" id="6388818">(</span><span class="ident" id="6388819">r</span>&nbsp;<span class="ident" id="6388821"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6388823">.</span><span class="ident" id="6388824">ReaderAt</span><span class="op" id="6388832">,</span>&nbsp;<span class="ident" id="6388834">size</span>&nbsp;<span class="ident" id="6388839">int64</span><span class="op" id="6388844">)</span>&nbsp;<span class="op" id="6388846">(</span><span class="op" id="6388847">*</span><span class="ident" id="6388848"><a href="/archive/zip/reader.go.html#6388016">Reader</a></span><span class="op" id="6388854">,</span>&nbsp;<span class="builtintype" id="6388856">error</span><span class="op" id="6388861">)</span>&nbsp;<span class="op" id="6388863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388866">zr</span>&nbsp;<span class="op" id="6388869">:=</span>&nbsp;<span class="builtinfunc" id="6388872">new</span><span class="op" id="6388875">(</span><span class="ident" id="6388876"><a href="/archive/zip/reader.go.html#6388016">Reader</a></span><span class="op" id="6388882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388885">if</span>&nbsp;<span class="ident" id="6388888">err</span>&nbsp;<span class="op" id="6388892">:=</span>&nbsp;<span class="ident" id="6388895"><a href="/archive/zip/reader.go.html#6388866">zr</a></span><span class="op" id="6388897">.</span><span class="ident" id="6388898">init</span><span class="op" id="6388902">(</span><span class="ident" id="6388903"><a href="/archive/zip/reader.go.html#6388819">r</a></span><span class="op" id="6388904">,</span>&nbsp;<span class="ident" id="6388906"><a href="/archive/zip/reader.go.html#6388834">size</a></span><span class="op" id="6388910">)</span><span class="op" id="6388911">;</span>&nbsp;<span class="ident" id="6388913"><a href="/archive/zip/reader.go.html#6388888">err</a></span>&nbsp;<span class="op" id="6388917">!=</span>&nbsp;<span class="ident" id="6388920">nil</span>&nbsp;<span class="op" id="6388924">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388928">return</span>&nbsp;<span class="ident" id="6388935">nil</span><span class="op" id="6388938">,</span>&nbsp;<span class="ident" id="6388940"><a href="/archive/zip/reader.go.html#6388888">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388948">return</span>&nbsp;<span class="ident" id="6388955"><a href="/archive/zip/reader.go.html#6388866">zr</a></span><span class="op" id="6388957">,</span>&nbsp;<span class="ident" id="6388959">nil</span><br>
<span class="lineno"></span><span class="op" id="6388963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6388966">func</span>&nbsp;<span class="op" id="6388971">(</span><span class="ident" id="6388972">z</span>&nbsp;<span class="op" id="6388974">*</span><span class="ident" id="6388975"><a href="/archive/zip/reader.go.html#6388016">Reader</a></span><span class="op" id="6388981">)</span>&nbsp;<span class="ident" id="6388983">init</span><span class="op" id="6388987">(</span><span class="ident" id="6388988">r</span>&nbsp;<span class="ident" id="6388990"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6388992">.</span><span class="ident" id="6388993">ReaderAt</span><span class="op" id="6389001">,</span>&nbsp;<span class="ident" id="6389003">size</span>&nbsp;<span class="ident" id="6389008">int64</span><span class="op" id="6389013">)</span>&nbsp;<span class="builtintype" id="6389015">error</span>&nbsp;<span class="op" id="6389021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389024">end</span><span class="op" id="6389027">,</span>&nbsp;<span class="ident" id="6389029">err</span>&nbsp;<span class="op" id="6389033">:=</span>&nbsp;<span class="ident" id="6389036"><a href="/archive/zip/reader.go.html#6395988">readDirectoryEnd</a></span><span class="op" id="6389052">(</span><span class="ident" id="6389053"><a href="/archive/zip/reader.go.html#6388988">r</a></span><span class="op" id="6389054">,</span>&nbsp;<span class="ident" id="6389056"><a href="/archive/zip/reader.go.html#6389003">size</a></span><span class="op" id="6389060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389063">if</span>&nbsp;<span class="ident" id="6389066"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389070">!=</span>&nbsp;<span class="ident" id="6389073">nil</span>&nbsp;<span class="op" id="6389077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389081">return</span>&nbsp;<span class="ident" id="6389088"><a href="/archive/zip/reader.go.html#6389029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389093">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389096"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389097">.</span><span class="ident" id="6389098">r</span>&nbsp;<span class="op" id="6389100">=</span>&nbsp;<span class="ident" id="6389102"><a href="/archive/zip/reader.go.html#6388988">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389105"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389106">.</span><span class="ident" id="6389107">File</span>&nbsp;<span class="op" id="6389112">=</span>&nbsp;<span class="builtinfunc" id="6389114">make</span><span class="op" id="6389118">(</span><span class="op" id="6389119">[</span><span class="op" id="6389120">]</span><span class="op" id="6389121">*</span><span class="ident" id="6389122"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6389126">,</span>&nbsp;<span class="num" id="6389128">0</span><span class="op" id="6389129">,</span>&nbsp;<span class="ident" id="6389131"><a href="/archive/zip/reader.go.html#6389024">end</a></span><span class="op" id="6389134">.</span><span class="ident" id="6389135">directoryRecords</span><span class="op" id="6389151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389154"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389155">.</span><span class="ident" id="6389156">Comment</span>&nbsp;<span class="op" id="6389164">=</span>&nbsp;<span class="ident" id="6389166"><a href="/archive/zip/reader.go.html#6389024">end</a></span><span class="op" id="6389169">.</span><span class="ident" id="6389170">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389179">rs</span>&nbsp;<span class="op" id="6389182">:=</span>&nbsp;<span class="ident" id="6389185"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6389187">.</span><span class="ident" id="6389188">NewSectionReader</span><span class="op" id="6389204">(</span><span class="ident" id="6389205"><a href="/archive/zip/reader.go.html#6388988">r</a></span><span class="op" id="6389206">,</span>&nbsp;<span class="num" id="6389208">0</span><span class="op" id="6389209">,</span>&nbsp;<span class="ident" id="6389211"><a href="/archive/zip/reader.go.html#6389003">size</a></span><span class="op" id="6389215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389218">if</span>&nbsp;<span class="ident" id="6389221">_</span><span class="op" id="6389222">,</span>&nbsp;<span class="ident" id="6389224"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389228">=</span>&nbsp;<span class="ident" id="6389230"><a href="/archive/zip/reader.go.html#6389179">rs</a></span><span class="op" id="6389232">.</span><span class="ident" id="6389233">Seek</span><span class="op" id="6389237">(</span><span class="ident" id="6389238">int64</span><span class="op" id="6389243">(</span><span class="ident" id="6389244"><a href="/archive/zip/reader.go.html#6389024">end</a></span><span class="op" id="6389247">.</span><span class="ident" id="6389248">directoryOffset</span><span class="op" id="6389263">)</span><span class="op" id="6389264">,</span>&nbsp;<span class="ident" id="6389266"><a href="/archive/zip/reader.go.html#6387819">os</a></span><span class="op" id="6389268">.</span><span class="ident" id="6389269">SEEK_SET</span><span class="op" id="6389277">)</span><span class="op" id="6389278">;</span>&nbsp;<span class="ident" id="6389280"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389284">!=</span>&nbsp;<span class="ident" id="6389287">nil</span>&nbsp;<span class="op" id="6389291">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389295">return</span>&nbsp;<span class="ident" id="6389302"><a href="/archive/zip/reader.go.html#6389029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389310">buf</span>&nbsp;<span class="op" id="6389314">:=</span>&nbsp;<span class="ident" id="6389317"><a href="/archive/zip/reader.go.html#6387753">bufio</a></span><span class="op" id="6389322">.</span><span class="ident" id="6389323">NewReader</span><span class="op" id="6389332">(</span><span class="ident" id="6389333"><a href="/archive/zip/reader.go.html#6389179">rs</a></span><span class="op" id="6389335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389339">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389408">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389466">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389534">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389580">for</span>&nbsp;<span class="op" id="6389584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389588">f</span>&nbsp;<span class="op" id="6389590">:=</span>&nbsp;<span class="op" id="6389593">&amp;</span><span class="ident" id="6389594"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6389598">{</span><span class="ident" id="6389599">zipr</span><span class="op" id="6389603">:</span>&nbsp;<span class="ident" id="6389605"><a href="/archive/zip/reader.go.html#6388988">r</a></span><span class="op" id="6389606">,</span>&nbsp;<span class="ident" id="6389608">zipsize</span><span class="op" id="6389615">:</span>&nbsp;<span class="ident" id="6389617"><a href="/archive/zip/reader.go.html#6389003">size</a></span><span class="op" id="6389621">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389625"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389629">=</span>&nbsp;<span class="ident" id="6389631"><a href="/archive/zip/reader.go.html#6392814">readDirectoryHeader</a></span><span class="op" id="6389650">(</span><span class="ident" id="6389651"><a href="/archive/zip/reader.go.html#6389588">f</a></span><span class="op" id="6389652">,</span>&nbsp;<span class="ident" id="6389654"><a href="/archive/zip/reader.go.html#6389310">buf</a></span><span class="op" id="6389657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389661">if</span>&nbsp;<span class="ident" id="6389664"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389668">==</span>&nbsp;<span class="ident" id="6389671"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span>&nbsp;<span class="op" id="6389681">||</span>&nbsp;<span class="ident" id="6389684"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389688">==</span>&nbsp;<span class="ident" id="6389691"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6389693">.</span><span class="ident" id="6389694">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6389711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389716">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389728">if</span>&nbsp;<span class="ident" id="6389731"><a href="/archive/zip/reader.go.html#6389029">err</a></span>&nbsp;<span class="op" id="6389735">!=</span>&nbsp;<span class="ident" id="6389738">nil</span>&nbsp;<span class="op" id="6389742">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389747">return</span>&nbsp;<span class="ident" id="6389754"><a href="/archive/zip/reader.go.html#6389029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389764"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389765">.</span><span class="ident" id="6389766">File</span>&nbsp;<span class="op" id="6389771">=</span>&nbsp;<span class="builtinfunc" id="6389773">append</span><span class="op" id="6389779">(</span><span class="ident" id="6389780"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389781">.</span><span class="ident" id="6389782">File</span><span class="op" id="6389786">,</span>&nbsp;<span class="ident" id="6389788"><a href="/archive/zip/reader.go.html#6389588">f</a></span><span class="op" id="6389789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389795">if</span>&nbsp;<span class="builtintype" id="6389798">uint16</span><span class="op" id="6389804">(</span><span class="builtinfunc" id="6389805">len</span><span class="op" id="6389808">(</span><span class="ident" id="6389809"><a href="/archive/zip/reader.go.html#6388972">z</a></span><span class="op" id="6389810">.</span><span class="ident" id="6389811">File</span><span class="op" id="6389815">)</span><span class="op" id="6389816">)</span>&nbsp;<span class="op" id="6389818">!=</span>&nbsp;<span class="builtintype" id="6389821">uint16</span><span class="op" id="6389827">(</span><span class="ident" id="6389828"><a href="/archive/zip/reader.go.html#6389024">end</a></span><span class="op" id="6389831">.</span><span class="ident" id="6389832">directoryRecords</span><span class="op" id="6389848">)</span>&nbsp;<span class="op" id="6389850">{</span>&nbsp;<span class="comment" id="6389852">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389883">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389936">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389980">return</span>&nbsp;<span class="ident" id="6389987"><a href="/archive/zip/reader.go.html#6389029">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389995">return</span>&nbsp;<span class="ident" id="6390002">nil</span><br>
<span class="lineno">110</span><span class="op" id="6390006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390009">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6390070">func</span>&nbsp;<span class="op" id="6390075">(</span><span class="ident" id="6390076">rc</span>&nbsp;<span class="op" id="6390079">*</span><span class="ident" id="6390080"><a href="/archive/zip/reader.go.html#6388094">ReadCloser</a></span><span class="op" id="6390090">)</span>&nbsp;<span class="ident" id="6390092">Close</span><span class="op" id="6390097">(</span><span class="op" id="6390098">)</span>&nbsp;<span class="builtintype" id="6390100">error</span>&nbsp;<span class="op" id="6390106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390109">return</span>&nbsp;<span class="ident" id="6390116"><a href="/archive/zip/reader.go.html#6390076">rc</a></span><span class="op" id="6390118">.</span><span class="ident" id="6390119">f</span><span class="op" id="6390120">.</span><span class="ident" id="6390121">Close</span><span class="op" id="6390126">(</span><span class="op" id="6390127">)</span><br>
<span class="lineno">115</span><span class="op" id="6390129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390132">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6390199">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6390251">//</span><br>
<span class="lineno">120</span><span class="comment" id="6390254">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6390315">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6390360">func</span>&nbsp;<span class="op" id="6390365">(</span><span class="ident" id="6390366">f</span>&nbsp;<span class="op" id="6390368">*</span><span class="ident" id="6390369"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6390373">)</span>&nbsp;<span class="ident" id="6390375">DataOffset</span><span class="op" id="6390385">(</span><span class="op" id="6390386">)</span>&nbsp;<span class="op" id="6390388">(</span><span class="ident" id="6390389">offset</span>&nbsp;<span class="ident" id="6390396">int64</span><span class="op" id="6390401">,</span>&nbsp;<span class="ident" id="6390403">err</span>&nbsp;<span class="builtintype" id="6390407">error</span><span class="op" id="6390412">)</span>&nbsp;<span class="op" id="6390414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390417">bodyOffset</span><span class="op" id="6390427">,</span>&nbsp;<span class="ident" id="6390429"><a href="/archive/zip/reader.go.html#6390403">err</a></span>&nbsp;<span class="op" id="6390433">:=</span>&nbsp;<span class="ident" id="6390436"><a href="/archive/zip/reader.go.html#6390366">f</a></span><span class="op" id="6390437">.</span><span class="ident" id="6390438">findBodyOffset</span><span class="op" id="6390452">(</span><span class="op" id="6390453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390456">if</span>&nbsp;<span class="ident" id="6390459"><a href="/archive/zip/reader.go.html#6390403">err</a></span>&nbsp;<span class="op" id="6390463">!=</span>&nbsp;<span class="ident" id="6390466">nil</span>&nbsp;<span class="op" id="6390470">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390485">return</span>&nbsp;<span class="ident" id="6390492"><a href="/archive/zip/reader.go.html#6390366">f</a></span><span class="op" id="6390493">.</span><span class="ident" id="6390494">headerOffset</span>&nbsp;<span class="op" id="6390507">+</span>&nbsp;<span class="ident" id="6390509"><a href="/archive/zip/reader.go.html#6390417">bodyOffset</a></span><span class="op" id="6390519">,</span>&nbsp;<span class="ident" id="6390521">nil</span><br>
<span class="lineno"></span><span class="op" id="6390525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6390528">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6390602">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6390646">func</span>&nbsp;<span class="op" id="6390651">(</span><span class="ident" id="6390652">f</span>&nbsp;<span class="op" id="6390654">*</span><span class="ident" id="6390655"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6390659">)</span>&nbsp;<span class="ident" id="6390661">Open</span><span class="op" id="6390665">(</span><span class="op" id="6390666">)</span>&nbsp;<span class="op" id="6390668">(</span><span class="ident" id="6390669">rc</span>&nbsp;<span class="ident" id="6390672"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6390674">.</span><span class="ident" id="6390675">ReadCloser</span><span class="op" id="6390685">,</span>&nbsp;<span class="ident" id="6390687">err</span>&nbsp;<span class="builtintype" id="6390691">error</span><span class="op" id="6390696">)</span>&nbsp;<span class="op" id="6390698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390701">bodyOffset</span><span class="op" id="6390711">,</span>&nbsp;<span class="ident" id="6390713"><a href="/archive/zip/reader.go.html#6390687">err</a></span>&nbsp;<span class="op" id="6390717">:=</span>&nbsp;<span class="ident" id="6390720"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390721">.</span><span class="ident" id="6390722">findBodyOffset</span><span class="op" id="6390736">(</span><span class="op" id="6390737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390740">if</span>&nbsp;<span class="ident" id="6390743"><a href="/archive/zip/reader.go.html#6390687">err</a></span>&nbsp;<span class="op" id="6390747">!=</span>&nbsp;<span class="ident" id="6390750">nil</span>&nbsp;<span class="op" id="6390754">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390758">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390769">size</span>&nbsp;<span class="op" id="6390774">:=</span>&nbsp;<span class="ident" id="6390777">int64</span><span class="op" id="6390782">(</span><span class="ident" id="6390783"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390784">.</span><span class="ident" id="6390785">CompressedSize64</span><span class="op" id="6390801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390804">r</span>&nbsp;<span class="op" id="6390806">:=</span>&nbsp;<span class="ident" id="6390809"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6390811">.</span><span class="ident" id="6390812">NewSectionReader</span><span class="op" id="6390828">(</span><span class="ident" id="6390829"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390830">.</span><span class="ident" id="6390831">zipr</span><span class="op" id="6390835">,</span>&nbsp;<span class="ident" id="6390837"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390838">.</span><span class="ident" id="6390839">headerOffset</span><span class="op" id="6390851">+</span><span class="ident" id="6390852"><a href="/archive/zip/reader.go.html#6390701">bodyOffset</a></span><span class="op" id="6390862">,</span>&nbsp;<span class="ident" id="6390864"><a href="/archive/zip/reader.go.html#6390769">size</a></span><span class="op" id="6390868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390871">dcomp</span>&nbsp;<span class="op" id="6390877">:=</span>&nbsp;<span class="ident" id="6390880"><a href="/archive/zip/register.go.html#6402533">decompressor</a></span><span class="op" id="6390892">(</span><span class="ident" id="6390893"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390894">.</span><span class="ident" id="6390895">Method</span><span class="op" id="6390901">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390904">if</span>&nbsp;<span class="ident" id="6390907"><a href="/archive/zip/reader.go.html#6390871">dcomp</a></span>&nbsp;<span class="op" id="6390913">==</span>&nbsp;<span class="ident" id="6390916">nil</span>&nbsp;<span class="op" id="6390920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390924"><a href="/archive/zip/reader.go.html#6390687">err</a></span>&nbsp;<span class="op" id="6390928">=</span>&nbsp;<span class="ident" id="6390930"><a href="/archive/zip/reader.go.html#6387890">ErrAlgorithm</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390945">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390956"><a href="/archive/zip/reader.go.html#6390669">rc</a></span>&nbsp;<span class="op" id="6390959">=</span>&nbsp;<span class="ident" id="6390961"><a href="/archive/zip/reader.go.html#6390871">dcomp</a></span><span class="op" id="6390966">(</span><span class="ident" id="6390967"><a href="/archive/zip/reader.go.html#6390804">r</a></span><span class="op" id="6390968">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390971">var</span>&nbsp;<span class="ident" id="6390975">desr</span>&nbsp;<span class="ident" id="6390980"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6390982">.</span><span class="ident" id="6390983">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390991">if</span>&nbsp;<span class="ident" id="6390994"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6390995">.</span><span class="ident" id="6390996">hasDataDescriptor</span><span class="op" id="6391013">(</span><span class="op" id="6391014">)</span>&nbsp;<span class="op" id="6391016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391020"><a href="/archive/zip/reader.go.html#6390975">desr</a></span>&nbsp;<span class="op" id="6391025">=</span>&nbsp;<span class="ident" id="6391027"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6391029">.</span><span class="ident" id="6391030">NewSectionReader</span><span class="op" id="6391046">(</span><span class="ident" id="6391047"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6391048">.</span><span class="ident" id="6391049">zipr</span><span class="op" id="6391053">,</span>&nbsp;<span class="ident" id="6391055"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6391056">.</span><span class="ident" id="6391057">headerOffset</span><span class="op" id="6391069">+</span><span class="ident" id="6391070"><a href="/archive/zip/reader.go.html#6390701">bodyOffset</a></span><span class="op" id="6391080">+</span><span class="ident" id="6391081"><a href="/archive/zip/reader.go.html#6390769">size</a></span><span class="op" id="6391085">,</span>&nbsp;<span class="ident" id="6391087"><a href="/archive/zip/struct.go.html#6403905">dataDescriptorLen</a></span><span class="op" id="6391104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391110"><a href="/archive/zip/reader.go.html#6390669">rc</a></span>&nbsp;<span class="op" id="6391113">=</span>&nbsp;<span class="op" id="6391115">&amp;</span><span class="ident" id="6391116"><a href="/archive/zip/reader.go.html#6391182">checksumReader</a></span><span class="op" id="6391130">{</span><span class="ident" id="6391131"><a href="/archive/zip/reader.go.html#6390669">rc</a></span><span class="op" id="6391133">,</span>&nbsp;<span class="ident" id="6391135"><a href="/archive/zip/reader.go.html#6387799">crc32</a></span><span class="op" id="6391140">.</span><span class="ident" id="6391141">NewIEEE</span><span class="op" id="6391148">(</span><span class="op" id="6391149">)</span><span class="op" id="6391150">,</span>&nbsp;<span class="ident" id="6391152"><a href="/archive/zip/reader.go.html#6390652">f</a></span><span class="op" id="6391153">,</span>&nbsp;<span class="ident" id="6391155"><a href="/archive/zip/reader.go.html#6390975">desr</a></span><span class="op" id="6391159">,</span>&nbsp;<span class="ident" id="6391161">nil</span><span class="op" id="6391164">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391167">return</span><br>
<span class="lineno"></span><span class="op" id="6391174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6391177">type</span>&nbsp;<span class="ident" id="6391182">checksumReader</span>&nbsp;<span class="keyword" id="6391197">struct</span>&nbsp;<span class="op" id="6391204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391207">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6391212"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6391214">.</span><span class="ident" id="6391215">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391227">hash</span>&nbsp;<span class="ident" id="6391232"><a href="/archive/zip/reader.go.html#6387791">hash</a></span><span class="op" id="6391236">.</span><span class="ident" id="6391237">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391245">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391250">*</span><span class="ident" id="6391251"><a href="/archive/zip/reader.go.html#6388142">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391257">desr</span>&nbsp;<span class="ident" id="6391262"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6391264">.</span><span class="ident" id="6391265">Reader</span>&nbsp;<span class="comment" id="6391272">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391322">err</span>&nbsp;&nbsp;<span class="builtintype" id="6391327">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391337">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6391353">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6391356">func</span>&nbsp;<span class="op" id="6391361">(</span><span class="ident" id="6391362">r</span>&nbsp;<span class="op" id="6391364">*</span><span class="ident" id="6391365"><a href="/archive/zip/reader.go.html#6391182">checksumReader</a></span><span class="op" id="6391379">)</span>&nbsp;<span class="ident" id="6391381">Read</span><span class="op" id="6391385">(</span><span class="ident" id="6391386">b</span>&nbsp;<span class="op" id="6391388">[</span><span class="op" id="6391389">]</span><span class="builtintype" id="6391390">byte</span><span class="op" id="6391394">)</span>&nbsp;<span class="op" id="6391396">(</span><span class="ident" id="6391397">n</span>&nbsp;<span class="builtintype" id="6391399">int</span><span class="op" id="6391402">,</span>&nbsp;<span class="ident" id="6391404">err</span>&nbsp;<span class="builtintype" id="6391408">error</span><span class="op" id="6391413">)</span>&nbsp;<span class="op" id="6391415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391418">if</span>&nbsp;<span class="ident" id="6391421"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391422">.</span><span class="ident" id="6391423">err</span>&nbsp;<span class="op" id="6391427">!=</span>&nbsp;<span class="ident" id="6391430">nil</span>&nbsp;<span class="op" id="6391434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391438">return</span>&nbsp;<span class="num" id="6391445">0</span><span class="op" id="6391446">,</span>&nbsp;<span class="ident" id="6391448"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391449">.</span><span class="ident" id="6391450">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391455">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391458"><a href="/archive/zip/reader.go.html#6391397">n</a></span><span class="op" id="6391459">,</span>&nbsp;<span class="ident" id="6391461"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391465">=</span>&nbsp;<span class="ident" id="6391467"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391468">.</span><span class="ident" id="6391469">rc</span><span class="op" id="6391471">.</span><span class="ident" id="6391472">Read</span><span class="op" id="6391476">(</span><span class="ident" id="6391477"><a href="/archive/zip/reader.go.html#6391386">b</a></span><span class="op" id="6391478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391481"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391482">.</span><span class="ident" id="6391483">hash</span><span class="op" id="6391487">.</span><span class="ident" id="6391488">Write</span><span class="op" id="6391493">(</span><span class="ident" id="6391494"><a href="/archive/zip/reader.go.html#6391386">b</a></span><span class="op" id="6391495">[</span><span class="op" id="6391496">:</span><span class="ident" id="6391497"><a href="/archive/zip/reader.go.html#6391397">n</a></span><span class="op" id="6391498">]</span><span class="op" id="6391499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391502">if</span>&nbsp;<span class="ident" id="6391505"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391509">==</span>&nbsp;<span class="ident" id="6391512">nil</span>&nbsp;<span class="op" id="6391516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391528">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391531">if</span>&nbsp;<span class="ident" id="6391534"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391538">==</span>&nbsp;<span class="ident" id="6391541"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6391543">.</span><span class="ident" id="6391544">EOF</span>&nbsp;<span class="op" id="6391548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391552">if</span>&nbsp;<span class="ident" id="6391555"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391556">.</span><span class="ident" id="6391557">desr</span>&nbsp;<span class="op" id="6391562">!=</span>&nbsp;<span class="ident" id="6391565">nil</span>&nbsp;<span class="op" id="6391569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391574">if</span>&nbsp;<span class="ident" id="6391577">err1</span>&nbsp;<span class="op" id="6391582">:=</span>&nbsp;<span class="ident" id="6391585"><a href="/archive/zip/reader.go.html#6394710">readDataDescriptor</a></span><span class="op" id="6391603">(</span><span class="ident" id="6391604"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391605">.</span><span class="ident" id="6391606">desr</span><span class="op" id="6391610">,</span>&nbsp;<span class="ident" id="6391612"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391613">.</span><span class="ident" id="6391614">f</span><span class="op" id="6391615">)</span><span class="op" id="6391616">;</span>&nbsp;<span class="ident" id="6391618"><a href="/archive/zip/reader.go.html#6391577">err1</a></span>&nbsp;<span class="op" id="6391623">!=</span>&nbsp;<span class="ident" id="6391626">nil</span>&nbsp;<span class="op" id="6391630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391636"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391640">=</span>&nbsp;<span class="ident" id="6391642"><a href="/archive/zip/reader.go.html#6391577">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391650">}</span>&nbsp;<span class="keyword" id="6391652">else</span>&nbsp;<span class="keyword" id="6391657">if</span>&nbsp;<span class="ident" id="6391660"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391661">.</span><span class="ident" id="6391662">hash</span><span class="op" id="6391666">.</span><span class="ident" id="6391667">Sum32</span><span class="op" id="6391672">(</span><span class="op" id="6391673">)</span>&nbsp;<span class="op" id="6391675">!=</span>&nbsp;<span class="ident" id="6391678"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391679">.</span><span class="ident" id="6391680">f</span><span class="op" id="6391681">.</span><span class="ident" id="6391682">CRC32</span>&nbsp;<span class="op" id="6391688">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391694"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391698">=</span>&nbsp;<span class="ident" id="6391700"><a href="/archive/zip/reader.go.html#6387959">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391719">}</span>&nbsp;<span class="keyword" id="6391721">else</span>&nbsp;<span class="op" id="6391726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391731">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391788">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391847">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391898">if</span>&nbsp;<span class="ident" id="6391901"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391902">.</span><span class="ident" id="6391903">f</span><span class="op" id="6391904">.</span><span class="ident" id="6391905">CRC32</span>&nbsp;<span class="op" id="6391911">!=</span>&nbsp;<span class="num" id="6391914">0</span>&nbsp;<span class="op" id="6391916">&amp;&amp;</span>&nbsp;<span class="ident" id="6391919"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391920">.</span><span class="ident" id="6391921">hash</span><span class="op" id="6391925">.</span><span class="ident" id="6391926">Sum32</span><span class="op" id="6391931">(</span><span class="op" id="6391932">)</span>&nbsp;<span class="op" id="6391934">!=</span>&nbsp;<span class="ident" id="6391937"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391938">.</span><span class="ident" id="6391939">f</span><span class="op" id="6391940">.</span><span class="ident" id="6391941">CRC32</span>&nbsp;<span class="op" id="6391947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391953"><a href="/archive/zip/reader.go.html#6391404">err</a></span>&nbsp;<span class="op" id="6391957">=</span>&nbsp;<span class="ident" id="6391959"><a href="/archive/zip/reader.go.html#6387959">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391978">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391984"><a href="/archive/zip/reader.go.html#6391362">r</a></span><span class="op" id="6391985">.</span><span class="ident" id="6391986">err</span>&nbsp;<span class="op" id="6391990">=</span>&nbsp;<span class="ident" id="6391992"><a href="/archive/zip/reader.go.html#6391404">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391997">return</span><br>
<span class="lineno"></span><span class="op" id="6392004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6392007">func</span>&nbsp;<span class="op" id="6392012">(</span><span class="ident" id="6392013">r</span>&nbsp;<span class="op" id="6392015">*</span><span class="ident" id="6392016"><a href="/archive/zip/reader.go.html#6391182">checksumReader</a></span><span class="op" id="6392030">)</span>&nbsp;<span class="ident" id="6392032">Close</span><span class="op" id="6392037">(</span><span class="op" id="6392038">)</span>&nbsp;<span class="builtintype" id="6392040">error</span>&nbsp;<span class="op" id="6392046">{</span>&nbsp;<span class="keyword" id="6392048">return</span>&nbsp;<span class="ident" id="6392055"><a href="/archive/zip/reader.go.html#6392013">r</a></span><span class="op" id="6392056">.</span><span class="ident" id="6392057">rc</span><span class="op" id="6392059">.</span><span class="ident" id="6392060">Close</span><span class="op" id="6392065">(</span><span class="op" id="6392066">)</span>&nbsp;<span class="op" id="6392068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392071">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6392143">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6392180">func</span>&nbsp;<span class="op" id="6392185">(</span><span class="ident" id="6392186">f</span>&nbsp;<span class="op" id="6392188">*</span><span class="ident" id="6392189"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6392193">)</span>&nbsp;<span class="ident" id="6392195">findBodyOffset</span><span class="op" id="6392209">(</span><span class="op" id="6392210">)</span>&nbsp;<span class="op" id="6392212">(</span><span class="ident" id="6392213">int64</span><span class="op" id="6392218">,</span>&nbsp;<span class="builtintype" id="6392220">error</span><span class="op" id="6392225">)</span>&nbsp;<span class="op" id="6392227">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392230">var</span>&nbsp;<span class="ident" id="6392234">buf</span>&nbsp;<span class="op" id="6392238">[</span><span class="ident" id="6392239"><a href="/archive/zip/struct.go.html#6403721">fileHeaderLen</a></span><span class="op" id="6392252">]</span><span class="builtintype" id="6392253">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392259">if</span>&nbsp;<span class="ident" id="6392262">_</span><span class="op" id="6392263">,</span>&nbsp;<span class="ident" id="6392265">err</span>&nbsp;<span class="op" id="6392269">:=</span>&nbsp;<span class="ident" id="6392272"><a href="/archive/zip/reader.go.html#6392186">f</a></span><span class="op" id="6392273">.</span><span class="ident" id="6392274">zipr</span><span class="op" id="6392278">.</span><span class="ident" id="6392279">ReadAt</span><span class="op" id="6392285">(</span><span class="ident" id="6392286"><a href="/archive/zip/reader.go.html#6392234">buf</a></span><span class="op" id="6392289">[</span><span class="op" id="6392290">:</span><span class="op" id="6392291">]</span><span class="op" id="6392292">,</span>&nbsp;<span class="ident" id="6392294"><a href="/archive/zip/reader.go.html#6392186">f</a></span><span class="op" id="6392295">.</span><span class="ident" id="6392296">headerOffset</span><span class="op" id="6392308">)</span><span class="op" id="6392309">;</span>&nbsp;<span class="ident" id="6392311"><a href="/archive/zip/reader.go.html#6392265">err</a></span>&nbsp;<span class="op" id="6392315">!=</span>&nbsp;<span class="ident" id="6392318">nil</span>&nbsp;<span class="op" id="6392322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392326">return</span>&nbsp;<span class="num" id="6392333">0</span><span class="op" id="6392334">,</span>&nbsp;<span class="ident" id="6392336"><a href="/archive/zip/reader.go.html#6392265">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392344">b</span>&nbsp;<span class="op" id="6392346">:=</span>&nbsp;<span class="ident" id="6392349"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6392356">(</span><span class="ident" id="6392357"><a href="/archive/zip/reader.go.html#6392234">buf</a></span><span class="op" id="6392360">[</span><span class="op" id="6392361">:</span><span class="op" id="6392362">]</span><span class="op" id="6392363">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392366">if</span>&nbsp;<span class="ident" id="6392369">sig</span>&nbsp;<span class="op" id="6392373">:=</span>&nbsp;<span class="ident" id="6392376"><a href="/archive/zip/reader.go.html#6392344">b</a></span><span class="op" id="6392377">.</span><span class="builtintype" id="6392378">uint32</span><span class="op" id="6392384">(</span><span class="op" id="6392385">)</span><span class="op" id="6392386">;</span>&nbsp;<span class="ident" id="6392388"><a href="/archive/zip/reader.go.html#6392369">sig</a></span>&nbsp;<span class="op" id="6392392">!=</span>&nbsp;<span class="ident" id="6392395"><a href="/archive/zip/struct.go.html#6403441">fileHeaderSignature</a></span>&nbsp;<span class="op" id="6392415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392419">return</span>&nbsp;<span class="num" id="6392426">0</span><span class="op" id="6392427">,</span>&nbsp;<span class="ident" id="6392429"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392443"><a href="/archive/zip/reader.go.html#6392344">b</a></span>&nbsp;<span class="op" id="6392445">=</span>&nbsp;<span class="ident" id="6392447"><a href="/archive/zip/reader.go.html#6392344">b</a></span><span class="op" id="6392448">[</span><span class="num" id="6392449">22</span><span class="op" id="6392451">:</span><span class="op" id="6392452">]</span>&nbsp;<span class="comment" id="6392454">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392487">filenameLen</span>&nbsp;<span class="op" id="6392499">:=</span>&nbsp;<span class="builtintype" id="6392502">int</span><span class="op" id="6392505">(</span><span class="ident" id="6392506"><a href="/archive/zip/reader.go.html#6392344">b</a></span><span class="op" id="6392507">.</span><span class="builtintype" id="6392508">uint16</span><span class="op" id="6392514">(</span><span class="op" id="6392515">)</span><span class="op" id="6392516">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392519">extraLen</span>&nbsp;<span class="op" id="6392528">:=</span>&nbsp;<span class="builtintype" id="6392531">int</span><span class="op" id="6392534">(</span><span class="ident" id="6392535"><a href="/archive/zip/reader.go.html#6392344">b</a></span><span class="op" id="6392536">.</span><span class="builtintype" id="6392537">uint16</span><span class="op" id="6392543">(</span><span class="op" id="6392544">)</span><span class="op" id="6392545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392548">return</span>&nbsp;<span class="ident" id="6392555">int64</span><span class="op" id="6392560">(</span><span class="ident" id="6392561"><a href="/archive/zip/struct.go.html#6403721">fileHeaderLen</a></span>&nbsp;<span class="op" id="6392575">+</span>&nbsp;<span class="ident" id="6392577"><a href="/archive/zip/reader.go.html#6392487">filenameLen</a></span>&nbsp;<span class="op" id="6392589">+</span>&nbsp;<span class="ident" id="6392591"><a href="/archive/zip/reader.go.html#6392519">extraLen</a></span><span class="op" id="6392599">)</span><span class="op" id="6392600">,</span>&nbsp;<span class="ident" id="6392602">nil</span><br>
<span class="lineno"></span><span class="op" id="6392606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392609">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6392676">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6392747">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6392809">func</span>&nbsp;<span class="ident" id="6392814">readDirectoryHeader</span><span class="op" id="6392833">(</span><span class="ident" id="6392834">f</span>&nbsp;<span class="op" id="6392836">*</span><span class="ident" id="6392837"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6392841">,</span>&nbsp;<span class="ident" id="6392843">r</span>&nbsp;<span class="ident" id="6392845"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6392847">.</span><span class="ident" id="6392848">Reader</span><span class="op" id="6392854">)</span>&nbsp;<span class="builtintype" id="6392856">error</span>&nbsp;<span class="op" id="6392862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392865">var</span>&nbsp;<span class="ident" id="6392869">buf</span>&nbsp;<span class="op" id="6392873">[</span><span class="ident" id="6392874"><a href="/archive/zip/struct.go.html#6403782">directoryHeaderLen</a></span><span class="op" id="6392892">]</span><span class="builtintype" id="6392893">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392899">if</span>&nbsp;<span class="ident" id="6392902">_</span><span class="op" id="6392903">,</span>&nbsp;<span class="ident" id="6392905">err</span>&nbsp;<span class="op" id="6392909">:=</span>&nbsp;<span class="ident" id="6392912"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6392914">.</span><span class="ident" id="6392915">ReadFull</span><span class="op" id="6392923">(</span><span class="ident" id="6392924"><a href="/archive/zip/reader.go.html#6392843">r</a></span><span class="op" id="6392925">,</span>&nbsp;<span class="ident" id="6392927"><a href="/archive/zip/reader.go.html#6392869">buf</a></span><span class="op" id="6392930">[</span><span class="op" id="6392931">:</span><span class="op" id="6392932">]</span><span class="op" id="6392933">)</span><span class="op" id="6392934">;</span>&nbsp;<span class="ident" id="6392936"><a href="/archive/zip/reader.go.html#6392905">err</a></span>&nbsp;<span class="op" id="6392940">!=</span>&nbsp;<span class="ident" id="6392943">nil</span>&nbsp;<span class="op" id="6392947">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392951">return</span>&nbsp;<span class="ident" id="6392958"><a href="/archive/zip/reader.go.html#6392905">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392966">b</span>&nbsp;<span class="op" id="6392968">:=</span>&nbsp;<span class="ident" id="6392971"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6392978">(</span><span class="ident" id="6392979"><a href="/archive/zip/reader.go.html#6392869">buf</a></span><span class="op" id="6392982">[</span><span class="op" id="6392983">:</span><span class="op" id="6392984">]</span><span class="op" id="6392985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392988">if</span>&nbsp;<span class="ident" id="6392991">sig</span>&nbsp;<span class="op" id="6392995">:=</span>&nbsp;<span class="ident" id="6392998"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6392999">.</span><span class="builtintype" id="6393000">uint32</span><span class="op" id="6393006">(</span><span class="op" id="6393007">)</span><span class="op" id="6393008">;</span>&nbsp;<span class="ident" id="6393010"><a href="/archive/zip/reader.go.html#6392991">sig</a></span>&nbsp;<span class="op" id="6393014">!=</span>&nbsp;<span class="ident" id="6393017"><a href="/archive/zip/struct.go.html#6403480">directoryHeaderSignature</a></span>&nbsp;<span class="op" id="6393042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393046">return</span>&nbsp;<span class="ident" id="6393053"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393067"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393068">.</span><span class="ident" id="6393069">CreatorVersion</span>&nbsp;<span class="op" id="6393084">=</span>&nbsp;<span class="ident" id="6393086"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393087">.</span><span class="builtintype" id="6393088">uint16</span><span class="op" id="6393094">(</span><span class="op" id="6393095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393098"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393099">.</span><span class="ident" id="6393100">ReaderVersion</span>&nbsp;<span class="op" id="6393114">=</span>&nbsp;<span class="ident" id="6393116"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393117">.</span><span class="builtintype" id="6393118">uint16</span><span class="op" id="6393124">(</span><span class="op" id="6393125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393128"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393129">.</span><span class="ident" id="6393130">Flags</span>&nbsp;<span class="op" id="6393136">=</span>&nbsp;<span class="ident" id="6393138"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393139">.</span><span class="builtintype" id="6393140">uint16</span><span class="op" id="6393146">(</span><span class="op" id="6393147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393150"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393151">.</span><span class="ident" id="6393152">Method</span>&nbsp;<span class="op" id="6393159">=</span>&nbsp;<span class="ident" id="6393161"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393162">.</span><span class="builtintype" id="6393163">uint16</span><span class="op" id="6393169">(</span><span class="op" id="6393170">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393173"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393174">.</span><span class="ident" id="6393175">ModifiedTime</span>&nbsp;<span class="op" id="6393188">=</span>&nbsp;<span class="ident" id="6393190"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393191">.</span><span class="builtintype" id="6393192">uint16</span><span class="op" id="6393198">(</span><span class="op" id="6393199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393202"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393203">.</span><span class="ident" id="6393204">ModifiedDate</span>&nbsp;<span class="op" id="6393217">=</span>&nbsp;<span class="ident" id="6393219"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393220">.</span><span class="builtintype" id="6393221">uint16</span><span class="op" id="6393227">(</span><span class="op" id="6393228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393231"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393232">.</span><span class="ident" id="6393233">CRC32</span>&nbsp;<span class="op" id="6393239">=</span>&nbsp;<span class="ident" id="6393241"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393242">.</span><span class="builtintype" id="6393243">uint32</span><span class="op" id="6393249">(</span><span class="op" id="6393250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393253"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393254">.</span><span class="ident" id="6393255">CompressedSize</span>&nbsp;<span class="op" id="6393270">=</span>&nbsp;<span class="ident" id="6393272"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393273">.</span><span class="builtintype" id="6393274">uint32</span><span class="op" id="6393280">(</span><span class="op" id="6393281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393284"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393285">.</span><span class="ident" id="6393286">UncompressedSize</span>&nbsp;<span class="op" id="6393303">=</span>&nbsp;<span class="ident" id="6393305"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393306">.</span><span class="builtintype" id="6393307">uint32</span><span class="op" id="6393313">(</span><span class="op" id="6393314">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393317"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393318">.</span><span class="ident" id="6393319">CompressedSize64</span>&nbsp;<span class="op" id="6393336">=</span>&nbsp;<span class="ident" id="6393338">uint64</span><span class="op" id="6393344">(</span><span class="ident" id="6393345"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393346">.</span><span class="ident" id="6393347">CompressedSize</span><span class="op" id="6393361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393364"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393365">.</span><span class="ident" id="6393366">UncompressedSize64</span>&nbsp;<span class="op" id="6393385">=</span>&nbsp;<span class="ident" id="6393387">uint64</span><span class="op" id="6393393">(</span><span class="ident" id="6393394"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393395">.</span><span class="ident" id="6393396">UncompressedSize</span><span class="op" id="6393412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393415">filenameLen</span>&nbsp;<span class="op" id="6393427">:=</span>&nbsp;<span class="builtintype" id="6393430">int</span><span class="op" id="6393433">(</span><span class="ident" id="6393434"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393435">.</span><span class="builtintype" id="6393436">uint16</span><span class="op" id="6393442">(</span><span class="op" id="6393443">)</span><span class="op" id="6393444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393447">extraLen</span>&nbsp;<span class="op" id="6393456">:=</span>&nbsp;<span class="builtintype" id="6393459">int</span><span class="op" id="6393462">(</span><span class="ident" id="6393463"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393464">.</span><span class="builtintype" id="6393465">uint16</span><span class="op" id="6393471">(</span><span class="op" id="6393472">)</span><span class="op" id="6393473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393476">commentLen</span>&nbsp;<span class="op" id="6393487">:=</span>&nbsp;<span class="builtintype" id="6393490">int</span><span class="op" id="6393493">(</span><span class="ident" id="6393494"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393495">.</span><span class="builtintype" id="6393496">uint16</span><span class="op" id="6393502">(</span><span class="op" id="6393503">)</span><span class="op" id="6393504">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393507"><a href="/archive/zip/reader.go.html#6392966">b</a></span>&nbsp;<span class="op" id="6393509">=</span>&nbsp;<span class="ident" id="6393511"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393512">[</span><span class="num" id="6393513">4</span><span class="op" id="6393514">:</span><span class="op" id="6393515">]</span>&nbsp;<span class="comment" id="6393517">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393583"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393584">.</span><span class="ident" id="6393585">ExternalAttrs</span>&nbsp;<span class="op" id="6393599">=</span>&nbsp;<span class="ident" id="6393601"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393602">.</span><span class="builtintype" id="6393603">uint32</span><span class="op" id="6393609">(</span><span class="op" id="6393610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393613"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393614">.</span><span class="ident" id="6393615">headerOffset</span>&nbsp;<span class="op" id="6393628">=</span>&nbsp;<span class="ident" id="6393630">int64</span><span class="op" id="6393635">(</span><span class="ident" id="6393636"><a href="/archive/zip/reader.go.html#6392966">b</a></span><span class="op" id="6393637">.</span><span class="builtintype" id="6393638">uint32</span><span class="op" id="6393644">(</span><span class="op" id="6393645">)</span><span class="op" id="6393646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393649">d</span>&nbsp;<span class="op" id="6393651">:=</span>&nbsp;<span class="builtinfunc" id="6393654">make</span><span class="op" id="6393658">(</span><span class="op" id="6393659">[</span><span class="op" id="6393660">]</span><span class="builtintype" id="6393661">byte</span><span class="op" id="6393665">,</span>&nbsp;<span class="ident" id="6393667"><a href="/archive/zip/reader.go.html#6393415">filenameLen</a></span><span class="op" id="6393678">+</span><span class="ident" id="6393679"><a href="/archive/zip/reader.go.html#6393447">extraLen</a></span><span class="op" id="6393687">+</span><span class="ident" id="6393688"><a href="/archive/zip/reader.go.html#6393476">commentLen</a></span><span class="op" id="6393698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393701">if</span>&nbsp;<span class="ident" id="6393704">_</span><span class="op" id="6393705">,</span>&nbsp;<span class="ident" id="6393707">err</span>&nbsp;<span class="op" id="6393711">:=</span>&nbsp;<span class="ident" id="6393714"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6393716">.</span><span class="ident" id="6393717">ReadFull</span><span class="op" id="6393725">(</span><span class="ident" id="6393726"><a href="/archive/zip/reader.go.html#6392843">r</a></span><span class="op" id="6393727">,</span>&nbsp;<span class="ident" id="6393729"><a href="/archive/zip/reader.go.html#6393649">d</a></span><span class="op" id="6393730">)</span><span class="op" id="6393731">;</span>&nbsp;<span class="ident" id="6393733"><a href="/archive/zip/reader.go.html#6393707">err</a></span>&nbsp;<span class="op" id="6393737">!=</span>&nbsp;<span class="ident" id="6393740">nil</span>&nbsp;<span class="op" id="6393744">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393748">return</span>&nbsp;<span class="ident" id="6393755"><a href="/archive/zip/reader.go.html#6393707">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393763"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393764">.</span><span class="ident" id="6393765">Name</span>&nbsp;<span class="op" id="6393770">=</span>&nbsp;<span class="builtintype" id="6393772">string</span><span class="op" id="6393778">(</span><span class="ident" id="6393779"><a href="/archive/zip/reader.go.html#6393649">d</a></span><span class="op" id="6393780">[</span><span class="op" id="6393781">:</span><span class="ident" id="6393782"><a href="/archive/zip/reader.go.html#6393415">filenameLen</a></span><span class="op" id="6393793">]</span><span class="op" id="6393794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393797"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393798">.</span><span class="ident" id="6393799">Extra</span>&nbsp;<span class="op" id="6393805">=</span>&nbsp;<span class="ident" id="6393807"><a href="/archive/zip/reader.go.html#6393649">d</a></span><span class="op" id="6393808">[</span><span class="ident" id="6393809"><a href="/archive/zip/reader.go.html#6393415">filenameLen</a></span>&nbsp;<span class="op" id="6393821">:</span>&nbsp;<span class="ident" id="6393823"><a href="/archive/zip/reader.go.html#6393415">filenameLen</a></span><span class="op" id="6393834">+</span><span class="ident" id="6393835"><a href="/archive/zip/reader.go.html#6393447">extraLen</a></span><span class="op" id="6393843">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393846"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393847">.</span><span class="ident" id="6393848">Comment</span>&nbsp;<span class="op" id="6393856">=</span>&nbsp;<span class="builtintype" id="6393858">string</span><span class="op" id="6393864">(</span><span class="ident" id="6393865"><a href="/archive/zip/reader.go.html#6393649">d</a></span><span class="op" id="6393866">[</span><span class="ident" id="6393867"><a href="/archive/zip/reader.go.html#6393415">filenameLen</a></span><span class="op" id="6393878">+</span><span class="ident" id="6393879"><a href="/archive/zip/reader.go.html#6393447">extraLen</a></span><span class="op" id="6393887">:</span><span class="op" id="6393888">]</span><span class="op" id="6393889">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393893">if</span>&nbsp;<span class="builtinfunc" id="6393896">len</span><span class="op" id="6393899">(</span><span class="ident" id="6393900"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393901">.</span><span class="ident" id="6393902">Extra</span><span class="op" id="6393907">)</span>&nbsp;<span class="op" id="6393909">&gt;</span>&nbsp;<span class="num" id="6393911">0</span>&nbsp;<span class="op" id="6393913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393917">b</span>&nbsp;<span class="op" id="6393919">:=</span>&nbsp;<span class="ident" id="6393922"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6393929">(</span><span class="ident" id="6393930"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6393931">.</span><span class="ident" id="6393932">Extra</span><span class="op" id="6393937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393941">for</span>&nbsp;<span class="builtinfunc" id="6393945">len</span><span class="op" id="6393948">(</span><span class="ident" id="6393949"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6393950">)</span>&nbsp;<span class="op" id="6393952">&gt;=</span>&nbsp;<span class="num" id="6393955">4</span>&nbsp;<span class="op" id="6393957">{</span>&nbsp;<span class="comment" id="6393959">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393992">tag</span>&nbsp;<span class="op" id="6393996">:=</span>&nbsp;<span class="ident" id="6393999"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6394000">.</span><span class="builtintype" id="6394001">uint16</span><span class="op" id="6394007">(</span><span class="op" id="6394008">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394013">size</span>&nbsp;<span class="op" id="6394018">:=</span>&nbsp;<span class="ident" id="6394021"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6394022">.</span><span class="builtintype" id="6394023">uint16</span><span class="op" id="6394029">(</span><span class="op" id="6394030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394035">if</span>&nbsp;<span class="builtintype" id="6394038">int</span><span class="op" id="6394041">(</span><span class="ident" id="6394042"><a href="/archive/zip/reader.go.html#6394013">size</a></span><span class="op" id="6394046">)</span>&nbsp;<span class="op" id="6394048">&gt;</span>&nbsp;<span class="builtinfunc" id="6394050">len</span><span class="op" id="6394053">(</span><span class="ident" id="6394054"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6394055">)</span>&nbsp;<span class="op" id="6394057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394063">return</span>&nbsp;<span class="ident" id="6394070"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394088">if</span>&nbsp;<span class="ident" id="6394091"><a href="/archive/zip/reader.go.html#6393992">tag</a></span>&nbsp;<span class="op" id="6394095">==</span>&nbsp;<span class="ident" id="6394098"><a href="/archive/zip/struct.go.html#6404540">zip64ExtraId</a></span>&nbsp;<span class="op" id="6394111">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394117">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394175">eb</span>&nbsp;<span class="op" id="6394178">:=</span>&nbsp;<span class="ident" id="6394181"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6394188">(</span><span class="ident" id="6394189"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6394190">[</span><span class="op" id="6394191">:</span><span class="ident" id="6394192"><a href="/archive/zip/reader.go.html#6394013">size</a></span><span class="op" id="6394196">]</span><span class="op" id="6394197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394203">if</span>&nbsp;<span class="builtinfunc" id="6394206">len</span><span class="op" id="6394209">(</span><span class="ident" id="6394210"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394212">)</span>&nbsp;<span class="op" id="6394214">&gt;=</span>&nbsp;<span class="num" id="6394217">8</span>&nbsp;<span class="op" id="6394219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394226"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6394227">.</span><span class="ident" id="6394228">UncompressedSize64</span>&nbsp;<span class="op" id="6394247">=</span>&nbsp;<span class="ident" id="6394249"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394251">.</span><span class="ident" id="6394252">uint64</span><span class="op" id="6394258">(</span><span class="op" id="6394259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394265">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394271">if</span>&nbsp;<span class="builtinfunc" id="6394274">len</span><span class="op" id="6394277">(</span><span class="ident" id="6394278"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394280">)</span>&nbsp;<span class="op" id="6394282">&gt;=</span>&nbsp;<span class="num" id="6394285">8</span>&nbsp;<span class="op" id="6394287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394294"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6394295">.</span><span class="ident" id="6394296">CompressedSize64</span>&nbsp;<span class="op" id="6394313">=</span>&nbsp;<span class="ident" id="6394315"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394317">.</span><span class="ident" id="6394318">uint64</span><span class="op" id="6394324">(</span><span class="op" id="6394325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394337">if</span>&nbsp;<span class="builtinfunc" id="6394340">len</span><span class="op" id="6394343">(</span><span class="ident" id="6394344"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394346">)</span>&nbsp;<span class="op" id="6394348">&gt;=</span>&nbsp;<span class="num" id="6394351">8</span>&nbsp;<span class="op" id="6394353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394360"><a href="/archive/zip/reader.go.html#6392834">f</a></span><span class="op" id="6394361">.</span><span class="ident" id="6394362">headerOffset</span>&nbsp;<span class="op" id="6394375">=</span>&nbsp;<span class="ident" id="6394377">int64</span><span class="op" id="6394382">(</span><span class="ident" id="6394383"><a href="/archive/zip/reader.go.html#6394175">eb</a></span><span class="op" id="6394385">.</span><span class="ident" id="6394386">uint64</span><span class="op" id="6394392">(</span><span class="op" id="6394393">)</span><span class="op" id="6394394">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394410"><a href="/archive/zip/reader.go.html#6393917">b</a></span>&nbsp;<span class="op" id="6394412">=</span>&nbsp;<span class="ident" id="6394414"><a href="/archive/zip/reader.go.html#6393917">b</a></span><span class="op" id="6394415">[</span><span class="ident" id="6394416"><a href="/archive/zip/reader.go.html#6394013">size</a></span><span class="op" id="6394420">:</span><span class="op" id="6394421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394429">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394473">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394530">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394583">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394620">for</span>&nbsp;<span class="ident" id="6394624">_</span><span class="op" id="6394625">,</span>&nbsp;<span class="ident" id="6394627">v</span>&nbsp;<span class="op" id="6394629">:=</span>&nbsp;<span class="keyword" id="6394632">range</span>&nbsp;<span class="ident" id="6394638"><a href="/archive/zip/reader.go.html#6393917">b</a></span>&nbsp;<span class="op" id="6394640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394645">if</span>&nbsp;<span class="ident" id="6394648"><a href="/archive/zip/reader.go.html#6394627">v</a></span>&nbsp;<span class="op" id="6394650">!=</span>&nbsp;<span class="num" id="6394653">0</span>&nbsp;<span class="op" id="6394655">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394661">return</span>&nbsp;<span class="ident" id="6394668"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394691">return</span>&nbsp;<span class="ident" id="6394698">nil</span><br>
<span class="lineno">280</span><span class="op" id="6394702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6394705">func</span>&nbsp;<span class="ident" id="6394710">readDataDescriptor</span><span class="op" id="6394728">(</span><span class="ident" id="6394729">r</span>&nbsp;<span class="ident" id="6394731"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6394733">.</span><span class="ident" id="6394734">Reader</span><span class="op" id="6394740">,</span>&nbsp;<span class="ident" id="6394742">f</span>&nbsp;<span class="op" id="6394744">*</span><span class="ident" id="6394745"><a href="/archive/zip/reader.go.html#6388142">File</a></span><span class="op" id="6394749">)</span>&nbsp;<span class="builtintype" id="6394751">error</span>&nbsp;<span class="op" id="6394757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394760">var</span>&nbsp;<span class="ident" id="6394764">buf</span>&nbsp;<span class="op" id="6394768">[</span><span class="ident" id="6394769"><a href="/archive/zip/struct.go.html#6403905">dataDescriptorLen</a></span><span class="op" id="6394786">]</span><span class="builtintype" id="6394787">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394794">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394849">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394911">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394968">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395023">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395083">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395147">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395187">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395191">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395252">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395307">if</span>&nbsp;<span class="ident" id="6395310">_</span><span class="op" id="6395311">,</span>&nbsp;<span class="ident" id="6395313">err</span>&nbsp;<span class="op" id="6395317">:=</span>&nbsp;<span class="ident" id="6395320"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6395322">.</span><span class="ident" id="6395323">ReadFull</span><span class="op" id="6395331">(</span><span class="ident" id="6395332"><a href="/archive/zip/reader.go.html#6394729">r</a></span><span class="op" id="6395333">,</span>&nbsp;<span class="ident" id="6395335"><a href="/archive/zip/reader.go.html#6394764">buf</a></span><span class="op" id="6395338">[</span><span class="op" id="6395339">:</span><span class="num" id="6395340">4</span><span class="op" id="6395341">]</span><span class="op" id="6395342">)</span><span class="op" id="6395343">;</span>&nbsp;<span class="ident" id="6395345"><a href="/archive/zip/reader.go.html#6395313">err</a></span>&nbsp;<span class="op" id="6395349">!=</span>&nbsp;<span class="ident" id="6395352">nil</span>&nbsp;<span class="op" id="6395356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395360">return</span>&nbsp;<span class="ident" id="6395367"><a href="/archive/zip/reader.go.html#6395313">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395375">off</span>&nbsp;<span class="op" id="6395379">:=</span>&nbsp;<span class="num" id="6395382">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395385">maybeSig</span>&nbsp;<span class="op" id="6395394">:=</span>&nbsp;<span class="ident" id="6395397"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6395404">(</span><span class="ident" id="6395405"><a href="/archive/zip/reader.go.html#6394764">buf</a></span><span class="op" id="6395408">[</span><span class="op" id="6395409">:</span><span class="num" id="6395410">4</span><span class="op" id="6395411">]</span><span class="op" id="6395412">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395415">if</span>&nbsp;<span class="ident" id="6395418"><a href="/archive/zip/reader.go.html#6395385">maybeSig</a></span><span class="op" id="6395426">.</span><span class="builtintype" id="6395427">uint32</span><span class="op" id="6395433">(</span><span class="op" id="6395434">)</span>&nbsp;<span class="op" id="6395436">!=</span>&nbsp;<span class="ident" id="6395439"><a href="/archive/zip/struct.go.html#6403636">dataDescriptorSignature</a></span>&nbsp;<span class="op" id="6395463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395467">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395518">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395530"><a href="/archive/zip/reader.go.html#6395375">off</a></span>&nbsp;<span class="op" id="6395534">+=</span>&nbsp;<span class="num" id="6395537">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395540">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395543">if</span>&nbsp;<span class="ident" id="6395546">_</span><span class="op" id="6395547">,</span>&nbsp;<span class="ident" id="6395549">err</span>&nbsp;<span class="op" id="6395553">:=</span>&nbsp;<span class="ident" id="6395556"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6395558">.</span><span class="ident" id="6395559">ReadFull</span><span class="op" id="6395567">(</span><span class="ident" id="6395568"><a href="/archive/zip/reader.go.html#6394729">r</a></span><span class="op" id="6395569">,</span>&nbsp;<span class="ident" id="6395571"><a href="/archive/zip/reader.go.html#6394764">buf</a></span><span class="op" id="6395574">[</span><span class="ident" id="6395575"><a href="/archive/zip/reader.go.html#6395375">off</a></span><span class="op" id="6395578">:</span><span class="num" id="6395579">12</span><span class="op" id="6395581">]</span><span class="op" id="6395582">)</span><span class="op" id="6395583">;</span>&nbsp;<span class="ident" id="6395585"><a href="/archive/zip/reader.go.html#6395549">err</a></span>&nbsp;<span class="op" id="6395589">!=</span>&nbsp;<span class="ident" id="6395592">nil</span>&nbsp;<span class="op" id="6395596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395600">return</span>&nbsp;<span class="ident" id="6395607"><a href="/archive/zip/reader.go.html#6395549">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395615">b</span>&nbsp;<span class="op" id="6395617">:=</span>&nbsp;<span class="ident" id="6395620"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6395627">(</span><span class="ident" id="6395628"><a href="/archive/zip/reader.go.html#6394764">buf</a></span><span class="op" id="6395631">[</span><span class="op" id="6395632">:</span><span class="num" id="6395633">12</span><span class="op" id="6395635">]</span><span class="op" id="6395636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395639">if</span>&nbsp;<span class="ident" id="6395642"><a href="/archive/zip/reader.go.html#6395615">b</a></span><span class="op" id="6395643">.</span><span class="builtintype" id="6395644">uint32</span><span class="op" id="6395650">(</span><span class="op" id="6395651">)</span>&nbsp;<span class="op" id="6395653">!=</span>&nbsp;<span class="ident" id="6395656"><a href="/archive/zip/reader.go.html#6394742">f</a></span><span class="op" id="6395657">.</span><span class="ident" id="6395658">CRC32</span>&nbsp;<span class="op" id="6395664">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395668">return</span>&nbsp;<span class="ident" id="6395675"><a href="/archive/zip/reader.go.html#6387959">ErrChecksum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395692">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395760">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395817">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395881">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395945">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395969">return</span>&nbsp;<span class="ident" id="6395976">nil</span><br>
<span class="lineno">320</span><span class="op" id="6395980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6395983">func</span>&nbsp;<span class="ident" id="6395988">readDirectoryEnd</span><span class="op" id="6396004">(</span><span class="ident" id="6396005">r</span>&nbsp;<span class="ident" id="6396007"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6396009">.</span><span class="ident" id="6396010">ReaderAt</span><span class="op" id="6396018">,</span>&nbsp;<span class="ident" id="6396020">size</span>&nbsp;<span class="ident" id="6396025">int64</span><span class="op" id="6396030">)</span>&nbsp;<span class="op" id="6396032">(</span><span class="ident" id="6396033">dir</span>&nbsp;<span class="op" id="6396037">*</span><span class="ident" id="6396038"><a href="/archive/zip/struct.go.html#6406835">directoryEnd</a></span><span class="op" id="6396050">,</span>&nbsp;<span class="ident" id="6396052">err</span>&nbsp;<span class="builtintype" id="6396056">error</span><span class="op" id="6396061">)</span>&nbsp;<span class="op" id="6396063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396066">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396138">var</span>&nbsp;<span class="ident" id="6396142">buf</span>&nbsp;<span class="op" id="6396146">[</span><span class="op" id="6396147">]</span><span class="builtintype" id="6396148">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396154">var</span>&nbsp;<span class="ident" id="6396158">directoryEndOffset</span>&nbsp;<span class="ident" id="6396177">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396184">for</span>&nbsp;<span class="ident" id="6396188">i</span><span class="op" id="6396189">,</span>&nbsp;<span class="ident" id="6396191">bLen</span>&nbsp;<span class="op" id="6396196">:=</span>&nbsp;<span class="keyword" id="6396199">range</span>&nbsp;<span class="op" id="6396205">[</span><span class="op" id="6396206">]</span><span class="ident" id="6396207">int64</span><span class="op" id="6396212">{</span><span class="num" id="6396213">1024</span><span class="op" id="6396217">,</span>&nbsp;<span class="num" id="6396219">65</span>&nbsp;<span class="op" id="6396222">*</span>&nbsp;<span class="num" id="6396224">1024</span><span class="op" id="6396228">}</span>&nbsp;<span class="op" id="6396230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396234">if</span>&nbsp;<span class="ident" id="6396237"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span>&nbsp;<span class="op" id="6396242">&gt;</span>&nbsp;<span class="ident" id="6396244"><a href="/archive/zip/reader.go.html#6396020">size</a></span>&nbsp;<span class="op" id="6396249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396254"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span>&nbsp;<span class="op" id="6396259">=</span>&nbsp;<span class="ident" id="6396261"><a href="/archive/zip/reader.go.html#6396020">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396268">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396272"><a href="/archive/zip/reader.go.html#6396142">buf</a></span>&nbsp;<span class="op" id="6396276">=</span>&nbsp;<span class="builtinfunc" id="6396278">make</span><span class="op" id="6396282">(</span><span class="op" id="6396283">[</span><span class="op" id="6396284">]</span><span class="builtintype" id="6396285">byte</span><span class="op" id="6396289">,</span>&nbsp;<span class="builtintype" id="6396291">int</span><span class="op" id="6396294">(</span><span class="ident" id="6396295"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span><span class="op" id="6396299">)</span><span class="op" id="6396300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396304">if</span>&nbsp;<span class="ident" id="6396307">_</span><span class="op" id="6396308">,</span>&nbsp;<span class="ident" id="6396310">err</span>&nbsp;<span class="op" id="6396314">:=</span>&nbsp;<span class="ident" id="6396317"><a href="/archive/zip/reader.go.html#6396005">r</a></span><span class="op" id="6396318">.</span><span class="ident" id="6396319">ReadAt</span><span class="op" id="6396325">(</span><span class="ident" id="6396326"><a href="/archive/zip/reader.go.html#6396142">buf</a></span><span class="op" id="6396329">,</span>&nbsp;<span class="ident" id="6396331"><a href="/archive/zip/reader.go.html#6396020">size</a></span><span class="op" id="6396335">-</span><span class="ident" id="6396336"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span><span class="op" id="6396340">)</span><span class="op" id="6396341">;</span>&nbsp;<span class="ident" id="6396343"><a href="/archive/zip/reader.go.html#6396310">err</a></span>&nbsp;<span class="op" id="6396347">!=</span>&nbsp;<span class="ident" id="6396350">nil</span>&nbsp;<span class="op" id="6396354">&amp;&amp;</span>&nbsp;<span class="ident" id="6396357"><a href="/archive/zip/reader.go.html#6396310">err</a></span>&nbsp;<span class="op" id="6396361">!=</span>&nbsp;<span class="ident" id="6396364"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6396366">.</span><span class="ident" id="6396367">EOF</span>&nbsp;<span class="op" id="6396371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396376">return</span>&nbsp;<span class="ident" id="6396383">nil</span><span class="op" id="6396386">,</span>&nbsp;<span class="ident" id="6396388"><a href="/archive/zip/reader.go.html#6396310">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396398">if</span>&nbsp;<span class="ident" id="6396401">p</span>&nbsp;<span class="op" id="6396403">:=</span>&nbsp;<span class="ident" id="6396406"><a href="/archive/zip/reader.go.html#6399255">findSignatureInBlock</a></span><span class="op" id="6396426">(</span><span class="ident" id="6396427"><a href="/archive/zip/reader.go.html#6396142">buf</a></span><span class="op" id="6396430">)</span><span class="op" id="6396431">;</span>&nbsp;<span class="ident" id="6396433"><a href="/archive/zip/reader.go.html#6396401">p</a></span>&nbsp;<span class="op" id="6396435">&gt;=</span>&nbsp;<span class="num" id="6396438">0</span>&nbsp;<span class="op" id="6396440">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396445"><a href="/archive/zip/reader.go.html#6396142">buf</a></span>&nbsp;<span class="op" id="6396449">=</span>&nbsp;<span class="ident" id="6396451"><a href="/archive/zip/reader.go.html#6396142">buf</a></span><span class="op" id="6396454">[</span><span class="ident" id="6396455"><a href="/archive/zip/reader.go.html#6396401">p</a></span><span class="op" id="6396456">:</span><span class="op" id="6396457">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396462"><a href="/archive/zip/reader.go.html#6396158">directoryEndOffset</a></span>&nbsp;<span class="op" id="6396481">=</span>&nbsp;<span class="ident" id="6396483"><a href="/archive/zip/reader.go.html#6396020">size</a></span>&nbsp;<span class="op" id="6396488">-</span>&nbsp;<span class="ident" id="6396490"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span>&nbsp;<span class="op" id="6396495">+</span>&nbsp;<span class="ident" id="6396497">int64</span><span class="op" id="6396502">(</span><span class="ident" id="6396503"><a href="/archive/zip/reader.go.html#6396401">p</a></span><span class="op" id="6396504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396509">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396521">if</span>&nbsp;<span class="ident" id="6396524"><a href="/archive/zip/reader.go.html#6396188">i</a></span>&nbsp;<span class="op" id="6396526">==</span>&nbsp;<span class="num" id="6396529">1</span>&nbsp;<span class="op" id="6396531">||</span>&nbsp;<span class="ident" id="6396534"><a href="/archive/zip/reader.go.html#6396191">bLen</a></span>&nbsp;<span class="op" id="6396539">==</span>&nbsp;<span class="ident" id="6396542"><a href="/archive/zip/reader.go.html#6396020">size</a></span>&nbsp;<span class="op" id="6396547">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396552">return</span>&nbsp;<span class="ident" id="6396559">nil</span><span class="op" id="6396562">,</span>&nbsp;<span class="ident" id="6396564"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396583">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396611">b</span>&nbsp;<span class="op" id="6396613">:=</span>&nbsp;<span class="ident" id="6396616"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6396623">(</span><span class="ident" id="6396624"><a href="/archive/zip/reader.go.html#6396142">buf</a></span><span class="op" id="6396627">[</span><span class="num" id="6396628">4</span><span class="op" id="6396629">:</span><span class="op" id="6396630">]</span><span class="op" id="6396631">)</span>&nbsp;<span class="comment" id="6396633">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396652">d</span>&nbsp;<span class="op" id="6396654">:=</span>&nbsp;<span class="op" id="6396657">&amp;</span><span class="ident" id="6396658"><a href="/archive/zip/struct.go.html#6406835">directoryEnd</a></span><span class="op" id="6396670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396674">diskNbr</span><span class="op" id="6396681">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6396694">uint32</span><span class="op" id="6396700">(</span><span class="ident" id="6396701"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396702">.</span><span class="builtintype" id="6396703">uint16</span><span class="op" id="6396709">(</span><span class="op" id="6396710">)</span><span class="op" id="6396711">)</span><span class="op" id="6396712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396716">dirDiskNbr</span><span class="op" id="6396726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6396736">uint32</span><span class="op" id="6396742">(</span><span class="ident" id="6396743"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396744">.</span><span class="builtintype" id="6396745">uint16</span><span class="op" id="6396751">(</span><span class="op" id="6396752">)</span><span class="op" id="6396753">)</span><span class="op" id="6396754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396758">dirRecordsThisDisk</span><span class="op" id="6396776">:</span>&nbsp;<span class="ident" id="6396778">uint64</span><span class="op" id="6396784">(</span><span class="ident" id="6396785"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396786">.</span><span class="builtintype" id="6396787">uint16</span><span class="op" id="6396793">(</span><span class="op" id="6396794">)</span><span class="op" id="6396795">)</span><span class="op" id="6396796">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396800">directoryRecords</span><span class="op" id="6396816">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6396820">uint64</span><span class="op" id="6396826">(</span><span class="ident" id="6396827"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396828">.</span><span class="builtintype" id="6396829">uint16</span><span class="op" id="6396835">(</span><span class="op" id="6396836">)</span><span class="op" id="6396837">)</span><span class="op" id="6396838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396842">directorySize</span><span class="op" id="6396855">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396862">uint64</span><span class="op" id="6396868">(</span><span class="ident" id="6396869"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396870">.</span><span class="builtintype" id="6396871">uint32</span><span class="op" id="6396877">(</span><span class="op" id="6396878">)</span><span class="op" id="6396879">)</span><span class="op" id="6396880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396884">directoryOffset</span><span class="op" id="6396899">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396904">uint64</span><span class="op" id="6396910">(</span><span class="ident" id="6396911"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396912">.</span><span class="builtintype" id="6396913">uint32</span><span class="op" id="6396919">(</span><span class="op" id="6396920">)</span><span class="op" id="6396921">)</span><span class="op" id="6396922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396926">commentLen</span><span class="op" id="6396936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396946"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396947">.</span><span class="builtintype" id="6396948">uint16</span><span class="op" id="6396954">(</span><span class="op" id="6396955">)</span><span class="op" id="6396956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396959">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396962">l</span>&nbsp;<span class="op" id="6396964">:=</span>&nbsp;<span class="builtintype" id="6396967">int</span><span class="op" id="6396970">(</span><span class="ident" id="6396971"><a href="/archive/zip/reader.go.html#6396652">d</a></span><span class="op" id="6396972">.</span><span class="ident" id="6396973">commentLen</span><span class="op" id="6396983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396986">if</span>&nbsp;<span class="ident" id="6396989"><a href="/archive/zip/reader.go.html#6396962">l</a></span>&nbsp;<span class="op" id="6396991">&gt;</span>&nbsp;<span class="builtinfunc" id="6396993">len</span><span class="op" id="6396996">(</span><span class="ident" id="6396997"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6396998">)</span>&nbsp;<span class="op" id="6397000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397004">return</span>&nbsp;<span class="ident" id="6397011">nil</span><span class="op" id="6397014">,</span>&nbsp;<span class="ident" id="6397016"><a href="/archive/zip/reader.go.html#6387781">errors</a></span><span class="op" id="6397022">.</span><span class="ident" id="6397023">New</span><span class="op" id="6397026">(</span><span class="string" id="6397027">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6397056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397062"><a href="/archive/zip/reader.go.html#6396652">d</a></span><span class="op" id="6397063">.</span><span class="ident" id="6397064">comment</span>&nbsp;<span class="op" id="6397072">=</span>&nbsp;<span class="builtintype" id="6397074">string</span><span class="op" id="6397080">(</span><span class="ident" id="6397081"><a href="/archive/zip/reader.go.html#6396611">b</a></span><span class="op" id="6397082">[</span><span class="op" id="6397083">:</span><span class="ident" id="6397084"><a href="/archive/zip/reader.go.html#6396962">l</a></span><span class="op" id="6397085">]</span><span class="op" id="6397086">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397090">p</span><span class="op" id="6397091">,</span>&nbsp;<span class="ident" id="6397093"><a href="/archive/zip/reader.go.html#6396052">err</a></span>&nbsp;<span class="op" id="6397097">:=</span>&nbsp;<span class="ident" id="6397100"><a href="/archive/zip/reader.go.html#6397566">findDirectory64End</a></span><span class="op" id="6397118">(</span><span class="ident" id="6397119"><a href="/archive/zip/reader.go.html#6396005">r</a></span><span class="op" id="6397120">,</span>&nbsp;<span class="ident" id="6397122"><a href="/archive/zip/reader.go.html#6396158">directoryEndOffset</a></span><span class="op" id="6397140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397143">if</span>&nbsp;<span class="ident" id="6397146"><a href="/archive/zip/reader.go.html#6396052">err</a></span>&nbsp;<span class="op" id="6397150">==</span>&nbsp;<span class="ident" id="6397153">nil</span>&nbsp;<span class="op" id="6397157">&amp;&amp;</span>&nbsp;<span class="ident" id="6397160"><a href="/archive/zip/reader.go.html#6397090">p</a></span>&nbsp;<span class="op" id="6397162">&gt;=</span>&nbsp;<span class="num" id="6397165">0</span>&nbsp;<span class="op" id="6397167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397171"><a href="/archive/zip/reader.go.html#6396052">err</a></span>&nbsp;<span class="op" id="6397175">=</span>&nbsp;<span class="ident" id="6397177"><a href="/archive/zip/reader.go.html#6398323">readDirectory64End</a></span><span class="op" id="6397195">(</span><span class="ident" id="6397196"><a href="/archive/zip/reader.go.html#6396005">r</a></span><span class="op" id="6397197">,</span>&nbsp;<span class="ident" id="6397199"><a href="/archive/zip/reader.go.html#6397090">p</a></span><span class="op" id="6397200">,</span>&nbsp;<span class="ident" id="6397202"><a href="/archive/zip/reader.go.html#6396652">d</a></span><span class="op" id="6397203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397206">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397209">if</span>&nbsp;<span class="ident" id="6397212"><a href="/archive/zip/reader.go.html#6396052">err</a></span>&nbsp;<span class="op" id="6397216">!=</span>&nbsp;<span class="ident" id="6397219">nil</span>&nbsp;<span class="op" id="6397223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397227">return</span>&nbsp;<span class="ident" id="6397234">nil</span><span class="op" id="6397237">,</span>&nbsp;<span class="ident" id="6397239"><a href="/archive/zip/reader.go.html#6396052">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397248">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397311">if</span>&nbsp;<span class="ident" id="6397314">o</span>&nbsp;<span class="op" id="6397316">:=</span>&nbsp;<span class="ident" id="6397319">int64</span><span class="op" id="6397324">(</span><span class="ident" id="6397325"><a href="/archive/zip/reader.go.html#6396652">d</a></span><span class="op" id="6397326">.</span><span class="ident" id="6397327">directoryOffset</span><span class="op" id="6397342">)</span><span class="op" id="6397343">;</span>&nbsp;<span class="ident" id="6397345"><a href="/archive/zip/reader.go.html#6397314">o</a></span>&nbsp;<span class="op" id="6397347">&lt;</span>&nbsp;<span class="num" id="6397349">0</span>&nbsp;<span class="op" id="6397351">||</span>&nbsp;<span class="ident" id="6397354"><a href="/archive/zip/reader.go.html#6397314">o</a></span>&nbsp;<span class="op" id="6397356">&gt;=</span>&nbsp;<span class="ident" id="6397359"><a href="/archive/zip/reader.go.html#6396020">size</a></span>&nbsp;<span class="op" id="6397364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397368">return</span>&nbsp;<span class="ident" id="6397375">nil</span><span class="op" id="6397378">,</span>&nbsp;<span class="ident" id="6397380"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397394">return</span>&nbsp;<span class="ident" id="6397401"><a href="/archive/zip/reader.go.html#6396652">d</a></span><span class="op" id="6397402">,</span>&nbsp;<span class="ident" id="6397404">nil</span><br>
<span class="lineno"></span><span class="op" id="6397408">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6397411">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6397481">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6397551">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6397561">func</span>&nbsp;<span class="ident" id="6397566">findDirectory64End</span><span class="op" id="6397584">(</span><span class="ident" id="6397585">r</span>&nbsp;<span class="ident" id="6397587"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6397589">.</span><span class="ident" id="6397590">ReaderAt</span><span class="op" id="6397598">,</span>&nbsp;<span class="ident" id="6397600">directoryEndOffset</span>&nbsp;<span class="ident" id="6397619">int64</span><span class="op" id="6397624">)</span>&nbsp;<span class="op" id="6397626">(</span><span class="ident" id="6397627">int64</span><span class="op" id="6397632">,</span>&nbsp;<span class="builtintype" id="6397634">error</span><span class="op" id="6397639">)</span>&nbsp;<span class="op" id="6397641">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397644">locOffset</span>&nbsp;<span class="op" id="6397654">:=</span>&nbsp;<span class="ident" id="6397657"><a href="/archive/zip/reader.go.html#6397600">directoryEndOffset</a></span>&nbsp;<span class="op" id="6397676">-</span>&nbsp;<span class="ident" id="6397678"><a href="/archive/zip/struct.go.html#6404082">directory64LocLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397697">if</span>&nbsp;<span class="ident" id="6397700"><a href="/archive/zip/reader.go.html#6397644">locOffset</a></span>&nbsp;<span class="op" id="6397710">&lt;</span>&nbsp;<span class="num" id="6397712">0</span>&nbsp;<span class="op" id="6397714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397718">return</span>&nbsp;<span class="op" id="6397725">-</span><span class="num" id="6397726">1</span><span class="op" id="6397727">,</span>&nbsp;<span class="ident" id="6397729">nil</span>&nbsp;<span class="comment" id="6397733">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397786">buf</span>&nbsp;<span class="op" id="6397790">:=</span>&nbsp;<span class="builtinfunc" id="6397793">make</span><span class="op" id="6397797">(</span><span class="op" id="6397798">[</span><span class="op" id="6397799">]</span><span class="builtintype" id="6397800">byte</span><span class="op" id="6397804">,</span>&nbsp;<span class="ident" id="6397806"><a href="/archive/zip/struct.go.html#6404082">directory64LocLen</a></span><span class="op" id="6397823">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397826">if</span>&nbsp;<span class="ident" id="6397829">_</span><span class="op" id="6397830">,</span>&nbsp;<span class="ident" id="6397832">err</span>&nbsp;<span class="op" id="6397836">:=</span>&nbsp;<span class="ident" id="6397839"><a href="/archive/zip/reader.go.html#6397585">r</a></span><span class="op" id="6397840">.</span><span class="ident" id="6397841">ReadAt</span><span class="op" id="6397847">(</span><span class="ident" id="6397848"><a href="/archive/zip/reader.go.html#6397786">buf</a></span><span class="op" id="6397851">,</span>&nbsp;<span class="ident" id="6397853"><a href="/archive/zip/reader.go.html#6397644">locOffset</a></span><span class="op" id="6397862">)</span><span class="op" id="6397863">;</span>&nbsp;<span class="ident" id="6397865"><a href="/archive/zip/reader.go.html#6397832">err</a></span>&nbsp;<span class="op" id="6397869">!=</span>&nbsp;<span class="ident" id="6397872">nil</span>&nbsp;<span class="op" id="6397876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397880">return</span>&nbsp;<span class="op" id="6397887">-</span><span class="num" id="6397888">1</span><span class="op" id="6397889">,</span>&nbsp;<span class="ident" id="6397891"><a href="/archive/zip/reader.go.html#6397832">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397899">b</span>&nbsp;<span class="op" id="6397901">:=</span>&nbsp;<span class="ident" id="6397904"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6397911">(</span><span class="ident" id="6397912"><a href="/archive/zip/reader.go.html#6397786">buf</a></span><span class="op" id="6397915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397918">if</span>&nbsp;<span class="ident" id="6397921">sig</span>&nbsp;<span class="op" id="6397925">:=</span>&nbsp;<span class="ident" id="6397928"><a href="/archive/zip/reader.go.html#6397899">b</a></span><span class="op" id="6397929">.</span><span class="builtintype" id="6397930">uint32</span><span class="op" id="6397936">(</span><span class="op" id="6397937">)</span><span class="op" id="6397938">;</span>&nbsp;<span class="ident" id="6397940"><a href="/archive/zip/reader.go.html#6397921">sig</a></span>&nbsp;<span class="op" id="6397944">!=</span>&nbsp;<span class="ident" id="6397947"><a href="/archive/zip/struct.go.html#6403558">directory64LocSignature</a></span>&nbsp;<span class="op" id="6397971">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397975">return</span>&nbsp;<span class="op" id="6397982">-</span><span class="num" id="6397983">1</span><span class="op" id="6397984">,</span>&nbsp;<span class="ident" id="6397986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397994"><a href="/archive/zip/reader.go.html#6397899">b</a></span>&nbsp;<span class="op" id="6397996">=</span>&nbsp;<span class="ident" id="6397998"><a href="/archive/zip/reader.go.html#6397899">b</a></span><span class="op" id="6397999">[</span><span class="num" id="6398000">4</span><span class="op" id="6398001">:</span><span class="op" id="6398002">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398010">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398091">p</span>&nbsp;<span class="op" id="6398093">:=</span>&nbsp;<span class="ident" id="6398096"><a href="/archive/zip/reader.go.html#6397899">b</a></span><span class="op" id="6398097">.</span><span class="ident" id="6398098">uint64</span><span class="op" id="6398104">(</span><span class="op" id="6398105">)</span>&nbsp;<span class="comment" id="6398107">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398172">return</span>&nbsp;<span class="ident" id="6398179">int64</span><span class="op" id="6398184">(</span><span class="ident" id="6398185"><a href="/archive/zip/reader.go.html#6398091">p</a></span><span class="op" id="6398186">)</span><span class="op" id="6398187">,</span>&nbsp;<span class="ident" id="6398189">nil</span><br>
<span class="lineno">395</span><span class="op" id="6398193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398196">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6398264">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6398318">func</span>&nbsp;<span class="ident" id="6398323">readDirectory64End</span><span class="op" id="6398341">(</span><span class="ident" id="6398342">r</span>&nbsp;<span class="ident" id="6398344"><a href="/archive/zip/reader.go.html#6387813">io</a></span><span class="op" id="6398346">.</span><span class="ident" id="6398347">ReaderAt</span><span class="op" id="6398355">,</span>&nbsp;<span class="ident" id="6398357">offset</span>&nbsp;<span class="ident" id="6398364">int64</span><span class="op" id="6398369">,</span>&nbsp;<span class="ident" id="6398371">d</span>&nbsp;<span class="op" id="6398373">*</span><span class="ident" id="6398374"><a href="/archive/zip/struct.go.html#6406835">directoryEnd</a></span><span class="op" id="6398386">)</span>&nbsp;<span class="op" id="6398388">(</span><span class="ident" id="6398389">err</span>&nbsp;<span class="builtintype" id="6398393">error</span><span class="op" id="6398398">)</span>&nbsp;<span class="op" id="6398400">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398403">buf</span>&nbsp;<span class="op" id="6398407">:=</span>&nbsp;<span class="builtinfunc" id="6398410">make</span><span class="op" id="6398414">(</span><span class="op" id="6398415">[</span><span class="op" id="6398416">]</span><span class="builtintype" id="6398417">byte</span><span class="op" id="6398421">,</span>&nbsp;<span class="ident" id="6398423"><a href="/archive/zip/struct.go.html#6404124">directory64EndLen</a></span><span class="op" id="6398440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398443">if</span>&nbsp;<span class="ident" id="6398446">_</span><span class="op" id="6398447">,</span>&nbsp;<span class="ident" id="6398449">err</span>&nbsp;<span class="op" id="6398453">:=</span>&nbsp;<span class="ident" id="6398456"><a href="/archive/zip/reader.go.html#6398342">r</a></span><span class="op" id="6398457">.</span><span class="ident" id="6398458">ReadAt</span><span class="op" id="6398464">(</span><span class="ident" id="6398465"><a href="/archive/zip/reader.go.html#6398403">buf</a></span><span class="op" id="6398468">,</span>&nbsp;<span class="ident" id="6398470"><a href="/archive/zip/reader.go.html#6398357">offset</a></span><span class="op" id="6398476">)</span><span class="op" id="6398477">;</span>&nbsp;<span class="ident" id="6398479"><a href="/archive/zip/reader.go.html#6398449">err</a></span>&nbsp;<span class="op" id="6398483">!=</span>&nbsp;<span class="ident" id="6398486">nil</span>&nbsp;<span class="op" id="6398490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398494">return</span>&nbsp;<span class="ident" id="6398501"><a href="/archive/zip/reader.go.html#6398449">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398510">b</span>&nbsp;<span class="op" id="6398512">:=</span>&nbsp;<span class="ident" id="6398515"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6398522">(</span><span class="ident" id="6398523"><a href="/archive/zip/reader.go.html#6398403">buf</a></span><span class="op" id="6398526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398529">if</span>&nbsp;<span class="ident" id="6398532">sig</span>&nbsp;<span class="op" id="6398536">:=</span>&nbsp;<span class="ident" id="6398539"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398540">.</span><span class="builtintype" id="6398541">uint32</span><span class="op" id="6398547">(</span><span class="op" id="6398548">)</span><span class="op" id="6398549">;</span>&nbsp;<span class="ident" id="6398551"><a href="/archive/zip/reader.go.html#6398532">sig</a></span>&nbsp;<span class="op" id="6398555">!=</span>&nbsp;<span class="ident" id="6398558"><a href="/archive/zip/struct.go.html#6403597">directory64EndSignature</a></span>&nbsp;<span class="op" id="6398582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398586">return</span>&nbsp;<span class="ident" id="6398593"><a href="/archive/zip/reader.go.html#6387834">ErrFormat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398608"><a href="/archive/zip/reader.go.html#6398510">b</a></span>&nbsp;<span class="op" id="6398610">=</span>&nbsp;<span class="ident" id="6398612"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398613">[</span><span class="num" id="6398614">12</span><span class="op" id="6398616">:</span><span class="op" id="6398617">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398642">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398709"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6398710">.</span><span class="ident" id="6398711">diskNbr</span>&nbsp;<span class="op" id="6398719">=</span>&nbsp;<span class="ident" id="6398721"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398722">.</span><span class="builtintype" id="6398723">uint32</span><span class="op" id="6398729">(</span><span class="op" id="6398730">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398743">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398767"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6398768">.</span><span class="ident" id="6398769">dirDiskNbr</span>&nbsp;<span class="op" id="6398780">=</span>&nbsp;<span class="ident" id="6398782"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398783">.</span><span class="builtintype" id="6398784">uint32</span><span class="op" id="6398790">(</span><span class="op" id="6398791">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398801">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398864"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6398865">.</span><span class="ident" id="6398866">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6398885">=</span>&nbsp;<span class="ident" id="6398887"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398888">.</span><span class="ident" id="6398889">uint64</span><span class="op" id="6398895">(</span><span class="op" id="6398896">)</span>&nbsp;<span class="comment" id="6398898">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398964"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6398965">.</span><span class="ident" id="6398966">directoryRecords</span>&nbsp;<span class="op" id="6398983">=</span>&nbsp;<span class="ident" id="6398985"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6398986">.</span><span class="ident" id="6398987">uint64</span><span class="op" id="6398993">(</span><span class="op" id="6398994">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6398998">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399051"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6399052">.</span><span class="ident" id="6399053">directorySize</span>&nbsp;<span class="op" id="6399067">=</span>&nbsp;<span class="ident" id="6399069"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6399070">.</span><span class="ident" id="6399071">uint64</span><span class="op" id="6399077">(</span><span class="op" id="6399078">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6399085">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399119"><a href="/archive/zip/reader.go.html#6398371">d</a></span><span class="op" id="6399120">.</span><span class="ident" id="6399121">directoryOffset</span>&nbsp;<span class="op" id="6399137">=</span>&nbsp;<span class="ident" id="6399139"><a href="/archive/zip/reader.go.html#6398510">b</a></span><span class="op" id="6399140">.</span><span class="ident" id="6399141">uint64</span><span class="op" id="6399147">(</span><span class="op" id="6399148">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6399153">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399236">return</span>&nbsp;<span class="ident" id="6399243">nil</span><br>
<span class="lineno"></span><span class="op" id="6399247">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6399250">func</span>&nbsp;<span class="ident" id="6399255">findSignatureInBlock</span><span class="op" id="6399275">(</span><span class="ident" id="6399276">b</span>&nbsp;<span class="op" id="6399278">[</span><span class="op" id="6399279">]</span><span class="builtintype" id="6399280">byte</span><span class="op" id="6399284">)</span>&nbsp;<span class="builtintype" id="6399286">int</span>&nbsp;<span class="op" id="6399290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399293">for</span>&nbsp;<span class="ident" id="6399297">i</span>&nbsp;<span class="op" id="6399299">:=</span>&nbsp;<span class="builtinfunc" id="6399302">len</span><span class="op" id="6399305">(</span><span class="ident" id="6399306"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399307">)</span>&nbsp;<span class="op" id="6399309">-</span>&nbsp;<span class="ident" id="6399311"><a href="/archive/zip/struct.go.html#6403853">directoryEndLen</a></span><span class="op" id="6399326">;</span>&nbsp;<span class="ident" id="6399328"><a href="/archive/zip/reader.go.html#6399297">i</a></span>&nbsp;<span class="op" id="6399330">&gt;=</span>&nbsp;<span class="num" id="6399333">0</span><span class="op" id="6399334">;</span>&nbsp;<span class="ident" id="6399336"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399337">--</span>&nbsp;<span class="op" id="6399340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399344">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399397">if</span>&nbsp;<span class="ident" id="6399400"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399401">[</span><span class="ident" id="6399402"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399403">]</span>&nbsp;<span class="op" id="6399405">==</span>&nbsp;<span class="string" id="6399408">&#39;P&#39;</span>&nbsp;<span class="op" id="6399412">&amp;&amp;</span>&nbsp;<span class="ident" id="6399415"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399416">[</span><span class="ident" id="6399417"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399418">+</span><span class="num" id="6399419">1</span><span class="op" id="6399420">]</span>&nbsp;<span class="op" id="6399422">==</span>&nbsp;<span class="string" id="6399425">&#39;K&#39;</span>&nbsp;<span class="op" id="6399429">&amp;&amp;</span>&nbsp;<span class="ident" id="6399432"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399433">[</span><span class="ident" id="6399434"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399435">+</span><span class="num" id="6399436">2</span><span class="op" id="6399437">]</span>&nbsp;<span class="op" id="6399439">==</span>&nbsp;<span class="num" id="6399442">0x05</span>&nbsp;<span class="op" id="6399447">&amp;&amp;</span>&nbsp;<span class="ident" id="6399450"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399451">[</span><span class="ident" id="6399452"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399453">+</span><span class="num" id="6399454">3</span><span class="op" id="6399455">]</span>&nbsp;<span class="op" id="6399457">==</span>&nbsp;<span class="num" id="6399460">0x06</span>&nbsp;<span class="op" id="6399465">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399470">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399499">n</span>&nbsp;<span class="op" id="6399501">:=</span>&nbsp;<span class="builtintype" id="6399504">int</span><span class="op" id="6399507">(</span><span class="ident" id="6399508"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399509">[</span><span class="ident" id="6399510"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399511">+</span><span class="ident" id="6399512"><a href="/archive/zip/struct.go.html#6403853">directoryEndLen</a></span><span class="op" id="6399527">-</span><span class="num" id="6399528">2</span><span class="op" id="6399529">]</span><span class="op" id="6399530">)</span>&nbsp;<span class="op" id="6399532">|</span>&nbsp;<span class="builtintype" id="6399534">int</span><span class="op" id="6399537">(</span><span class="ident" id="6399538"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399539">[</span><span class="ident" id="6399540"><a href="/archive/zip/reader.go.html#6399297">i</a></span><span class="op" id="6399541">+</span><span class="ident" id="6399542"><a href="/archive/zip/struct.go.html#6403853">directoryEndLen</a></span><span class="op" id="6399557">-</span><span class="num" id="6399558">1</span><span class="op" id="6399559">]</span><span class="op" id="6399560">)</span><span class="op" id="6399561">&lt;&lt;</span><span class="num" id="6399563">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399568">if</span>&nbsp;<span class="ident" id="6399571"><a href="/archive/zip/reader.go.html#6399499">n</a></span><span class="op" id="6399572">+</span><span class="ident" id="6399573"><a href="/archive/zip/struct.go.html#6403853">directoryEndLen</a></span><span class="op" id="6399588">+</span><span class="ident" id="6399589"><a href="/archive/zip/reader.go.html#6399297">i</a></span>&nbsp;<span class="op" id="6399591">&lt;=</span>&nbsp;<span class="builtinfunc" id="6399594">len</span><span class="op" id="6399597">(</span><span class="ident" id="6399598"><a href="/archive/zip/reader.go.html#6399276">b</a></span><span class="op" id="6399599">)</span>&nbsp;<span class="op" id="6399601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399607">return</span>&nbsp;<span class="ident" id="6399614"><a href="/archive/zip/reader.go.html#6399297">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399619">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399629">return</span>&nbsp;<span class="op" id="6399636">-</span><span class="num" id="6399637">1</span><br>
<span class="lineno"></span><span class="op" id="6399639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6399642">type</span>&nbsp;<span class="ident" id="6399647">readBuf</span>&nbsp;<span class="op" id="6399655">[</span><span class="op" id="6399656">]</span><span class="builtintype" id="6399657">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6399663">func</span>&nbsp;<span class="op" id="6399668">(</span><span class="ident" id="6399669">b</span>&nbsp;<span class="op" id="6399671">*</span><span class="ident" id="6399672"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6399679">)</span>&nbsp;<span class="builtintype" id="6399681">uint16</span><span class="op" id="6399687">(</span><span class="op" id="6399688">)</span>&nbsp;<span class="builtintype" id="6399690">uint16</span>&nbsp;<span class="op" id="6399697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399700">v</span>&nbsp;<span class="op" id="6399702">:=</span>&nbsp;<span class="ident" id="6399705"><a href="/archive/zip/reader.go.html#6387762">binary</a></span><span class="op" id="6399711">.</span><span class="ident" id="6399712">LittleEndian</span><span class="op" id="6399724">.</span><span class="ident" id="6399725">Uint16</span><span class="op" id="6399731">(</span><span class="op" id="6399732">*</span><span class="ident" id="6399733"><a href="/archive/zip/reader.go.html#6399669">b</a></span><span class="op" id="6399734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399737">*</span><span class="ident" id="6399738"><a href="/archive/zip/reader.go.html#6399669">b</a></span>&nbsp;<span class="op" id="6399740">=</span>&nbsp;<span class="op" id="6399742">(</span><span class="op" id="6399743">*</span><span class="ident" id="6399744"><a href="/archive/zip/reader.go.html#6399669">b</a></span><span class="op" id="6399745">)</span><span class="op" id="6399746">[</span><span class="num" id="6399747">2</span><span class="op" id="6399748">:</span><span class="op" id="6399749">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399752">return</span>&nbsp;<span class="ident" id="6399759"><a href="/archive/zip/reader.go.html#6399700">v</a></span><br>
<span class="lineno"></span><span class="op" id="6399761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6399764">func</span>&nbsp;<span class="op" id="6399769">(</span><span class="ident" id="6399770">b</span>&nbsp;<span class="op" id="6399772">*</span><span class="ident" id="6399773"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6399780">)</span>&nbsp;<span class="builtintype" id="6399782">uint32</span><span class="op" id="6399788">(</span><span class="op" id="6399789">)</span>&nbsp;<span class="builtintype" id="6399791">uint32</span>&nbsp;<span class="op" id="6399798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399801">v</span>&nbsp;<span class="op" id="6399803">:=</span>&nbsp;<span class="ident" id="6399806"><a href="/archive/zip/reader.go.html#6387762">binary</a></span><span class="op" id="6399812">.</span><span class="ident" id="6399813">LittleEndian</span><span class="op" id="6399825">.</span><span class="ident" id="6399826">Uint32</span><span class="op" id="6399832">(</span><span class="op" id="6399833">*</span><span class="ident" id="6399834"><a href="/archive/zip/reader.go.html#6399770">b</a></span><span class="op" id="6399835">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399838">*</span><span class="ident" id="6399839"><a href="/archive/zip/reader.go.html#6399770">b</a></span>&nbsp;<span class="op" id="6399841">=</span>&nbsp;<span class="op" id="6399843">(</span><span class="op" id="6399844">*</span><span class="ident" id="6399845"><a href="/archive/zip/reader.go.html#6399770">b</a></span><span class="op" id="6399846">)</span><span class="op" id="6399847">[</span><span class="num" id="6399848">4</span><span class="op" id="6399849">:</span><span class="op" id="6399850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399853">return</span>&nbsp;<span class="ident" id="6399860"><a href="/archive/zip/reader.go.html#6399801">v</a></span><br>
<span class="lineno"></span><span class="op" id="6399862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6399865">func</span>&nbsp;<span class="op" id="6399870">(</span><span class="ident" id="6399871">b</span>&nbsp;<span class="op" id="6399873">*</span><span class="ident" id="6399874"><a href="/archive/zip/reader.go.html#6399647">readBuf</a></span><span class="op" id="6399881">)</span>&nbsp;<span class="ident" id="6399883">uint64</span><span class="op" id="6399889">(</span><span class="op" id="6399890">)</span>&nbsp;<span class="ident" id="6399892">uint64</span>&nbsp;<span class="op" id="6399899">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399902">v</span>&nbsp;<span class="op" id="6399904">:=</span>&nbsp;<span class="ident" id="6399907"><a href="/archive/zip/reader.go.html#6387762">binary</a></span><span class="op" id="6399913">.</span><span class="ident" id="6399914">LittleEndian</span><span class="op" id="6399926">.</span><span class="ident" id="6399927">Uint64</span><span class="op" id="6399933">(</span><span class="op" id="6399934">*</span><span class="ident" id="6399935"><a href="/archive/zip/reader.go.html#6399871">b</a></span><span class="op" id="6399936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399939">*</span><span class="ident" id="6399940"><a href="/archive/zip/reader.go.html#6399871">b</a></span>&nbsp;<span class="op" id="6399942">=</span>&nbsp;<span class="op" id="6399944">(</span><span class="op" id="6399945">*</span><span class="ident" id="6399946"><a href="/archive/zip/reader.go.html#6399871">b</a></span><span class="op" id="6399947">)</span><span class="op" id="6399948">[</span><span class="num" id="6399949">8</span><span class="op" id="6399950">:</span><span class="op" id="6399951">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399954">return</span>&nbsp;<span class="ident" id="6399961"><a href="/archive/zip/reader.go.html#6399902">v</a></span><br>
<span class="lineno"></span><span class="op" id="6399963">}</span>
</div>
</body>
</html>
