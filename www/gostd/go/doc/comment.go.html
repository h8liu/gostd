<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4336162">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4336217">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4336271">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4336322">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336383">package</span>&nbsp;<span class="ident" id="4336391">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336396">import</span>&nbsp;<span class="op" id="4336403">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336406">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336412">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336422">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336433">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="4336449">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336468">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4336479">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4336494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336497">var</span>&nbsp;<span class="op" id="4336501">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336504">ldquo</span>&nbsp;<span class="op" id="4336510">=</span>&nbsp;<span class="op" id="4336512">[</span><span class="op" id="4336513">]</span><span class="builtintype" id="4336514">byte</span><span class="op" id="4336518">(</span><span class="string" id="4336519">&#34;&amp;ldquo;&#34;</span><span class="op" id="4336528">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336531">rdquo</span>&nbsp;<span class="op" id="4336537">=</span>&nbsp;<span class="op" id="4336539">[</span><span class="op" id="4336540">]</span><span class="builtintype" id="4336541">byte</span><span class="op" id="4336545">(</span><span class="string" id="4336546">&#34;&amp;rdquo;&#34;</span><span class="op" id="4336555">)</span><br>
<span class="lineno"></span><span class="op" id="4336557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4336560">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="4336609">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="4336659">func</span>&nbsp;<span class="ident" id="4336664">commentEscape</span><span class="op" id="4336677">(</span><span class="ident" id="4336678">w</span>&nbsp;<span class="ident" id="4336680">io</span><span class="op" id="4336682">.</span><span class="ident" id="4336683">Writer</span><span class="op" id="4336689">,</span>&nbsp;<span class="ident" id="4336691">text</span>&nbsp;<span class="builtintype" id="4336696">string</span><span class="op" id="4336702">,</span>&nbsp;<span class="ident" id="4336704">nice</span>&nbsp;<span class="builtintype" id="4336709">bool</span><span class="op" id="4336713">)</span>&nbsp;<span class="op" id="4336715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336718">last</span>&nbsp;<span class="op" id="4336723">:=</span>&nbsp;<span class="num" id="4336726">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336729">if</span>&nbsp;<span class="ident" id="4336732">nice</span>&nbsp;<span class="op" id="4336737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336741">for</span>&nbsp;<span class="ident" id="4336745">i</span>&nbsp;<span class="op" id="4336747">:=</span>&nbsp;<span class="num" id="4336750">0</span><span class="op" id="4336751">;</span>&nbsp;<span class="ident" id="4336753">i</span>&nbsp;<span class="op" id="4336755">&lt;</span>&nbsp;<span class="builtinfunc" id="4336757">len</span><span class="op" id="4336760">(</span><span class="ident" id="4336761">text</span><span class="op" id="4336765">)</span><span class="op" id="4336766">-</span><span class="num" id="4336767">1</span><span class="op" id="4336768">;</span>&nbsp;<span class="ident" id="4336770">i</span><span class="op" id="4336771">++</span>&nbsp;<span class="op" id="4336774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336779">ch</span>&nbsp;<span class="op" id="4336782">:=</span>&nbsp;<span class="ident" id="4336785">text</span><span class="op" id="4336789">[</span><span class="ident" id="4336790">i</span><span class="op" id="4336791">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336796">if</span>&nbsp;<span class="ident" id="4336799">ch</span>&nbsp;<span class="op" id="4336802">==</span>&nbsp;<span class="ident" id="4336805">text</span><span class="op" id="4336809">[</span><span class="ident" id="4336810">i</span><span class="op" id="4336811">+</span><span class="num" id="4336812">1</span><span class="op" id="4336813">]</span>&nbsp;<span class="op" id="4336815">&amp;&amp;</span>&nbsp;<span class="op" id="4336818">(</span><span class="ident" id="4336819">ch</span>&nbsp;<span class="op" id="4336822">==</span>&nbsp;<span class="string" id="4336825">&#39;`&#39;</span>&nbsp;<span class="op" id="4336829">||</span>&nbsp;<span class="ident" id="4336832">ch</span>&nbsp;<span class="op" id="4336835">==</span>&nbsp;<span class="string" id="4336838">&#39;\&#39;&#39;</span><span class="op" id="4336842">)</span>&nbsp;<span class="op" id="4336844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336850">template</span><span class="op" id="4336858">.</span><span class="ident" id="4336859">HTMLEscape</span><span class="op" id="4336869">(</span><span class="ident" id="4336870">w</span><span class="op" id="4336871">,</span>&nbsp;<span class="op" id="4336873">[</span><span class="op" id="4336874">]</span><span class="builtintype" id="4336875">byte</span><span class="op" id="4336879">(</span><span class="ident" id="4336880">text</span><span class="op" id="4336884">[</span><span class="ident" id="4336885">last</span><span class="op" id="4336889">:</span><span class="ident" id="4336890">i</span><span class="op" id="4336891">]</span><span class="op" id="4336892">)</span><span class="op" id="4336893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336899">last</span>&nbsp;<span class="op" id="4336904">=</span>&nbsp;<span class="ident" id="4336906">i</span>&nbsp;<span class="op" id="4336908">+</span>&nbsp;<span class="num" id="4336910">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336916">switch</span>&nbsp;<span class="ident" id="4336923">ch</span>&nbsp;<span class="op" id="4336926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336932">case</span>&nbsp;<span class="string" id="4336937">&#39;`&#39;</span><span class="op" id="4336940">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336947">w</span><span class="op" id="4336948">.</span><span class="ident" id="4336949">Write</span><span class="op" id="4336954">(</span><span class="ident" id="4336955">ldquo</span><span class="op" id="4336960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336966">case</span>&nbsp;<span class="string" id="4336971">&#39;\&#39;&#39;</span><span class="op" id="4336975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336982">w</span><span class="op" id="4336983">.</span><span class="ident" id="4336984">Write</span><span class="op" id="4336989">(</span><span class="ident" id="4336990">rdquo</span><span class="op" id="4336995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337007">i</span><span class="op" id="4337008">++</span>&nbsp;<span class="comment" id="4337011">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337050">template</span><span class="op" id="4337058">.</span><span class="ident" id="4337059">HTMLEscape</span><span class="op" id="4337069">(</span><span class="ident" id="4337070">w</span><span class="op" id="4337071">,</span>&nbsp;<span class="op" id="4337073">[</span><span class="op" id="4337074">]</span><span class="builtintype" id="4337075">byte</span><span class="op" id="4337079">(</span><span class="ident" id="4337080">text</span><span class="op" id="4337084">[</span><span class="ident" id="4337085">last</span><span class="op" id="4337089">:</span><span class="op" id="4337090">]</span><span class="op" id="4337091">)</span><span class="op" id="4337092">)</span><br>
<span class="lineno"></span><span class="op" id="4337094">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4337097">const</span>&nbsp;<span class="op" id="4337103">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337106">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337136">identRx</span>&nbsp;<span class="op" id="4337144">=</span>&nbsp;<span class="string" id="4337146">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337167">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337187">protocol</span>&nbsp;<span class="op" id="4337196">=</span>&nbsp;<span class="string" id="4337198">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337262">hostPart</span>&nbsp;<span class="op" id="4337271">=</span>&nbsp;<span class="string" id="4337273">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337293">filePart</span>&nbsp;<span class="op" id="4337302">=</span>&nbsp;<span class="string" id="4337304">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="4337332">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337395">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337404">=</span>&nbsp;<span class="string" id="4337406">`(`</span>&nbsp;<span class="op" id="4337410">+</span>&nbsp;<span class="ident" id="4337412">protocol</span>&nbsp;<span class="op" id="4337421">+</span>&nbsp;<span class="string" id="4337423">`)://`</span>&nbsp;<span class="op" id="4337430">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4337434">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337447">hostPart</span>&nbsp;<span class="op" id="4337456">+</span>&nbsp;<span class="string" id="4337458">`([.:]`</span>&nbsp;<span class="op" id="4337466">+</span>&nbsp;<span class="ident" id="4337468">hostPart</span>&nbsp;<span class="op" id="4337477">+</span>&nbsp;<span class="string" id="4337479">`)*/?`</span>&nbsp;<span class="op" id="4337486">+</span>&nbsp;<span class="comment" id="4337488">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337516">filePart</span>&nbsp;<span class="op" id="4337525">+</span>&nbsp;<span class="string" id="4337527">`([:.,]`</span>&nbsp;<span class="op" id="4337536">+</span>&nbsp;<span class="ident" id="4337538">filePart</span>&nbsp;<span class="op" id="4337547">+</span>&nbsp;<span class="string" id="4337549">`)*`</span><br>
<span class="lineno"></span><span class="op" id="4337554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4337557">var</span>&nbsp;<span class="ident" id="4337561">matchRx</span>&nbsp;<span class="op" id="4337569">=</span>&nbsp;<span class="ident" id="4337571">regexp</span><span class="op" id="4337577">.</span><span class="ident" id="4337578">MustCompile</span><span class="op" id="4337589">(</span><span class="string" id="4337590">`(`</span>&nbsp;<span class="op" id="4337594">+</span>&nbsp;<span class="ident" id="4337596">urlRx</span>&nbsp;<span class="op" id="4337602">+</span>&nbsp;<span class="string" id="4337604">`)|(`</span>&nbsp;<span class="op" id="4337610">+</span>&nbsp;<span class="ident" id="4337612">identRx</span>&nbsp;<span class="op" id="4337620">+</span>&nbsp;<span class="string" id="4337622">`)`</span><span class="op" id="4337625">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4337628">var</span>&nbsp;<span class="op" id="4337632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337635">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337647">=</span>&nbsp;<span class="op" id="4337649">[</span><span class="op" id="4337650">]</span><span class="builtintype" id="4337651">byte</span><span class="op" id="4337655">(</span><span class="string" id="4337656">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="4337667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337670">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337682">=</span>&nbsp;<span class="op" id="4337684">[</span><span class="op" id="4337685">]</span><span class="builtintype" id="4337686">byte</span><span class="op" id="4337690">(</span><span class="string" id="4337691">`&#34;&gt;`</span><span class="op" id="4337695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337698">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4337710">=</span>&nbsp;<span class="op" id="4337712">[</span><span class="op" id="4337713">]</span><span class="builtintype" id="4337714">byte</span><span class="op" id="4337718">(</span><span class="string" id="4337719">&#34;&lt;/a&gt;&#34;</span><span class="op" id="4337725">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337728">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337740">=</span>&nbsp;<span class="op" id="4337742">[</span><span class="op" id="4337743">]</span><span class="builtintype" id="4337744">byte</span><span class="op" id="4337748">(</span><span class="string" id="4337749">&#34;&lt;i&gt;&#34;</span><span class="op" id="4337754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337757">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4337769">=</span>&nbsp;<span class="op" id="4337771">[</span><span class="op" id="4337772">]</span><span class="builtintype" id="4337773">byte</span><span class="op" id="4337777">(</span><span class="string" id="4337778">&#34;&lt;/i&gt;&#34;</span><span class="op" id="4337784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337787">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337799">=</span>&nbsp;<span class="op" id="4337801">[</span><span class="op" id="4337802">]</span><span class="builtintype" id="4337803">byte</span><span class="op" id="4337807">(</span><span class="string" id="4337808">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="4337815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337818">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4337830">=</span>&nbsp;<span class="op" id="4337832">[</span><span class="op" id="4337833">]</span><span class="builtintype" id="4337834">byte</span><span class="op" id="4337838">(</span><span class="string" id="4337839">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="4337847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337850">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337862">=</span>&nbsp;<span class="op" id="4337864">[</span><span class="op" id="4337865">]</span><span class="builtintype" id="4337866">byte</span><span class="op" id="4337870">(</span><span class="string" id="4337871">&#34;&lt;pre&gt;&#34;</span><span class="op" id="4337878">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337881">html_endpre</span>&nbsp;<span class="op" id="4337893">=</span>&nbsp;<span class="op" id="4337895">[</span><span class="op" id="4337896">]</span><span class="builtintype" id="4337897">byte</span><span class="op" id="4337901">(</span><span class="string" id="4337902">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="4337912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337915">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337927">=</span>&nbsp;<span class="op" id="4337929">[</span><span class="op" id="4337930">]</span><span class="builtintype" id="4337931">byte</span><span class="op" id="4337935">(</span><span class="string" id="4337936">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="4337946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337949">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337961">=</span>&nbsp;<span class="op" id="4337963">[</span><span class="op" id="4337964">]</span><span class="builtintype" id="4337965">byte</span><span class="op" id="4337969">(</span><span class="string" id="4337970">`&#34;&gt;`</span><span class="op" id="4337974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337977">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4337989">=</span>&nbsp;<span class="op" id="4337991">[</span><span class="op" id="4337992">]</span><span class="builtintype" id="4337993">byte</span><span class="op" id="4337997">(</span><span class="string" id="4337998">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="4338007">)</span><br>
<span class="lineno"></span><span class="op" id="4338009">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4338012">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="4338114">func</span>&nbsp;<span class="ident" id="4338119">pairedParensPrefixLen</span><span class="op" id="4338140">(</span><span class="ident" id="4338141">s</span>&nbsp;<span class="builtintype" id="4338143">string</span><span class="op" id="4338149">)</span>&nbsp;<span class="builtintype" id="4338151">int</span>&nbsp;<span class="op" id="4338155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338158">parens</span>&nbsp;<span class="op" id="4338165">:=</span>&nbsp;<span class="num" id="4338168">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338171">l</span>&nbsp;<span class="op" id="4338173">:=</span>&nbsp;<span class="builtinfunc" id="4338176">len</span><span class="op" id="4338179">(</span><span class="ident" id="4338180">s</span><span class="op" id="4338181">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338184">for</span>&nbsp;<span class="ident" id="4338188">i</span><span class="op" id="4338189">,</span>&nbsp;<span class="ident" id="4338191">ch</span>&nbsp;<span class="op" id="4338194">:=</span>&nbsp;<span class="keyword" id="4338197">range</span>&nbsp;<span class="ident" id="4338203">s</span>&nbsp;<span class="op" id="4338205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338209">switch</span>&nbsp;<span class="ident" id="4338216">ch</span>&nbsp;<span class="op" id="4338219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338223">case</span>&nbsp;<span class="string" id="4338228">&#39;(&#39;</span><span class="op" id="4338231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338236">if</span>&nbsp;<span class="ident" id="4338239">parens</span>&nbsp;<span class="op" id="4338246">==</span>&nbsp;<span class="num" id="4338249">0</span>&nbsp;<span class="op" id="4338251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338257">l</span>&nbsp;<span class="op" id="4338259">=</span>&nbsp;<span class="ident" id="4338261">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338271">parens</span><span class="op" id="4338277">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338282">case</span>&nbsp;<span class="string" id="4338287">&#39;)&#39;</span><span class="op" id="4338290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338295">parens</span><span class="op" id="4338301">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338307">if</span>&nbsp;<span class="ident" id="4338310">parens</span>&nbsp;<span class="op" id="4338317">==</span>&nbsp;<span class="num" id="4338320">0</span>&nbsp;<span class="op" id="4338322">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338328">l</span>&nbsp;<span class="op" id="4338330">=</span>&nbsp;<span class="builtinfunc" id="4338332">len</span><span class="op" id="4338335">(</span><span class="ident" id="4338336">s</span><span class="op" id="4338337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338342">}</span>&nbsp;<span class="keyword" id="4338344">else</span>&nbsp;<span class="keyword" id="4338349">if</span>&nbsp;<span class="ident" id="4338352">parens</span>&nbsp;<span class="op" id="4338359">&lt;</span>&nbsp;<span class="num" id="4338361">0</span>&nbsp;<span class="op" id="4338363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338369">return</span>&nbsp;<span class="ident" id="4338376">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338385">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338391">return</span>&nbsp;<span class="ident" id="4338398">l</span><br>
<span class="lineno"></span><span class="op" id="4338400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4338403">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="4338483">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="4338563">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="4338640">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4338720">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="4338799">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="4338878">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="4338958">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="4338983">func</span>&nbsp;<span class="ident" id="4338988">emphasize</span><span class="op" id="4338997">(</span><span class="ident" id="4338998">w</span>&nbsp;<span class="ident" id="4339000">io</span><span class="op" id="4339002">.</span><span class="ident" id="4339003">Writer</span><span class="op" id="4339009">,</span>&nbsp;<span class="ident" id="4339011">line</span>&nbsp;<span class="builtintype" id="4339016">string</span><span class="op" id="4339022">,</span>&nbsp;<span class="ident" id="4339024">words</span>&nbsp;<span class="keyword" id="4339030">map</span><span class="op" id="4339033">[</span><span class="builtintype" id="4339034">string</span><span class="op" id="4339040">]</span><span class="builtintype" id="4339041">string</span><span class="op" id="4339047">,</span>&nbsp;<span class="ident" id="4339049">nice</span>&nbsp;<span class="builtintype" id="4339054">bool</span><span class="op" id="4339058">)</span>&nbsp;<span class="op" id="4339060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339063">for</span>&nbsp;<span class="op" id="4339067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339071">m</span>&nbsp;<span class="op" id="4339073">:=</span>&nbsp;<span class="ident" id="4339076">matchRx</span><span class="op" id="4339083">.</span><span class="ident" id="4339084">FindStringSubmatchIndex</span><span class="op" id="4339107">(</span><span class="ident" id="4339108">line</span><span class="op" id="4339112">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339116">if</span>&nbsp;<span class="ident" id="4339119">m</span>&nbsp;<span class="op" id="4339121">==</span>&nbsp;<span class="ident" id="4339124">nil</span>&nbsp;<span class="op" id="4339128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339133">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339145">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339219">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339248">commentEscape</span><span class="op" id="4339261">(</span><span class="ident" id="4339262">w</span><span class="op" id="4339263">,</span>&nbsp;<span class="ident" id="4339265">line</span><span class="op" id="4339269">[</span><span class="num" id="4339270">0</span><span class="op" id="4339271">:</span><span class="ident" id="4339272">m</span><span class="op" id="4339273">[</span><span class="num" id="4339274">0</span><span class="op" id="4339275">]</span><span class="op" id="4339276">]</span><span class="op" id="4339277">,</span>&nbsp;<span class="ident" id="4339279">nice</span><span class="op" id="4339283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339288">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339319">match</span>&nbsp;<span class="op" id="4339325">:=</span>&nbsp;<span class="ident" id="4339328">line</span><span class="op" id="4339332">[</span><span class="ident" id="4339333">m</span><span class="op" id="4339334">[</span><span class="num" id="4339335">0</span><span class="op" id="4339336">]</span><span class="op" id="4339337">:</span><span class="ident" id="4339338">m</span><span class="op" id="4339339">[</span><span class="num" id="4339340">1</span><span class="op" id="4339341">]</span><span class="op" id="4339342">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339346">if</span>&nbsp;<span class="ident" id="4339349">n</span>&nbsp;<span class="op" id="4339351">:=</span>&nbsp;<span class="ident" id="4339354">pairedParensPrefixLen</span><span class="op" id="4339375">(</span><span class="ident" id="4339376">match</span><span class="op" id="4339381">)</span><span class="op" id="4339382">;</span>&nbsp;<span class="ident" id="4339384">n</span>&nbsp;<span class="op" id="4339386">&lt;</span>&nbsp;<span class="builtinfunc" id="4339388">len</span><span class="op" id="4339391">(</span><span class="ident" id="4339392">match</span><span class="op" id="4339397">)</span>&nbsp;<span class="op" id="4339399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339404">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339454">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339514">m</span>&nbsp;<span class="op" id="4339516">=</span>&nbsp;<span class="ident" id="4339518">matchRx</span><span class="op" id="4339525">.</span><span class="ident" id="4339526">FindStringSubmatchIndex</span><span class="op" id="4339549">(</span><span class="ident" id="4339550">line</span><span class="op" id="4339554">[</span><span class="op" id="4339555">:</span><span class="ident" id="4339556">m</span><span class="op" id="4339557">[</span><span class="num" id="4339558">0</span><span class="op" id="4339559">]</span><span class="op" id="4339560">+</span><span class="ident" id="4339561">n</span><span class="op" id="4339562">]</span><span class="op" id="4339563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339568">match</span>&nbsp;<span class="op" id="4339574">=</span>&nbsp;<span class="ident" id="4339576">match</span><span class="op" id="4339581">[</span><span class="op" id="4339582">:</span><span class="ident" id="4339583">n</span><span class="op" id="4339584">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339593">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339612">url</span>&nbsp;<span class="op" id="4339616">:=</span>&nbsp;<span class="string" id="4339619">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339624">italics</span>&nbsp;<span class="op" id="4339632">:=</span>&nbsp;<span class="builtintype" id="4339635">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339643">if</span>&nbsp;<span class="ident" id="4339646">words</span>&nbsp;<span class="op" id="4339652">!=</span>&nbsp;<span class="ident" id="4339655">nil</span>&nbsp;<span class="op" id="4339659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339664">url</span><span class="op" id="4339667">,</span>&nbsp;<span class="ident" id="4339669">italics</span>&nbsp;<span class="op" id="4339677">=</span>&nbsp;<span class="ident" id="4339679">words</span><span class="op" id="4339684">[</span><span class="ident" id="4339685">match</span><span class="op" id="4339690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339698">if</span>&nbsp;<span class="ident" id="4339701">m</span><span class="op" id="4339702">[</span><span class="num" id="4339703">2</span><span class="op" id="4339704">]</span>&nbsp;<span class="op" id="4339706">&gt;=</span>&nbsp;<span class="num" id="4339709">0</span>&nbsp;<span class="op" id="4339711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339716">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339796">if</span>&nbsp;<span class="op" id="4339799">!</span><span class="ident" id="4339800">italics</span>&nbsp;<span class="op" id="4339808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339814">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339873">url</span>&nbsp;<span class="op" id="4339877">=</span>&nbsp;<span class="ident" id="4339879">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339893">italics</span>&nbsp;<span class="op" id="4339901">=</span>&nbsp;<span class="builtintype" id="4339903">false</span>&nbsp;<span class="comment" id="4339909">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339940">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339957">if</span>&nbsp;<span class="builtinfunc" id="4339960">len</span><span class="op" id="4339963">(</span><span class="ident" id="4339964">url</span><span class="op" id="4339967">)</span>&nbsp;<span class="op" id="4339969">&gt;</span>&nbsp;<span class="num" id="4339971">0</span>&nbsp;<span class="op" id="4339973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339978">w</span><span class="op" id="4339979">.</span><span class="ident" id="4339980">Write</span><span class="op" id="4339985">(</span><span class="ident" id="4339986">html_a</span><span class="op" id="4339992">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339997">template</span><span class="op" id="4340005">.</span><span class="ident" id="4340006">HTMLEscape</span><span class="op" id="4340016">(</span><span class="ident" id="4340017">w</span><span class="op" id="4340018">,</span>&nbsp;<span class="op" id="4340020">[</span><span class="op" id="4340021">]</span><span class="builtintype" id="4340022">byte</span><span class="op" id="4340026">(</span><span class="ident" id="4340027">url</span><span class="op" id="4340030">)</span><span class="op" id="4340031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340036">w</span><span class="op" id="4340037">.</span><span class="ident" id="4340038">Write</span><span class="op" id="4340043">(</span><span class="ident" id="4340044">html_aq</span><span class="op" id="4340051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340059">if</span>&nbsp;<span class="ident" id="4340062">italics</span>&nbsp;<span class="op" id="4340070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340075">w</span><span class="op" id="4340076">.</span><span class="ident" id="4340077">Write</span><span class="op" id="4340082">(</span><span class="ident" id="4340083">html_i</span><span class="op" id="4340089">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340097">commentEscape</span><span class="op" id="4340110">(</span><span class="ident" id="4340111">w</span><span class="op" id="4340112">,</span>&nbsp;<span class="ident" id="4340114">match</span><span class="op" id="4340119">,</span>&nbsp;<span class="ident" id="4340121">nice</span><span class="op" id="4340125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340129">if</span>&nbsp;<span class="ident" id="4340132">italics</span>&nbsp;<span class="op" id="4340140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340145">w</span><span class="op" id="4340146">.</span><span class="ident" id="4340147">Write</span><span class="op" id="4340152">(</span><span class="ident" id="4340153">html_endi</span><span class="op" id="4340162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340166">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340170">if</span>&nbsp;<span class="builtinfunc" id="4340173">len</span><span class="op" id="4340176">(</span><span class="ident" id="4340177">url</span><span class="op" id="4340180">)</span>&nbsp;<span class="op" id="4340182">&gt;</span>&nbsp;<span class="num" id="4340184">0</span>&nbsp;<span class="op" id="4340186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340191">w</span><span class="op" id="4340192">.</span><span class="ident" id="4340193">Write</span><span class="op" id="4340198">(</span><span class="ident" id="4340199">html_enda</span><span class="op" id="4340208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340217">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340230">line</span>&nbsp;<span class="op" id="4340235">=</span>&nbsp;<span class="ident" id="4340237">line</span><span class="op" id="4340241">[</span><span class="ident" id="4340242">m</span><span class="op" id="4340243">[</span><span class="num" id="4340244">1</span><span class="op" id="4340245">]</span><span class="op" id="4340246">:</span><span class="op" id="4340247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340253">commentEscape</span><span class="op" id="4340266">(</span><span class="ident" id="4340267">w</span><span class="op" id="4340268">,</span>&nbsp;<span class="ident" id="4340270">line</span><span class="op" id="4340274">,</span>&nbsp;<span class="ident" id="4340276">nice</span><span class="op" id="4340280">)</span><br>
<span class="lineno"></span><span class="op" id="4340282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4340285">func</span>&nbsp;<span class="ident" id="4340290">indentLen</span><span class="op" id="4340299">(</span><span class="ident" id="4340300">s</span>&nbsp;<span class="builtintype" id="4340302">string</span><span class="op" id="4340308">)</span>&nbsp;<span class="builtintype" id="4340310">int</span>&nbsp;<span class="op" id="4340314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340317">i</span>&nbsp;<span class="op" id="4340319">:=</span>&nbsp;<span class="num" id="4340322">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340325">for</span>&nbsp;<span class="ident" id="4340329">i</span>&nbsp;<span class="op" id="4340331">&lt;</span>&nbsp;<span class="builtinfunc" id="4340333">len</span><span class="op" id="4340336">(</span><span class="ident" id="4340337">s</span><span class="op" id="4340338">)</span>&nbsp;<span class="op" id="4340340">&amp;&amp;</span>&nbsp;<span class="op" id="4340343">(</span><span class="ident" id="4340344">s</span><span class="op" id="4340345">[</span><span class="ident" id="4340346">i</span><span class="op" id="4340347">]</span>&nbsp;<span class="op" id="4340349">==</span>&nbsp;<span class="string" id="4340352">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4340356">||</span>&nbsp;<span class="ident" id="4340359">s</span><span class="op" id="4340360">[</span><span class="ident" id="4340361">i</span><span class="op" id="4340362">]</span>&nbsp;<span class="op" id="4340364">==</span>&nbsp;<span class="string" id="4340367">&#39;\t&#39;</span><span class="op" id="4340371">)</span>&nbsp;<span class="op" id="4340373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340377">i</span><span class="op" id="4340378">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340382">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340385">return</span>&nbsp;<span class="ident" id="4340392">i</span><br>
<span class="lineno"></span><span class="op" id="4340394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340397">func</span>&nbsp;<span class="ident" id="4340402">isBlank</span><span class="op" id="4340409">(</span><span class="ident" id="4340410">s</span>&nbsp;<span class="builtintype" id="4340412">string</span><span class="op" id="4340418">)</span>&nbsp;<span class="builtintype" id="4340420">bool</span>&nbsp;<span class="op" id="4340425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340428">return</span>&nbsp;<span class="builtinfunc" id="4340435">len</span><span class="op" id="4340438">(</span><span class="ident" id="4340439">s</span><span class="op" id="4340440">)</span>&nbsp;<span class="op" id="4340442">==</span>&nbsp;<span class="num" id="4340445">0</span>&nbsp;<span class="op" id="4340447">||</span>&nbsp;<span class="op" id="4340450">(</span><span class="builtinfunc" id="4340451">len</span><span class="op" id="4340454">(</span><span class="ident" id="4340455">s</span><span class="op" id="4340456">)</span>&nbsp;<span class="op" id="4340458">==</span>&nbsp;<span class="num" id="4340461">1</span>&nbsp;<span class="op" id="4340463">&amp;&amp;</span>&nbsp;<span class="ident" id="4340466">s</span><span class="op" id="4340467">[</span><span class="num" id="4340468">0</span><span class="op" id="4340469">]</span>&nbsp;<span class="op" id="4340471">==</span>&nbsp;<span class="string" id="4340474">&#39;\n&#39;</span><span class="op" id="4340478">)</span><br>
<span class="lineno">175</span><span class="op" id="4340480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340483">func</span>&nbsp;<span class="ident" id="4340488">commonPrefix</span><span class="op" id="4340500">(</span><span class="ident" id="4340501">a</span><span class="op" id="4340502">,</span>&nbsp;<span class="ident" id="4340504">b</span>&nbsp;<span class="builtintype" id="4340506">string</span><span class="op" id="4340512">)</span>&nbsp;<span class="builtintype" id="4340514">string</span>&nbsp;<span class="op" id="4340521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340524">i</span>&nbsp;<span class="op" id="4340526">:=</span>&nbsp;<span class="num" id="4340529">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340532">for</span>&nbsp;<span class="ident" id="4340536">i</span>&nbsp;<span class="op" id="4340538">&lt;</span>&nbsp;<span class="builtinfunc" id="4340540">len</span><span class="op" id="4340543">(</span><span class="ident" id="4340544">a</span><span class="op" id="4340545">)</span>&nbsp;<span class="op" id="4340547">&amp;&amp;</span>&nbsp;<span class="ident" id="4340550">i</span>&nbsp;<span class="op" id="4340552">&lt;</span>&nbsp;<span class="builtinfunc" id="4340554">len</span><span class="op" id="4340557">(</span><span class="ident" id="4340558">b</span><span class="op" id="4340559">)</span>&nbsp;<span class="op" id="4340561">&amp;&amp;</span>&nbsp;<span class="ident" id="4340564">a</span><span class="op" id="4340565">[</span><span class="ident" id="4340566">i</span><span class="op" id="4340567">]</span>&nbsp;<span class="op" id="4340569">==</span>&nbsp;<span class="ident" id="4340572">b</span><span class="op" id="4340573">[</span><span class="ident" id="4340574">i</span><span class="op" id="4340575">]</span>&nbsp;<span class="op" id="4340577">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340581">i</span><span class="op" id="4340582">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340589">return</span>&nbsp;<span class="ident" id="4340596">a</span><span class="op" id="4340597">[</span><span class="num" id="4340598">0</span><span class="op" id="4340599">:</span><span class="ident" id="4340600">i</span><span class="op" id="4340601">]</span><br>
<span class="lineno"></span><span class="op" id="4340603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4340606">func</span>&nbsp;<span class="ident" id="4340611">unindent</span><span class="op" id="4340619">(</span><span class="ident" id="4340620">block</span>&nbsp;<span class="op" id="4340626">[</span><span class="op" id="4340627">]</span><span class="builtintype" id="4340628">string</span><span class="op" id="4340634">)</span>&nbsp;<span class="op" id="4340636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340639">if</span>&nbsp;<span class="builtinfunc" id="4340642">len</span><span class="op" id="4340645">(</span><span class="ident" id="4340646">block</span><span class="op" id="4340651">)</span>&nbsp;<span class="op" id="4340653">==</span>&nbsp;<span class="num" id="4340656">0</span>&nbsp;<span class="op" id="4340658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340662">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340674">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340714">prefix</span>&nbsp;<span class="op" id="4340721">:=</span>&nbsp;<span class="ident" id="4340724">block</span><span class="op" id="4340729">[</span><span class="num" id="4340730">0</span><span class="op" id="4340731">]</span><span class="op" id="4340732">[</span><span class="num" id="4340733">0</span><span class="op" id="4340734">:</span><span class="ident" id="4340735">indentLen</span><span class="op" id="4340744">(</span><span class="ident" id="4340745">block</span><span class="op" id="4340750">[</span><span class="num" id="4340751">0</span><span class="op" id="4340752">]</span><span class="op" id="4340753">)</span><span class="op" id="4340754">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340757">for</span>&nbsp;<span class="ident" id="4340761">_</span><span class="op" id="4340762">,</span>&nbsp;<span class="ident" id="4340764">line</span>&nbsp;<span class="op" id="4340769">:=</span>&nbsp;<span class="keyword" id="4340772">range</span>&nbsp;<span class="ident" id="4340778">block</span>&nbsp;<span class="op" id="4340784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340788">if</span>&nbsp;<span class="op" id="4340791">!</span><span class="ident" id="4340792">isBlank</span><span class="op" id="4340799">(</span><span class="ident" id="4340800">line</span><span class="op" id="4340804">)</span>&nbsp;<span class="op" id="4340806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340811">prefix</span>&nbsp;<span class="op" id="4340818">=</span>&nbsp;<span class="ident" id="4340820">commonPrefix</span><span class="op" id="4340832">(</span><span class="ident" id="4340833">prefix</span><span class="op" id="4340839">,</span>&nbsp;<span class="ident" id="4340841">line</span><span class="op" id="4340845">[</span><span class="num" id="4340846">0</span><span class="op" id="4340847">:</span><span class="ident" id="4340848">indentLen</span><span class="op" id="4340857">(</span><span class="ident" id="4340858">line</span><span class="op" id="4340862">)</span><span class="op" id="4340863">]</span><span class="op" id="4340864">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340874">n</span>&nbsp;<span class="op" id="4340876">:=</span>&nbsp;<span class="builtinfunc" id="4340879">len</span><span class="op" id="4340882">(</span><span class="ident" id="4340883">prefix</span><span class="op" id="4340889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340893">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340904">for</span>&nbsp;<span class="ident" id="4340908">i</span><span class="op" id="4340909">,</span>&nbsp;<span class="ident" id="4340911">line</span>&nbsp;<span class="op" id="4340916">:=</span>&nbsp;<span class="keyword" id="4340919">range</span>&nbsp;<span class="ident" id="4340925">block</span>&nbsp;<span class="op" id="4340931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340935">if</span>&nbsp;<span class="op" id="4340938">!</span><span class="ident" id="4340939">isBlank</span><span class="op" id="4340946">(</span><span class="ident" id="4340947">line</span><span class="op" id="4340951">)</span>&nbsp;<span class="op" id="4340953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340958">block</span><span class="op" id="4340963">[</span><span class="ident" id="4340964">i</span><span class="op" id="4340965">]</span>&nbsp;<span class="op" id="4340967">=</span>&nbsp;<span class="ident" id="4340969">line</span><span class="op" id="4340973">[</span><span class="ident" id="4340974">n</span><span class="op" id="4340975">:</span><span class="op" id="4340976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340983">}</span><br>
<span class="lineno">205</span><span class="op" id="4340985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4340988">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="4341059">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4341101">func</span>&nbsp;<span class="ident" id="4341106">heading</span><span class="op" id="4341113">(</span><span class="ident" id="4341114">line</span>&nbsp;<span class="builtintype" id="4341119">string</span><span class="op" id="4341125">)</span>&nbsp;<span class="builtintype" id="4341127">string</span>&nbsp;<span class="op" id="4341134">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341137">line</span>&nbsp;<span class="op" id="4341142">=</span>&nbsp;<span class="ident" id="4341144">strings</span><span class="op" id="4341151">.</span><span class="ident" id="4341152">TrimSpace</span><span class="op" id="4341161">(</span><span class="ident" id="4341162">line</span><span class="op" id="4341166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341169">if</span>&nbsp;<span class="builtinfunc" id="4341172">len</span><span class="op" id="4341175">(</span><span class="ident" id="4341176">line</span><span class="op" id="4341180">)</span>&nbsp;<span class="op" id="4341182">==</span>&nbsp;<span class="num" id="4341185">0</span>&nbsp;<span class="op" id="4341187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341191">return</span>&nbsp;<span class="string" id="4341198">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4341206">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341256">r</span><span class="op" id="4341257">,</span>&nbsp;<span class="ident" id="4341259">_</span>&nbsp;<span class="op" id="4341261">:=</span>&nbsp;<span class="ident" id="4341264">utf8</span><span class="op" id="4341268">.</span><span class="ident" id="4341269">DecodeRuneInString</span><span class="op" id="4341287">(</span><span class="ident" id="4341288">line</span><span class="op" id="4341292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341295">if</span>&nbsp;<span class="op" id="4341298">!</span><span class="ident" id="4341299">unicode</span><span class="op" id="4341306">.</span><span class="ident" id="4341307">IsLetter</span><span class="op" id="4341315">(</span><span class="ident" id="4341316">r</span><span class="op" id="4341317">)</span>&nbsp;<span class="op" id="4341319">||</span>&nbsp;<span class="op" id="4341322">!</span><span class="ident" id="4341323">unicode</span><span class="op" id="4341330">.</span><span class="ident" id="4341331">IsUpper</span><span class="op" id="4341338">(</span><span class="ident" id="4341339">r</span><span class="op" id="4341340">)</span>&nbsp;<span class="op" id="4341342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341346">return</span>&nbsp;<span class="string" id="4341353">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341357">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4341361">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341399">r</span><span class="op" id="4341400">,</span>&nbsp;<span class="ident" id="4341402">_</span>&nbsp;<span class="op" id="4341404">=</span>&nbsp;<span class="ident" id="4341406">utf8</span><span class="op" id="4341410">.</span><span class="ident" id="4341411">DecodeLastRuneInString</span><span class="op" id="4341433">(</span><span class="ident" id="4341434">line</span><span class="op" id="4341438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341441">if</span>&nbsp;<span class="op" id="4341444">!</span><span class="ident" id="4341445">unicode</span><span class="op" id="4341452">.</span><span class="ident" id="4341453">IsLetter</span><span class="op" id="4341461">(</span><span class="ident" id="4341462">r</span><span class="op" id="4341463">)</span>&nbsp;<span class="op" id="4341465">&amp;&amp;</span>&nbsp;<span class="op" id="4341468">!</span><span class="ident" id="4341469">unicode</span><span class="op" id="4341476">.</span><span class="ident" id="4341477">IsDigit</span><span class="op" id="4341484">(</span><span class="ident" id="4341485">r</span><span class="op" id="4341486">)</span>&nbsp;<span class="op" id="4341488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341492">return</span>&nbsp;<span class="string" id="4341499">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4341507">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341549">if</span>&nbsp;<span class="ident" id="4341552">strings</span><span class="op" id="4341559">.</span><span class="ident" id="4341560">IndexAny</span><span class="op" id="4341568">(</span><span class="ident" id="4341569">line</span><span class="op" id="4341573">,</span>&nbsp;<span class="string" id="4341575">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="4341610">)</span>&nbsp;<span class="op" id="4341612">&gt;=</span>&nbsp;<span class="num" id="4341615">0</span>&nbsp;<span class="op" id="4341617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341621">return</span>&nbsp;<span class="string" id="4341628">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4341636">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341675">for</span>&nbsp;<span class="ident" id="4341679">b</span>&nbsp;<span class="op" id="4341681">:=</span>&nbsp;<span class="ident" id="4341684">line</span><span class="op" id="4341688">;</span>&nbsp;<span class="op" id="4341690">;</span>&nbsp;<span class="op" id="4341692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341696">i</span>&nbsp;<span class="op" id="4341698">:=</span>&nbsp;<span class="ident" id="4341701">strings</span><span class="op" id="4341708">.</span><span class="ident" id="4341709">IndexRune</span><span class="op" id="4341718">(</span><span class="ident" id="4341719">b</span><span class="op" id="4341720">,</span>&nbsp;<span class="string" id="4341722">&#39;\&#39;&#39;</span><span class="op" id="4341726">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341730">if</span>&nbsp;<span class="ident" id="4341733">i</span>&nbsp;<span class="op" id="4341735">&lt;</span>&nbsp;<span class="num" id="4341737">0</span>&nbsp;<span class="op" id="4341739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341744">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341756">if</span>&nbsp;<span class="ident" id="4341759">i</span><span class="op" id="4341760">+</span><span class="num" id="4341761">1</span>&nbsp;<span class="op" id="4341763">&gt;=</span>&nbsp;<span class="builtinfunc" id="4341766">len</span><span class="op" id="4341769">(</span><span class="ident" id="4341770">b</span><span class="op" id="4341771">)</span>&nbsp;<span class="op" id="4341773">||</span>&nbsp;<span class="ident" id="4341776">b</span><span class="op" id="4341777">[</span><span class="ident" id="4341778">i</span><span class="op" id="4341779">+</span><span class="num" id="4341780">1</span><span class="op" id="4341781">]</span>&nbsp;<span class="op" id="4341783">!=</span>&nbsp;<span class="string" id="4341786">&#39;s&#39;</span>&nbsp;<span class="op" id="4341790">||</span>&nbsp;<span class="op" id="4341793">(</span><span class="ident" id="4341794">i</span><span class="op" id="4341795">+</span><span class="num" id="4341796">2</span>&nbsp;<span class="op" id="4341798">&lt;</span>&nbsp;<span class="builtinfunc" id="4341800">len</span><span class="op" id="4341803">(</span><span class="ident" id="4341804">b</span><span class="op" id="4341805">)</span>&nbsp;<span class="op" id="4341807">&amp;&amp;</span>&nbsp;<span class="ident" id="4341810">b</span><span class="op" id="4341811">[</span><span class="ident" id="4341812">i</span><span class="op" id="4341813">+</span><span class="num" id="4341814">2</span><span class="op" id="4341815">]</span>&nbsp;<span class="op" id="4341817">!=</span>&nbsp;<span class="string" id="4341820">&#39;&nbsp;&#39;</span><span class="op" id="4341823">)</span>&nbsp;<span class="op" id="4341825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341830">return</span>&nbsp;<span class="string" id="4341837">&#34;&#34;</span>&nbsp;<span class="comment" id="4341840">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341870">b</span>&nbsp;<span class="op" id="4341872">=</span>&nbsp;<span class="ident" id="4341874">b</span><span class="op" id="4341875">[</span><span class="ident" id="4341876">i</span><span class="op" id="4341877">+</span><span class="num" id="4341878">2</span><span class="op" id="4341879">:</span><span class="op" id="4341880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341887">return</span>&nbsp;<span class="ident" id="4341894">line</span><br>
<span class="lineno">245</span><span class="op" id="4341899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341902">type</span>&nbsp;<span class="ident" id="4341907">op</span>&nbsp;<span class="builtintype" id="4341910">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341915">const</span>&nbsp;<span class="op" id="4341921">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341924">opPara</span>&nbsp;<span class="ident" id="4341931">op</span>&nbsp;<span class="op" id="4341934">=</span>&nbsp;<span class="ident" id="4341936">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341942">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341950">opPre</span><br>
<span class="lineno"></span><span class="op" id="4341956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="4341959">type</span>&nbsp;<span class="ident" id="4341964">block</span>&nbsp;<span class="keyword" id="4341970">struct</span>&nbsp;<span class="op" id="4341977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341980">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341986">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341990">lines</span>&nbsp;<span class="op" id="4341996">[</span><span class="op" id="4341997">]</span><span class="builtintype" id="4341998">string</span><br>
<span class="lineno"></span><span class="op" id="4342005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="4342008">var</span>&nbsp;<span class="ident" id="4342012">nonAlphaNumRx</span>&nbsp;<span class="op" id="4342026">=</span>&nbsp;<span class="ident" id="4342028">regexp</span><span class="op" id="4342034">.</span><span class="ident" id="4342035">MustCompile</span><span class="op" id="4342046">(</span><span class="string" id="4342047">`[^a-zA-Z0-9]`</span><span class="op" id="4342061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4342064">func</span>&nbsp;<span class="ident" id="4342069">anchorID</span><span class="op" id="4342077">(</span><span class="ident" id="4342078">line</span>&nbsp;<span class="builtintype" id="4342083">string</span><span class="op" id="4342089">)</span>&nbsp;<span class="builtintype" id="4342091">string</span>&nbsp;<span class="op" id="4342098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4342101">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4342181">return</span>&nbsp;<span class="string" id="4342188">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="4342195">+</span>&nbsp;<span class="ident" id="4342197">nonAlphaNumRx</span><span class="op" id="4342210">.</span><span class="ident" id="4342211">ReplaceAllString</span><span class="op" id="4342227">(</span><span class="ident" id="4342228">line</span><span class="op" id="4342232">,</span>&nbsp;<span class="string" id="4342234">&#34;_&#34;</span><span class="op" id="4342237">)</span><br>
<span class="lineno">265</span><span class="op" id="4342239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342242">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="4342293">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="4342335">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="4342395">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="4342447">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4342497">//</span><br>
<span class="lineno"></span><span class="comment" id="4342500">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4342561">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="4342632">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="4342701">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="4342762">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="4342792">//</span><br>
<span class="lineno"></span><span class="comment" id="4342795">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="4342856">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4342898">//</span><br>
<span class="lineno"></span><span class="comment" id="4342901">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="4342979">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="4343057">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="4343126">//</span><br>
<span class="lineno"></span><span class="comment" id="4343129">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4343213">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="4343300">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="4343316">func</span>&nbsp;<span class="ident" id="4343321">ToHTML</span><span class="op" id="4343327">(</span><span class="ident" id="4343328">w</span>&nbsp;<span class="ident" id="4343330">io</span><span class="op" id="4343332">.</span><span class="ident" id="4343333">Writer</span><span class="op" id="4343339">,</span>&nbsp;<span class="ident" id="4343341">text</span>&nbsp;<span class="builtintype" id="4343346">string</span><span class="op" id="4343352">,</span>&nbsp;<span class="ident" id="4343354">words</span>&nbsp;<span class="keyword" id="4343360">map</span><span class="op" id="4343363">[</span><span class="builtintype" id="4343364">string</span><span class="op" id="4343370">]</span><span class="builtintype" id="4343371">string</span><span class="op" id="4343377">)</span>&nbsp;<span class="op" id="4343379">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343382">for</span>&nbsp;<span class="ident" id="4343386">_</span><span class="op" id="4343387">,</span>&nbsp;<span class="ident" id="4343389">b</span>&nbsp;<span class="op" id="4343391">:=</span>&nbsp;<span class="keyword" id="4343394">range</span>&nbsp;<span class="ident" id="4343400">blocks</span><span class="op" id="4343406">(</span><span class="ident" id="4343407">text</span><span class="op" id="4343411">)</span>&nbsp;<span class="op" id="4343413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343417">switch</span>&nbsp;<span class="ident" id="4343424">b</span><span class="op" id="4343425">.</span><span class="ident" id="4343426">op</span>&nbsp;<span class="op" id="4343429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343433">case</span>&nbsp;<span class="ident" id="4343438">opPara</span><span class="op" id="4343444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343449">w</span><span class="op" id="4343450">.</span><span class="ident" id="4343451">Write</span><span class="op" id="4343456">(</span><span class="ident" id="4343457">html_p</span><span class="op" id="4343463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343468">for</span>&nbsp;<span class="ident" id="4343472">_</span><span class="op" id="4343473">,</span>&nbsp;<span class="ident" id="4343475">line</span>&nbsp;<span class="op" id="4343480">:=</span>&nbsp;<span class="keyword" id="4343483">range</span>&nbsp;<span class="ident" id="4343489">b</span><span class="op" id="4343490">.</span><span class="ident" id="4343491">lines</span>&nbsp;<span class="op" id="4343497">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343503">emphasize</span><span class="op" id="4343512">(</span><span class="ident" id="4343513">w</span><span class="op" id="4343514">,</span>&nbsp;<span class="ident" id="4343516">line</span><span class="op" id="4343520">,</span>&nbsp;<span class="ident" id="4343522">words</span><span class="op" id="4343527">,</span>&nbsp;<span class="builtintype" id="4343529">true</span><span class="op" id="4343533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343543">w</span><span class="op" id="4343544">.</span><span class="ident" id="4343545">Write</span><span class="op" id="4343550">(</span><span class="ident" id="4343551">html_endp</span><span class="op" id="4343560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343564">case</span>&nbsp;<span class="ident" id="4343569">opHead</span><span class="op" id="4343575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343580">w</span><span class="op" id="4343581">.</span><span class="ident" id="4343582">Write</span><span class="op" id="4343587">(</span><span class="ident" id="4343588">html_h</span><span class="op" id="4343594">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343599">id</span>&nbsp;<span class="op" id="4343602">:=</span>&nbsp;<span class="string" id="4343605">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343611">for</span>&nbsp;<span class="ident" id="4343615">_</span><span class="op" id="4343616">,</span>&nbsp;<span class="ident" id="4343618">line</span>&nbsp;<span class="op" id="4343623">:=</span>&nbsp;<span class="keyword" id="4343626">range</span>&nbsp;<span class="ident" id="4343632">b</span><span class="op" id="4343633">.</span><span class="ident" id="4343634">lines</span>&nbsp;<span class="op" id="4343640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343646">if</span>&nbsp;<span class="ident" id="4343649">id</span>&nbsp;<span class="op" id="4343652">==</span>&nbsp;<span class="string" id="4343655">&#34;&#34;</span>&nbsp;<span class="op" id="4343658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343665">id</span>&nbsp;<span class="op" id="4343668">=</span>&nbsp;<span class="ident" id="4343670">anchorID</span><span class="op" id="4343678">(</span><span class="ident" id="4343679">line</span><span class="op" id="4343683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343690">w</span><span class="op" id="4343691">.</span><span class="ident" id="4343692">Write</span><span class="op" id="4343697">(</span><span class="op" id="4343698">[</span><span class="op" id="4343699">]</span><span class="builtintype" id="4343700">byte</span><span class="op" id="4343704">(</span><span class="ident" id="4343705">id</span><span class="op" id="4343707">)</span><span class="op" id="4343708">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343715">w</span><span class="op" id="4343716">.</span><span class="ident" id="4343717">Write</span><span class="op" id="4343722">(</span><span class="ident" id="4343723">html_hq</span><span class="op" id="4343730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343742">commentEscape</span><span class="op" id="4343755">(</span><span class="ident" id="4343756">w</span><span class="op" id="4343757">,</span>&nbsp;<span class="ident" id="4343759">line</span><span class="op" id="4343763">,</span>&nbsp;<span class="builtintype" id="4343765">true</span><span class="op" id="4343769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343779">if</span>&nbsp;<span class="ident" id="4343782">id</span>&nbsp;<span class="op" id="4343785">==</span>&nbsp;<span class="string" id="4343788">&#34;&#34;</span>&nbsp;<span class="op" id="4343791">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343797">w</span><span class="op" id="4343798">.</span><span class="ident" id="4343799">Write</span><span class="op" id="4343804">(</span><span class="ident" id="4343805">html_hq</span><span class="op" id="4343812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343822">w</span><span class="op" id="4343823">.</span><span class="ident" id="4343824">Write</span><span class="op" id="4343829">(</span><span class="ident" id="4343830">html_endh</span><span class="op" id="4343839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343843">case</span>&nbsp;<span class="ident" id="4343848">opPre</span><span class="op" id="4343853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343858">w</span><span class="op" id="4343859">.</span><span class="ident" id="4343860">Write</span><span class="op" id="4343865">(</span><span class="ident" id="4343866">html_pre</span><span class="op" id="4343874">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4343879">for</span>&nbsp;<span class="ident" id="4343883">_</span><span class="op" id="4343884">,</span>&nbsp;<span class="ident" id="4343886">line</span>&nbsp;<span class="op" id="4343891">:=</span>&nbsp;<span class="keyword" id="4343894">range</span>&nbsp;<span class="ident" id="4343900">b</span><span class="op" id="4343901">.</span><span class="ident" id="4343902">lines</span>&nbsp;<span class="op" id="4343908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343914">emphasize</span><span class="op" id="4343923">(</span><span class="ident" id="4343924">w</span><span class="op" id="4343925">,</span>&nbsp;<span class="ident" id="4343927">line</span><span class="op" id="4343931">,</span>&nbsp;<span class="ident" id="4343933">nil</span><span class="op" id="4343936">,</span>&nbsp;<span class="builtintype" id="4343938">false</span><span class="op" id="4343943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343953">w</span><span class="op" id="4343954">.</span><span class="ident" id="4343955">Write</span><span class="op" id="4343960">(</span><span class="ident" id="4343961">html_endpre</span><span class="op" id="4343972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343976">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4343979">}</span><br>
<span class="lineno"></span><span class="op" id="4343981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343984">func</span>&nbsp;<span class="ident" id="4343989">blocks</span><span class="op" id="4343995">(</span><span class="ident" id="4343996">text</span>&nbsp;<span class="builtintype" id="4344001">string</span><span class="op" id="4344007">)</span>&nbsp;<span class="op" id="4344009">[</span><span class="op" id="4344010">]</span><span class="ident" id="4344011">block</span>&nbsp;<span class="op" id="4344017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344020">var</span>&nbsp;<span class="op" id="4344024">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344028">out</span>&nbsp;&nbsp;<span class="op" id="4344033">[</span><span class="op" id="4344034">]</span><span class="ident" id="4344035">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344043">para</span>&nbsp;<span class="op" id="4344048">[</span><span class="op" id="4344049">]</span><span class="builtintype" id="4344050">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344060">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4344075">=</span>&nbsp;<span class="builtintype" id="4344077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344085">lastWasHeading</span>&nbsp;<span class="op" id="4344100">=</span>&nbsp;<span class="builtintype" id="4344102">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4344113">close</span>&nbsp;<span class="op" id="4344119">:=</span>&nbsp;<span class="keyword" id="4344122">func</span><span class="op" id="4344126">(</span><span class="op" id="4344127">)</span>&nbsp;<span class="op" id="4344129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344133">if</span>&nbsp;<span class="ident" id="4344136">para</span>&nbsp;<span class="op" id="4344141">!=</span>&nbsp;<span class="ident" id="4344144">nil</span>&nbsp;<span class="op" id="4344148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344153">out</span>&nbsp;<span class="op" id="4344157">=</span>&nbsp;<span class="builtinfunc" id="4344159">append</span><span class="op" id="4344165">(</span><span class="ident" id="4344166">out</span><span class="op" id="4344169">,</span>&nbsp;<span class="ident" id="4344171">block</span><span class="op" id="4344176">{</span><span class="ident" id="4344177">opPara</span><span class="op" id="4344183">,</span>&nbsp;<span class="ident" id="4344185">para</span><span class="op" id="4344189">}</span><span class="op" id="4344190">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344195">para</span>&nbsp;<span class="op" id="4344200">=</span>&nbsp;<span class="ident" id="4344202">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344215">lines</span>&nbsp;<span class="op" id="4344221">:=</span>&nbsp;<span class="ident" id="4344224">strings</span><span class="op" id="4344231">.</span><span class="ident" id="4344232">SplitAfter</span><span class="op" id="4344242">(</span><span class="ident" id="4344243">text</span><span class="op" id="4344247">,</span>&nbsp;<span class="string" id="4344249">&#34;\n&#34;</span><span class="op" id="4344253">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344256">unindent</span><span class="op" id="4344264">(</span><span class="ident" id="4344265">lines</span><span class="op" id="4344270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344273">for</span>&nbsp;<span class="ident" id="4344277">i</span>&nbsp;<span class="op" id="4344279">:=</span>&nbsp;<span class="num" id="4344282">0</span><span class="op" id="4344283">;</span>&nbsp;<span class="ident" id="4344285">i</span>&nbsp;<span class="op" id="4344287">&lt;</span>&nbsp;<span class="builtinfunc" id="4344289">len</span><span class="op" id="4344292">(</span><span class="ident" id="4344293">lines</span><span class="op" id="4344298">)</span><span class="op" id="4344299">;</span>&nbsp;<span class="op" id="4344301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344305">line</span>&nbsp;<span class="op" id="4344310">:=</span>&nbsp;<span class="ident" id="4344313">lines</span><span class="op" id="4344318">[</span><span class="ident" id="4344319">i</span><span class="op" id="4344320">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344324">if</span>&nbsp;<span class="ident" id="4344327">isBlank</span><span class="op" id="4344334">(</span><span class="ident" id="4344335">line</span><span class="op" id="4344339">)</span>&nbsp;<span class="op" id="4344341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4344346">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4344368">close</span><span class="op" id="4344373">(</span><span class="op" id="4344374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344379">i</span><span class="op" id="4344380">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344386">lastWasBlank</span>&nbsp;<span class="op" id="4344399">=</span>&nbsp;<span class="builtintype" id="4344401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344409">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344420">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344424">if</span>&nbsp;<span class="ident" id="4344427">indentLen</span><span class="op" id="4344436">(</span><span class="ident" id="4344437">line</span><span class="op" id="4344441">)</span>&nbsp;<span class="op" id="4344443">&gt;</span>&nbsp;<span class="num" id="4344445">0</span>&nbsp;<span class="op" id="4344447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4344452">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4344474">close</span><span class="op" id="4344479">(</span><span class="op" id="4344480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4344486">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344522">j</span>&nbsp;<span class="op" id="4344524">:=</span>&nbsp;<span class="ident" id="4344527">i</span>&nbsp;<span class="op" id="4344529">+</span>&nbsp;<span class="num" id="4344531">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344536">for</span>&nbsp;<span class="ident" id="4344540">j</span>&nbsp;<span class="op" id="4344542">&lt;</span>&nbsp;<span class="builtinfunc" id="4344544">len</span><span class="op" id="4344547">(</span><span class="ident" id="4344548">lines</span><span class="op" id="4344553">)</span>&nbsp;<span class="op" id="4344555">&amp;&amp;</span>&nbsp;<span class="op" id="4344558">(</span><span class="ident" id="4344559">isBlank</span><span class="op" id="4344566">(</span><span class="ident" id="4344567">lines</span><span class="op" id="4344572">[</span><span class="ident" id="4344573">j</span><span class="op" id="4344574">]</span><span class="op" id="4344575">)</span>&nbsp;<span class="op" id="4344577">||</span>&nbsp;<span class="ident" id="4344580">indentLen</span><span class="op" id="4344589">(</span><span class="ident" id="4344590">lines</span><span class="op" id="4344595">[</span><span class="ident" id="4344596">j</span><span class="op" id="4344597">]</span><span class="op" id="4344598">)</span>&nbsp;<span class="op" id="4344600">&gt;</span>&nbsp;<span class="num" id="4344602">0</span><span class="op" id="4344603">)</span>&nbsp;<span class="op" id="4344605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344611">j</span><span class="op" id="4344612">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4344623">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344658">for</span>&nbsp;<span class="ident" id="4344662">j</span>&nbsp;<span class="op" id="4344664">&gt;</span>&nbsp;<span class="ident" id="4344666">i</span>&nbsp;<span class="op" id="4344668">&amp;&amp;</span>&nbsp;<span class="ident" id="4344671">isBlank</span><span class="op" id="4344678">(</span><span class="ident" id="4344679">lines</span><span class="op" id="4344684">[</span><span class="ident" id="4344685">j</span><span class="op" id="4344686">-</span><span class="num" id="4344687">1</span><span class="op" id="4344688">]</span><span class="op" id="4344689">)</span>&nbsp;<span class="op" id="4344691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344697">j</span><span class="op" id="4344698">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344709">pre</span>&nbsp;<span class="op" id="4344713">:=</span>&nbsp;<span class="ident" id="4344716">lines</span><span class="op" id="4344721">[</span><span class="ident" id="4344722">i</span><span class="op" id="4344723">:</span><span class="ident" id="4344724">j</span><span class="op" id="4344725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344730">i</span>&nbsp;<span class="op" id="4344732">=</span>&nbsp;<span class="ident" id="4344734">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344740">unindent</span><span class="op" id="4344748">(</span><span class="ident" id="4344749">pre</span><span class="op" id="4344752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4344758">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344795">out</span>&nbsp;<span class="op" id="4344799">=</span>&nbsp;<span class="builtinfunc" id="4344801">append</span><span class="op" id="4344807">(</span><span class="ident" id="4344808">out</span><span class="op" id="4344811">,</span>&nbsp;<span class="ident" id="4344813">block</span><span class="op" id="4344818">{</span><span class="ident" id="4344819">opPre</span><span class="op" id="4344824">,</span>&nbsp;<span class="ident" id="4344826">pre</span><span class="op" id="4344829">}</span><span class="op" id="4344830">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344835">lastWasHeading</span>&nbsp;<span class="op" id="4344850">=</span>&nbsp;<span class="builtintype" id="4344852">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344861">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4344872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4344877">if</span>&nbsp;<span class="ident" id="4344880">lastWasBlank</span>&nbsp;<span class="op" id="4344893">&amp;&amp;</span>&nbsp;<span class="op" id="4344896">!</span><span class="ident" id="4344897">lastWasHeading</span>&nbsp;<span class="op" id="4344912">&amp;&amp;</span>&nbsp;<span class="ident" id="4344915">i</span><span class="op" id="4344916">+</span><span class="num" id="4344917">2</span>&nbsp;<span class="op" id="4344919">&lt;</span>&nbsp;<span class="builtinfunc" id="4344921">len</span><span class="op" id="4344924">(</span><span class="ident" id="4344925">lines</span><span class="op" id="4344930">)</span>&nbsp;<span class="op" id="4344932">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344938">isBlank</span><span class="op" id="4344945">(</span><span class="ident" id="4344946">lines</span><span class="op" id="4344951">[</span><span class="ident" id="4344952">i</span><span class="op" id="4344953">+</span><span class="num" id="4344954">1</span><span class="op" id="4344955">]</span><span class="op" id="4344956">)</span>&nbsp;<span class="op" id="4344958">&amp;&amp;</span>&nbsp;<span class="op" id="4344961">!</span><span class="ident" id="4344962">isBlank</span><span class="op" id="4344969">(</span><span class="ident" id="4344970">lines</span><span class="op" id="4344975">[</span><span class="ident" id="4344976">i</span><span class="op" id="4344977">+</span><span class="num" id="4344978">2</span><span class="op" id="4344979">]</span><span class="op" id="4344980">)</span>&nbsp;<span class="op" id="4344982">&amp;&amp;</span>&nbsp;<span class="ident" id="4344985">indentLen</span><span class="op" id="4344994">(</span><span class="ident" id="4344995">lines</span><span class="op" id="4345000">[</span><span class="ident" id="4345001">i</span><span class="op" id="4345002">+</span><span class="num" id="4345003">2</span><span class="op" id="4345004">]</span><span class="op" id="4345005">)</span>&nbsp;<span class="op" id="4345007">==</span>&nbsp;<span class="num" id="4345010">0</span>&nbsp;<span class="op" id="4345012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345017">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345076">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345132">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345158">if</span>&nbsp;<span class="ident" id="4345161">head</span>&nbsp;<span class="op" id="4345166">:=</span>&nbsp;<span class="ident" id="4345169">heading</span><span class="op" id="4345176">(</span><span class="ident" id="4345177">line</span><span class="op" id="4345181">)</span><span class="op" id="4345182">;</span>&nbsp;<span class="ident" id="4345184">head</span>&nbsp;<span class="op" id="4345189">!=</span>&nbsp;<span class="string" id="4345192">&#34;&#34;</span>&nbsp;<span class="op" id="4345195">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4345201">close</span><span class="op" id="4345206">(</span><span class="op" id="4345207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345213">out</span>&nbsp;<span class="op" id="4345217">=</span>&nbsp;<span class="builtinfunc" id="4345219">append</span><span class="op" id="4345225">(</span><span class="ident" id="4345226">out</span><span class="op" id="4345229">,</span>&nbsp;<span class="ident" id="4345231">block</span><span class="op" id="4345236">{</span><span class="ident" id="4345237">opHead</span><span class="op" id="4345243">,</span>&nbsp;<span class="op" id="4345245">[</span><span class="op" id="4345246">]</span><span class="builtintype" id="4345247">string</span><span class="op" id="4345253">{</span><span class="ident" id="4345254">head</span><span class="op" id="4345258">}</span><span class="op" id="4345259">}</span><span class="op" id="4345260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345266">i</span>&nbsp;<span class="op" id="4345268">+=</span>&nbsp;<span class="num" id="4345271">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345277">lastWasHeading</span>&nbsp;<span class="op" id="4345292">=</span>&nbsp;<span class="builtintype" id="4345294">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345303">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345324">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345344">lastWasBlank</span>&nbsp;<span class="op" id="4345357">=</span>&nbsp;<span class="builtintype" id="4345359">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345367">lastWasHeading</span>&nbsp;<span class="op" id="4345382">=</span>&nbsp;<span class="builtintype" id="4345384">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345392">para</span>&nbsp;<span class="op" id="4345397">=</span>&nbsp;<span class="builtinfunc" id="4345399">append</span><span class="op" id="4345405">(</span><span class="ident" id="4345406">para</span><span class="op" id="4345410">,</span>&nbsp;<span class="ident" id="4345412">lines</span><span class="op" id="4345417">[</span><span class="ident" id="4345418">i</span><span class="op" id="4345419">]</span><span class="op" id="4345420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345424">i</span><span class="op" id="4345425">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4345432">close</span><span class="op" id="4345437">(</span><span class="op" id="4345438">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345442">return</span>&nbsp;<span class="ident" id="4345449">out</span><br>
<span class="lineno"></span><span class="op" id="4345453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4345456">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="4345524">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="4345593">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="4345667">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="4345742">func</span>&nbsp;<span class="ident" id="4345747">ToText</span><span class="op" id="4345753">(</span><span class="ident" id="4345754">w</span>&nbsp;<span class="ident" id="4345756">io</span><span class="op" id="4345758">.</span><span class="ident" id="4345759">Writer</span><span class="op" id="4345765">,</span>&nbsp;<span class="ident" id="4345767">text</span>&nbsp;<span class="builtintype" id="4345772">string</span><span class="op" id="4345778">,</span>&nbsp;<span class="ident" id="4345780">indent</span><span class="op" id="4345786">,</span>&nbsp;<span class="ident" id="4345788">preIndent</span>&nbsp;<span class="builtintype" id="4345798">string</span><span class="op" id="4345804">,</span>&nbsp;<span class="ident" id="4345806">width</span>&nbsp;<span class="builtintype" id="4345812">int</span><span class="op" id="4345815">)</span>&nbsp;<span class="op" id="4345817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345820">l</span>&nbsp;<span class="op" id="4345822">:=</span>&nbsp;<span class="ident" id="4345825">lineWrapper</span><span class="op" id="4345836">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345840">out</span><span class="op" id="4345843">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345848">w</span><span class="op" id="4345849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345853">width</span><span class="op" id="4345858">:</span>&nbsp;&nbsp;<span class="ident" id="4345861">width</span><span class="op" id="4345866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345870">indent</span><span class="op" id="4345876">:</span>&nbsp;<span class="ident" id="4345878">indent</span><span class="op" id="4345884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345890">for</span>&nbsp;<span class="ident" id="4345894">_</span><span class="op" id="4345895">,</span>&nbsp;<span class="ident" id="4345897">b</span>&nbsp;<span class="op" id="4345899">:=</span>&nbsp;<span class="keyword" id="4345902">range</span>&nbsp;<span class="ident" id="4345908">blocks</span><span class="op" id="4345914">(</span><span class="ident" id="4345915">text</span><span class="op" id="4345919">)</span>&nbsp;<span class="op" id="4345921">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345925">switch</span>&nbsp;<span class="ident" id="4345932">b</span><span class="op" id="4345933">.</span><span class="ident" id="4345934">op</span>&nbsp;<span class="op" id="4345937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345941">case</span>&nbsp;<span class="ident" id="4345946">opPara</span><span class="op" id="4345952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345957">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346008">for</span>&nbsp;<span class="ident" id="4346012">_</span><span class="op" id="4346013">,</span>&nbsp;<span class="ident" id="4346015">line</span>&nbsp;<span class="op" id="4346020">:=</span>&nbsp;<span class="keyword" id="4346023">range</span>&nbsp;<span class="ident" id="4346029">b</span><span class="op" id="4346030">.</span><span class="ident" id="4346031">lines</span>&nbsp;<span class="op" id="4346037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346043">l</span><span class="op" id="4346044">.</span><span class="ident" id="4346045">write</span><span class="op" id="4346050">(</span><span class="ident" id="4346051">line</span><span class="op" id="4346055">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346065">l</span><span class="op" id="4346066">.</span><span class="ident" id="4346067">flush</span><span class="op" id="4346072">(</span><span class="op" id="4346073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346077">case</span>&nbsp;<span class="ident" id="4346082">opHead</span><span class="op" id="4346088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346093">w</span><span class="op" id="4346094">.</span><span class="ident" id="4346095">Write</span><span class="op" id="4346100">(</span><span class="ident" id="4346101">nl</span><span class="op" id="4346103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346108">for</span>&nbsp;<span class="ident" id="4346112">_</span><span class="op" id="4346113">,</span>&nbsp;<span class="ident" id="4346115">line</span>&nbsp;<span class="op" id="4346120">:=</span>&nbsp;<span class="keyword" id="4346123">range</span>&nbsp;<span class="ident" id="4346129">b</span><span class="op" id="4346130">.</span><span class="ident" id="4346131">lines</span>&nbsp;<span class="op" id="4346137">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346143">l</span><span class="op" id="4346144">.</span><span class="ident" id="4346145">write</span><span class="op" id="4346150">(</span><span class="ident" id="4346151">line</span>&nbsp;<span class="op" id="4346156">+</span>&nbsp;<span class="string" id="4346158">&#34;\n&#34;</span><span class="op" id="4346162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346172">l</span><span class="op" id="4346173">.</span><span class="ident" id="4346174">flush</span><span class="op" id="4346179">(</span><span class="op" id="4346180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346184">case</span>&nbsp;<span class="ident" id="4346189">opPre</span><span class="op" id="4346194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346199">w</span><span class="op" id="4346200">.</span><span class="ident" id="4346201">Write</span><span class="op" id="4346206">(</span><span class="ident" id="4346207">nl</span><span class="op" id="4346209">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346214">for</span>&nbsp;<span class="ident" id="4346218">_</span><span class="op" id="4346219">,</span>&nbsp;<span class="ident" id="4346221">line</span>&nbsp;<span class="op" id="4346226">:=</span>&nbsp;<span class="keyword" id="4346229">range</span>&nbsp;<span class="ident" id="4346235">b</span><span class="op" id="4346236">.</span><span class="ident" id="4346237">lines</span>&nbsp;<span class="op" id="4346243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346249">if</span>&nbsp;<span class="ident" id="4346252">isBlank</span><span class="op" id="4346259">(</span><span class="ident" id="4346260">line</span><span class="op" id="4346264">)</span>&nbsp;<span class="op" id="4346266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346273">w</span><span class="op" id="4346274">.</span><span class="ident" id="4346275">Write</span><span class="op" id="4346280">(</span><span class="op" id="4346281">[</span><span class="op" id="4346282">]</span><span class="builtintype" id="4346283">byte</span><span class="op" id="4346287">(</span><span class="string" id="4346288">&#34;\n&#34;</span><span class="op" id="4346292">)</span><span class="op" id="4346293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346299">}</span>&nbsp;<span class="keyword" id="4346301">else</span>&nbsp;<span class="op" id="4346306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346313">w</span><span class="op" id="4346314">.</span><span class="ident" id="4346315">Write</span><span class="op" id="4346320">(</span><span class="op" id="4346321">[</span><span class="op" id="4346322">]</span><span class="builtintype" id="4346323">byte</span><span class="op" id="4346327">(</span><span class="ident" id="4346328">preIndent</span><span class="op" id="4346337">)</span><span class="op" id="4346338">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346345">w</span><span class="op" id="4346346">.</span><span class="ident" id="4346347">Write</span><span class="op" id="4346352">(</span><span class="op" id="4346353">[</span><span class="op" id="4346354">]</span><span class="builtintype" id="4346355">byte</span><span class="op" id="4346359">(</span><span class="ident" id="4346360">line</span><span class="op" id="4346364">)</span><span class="op" id="4346365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346383">}</span><br>
<span class="lineno">435</span><span class="op" id="4346385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4346388">type</span>&nbsp;<span class="ident" id="4346393">lineWrapper</span>&nbsp;<span class="keyword" id="4346405">struct</span>&nbsp;<span class="op" id="4346412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346415">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346425">io</span><span class="op" id="4346427">.</span><span class="ident" id="4346428">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346436">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4346446">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346452">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4346462">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346467">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4346477">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346485">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4346495">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346500">pendSpace</span>&nbsp;<span class="builtintype" id="4346510">int</span><br>
<span class="lineno"></span><span class="op" id="4346514">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="4346517">var</span>&nbsp;<span class="ident" id="4346521">nl</span>&nbsp;<span class="op" id="4346524">=</span>&nbsp;<span class="op" id="4346526">[</span><span class="op" id="4346527">]</span><span class="builtintype" id="4346528">byte</span><span class="op" id="4346532">(</span><span class="string" id="4346533">&#34;\n&#34;</span><span class="op" id="4346537">)</span><br>
<span class="lineno"></span><span class="keyword" id="4346539">var</span>&nbsp;<span class="ident" id="4346543">space</span>&nbsp;<span class="op" id="4346549">=</span>&nbsp;<span class="op" id="4346551">[</span><span class="op" id="4346552">]</span><span class="builtintype" id="4346553">byte</span><span class="op" id="4346557">(</span><span class="string" id="4346558">&#34;&nbsp;&#34;</span><span class="op" id="4346561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4346564">func</span>&nbsp;<span class="op" id="4346569">(</span><span class="ident" id="4346570">l</span>&nbsp;<span class="op" id="4346572">*</span><span class="ident" id="4346573">lineWrapper</span><span class="op" id="4346584">)</span>&nbsp;<span class="ident" id="4346586">write</span><span class="op" id="4346591">(</span><span class="ident" id="4346592">text</span>&nbsp;<span class="builtintype" id="4346597">string</span><span class="op" id="4346603">)</span>&nbsp;<span class="op" id="4346605">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346608">if</span>&nbsp;<span class="ident" id="4346611">l</span><span class="op" id="4346612">.</span><span class="ident" id="4346613">n</span>&nbsp;<span class="op" id="4346615">==</span>&nbsp;<span class="num" id="4346618">0</span>&nbsp;<span class="op" id="4346620">&amp;&amp;</span>&nbsp;<span class="ident" id="4346623">l</span><span class="op" id="4346624">.</span><span class="ident" id="4346625">printed</span>&nbsp;<span class="op" id="4346633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346637">l</span><span class="op" id="4346638">.</span><span class="ident" id="4346639">out</span><span class="op" id="4346642">.</span><span class="ident" id="4346643">Write</span><span class="op" id="4346648">(</span><span class="ident" id="4346649">nl</span><span class="op" id="4346651">)</span>&nbsp;<span class="comment" id="4346653">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346692">l</span><span class="op" id="4346693">.</span><span class="ident" id="4346694">printed</span>&nbsp;<span class="op" id="4346702">=</span>&nbsp;<span class="builtintype" id="4346704">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346711">for</span>&nbsp;<span class="ident" id="4346715">_</span><span class="op" id="4346716">,</span>&nbsp;<span class="ident" id="4346718">f</span>&nbsp;<span class="op" id="4346720">:=</span>&nbsp;<span class="keyword" id="4346723">range</span>&nbsp;<span class="ident" id="4346729">strings</span><span class="op" id="4346736">.</span><span class="ident" id="4346737">Fields</span><span class="op" id="4346743">(</span><span class="ident" id="4346744">text</span><span class="op" id="4346748">)</span>&nbsp;<span class="op" id="4346750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346754">w</span>&nbsp;<span class="op" id="4346756">:=</span>&nbsp;<span class="ident" id="4346759">utf8</span><span class="op" id="4346763">.</span><span class="ident" id="4346764">RuneCountInString</span><span class="op" id="4346781">(</span><span class="ident" id="4346782">f</span><span class="op" id="4346783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4346787">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346817">if</span>&nbsp;<span class="ident" id="4346820">l</span><span class="op" id="4346821">.</span><span class="ident" id="4346822">n</span>&nbsp;<span class="op" id="4346824">&gt;</span>&nbsp;<span class="num" id="4346826">0</span>&nbsp;<span class="op" id="4346828">&amp;&amp;</span>&nbsp;<span class="ident" id="4346831">l</span><span class="op" id="4346832">.</span><span class="ident" id="4346833">n</span><span class="op" id="4346834">+</span><span class="ident" id="4346835">l</span><span class="op" id="4346836">.</span><span class="ident" id="4346837">pendSpace</span><span class="op" id="4346846">+</span><span class="ident" id="4346847">w</span>&nbsp;<span class="op" id="4346849">&gt;</span>&nbsp;<span class="ident" id="4346851">l</span><span class="op" id="4346852">.</span><span class="ident" id="4346853">width</span>&nbsp;<span class="op" id="4346859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346864">l</span><span class="op" id="4346865">.</span><span class="ident" id="4346866">out</span><span class="op" id="4346869">.</span><span class="ident" id="4346870">Write</span><span class="op" id="4346875">(</span><span class="ident" id="4346876">nl</span><span class="op" id="4346878">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346883">l</span><span class="op" id="4346884">.</span><span class="ident" id="4346885">n</span>&nbsp;<span class="op" id="4346887">=</span>&nbsp;<span class="num" id="4346889">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346894">l</span><span class="op" id="4346895">.</span><span class="ident" id="4346896">pendSpace</span>&nbsp;<span class="op" id="4346906">=</span>&nbsp;<span class="num" id="4346908">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346916">if</span>&nbsp;<span class="ident" id="4346919">l</span><span class="op" id="4346920">.</span><span class="ident" id="4346921">n</span>&nbsp;<span class="op" id="4346923">==</span>&nbsp;<span class="num" id="4346926">0</span>&nbsp;<span class="op" id="4346928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346933">l</span><span class="op" id="4346934">.</span><span class="ident" id="4346935">out</span><span class="op" id="4346938">.</span><span class="ident" id="4346939">Write</span><span class="op" id="4346944">(</span><span class="op" id="4346945">[</span><span class="op" id="4346946">]</span><span class="builtintype" id="4346947">byte</span><span class="op" id="4346951">(</span><span class="ident" id="4346952">l</span><span class="op" id="4346953">.</span><span class="ident" id="4346954">indent</span><span class="op" id="4346960">)</span><span class="op" id="4346961">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346969">l</span><span class="op" id="4346970">.</span><span class="ident" id="4346971">out</span><span class="op" id="4346974">.</span><span class="ident" id="4346975">Write</span><span class="op" id="4346980">(</span><span class="ident" id="4346981">space</span><span class="op" id="4346986">[</span><span class="op" id="4346987">:</span><span class="ident" id="4346988">l</span><span class="op" id="4346989">.</span><span class="ident" id="4346990">pendSpace</span><span class="op" id="4346999">]</span><span class="op" id="4347000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347004">l</span><span class="op" id="4347005">.</span><span class="ident" id="4347006">out</span><span class="op" id="4347009">.</span><span class="ident" id="4347010">Write</span><span class="op" id="4347015">(</span><span class="op" id="4347016">[</span><span class="op" id="4347017">]</span><span class="builtintype" id="4347018">byte</span><span class="op" id="4347022">(</span><span class="ident" id="4347023">f</span><span class="op" id="4347024">)</span><span class="op" id="4347025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347029">l</span><span class="op" id="4347030">.</span><span class="ident" id="4347031">n</span>&nbsp;<span class="op" id="4347033">+=</span>&nbsp;<span class="ident" id="4347036">l</span><span class="op" id="4347037">.</span><span class="ident" id="4347038">pendSpace</span>&nbsp;<span class="op" id="4347048">+</span>&nbsp;<span class="ident" id="4347050">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347054">l</span><span class="op" id="4347055">.</span><span class="ident" id="4347056">pendSpace</span>&nbsp;<span class="op" id="4347066">=</span>&nbsp;<span class="num" id="4347068">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4347071">}</span><br>
<span class="lineno"></span><span class="op" id="4347073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4347076">func</span>&nbsp;<span class="op" id="4347081">(</span><span class="ident" id="4347082">l</span>&nbsp;<span class="op" id="4347084">*</span><span class="ident" id="4347085">lineWrapper</span><span class="op" id="4347096">)</span>&nbsp;<span class="ident" id="4347098">flush</span><span class="op" id="4347103">(</span><span class="op" id="4347104">)</span>&nbsp;<span class="op" id="4347106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4347109">if</span>&nbsp;<span class="ident" id="4347112">l</span><span class="op" id="4347113">.</span><span class="ident" id="4347114">n</span>&nbsp;<span class="op" id="4347116">==</span>&nbsp;<span class="num" id="4347119">0</span>&nbsp;<span class="op" id="4347121">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4347125">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4347133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347136">l</span><span class="op" id="4347137">.</span><span class="ident" id="4347138">out</span><span class="op" id="4347141">.</span><span class="ident" id="4347142">Write</span><span class="op" id="4347147">(</span><span class="ident" id="4347148">nl</span><span class="op" id="4347150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347153">l</span><span class="op" id="4347154">.</span><span class="ident" id="4347155">pendSpace</span>&nbsp;<span class="op" id="4347165">=</span>&nbsp;<span class="num" id="4347167">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347170">l</span><span class="op" id="4347171">.</span><span class="ident" id="4347172">n</span>&nbsp;<span class="op" id="4347174">=</span>&nbsp;<span class="num" id="4347176">0</span><br>
<span class="lineno">480</span><span class="op" id="4347178">}</span>
</div>
</body>
</html>
