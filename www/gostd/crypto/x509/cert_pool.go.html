<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4235665">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4235720">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4235774">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4235825">package</span>&nbsp;<span class="ident" id="4235833">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4235839">import</span>&nbsp;<span class="op" id="4235846">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4235849">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4235864">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4235867">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4235905">type</span>&nbsp;<span class="ident" id="4235910">CertPool</span>&nbsp;<span class="keyword" id="4235919">struct</span>&nbsp;<span class="op" id="4235926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235929">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4235944">map</span><span class="op" id="4235947">[</span><span class="builtintype" id="4235948">string</span><span class="op" id="4235954">]</span><span class="op" id="4235955">[</span><span class="op" id="4235956">]</span><span class="builtintype" id="4235957">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235962">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235977">map</span><span class="op" id="4235980">[</span><span class="builtintype" id="4235981">string</span><span class="op" id="4235987">]</span><span class="op" id="4235988">[</span><span class="op" id="4235989">]</span><span class="builtintype" id="4235990">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235995">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236010">[</span><span class="op" id="4236011">]</span><span class="op" id="4236012">*</span><span class="ident" id="4236013">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4236025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4236028">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4236074">func</span>&nbsp;<span class="ident" id="4236079">NewCertPool</span><span class="op" id="4236090">(</span><span class="op" id="4236091">)</span>&nbsp;<span class="op" id="4236093">*</span><span class="ident" id="4236094">CertPool</span>&nbsp;<span class="op" id="4236103">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236106">return</span>&nbsp;<span class="op" id="4236113">&amp;</span><span class="ident" id="4236114">CertPool</span><span class="op" id="4236122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4236126">make</span><span class="op" id="4236130">(</span><span class="keyword" id="4236131">map</span><span class="op" id="4236134">[</span><span class="builtintype" id="4236135">string</span><span class="op" id="4236141">]</span><span class="op" id="4236142">[</span><span class="op" id="4236143">]</span><span class="builtintype" id="4236144">int</span><span class="op" id="4236147">)</span><span class="op" id="4236148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4236152">make</span><span class="op" id="4236156">(</span><span class="keyword" id="4236157">map</span><span class="op" id="4236160">[</span><span class="builtintype" id="4236161">string</span><span class="op" id="4236167">]</span><span class="op" id="4236168">[</span><span class="op" id="4236169">]</span><span class="builtintype" id="4236170">int</span><span class="op" id="4236173">)</span><span class="op" id="4236174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236178">nil</span><span class="op" id="4236181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236184">}</span><br>
<span class="lineno">25</span><span class="op" id="4236186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4236189">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4236269">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4236348">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4236424">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4236437">func</span>&nbsp;<span class="op" id="4236442">(</span><span class="ident" id="4236443">s</span>&nbsp;<span class="op" id="4236445">*</span><span class="ident" id="4236446">CertPool</span><span class="op" id="4236454">)</span>&nbsp;<span class="ident" id="4236456">findVerifiedParents</span><span class="op" id="4236475">(</span><span class="ident" id="4236476">cert</span>&nbsp;<span class="op" id="4236481">*</span><span class="ident" id="4236482">Certificate</span><span class="op" id="4236493">)</span>&nbsp;<span class="op" id="4236495">(</span><span class="ident" id="4236496">parents</span>&nbsp;<span class="op" id="4236504">[</span><span class="op" id="4236505">]</span><span class="builtintype" id="4236506">int</span><span class="op" id="4236509">,</span>&nbsp;<span class="ident" id="4236511">errCert</span>&nbsp;<span class="op" id="4236519">*</span><span class="ident" id="4236520">Certificate</span><span class="op" id="4236531">,</span>&nbsp;<span class="ident" id="4236533">err</span>&nbsp;<span class="builtintype" id="4236537">error</span><span class="op" id="4236542">)</span>&nbsp;<span class="op" id="4236544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236547">if</span>&nbsp;<span class="ident" id="4236550">s</span>&nbsp;<span class="op" id="4236552">==</span>&nbsp;<span class="ident" id="4236555">nil</span>&nbsp;<span class="op" id="4236559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236563">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236571">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236574">var</span>&nbsp;<span class="ident" id="4236578">candidates</span>&nbsp;<span class="op" id="4236589">[</span><span class="op" id="4236590">]</span><span class="builtintype" id="4236591">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236597">if</span>&nbsp;<span class="builtinfunc" id="4236600">len</span><span class="op" id="4236603">(</span><span class="ident" id="4236604">cert</span><span class="op" id="4236608">.</span><span class="ident" id="4236609">AuthorityKeyId</span><span class="op" id="4236623">)</span>&nbsp;<span class="op" id="4236625">&gt;</span>&nbsp;<span class="num" id="4236627">0</span>&nbsp;<span class="op" id="4236629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236633">candidates</span>&nbsp;<span class="op" id="4236644">=</span>&nbsp;<span class="ident" id="4236646">s</span><span class="op" id="4236647">.</span><span class="ident" id="4236648">bySubjectKeyId</span><span class="op" id="4236662">[</span><span class="builtintype" id="4236663">string</span><span class="op" id="4236669">(</span><span class="ident" id="4236670">cert</span><span class="op" id="4236674">.</span><span class="ident" id="4236675">AuthorityKeyId</span><span class="op" id="4236689">)</span><span class="op" id="4236690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236693">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236696">if</span>&nbsp;<span class="builtinfunc" id="4236699">len</span><span class="op" id="4236702">(</span><span class="ident" id="4236703">candidates</span><span class="op" id="4236713">)</span>&nbsp;<span class="op" id="4236715">==</span>&nbsp;<span class="num" id="4236718">0</span>&nbsp;<span class="op" id="4236720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236724">candidates</span>&nbsp;<span class="op" id="4236735">=</span>&nbsp;<span class="ident" id="4236737">s</span><span class="op" id="4236738">.</span><span class="ident" id="4236739">byName</span><span class="op" id="4236745">[</span><span class="builtintype" id="4236746">string</span><span class="op" id="4236752">(</span><span class="ident" id="4236753">cert</span><span class="op" id="4236757">.</span><span class="ident" id="4236758">RawIssuer</span><span class="op" id="4236767">)</span><span class="op" id="4236768">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236775">for</span>&nbsp;<span class="ident" id="4236779">_</span><span class="op" id="4236780">,</span>&nbsp;<span class="ident" id="4236782">c</span>&nbsp;<span class="op" id="4236784">:=</span>&nbsp;<span class="keyword" id="4236787">range</span>&nbsp;<span class="ident" id="4236793">candidates</span>&nbsp;<span class="op" id="4236804">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236808">if</span>&nbsp;<span class="ident" id="4236811">err</span>&nbsp;<span class="op" id="4236815">=</span>&nbsp;<span class="ident" id="4236817">cert</span><span class="op" id="4236821">.</span><span class="ident" id="4236822">CheckSignatureFrom</span><span class="op" id="4236840">(</span><span class="ident" id="4236841">s</span><span class="op" id="4236842">.</span><span class="ident" id="4236843">certs</span><span class="op" id="4236848">[</span><span class="ident" id="4236849">c</span><span class="op" id="4236850">]</span><span class="op" id="4236851">)</span><span class="op" id="4236852">;</span>&nbsp;<span class="ident" id="4236854">err</span>&nbsp;<span class="op" id="4236858">==</span>&nbsp;<span class="ident" id="4236861">nil</span>&nbsp;<span class="op" id="4236865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236870">parents</span>&nbsp;<span class="op" id="4236878">=</span>&nbsp;<span class="builtinfunc" id="4236880">append</span><span class="op" id="4236886">(</span><span class="ident" id="4236887">parents</span><span class="op" id="4236894">,</span>&nbsp;<span class="ident" id="4236896">c</span><span class="op" id="4236897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236901">}</span>&nbsp;<span class="keyword" id="4236903">else</span>&nbsp;<span class="op" id="4236908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236913">errCert</span>&nbsp;<span class="op" id="4236921">=</span>&nbsp;<span class="ident" id="4236923">s</span><span class="op" id="4236924">.</span><span class="ident" id="4236925">certs</span><span class="op" id="4236930">[</span><span class="ident" id="4236931">c</span><span class="op" id="4236932">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236936">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236943">return</span><br>
<span class="lineno"></span><span class="op" id="4236950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4236953">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4236994">func</span>&nbsp;<span class="op" id="4236999">(</span><span class="ident" id="4237000">s</span>&nbsp;<span class="op" id="4237002">*</span><span class="ident" id="4237003">CertPool</span><span class="op" id="4237011">)</span>&nbsp;<span class="ident" id="4237013">AddCert</span><span class="op" id="4237020">(</span><span class="ident" id="4237021">cert</span>&nbsp;<span class="op" id="4237026">*</span><span class="ident" id="4237027">Certificate</span><span class="op" id="4237038">)</span>&nbsp;<span class="op" id="4237040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237043">if</span>&nbsp;<span class="ident" id="4237046">cert</span>&nbsp;<span class="op" id="4237051">==</span>&nbsp;<span class="ident" id="4237054">nil</span>&nbsp;<span class="op" id="4237058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4237062">panic</span><span class="op" id="4237067">(</span><span class="string" id="4237068">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4237104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237107">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4237111">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237167">for</span>&nbsp;<span class="ident" id="4237171">_</span><span class="op" id="4237172">,</span>&nbsp;<span class="ident" id="4237174">c</span>&nbsp;<span class="op" id="4237176">:=</span>&nbsp;<span class="keyword" id="4237179">range</span>&nbsp;<span class="ident" id="4237185">s</span><span class="op" id="4237186">.</span><span class="ident" id="4237187">certs</span>&nbsp;<span class="op" id="4237193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237197">if</span>&nbsp;<span class="ident" id="4237200">c</span><span class="op" id="4237201">.</span><span class="ident" id="4237202">Equal</span><span class="op" id="4237207">(</span><span class="ident" id="4237208">cert</span><span class="op" id="4237212">)</span>&nbsp;<span class="op" id="4237214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237219">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237235">n</span>&nbsp;<span class="op" id="4237237">:=</span>&nbsp;<span class="builtinfunc" id="4237240">len</span><span class="op" id="4237243">(</span><span class="ident" id="4237244">s</span><span class="op" id="4237245">.</span><span class="ident" id="4237246">certs</span><span class="op" id="4237251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237254">s</span><span class="op" id="4237255">.</span><span class="ident" id="4237256">certs</span>&nbsp;<span class="op" id="4237262">=</span>&nbsp;<span class="builtinfunc" id="4237264">append</span><span class="op" id="4237270">(</span><span class="ident" id="4237271">s</span><span class="op" id="4237272">.</span><span class="ident" id="4237273">certs</span><span class="op" id="4237278">,</span>&nbsp;<span class="ident" id="4237280">cert</span><span class="op" id="4237284">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237288">if</span>&nbsp;<span class="builtinfunc" id="4237291">len</span><span class="op" id="4237294">(</span><span class="ident" id="4237295">cert</span><span class="op" id="4237299">.</span><span class="ident" id="4237300">SubjectKeyId</span><span class="op" id="4237312">)</span>&nbsp;<span class="op" id="4237314">&gt;</span>&nbsp;<span class="num" id="4237316">0</span>&nbsp;<span class="op" id="4237318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237322">keyId</span>&nbsp;<span class="op" id="4237328">:=</span>&nbsp;<span class="builtintype" id="4237331">string</span><span class="op" id="4237337">(</span><span class="ident" id="4237338">cert</span><span class="op" id="4237342">.</span><span class="ident" id="4237343">SubjectKeyId</span><span class="op" id="4237355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237359">s</span><span class="op" id="4237360">.</span><span class="ident" id="4237361">bySubjectKeyId</span><span class="op" id="4237375">[</span><span class="ident" id="4237376">keyId</span><span class="op" id="4237381">]</span>&nbsp;<span class="op" id="4237383">=</span>&nbsp;<span class="builtinfunc" id="4237385">append</span><span class="op" id="4237391">(</span><span class="ident" id="4237392">s</span><span class="op" id="4237393">.</span><span class="ident" id="4237394">bySubjectKeyId</span><span class="op" id="4237408">[</span><span class="ident" id="4237409">keyId</span><span class="op" id="4237414">]</span><span class="op" id="4237415">,</span>&nbsp;<span class="ident" id="4237417">n</span><span class="op" id="4237418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237421">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237424">name</span>&nbsp;<span class="op" id="4237429">:=</span>&nbsp;<span class="builtintype" id="4237432">string</span><span class="op" id="4237438">(</span><span class="ident" id="4237439">cert</span><span class="op" id="4237443">.</span><span class="ident" id="4237444">RawSubject</span><span class="op" id="4237454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237457">s</span><span class="op" id="4237458">.</span><span class="ident" id="4237459">byName</span><span class="op" id="4237465">[</span><span class="ident" id="4237466">name</span><span class="op" id="4237470">]</span>&nbsp;<span class="op" id="4237472">=</span>&nbsp;<span class="builtinfunc" id="4237474">append</span><span class="op" id="4237480">(</span><span class="ident" id="4237481">s</span><span class="op" id="4237482">.</span><span class="ident" id="4237483">byName</span><span class="op" id="4237489">[</span><span class="ident" id="4237490">name</span><span class="op" id="4237494">]</span><span class="op" id="4237495">,</span>&nbsp;<span class="ident" id="4237497">n</span><span class="op" id="4237498">)</span><br>
<span class="lineno"></span><span class="op" id="4237500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4237503">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4237581">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4237660">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4237689">//</span><br>
<span class="lineno"></span><span class="comment" id="4237692">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4237769">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4237824">func</span>&nbsp;<span class="op" id="4237829">(</span><span class="ident" id="4237830">s</span>&nbsp;<span class="op" id="4237832">*</span><span class="ident" id="4237833">CertPool</span><span class="op" id="4237841">)</span>&nbsp;<span class="ident" id="4237843">AppendCertsFromPEM</span><span class="op" id="4237861">(</span><span class="ident" id="4237862">pemCerts</span>&nbsp;<span class="op" id="4237871">[</span><span class="op" id="4237872">]</span><span class="builtintype" id="4237873">byte</span><span class="op" id="4237877">)</span>&nbsp;<span class="op" id="4237879">(</span><span class="ident" id="4237880">ok</span>&nbsp;<span class="builtintype" id="4237883">bool</span><span class="op" id="4237887">)</span>&nbsp;<span class="op" id="4237889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237892">for</span>&nbsp;<span class="builtinfunc" id="4237896">len</span><span class="op" id="4237899">(</span><span class="ident" id="4237900">pemCerts</span><span class="op" id="4237908">)</span>&nbsp;<span class="op" id="4237910">&gt;</span>&nbsp;<span class="num" id="4237912">0</span>&nbsp;<span class="op" id="4237914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237918">var</span>&nbsp;<span class="ident" id="4237922">block</span>&nbsp;<span class="op" id="4237928">*</span><span class="ident" id="4237929">pem</span><span class="op" id="4237932">.</span><span class="ident" id="4237933">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237941">block</span><span class="op" id="4237946">,</span>&nbsp;<span class="ident" id="4237948">pemCerts</span>&nbsp;<span class="op" id="4237957">=</span>&nbsp;<span class="ident" id="4237959">pem</span><span class="op" id="4237962">.</span><span class="ident" id="4237963">Decode</span><span class="op" id="4237969">(</span><span class="ident" id="4237970">pemCerts</span><span class="op" id="4237978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237982">if</span>&nbsp;<span class="ident" id="4237985">block</span>&nbsp;<span class="op" id="4237991">==</span>&nbsp;<span class="ident" id="4237994">nil</span>&nbsp;<span class="op" id="4237998">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238003">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238015">if</span>&nbsp;<span class="ident" id="4238018">block</span><span class="op" id="4238023">.</span><span class="ident" id="4238024">Type</span>&nbsp;<span class="op" id="4238029">!=</span>&nbsp;<span class="string" id="4238032">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4238046">||</span>&nbsp;<span class="builtinfunc" id="4238049">len</span><span class="op" id="4238052">(</span><span class="ident" id="4238053">block</span><span class="op" id="4238058">.</span><span class="ident" id="4238059">Headers</span><span class="op" id="4238066">)</span>&nbsp;<span class="op" id="4238068">!=</span>&nbsp;<span class="num" id="4238071">0</span>&nbsp;<span class="op" id="4238073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238078">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238089">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238094">cert</span><span class="op" id="4238098">,</span>&nbsp;<span class="ident" id="4238100">err</span>&nbsp;<span class="op" id="4238104">:=</span>&nbsp;<span class="ident" id="4238107">ParseCertificate</span><span class="op" id="4238123">(</span><span class="ident" id="4238124">block</span><span class="op" id="4238129">.</span><span class="ident" id="4238130">Bytes</span><span class="op" id="4238135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238139">if</span>&nbsp;<span class="ident" id="4238142">err</span>&nbsp;<span class="op" id="4238146">!=</span>&nbsp;<span class="ident" id="4238149">nil</span>&nbsp;<span class="op" id="4238153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238158">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238169">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238174">s</span><span class="op" id="4238175">.</span><span class="ident" id="4238176">AddCert</span><span class="op" id="4238183">(</span><span class="ident" id="4238184">cert</span><span class="op" id="4238188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238192">ok</span>&nbsp;<span class="op" id="4238195">=</span>&nbsp;<span class="builtintype" id="4238197">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238207">return</span><br>
<span class="lineno"></span><span class="op" id="4238214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4238217">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4238275">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4238315">func</span>&nbsp;<span class="op" id="4238320">(</span><span class="ident" id="4238321">s</span>&nbsp;<span class="op" id="4238323">*</span><span class="ident" id="4238324">CertPool</span><span class="op" id="4238332">)</span>&nbsp;<span class="ident" id="4238334">Subjects</span><span class="op" id="4238342">(</span><span class="op" id="4238343">)</span>&nbsp;<span class="op" id="4238345">(</span><span class="ident" id="4238346">res</span>&nbsp;<span class="op" id="4238350">[</span><span class="op" id="4238351">]</span><span class="op" id="4238352">[</span><span class="op" id="4238353">]</span><span class="builtintype" id="4238354">byte</span><span class="op" id="4238358">)</span>&nbsp;<span class="op" id="4238360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238363">res</span>&nbsp;<span class="op" id="4238367">=</span>&nbsp;<span class="builtinfunc" id="4238369">make</span><span class="op" id="4238373">(</span><span class="op" id="4238374">[</span><span class="op" id="4238375">]</span><span class="op" id="4238376">[</span><span class="op" id="4238377">]</span><span class="builtintype" id="4238378">byte</span><span class="op" id="4238382">,</span>&nbsp;<span class="builtinfunc" id="4238384">len</span><span class="op" id="4238387">(</span><span class="ident" id="4238388">s</span><span class="op" id="4238389">.</span><span class="ident" id="4238390">certs</span><span class="op" id="4238395">)</span><span class="op" id="4238396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238399">for</span>&nbsp;<span class="ident" id="4238403">i</span><span class="op" id="4238404">,</span>&nbsp;<span class="ident" id="4238406">c</span>&nbsp;<span class="op" id="4238408">:=</span>&nbsp;<span class="keyword" id="4238411">range</span>&nbsp;<span class="ident" id="4238417">s</span><span class="op" id="4238418">.</span><span class="ident" id="4238419">certs</span>&nbsp;<span class="op" id="4238425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238429">res</span><span class="op" id="4238432">[</span><span class="ident" id="4238433">i</span><span class="op" id="4238434">]</span>&nbsp;<span class="op" id="4238436">=</span>&nbsp;<span class="ident" id="4238438">c</span><span class="op" id="4238439">.</span><span class="ident" id="4238440">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238452">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238455">return</span><br>
<span class="lineno"></span><span class="op" id="4238462">}</span>
</div>
</body>
</html>
