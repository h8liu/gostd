<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4219537">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4219592">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4219646">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4219697">package</span>&nbsp;<span class="ident" id="4219705">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4219710">import</span>&nbsp;<span class="op" id="4219717">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4219720">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4219738">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4219748">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4219754">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4219767">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4219774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4219777">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4219838">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="4219904">type</span>&nbsp;<span class="ident" id="4219909">Compressor</span>&nbsp;<span class="keyword" id="4219920">func</span><span class="op" id="4219924">(</span><span class="ident" id="4219925">io</span><span class="op" id="4219927">.</span><span class="ident" id="4219928">Writer</span><span class="op" id="4219934">)</span>&nbsp;<span class="op" id="4219936">(</span><span class="ident" id="4219937">io</span><span class="op" id="4219939">.</span><span class="ident" id="4219940">WriteCloser</span><span class="op" id="4219951">,</span>&nbsp;<span class="builtintype" id="4219953">error</span><span class="op" id="4219958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4219961">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="4220040">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4220114">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4220192">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="4220226">type</span>&nbsp;<span class="ident" id="4220231">Decompressor</span>&nbsp;<span class="keyword" id="4220244">func</span><span class="op" id="4220248">(</span><span class="ident" id="4220249">io</span><span class="op" id="4220251">.</span><span class="ident" id="4220252">Reader</span><span class="op" id="4220258">)</span>&nbsp;<span class="ident" id="4220260">io</span><span class="op" id="4220262">.</span><span class="ident" id="4220263">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4220275">var</span>&nbsp;<span class="ident" id="4220279">flateWriterPool</span>&nbsp;<span class="ident" id="4220295">sync</span><span class="op" id="4220299">.</span><span class="ident" id="4220300">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4220306">func</span>&nbsp;<span class="ident" id="4220311">newFlateWriter</span><span class="op" id="4220325">(</span><span class="ident" id="4220326">w</span>&nbsp;<span class="ident" id="4220328">io</span><span class="op" id="4220330">.</span><span class="ident" id="4220331">Writer</span><span class="op" id="4220337">)</span>&nbsp;<span class="ident" id="4220339">io</span><span class="op" id="4220341">.</span><span class="ident" id="4220342">WriteCloser</span>&nbsp;<span class="op" id="4220354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220357">fw</span><span class="op" id="4220359">,</span>&nbsp;<span class="ident" id="4220361">ok</span>&nbsp;<span class="op" id="4220364">:=</span>&nbsp;<span class="ident" id="4220367">flateWriterPool</span><span class="op" id="4220382">.</span><span class="ident" id="4220383">Get</span><span class="op" id="4220386">(</span><span class="op" id="4220387">)</span><span class="op" id="4220388">.</span><span class="op" id="4220389">(</span><span class="op" id="4220390">*</span><span class="ident" id="4220391">flate</span><span class="op" id="4220396">.</span><span class="ident" id="4220397">Writer</span><span class="op" id="4220403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220406">if</span>&nbsp;<span class="ident" id="4220409">ok</span>&nbsp;<span class="op" id="4220412">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220416">fw</span><span class="op" id="4220418">.</span><span class="ident" id="4220419">Reset</span><span class="op" id="4220424">(</span><span class="ident" id="4220425">w</span><span class="op" id="4220426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220429">}</span>&nbsp;<span class="keyword" id="4220431">else</span>&nbsp;<span class="op" id="4220436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220440">fw</span><span class="op" id="4220442">,</span>&nbsp;<span class="ident" id="4220444">_</span>&nbsp;<span class="op" id="4220446">=</span>&nbsp;<span class="ident" id="4220448">flate</span><span class="op" id="4220453">.</span><span class="ident" id="4220454">NewWriter</span><span class="op" id="4220463">(</span><span class="ident" id="4220464">w</span><span class="op" id="4220465">,</span>&nbsp;<span class="num" id="4220467">5</span><span class="op" id="4220468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220474">return</span>&nbsp;<span class="op" id="4220481">&amp;</span><span class="ident" id="4220482">pooledFlateWriter</span><span class="op" id="4220499">{</span><span class="ident" id="4220500">fw</span><span class="op" id="4220502">:</span>&nbsp;<span class="ident" id="4220504">fw</span><span class="op" id="4220506">}</span><br>
<span class="lineno">35</span><span class="op" id="4220508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4220511">type</span>&nbsp;<span class="ident" id="4220516">pooledFlateWriter</span>&nbsp;<span class="keyword" id="4220534">struct</span>&nbsp;<span class="op" id="4220541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220544">mu</span>&nbsp;<span class="ident" id="4220547">sync</span><span class="op" id="4220551">.</span><span class="ident" id="4220552">Mutex</span>&nbsp;<span class="comment" id="4220558">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220585">fw</span>&nbsp;<span class="op" id="4220588">*</span><span class="ident" id="4220589">flate</span><span class="op" id="4220594">.</span><span class="ident" id="4220595">Writer</span><br>
<span class="lineno">40</span><span class="op" id="4220602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4220605">func</span>&nbsp;<span class="op" id="4220610">(</span><span class="ident" id="4220611">w</span>&nbsp;<span class="op" id="4220613">*</span><span class="ident" id="4220614">pooledFlateWriter</span><span class="op" id="4220631">)</span>&nbsp;<span class="ident" id="4220633">Write</span><span class="op" id="4220638">(</span><span class="ident" id="4220639">p</span>&nbsp;<span class="op" id="4220641">[</span><span class="op" id="4220642">]</span><span class="builtintype" id="4220643">byte</span><span class="op" id="4220647">)</span>&nbsp;<span class="op" id="4220649">(</span><span class="ident" id="4220650">n</span>&nbsp;<span class="builtintype" id="4220652">int</span><span class="op" id="4220655">,</span>&nbsp;<span class="ident" id="4220657">err</span>&nbsp;<span class="builtintype" id="4220661">error</span><span class="op" id="4220666">)</span>&nbsp;<span class="op" id="4220668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220671">w</span><span class="op" id="4220672">.</span><span class="ident" id="4220673">mu</span><span class="op" id="4220675">.</span><span class="ident" id="4220676">Lock</span><span class="op" id="4220680">(</span><span class="op" id="4220681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220684">defer</span>&nbsp;<span class="ident" id="4220690">w</span><span class="op" id="4220691">.</span><span class="ident" id="4220692">mu</span><span class="op" id="4220694">.</span><span class="ident" id="4220695">Unlock</span><span class="op" id="4220701">(</span><span class="op" id="4220702">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220705">if</span>&nbsp;<span class="ident" id="4220708">w</span><span class="op" id="4220709">.</span><span class="ident" id="4220710">fw</span>&nbsp;<span class="op" id="4220713">==</span>&nbsp;<span class="ident" id="4220716">nil</span>&nbsp;<span class="op" id="4220720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220724">return</span>&nbsp;<span class="num" id="4220731">0</span><span class="op" id="4220732">,</span>&nbsp;<span class="ident" id="4220734">errors</span><span class="op" id="4220740">.</span><span class="ident" id="4220741">New</span><span class="op" id="4220744">(</span><span class="string" id="4220745">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="4220764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220770">return</span>&nbsp;<span class="ident" id="4220777">w</span><span class="op" id="4220778">.</span><span class="ident" id="4220779">fw</span><span class="op" id="4220781">.</span><span class="ident" id="4220782">Write</span><span class="op" id="4220787">(</span><span class="ident" id="4220788">p</span><span class="op" id="4220789">)</span><br>
<span class="lineno"></span><span class="op" id="4220791">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4220794">func</span>&nbsp;<span class="op" id="4220799">(</span><span class="ident" id="4220800">w</span>&nbsp;<span class="op" id="4220802">*</span><span class="ident" id="4220803">pooledFlateWriter</span><span class="op" id="4220820">)</span>&nbsp;<span class="ident" id="4220822">Close</span><span class="op" id="4220827">(</span><span class="op" id="4220828">)</span>&nbsp;<span class="builtintype" id="4220830">error</span>&nbsp;<span class="op" id="4220836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220839">w</span><span class="op" id="4220840">.</span><span class="ident" id="4220841">mu</span><span class="op" id="4220843">.</span><span class="ident" id="4220844">Lock</span><span class="op" id="4220848">(</span><span class="op" id="4220849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220852">defer</span>&nbsp;<span class="ident" id="4220858">w</span><span class="op" id="4220859">.</span><span class="ident" id="4220860">mu</span><span class="op" id="4220862">.</span><span class="ident" id="4220863">Unlock</span><span class="op" id="4220869">(</span><span class="op" id="4220870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220873">var</span>&nbsp;<span class="ident" id="4220877">err</span>&nbsp;<span class="builtintype" id="4220881">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220888">if</span>&nbsp;<span class="ident" id="4220891">w</span><span class="op" id="4220892">.</span><span class="ident" id="4220893">fw</span>&nbsp;<span class="op" id="4220896">!=</span>&nbsp;<span class="ident" id="4220899">nil</span>&nbsp;<span class="op" id="4220903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220907">err</span>&nbsp;<span class="op" id="4220911">=</span>&nbsp;<span class="ident" id="4220913">w</span><span class="op" id="4220914">.</span><span class="ident" id="4220915">fw</span><span class="op" id="4220917">.</span><span class="ident" id="4220918">Close</span><span class="op" id="4220923">(</span><span class="op" id="4220924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220928">flateWriterPool</span><span class="op" id="4220943">.</span><span class="ident" id="4220944">Put</span><span class="op" id="4220947">(</span><span class="ident" id="4220948">w</span><span class="op" id="4220949">.</span><span class="ident" id="4220950">fw</span><span class="op" id="4220952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220956">w</span><span class="op" id="4220957">.</span><span class="ident" id="4220958">fw</span>&nbsp;<span class="op" id="4220961">=</span>&nbsp;<span class="ident" id="4220963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220968">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220971">return</span>&nbsp;<span class="ident" id="4220978">err</span><br>
<span class="lineno"></span><span class="op" id="4220982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4220985">var</span>&nbsp;<span class="op" id="4220989">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220992">mu</span>&nbsp;<span class="ident" id="4220995">sync</span><span class="op" id="4220999">.</span><span class="ident" id="4221000">RWMutex</span>&nbsp;<span class="comment" id="4221008">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221053">compressors</span>&nbsp;<span class="op" id="4221065">=</span>&nbsp;<span class="keyword" id="4221067">map</span><span class="op" id="4221070">[</span><span class="builtintype" id="4221071">uint16</span><span class="op" id="4221077">]</span><span class="ident" id="4221078">Compressor</span><span class="op" id="4221088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221092">Store</span><span class="op" id="4221097">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="4221101">func</span><span class="op" id="4221105">(</span><span class="ident" id="4221106">w</span>&nbsp;<span class="ident" id="4221108">io</span><span class="op" id="4221110">.</span><span class="ident" id="4221111">Writer</span><span class="op" id="4221117">)</span>&nbsp;<span class="op" id="4221119">(</span><span class="ident" id="4221120">io</span><span class="op" id="4221122">.</span><span class="ident" id="4221123">WriteCloser</span><span class="op" id="4221134">,</span>&nbsp;<span class="builtintype" id="4221136">error</span><span class="op" id="4221141">)</span>&nbsp;<span class="op" id="4221143">{</span>&nbsp;<span class="keyword" id="4221145">return</span>&nbsp;<span class="op" id="4221152">&amp;</span><span class="ident" id="4221153">nopCloser</span><span class="op" id="4221162">{</span><span class="ident" id="4221163">w</span><span class="op" id="4221164">}</span><span class="op" id="4221165">,</span>&nbsp;<span class="ident" id="4221167">nil</span>&nbsp;<span class="op" id="4221171">}</span><span class="op" id="4221172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221176">Deflate</span><span class="op" id="4221183">:</span>&nbsp;<span class="keyword" id="4221185">func</span><span class="op" id="4221189">(</span><span class="ident" id="4221190">w</span>&nbsp;<span class="ident" id="4221192">io</span><span class="op" id="4221194">.</span><span class="ident" id="4221195">Writer</span><span class="op" id="4221201">)</span>&nbsp;<span class="op" id="4221203">(</span><span class="ident" id="4221204">io</span><span class="op" id="4221206">.</span><span class="ident" id="4221207">WriteCloser</span><span class="op" id="4221218">,</span>&nbsp;<span class="builtintype" id="4221220">error</span><span class="op" id="4221225">)</span>&nbsp;<span class="op" id="4221227">{</span>&nbsp;<span class="keyword" id="4221229">return</span>&nbsp;<span class="ident" id="4221236">newFlateWriter</span><span class="op" id="4221250">(</span><span class="ident" id="4221251">w</span><span class="op" id="4221252">)</span><span class="op" id="4221253">,</span>&nbsp;<span class="ident" id="4221255">nil</span>&nbsp;<span class="op" id="4221259">}</span><span class="op" id="4221260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4221263">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221267">decompressors</span>&nbsp;<span class="op" id="4221281">=</span>&nbsp;<span class="keyword" id="4221283">map</span><span class="op" id="4221286">[</span><span class="builtintype" id="4221287">uint16</span><span class="op" id="4221293">]</span><span class="ident" id="4221294">Decompressor</span><span class="op" id="4221306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221310">Store</span><span class="op" id="4221315">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4221319">ioutil</span><span class="op" id="4221325">.</span><span class="ident" id="4221326">NopCloser</span><span class="op" id="4221335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221339">Deflate</span><span class="op" id="4221346">:</span>&nbsp;<span class="ident" id="4221348">flate</span><span class="op" id="4221353">.</span><span class="ident" id="4221354">NewReader</span><span class="op" id="4221363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4221366">}</span><br>
<span class="lineno">75</span><span class="op" id="4221368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4221371">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="4221450">func</span>&nbsp;<span class="ident" id="4221455">RegisterDecompressor</span><span class="op" id="4221475">(</span><span class="ident" id="4221476">method</span>&nbsp;<span class="builtintype" id="4221483">uint16</span><span class="op" id="4221489">,</span>&nbsp;<span class="ident" id="4221491">d</span>&nbsp;<span class="ident" id="4221493">Decompressor</span><span class="op" id="4221505">)</span>&nbsp;<span class="op" id="4221507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221510">mu</span><span class="op" id="4221512">.</span><span class="ident" id="4221513">Lock</span><span class="op" id="4221517">(</span><span class="op" id="4221518">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4221521">defer</span>&nbsp;<span class="ident" id="4221527">mu</span><span class="op" id="4221529">.</span><span class="ident" id="4221530">Unlock</span><span class="op" id="4221536">(</span><span class="op" id="4221537">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4221541">if</span>&nbsp;<span class="ident" id="4221544">_</span><span class="op" id="4221545">,</span>&nbsp;<span class="ident" id="4221547">ok</span>&nbsp;<span class="op" id="4221550">:=</span>&nbsp;<span class="ident" id="4221553">decompressors</span><span class="op" id="4221566">[</span><span class="ident" id="4221567">method</span><span class="op" id="4221573">]</span><span class="op" id="4221574">;</span>&nbsp;<span class="ident" id="4221576">ok</span>&nbsp;<span class="op" id="4221579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4221583">panic</span><span class="op" id="4221588">(</span><span class="string" id="4221589">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="4221622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4221625">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221628">decompressors</span><span class="op" id="4221641">[</span><span class="ident" id="4221642">method</span><span class="op" id="4221648">]</span>&nbsp;<span class="op" id="4221650">=</span>&nbsp;<span class="ident" id="4221652">d</span><br>
<span class="lineno"></span><span class="op" id="4221654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4221657">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="4221735">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="4221789">func</span>&nbsp;<span class="ident" id="4221794">RegisterCompressor</span><span class="op" id="4221812">(</span><span class="ident" id="4221813">method</span>&nbsp;<span class="builtintype" id="4221820">uint16</span><span class="op" id="4221826">,</span>&nbsp;<span class="ident" id="4221828">comp</span>&nbsp;<span class="ident" id="4221833">Compressor</span><span class="op" id="4221843">)</span>&nbsp;<span class="op" id="4221845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221848">mu</span><span class="op" id="4221850">.</span><span class="ident" id="4221851">Lock</span><span class="op" id="4221855">(</span><span class="op" id="4221856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4221859">defer</span>&nbsp;<span class="ident" id="4221865">mu</span><span class="op" id="4221867">.</span><span class="ident" id="4221868">Unlock</span><span class="op" id="4221874">(</span><span class="op" id="4221875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4221879">if</span>&nbsp;<span class="ident" id="4221882">_</span><span class="op" id="4221883">,</span>&nbsp;<span class="ident" id="4221885">ok</span>&nbsp;<span class="op" id="4221888">:=</span>&nbsp;<span class="ident" id="4221891">compressors</span><span class="op" id="4221902">[</span><span class="ident" id="4221903">method</span><span class="op" id="4221909">]</span><span class="op" id="4221910">;</span>&nbsp;<span class="ident" id="4221912">ok</span>&nbsp;<span class="op" id="4221915">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4221919">panic</span><span class="op" id="4221924">(</span><span class="string" id="4221925">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="4221956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4221959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221962">compressors</span><span class="op" id="4221973">[</span><span class="ident" id="4221974">method</span><span class="op" id="4221980">]</span>&nbsp;<span class="op" id="4221982">=</span>&nbsp;<span class="ident" id="4221984">comp</span><br>
<span class="lineno"></span><span class="op" id="4221989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4221992">func</span>&nbsp;<span class="ident" id="4221997">compressor</span><span class="op" id="4222007">(</span><span class="ident" id="4222008">method</span>&nbsp;<span class="builtintype" id="4222015">uint16</span><span class="op" id="4222021">)</span>&nbsp;<span class="ident" id="4222023">Compressor</span>&nbsp;<span class="op" id="4222034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222037">mu</span><span class="op" id="4222039">.</span><span class="ident" id="4222040">RLock</span><span class="op" id="4222045">(</span><span class="op" id="4222046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4222049">defer</span>&nbsp;<span class="ident" id="4222055">mu</span><span class="op" id="4222057">.</span><span class="ident" id="4222058">RUnlock</span><span class="op" id="4222065">(</span><span class="op" id="4222066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4222069">return</span>&nbsp;<span class="ident" id="4222076">compressors</span><span class="op" id="4222087">[</span><span class="ident" id="4222088">method</span><span class="op" id="4222094">]</span><br>
<span class="lineno"></span><span class="op" id="4222096">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="4222099">func</span>&nbsp;<span class="ident" id="4222104">decompressor</span><span class="op" id="4222116">(</span><span class="ident" id="4222117">method</span>&nbsp;<span class="builtintype" id="4222124">uint16</span><span class="op" id="4222130">)</span>&nbsp;<span class="ident" id="4222132">Decompressor</span>&nbsp;<span class="op" id="4222145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222148">mu</span><span class="op" id="4222150">.</span><span class="ident" id="4222151">RLock</span><span class="op" id="4222156">(</span><span class="op" id="4222157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4222160">defer</span>&nbsp;<span class="ident" id="4222166">mu</span><span class="op" id="4222168">.</span><span class="ident" id="4222169">RUnlock</span><span class="op" id="4222176">(</span><span class="op" id="4222177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4222180">return</span>&nbsp;<span class="ident" id="4222187">decompressors</span><span class="op" id="4222200">[</span><span class="ident" id="4222201">method</span><span class="op" id="4222207">]</span><br>
<span class="lineno">110</span><span class="op" id="4222209">}</span>
</div>
</body>
</html>
