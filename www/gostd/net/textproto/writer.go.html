<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3002263">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3002319">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3002373">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3002424">package</span>&nbsp;<span class="ident" id="3002432">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3002443">import</span>&nbsp;<span class="op" id="3002450">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3002453">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3002462">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3002469">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3002474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002477">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3002532">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="3002596">type</span>&nbsp;<span class="ident" id="3002601">Writer</span>&nbsp;<span class="keyword" id="3002608">struct</span>&nbsp;<span class="op" id="3002615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002618">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3002622">*</span><span class="ident" id="3002623">bufio</span><span class="op" id="3002628">.</span><span class="ident" id="3002629">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002637">dot</span>&nbsp;<span class="op" id="3002641">*</span><span class="ident" id="3002642">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="3002652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3002655">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3002703">func</span>&nbsp;<span class="ident" id="3002708">NewWriter</span><span class="op" id="3002717">(</span><span class="ident" id="3002718">w</span>&nbsp;<span class="op" id="3002720">*</span><span class="ident" id="3002721">bufio</span><span class="op" id="3002726">.</span><span class="ident" id="3002727">Writer</span><span class="op" id="3002733">)</span>&nbsp;<span class="op" id="3002735">*</span><span class="ident" id="3002736">Writer</span>&nbsp;<span class="op" id="3002743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002746">return</span>&nbsp;<span class="op" id="3002753">&amp;</span><span class="ident" id="3002754">Writer</span><span class="op" id="3002760">{</span><span class="ident" id="3002761">W</span><span class="op" id="3002762">:</span>&nbsp;<span class="ident" id="3002764">w</span><span class="op" id="3002765">}</span><br>
<span class="lineno"></span><span class="op" id="3002767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3002770">var</span>&nbsp;<span class="ident" id="3002774">crnl</span>&nbsp;<span class="op" id="3002779">=</span>&nbsp;<span class="op" id="3002781">[</span><span class="op" id="3002782">]</span><span class="builtintype" id="3002783">byte</span><span class="op" id="3002787">{</span><span class="string" id="3002788">&#39;\r&#39;</span><span class="op" id="3002792">,</span>&nbsp;<span class="string" id="3002794">&#39;\n&#39;</span><span class="op" id="3002798">}</span><br>
<span class="lineno"></span><span class="keyword" id="3002800">var</span>&nbsp;<span class="ident" id="3002804">dotcrnl</span>&nbsp;<span class="op" id="3002812">=</span>&nbsp;<span class="op" id="3002814">[</span><span class="op" id="3002815">]</span><span class="builtintype" id="3002816">byte</span><span class="op" id="3002820">{</span><span class="string" id="3002821">&#39;.&#39;</span><span class="op" id="3002824">,</span>&nbsp;<span class="string" id="3002826">&#39;\r&#39;</span><span class="op" id="3002830">,</span>&nbsp;<span class="string" id="3002832">&#39;\n&#39;</span><span class="op" id="3002836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002839">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="3002899">func</span>&nbsp;<span class="op" id="3002904">(</span><span class="ident" id="3002905">w</span>&nbsp;<span class="op" id="3002907">*</span><span class="ident" id="3002908">Writer</span><span class="op" id="3002914">)</span>&nbsp;<span class="ident" id="3002916">PrintfLine</span><span class="op" id="3002926">(</span><span class="ident" id="3002927">format</span>&nbsp;<span class="builtintype" id="3002934">string</span><span class="op" id="3002940">,</span>&nbsp;<span class="ident" id="3002942">args</span>&nbsp;<span class="op" id="3002947">...</span><span class="keyword" id="3002950">interface</span><span class="op" id="3002959">{</span><span class="op" id="3002960">}</span><span class="op" id="3002961">)</span>&nbsp;<span class="builtintype" id="3002963">error</span>&nbsp;<span class="op" id="3002969">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002972">w</span><span class="op" id="3002973">.</span><span class="ident" id="3002974">closeDot</span><span class="op" id="3002982">(</span><span class="op" id="3002983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002986">fmt</span><span class="op" id="3002989">.</span><span class="ident" id="3002990">Fprintf</span><span class="op" id="3002997">(</span><span class="ident" id="3002998">w</span><span class="op" id="3002999">.</span><span class="ident" id="3003000">W</span><span class="op" id="3003001">,</span>&nbsp;<span class="ident" id="3003003">format</span><span class="op" id="3003009">,</span>&nbsp;<span class="ident" id="3003011">args</span><span class="op" id="3003015">...</span><span class="op" id="3003018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003021">w</span><span class="op" id="3003022">.</span><span class="ident" id="3003023">W</span><span class="op" id="3003024">.</span><span class="ident" id="3003025">Write</span><span class="op" id="3003030">(</span><span class="ident" id="3003031">crnl</span><span class="op" id="3003035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003038">return</span>&nbsp;<span class="ident" id="3003045">w</span><span class="op" id="3003046">.</span><span class="ident" id="3003047">W</span><span class="op" id="3003048">.</span><span class="ident" id="3003049">Flush</span><span class="op" id="3003054">(</span><span class="op" id="3003055">)</span><br>
<span class="lineno"></span><span class="op" id="3003057">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3003060">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3003137">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="3003196">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3003269">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3003331">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3003383">//</span><br>
<span class="lineno"></span><span class="comment" id="3003386">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3003473">func</span>&nbsp;<span class="op" id="3003478">(</span><span class="ident" id="3003479">w</span>&nbsp;<span class="op" id="3003481">*</span><span class="ident" id="3003482">Writer</span><span class="op" id="3003488">)</span>&nbsp;<span class="ident" id="3003490">DotWriter</span><span class="op" id="3003499">(</span><span class="op" id="3003500">)</span>&nbsp;<span class="ident" id="3003502">io</span><span class="op" id="3003504">.</span><span class="ident" id="3003505">WriteCloser</span>&nbsp;<span class="op" id="3003517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003520">w</span><span class="op" id="3003521">.</span><span class="ident" id="3003522">closeDot</span><span class="op" id="3003530">(</span><span class="op" id="3003531">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003534">w</span><span class="op" id="3003535">.</span><span class="ident" id="3003536">dot</span>&nbsp;<span class="op" id="3003540">=</span>&nbsp;<span class="op" id="3003542">&amp;</span><span class="ident" id="3003543">dotWriter</span><span class="op" id="3003552">{</span><span class="ident" id="3003553">w</span><span class="op" id="3003554">:</span>&nbsp;<span class="ident" id="3003556">w</span><span class="op" id="3003557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003560">return</span>&nbsp;<span class="ident" id="3003567">w</span><span class="op" id="3003568">.</span><span class="ident" id="3003569">dot</span><br>
<span class="lineno"></span><span class="op" id="3003573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3003576">func</span>&nbsp;<span class="op" id="3003581">(</span><span class="ident" id="3003582">w</span>&nbsp;<span class="op" id="3003584">*</span><span class="ident" id="3003585">Writer</span><span class="op" id="3003591">)</span>&nbsp;<span class="ident" id="3003593">closeDot</span><span class="op" id="3003601">(</span><span class="op" id="3003602">)</span>&nbsp;<span class="op" id="3003604">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003607">if</span>&nbsp;<span class="ident" id="3003610">w</span><span class="op" id="3003611">.</span><span class="ident" id="3003612">dot</span>&nbsp;<span class="op" id="3003616">!=</span>&nbsp;<span class="ident" id="3003619">nil</span>&nbsp;<span class="op" id="3003623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003627">w</span><span class="op" id="3003628">.</span><span class="ident" id="3003629">dot</span><span class="op" id="3003632">.</span><span class="ident" id="3003633">Close</span><span class="op" id="3003638">(</span><span class="op" id="3003639">)</span>&nbsp;<span class="comment" id="3003641">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003662">}</span><br>
<span class="lineno"></span><span class="op" id="3003664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3003667">type</span>&nbsp;<span class="ident" id="3003672">dotWriter</span>&nbsp;<span class="keyword" id="3003682">struct</span>&nbsp;<span class="op" id="3003689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003692">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003698">*</span><span class="ident" id="3003699">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003707">state</span>&nbsp;<span class="builtintype" id="3003713">int</span><br>
<span class="lineno"></span><span class="op" id="3003717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3003720">const</span>&nbsp;<span class="op" id="3003726">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003729">wstateBeginLine</span>&nbsp;<span class="op" id="3003745">=</span>&nbsp;<span class="ident" id="3003747">iota</span>&nbsp;<span class="comment" id="3003752">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003803">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003826">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003865">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003888">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="3003922">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3003925">func</span>&nbsp;<span class="op" id="3003930">(</span><span class="ident" id="3003931">d</span>&nbsp;<span class="op" id="3003933">*</span><span class="ident" id="3003934">dotWriter</span><span class="op" id="3003943">)</span>&nbsp;<span class="ident" id="3003945">Write</span><span class="op" id="3003950">(</span><span class="ident" id="3003951">b</span>&nbsp;<span class="op" id="3003953">[</span><span class="op" id="3003954">]</span><span class="builtintype" id="3003955">byte</span><span class="op" id="3003959">)</span>&nbsp;<span class="op" id="3003961">(</span><span class="ident" id="3003962">n</span>&nbsp;<span class="builtintype" id="3003964">int</span><span class="op" id="3003967">,</span>&nbsp;<span class="ident" id="3003969">err</span>&nbsp;<span class="builtintype" id="3003973">error</span><span class="op" id="3003978">)</span>&nbsp;<span class="op" id="3003980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003983">bw</span>&nbsp;<span class="op" id="3003986">:=</span>&nbsp;<span class="ident" id="3003989">d</span><span class="op" id="3003990">.</span><span class="ident" id="3003991">w</span><span class="op" id="3003992">.</span><span class="ident" id="3003993">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003996">for</span>&nbsp;<span class="ident" id="3004000">n</span>&nbsp;<span class="op" id="3004002">&lt;</span>&nbsp;<span class="builtinfunc" id="3004004">len</span><span class="op" id="3004007">(</span><span class="ident" id="3004008">b</span><span class="op" id="3004009">)</span>&nbsp;<span class="op" id="3004011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004015">c</span>&nbsp;<span class="op" id="3004017">:=</span>&nbsp;<span class="ident" id="3004020">b</span><span class="op" id="3004021">[</span><span class="ident" id="3004022">n</span><span class="op" id="3004023">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004027">switch</span>&nbsp;<span class="ident" id="3004034">d</span><span class="op" id="3004035">.</span><span class="ident" id="3004036">state</span>&nbsp;<span class="op" id="3004042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004046">case</span>&nbsp;<span class="ident" id="3004051">wstateBeginLine</span><span class="op" id="3004066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004071">d</span><span class="op" id="3004072">.</span><span class="ident" id="3004073">state</span>&nbsp;<span class="op" id="3004079">=</span>&nbsp;<span class="ident" id="3004081">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004095">if</span>&nbsp;<span class="ident" id="3004098">c</span>&nbsp;<span class="op" id="3004100">==</span>&nbsp;<span class="string" id="3004103">&#39;.&#39;</span>&nbsp;<span class="op" id="3004107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004113">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004139">bw</span><span class="op" id="3004141">.</span><span class="ident" id="3004142">WriteByte</span><span class="op" id="3004151">(</span><span class="string" id="3004152">&#39;.&#39;</span><span class="op" id="3004155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004165">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004180">case</span>&nbsp;<span class="ident" id="3004185">wstateData</span><span class="op" id="3004195">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004200">if</span>&nbsp;<span class="ident" id="3004203">c</span>&nbsp;<span class="op" id="3004205">==</span>&nbsp;<span class="string" id="3004208">&#39;\r&#39;</span>&nbsp;<span class="op" id="3004213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004219">d</span><span class="op" id="3004220">.</span><span class="ident" id="3004221">state</span>&nbsp;<span class="op" id="3004227">=</span>&nbsp;<span class="ident" id="3004229">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004246">if</span>&nbsp;<span class="ident" id="3004249">c</span>&nbsp;<span class="op" id="3004251">==</span>&nbsp;<span class="string" id="3004254">&#39;\n&#39;</span>&nbsp;<span class="op" id="3004259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004265">bw</span><span class="op" id="3004267">.</span><span class="ident" id="3004268">WriteByte</span><span class="op" id="3004277">(</span><span class="string" id="3004278">&#39;\r&#39;</span><span class="op" id="3004282">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004288">d</span><span class="op" id="3004289">.</span><span class="ident" id="3004290">state</span>&nbsp;<span class="op" id="3004296">=</span>&nbsp;<span class="ident" id="3004298">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004322">case</span>&nbsp;<span class="ident" id="3004327">wstateCR</span><span class="op" id="3004335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004340">d</span><span class="op" id="3004341">.</span><span class="ident" id="3004342">state</span>&nbsp;<span class="op" id="3004348">=</span>&nbsp;<span class="ident" id="3004350">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004364">if</span>&nbsp;<span class="ident" id="3004367">c</span>&nbsp;<span class="op" id="3004369">==</span>&nbsp;<span class="string" id="3004372">&#39;\n&#39;</span>&nbsp;<span class="op" id="3004377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004383">d</span><span class="op" id="3004384">.</span><span class="ident" id="3004385">state</span>&nbsp;<span class="op" id="3004391">=</span>&nbsp;<span class="ident" id="3004393">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004420">if</span>&nbsp;<span class="ident" id="3004423">err</span>&nbsp;<span class="op" id="3004427">=</span>&nbsp;<span class="ident" id="3004429">bw</span><span class="op" id="3004431">.</span><span class="ident" id="3004432">WriteByte</span><span class="op" id="3004441">(</span><span class="ident" id="3004442">c</span><span class="op" id="3004443">)</span><span class="op" id="3004444">;</span>&nbsp;<span class="ident" id="3004446">err</span>&nbsp;<span class="op" id="3004450">!=</span>&nbsp;<span class="ident" id="3004453">nil</span>&nbsp;<span class="op" id="3004457">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004462">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004474">n</span><span class="op" id="3004475">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004482">return</span><br>
<span class="lineno">100</span><span class="op" id="3004489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3004492">func</span>&nbsp;<span class="op" id="3004497">(</span><span class="ident" id="3004498">d</span>&nbsp;<span class="op" id="3004500">*</span><span class="ident" id="3004501">dotWriter</span><span class="op" id="3004510">)</span>&nbsp;<span class="ident" id="3004512">Close</span><span class="op" id="3004517">(</span><span class="op" id="3004518">)</span>&nbsp;<span class="builtintype" id="3004520">error</span>&nbsp;<span class="op" id="3004526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004529">if</span>&nbsp;<span class="ident" id="3004532">d</span><span class="op" id="3004533">.</span><span class="ident" id="3004534">w</span><span class="op" id="3004535">.</span><span class="ident" id="3004536">dot</span>&nbsp;<span class="op" id="3004540">==</span>&nbsp;<span class="ident" id="3004543">d</span>&nbsp;<span class="op" id="3004545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004549">d</span><span class="op" id="3004550">.</span><span class="ident" id="3004551">w</span><span class="op" id="3004552">.</span><span class="ident" id="3004553">dot</span>&nbsp;<span class="op" id="3004557">=</span>&nbsp;<span class="ident" id="3004559">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004567">bw</span>&nbsp;<span class="op" id="3004570">:=</span>&nbsp;<span class="ident" id="3004573">d</span><span class="op" id="3004574">.</span><span class="ident" id="3004575">w</span><span class="op" id="3004576">.</span><span class="ident" id="3004577">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004580">switch</span>&nbsp;<span class="ident" id="3004587">d</span><span class="op" id="3004588">.</span><span class="ident" id="3004589">state</span>&nbsp;<span class="op" id="3004595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004598">default</span><span class="op" id="3004605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004609">bw</span><span class="op" id="3004611">.</span><span class="ident" id="3004612">WriteByte</span><span class="op" id="3004621">(</span><span class="string" id="3004622">&#39;\r&#39;</span><span class="op" id="3004626">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004630">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004643">case</span>&nbsp;<span class="ident" id="3004648">wstateCR</span><span class="op" id="3004656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004660">bw</span><span class="op" id="3004662">.</span><span class="ident" id="3004663">WriteByte</span><span class="op" id="3004672">(</span><span class="string" id="3004673">&#39;\n&#39;</span><span class="op" id="3004677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004681">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004694">case</span>&nbsp;<span class="ident" id="3004699">wstateBeginLine</span><span class="op" id="3004714">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004718">bw</span><span class="op" id="3004720">.</span><span class="ident" id="3004721">Write</span><span class="op" id="3004726">(</span><span class="ident" id="3004727">dotcrnl</span><span class="op" id="3004734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004740">return</span>&nbsp;<span class="ident" id="3004747">bw</span><span class="op" id="3004749">.</span><span class="ident" id="3004750">Flush</span><span class="op" id="3004755">(</span><span class="op" id="3004756">)</span><br>
<span class="lineno"></span><span class="op" id="3004758">}</span>
</div>
</body>
</html>
