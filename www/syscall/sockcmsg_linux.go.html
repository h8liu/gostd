<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1659452">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1659508">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1659562">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1659613">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1659641">package</span>&nbsp;<span class="ident" id="1659649">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1659658">import</span>&nbsp;<span class="string" id="1659665">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1659675">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="1659744">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1659800">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="1659819">func</span>&nbsp;<span class="ident" id="1659824">UnixCredentials</span><span class="op" id="1659839">(</span><span class="ident" id="1659840">ucred</span>&nbsp;<span class="op" id="1659846">*</span><span class="ident" id="1659847"><a href="/syscall/ztypes_linux_amd64.go.html#1825426">Ucred</a></span><span class="op" id="1659852">)</span>&nbsp;<span class="op" id="1659854">[</span><span class="op" id="1659855">]</span><span class="builtintype" id="1659856">byte</span>&nbsp;<span class="op" id="1659861">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659864">b</span>&nbsp;<span class="op" id="1659866">:=</span>&nbsp;<span class="builtinfunc" id="1659869">make</span><span class="op" id="1659873">(</span><span class="op" id="1659874">[</span><span class="op" id="1659875">]</span><span class="builtintype" id="1659876">byte</span><span class="op" id="1659880">,</span>&nbsp;<span class="ident" id="1659882"><a href="/syscall/sockcmsg_unix.go.html#1661488">CmsgSpace</a></span><span class="op" id="1659891">(</span><span class="ident" id="1659892"><a href="/syscall/ztypes_linux_amd64.go.html#1826728">SizeofUcred</a></span><span class="op" id="1659903">)</span><span class="op" id="1659904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659907">h</span>&nbsp;<span class="op" id="1659909">:=</span>&nbsp;<span class="op" id="1659912">(</span><span class="op" id="1659913">*</span><span class="ident" id="1659914"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><span class="op" id="1659921">)</span><span class="op" id="1659922">(</span><span class="ident" id="1659923"><a href="/syscall/sockcmsg_linux.go.html#1659665">unsafe</a></span><span class="op" id="1659929">.</span><span class="ident" id="1659930">Pointer</span><span class="op" id="1659937">(</span><span class="op" id="1659938">&amp;</span><span class="ident" id="1659939"><a href="/syscall/sockcmsg_linux.go.html#1659864">b</a></span><span class="op" id="1659940">[</span><span class="num" id="1659941">0</span><span class="op" id="1659942">]</span><span class="op" id="1659943">)</span><span class="op" id="1659944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659947"><a href="/syscall/sockcmsg_linux.go.html#1659907">h</a></span><span class="op" id="1659948">.</span><span class="ident" id="1659949">Level</span>&nbsp;<span class="op" id="1659955">=</span>&nbsp;<span class="ident" id="1659957"><a href="/syscall/zerrors_linux_amd64.go.html#1747792">SOL_SOCKET</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659969"><a href="/syscall/sockcmsg_linux.go.html#1659907">h</a></span><span class="op" id="1659970">.</span><span class="ident" id="1659971">Type</span>&nbsp;<span class="op" id="1659976">=</span>&nbsp;<span class="ident" id="1659978"><a href="/syscall/zerrors_linux_amd64.go.html#1744236">SCM_CREDENTIALS</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659995"><a href="/syscall/sockcmsg_linux.go.html#1659907">h</a></span><span class="op" id="1659996">.</span><span class="ident" id="1659997">SetLen</span><span class="op" id="1660003">(</span><span class="ident" id="1660004"><a href="/syscall/sockcmsg_unix.go.html#1661294">CmsgLen</a></span><span class="op" id="1660011">(</span><span class="ident" id="1660012"><a href="/syscall/ztypes_linux_amd64.go.html#1826728">SizeofUcred</a></span><span class="op" id="1660023">)</span><span class="op" id="1660024">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660027">*</span><span class="op" id="1660028">(</span><span class="op" id="1660029">(</span><span class="op" id="1660030">*</span><span class="ident" id="1660031"><a href="/syscall/ztypes_linux_amd64.go.html#1825426">Ucred</a></span><span class="op" id="1660036">)</span><span class="op" id="1660037">(</span><span class="ident" id="1660038"><a href="/syscall/sockcmsg_unix.go.html#1661583">cmsgData</a></span><span class="op" id="1660046">(</span><span class="ident" id="1660047"><a href="/syscall/sockcmsg_linux.go.html#1659907">h</a></span><span class="op" id="1660048">)</span><span class="op" id="1660049">)</span><span class="op" id="1660050">)</span>&nbsp;<span class="op" id="1660052">=</span>&nbsp;<span class="op" id="1660054">*</span><span class="ident" id="1660055"><a href="/syscall/sockcmsg_linux.go.html#1659840">ucred</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660062">return</span>&nbsp;<span class="ident" id="1660069"><a href="/syscall/sockcmsg_linux.go.html#1659864">b</a></span><br>
<span class="lineno"></span><span class="op" id="1660071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660074">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="1660145">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1660213">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="1660266">func</span>&nbsp;<span class="ident" id="1660271">ParseUnixCredentials</span><span class="op" id="1660291">(</span><span class="ident" id="1660292">m</span>&nbsp;<span class="op" id="1660294">*</span><span class="ident" id="1660295"><a href="/syscall/sockcmsg_unix.go.html#1661779">SocketControlMessage</a></span><span class="op" id="1660315">)</span>&nbsp;<span class="op" id="1660317">(</span><span class="op" id="1660318">*</span><span class="ident" id="1660319"><a href="/syscall/ztypes_linux_amd64.go.html#1825426">Ucred</a></span><span class="op" id="1660324">,</span>&nbsp;<span class="builtintype" id="1660326">error</span><span class="op" id="1660331">)</span>&nbsp;<span class="op" id="1660333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660336">if</span>&nbsp;<span class="ident" id="1660339"><a href="/syscall/sockcmsg_linux.go.html#1660292">m</a></span><span class="op" id="1660340">.</span><span class="ident" id="1660341">Header</span><span class="op" id="1660347">.</span><span class="ident" id="1660348">Level</span>&nbsp;<span class="op" id="1660354">!=</span>&nbsp;<span class="ident" id="1660357"><a href="/syscall/zerrors_linux_amd64.go.html#1747792">SOL_SOCKET</a></span>&nbsp;<span class="op" id="1660368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660372">return</span>&nbsp;<span class="ident" id="1660379">nil</span><span class="op" id="1660382">,</span>&nbsp;<span class="ident" id="1660384"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660395">if</span>&nbsp;<span class="ident" id="1660398"><a href="/syscall/sockcmsg_linux.go.html#1660292">m</a></span><span class="op" id="1660399">.</span><span class="ident" id="1660400">Header</span><span class="op" id="1660406">.</span><span class="ident" id="1660407">Type</span>&nbsp;<span class="op" id="1660412">!=</span>&nbsp;<span class="ident" id="1660415"><a href="/syscall/zerrors_linux_amd64.go.html#1744236">SCM_CREDENTIALS</a></span>&nbsp;<span class="op" id="1660431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660435">return</span>&nbsp;<span class="ident" id="1660442">nil</span><span class="op" id="1660445">,</span>&nbsp;<span class="ident" id="1660447"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660458">ucred</span>&nbsp;<span class="op" id="1660464">:=</span>&nbsp;<span class="op" id="1660467">*</span><span class="op" id="1660468">(</span><span class="op" id="1660469">*</span><span class="ident" id="1660470"><a href="/syscall/ztypes_linux_amd64.go.html#1825426">Ucred</a></span><span class="op" id="1660475">)</span><span class="op" id="1660476">(</span><span class="ident" id="1660477"><a href="/syscall/sockcmsg_linux.go.html#1659665">unsafe</a></span><span class="op" id="1660483">.</span><span class="ident" id="1660484">Pointer</span><span class="op" id="1660491">(</span><span class="op" id="1660492">&amp;</span><span class="ident" id="1660493"><a href="/syscall/sockcmsg_linux.go.html#1660292">m</a></span><span class="op" id="1660494">.</span><span class="ident" id="1660495">Data</span><span class="op" id="1660499">[</span><span class="num" id="1660500">0</span><span class="op" id="1660501">]</span><span class="op" id="1660502">)</span><span class="op" id="1660503">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660506">return</span>&nbsp;<span class="op" id="1660513">&amp;</span><span class="ident" id="1660514"><a href="/syscall/sockcmsg_linux.go.html#1660458">ucred</a></span><span class="op" id="1660519">,</span>&nbsp;<span class="ident" id="1660521">nil</span><br>
<span class="lineno"></span><span class="op" id="1660525">}</span>
</div>
</body>
</html>
