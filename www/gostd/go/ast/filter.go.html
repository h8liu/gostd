<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1371687">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1371742">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1371796">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1371847">package</span>&nbsp;<span class="ident" id="1371855">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1371860">import</span>&nbsp;<span class="op" id="1371867">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1371870">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1371882">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="1371889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1371892">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1371972">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1371993">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="1372065">func</span>&nbsp;<span class="ident" id="1372070">exportFilter</span><span class="op" id="1372082">(</span><span class="ident" id="1372083">name</span>&nbsp;<span class="builtintype" id="1372088">string</span><span class="op" id="1372094">)</span>&nbsp;<span class="builtintype" id="1372096">bool</span>&nbsp;<span class="op" id="1372101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1372104">return</span>&nbsp;<span class="ident" id="1372111">IsExported</span><span class="op" id="1372121">(</span><span class="ident" id="1372122">name</span><span class="op" id="1372126">)</span><br>
<span class="lineno"></span><span class="op" id="1372128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="1372131">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1372200">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="1372280">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="1372358">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="1372434">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="1372486">//</span><br>
<span class="lineno"></span><span class="comment" id="1372489">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="1372553">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="1372584">//</span><br>
<span class="lineno"></span><span class="keyword" id="1372587">func</span>&nbsp;<span class="ident" id="1372592">FileExports</span><span class="op" id="1372603">(</span><span class="ident" id="1372604">src</span>&nbsp;<span class="op" id="1372608">*</span><span class="ident" id="1372609">File</span><span class="op" id="1372613">)</span>&nbsp;<span class="builtintype" id="1372615">bool</span>&nbsp;<span class="op" id="1372620">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1372623">return</span>&nbsp;<span class="ident" id="1372630">filterFile</span><span class="op" id="1372640">(</span><span class="ident" id="1372641">src</span><span class="op" id="1372644">,</span>&nbsp;<span class="ident" id="1372646">exportFilter</span><span class="op" id="1372658">,</span>&nbsp;<span class="builtintype" id="1372660">true</span><span class="op" id="1372664">)</span><br>
<span class="lineno"></span><span class="op" id="1372666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1372669">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1372737">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="1372811">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="1372872">//</span><br>
<span class="lineno"></span><span class="comment" id="1372875">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="1372942">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="1372973">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1372976">func</span>&nbsp;<span class="ident" id="1372981">PackageExports</span><span class="op" id="1372995">(</span><span class="ident" id="1372996">pkg</span>&nbsp;<span class="op" id="1373000">*</span><span class="ident" id="1373001">Package</span><span class="op" id="1373008">)</span>&nbsp;<span class="builtintype" id="1373010">bool</span>&nbsp;<span class="op" id="1373015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373018">return</span>&nbsp;<span class="ident" id="1373025">filterPackage</span><span class="op" id="1373038">(</span><span class="ident" id="1373039">pkg</span><span class="op" id="1373042">,</span>&nbsp;<span class="ident" id="1373044">exportFilter</span><span class="op" id="1373056">,</span>&nbsp;<span class="builtintype" id="1373058">true</span><span class="op" id="1373062">)</span><br>
<span class="lineno"></span><span class="op" id="1373064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1373067">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="1373147">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1373169">type</span>&nbsp;<span class="ident" id="1373174">Filter</span>&nbsp;<span class="keyword" id="1373181">func</span><span class="op" id="1373185">(</span><span class="builtintype" id="1373186">string</span><span class="op" id="1373192">)</span>&nbsp;<span class="builtintype" id="1373194">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1373200">func</span>&nbsp;<span class="ident" id="1373205">filterIdentList</span><span class="op" id="1373220">(</span><span class="ident" id="1373221">list</span>&nbsp;<span class="op" id="1373226">[</span><span class="op" id="1373227">]</span><span class="op" id="1373228">*</span><span class="ident" id="1373229">Ident</span><span class="op" id="1373234">,</span>&nbsp;<span class="ident" id="1373236">f</span>&nbsp;<span class="ident" id="1373238">Filter</span><span class="op" id="1373244">)</span>&nbsp;<span class="op" id="1373246">[</span><span class="op" id="1373247">]</span><span class="op" id="1373248">*</span><span class="ident" id="1373249">Ident</span>&nbsp;<span class="op" id="1373255">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373258">j</span>&nbsp;<span class="op" id="1373260">:=</span>&nbsp;<span class="num" id="1373263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373266">for</span>&nbsp;<span class="ident" id="1373270">_</span><span class="op" id="1373271">,</span>&nbsp;<span class="ident" id="1373273">x</span>&nbsp;<span class="op" id="1373275">:=</span>&nbsp;<span class="keyword" id="1373278">range</span>&nbsp;<span class="ident" id="1373284">list</span>&nbsp;<span class="op" id="1373289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373293">if</span>&nbsp;<span class="ident" id="1373296">f</span><span class="op" id="1373297">(</span><span class="ident" id="1373298">x</span><span class="op" id="1373299">.</span><span class="ident" id="1373300">Name</span><span class="op" id="1373304">)</span>&nbsp;<span class="op" id="1373306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373311">list</span><span class="op" id="1373315">[</span><span class="ident" id="1373316">j</span><span class="op" id="1373317">]</span>&nbsp;<span class="op" id="1373319">=</span>&nbsp;<span class="ident" id="1373321">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373326">j</span><span class="op" id="1373327">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1373332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1373335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373338">return</span>&nbsp;<span class="ident" id="1373345">list</span><span class="op" id="1373349">[</span><span class="num" id="1373350">0</span><span class="op" id="1373351">:</span><span class="ident" id="1373352">j</span><span class="op" id="1373353">]</span><br>
<span class="lineno"></span><span class="op" id="1373355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1373358">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1373424">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="1373491">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1373530">//</span><br>
<span class="lineno"></span><span class="keyword" id="1373533">func</span>&nbsp;<span class="ident" id="1373538">fieldName</span><span class="op" id="1373547">(</span><span class="ident" id="1373548">x</span>&nbsp;<span class="ident" id="1373550">Expr</span><span class="op" id="1373554">)</span>&nbsp;<span class="op" id="1373556">*</span><span class="ident" id="1373557">Ident</span>&nbsp;<span class="op" id="1373563">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373566">switch</span>&nbsp;<span class="ident" id="1373573">t</span>&nbsp;<span class="op" id="1373575">:=</span>&nbsp;<span class="ident" id="1373578">x</span><span class="op" id="1373579">.</span><span class="op" id="1373580">(</span><span class="keyword" id="1373581">type</span><span class="op" id="1373585">)</span>&nbsp;<span class="op" id="1373587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373590">case</span>&nbsp;<span class="op" id="1373595">*</span><span class="ident" id="1373596">Ident</span><span class="op" id="1373601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373605">return</span>&nbsp;<span class="ident" id="1373612">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373615">case</span>&nbsp;<span class="op" id="1373620">*</span><span class="ident" id="1373621">SelectorExpr</span><span class="op" id="1373633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373637">if</span>&nbsp;<span class="ident" id="1373640">_</span><span class="op" id="1373641">,</span>&nbsp;<span class="ident" id="1373643">ok</span>&nbsp;<span class="op" id="1373646">:=</span>&nbsp;<span class="ident" id="1373649">t</span><span class="op" id="1373650">.</span><span class="ident" id="1373651">X</span><span class="op" id="1373652">.</span><span class="op" id="1373653">(</span><span class="op" id="1373654">*</span><span class="ident" id="1373655">Ident</span><span class="op" id="1373660">)</span><span class="op" id="1373661">;</span>&nbsp;<span class="ident" id="1373663">ok</span>&nbsp;<span class="op" id="1373666">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373671">return</span>&nbsp;<span class="ident" id="1373678">t</span><span class="op" id="1373679">.</span><span class="ident" id="1373680">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1373686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373689">case</span>&nbsp;<span class="op" id="1373694">*</span><span class="ident" id="1373695">StarExpr</span><span class="op" id="1373703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373707">return</span>&nbsp;<span class="ident" id="1373714">fieldName</span><span class="op" id="1373723">(</span><span class="ident" id="1373724">t</span><span class="op" id="1373725">.</span><span class="ident" id="1373726">X</span><span class="op" id="1373727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1373730">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373733">return</span>&nbsp;<span class="ident" id="1373740">nil</span><br>
<span class="lineno"></span><span class="op" id="1373744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1373747">func</span>&nbsp;<span class="ident" id="1373752">filterFieldList</span><span class="op" id="1373767">(</span><span class="ident" id="1373768">fields</span>&nbsp;<span class="op" id="1373775">*</span><span class="ident" id="1373776">FieldList</span><span class="op" id="1373785">,</span>&nbsp;<span class="ident" id="1373787">filter</span>&nbsp;<span class="ident" id="1373794">Filter</span><span class="op" id="1373800">,</span>&nbsp;<span class="ident" id="1373802">export</span>&nbsp;<span class="builtintype" id="1373809">bool</span><span class="op" id="1373813">)</span>&nbsp;<span class="op" id="1373815">(</span><span class="ident" id="1373816">removedFields</span>&nbsp;<span class="builtintype" id="1373830">bool</span><span class="op" id="1373834">)</span>&nbsp;<span class="op" id="1373836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373839">if</span>&nbsp;<span class="ident" id="1373842">fields</span>&nbsp;<span class="op" id="1373849">==</span>&nbsp;<span class="ident" id="1373852">nil</span>&nbsp;<span class="op" id="1373856">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373860">return</span>&nbsp;<span class="builtintype" id="1373867">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1373874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373877">list</span>&nbsp;<span class="op" id="1373882">:=</span>&nbsp;<span class="ident" id="1373885">fields</span><span class="op" id="1373891">.</span><span class="ident" id="1373892">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373898">j</span>&nbsp;<span class="op" id="1373900">:=</span>&nbsp;<span class="num" id="1373903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373906">for</span>&nbsp;<span class="ident" id="1373910">_</span><span class="op" id="1373911">,</span>&nbsp;<span class="ident" id="1373913">f</span>&nbsp;<span class="op" id="1373915">:=</span>&nbsp;<span class="keyword" id="1373918">range</span>&nbsp;<span class="ident" id="1373924">list</span>&nbsp;<span class="op" id="1373929">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1373933">keepField</span>&nbsp;<span class="op" id="1373943">:=</span>&nbsp;<span class="builtintype" id="1373946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1373954">if</span>&nbsp;<span class="builtinfunc" id="1373957">len</span><span class="op" id="1373960">(</span><span class="ident" id="1373961">f</span><span class="op" id="1373962">.</span><span class="ident" id="1373963">Names</span><span class="op" id="1373968">)</span>&nbsp;<span class="op" id="1373970">==</span>&nbsp;<span class="num" id="1373973">0</span>&nbsp;<span class="op" id="1373975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1373980">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374002">name</span>&nbsp;<span class="op" id="1374007">:=</span>&nbsp;<span class="ident" id="1374010">fieldName</span><span class="op" id="1374019">(</span><span class="ident" id="1374020">f</span><span class="op" id="1374021">.</span><span class="ident" id="1374022">Type</span><span class="op" id="1374026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374031">keepField</span>&nbsp;<span class="op" id="1374041">=</span>&nbsp;<span class="ident" id="1374043">name</span>&nbsp;<span class="op" id="1374048">!=</span>&nbsp;<span class="ident" id="1374051">nil</span>&nbsp;<span class="op" id="1374055">&amp;&amp;</span>&nbsp;<span class="ident" id="1374058">filter</span><span class="op" id="1374064">(</span><span class="ident" id="1374065">name</span><span class="op" id="1374069">.</span><span class="ident" id="1374070">Name</span><span class="op" id="1374074">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374078">}</span>&nbsp;<span class="keyword" id="1374080">else</span>&nbsp;<span class="op" id="1374085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374090">n</span>&nbsp;<span class="op" id="1374092">:=</span>&nbsp;<span class="builtinfunc" id="1374095">len</span><span class="op" id="1374098">(</span><span class="ident" id="1374099">f</span><span class="op" id="1374100">.</span><span class="ident" id="1374101">Names</span><span class="op" id="1374106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374111">f</span><span class="op" id="1374112">.</span><span class="ident" id="1374113">Names</span>&nbsp;<span class="op" id="1374119">=</span>&nbsp;<span class="ident" id="1374121">filterIdentList</span><span class="op" id="1374136">(</span><span class="ident" id="1374137">f</span><span class="op" id="1374138">.</span><span class="ident" id="1374139">Names</span><span class="op" id="1374144">,</span>&nbsp;<span class="ident" id="1374146">filter</span><span class="op" id="1374152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374157">if</span>&nbsp;<span class="builtinfunc" id="1374160">len</span><span class="op" id="1374163">(</span><span class="ident" id="1374164">f</span><span class="op" id="1374165">.</span><span class="ident" id="1374166">Names</span><span class="op" id="1374171">)</span>&nbsp;<span class="op" id="1374173">&lt;</span>&nbsp;<span class="ident" id="1374175">n</span>&nbsp;<span class="op" id="1374177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374183">removedFields</span>&nbsp;<span class="op" id="1374197">=</span>&nbsp;<span class="builtintype" id="1374199">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374212">keepField</span>&nbsp;<span class="op" id="1374222">=</span>&nbsp;<span class="builtinfunc" id="1374224">len</span><span class="op" id="1374227">(</span><span class="ident" id="1374228">f</span><span class="op" id="1374229">.</span><span class="ident" id="1374230">Names</span><span class="op" id="1374235">)</span>&nbsp;<span class="op" id="1374237">&gt;</span>&nbsp;<span class="num" id="1374239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374247">if</span>&nbsp;<span class="ident" id="1374250">keepField</span>&nbsp;<span class="op" id="1374260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374265">if</span>&nbsp;<span class="ident" id="1374268">export</span>&nbsp;<span class="op" id="1374275">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374281">filterType</span><span class="op" id="1374291">(</span><span class="ident" id="1374292">f</span><span class="op" id="1374293">.</span><span class="ident" id="1374294">Type</span><span class="op" id="1374298">,</span>&nbsp;<span class="ident" id="1374300">filter</span><span class="op" id="1374306">,</span>&nbsp;<span class="ident" id="1374308">export</span><span class="op" id="1374314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374324">list</span><span class="op" id="1374328">[</span><span class="ident" id="1374329">j</span><span class="op" id="1374330">]</span>&nbsp;<span class="op" id="1374332">=</span>&nbsp;<span class="ident" id="1374334">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374339">j</span><span class="op" id="1374340">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374345">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374351">if</span>&nbsp;<span class="ident" id="1374354">j</span>&nbsp;<span class="op" id="1374356">&lt;</span>&nbsp;<span class="builtinfunc" id="1374358">len</span><span class="op" id="1374361">(</span><span class="ident" id="1374362">list</span><span class="op" id="1374366">)</span>&nbsp;<span class="op" id="1374368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374372">removedFields</span>&nbsp;<span class="op" id="1374386">=</span>&nbsp;<span class="builtintype" id="1374388">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374397">fields</span><span class="op" id="1374403">.</span><span class="ident" id="1374404">List</span>&nbsp;<span class="op" id="1374409">=</span>&nbsp;<span class="ident" id="1374411">list</span><span class="op" id="1374415">[</span><span class="num" id="1374416">0</span><span class="op" id="1374417">:</span><span class="ident" id="1374418">j</span><span class="op" id="1374419">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374422">return</span><br>
<span class="lineno"></span><span class="op" id="1374429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1374432">func</span>&nbsp;<span class="ident" id="1374437">filterParamList</span><span class="op" id="1374452">(</span><span class="ident" id="1374453">fields</span>&nbsp;<span class="op" id="1374460">*</span><span class="ident" id="1374461">FieldList</span><span class="op" id="1374470">,</span>&nbsp;<span class="ident" id="1374472">filter</span>&nbsp;<span class="ident" id="1374479">Filter</span><span class="op" id="1374485">,</span>&nbsp;<span class="ident" id="1374487">export</span>&nbsp;<span class="builtintype" id="1374494">bool</span><span class="op" id="1374498">)</span>&nbsp;<span class="builtintype" id="1374500">bool</span>&nbsp;<span class="op" id="1374505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374508">if</span>&nbsp;<span class="ident" id="1374511">fields</span>&nbsp;<span class="op" id="1374518">==</span>&nbsp;<span class="ident" id="1374521">nil</span>&nbsp;<span class="op" id="1374525">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374529">return</span>&nbsp;<span class="builtintype" id="1374536">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374546">var</span>&nbsp;<span class="ident" id="1374550">b</span>&nbsp;<span class="builtintype" id="1374552">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374558">for</span>&nbsp;<span class="ident" id="1374562">_</span><span class="op" id="1374563">,</span>&nbsp;<span class="ident" id="1374565">f</span>&nbsp;<span class="op" id="1374567">:=</span>&nbsp;<span class="keyword" id="1374570">range</span>&nbsp;<span class="ident" id="1374576">fields</span><span class="op" id="1374582">.</span><span class="ident" id="1374583">List</span>&nbsp;<span class="op" id="1374588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374592">if</span>&nbsp;<span class="ident" id="1374595">filterType</span><span class="op" id="1374605">(</span><span class="ident" id="1374606">f</span><span class="op" id="1374607">.</span><span class="ident" id="1374608">Type</span><span class="op" id="1374612">,</span>&nbsp;<span class="ident" id="1374614">filter</span><span class="op" id="1374620">,</span>&nbsp;<span class="ident" id="1374622">export</span><span class="op" id="1374628">)</span>&nbsp;<span class="op" id="1374630">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374635">b</span>&nbsp;<span class="op" id="1374637">=</span>&nbsp;<span class="builtintype" id="1374639">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374652">return</span>&nbsp;<span class="ident" id="1374659">b</span><br>
<span class="lineno"></span><span class="op" id="1374661">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1374664">func</span>&nbsp;<span class="ident" id="1374669">filterType</span><span class="op" id="1374679">(</span><span class="ident" id="1374680">typ</span>&nbsp;<span class="ident" id="1374684">Expr</span><span class="op" id="1374688">,</span>&nbsp;<span class="ident" id="1374690">f</span>&nbsp;<span class="ident" id="1374692">Filter</span><span class="op" id="1374698">,</span>&nbsp;<span class="ident" id="1374700">export</span>&nbsp;<span class="builtintype" id="1374707">bool</span><span class="op" id="1374711">)</span>&nbsp;<span class="builtintype" id="1374713">bool</span>&nbsp;<span class="op" id="1374718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374721">switch</span>&nbsp;<span class="ident" id="1374728">t</span>&nbsp;<span class="op" id="1374730">:=</span>&nbsp;<span class="ident" id="1374733">typ</span><span class="op" id="1374736">.</span><span class="op" id="1374737">(</span><span class="keyword" id="1374738">type</span><span class="op" id="1374742">)</span>&nbsp;<span class="op" id="1374744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374747">case</span>&nbsp;<span class="op" id="1374752">*</span><span class="ident" id="1374753">Ident</span><span class="op" id="1374758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374762">return</span>&nbsp;<span class="ident" id="1374769">f</span><span class="op" id="1374770">(</span><span class="ident" id="1374771">t</span><span class="op" id="1374772">.</span><span class="ident" id="1374773">Name</span><span class="op" id="1374777">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374780">case</span>&nbsp;<span class="op" id="1374785">*</span><span class="ident" id="1374786">ParenExpr</span><span class="op" id="1374795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374799">return</span>&nbsp;<span class="ident" id="1374806">filterType</span><span class="op" id="1374816">(</span><span class="ident" id="1374817">t</span><span class="op" id="1374818">.</span><span class="ident" id="1374819">X</span><span class="op" id="1374820">,</span>&nbsp;<span class="ident" id="1374822">f</span><span class="op" id="1374823">,</span>&nbsp;<span class="ident" id="1374825">export</span><span class="op" id="1374831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374834">case</span>&nbsp;<span class="op" id="1374839">*</span><span class="ident" id="1374840">ArrayType</span><span class="op" id="1374849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374853">return</span>&nbsp;<span class="ident" id="1374860">filterType</span><span class="op" id="1374870">(</span><span class="ident" id="1374871">t</span><span class="op" id="1374872">.</span><span class="ident" id="1374873">Elt</span><span class="op" id="1374876">,</span>&nbsp;<span class="ident" id="1374878">f</span><span class="op" id="1374879">,</span>&nbsp;<span class="ident" id="1374881">export</span><span class="op" id="1374887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374890">case</span>&nbsp;<span class="op" id="1374895">*</span><span class="ident" id="1374896">StructType</span><span class="op" id="1374906">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374910">if</span>&nbsp;<span class="ident" id="1374913">filterFieldList</span><span class="op" id="1374928">(</span><span class="ident" id="1374929">t</span><span class="op" id="1374930">.</span><span class="ident" id="1374931">Fields</span><span class="op" id="1374937">,</span>&nbsp;<span class="ident" id="1374939">f</span><span class="op" id="1374940">,</span>&nbsp;<span class="ident" id="1374942">export</span><span class="op" id="1374948">)</span>&nbsp;<span class="op" id="1374950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1374955">t</span><span class="op" id="1374956">.</span><span class="ident" id="1374957">Incomplete</span>&nbsp;<span class="op" id="1374968">=</span>&nbsp;<span class="builtintype" id="1374970">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1374977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1374981">return</span>&nbsp;<span class="builtinfunc" id="1374988">len</span><span class="op" id="1374991">(</span><span class="ident" id="1374992">t</span><span class="op" id="1374993">.</span><span class="ident" id="1374994">Fields</span><span class="op" id="1375000">.</span><span class="ident" id="1375001">List</span><span class="op" id="1375005">)</span>&nbsp;<span class="op" id="1375007">&gt;</span>&nbsp;<span class="num" id="1375009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375012">case</span>&nbsp;<span class="op" id="1375017">*</span><span class="ident" id="1375018">FuncType</span><span class="op" id="1375026">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375030">b1</span>&nbsp;<span class="op" id="1375033">:=</span>&nbsp;<span class="ident" id="1375036">filterParamList</span><span class="op" id="1375051">(</span><span class="ident" id="1375052">t</span><span class="op" id="1375053">.</span><span class="ident" id="1375054">Params</span><span class="op" id="1375060">,</span>&nbsp;<span class="ident" id="1375062">f</span><span class="op" id="1375063">,</span>&nbsp;<span class="ident" id="1375065">export</span><span class="op" id="1375071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375075">b2</span>&nbsp;<span class="op" id="1375078">:=</span>&nbsp;<span class="ident" id="1375081">filterParamList</span><span class="op" id="1375096">(</span><span class="ident" id="1375097">t</span><span class="op" id="1375098">.</span><span class="ident" id="1375099">Results</span><span class="op" id="1375106">,</span>&nbsp;<span class="ident" id="1375108">f</span><span class="op" id="1375109">,</span>&nbsp;<span class="ident" id="1375111">export</span><span class="op" id="1375117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375121">return</span>&nbsp;<span class="ident" id="1375128">b1</span>&nbsp;<span class="op" id="1375131">||</span>&nbsp;<span class="ident" id="1375134">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375138">case</span>&nbsp;<span class="op" id="1375143">*</span><span class="ident" id="1375144">InterfaceType</span><span class="op" id="1375157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375161">if</span>&nbsp;<span class="ident" id="1375164">filterFieldList</span><span class="op" id="1375179">(</span><span class="ident" id="1375180">t</span><span class="op" id="1375181">.</span><span class="ident" id="1375182">Methods</span><span class="op" id="1375189">,</span>&nbsp;<span class="ident" id="1375191">f</span><span class="op" id="1375192">,</span>&nbsp;<span class="ident" id="1375194">export</span><span class="op" id="1375200">)</span>&nbsp;<span class="op" id="1375202">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375207">t</span><span class="op" id="1375208">.</span><span class="ident" id="1375209">Incomplete</span>&nbsp;<span class="op" id="1375220">=</span>&nbsp;<span class="builtintype" id="1375222">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375233">return</span>&nbsp;<span class="builtinfunc" id="1375240">len</span><span class="op" id="1375243">(</span><span class="ident" id="1375244">t</span><span class="op" id="1375245">.</span><span class="ident" id="1375246">Methods</span><span class="op" id="1375253">.</span><span class="ident" id="1375254">List</span><span class="op" id="1375258">)</span>&nbsp;<span class="op" id="1375260">&gt;</span>&nbsp;<span class="num" id="1375262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375265">case</span>&nbsp;<span class="op" id="1375270">*</span><span class="ident" id="1375271">MapType</span><span class="op" id="1375278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375282">b1</span>&nbsp;<span class="op" id="1375285">:=</span>&nbsp;<span class="ident" id="1375288">filterType</span><span class="op" id="1375298">(</span><span class="ident" id="1375299">t</span><span class="op" id="1375300">.</span><span class="ident" id="1375301">Key</span><span class="op" id="1375304">,</span>&nbsp;<span class="ident" id="1375306">f</span><span class="op" id="1375307">,</span>&nbsp;<span class="ident" id="1375309">export</span><span class="op" id="1375315">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375319">b2</span>&nbsp;<span class="op" id="1375322">:=</span>&nbsp;<span class="ident" id="1375325">filterType</span><span class="op" id="1375335">(</span><span class="ident" id="1375336">t</span><span class="op" id="1375337">.</span><span class="ident" id="1375338">Value</span><span class="op" id="1375343">,</span>&nbsp;<span class="ident" id="1375345">f</span><span class="op" id="1375346">,</span>&nbsp;<span class="ident" id="1375348">export</span><span class="op" id="1375354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375358">return</span>&nbsp;<span class="ident" id="1375365">b1</span>&nbsp;<span class="op" id="1375368">||</span>&nbsp;<span class="ident" id="1375371">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375375">case</span>&nbsp;<span class="op" id="1375380">*</span><span class="ident" id="1375381">ChanType</span><span class="op" id="1375389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375393">return</span>&nbsp;<span class="ident" id="1375400">filterType</span><span class="op" id="1375410">(</span><span class="ident" id="1375411">t</span><span class="op" id="1375412">.</span><span class="ident" id="1375413">Value</span><span class="op" id="1375418">,</span>&nbsp;<span class="ident" id="1375420">f</span><span class="op" id="1375421">,</span>&nbsp;<span class="ident" id="1375423">export</span><span class="op" id="1375429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375432">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375435">return</span>&nbsp;<span class="builtintype" id="1375442">false</span><br>
<span class="lineno"></span><span class="op" id="1375448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1375451">func</span>&nbsp;<span class="ident" id="1375456">filterSpec</span><span class="op" id="1375466">(</span><span class="ident" id="1375467">spec</span>&nbsp;<span class="ident" id="1375472">Spec</span><span class="op" id="1375476">,</span>&nbsp;<span class="ident" id="1375478">f</span>&nbsp;<span class="ident" id="1375480">Filter</span><span class="op" id="1375486">,</span>&nbsp;<span class="ident" id="1375488">export</span>&nbsp;<span class="builtintype" id="1375495">bool</span><span class="op" id="1375499">)</span>&nbsp;<span class="builtintype" id="1375501">bool</span>&nbsp;<span class="op" id="1375506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375509">switch</span>&nbsp;<span class="ident" id="1375516">s</span>&nbsp;<span class="op" id="1375518">:=</span>&nbsp;<span class="ident" id="1375521">spec</span><span class="op" id="1375525">.</span><span class="op" id="1375526">(</span><span class="keyword" id="1375527">type</span><span class="op" id="1375531">)</span>&nbsp;<span class="op" id="1375533">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375536">case</span>&nbsp;<span class="op" id="1375541">*</span><span class="ident" id="1375542">ValueSpec</span><span class="op" id="1375551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375555">s</span><span class="op" id="1375556">.</span><span class="ident" id="1375557">Names</span>&nbsp;<span class="op" id="1375563">=</span>&nbsp;<span class="ident" id="1375565">filterIdentList</span><span class="op" id="1375580">(</span><span class="ident" id="1375581">s</span><span class="op" id="1375582">.</span><span class="ident" id="1375583">Names</span><span class="op" id="1375588">,</span>&nbsp;<span class="ident" id="1375590">f</span><span class="op" id="1375591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375595">if</span>&nbsp;<span class="builtinfunc" id="1375598">len</span><span class="op" id="1375601">(</span><span class="ident" id="1375602">s</span><span class="op" id="1375603">.</span><span class="ident" id="1375604">Names</span><span class="op" id="1375609">)</span>&nbsp;<span class="op" id="1375611">&gt;</span>&nbsp;<span class="num" id="1375613">0</span>&nbsp;<span class="op" id="1375615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375620">if</span>&nbsp;<span class="ident" id="1375623">export</span>&nbsp;<span class="op" id="1375630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375636">filterType</span><span class="op" id="1375646">(</span><span class="ident" id="1375647">s</span><span class="op" id="1375648">.</span><span class="ident" id="1375649">Type</span><span class="op" id="1375653">,</span>&nbsp;<span class="ident" id="1375655">f</span><span class="op" id="1375656">,</span>&nbsp;<span class="ident" id="1375658">export</span><span class="op" id="1375664">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375674">return</span>&nbsp;<span class="builtintype" id="1375681">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375691">case</span>&nbsp;<span class="op" id="1375696">*</span><span class="ident" id="1375697">TypeSpec</span><span class="op" id="1375705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375709">if</span>&nbsp;<span class="ident" id="1375712">f</span><span class="op" id="1375713">(</span><span class="ident" id="1375714">s</span><span class="op" id="1375715">.</span><span class="ident" id="1375716">Name</span><span class="op" id="1375720">.</span><span class="ident" id="1375721">Name</span><span class="op" id="1375725">)</span>&nbsp;<span class="op" id="1375727">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375732">if</span>&nbsp;<span class="ident" id="1375735">export</span>&nbsp;<span class="op" id="1375742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1375748">filterType</span><span class="op" id="1375758">(</span><span class="ident" id="1375759">s</span><span class="op" id="1375760">.</span><span class="ident" id="1375761">Type</span><span class="op" id="1375765">,</span>&nbsp;<span class="ident" id="1375767">f</span><span class="op" id="1375768">,</span>&nbsp;<span class="ident" id="1375770">export</span><span class="op" id="1375776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375786">return</span>&nbsp;<span class="builtintype" id="1375793">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1375800">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1375804">if</span>&nbsp;<span class="op" id="1375807">!</span><span class="ident" id="1375808">export</span>&nbsp;<span class="op" id="1375815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375820">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375868">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375915">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375926">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1375972">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376000">return</span>&nbsp;<span class="ident" id="1376007">filterType</span><span class="op" id="1376017">(</span><span class="ident" id="1376018">s</span><span class="op" id="1376019">.</span><span class="ident" id="1376020">Type</span><span class="op" id="1376024">,</span>&nbsp;<span class="ident" id="1376026">f</span><span class="op" id="1376027">,</span>&nbsp;<span class="ident" id="1376029">export</span><span class="op" id="1376035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376045">return</span>&nbsp;<span class="builtintype" id="1376052">false</span><br>
<span class="lineno">185</span><span class="op" id="1376058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1376061">func</span>&nbsp;<span class="ident" id="1376066">filterSpecList</span><span class="op" id="1376080">(</span><span class="ident" id="1376081">list</span>&nbsp;<span class="op" id="1376086">[</span><span class="op" id="1376087">]</span><span class="ident" id="1376088">Spec</span><span class="op" id="1376092">,</span>&nbsp;<span class="ident" id="1376094">f</span>&nbsp;<span class="ident" id="1376096">Filter</span><span class="op" id="1376102">,</span>&nbsp;<span class="ident" id="1376104">export</span>&nbsp;<span class="builtintype" id="1376111">bool</span><span class="op" id="1376115">)</span>&nbsp;<span class="op" id="1376117">[</span><span class="op" id="1376118">]</span><span class="ident" id="1376119">Spec</span>&nbsp;<span class="op" id="1376124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376127">j</span>&nbsp;<span class="op" id="1376129">:=</span>&nbsp;<span class="num" id="1376132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376135">for</span>&nbsp;<span class="ident" id="1376139">_</span><span class="op" id="1376140">,</span>&nbsp;<span class="ident" id="1376142">s</span>&nbsp;<span class="op" id="1376144">:=</span>&nbsp;<span class="keyword" id="1376147">range</span>&nbsp;<span class="ident" id="1376153">list</span>&nbsp;<span class="op" id="1376158">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376162">if</span>&nbsp;<span class="ident" id="1376165">filterSpec</span><span class="op" id="1376175">(</span><span class="ident" id="1376176">s</span><span class="op" id="1376177">,</span>&nbsp;<span class="ident" id="1376179">f</span><span class="op" id="1376180">,</span>&nbsp;<span class="ident" id="1376182">export</span><span class="op" id="1376188">)</span>&nbsp;<span class="op" id="1376190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376195">list</span><span class="op" id="1376199">[</span><span class="ident" id="1376200">j</span><span class="op" id="1376201">]</span>&nbsp;<span class="op" id="1376203">=</span>&nbsp;<span class="ident" id="1376205">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376210">j</span><span class="op" id="1376211">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376219">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376222">return</span>&nbsp;<span class="ident" id="1376229">list</span><span class="op" id="1376233">[</span><span class="num" id="1376234">0</span><span class="op" id="1376235">:</span><span class="ident" id="1376236">j</span><span class="op" id="1376237">]</span><br>
<span class="lineno"></span><span class="op" id="1376239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1376242">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="1376312">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="1376381">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1376448">//</span><br>
<span class="lineno"></span><span class="comment" id="1376451">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="1376521">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="1376563">//</span><br>
<span class="lineno">205</span><span class="keyword" id="1376566">func</span>&nbsp;<span class="ident" id="1376571">FilterDecl</span><span class="op" id="1376581">(</span><span class="ident" id="1376582">decl</span>&nbsp;<span class="ident" id="1376587">Decl</span><span class="op" id="1376591">,</span>&nbsp;<span class="ident" id="1376593">f</span>&nbsp;<span class="ident" id="1376595">Filter</span><span class="op" id="1376601">)</span>&nbsp;<span class="builtintype" id="1376603">bool</span>&nbsp;<span class="op" id="1376608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376611">return</span>&nbsp;<span class="ident" id="1376618">filterDecl</span><span class="op" id="1376628">(</span><span class="ident" id="1376629">decl</span><span class="op" id="1376633">,</span>&nbsp;<span class="ident" id="1376635">f</span><span class="op" id="1376636">,</span>&nbsp;<span class="builtintype" id="1376638">false</span><span class="op" id="1376643">)</span><br>
<span class="lineno"></span><span class="op" id="1376645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1376648">func</span>&nbsp;<span class="ident" id="1376653">filterDecl</span><span class="op" id="1376663">(</span><span class="ident" id="1376664">decl</span>&nbsp;<span class="ident" id="1376669">Decl</span><span class="op" id="1376673">,</span>&nbsp;<span class="ident" id="1376675">f</span>&nbsp;<span class="ident" id="1376677">Filter</span><span class="op" id="1376683">,</span>&nbsp;<span class="ident" id="1376685">export</span>&nbsp;<span class="builtintype" id="1376692">bool</span><span class="op" id="1376696">)</span>&nbsp;<span class="builtintype" id="1376698">bool</span>&nbsp;<span class="op" id="1376703">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376706">switch</span>&nbsp;<span class="ident" id="1376713">d</span>&nbsp;<span class="op" id="1376715">:=</span>&nbsp;<span class="ident" id="1376718">decl</span><span class="op" id="1376722">.</span><span class="op" id="1376723">(</span><span class="keyword" id="1376724">type</span><span class="op" id="1376728">)</span>&nbsp;<span class="op" id="1376730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376733">case</span>&nbsp;<span class="op" id="1376738">*</span><span class="ident" id="1376739">GenDecl</span><span class="op" id="1376746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1376750">d</span><span class="op" id="1376751">.</span><span class="ident" id="1376752">Specs</span>&nbsp;<span class="op" id="1376758">=</span>&nbsp;<span class="ident" id="1376760">filterSpecList</span><span class="op" id="1376774">(</span><span class="ident" id="1376775">d</span><span class="op" id="1376776">.</span><span class="ident" id="1376777">Specs</span><span class="op" id="1376782">,</span>&nbsp;<span class="ident" id="1376784">f</span><span class="op" id="1376785">,</span>&nbsp;<span class="ident" id="1376787">export</span><span class="op" id="1376793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376797">return</span>&nbsp;<span class="builtinfunc" id="1376804">len</span><span class="op" id="1376807">(</span><span class="ident" id="1376808">d</span><span class="op" id="1376809">.</span><span class="ident" id="1376810">Specs</span><span class="op" id="1376815">)</span>&nbsp;<span class="op" id="1376817">&gt;</span>&nbsp;<span class="num" id="1376819">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376822">case</span>&nbsp;<span class="op" id="1376827">*</span><span class="ident" id="1376828">FuncDecl</span><span class="op" id="1376836">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376840">return</span>&nbsp;<span class="ident" id="1376847">f</span><span class="op" id="1376848">(</span><span class="ident" id="1376849">d</span><span class="op" id="1376850">.</span><span class="ident" id="1376851">Name</span><span class="op" id="1376855">.</span><span class="ident" id="1376856">Name</span><span class="op" id="1376860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1376863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1376866">return</span>&nbsp;<span class="builtintype" id="1376873">false</span><br>
<span class="lineno"></span><span class="op" id="1376879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1376882">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1376949">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1377014">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1377082">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="1377152">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="1377219">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="1377238">//</span><br>
<span class="lineno"></span><span class="comment" id="1377241">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="1377308">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="1377361">//</span><br>
<span class="lineno">230</span><span class="keyword" id="1377364">func</span>&nbsp;<span class="ident" id="1377369">FilterFile</span><span class="op" id="1377379">(</span><span class="ident" id="1377380">src</span>&nbsp;<span class="op" id="1377384">*</span><span class="ident" id="1377385">File</span><span class="op" id="1377389">,</span>&nbsp;<span class="ident" id="1377391">f</span>&nbsp;<span class="ident" id="1377393">Filter</span><span class="op" id="1377399">)</span>&nbsp;<span class="builtintype" id="1377401">bool</span>&nbsp;<span class="op" id="1377406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1377409">return</span>&nbsp;<span class="ident" id="1377416">filterFile</span><span class="op" id="1377426">(</span><span class="ident" id="1377427">src</span><span class="op" id="1377430">,</span>&nbsp;<span class="ident" id="1377432">f</span><span class="op" id="1377433">,</span>&nbsp;<span class="builtintype" id="1377435">false</span><span class="op" id="1377440">)</span><br>
<span class="lineno"></span><span class="op" id="1377442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1377445">func</span>&nbsp;<span class="ident" id="1377450">filterFile</span><span class="op" id="1377460">(</span><span class="ident" id="1377461">src</span>&nbsp;<span class="op" id="1377465">*</span><span class="ident" id="1377466">File</span><span class="op" id="1377470">,</span>&nbsp;<span class="ident" id="1377472">f</span>&nbsp;<span class="ident" id="1377474">Filter</span><span class="op" id="1377480">,</span>&nbsp;<span class="ident" id="1377482">export</span>&nbsp;<span class="builtintype" id="1377489">bool</span><span class="op" id="1377493">)</span>&nbsp;<span class="builtintype" id="1377495">bool</span>&nbsp;<span class="op" id="1377500">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377503">j</span>&nbsp;<span class="op" id="1377505">:=</span>&nbsp;<span class="num" id="1377508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1377511">for</span>&nbsp;<span class="ident" id="1377515">_</span><span class="op" id="1377516">,</span>&nbsp;<span class="ident" id="1377518">d</span>&nbsp;<span class="op" id="1377520">:=</span>&nbsp;<span class="keyword" id="1377523">range</span>&nbsp;<span class="ident" id="1377529">src</span><span class="op" id="1377532">.</span><span class="ident" id="1377533">Decls</span>&nbsp;<span class="op" id="1377539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1377543">if</span>&nbsp;<span class="ident" id="1377546">filterDecl</span><span class="op" id="1377556">(</span><span class="ident" id="1377557">d</span><span class="op" id="1377558">,</span>&nbsp;<span class="ident" id="1377560">f</span><span class="op" id="1377561">,</span>&nbsp;<span class="ident" id="1377563">export</span><span class="op" id="1377569">)</span>&nbsp;<span class="op" id="1377571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377576">src</span><span class="op" id="1377579">.</span><span class="ident" id="1377580">Decls</span><span class="op" id="1377585">[</span><span class="ident" id="1377586">j</span><span class="op" id="1377587">]</span>&nbsp;<span class="op" id="1377589">=</span>&nbsp;<span class="ident" id="1377591">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377596">j</span><span class="op" id="1377597">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1377602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1377605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1377608">src</span><span class="op" id="1377611">.</span><span class="ident" id="1377612">Decls</span>&nbsp;<span class="op" id="1377618">=</span>&nbsp;<span class="ident" id="1377620">src</span><span class="op" id="1377623">.</span><span class="ident" id="1377624">Decls</span><span class="op" id="1377629">[</span><span class="num" id="1377630">0</span><span class="op" id="1377631">:</span><span class="ident" id="1377632">j</span><span class="op" id="1377633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1377636">return</span>&nbsp;<span class="ident" id="1377643">j</span>&nbsp;<span class="op" id="1377645">&gt;</span>&nbsp;<span class="num" id="1377647">0</span><br>
<span class="lineno"></span><span class="op" id="1377649">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="1377652">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="1377721">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1377790">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1377858">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="1377928">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1377998">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="1378070">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="1378079">//</span><br>
<span class="lineno"></span><span class="comment" id="1378082">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="1378152">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="1378205">//</span><br>
<span class="lineno"></span><span class="keyword" id="1378208">func</span>&nbsp;<span class="ident" id="1378213">FilterPackage</span><span class="op" id="1378226">(</span><span class="ident" id="1378227">pkg</span>&nbsp;<span class="op" id="1378231">*</span><span class="ident" id="1378232">Package</span><span class="op" id="1378239">,</span>&nbsp;<span class="ident" id="1378241">f</span>&nbsp;<span class="ident" id="1378243">Filter</span><span class="op" id="1378249">)</span>&nbsp;<span class="builtintype" id="1378251">bool</span>&nbsp;<span class="op" id="1378256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378259">return</span>&nbsp;<span class="ident" id="1378266">filterPackage</span><span class="op" id="1378279">(</span><span class="ident" id="1378280">pkg</span><span class="op" id="1378283">,</span>&nbsp;<span class="ident" id="1378285">f</span><span class="op" id="1378286">,</span>&nbsp;<span class="builtintype" id="1378288">false</span><span class="op" id="1378293">)</span><br>
<span class="lineno"></span><span class="op" id="1378295">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="1378298">func</span>&nbsp;<span class="ident" id="1378303">filterPackage</span><span class="op" id="1378316">(</span><span class="ident" id="1378317">pkg</span>&nbsp;<span class="op" id="1378321">*</span><span class="ident" id="1378322">Package</span><span class="op" id="1378329">,</span>&nbsp;<span class="ident" id="1378331">f</span>&nbsp;<span class="ident" id="1378333">Filter</span><span class="op" id="1378339">,</span>&nbsp;<span class="ident" id="1378341">export</span>&nbsp;<span class="builtintype" id="1378348">bool</span><span class="op" id="1378352">)</span>&nbsp;<span class="builtintype" id="1378354">bool</span>&nbsp;<span class="op" id="1378359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378362">hasDecls</span>&nbsp;<span class="op" id="1378371">:=</span>&nbsp;<span class="builtintype" id="1378374">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378381">for</span>&nbsp;<span class="ident" id="1378385">_</span><span class="op" id="1378386">,</span>&nbsp;<span class="ident" id="1378388">src</span>&nbsp;<span class="op" id="1378392">:=</span>&nbsp;<span class="keyword" id="1378395">range</span>&nbsp;<span class="ident" id="1378401">pkg</span><span class="op" id="1378404">.</span><span class="ident" id="1378405">Files</span>&nbsp;<span class="op" id="1378411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378415">if</span>&nbsp;<span class="ident" id="1378418">filterFile</span><span class="op" id="1378428">(</span><span class="ident" id="1378429">src</span><span class="op" id="1378432">,</span>&nbsp;<span class="ident" id="1378434">f</span><span class="op" id="1378435">,</span>&nbsp;<span class="ident" id="1378437">export</span><span class="op" id="1378443">)</span>&nbsp;<span class="op" id="1378445">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378450">hasDecls</span>&nbsp;<span class="op" id="1378459">=</span>&nbsp;<span class="builtintype" id="1378461">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1378471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1378474">return</span>&nbsp;<span class="ident" id="1378481">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="1378490">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="1378493">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="1378573">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378602">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="1378668">type</span>&nbsp;<span class="ident" id="1378673">MergeMode</span>&nbsp;<span class="builtintype" id="1378683">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1378689">const</span>&nbsp;<span class="op" id="1378695">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378698">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378756">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="1378777">MergeMode</span>&nbsp;<span class="op" id="1378787">=</span>&nbsp;<span class="num" id="1378789">1</span>&nbsp;<span class="op" id="1378791">&lt;&lt;</span>&nbsp;<span class="ident" id="1378794">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378800">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378861">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378908">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1378936">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1378992">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="1379015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379018">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1379084">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1379151">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="1379195">//</span><br>
<span class="lineno"></span><span class="keyword" id="1379198">func</span>&nbsp;<span class="ident" id="1379203">nameOf</span><span class="op" id="1379209">(</span><span class="ident" id="1379210">f</span>&nbsp;<span class="op" id="1379212">*</span><span class="ident" id="1379213">FuncDecl</span><span class="op" id="1379221">)</span>&nbsp;<span class="builtintype" id="1379223">string</span>&nbsp;<span class="op" id="1379230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379233">if</span>&nbsp;<span class="ident" id="1379236">r</span>&nbsp;<span class="op" id="1379238">:=</span>&nbsp;<span class="ident" id="1379241">f</span><span class="op" id="1379242">.</span><span class="ident" id="1379243">Recv</span><span class="op" id="1379247">;</span>&nbsp;<span class="ident" id="1379249">r</span>&nbsp;<span class="op" id="1379251">!=</span>&nbsp;<span class="ident" id="1379254">nil</span>&nbsp;<span class="op" id="1379258">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1379261">len</span><span class="op" id="1379264">(</span><span class="ident" id="1379265">r</span><span class="op" id="1379266">.</span><span class="ident" id="1379267">List</span><span class="op" id="1379271">)</span>&nbsp;<span class="op" id="1379273">==</span>&nbsp;<span class="num" id="1379276">1</span>&nbsp;<span class="op" id="1379278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379282">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379329">t</span>&nbsp;<span class="op" id="1379331">:=</span>&nbsp;<span class="ident" id="1379334">r</span><span class="op" id="1379335">.</span><span class="ident" id="1379336">List</span><span class="op" id="1379340">[</span><span class="num" id="1379341">0</span><span class="op" id="1379342">]</span><span class="op" id="1379343">.</span><span class="ident" id="1379344">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379351">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379391">if</span>&nbsp;<span class="ident" id="1379394">p</span><span class="op" id="1379395">,</span>&nbsp;<span class="ident" id="1379397">_</span>&nbsp;<span class="op" id="1379399">:=</span>&nbsp;<span class="ident" id="1379402">t</span><span class="op" id="1379403">.</span><span class="op" id="1379404">(</span><span class="op" id="1379405">*</span><span class="ident" id="1379406">StarExpr</span><span class="op" id="1379414">)</span><span class="op" id="1379415">;</span>&nbsp;<span class="ident" id="1379417">p</span>&nbsp;<span class="op" id="1379419">!=</span>&nbsp;<span class="ident" id="1379422">nil</span>&nbsp;<span class="op" id="1379426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1379431">t</span>&nbsp;<span class="op" id="1379433">=</span>&nbsp;<span class="ident" id="1379435">p</span><span class="op" id="1379436">.</span><span class="ident" id="1379437">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379445">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379488">if</span>&nbsp;<span class="ident" id="1379491">p</span><span class="op" id="1379492">,</span>&nbsp;<span class="ident" id="1379494">_</span>&nbsp;<span class="op" id="1379496">:=</span>&nbsp;<span class="ident" id="1379499">t</span><span class="op" id="1379500">.</span><span class="op" id="1379501">(</span><span class="op" id="1379502">*</span><span class="ident" id="1379503">Ident</span><span class="op" id="1379508">)</span><span class="op" id="1379509">;</span>&nbsp;<span class="ident" id="1379511">p</span>&nbsp;<span class="op" id="1379513">!=</span>&nbsp;<span class="ident" id="1379516">nil</span>&nbsp;<span class="op" id="1379520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379525">return</span>&nbsp;<span class="ident" id="1379532">p</span><span class="op" id="1379533">.</span><span class="ident" id="1379534">Name</span>&nbsp;<span class="op" id="1379539">+</span>&nbsp;<span class="string" id="1379541">&#34;.&#34;</span>&nbsp;<span class="op" id="1379545">+</span>&nbsp;<span class="ident" id="1379547">f</span><span class="op" id="1379548">.</span><span class="ident" id="1379549">Name</span><span class="op" id="1379553">.</span><span class="ident" id="1379554">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1379565">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1379605">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1379608">return</span>&nbsp;<span class="ident" id="1379615">f</span><span class="op" id="1379616">.</span><span class="ident" id="1379617">Name</span><span class="op" id="1379621">.</span><span class="ident" id="1379622">Name</span><br>
<span class="lineno"></span><span class="op" id="1379627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379630">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="1379701">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="1379776">//</span><br>
<span class="lineno"></span><span class="keyword" id="1379779">var</span>&nbsp;<span class="ident" id="1379783">separator</span>&nbsp;<span class="op" id="1379793">=</span>&nbsp;<span class="op" id="1379795">&amp;</span><span class="ident" id="1379796">Comment</span><span class="op" id="1379803">{</span><span class="ident" id="1379804">token</span><span class="op" id="1379809">.</span><span class="ident" id="1379810">NoPos</span><span class="op" id="1379815">,</span>&nbsp;<span class="string" id="1379817">&#34;//&#34;</span><span class="op" id="1379821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379824">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1379891">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="1379965">//</span><br>
<span class="lineno"></span><span class="keyword" id="1379968">func</span>&nbsp;<span class="ident" id="1379973">MergePackageFiles</span><span class="op" id="1379990">(</span><span class="ident" id="1379991">pkg</span>&nbsp;<span class="op" id="1379995">*</span><span class="ident" id="1379996">Package</span><span class="op" id="1380003">,</span>&nbsp;<span class="ident" id="1380005">mode</span>&nbsp;<span class="ident" id="1380010">MergeMode</span><span class="op" id="1380019">)</span>&nbsp;<span class="op" id="1380021">*</span><span class="ident" id="1380022">File</span>&nbsp;<span class="op" id="1380027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380030">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380101">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380172">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380236">ndocs</span>&nbsp;<span class="op" id="1380242">:=</span>&nbsp;<span class="num" id="1380245">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380248">ncomments</span>&nbsp;<span class="op" id="1380258">:=</span>&nbsp;<span class="num" id="1380261">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380264">ndecls</span>&nbsp;<span class="op" id="1380271">:=</span>&nbsp;<span class="num" id="1380274">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380277">filenames</span>&nbsp;<span class="op" id="1380287">:=</span>&nbsp;<span class="builtinfunc" id="1380290">make</span><span class="op" id="1380294">(</span><span class="op" id="1380295">[</span><span class="op" id="1380296">]</span><span class="builtintype" id="1380297">string</span><span class="op" id="1380303">,</span>&nbsp;<span class="builtinfunc" id="1380305">len</span><span class="op" id="1380308">(</span><span class="ident" id="1380309">pkg</span><span class="op" id="1380312">.</span><span class="ident" id="1380313">Files</span><span class="op" id="1380318">)</span><span class="op" id="1380319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380322">i</span>&nbsp;<span class="op" id="1380324">:=</span>&nbsp;<span class="num" id="1380327">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380330">for</span>&nbsp;<span class="ident" id="1380334">filename</span><span class="op" id="1380342">,</span>&nbsp;<span class="ident" id="1380344">f</span>&nbsp;<span class="op" id="1380346">:=</span>&nbsp;<span class="keyword" id="1380349">range</span>&nbsp;<span class="ident" id="1380355">pkg</span><span class="op" id="1380358">.</span><span class="ident" id="1380359">Files</span>&nbsp;<span class="op" id="1380365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380369">filenames</span><span class="op" id="1380378">[</span><span class="ident" id="1380379">i</span><span class="op" id="1380380">]</span>&nbsp;<span class="op" id="1380382">=</span>&nbsp;<span class="ident" id="1380384">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380395">i</span><span class="op" id="1380396">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380401">if</span>&nbsp;<span class="ident" id="1380404">f</span><span class="op" id="1380405">.</span><span class="ident" id="1380406">Doc</span>&nbsp;<span class="op" id="1380410">!=</span>&nbsp;<span class="ident" id="1380413">nil</span>&nbsp;<span class="op" id="1380417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380422">ndocs</span>&nbsp;<span class="op" id="1380428">+=</span>&nbsp;<span class="builtinfunc" id="1380431">len</span><span class="op" id="1380434">(</span><span class="ident" id="1380435">f</span><span class="op" id="1380436">.</span><span class="ident" id="1380437">Doc</span><span class="op" id="1380440">.</span><span class="ident" id="1380441">List</span><span class="op" id="1380445">)</span>&nbsp;<span class="op" id="1380447">+</span>&nbsp;<span class="num" id="1380449">1</span>&nbsp;<span class="comment" id="1380451">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1380473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380477">ncomments</span>&nbsp;<span class="op" id="1380487">+=</span>&nbsp;<span class="builtinfunc" id="1380490">len</span><span class="op" id="1380493">(</span><span class="ident" id="1380494">f</span><span class="op" id="1380495">.</span><span class="ident" id="1380496">Comments</span><span class="op" id="1380504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380508">ndecls</span>&nbsp;<span class="op" id="1380515">+=</span>&nbsp;<span class="builtinfunc" id="1380518">len</span><span class="op" id="1380521">(</span><span class="ident" id="1380522">f</span><span class="op" id="1380523">.</span><span class="ident" id="1380524">Decls</span><span class="op" id="1380529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1380532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380535">sort</span><span class="op" id="1380539">.</span><span class="ident" id="1380540">Strings</span><span class="op" id="1380547">(</span><span class="ident" id="1380548">filenames</span><span class="op" id="1380557">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380561">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380627">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380694">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1380761">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380827">var</span>&nbsp;<span class="ident" id="1380831">doc</span>&nbsp;<span class="op" id="1380835">*</span><span class="ident" id="1380836">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380850">var</span>&nbsp;<span class="ident" id="1380854">pos</span>&nbsp;<span class="ident" id="1380858">token</span><span class="op" id="1380863">.</span><span class="ident" id="1380864">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380869">if</span>&nbsp;<span class="ident" id="1380872">ndocs</span>&nbsp;<span class="op" id="1380878">&gt;</span>&nbsp;<span class="num" id="1380880">0</span>&nbsp;<span class="op" id="1380882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380886">list</span>&nbsp;<span class="op" id="1380891">:=</span>&nbsp;<span class="builtinfunc" id="1380894">make</span><span class="op" id="1380898">(</span><span class="op" id="1380899">[</span><span class="op" id="1380900">]</span><span class="op" id="1380901">*</span><span class="ident" id="1380902">Comment</span><span class="op" id="1380909">,</span>&nbsp;<span class="ident" id="1380911">ndocs</span><span class="op" id="1380916">-</span><span class="num" id="1380917">1</span><span class="op" id="1380918">)</span>&nbsp;<span class="comment" id="1380920">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1380961">i</span>&nbsp;<span class="op" id="1380963">:=</span>&nbsp;<span class="num" id="1380966">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1380970">for</span>&nbsp;<span class="ident" id="1380974">_</span><span class="op" id="1380975">,</span>&nbsp;<span class="ident" id="1380977">filename</span>&nbsp;<span class="op" id="1380986">:=</span>&nbsp;<span class="keyword" id="1380989">range</span>&nbsp;<span class="ident" id="1380995">filenames</span>&nbsp;<span class="op" id="1381005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381010">f</span>&nbsp;<span class="op" id="1381012">:=</span>&nbsp;<span class="ident" id="1381015">pkg</span><span class="op" id="1381018">.</span><span class="ident" id="1381019">Files</span><span class="op" id="1381024">[</span><span class="ident" id="1381025">filename</span><span class="op" id="1381033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381038">if</span>&nbsp;<span class="ident" id="1381041">f</span><span class="op" id="1381042">.</span><span class="ident" id="1381043">Doc</span>&nbsp;<span class="op" id="1381047">!=</span>&nbsp;<span class="ident" id="1381050">nil</span>&nbsp;<span class="op" id="1381054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381060">if</span>&nbsp;<span class="ident" id="1381063">i</span>&nbsp;<span class="op" id="1381065">&gt;</span>&nbsp;<span class="num" id="1381067">0</span>&nbsp;<span class="op" id="1381069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381076">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381120">list</span><span class="op" id="1381124">[</span><span class="ident" id="1381125">i</span><span class="op" id="1381126">]</span>&nbsp;<span class="op" id="1381128">=</span>&nbsp;<span class="ident" id="1381130">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381145">i</span><span class="op" id="1381146">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381159">for</span>&nbsp;<span class="ident" id="1381163">_</span><span class="op" id="1381164">,</span>&nbsp;<span class="ident" id="1381166">c</span>&nbsp;<span class="op" id="1381168">:=</span>&nbsp;<span class="keyword" id="1381171">range</span>&nbsp;<span class="ident" id="1381177">f</span><span class="op" id="1381178">.</span><span class="ident" id="1381179">Doc</span><span class="op" id="1381182">.</span><span class="ident" id="1381183">List</span>&nbsp;<span class="op" id="1381188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381195">list</span><span class="op" id="1381199">[</span><span class="ident" id="1381200">i</span><span class="op" id="1381201">]</span>&nbsp;<span class="op" id="1381203">=</span>&nbsp;<span class="ident" id="1381205">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381212">i</span><span class="op" id="1381213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381226">if</span>&nbsp;<span class="ident" id="1381229">f</span><span class="op" id="1381230">.</span><span class="ident" id="1381231">Package</span>&nbsp;<span class="op" id="1381239">&gt;</span>&nbsp;<span class="ident" id="1381241">pos</span>&nbsp;<span class="op" id="1381245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381252">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381304">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381358">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381373">pos</span>&nbsp;<span class="op" id="1381377">=</span>&nbsp;<span class="ident" id="1381379">f</span><span class="op" id="1381380">.</span><span class="ident" id="1381381">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381402">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381406">doc</span>&nbsp;<span class="op" id="1381410">=</span>&nbsp;<span class="op" id="1381412">&amp;</span><span class="ident" id="1381413">CommentGroup</span><span class="op" id="1381425">{</span><span class="ident" id="1381426">list</span><span class="op" id="1381430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1381433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381437">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381486">var</span>&nbsp;<span class="ident" id="1381490">decls</span>&nbsp;<span class="op" id="1381496">[</span><span class="op" id="1381497">]</span><span class="ident" id="1381498">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381504">if</span>&nbsp;<span class="ident" id="1381507">ndecls</span>&nbsp;<span class="op" id="1381514">&gt;</span>&nbsp;<span class="num" id="1381516">0</span>&nbsp;<span class="op" id="1381518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381522">decls</span>&nbsp;<span class="op" id="1381528">=</span>&nbsp;<span class="builtinfunc" id="1381530">make</span><span class="op" id="1381534">(</span><span class="op" id="1381535">[</span><span class="op" id="1381536">]</span><span class="ident" id="1381537">Decl</span><span class="op" id="1381541">,</span>&nbsp;<span class="ident" id="1381543">ndecls</span><span class="op" id="1381549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381553">funcs</span>&nbsp;<span class="op" id="1381559">:=</span>&nbsp;<span class="builtinfunc" id="1381562">make</span><span class="op" id="1381566">(</span><span class="keyword" id="1381567">map</span><span class="op" id="1381570">[</span><span class="builtintype" id="1381571">string</span><span class="op" id="1381577">]</span><span class="builtintype" id="1381578">int</span><span class="op" id="1381581">)</span>&nbsp;<span class="comment" id="1381583">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381620">i</span>&nbsp;<span class="op" id="1381622">:=</span>&nbsp;<span class="num" id="1381625">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1381650">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381669">n</span>&nbsp;<span class="op" id="1381671">:=</span>&nbsp;<span class="num" id="1381674">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1381699">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381731">for</span>&nbsp;<span class="ident" id="1381735">_</span><span class="op" id="1381736">,</span>&nbsp;<span class="ident" id="1381738">filename</span>&nbsp;<span class="op" id="1381747">:=</span>&nbsp;<span class="keyword" id="1381750">range</span>&nbsp;<span class="ident" id="1381756">filenames</span>&nbsp;<span class="op" id="1381766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1381771">f</span>&nbsp;<span class="op" id="1381773">:=</span>&nbsp;<span class="ident" id="1381776">pkg</span><span class="op" id="1381779">.</span><span class="ident" id="1381780">Files</span><span class="op" id="1381785">[</span><span class="ident" id="1381786">filename</span><span class="op" id="1381794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381799">for</span>&nbsp;<span class="ident" id="1381803">_</span><span class="op" id="1381804">,</span>&nbsp;<span class="ident" id="1381806">d</span>&nbsp;<span class="op" id="1381808">:=</span>&nbsp;<span class="keyword" id="1381811">range</span>&nbsp;<span class="ident" id="1381817">f</span><span class="op" id="1381818">.</span><span class="ident" id="1381819">Decls</span>&nbsp;<span class="op" id="1381825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1381831">if</span>&nbsp;<span class="ident" id="1381834">mode</span><span class="op" id="1381838">&amp;</span><span class="ident" id="1381839">FilterFuncDuplicates</span>&nbsp;<span class="op" id="1381860">!=</span>&nbsp;<span class="num" id="1381863">0</span>&nbsp;<span class="op" id="1381865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381872">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381923">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1381973">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382021">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382071">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382124">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382132">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382182">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382286">if</span>&nbsp;<span class="ident" id="1382289">f</span><span class="op" id="1382290">,</span>&nbsp;<span class="ident" id="1382292">isFun</span>&nbsp;<span class="op" id="1382298">:=</span>&nbsp;<span class="ident" id="1382301">d</span><span class="op" id="1382302">.</span><span class="op" id="1382303">(</span><span class="op" id="1382304">*</span><span class="ident" id="1382305">FuncDecl</span><span class="op" id="1382313">)</span><span class="op" id="1382314">;</span>&nbsp;<span class="ident" id="1382316">isFun</span>&nbsp;<span class="op" id="1382322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382330">name</span>&nbsp;<span class="op" id="1382335">:=</span>&nbsp;<span class="ident" id="1382338">nameOf</span><span class="op" id="1382344">(</span><span class="ident" id="1382345">f</span><span class="op" id="1382346">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382354">if</span>&nbsp;<span class="ident" id="1382357">j</span><span class="op" id="1382358">,</span>&nbsp;<span class="ident" id="1382360">exists</span>&nbsp;<span class="op" id="1382367">:=</span>&nbsp;<span class="ident" id="1382370">funcs</span><span class="op" id="1382375">[</span><span class="ident" id="1382376">name</span><span class="op" id="1382380">]</span><span class="op" id="1382381">;</span>&nbsp;<span class="ident" id="1382383">exists</span>&nbsp;<span class="op" id="1382390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382399">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1382435">if</span>&nbsp;<span class="ident" id="1382438">decls</span><span class="op" id="1382443">[</span><span class="ident" id="1382444">j</span><span class="op" id="1382445">]</span>&nbsp;<span class="op" id="1382447">!=</span>&nbsp;<span class="ident" id="1382450">nil</span>&nbsp;<span class="op" id="1382454">&amp;&amp;</span>&nbsp;<span class="ident" id="1382457">decls</span><span class="op" id="1382462">[</span><span class="ident" id="1382463">j</span><span class="op" id="1382464">]</span><span class="op" id="1382465">.</span><span class="op" id="1382466">(</span><span class="op" id="1382467">*</span><span class="ident" id="1382468">FuncDecl</span><span class="op" id="1382476">)</span><span class="op" id="1382477">.</span><span class="ident" id="1382478">Doc</span>&nbsp;<span class="op" id="1382482">==</span>&nbsp;<span class="ident" id="1382485">nil</span>&nbsp;<span class="op" id="1382489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382499">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382553">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382596">decls</span><span class="op" id="1382601">[</span><span class="ident" id="1382602">j</span><span class="op" id="1382603">]</span>&nbsp;<span class="op" id="1382605">=</span>&nbsp;<span class="ident" id="1382607">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382618">}</span>&nbsp;<span class="keyword" id="1382620">else</span>&nbsp;<span class="op" id="1382625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382635">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382673">d</span>&nbsp;<span class="op" id="1382675">=</span>&nbsp;<span class="ident" id="1382677">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382688">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382697">n</span><span class="op" id="1382698">++</span>&nbsp;<span class="comment" id="1382701">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382728">}</span>&nbsp;<span class="keyword" id="1382730">else</span>&nbsp;<span class="op" id="1382735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382744">funcs</span><span class="op" id="1382749">[</span><span class="ident" id="1382750">name</span><span class="op" id="1382754">]</span>&nbsp;<span class="op" id="1382756">=</span>&nbsp;<span class="ident" id="1382758">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382773">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382785">decls</span><span class="op" id="1382790">[</span><span class="ident" id="1382791">i</span><span class="op" id="1382792">]</span>&nbsp;<span class="op" id="1382794">=</span>&nbsp;<span class="ident" id="1382796">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1382802">i</span><span class="op" id="1382803">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1382813">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382818">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382881">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1382948">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383015">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383080">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383113">if</span>&nbsp;<span class="ident" id="1383116">n</span>&nbsp;<span class="op" id="1383118">&gt;</span>&nbsp;<span class="num" id="1383120">0</span>&nbsp;<span class="op" id="1383122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383127">i</span>&nbsp;<span class="op" id="1383129">=</span>&nbsp;<span class="num" id="1383131">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383136">for</span>&nbsp;<span class="ident" id="1383140">_</span><span class="op" id="1383141">,</span>&nbsp;<span class="ident" id="1383143">d</span>&nbsp;<span class="op" id="1383145">:=</span>&nbsp;<span class="keyword" id="1383148">range</span>&nbsp;<span class="ident" id="1383154">decls</span>&nbsp;<span class="op" id="1383160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383166">if</span>&nbsp;<span class="ident" id="1383169">d</span>&nbsp;<span class="op" id="1383171">!=</span>&nbsp;<span class="ident" id="1383174">nil</span>&nbsp;<span class="op" id="1383178">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383185">decls</span><span class="op" id="1383190">[</span><span class="ident" id="1383191">i</span><span class="op" id="1383192">]</span>&nbsp;<span class="op" id="1383194">=</span>&nbsp;<span class="ident" id="1383196">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383203">i</span><span class="op" id="1383204">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383221">decls</span>&nbsp;<span class="op" id="1383227">=</span>&nbsp;<span class="ident" id="1383229">decls</span><span class="op" id="1383234">[</span><span class="num" id="1383235">0</span><span class="op" id="1383236">:</span><span class="ident" id="1383237">i</span><span class="op" id="1383238">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383249">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383298">var</span>&nbsp;<span class="ident" id="1383302">imports</span>&nbsp;<span class="op" id="1383310">[</span><span class="op" id="1383311">]</span><span class="op" id="1383312">*</span><span class="ident" id="1383313">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383325">if</span>&nbsp;<span class="ident" id="1383328">mode</span><span class="op" id="1383332">&amp;</span><span class="ident" id="1383333">FilterImportDuplicates</span>&nbsp;<span class="op" id="1383356">!=</span>&nbsp;<span class="num" id="1383359">0</span>&nbsp;<span class="op" id="1383361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383365">seen</span>&nbsp;<span class="op" id="1383370">:=</span>&nbsp;<span class="builtinfunc" id="1383373">make</span><span class="op" id="1383377">(</span><span class="keyword" id="1383378">map</span><span class="op" id="1383381">[</span><span class="builtintype" id="1383382">string</span><span class="op" id="1383388">]</span><span class="builtintype" id="1383389">bool</span><span class="op" id="1383393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383397">for</span>&nbsp;<span class="ident" id="1383401">_</span><span class="op" id="1383402">,</span>&nbsp;<span class="ident" id="1383404">filename</span>&nbsp;<span class="op" id="1383413">:=</span>&nbsp;<span class="keyword" id="1383416">range</span>&nbsp;<span class="ident" id="1383422">filenames</span>&nbsp;<span class="op" id="1383432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383437">f</span>&nbsp;<span class="op" id="1383439">:=</span>&nbsp;<span class="ident" id="1383442">pkg</span><span class="op" id="1383445">.</span><span class="ident" id="1383446">Files</span><span class="op" id="1383451">[</span><span class="ident" id="1383452">filename</span><span class="op" id="1383460">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383465">for</span>&nbsp;<span class="ident" id="1383469">_</span><span class="op" id="1383470">,</span>&nbsp;<span class="ident" id="1383472">imp</span>&nbsp;<span class="op" id="1383476">:=</span>&nbsp;<span class="keyword" id="1383479">range</span>&nbsp;<span class="ident" id="1383485">f</span><span class="op" id="1383486">.</span><span class="ident" id="1383487">Imports</span>&nbsp;<span class="op" id="1383495">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383501">if</span>&nbsp;<span class="ident" id="1383504">path</span>&nbsp;<span class="op" id="1383509">:=</span>&nbsp;<span class="ident" id="1383512">imp</span><span class="op" id="1383515">.</span><span class="ident" id="1383516">Path</span><span class="op" id="1383520">.</span><span class="ident" id="1383521">Value</span><span class="op" id="1383526">;</span>&nbsp;<span class="op" id="1383528">!</span><span class="ident" id="1383529">seen</span><span class="op" id="1383533">[</span><span class="ident" id="1383534">path</span><span class="op" id="1383538">]</span>&nbsp;<span class="op" id="1383540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383547">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383592">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383648">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383706">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383735">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383788">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1383843">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383873">imports</span>&nbsp;<span class="op" id="1383881">=</span>&nbsp;<span class="builtinfunc" id="1383883">append</span><span class="op" id="1383889">(</span><span class="ident" id="1383890">imports</span><span class="op" id="1383897">,</span>&nbsp;<span class="ident" id="1383899">imp</span><span class="op" id="1383902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383909">seen</span><span class="op" id="1383913">[</span><span class="ident" id="1383914">path</span><span class="op" id="1383918">]</span>&nbsp;<span class="op" id="1383920">=</span>&nbsp;<span class="builtintype" id="1383922">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1383943">}</span>&nbsp;<span class="keyword" id="1383945">else</span>&nbsp;<span class="op" id="1383950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1383954">for</span>&nbsp;<span class="ident" id="1383958">_</span><span class="op" id="1383959">,</span>&nbsp;<span class="ident" id="1383961">f</span>&nbsp;<span class="op" id="1383963">:=</span>&nbsp;<span class="keyword" id="1383966">range</span>&nbsp;<span class="ident" id="1383972">pkg</span><span class="op" id="1383975">.</span><span class="ident" id="1383976">Files</span>&nbsp;<span class="op" id="1383982">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1383987">imports</span>&nbsp;<span class="op" id="1383995">=</span>&nbsp;<span class="builtinfunc" id="1383997">append</span><span class="op" id="1384003">(</span><span class="ident" id="1384004">imports</span><span class="op" id="1384011">,</span>&nbsp;<span class="ident" id="1384013">f</span><span class="op" id="1384014">.</span><span class="ident" id="1384015">Imports</span><span class="op" id="1384022">...</span><span class="op" id="1384025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1384036">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384081">var</span>&nbsp;<span class="ident" id="1384085">comments</span>&nbsp;<span class="op" id="1384094">[</span><span class="op" id="1384095">]</span><span class="op" id="1384096">*</span><span class="ident" id="1384097">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384111">if</span>&nbsp;<span class="ident" id="1384114">mode</span><span class="op" id="1384118">&amp;</span><span class="ident" id="1384119">FilterUnassociatedComments</span>&nbsp;<span class="op" id="1384146">==</span>&nbsp;<span class="num" id="1384149">0</span>&nbsp;<span class="op" id="1384151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384155">comments</span>&nbsp;<span class="op" id="1384164">=</span>&nbsp;<span class="builtinfunc" id="1384166">make</span><span class="op" id="1384170">(</span><span class="op" id="1384171">[</span><span class="op" id="1384172">]</span><span class="op" id="1384173">*</span><span class="ident" id="1384174">CommentGroup</span><span class="op" id="1384186">,</span>&nbsp;<span class="ident" id="1384188">ncomments</span><span class="op" id="1384197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384201">i</span>&nbsp;<span class="op" id="1384203">:=</span>&nbsp;<span class="num" id="1384206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384210">for</span>&nbsp;<span class="ident" id="1384214">_</span><span class="op" id="1384215">,</span>&nbsp;<span class="ident" id="1384217">f</span>&nbsp;<span class="op" id="1384219">:=</span>&nbsp;<span class="keyword" id="1384222">range</span>&nbsp;<span class="ident" id="1384228">pkg</span><span class="op" id="1384231">.</span><span class="ident" id="1384232">Files</span>&nbsp;<span class="op" id="1384238">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1384243">i</span>&nbsp;<span class="op" id="1384245">+=</span>&nbsp;<span class="builtinfunc" id="1384248">copy</span><span class="op" id="1384252">(</span><span class="ident" id="1384253">comments</span><span class="op" id="1384261">[</span><span class="ident" id="1384262">i</span><span class="op" id="1384263">:</span><span class="op" id="1384264">]</span><span class="op" id="1384265">,</span>&nbsp;<span class="ident" id="1384267">f</span><span class="op" id="1384268">.</span><span class="ident" id="1384269">Comments</span><span class="op" id="1384277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1384284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1384288">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1384342">return</span>&nbsp;<span class="op" id="1384349">&amp;</span><span class="ident" id="1384350">File</span><span class="op" id="1384354">{</span><span class="ident" id="1384355">doc</span><span class="op" id="1384358">,</span>&nbsp;<span class="ident" id="1384360">pos</span><span class="op" id="1384363">,</span>&nbsp;<span class="ident" id="1384365">NewIdent</span><span class="op" id="1384373">(</span><span class="ident" id="1384374">pkg</span><span class="op" id="1384377">.</span><span class="ident" id="1384378">Name</span><span class="op" id="1384382">)</span><span class="op" id="1384383">,</span>&nbsp;<span class="ident" id="1384385">decls</span><span class="op" id="1384390">,</span>&nbsp;<span class="ident" id="1384392">pkg</span><span class="op" id="1384395">.</span><span class="ident" id="1384396">Scope</span><span class="op" id="1384401">,</span>&nbsp;<span class="ident" id="1384403">imports</span><span class="op" id="1384410">,</span>&nbsp;<span class="ident" id="1384412">nil</span><span class="op" id="1384415">,</span>&nbsp;<span class="ident" id="1384417">comments</span><span class="op" id="1384425">}</span><br>
<span class="lineno"></span><span class="op" id="1384427">}</span>
</div>
</body>
</html>
