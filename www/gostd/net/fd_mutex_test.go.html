<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7779338">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7779393">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7779447">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7779498">package</span>&nbsp;<span class="ident" id="7779506">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7779511">import</span>&nbsp;<span class="op" id="7779518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7779521">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7779534">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7779545">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7779556">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7779563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7779566">func</span>&nbsp;<span class="ident" id="7779571">TestMutexLock</span><span class="op" id="7779584">(</span><span class="ident" id="7779585">t</span>&nbsp;<span class="op" id="7779587">*</span><span class="ident" id="7779588">testing</span><span class="op" id="7779595">.</span><span class="ident" id="7779596">T</span><span class="op" id="7779597">)</span>&nbsp;<span class="op" id="7779599">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779602">var</span>&nbsp;<span class="ident" id="7779606">mu</span>&nbsp;<span class="ident" id="7779609">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779619">if</span>&nbsp;<span class="op" id="7779622">!</span><span class="ident" id="7779623">mu</span><span class="op" id="7779625">.</span><span class="ident" id="7779626">Incref</span><span class="op" id="7779632">(</span><span class="op" id="7779633">)</span>&nbsp;<span class="op" id="7779635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779639">t</span><span class="op" id="7779640">.</span><span class="ident" id="7779641">Fatal</span><span class="op" id="7779646">(</span><span class="string" id="7779647">&#34;broken&#34;</span><span class="op" id="7779655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779658">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779661">if</span>&nbsp;<span class="ident" id="7779664">mu</span><span class="op" id="7779666">.</span><span class="ident" id="7779667">Decref</span><span class="op" id="7779673">(</span><span class="op" id="7779674">)</span>&nbsp;<span class="op" id="7779676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779680">t</span><span class="op" id="7779681">.</span><span class="ident" id="7779682">Fatal</span><span class="op" id="7779687">(</span><span class="string" id="7779688">&#34;broken&#34;</span><span class="op" id="7779696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779703">if</span>&nbsp;<span class="op" id="7779706">!</span><span class="ident" id="7779707">mu</span><span class="op" id="7779709">.</span><span class="ident" id="7779710">RWLock</span><span class="op" id="7779716">(</span><span class="builtintype" id="7779717">true</span><span class="op" id="7779721">)</span>&nbsp;<span class="op" id="7779723">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779727">t</span><span class="op" id="7779728">.</span><span class="ident" id="7779729">Fatal</span><span class="op" id="7779734">(</span><span class="string" id="7779735">&#34;broken&#34;</span><span class="op" id="7779743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779749">if</span>&nbsp;<span class="ident" id="7779752">mu</span><span class="op" id="7779754">.</span><span class="ident" id="7779755">RWUnlock</span><span class="op" id="7779763">(</span><span class="builtintype" id="7779764">true</span><span class="op" id="7779768">)</span>&nbsp;<span class="op" id="7779770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779774">t</span><span class="op" id="7779775">.</span><span class="ident" id="7779776">Fatal</span><span class="op" id="7779781">(</span><span class="string" id="7779782">&#34;broken&#34;</span><span class="op" id="7779790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779793">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779797">if</span>&nbsp;<span class="op" id="7779800">!</span><span class="ident" id="7779801">mu</span><span class="op" id="7779803">.</span><span class="ident" id="7779804">RWLock</span><span class="op" id="7779810">(</span><span class="builtintype" id="7779811">false</span><span class="op" id="7779816">)</span>&nbsp;<span class="op" id="7779818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779822">t</span><span class="op" id="7779823">.</span><span class="ident" id="7779824">Fatal</span><span class="op" id="7779829">(</span><span class="string" id="7779830">&#34;broken&#34;</span><span class="op" id="7779838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779844">if</span>&nbsp;<span class="ident" id="7779847">mu</span><span class="op" id="7779849">.</span><span class="ident" id="7779850">RWUnlock</span><span class="op" id="7779858">(</span><span class="builtintype" id="7779859">false</span><span class="op" id="7779864">)</span>&nbsp;<span class="op" id="7779866">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779870">t</span><span class="op" id="7779871">.</span><span class="ident" id="7779872">Fatal</span><span class="op" id="7779877">(</span><span class="string" id="7779878">&#34;broken&#34;</span><span class="op" id="7779886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779889">}</span><br>
<span class="lineno"></span><span class="op" id="7779891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7779894">func</span>&nbsp;<span class="ident" id="7779899">TestMutexClose</span><span class="op" id="7779913">(</span><span class="ident" id="7779914">t</span>&nbsp;<span class="op" id="7779916">*</span><span class="ident" id="7779917">testing</span><span class="op" id="7779924">.</span><span class="ident" id="7779925">T</span><span class="op" id="7779926">)</span>&nbsp;<span class="op" id="7779928">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779931">var</span>&nbsp;<span class="ident" id="7779935">mu</span>&nbsp;<span class="ident" id="7779938">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779947">if</span>&nbsp;<span class="op" id="7779950">!</span><span class="ident" id="7779951">mu</span><span class="op" id="7779953">.</span><span class="ident" id="7779954">IncrefAndClose</span><span class="op" id="7779968">(</span><span class="op" id="7779969">)</span>&nbsp;<span class="op" id="7779971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7779975">t</span><span class="op" id="7779976">.</span><span class="ident" id="7779977">Fatal</span><span class="op" id="7779982">(</span><span class="string" id="7779983">&#34;broken&#34;</span><span class="op" id="7779991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7779994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7779998">if</span>&nbsp;<span class="ident" id="7780001">mu</span><span class="op" id="7780003">.</span><span class="ident" id="7780004">Incref</span><span class="op" id="7780010">(</span><span class="op" id="7780011">)</span>&nbsp;<span class="op" id="7780013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780017">t</span><span class="op" id="7780018">.</span><span class="ident" id="7780019">Fatal</span><span class="op" id="7780024">(</span><span class="string" id="7780025">&#34;broken&#34;</span><span class="op" id="7780033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780039">if</span>&nbsp;<span class="ident" id="7780042">mu</span><span class="op" id="7780044">.</span><span class="ident" id="7780045">RWLock</span><span class="op" id="7780051">(</span><span class="builtintype" id="7780052">true</span><span class="op" id="7780056">)</span>&nbsp;<span class="op" id="7780058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780062">t</span><span class="op" id="7780063">.</span><span class="ident" id="7780064">Fatal</span><span class="op" id="7780069">(</span><span class="string" id="7780070">&#34;broken&#34;</span><span class="op" id="7780078">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780084">if</span>&nbsp;<span class="ident" id="7780087">mu</span><span class="op" id="7780089">.</span><span class="ident" id="7780090">RWLock</span><span class="op" id="7780096">(</span><span class="builtintype" id="7780097">false</span><span class="op" id="7780102">)</span>&nbsp;<span class="op" id="7780104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780108">t</span><span class="op" id="7780109">.</span><span class="ident" id="7780110">Fatal</span><span class="op" id="7780115">(</span><span class="string" id="7780116">&#34;broken&#34;</span><span class="op" id="7780124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780130">if</span>&nbsp;<span class="ident" id="7780133">mu</span><span class="op" id="7780135">.</span><span class="ident" id="7780136">IncrefAndClose</span><span class="op" id="7780150">(</span><span class="op" id="7780151">)</span>&nbsp;<span class="op" id="7780153">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780157">t</span><span class="op" id="7780158">.</span><span class="ident" id="7780159">Fatal</span><span class="op" id="7780164">(</span><span class="string" id="7780165">&#34;broken&#34;</span><span class="op" id="7780173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780176">}</span><br>
<span class="lineno"></span><span class="op" id="7780178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7780181">func</span>&nbsp;<span class="ident" id="7780186">TestMutexCloseUnblock</span><span class="op" id="7780207">(</span><span class="ident" id="7780208">t</span>&nbsp;<span class="op" id="7780210">*</span><span class="ident" id="7780211">testing</span><span class="op" id="7780218">.</span><span class="ident" id="7780219">T</span><span class="op" id="7780220">)</span>&nbsp;<span class="op" id="7780222">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780225">c</span>&nbsp;<span class="op" id="7780227">:=</span>&nbsp;<span class="builtinfunc" id="7780230">make</span><span class="op" id="7780234">(</span><span class="keyword" id="7780235">chan</span>&nbsp;<span class="builtintype" id="7780240">bool</span><span class="op" id="7780244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780247">var</span>&nbsp;<span class="ident" id="7780251">mu</span>&nbsp;<span class="ident" id="7780254">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780263">mu</span><span class="op" id="7780265">.</span><span class="ident" id="7780266">RWLock</span><span class="op" id="7780272">(</span><span class="builtintype" id="7780273">true</span><span class="op" id="7780277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780280">for</span>&nbsp;<span class="ident" id="7780284">i</span>&nbsp;<span class="op" id="7780286">:=</span>&nbsp;<span class="num" id="7780289">0</span><span class="op" id="7780290">;</span>&nbsp;<span class="ident" id="7780292">i</span>&nbsp;<span class="op" id="7780294">&lt;</span>&nbsp;<span class="num" id="7780296">4</span><span class="op" id="7780297">;</span>&nbsp;<span class="ident" id="7780299">i</span><span class="op" id="7780300">++</span>&nbsp;<span class="op" id="7780303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780307">go</span>&nbsp;<span class="keyword" id="7780310">func</span><span class="op" id="7780314">(</span><span class="op" id="7780315">)</span>&nbsp;<span class="op" id="7780317">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780322">if</span>&nbsp;<span class="ident" id="7780325">mu</span><span class="op" id="7780327">.</span><span class="ident" id="7780328">RWLock</span><span class="op" id="7780334">(</span><span class="builtintype" id="7780335">true</span><span class="op" id="7780339">)</span>&nbsp;<span class="op" id="7780341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780347">t</span><span class="op" id="7780348">.</span><span class="ident" id="7780349">Error</span><span class="op" id="7780354">(</span><span class="string" id="7780355">&#34;broken&#34;</span><span class="op" id="7780363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780369">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780384">c</span>&nbsp;<span class="op" id="7780386">&lt;-</span>&nbsp;<span class="builtintype" id="7780389">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780396">}</span><span class="op" id="7780397">(</span><span class="op" id="7780398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7780404">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780471">time</span><span class="op" id="7780475">.</span><span class="ident" id="7780476">Sleep</span><span class="op" id="7780481">(</span><span class="ident" id="7780482">time</span><span class="op" id="7780486">.</span><span class="ident" id="7780487">Millisecond</span><span class="op" id="7780498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780501">select</span>&nbsp;<span class="op" id="7780508">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780511">case</span>&nbsp;<span class="op" id="7780516">&lt;-</span><span class="ident" id="7780518">c</span><span class="op" id="7780519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780523">t</span><span class="op" id="7780524">.</span><span class="ident" id="7780525">Fatal</span><span class="op" id="7780530">(</span><span class="string" id="7780531">&#34;broken&#34;</span><span class="op" id="7780539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780542">default</span><span class="op" id="7780549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780555">mu</span><span class="op" id="7780557">.</span><span class="ident" id="7780558">IncrefAndClose</span><span class="op" id="7780572">(</span><span class="op" id="7780573">)</span>&nbsp;<span class="comment" id="7780575">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780605">for</span>&nbsp;<span class="ident" id="7780609">i</span>&nbsp;<span class="op" id="7780611">:=</span>&nbsp;<span class="num" id="7780614">0</span><span class="op" id="7780615">;</span>&nbsp;<span class="ident" id="7780617">i</span>&nbsp;<span class="op" id="7780619">&lt;</span>&nbsp;<span class="num" id="7780621">4</span><span class="op" id="7780622">;</span>&nbsp;<span class="ident" id="7780624">i</span><span class="op" id="7780625">++</span>&nbsp;<span class="op" id="7780628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780632">select</span>&nbsp;<span class="op" id="7780639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780643">case</span>&nbsp;<span class="op" id="7780648">&lt;-</span><span class="ident" id="7780650">c</span><span class="op" id="7780651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780655">case</span>&nbsp;<span class="op" id="7780660">&lt;-</span><span class="ident" id="7780662">time</span><span class="op" id="7780666">.</span><span class="ident" id="7780667">After</span><span class="op" id="7780672">(</span><span class="num" id="7780673">10</span>&nbsp;<span class="op" id="7780676">*</span>&nbsp;<span class="ident" id="7780678">time</span><span class="op" id="7780682">.</span><span class="ident" id="7780683">Second</span><span class="op" id="7780689">)</span><span class="op" id="7780690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780695">t</span><span class="op" id="7780696">.</span><span class="ident" id="7780697">Fatal</span><span class="op" id="7780702">(</span><span class="string" id="7780703">&#34;broken&#34;</span><span class="op" id="7780711">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780721">if</span>&nbsp;<span class="ident" id="7780724">mu</span><span class="op" id="7780726">.</span><span class="ident" id="7780727">Decref</span><span class="op" id="7780733">(</span><span class="op" id="7780734">)</span>&nbsp;<span class="op" id="7780736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780740">t</span><span class="op" id="7780741">.</span><span class="ident" id="7780742">Fatal</span><span class="op" id="7780747">(</span><span class="string" id="7780748">&#34;broken&#34;</span><span class="op" id="7780756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780759">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780762">if</span>&nbsp;<span class="op" id="7780765">!</span><span class="ident" id="7780766">mu</span><span class="op" id="7780768">.</span><span class="ident" id="7780769">RWUnlock</span><span class="op" id="7780777">(</span><span class="builtintype" id="7780778">true</span><span class="op" id="7780782">)</span>&nbsp;<span class="op" id="7780784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780788">t</span><span class="op" id="7780789">.</span><span class="ident" id="7780790">Fatal</span><span class="op" id="7780795">(</span><span class="string" id="7780796">&#34;broken&#34;</span><span class="op" id="7780804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780807">}</span><br>
<span class="lineno"></span><span class="op" id="7780809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7780812">func</span>&nbsp;<span class="ident" id="7780817">TestMutexPanic</span><span class="op" id="7780831">(</span><span class="ident" id="7780832">t</span>&nbsp;<span class="op" id="7780834">*</span><span class="ident" id="7780835">testing</span><span class="op" id="7780842">.</span><span class="ident" id="7780843">T</span><span class="op" id="7780844">)</span>&nbsp;<span class="op" id="7780846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780849">ensurePanics</span>&nbsp;<span class="op" id="7780862">:=</span>&nbsp;<span class="keyword" id="7780865">func</span><span class="op" id="7780869">(</span><span class="ident" id="7780870">f</span>&nbsp;<span class="keyword" id="7780872">func</span><span class="op" id="7780876">(</span><span class="op" id="7780877">)</span><span class="op" id="7780878">)</span>&nbsp;<span class="op" id="7780880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780884">defer</span>&nbsp;<span class="keyword" id="7780890">func</span><span class="op" id="7780894">(</span><span class="op" id="7780895">)</span>&nbsp;<span class="op" id="7780897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780902">if</span>&nbsp;<span class="builtinfunc" id="7780905">recover</span><span class="op" id="7780912">(</span><span class="op" id="7780913">)</span>&nbsp;<span class="op" id="7780915">==</span>&nbsp;<span class="ident" id="7780918">nil</span>&nbsp;<span class="op" id="7780922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780928">t</span><span class="op" id="7780929">.</span><span class="ident" id="7780930">Fatal</span><span class="op" id="7780935">(</span><span class="string" id="7780936">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7780952">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780961">}</span><span class="op" id="7780962">(</span><span class="op" id="7780963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780967">f</span><span class="op" id="7780968">(</span><span class="op" id="7780969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7780972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7780976">var</span>&nbsp;<span class="ident" id="7780980">mu</span>&nbsp;<span class="ident" id="7780983">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7780992">ensurePanics</span><span class="op" id="7781004">(</span><span class="keyword" id="7781005">func</span><span class="op" id="7781009">(</span><span class="op" id="7781010">)</span>&nbsp;<span class="op" id="7781012">{</span>&nbsp;<span class="ident" id="7781014">mu</span><span class="op" id="7781016">.</span><span class="ident" id="7781017">Decref</span><span class="op" id="7781023">(</span><span class="op" id="7781024">)</span>&nbsp;<span class="op" id="7781026">}</span><span class="op" id="7781027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781030">ensurePanics</span><span class="op" id="7781042">(</span><span class="keyword" id="7781043">func</span><span class="op" id="7781047">(</span><span class="op" id="7781048">)</span>&nbsp;<span class="op" id="7781050">{</span>&nbsp;<span class="ident" id="7781052">mu</span><span class="op" id="7781054">.</span><span class="ident" id="7781055">RWUnlock</span><span class="op" id="7781063">(</span><span class="builtintype" id="7781064">true</span><span class="op" id="7781068">)</span>&nbsp;<span class="op" id="7781070">}</span><span class="op" id="7781071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781074">ensurePanics</span><span class="op" id="7781086">(</span><span class="keyword" id="7781087">func</span><span class="op" id="7781091">(</span><span class="op" id="7781092">)</span>&nbsp;<span class="op" id="7781094">{</span>&nbsp;<span class="ident" id="7781096">mu</span><span class="op" id="7781098">.</span><span class="ident" id="7781099">RWUnlock</span><span class="op" id="7781107">(</span><span class="builtintype" id="7781108">false</span><span class="op" id="7781113">)</span>&nbsp;<span class="op" id="7781115">}</span><span class="op" id="7781116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781120">ensurePanics</span><span class="op" id="7781132">(</span><span class="keyword" id="7781133">func</span><span class="op" id="7781137">(</span><span class="op" id="7781138">)</span>&nbsp;<span class="op" id="7781140">{</span>&nbsp;<span class="ident" id="7781142">mu</span><span class="op" id="7781144">.</span><span class="ident" id="7781145">Incref</span><span class="op" id="7781151">(</span><span class="op" id="7781152">)</span><span class="op" id="7781153">;</span>&nbsp;<span class="ident" id="7781155">mu</span><span class="op" id="7781157">.</span><span class="ident" id="7781158">Decref</span><span class="op" id="7781164">(</span><span class="op" id="7781165">)</span><span class="op" id="7781166">;</span>&nbsp;<span class="ident" id="7781168">mu</span><span class="op" id="7781170">.</span><span class="ident" id="7781171">Decref</span><span class="op" id="7781177">(</span><span class="op" id="7781178">)</span>&nbsp;<span class="op" id="7781180">}</span><span class="op" id="7781181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781184">ensurePanics</span><span class="op" id="7781196">(</span><span class="keyword" id="7781197">func</span><span class="op" id="7781201">(</span><span class="op" id="7781202">)</span>&nbsp;<span class="op" id="7781204">{</span>&nbsp;<span class="ident" id="7781206">mu</span><span class="op" id="7781208">.</span><span class="ident" id="7781209">RWLock</span><span class="op" id="7781215">(</span><span class="builtintype" id="7781216">true</span><span class="op" id="7781220">)</span><span class="op" id="7781221">;</span>&nbsp;<span class="ident" id="7781223">mu</span><span class="op" id="7781225">.</span><span class="ident" id="7781226">RWUnlock</span><span class="op" id="7781234">(</span><span class="builtintype" id="7781235">true</span><span class="op" id="7781239">)</span><span class="op" id="7781240">;</span>&nbsp;<span class="ident" id="7781242">mu</span><span class="op" id="7781244">.</span><span class="ident" id="7781245">RWUnlock</span><span class="op" id="7781253">(</span><span class="builtintype" id="7781254">true</span><span class="op" id="7781258">)</span>&nbsp;<span class="op" id="7781260">}</span><span class="op" id="7781261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781264">ensurePanics</span><span class="op" id="7781276">(</span><span class="keyword" id="7781277">func</span><span class="op" id="7781281">(</span><span class="op" id="7781282">)</span>&nbsp;<span class="op" id="7781284">{</span>&nbsp;<span class="ident" id="7781286">mu</span><span class="op" id="7781288">.</span><span class="ident" id="7781289">RWLock</span><span class="op" id="7781295">(</span><span class="builtintype" id="7781296">false</span><span class="op" id="7781301">)</span><span class="op" id="7781302">;</span>&nbsp;<span class="ident" id="7781304">mu</span><span class="op" id="7781306">.</span><span class="ident" id="7781307">RWUnlock</span><span class="op" id="7781315">(</span><span class="builtintype" id="7781316">false</span><span class="op" id="7781321">)</span><span class="op" id="7781322">;</span>&nbsp;<span class="ident" id="7781324">mu</span><span class="op" id="7781326">.</span><span class="ident" id="7781327">RWUnlock</span><span class="op" id="7781335">(</span><span class="builtintype" id="7781336">false</span><span class="op" id="7781341">)</span>&nbsp;<span class="op" id="7781343">}</span><span class="op" id="7781344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7781348">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781386">mu</span><span class="op" id="7781388">.</span><span class="ident" id="7781389">Incref</span><span class="op" id="7781395">(</span><span class="op" id="7781396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781399">mu</span><span class="op" id="7781401">.</span><span class="ident" id="7781402">Decref</span><span class="op" id="7781408">(</span><span class="op" id="7781409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781412">mu</span><span class="op" id="7781414">.</span><span class="ident" id="7781415">RWLock</span><span class="op" id="7781421">(</span><span class="builtintype" id="7781422">true</span><span class="op" id="7781426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781429">mu</span><span class="op" id="7781431">.</span><span class="ident" id="7781432">RWUnlock</span><span class="op" id="7781440">(</span><span class="builtintype" id="7781441">true</span><span class="op" id="7781445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781448">mu</span><span class="op" id="7781450">.</span><span class="ident" id="7781451">RWLock</span><span class="op" id="7781457">(</span><span class="builtintype" id="7781458">false</span><span class="op" id="7781463">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781466">mu</span><span class="op" id="7781468">.</span><span class="ident" id="7781469">RWUnlock</span><span class="op" id="7781477">(</span><span class="builtintype" id="7781478">false</span><span class="op" id="7781483">)</span><br>
<span class="lineno"></span><span class="op" id="7781485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7781488">func</span>&nbsp;<span class="ident" id="7781493">TestMutexStress</span><span class="op" id="7781508">(</span><span class="ident" id="7781509">t</span>&nbsp;<span class="op" id="7781511">*</span><span class="ident" id="7781512">testing</span><span class="op" id="7781519">.</span><span class="ident" id="7781520">T</span><span class="op" id="7781521">)</span>&nbsp;<span class="op" id="7781523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781526">P</span>&nbsp;<span class="op" id="7781528">:=</span>&nbsp;<span class="num" id="7781531">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781534">N</span>&nbsp;<span class="op" id="7781536">:=</span>&nbsp;<span class="builtintype" id="7781539">int</span><span class="op" id="7781542">(</span><span class="num" id="7781543">1e6</span><span class="op" id="7781546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781549">if</span>&nbsp;<span class="ident" id="7781552">testing</span><span class="op" id="7781559">.</span><span class="ident" id="7781560">Short</span><span class="op" id="7781565">(</span><span class="op" id="7781566">)</span>&nbsp;<span class="op" id="7781568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781572">P</span>&nbsp;<span class="op" id="7781574">=</span>&nbsp;<span class="num" id="7781576">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781580">N</span>&nbsp;<span class="op" id="7781582">=</span>&nbsp;<span class="num" id="7781584">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7781589">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781592">defer</span>&nbsp;<span class="ident" id="7781598">runtime</span><span class="op" id="7781605">.</span><span class="ident" id="7781606">GOMAXPROCS</span><span class="op" id="7781616">(</span><span class="ident" id="7781617">runtime</span><span class="op" id="7781624">.</span><span class="ident" id="7781625">GOMAXPROCS</span><span class="op" id="7781635">(</span><span class="ident" id="7781636">P</span><span class="op" id="7781637">)</span><span class="op" id="7781638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781641">done</span>&nbsp;<span class="op" id="7781646">:=</span>&nbsp;<span class="builtinfunc" id="7781649">make</span><span class="op" id="7781653">(</span><span class="keyword" id="7781654">chan</span>&nbsp;<span class="builtintype" id="7781659">bool</span><span class="op" id="7781663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781666">var</span>&nbsp;<span class="ident" id="7781670">mu</span>&nbsp;<span class="ident" id="7781673">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781682">var</span>&nbsp;<span class="ident" id="7781686">readState</span>&nbsp;<span class="op" id="7781696">[</span><span class="num" id="7781697">2</span><span class="op" id="7781698">]</span><span class="ident" id="7781699">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781707">var</span>&nbsp;<span class="ident" id="7781711">writeState</span>&nbsp;<span class="op" id="7781722">[</span><span class="num" id="7781723">2</span><span class="op" id="7781724">]</span><span class="ident" id="7781725">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781733">for</span>&nbsp;<span class="ident" id="7781737">p</span>&nbsp;<span class="op" id="7781739">:=</span>&nbsp;<span class="num" id="7781742">0</span><span class="op" id="7781743">;</span>&nbsp;<span class="ident" id="7781745">p</span>&nbsp;<span class="op" id="7781747">&lt;</span>&nbsp;<span class="ident" id="7781749">P</span><span class="op" id="7781750">;</span>&nbsp;<span class="ident" id="7781752">p</span><span class="op" id="7781753">++</span>&nbsp;<span class="op" id="7781756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781760">go</span>&nbsp;<span class="keyword" id="7781763">func</span><span class="op" id="7781767">(</span><span class="op" id="7781768">)</span>&nbsp;<span class="op" id="7781770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781775">r</span>&nbsp;<span class="op" id="7781777">:=</span>&nbsp;<span class="ident" id="7781780">rand</span><span class="op" id="7781784">.</span><span class="ident" id="7781785">New</span><span class="op" id="7781788">(</span><span class="ident" id="7781789">rand</span><span class="op" id="7781793">.</span><span class="ident" id="7781794">NewSource</span><span class="op" id="7781803">(</span><span class="ident" id="7781804">rand</span><span class="op" id="7781808">.</span><span class="ident" id="7781809">Int63</span><span class="op" id="7781814">(</span><span class="op" id="7781815">)</span><span class="op" id="7781816">)</span><span class="op" id="7781817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781822">for</span>&nbsp;<span class="ident" id="7781826">i</span>&nbsp;<span class="op" id="7781828">:=</span>&nbsp;<span class="num" id="7781831">0</span><span class="op" id="7781832">;</span>&nbsp;<span class="ident" id="7781834">i</span>&nbsp;<span class="op" id="7781836">&lt;</span>&nbsp;<span class="ident" id="7781838">N</span><span class="op" id="7781839">;</span>&nbsp;<span class="ident" id="7781841">i</span><span class="op" id="7781842">++</span>&nbsp;<span class="op" id="7781845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781851">switch</span>&nbsp;<span class="ident" id="7781858">r</span><span class="op" id="7781859">.</span><span class="ident" id="7781860">Intn</span><span class="op" id="7781864">(</span><span class="num" id="7781865">3</span><span class="op" id="7781866">)</span>&nbsp;<span class="op" id="7781868">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781874">case</span>&nbsp;<span class="num" id="7781879">0</span><span class="op" id="7781880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781887">if</span>&nbsp;<span class="op" id="7781890">!</span><span class="ident" id="7781891">mu</span><span class="op" id="7781893">.</span><span class="ident" id="7781894">Incref</span><span class="op" id="7781900">(</span><span class="op" id="7781901">)</span>&nbsp;<span class="op" id="7781903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781911">t</span><span class="op" id="7781912">.</span><span class="ident" id="7781913">Error</span><span class="op" id="7781918">(</span><span class="string" id="7781919">&#34;broken&#34;</span><span class="op" id="7781927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7781947">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7781954">if</span>&nbsp;<span class="ident" id="7781957">mu</span><span class="op" id="7781959">.</span><span class="ident" id="7781960">Decref</span><span class="op" id="7781966">(</span><span class="op" id="7781967">)</span>&nbsp;<span class="op" id="7781969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7781977">t</span><span class="op" id="7781978">.</span><span class="ident" id="7781979">Error</span><span class="op" id="7781984">(</span><span class="string" id="7781985">&#34;broken&#34;</span><span class="op" id="7781993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782001">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782019">case</span>&nbsp;<span class="num" id="7782024">1</span><span class="op" id="7782025">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782032">if</span>&nbsp;<span class="op" id="7782035">!</span><span class="ident" id="7782036">mu</span><span class="op" id="7782038">.</span><span class="ident" id="7782039">RWLock</span><span class="op" id="7782045">(</span><span class="builtintype" id="7782046">true</span><span class="op" id="7782050">)</span>&nbsp;<span class="op" id="7782052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782060">t</span><span class="op" id="7782061">.</span><span class="ident" id="7782062">Error</span><span class="op" id="7782067">(</span><span class="string" id="7782068">&#34;broken&#34;</span><span class="op" id="7782076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782084">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7782103">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782165">if</span>&nbsp;<span class="ident" id="7782168">readState</span><span class="op" id="7782177">[</span><span class="num" id="7782178">0</span><span class="op" id="7782179">]</span>&nbsp;<span class="op" id="7782181">!=</span>&nbsp;<span class="ident" id="7782184">readState</span><span class="op" id="7782193">[</span><span class="num" id="7782194">1</span><span class="op" id="7782195">]</span>&nbsp;<span class="op" id="7782197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782205">t</span><span class="op" id="7782206">.</span><span class="ident" id="7782207">Error</span><span class="op" id="7782212">(</span><span class="string" id="7782213">&#34;broken&#34;</span><span class="op" id="7782221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782229">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782248">readState</span><span class="op" id="7782257">[</span><span class="num" id="7782258">0</span><span class="op" id="7782259">]</span><span class="op" id="7782260">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782268">readState</span><span class="op" id="7782277">[</span><span class="num" id="7782278">1</span><span class="op" id="7782279">]</span><span class="op" id="7782280">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782288">if</span>&nbsp;<span class="ident" id="7782291">mu</span><span class="op" id="7782293">.</span><span class="ident" id="7782294">RWUnlock</span><span class="op" id="7782302">(</span><span class="builtintype" id="7782303">true</span><span class="op" id="7782307">)</span>&nbsp;<span class="op" id="7782309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782317">t</span><span class="op" id="7782318">.</span><span class="ident" id="7782319">Error</span><span class="op" id="7782324">(</span><span class="string" id="7782325">&#34;broken&#34;</span><span class="op" id="7782333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782341">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782353">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782359">case</span>&nbsp;<span class="num" id="7782364">2</span><span class="op" id="7782365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782372">if</span>&nbsp;<span class="op" id="7782375">!</span><span class="ident" id="7782376">mu</span><span class="op" id="7782378">.</span><span class="ident" id="7782379">RWLock</span><span class="op" id="7782385">(</span><span class="builtintype" id="7782386">false</span><span class="op" id="7782391">)</span>&nbsp;<span class="op" id="7782393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782401">t</span><span class="op" id="7782402">.</span><span class="ident" id="7782403">Error</span><span class="op" id="7782408">(</span><span class="string" id="7782409">&#34;broken&#34;</span><span class="op" id="7782417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782437">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7782444">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782506">if</span>&nbsp;<span class="ident" id="7782509">writeState</span><span class="op" id="7782519">[</span><span class="num" id="7782520">0</span><span class="op" id="7782521">]</span>&nbsp;<span class="op" id="7782523">!=</span>&nbsp;<span class="ident" id="7782526">writeState</span><span class="op" id="7782536">[</span><span class="num" id="7782537">1</span><span class="op" id="7782538">]</span>&nbsp;<span class="op" id="7782540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782548">t</span><span class="op" id="7782549">.</span><span class="ident" id="7782550">Error</span><span class="op" id="7782555">(</span><span class="string" id="7782556">&#34;broken&#34;</span><span class="op" id="7782564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782572">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782584">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782591">writeState</span><span class="op" id="7782601">[</span><span class="num" id="7782602">0</span><span class="op" id="7782603">]</span><span class="op" id="7782604">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782612">writeState</span><span class="op" id="7782622">[</span><span class="num" id="7782623">1</span><span class="op" id="7782624">]</span><span class="op" id="7782625">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782633">if</span>&nbsp;<span class="ident" id="7782636">mu</span><span class="op" id="7782638">.</span><span class="ident" id="7782639">RWUnlock</span><span class="op" id="7782647">(</span><span class="builtintype" id="7782648">false</span><span class="op" id="7782653">)</span>&nbsp;<span class="op" id="7782655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782663">t</span><span class="op" id="7782664">.</span><span class="ident" id="7782665">Error</span><span class="op" id="7782670">(</span><span class="string" id="7782671">&#34;broken&#34;</span><span class="op" id="7782679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782687">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782715">done</span>&nbsp;<span class="op" id="7782720">&lt;-</span>&nbsp;<span class="builtintype" id="7782723">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782730">}</span><span class="op" id="7782731">(</span><span class="op" id="7782732">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782738">for</span>&nbsp;<span class="ident" id="7782742">p</span>&nbsp;<span class="op" id="7782744">:=</span>&nbsp;<span class="num" id="7782747">0</span><span class="op" id="7782748">;</span>&nbsp;<span class="ident" id="7782750">p</span>&nbsp;<span class="op" id="7782752">&lt;</span>&nbsp;<span class="ident" id="7782754">P</span><span class="op" id="7782755">;</span>&nbsp;<span class="ident" id="7782757">p</span><span class="op" id="7782758">++</span>&nbsp;<span class="op" id="7782761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782765">&lt;-</span><span class="ident" id="7782767">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782776">if</span>&nbsp;<span class="op" id="7782779">!</span><span class="ident" id="7782780">mu</span><span class="op" id="7782782">.</span><span class="ident" id="7782783">IncrefAndClose</span><span class="op" id="7782797">(</span><span class="op" id="7782798">)</span>&nbsp;<span class="op" id="7782800">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782804">t</span><span class="op" id="7782805">.</span><span class="ident" id="7782806">Fatal</span><span class="op" id="7782811">(</span><span class="string" id="7782812">&#34;broken&#34;</span><span class="op" id="7782820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782826">if</span>&nbsp;<span class="op" id="7782829">!</span><span class="ident" id="7782830">mu</span><span class="op" id="7782832">.</span><span class="ident" id="7782833">Decref</span><span class="op" id="7782839">(</span><span class="op" id="7782840">)</span>&nbsp;<span class="op" id="7782842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782846">t</span><span class="op" id="7782847">.</span><span class="ident" id="7782848">Fatal</span><span class="op" id="7782853">(</span><span class="string" id="7782854">&#34;broken&#34;</span><span class="op" id="7782862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782865">}</span><br>
<span class="lineno">195</span><span class="op" id="7782867">}</span>
</div>
</body>
</html>
