<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html" class="current">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2436999">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2437054">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2437108">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2437159">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437224">package</span>&nbsp;<span class="ident" id="2437232">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437241">import</span>&nbsp;<span class="op" id="2437248">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2437251">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2437262">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2437270">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2437279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2437282">var</span>&nbsp;<span class="op" id="2437286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437289">Stdin</span>&nbsp;&nbsp;<span class="op" id="2437296">=</span>&nbsp;<span class="num" id="2437298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437301">Stdout</span>&nbsp;<span class="op" id="2437308">=</span>&nbsp;<span class="num" id="2437310">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437313">Stderr</span>&nbsp;<span class="op" id="2437320">=</span>&nbsp;<span class="num" id="2437322">2</span><br>
<span class="lineno"></span><span class="op" id="2437324">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2437327">const</span>&nbsp;<span class="op" id="2437333">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437336">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2437351">=</span>&nbsp;<span class="ident" id="2437353">runtime</span><span class="op" id="2437360">.</span><span class="ident" id="2437361">GOOS</span>&nbsp;<span class="op" id="2437366">==</span>&nbsp;<span class="string" id="2437369">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2437378">&amp;&amp;</span>&nbsp;<span class="ident" id="2437381">sizeofPtr</span>&nbsp;<span class="op" id="2437391">==</span>&nbsp;<span class="num" id="2437394">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437397">dragonfly64Bit</span>&nbsp;<span class="op" id="2437412">=</span>&nbsp;<span class="ident" id="2437414">runtime</span><span class="op" id="2437421">.</span><span class="ident" id="2437422">GOOS</span>&nbsp;<span class="op" id="2437427">==</span>&nbsp;<span class="string" id="2437430">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2437442">&amp;&amp;</span>&nbsp;<span class="ident" id="2437445">sizeofPtr</span>&nbsp;<span class="op" id="2437455">==</span>&nbsp;<span class="num" id="2437458">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437461">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2437476">=</span>&nbsp;<span class="ident" id="2437478">runtime</span><span class="op" id="2437485">.</span><span class="ident" id="2437486">GOOS</span>&nbsp;<span class="op" id="2437491">==</span>&nbsp;<span class="string" id="2437494">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2437503">&amp;&amp;</span>&nbsp;<span class="ident" id="2437506">sizeofPtr</span>&nbsp;<span class="op" id="2437516">==</span>&nbsp;<span class="num" id="2437519">4</span><br>
<span class="lineno">25</span><span class="op" id="2437521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437524">func</span>&nbsp;<span class="ident" id="2437529">Syscall</span><span class="op" id="2437536">(</span><span class="ident" id="2437537">trap</span><span class="op" id="2437541">,</span>&nbsp;<span class="ident" id="2437543">a1</span><span class="op" id="2437545">,</span>&nbsp;<span class="ident" id="2437547">a2</span><span class="op" id="2437549">,</span>&nbsp;<span class="ident" id="2437551">a3</span>&nbsp;<span class="builtintype" id="2437554">uintptr</span><span class="op" id="2437561">)</span>&nbsp;<span class="op" id="2437563">(</span><span class="ident" id="2437564">r1</span><span class="op" id="2437566">,</span>&nbsp;<span class="ident" id="2437568">r2</span>&nbsp;<span class="builtintype" id="2437571">uintptr</span><span class="op" id="2437578">,</span>&nbsp;<span class="ident" id="2437580">err</span>&nbsp;<span class="ident" id="2437584">Errno</span><span class="op" id="2437589">)</span><br>
<span class="lineno"></span><span class="keyword" id="2437591">func</span>&nbsp;<span class="ident" id="2437596">Syscall6</span><span class="op" id="2437604">(</span><span class="ident" id="2437605">trap</span><span class="op" id="2437609">,</span>&nbsp;<span class="ident" id="2437611">a1</span><span class="op" id="2437613">,</span>&nbsp;<span class="ident" id="2437615">a2</span><span class="op" id="2437617">,</span>&nbsp;<span class="ident" id="2437619">a3</span><span class="op" id="2437621">,</span>&nbsp;<span class="ident" id="2437623">a4</span><span class="op" id="2437625">,</span>&nbsp;<span class="ident" id="2437627">a5</span><span class="op" id="2437629">,</span>&nbsp;<span class="ident" id="2437631">a6</span>&nbsp;<span class="builtintype" id="2437634">uintptr</span><span class="op" id="2437641">)</span>&nbsp;<span class="op" id="2437643">(</span><span class="ident" id="2437644">r1</span><span class="op" id="2437646">,</span>&nbsp;<span class="ident" id="2437648">r2</span>&nbsp;<span class="builtintype" id="2437651">uintptr</span><span class="op" id="2437658">,</span>&nbsp;<span class="ident" id="2437660">err</span>&nbsp;<span class="ident" id="2437664">Errno</span><span class="op" id="2437669">)</span><br>
<span class="lineno"></span><span class="keyword" id="2437671">func</span>&nbsp;<span class="ident" id="2437676">RawSyscall</span><span class="op" id="2437686">(</span><span class="ident" id="2437687">trap</span><span class="op" id="2437691">,</span>&nbsp;<span class="ident" id="2437693">a1</span><span class="op" id="2437695">,</span>&nbsp;<span class="ident" id="2437697">a2</span><span class="op" id="2437699">,</span>&nbsp;<span class="ident" id="2437701">a3</span>&nbsp;<span class="builtintype" id="2437704">uintptr</span><span class="op" id="2437711">)</span>&nbsp;<span class="op" id="2437713">(</span><span class="ident" id="2437714">r1</span><span class="op" id="2437716">,</span>&nbsp;<span class="ident" id="2437718">r2</span>&nbsp;<span class="builtintype" id="2437721">uintptr</span><span class="op" id="2437728">,</span>&nbsp;<span class="ident" id="2437730">err</span>&nbsp;<span class="ident" id="2437734">Errno</span><span class="op" id="2437739">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2437741">func</span>&nbsp;<span class="ident" id="2437746">RawSyscall6</span><span class="op" id="2437757">(</span><span class="ident" id="2437758">trap</span><span class="op" id="2437762">,</span>&nbsp;<span class="ident" id="2437764">a1</span><span class="op" id="2437766">,</span>&nbsp;<span class="ident" id="2437768">a2</span><span class="op" id="2437770">,</span>&nbsp;<span class="ident" id="2437772">a3</span><span class="op" id="2437774">,</span>&nbsp;<span class="ident" id="2437776">a4</span><span class="op" id="2437778">,</span>&nbsp;<span class="ident" id="2437780">a5</span><span class="op" id="2437782">,</span>&nbsp;<span class="ident" id="2437784">a6</span>&nbsp;<span class="builtintype" id="2437787">uintptr</span><span class="op" id="2437794">)</span>&nbsp;<span class="op" id="2437796">(</span><span class="ident" id="2437797">r1</span><span class="op" id="2437799">,</span>&nbsp;<span class="ident" id="2437801">r2</span>&nbsp;<span class="builtintype" id="2437804">uintptr</span><span class="op" id="2437811">,</span>&nbsp;<span class="ident" id="2437813">err</span>&nbsp;<span class="ident" id="2437817">Errno</span><span class="op" id="2437822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2437825">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437897">type</span>&nbsp;<span class="ident" id="2437902">mmapper</span>&nbsp;<span class="keyword" id="2437910">struct</span>&nbsp;<span class="op" id="2437917">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437920">sync</span><span class="op" id="2437924">.</span><span class="ident" id="2437925">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437932">active</span>&nbsp;<span class="keyword" id="2437939">map</span><span class="op" id="2437942">[</span><span class="op" id="2437943">*</span><span class="builtintype" id="2437944">byte</span><span class="op" id="2437948">]</span><span class="op" id="2437949">[</span><span class="op" id="2437950">]</span><span class="builtintype" id="2437951">byte</span>&nbsp;<span class="comment" id="2437956">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438005">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438012">func</span><span class="op" id="2438016">(</span><span class="ident" id="2438017">addr</span><span class="op" id="2438021">,</span>&nbsp;<span class="ident" id="2438023">length</span>&nbsp;<span class="builtintype" id="2438030">uintptr</span><span class="op" id="2438037">,</span>&nbsp;<span class="ident" id="2438039">prot</span><span class="op" id="2438043">,</span>&nbsp;<span class="ident" id="2438045">flags</span><span class="op" id="2438050">,</span>&nbsp;<span class="ident" id="2438052">fd</span>&nbsp;<span class="builtintype" id="2438055">int</span><span class="op" id="2438058">,</span>&nbsp;<span class="ident" id="2438060">offset</span>&nbsp;<span class="ident" id="2438067">int64</span><span class="op" id="2438072">)</span>&nbsp;<span class="op" id="2438074">(</span><span class="builtintype" id="2438075">uintptr</span><span class="op" id="2438082">,</span>&nbsp;<span class="builtintype" id="2438084">error</span><span class="op" id="2438089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438092">munmap</span>&nbsp;<span class="keyword" id="2438099">func</span><span class="op" id="2438103">(</span><span class="ident" id="2438104">addr</span>&nbsp;<span class="builtintype" id="2438109">uintptr</span><span class="op" id="2438116">,</span>&nbsp;<span class="ident" id="2438118">length</span>&nbsp;<span class="builtintype" id="2438125">uintptr</span><span class="op" id="2438132">)</span>&nbsp;<span class="builtintype" id="2438134">error</span><br>
<span class="lineno"></span><span class="op" id="2438140">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2438143">func</span>&nbsp;<span class="op" id="2438148">(</span><span class="ident" id="2438149">m</span>&nbsp;<span class="op" id="2438151">*</span><span class="ident" id="2438152">mmapper</span><span class="op" id="2438159">)</span>&nbsp;<span class="ident" id="2438161">Mmap</span><span class="op" id="2438165">(</span><span class="ident" id="2438166">fd</span>&nbsp;<span class="builtintype" id="2438169">int</span><span class="op" id="2438172">,</span>&nbsp;<span class="ident" id="2438174">offset</span>&nbsp;<span class="ident" id="2438181">int64</span><span class="op" id="2438186">,</span>&nbsp;<span class="ident" id="2438188">length</span>&nbsp;<span class="builtintype" id="2438195">int</span><span class="op" id="2438198">,</span>&nbsp;<span class="ident" id="2438200">prot</span>&nbsp;<span class="builtintype" id="2438205">int</span><span class="op" id="2438208">,</span>&nbsp;<span class="ident" id="2438210">flags</span>&nbsp;<span class="builtintype" id="2438216">int</span><span class="op" id="2438219">)</span>&nbsp;<span class="op" id="2438221">(</span><span class="ident" id="2438222">data</span>&nbsp;<span class="op" id="2438227">[</span><span class="op" id="2438228">]</span><span class="builtintype" id="2438229">byte</span><span class="op" id="2438233">,</span>&nbsp;<span class="ident" id="2438235">err</span>&nbsp;<span class="builtintype" id="2438239">error</span><span class="op" id="2438244">)</span>&nbsp;<span class="op" id="2438246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438249">if</span>&nbsp;<span class="ident" id="2438252">length</span>&nbsp;<span class="op" id="2438259">&lt;=</span>&nbsp;<span class="num" id="2438262">0</span>&nbsp;<span class="op" id="2438264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438268">return</span>&nbsp;<span class="builtintype" id="2438275">nil</span><span class="op" id="2438278">,</span>&nbsp;<span class="ident" id="2438280">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2438288">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2438292">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438322">addr</span><span class="op" id="2438326">,</span>&nbsp;<span class="ident" id="2438328">errno</span>&nbsp;<span class="op" id="2438334">:=</span>&nbsp;<span class="ident" id="2438337">m</span><span class="op" id="2438338">.</span><span class="ident" id="2438339">mmap</span><span class="op" id="2438343">(</span><span class="num" id="2438344">0</span><span class="op" id="2438345">,</span>&nbsp;<span class="builtintype" id="2438347">uintptr</span><span class="op" id="2438354">(</span><span class="ident" id="2438355">length</span><span class="op" id="2438361">)</span><span class="op" id="2438362">,</span>&nbsp;<span class="ident" id="2438364">prot</span><span class="op" id="2438368">,</span>&nbsp;<span class="ident" id="2438370">flags</span><span class="op" id="2438375">,</span>&nbsp;<span class="ident" id="2438377">fd</span><span class="op" id="2438379">,</span>&nbsp;<span class="ident" id="2438381">offset</span><span class="op" id="2438387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438390">if</span>&nbsp;<span class="ident" id="2438393">errno</span>&nbsp;<span class="op" id="2438399">!=</span>&nbsp;<span class="builtintype" id="2438402">nil</span>&nbsp;<span class="op" id="2438406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438410">return</span>&nbsp;<span class="builtintype" id="2438417">nil</span><span class="op" id="2438420">,</span>&nbsp;<span class="ident" id="2438422">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2438429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2438433">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438457">var</span>&nbsp;<span class="ident" id="2438461">sl</span>&nbsp;<span class="op" id="2438464">=</span>&nbsp;<span class="keyword" id="2438466">struct</span>&nbsp;<span class="op" id="2438473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438477">addr</span>&nbsp;<span class="builtintype" id="2438482">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2438492">len</span>&nbsp;&nbsp;<span class="builtintype" id="2438497">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2438503">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2438508">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2438513">}</span><span class="op" id="2438514">{</span><span class="ident" id="2438515">addr</span><span class="op" id="2438519">,</span>&nbsp;<span class="ident" id="2438521">length</span><span class="op" id="2438527">,</span>&nbsp;<span class="ident" id="2438529">length</span><span class="op" id="2438535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2438539">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438580">b</span>&nbsp;<span class="op" id="2438582">:=</span>&nbsp;<span class="op" id="2438585">*</span><span class="op" id="2438586">(</span><span class="op" id="2438587">*</span><span class="op" id="2438588">[</span><span class="op" id="2438589">]</span><span class="builtintype" id="2438590">byte</span><span class="op" id="2438594">)</span><span class="op" id="2438595">(</span><span class="ident" id="2438596">unsafe</span><span class="op" id="2438602">.</span><span class="ident" id="2438603">Pointer</span><span class="op" id="2438610">(</span><span class="op" id="2438611">&amp;</span><span class="ident" id="2438612">sl</span><span class="op" id="2438614">)</span><span class="op" id="2438615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2438619">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438660">p</span>&nbsp;<span class="op" id="2438662">:=</span>&nbsp;<span class="op" id="2438665">&amp;</span><span class="ident" id="2438666">b</span><span class="op" id="2438667">[</span><span class="builtinfunc" id="2438668">cap</span><span class="op" id="2438671">(</span><span class="ident" id="2438672">b</span><span class="op" id="2438673">)</span><span class="op" id="2438674">-</span><span class="num" id="2438675">1</span><span class="op" id="2438676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438679">m</span><span class="op" id="2438680">.</span><span class="ident" id="2438681">Lock</span><span class="op" id="2438685">(</span><span class="op" id="2438686">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438689">defer</span>&nbsp;<span class="ident" id="2438695">m</span><span class="op" id="2438696">.</span><span class="ident" id="2438697">Unlock</span><span class="op" id="2438703">(</span><span class="op" id="2438704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438707">m</span><span class="op" id="2438708">.</span><span class="ident" id="2438709">active</span><span class="op" id="2438715">[</span><span class="ident" id="2438716">p</span><span class="op" id="2438717">]</span>&nbsp;<span class="op" id="2438719">=</span>&nbsp;<span class="ident" id="2438721">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438724">return</span>&nbsp;<span class="ident" id="2438731">b</span><span class="op" id="2438732">,</span>&nbsp;<span class="builtintype" id="2438734">nil</span><br>
<span class="lineno"></span><span class="op" id="2438738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2438741">func</span>&nbsp;<span class="op" id="2438746">(</span><span class="ident" id="2438747">m</span>&nbsp;<span class="op" id="2438749">*</span><span class="ident" id="2438750">mmapper</span><span class="op" id="2438757">)</span>&nbsp;<span class="ident" id="2438759">Munmap</span><span class="op" id="2438765">(</span><span class="ident" id="2438766">data</span>&nbsp;<span class="op" id="2438771">[</span><span class="op" id="2438772">]</span><span class="builtintype" id="2438773">byte</span><span class="op" id="2438777">)</span>&nbsp;<span class="op" id="2438779">(</span><span class="ident" id="2438780">err</span>&nbsp;<span class="builtintype" id="2438784">error</span><span class="op" id="2438789">)</span>&nbsp;<span class="op" id="2438791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438794">if</span>&nbsp;<span class="builtinfunc" id="2438797">len</span><span class="op" id="2438800">(</span><span class="ident" id="2438801">data</span><span class="op" id="2438805">)</span>&nbsp;<span class="op" id="2438807">==</span>&nbsp;<span class="num" id="2438810">0</span>&nbsp;<span class="op" id="2438812">||</span>&nbsp;<span class="builtinfunc" id="2438815">len</span><span class="op" id="2438818">(</span><span class="ident" id="2438819">data</span><span class="op" id="2438823">)</span>&nbsp;<span class="op" id="2438825">!=</span>&nbsp;<span class="builtinfunc" id="2438828">cap</span><span class="op" id="2438831">(</span><span class="ident" id="2438832">data</span><span class="op" id="2438836">)</span>&nbsp;<span class="op" id="2438838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438842">return</span>&nbsp;<span class="ident" id="2438849">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2438857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2438861">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438895">p</span>&nbsp;<span class="op" id="2438897">:=</span>&nbsp;<span class="op" id="2438900">&amp;</span><span class="ident" id="2438901">data</span><span class="op" id="2438905">[</span><span class="builtinfunc" id="2438906">cap</span><span class="op" id="2438909">(</span><span class="ident" id="2438910">data</span><span class="op" id="2438914">)</span><span class="op" id="2438915">-</span><span class="num" id="2438916">1</span><span class="op" id="2438917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438920">m</span><span class="op" id="2438921">.</span><span class="ident" id="2438922">Lock</span><span class="op" id="2438926">(</span><span class="op" id="2438927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438930">defer</span>&nbsp;<span class="ident" id="2438936">m</span><span class="op" id="2438937">.</span><span class="ident" id="2438938">Unlock</span><span class="op" id="2438944">(</span><span class="op" id="2438945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2438948">b</span>&nbsp;<span class="op" id="2438950">:=</span>&nbsp;<span class="ident" id="2438953">m</span><span class="op" id="2438954">.</span><span class="ident" id="2438955">active</span><span class="op" id="2438961">[</span><span class="ident" id="2438962">p</span><span class="op" id="2438963">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2438966">if</span>&nbsp;<span class="ident" id="2438969">b</span>&nbsp;<span class="op" id="2438971">==</span>&nbsp;<span class="builtintype" id="2438974">nil</span>&nbsp;<span class="op" id="2438978">||</span>&nbsp;<span class="op" id="2438981">&amp;</span><span class="ident" id="2438982">b</span><span class="op" id="2438983">[</span><span class="num" id="2438984">0</span><span class="op" id="2438985">]</span>&nbsp;<span class="op" id="2438987">!=</span>&nbsp;<span class="op" id="2438990">&amp;</span><span class="ident" id="2438991">data</span><span class="op" id="2438995">[</span><span class="num" id="2438996">0</span><span class="op" id="2438997">]</span>&nbsp;<span class="op" id="2438999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439003">return</span>&nbsp;<span class="ident" id="2439010">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2439018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2439022">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439057">if</span>&nbsp;<span class="ident" id="2439060">errno</span>&nbsp;<span class="op" id="2439066">:=</span>&nbsp;<span class="ident" id="2439069">m</span><span class="op" id="2439070">.</span><span class="ident" id="2439071">munmap</span><span class="op" id="2439077">(</span><span class="builtintype" id="2439078">uintptr</span><span class="op" id="2439085">(</span><span class="ident" id="2439086">unsafe</span><span class="op" id="2439092">.</span><span class="ident" id="2439093">Pointer</span><span class="op" id="2439100">(</span><span class="op" id="2439101">&amp;</span><span class="ident" id="2439102">b</span><span class="op" id="2439103">[</span><span class="num" id="2439104">0</span><span class="op" id="2439105">]</span><span class="op" id="2439106">)</span><span class="op" id="2439107">)</span><span class="op" id="2439108">,</span>&nbsp;<span class="builtintype" id="2439110">uintptr</span><span class="op" id="2439117">(</span><span class="builtinfunc" id="2439118">len</span><span class="op" id="2439121">(</span><span class="ident" id="2439122">b</span><span class="op" id="2439123">)</span><span class="op" id="2439124">)</span><span class="op" id="2439125">)</span><span class="op" id="2439126">;</span>&nbsp;<span class="ident" id="2439128">errno</span>&nbsp;<span class="op" id="2439134">!=</span>&nbsp;<span class="builtintype" id="2439137">nil</span>&nbsp;<span class="op" id="2439141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439145">return</span>&nbsp;<span class="ident" id="2439152">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2439159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2439162">delete</span><span class="op" id="2439168">(</span><span class="ident" id="2439169">m</span><span class="op" id="2439170">.</span><span class="ident" id="2439171">active</span><span class="op" id="2439177">,</span>&nbsp;<span class="ident" id="2439179">p</span><span class="op" id="2439180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439183">return</span>&nbsp;<span class="builtintype" id="2439190">nil</span><br>
<span class="lineno">90</span><span class="op" id="2439194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2439197">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2439262">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2439333">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2439400">//&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2439413">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2439432">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2439448">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="2439453">type</span>&nbsp;<span class="ident" id="2439458">Errno</span>&nbsp;<span class="builtintype" id="2439464">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2439473">func</span>&nbsp;<span class="op" id="2439478">(</span><span class="ident" id="2439479">e</span>&nbsp;<span class="ident" id="2439481">Errno</span><span class="op" id="2439486">)</span>&nbsp;<span class="ident" id="2439488">Error</span><span class="op" id="2439493">(</span><span class="op" id="2439494">)</span>&nbsp;<span class="builtintype" id="2439496">string</span>&nbsp;<span class="op" id="2439503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439506">if</span>&nbsp;<span class="num" id="2439509">0</span>&nbsp;<span class="op" id="2439511">&lt;=</span>&nbsp;<span class="builtintype" id="2439514">int</span><span class="op" id="2439517">(</span><span class="ident" id="2439518">e</span><span class="op" id="2439519">)</span>&nbsp;<span class="op" id="2439521">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2439524">int</span><span class="op" id="2439527">(</span><span class="ident" id="2439528">e</span><span class="op" id="2439529">)</span>&nbsp;<span class="op" id="2439531">&lt;</span>&nbsp;<span class="builtinfunc" id="2439533">len</span><span class="op" id="2439536">(</span><span class="ident" id="2439537">errors</span><span class="op" id="2439543">)</span>&nbsp;<span class="op" id="2439545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2439549">s</span>&nbsp;<span class="op" id="2439551">:=</span>&nbsp;<span class="ident" id="2439554">errors</span><span class="op" id="2439560">[</span><span class="ident" id="2439561">e</span><span class="op" id="2439562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439566">if</span>&nbsp;<span class="ident" id="2439569">s</span>&nbsp;<span class="op" id="2439571">!=</span>&nbsp;<span class="string" id="2439574">&#34;&#34;</span>&nbsp;<span class="op" id="2439577">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439582">return</span>&nbsp;<span class="ident" id="2439589">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2439593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2439596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439599">return</span>&nbsp;<span class="string" id="2439606">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2439615">+</span>&nbsp;<span class="ident" id="2439617">itoa</span><span class="op" id="2439621">(</span><span class="builtintype" id="2439622">int</span><span class="op" id="2439625">(</span><span class="ident" id="2439626">e</span><span class="op" id="2439627">)</span><span class="op" id="2439628">)</span><br>
<span class="lineno"></span><span class="op" id="2439630">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2439633">func</span>&nbsp;<span class="op" id="2439638">(</span><span class="ident" id="2439639">e</span>&nbsp;<span class="ident" id="2439641">Errno</span><span class="op" id="2439646">)</span>&nbsp;<span class="ident" id="2439648">Temporary</span><span class="op" id="2439657">(</span><span class="op" id="2439658">)</span>&nbsp;<span class="builtintype" id="2439660">bool</span>&nbsp;<span class="op" id="2439665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439668">return</span>&nbsp;<span class="ident" id="2439675">e</span>&nbsp;<span class="op" id="2439677">==</span>&nbsp;<span class="ident" id="2439680">EINTR</span>&nbsp;<span class="op" id="2439686">||</span>&nbsp;<span class="ident" id="2439689">e</span>&nbsp;<span class="op" id="2439691">==</span>&nbsp;<span class="ident" id="2439694">EMFILE</span>&nbsp;<span class="op" id="2439701">||</span>&nbsp;<span class="ident" id="2439704">e</span>&nbsp;<span class="op" id="2439706">==</span>&nbsp;<span class="ident" id="2439709">ECONNRESET</span>&nbsp;<span class="op" id="2439720">||</span>&nbsp;<span class="ident" id="2439723">e</span>&nbsp;<span class="op" id="2439725">==</span>&nbsp;<span class="ident" id="2439728">ECONNABORTED</span>&nbsp;<span class="op" id="2439741">||</span>&nbsp;<span class="ident" id="2439744">e</span><span class="op" id="2439745">.</span><span class="ident" id="2439746">Timeout</span><span class="op" id="2439753">(</span><span class="op" id="2439754">)</span><br>
<span class="lineno"></span><span class="op" id="2439756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2439759">func</span>&nbsp;<span class="op" id="2439764">(</span><span class="ident" id="2439765">e</span>&nbsp;<span class="ident" id="2439767">Errno</span><span class="op" id="2439772">)</span>&nbsp;<span class="ident" id="2439774">Timeout</span><span class="op" id="2439781">(</span><span class="op" id="2439782">)</span>&nbsp;<span class="builtintype" id="2439784">bool</span>&nbsp;<span class="op" id="2439789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2439792">return</span>&nbsp;<span class="ident" id="2439799">e</span>&nbsp;<span class="op" id="2439801">==</span>&nbsp;<span class="ident" id="2439804">EAGAIN</span>&nbsp;<span class="op" id="2439811">||</span>&nbsp;<span class="ident" id="2439814">e</span>&nbsp;<span class="op" id="2439816">==</span>&nbsp;<span class="ident" id="2439819">EWOULDBLOCK</span>&nbsp;<span class="op" id="2439831">||</span>&nbsp;<span class="ident" id="2439834">e</span>&nbsp;<span class="op" id="2439836">==</span>&nbsp;<span class="ident" id="2439839">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2439849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2439852">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2439905">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2439947">type</span>&nbsp;<span class="ident" id="2439952">Signal</span>&nbsp;<span class="builtintype" id="2439959">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439964">func</span>&nbsp;<span class="op" id="2439969">(</span><span class="ident" id="2439970">s</span>&nbsp;<span class="ident" id="2439972">Signal</span><span class="op" id="2439978">)</span>&nbsp;<span class="ident" id="2439980">Signal</span><span class="op" id="2439986">(</span><span class="op" id="2439987">)</span>&nbsp;<span class="op" id="2439989">{</span><span class="op" id="2439990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2439993">func</span>&nbsp;<span class="op" id="2439998">(</span><span class="ident" id="2439999">s</span>&nbsp;<span class="ident" id="2440001">Signal</span><span class="op" id="2440007">)</span>&nbsp;<span class="ident" id="2440009">String</span><span class="op" id="2440015">(</span><span class="op" id="2440016">)</span>&nbsp;<span class="builtintype" id="2440018">string</span>&nbsp;<span class="op" id="2440025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440028">if</span>&nbsp;<span class="num" id="2440031">0</span>&nbsp;<span class="op" id="2440033">&lt;=</span>&nbsp;<span class="ident" id="2440036">s</span>&nbsp;<span class="op" id="2440038">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2440041">int</span><span class="op" id="2440044">(</span><span class="ident" id="2440045">s</span><span class="op" id="2440046">)</span>&nbsp;<span class="op" id="2440048">&lt;</span>&nbsp;<span class="builtinfunc" id="2440050">len</span><span class="op" id="2440053">(</span><span class="ident" id="2440054">signals</span><span class="op" id="2440061">)</span>&nbsp;<span class="op" id="2440063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440067">str</span>&nbsp;<span class="op" id="2440071">:=</span>&nbsp;<span class="ident" id="2440074">signals</span><span class="op" id="2440081">[</span><span class="ident" id="2440082">s</span><span class="op" id="2440083">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440087">if</span>&nbsp;<span class="ident" id="2440090">str</span>&nbsp;<span class="op" id="2440094">!=</span>&nbsp;<span class="string" id="2440097">&#34;&#34;</span>&nbsp;<span class="op" id="2440100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440105">return</span>&nbsp;<span class="ident" id="2440112">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440124">return</span>&nbsp;<span class="string" id="2440131">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2440141">+</span>&nbsp;<span class="ident" id="2440143">itoa</span><span class="op" id="2440147">(</span><span class="builtintype" id="2440148">int</span><span class="op" id="2440151">(</span><span class="ident" id="2440152">s</span><span class="op" id="2440153">)</span><span class="op" id="2440154">)</span><br>
<span class="lineno"></span><span class="op" id="2440156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2440159">func</span>&nbsp;<span class="ident" id="2440164">Read</span><span class="op" id="2440168">(</span><span class="ident" id="2440169">fd</span>&nbsp;<span class="builtintype" id="2440172">int</span><span class="op" id="2440175">,</span>&nbsp;<span class="ident" id="2440177">p</span>&nbsp;<span class="op" id="2440179">[</span><span class="op" id="2440180">]</span><span class="builtintype" id="2440181">byte</span><span class="op" id="2440185">)</span>&nbsp;<span class="op" id="2440187">(</span><span class="ident" id="2440188">n</span>&nbsp;<span class="builtintype" id="2440190">int</span><span class="op" id="2440193">,</span>&nbsp;<span class="ident" id="2440195">err</span>&nbsp;<span class="builtintype" id="2440199">error</span><span class="op" id="2440204">)</span>&nbsp;<span class="op" id="2440206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440209">n</span><span class="op" id="2440210">,</span>&nbsp;<span class="ident" id="2440212">err</span>&nbsp;<span class="op" id="2440216">=</span>&nbsp;<span class="ident" id="2440218">read</span><span class="op" id="2440222">(</span><span class="ident" id="2440223">fd</span><span class="op" id="2440225">,</span>&nbsp;<span class="ident" id="2440227">p</span><span class="op" id="2440228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440231">if</span>&nbsp;<span class="ident" id="2440234">raceenabled</span>&nbsp;<span class="op" id="2440246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440250">if</span>&nbsp;<span class="ident" id="2440253">n</span>&nbsp;<span class="op" id="2440255">&gt;</span>&nbsp;<span class="num" id="2440257">0</span>&nbsp;<span class="op" id="2440259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440264">raceWriteRange</span><span class="op" id="2440278">(</span><span class="ident" id="2440279">unsafe</span><span class="op" id="2440285">.</span><span class="ident" id="2440286">Pointer</span><span class="op" id="2440293">(</span><span class="op" id="2440294">&amp;</span><span class="ident" id="2440295">p</span><span class="op" id="2440296">[</span><span class="num" id="2440297">0</span><span class="op" id="2440298">]</span><span class="op" id="2440299">)</span><span class="op" id="2440300">,</span>&nbsp;<span class="ident" id="2440302">n</span><span class="op" id="2440303">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440311">if</span>&nbsp;<span class="ident" id="2440314">err</span>&nbsp;<span class="op" id="2440318">==</span>&nbsp;<span class="builtintype" id="2440321">nil</span>&nbsp;<span class="op" id="2440325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440330">raceAcquire</span><span class="op" id="2440341">(</span><span class="ident" id="2440342">unsafe</span><span class="op" id="2440348">.</span><span class="ident" id="2440349">Pointer</span><span class="op" id="2440356">(</span><span class="op" id="2440357">&amp;</span><span class="ident" id="2440358">ioSync</span><span class="op" id="2440364">)</span><span class="op" id="2440365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440372">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440375">return</span><br>
<span class="lineno"></span><span class="op" id="2440382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440385">func</span>&nbsp;<span class="ident" id="2440390">Write</span><span class="op" id="2440395">(</span><span class="ident" id="2440396">fd</span>&nbsp;<span class="builtintype" id="2440399">int</span><span class="op" id="2440402">,</span>&nbsp;<span class="ident" id="2440404">p</span>&nbsp;<span class="op" id="2440406">[</span><span class="op" id="2440407">]</span><span class="builtintype" id="2440408">byte</span><span class="op" id="2440412">)</span>&nbsp;<span class="op" id="2440414">(</span><span class="ident" id="2440415">n</span>&nbsp;<span class="builtintype" id="2440417">int</span><span class="op" id="2440420">,</span>&nbsp;<span class="ident" id="2440422">err</span>&nbsp;<span class="builtintype" id="2440426">error</span><span class="op" id="2440431">)</span>&nbsp;<span class="op" id="2440433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440436">if</span>&nbsp;<span class="ident" id="2440439">raceenabled</span>&nbsp;<span class="op" id="2440451">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440455">raceReleaseMerge</span><span class="op" id="2440471">(</span><span class="ident" id="2440472">unsafe</span><span class="op" id="2440478">.</span><span class="ident" id="2440479">Pointer</span><span class="op" id="2440486">(</span><span class="op" id="2440487">&amp;</span><span class="ident" id="2440488">ioSync</span><span class="op" id="2440494">)</span><span class="op" id="2440495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440501">n</span><span class="op" id="2440502">,</span>&nbsp;<span class="ident" id="2440504">err</span>&nbsp;<span class="op" id="2440508">=</span>&nbsp;<span class="ident" id="2440510">write</span><span class="op" id="2440515">(</span><span class="ident" id="2440516">fd</span><span class="op" id="2440518">,</span>&nbsp;<span class="ident" id="2440520">p</span><span class="op" id="2440521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440524">if</span>&nbsp;<span class="ident" id="2440527">raceenabled</span>&nbsp;<span class="op" id="2440539">&amp;&amp;</span>&nbsp;<span class="ident" id="2440542">n</span>&nbsp;<span class="op" id="2440544">&gt;</span>&nbsp;<span class="num" id="2440546">0</span>&nbsp;<span class="op" id="2440548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440552">raceReadRange</span><span class="op" id="2440565">(</span><span class="ident" id="2440566">unsafe</span><span class="op" id="2440572">.</span><span class="ident" id="2440573">Pointer</span><span class="op" id="2440580">(</span><span class="op" id="2440581">&amp;</span><span class="ident" id="2440582">p</span><span class="op" id="2440583">[</span><span class="num" id="2440584">0</span><span class="op" id="2440585">]</span><span class="op" id="2440586">)</span><span class="op" id="2440587">,</span>&nbsp;<span class="ident" id="2440589">n</span><span class="op" id="2440590">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2440593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2440596">return</span><br>
<span class="lineno"></span><span class="op" id="2440603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2440606">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2440657">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2440709">var</span>&nbsp;<span class="ident" id="2440713">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2440731">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440737">type</span>&nbsp;<span class="ident" id="2440742">Sockaddr</span>&nbsp;<span class="keyword" id="2440751">interface</span>&nbsp;<span class="op" id="2440761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440764">sockaddr</span><span class="op" id="2440772">(</span><span class="op" id="2440773">)</span>&nbsp;<span class="op" id="2440775">(</span><span class="ident" id="2440776">ptr</span>&nbsp;<span class="ident" id="2440780">unsafe</span><span class="op" id="2440786">.</span><span class="ident" id="2440787">Pointer</span><span class="op" id="2440794">,</span>&nbsp;<span class="builtinfunc" id="2440796">len</span>&nbsp;<span class="ident" id="2440800">_Socklen</span><span class="op" id="2440808">,</span>&nbsp;<span class="ident" id="2440810">err</span>&nbsp;<span class="builtintype" id="2440814">error</span><span class="op" id="2440819">)</span>&nbsp;<span class="comment" id="2440821">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2440864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440867">type</span>&nbsp;<span class="ident" id="2440872">SockaddrInet4</span>&nbsp;<span class="keyword" id="2440886">struct</span>&nbsp;<span class="op" id="2440893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440896">Port</span>&nbsp;<span class="builtintype" id="2440901">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440906">Addr</span>&nbsp;<span class="op" id="2440911">[</span><span class="num" id="2440912">4</span><span class="op" id="2440913">]</span><span class="builtintype" id="2440914">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440920">raw</span>&nbsp;&nbsp;<span class="ident" id="2440925">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2440942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440945">type</span>&nbsp;<span class="ident" id="2440950">SockaddrInet6</span>&nbsp;<span class="keyword" id="2440964">struct</span>&nbsp;<span class="op" id="2440971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440974">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2440981">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2440986">ZoneId</span>&nbsp;<span class="builtintype" id="2440993">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441001">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2441008">[</span><span class="num" id="2441009">16</span><span class="op" id="2441011">]</span><span class="builtintype" id="2441012">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441018">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441025">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2441042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2441045">type</span>&nbsp;<span class="ident" id="2441050">SockaddrUnix</span>&nbsp;<span class="keyword" id="2441063">struct</span>&nbsp;<span class="op" id="2441070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441073">Name</span>&nbsp;<span class="builtintype" id="2441078">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441086">raw</span>&nbsp;&nbsp;<span class="ident" id="2441091">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2441107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2441110">func</span>&nbsp;<span class="ident" id="2441115">Bind</span><span class="op" id="2441119">(</span><span class="ident" id="2441120">fd</span>&nbsp;<span class="builtintype" id="2441123">int</span><span class="op" id="2441126">,</span>&nbsp;<span class="ident" id="2441128">sa</span>&nbsp;<span class="ident" id="2441131">Sockaddr</span><span class="op" id="2441139">)</span>&nbsp;<span class="op" id="2441141">(</span><span class="ident" id="2441142">err</span>&nbsp;<span class="builtintype" id="2441146">error</span><span class="op" id="2441151">)</span>&nbsp;<span class="op" id="2441153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441156">ptr</span><span class="op" id="2441159">,</span>&nbsp;<span class="ident" id="2441161">n</span><span class="op" id="2441162">,</span>&nbsp;<span class="ident" id="2441164">err</span>&nbsp;<span class="op" id="2441168">:=</span>&nbsp;<span class="ident" id="2441171">sa</span><span class="op" id="2441173">.</span><span class="ident" id="2441174">sockaddr</span><span class="op" id="2441182">(</span><span class="op" id="2441183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441186">if</span>&nbsp;<span class="ident" id="2441189">err</span>&nbsp;<span class="op" id="2441193">!=</span>&nbsp;<span class="builtintype" id="2441196">nil</span>&nbsp;<span class="op" id="2441200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441204">return</span>&nbsp;<span class="ident" id="2441211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2441216">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441219">return</span>&nbsp;<span class="ident" id="2441226">bind</span><span class="op" id="2441230">(</span><span class="ident" id="2441231">fd</span><span class="op" id="2441233">,</span>&nbsp;<span class="ident" id="2441235">ptr</span><span class="op" id="2441238">,</span>&nbsp;<span class="ident" id="2441240">n</span><span class="op" id="2441241">)</span><br>
<span class="lineno"></span><span class="op" id="2441243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2441246">func</span>&nbsp;<span class="ident" id="2441251">Connect</span><span class="op" id="2441258">(</span><span class="ident" id="2441259">fd</span>&nbsp;<span class="builtintype" id="2441262">int</span><span class="op" id="2441265">,</span>&nbsp;<span class="ident" id="2441267">sa</span>&nbsp;<span class="ident" id="2441270">Sockaddr</span><span class="op" id="2441278">)</span>&nbsp;<span class="op" id="2441280">(</span><span class="ident" id="2441281">err</span>&nbsp;<span class="builtintype" id="2441285">error</span><span class="op" id="2441290">)</span>&nbsp;<span class="op" id="2441292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441295">ptr</span><span class="op" id="2441298">,</span>&nbsp;<span class="ident" id="2441300">n</span><span class="op" id="2441301">,</span>&nbsp;<span class="ident" id="2441303">err</span>&nbsp;<span class="op" id="2441307">:=</span>&nbsp;<span class="ident" id="2441310">sa</span><span class="op" id="2441312">.</span><span class="ident" id="2441313">sockaddr</span><span class="op" id="2441321">(</span><span class="op" id="2441322">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441325">if</span>&nbsp;<span class="ident" id="2441328">err</span>&nbsp;<span class="op" id="2441332">!=</span>&nbsp;<span class="builtintype" id="2441335">nil</span>&nbsp;<span class="op" id="2441339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441343">return</span>&nbsp;<span class="ident" id="2441350">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2441355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441358">return</span>&nbsp;<span class="ident" id="2441365">connect</span><span class="op" id="2441372">(</span><span class="ident" id="2441373">fd</span><span class="op" id="2441375">,</span>&nbsp;<span class="ident" id="2441377">ptr</span><span class="op" id="2441380">,</span>&nbsp;<span class="ident" id="2441382">n</span><span class="op" id="2441383">)</span><br>
<span class="lineno"></span><span class="op" id="2441385">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2441388">func</span>&nbsp;<span class="ident" id="2441393">Getpeername</span><span class="op" id="2441404">(</span><span class="ident" id="2441405">fd</span>&nbsp;<span class="builtintype" id="2441408">int</span><span class="op" id="2441411">)</span>&nbsp;<span class="op" id="2441413">(</span><span class="ident" id="2441414">sa</span>&nbsp;<span class="ident" id="2441417">Sockaddr</span><span class="op" id="2441425">,</span>&nbsp;<span class="ident" id="2441427">err</span>&nbsp;<span class="builtintype" id="2441431">error</span><span class="op" id="2441436">)</span>&nbsp;<span class="op" id="2441438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441441">var</span>&nbsp;<span class="ident" id="2441445">rsa</span>&nbsp;<span class="ident" id="2441449">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441465">var</span>&nbsp;<span class="builtinfunc" id="2441469">len</span>&nbsp;<span class="ident" id="2441473">_Socklen</span>&nbsp;<span class="op" id="2441482">=</span>&nbsp;<span class="ident" id="2441484">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441503">if</span>&nbsp;<span class="ident" id="2441506">err</span>&nbsp;<span class="op" id="2441510">=</span>&nbsp;<span class="ident" id="2441512">getpeername</span><span class="op" id="2441523">(</span><span class="ident" id="2441524">fd</span><span class="op" id="2441526">,</span>&nbsp;<span class="op" id="2441528">&amp;</span><span class="ident" id="2441529">rsa</span><span class="op" id="2441532">,</span>&nbsp;<span class="op" id="2441534">&amp;</span><span class="builtinfunc" id="2441535">len</span><span class="op" id="2441538">)</span><span class="op" id="2441539">;</span>&nbsp;<span class="ident" id="2441541">err</span>&nbsp;<span class="op" id="2441545">!=</span>&nbsp;<span class="builtintype" id="2441548">nil</span>&nbsp;<span class="op" id="2441552">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441556">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2441564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441567">return</span>&nbsp;<span class="ident" id="2441574">anyToSockaddr</span><span class="op" id="2441587">(</span><span class="op" id="2441588">&amp;</span><span class="ident" id="2441589">rsa</span><span class="op" id="2441592">)</span><br>
<span class="lineno"></span><span class="op" id="2441594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2441597">func</span>&nbsp;<span class="ident" id="2441602">GetsockoptInt</span><span class="op" id="2441615">(</span><span class="ident" id="2441616">fd</span><span class="op" id="2441618">,</span>&nbsp;<span class="ident" id="2441620">level</span><span class="op" id="2441625">,</span>&nbsp;<span class="ident" id="2441627">opt</span>&nbsp;<span class="builtintype" id="2441631">int</span><span class="op" id="2441634">)</span>&nbsp;<span class="op" id="2441636">(</span><span class="ident" id="2441637">value</span>&nbsp;<span class="builtintype" id="2441643">int</span><span class="op" id="2441646">,</span>&nbsp;<span class="ident" id="2441648">err</span>&nbsp;<span class="builtintype" id="2441652">error</span><span class="op" id="2441657">)</span>&nbsp;<span class="op" id="2441659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441662">var</span>&nbsp;<span class="ident" id="2441666">n</span>&nbsp;<span class="builtintype" id="2441668">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441675">vallen</span>&nbsp;<span class="op" id="2441682">:=</span>&nbsp;<span class="ident" id="2441685">_Socklen</span><span class="op" id="2441693">(</span><span class="num" id="2441694">4</span><span class="op" id="2441695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2441698">err</span>&nbsp;<span class="op" id="2441702">=</span>&nbsp;<span class="ident" id="2441704">getsockopt</span><span class="op" id="2441714">(</span><span class="ident" id="2441715">fd</span><span class="op" id="2441717">,</span>&nbsp;<span class="ident" id="2441719">level</span><span class="op" id="2441724">,</span>&nbsp;<span class="ident" id="2441726">opt</span><span class="op" id="2441729">,</span>&nbsp;<span class="ident" id="2441731">unsafe</span><span class="op" id="2441737">.</span><span class="ident" id="2441738">Pointer</span><span class="op" id="2441745">(</span><span class="op" id="2441746">&amp;</span><span class="ident" id="2441747">n</span><span class="op" id="2441748">)</span><span class="op" id="2441749">,</span>&nbsp;<span class="op" id="2441751">&amp;</span><span class="ident" id="2441752">vallen</span><span class="op" id="2441758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441761">return</span>&nbsp;<span class="builtintype" id="2441768">int</span><span class="op" id="2441771">(</span><span class="ident" id="2441772">n</span><span class="op" id="2441773">)</span><span class="op" id="2441774">,</span>&nbsp;<span class="ident" id="2441776">err</span><br>
<span class="lineno">215</span><span class="op" id="2441780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2441783">func</span>&nbsp;<span class="ident" id="2441788">Recvfrom</span><span class="op" id="2441796">(</span><span class="ident" id="2441797">fd</span>&nbsp;<span class="builtintype" id="2441800">int</span><span class="op" id="2441803">,</span>&nbsp;<span class="ident" id="2441805">p</span>&nbsp;<span class="op" id="2441807">[</span><span class="op" id="2441808">]</span><span class="builtintype" id="2441809">byte</span><span class="op" id="2441813">,</span>&nbsp;<span class="ident" id="2441815">flags</span>&nbsp;<span class="builtintype" id="2441821">int</span><span class="op" id="2441824">)</span>&nbsp;<span class="op" id="2441826">(</span><span class="ident" id="2441827">n</span>&nbsp;<span class="builtintype" id="2441829">int</span><span class="op" id="2441832">,</span>&nbsp;<span class="ident" id="2441834">from</span>&nbsp;<span class="ident" id="2441839">Sockaddr</span><span class="op" id="2441847">,</span>&nbsp;<span class="ident" id="2441849">err</span>&nbsp;<span class="builtintype" id="2441853">error</span><span class="op" id="2441858">)</span>&nbsp;<span class="op" id="2441860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441863">var</span>&nbsp;<span class="ident" id="2441867">rsa</span>&nbsp;<span class="ident" id="2441871">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441887">var</span>&nbsp;<span class="builtinfunc" id="2441891">len</span>&nbsp;<span class="ident" id="2441895">_Socklen</span>&nbsp;<span class="op" id="2441904">=</span>&nbsp;<span class="ident" id="2441906">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441925">if</span>&nbsp;<span class="ident" id="2441928">n</span><span class="op" id="2441929">,</span>&nbsp;<span class="ident" id="2441931">err</span>&nbsp;<span class="op" id="2441935">=</span>&nbsp;<span class="ident" id="2441937">recvfrom</span><span class="op" id="2441945">(</span><span class="ident" id="2441946">fd</span><span class="op" id="2441948">,</span>&nbsp;<span class="ident" id="2441950">p</span><span class="op" id="2441951">,</span>&nbsp;<span class="ident" id="2441953">flags</span><span class="op" id="2441958">,</span>&nbsp;<span class="op" id="2441960">&amp;</span><span class="ident" id="2441961">rsa</span><span class="op" id="2441964">,</span>&nbsp;<span class="op" id="2441966">&amp;</span><span class="builtinfunc" id="2441967">len</span><span class="op" id="2441970">)</span><span class="op" id="2441971">;</span>&nbsp;<span class="ident" id="2441973">err</span>&nbsp;<span class="op" id="2441977">!=</span>&nbsp;<span class="builtintype" id="2441980">nil</span>&nbsp;<span class="op" id="2441984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441988">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2441996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2441999">if</span>&nbsp;<span class="ident" id="2442002">rsa</span><span class="op" id="2442005">.</span><span class="ident" id="2442006">Addr</span><span class="op" id="2442010">.</span><span class="ident" id="2442011">Family</span>&nbsp;<span class="op" id="2442018">!=</span>&nbsp;<span class="ident" id="2442021">AF_UNSPEC</span>&nbsp;<span class="op" id="2442031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2442035">from</span><span class="op" id="2442039">,</span>&nbsp;<span class="ident" id="2442041">err</span>&nbsp;<span class="op" id="2442045">=</span>&nbsp;<span class="ident" id="2442047">anyToSockaddr</span><span class="op" id="2442060">(</span><span class="op" id="2442061">&amp;</span><span class="ident" id="2442062">rsa</span><span class="op" id="2442065">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2442068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442071">return</span><br>
<span class="lineno"></span><span class="op" id="2442078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442081">func</span>&nbsp;<span class="ident" id="2442086">Sendto</span><span class="op" id="2442092">(</span><span class="ident" id="2442093">fd</span>&nbsp;<span class="builtintype" id="2442096">int</span><span class="op" id="2442099">,</span>&nbsp;<span class="ident" id="2442101">p</span>&nbsp;<span class="op" id="2442103">[</span><span class="op" id="2442104">]</span><span class="builtintype" id="2442105">byte</span><span class="op" id="2442109">,</span>&nbsp;<span class="ident" id="2442111">flags</span>&nbsp;<span class="builtintype" id="2442117">int</span><span class="op" id="2442120">,</span>&nbsp;<span class="ident" id="2442122">to</span>&nbsp;<span class="ident" id="2442125">Sockaddr</span><span class="op" id="2442133">)</span>&nbsp;<span class="op" id="2442135">(</span><span class="ident" id="2442136">err</span>&nbsp;<span class="builtintype" id="2442140">error</span><span class="op" id="2442145">)</span>&nbsp;<span class="op" id="2442147">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2442150">ptr</span><span class="op" id="2442153">,</span>&nbsp;<span class="ident" id="2442155">n</span><span class="op" id="2442156">,</span>&nbsp;<span class="ident" id="2442158">err</span>&nbsp;<span class="op" id="2442162">:=</span>&nbsp;<span class="ident" id="2442165">to</span><span class="op" id="2442167">.</span><span class="ident" id="2442168">sockaddr</span><span class="op" id="2442176">(</span><span class="op" id="2442177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442180">if</span>&nbsp;<span class="ident" id="2442183">err</span>&nbsp;<span class="op" id="2442187">!=</span>&nbsp;<span class="builtintype" id="2442190">nil</span>&nbsp;<span class="op" id="2442194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442198">return</span>&nbsp;<span class="ident" id="2442205">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2442210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442213">return</span>&nbsp;<span class="ident" id="2442220">sendto</span><span class="op" id="2442226">(</span><span class="ident" id="2442227">fd</span><span class="op" id="2442229">,</span>&nbsp;<span class="ident" id="2442231">p</span><span class="op" id="2442232">,</span>&nbsp;<span class="ident" id="2442234">flags</span><span class="op" id="2442239">,</span>&nbsp;<span class="ident" id="2442241">ptr</span><span class="op" id="2442244">,</span>&nbsp;<span class="ident" id="2442246">n</span><span class="op" id="2442247">)</span><br>
<span class="lineno">235</span><span class="op" id="2442249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442252">func</span>&nbsp;<span class="ident" id="2442257">SetsockoptByte</span><span class="op" id="2442271">(</span><span class="ident" id="2442272">fd</span><span class="op" id="2442274">,</span>&nbsp;<span class="ident" id="2442276">level</span><span class="op" id="2442281">,</span>&nbsp;<span class="ident" id="2442283">opt</span>&nbsp;<span class="builtintype" id="2442287">int</span><span class="op" id="2442290">,</span>&nbsp;<span class="ident" id="2442292">value</span>&nbsp;<span class="builtintype" id="2442298">byte</span><span class="op" id="2442302">)</span>&nbsp;<span class="op" id="2442304">(</span><span class="ident" id="2442305">err</span>&nbsp;<span class="builtintype" id="2442309">error</span><span class="op" id="2442314">)</span>&nbsp;<span class="op" id="2442316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442319">return</span>&nbsp;<span class="ident" id="2442326">setsockopt</span><span class="op" id="2442336">(</span><span class="ident" id="2442337">fd</span><span class="op" id="2442339">,</span>&nbsp;<span class="ident" id="2442341">level</span><span class="op" id="2442346">,</span>&nbsp;<span class="ident" id="2442348">opt</span><span class="op" id="2442351">,</span>&nbsp;<span class="ident" id="2442353">unsafe</span><span class="op" id="2442359">.</span><span class="ident" id="2442360">Pointer</span><span class="op" id="2442367">(</span><span class="op" id="2442368">&amp;</span><span class="ident" id="2442369">value</span><span class="op" id="2442374">)</span><span class="op" id="2442375">,</span>&nbsp;<span class="num" id="2442377">1</span><span class="op" id="2442378">)</span><br>
<span class="lineno"></span><span class="op" id="2442380">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2442383">func</span>&nbsp;<span class="ident" id="2442388">SetsockoptInt</span><span class="op" id="2442401">(</span><span class="ident" id="2442402">fd</span><span class="op" id="2442404">,</span>&nbsp;<span class="ident" id="2442406">level</span><span class="op" id="2442411">,</span>&nbsp;<span class="ident" id="2442413">opt</span>&nbsp;<span class="builtintype" id="2442417">int</span><span class="op" id="2442420">,</span>&nbsp;<span class="ident" id="2442422">value</span>&nbsp;<span class="builtintype" id="2442428">int</span><span class="op" id="2442431">)</span>&nbsp;<span class="op" id="2442433">(</span><span class="ident" id="2442434">err</span>&nbsp;<span class="builtintype" id="2442438">error</span><span class="op" id="2442443">)</span>&nbsp;<span class="op" id="2442445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442448">var</span>&nbsp;<span class="ident" id="2442452">n</span>&nbsp;<span class="op" id="2442454">=</span>&nbsp;<span class="builtintype" id="2442456">int32</span><span class="op" id="2442461">(</span><span class="ident" id="2442462">value</span><span class="op" id="2442467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442470">return</span>&nbsp;<span class="ident" id="2442477">setsockopt</span><span class="op" id="2442487">(</span><span class="ident" id="2442488">fd</span><span class="op" id="2442490">,</span>&nbsp;<span class="ident" id="2442492">level</span><span class="op" id="2442497">,</span>&nbsp;<span class="ident" id="2442499">opt</span><span class="op" id="2442502">,</span>&nbsp;<span class="ident" id="2442504">unsafe</span><span class="op" id="2442510">.</span><span class="ident" id="2442511">Pointer</span><span class="op" id="2442518">(</span><span class="op" id="2442519">&amp;</span><span class="ident" id="2442520">n</span><span class="op" id="2442521">)</span><span class="op" id="2442522">,</span>&nbsp;<span class="num" id="2442524">4</span><span class="op" id="2442525">)</span><br>
<span class="lineno"></span><span class="op" id="2442527">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2442530">func</span>&nbsp;<span class="ident" id="2442535">SetsockoptInet4Addr</span><span class="op" id="2442554">(</span><span class="ident" id="2442555">fd</span><span class="op" id="2442557">,</span>&nbsp;<span class="ident" id="2442559">level</span><span class="op" id="2442564">,</span>&nbsp;<span class="ident" id="2442566">opt</span>&nbsp;<span class="builtintype" id="2442570">int</span><span class="op" id="2442573">,</span>&nbsp;<span class="ident" id="2442575">value</span>&nbsp;<span class="op" id="2442581">[</span><span class="num" id="2442582">4</span><span class="op" id="2442583">]</span><span class="builtintype" id="2442584">byte</span><span class="op" id="2442588">)</span>&nbsp;<span class="op" id="2442590">(</span><span class="ident" id="2442591">err</span>&nbsp;<span class="builtintype" id="2442595">error</span><span class="op" id="2442600">)</span>&nbsp;<span class="op" id="2442602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442605">return</span>&nbsp;<span class="ident" id="2442612">setsockopt</span><span class="op" id="2442622">(</span><span class="ident" id="2442623">fd</span><span class="op" id="2442625">,</span>&nbsp;<span class="ident" id="2442627">level</span><span class="op" id="2442632">,</span>&nbsp;<span class="ident" id="2442634">opt</span><span class="op" id="2442637">,</span>&nbsp;<span class="ident" id="2442639">unsafe</span><span class="op" id="2442645">.</span><span class="ident" id="2442646">Pointer</span><span class="op" id="2442653">(</span><span class="op" id="2442654">&amp;</span><span class="ident" id="2442655">value</span><span class="op" id="2442660">[</span><span class="num" id="2442661">0</span><span class="op" id="2442662">]</span><span class="op" id="2442663">)</span><span class="op" id="2442664">,</span>&nbsp;<span class="num" id="2442666">4</span><span class="op" id="2442667">)</span><br>
<span class="lineno"></span><span class="op" id="2442669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2442672">func</span>&nbsp;<span class="ident" id="2442677">SetsockoptIPMreq</span><span class="op" id="2442693">(</span><span class="ident" id="2442694">fd</span><span class="op" id="2442696">,</span>&nbsp;<span class="ident" id="2442698">level</span><span class="op" id="2442703">,</span>&nbsp;<span class="ident" id="2442705">opt</span>&nbsp;<span class="builtintype" id="2442709">int</span><span class="op" id="2442712">,</span>&nbsp;<span class="ident" id="2442714">mreq</span>&nbsp;<span class="op" id="2442719">*</span><span class="ident" id="2442720">IPMreq</span><span class="op" id="2442726">)</span>&nbsp;<span class="op" id="2442728">(</span><span class="ident" id="2442729">err</span>&nbsp;<span class="builtintype" id="2442733">error</span><span class="op" id="2442738">)</span>&nbsp;<span class="op" id="2442740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442743">return</span>&nbsp;<span class="ident" id="2442750">setsockopt</span><span class="op" id="2442760">(</span><span class="ident" id="2442761">fd</span><span class="op" id="2442763">,</span>&nbsp;<span class="ident" id="2442765">level</span><span class="op" id="2442770">,</span>&nbsp;<span class="ident" id="2442772">opt</span><span class="op" id="2442775">,</span>&nbsp;<span class="ident" id="2442777">unsafe</span><span class="op" id="2442783">.</span><span class="ident" id="2442784">Pointer</span><span class="op" id="2442791">(</span><span class="ident" id="2442792">mreq</span><span class="op" id="2442796">)</span><span class="op" id="2442797">,</span>&nbsp;<span class="ident" id="2442799">SizeofIPMreq</span><span class="op" id="2442811">)</span><br>
<span class="lineno"></span><span class="op" id="2442813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442816">func</span>&nbsp;<span class="ident" id="2442821">SetsockoptIPv6Mreq</span><span class="op" id="2442839">(</span><span class="ident" id="2442840">fd</span><span class="op" id="2442842">,</span>&nbsp;<span class="ident" id="2442844">level</span><span class="op" id="2442849">,</span>&nbsp;<span class="ident" id="2442851">opt</span>&nbsp;<span class="builtintype" id="2442855">int</span><span class="op" id="2442858">,</span>&nbsp;<span class="ident" id="2442860">mreq</span>&nbsp;<span class="op" id="2442865">*</span><span class="ident" id="2442866">IPv6Mreq</span><span class="op" id="2442874">)</span>&nbsp;<span class="op" id="2442876">(</span><span class="ident" id="2442877">err</span>&nbsp;<span class="builtintype" id="2442881">error</span><span class="op" id="2442886">)</span>&nbsp;<span class="op" id="2442888">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2442891">return</span>&nbsp;<span class="ident" id="2442898">setsockopt</span><span class="op" id="2442908">(</span><span class="ident" id="2442909">fd</span><span class="op" id="2442911">,</span>&nbsp;<span class="ident" id="2442913">level</span><span class="op" id="2442918">,</span>&nbsp;<span class="ident" id="2442920">opt</span><span class="op" id="2442923">,</span>&nbsp;<span class="ident" id="2442925">unsafe</span><span class="op" id="2442931">.</span><span class="ident" id="2442932">Pointer</span><span class="op" id="2442939">(</span><span class="ident" id="2442940">mreq</span><span class="op" id="2442944">)</span><span class="op" id="2442945">,</span>&nbsp;<span class="ident" id="2442947">SizeofIPv6Mreq</span><span class="op" id="2442961">)</span><br>
<span class="lineno"></span><span class="op" id="2442963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442966">func</span>&nbsp;<span class="ident" id="2442971">SetsockoptICMPv6Filter</span><span class="op" id="2442993">(</span><span class="ident" id="2442994">fd</span><span class="op" id="2442996">,</span>&nbsp;<span class="ident" id="2442998">level</span><span class="op" id="2443003">,</span>&nbsp;<span class="ident" id="2443005">opt</span>&nbsp;<span class="builtintype" id="2443009">int</span><span class="op" id="2443012">,</span>&nbsp;<span class="ident" id="2443014">filter</span>&nbsp;<span class="op" id="2443021">*</span><span class="ident" id="2443022">ICMPv6Filter</span><span class="op" id="2443034">)</span>&nbsp;<span class="builtintype" id="2443036">error</span>&nbsp;<span class="op" id="2443042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443045">return</span>&nbsp;<span class="ident" id="2443052">setsockopt</span><span class="op" id="2443062">(</span><span class="ident" id="2443063">fd</span><span class="op" id="2443065">,</span>&nbsp;<span class="ident" id="2443067">level</span><span class="op" id="2443072">,</span>&nbsp;<span class="ident" id="2443074">opt</span><span class="op" id="2443077">,</span>&nbsp;<span class="ident" id="2443079">unsafe</span><span class="op" id="2443085">.</span><span class="ident" id="2443086">Pointer</span><span class="op" id="2443093">(</span><span class="ident" id="2443094">filter</span><span class="op" id="2443100">)</span><span class="op" id="2443101">,</span>&nbsp;<span class="ident" id="2443103">SizeofICMPv6Filter</span><span class="op" id="2443121">)</span><br>
<span class="lineno">260</span><span class="op" id="2443123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443126">func</span>&nbsp;<span class="ident" id="2443131">SetsockoptLinger</span><span class="op" id="2443147">(</span><span class="ident" id="2443148">fd</span><span class="op" id="2443150">,</span>&nbsp;<span class="ident" id="2443152">level</span><span class="op" id="2443157">,</span>&nbsp;<span class="ident" id="2443159">opt</span>&nbsp;<span class="builtintype" id="2443163">int</span><span class="op" id="2443166">,</span>&nbsp;<span class="ident" id="2443168">l</span>&nbsp;<span class="op" id="2443170">*</span><span class="ident" id="2443171">Linger</span><span class="op" id="2443177">)</span>&nbsp;<span class="op" id="2443179">(</span><span class="ident" id="2443180">err</span>&nbsp;<span class="builtintype" id="2443184">error</span><span class="op" id="2443189">)</span>&nbsp;<span class="op" id="2443191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443194">return</span>&nbsp;<span class="ident" id="2443201">setsockopt</span><span class="op" id="2443211">(</span><span class="ident" id="2443212">fd</span><span class="op" id="2443214">,</span>&nbsp;<span class="ident" id="2443216">level</span><span class="op" id="2443221">,</span>&nbsp;<span class="ident" id="2443223">opt</span><span class="op" id="2443226">,</span>&nbsp;<span class="ident" id="2443228">unsafe</span><span class="op" id="2443234">.</span><span class="ident" id="2443235">Pointer</span><span class="op" id="2443242">(</span><span class="ident" id="2443243">l</span><span class="op" id="2443244">)</span><span class="op" id="2443245">,</span>&nbsp;<span class="ident" id="2443247">SizeofLinger</span><span class="op" id="2443259">)</span><br>
<span class="lineno"></span><span class="op" id="2443261">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2443264">func</span>&nbsp;<span class="ident" id="2443269">SetsockoptString</span><span class="op" id="2443285">(</span><span class="ident" id="2443286">fd</span><span class="op" id="2443288">,</span>&nbsp;<span class="ident" id="2443290">level</span><span class="op" id="2443295">,</span>&nbsp;<span class="ident" id="2443297">opt</span>&nbsp;<span class="builtintype" id="2443301">int</span><span class="op" id="2443304">,</span>&nbsp;<span class="ident" id="2443306">s</span>&nbsp;<span class="builtintype" id="2443308">string</span><span class="op" id="2443314">)</span>&nbsp;<span class="op" id="2443316">(</span><span class="ident" id="2443317">err</span>&nbsp;<span class="builtintype" id="2443321">error</span><span class="op" id="2443326">)</span>&nbsp;<span class="op" id="2443328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443331">return</span>&nbsp;<span class="ident" id="2443338">setsockopt</span><span class="op" id="2443348">(</span><span class="ident" id="2443349">fd</span><span class="op" id="2443351">,</span>&nbsp;<span class="ident" id="2443353">level</span><span class="op" id="2443358">,</span>&nbsp;<span class="ident" id="2443360">opt</span><span class="op" id="2443363">,</span>&nbsp;<span class="ident" id="2443365">unsafe</span><span class="op" id="2443371">.</span><span class="ident" id="2443372">Pointer</span><span class="op" id="2443379">(</span><span class="op" id="2443380">&amp;</span><span class="op" id="2443381">[</span><span class="op" id="2443382">]</span><span class="builtintype" id="2443383">byte</span><span class="op" id="2443387">(</span><span class="ident" id="2443388">s</span><span class="op" id="2443389">)</span><span class="op" id="2443390">[</span><span class="num" id="2443391">0</span><span class="op" id="2443392">]</span><span class="op" id="2443393">)</span><span class="op" id="2443394">,</span>&nbsp;<span class="builtintype" id="2443396">uintptr</span><span class="op" id="2443403">(</span><span class="builtinfunc" id="2443404">len</span><span class="op" id="2443407">(</span><span class="ident" id="2443408">s</span><span class="op" id="2443409">)</span><span class="op" id="2443410">)</span><span class="op" id="2443411">)</span><br>
<span class="lineno"></span><span class="op" id="2443413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2443416">func</span>&nbsp;<span class="ident" id="2443421">SetsockoptTimeval</span><span class="op" id="2443438">(</span><span class="ident" id="2443439">fd</span><span class="op" id="2443441">,</span>&nbsp;<span class="ident" id="2443443">level</span><span class="op" id="2443448">,</span>&nbsp;<span class="ident" id="2443450">opt</span>&nbsp;<span class="builtintype" id="2443454">int</span><span class="op" id="2443457">,</span>&nbsp;<span class="ident" id="2443459">tv</span>&nbsp;<span class="op" id="2443462">*</span><span class="ident" id="2443463">Timeval</span><span class="op" id="2443470">)</span>&nbsp;<span class="op" id="2443472">(</span><span class="ident" id="2443473">err</span>&nbsp;<span class="builtintype" id="2443477">error</span><span class="op" id="2443482">)</span>&nbsp;<span class="op" id="2443484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443487">return</span>&nbsp;<span class="ident" id="2443494">setsockopt</span><span class="op" id="2443504">(</span><span class="ident" id="2443505">fd</span><span class="op" id="2443507">,</span>&nbsp;<span class="ident" id="2443509">level</span><span class="op" id="2443514">,</span>&nbsp;<span class="ident" id="2443516">opt</span><span class="op" id="2443519">,</span>&nbsp;<span class="ident" id="2443521">unsafe</span><span class="op" id="2443527">.</span><span class="ident" id="2443528">Pointer</span><span class="op" id="2443535">(</span><span class="ident" id="2443536">tv</span><span class="op" id="2443538">)</span><span class="op" id="2443539">,</span>&nbsp;<span class="ident" id="2443541">unsafe</span><span class="op" id="2443547">.</span><span class="ident" id="2443548">Sizeof</span><span class="op" id="2443554">(</span><span class="op" id="2443555">*</span><span class="ident" id="2443556">tv</span><span class="op" id="2443558">)</span><span class="op" id="2443559">)</span><br>
<span class="lineno"></span><span class="op" id="2443561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443564">func</span>&nbsp;<span class="ident" id="2443569">Socket</span><span class="op" id="2443575">(</span><span class="ident" id="2443576">domain</span><span class="op" id="2443582">,</span>&nbsp;<span class="ident" id="2443584">typ</span><span class="op" id="2443587">,</span>&nbsp;<span class="ident" id="2443589">proto</span>&nbsp;<span class="builtintype" id="2443595">int</span><span class="op" id="2443598">)</span>&nbsp;<span class="op" id="2443600">(</span><span class="ident" id="2443601">fd</span>&nbsp;<span class="builtintype" id="2443604">int</span><span class="op" id="2443607">,</span>&nbsp;<span class="ident" id="2443609">err</span>&nbsp;<span class="builtintype" id="2443613">error</span><span class="op" id="2443618">)</span>&nbsp;<span class="op" id="2443620">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443623">if</span>&nbsp;<span class="ident" id="2443626">domain</span>&nbsp;<span class="op" id="2443633">==</span>&nbsp;<span class="ident" id="2443636">AF_INET6</span>&nbsp;<span class="op" id="2443645">&amp;&amp;</span>&nbsp;<span class="ident" id="2443648">SocketDisableIPv6</span>&nbsp;<span class="op" id="2443666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443670">return</span>&nbsp;<span class="op" id="2443677">-</span><span class="num" id="2443678">1</span><span class="op" id="2443679">,</span>&nbsp;<span class="ident" id="2443681">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2443695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443698">fd</span><span class="op" id="2443700">,</span>&nbsp;<span class="ident" id="2443702">err</span>&nbsp;<span class="op" id="2443706">=</span>&nbsp;<span class="ident" id="2443708">socket</span><span class="op" id="2443714">(</span><span class="ident" id="2443715">domain</span><span class="op" id="2443721">,</span>&nbsp;<span class="ident" id="2443723">typ</span><span class="op" id="2443726">,</span>&nbsp;<span class="ident" id="2443728">proto</span><span class="op" id="2443733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443736">return</span><br>
<span class="lineno">280</span><span class="op" id="2443743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443746">func</span>&nbsp;<span class="ident" id="2443751">Socketpair</span><span class="op" id="2443761">(</span><span class="ident" id="2443762">domain</span><span class="op" id="2443768">,</span>&nbsp;<span class="ident" id="2443770">typ</span><span class="op" id="2443773">,</span>&nbsp;<span class="ident" id="2443775">proto</span>&nbsp;<span class="builtintype" id="2443781">int</span><span class="op" id="2443784">)</span>&nbsp;<span class="op" id="2443786">(</span><span class="ident" id="2443787">fd</span>&nbsp;<span class="op" id="2443790">[</span><span class="num" id="2443791">2</span><span class="op" id="2443792">]</span><span class="builtintype" id="2443793">int</span><span class="op" id="2443796">,</span>&nbsp;<span class="ident" id="2443798">err</span>&nbsp;<span class="builtintype" id="2443802">error</span><span class="op" id="2443807">)</span>&nbsp;<span class="op" id="2443809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443812">var</span>&nbsp;<span class="ident" id="2443816">fdx</span>&nbsp;<span class="op" id="2443820">[</span><span class="num" id="2443821">2</span><span class="op" id="2443822">]</span><span class="builtintype" id="2443823">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443830">err</span>&nbsp;<span class="op" id="2443834">=</span>&nbsp;<span class="ident" id="2443836">socketpair</span><span class="op" id="2443846">(</span><span class="ident" id="2443847">domain</span><span class="op" id="2443853">,</span>&nbsp;<span class="ident" id="2443855">typ</span><span class="op" id="2443858">,</span>&nbsp;<span class="ident" id="2443860">proto</span><span class="op" id="2443865">,</span>&nbsp;<span class="op" id="2443867">&amp;</span><span class="ident" id="2443868">fdx</span><span class="op" id="2443871">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443874">if</span>&nbsp;<span class="ident" id="2443877">err</span>&nbsp;<span class="op" id="2443881">==</span>&nbsp;<span class="builtintype" id="2443884">nil</span>&nbsp;<span class="op" id="2443888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443892">fd</span><span class="op" id="2443894">[</span><span class="num" id="2443895">0</span><span class="op" id="2443896">]</span>&nbsp;<span class="op" id="2443898">=</span>&nbsp;<span class="builtintype" id="2443900">int</span><span class="op" id="2443903">(</span><span class="ident" id="2443904">fdx</span><span class="op" id="2443907">[</span><span class="num" id="2443908">0</span><span class="op" id="2443909">]</span><span class="op" id="2443910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443914">fd</span><span class="op" id="2443916">[</span><span class="num" id="2443917">1</span><span class="op" id="2443918">]</span>&nbsp;<span class="op" id="2443920">=</span>&nbsp;<span class="builtintype" id="2443922">int</span><span class="op" id="2443925">(</span><span class="ident" id="2443926">fdx</span><span class="op" id="2443929">[</span><span class="num" id="2443930">1</span><span class="op" id="2443931">]</span><span class="op" id="2443932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2443935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443938">return</span><br>
<span class="lineno">290</span><span class="op" id="2443945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2443948">func</span>&nbsp;<span class="ident" id="2443953">Sendfile</span><span class="op" id="2443961">(</span><span class="ident" id="2443962">outfd</span>&nbsp;<span class="builtintype" id="2443968">int</span><span class="op" id="2443971">,</span>&nbsp;<span class="ident" id="2443973">infd</span>&nbsp;<span class="builtintype" id="2443978">int</span><span class="op" id="2443981">,</span>&nbsp;<span class="ident" id="2443983">offset</span>&nbsp;<span class="op" id="2443990">*</span><span class="ident" id="2443991">int64</span><span class="op" id="2443996">,</span>&nbsp;<span class="ident" id="2443998">count</span>&nbsp;<span class="builtintype" id="2444004">int</span><span class="op" id="2444007">)</span>&nbsp;<span class="op" id="2444009">(</span><span class="ident" id="2444010">written</span>&nbsp;<span class="builtintype" id="2444018">int</span><span class="op" id="2444021">,</span>&nbsp;<span class="ident" id="2444023">err</span>&nbsp;<span class="builtintype" id="2444027">error</span><span class="op" id="2444032">)</span>&nbsp;<span class="op" id="2444034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2444037">if</span>&nbsp;<span class="ident" id="2444040">raceenabled</span>&nbsp;<span class="op" id="2444052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444056">raceReleaseMerge</span><span class="op" id="2444072">(</span><span class="ident" id="2444073">unsafe</span><span class="op" id="2444079">.</span><span class="ident" id="2444080">Pointer</span><span class="op" id="2444087">(</span><span class="op" id="2444088">&amp;</span><span class="ident" id="2444089">ioSync</span><span class="op" id="2444095">)</span><span class="op" id="2444096">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2444099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2444102">return</span>&nbsp;<span class="ident" id="2444109">sendfile</span><span class="op" id="2444117">(</span><span class="ident" id="2444118">outfd</span><span class="op" id="2444123">,</span>&nbsp;<span class="ident" id="2444125">infd</span><span class="op" id="2444129">,</span>&nbsp;<span class="ident" id="2444131">offset</span><span class="op" id="2444137">,</span>&nbsp;<span class="ident" id="2444139">count</span><span class="op" id="2444144">)</span><br>
<span class="lineno"></span><span class="op" id="2444146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2444149">var</span>&nbsp;<span class="ident" id="2444153">ioSync</span>&nbsp;<span class="ident" id="2444160">int64</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
