<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8184403">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8184458">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8184512">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8184563">package</span>&nbsp;<span class="ident" id="8184571">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184577">import</span>&nbsp;<span class="op" id="8184584">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8184587">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8184596">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8184604">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8184615">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8184626">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="8184636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8184639">type</span>&nbsp;<span class="ident" id="8184644">Optionals</span>&nbsp;<span class="keyword" id="8184654">struct</span>&nbsp;<span class="op" id="8184661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184664">Sr</span>&nbsp;<span class="builtintype" id="8184667">string</span>&nbsp;<span class="string" id="8184674">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184687">So</span>&nbsp;<span class="builtintype" id="8184690">string</span>&nbsp;<span class="string" id="8184697">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184720">Sw</span>&nbsp;<span class="builtintype" id="8184723">string</span>&nbsp;<span class="string" id="8184730">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184743">Ir</span>&nbsp;<span class="builtintype" id="8184746">int</span>&nbsp;<span class="string" id="8184750">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="8184769">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184813">Io</span>&nbsp;<span class="builtintype" id="8184816">int</span>&nbsp;<span class="string" id="8184820">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184844">Slr</span>&nbsp;<span class="op" id="8184848">[</span><span class="op" id="8184849">]</span><span class="builtintype" id="8184850">string</span>&nbsp;<span class="string" id="8184857">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184878">Slo</span>&nbsp;<span class="op" id="8184882">[</span><span class="op" id="8184883">]</span><span class="builtintype" id="8184884">string</span>&nbsp;<span class="string" id="8184891">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184916">Mr</span>&nbsp;<span class="keyword" id="8184919">map</span><span class="op" id="8184922">[</span><span class="builtintype" id="8184923">string</span><span class="op" id="8184929">]</span><span class="keyword" id="8184930">interface</span><span class="op" id="8184939">{</span><span class="op" id="8184940">}</span>&nbsp;<span class="string" id="8184942">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184955">Mo</span>&nbsp;<span class="keyword" id="8184958">map</span><span class="op" id="8184961">[</span><span class="builtintype" id="8184962">string</span><span class="op" id="8184968">]</span><span class="keyword" id="8184969">interface</span><span class="op" id="8184978">{</span><span class="op" id="8184979">}</span>&nbsp;<span class="string" id="8184981">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185003">Fr</span>&nbsp;<span class="builtintype" id="8185006">float64</span>&nbsp;<span class="string" id="8185014">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185027">Fo</span>&nbsp;<span class="builtintype" id="8185030">float64</span>&nbsp;<span class="string" id="8185038">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185062">Br</span>&nbsp;<span class="builtintype" id="8185065">bool</span>&nbsp;<span class="string" id="8185070">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185083">Bo</span>&nbsp;<span class="builtintype" id="8185086">bool</span>&nbsp;<span class="string" id="8185091">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185115">Ur</span>&nbsp;<span class="builtintype" id="8185118">uint</span>&nbsp;<span class="string" id="8185123">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185136">Uo</span>&nbsp;<span class="builtintype" id="8185139">uint</span>&nbsp;<span class="string" id="8185144">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185168">Str</span>&nbsp;<span class="keyword" id="8185172">struct</span><span class="op" id="8185178">{</span><span class="op" id="8185179">}</span>&nbsp;<span class="string" id="8185181">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185195">Sto</span>&nbsp;<span class="keyword" id="8185199">struct</span><span class="op" id="8185205">{</span><span class="op" id="8185206">}</span>&nbsp;<span class="string" id="8185208">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="8185231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185234">var</span>&nbsp;<span class="ident" id="8185238">optionalsExpected</span>&nbsp;<span class="op" id="8185256">=</span>&nbsp;<span class="string" id="8185258">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185375">func</span>&nbsp;<span class="ident" id="8185380">TestOmitEmpty</span><span class="op" id="8185393">(</span><span class="ident" id="8185394">t</span>&nbsp;<span class="op" id="8185396">*</span><span class="ident" id="8185397">testing</span><span class="op" id="8185404">.</span><span class="ident" id="8185405">T</span><span class="op" id="8185406">)</span>&nbsp;<span class="op" id="8185408">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185411">var</span>&nbsp;<span class="ident" id="8185415">o</span>&nbsp;<span class="ident" id="8185417">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185428">o</span><span class="op" id="8185429">.</span><span class="ident" id="8185430">Sw</span>&nbsp;<span class="op" id="8185433">=</span>&nbsp;<span class="string" id="8185435">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185448">o</span><span class="op" id="8185449">.</span><span class="ident" id="8185450">Mr</span>&nbsp;<span class="op" id="8185453">=</span>&nbsp;<span class="keyword" id="8185455">map</span><span class="op" id="8185458">[</span><span class="builtintype" id="8185459">string</span><span class="op" id="8185465">]</span><span class="keyword" id="8185466">interface</span><span class="op" id="8185475">{</span><span class="op" id="8185476">}</span><span class="op" id="8185477">{</span><span class="op" id="8185478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185481">o</span><span class="op" id="8185482">.</span><span class="ident" id="8185483">Mo</span>&nbsp;<span class="op" id="8185486">=</span>&nbsp;<span class="keyword" id="8185488">map</span><span class="op" id="8185491">[</span><span class="builtintype" id="8185492">string</span><span class="op" id="8185498">]</span><span class="keyword" id="8185499">interface</span><span class="op" id="8185508">{</span><span class="op" id="8185509">}</span><span class="op" id="8185510">{</span><span class="op" id="8185511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185515">got</span><span class="op" id="8185518">,</span>&nbsp;<span class="ident" id="8185520">err</span>&nbsp;<span class="op" id="8185524">:=</span>&nbsp;<span class="ident" id="8185527">MarshalIndent</span><span class="op" id="8185540">(</span><span class="op" id="8185541">&amp;</span><span class="ident" id="8185542">o</span><span class="op" id="8185543">,</span>&nbsp;<span class="string" id="8185545">&#34;&#34;</span><span class="op" id="8185547">,</span>&nbsp;<span class="string" id="8185549">&#34;&nbsp;&#34;</span><span class="op" id="8185552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185555">if</span>&nbsp;<span class="ident" id="8185558">err</span>&nbsp;<span class="op" id="8185562">!=</span>&nbsp;<span class="ident" id="8185565">nil</span>&nbsp;<span class="op" id="8185569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185573">t</span><span class="op" id="8185574">.</span><span class="ident" id="8185575">Fatal</span><span class="op" id="8185580">(</span><span class="ident" id="8185581">err</span><span class="op" id="8185584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185590">if</span>&nbsp;<span class="ident" id="8185593">got</span>&nbsp;<span class="op" id="8185597">:=</span>&nbsp;<span class="builtintype" id="8185600">string</span><span class="op" id="8185606">(</span><span class="ident" id="8185607">got</span><span class="op" id="8185610">)</span><span class="op" id="8185611">;</span>&nbsp;<span class="ident" id="8185613">got</span>&nbsp;<span class="op" id="8185617">!=</span>&nbsp;<span class="ident" id="8185620">optionalsExpected</span>&nbsp;<span class="op" id="8185638">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185642">t</span><span class="op" id="8185643">.</span><span class="ident" id="8185644">Errorf</span><span class="op" id="8185650">(</span><span class="string" id="8185651">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8185673">,</span>&nbsp;<span class="ident" id="8185675">got</span><span class="op" id="8185678">,</span>&nbsp;<span class="ident" id="8185680">optionalsExpected</span><span class="op" id="8185697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185700">}</span><br>
<span class="lineno"></span><span class="op" id="8185702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185705">type</span>&nbsp;<span class="ident" id="8185710">StringTag</span>&nbsp;<span class="keyword" id="8185720">struct</span>&nbsp;<span class="op" id="8185727">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185730">BoolStr</span>&nbsp;<span class="builtintype" id="8185738">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8185745">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185763">IntStr</span>&nbsp;&nbsp;<span class="ident" id="8185771">int64</span>&nbsp;&nbsp;<span class="string" id="8185778">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185796">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="8185804">string</span>&nbsp;<span class="string" id="8185811">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8185828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8185831">var</span>&nbsp;<span class="ident" id="8185835">stringTagExpected</span>&nbsp;<span class="op" id="8185853">=</span>&nbsp;<span class="string" id="8185855">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8185922">func</span>&nbsp;<span class="ident" id="8185927">TestStringTag</span><span class="op" id="8185940">(</span><span class="ident" id="8185941">t</span>&nbsp;<span class="op" id="8185943">*</span><span class="ident" id="8185944">testing</span><span class="op" id="8185951">.</span><span class="ident" id="8185952">T</span><span class="op" id="8185953">)</span>&nbsp;<span class="op" id="8185955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185958">var</span>&nbsp;<span class="ident" id="8185962">s</span>&nbsp;<span class="ident" id="8185964">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185975">s</span><span class="op" id="8185976">.</span><span class="ident" id="8185977">BoolStr</span>&nbsp;<span class="op" id="8185985">=</span>&nbsp;<span class="builtintype" id="8185987">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185993">s</span><span class="op" id="8185994">.</span><span class="ident" id="8185995">IntStr</span>&nbsp;<span class="op" id="8186002">=</span>&nbsp;<span class="num" id="8186004">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186008">s</span><span class="op" id="8186009">.</span><span class="ident" id="8186010">StrStr</span>&nbsp;<span class="op" id="8186017">=</span>&nbsp;<span class="string" id="8186019">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186028">got</span><span class="op" id="8186031">,</span>&nbsp;<span class="ident" id="8186033">err</span>&nbsp;<span class="op" id="8186037">:=</span>&nbsp;<span class="ident" id="8186040">MarshalIndent</span><span class="op" id="8186053">(</span><span class="op" id="8186054">&amp;</span><span class="ident" id="8186055">s</span><span class="op" id="8186056">,</span>&nbsp;<span class="string" id="8186058">&#34;&#34;</span><span class="op" id="8186060">,</span>&nbsp;<span class="string" id="8186062">&#34;&nbsp;&#34;</span><span class="op" id="8186065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186068">if</span>&nbsp;<span class="ident" id="8186071">err</span>&nbsp;<span class="op" id="8186075">!=</span>&nbsp;<span class="ident" id="8186078">nil</span>&nbsp;<span class="op" id="8186082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186086">t</span><span class="op" id="8186087">.</span><span class="ident" id="8186088">Fatal</span><span class="op" id="8186093">(</span><span class="ident" id="8186094">err</span><span class="op" id="8186097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186100">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186103">if</span>&nbsp;<span class="ident" id="8186106">got</span>&nbsp;<span class="op" id="8186110">:=</span>&nbsp;<span class="builtintype" id="8186113">string</span><span class="op" id="8186119">(</span><span class="ident" id="8186120">got</span><span class="op" id="8186123">)</span><span class="op" id="8186124">;</span>&nbsp;<span class="ident" id="8186126">got</span>&nbsp;<span class="op" id="8186130">!=</span>&nbsp;<span class="ident" id="8186133">stringTagExpected</span>&nbsp;<span class="op" id="8186151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186155">t</span><span class="op" id="8186156">.</span><span class="ident" id="8186157">Fatalf</span><span class="op" id="8186163">(</span><span class="string" id="8186164">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8186186">,</span>&nbsp;<span class="ident" id="8186188">got</span><span class="op" id="8186191">,</span>&nbsp;<span class="ident" id="8186193">stringTagExpected</span><span class="op" id="8186210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186217">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186249">var</span>&nbsp;<span class="ident" id="8186253">s2</span>&nbsp;<span class="ident" id="8186256">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186267">err</span>&nbsp;<span class="op" id="8186271">=</span>&nbsp;<span class="ident" id="8186273">NewDecoder</span><span class="op" id="8186283">(</span><span class="ident" id="8186284">bytes</span><span class="op" id="8186289">.</span><span class="ident" id="8186290">NewReader</span><span class="op" id="8186299">(</span><span class="ident" id="8186300">got</span><span class="op" id="8186303">)</span><span class="op" id="8186304">)</span><span class="op" id="8186305">.</span><span class="ident" id="8186306">Decode</span><span class="op" id="8186312">(</span><span class="op" id="8186313">&amp;</span><span class="ident" id="8186314">s2</span><span class="op" id="8186316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186319">if</span>&nbsp;<span class="ident" id="8186322">err</span>&nbsp;<span class="op" id="8186326">!=</span>&nbsp;<span class="ident" id="8186329">nil</span>&nbsp;<span class="op" id="8186333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186337">t</span><span class="op" id="8186338">.</span><span class="ident" id="8186339">Fatalf</span><span class="op" id="8186345">(</span><span class="string" id="8186346">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8186358">,</span>&nbsp;<span class="ident" id="8186360">err</span><span class="op" id="8186363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186366">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186369">if</span>&nbsp;<span class="op" id="8186372">!</span><span class="ident" id="8186373">reflect</span><span class="op" id="8186380">.</span><span class="ident" id="8186381">DeepEqual</span><span class="op" id="8186390">(</span><span class="ident" id="8186391">s</span><span class="op" id="8186392">,</span>&nbsp;<span class="ident" id="8186394">s2</span><span class="op" id="8186396">)</span>&nbsp;<span class="op" id="8186398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186402">t</span><span class="op" id="8186403">.</span><span class="ident" id="8186404">Fatalf</span><span class="op" id="8186410">(</span><span class="string" id="8186411">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="8186476">,</span>&nbsp;<span class="ident" id="8186478">s</span><span class="op" id="8186479">,</span>&nbsp;<span class="builtintype" id="8186481">string</span><span class="op" id="8186487">(</span><span class="ident" id="8186488">got</span><span class="op" id="8186491">)</span><span class="op" id="8186492">,</span>&nbsp;<span class="ident" id="8186494">s2</span><span class="op" id="8186496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186499">}</span><br>
<span class="lineno"></span><span class="op" id="8186501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="8186504">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="8186562">type</span>&nbsp;<span class="ident" id="8186567">renamedByte</span>&nbsp;<span class="builtintype" id="8186579">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8186584">type</span>&nbsp;<span class="ident" id="8186589">renamedByteSlice</span>&nbsp;<span class="op" id="8186606">[</span><span class="op" id="8186607">]</span><span class="builtintype" id="8186608">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8186613">type</span>&nbsp;<span class="ident" id="8186618">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="8186642">[</span><span class="op" id="8186643">]</span><span class="ident" id="8186644">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8186657">func</span>&nbsp;<span class="ident" id="8186662">TestEncodeRenamedByteSlice</span><span class="op" id="8186688">(</span><span class="ident" id="8186689">t</span>&nbsp;<span class="op" id="8186691">*</span><span class="ident" id="8186692">testing</span><span class="op" id="8186699">.</span><span class="ident" id="8186700">T</span><span class="op" id="8186701">)</span>&nbsp;<span class="op" id="8186703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186706">s</span>&nbsp;<span class="op" id="8186708">:=</span>&nbsp;<span class="ident" id="8186711">renamedByteSlice</span><span class="op" id="8186727">(</span><span class="string" id="8186728">&#34;abc&#34;</span><span class="op" id="8186733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186736">result</span><span class="op" id="8186742">,</span>&nbsp;<span class="ident" id="8186744">err</span>&nbsp;<span class="op" id="8186748">:=</span>&nbsp;<span class="ident" id="8186751">Marshal</span><span class="op" id="8186758">(</span><span class="ident" id="8186759">s</span><span class="op" id="8186760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186763">if</span>&nbsp;<span class="ident" id="8186766">err</span>&nbsp;<span class="op" id="8186770">!=</span>&nbsp;<span class="ident" id="8186773">nil</span>&nbsp;<span class="op" id="8186777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186781">t</span><span class="op" id="8186782">.</span><span class="ident" id="8186783">Fatal</span><span class="op" id="8186788">(</span><span class="ident" id="8186789">err</span><span class="op" id="8186792">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186798">expect</span>&nbsp;<span class="op" id="8186805">:=</span>&nbsp;<span class="string" id="8186808">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186818">if</span>&nbsp;<span class="builtintype" id="8186821">string</span><span class="op" id="8186827">(</span><span class="ident" id="8186828">result</span><span class="op" id="8186834">)</span>&nbsp;<span class="op" id="8186836">!=</span>&nbsp;<span class="ident" id="8186839">expect</span>&nbsp;<span class="op" id="8186846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186850">t</span><span class="op" id="8186851">.</span><span class="ident" id="8186852">Errorf</span><span class="op" id="8186858">(</span><span class="string" id="8186859">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8186876">,</span>&nbsp;<span class="ident" id="8186878">result</span><span class="op" id="8186884">,</span>&nbsp;<span class="ident" id="8186886">expect</span><span class="op" id="8186892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186895">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186898">r</span>&nbsp;<span class="op" id="8186900">:=</span>&nbsp;<span class="ident" id="8186903">renamedRenamedByteSlice</span><span class="op" id="8186926">(</span><span class="string" id="8186927">&#34;abc&#34;</span><span class="op" id="8186932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186935">result</span><span class="op" id="8186941">,</span>&nbsp;<span class="ident" id="8186943">err</span>&nbsp;<span class="op" id="8186947">=</span>&nbsp;<span class="ident" id="8186949">Marshal</span><span class="op" id="8186956">(</span><span class="ident" id="8186957">r</span><span class="op" id="8186958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186961">if</span>&nbsp;<span class="ident" id="8186964">err</span>&nbsp;<span class="op" id="8186968">!=</span>&nbsp;<span class="ident" id="8186971">nil</span>&nbsp;<span class="op" id="8186975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186979">t</span><span class="op" id="8186980">.</span><span class="ident" id="8186981">Fatal</span><span class="op" id="8186986">(</span><span class="ident" id="8186987">err</span><span class="op" id="8186990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186993">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186996">if</span>&nbsp;<span class="builtintype" id="8186999">string</span><span class="op" id="8187005">(</span><span class="ident" id="8187006">result</span><span class="op" id="8187012">)</span>&nbsp;<span class="op" id="8187014">!=</span>&nbsp;<span class="ident" id="8187017">expect</span>&nbsp;<span class="op" id="8187024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187028">t</span><span class="op" id="8187029">.</span><span class="ident" id="8187030">Errorf</span><span class="op" id="8187036">(</span><span class="string" id="8187037">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8187054">,</span>&nbsp;<span class="ident" id="8187056">result</span><span class="op" id="8187062">,</span>&nbsp;<span class="ident" id="8187064">expect</span><span class="op" id="8187070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187073">}</span><br>
<span class="lineno"></span><span class="op" id="8187075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8187078">var</span>&nbsp;<span class="ident" id="8187082">unsupportedValues</span>&nbsp;<span class="op" id="8187100">=</span>&nbsp;<span class="op" id="8187102">[</span><span class="op" id="8187103">]</span><span class="keyword" id="8187104">interface</span><span class="op" id="8187113">{</span><span class="op" id="8187114">}</span><span class="op" id="8187115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187118">math</span><span class="op" id="8187122">.</span><span class="ident" id="8187123">NaN</span><span class="op" id="8187126">(</span><span class="op" id="8187127">)</span><span class="op" id="8187128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187131">math</span><span class="op" id="8187135">.</span><span class="ident" id="8187136">Inf</span><span class="op" id="8187139">(</span><span class="op" id="8187140">-</span><span class="num" id="8187141">1</span><span class="op" id="8187142">)</span><span class="op" id="8187143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187146">math</span><span class="op" id="8187150">.</span><span class="ident" id="8187151">Inf</span><span class="op" id="8187154">(</span><span class="num" id="8187155">1</span><span class="op" id="8187156">)</span><span class="op" id="8187157">,</span><br>
<span class="lineno"></span><span class="op" id="8187159">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8187162">func</span>&nbsp;<span class="ident" id="8187167">TestUnsupportedValues</span><span class="op" id="8187188">(</span><span class="ident" id="8187189">t</span>&nbsp;<span class="op" id="8187191">*</span><span class="ident" id="8187192">testing</span><span class="op" id="8187199">.</span><span class="ident" id="8187200">T</span><span class="op" id="8187201">)</span>&nbsp;<span class="op" id="8187203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187206">for</span>&nbsp;<span class="ident" id="8187210">_</span><span class="op" id="8187211">,</span>&nbsp;<span class="ident" id="8187213">v</span>&nbsp;<span class="op" id="8187215">:=</span>&nbsp;<span class="keyword" id="8187218">range</span>&nbsp;<span class="ident" id="8187224">unsupportedValues</span>&nbsp;<span class="op" id="8187242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187246">if</span>&nbsp;<span class="ident" id="8187249">_</span><span class="op" id="8187250">,</span>&nbsp;<span class="ident" id="8187252">err</span>&nbsp;<span class="op" id="8187256">:=</span>&nbsp;<span class="ident" id="8187259">Marshal</span><span class="op" id="8187266">(</span><span class="ident" id="8187267">v</span><span class="op" id="8187268">)</span><span class="op" id="8187269">;</span>&nbsp;<span class="ident" id="8187271">err</span>&nbsp;<span class="op" id="8187275">!=</span>&nbsp;<span class="ident" id="8187278">nil</span>&nbsp;<span class="op" id="8187282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187287">if</span>&nbsp;<span class="ident" id="8187290">_</span><span class="op" id="8187291">,</span>&nbsp;<span class="ident" id="8187293">ok</span>&nbsp;<span class="op" id="8187296">:=</span>&nbsp;<span class="ident" id="8187299">err</span><span class="op" id="8187302">.</span><span class="op" id="8187303">(</span><span class="op" id="8187304">*</span><span class="ident" id="8187305">UnsupportedValueError</span><span class="op" id="8187326">)</span><span class="op" id="8187327">;</span>&nbsp;<span class="op" id="8187329">!</span><span class="ident" id="8187330">ok</span>&nbsp;<span class="op" id="8187333">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187339">t</span><span class="op" id="8187340">.</span><span class="ident" id="8187341">Errorf</span><span class="op" id="8187347">(</span><span class="string" id="8187348">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="8187391">,</span>&nbsp;<span class="ident" id="8187393">v</span><span class="op" id="8187394">,</span>&nbsp;<span class="ident" id="8187396">err</span><span class="op" id="8187399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187408">}</span>&nbsp;<span class="keyword" id="8187410">else</span>&nbsp;<span class="op" id="8187415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187420">t</span><span class="op" id="8187421">.</span><span class="ident" id="8187422">Errorf</span><span class="op" id="8187428">(</span><span class="string" id="8187429">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8187453">,</span>&nbsp;<span class="ident" id="8187455">v</span><span class="op" id="8187456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187460">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187463">}</span><br>
<span class="lineno"></span><span class="op" id="8187465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8187468">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8187536">type</span>&nbsp;<span class="ident" id="8187541">Ref</span>&nbsp;<span class="builtintype" id="8187545">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8187550">func</span>&nbsp;<span class="op" id="8187555">(</span><span class="op" id="8187556">*</span><span class="ident" id="8187557">Ref</span><span class="op" id="8187560">)</span>&nbsp;<span class="ident" id="8187562">MarshalJSON</span><span class="op" id="8187573">(</span><span class="op" id="8187574">)</span>&nbsp;<span class="op" id="8187576">(</span><span class="op" id="8187577">[</span><span class="op" id="8187578">]</span><span class="builtintype" id="8187579">byte</span><span class="op" id="8187583">,</span>&nbsp;<span class="builtintype" id="8187585">error</span><span class="op" id="8187590">)</span>&nbsp;<span class="op" id="8187592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187595">return</span>&nbsp;<span class="op" id="8187602">[</span><span class="op" id="8187603">]</span><span class="builtintype" id="8187604">byte</span><span class="op" id="8187608">(</span><span class="string" id="8187609">`&#34;ref&#34;`</span><span class="op" id="8187616">)</span><span class="op" id="8187617">,</span>&nbsp;<span class="ident" id="8187619">nil</span><br>
<span class="lineno"></span><span class="op" id="8187623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="8187626">func</span>&nbsp;<span class="op" id="8187631">(</span><span class="ident" id="8187632">r</span>&nbsp;<span class="op" id="8187634">*</span><span class="ident" id="8187635">Ref</span><span class="op" id="8187638">)</span>&nbsp;<span class="ident" id="8187640">UnmarshalJSON</span><span class="op" id="8187653">(</span><span class="op" id="8187654">[</span><span class="op" id="8187655">]</span><span class="builtintype" id="8187656">byte</span><span class="op" id="8187660">)</span>&nbsp;<span class="builtintype" id="8187662">error</span>&nbsp;<span class="op" id="8187668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187671">*</span><span class="ident" id="8187672">r</span>&nbsp;<span class="op" id="8187674">=</span>&nbsp;<span class="num" id="8187676">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187680">return</span>&nbsp;<span class="ident" id="8187687">nil</span><br>
<span class="lineno"></span><span class="op" id="8187691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="8187694">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8187744">type</span>&nbsp;<span class="ident" id="8187749">Val</span>&nbsp;<span class="builtintype" id="8187753">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187758">func</span>&nbsp;<span class="op" id="8187763">(</span><span class="ident" id="8187764">Val</span><span class="op" id="8187767">)</span>&nbsp;<span class="ident" id="8187769">MarshalJSON</span><span class="op" id="8187780">(</span><span class="op" id="8187781">)</span>&nbsp;<span class="op" id="8187783">(</span><span class="op" id="8187784">[</span><span class="op" id="8187785">]</span><span class="builtintype" id="8187786">byte</span><span class="op" id="8187790">,</span>&nbsp;<span class="builtintype" id="8187792">error</span><span class="op" id="8187797">)</span>&nbsp;<span class="op" id="8187799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187802">return</span>&nbsp;<span class="op" id="8187809">[</span><span class="op" id="8187810">]</span><span class="builtintype" id="8187811">byte</span><span class="op" id="8187815">(</span><span class="string" id="8187816">`&#34;val&#34;`</span><span class="op" id="8187823">)</span><span class="op" id="8187824">,</span>&nbsp;<span class="ident" id="8187826">nil</span><br>
<span class="lineno">165</span><span class="op" id="8187830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8187833">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8187905">type</span>&nbsp;<span class="ident" id="8187910">RefText</span>&nbsp;<span class="builtintype" id="8187918">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8187923">func</span>&nbsp;<span class="op" id="8187928">(</span><span class="op" id="8187929">*</span><span class="ident" id="8187930">RefText</span><span class="op" id="8187937">)</span>&nbsp;<span class="ident" id="8187939">MarshalText</span><span class="op" id="8187950">(</span><span class="op" id="8187951">)</span>&nbsp;<span class="op" id="8187953">(</span><span class="op" id="8187954">[</span><span class="op" id="8187955">]</span><span class="builtintype" id="8187956">byte</span><span class="op" id="8187960">,</span>&nbsp;<span class="builtintype" id="8187962">error</span><span class="op" id="8187967">)</span>&nbsp;<span class="op" id="8187969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187972">return</span>&nbsp;<span class="op" id="8187979">[</span><span class="op" id="8187980">]</span><span class="builtintype" id="8187981">byte</span><span class="op" id="8187985">(</span><span class="string" id="8187986">`&#34;ref&#34;`</span><span class="op" id="8187993">)</span><span class="op" id="8187994">,</span>&nbsp;<span class="ident" id="8187996">nil</span><br>
<span class="lineno"></span><span class="op" id="8188000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188003">func</span>&nbsp;<span class="op" id="8188008">(</span><span class="ident" id="8188009">r</span>&nbsp;<span class="op" id="8188011">*</span><span class="ident" id="8188012">RefText</span><span class="op" id="8188019">)</span>&nbsp;<span class="ident" id="8188021">UnmarshalText</span><span class="op" id="8188034">(</span><span class="op" id="8188035">[</span><span class="op" id="8188036">]</span><span class="builtintype" id="8188037">byte</span><span class="op" id="8188041">)</span>&nbsp;<span class="builtintype" id="8188043">error</span>&nbsp;<span class="op" id="8188049">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188052">*</span><span class="ident" id="8188053">r</span>&nbsp;<span class="op" id="8188055">=</span>&nbsp;<span class="num" id="8188057">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188061">return</span>&nbsp;<span class="ident" id="8188068">nil</span><br>
<span class="lineno"></span><span class="op" id="8188072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8188075">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="8188129">type</span>&nbsp;<span class="ident" id="8188134">ValText</span>&nbsp;<span class="builtintype" id="8188142">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188147">func</span>&nbsp;<span class="op" id="8188152">(</span><span class="ident" id="8188153">ValText</span><span class="op" id="8188160">)</span>&nbsp;<span class="ident" id="8188162">MarshalText</span><span class="op" id="8188173">(</span><span class="op" id="8188174">)</span>&nbsp;<span class="op" id="8188176">(</span><span class="op" id="8188177">[</span><span class="op" id="8188178">]</span><span class="builtintype" id="8188179">byte</span><span class="op" id="8188183">,</span>&nbsp;<span class="builtintype" id="8188185">error</span><span class="op" id="8188190">)</span>&nbsp;<span class="op" id="8188192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188195">return</span>&nbsp;<span class="op" id="8188202">[</span><span class="op" id="8188203">]</span><span class="builtintype" id="8188204">byte</span><span class="op" id="8188208">(</span><span class="string" id="8188209">`&#34;val&#34;`</span><span class="op" id="8188216">)</span><span class="op" id="8188217">,</span>&nbsp;<span class="ident" id="8188219">nil</span><br>
<span class="lineno"></span><span class="op" id="8188223">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8188226">func</span>&nbsp;<span class="ident" id="8188231">TestRefValMarshal</span><span class="op" id="8188248">(</span><span class="ident" id="8188249">t</span>&nbsp;<span class="op" id="8188251">*</span><span class="ident" id="8188252">testing</span><span class="op" id="8188259">.</span><span class="ident" id="8188260">T</span><span class="op" id="8188261">)</span>&nbsp;<span class="op" id="8188263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188266">var</span>&nbsp;<span class="ident" id="8188270">s</span>&nbsp;<span class="op" id="8188272">=</span>&nbsp;<span class="keyword" id="8188274">struct</span>&nbsp;<span class="op" id="8188281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188285">R0</span>&nbsp;<span class="ident" id="8188288">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188294">R1</span>&nbsp;<span class="op" id="8188297">*</span><span class="ident" id="8188298">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188304">R2</span>&nbsp;<span class="ident" id="8188307">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188317">R3</span>&nbsp;<span class="op" id="8188320">*</span><span class="ident" id="8188321">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188331">V0</span>&nbsp;<span class="ident" id="8188334">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188340">V1</span>&nbsp;<span class="op" id="8188343">*</span><span class="ident" id="8188344">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188350">V2</span>&nbsp;<span class="ident" id="8188353">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188363">V3</span>&nbsp;<span class="op" id="8188366">*</span><span class="ident" id="8188367">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188376">}</span><span class="op" id="8188377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188381">R0</span><span class="op" id="8188383">:</span>&nbsp;<span class="num" id="8188385">12</span><span class="op" id="8188387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188391">R1</span><span class="op" id="8188393">:</span>&nbsp;<span class="builtinfunc" id="8188395">new</span><span class="op" id="8188398">(</span><span class="ident" id="8188399">Ref</span><span class="op" id="8188402">)</span><span class="op" id="8188403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188407">R2</span><span class="op" id="8188409">:</span>&nbsp;<span class="num" id="8188411">14</span><span class="op" id="8188413">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188417">R3</span><span class="op" id="8188419">:</span>&nbsp;<span class="builtinfunc" id="8188421">new</span><span class="op" id="8188424">(</span><span class="ident" id="8188425">RefText</span><span class="op" id="8188432">)</span><span class="op" id="8188433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188437">V0</span><span class="op" id="8188439">:</span>&nbsp;<span class="num" id="8188441">13</span><span class="op" id="8188443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188447">V1</span><span class="op" id="8188449">:</span>&nbsp;<span class="builtinfunc" id="8188451">new</span><span class="op" id="8188454">(</span><span class="ident" id="8188455">Val</span><span class="op" id="8188458">)</span><span class="op" id="8188459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188463">V2</span><span class="op" id="8188465">:</span>&nbsp;<span class="num" id="8188467">15</span><span class="op" id="8188469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188473">V3</span><span class="op" id="8188475">:</span>&nbsp;<span class="builtinfunc" id="8188477">new</span><span class="op" id="8188480">(</span><span class="ident" id="8188481">ValText</span><span class="op" id="8188488">)</span><span class="op" id="8188489">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188495">const</span>&nbsp;<span class="ident" id="8188501">want</span>&nbsp;<span class="op" id="8188506">=</span>&nbsp;<span class="string" id="8188508">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188617">b</span><span class="op" id="8188618">,</span>&nbsp;<span class="ident" id="8188620">err</span>&nbsp;<span class="op" id="8188624">:=</span>&nbsp;<span class="ident" id="8188627">Marshal</span><span class="op" id="8188634">(</span><span class="op" id="8188635">&amp;</span><span class="ident" id="8188636">s</span><span class="op" id="8188637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188640">if</span>&nbsp;<span class="ident" id="8188643">err</span>&nbsp;<span class="op" id="8188647">!=</span>&nbsp;<span class="ident" id="8188650">nil</span>&nbsp;<span class="op" id="8188654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188658">t</span><span class="op" id="8188659">.</span><span class="ident" id="8188660">Fatalf</span><span class="op" id="8188666">(</span><span class="string" id="8188667">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8188680">,</span>&nbsp;<span class="ident" id="8188682">err</span><span class="op" id="8188685">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188691">if</span>&nbsp;<span class="ident" id="8188694">got</span>&nbsp;<span class="op" id="8188698">:=</span>&nbsp;<span class="builtintype" id="8188701">string</span><span class="op" id="8188707">(</span><span class="ident" id="8188708">b</span><span class="op" id="8188709">)</span><span class="op" id="8188710">;</span>&nbsp;<span class="ident" id="8188712">got</span>&nbsp;<span class="op" id="8188716">!=</span>&nbsp;<span class="ident" id="8188719">want</span>&nbsp;<span class="op" id="8188724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188728">t</span><span class="op" id="8188729">.</span><span class="ident" id="8188730">Errorf</span><span class="op" id="8188736">(</span><span class="string" id="8188737">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8188754">,</span>&nbsp;<span class="ident" id="8188756">got</span><span class="op" id="8188759">,</span>&nbsp;<span class="ident" id="8188761">want</span><span class="op" id="8188765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188768">}</span><br>
<span class="lineno"></span><span class="op" id="8188770">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="8188773">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="8188827">type</span>&nbsp;<span class="ident" id="8188832">C</span>&nbsp;<span class="builtintype" id="8188834">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188839">func</span>&nbsp;<span class="op" id="8188844">(</span><span class="ident" id="8188845">C</span><span class="op" id="8188846">)</span>&nbsp;<span class="ident" id="8188848">MarshalJSON</span><span class="op" id="8188859">(</span><span class="op" id="8188860">)</span>&nbsp;<span class="op" id="8188862">(</span><span class="op" id="8188863">[</span><span class="op" id="8188864">]</span><span class="builtintype" id="8188865">byte</span><span class="op" id="8188869">,</span>&nbsp;<span class="builtintype" id="8188871">error</span><span class="op" id="8188876">)</span>&nbsp;<span class="op" id="8188878">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188881">return</span>&nbsp;<span class="op" id="8188888">[</span><span class="op" id="8188889">]</span><span class="builtintype" id="8188890">byte</span><span class="op" id="8188894">(</span><span class="string" id="8188895">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8188902">)</span><span class="op" id="8188903">,</span>&nbsp;<span class="ident" id="8188905">nil</span><br>
<span class="lineno"></span><span class="op" id="8188909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8188912">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="8188970">type</span>&nbsp;<span class="ident" id="8188975">CText</span>&nbsp;<span class="builtintype" id="8188981">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="8188986">func</span>&nbsp;<span class="op" id="8188991">(</span><span class="ident" id="8188992">CText</span><span class="op" id="8188997">)</span>&nbsp;<span class="ident" id="8188999">MarshalText</span><span class="op" id="8189010">(</span><span class="op" id="8189011">)</span>&nbsp;<span class="op" id="8189013">(</span><span class="op" id="8189014">[</span><span class="op" id="8189015">]</span><span class="builtintype" id="8189016">byte</span><span class="op" id="8189020">,</span>&nbsp;<span class="builtintype" id="8189022">error</span><span class="op" id="8189027">)</span>&nbsp;<span class="op" id="8189029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189032">return</span>&nbsp;<span class="op" id="8189039">[</span><span class="op" id="8189040">]</span><span class="builtintype" id="8189041">byte</span><span class="op" id="8189045">(</span><span class="string" id="8189046">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8189053">)</span><span class="op" id="8189054">,</span>&nbsp;<span class="ident" id="8189056">nil</span><br>
<span class="lineno"></span><span class="op" id="8189060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8189063">func</span>&nbsp;<span class="ident" id="8189068">TestMarshalerEscaping</span><span class="op" id="8189089">(</span><span class="ident" id="8189090">t</span>&nbsp;<span class="op" id="8189092">*</span><span class="ident" id="8189093">testing</span><span class="op" id="8189100">.</span><span class="ident" id="8189101">T</span><span class="op" id="8189102">)</span>&nbsp;<span class="op" id="8189104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189107">var</span>&nbsp;<span class="ident" id="8189111">c</span>&nbsp;<span class="ident" id="8189113">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189116">want</span>&nbsp;<span class="op" id="8189121">:=</span>&nbsp;<span class="string" id="8189124">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189148">b</span><span class="op" id="8189149">,</span>&nbsp;<span class="ident" id="8189151">err</span>&nbsp;<span class="op" id="8189155">:=</span>&nbsp;<span class="ident" id="8189158">Marshal</span><span class="op" id="8189165">(</span><span class="ident" id="8189166">c</span><span class="op" id="8189167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189170">if</span>&nbsp;<span class="ident" id="8189173">err</span>&nbsp;<span class="op" id="8189177">!=</span>&nbsp;<span class="ident" id="8189180">nil</span>&nbsp;<span class="op" id="8189184">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189188">t</span><span class="op" id="8189189">.</span><span class="ident" id="8189190">Fatalf</span><span class="op" id="8189196">(</span><span class="string" id="8189197">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="8189213">,</span>&nbsp;<span class="ident" id="8189215">err</span><span class="op" id="8189218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189224">if</span>&nbsp;<span class="ident" id="8189227">got</span>&nbsp;<span class="op" id="8189231">:=</span>&nbsp;<span class="builtintype" id="8189234">string</span><span class="op" id="8189240">(</span><span class="ident" id="8189241">b</span><span class="op" id="8189242">)</span><span class="op" id="8189243">;</span>&nbsp;<span class="ident" id="8189245">got</span>&nbsp;<span class="op" id="8189249">!=</span>&nbsp;<span class="ident" id="8189252">want</span>&nbsp;<span class="op" id="8189257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189261">t</span><span class="op" id="8189262">.</span><span class="ident" id="8189263">Errorf</span><span class="op" id="8189269">(</span><span class="string" id="8189270">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8189298">,</span>&nbsp;<span class="ident" id="8189300">got</span><span class="op" id="8189303">,</span>&nbsp;<span class="ident" id="8189305">want</span><span class="op" id="8189309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189312">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189316">var</span>&nbsp;<span class="ident" id="8189320">ct</span>&nbsp;<span class="ident" id="8189323">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189330">want</span>&nbsp;<span class="op" id="8189335">=</span>&nbsp;<span class="string" id="8189337">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189365">b</span><span class="op" id="8189366">,</span>&nbsp;<span class="ident" id="8189368">err</span>&nbsp;<span class="op" id="8189372">=</span>&nbsp;<span class="ident" id="8189374">Marshal</span><span class="op" id="8189381">(</span><span class="ident" id="8189382">ct</span><span class="op" id="8189384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189387">if</span>&nbsp;<span class="ident" id="8189390">err</span>&nbsp;<span class="op" id="8189394">!=</span>&nbsp;<span class="ident" id="8189397">nil</span>&nbsp;<span class="op" id="8189401">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189405">t</span><span class="op" id="8189406">.</span><span class="ident" id="8189407">Fatalf</span><span class="op" id="8189413">(</span><span class="string" id="8189414">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="8189431">,</span>&nbsp;<span class="ident" id="8189433">err</span><span class="op" id="8189436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189442">if</span>&nbsp;<span class="ident" id="8189445">got</span>&nbsp;<span class="op" id="8189449">:=</span>&nbsp;<span class="builtintype" id="8189452">string</span><span class="op" id="8189458">(</span><span class="ident" id="8189459">b</span><span class="op" id="8189460">)</span><span class="op" id="8189461">;</span>&nbsp;<span class="ident" id="8189463">got</span>&nbsp;<span class="op" id="8189467">!=</span>&nbsp;<span class="ident" id="8189470">want</span>&nbsp;<span class="op" id="8189475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189479">t</span><span class="op" id="8189480">.</span><span class="ident" id="8189481">Errorf</span><span class="op" id="8189487">(</span><span class="string" id="8189488">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8189517">,</span>&nbsp;<span class="ident" id="8189519">got</span><span class="op" id="8189522">,</span>&nbsp;<span class="ident" id="8189524">want</span><span class="op" id="8189528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189531">}</span><br>
<span class="lineno">250</span><span class="op" id="8189533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189536">type</span>&nbsp;<span class="ident" id="8189541">IntType</span>&nbsp;<span class="builtintype" id="8189549">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189554">type</span>&nbsp;<span class="ident" id="8189559">MyStruct</span>&nbsp;<span class="keyword" id="8189568">struct</span>&nbsp;<span class="op" id="8189575">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189578">IntType</span><br>
<span class="lineno"></span><span class="op" id="8189586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189589">func</span>&nbsp;<span class="ident" id="8189594">TestAnonymousNonstruct</span><span class="op" id="8189616">(</span><span class="ident" id="8189617">t</span>&nbsp;<span class="op" id="8189619">*</span><span class="ident" id="8189620">testing</span><span class="op" id="8189627">.</span><span class="ident" id="8189628">T</span><span class="op" id="8189629">)</span>&nbsp;<span class="op" id="8189631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189634">var</span>&nbsp;<span class="ident" id="8189638">i</span>&nbsp;<span class="ident" id="8189640">IntType</span>&nbsp;<span class="op" id="8189648">=</span>&nbsp;<span class="num" id="8189650">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189654">a</span>&nbsp;<span class="op" id="8189656">:=</span>&nbsp;<span class="ident" id="8189659">MyStruct</span><span class="op" id="8189667">{</span><span class="ident" id="8189668">i</span><span class="op" id="8189669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189672">const</span>&nbsp;<span class="ident" id="8189678">want</span>&nbsp;<span class="op" id="8189683">=</span>&nbsp;<span class="string" id="8189685">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189704">b</span><span class="op" id="8189705">,</span>&nbsp;<span class="ident" id="8189707">err</span>&nbsp;<span class="op" id="8189711">:=</span>&nbsp;<span class="ident" id="8189714">Marshal</span><span class="op" id="8189721">(</span><span class="ident" id="8189722">a</span><span class="op" id="8189723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189726">if</span>&nbsp;<span class="ident" id="8189729">err</span>&nbsp;<span class="op" id="8189733">!=</span>&nbsp;<span class="ident" id="8189736">nil</span>&nbsp;<span class="op" id="8189740">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189744">t</span><span class="op" id="8189745">.</span><span class="ident" id="8189746">Fatalf</span><span class="op" id="8189752">(</span><span class="string" id="8189753">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8189766">,</span>&nbsp;<span class="ident" id="8189768">err</span><span class="op" id="8189771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189777">if</span>&nbsp;<span class="ident" id="8189780">got</span>&nbsp;<span class="op" id="8189784">:=</span>&nbsp;<span class="builtintype" id="8189787">string</span><span class="op" id="8189793">(</span><span class="ident" id="8189794">b</span><span class="op" id="8189795">)</span><span class="op" id="8189796">;</span>&nbsp;<span class="ident" id="8189798">got</span>&nbsp;<span class="op" id="8189802">!=</span>&nbsp;<span class="ident" id="8189805">want</span>&nbsp;<span class="op" id="8189810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189814">t</span><span class="op" id="8189815">.</span><span class="ident" id="8189816">Errorf</span><span class="op" id="8189822">(</span><span class="string" id="8189823">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8189840">,</span>&nbsp;<span class="ident" id="8189842">got</span><span class="op" id="8189845">,</span>&nbsp;<span class="ident" id="8189847">want</span><span class="op" id="8189851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189854">}</span><br>
<span class="lineno">270</span><span class="op" id="8189856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189859">type</span>&nbsp;<span class="ident" id="8189864">BugA</span>&nbsp;<span class="keyword" id="8189869">struct</span>&nbsp;<span class="op" id="8189876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189879">S</span>&nbsp;<span class="builtintype" id="8189881">string</span><br>
<span class="lineno"></span><span class="op" id="8189888">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="8189891">type</span>&nbsp;<span class="ident" id="8189896">BugB</span>&nbsp;<span class="keyword" id="8189901">struct</span>&nbsp;<span class="op" id="8189908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189911">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189917">S</span>&nbsp;<span class="builtintype" id="8189919">string</span><br>
<span class="lineno"></span><span class="op" id="8189926">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8189929">type</span>&nbsp;<span class="ident" id="8189934">BugC</span>&nbsp;<span class="keyword" id="8189939">struct</span>&nbsp;<span class="op" id="8189946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189949">S</span>&nbsp;<span class="builtintype" id="8189951">string</span><br>
<span class="lineno"></span><span class="op" id="8189958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="8189961">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="8190020">type</span>&nbsp;<span class="ident" id="8190025">BugX</span>&nbsp;<span class="keyword" id="8190030">struct</span>&nbsp;<span class="op" id="8190037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190040">A</span>&nbsp;<span class="builtintype" id="8190042">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190047">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190053">BugB</span><br>
<span class="lineno">290</span><span class="op" id="8190058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8190061">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="8190076">func</span>&nbsp;<span class="ident" id="8190081">TestEmbeddedBug</span><span class="op" id="8190096">(</span><span class="ident" id="8190097">t</span>&nbsp;<span class="op" id="8190099">*</span><span class="ident" id="8190100">testing</span><span class="op" id="8190107">.</span><span class="ident" id="8190108">T</span><span class="op" id="8190109">)</span>&nbsp;<span class="op" id="8190111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190114">v</span>&nbsp;<span class="op" id="8190116">:=</span>&nbsp;<span class="ident" id="8190119">BugB</span><span class="op" id="8190123">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190127">BugA</span><span class="op" id="8190131">{</span><span class="string" id="8190132">&#34;A&#34;</span><span class="op" id="8190135">}</span><span class="op" id="8190136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8190140">&#34;B&#34;</span><span class="op" id="8190143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190149">b</span><span class="op" id="8190150">,</span>&nbsp;<span class="ident" id="8190152">err</span>&nbsp;<span class="op" id="8190156">:=</span>&nbsp;<span class="ident" id="8190159">Marshal</span><span class="op" id="8190166">(</span><span class="ident" id="8190167">v</span><span class="op" id="8190168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190171">if</span>&nbsp;<span class="ident" id="8190174">err</span>&nbsp;<span class="op" id="8190178">!=</span>&nbsp;<span class="ident" id="8190181">nil</span>&nbsp;<span class="op" id="8190185">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190189">t</span><span class="op" id="8190190">.</span><span class="ident" id="8190191">Fatal</span><span class="op" id="8190196">(</span><span class="string" id="8190197">&#34;Marshal:&#34;</span><span class="op" id="8190207">,</span>&nbsp;<span class="ident" id="8190209">err</span><span class="op" id="8190212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190218">want</span>&nbsp;<span class="op" id="8190223">:=</span>&nbsp;<span class="string" id="8190226">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190239">got</span>&nbsp;<span class="op" id="8190243">:=</span>&nbsp;<span class="builtintype" id="8190246">string</span><span class="op" id="8190252">(</span><span class="ident" id="8190253">b</span><span class="op" id="8190254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190257">if</span>&nbsp;<span class="ident" id="8190260">got</span>&nbsp;<span class="op" id="8190264">!=</span>&nbsp;<span class="ident" id="8190267">want</span>&nbsp;<span class="op" id="8190272">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190276">t</span><span class="op" id="8190277">.</span><span class="ident" id="8190278">Fatalf</span><span class="op" id="8190284">(</span><span class="string" id="8190285">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8190310">,</span>&nbsp;<span class="ident" id="8190312">got</span><span class="op" id="8190315">,</span>&nbsp;<span class="ident" id="8190317">want</span><span class="op" id="8190321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8190327">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190387">x</span>&nbsp;<span class="op" id="8190389">:=</span>&nbsp;<span class="ident" id="8190392">BugX</span><span class="op" id="8190396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190400">A</span><span class="op" id="8190401">:</span>&nbsp;<span class="num" id="8190403">23</span><span class="op" id="8190405">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190411">b</span><span class="op" id="8190412">,</span>&nbsp;<span class="ident" id="8190414">err</span>&nbsp;<span class="op" id="8190418">=</span>&nbsp;<span class="ident" id="8190420">Marshal</span><span class="op" id="8190427">(</span><span class="ident" id="8190428">x</span><span class="op" id="8190429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190432">if</span>&nbsp;<span class="ident" id="8190435">err</span>&nbsp;<span class="op" id="8190439">!=</span>&nbsp;<span class="ident" id="8190442">nil</span>&nbsp;<span class="op" id="8190446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190450">t</span><span class="op" id="8190451">.</span><span class="ident" id="8190452">Fatal</span><span class="op" id="8190457">(</span><span class="string" id="8190458">&#34;Marshal:&#34;</span><span class="op" id="8190468">,</span>&nbsp;<span class="ident" id="8190470">err</span><span class="op" id="8190473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190476">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190479">want</span>&nbsp;<span class="op" id="8190484">=</span>&nbsp;<span class="string" id="8190486">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190498">got</span>&nbsp;<span class="op" id="8190502">=</span>&nbsp;<span class="builtintype" id="8190504">string</span><span class="op" id="8190510">(</span><span class="ident" id="8190511">b</span><span class="op" id="8190512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190515">if</span>&nbsp;<span class="ident" id="8190518">got</span>&nbsp;<span class="op" id="8190522">!=</span>&nbsp;<span class="ident" id="8190525">want</span>&nbsp;<span class="op" id="8190530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190534">t</span><span class="op" id="8190535">.</span><span class="ident" id="8190536">Fatalf</span><span class="op" id="8190542">(</span><span class="string" id="8190543">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8190568">,</span>&nbsp;<span class="ident" id="8190570">got</span><span class="op" id="8190573">,</span>&nbsp;<span class="ident" id="8190575">want</span><span class="op" id="8190579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190582">}</span><br>
<span class="lineno">320</span><span class="op" id="8190584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8190587">type</span>&nbsp;<span class="ident" id="8190592">BugD</span>&nbsp;<span class="keyword" id="8190597">struct</span>&nbsp;<span class="op" id="8190604">{</span>&nbsp;<span class="comment" id="8190606">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190638">XXX</span>&nbsp;<span class="builtintype" id="8190642">string</span>&nbsp;<span class="string" id="8190649">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8190660">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="8190663">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="8190712">type</span>&nbsp;<span class="ident" id="8190717">BugY</span>&nbsp;<span class="keyword" id="8190722">struct</span>&nbsp;<span class="op" id="8190729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190732">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190738">BugD</span><br>
<span class="lineno">330</span><span class="op" id="8190743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8190746">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="8190805">func</span>&nbsp;<span class="ident" id="8190810">TestTaggedFieldDominates</span><span class="op" id="8190834">(</span><span class="ident" id="8190835">t</span>&nbsp;<span class="op" id="8190837">*</span><span class="ident" id="8190838">testing</span><span class="op" id="8190845">.</span><span class="ident" id="8190846">T</span><span class="op" id="8190847">)</span>&nbsp;<span class="op" id="8190849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190852">v</span>&nbsp;<span class="op" id="8190854">:=</span>&nbsp;<span class="ident" id="8190857">BugY</span><span class="op" id="8190861">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190865">BugA</span><span class="op" id="8190869">{</span><span class="string" id="8190870">&#34;BugA&#34;</span><span class="op" id="8190876">}</span><span class="op" id="8190877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190881">BugD</span><span class="op" id="8190885">{</span><span class="string" id="8190886">&#34;BugD&#34;</span><span class="op" id="8190892">}</span><span class="op" id="8190893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190899">b</span><span class="op" id="8190900">,</span>&nbsp;<span class="ident" id="8190902">err</span>&nbsp;<span class="op" id="8190906">:=</span>&nbsp;<span class="ident" id="8190909">Marshal</span><span class="op" id="8190916">(</span><span class="ident" id="8190917">v</span><span class="op" id="8190918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190921">if</span>&nbsp;<span class="ident" id="8190924">err</span>&nbsp;<span class="op" id="8190928">!=</span>&nbsp;<span class="ident" id="8190931">nil</span>&nbsp;<span class="op" id="8190935">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190939">t</span><span class="op" id="8190940">.</span><span class="ident" id="8190941">Fatal</span><span class="op" id="8190946">(</span><span class="string" id="8190947">&#34;Marshal:&#34;</span><span class="op" id="8190957">,</span>&nbsp;<span class="ident" id="8190959">err</span><span class="op" id="8190962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190968">want</span>&nbsp;<span class="op" id="8190973">:=</span>&nbsp;<span class="string" id="8190976">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190992">got</span>&nbsp;<span class="op" id="8190996">:=</span>&nbsp;<span class="builtintype" id="8190999">string</span><span class="op" id="8191005">(</span><span class="ident" id="8191006">b</span><span class="op" id="8191007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191010">if</span>&nbsp;<span class="ident" id="8191013">got</span>&nbsp;<span class="op" id="8191017">!=</span>&nbsp;<span class="ident" id="8191020">want</span>&nbsp;<span class="op" id="8191025">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191029">t</span><span class="op" id="8191030">.</span><span class="ident" id="8191031">Fatalf</span><span class="op" id="8191037">(</span><span class="string" id="8191038">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8191063">,</span>&nbsp;<span class="ident" id="8191065">got</span><span class="op" id="8191068">,</span>&nbsp;<span class="ident" id="8191070">want</span><span class="op" id="8191074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191077">}</span><br>
<span class="lineno"></span><span class="op" id="8191079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8191082">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="8191133">type</span>&nbsp;<span class="ident" id="8191138">BugZ</span>&nbsp;<span class="keyword" id="8191143">struct</span>&nbsp;<span class="op" id="8191150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191153">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191159">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191165">BugY</span>&nbsp;<span class="comment" id="8191170">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="8191234">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8191237">func</span>&nbsp;<span class="ident" id="8191242">TestDuplicatedFieldDisappears</span><span class="op" id="8191271">(</span><span class="ident" id="8191272">t</span>&nbsp;<span class="op" id="8191274">*</span><span class="ident" id="8191275">testing</span><span class="op" id="8191282">.</span><span class="ident" id="8191283">T</span><span class="op" id="8191284">)</span>&nbsp;<span class="op" id="8191286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191289">v</span>&nbsp;<span class="op" id="8191291">:=</span>&nbsp;<span class="ident" id="8191294">BugZ</span><span class="op" id="8191298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191302">BugA</span><span class="op" id="8191306">{</span><span class="string" id="8191307">&#34;BugA&#34;</span><span class="op" id="8191313">}</span><span class="op" id="8191314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191318">BugC</span><span class="op" id="8191322">{</span><span class="string" id="8191323">&#34;BugC&#34;</span><span class="op" id="8191329">}</span><span class="op" id="8191330">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191334">BugY</span><span class="op" id="8191338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191343">BugA</span><span class="op" id="8191347">{</span><span class="string" id="8191348">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="8191361">}</span><span class="op" id="8191362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191367">BugD</span><span class="op" id="8191371">{</span><span class="string" id="8191372">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="8191385">}</span><span class="op" id="8191386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191390">}</span><span class="op" id="8191391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191394">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191397">b</span><span class="op" id="8191398">,</span>&nbsp;<span class="ident" id="8191400">err</span>&nbsp;<span class="op" id="8191404">:=</span>&nbsp;<span class="ident" id="8191407">Marshal</span><span class="op" id="8191414">(</span><span class="ident" id="8191415">v</span><span class="op" id="8191416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191419">if</span>&nbsp;<span class="ident" id="8191422">err</span>&nbsp;<span class="op" id="8191426">!=</span>&nbsp;<span class="ident" id="8191429">nil</span>&nbsp;<span class="op" id="8191433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191437">t</span><span class="op" id="8191438">.</span><span class="ident" id="8191439">Fatal</span><span class="op" id="8191444">(</span><span class="string" id="8191445">&#34;Marshal:&#34;</span><span class="op" id="8191455">,</span>&nbsp;<span class="ident" id="8191457">err</span><span class="op" id="8191460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191466">want</span>&nbsp;<span class="op" id="8191471">:=</span>&nbsp;<span class="string" id="8191474">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191480">got</span>&nbsp;<span class="op" id="8191484">:=</span>&nbsp;<span class="builtintype" id="8191487">string</span><span class="op" id="8191493">(</span><span class="ident" id="8191494">b</span><span class="op" id="8191495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191498">if</span>&nbsp;<span class="ident" id="8191501">got</span>&nbsp;<span class="op" id="8191505">!=</span>&nbsp;<span class="ident" id="8191508">want</span>&nbsp;<span class="op" id="8191513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191517">t</span><span class="op" id="8191518">.</span><span class="ident" id="8191519">Fatalf</span><span class="op" id="8191525">(</span><span class="string" id="8191526">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8191551">,</span>&nbsp;<span class="ident" id="8191553">got</span><span class="op" id="8191556">,</span>&nbsp;<span class="ident" id="8191558">want</span><span class="op" id="8191562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191565">}</span><br>
<span class="lineno"></span><span class="op" id="8191567">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8191570">func</span>&nbsp;<span class="ident" id="8191575">TestStringBytes</span><span class="op" id="8191590">(</span><span class="ident" id="8191591">t</span>&nbsp;<span class="op" id="8191593">*</span><span class="ident" id="8191594">testing</span><span class="op" id="8191601">.</span><span class="ident" id="8191602">T</span><span class="op" id="8191603">)</span>&nbsp;<span class="op" id="8191605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8191608">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191692">es</span>&nbsp;<span class="op" id="8191695">:=</span>&nbsp;<span class="op" id="8191698">&amp;</span><span class="ident" id="8191699">encodeState</span><span class="op" id="8191710">{</span><span class="op" id="8191711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191714">var</span>&nbsp;<span class="ident" id="8191718">r</span>&nbsp;<span class="op" id="8191720">[</span><span class="op" id="8191721">]</span><span class="builtintype" id="8191722">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191728">for</span>&nbsp;<span class="ident" id="8191732">i</span>&nbsp;<span class="op" id="8191734">:=</span>&nbsp;<span class="string" id="8191737">&#39;\u0000&#39;</span><span class="op" id="8191745">;</span>&nbsp;<span class="ident" id="8191747">i</span>&nbsp;<span class="op" id="8191749">&lt;=</span>&nbsp;<span class="ident" id="8191752">unicode</span><span class="op" id="8191759">.</span><span class="ident" id="8191760">MaxRune</span><span class="op" id="8191767">;</span>&nbsp;<span class="ident" id="8191769">i</span><span class="op" id="8191770">++</span>&nbsp;<span class="op" id="8191773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191777">r</span>&nbsp;<span class="op" id="8191779">=</span>&nbsp;<span class="builtinfunc" id="8191781">append</span><span class="op" id="8191787">(</span><span class="ident" id="8191788">r</span><span class="op" id="8191789">,</span>&nbsp;<span class="ident" id="8191791">i</span><span class="op" id="8191792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191798">s</span>&nbsp;<span class="op" id="8191800">:=</span>&nbsp;<span class="builtintype" id="8191803">string</span><span class="op" id="8191809">(</span><span class="ident" id="8191810">r</span><span class="op" id="8191811">)</span>&nbsp;<span class="op" id="8191813">+</span>&nbsp;<span class="string" id="8191815">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="8191835">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191862">_</span><span class="op" id="8191863">,</span>&nbsp;<span class="ident" id="8191865">err</span>&nbsp;<span class="op" id="8191869">:=</span>&nbsp;<span class="ident" id="8191872">es</span><span class="op" id="8191874">.</span><span class="builtintype" id="8191875">string</span><span class="op" id="8191881">(</span><span class="ident" id="8191882">s</span><span class="op" id="8191883">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191886">if</span>&nbsp;<span class="ident" id="8191889">err</span>&nbsp;<span class="op" id="8191893">!=</span>&nbsp;<span class="ident" id="8191896">nil</span>&nbsp;<span class="op" id="8191900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191904">t</span><span class="op" id="8191905">.</span><span class="ident" id="8191906">Fatal</span><span class="op" id="8191911">(</span><span class="ident" id="8191912">err</span><span class="op" id="8191915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191922">esBytes</span>&nbsp;<span class="op" id="8191930">:=</span>&nbsp;<span class="op" id="8191933">&amp;</span><span class="ident" id="8191934">encodeState</span><span class="op" id="8191945">{</span><span class="op" id="8191946">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191949">_</span><span class="op" id="8191950">,</span>&nbsp;<span class="ident" id="8191952">err</span>&nbsp;<span class="op" id="8191956">=</span>&nbsp;<span class="ident" id="8191958">esBytes</span><span class="op" id="8191965">.</span><span class="ident" id="8191966">stringBytes</span><span class="op" id="8191977">(</span><span class="op" id="8191978">[</span><span class="op" id="8191979">]</span><span class="builtintype" id="8191980">byte</span><span class="op" id="8191984">(</span><span class="ident" id="8191985">s</span><span class="op" id="8191986">)</span><span class="op" id="8191987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191990">if</span>&nbsp;<span class="ident" id="8191993">err</span>&nbsp;<span class="op" id="8191997">!=</span>&nbsp;<span class="ident" id="8192000">nil</span>&nbsp;<span class="op" id="8192004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192008">t</span><span class="op" id="8192009">.</span><span class="ident" id="8192010">Fatal</span><span class="op" id="8192015">(</span><span class="ident" id="8192016">err</span><span class="op" id="8192019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192026">enc</span>&nbsp;<span class="op" id="8192030">:=</span>&nbsp;<span class="ident" id="8192033">es</span><span class="op" id="8192035">.</span><span class="ident" id="8192036">Buffer</span><span class="op" id="8192042">.</span><span class="ident" id="8192043">String</span><span class="op" id="8192049">(</span><span class="op" id="8192050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192053">encBytes</span>&nbsp;<span class="op" id="8192062">:=</span>&nbsp;<span class="ident" id="8192065">esBytes</span><span class="op" id="8192072">.</span><span class="ident" id="8192073">Buffer</span><span class="op" id="8192079">.</span><span class="ident" id="8192080">String</span><span class="op" id="8192086">(</span><span class="op" id="8192087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192090">if</span>&nbsp;<span class="ident" id="8192093">enc</span>&nbsp;<span class="op" id="8192097">!=</span>&nbsp;<span class="ident" id="8192100">encBytes</span>&nbsp;<span class="op" id="8192109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192113">i</span>&nbsp;<span class="op" id="8192115">:=</span>&nbsp;<span class="num" id="8192118">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192122">for</span>&nbsp;<span class="ident" id="8192126">i</span>&nbsp;<span class="op" id="8192128">&lt;</span>&nbsp;<span class="builtinfunc" id="8192130">len</span><span class="op" id="8192133">(</span><span class="ident" id="8192134">enc</span><span class="op" id="8192137">)</span>&nbsp;<span class="op" id="8192139">&amp;&amp;</span>&nbsp;<span class="ident" id="8192142">i</span>&nbsp;<span class="op" id="8192144">&lt;</span>&nbsp;<span class="builtinfunc" id="8192146">len</span><span class="op" id="8192149">(</span><span class="ident" id="8192150">encBytes</span><span class="op" id="8192158">)</span>&nbsp;<span class="op" id="8192160">&amp;&amp;</span>&nbsp;<span class="ident" id="8192163">enc</span><span class="op" id="8192166">[</span><span class="ident" id="8192167">i</span><span class="op" id="8192168">]</span>&nbsp;<span class="op" id="8192170">==</span>&nbsp;<span class="ident" id="8192173">encBytes</span><span class="op" id="8192181">[</span><span class="ident" id="8192182">i</span><span class="op" id="8192183">]</span>&nbsp;<span class="op" id="8192185">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192190">i</span><span class="op" id="8192191">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192200">enc</span>&nbsp;<span class="op" id="8192204">=</span>&nbsp;<span class="ident" id="8192206">enc</span><span class="op" id="8192209">[</span><span class="ident" id="8192210">i</span><span class="op" id="8192211">:</span><span class="op" id="8192212">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192216">encBytes</span>&nbsp;<span class="op" id="8192225">=</span>&nbsp;<span class="ident" id="8192227">encBytes</span><span class="op" id="8192235">[</span><span class="ident" id="8192236">i</span><span class="op" id="8192237">:</span><span class="op" id="8192238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192242">i</span>&nbsp;<span class="op" id="8192244">=</span>&nbsp;<span class="num" id="8192246">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192250">for</span>&nbsp;<span class="ident" id="8192254">i</span>&nbsp;<span class="op" id="8192256">&lt;</span>&nbsp;<span class="builtinfunc" id="8192258">len</span><span class="op" id="8192261">(</span><span class="ident" id="8192262">enc</span><span class="op" id="8192265">)</span>&nbsp;<span class="op" id="8192267">&amp;&amp;</span>&nbsp;<span class="ident" id="8192270">i</span>&nbsp;<span class="op" id="8192272">&lt;</span>&nbsp;<span class="builtinfunc" id="8192274">len</span><span class="op" id="8192277">(</span><span class="ident" id="8192278">encBytes</span><span class="op" id="8192286">)</span>&nbsp;<span class="op" id="8192288">&amp;&amp;</span>&nbsp;<span class="ident" id="8192291">enc</span><span class="op" id="8192294">[</span><span class="builtinfunc" id="8192295">len</span><span class="op" id="8192298">(</span><span class="ident" id="8192299">enc</span><span class="op" id="8192302">)</span><span class="op" id="8192303">-</span><span class="ident" id="8192304">i</span><span class="op" id="8192305">-</span><span class="num" id="8192306">1</span><span class="op" id="8192307">]</span>&nbsp;<span class="op" id="8192309">==</span>&nbsp;<span class="ident" id="8192312">encBytes</span><span class="op" id="8192320">[</span><span class="builtinfunc" id="8192321">len</span><span class="op" id="8192324">(</span><span class="ident" id="8192325">encBytes</span><span class="op" id="8192333">)</span><span class="op" id="8192334">-</span><span class="ident" id="8192335">i</span><span class="op" id="8192336">-</span><span class="num" id="8192337">1</span><span class="op" id="8192338">]</span>&nbsp;<span class="op" id="8192340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192345">i</span><span class="op" id="8192346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192355">enc</span>&nbsp;<span class="op" id="8192359">=</span>&nbsp;<span class="ident" id="8192361">enc</span><span class="op" id="8192364">[</span><span class="op" id="8192365">:</span><span class="builtinfunc" id="8192366">len</span><span class="op" id="8192369">(</span><span class="ident" id="8192370">enc</span><span class="op" id="8192373">)</span><span class="op" id="8192374">-</span><span class="ident" id="8192375">i</span><span class="op" id="8192376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192380">encBytes</span>&nbsp;<span class="op" id="8192389">=</span>&nbsp;<span class="ident" id="8192391">encBytes</span><span class="op" id="8192399">[</span><span class="op" id="8192400">:</span><span class="builtinfunc" id="8192401">len</span><span class="op" id="8192404">(</span><span class="ident" id="8192405">encBytes</span><span class="op" id="8192413">)</span><span class="op" id="8192414">-</span><span class="ident" id="8192415">i</span><span class="op" id="8192416">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192421">if</span>&nbsp;<span class="builtinfunc" id="8192424">len</span><span class="op" id="8192427">(</span><span class="ident" id="8192428">enc</span><span class="op" id="8192431">)</span>&nbsp;<span class="op" id="8192433">&gt;</span>&nbsp;<span class="num" id="8192435">20</span>&nbsp;<span class="op" id="8192438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192443">enc</span>&nbsp;<span class="op" id="8192447">=</span>&nbsp;<span class="ident" id="8192449">enc</span><span class="op" id="8192452">[</span><span class="op" id="8192453">:</span><span class="num" id="8192454">20</span><span class="op" id="8192456">]</span>&nbsp;<span class="op" id="8192458">+</span>&nbsp;<span class="string" id="8192460">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192472">if</span>&nbsp;<span class="builtinfunc" id="8192475">len</span><span class="op" id="8192478">(</span><span class="ident" id="8192479">encBytes</span><span class="op" id="8192487">)</span>&nbsp;<span class="op" id="8192489">&gt;</span>&nbsp;<span class="num" id="8192491">20</span>&nbsp;<span class="op" id="8192494">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192499">encBytes</span>&nbsp;<span class="op" id="8192508">=</span>&nbsp;<span class="ident" id="8192510">encBytes</span><span class="op" id="8192518">[</span><span class="op" id="8192519">:</span><span class="num" id="8192520">20</span><span class="op" id="8192522">]</span>&nbsp;<span class="op" id="8192524">+</span>&nbsp;<span class="string" id="8192526">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192539">t</span><span class="op" id="8192540">.</span><span class="ident" id="8192541">Errorf</span><span class="op" id="8192547">(</span><span class="string" id="8192548">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="8192580">,</span>&nbsp;<span class="ident" id="8192582">enc</span><span class="op" id="8192585">,</span>&nbsp;<span class="ident" id="8192587">encBytes</span><span class="op" id="8192595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192598">}</span><br>
<span class="lineno">420</span><span class="op" id="8192600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192603">func</span>&nbsp;<span class="ident" id="8192608">TestIssue6458</span><span class="op" id="8192621">(</span><span class="ident" id="8192622">t</span>&nbsp;<span class="op" id="8192624">*</span><span class="ident" id="8192625">testing</span><span class="op" id="8192632">.</span><span class="ident" id="8192633">T</span><span class="op" id="8192634">)</span>&nbsp;<span class="op" id="8192636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192639">type</span>&nbsp;<span class="ident" id="8192644">Foo</span>&nbsp;<span class="keyword" id="8192648">struct</span>&nbsp;<span class="op" id="8192655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192659">M</span>&nbsp;<span class="ident" id="8192661">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192676">x</span>&nbsp;<span class="op" id="8192678">:=</span>&nbsp;<span class="ident" id="8192681">Foo</span><span class="op" id="8192684">{</span><span class="ident" id="8192685">RawMessage</span><span class="op" id="8192695">(</span><span class="string" id="8192696">`&#34;foo&#34;`</span><span class="op" id="8192703">)</span><span class="op" id="8192704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192708">b</span><span class="op" id="8192709">,</span>&nbsp;<span class="ident" id="8192711">err</span>&nbsp;<span class="op" id="8192715">:=</span>&nbsp;<span class="ident" id="8192718">Marshal</span><span class="op" id="8192725">(</span><span class="op" id="8192726">&amp;</span><span class="ident" id="8192727">x</span><span class="op" id="8192728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192731">if</span>&nbsp;<span class="ident" id="8192734">err</span>&nbsp;<span class="op" id="8192738">!=</span>&nbsp;<span class="ident" id="8192741">nil</span>&nbsp;<span class="op" id="8192745">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192749">t</span><span class="op" id="8192750">.</span><span class="ident" id="8192751">Fatal</span><span class="op" id="8192756">(</span><span class="ident" id="8192757">err</span><span class="op" id="8192760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192766">if</span>&nbsp;<span class="ident" id="8192769">want</span>&nbsp;<span class="op" id="8192774">:=</span>&nbsp;<span class="string" id="8192777">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="8192790">;</span>&nbsp;<span class="builtintype" id="8192792">string</span><span class="op" id="8192798">(</span><span class="ident" id="8192799">b</span><span class="op" id="8192800">)</span>&nbsp;<span class="op" id="8192802">!=</span>&nbsp;<span class="ident" id="8192805">want</span>&nbsp;<span class="op" id="8192810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192814">t</span><span class="op" id="8192815">.</span><span class="ident" id="8192816">Errorf</span><span class="op" id="8192822">(</span><span class="string" id="8192823">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8192852">,</span>&nbsp;<span class="ident" id="8192854">b</span><span class="op" id="8192855">,</span>&nbsp;<span class="ident" id="8192857">want</span><span class="op" id="8192861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192864">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192868">b</span><span class="op" id="8192869">,</span>&nbsp;<span class="ident" id="8192871">err</span>&nbsp;<span class="op" id="8192875">=</span>&nbsp;<span class="ident" id="8192877">Marshal</span><span class="op" id="8192884">(</span><span class="ident" id="8192885">x</span><span class="op" id="8192886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192889">if</span>&nbsp;<span class="ident" id="8192892">err</span>&nbsp;<span class="op" id="8192896">!=</span>&nbsp;<span class="ident" id="8192899">nil</span>&nbsp;<span class="op" id="8192903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192907">t</span><span class="op" id="8192908">.</span><span class="ident" id="8192909">Fatal</span><span class="op" id="8192914">(</span><span class="ident" id="8192915">err</span><span class="op" id="8192918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192921">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8192925">if</span>&nbsp;<span class="ident" id="8192928">want</span>&nbsp;<span class="op" id="8192933">:=</span>&nbsp;<span class="string" id="8192936">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="8192954">;</span>&nbsp;<span class="builtintype" id="8192956">string</span><span class="op" id="8192962">(</span><span class="ident" id="8192963">b</span><span class="op" id="8192964">)</span>&nbsp;<span class="op" id="8192966">!=</span>&nbsp;<span class="ident" id="8192969">want</span>&nbsp;<span class="op" id="8192974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192978">t</span><span class="op" id="8192979">.</span><span class="ident" id="8192980">Errorf</span><span class="op" id="8192986">(</span><span class="string" id="8192987">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8193015">,</span>&nbsp;<span class="ident" id="8193017">b</span><span class="op" id="8193018">,</span>&nbsp;<span class="ident" id="8193020">want</span><span class="op" id="8193024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193027">}</span><br>
<span class="lineno"></span><span class="op" id="8193029">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8193032">func</span>&nbsp;<span class="ident" id="8193037">TestHTMLEscape</span><span class="op" id="8193051">(</span><span class="ident" id="8193052">t</span>&nbsp;<span class="op" id="8193054">*</span><span class="ident" id="8193055">testing</span><span class="op" id="8193062">.</span><span class="ident" id="8193063">T</span><span class="op" id="8193064">)</span>&nbsp;<span class="op" id="8193066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193069">var</span>&nbsp;<span class="ident" id="8193073">b</span><span class="op" id="8193074">,</span>&nbsp;<span class="ident" id="8193076">want</span>&nbsp;<span class="ident" id="8193081">bytes</span><span class="op" id="8193086">.</span><span class="ident" id="8193087">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193095">m</span>&nbsp;<span class="op" id="8193097">:=</span>&nbsp;<span class="string" id="8193100">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="8193120">+</span>&nbsp;<span class="string" id="8193122">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="8193150">+</span>&nbsp;<span class="string" id="8193152">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193165">want</span><span class="op" id="8193169">.</span><span class="ident" id="8193170">Write</span><span class="op" id="8193175">(</span><span class="op" id="8193176">[</span><span class="op" id="8193177">]</span><span class="builtintype" id="8193178">byte</span><span class="op" id="8193182">(</span><span class="string" id="8193183">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="8193249">)</span><span class="op" id="8193250">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193253">HTMLEscape</span><span class="op" id="8193263">(</span><span class="op" id="8193264">&amp;</span><span class="ident" id="8193265">b</span><span class="op" id="8193266">,</span>&nbsp;<span class="op" id="8193268">[</span><span class="op" id="8193269">]</span><span class="builtintype" id="8193270">byte</span><span class="op" id="8193274">(</span><span class="ident" id="8193275">m</span><span class="op" id="8193276">)</span><span class="op" id="8193277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193280">if</span>&nbsp;<span class="op" id="8193283">!</span><span class="ident" id="8193284">bytes</span><span class="op" id="8193289">.</span><span class="ident" id="8193290">Equal</span><span class="op" id="8193295">(</span><span class="ident" id="8193296">b</span><span class="op" id="8193297">.</span><span class="ident" id="8193298">Bytes</span><span class="op" id="8193303">(</span><span class="op" id="8193304">)</span><span class="op" id="8193305">,</span>&nbsp;<span class="ident" id="8193307">want</span><span class="op" id="8193311">.</span><span class="ident" id="8193312">Bytes</span><span class="op" id="8193317">(</span><span class="op" id="8193318">)</span><span class="op" id="8193319">)</span>&nbsp;<span class="op" id="8193321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193325">t</span><span class="op" id="8193326">.</span><span class="ident" id="8193327">Errorf</span><span class="op" id="8193333">(</span><span class="string" id="8193334">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8193375">,</span>&nbsp;<span class="ident" id="8193377">b</span><span class="op" id="8193378">.</span><span class="ident" id="8193379">Bytes</span><span class="op" id="8193384">(</span><span class="op" id="8193385">)</span><span class="op" id="8193386">,</span>&nbsp;<span class="ident" id="8193388">want</span><span class="op" id="8193392">.</span><span class="ident" id="8193393">Bytes</span><span class="op" id="8193398">(</span><span class="op" id="8193399">)</span><span class="op" id="8193400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193403">}</span><br>
<span class="lineno"></span><span class="op" id="8193405">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="8193408">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="8193433">func</span>&nbsp;<span class="ident" id="8193438">TestEncodePointerString</span><span class="op" id="8193461">(</span><span class="ident" id="8193462">t</span>&nbsp;<span class="op" id="8193464">*</span><span class="ident" id="8193465">testing</span><span class="op" id="8193472">.</span><span class="ident" id="8193473">T</span><span class="op" id="8193474">)</span>&nbsp;<span class="op" id="8193476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193479">type</span>&nbsp;<span class="ident" id="8193484">stringPointer</span>&nbsp;<span class="keyword" id="8193498">struct</span>&nbsp;<span class="op" id="8193505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193509">N</span>&nbsp;<span class="op" id="8193511">*</span><span class="ident" id="8193512">int64</span>&nbsp;<span class="string" id="8193518">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193540">var</span>&nbsp;<span class="ident" id="8193544">n</span>&nbsp;<span class="ident" id="8193546">int64</span>&nbsp;<span class="op" id="8193552">=</span>&nbsp;<span class="num" id="8193554">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193558">b</span><span class="op" id="8193559">,</span>&nbsp;<span class="ident" id="8193561">err</span>&nbsp;<span class="op" id="8193565">:=</span>&nbsp;<span class="ident" id="8193568">Marshal</span><span class="op" id="8193575">(</span><span class="ident" id="8193576">stringPointer</span><span class="op" id="8193589">{</span><span class="ident" id="8193590">N</span><span class="op" id="8193591">:</span>&nbsp;<span class="op" id="8193593">&amp;</span><span class="ident" id="8193594">n</span><span class="op" id="8193595">}</span><span class="op" id="8193596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193599">if</span>&nbsp;<span class="ident" id="8193602">err</span>&nbsp;<span class="op" id="8193606">!=</span>&nbsp;<span class="ident" id="8193609">nil</span>&nbsp;<span class="op" id="8193613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193617">t</span><span class="op" id="8193618">.</span><span class="ident" id="8193619">Fatalf</span><span class="op" id="8193625">(</span><span class="string" id="8193626">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8193639">,</span>&nbsp;<span class="ident" id="8193641">err</span><span class="op" id="8193644">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193650">if</span>&nbsp;<span class="ident" id="8193653">got</span><span class="op" id="8193656">,</span>&nbsp;<span class="ident" id="8193658">want</span>&nbsp;<span class="op" id="8193663">:=</span>&nbsp;<span class="builtintype" id="8193666">string</span><span class="op" id="8193672">(</span><span class="ident" id="8193673">b</span><span class="op" id="8193674">)</span><span class="op" id="8193675">,</span>&nbsp;<span class="string" id="8193677">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="8193689">;</span>&nbsp;<span class="ident" id="8193691">got</span>&nbsp;<span class="op" id="8193695">!=</span>&nbsp;<span class="ident" id="8193698">want</span>&nbsp;<span class="op" id="8193703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193707">t</span><span class="op" id="8193708">.</span><span class="ident" id="8193709">Errorf</span><span class="op" id="8193715">(</span><span class="string" id="8193716">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8193739">,</span>&nbsp;<span class="ident" id="8193741">got</span><span class="op" id="8193744">,</span>&nbsp;<span class="ident" id="8193746">want</span><span class="op" id="8193750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193756">var</span>&nbsp;<span class="ident" id="8193760">back</span>&nbsp;<span class="ident" id="8193765">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193780">err</span>&nbsp;<span class="op" id="8193784">=</span>&nbsp;<span class="ident" id="8193786">Unmarshal</span><span class="op" id="8193795">(</span><span class="ident" id="8193796">b</span><span class="op" id="8193797">,</span>&nbsp;<span class="op" id="8193799">&amp;</span><span class="ident" id="8193800">back</span><span class="op" id="8193804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193807">if</span>&nbsp;<span class="ident" id="8193810">err</span>&nbsp;<span class="op" id="8193814">!=</span>&nbsp;<span class="ident" id="8193817">nil</span>&nbsp;<span class="op" id="8193821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193825">t</span><span class="op" id="8193826">.</span><span class="ident" id="8193827">Fatalf</span><span class="op" id="8193833">(</span><span class="string" id="8193834">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8193849">,</span>&nbsp;<span class="ident" id="8193851">err</span><span class="op" id="8193854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193860">if</span>&nbsp;<span class="ident" id="8193863">back</span><span class="op" id="8193867">.</span><span class="ident" id="8193868">N</span>&nbsp;<span class="op" id="8193870">==</span>&nbsp;<span class="ident" id="8193873">nil</span>&nbsp;<span class="op" id="8193877">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193881">t</span><span class="op" id="8193882">.</span><span class="ident" id="8193883">Fatalf</span><span class="op" id="8193889">(</span><span class="string" id="8193890">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="8193916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193922">if</span>&nbsp;<span class="op" id="8193925">*</span><span class="ident" id="8193926">back</span><span class="op" id="8193930">.</span><span class="ident" id="8193931">N</span>&nbsp;<span class="op" id="8193933">!=</span>&nbsp;<span class="num" id="8193936">42</span>&nbsp;<span class="op" id="8193939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193943">t</span><span class="op" id="8193944">.</span><span class="ident" id="8193945">Fatalf</span><span class="op" id="8193951">(</span><span class="string" id="8193952">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="8193970">,</span>&nbsp;<span class="op" id="8193972">*</span><span class="ident" id="8193973">back</span><span class="op" id="8193977">.</span><span class="ident" id="8193978">N</span><span class="op" id="8193979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193982">}</span><br>
<span class="lineno">480</span><span class="op" id="8193984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8193987">var</span>&nbsp;<span class="ident" id="8193991">encodeStringTests</span>&nbsp;<span class="op" id="8194009">=</span>&nbsp;<span class="op" id="8194011">[</span><span class="op" id="8194012">]</span><span class="keyword" id="8194013">struct</span>&nbsp;<span class="op" id="8194020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194023">in</span>&nbsp;&nbsp;<span class="builtintype" id="8194027">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194035">out</span>&nbsp;<span class="builtintype" id="8194039">string</span><br>
<span class="lineno">485</span><span class="op" id="8194046">}</span><span class="op" id="8194047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194050">{</span><span class="string" id="8194051">&#34;\x00&#34;</span><span class="op" id="8194057">,</span>&nbsp;<span class="string" id="8194059">`&#34;\u0000&#34;`</span><span class="op" id="8194069">}</span><span class="op" id="8194070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194073">{</span><span class="string" id="8194074">&#34;\x01&#34;</span><span class="op" id="8194080">,</span>&nbsp;<span class="string" id="8194082">`&#34;\u0001&#34;`</span><span class="op" id="8194092">}</span><span class="op" id="8194093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194096">{</span><span class="string" id="8194097">&#34;\x02&#34;</span><span class="op" id="8194103">,</span>&nbsp;<span class="string" id="8194105">`&#34;\u0002&#34;`</span><span class="op" id="8194115">}</span><span class="op" id="8194116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194119">{</span><span class="string" id="8194120">&#34;\x03&#34;</span><span class="op" id="8194126">,</span>&nbsp;<span class="string" id="8194128">`&#34;\u0003&#34;`</span><span class="op" id="8194138">}</span><span class="op" id="8194139">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194142">{</span><span class="string" id="8194143">&#34;\x04&#34;</span><span class="op" id="8194149">,</span>&nbsp;<span class="string" id="8194151">`&#34;\u0004&#34;`</span><span class="op" id="8194161">}</span><span class="op" id="8194162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194165">{</span><span class="string" id="8194166">&#34;\x05&#34;</span><span class="op" id="8194172">,</span>&nbsp;<span class="string" id="8194174">`&#34;\u0005&#34;`</span><span class="op" id="8194184">}</span><span class="op" id="8194185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194188">{</span><span class="string" id="8194189">&#34;\x06&#34;</span><span class="op" id="8194195">,</span>&nbsp;<span class="string" id="8194197">`&#34;\u0006&#34;`</span><span class="op" id="8194207">}</span><span class="op" id="8194208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194211">{</span><span class="string" id="8194212">&#34;\x07&#34;</span><span class="op" id="8194218">,</span>&nbsp;<span class="string" id="8194220">`&#34;\u0007&#34;`</span><span class="op" id="8194230">}</span><span class="op" id="8194231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194234">{</span><span class="string" id="8194235">&#34;\x08&#34;</span><span class="op" id="8194241">,</span>&nbsp;<span class="string" id="8194243">`&#34;\u0008&#34;`</span><span class="op" id="8194253">}</span><span class="op" id="8194254">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194257">{</span><span class="string" id="8194258">&#34;\x09&#34;</span><span class="op" id="8194264">,</span>&nbsp;<span class="string" id="8194266">`&#34;\t&#34;`</span><span class="op" id="8194272">}</span><span class="op" id="8194273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194276">{</span><span class="string" id="8194277">&#34;\x0a&#34;</span><span class="op" id="8194283">,</span>&nbsp;<span class="string" id="8194285">`&#34;\n&#34;`</span><span class="op" id="8194291">}</span><span class="op" id="8194292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194295">{</span><span class="string" id="8194296">&#34;\x0b&#34;</span><span class="op" id="8194302">,</span>&nbsp;<span class="string" id="8194304">`&#34;\u000b&#34;`</span><span class="op" id="8194314">}</span><span class="op" id="8194315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194318">{</span><span class="string" id="8194319">&#34;\x0c&#34;</span><span class="op" id="8194325">,</span>&nbsp;<span class="string" id="8194327">`&#34;\u000c&#34;`</span><span class="op" id="8194337">}</span><span class="op" id="8194338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194341">{</span><span class="string" id="8194342">&#34;\x0d&#34;</span><span class="op" id="8194348">,</span>&nbsp;<span class="string" id="8194350">`&#34;\r&#34;`</span><span class="op" id="8194356">}</span><span class="op" id="8194357">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194360">{</span><span class="string" id="8194361">&#34;\x0e&#34;</span><span class="op" id="8194367">,</span>&nbsp;<span class="string" id="8194369">`&#34;\u000e&#34;`</span><span class="op" id="8194379">}</span><span class="op" id="8194380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194383">{</span><span class="string" id="8194384">&#34;\x0f&#34;</span><span class="op" id="8194390">,</span>&nbsp;<span class="string" id="8194392">`&#34;\u000f&#34;`</span><span class="op" id="8194402">}</span><span class="op" id="8194403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194406">{</span><span class="string" id="8194407">&#34;\x10&#34;</span><span class="op" id="8194413">,</span>&nbsp;<span class="string" id="8194415">`&#34;\u0010&#34;`</span><span class="op" id="8194425">}</span><span class="op" id="8194426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194429">{</span><span class="string" id="8194430">&#34;\x11&#34;</span><span class="op" id="8194436">,</span>&nbsp;<span class="string" id="8194438">`&#34;\u0011&#34;`</span><span class="op" id="8194448">}</span><span class="op" id="8194449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194452">{</span><span class="string" id="8194453">&#34;\x12&#34;</span><span class="op" id="8194459">,</span>&nbsp;<span class="string" id="8194461">`&#34;\u0012&#34;`</span><span class="op" id="8194471">}</span><span class="op" id="8194472">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194475">{</span><span class="string" id="8194476">&#34;\x13&#34;</span><span class="op" id="8194482">,</span>&nbsp;<span class="string" id="8194484">`&#34;\u0013&#34;`</span><span class="op" id="8194494">}</span><span class="op" id="8194495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194498">{</span><span class="string" id="8194499">&#34;\x14&#34;</span><span class="op" id="8194505">,</span>&nbsp;<span class="string" id="8194507">`&#34;\u0014&#34;`</span><span class="op" id="8194517">}</span><span class="op" id="8194518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194521">{</span><span class="string" id="8194522">&#34;\x15&#34;</span><span class="op" id="8194528">,</span>&nbsp;<span class="string" id="8194530">`&#34;\u0015&#34;`</span><span class="op" id="8194540">}</span><span class="op" id="8194541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194544">{</span><span class="string" id="8194545">&#34;\x16&#34;</span><span class="op" id="8194551">,</span>&nbsp;<span class="string" id="8194553">`&#34;\u0016&#34;`</span><span class="op" id="8194563">}</span><span class="op" id="8194564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194567">{</span><span class="string" id="8194568">&#34;\x17&#34;</span><span class="op" id="8194574">,</span>&nbsp;<span class="string" id="8194576">`&#34;\u0017&#34;`</span><span class="op" id="8194586">}</span><span class="op" id="8194587">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194590">{</span><span class="string" id="8194591">&#34;\x18&#34;</span><span class="op" id="8194597">,</span>&nbsp;<span class="string" id="8194599">`&#34;\u0018&#34;`</span><span class="op" id="8194609">}</span><span class="op" id="8194610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194613">{</span><span class="string" id="8194614">&#34;\x19&#34;</span><span class="op" id="8194620">,</span>&nbsp;<span class="string" id="8194622">`&#34;\u0019&#34;`</span><span class="op" id="8194632">}</span><span class="op" id="8194633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194636">{</span><span class="string" id="8194637">&#34;\x1a&#34;</span><span class="op" id="8194643">,</span>&nbsp;<span class="string" id="8194645">`&#34;\u001a&#34;`</span><span class="op" id="8194655">}</span><span class="op" id="8194656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194659">{</span><span class="string" id="8194660">&#34;\x1b&#34;</span><span class="op" id="8194666">,</span>&nbsp;<span class="string" id="8194668">`&#34;\u001b&#34;`</span><span class="op" id="8194678">}</span><span class="op" id="8194679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194682">{</span><span class="string" id="8194683">&#34;\x1c&#34;</span><span class="op" id="8194689">,</span>&nbsp;<span class="string" id="8194691">`&#34;\u001c&#34;`</span><span class="op" id="8194701">}</span><span class="op" id="8194702">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194705">{</span><span class="string" id="8194706">&#34;\x1d&#34;</span><span class="op" id="8194712">,</span>&nbsp;<span class="string" id="8194714">`&#34;\u001d&#34;`</span><span class="op" id="8194724">}</span><span class="op" id="8194725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194728">{</span><span class="string" id="8194729">&#34;\x1e&#34;</span><span class="op" id="8194735">,</span>&nbsp;<span class="string" id="8194737">`&#34;\u001e&#34;`</span><span class="op" id="8194747">}</span><span class="op" id="8194748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194751">{</span><span class="string" id="8194752">&#34;\x1f&#34;</span><span class="op" id="8194758">,</span>&nbsp;<span class="string" id="8194760">`&#34;\u001f&#34;`</span><span class="op" id="8194770">}</span><span class="op" id="8194771">,</span><br>
<span class="lineno"></span><span class="op" id="8194773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8194776">func</span>&nbsp;<span class="ident" id="8194781">TestEncodeString</span><span class="op" id="8194797">(</span><span class="ident" id="8194798">t</span>&nbsp;<span class="op" id="8194800">*</span><span class="ident" id="8194801">testing</span><span class="op" id="8194808">.</span><span class="ident" id="8194809">T</span><span class="op" id="8194810">)</span>&nbsp;<span class="op" id="8194812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194815">for</span>&nbsp;<span class="ident" id="8194819">_</span><span class="op" id="8194820">,</span>&nbsp;<span class="ident" id="8194822">tt</span>&nbsp;<span class="op" id="8194825">:=</span>&nbsp;<span class="keyword" id="8194828">range</span>&nbsp;<span class="ident" id="8194834">encodeStringTests</span>&nbsp;<span class="op" id="8194852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194856">b</span><span class="op" id="8194857">,</span>&nbsp;<span class="ident" id="8194859">err</span>&nbsp;<span class="op" id="8194863">:=</span>&nbsp;<span class="ident" id="8194866">Marshal</span><span class="op" id="8194873">(</span><span class="ident" id="8194874">tt</span><span class="op" id="8194876">.</span><span class="ident" id="8194877">in</span><span class="op" id="8194879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194883">if</span>&nbsp;<span class="ident" id="8194886">err</span>&nbsp;<span class="op" id="8194890">!=</span>&nbsp;<span class="ident" id="8194893">nil</span>&nbsp;<span class="op" id="8194897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194902">t</span><span class="op" id="8194903">.</span><span class="ident" id="8194904">Errorf</span><span class="op" id="8194910">(</span><span class="string" id="8194911">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="8194928">,</span>&nbsp;<span class="ident" id="8194930">tt</span><span class="op" id="8194932">.</span><span class="ident" id="8194933">in</span><span class="op" id="8194935">,</span>&nbsp;<span class="ident" id="8194937">err</span><span class="op" id="8194940">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194945">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194960">out</span>&nbsp;<span class="op" id="8194964">:=</span>&nbsp;<span class="builtintype" id="8194967">string</span><span class="op" id="8194973">(</span><span class="ident" id="8194974">b</span><span class="op" id="8194975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194979">if</span>&nbsp;<span class="ident" id="8194982">out</span>&nbsp;<span class="op" id="8194986">!=</span>&nbsp;<span class="ident" id="8194989">tt</span><span class="op" id="8194991">.</span><span class="ident" id="8194992">out</span>&nbsp;<span class="op" id="8194996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195001">t</span><span class="op" id="8195002">.</span><span class="ident" id="8195003">Errorf</span><span class="op" id="8195009">(</span><span class="string" id="8195010">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8195039">,</span>&nbsp;<span class="ident" id="8195041">tt</span><span class="op" id="8195043">.</span><span class="ident" id="8195044">in</span><span class="op" id="8195046">,</span>&nbsp;<span class="ident" id="8195048">out</span><span class="op" id="8195051">,</span>&nbsp;<span class="ident" id="8195053">tt</span><span class="op" id="8195055">.</span><span class="ident" id="8195056">out</span><span class="op" id="8195059">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8195066">}</span><br>
<span class="lineno"></span><span class="op" id="8195068">}</span>
</div>
</body>
</html>
