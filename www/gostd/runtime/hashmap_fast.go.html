<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html" class="current">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1475045">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1475100">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1475154">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1475205">package</span>&nbsp;<span class="ident" id="1475213">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1475222">import</span>&nbsp;<span class="op" id="1475229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1475232">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1475241">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1475244">func</span>&nbsp;<span class="ident" id="1475249">mapaccess1_fast32</span><span class="op" id="1475266">(</span><span class="ident" id="1475267">t</span>&nbsp;<span class="op" id="1475269">*</span><span class="ident" id="1475270">maptype</span><span class="op" id="1475277">,</span>&nbsp;<span class="ident" id="1475279">h</span>&nbsp;<span class="op" id="1475281">*</span><span class="ident" id="1475282">hmap</span><span class="op" id="1475286">,</span>&nbsp;<span class="ident" id="1475288">key</span>&nbsp;<span class="builtintype" id="1475292">uint32</span><span class="op" id="1475298">)</span>&nbsp;<span class="ident" id="1475300">unsafe</span><span class="op" id="1475306">.</span><span class="ident" id="1475307">Pointer</span>&nbsp;<span class="op" id="1475315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475318">if</span>&nbsp;<span class="ident" id="1475321">raceenabled</span>&nbsp;<span class="op" id="1475333">&amp;&amp;</span>&nbsp;<span class="ident" id="1475336">h</span>&nbsp;<span class="op" id="1475338">!=</span>&nbsp;<span class="builtintype" id="1475341">nil</span>&nbsp;<span class="op" id="1475345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475349">callerpc</span>&nbsp;<span class="op" id="1475358">:=</span>&nbsp;<span class="ident" id="1475361">getcallerpc</span><span class="op" id="1475372">(</span><span class="ident" id="1475373">unsafe</span><span class="op" id="1475379">.</span><span class="ident" id="1475380">Pointer</span><span class="op" id="1475387">(</span><span class="op" id="1475388">&amp;</span><span class="ident" id="1475389">t</span><span class="op" id="1475390">)</span><span class="op" id="1475391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475395">racereadpc</span><span class="op" id="1475405">(</span><span class="ident" id="1475406">unsafe</span><span class="op" id="1475412">.</span><span class="ident" id="1475413">Pointer</span><span class="op" id="1475420">(</span><span class="ident" id="1475421">h</span><span class="op" id="1475422">)</span><span class="op" id="1475423">,</span>&nbsp;<span class="ident" id="1475425">callerpc</span><span class="op" id="1475433">,</span>&nbsp;<span class="ident" id="1475435">funcPC</span><span class="op" id="1475441">(</span><span class="ident" id="1475442">mapaccess1_fast32</span><span class="op" id="1475459">)</span><span class="op" id="1475460">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475466">if</span>&nbsp;<span class="ident" id="1475469">h</span>&nbsp;<span class="op" id="1475471">==</span>&nbsp;<span class="builtintype" id="1475474">nil</span>&nbsp;<span class="op" id="1475478">||</span>&nbsp;<span class="ident" id="1475481">h</span><span class="op" id="1475482">.</span><span class="ident" id="1475483">count</span>&nbsp;<span class="op" id="1475489">==</span>&nbsp;<span class="num" id="1475492">0</span>&nbsp;<span class="op" id="1475494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475498">return</span>&nbsp;<span class="ident" id="1475505">unsafe</span><span class="op" id="1475511">.</span><span class="ident" id="1475512">Pointer</span><span class="op" id="1475519">(</span><span class="ident" id="1475520">t</span><span class="op" id="1475521">.</span><span class="ident" id="1475522">elem</span><span class="op" id="1475526">.</span><span class="ident" id="1475527">zero</span><span class="op" id="1475531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475537">var</span>&nbsp;<span class="ident" id="1475541">b</span>&nbsp;<span class="op" id="1475543">*</span><span class="ident" id="1475544">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475550">if</span>&nbsp;<span class="ident" id="1475553">h</span><span class="op" id="1475554">.</span><span class="ident" id="1475555">B</span>&nbsp;<span class="op" id="1475557">==</span>&nbsp;<span class="num" id="1475560">0</span>&nbsp;<span class="op" id="1475562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1475566">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475607">b</span>&nbsp;<span class="op" id="1475609">=</span>&nbsp;<span class="op" id="1475611">(</span><span class="op" id="1475612">*</span><span class="ident" id="1475613">bmap</span><span class="op" id="1475617">)</span><span class="op" id="1475618">(</span><span class="ident" id="1475619">h</span><span class="op" id="1475620">.</span><span class="ident" id="1475621">buckets</span><span class="op" id="1475628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475631">}</span>&nbsp;<span class="keyword" id="1475633">else</span>&nbsp;<span class="op" id="1475638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475642">hash</span>&nbsp;<span class="op" id="1475647">:=</span>&nbsp;<span class="ident" id="1475650">goalg</span><span class="op" id="1475655">(</span><span class="ident" id="1475656">t</span><span class="op" id="1475657">.</span><span class="ident" id="1475658">key</span><span class="op" id="1475661">.</span><span class="ident" id="1475662">alg</span><span class="op" id="1475665">)</span><span class="op" id="1475666">.</span><span class="ident" id="1475667">hash</span><span class="op" id="1475671">(</span><span class="ident" id="1475672">noescape</span><span class="op" id="1475680">(</span><span class="ident" id="1475681">unsafe</span><span class="op" id="1475687">.</span><span class="ident" id="1475688">Pointer</span><span class="op" id="1475695">(</span><span class="op" id="1475696">&amp;</span><span class="ident" id="1475697">key</span><span class="op" id="1475700">)</span><span class="op" id="1475701">)</span><span class="op" id="1475702">,</span>&nbsp;<span class="num" id="1475704">4</span><span class="op" id="1475705">,</span>&nbsp;<span class="builtintype" id="1475707">uintptr</span><span class="op" id="1475714">(</span><span class="ident" id="1475715">h</span><span class="op" id="1475716">.</span><span class="ident" id="1475717">hash0</span><span class="op" id="1475722">)</span><span class="op" id="1475723">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475727">m</span>&nbsp;<span class="op" id="1475729">:=</span>&nbsp;<span class="builtintype" id="1475732">uintptr</span><span class="op" id="1475739">(</span><span class="num" id="1475740">1</span><span class="op" id="1475741">)</span><span class="op" id="1475742">&lt;&lt;</span><span class="ident" id="1475744">h</span><span class="op" id="1475745">.</span><span class="ident" id="1475746">B</span>&nbsp;<span class="op" id="1475748">-</span>&nbsp;<span class="num" id="1475750">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475754">b</span>&nbsp;<span class="op" id="1475756">=</span>&nbsp;<span class="op" id="1475758">(</span><span class="op" id="1475759">*</span><span class="ident" id="1475760">bmap</span><span class="op" id="1475764">)</span><span class="op" id="1475765">(</span><span class="ident" id="1475766">add</span><span class="op" id="1475769">(</span><span class="ident" id="1475770">h</span><span class="op" id="1475771">.</span><span class="ident" id="1475772">buckets</span><span class="op" id="1475779">,</span>&nbsp;<span class="op" id="1475781">(</span><span class="ident" id="1475782">hash</span><span class="op" id="1475786">&amp;</span><span class="ident" id="1475787">m</span><span class="op" id="1475788">)</span><span class="op" id="1475789">*</span><span class="builtintype" id="1475790">uintptr</span><span class="op" id="1475797">(</span><span class="ident" id="1475798">t</span><span class="op" id="1475799">.</span><span class="ident" id="1475800">bucketsize</span><span class="op" id="1475810">)</span><span class="op" id="1475811">)</span><span class="op" id="1475812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475816">if</span>&nbsp;<span class="ident" id="1475819">c</span>&nbsp;<span class="op" id="1475821">:=</span>&nbsp;<span class="ident" id="1475824">h</span><span class="op" id="1475825">.</span><span class="ident" id="1475826">oldbuckets</span><span class="op" id="1475836">;</span>&nbsp;<span class="ident" id="1475838">c</span>&nbsp;<span class="op" id="1475840">!=</span>&nbsp;<span class="builtintype" id="1475843">nil</span>&nbsp;<span class="op" id="1475847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475852">oldb</span>&nbsp;<span class="op" id="1475857">:=</span>&nbsp;<span class="op" id="1475860">(</span><span class="op" id="1475861">*</span><span class="ident" id="1475862">bmap</span><span class="op" id="1475866">)</span><span class="op" id="1475867">(</span><span class="ident" id="1475868">add</span><span class="op" id="1475871">(</span><span class="ident" id="1475872">c</span><span class="op" id="1475873">,</span>&nbsp;<span class="op" id="1475875">(</span><span class="ident" id="1475876">hash</span><span class="op" id="1475880">&amp;</span><span class="op" id="1475881">(</span><span class="ident" id="1475882">m</span><span class="op" id="1475883">&gt;&gt;</span><span class="num" id="1475885">1</span><span class="op" id="1475886">)</span><span class="op" id="1475887">)</span><span class="op" id="1475888">*</span><span class="builtintype" id="1475889">uintptr</span><span class="op" id="1475896">(</span><span class="ident" id="1475897">t</span><span class="op" id="1475898">.</span><span class="ident" id="1475899">bucketsize</span><span class="op" id="1475909">)</span><span class="op" id="1475910">)</span><span class="op" id="1475911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475916">if</span>&nbsp;<span class="op" id="1475919">!</span><span class="ident" id="1475920">evacuated</span><span class="op" id="1475929">(</span><span class="ident" id="1475930">oldb</span><span class="op" id="1475934">)</span>&nbsp;<span class="op" id="1475936">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1475942">b</span>&nbsp;<span class="op" id="1475944">=</span>&nbsp;<span class="ident" id="1475946">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1475961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475964">for</span>&nbsp;<span class="op" id="1475968">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1475972">for</span>&nbsp;<span class="ident" id="1475976">i</span>&nbsp;<span class="op" id="1475978">:=</span>&nbsp;<span class="builtintype" id="1475981">uintptr</span><span class="op" id="1475988">(</span><span class="num" id="1475989">0</span><span class="op" id="1475990">)</span><span class="op" id="1475991">;</span>&nbsp;<span class="ident" id="1475993">i</span>&nbsp;<span class="op" id="1475995">&lt;</span>&nbsp;<span class="ident" id="1475997">bucketCnt</span><span class="op" id="1476006">;</span>&nbsp;<span class="ident" id="1476008">i</span><span class="op" id="1476009">++</span>&nbsp;<span class="op" id="1476012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476017">k</span>&nbsp;<span class="op" id="1476019">:=</span>&nbsp;<span class="op" id="1476022">*</span><span class="op" id="1476023">(</span><span class="op" id="1476024">(</span><span class="op" id="1476025">*</span><span class="builtintype" id="1476026">uint32</span><span class="op" id="1476032">)</span><span class="op" id="1476033">(</span><span class="ident" id="1476034">add</span><span class="op" id="1476037">(</span><span class="ident" id="1476038">unsafe</span><span class="op" id="1476044">.</span><span class="ident" id="1476045">Pointer</span><span class="op" id="1476052">(</span><span class="ident" id="1476053">b</span><span class="op" id="1476054">)</span><span class="op" id="1476055">,</span>&nbsp;<span class="ident" id="1476057">dataOffset</span><span class="op" id="1476067">+</span><span class="ident" id="1476068">i</span><span class="op" id="1476069">*</span><span class="num" id="1476070">4</span><span class="op" id="1476071">)</span><span class="op" id="1476072">)</span><span class="op" id="1476073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476078">if</span>&nbsp;<span class="ident" id="1476081">k</span>&nbsp;<span class="op" id="1476083">!=</span>&nbsp;<span class="ident" id="1476086">key</span>&nbsp;<span class="op" id="1476090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476096">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476108">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476113">x</span>&nbsp;<span class="op" id="1476115">:=</span>&nbsp;<span class="op" id="1476118">*</span><span class="op" id="1476119">(</span><span class="op" id="1476120">(</span><span class="op" id="1476121">*</span><span class="builtintype" id="1476122">uint8</span><span class="op" id="1476127">)</span><span class="op" id="1476128">(</span><span class="ident" id="1476129">add</span><span class="op" id="1476132">(</span><span class="ident" id="1476133">unsafe</span><span class="op" id="1476139">.</span><span class="ident" id="1476140">Pointer</span><span class="op" id="1476147">(</span><span class="ident" id="1476148">b</span><span class="op" id="1476149">)</span><span class="op" id="1476150">,</span>&nbsp;<span class="ident" id="1476152">i</span><span class="op" id="1476153">)</span><span class="op" id="1476154">)</span><span class="op" id="1476155">)</span>&nbsp;<span class="comment" id="1476157">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476201">if</span>&nbsp;<span class="ident" id="1476204">x</span>&nbsp;<span class="op" id="1476206">==</span>&nbsp;<span class="ident" id="1476209">empty</span>&nbsp;<span class="op" id="1476215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476221">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476238">return</span>&nbsp;<span class="ident" id="1476245">add</span><span class="op" id="1476248">(</span><span class="ident" id="1476249">unsafe</span><span class="op" id="1476255">.</span><span class="ident" id="1476256">Pointer</span><span class="op" id="1476263">(</span><span class="ident" id="1476264">b</span><span class="op" id="1476265">)</span><span class="op" id="1476266">,</span>&nbsp;<span class="ident" id="1476268">dataOffset</span><span class="op" id="1476278">+</span><span class="ident" id="1476279">bucketCnt</span><span class="op" id="1476288">*</span><span class="num" id="1476289">4</span><span class="op" id="1476290">+</span><span class="ident" id="1476291">i</span><span class="op" id="1476292">*</span><span class="builtintype" id="1476293">uintptr</span><span class="op" id="1476300">(</span><span class="ident" id="1476301">t</span><span class="op" id="1476302">.</span><span class="ident" id="1476303">valuesize</span><span class="op" id="1476312">)</span><span class="op" id="1476313">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476321">b</span>&nbsp;<span class="op" id="1476323">=</span>&nbsp;<span class="ident" id="1476325">b</span><span class="op" id="1476326">.</span><span class="ident" id="1476327">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476338">if</span>&nbsp;<span class="ident" id="1476341">b</span>&nbsp;<span class="op" id="1476343">==</span>&nbsp;<span class="builtintype" id="1476346">nil</span>&nbsp;<span class="op" id="1476350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476355">return</span>&nbsp;<span class="ident" id="1476362">unsafe</span><span class="op" id="1476368">.</span><span class="ident" id="1476369">Pointer</span><span class="op" id="1476376">(</span><span class="ident" id="1476377">t</span><span class="op" id="1476378">.</span><span class="ident" id="1476379">elem</span><span class="op" id="1476383">.</span><span class="ident" id="1476384">zero</span><span class="op" id="1476388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476392">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476395">}</span><br>
<span class="lineno"></span><span class="op" id="1476397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1476400">func</span>&nbsp;<span class="ident" id="1476405">mapaccess2_fast32</span><span class="op" id="1476422">(</span><span class="ident" id="1476423">t</span>&nbsp;<span class="op" id="1476425">*</span><span class="ident" id="1476426">maptype</span><span class="op" id="1476433">,</span>&nbsp;<span class="ident" id="1476435">h</span>&nbsp;<span class="op" id="1476437">*</span><span class="ident" id="1476438">hmap</span><span class="op" id="1476442">,</span>&nbsp;<span class="ident" id="1476444">key</span>&nbsp;<span class="builtintype" id="1476448">uint32</span><span class="op" id="1476454">)</span>&nbsp;<span class="op" id="1476456">(</span><span class="ident" id="1476457">unsafe</span><span class="op" id="1476463">.</span><span class="ident" id="1476464">Pointer</span><span class="op" id="1476471">,</span>&nbsp;<span class="builtintype" id="1476473">bool</span><span class="op" id="1476477">)</span>&nbsp;<span class="op" id="1476479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476482">if</span>&nbsp;<span class="ident" id="1476485">raceenabled</span>&nbsp;<span class="op" id="1476497">&amp;&amp;</span>&nbsp;<span class="ident" id="1476500">h</span>&nbsp;<span class="op" id="1476502">!=</span>&nbsp;<span class="builtintype" id="1476505">nil</span>&nbsp;<span class="op" id="1476509">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476513">callerpc</span>&nbsp;<span class="op" id="1476522">:=</span>&nbsp;<span class="ident" id="1476525">getcallerpc</span><span class="op" id="1476536">(</span><span class="ident" id="1476537">unsafe</span><span class="op" id="1476543">.</span><span class="ident" id="1476544">Pointer</span><span class="op" id="1476551">(</span><span class="op" id="1476552">&amp;</span><span class="ident" id="1476553">t</span><span class="op" id="1476554">)</span><span class="op" id="1476555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476559">racereadpc</span><span class="op" id="1476569">(</span><span class="ident" id="1476570">unsafe</span><span class="op" id="1476576">.</span><span class="ident" id="1476577">Pointer</span><span class="op" id="1476584">(</span><span class="ident" id="1476585">h</span><span class="op" id="1476586">)</span><span class="op" id="1476587">,</span>&nbsp;<span class="ident" id="1476589">callerpc</span><span class="op" id="1476597">,</span>&nbsp;<span class="ident" id="1476599">funcPC</span><span class="op" id="1476605">(</span><span class="ident" id="1476606">mapaccess2_fast32</span><span class="op" id="1476623">)</span><span class="op" id="1476624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476630">if</span>&nbsp;<span class="ident" id="1476633">h</span>&nbsp;<span class="op" id="1476635">==</span>&nbsp;<span class="builtintype" id="1476638">nil</span>&nbsp;<span class="op" id="1476642">||</span>&nbsp;<span class="ident" id="1476645">h</span><span class="op" id="1476646">.</span><span class="ident" id="1476647">count</span>&nbsp;<span class="op" id="1476653">==</span>&nbsp;<span class="num" id="1476656">0</span>&nbsp;<span class="op" id="1476658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476662">return</span>&nbsp;<span class="ident" id="1476669">unsafe</span><span class="op" id="1476675">.</span><span class="ident" id="1476676">Pointer</span><span class="op" id="1476683">(</span><span class="ident" id="1476684">t</span><span class="op" id="1476685">.</span><span class="ident" id="1476686">elem</span><span class="op" id="1476690">.</span><span class="ident" id="1476691">zero</span><span class="op" id="1476695">)</span><span class="op" id="1476696">,</span>&nbsp;<span class="builtintype" id="1476698">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476708">var</span>&nbsp;<span class="ident" id="1476712">b</span>&nbsp;<span class="op" id="1476714">*</span><span class="ident" id="1476715">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476721">if</span>&nbsp;<span class="ident" id="1476724">h</span><span class="op" id="1476725">.</span><span class="ident" id="1476726">B</span>&nbsp;<span class="op" id="1476728">==</span>&nbsp;<span class="num" id="1476731">0</span>&nbsp;<span class="op" id="1476733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1476737">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476778">b</span>&nbsp;<span class="op" id="1476780">=</span>&nbsp;<span class="op" id="1476782">(</span><span class="op" id="1476783">*</span><span class="ident" id="1476784">bmap</span><span class="op" id="1476788">)</span><span class="op" id="1476789">(</span><span class="ident" id="1476790">h</span><span class="op" id="1476791">.</span><span class="ident" id="1476792">buckets</span><span class="op" id="1476799">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1476802">}</span>&nbsp;<span class="keyword" id="1476804">else</span>&nbsp;<span class="op" id="1476809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476813">hash</span>&nbsp;<span class="op" id="1476818">:=</span>&nbsp;<span class="ident" id="1476821">goalg</span><span class="op" id="1476826">(</span><span class="ident" id="1476827">t</span><span class="op" id="1476828">.</span><span class="ident" id="1476829">key</span><span class="op" id="1476832">.</span><span class="ident" id="1476833">alg</span><span class="op" id="1476836">)</span><span class="op" id="1476837">.</span><span class="ident" id="1476838">hash</span><span class="op" id="1476842">(</span><span class="ident" id="1476843">noescape</span><span class="op" id="1476851">(</span><span class="ident" id="1476852">unsafe</span><span class="op" id="1476858">.</span><span class="ident" id="1476859">Pointer</span><span class="op" id="1476866">(</span><span class="op" id="1476867">&amp;</span><span class="ident" id="1476868">key</span><span class="op" id="1476871">)</span><span class="op" id="1476872">)</span><span class="op" id="1476873">,</span>&nbsp;<span class="num" id="1476875">4</span><span class="op" id="1476876">,</span>&nbsp;<span class="builtintype" id="1476878">uintptr</span><span class="op" id="1476885">(</span><span class="ident" id="1476886">h</span><span class="op" id="1476887">.</span><span class="ident" id="1476888">hash0</span><span class="op" id="1476893">)</span><span class="op" id="1476894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476898">m</span>&nbsp;<span class="op" id="1476900">:=</span>&nbsp;<span class="builtintype" id="1476903">uintptr</span><span class="op" id="1476910">(</span><span class="num" id="1476911">1</span><span class="op" id="1476912">)</span><span class="op" id="1476913">&lt;&lt;</span><span class="ident" id="1476915">h</span><span class="op" id="1476916">.</span><span class="ident" id="1476917">B</span>&nbsp;<span class="op" id="1476919">-</span>&nbsp;<span class="num" id="1476921">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1476925">b</span>&nbsp;<span class="op" id="1476927">=</span>&nbsp;<span class="op" id="1476929">(</span><span class="op" id="1476930">*</span><span class="ident" id="1476931">bmap</span><span class="op" id="1476935">)</span><span class="op" id="1476936">(</span><span class="ident" id="1476937">add</span><span class="op" id="1476940">(</span><span class="ident" id="1476941">h</span><span class="op" id="1476942">.</span><span class="ident" id="1476943">buckets</span><span class="op" id="1476950">,</span>&nbsp;<span class="op" id="1476952">(</span><span class="ident" id="1476953">hash</span><span class="op" id="1476957">&amp;</span><span class="ident" id="1476958">m</span><span class="op" id="1476959">)</span><span class="op" id="1476960">*</span><span class="builtintype" id="1476961">uintptr</span><span class="op" id="1476968">(</span><span class="ident" id="1476969">t</span><span class="op" id="1476970">.</span><span class="ident" id="1476971">bucketsize</span><span class="op" id="1476981">)</span><span class="op" id="1476982">)</span><span class="op" id="1476983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1476987">if</span>&nbsp;<span class="ident" id="1476990">c</span>&nbsp;<span class="op" id="1476992">:=</span>&nbsp;<span class="ident" id="1476995">h</span><span class="op" id="1476996">.</span><span class="ident" id="1476997">oldbuckets</span><span class="op" id="1477007">;</span>&nbsp;<span class="ident" id="1477009">c</span>&nbsp;<span class="op" id="1477011">!=</span>&nbsp;<span class="builtintype" id="1477014">nil</span>&nbsp;<span class="op" id="1477018">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477023">oldb</span>&nbsp;<span class="op" id="1477028">:=</span>&nbsp;<span class="op" id="1477031">(</span><span class="op" id="1477032">*</span><span class="ident" id="1477033">bmap</span><span class="op" id="1477037">)</span><span class="op" id="1477038">(</span><span class="ident" id="1477039">add</span><span class="op" id="1477042">(</span><span class="ident" id="1477043">c</span><span class="op" id="1477044">,</span>&nbsp;<span class="op" id="1477046">(</span><span class="ident" id="1477047">hash</span><span class="op" id="1477051">&amp;</span><span class="op" id="1477052">(</span><span class="ident" id="1477053">m</span><span class="op" id="1477054">&gt;&gt;</span><span class="num" id="1477056">1</span><span class="op" id="1477057">)</span><span class="op" id="1477058">)</span><span class="op" id="1477059">*</span><span class="builtintype" id="1477060">uintptr</span><span class="op" id="1477067">(</span><span class="ident" id="1477068">t</span><span class="op" id="1477069">.</span><span class="ident" id="1477070">bucketsize</span><span class="op" id="1477080">)</span><span class="op" id="1477081">)</span><span class="op" id="1477082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477087">if</span>&nbsp;<span class="op" id="1477090">!</span><span class="ident" id="1477091">evacuated</span><span class="op" id="1477100">(</span><span class="ident" id="1477101">oldb</span><span class="op" id="1477105">)</span>&nbsp;<span class="op" id="1477107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477113">b</span>&nbsp;<span class="op" id="1477115">=</span>&nbsp;<span class="ident" id="1477117">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477129">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477135">for</span>&nbsp;<span class="op" id="1477139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477143">for</span>&nbsp;<span class="ident" id="1477147">i</span>&nbsp;<span class="op" id="1477149">:=</span>&nbsp;<span class="builtintype" id="1477152">uintptr</span><span class="op" id="1477159">(</span><span class="num" id="1477160">0</span><span class="op" id="1477161">)</span><span class="op" id="1477162">;</span>&nbsp;<span class="ident" id="1477164">i</span>&nbsp;<span class="op" id="1477166">&lt;</span>&nbsp;<span class="ident" id="1477168">bucketCnt</span><span class="op" id="1477177">;</span>&nbsp;<span class="ident" id="1477179">i</span><span class="op" id="1477180">++</span>&nbsp;<span class="op" id="1477183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477188">k</span>&nbsp;<span class="op" id="1477190">:=</span>&nbsp;<span class="op" id="1477193">*</span><span class="op" id="1477194">(</span><span class="op" id="1477195">(</span><span class="op" id="1477196">*</span><span class="builtintype" id="1477197">uint32</span><span class="op" id="1477203">)</span><span class="op" id="1477204">(</span><span class="ident" id="1477205">add</span><span class="op" id="1477208">(</span><span class="ident" id="1477209">unsafe</span><span class="op" id="1477215">.</span><span class="ident" id="1477216">Pointer</span><span class="op" id="1477223">(</span><span class="ident" id="1477224">b</span><span class="op" id="1477225">)</span><span class="op" id="1477226">,</span>&nbsp;<span class="ident" id="1477228">dataOffset</span><span class="op" id="1477238">+</span><span class="ident" id="1477239">i</span><span class="op" id="1477240">*</span><span class="num" id="1477241">4</span><span class="op" id="1477242">)</span><span class="op" id="1477243">)</span><span class="op" id="1477244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477249">if</span>&nbsp;<span class="ident" id="1477252">k</span>&nbsp;<span class="op" id="1477254">!=</span>&nbsp;<span class="ident" id="1477257">key</span>&nbsp;<span class="op" id="1477261">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477267">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477284">x</span>&nbsp;<span class="op" id="1477286">:=</span>&nbsp;<span class="op" id="1477289">*</span><span class="op" id="1477290">(</span><span class="op" id="1477291">(</span><span class="op" id="1477292">*</span><span class="builtintype" id="1477293">uint8</span><span class="op" id="1477298">)</span><span class="op" id="1477299">(</span><span class="ident" id="1477300">add</span><span class="op" id="1477303">(</span><span class="ident" id="1477304">unsafe</span><span class="op" id="1477310">.</span><span class="ident" id="1477311">Pointer</span><span class="op" id="1477318">(</span><span class="ident" id="1477319">b</span><span class="op" id="1477320">)</span><span class="op" id="1477321">,</span>&nbsp;<span class="ident" id="1477323">i</span><span class="op" id="1477324">)</span><span class="op" id="1477325">)</span><span class="op" id="1477326">)</span>&nbsp;<span class="comment" id="1477328">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477372">if</span>&nbsp;<span class="ident" id="1477375">x</span>&nbsp;<span class="op" id="1477377">==</span>&nbsp;<span class="ident" id="1477380">empty</span>&nbsp;<span class="op" id="1477386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477392">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477409">return</span>&nbsp;<span class="ident" id="1477416">add</span><span class="op" id="1477419">(</span><span class="ident" id="1477420">unsafe</span><span class="op" id="1477426">.</span><span class="ident" id="1477427">Pointer</span><span class="op" id="1477434">(</span><span class="ident" id="1477435">b</span><span class="op" id="1477436">)</span><span class="op" id="1477437">,</span>&nbsp;<span class="ident" id="1477439">dataOffset</span><span class="op" id="1477449">+</span><span class="ident" id="1477450">bucketCnt</span><span class="op" id="1477459">*</span><span class="num" id="1477460">4</span><span class="op" id="1477461">+</span><span class="ident" id="1477462">i</span><span class="op" id="1477463">*</span><span class="builtintype" id="1477464">uintptr</span><span class="op" id="1477471">(</span><span class="ident" id="1477472">t</span><span class="op" id="1477473">.</span><span class="ident" id="1477474">valuesize</span><span class="op" id="1477483">)</span><span class="op" id="1477484">)</span><span class="op" id="1477485">,</span>&nbsp;<span class="builtintype" id="1477487">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477498">b</span>&nbsp;<span class="op" id="1477500">=</span>&nbsp;<span class="ident" id="1477502">b</span><span class="op" id="1477503">.</span><span class="ident" id="1477504">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477515">if</span>&nbsp;<span class="ident" id="1477518">b</span>&nbsp;<span class="op" id="1477520">==</span>&nbsp;<span class="builtintype" id="1477523">nil</span>&nbsp;<span class="op" id="1477527">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477532">return</span>&nbsp;<span class="ident" id="1477539">unsafe</span><span class="op" id="1477545">.</span><span class="ident" id="1477546">Pointer</span><span class="op" id="1477553">(</span><span class="ident" id="1477554">t</span><span class="op" id="1477555">.</span><span class="ident" id="1477556">elem</span><span class="op" id="1477560">.</span><span class="ident" id="1477561">zero</span><span class="op" id="1477565">)</span><span class="op" id="1477566">,</span>&nbsp;<span class="builtintype" id="1477568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477579">}</span><br>
<span class="lineno"></span><span class="op" id="1477581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1477584">func</span>&nbsp;<span class="ident" id="1477589">mapaccess1_fast64</span><span class="op" id="1477606">(</span><span class="ident" id="1477607">t</span>&nbsp;<span class="op" id="1477609">*</span><span class="ident" id="1477610">maptype</span><span class="op" id="1477617">,</span>&nbsp;<span class="ident" id="1477619">h</span>&nbsp;<span class="op" id="1477621">*</span><span class="ident" id="1477622">hmap</span><span class="op" id="1477626">,</span>&nbsp;<span class="ident" id="1477628">key</span>&nbsp;<span class="builtintype" id="1477632">uint64</span><span class="op" id="1477638">)</span>&nbsp;<span class="ident" id="1477640">unsafe</span><span class="op" id="1477646">.</span><span class="ident" id="1477647">Pointer</span>&nbsp;<span class="op" id="1477655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477658">if</span>&nbsp;<span class="ident" id="1477661">raceenabled</span>&nbsp;<span class="op" id="1477673">&amp;&amp;</span>&nbsp;<span class="ident" id="1477676">h</span>&nbsp;<span class="op" id="1477678">!=</span>&nbsp;<span class="builtintype" id="1477681">nil</span>&nbsp;<span class="op" id="1477685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477689">callerpc</span>&nbsp;<span class="op" id="1477698">:=</span>&nbsp;<span class="ident" id="1477701">getcallerpc</span><span class="op" id="1477712">(</span><span class="ident" id="1477713">unsafe</span><span class="op" id="1477719">.</span><span class="ident" id="1477720">Pointer</span><span class="op" id="1477727">(</span><span class="op" id="1477728">&amp;</span><span class="ident" id="1477729">t</span><span class="op" id="1477730">)</span><span class="op" id="1477731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477735">racereadpc</span><span class="op" id="1477745">(</span><span class="ident" id="1477746">unsafe</span><span class="op" id="1477752">.</span><span class="ident" id="1477753">Pointer</span><span class="op" id="1477760">(</span><span class="ident" id="1477761">h</span><span class="op" id="1477762">)</span><span class="op" id="1477763">,</span>&nbsp;<span class="ident" id="1477765">callerpc</span><span class="op" id="1477773">,</span>&nbsp;<span class="ident" id="1477775">funcPC</span><span class="op" id="1477781">(</span><span class="ident" id="1477782">mapaccess1_fast64</span><span class="op" id="1477799">)</span><span class="op" id="1477800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477803">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477806">if</span>&nbsp;<span class="ident" id="1477809">h</span>&nbsp;<span class="op" id="1477811">==</span>&nbsp;<span class="builtintype" id="1477814">nil</span>&nbsp;<span class="op" id="1477818">||</span>&nbsp;<span class="ident" id="1477821">h</span><span class="op" id="1477822">.</span><span class="ident" id="1477823">count</span>&nbsp;<span class="op" id="1477829">==</span>&nbsp;<span class="num" id="1477832">0</span>&nbsp;<span class="op" id="1477834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477838">return</span>&nbsp;<span class="ident" id="1477845">unsafe</span><span class="op" id="1477851">.</span><span class="ident" id="1477852">Pointer</span><span class="op" id="1477859">(</span><span class="ident" id="1477860">t</span><span class="op" id="1477861">.</span><span class="ident" id="1477862">elem</span><span class="op" id="1477866">.</span><span class="ident" id="1477867">zero</span><span class="op" id="1477871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477877">var</span>&nbsp;<span class="ident" id="1477881">b</span>&nbsp;<span class="op" id="1477883">*</span><span class="ident" id="1477884">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1477890">if</span>&nbsp;<span class="ident" id="1477893">h</span><span class="op" id="1477894">.</span><span class="ident" id="1477895">B</span>&nbsp;<span class="op" id="1477897">==</span>&nbsp;<span class="num" id="1477900">0</span>&nbsp;<span class="op" id="1477902">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1477906">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477947">b</span>&nbsp;<span class="op" id="1477949">=</span>&nbsp;<span class="op" id="1477951">(</span><span class="op" id="1477952">*</span><span class="ident" id="1477953">bmap</span><span class="op" id="1477957">)</span><span class="op" id="1477958">(</span><span class="ident" id="1477959">h</span><span class="op" id="1477960">.</span><span class="ident" id="1477961">buckets</span><span class="op" id="1477968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1477971">}</span>&nbsp;<span class="keyword" id="1477973">else</span>&nbsp;<span class="op" id="1477978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1477982">hash</span>&nbsp;<span class="op" id="1477987">:=</span>&nbsp;<span class="ident" id="1477990">goalg</span><span class="op" id="1477995">(</span><span class="ident" id="1477996">t</span><span class="op" id="1477997">.</span><span class="ident" id="1477998">key</span><span class="op" id="1478001">.</span><span class="ident" id="1478002">alg</span><span class="op" id="1478005">)</span><span class="op" id="1478006">.</span><span class="ident" id="1478007">hash</span><span class="op" id="1478011">(</span><span class="ident" id="1478012">noescape</span><span class="op" id="1478020">(</span><span class="ident" id="1478021">unsafe</span><span class="op" id="1478027">.</span><span class="ident" id="1478028">Pointer</span><span class="op" id="1478035">(</span><span class="op" id="1478036">&amp;</span><span class="ident" id="1478037">key</span><span class="op" id="1478040">)</span><span class="op" id="1478041">)</span><span class="op" id="1478042">,</span>&nbsp;<span class="num" id="1478044">8</span><span class="op" id="1478045">,</span>&nbsp;<span class="builtintype" id="1478047">uintptr</span><span class="op" id="1478054">(</span><span class="ident" id="1478055">h</span><span class="op" id="1478056">.</span><span class="ident" id="1478057">hash0</span><span class="op" id="1478062">)</span><span class="op" id="1478063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478067">m</span>&nbsp;<span class="op" id="1478069">:=</span>&nbsp;<span class="builtintype" id="1478072">uintptr</span><span class="op" id="1478079">(</span><span class="num" id="1478080">1</span><span class="op" id="1478081">)</span><span class="op" id="1478082">&lt;&lt;</span><span class="ident" id="1478084">h</span><span class="op" id="1478085">.</span><span class="ident" id="1478086">B</span>&nbsp;<span class="op" id="1478088">-</span>&nbsp;<span class="num" id="1478090">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478094">b</span>&nbsp;<span class="op" id="1478096">=</span>&nbsp;<span class="op" id="1478098">(</span><span class="op" id="1478099">*</span><span class="ident" id="1478100">bmap</span><span class="op" id="1478104">)</span><span class="op" id="1478105">(</span><span class="ident" id="1478106">add</span><span class="op" id="1478109">(</span><span class="ident" id="1478110">h</span><span class="op" id="1478111">.</span><span class="ident" id="1478112">buckets</span><span class="op" id="1478119">,</span>&nbsp;<span class="op" id="1478121">(</span><span class="ident" id="1478122">hash</span><span class="op" id="1478126">&amp;</span><span class="ident" id="1478127">m</span><span class="op" id="1478128">)</span><span class="op" id="1478129">*</span><span class="builtintype" id="1478130">uintptr</span><span class="op" id="1478137">(</span><span class="ident" id="1478138">t</span><span class="op" id="1478139">.</span><span class="ident" id="1478140">bucketsize</span><span class="op" id="1478150">)</span><span class="op" id="1478151">)</span><span class="op" id="1478152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478156">if</span>&nbsp;<span class="ident" id="1478159">c</span>&nbsp;<span class="op" id="1478161">:=</span>&nbsp;<span class="ident" id="1478164">h</span><span class="op" id="1478165">.</span><span class="ident" id="1478166">oldbuckets</span><span class="op" id="1478176">;</span>&nbsp;<span class="ident" id="1478178">c</span>&nbsp;<span class="op" id="1478180">!=</span>&nbsp;<span class="builtintype" id="1478183">nil</span>&nbsp;<span class="op" id="1478187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478192">oldb</span>&nbsp;<span class="op" id="1478197">:=</span>&nbsp;<span class="op" id="1478200">(</span><span class="op" id="1478201">*</span><span class="ident" id="1478202">bmap</span><span class="op" id="1478206">)</span><span class="op" id="1478207">(</span><span class="ident" id="1478208">add</span><span class="op" id="1478211">(</span><span class="ident" id="1478212">c</span><span class="op" id="1478213">,</span>&nbsp;<span class="op" id="1478215">(</span><span class="ident" id="1478216">hash</span><span class="op" id="1478220">&amp;</span><span class="op" id="1478221">(</span><span class="ident" id="1478222">m</span><span class="op" id="1478223">&gt;&gt;</span><span class="num" id="1478225">1</span><span class="op" id="1478226">)</span><span class="op" id="1478227">)</span><span class="op" id="1478228">*</span><span class="builtintype" id="1478229">uintptr</span><span class="op" id="1478236">(</span><span class="ident" id="1478237">t</span><span class="op" id="1478238">.</span><span class="ident" id="1478239">bucketsize</span><span class="op" id="1478249">)</span><span class="op" id="1478250">)</span><span class="op" id="1478251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478256">if</span>&nbsp;<span class="op" id="1478259">!</span><span class="ident" id="1478260">evacuated</span><span class="op" id="1478269">(</span><span class="ident" id="1478270">oldb</span><span class="op" id="1478274">)</span>&nbsp;<span class="op" id="1478276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478282">b</span>&nbsp;<span class="op" id="1478284">=</span>&nbsp;<span class="ident" id="1478286">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478304">for</span>&nbsp;<span class="op" id="1478308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478312">for</span>&nbsp;<span class="ident" id="1478316">i</span>&nbsp;<span class="op" id="1478318">:=</span>&nbsp;<span class="builtintype" id="1478321">uintptr</span><span class="op" id="1478328">(</span><span class="num" id="1478329">0</span><span class="op" id="1478330">)</span><span class="op" id="1478331">;</span>&nbsp;<span class="ident" id="1478333">i</span>&nbsp;<span class="op" id="1478335">&lt;</span>&nbsp;<span class="ident" id="1478337">bucketCnt</span><span class="op" id="1478346">;</span>&nbsp;<span class="ident" id="1478348">i</span><span class="op" id="1478349">++</span>&nbsp;<span class="op" id="1478352">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478357">k</span>&nbsp;<span class="op" id="1478359">:=</span>&nbsp;<span class="op" id="1478362">*</span><span class="op" id="1478363">(</span><span class="op" id="1478364">(</span><span class="op" id="1478365">*</span><span class="builtintype" id="1478366">uint64</span><span class="op" id="1478372">)</span><span class="op" id="1478373">(</span><span class="ident" id="1478374">add</span><span class="op" id="1478377">(</span><span class="ident" id="1478378">unsafe</span><span class="op" id="1478384">.</span><span class="ident" id="1478385">Pointer</span><span class="op" id="1478392">(</span><span class="ident" id="1478393">b</span><span class="op" id="1478394">)</span><span class="op" id="1478395">,</span>&nbsp;<span class="ident" id="1478397">dataOffset</span><span class="op" id="1478407">+</span><span class="ident" id="1478408">i</span><span class="op" id="1478409">*</span><span class="num" id="1478410">8</span><span class="op" id="1478411">)</span><span class="op" id="1478412">)</span><span class="op" id="1478413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478418">if</span>&nbsp;<span class="ident" id="1478421">k</span>&nbsp;<span class="op" id="1478423">!=</span>&nbsp;<span class="ident" id="1478426">key</span>&nbsp;<span class="op" id="1478430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478436">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478453">x</span>&nbsp;<span class="op" id="1478455">:=</span>&nbsp;<span class="op" id="1478458">*</span><span class="op" id="1478459">(</span><span class="op" id="1478460">(</span><span class="op" id="1478461">*</span><span class="builtintype" id="1478462">uint8</span><span class="op" id="1478467">)</span><span class="op" id="1478468">(</span><span class="ident" id="1478469">add</span><span class="op" id="1478472">(</span><span class="ident" id="1478473">unsafe</span><span class="op" id="1478479">.</span><span class="ident" id="1478480">Pointer</span><span class="op" id="1478487">(</span><span class="ident" id="1478488">b</span><span class="op" id="1478489">)</span><span class="op" id="1478490">,</span>&nbsp;<span class="ident" id="1478492">i</span><span class="op" id="1478493">)</span><span class="op" id="1478494">)</span><span class="op" id="1478495">)</span>&nbsp;<span class="comment" id="1478497">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478541">if</span>&nbsp;<span class="ident" id="1478544">x</span>&nbsp;<span class="op" id="1478546">==</span>&nbsp;<span class="ident" id="1478549">empty</span>&nbsp;<span class="op" id="1478555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478561">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478578">return</span>&nbsp;<span class="ident" id="1478585">add</span><span class="op" id="1478588">(</span><span class="ident" id="1478589">unsafe</span><span class="op" id="1478595">.</span><span class="ident" id="1478596">Pointer</span><span class="op" id="1478603">(</span><span class="ident" id="1478604">b</span><span class="op" id="1478605">)</span><span class="op" id="1478606">,</span>&nbsp;<span class="ident" id="1478608">dataOffset</span><span class="op" id="1478618">+</span><span class="ident" id="1478619">bucketCnt</span><span class="op" id="1478628">*</span><span class="num" id="1478629">8</span><span class="op" id="1478630">+</span><span class="ident" id="1478631">i</span><span class="op" id="1478632">*</span><span class="builtintype" id="1478633">uintptr</span><span class="op" id="1478640">(</span><span class="ident" id="1478641">t</span><span class="op" id="1478642">.</span><span class="ident" id="1478643">valuesize</span><span class="op" id="1478652">)</span><span class="op" id="1478653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478657">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478661">b</span>&nbsp;<span class="op" id="1478663">=</span>&nbsp;<span class="ident" id="1478665">b</span><span class="op" id="1478666">.</span><span class="ident" id="1478667">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478678">if</span>&nbsp;<span class="ident" id="1478681">b</span>&nbsp;<span class="op" id="1478683">==</span>&nbsp;<span class="builtintype" id="1478686">nil</span>&nbsp;<span class="op" id="1478690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478695">return</span>&nbsp;<span class="ident" id="1478702">unsafe</span><span class="op" id="1478708">.</span><span class="ident" id="1478709">Pointer</span><span class="op" id="1478716">(</span><span class="ident" id="1478717">t</span><span class="op" id="1478718">.</span><span class="ident" id="1478719">elem</span><span class="op" id="1478723">.</span><span class="ident" id="1478724">zero</span><span class="op" id="1478728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478735">}</span><br>
<span class="lineno">135</span><span class="op" id="1478737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1478740">func</span>&nbsp;<span class="ident" id="1478745">mapaccess2_fast64</span><span class="op" id="1478762">(</span><span class="ident" id="1478763">t</span>&nbsp;<span class="op" id="1478765">*</span><span class="ident" id="1478766">maptype</span><span class="op" id="1478773">,</span>&nbsp;<span class="ident" id="1478775">h</span>&nbsp;<span class="op" id="1478777">*</span><span class="ident" id="1478778">hmap</span><span class="op" id="1478782">,</span>&nbsp;<span class="ident" id="1478784">key</span>&nbsp;<span class="builtintype" id="1478788">uint64</span><span class="op" id="1478794">)</span>&nbsp;<span class="op" id="1478796">(</span><span class="ident" id="1478797">unsafe</span><span class="op" id="1478803">.</span><span class="ident" id="1478804">Pointer</span><span class="op" id="1478811">,</span>&nbsp;<span class="builtintype" id="1478813">bool</span><span class="op" id="1478817">)</span>&nbsp;<span class="op" id="1478819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478822">if</span>&nbsp;<span class="ident" id="1478825">raceenabled</span>&nbsp;<span class="op" id="1478837">&amp;&amp;</span>&nbsp;<span class="ident" id="1478840">h</span>&nbsp;<span class="op" id="1478842">!=</span>&nbsp;<span class="builtintype" id="1478845">nil</span>&nbsp;<span class="op" id="1478849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478853">callerpc</span>&nbsp;<span class="op" id="1478862">:=</span>&nbsp;<span class="ident" id="1478865">getcallerpc</span><span class="op" id="1478876">(</span><span class="ident" id="1478877">unsafe</span><span class="op" id="1478883">.</span><span class="ident" id="1478884">Pointer</span><span class="op" id="1478891">(</span><span class="op" id="1478892">&amp;</span><span class="ident" id="1478893">t</span><span class="op" id="1478894">)</span><span class="op" id="1478895">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478899">racereadpc</span><span class="op" id="1478909">(</span><span class="ident" id="1478910">unsafe</span><span class="op" id="1478916">.</span><span class="ident" id="1478917">Pointer</span><span class="op" id="1478924">(</span><span class="ident" id="1478925">h</span><span class="op" id="1478926">)</span><span class="op" id="1478927">,</span>&nbsp;<span class="ident" id="1478929">callerpc</span><span class="op" id="1478937">,</span>&nbsp;<span class="ident" id="1478939">funcPC</span><span class="op" id="1478945">(</span><span class="ident" id="1478946">mapaccess2_fast64</span><span class="op" id="1478963">)</span><span class="op" id="1478964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1478970">if</span>&nbsp;<span class="ident" id="1478973">h</span>&nbsp;<span class="op" id="1478975">==</span>&nbsp;<span class="builtintype" id="1478978">nil</span>&nbsp;<span class="op" id="1478982">||</span>&nbsp;<span class="ident" id="1478985">h</span><span class="op" id="1478986">.</span><span class="ident" id="1478987">count</span>&nbsp;<span class="op" id="1478993">==</span>&nbsp;<span class="num" id="1478996">0</span>&nbsp;<span class="op" id="1478998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479002">return</span>&nbsp;<span class="ident" id="1479009">unsafe</span><span class="op" id="1479015">.</span><span class="ident" id="1479016">Pointer</span><span class="op" id="1479023">(</span><span class="ident" id="1479024">t</span><span class="op" id="1479025">.</span><span class="ident" id="1479026">elem</span><span class="op" id="1479030">.</span><span class="ident" id="1479031">zero</span><span class="op" id="1479035">)</span><span class="op" id="1479036">,</span>&nbsp;<span class="builtintype" id="1479038">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479045">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479048">var</span>&nbsp;<span class="ident" id="1479052">b</span>&nbsp;<span class="op" id="1479054">*</span><span class="ident" id="1479055">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479061">if</span>&nbsp;<span class="ident" id="1479064">h</span><span class="op" id="1479065">.</span><span class="ident" id="1479066">B</span>&nbsp;<span class="op" id="1479068">==</span>&nbsp;<span class="num" id="1479071">0</span>&nbsp;<span class="op" id="1479073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1479077">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479118">b</span>&nbsp;<span class="op" id="1479120">=</span>&nbsp;<span class="op" id="1479122">(</span><span class="op" id="1479123">*</span><span class="ident" id="1479124">bmap</span><span class="op" id="1479128">)</span><span class="op" id="1479129">(</span><span class="ident" id="1479130">h</span><span class="op" id="1479131">.</span><span class="ident" id="1479132">buckets</span><span class="op" id="1479139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479142">}</span>&nbsp;<span class="keyword" id="1479144">else</span>&nbsp;<span class="op" id="1479149">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479153">hash</span>&nbsp;<span class="op" id="1479158">:=</span>&nbsp;<span class="ident" id="1479161">goalg</span><span class="op" id="1479166">(</span><span class="ident" id="1479167">t</span><span class="op" id="1479168">.</span><span class="ident" id="1479169">key</span><span class="op" id="1479172">.</span><span class="ident" id="1479173">alg</span><span class="op" id="1479176">)</span><span class="op" id="1479177">.</span><span class="ident" id="1479178">hash</span><span class="op" id="1479182">(</span><span class="ident" id="1479183">noescape</span><span class="op" id="1479191">(</span><span class="ident" id="1479192">unsafe</span><span class="op" id="1479198">.</span><span class="ident" id="1479199">Pointer</span><span class="op" id="1479206">(</span><span class="op" id="1479207">&amp;</span><span class="ident" id="1479208">key</span><span class="op" id="1479211">)</span><span class="op" id="1479212">)</span><span class="op" id="1479213">,</span>&nbsp;<span class="num" id="1479215">8</span><span class="op" id="1479216">,</span>&nbsp;<span class="builtintype" id="1479218">uintptr</span><span class="op" id="1479225">(</span><span class="ident" id="1479226">h</span><span class="op" id="1479227">.</span><span class="ident" id="1479228">hash0</span><span class="op" id="1479233">)</span><span class="op" id="1479234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479238">m</span>&nbsp;<span class="op" id="1479240">:=</span>&nbsp;<span class="builtintype" id="1479243">uintptr</span><span class="op" id="1479250">(</span><span class="num" id="1479251">1</span><span class="op" id="1479252">)</span><span class="op" id="1479253">&lt;&lt;</span><span class="ident" id="1479255">h</span><span class="op" id="1479256">.</span><span class="ident" id="1479257">B</span>&nbsp;<span class="op" id="1479259">-</span>&nbsp;<span class="num" id="1479261">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479265">b</span>&nbsp;<span class="op" id="1479267">=</span>&nbsp;<span class="op" id="1479269">(</span><span class="op" id="1479270">*</span><span class="ident" id="1479271">bmap</span><span class="op" id="1479275">)</span><span class="op" id="1479276">(</span><span class="ident" id="1479277">add</span><span class="op" id="1479280">(</span><span class="ident" id="1479281">h</span><span class="op" id="1479282">.</span><span class="ident" id="1479283">buckets</span><span class="op" id="1479290">,</span>&nbsp;<span class="op" id="1479292">(</span><span class="ident" id="1479293">hash</span><span class="op" id="1479297">&amp;</span><span class="ident" id="1479298">m</span><span class="op" id="1479299">)</span><span class="op" id="1479300">*</span><span class="builtintype" id="1479301">uintptr</span><span class="op" id="1479308">(</span><span class="ident" id="1479309">t</span><span class="op" id="1479310">.</span><span class="ident" id="1479311">bucketsize</span><span class="op" id="1479321">)</span><span class="op" id="1479322">)</span><span class="op" id="1479323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479327">if</span>&nbsp;<span class="ident" id="1479330">c</span>&nbsp;<span class="op" id="1479332">:=</span>&nbsp;<span class="ident" id="1479335">h</span><span class="op" id="1479336">.</span><span class="ident" id="1479337">oldbuckets</span><span class="op" id="1479347">;</span>&nbsp;<span class="ident" id="1479349">c</span>&nbsp;<span class="op" id="1479351">!=</span>&nbsp;<span class="builtintype" id="1479354">nil</span>&nbsp;<span class="op" id="1479358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479363">oldb</span>&nbsp;<span class="op" id="1479368">:=</span>&nbsp;<span class="op" id="1479371">(</span><span class="op" id="1479372">*</span><span class="ident" id="1479373">bmap</span><span class="op" id="1479377">)</span><span class="op" id="1479378">(</span><span class="ident" id="1479379">add</span><span class="op" id="1479382">(</span><span class="ident" id="1479383">c</span><span class="op" id="1479384">,</span>&nbsp;<span class="op" id="1479386">(</span><span class="ident" id="1479387">hash</span><span class="op" id="1479391">&amp;</span><span class="op" id="1479392">(</span><span class="ident" id="1479393">m</span><span class="op" id="1479394">&gt;&gt;</span><span class="num" id="1479396">1</span><span class="op" id="1479397">)</span><span class="op" id="1479398">)</span><span class="op" id="1479399">*</span><span class="builtintype" id="1479400">uintptr</span><span class="op" id="1479407">(</span><span class="ident" id="1479408">t</span><span class="op" id="1479409">.</span><span class="ident" id="1479410">bucketsize</span><span class="op" id="1479420">)</span><span class="op" id="1479421">)</span><span class="op" id="1479422">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479427">if</span>&nbsp;<span class="op" id="1479430">!</span><span class="ident" id="1479431">evacuated</span><span class="op" id="1479440">(</span><span class="ident" id="1479441">oldb</span><span class="op" id="1479445">)</span>&nbsp;<span class="op" id="1479447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479453">b</span>&nbsp;<span class="op" id="1479455">=</span>&nbsp;<span class="ident" id="1479457">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479472">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479475">for</span>&nbsp;<span class="op" id="1479479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479483">for</span>&nbsp;<span class="ident" id="1479487">i</span>&nbsp;<span class="op" id="1479489">:=</span>&nbsp;<span class="builtintype" id="1479492">uintptr</span><span class="op" id="1479499">(</span><span class="num" id="1479500">0</span><span class="op" id="1479501">)</span><span class="op" id="1479502">;</span>&nbsp;<span class="ident" id="1479504">i</span>&nbsp;<span class="op" id="1479506">&lt;</span>&nbsp;<span class="ident" id="1479508">bucketCnt</span><span class="op" id="1479517">;</span>&nbsp;<span class="ident" id="1479519">i</span><span class="op" id="1479520">++</span>&nbsp;<span class="op" id="1479523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479528">k</span>&nbsp;<span class="op" id="1479530">:=</span>&nbsp;<span class="op" id="1479533">*</span><span class="op" id="1479534">(</span><span class="op" id="1479535">(</span><span class="op" id="1479536">*</span><span class="builtintype" id="1479537">uint64</span><span class="op" id="1479543">)</span><span class="op" id="1479544">(</span><span class="ident" id="1479545">add</span><span class="op" id="1479548">(</span><span class="ident" id="1479549">unsafe</span><span class="op" id="1479555">.</span><span class="ident" id="1479556">Pointer</span><span class="op" id="1479563">(</span><span class="ident" id="1479564">b</span><span class="op" id="1479565">)</span><span class="op" id="1479566">,</span>&nbsp;<span class="ident" id="1479568">dataOffset</span><span class="op" id="1479578">+</span><span class="ident" id="1479579">i</span><span class="op" id="1479580">*</span><span class="num" id="1479581">8</span><span class="op" id="1479582">)</span><span class="op" id="1479583">)</span><span class="op" id="1479584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479589">if</span>&nbsp;<span class="ident" id="1479592">k</span>&nbsp;<span class="op" id="1479594">!=</span>&nbsp;<span class="ident" id="1479597">key</span>&nbsp;<span class="op" id="1479601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479607">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479624">x</span>&nbsp;<span class="op" id="1479626">:=</span>&nbsp;<span class="op" id="1479629">*</span><span class="op" id="1479630">(</span><span class="op" id="1479631">(</span><span class="op" id="1479632">*</span><span class="builtintype" id="1479633">uint8</span><span class="op" id="1479638">)</span><span class="op" id="1479639">(</span><span class="ident" id="1479640">add</span><span class="op" id="1479643">(</span><span class="ident" id="1479644">unsafe</span><span class="op" id="1479650">.</span><span class="ident" id="1479651">Pointer</span><span class="op" id="1479658">(</span><span class="ident" id="1479659">b</span><span class="op" id="1479660">)</span><span class="op" id="1479661">,</span>&nbsp;<span class="ident" id="1479663">i</span><span class="op" id="1479664">)</span><span class="op" id="1479665">)</span><span class="op" id="1479666">)</span>&nbsp;<span class="comment" id="1479668">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479712">if</span>&nbsp;<span class="ident" id="1479715">x</span>&nbsp;<span class="op" id="1479717">==</span>&nbsp;<span class="ident" id="1479720">empty</span>&nbsp;<span class="op" id="1479726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479732">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479744">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479749">return</span>&nbsp;<span class="ident" id="1479756">add</span><span class="op" id="1479759">(</span><span class="ident" id="1479760">unsafe</span><span class="op" id="1479766">.</span><span class="ident" id="1479767">Pointer</span><span class="op" id="1479774">(</span><span class="ident" id="1479775">b</span><span class="op" id="1479776">)</span><span class="op" id="1479777">,</span>&nbsp;<span class="ident" id="1479779">dataOffset</span><span class="op" id="1479789">+</span><span class="ident" id="1479790">bucketCnt</span><span class="op" id="1479799">*</span><span class="num" id="1479800">8</span><span class="op" id="1479801">+</span><span class="ident" id="1479802">i</span><span class="op" id="1479803">*</span><span class="builtintype" id="1479804">uintptr</span><span class="op" id="1479811">(</span><span class="ident" id="1479812">t</span><span class="op" id="1479813">.</span><span class="ident" id="1479814">valuesize</span><span class="op" id="1479823">)</span><span class="op" id="1479824">)</span><span class="op" id="1479825">,</span>&nbsp;<span class="builtintype" id="1479827">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1479838">b</span>&nbsp;<span class="op" id="1479840">=</span>&nbsp;<span class="ident" id="1479842">b</span><span class="op" id="1479843">.</span><span class="ident" id="1479844">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479855">if</span>&nbsp;<span class="ident" id="1479858">b</span>&nbsp;<span class="op" id="1479860">==</span>&nbsp;<span class="builtintype" id="1479863">nil</span>&nbsp;<span class="op" id="1479867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479872">return</span>&nbsp;<span class="ident" id="1479879">unsafe</span><span class="op" id="1479885">.</span><span class="ident" id="1479886">Pointer</span><span class="op" id="1479893">(</span><span class="ident" id="1479894">t</span><span class="op" id="1479895">.</span><span class="ident" id="1479896">elem</span><span class="op" id="1479900">.</span><span class="ident" id="1479901">zero</span><span class="op" id="1479905">)</span><span class="op" id="1479906">,</span>&nbsp;<span class="builtintype" id="1479908">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1479919">}</span><br>
<span class="lineno"></span><span class="op" id="1479921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1479924">func</span>&nbsp;<span class="ident" id="1479929">mapaccess1_faststr</span><span class="op" id="1479947">(</span><span class="ident" id="1479948">t</span>&nbsp;<span class="op" id="1479950">*</span><span class="ident" id="1479951">maptype</span><span class="op" id="1479958">,</span>&nbsp;<span class="ident" id="1479960">h</span>&nbsp;<span class="op" id="1479962">*</span><span class="ident" id="1479963">hmap</span><span class="op" id="1479967">,</span>&nbsp;<span class="ident" id="1479969">ky</span>&nbsp;<span class="builtintype" id="1479972">string</span><span class="op" id="1479978">)</span>&nbsp;<span class="ident" id="1479980">unsafe</span><span class="op" id="1479986">.</span><span class="ident" id="1479987">Pointer</span>&nbsp;<span class="op" id="1479995">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1479998">if</span>&nbsp;<span class="ident" id="1480001">raceenabled</span>&nbsp;<span class="op" id="1480013">&amp;&amp;</span>&nbsp;<span class="ident" id="1480016">h</span>&nbsp;<span class="op" id="1480018">!=</span>&nbsp;<span class="builtintype" id="1480021">nil</span>&nbsp;<span class="op" id="1480025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480029">callerpc</span>&nbsp;<span class="op" id="1480038">:=</span>&nbsp;<span class="ident" id="1480041">getcallerpc</span><span class="op" id="1480052">(</span><span class="ident" id="1480053">unsafe</span><span class="op" id="1480059">.</span><span class="ident" id="1480060">Pointer</span><span class="op" id="1480067">(</span><span class="op" id="1480068">&amp;</span><span class="ident" id="1480069">t</span><span class="op" id="1480070">)</span><span class="op" id="1480071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480075">racereadpc</span><span class="op" id="1480085">(</span><span class="ident" id="1480086">unsafe</span><span class="op" id="1480092">.</span><span class="ident" id="1480093">Pointer</span><span class="op" id="1480100">(</span><span class="ident" id="1480101">h</span><span class="op" id="1480102">)</span><span class="op" id="1480103">,</span>&nbsp;<span class="ident" id="1480105">callerpc</span><span class="op" id="1480113">,</span>&nbsp;<span class="ident" id="1480115">funcPC</span><span class="op" id="1480121">(</span><span class="ident" id="1480122">mapaccess1_faststr</span><span class="op" id="1480140">)</span><span class="op" id="1480141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480147">if</span>&nbsp;<span class="ident" id="1480150">h</span>&nbsp;<span class="op" id="1480152">==</span>&nbsp;<span class="builtintype" id="1480155">nil</span>&nbsp;<span class="op" id="1480159">||</span>&nbsp;<span class="ident" id="1480162">h</span><span class="op" id="1480163">.</span><span class="ident" id="1480164">count</span>&nbsp;<span class="op" id="1480170">==</span>&nbsp;<span class="num" id="1480173">0</span>&nbsp;<span class="op" id="1480175">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480179">return</span>&nbsp;<span class="ident" id="1480186">unsafe</span><span class="op" id="1480192">.</span><span class="ident" id="1480193">Pointer</span><span class="op" id="1480200">(</span><span class="ident" id="1480201">t</span><span class="op" id="1480202">.</span><span class="ident" id="1480203">elem</span><span class="op" id="1480207">.</span><span class="ident" id="1480208">zero</span><span class="op" id="1480212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480218">key</span>&nbsp;<span class="op" id="1480222">:=</span>&nbsp;<span class="op" id="1480225">(</span><span class="op" id="1480226">*</span><span class="ident" id="1480227">stringStruct</span><span class="op" id="1480239">)</span><span class="op" id="1480240">(</span><span class="ident" id="1480241">unsafe</span><span class="op" id="1480247">.</span><span class="ident" id="1480248">Pointer</span><span class="op" id="1480255">(</span><span class="op" id="1480256">&amp;</span><span class="ident" id="1480257">ky</span><span class="op" id="1480259">)</span><span class="op" id="1480260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480263">if</span>&nbsp;<span class="ident" id="1480266">h</span><span class="op" id="1480267">.</span><span class="ident" id="1480268">B</span>&nbsp;<span class="op" id="1480270">==</span>&nbsp;<span class="num" id="1480273">0</span>&nbsp;<span class="op" id="1480275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1480279">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480302">b</span>&nbsp;<span class="op" id="1480304">:=</span>&nbsp;<span class="op" id="1480307">(</span><span class="op" id="1480308">*</span><span class="ident" id="1480309">bmap</span><span class="op" id="1480313">)</span><span class="op" id="1480314">(</span><span class="ident" id="1480315">h</span><span class="op" id="1480316">.</span><span class="ident" id="1480317">buckets</span><span class="op" id="1480324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480328">if</span>&nbsp;<span class="ident" id="1480331">key</span><span class="op" id="1480334">.</span><span class="builtinfunc" id="1480335">len</span>&nbsp;<span class="op" id="1480339">&lt;</span>&nbsp;<span class="num" id="1480341">32</span>&nbsp;<span class="op" id="1480344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1480349">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480398">for</span>&nbsp;<span class="ident" id="1480402">i</span>&nbsp;<span class="op" id="1480404">:=</span>&nbsp;<span class="builtintype" id="1480407">uintptr</span><span class="op" id="1480414">(</span><span class="num" id="1480415">0</span><span class="op" id="1480416">)</span><span class="op" id="1480417">;</span>&nbsp;<span class="ident" id="1480419">i</span>&nbsp;<span class="op" id="1480421">&lt;</span>&nbsp;<span class="ident" id="1480423">bucketCnt</span><span class="op" id="1480432">;</span>&nbsp;<span class="ident" id="1480434">i</span><span class="op" id="1480435">++</span>&nbsp;<span class="op" id="1480438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480444">x</span>&nbsp;<span class="op" id="1480446">:=</span>&nbsp;<span class="op" id="1480449">*</span><span class="op" id="1480450">(</span><span class="op" id="1480451">(</span><span class="op" id="1480452">*</span><span class="builtintype" id="1480453">uint8</span><span class="op" id="1480458">)</span><span class="op" id="1480459">(</span><span class="ident" id="1480460">add</span><span class="op" id="1480463">(</span><span class="ident" id="1480464">unsafe</span><span class="op" id="1480470">.</span><span class="ident" id="1480471">Pointer</span><span class="op" id="1480478">(</span><span class="ident" id="1480479">b</span><span class="op" id="1480480">)</span><span class="op" id="1480481">,</span>&nbsp;<span class="ident" id="1480483">i</span><span class="op" id="1480484">)</span><span class="op" id="1480485">)</span><span class="op" id="1480486">)</span>&nbsp;<span class="comment" id="1480488">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480533">if</span>&nbsp;<span class="ident" id="1480536">x</span>&nbsp;<span class="op" id="1480538">==</span>&nbsp;<span class="ident" id="1480541">empty</span>&nbsp;<span class="op" id="1480547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480554">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480573">k</span>&nbsp;<span class="op" id="1480575">:=</span>&nbsp;<span class="op" id="1480578">(</span><span class="op" id="1480579">*</span><span class="ident" id="1480580">stringStruct</span><span class="op" id="1480592">)</span><span class="op" id="1480593">(</span><span class="ident" id="1480594">add</span><span class="op" id="1480597">(</span><span class="ident" id="1480598">unsafe</span><span class="op" id="1480604">.</span><span class="ident" id="1480605">Pointer</span><span class="op" id="1480612">(</span><span class="ident" id="1480613">b</span><span class="op" id="1480614">)</span><span class="op" id="1480615">,</span>&nbsp;<span class="ident" id="1480617">dataOffset</span><span class="op" id="1480627">+</span><span class="ident" id="1480628">i</span><span class="op" id="1480629">*</span><span class="num" id="1480630">2</span><span class="op" id="1480631">*</span><span class="ident" id="1480632">ptrSize</span><span class="op" id="1480639">)</span><span class="op" id="1480640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480646">if</span>&nbsp;<span class="ident" id="1480649">k</span><span class="op" id="1480650">.</span><span class="builtinfunc" id="1480651">len</span>&nbsp;<span class="op" id="1480655">!=</span>&nbsp;<span class="ident" id="1480658">key</span><span class="op" id="1480661">.</span><span class="builtinfunc" id="1480662">len</span>&nbsp;<span class="op" id="1480666">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480673">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480692">if</span>&nbsp;<span class="ident" id="1480695">k</span><span class="op" id="1480696">.</span><span class="ident" id="1480697">str</span>&nbsp;<span class="op" id="1480701">==</span>&nbsp;<span class="ident" id="1480704">key</span><span class="op" id="1480707">.</span><span class="ident" id="1480708">str</span>&nbsp;<span class="op" id="1480712">||</span>&nbsp;<span class="ident" id="1480715">memeq</span><span class="op" id="1480720">(</span><span class="ident" id="1480721">k</span><span class="op" id="1480722">.</span><span class="ident" id="1480723">str</span><span class="op" id="1480726">,</span>&nbsp;<span class="ident" id="1480728">key</span><span class="op" id="1480731">.</span><span class="ident" id="1480732">str</span><span class="op" id="1480735">,</span>&nbsp;<span class="builtintype" id="1480737">uintptr</span><span class="op" id="1480744">(</span><span class="ident" id="1480745">key</span><span class="op" id="1480748">.</span><span class="builtinfunc" id="1480749">len</span><span class="op" id="1480752">)</span><span class="op" id="1480753">)</span>&nbsp;<span class="op" id="1480755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480762">return</span>&nbsp;<span class="ident" id="1480769">add</span><span class="op" id="1480772">(</span><span class="ident" id="1480773">unsafe</span><span class="op" id="1480779">.</span><span class="ident" id="1480780">Pointer</span><span class="op" id="1480787">(</span><span class="ident" id="1480788">b</span><span class="op" id="1480789">)</span><span class="op" id="1480790">,</span>&nbsp;<span class="ident" id="1480792">dataOffset</span><span class="op" id="1480802">+</span><span class="ident" id="1480803">bucketCnt</span><span class="op" id="1480812">*</span><span class="num" id="1480813">2</span><span class="op" id="1480814">*</span><span class="ident" id="1480815">ptrSize</span><span class="op" id="1480822">+</span><span class="ident" id="1480823">i</span><span class="op" id="1480824">*</span><span class="builtintype" id="1480825">uintptr</span><span class="op" id="1480832">(</span><span class="ident" id="1480833">t</span><span class="op" id="1480834">.</span><span class="ident" id="1480835">valuesize</span><span class="op" id="1480844">)</span><span class="op" id="1480845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480851">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480861">return</span>&nbsp;<span class="ident" id="1480868">unsafe</span><span class="op" id="1480874">.</span><span class="ident" id="1480875">Pointer</span><span class="op" id="1480882">(</span><span class="ident" id="1480883">t</span><span class="op" id="1480884">.</span><span class="ident" id="1480885">elem</span><span class="op" id="1480889">.</span><span class="ident" id="1480890">zero</span><span class="op" id="1480894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1480902">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480963">keymaybe</span>&nbsp;<span class="op" id="1480972">:=</span>&nbsp;<span class="builtintype" id="1480975">uintptr</span><span class="op" id="1480982">(</span><span class="ident" id="1480983">bucketCnt</span><span class="op" id="1480992">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480996">for</span>&nbsp;<span class="ident" id="1481000">i</span>&nbsp;<span class="op" id="1481002">:=</span>&nbsp;<span class="builtintype" id="1481005">uintptr</span><span class="op" id="1481012">(</span><span class="num" id="1481013">0</span><span class="op" id="1481014">)</span><span class="op" id="1481015">;</span>&nbsp;<span class="ident" id="1481017">i</span>&nbsp;<span class="op" id="1481019">&lt;</span>&nbsp;<span class="ident" id="1481021">bucketCnt</span><span class="op" id="1481030">;</span>&nbsp;<span class="ident" id="1481032">i</span><span class="op" id="1481033">++</span>&nbsp;<span class="op" id="1481036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481041">x</span>&nbsp;<span class="op" id="1481043">:=</span>&nbsp;<span class="op" id="1481046">*</span><span class="op" id="1481047">(</span><span class="op" id="1481048">(</span><span class="op" id="1481049">*</span><span class="builtintype" id="1481050">uint8</span><span class="op" id="1481055">)</span><span class="op" id="1481056">(</span><span class="ident" id="1481057">add</span><span class="op" id="1481060">(</span><span class="ident" id="1481061">unsafe</span><span class="op" id="1481067">.</span><span class="ident" id="1481068">Pointer</span><span class="op" id="1481075">(</span><span class="ident" id="1481076">b</span><span class="op" id="1481077">)</span><span class="op" id="1481078">,</span>&nbsp;<span class="ident" id="1481080">i</span><span class="op" id="1481081">)</span><span class="op" id="1481082">)</span><span class="op" id="1481083">)</span>&nbsp;<span class="comment" id="1481085">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481129">if</span>&nbsp;<span class="ident" id="1481132">x</span>&nbsp;<span class="op" id="1481134">==</span>&nbsp;<span class="ident" id="1481137">empty</span>&nbsp;<span class="op" id="1481143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481149">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481161">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481166">k</span>&nbsp;<span class="op" id="1481168">:=</span>&nbsp;<span class="op" id="1481171">(</span><span class="op" id="1481172">*</span><span class="ident" id="1481173">stringStruct</span><span class="op" id="1481185">)</span><span class="op" id="1481186">(</span><span class="ident" id="1481187">add</span><span class="op" id="1481190">(</span><span class="ident" id="1481191">unsafe</span><span class="op" id="1481197">.</span><span class="ident" id="1481198">Pointer</span><span class="op" id="1481205">(</span><span class="ident" id="1481206">b</span><span class="op" id="1481207">)</span><span class="op" id="1481208">,</span>&nbsp;<span class="ident" id="1481210">dataOffset</span><span class="op" id="1481220">+</span><span class="ident" id="1481221">i</span><span class="op" id="1481222">*</span><span class="num" id="1481223">2</span><span class="op" id="1481224">*</span><span class="ident" id="1481225">ptrSize</span><span class="op" id="1481232">)</span><span class="op" id="1481233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481238">if</span>&nbsp;<span class="ident" id="1481241">k</span><span class="op" id="1481242">.</span><span class="builtinfunc" id="1481243">len</span>&nbsp;<span class="op" id="1481247">!=</span>&nbsp;<span class="ident" id="1481250">key</span><span class="op" id="1481253">.</span><span class="builtinfunc" id="1481254">len</span>&nbsp;<span class="op" id="1481258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481264">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481281">if</span>&nbsp;<span class="ident" id="1481284">k</span><span class="op" id="1481285">.</span><span class="ident" id="1481286">str</span>&nbsp;<span class="op" id="1481290">==</span>&nbsp;<span class="ident" id="1481293">key</span><span class="op" id="1481296">.</span><span class="ident" id="1481297">str</span>&nbsp;<span class="op" id="1481301">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481307">return</span>&nbsp;<span class="ident" id="1481314">add</span><span class="op" id="1481317">(</span><span class="ident" id="1481318">unsafe</span><span class="op" id="1481324">.</span><span class="ident" id="1481325">Pointer</span><span class="op" id="1481332">(</span><span class="ident" id="1481333">b</span><span class="op" id="1481334">)</span><span class="op" id="1481335">,</span>&nbsp;<span class="ident" id="1481337">dataOffset</span><span class="op" id="1481347">+</span><span class="ident" id="1481348">bucketCnt</span><span class="op" id="1481357">*</span><span class="num" id="1481358">2</span><span class="op" id="1481359">*</span><span class="ident" id="1481360">ptrSize</span><span class="op" id="1481367">+</span><span class="ident" id="1481368">i</span><span class="op" id="1481369">*</span><span class="builtintype" id="1481370">uintptr</span><span class="op" id="1481377">(</span><span class="ident" id="1481378">t</span><span class="op" id="1481379">.</span><span class="ident" id="1481380">valuesize</span><span class="op" id="1481389">)</span><span class="op" id="1481390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481400">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481426">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481515">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481546">if</span>&nbsp;<span class="op" id="1481549">*</span><span class="op" id="1481550">(</span><span class="op" id="1481551">(</span><span class="op" id="1481552">*</span><span class="op" id="1481553">[</span><span class="num" id="1481554">4</span><span class="op" id="1481555">]</span><span class="builtintype" id="1481556">byte</span><span class="op" id="1481560">)</span><span class="op" id="1481561">(</span><span class="ident" id="1481562">key</span><span class="op" id="1481565">.</span><span class="ident" id="1481566">str</span><span class="op" id="1481569">)</span><span class="op" id="1481570">)</span>&nbsp;<span class="op" id="1481572">!=</span>&nbsp;<span class="op" id="1481575">*</span><span class="op" id="1481576">(</span><span class="op" id="1481577">(</span><span class="op" id="1481578">*</span><span class="op" id="1481579">[</span><span class="num" id="1481580">4</span><span class="op" id="1481581">]</span><span class="builtintype" id="1481582">byte</span><span class="op" id="1481586">)</span><span class="op" id="1481587">(</span><span class="ident" id="1481588">k</span><span class="op" id="1481589">.</span><span class="ident" id="1481590">str</span><span class="op" id="1481593">)</span><span class="op" id="1481594">)</span>&nbsp;<span class="op" id="1481596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481619">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481644">if</span>&nbsp;<span class="op" id="1481647">*</span><span class="op" id="1481648">(</span><span class="op" id="1481649">(</span><span class="op" id="1481650">*</span><span class="op" id="1481651">[</span><span class="num" id="1481652">4</span><span class="op" id="1481653">]</span><span class="builtintype" id="1481654">byte</span><span class="op" id="1481658">)</span><span class="op" id="1481659">(</span><span class="ident" id="1481660">add</span><span class="op" id="1481663">(</span><span class="ident" id="1481664">key</span><span class="op" id="1481667">.</span><span class="ident" id="1481668">str</span><span class="op" id="1481671">,</span>&nbsp;<span class="builtintype" id="1481673">uintptr</span><span class="op" id="1481680">(</span><span class="ident" id="1481681">key</span><span class="op" id="1481684">.</span><span class="builtinfunc" id="1481685">len</span><span class="op" id="1481688">)</span><span class="op" id="1481689">-</span><span class="num" id="1481690">4</span><span class="op" id="1481691">)</span><span class="op" id="1481692">)</span><span class="op" id="1481693">)</span>&nbsp;<span class="op" id="1481695">!=</span>&nbsp;<span class="op" id="1481698">*</span><span class="op" id="1481699">(</span><span class="op" id="1481700">(</span><span class="op" id="1481701">*</span><span class="op" id="1481702">[</span><span class="num" id="1481703">4</span><span class="op" id="1481704">]</span><span class="builtintype" id="1481705">byte</span><span class="op" id="1481709">)</span><span class="op" id="1481710">(</span><span class="ident" id="1481711">add</span><span class="op" id="1481714">(</span><span class="ident" id="1481715">k</span><span class="op" id="1481716">.</span><span class="ident" id="1481717">str</span><span class="op" id="1481720">,</span>&nbsp;<span class="builtintype" id="1481722">uintptr</span><span class="op" id="1481729">(</span><span class="ident" id="1481730">key</span><span class="op" id="1481733">.</span><span class="builtinfunc" id="1481734">len</span><span class="op" id="1481737">)</span><span class="op" id="1481738">-</span><span class="num" id="1481739">4</span><span class="op" id="1481740">)</span><span class="op" id="1481741">)</span><span class="op" id="1481742">)</span>&nbsp;<span class="op" id="1481744">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481750">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481767">if</span>&nbsp;<span class="ident" id="1481770">keymaybe</span>&nbsp;<span class="op" id="1481779">!=</span>&nbsp;<span class="ident" id="1481782">bucketCnt</span>&nbsp;<span class="op" id="1481792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481798">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481868">goto</span>&nbsp;<span class="ident" id="1481873">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481888">keymaybe</span>&nbsp;<span class="op" id="1481897">=</span>&nbsp;<span class="ident" id="1481899">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481907">if</span>&nbsp;<span class="ident" id="1481910">keymaybe</span>&nbsp;<span class="op" id="1481919">!=</span>&nbsp;<span class="ident" id="1481922">bucketCnt</span>&nbsp;<span class="op" id="1481932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481937">k</span>&nbsp;<span class="op" id="1481939">:=</span>&nbsp;<span class="op" id="1481942">(</span><span class="op" id="1481943">*</span><span class="ident" id="1481944">stringStruct</span><span class="op" id="1481956">)</span><span class="op" id="1481957">(</span><span class="ident" id="1481958">add</span><span class="op" id="1481961">(</span><span class="ident" id="1481962">unsafe</span><span class="op" id="1481968">.</span><span class="ident" id="1481969">Pointer</span><span class="op" id="1481976">(</span><span class="ident" id="1481977">b</span><span class="op" id="1481978">)</span><span class="op" id="1481979">,</span>&nbsp;<span class="ident" id="1481981">dataOffset</span><span class="op" id="1481991">+</span><span class="ident" id="1481992">keymaybe</span><span class="op" id="1482000">*</span><span class="num" id="1482001">2</span><span class="op" id="1482002">*</span><span class="ident" id="1482003">ptrSize</span><span class="op" id="1482010">)</span><span class="op" id="1482011">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482016">if</span>&nbsp;<span class="ident" id="1482019">memeq</span><span class="op" id="1482024">(</span><span class="ident" id="1482025">k</span><span class="op" id="1482026">.</span><span class="ident" id="1482027">str</span><span class="op" id="1482030">,</span>&nbsp;<span class="ident" id="1482032">key</span><span class="op" id="1482035">.</span><span class="ident" id="1482036">str</span><span class="op" id="1482039">,</span>&nbsp;<span class="builtintype" id="1482041">uintptr</span><span class="op" id="1482048">(</span><span class="ident" id="1482049">key</span><span class="op" id="1482052">.</span><span class="builtinfunc" id="1482053">len</span><span class="op" id="1482056">)</span><span class="op" id="1482057">)</span>&nbsp;<span class="op" id="1482059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482065">return</span>&nbsp;<span class="ident" id="1482072">add</span><span class="op" id="1482075">(</span><span class="ident" id="1482076">unsafe</span><span class="op" id="1482082">.</span><span class="ident" id="1482083">Pointer</span><span class="op" id="1482090">(</span><span class="ident" id="1482091">b</span><span class="op" id="1482092">)</span><span class="op" id="1482093">,</span>&nbsp;<span class="ident" id="1482095">dataOffset</span><span class="op" id="1482105">+</span><span class="ident" id="1482106">bucketCnt</span><span class="op" id="1482115">*</span><span class="num" id="1482116">2</span><span class="op" id="1482117">*</span><span class="ident" id="1482118">ptrSize</span><span class="op" id="1482125">+</span><span class="ident" id="1482126">keymaybe</span><span class="op" id="1482134">*</span><span class="builtintype" id="1482135">uintptr</span><span class="op" id="1482142">(</span><span class="ident" id="1482143">t</span><span class="op" id="1482144">.</span><span class="ident" id="1482145">valuesize</span><span class="op" id="1482154">)</span><span class="op" id="1482155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482168">return</span>&nbsp;<span class="ident" id="1482175">unsafe</span><span class="op" id="1482181">.</span><span class="ident" id="1482182">Pointer</span><span class="op" id="1482189">(</span><span class="ident" id="1482190">t</span><span class="op" id="1482191">.</span><span class="ident" id="1482192">elem</span><span class="op" id="1482196">.</span><span class="ident" id="1482197">zero</span><span class="op" id="1482201">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482204">}</span><br>
<span class="lineno"></span><span class="ident" id="1482206">dohash</span><span class="op" id="1482212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482215">hash</span>&nbsp;<span class="op" id="1482220">:=</span>&nbsp;<span class="ident" id="1482223">goalg</span><span class="op" id="1482228">(</span><span class="ident" id="1482229">t</span><span class="op" id="1482230">.</span><span class="ident" id="1482231">key</span><span class="op" id="1482234">.</span><span class="ident" id="1482235">alg</span><span class="op" id="1482238">)</span><span class="op" id="1482239">.</span><span class="ident" id="1482240">hash</span><span class="op" id="1482244">(</span><span class="ident" id="1482245">noescape</span><span class="op" id="1482253">(</span><span class="ident" id="1482254">unsafe</span><span class="op" id="1482260">.</span><span class="ident" id="1482261">Pointer</span><span class="op" id="1482268">(</span><span class="op" id="1482269">&amp;</span><span class="ident" id="1482270">ky</span><span class="op" id="1482272">)</span><span class="op" id="1482273">)</span><span class="op" id="1482274">,</span>&nbsp;<span class="num" id="1482276">2</span><span class="op" id="1482277">*</span><span class="ident" id="1482278">ptrSize</span><span class="op" id="1482285">,</span>&nbsp;<span class="builtintype" id="1482287">uintptr</span><span class="op" id="1482294">(</span><span class="ident" id="1482295">h</span><span class="op" id="1482296">.</span><span class="ident" id="1482297">hash0</span><span class="op" id="1482302">)</span><span class="op" id="1482303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482306">m</span>&nbsp;<span class="op" id="1482308">:=</span>&nbsp;<span class="builtintype" id="1482311">uintptr</span><span class="op" id="1482318">(</span><span class="num" id="1482319">1</span><span class="op" id="1482320">)</span><span class="op" id="1482321">&lt;&lt;</span><span class="ident" id="1482323">h</span><span class="op" id="1482324">.</span><span class="ident" id="1482325">B</span>&nbsp;<span class="op" id="1482327">-</span>&nbsp;<span class="num" id="1482329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482332">b</span>&nbsp;<span class="op" id="1482334">:=</span>&nbsp;<span class="op" id="1482337">(</span><span class="op" id="1482338">*</span><span class="ident" id="1482339">bmap</span><span class="op" id="1482343">)</span><span class="op" id="1482344">(</span><span class="ident" id="1482345">add</span><span class="op" id="1482348">(</span><span class="ident" id="1482349">h</span><span class="op" id="1482350">.</span><span class="ident" id="1482351">buckets</span><span class="op" id="1482358">,</span>&nbsp;<span class="op" id="1482360">(</span><span class="ident" id="1482361">hash</span><span class="op" id="1482365">&amp;</span><span class="ident" id="1482366">m</span><span class="op" id="1482367">)</span><span class="op" id="1482368">*</span><span class="builtintype" id="1482369">uintptr</span><span class="op" id="1482376">(</span><span class="ident" id="1482377">t</span><span class="op" id="1482378">.</span><span class="ident" id="1482379">bucketsize</span><span class="op" id="1482389">)</span><span class="op" id="1482390">)</span><span class="op" id="1482391">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482394">if</span>&nbsp;<span class="ident" id="1482397">c</span>&nbsp;<span class="op" id="1482399">:=</span>&nbsp;<span class="ident" id="1482402">h</span><span class="op" id="1482403">.</span><span class="ident" id="1482404">oldbuckets</span><span class="op" id="1482414">;</span>&nbsp;<span class="ident" id="1482416">c</span>&nbsp;<span class="op" id="1482418">!=</span>&nbsp;<span class="builtintype" id="1482421">nil</span>&nbsp;<span class="op" id="1482425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482429">oldb</span>&nbsp;<span class="op" id="1482434">:=</span>&nbsp;<span class="op" id="1482437">(</span><span class="op" id="1482438">*</span><span class="ident" id="1482439">bmap</span><span class="op" id="1482443">)</span><span class="op" id="1482444">(</span><span class="ident" id="1482445">add</span><span class="op" id="1482448">(</span><span class="ident" id="1482449">c</span><span class="op" id="1482450">,</span>&nbsp;<span class="op" id="1482452">(</span><span class="ident" id="1482453">hash</span><span class="op" id="1482457">&amp;</span><span class="op" id="1482458">(</span><span class="ident" id="1482459">m</span><span class="op" id="1482460">&gt;&gt;</span><span class="num" id="1482462">1</span><span class="op" id="1482463">)</span><span class="op" id="1482464">)</span><span class="op" id="1482465">*</span><span class="builtintype" id="1482466">uintptr</span><span class="op" id="1482473">(</span><span class="ident" id="1482474">t</span><span class="op" id="1482475">.</span><span class="ident" id="1482476">bucketsize</span><span class="op" id="1482486">)</span><span class="op" id="1482487">)</span><span class="op" id="1482488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482492">if</span>&nbsp;<span class="op" id="1482495">!</span><span class="ident" id="1482496">evacuated</span><span class="op" id="1482505">(</span><span class="ident" id="1482506">oldb</span><span class="op" id="1482510">)</span>&nbsp;<span class="op" id="1482512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482517">b</span>&nbsp;<span class="op" id="1482519">=</span>&nbsp;<span class="ident" id="1482521">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482528">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482534">top</span>&nbsp;<span class="op" id="1482538">:=</span>&nbsp;<span class="builtintype" id="1482541">uint8</span><span class="op" id="1482546">(</span><span class="ident" id="1482547">hash</span>&nbsp;<span class="op" id="1482552">&gt;&gt;</span>&nbsp;<span class="op" id="1482555">(</span><span class="ident" id="1482556">ptrSize</span><span class="op" id="1482563">*</span><span class="num" id="1482564">8</span>&nbsp;<span class="op" id="1482566">-</span>&nbsp;<span class="num" id="1482568">8</span><span class="op" id="1482569">)</span><span class="op" id="1482570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482573">if</span>&nbsp;<span class="ident" id="1482576">top</span>&nbsp;<span class="op" id="1482580">&lt;</span>&nbsp;<span class="ident" id="1482582">minTopHash</span>&nbsp;<span class="op" id="1482593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482597">top</span>&nbsp;<span class="op" id="1482601">+=</span>&nbsp;<span class="ident" id="1482604">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482616">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482619">for</span>&nbsp;<span class="op" id="1482623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482627">for</span>&nbsp;<span class="ident" id="1482631">i</span>&nbsp;<span class="op" id="1482633">:=</span>&nbsp;<span class="builtintype" id="1482636">uintptr</span><span class="op" id="1482643">(</span><span class="num" id="1482644">0</span><span class="op" id="1482645">)</span><span class="op" id="1482646">;</span>&nbsp;<span class="ident" id="1482648">i</span>&nbsp;<span class="op" id="1482650">&lt;</span>&nbsp;<span class="ident" id="1482652">bucketCnt</span><span class="op" id="1482661">;</span>&nbsp;<span class="ident" id="1482663">i</span><span class="op" id="1482664">++</span>&nbsp;<span class="op" id="1482667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482672">x</span>&nbsp;<span class="op" id="1482674">:=</span>&nbsp;<span class="op" id="1482677">*</span><span class="op" id="1482678">(</span><span class="op" id="1482679">(</span><span class="op" id="1482680">*</span><span class="builtintype" id="1482681">uint8</span><span class="op" id="1482686">)</span><span class="op" id="1482687">(</span><span class="ident" id="1482688">add</span><span class="op" id="1482691">(</span><span class="ident" id="1482692">unsafe</span><span class="op" id="1482698">.</span><span class="ident" id="1482699">Pointer</span><span class="op" id="1482706">(</span><span class="ident" id="1482707">b</span><span class="op" id="1482708">)</span><span class="op" id="1482709">,</span>&nbsp;<span class="ident" id="1482711">i</span><span class="op" id="1482712">)</span><span class="op" id="1482713">)</span><span class="op" id="1482714">)</span>&nbsp;<span class="comment" id="1482716">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482760">if</span>&nbsp;<span class="ident" id="1482763">x</span>&nbsp;<span class="op" id="1482765">!=</span>&nbsp;<span class="ident" id="1482768">top</span>&nbsp;<span class="op" id="1482772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482778">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1482795">k</span>&nbsp;<span class="op" id="1482797">:=</span>&nbsp;<span class="op" id="1482800">(</span><span class="op" id="1482801">*</span><span class="ident" id="1482802">stringStruct</span><span class="op" id="1482814">)</span><span class="op" id="1482815">(</span><span class="ident" id="1482816">add</span><span class="op" id="1482819">(</span><span class="ident" id="1482820">unsafe</span><span class="op" id="1482826">.</span><span class="ident" id="1482827">Pointer</span><span class="op" id="1482834">(</span><span class="ident" id="1482835">b</span><span class="op" id="1482836">)</span><span class="op" id="1482837">,</span>&nbsp;<span class="ident" id="1482839">dataOffset</span><span class="op" id="1482849">+</span><span class="ident" id="1482850">i</span><span class="op" id="1482851">*</span><span class="num" id="1482852">2</span><span class="op" id="1482853">*</span><span class="ident" id="1482854">ptrSize</span><span class="op" id="1482861">)</span><span class="op" id="1482862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482867">if</span>&nbsp;<span class="ident" id="1482870">k</span><span class="op" id="1482871">.</span><span class="builtinfunc" id="1482872">len</span>&nbsp;<span class="op" id="1482876">!=</span>&nbsp;<span class="ident" id="1482879">key</span><span class="op" id="1482882">.</span><span class="builtinfunc" id="1482883">len</span>&nbsp;<span class="op" id="1482887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482893">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1482905">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482910">if</span>&nbsp;<span class="ident" id="1482913">k</span><span class="op" id="1482914">.</span><span class="ident" id="1482915">str</span>&nbsp;<span class="op" id="1482919">==</span>&nbsp;<span class="ident" id="1482922">key</span><span class="op" id="1482925">.</span><span class="ident" id="1482926">str</span>&nbsp;<span class="op" id="1482930">||</span>&nbsp;<span class="ident" id="1482933">memeq</span><span class="op" id="1482938">(</span><span class="ident" id="1482939">k</span><span class="op" id="1482940">.</span><span class="ident" id="1482941">str</span><span class="op" id="1482944">,</span>&nbsp;<span class="ident" id="1482946">key</span><span class="op" id="1482949">.</span><span class="ident" id="1482950">str</span><span class="op" id="1482953">,</span>&nbsp;<span class="builtintype" id="1482955">uintptr</span><span class="op" id="1482962">(</span><span class="ident" id="1482963">key</span><span class="op" id="1482966">.</span><span class="builtinfunc" id="1482967">len</span><span class="op" id="1482970">)</span><span class="op" id="1482971">)</span>&nbsp;<span class="op" id="1482973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1482979">return</span>&nbsp;<span class="ident" id="1482986">add</span><span class="op" id="1482989">(</span><span class="ident" id="1482990">unsafe</span><span class="op" id="1482996">.</span><span class="ident" id="1482997">Pointer</span><span class="op" id="1483004">(</span><span class="ident" id="1483005">b</span><span class="op" id="1483006">)</span><span class="op" id="1483007">,</span>&nbsp;<span class="ident" id="1483009">dataOffset</span><span class="op" id="1483019">+</span><span class="ident" id="1483020">bucketCnt</span><span class="op" id="1483029">*</span><span class="num" id="1483030">2</span><span class="op" id="1483031">*</span><span class="ident" id="1483032">ptrSize</span><span class="op" id="1483039">+</span><span class="ident" id="1483040">i</span><span class="op" id="1483041">*</span><span class="builtintype" id="1483042">uintptr</span><span class="op" id="1483049">(</span><span class="ident" id="1483050">t</span><span class="op" id="1483051">.</span><span class="ident" id="1483052">valuesize</span><span class="op" id="1483061">)</span><span class="op" id="1483062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483075">b</span>&nbsp;<span class="op" id="1483077">=</span>&nbsp;<span class="ident" id="1483079">b</span><span class="op" id="1483080">.</span><span class="ident" id="1483081">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483092">if</span>&nbsp;<span class="ident" id="1483095">b</span>&nbsp;<span class="op" id="1483097">==</span>&nbsp;<span class="builtintype" id="1483100">nil</span>&nbsp;<span class="op" id="1483104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483109">return</span>&nbsp;<span class="ident" id="1483116">unsafe</span><span class="op" id="1483122">.</span><span class="ident" id="1483123">Pointer</span><span class="op" id="1483130">(</span><span class="ident" id="1483131">t</span><span class="op" id="1483132">.</span><span class="ident" id="1483133">elem</span><span class="op" id="1483137">.</span><span class="ident" id="1483138">zero</span><span class="op" id="1483142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483149">}</span><br>
<span class="lineno"></span><span class="op" id="1483151">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1483154">func</span>&nbsp;<span class="ident" id="1483159">mapaccess2_faststr</span><span class="op" id="1483177">(</span><span class="ident" id="1483178">t</span>&nbsp;<span class="op" id="1483180">*</span><span class="ident" id="1483181">maptype</span><span class="op" id="1483188">,</span>&nbsp;<span class="ident" id="1483190">h</span>&nbsp;<span class="op" id="1483192">*</span><span class="ident" id="1483193">hmap</span><span class="op" id="1483197">,</span>&nbsp;<span class="ident" id="1483199">ky</span>&nbsp;<span class="builtintype" id="1483202">string</span><span class="op" id="1483208">)</span>&nbsp;<span class="op" id="1483210">(</span><span class="ident" id="1483211">unsafe</span><span class="op" id="1483217">.</span><span class="ident" id="1483218">Pointer</span><span class="op" id="1483225">,</span>&nbsp;<span class="builtintype" id="1483227">bool</span><span class="op" id="1483231">)</span>&nbsp;<span class="op" id="1483233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483236">if</span>&nbsp;<span class="ident" id="1483239">raceenabled</span>&nbsp;<span class="op" id="1483251">&amp;&amp;</span>&nbsp;<span class="ident" id="1483254">h</span>&nbsp;<span class="op" id="1483256">!=</span>&nbsp;<span class="builtintype" id="1483259">nil</span>&nbsp;<span class="op" id="1483263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483267">callerpc</span>&nbsp;<span class="op" id="1483276">:=</span>&nbsp;<span class="ident" id="1483279">getcallerpc</span><span class="op" id="1483290">(</span><span class="ident" id="1483291">unsafe</span><span class="op" id="1483297">.</span><span class="ident" id="1483298">Pointer</span><span class="op" id="1483305">(</span><span class="op" id="1483306">&amp;</span><span class="ident" id="1483307">t</span><span class="op" id="1483308">)</span><span class="op" id="1483309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483313">racereadpc</span><span class="op" id="1483323">(</span><span class="ident" id="1483324">unsafe</span><span class="op" id="1483330">.</span><span class="ident" id="1483331">Pointer</span><span class="op" id="1483338">(</span><span class="ident" id="1483339">h</span><span class="op" id="1483340">)</span><span class="op" id="1483341">,</span>&nbsp;<span class="ident" id="1483343">callerpc</span><span class="op" id="1483351">,</span>&nbsp;<span class="ident" id="1483353">funcPC</span><span class="op" id="1483359">(</span><span class="ident" id="1483360">mapaccess2_faststr</span><span class="op" id="1483378">)</span><span class="op" id="1483379">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483385">if</span>&nbsp;<span class="ident" id="1483388">h</span>&nbsp;<span class="op" id="1483390">==</span>&nbsp;<span class="builtintype" id="1483393">nil</span>&nbsp;<span class="op" id="1483397">||</span>&nbsp;<span class="ident" id="1483400">h</span><span class="op" id="1483401">.</span><span class="ident" id="1483402">count</span>&nbsp;<span class="op" id="1483408">==</span>&nbsp;<span class="num" id="1483411">0</span>&nbsp;<span class="op" id="1483413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483417">return</span>&nbsp;<span class="ident" id="1483424">unsafe</span><span class="op" id="1483430">.</span><span class="ident" id="1483431">Pointer</span><span class="op" id="1483438">(</span><span class="ident" id="1483439">t</span><span class="op" id="1483440">.</span><span class="ident" id="1483441">elem</span><span class="op" id="1483445">.</span><span class="ident" id="1483446">zero</span><span class="op" id="1483450">)</span><span class="op" id="1483451">,</span>&nbsp;<span class="builtintype" id="1483453">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483463">key</span>&nbsp;<span class="op" id="1483467">:=</span>&nbsp;<span class="op" id="1483470">(</span><span class="op" id="1483471">*</span><span class="ident" id="1483472">stringStruct</span><span class="op" id="1483484">)</span><span class="op" id="1483485">(</span><span class="ident" id="1483486">unsafe</span><span class="op" id="1483492">.</span><span class="ident" id="1483493">Pointer</span><span class="op" id="1483500">(</span><span class="op" id="1483501">&amp;</span><span class="ident" id="1483502">ky</span><span class="op" id="1483504">)</span><span class="op" id="1483505">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483508">if</span>&nbsp;<span class="ident" id="1483511">h</span><span class="op" id="1483512">.</span><span class="ident" id="1483513">B</span>&nbsp;<span class="op" id="1483515">==</span>&nbsp;<span class="num" id="1483518">0</span>&nbsp;<span class="op" id="1483520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1483524">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483547">b</span>&nbsp;<span class="op" id="1483549">:=</span>&nbsp;<span class="op" id="1483552">(</span><span class="op" id="1483553">*</span><span class="ident" id="1483554">bmap</span><span class="op" id="1483558">)</span><span class="op" id="1483559">(</span><span class="ident" id="1483560">h</span><span class="op" id="1483561">.</span><span class="ident" id="1483562">buckets</span><span class="op" id="1483569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483573">if</span>&nbsp;<span class="ident" id="1483576">key</span><span class="op" id="1483579">.</span><span class="builtinfunc" id="1483580">len</span>&nbsp;<span class="op" id="1483584">&lt;</span>&nbsp;<span class="num" id="1483586">32</span>&nbsp;<span class="op" id="1483589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1483594">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483643">for</span>&nbsp;<span class="ident" id="1483647">i</span>&nbsp;<span class="op" id="1483649">:=</span>&nbsp;<span class="builtintype" id="1483652">uintptr</span><span class="op" id="1483659">(</span><span class="num" id="1483660">0</span><span class="op" id="1483661">)</span><span class="op" id="1483662">;</span>&nbsp;<span class="ident" id="1483664">i</span>&nbsp;<span class="op" id="1483666">&lt;</span>&nbsp;<span class="ident" id="1483668">bucketCnt</span><span class="op" id="1483677">;</span>&nbsp;<span class="ident" id="1483679">i</span><span class="op" id="1483680">++</span>&nbsp;<span class="op" id="1483683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483689">x</span>&nbsp;<span class="op" id="1483691">:=</span>&nbsp;<span class="op" id="1483694">*</span><span class="op" id="1483695">(</span><span class="op" id="1483696">(</span><span class="op" id="1483697">*</span><span class="builtintype" id="1483698">uint8</span><span class="op" id="1483703">)</span><span class="op" id="1483704">(</span><span class="ident" id="1483705">add</span><span class="op" id="1483708">(</span><span class="ident" id="1483709">unsafe</span><span class="op" id="1483715">.</span><span class="ident" id="1483716">Pointer</span><span class="op" id="1483723">(</span><span class="ident" id="1483724">b</span><span class="op" id="1483725">)</span><span class="op" id="1483726">,</span>&nbsp;<span class="ident" id="1483728">i</span><span class="op" id="1483729">)</span><span class="op" id="1483730">)</span><span class="op" id="1483731">)</span>&nbsp;<span class="comment" id="1483733">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483778">if</span>&nbsp;<span class="ident" id="1483781">x</span>&nbsp;<span class="op" id="1483783">==</span>&nbsp;<span class="ident" id="1483786">empty</span>&nbsp;<span class="op" id="1483792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483799">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483812">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1483818">k</span>&nbsp;<span class="op" id="1483820">:=</span>&nbsp;<span class="op" id="1483823">(</span><span class="op" id="1483824">*</span><span class="ident" id="1483825">stringStruct</span><span class="op" id="1483837">)</span><span class="op" id="1483838">(</span><span class="ident" id="1483839">add</span><span class="op" id="1483842">(</span><span class="ident" id="1483843">unsafe</span><span class="op" id="1483849">.</span><span class="ident" id="1483850">Pointer</span><span class="op" id="1483857">(</span><span class="ident" id="1483858">b</span><span class="op" id="1483859">)</span><span class="op" id="1483860">,</span>&nbsp;<span class="ident" id="1483862">dataOffset</span><span class="op" id="1483872">+</span><span class="ident" id="1483873">i</span><span class="op" id="1483874">*</span><span class="num" id="1483875">2</span><span class="op" id="1483876">*</span><span class="ident" id="1483877">ptrSize</span><span class="op" id="1483884">)</span><span class="op" id="1483885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483891">if</span>&nbsp;<span class="ident" id="1483894">k</span><span class="op" id="1483895">.</span><span class="builtinfunc" id="1483896">len</span>&nbsp;<span class="op" id="1483900">!=</span>&nbsp;<span class="ident" id="1483903">key</span><span class="op" id="1483906">.</span><span class="builtinfunc" id="1483907">len</span>&nbsp;<span class="op" id="1483911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483918">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1483931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1483937">if</span>&nbsp;<span class="ident" id="1483940">k</span><span class="op" id="1483941">.</span><span class="ident" id="1483942">str</span>&nbsp;<span class="op" id="1483946">==</span>&nbsp;<span class="ident" id="1483949">key</span><span class="op" id="1483952">.</span><span class="ident" id="1483953">str</span>&nbsp;<span class="op" id="1483957">||</span>&nbsp;<span class="ident" id="1483960">memeq</span><span class="op" id="1483965">(</span><span class="ident" id="1483966">k</span><span class="op" id="1483967">.</span><span class="ident" id="1483968">str</span><span class="op" id="1483971">,</span>&nbsp;<span class="ident" id="1483973">key</span><span class="op" id="1483976">.</span><span class="ident" id="1483977">str</span><span class="op" id="1483980">,</span>&nbsp;<span class="builtintype" id="1483982">uintptr</span><span class="op" id="1483989">(</span><span class="ident" id="1483990">key</span><span class="op" id="1483993">.</span><span class="builtinfunc" id="1483994">len</span><span class="op" id="1483997">)</span><span class="op" id="1483998">)</span>&nbsp;<span class="op" id="1484000">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484007">return</span>&nbsp;<span class="ident" id="1484014">add</span><span class="op" id="1484017">(</span><span class="ident" id="1484018">unsafe</span><span class="op" id="1484024">.</span><span class="ident" id="1484025">Pointer</span><span class="op" id="1484032">(</span><span class="ident" id="1484033">b</span><span class="op" id="1484034">)</span><span class="op" id="1484035">,</span>&nbsp;<span class="ident" id="1484037">dataOffset</span><span class="op" id="1484047">+</span><span class="ident" id="1484048">bucketCnt</span><span class="op" id="1484057">*</span><span class="num" id="1484058">2</span><span class="op" id="1484059">*</span><span class="ident" id="1484060">ptrSize</span><span class="op" id="1484067">+</span><span class="ident" id="1484068">i</span><span class="op" id="1484069">*</span><span class="builtintype" id="1484070">uintptr</span><span class="op" id="1484077">(</span><span class="ident" id="1484078">t</span><span class="op" id="1484079">.</span><span class="ident" id="1484080">valuesize</span><span class="op" id="1484089">)</span><span class="op" id="1484090">)</span><span class="op" id="1484091">,</span>&nbsp;<span class="builtintype" id="1484093">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484112">return</span>&nbsp;<span class="ident" id="1484119">unsafe</span><span class="op" id="1484125">.</span><span class="ident" id="1484126">Pointer</span><span class="op" id="1484133">(</span><span class="ident" id="1484134">t</span><span class="op" id="1484135">.</span><span class="ident" id="1484136">elem</span><span class="op" id="1484140">.</span><span class="ident" id="1484141">zero</span><span class="op" id="1484145">)</span><span class="op" id="1484146">,</span>&nbsp;<span class="builtintype" id="1484148">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484156">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1484160">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1484221">keymaybe</span>&nbsp;<span class="op" id="1484230">:=</span>&nbsp;<span class="builtintype" id="1484233">uintptr</span><span class="op" id="1484240">(</span><span class="ident" id="1484241">bucketCnt</span><span class="op" id="1484250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484254">for</span>&nbsp;<span class="ident" id="1484258">i</span>&nbsp;<span class="op" id="1484260">:=</span>&nbsp;<span class="builtintype" id="1484263">uintptr</span><span class="op" id="1484270">(</span><span class="num" id="1484271">0</span><span class="op" id="1484272">)</span><span class="op" id="1484273">;</span>&nbsp;<span class="ident" id="1484275">i</span>&nbsp;<span class="op" id="1484277">&lt;</span>&nbsp;<span class="ident" id="1484279">bucketCnt</span><span class="op" id="1484288">;</span>&nbsp;<span class="ident" id="1484290">i</span><span class="op" id="1484291">++</span>&nbsp;<span class="op" id="1484294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1484299">x</span>&nbsp;<span class="op" id="1484301">:=</span>&nbsp;<span class="op" id="1484304">*</span><span class="op" id="1484305">(</span><span class="op" id="1484306">(</span><span class="op" id="1484307">*</span><span class="builtintype" id="1484308">uint8</span><span class="op" id="1484313">)</span><span class="op" id="1484314">(</span><span class="ident" id="1484315">add</span><span class="op" id="1484318">(</span><span class="ident" id="1484319">unsafe</span><span class="op" id="1484325">.</span><span class="ident" id="1484326">Pointer</span><span class="op" id="1484333">(</span><span class="ident" id="1484334">b</span><span class="op" id="1484335">)</span><span class="op" id="1484336">,</span>&nbsp;<span class="ident" id="1484338">i</span><span class="op" id="1484339">)</span><span class="op" id="1484340">)</span><span class="op" id="1484341">)</span>&nbsp;<span class="comment" id="1484343">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484387">if</span>&nbsp;<span class="ident" id="1484390">x</span>&nbsp;<span class="op" id="1484392">==</span>&nbsp;<span class="ident" id="1484395">empty</span>&nbsp;<span class="op" id="1484401">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484407">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1484424">k</span>&nbsp;<span class="op" id="1484426">:=</span>&nbsp;<span class="op" id="1484429">(</span><span class="op" id="1484430">*</span><span class="ident" id="1484431">stringStruct</span><span class="op" id="1484443">)</span><span class="op" id="1484444">(</span><span class="ident" id="1484445">add</span><span class="op" id="1484448">(</span><span class="ident" id="1484449">unsafe</span><span class="op" id="1484455">.</span><span class="ident" id="1484456">Pointer</span><span class="op" id="1484463">(</span><span class="ident" id="1484464">b</span><span class="op" id="1484465">)</span><span class="op" id="1484466">,</span>&nbsp;<span class="ident" id="1484468">dataOffset</span><span class="op" id="1484478">+</span><span class="ident" id="1484479">i</span><span class="op" id="1484480">*</span><span class="num" id="1484481">2</span><span class="op" id="1484482">*</span><span class="ident" id="1484483">ptrSize</span><span class="op" id="1484490">)</span><span class="op" id="1484491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484496">if</span>&nbsp;<span class="ident" id="1484499">k</span><span class="op" id="1484500">.</span><span class="builtinfunc" id="1484501">len</span>&nbsp;<span class="op" id="1484505">!=</span>&nbsp;<span class="ident" id="1484508">key</span><span class="op" id="1484511">.</span><span class="builtinfunc" id="1484512">len</span>&nbsp;<span class="op" id="1484516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484522">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484539">if</span>&nbsp;<span class="ident" id="1484542">k</span><span class="op" id="1484543">.</span><span class="ident" id="1484544">str</span>&nbsp;<span class="op" id="1484548">==</span>&nbsp;<span class="ident" id="1484551">key</span><span class="op" id="1484554">.</span><span class="ident" id="1484555">str</span>&nbsp;<span class="op" id="1484559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484565">return</span>&nbsp;<span class="ident" id="1484572">add</span><span class="op" id="1484575">(</span><span class="ident" id="1484576">unsafe</span><span class="op" id="1484582">.</span><span class="ident" id="1484583">Pointer</span><span class="op" id="1484590">(</span><span class="ident" id="1484591">b</span><span class="op" id="1484592">)</span><span class="op" id="1484593">,</span>&nbsp;<span class="ident" id="1484595">dataOffset</span><span class="op" id="1484605">+</span><span class="ident" id="1484606">bucketCnt</span><span class="op" id="1484615">*</span><span class="num" id="1484616">2</span><span class="op" id="1484617">*</span><span class="ident" id="1484618">ptrSize</span><span class="op" id="1484625">+</span><span class="ident" id="1484626">i</span><span class="op" id="1484627">*</span><span class="builtintype" id="1484628">uintptr</span><span class="op" id="1484635">(</span><span class="ident" id="1484636">t</span><span class="op" id="1484637">.</span><span class="ident" id="1484638">valuesize</span><span class="op" id="1484647">)</span><span class="op" id="1484648">)</span><span class="op" id="1484649">,</span>&nbsp;<span class="builtintype" id="1484651">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1484664">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484690">if</span>&nbsp;<span class="op" id="1484693">*</span><span class="op" id="1484694">(</span><span class="op" id="1484695">(</span><span class="op" id="1484696">*</span><span class="op" id="1484697">[</span><span class="num" id="1484698">4</span><span class="op" id="1484699">]</span><span class="builtintype" id="1484700">byte</span><span class="op" id="1484704">)</span><span class="op" id="1484705">(</span><span class="ident" id="1484706">key</span><span class="op" id="1484709">.</span><span class="ident" id="1484710">str</span><span class="op" id="1484713">)</span><span class="op" id="1484714">)</span>&nbsp;<span class="op" id="1484716">!=</span>&nbsp;<span class="op" id="1484719">*</span><span class="op" id="1484720">(</span><span class="op" id="1484721">(</span><span class="op" id="1484722">*</span><span class="op" id="1484723">[</span><span class="num" id="1484724">4</span><span class="op" id="1484725">]</span><span class="builtintype" id="1484726">byte</span><span class="op" id="1484730">)</span><span class="op" id="1484731">(</span><span class="ident" id="1484732">k</span><span class="op" id="1484733">.</span><span class="ident" id="1484734">str</span><span class="op" id="1484737">)</span><span class="op" id="1484738">)</span>&nbsp;<span class="op" id="1484740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484746">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1484763">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484788">if</span>&nbsp;<span class="op" id="1484791">*</span><span class="op" id="1484792">(</span><span class="op" id="1484793">(</span><span class="op" id="1484794">*</span><span class="op" id="1484795">[</span><span class="num" id="1484796">4</span><span class="op" id="1484797">]</span><span class="builtintype" id="1484798">byte</span><span class="op" id="1484802">)</span><span class="op" id="1484803">(</span><span class="ident" id="1484804">add</span><span class="op" id="1484807">(</span><span class="ident" id="1484808">key</span><span class="op" id="1484811">.</span><span class="ident" id="1484812">str</span><span class="op" id="1484815">,</span>&nbsp;<span class="builtintype" id="1484817">uintptr</span><span class="op" id="1484824">(</span><span class="ident" id="1484825">key</span><span class="op" id="1484828">.</span><span class="builtinfunc" id="1484829">len</span><span class="op" id="1484832">)</span><span class="op" id="1484833">-</span><span class="num" id="1484834">4</span><span class="op" id="1484835">)</span><span class="op" id="1484836">)</span><span class="op" id="1484837">)</span>&nbsp;<span class="op" id="1484839">!=</span>&nbsp;<span class="op" id="1484842">*</span><span class="op" id="1484843">(</span><span class="op" id="1484844">(</span><span class="op" id="1484845">*</span><span class="op" id="1484846">[</span><span class="num" id="1484847">4</span><span class="op" id="1484848">]</span><span class="builtintype" id="1484849">byte</span><span class="op" id="1484853">)</span><span class="op" id="1484854">(</span><span class="ident" id="1484855">add</span><span class="op" id="1484858">(</span><span class="ident" id="1484859">k</span><span class="op" id="1484860">.</span><span class="ident" id="1484861">str</span><span class="op" id="1484864">,</span>&nbsp;<span class="builtintype" id="1484866">uintptr</span><span class="op" id="1484873">(</span><span class="ident" id="1484874">key</span><span class="op" id="1484877">.</span><span class="builtinfunc" id="1484878">len</span><span class="op" id="1484881">)</span><span class="op" id="1484882">-</span><span class="num" id="1484883">4</span><span class="op" id="1484884">)</span><span class="op" id="1484885">)</span><span class="op" id="1484886">)</span>&nbsp;<span class="op" id="1484888">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484894">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1484906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1484911">if</span>&nbsp;<span class="ident" id="1484914">keymaybe</span>&nbsp;<span class="op" id="1484923">!=</span>&nbsp;<span class="ident" id="1484926">bucketCnt</span>&nbsp;<span class="op" id="1484936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1484942">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485012">goto</span>&nbsp;<span class="ident" id="1485017">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485032">keymaybe</span>&nbsp;<span class="op" id="1485041">=</span>&nbsp;<span class="ident" id="1485043">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485051">if</span>&nbsp;<span class="ident" id="1485054">keymaybe</span>&nbsp;<span class="op" id="1485063">!=</span>&nbsp;<span class="ident" id="1485066">bucketCnt</span>&nbsp;<span class="op" id="1485076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485081">k</span>&nbsp;<span class="op" id="1485083">:=</span>&nbsp;<span class="op" id="1485086">(</span><span class="op" id="1485087">*</span><span class="ident" id="1485088">stringStruct</span><span class="op" id="1485100">)</span><span class="op" id="1485101">(</span><span class="ident" id="1485102">add</span><span class="op" id="1485105">(</span><span class="ident" id="1485106">unsafe</span><span class="op" id="1485112">.</span><span class="ident" id="1485113">Pointer</span><span class="op" id="1485120">(</span><span class="ident" id="1485121">b</span><span class="op" id="1485122">)</span><span class="op" id="1485123">,</span>&nbsp;<span class="ident" id="1485125">dataOffset</span><span class="op" id="1485135">+</span><span class="ident" id="1485136">keymaybe</span><span class="op" id="1485144">*</span><span class="num" id="1485145">2</span><span class="op" id="1485146">*</span><span class="ident" id="1485147">ptrSize</span><span class="op" id="1485154">)</span><span class="op" id="1485155">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485160">if</span>&nbsp;<span class="ident" id="1485163">memeq</span><span class="op" id="1485168">(</span><span class="ident" id="1485169">k</span><span class="op" id="1485170">.</span><span class="ident" id="1485171">str</span><span class="op" id="1485174">,</span>&nbsp;<span class="ident" id="1485176">key</span><span class="op" id="1485179">.</span><span class="ident" id="1485180">str</span><span class="op" id="1485183">,</span>&nbsp;<span class="builtintype" id="1485185">uintptr</span><span class="op" id="1485192">(</span><span class="ident" id="1485193">key</span><span class="op" id="1485196">.</span><span class="builtinfunc" id="1485197">len</span><span class="op" id="1485200">)</span><span class="op" id="1485201">)</span>&nbsp;<span class="op" id="1485203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485209">return</span>&nbsp;<span class="ident" id="1485216">add</span><span class="op" id="1485219">(</span><span class="ident" id="1485220">unsafe</span><span class="op" id="1485226">.</span><span class="ident" id="1485227">Pointer</span><span class="op" id="1485234">(</span><span class="ident" id="1485235">b</span><span class="op" id="1485236">)</span><span class="op" id="1485237">,</span>&nbsp;<span class="ident" id="1485239">dataOffset</span><span class="op" id="1485249">+</span><span class="ident" id="1485250">bucketCnt</span><span class="op" id="1485259">*</span><span class="num" id="1485260">2</span><span class="op" id="1485261">*</span><span class="ident" id="1485262">ptrSize</span><span class="op" id="1485269">+</span><span class="ident" id="1485270">keymaybe</span><span class="op" id="1485278">*</span><span class="builtintype" id="1485279">uintptr</span><span class="op" id="1485286">(</span><span class="ident" id="1485287">t</span><span class="op" id="1485288">.</span><span class="ident" id="1485289">valuesize</span><span class="op" id="1485298">)</span><span class="op" id="1485299">)</span><span class="op" id="1485300">,</span>&nbsp;<span class="builtintype" id="1485302">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485318">return</span>&nbsp;<span class="ident" id="1485325">unsafe</span><span class="op" id="1485331">.</span><span class="ident" id="1485332">Pointer</span><span class="op" id="1485339">(</span><span class="ident" id="1485340">t</span><span class="op" id="1485341">.</span><span class="ident" id="1485342">elem</span><span class="op" id="1485346">.</span><span class="ident" id="1485347">zero</span><span class="op" id="1485351">)</span><span class="op" id="1485352">,</span>&nbsp;<span class="builtintype" id="1485354">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485361">}</span><br>
<span class="lineno"></span><span class="ident" id="1485363">dohash</span><span class="op" id="1485369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485372">hash</span>&nbsp;<span class="op" id="1485377">:=</span>&nbsp;<span class="ident" id="1485380">goalg</span><span class="op" id="1485385">(</span><span class="ident" id="1485386">t</span><span class="op" id="1485387">.</span><span class="ident" id="1485388">key</span><span class="op" id="1485391">.</span><span class="ident" id="1485392">alg</span><span class="op" id="1485395">)</span><span class="op" id="1485396">.</span><span class="ident" id="1485397">hash</span><span class="op" id="1485401">(</span><span class="ident" id="1485402">noescape</span><span class="op" id="1485410">(</span><span class="ident" id="1485411">unsafe</span><span class="op" id="1485417">.</span><span class="ident" id="1485418">Pointer</span><span class="op" id="1485425">(</span><span class="op" id="1485426">&amp;</span><span class="ident" id="1485427">ky</span><span class="op" id="1485429">)</span><span class="op" id="1485430">)</span><span class="op" id="1485431">,</span>&nbsp;<span class="num" id="1485433">2</span><span class="op" id="1485434">*</span><span class="ident" id="1485435">ptrSize</span><span class="op" id="1485442">,</span>&nbsp;<span class="builtintype" id="1485444">uintptr</span><span class="op" id="1485451">(</span><span class="ident" id="1485452">h</span><span class="op" id="1485453">.</span><span class="ident" id="1485454">hash0</span><span class="op" id="1485459">)</span><span class="op" id="1485460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485463">m</span>&nbsp;<span class="op" id="1485465">:=</span>&nbsp;<span class="builtintype" id="1485468">uintptr</span><span class="op" id="1485475">(</span><span class="num" id="1485476">1</span><span class="op" id="1485477">)</span><span class="op" id="1485478">&lt;&lt;</span><span class="ident" id="1485480">h</span><span class="op" id="1485481">.</span><span class="ident" id="1485482">B</span>&nbsp;<span class="op" id="1485484">-</span>&nbsp;<span class="num" id="1485486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485489">b</span>&nbsp;<span class="op" id="1485491">:=</span>&nbsp;<span class="op" id="1485494">(</span><span class="op" id="1485495">*</span><span class="ident" id="1485496">bmap</span><span class="op" id="1485500">)</span><span class="op" id="1485501">(</span><span class="ident" id="1485502">add</span><span class="op" id="1485505">(</span><span class="ident" id="1485506">h</span><span class="op" id="1485507">.</span><span class="ident" id="1485508">buckets</span><span class="op" id="1485515">,</span>&nbsp;<span class="op" id="1485517">(</span><span class="ident" id="1485518">hash</span><span class="op" id="1485522">&amp;</span><span class="ident" id="1485523">m</span><span class="op" id="1485524">)</span><span class="op" id="1485525">*</span><span class="builtintype" id="1485526">uintptr</span><span class="op" id="1485533">(</span><span class="ident" id="1485534">t</span><span class="op" id="1485535">.</span><span class="ident" id="1485536">bucketsize</span><span class="op" id="1485546">)</span><span class="op" id="1485547">)</span><span class="op" id="1485548">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485551">if</span>&nbsp;<span class="ident" id="1485554">c</span>&nbsp;<span class="op" id="1485556">:=</span>&nbsp;<span class="ident" id="1485559">h</span><span class="op" id="1485560">.</span><span class="ident" id="1485561">oldbuckets</span><span class="op" id="1485571">;</span>&nbsp;<span class="ident" id="1485573">c</span>&nbsp;<span class="op" id="1485575">!=</span>&nbsp;<span class="builtintype" id="1485578">nil</span>&nbsp;<span class="op" id="1485582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485586">oldb</span>&nbsp;<span class="op" id="1485591">:=</span>&nbsp;<span class="op" id="1485594">(</span><span class="op" id="1485595">*</span><span class="ident" id="1485596">bmap</span><span class="op" id="1485600">)</span><span class="op" id="1485601">(</span><span class="ident" id="1485602">add</span><span class="op" id="1485605">(</span><span class="ident" id="1485606">c</span><span class="op" id="1485607">,</span>&nbsp;<span class="op" id="1485609">(</span><span class="ident" id="1485610">hash</span><span class="op" id="1485614">&amp;</span><span class="op" id="1485615">(</span><span class="ident" id="1485616">m</span><span class="op" id="1485617">&gt;&gt;</span><span class="num" id="1485619">1</span><span class="op" id="1485620">)</span><span class="op" id="1485621">)</span><span class="op" id="1485622">*</span><span class="builtintype" id="1485623">uintptr</span><span class="op" id="1485630">(</span><span class="ident" id="1485631">t</span><span class="op" id="1485632">.</span><span class="ident" id="1485633">bucketsize</span><span class="op" id="1485643">)</span><span class="op" id="1485644">)</span><span class="op" id="1485645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485649">if</span>&nbsp;<span class="op" id="1485652">!</span><span class="ident" id="1485653">evacuated</span><span class="op" id="1485662">(</span><span class="ident" id="1485663">oldb</span><span class="op" id="1485667">)</span>&nbsp;<span class="op" id="1485669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485674">b</span>&nbsp;<span class="op" id="1485676">=</span>&nbsp;<span class="ident" id="1485678">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485685">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485691">top</span>&nbsp;<span class="op" id="1485695">:=</span>&nbsp;<span class="builtintype" id="1485698">uint8</span><span class="op" id="1485703">(</span><span class="ident" id="1485704">hash</span>&nbsp;<span class="op" id="1485709">&gt;&gt;</span>&nbsp;<span class="op" id="1485712">(</span><span class="ident" id="1485713">ptrSize</span><span class="op" id="1485720">*</span><span class="num" id="1485721">8</span>&nbsp;<span class="op" id="1485723">-</span>&nbsp;<span class="num" id="1485725">8</span><span class="op" id="1485726">)</span><span class="op" id="1485727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485730">if</span>&nbsp;<span class="ident" id="1485733">top</span>&nbsp;<span class="op" id="1485737">&lt;</span>&nbsp;<span class="ident" id="1485739">minTopHash</span>&nbsp;<span class="op" id="1485750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485754">top</span>&nbsp;<span class="op" id="1485758">+=</span>&nbsp;<span class="ident" id="1485761">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485773">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485776">for</span>&nbsp;<span class="op" id="1485780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485784">for</span>&nbsp;<span class="ident" id="1485788">i</span>&nbsp;<span class="op" id="1485790">:=</span>&nbsp;<span class="builtintype" id="1485793">uintptr</span><span class="op" id="1485800">(</span><span class="num" id="1485801">0</span><span class="op" id="1485802">)</span><span class="op" id="1485803">;</span>&nbsp;<span class="ident" id="1485805">i</span>&nbsp;<span class="op" id="1485807">&lt;</span>&nbsp;<span class="ident" id="1485809">bucketCnt</span><span class="op" id="1485818">;</span>&nbsp;<span class="ident" id="1485820">i</span><span class="op" id="1485821">++</span>&nbsp;<span class="op" id="1485824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485829">x</span>&nbsp;<span class="op" id="1485831">:=</span>&nbsp;<span class="op" id="1485834">*</span><span class="op" id="1485835">(</span><span class="op" id="1485836">(</span><span class="op" id="1485837">*</span><span class="builtintype" id="1485838">uint8</span><span class="op" id="1485843">)</span><span class="op" id="1485844">(</span><span class="ident" id="1485845">add</span><span class="op" id="1485848">(</span><span class="ident" id="1485849">unsafe</span><span class="op" id="1485855">.</span><span class="ident" id="1485856">Pointer</span><span class="op" id="1485863">(</span><span class="ident" id="1485864">b</span><span class="op" id="1485865">)</span><span class="op" id="1485866">,</span>&nbsp;<span class="ident" id="1485868">i</span><span class="op" id="1485869">)</span><span class="op" id="1485870">)</span><span class="op" id="1485871">)</span>&nbsp;<span class="comment" id="1485873">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485917">if</span>&nbsp;<span class="ident" id="1485920">x</span>&nbsp;<span class="op" id="1485922">!=</span>&nbsp;<span class="ident" id="1485925">top</span>&nbsp;<span class="op" id="1485929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1485935">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485952">k</span>&nbsp;<span class="op" id="1485954">:=</span>&nbsp;<span class="op" id="1485957">(</span><span class="op" id="1485958">*</span><span class="ident" id="1485959">stringStruct</span><span class="op" id="1485971">)</span><span class="op" id="1485972">(</span><span class="ident" id="1485973">add</span><span class="op" id="1485976">(</span><span class="ident" id="1485977">unsafe</span><span class="op" id="1485983">.</span><span class="ident" id="1485984">Pointer</span><span class="op" id="1485991">(</span><span class="ident" id="1485992">b</span><span class="op" id="1485993">)</span><span class="op" id="1485994">,</span>&nbsp;<span class="ident" id="1485996">dataOffset</span><span class="op" id="1486006">+</span><span class="ident" id="1486007">i</span><span class="op" id="1486008">*</span><span class="num" id="1486009">2</span><span class="op" id="1486010">*</span><span class="ident" id="1486011">ptrSize</span><span class="op" id="1486018">)</span><span class="op" id="1486019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486024">if</span>&nbsp;<span class="ident" id="1486027">k</span><span class="op" id="1486028">.</span><span class="builtinfunc" id="1486029">len</span>&nbsp;<span class="op" id="1486033">!=</span>&nbsp;<span class="ident" id="1486036">key</span><span class="op" id="1486039">.</span><span class="builtinfunc" id="1486040">len</span>&nbsp;<span class="op" id="1486044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486050">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486062">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486067">if</span>&nbsp;<span class="ident" id="1486070">k</span><span class="op" id="1486071">.</span><span class="ident" id="1486072">str</span>&nbsp;<span class="op" id="1486076">==</span>&nbsp;<span class="ident" id="1486079">key</span><span class="op" id="1486082">.</span><span class="ident" id="1486083">str</span>&nbsp;<span class="op" id="1486087">||</span>&nbsp;<span class="ident" id="1486090">memeq</span><span class="op" id="1486095">(</span><span class="ident" id="1486096">k</span><span class="op" id="1486097">.</span><span class="ident" id="1486098">str</span><span class="op" id="1486101">,</span>&nbsp;<span class="ident" id="1486103">key</span><span class="op" id="1486106">.</span><span class="ident" id="1486107">str</span><span class="op" id="1486110">,</span>&nbsp;<span class="builtintype" id="1486112">uintptr</span><span class="op" id="1486119">(</span><span class="ident" id="1486120">key</span><span class="op" id="1486123">.</span><span class="builtinfunc" id="1486124">len</span><span class="op" id="1486127">)</span><span class="op" id="1486128">)</span>&nbsp;<span class="op" id="1486130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486136">return</span>&nbsp;<span class="ident" id="1486143">add</span><span class="op" id="1486146">(</span><span class="ident" id="1486147">unsafe</span><span class="op" id="1486153">.</span><span class="ident" id="1486154">Pointer</span><span class="op" id="1486161">(</span><span class="ident" id="1486162">b</span><span class="op" id="1486163">)</span><span class="op" id="1486164">,</span>&nbsp;<span class="ident" id="1486166">dataOffset</span><span class="op" id="1486176">+</span><span class="ident" id="1486177">bucketCnt</span><span class="op" id="1486186">*</span><span class="num" id="1486187">2</span><span class="op" id="1486188">*</span><span class="ident" id="1486189">ptrSize</span><span class="op" id="1486196">+</span><span class="ident" id="1486197">i</span><span class="op" id="1486198">*</span><span class="builtintype" id="1486199">uintptr</span><span class="op" id="1486206">(</span><span class="ident" id="1486207">t</span><span class="op" id="1486208">.</span><span class="ident" id="1486209">valuesize</span><span class="op" id="1486218">)</span><span class="op" id="1486219">)</span><span class="op" id="1486220">,</span>&nbsp;<span class="builtintype" id="1486222">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1486238">b</span>&nbsp;<span class="op" id="1486240">=</span>&nbsp;<span class="ident" id="1486242">b</span><span class="op" id="1486243">.</span><span class="ident" id="1486244">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486255">if</span>&nbsp;<span class="ident" id="1486258">b</span>&nbsp;<span class="op" id="1486260">==</span>&nbsp;<span class="builtintype" id="1486263">nil</span>&nbsp;<span class="op" id="1486267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1486272">return</span>&nbsp;<span class="ident" id="1486279">unsafe</span><span class="op" id="1486285">.</span><span class="ident" id="1486286">Pointer</span><span class="op" id="1486293">(</span><span class="ident" id="1486294">t</span><span class="op" id="1486295">.</span><span class="ident" id="1486296">elem</span><span class="op" id="1486300">.</span><span class="ident" id="1486301">zero</span><span class="op" id="1486305">)</span><span class="op" id="1486306">,</span>&nbsp;<span class="builtintype" id="1486308">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1486319">}</span><br>
<span class="lineno"></span><span class="op" id="1486321">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
