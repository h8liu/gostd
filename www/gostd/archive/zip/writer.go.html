<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6308234">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6308289">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6308343">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6308394">package</span>&nbsp;<span class="ident" id="6308402">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6308407">import</span>&nbsp;<span class="op" id="6308414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308417">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308426">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308445">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308455">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308463">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6308477">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6308482">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6308485">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6308525">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308573">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6308613">type</span>&nbsp;<span class="ident" id="6308618">Writer</span>&nbsp;<span class="keyword" id="6308625">struct</span>&nbsp;<span class="op" id="6308632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308635">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308642">*</span><span class="ident" id="6308643">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308656">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308663">[</span><span class="op" id="6308664">]</span><span class="op" id="6308665">*</span><span class="ident" id="6308666">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308674">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6308681">*</span><span class="ident" id="6308682">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308694">closed</span>&nbsp;<span class="builtintype" id="6308701">bool</span><br>
<span class="lineno">25</span><span class="op" id="6308706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6308709">type</span>&nbsp;<span class="ident" id="6308714">header</span>&nbsp;<span class="keyword" id="6308721">struct</span>&nbsp;<span class="op" id="6308728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308731">*</span><span class="ident" id="6308732">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308744">offset</span>&nbsp;<span class="ident" id="6308751">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6308758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308761">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6308820">func</span>&nbsp;<span class="ident" id="6308825">NewWriter</span><span class="op" id="6308834">(</span><span class="ident" id="6308835">w</span>&nbsp;<span class="ident" id="6308837">io</span><span class="op" id="6308839">.</span><span class="ident" id="6308840">Writer</span><span class="op" id="6308846">)</span>&nbsp;<span class="op" id="6308848">*</span><span class="ident" id="6308849">Writer</span>&nbsp;<span class="op" id="6308856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308859">return</span>&nbsp;<span class="op" id="6308866">&amp;</span><span class="ident" id="6308867">Writer</span><span class="op" id="6308873">{</span><span class="ident" id="6308874">cw</span><span class="op" id="6308876">:</span>&nbsp;<span class="op" id="6308878">&amp;</span><span class="ident" id="6308879">countWriter</span><span class="op" id="6308890">{</span><span class="ident" id="6308891">w</span><span class="op" id="6308892">:</span>&nbsp;<span class="ident" id="6308894">bufio</span><span class="op" id="6308899">.</span><span class="ident" id="6308900">NewWriter</span><span class="op" id="6308909">(</span><span class="ident" id="6308910">w</span><span class="op" id="6308911">)</span><span class="op" id="6308912">}</span><span class="op" id="6308913">}</span><br>
<span class="lineno">35</span><span class="op" id="6308915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308918">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6308979">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6309052">func</span>&nbsp;<span class="op" id="6309057">(</span><span class="ident" id="6309058">w</span>&nbsp;<span class="op" id="6309060">*</span><span class="ident" id="6309061">Writer</span><span class="op" id="6309067">)</span>&nbsp;<span class="ident" id="6309069">Flush</span><span class="op" id="6309074">(</span><span class="op" id="6309075">)</span>&nbsp;<span class="builtintype" id="6309077">error</span>&nbsp;<span class="op" id="6309083">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309086">return</span>&nbsp;<span class="ident" id="6309093">w</span><span class="op" id="6309094">.</span><span class="ident" id="6309095">cw</span><span class="op" id="6309097">.</span><span class="ident" id="6309098">w</span><span class="op" id="6309099">.</span><span class="op" id="6309100">(</span><span class="op" id="6309101">*</span><span class="ident" id="6309102">bufio</span><span class="op" id="6309107">.</span><span class="ident" id="6309108">Writer</span><span class="op" id="6309114">)</span><span class="op" id="6309115">.</span><span class="ident" id="6309116">Flush</span><span class="op" id="6309121">(</span><span class="op" id="6309122">)</span><br>
<span class="lineno"></span><span class="op" id="6309124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309127">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6309200">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6309258">func</span>&nbsp;<span class="op" id="6309263">(</span><span class="ident" id="6309264">w</span>&nbsp;<span class="op" id="6309266">*</span><span class="ident" id="6309267">Writer</span><span class="op" id="6309273">)</span>&nbsp;<span class="ident" id="6309275">Close</span><span class="op" id="6309280">(</span><span class="op" id="6309281">)</span>&nbsp;<span class="builtintype" id="6309283">error</span>&nbsp;<span class="op" id="6309289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309292">if</span>&nbsp;<span class="ident" id="6309295">w</span><span class="op" id="6309296">.</span><span class="ident" id="6309297">last</span>&nbsp;<span class="op" id="6309302">!=</span>&nbsp;<span class="ident" id="6309305">nil</span>&nbsp;<span class="op" id="6309309">&amp;&amp;</span>&nbsp;<span class="op" id="6309312">!</span><span class="ident" id="6309313">w</span><span class="op" id="6309314">.</span><span class="ident" id="6309315">last</span><span class="op" id="6309319">.</span><span class="ident" id="6309320">closed</span>&nbsp;<span class="op" id="6309327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309331">if</span>&nbsp;<span class="ident" id="6309334">err</span>&nbsp;<span class="op" id="6309338">:=</span>&nbsp;<span class="ident" id="6309341">w</span><span class="op" id="6309342">.</span><span class="ident" id="6309343">last</span><span class="op" id="6309347">.</span><span class="builtinfunc" id="6309348">close</span><span class="op" id="6309353">(</span><span class="op" id="6309354">)</span><span class="op" id="6309355">;</span>&nbsp;<span class="ident" id="6309357">err</span>&nbsp;<span class="op" id="6309361">!=</span>&nbsp;<span class="ident" id="6309364">nil</span>&nbsp;<span class="op" id="6309368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309373">return</span>&nbsp;<span class="ident" id="6309380">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309386">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309390">w</span><span class="op" id="6309391">.</span><span class="ident" id="6309392">last</span>&nbsp;<span class="op" id="6309397">=</span>&nbsp;<span class="ident" id="6309399">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309407">if</span>&nbsp;<span class="ident" id="6309410">w</span><span class="op" id="6309411">.</span><span class="ident" id="6309412">closed</span>&nbsp;<span class="op" id="6309419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309423">return</span>&nbsp;<span class="ident" id="6309430">errors</span><span class="op" id="6309436">.</span><span class="ident" id="6309437">New</span><span class="op" id="6309440">(</span><span class="string" id="6309441">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6309467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309470">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309473">w</span><span class="op" id="6309474">.</span><span class="ident" id="6309475">closed</span>&nbsp;<span class="op" id="6309482">=</span>&nbsp;<span class="builtintype" id="6309484">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309491">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309519">start</span>&nbsp;<span class="op" id="6309525">:=</span>&nbsp;<span class="ident" id="6309528">w</span><span class="op" id="6309529">.</span><span class="ident" id="6309530">cw</span><span class="op" id="6309532">.</span><span class="ident" id="6309533">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309540">for</span>&nbsp;<span class="ident" id="6309544">_</span><span class="op" id="6309545">,</span>&nbsp;<span class="ident" id="6309547">h</span>&nbsp;<span class="op" id="6309549">:=</span>&nbsp;<span class="keyword" id="6309552">range</span>&nbsp;<span class="ident" id="6309558">w</span><span class="op" id="6309559">.</span><span class="ident" id="6309560">dir</span>&nbsp;<span class="op" id="6309564">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309568">var</span>&nbsp;<span class="ident" id="6309572">buf</span>&nbsp;<span class="op" id="6309576">[</span><span class="ident" id="6309577">directoryHeaderLen</span><span class="op" id="6309595">]</span><span class="builtintype" id="6309596">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309603">b</span>&nbsp;<span class="op" id="6309605">:=</span>&nbsp;<span class="ident" id="6309608">writeBuf</span><span class="op" id="6309616">(</span><span class="ident" id="6309617">buf</span><span class="op" id="6309620">[</span><span class="op" id="6309621">:</span><span class="op" id="6309622">]</span><span class="op" id="6309623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309627">b</span><span class="op" id="6309628">.</span><span class="builtintype" id="6309629">uint32</span><span class="op" id="6309635">(</span><span class="builtintype" id="6309636">uint32</span><span class="op" id="6309642">(</span><span class="ident" id="6309643">directoryHeaderSignature</span><span class="op" id="6309667">)</span><span class="op" id="6309668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309672">b</span><span class="op" id="6309673">.</span><span class="builtintype" id="6309674">uint16</span><span class="op" id="6309680">(</span><span class="ident" id="6309681">h</span><span class="op" id="6309682">.</span><span class="ident" id="6309683">CreatorVersion</span><span class="op" id="6309697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309701">b</span><span class="op" id="6309702">.</span><span class="builtintype" id="6309703">uint16</span><span class="op" id="6309709">(</span><span class="ident" id="6309710">h</span><span class="op" id="6309711">.</span><span class="ident" id="6309712">ReaderVersion</span><span class="op" id="6309725">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309729">b</span><span class="op" id="6309730">.</span><span class="builtintype" id="6309731">uint16</span><span class="op" id="6309737">(</span><span class="ident" id="6309738">h</span><span class="op" id="6309739">.</span><span class="ident" id="6309740">Flags</span><span class="op" id="6309745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309749">b</span><span class="op" id="6309750">.</span><span class="builtintype" id="6309751">uint16</span><span class="op" id="6309757">(</span><span class="ident" id="6309758">h</span><span class="op" id="6309759">.</span><span class="ident" id="6309760">Method</span><span class="op" id="6309766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309770">b</span><span class="op" id="6309771">.</span><span class="builtintype" id="6309772">uint16</span><span class="op" id="6309778">(</span><span class="ident" id="6309779">h</span><span class="op" id="6309780">.</span><span class="ident" id="6309781">ModifiedTime</span><span class="op" id="6309793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309797">b</span><span class="op" id="6309798">.</span><span class="builtintype" id="6309799">uint16</span><span class="op" id="6309805">(</span><span class="ident" id="6309806">h</span><span class="op" id="6309807">.</span><span class="ident" id="6309808">ModifiedDate</span><span class="op" id="6309820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309824">b</span><span class="op" id="6309825">.</span><span class="builtintype" id="6309826">uint32</span><span class="op" id="6309832">(</span><span class="ident" id="6309833">h</span><span class="op" id="6309834">.</span><span class="ident" id="6309835">CRC32</span><span class="op" id="6309840">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309844">if</span>&nbsp;<span class="ident" id="6309847">h</span><span class="op" id="6309848">.</span><span class="ident" id="6309849">isZip64</span><span class="op" id="6309856">(</span><span class="op" id="6309857">)</span>&nbsp;<span class="op" id="6309859">||</span>&nbsp;<span class="ident" id="6309862">h</span><span class="op" id="6309863">.</span><span class="ident" id="6309864">offset</span>&nbsp;<span class="op" id="6309871">&gt;</span>&nbsp;<span class="ident" id="6309873">uint32max</span>&nbsp;<span class="op" id="6309883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309888">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309946">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310009">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310050">b</span><span class="op" id="6310051">.</span><span class="builtintype" id="6310052">uint32</span><span class="op" id="6310058">(</span><span class="ident" id="6310059">uint32max</span><span class="op" id="6310068">)</span>&nbsp;<span class="comment" id="6310070">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310092">b</span><span class="op" id="6310093">.</span><span class="builtintype" id="6310094">uint32</span><span class="op" id="6310100">(</span><span class="ident" id="6310101">uint32max</span><span class="op" id="6310110">)</span>&nbsp;<span class="comment" id="6310112">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310137">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310179">var</span>&nbsp;<span class="ident" id="6310183">buf</span>&nbsp;<span class="op" id="6310187">[</span><span class="num" id="6310188">28</span><span class="op" id="6310190">]</span><span class="builtintype" id="6310191">byte</span>&nbsp;<span class="comment" id="6310196">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310224">eb</span>&nbsp;<span class="op" id="6310227">:=</span>&nbsp;<span class="ident" id="6310230">writeBuf</span><span class="op" id="6310238">(</span><span class="ident" id="6310239">buf</span><span class="op" id="6310242">[</span><span class="op" id="6310243">:</span><span class="op" id="6310244">]</span><span class="op" id="6310245">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310250">eb</span><span class="op" id="6310252">.</span><span class="builtintype" id="6310253">uint16</span><span class="op" id="6310259">(</span><span class="ident" id="6310260">zip64ExtraId</span><span class="op" id="6310272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310277">eb</span><span class="op" id="6310279">.</span><span class="builtintype" id="6310280">uint16</span><span class="op" id="6310286">(</span><span class="num" id="6310287">24</span><span class="op" id="6310289">)</span>&nbsp;<span class="comment" id="6310291">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310314">eb</span><span class="op" id="6310316">.</span><span class="ident" id="6310317">uint64</span><span class="op" id="6310323">(</span><span class="ident" id="6310324">h</span><span class="op" id="6310325">.</span><span class="ident" id="6310326">UncompressedSize64</span><span class="op" id="6310344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310349">eb</span><span class="op" id="6310351">.</span><span class="ident" id="6310352">uint64</span><span class="op" id="6310358">(</span><span class="ident" id="6310359">h</span><span class="op" id="6310360">.</span><span class="ident" id="6310361">CompressedSize64</span><span class="op" id="6310377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310382">eb</span><span class="op" id="6310384">.</span><span class="ident" id="6310385">uint64</span><span class="op" id="6310391">(</span><span class="ident" id="6310392">h</span><span class="op" id="6310393">.</span><span class="ident" id="6310394">offset</span><span class="op" id="6310400">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310405">h</span><span class="op" id="6310406">.</span><span class="ident" id="6310407">Extra</span>&nbsp;<span class="op" id="6310413">=</span>&nbsp;<span class="builtinfunc" id="6310415">append</span><span class="op" id="6310421">(</span><span class="ident" id="6310422">h</span><span class="op" id="6310423">.</span><span class="ident" id="6310424">Extra</span><span class="op" id="6310429">,</span>&nbsp;<span class="ident" id="6310431">buf</span><span class="op" id="6310434">[</span><span class="op" id="6310435">:</span><span class="op" id="6310436">]</span><span class="op" id="6310437">...</span><span class="op" id="6310440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310444">}</span>&nbsp;<span class="keyword" id="6310446">else</span>&nbsp;<span class="op" id="6310451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310456">b</span><span class="op" id="6310457">.</span><span class="builtintype" id="6310458">uint32</span><span class="op" id="6310464">(</span><span class="ident" id="6310465">h</span><span class="op" id="6310466">.</span><span class="ident" id="6310467">CompressedSize</span><span class="op" id="6310481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310486">b</span><span class="op" id="6310487">.</span><span class="builtintype" id="6310488">uint32</span><span class="op" id="6310494">(</span><span class="ident" id="6310495">h</span><span class="op" id="6310496">.</span><span class="ident" id="6310497">UncompressedSize</span><span class="op" id="6310513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310517">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310521">b</span><span class="op" id="6310522">.</span><span class="builtintype" id="6310523">uint16</span><span class="op" id="6310529">(</span><span class="builtintype" id="6310530">uint16</span><span class="op" id="6310536">(</span><span class="builtinfunc" id="6310537">len</span><span class="op" id="6310540">(</span><span class="ident" id="6310541">h</span><span class="op" id="6310542">.</span><span class="ident" id="6310543">Name</span><span class="op" id="6310547">)</span><span class="op" id="6310548">)</span><span class="op" id="6310549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310553">b</span><span class="op" id="6310554">.</span><span class="builtintype" id="6310555">uint16</span><span class="op" id="6310561">(</span><span class="builtintype" id="6310562">uint16</span><span class="op" id="6310568">(</span><span class="builtinfunc" id="6310569">len</span><span class="op" id="6310572">(</span><span class="ident" id="6310573">h</span><span class="op" id="6310574">.</span><span class="ident" id="6310575">Extra</span><span class="op" id="6310580">)</span><span class="op" id="6310581">)</span><span class="op" id="6310582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310586">b</span><span class="op" id="6310587">.</span><span class="builtintype" id="6310588">uint16</span><span class="op" id="6310594">(</span><span class="builtintype" id="6310595">uint16</span><span class="op" id="6310601">(</span><span class="builtinfunc" id="6310602">len</span><span class="op" id="6310605">(</span><span class="ident" id="6310606">h</span><span class="op" id="6310607">.</span><span class="ident" id="6310608">Comment</span><span class="op" id="6310615">)</span><span class="op" id="6310616">)</span><span class="op" id="6310617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310621">b</span>&nbsp;<span class="op" id="6310623">=</span>&nbsp;<span class="ident" id="6310625">b</span><span class="op" id="6310626">[</span><span class="num" id="6310627">4</span><span class="op" id="6310628">:</span><span class="op" id="6310629">]</span>&nbsp;<span class="comment" id="6310631">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310694">b</span><span class="op" id="6310695">.</span><span class="builtintype" id="6310696">uint32</span><span class="op" id="6310702">(</span><span class="ident" id="6310703">h</span><span class="op" id="6310704">.</span><span class="ident" id="6310705">ExternalAttrs</span><span class="op" id="6310718">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310722">if</span>&nbsp;<span class="ident" id="6310725">h</span><span class="op" id="6310726">.</span><span class="ident" id="6310727">offset</span>&nbsp;<span class="op" id="6310734">&gt;</span>&nbsp;<span class="ident" id="6310736">uint32max</span>&nbsp;<span class="op" id="6310746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310751">b</span><span class="op" id="6310752">.</span><span class="builtintype" id="6310753">uint32</span><span class="op" id="6310759">(</span><span class="ident" id="6310760">uint32max</span><span class="op" id="6310769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310773">}</span>&nbsp;<span class="keyword" id="6310775">else</span>&nbsp;<span class="op" id="6310780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310785">b</span><span class="op" id="6310786">.</span><span class="builtintype" id="6310787">uint32</span><span class="op" id="6310793">(</span><span class="builtintype" id="6310794">uint32</span><span class="op" id="6310800">(</span><span class="ident" id="6310801">h</span><span class="op" id="6310802">.</span><span class="ident" id="6310803">offset</span><span class="op" id="6310809">)</span><span class="op" id="6310810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310814">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310818">if</span>&nbsp;<span class="ident" id="6310821">_</span><span class="op" id="6310822">,</span>&nbsp;<span class="ident" id="6310824">err</span>&nbsp;<span class="op" id="6310828">:=</span>&nbsp;<span class="ident" id="6310831">w</span><span class="op" id="6310832">.</span><span class="ident" id="6310833">cw</span><span class="op" id="6310835">.</span><span class="ident" id="6310836">Write</span><span class="op" id="6310841">(</span><span class="ident" id="6310842">buf</span><span class="op" id="6310845">[</span><span class="op" id="6310846">:</span><span class="op" id="6310847">]</span><span class="op" id="6310848">)</span><span class="op" id="6310849">;</span>&nbsp;<span class="ident" id="6310851">err</span>&nbsp;<span class="op" id="6310855">!=</span>&nbsp;<span class="ident" id="6310858">nil</span>&nbsp;<span class="op" id="6310862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310867">return</span>&nbsp;<span class="ident" id="6310874">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310884">if</span>&nbsp;<span class="ident" id="6310887">_</span><span class="op" id="6310888">,</span>&nbsp;<span class="ident" id="6310890">err</span>&nbsp;<span class="op" id="6310894">:=</span>&nbsp;<span class="ident" id="6310897">io</span><span class="op" id="6310899">.</span><span class="ident" id="6310900">WriteString</span><span class="op" id="6310911">(</span><span class="ident" id="6310912">w</span><span class="op" id="6310913">.</span><span class="ident" id="6310914">cw</span><span class="op" id="6310916">,</span>&nbsp;<span class="ident" id="6310918">h</span><span class="op" id="6310919">.</span><span class="ident" id="6310920">Name</span><span class="op" id="6310924">)</span><span class="op" id="6310925">;</span>&nbsp;<span class="ident" id="6310927">err</span>&nbsp;<span class="op" id="6310931">!=</span>&nbsp;<span class="ident" id="6310934">nil</span>&nbsp;<span class="op" id="6310938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310943">return</span>&nbsp;<span class="ident" id="6310950">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310960">if</span>&nbsp;<span class="ident" id="6310963">_</span><span class="op" id="6310964">,</span>&nbsp;<span class="ident" id="6310966">err</span>&nbsp;<span class="op" id="6310970">:=</span>&nbsp;<span class="ident" id="6310973">w</span><span class="op" id="6310974">.</span><span class="ident" id="6310975">cw</span><span class="op" id="6310977">.</span><span class="ident" id="6310978">Write</span><span class="op" id="6310983">(</span><span class="ident" id="6310984">h</span><span class="op" id="6310985">.</span><span class="ident" id="6310986">Extra</span><span class="op" id="6310991">)</span><span class="op" id="6310992">;</span>&nbsp;<span class="ident" id="6310994">err</span>&nbsp;<span class="op" id="6310998">!=</span>&nbsp;<span class="ident" id="6311001">nil</span>&nbsp;<span class="op" id="6311005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311010">return</span>&nbsp;<span class="ident" id="6311017">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311027">if</span>&nbsp;<span class="ident" id="6311030">_</span><span class="op" id="6311031">,</span>&nbsp;<span class="ident" id="6311033">err</span>&nbsp;<span class="op" id="6311037">:=</span>&nbsp;<span class="ident" id="6311040">io</span><span class="op" id="6311042">.</span><span class="ident" id="6311043">WriteString</span><span class="op" id="6311054">(</span><span class="ident" id="6311055">w</span><span class="op" id="6311056">.</span><span class="ident" id="6311057">cw</span><span class="op" id="6311059">,</span>&nbsp;<span class="ident" id="6311061">h</span><span class="op" id="6311062">.</span><span class="ident" id="6311063">Comment</span><span class="op" id="6311070">)</span><span class="op" id="6311071">;</span>&nbsp;<span class="ident" id="6311073">err</span>&nbsp;<span class="op" id="6311077">!=</span>&nbsp;<span class="ident" id="6311080">nil</span>&nbsp;<span class="op" id="6311084">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311089">return</span>&nbsp;<span class="ident" id="6311096">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311108">end</span>&nbsp;<span class="op" id="6311112">:=</span>&nbsp;<span class="ident" id="6311115">w</span><span class="op" id="6311116">.</span><span class="ident" id="6311117">cw</span><span class="op" id="6311119">.</span><span class="ident" id="6311120">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311128">records</span>&nbsp;<span class="op" id="6311136">:=</span>&nbsp;<span class="ident" id="6311139">uint64</span><span class="op" id="6311145">(</span><span class="builtinfunc" id="6311146">len</span><span class="op" id="6311149">(</span><span class="ident" id="6311150">w</span><span class="op" id="6311151">.</span><span class="ident" id="6311152">dir</span><span class="op" id="6311155">)</span><span class="op" id="6311156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311159">size</span>&nbsp;<span class="op" id="6311164">:=</span>&nbsp;<span class="ident" id="6311167">uint64</span><span class="op" id="6311173">(</span><span class="ident" id="6311174">end</span>&nbsp;<span class="op" id="6311178">-</span>&nbsp;<span class="ident" id="6311180">start</span><span class="op" id="6311185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311188">offset</span>&nbsp;<span class="op" id="6311195">:=</span>&nbsp;<span class="ident" id="6311198">uint64</span><span class="op" id="6311204">(</span><span class="ident" id="6311205">start</span><span class="op" id="6311210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311214">if</span>&nbsp;<span class="ident" id="6311217">records</span>&nbsp;<span class="op" id="6311225">&gt;</span>&nbsp;<span class="ident" id="6311227">uint16max</span>&nbsp;<span class="op" id="6311237">||</span>&nbsp;<span class="ident" id="6311240">size</span>&nbsp;<span class="op" id="6311245">&gt;</span>&nbsp;<span class="ident" id="6311247">uint32max</span>&nbsp;<span class="op" id="6311257">||</span>&nbsp;<span class="ident" id="6311260">offset</span>&nbsp;<span class="op" id="6311267">&gt;</span>&nbsp;<span class="ident" id="6311269">uint32max</span>&nbsp;<span class="op" id="6311279">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311283">var</span>&nbsp;<span class="ident" id="6311287">buf</span>&nbsp;<span class="op" id="6311291">[</span><span class="ident" id="6311292">directory64EndLen</span>&nbsp;<span class="op" id="6311310">+</span>&nbsp;<span class="ident" id="6311312">directory64LocLen</span><span class="op" id="6311329">]</span><span class="builtintype" id="6311330">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311337">b</span>&nbsp;<span class="op" id="6311339">:=</span>&nbsp;<span class="ident" id="6311342">writeBuf</span><span class="op" id="6311350">(</span><span class="ident" id="6311351">buf</span><span class="op" id="6311354">[</span><span class="op" id="6311355">:</span><span class="op" id="6311356">]</span><span class="op" id="6311357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311362">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311405">b</span><span class="op" id="6311406">.</span><span class="builtintype" id="6311407">uint32</span><span class="op" id="6311413">(</span><span class="ident" id="6311414">directory64EndSignature</span><span class="op" id="6311437">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311441">b</span><span class="op" id="6311442">.</span><span class="ident" id="6311443">uint64</span><span class="op" id="6311449">(</span><span class="ident" id="6311450">directory64EndLen</span><span class="op" id="6311467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311471">b</span><span class="op" id="6311472">.</span><span class="builtintype" id="6311473">uint16</span><span class="op" id="6311479">(</span><span class="ident" id="6311480">zipVersion45</span><span class="op" id="6311492">)</span>&nbsp;<span class="comment" id="6311494">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311515">b</span><span class="op" id="6311516">.</span><span class="builtintype" id="6311517">uint16</span><span class="op" id="6311523">(</span><span class="ident" id="6311524">zipVersion45</span><span class="op" id="6311536">)</span>&nbsp;<span class="comment" id="6311538">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311569">b</span><span class="op" id="6311570">.</span><span class="builtintype" id="6311571">uint32</span><span class="op" id="6311577">(</span><span class="num" id="6311578">0</span><span class="op" id="6311579">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311592">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311617">b</span><span class="op" id="6311618">.</span><span class="builtintype" id="6311619">uint32</span><span class="op" id="6311625">(</span><span class="num" id="6311626">0</span><span class="op" id="6311627">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311640">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311704">b</span><span class="op" id="6311705">.</span><span class="ident" id="6311706">uint64</span><span class="op" id="6311712">(</span><span class="ident" id="6311713">records</span><span class="op" id="6311720">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311727">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311794">b</span><span class="op" id="6311795">.</span><span class="ident" id="6311796">uint64</span><span class="op" id="6311802">(</span><span class="ident" id="6311803">records</span><span class="op" id="6311810">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311817">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311871">b</span><span class="op" id="6311872">.</span><span class="ident" id="6311873">uint64</span><span class="op" id="6311879">(</span><span class="ident" id="6311880">size</span><span class="op" id="6311884">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311894">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311929">b</span><span class="op" id="6311930">.</span><span class="ident" id="6311931">uint64</span><span class="op" id="6311937">(</span><span class="ident" id="6311938">offset</span><span class="op" id="6311944">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6311952">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312036">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312080">b</span><span class="op" id="6312081">.</span><span class="builtintype" id="6312082">uint32</span><span class="op" id="6312088">(</span><span class="ident" id="6312089">directory64LocSignature</span><span class="op" id="6312112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312116">b</span><span class="op" id="6312117">.</span><span class="builtintype" id="6312118">uint32</span><span class="op" id="6312124">(</span><span class="num" id="6312125">0</span><span class="op" id="6312126">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6312138">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312215">b</span><span class="op" id="6312216">.</span><span class="ident" id="6312217">uint64</span><span class="op" id="6312223">(</span><span class="ident" id="6312224">uint64</span><span class="op" id="6312230">(</span><span class="ident" id="6312231">end</span><span class="op" id="6312234">)</span><span class="op" id="6312235">)</span>&nbsp;<span class="comment" id="6312237">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312303">b</span><span class="op" id="6312304">.</span><span class="builtintype" id="6312305">uint32</span><span class="op" id="6312311">(</span><span class="num" id="6312312">1</span><span class="op" id="6312313">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6312325">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312353">if</span>&nbsp;<span class="ident" id="6312356">_</span><span class="op" id="6312357">,</span>&nbsp;<span class="ident" id="6312359">err</span>&nbsp;<span class="op" id="6312363">:=</span>&nbsp;<span class="ident" id="6312366">w</span><span class="op" id="6312367">.</span><span class="ident" id="6312368">cw</span><span class="op" id="6312370">.</span><span class="ident" id="6312371">Write</span><span class="op" id="6312376">(</span><span class="ident" id="6312377">buf</span><span class="op" id="6312380">[</span><span class="op" id="6312381">:</span><span class="op" id="6312382">]</span><span class="op" id="6312383">)</span><span class="op" id="6312384">;</span>&nbsp;<span class="ident" id="6312386">err</span>&nbsp;<span class="op" id="6312390">!=</span>&nbsp;<span class="ident" id="6312393">nil</span>&nbsp;<span class="op" id="6312397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312402">return</span>&nbsp;<span class="ident" id="6312409">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312420">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312483">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312533">records</span>&nbsp;<span class="op" id="6312541">=</span>&nbsp;<span class="ident" id="6312543">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312555">size</span>&nbsp;<span class="op" id="6312560">=</span>&nbsp;<span class="ident" id="6312562">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312574">offset</span>&nbsp;<span class="op" id="6312581">=</span>&nbsp;<span class="ident" id="6312583">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312598">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312619">var</span>&nbsp;<span class="ident" id="6312623">buf</span>&nbsp;<span class="op" id="6312627">[</span><span class="ident" id="6312628">directoryEndLen</span><span class="op" id="6312643">]</span><span class="builtintype" id="6312644">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312650">b</span>&nbsp;<span class="op" id="6312652">:=</span>&nbsp;<span class="ident" id="6312655">writeBuf</span><span class="op" id="6312663">(</span><span class="ident" id="6312664">buf</span><span class="op" id="6312667">[</span><span class="op" id="6312668">:</span><span class="op" id="6312669">]</span><span class="op" id="6312670">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312673">b</span><span class="op" id="6312674">.</span><span class="builtintype" id="6312675">uint32</span><span class="op" id="6312681">(</span><span class="builtintype" id="6312682">uint32</span><span class="op" id="6312688">(</span><span class="ident" id="6312689">directoryEndSignature</span><span class="op" id="6312710">)</span><span class="op" id="6312711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312714">b</span>&nbsp;<span class="op" id="6312716">=</span>&nbsp;<span class="ident" id="6312718">b</span><span class="op" id="6312719">[</span><span class="num" id="6312720">4</span><span class="op" id="6312721">:</span><span class="op" id="6312722">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6312740">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312800">b</span><span class="op" id="6312801">.</span><span class="builtintype" id="6312802">uint16</span><span class="op" id="6312808">(</span><span class="builtintype" id="6312809">uint16</span><span class="op" id="6312815">(</span><span class="ident" id="6312816">records</span><span class="op" id="6312823">)</span><span class="op" id="6312824">)</span>&nbsp;<span class="comment" id="6312826">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312858">b</span><span class="op" id="6312859">.</span><span class="builtintype" id="6312860">uint16</span><span class="op" id="6312866">(</span><span class="builtintype" id="6312867">uint16</span><span class="op" id="6312873">(</span><span class="ident" id="6312874">records</span><span class="op" id="6312881">)</span><span class="op" id="6312882">)</span>&nbsp;<span class="comment" id="6312884">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312912">b</span><span class="op" id="6312913">.</span><span class="builtintype" id="6312914">uint32</span><span class="op" id="6312920">(</span><span class="builtintype" id="6312921">uint32</span><span class="op" id="6312927">(</span><span class="ident" id="6312928">size</span><span class="op" id="6312932">)</span><span class="op" id="6312933">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6312938">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312960">b</span><span class="op" id="6312961">.</span><span class="builtintype" id="6312962">uint32</span><span class="op" id="6312968">(</span><span class="builtintype" id="6312969">uint32</span><span class="op" id="6312975">(</span><span class="ident" id="6312976">offset</span><span class="op" id="6312982">)</span><span class="op" id="6312983">)</span>&nbsp;&nbsp;<span class="comment" id="6312986">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313009">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313051">if</span>&nbsp;<span class="ident" id="6313054">_</span><span class="op" id="6313055">,</span>&nbsp;<span class="ident" id="6313057">err</span>&nbsp;<span class="op" id="6313061">:=</span>&nbsp;<span class="ident" id="6313064">w</span><span class="op" id="6313065">.</span><span class="ident" id="6313066">cw</span><span class="op" id="6313068">.</span><span class="ident" id="6313069">Write</span><span class="op" id="6313074">(</span><span class="ident" id="6313075">buf</span><span class="op" id="6313078">[</span><span class="op" id="6313079">:</span><span class="op" id="6313080">]</span><span class="op" id="6313081">)</span><span class="op" id="6313082">;</span>&nbsp;<span class="ident" id="6313084">err</span>&nbsp;<span class="op" id="6313088">!=</span>&nbsp;<span class="ident" id="6313091">nil</span>&nbsp;<span class="op" id="6313095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313099">return</span>&nbsp;<span class="ident" id="6313106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313111">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313115">return</span>&nbsp;<span class="ident" id="6313122">w</span><span class="op" id="6313123">.</span><span class="ident" id="6313124">cw</span><span class="op" id="6313126">.</span><span class="ident" id="6313127">w</span><span class="op" id="6313128">.</span><span class="op" id="6313129">(</span><span class="op" id="6313130">*</span><span class="ident" id="6313131">bufio</span><span class="op" id="6313136">.</span><span class="ident" id="6313137">Writer</span><span class="op" id="6313143">)</span><span class="op" id="6313144">.</span><span class="ident" id="6313145">Flush</span><span class="op" id="6313150">(</span><span class="op" id="6313151">)</span><br>
<span class="lineno"></span><span class="op" id="6313153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6313156">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6313219">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6313288">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6313356">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6313423">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6313435">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6313507">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6313550">func</span>&nbsp;<span class="op" id="6313555">(</span><span class="ident" id="6313556">w</span>&nbsp;<span class="op" id="6313558">*</span><span class="ident" id="6313559">Writer</span><span class="op" id="6313565">)</span>&nbsp;<span class="ident" id="6313567">Create</span><span class="op" id="6313573">(</span><span class="ident" id="6313574">name</span>&nbsp;<span class="builtintype" id="6313579">string</span><span class="op" id="6313585">)</span>&nbsp;<span class="op" id="6313587">(</span><span class="ident" id="6313588">io</span><span class="op" id="6313590">.</span><span class="ident" id="6313591">Writer</span><span class="op" id="6313597">,</span>&nbsp;<span class="builtintype" id="6313599">error</span><span class="op" id="6313604">)</span>&nbsp;<span class="op" id="6313606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313609">header</span>&nbsp;<span class="op" id="6313616">:=</span>&nbsp;<span class="op" id="6313619">&amp;</span><span class="ident" id="6313620">FileHeader</span><span class="op" id="6313630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313634">Name</span><span class="op" id="6313638">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6313642">name</span><span class="op" id="6313646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313650">Method</span><span class="op" id="6313656">:</span>&nbsp;<span class="ident" id="6313658">Deflate</span><span class="op" id="6313665">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313671">return</span>&nbsp;<span class="ident" id="6313678">w</span><span class="op" id="6313679">.</span><span class="ident" id="6313680">CreateHeader</span><span class="op" id="6313692">(</span><span class="ident" id="6313693">header</span><span class="op" id="6313699">)</span><br>
<span class="lineno"></span><span class="op" id="6313701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6313704">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6313778">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6313804">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6313873">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6313945">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6313988">func</span>&nbsp;<span class="op" id="6313993">(</span><span class="ident" id="6313994">w</span>&nbsp;<span class="op" id="6313996">*</span><span class="ident" id="6313997">Writer</span><span class="op" id="6314003">)</span>&nbsp;<span class="ident" id="6314005">CreateHeader</span><span class="op" id="6314017">(</span><span class="ident" id="6314018">fh</span>&nbsp;<span class="op" id="6314021">*</span><span class="ident" id="6314022">FileHeader</span><span class="op" id="6314032">)</span>&nbsp;<span class="op" id="6314034">(</span><span class="ident" id="6314035">io</span><span class="op" id="6314037">.</span><span class="ident" id="6314038">Writer</span><span class="op" id="6314044">,</span>&nbsp;<span class="builtintype" id="6314046">error</span><span class="op" id="6314051">)</span>&nbsp;<span class="op" id="6314053">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314056">if</span>&nbsp;<span class="ident" id="6314059">w</span><span class="op" id="6314060">.</span><span class="ident" id="6314061">last</span>&nbsp;<span class="op" id="6314066">!=</span>&nbsp;<span class="ident" id="6314069">nil</span>&nbsp;<span class="op" id="6314073">&amp;&amp;</span>&nbsp;<span class="op" id="6314076">!</span><span class="ident" id="6314077">w</span><span class="op" id="6314078">.</span><span class="ident" id="6314079">last</span><span class="op" id="6314083">.</span><span class="ident" id="6314084">closed</span>&nbsp;<span class="op" id="6314091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314095">if</span>&nbsp;<span class="ident" id="6314098">err</span>&nbsp;<span class="op" id="6314102">:=</span>&nbsp;<span class="ident" id="6314105">w</span><span class="op" id="6314106">.</span><span class="ident" id="6314107">last</span><span class="op" id="6314111">.</span><span class="builtinfunc" id="6314112">close</span><span class="op" id="6314117">(</span><span class="op" id="6314118">)</span><span class="op" id="6314119">;</span>&nbsp;<span class="ident" id="6314121">err</span>&nbsp;<span class="op" id="6314125">!=</span>&nbsp;<span class="ident" id="6314128">nil</span>&nbsp;<span class="op" id="6314132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314137">return</span>&nbsp;<span class="ident" id="6314144">nil</span><span class="op" id="6314147">,</span>&nbsp;<span class="ident" id="6314149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314158">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314162">fh</span><span class="op" id="6314164">.</span><span class="ident" id="6314165">Flags</span>&nbsp;<span class="op" id="6314171">|=</span>&nbsp;<span class="num" id="6314174">0x8</span>&nbsp;<span class="comment" id="6314178">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314215">fh</span><span class="op" id="6314217">.</span><span class="ident" id="6314218">CreatorVersion</span>&nbsp;<span class="op" id="6314233">=</span>&nbsp;<span class="ident" id="6314235">fh</span><span class="op" id="6314237">.</span><span class="ident" id="6314238">CreatorVersion</span><span class="op" id="6314252">&amp;</span><span class="num" id="6314253">0xff00</span>&nbsp;<span class="op" id="6314260">|</span>&nbsp;<span class="ident" id="6314262">zipVersion20</span>&nbsp;<span class="comment" id="6314275">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314307">fh</span><span class="op" id="6314309">.</span><span class="ident" id="6314310">ReaderVersion</span>&nbsp;<span class="op" id="6314324">=</span>&nbsp;<span class="ident" id="6314326">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314341">fw</span>&nbsp;<span class="op" id="6314344">:=</span>&nbsp;<span class="op" id="6314347">&amp;</span><span class="ident" id="6314348">fileWriter</span><span class="op" id="6314358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314362">zipw</span><span class="op" id="6314366">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314373">w</span><span class="op" id="6314374">.</span><span class="ident" id="6314375">cw</span><span class="op" id="6314377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314381">compCount</span><span class="op" id="6314390">:</span>&nbsp;<span class="op" id="6314392">&amp;</span><span class="ident" id="6314393">countWriter</span><span class="op" id="6314404">{</span><span class="ident" id="6314405">w</span><span class="op" id="6314406">:</span>&nbsp;<span class="ident" id="6314408">w</span><span class="op" id="6314409">.</span><span class="ident" id="6314410">cw</span><span class="op" id="6314412">}</span><span class="op" id="6314413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314417">crc32</span><span class="op" id="6314422">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314428">crc32</span><span class="op" id="6314433">.</span><span class="ident" id="6314434">NewIEEE</span><span class="op" id="6314441">(</span><span class="op" id="6314442">)</span><span class="op" id="6314443">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314449">comp</span>&nbsp;<span class="op" id="6314454">:=</span>&nbsp;<span class="ident" id="6314457">compressor</span><span class="op" id="6314467">(</span><span class="ident" id="6314468">fh</span><span class="op" id="6314470">.</span><span class="ident" id="6314471">Method</span><span class="op" id="6314477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314480">if</span>&nbsp;<span class="ident" id="6314483">comp</span>&nbsp;<span class="op" id="6314488">==</span>&nbsp;<span class="ident" id="6314491">nil</span>&nbsp;<span class="op" id="6314495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314499">return</span>&nbsp;<span class="ident" id="6314506">nil</span><span class="op" id="6314509">,</span>&nbsp;<span class="ident" id="6314511">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314525">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314528">var</span>&nbsp;<span class="ident" id="6314532">err</span>&nbsp;<span class="builtintype" id="6314536">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314543">fw</span><span class="op" id="6314545">.</span><span class="ident" id="6314546">comp</span><span class="op" id="6314550">,</span>&nbsp;<span class="ident" id="6314552">err</span>&nbsp;<span class="op" id="6314556">=</span>&nbsp;<span class="ident" id="6314558">comp</span><span class="op" id="6314562">(</span><span class="ident" id="6314563">fw</span><span class="op" id="6314565">.</span><span class="ident" id="6314566">compCount</span><span class="op" id="6314575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314578">if</span>&nbsp;<span class="ident" id="6314581">err</span>&nbsp;<span class="op" id="6314585">!=</span>&nbsp;<span class="ident" id="6314588">nil</span>&nbsp;<span class="op" id="6314592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314596">return</span>&nbsp;<span class="ident" id="6314603">nil</span><span class="op" id="6314606">,</span>&nbsp;<span class="ident" id="6314608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314613">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314616">fw</span><span class="op" id="6314618">.</span><span class="ident" id="6314619">rawCount</span>&nbsp;<span class="op" id="6314628">=</span>&nbsp;<span class="op" id="6314630">&amp;</span><span class="ident" id="6314631">countWriter</span><span class="op" id="6314642">{</span><span class="ident" id="6314643">w</span><span class="op" id="6314644">:</span>&nbsp;<span class="ident" id="6314646">fw</span><span class="op" id="6314648">.</span><span class="ident" id="6314649">comp</span><span class="op" id="6314653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314657">h</span>&nbsp;<span class="op" id="6314659">:=</span>&nbsp;<span class="op" id="6314662">&amp;</span><span class="ident" id="6314663">header</span><span class="op" id="6314669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314673">FileHeader</span><span class="op" id="6314683">:</span>&nbsp;<span class="ident" id="6314685">fh</span><span class="op" id="6314687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314691">offset</span><span class="op" id="6314697">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314703">uint64</span><span class="op" id="6314709">(</span><span class="ident" id="6314710">w</span><span class="op" id="6314711">.</span><span class="ident" id="6314712">cw</span><span class="op" id="6314714">.</span><span class="ident" id="6314715">count</span><span class="op" id="6314720">)</span><span class="op" id="6314721">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314727">w</span><span class="op" id="6314728">.</span><span class="ident" id="6314729">dir</span>&nbsp;<span class="op" id="6314733">=</span>&nbsp;<span class="builtinfunc" id="6314735">append</span><span class="op" id="6314741">(</span><span class="ident" id="6314742">w</span><span class="op" id="6314743">.</span><span class="ident" id="6314744">dir</span><span class="op" id="6314747">,</span>&nbsp;<span class="ident" id="6314749">h</span><span class="op" id="6314750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314753">fw</span><span class="op" id="6314755">.</span><span class="ident" id="6314756">header</span>&nbsp;<span class="op" id="6314763">=</span>&nbsp;<span class="ident" id="6314765">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314769">if</span>&nbsp;<span class="ident" id="6314772">err</span>&nbsp;<span class="op" id="6314776">:=</span>&nbsp;<span class="ident" id="6314779">writeHeader</span><span class="op" id="6314790">(</span><span class="ident" id="6314791">w</span><span class="op" id="6314792">.</span><span class="ident" id="6314793">cw</span><span class="op" id="6314795">,</span>&nbsp;<span class="ident" id="6314797">fh</span><span class="op" id="6314799">)</span><span class="op" id="6314800">;</span>&nbsp;<span class="ident" id="6314802">err</span>&nbsp;<span class="op" id="6314806">!=</span>&nbsp;<span class="ident" id="6314809">nil</span>&nbsp;<span class="op" id="6314813">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314817">return</span>&nbsp;<span class="ident" id="6314824">nil</span><span class="op" id="6314827">,</span>&nbsp;<span class="ident" id="6314829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314838">w</span><span class="op" id="6314839">.</span><span class="ident" id="6314840">last</span>&nbsp;<span class="op" id="6314845">=</span>&nbsp;<span class="ident" id="6314847">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314851">return</span>&nbsp;<span class="ident" id="6314858">fw</span><span class="op" id="6314860">,</span>&nbsp;<span class="ident" id="6314862">nil</span><br>
<span class="lineno">230</span><span class="op" id="6314866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6314869">func</span>&nbsp;<span class="ident" id="6314874">writeHeader</span><span class="op" id="6314885">(</span><span class="ident" id="6314886">w</span>&nbsp;<span class="ident" id="6314888">io</span><span class="op" id="6314890">.</span><span class="ident" id="6314891">Writer</span><span class="op" id="6314897">,</span>&nbsp;<span class="ident" id="6314899">h</span>&nbsp;<span class="op" id="6314901">*</span><span class="ident" id="6314902">FileHeader</span><span class="op" id="6314912">)</span>&nbsp;<span class="builtintype" id="6314914">error</span>&nbsp;<span class="op" id="6314920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314923">var</span>&nbsp;<span class="ident" id="6314927">buf</span>&nbsp;<span class="op" id="6314931">[</span><span class="ident" id="6314932">fileHeaderLen</span><span class="op" id="6314945">]</span><span class="builtintype" id="6314946">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314952">b</span>&nbsp;<span class="op" id="6314954">:=</span>&nbsp;<span class="ident" id="6314957">writeBuf</span><span class="op" id="6314965">(</span><span class="ident" id="6314966">buf</span><span class="op" id="6314969">[</span><span class="op" id="6314970">:</span><span class="op" id="6314971">]</span><span class="op" id="6314972">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314975">b</span><span class="op" id="6314976">.</span><span class="builtintype" id="6314977">uint32</span><span class="op" id="6314983">(</span><span class="builtintype" id="6314984">uint32</span><span class="op" id="6314990">(</span><span class="ident" id="6314991">fileHeaderSignature</span><span class="op" id="6315010">)</span><span class="op" id="6315011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315014">b</span><span class="op" id="6315015">.</span><span class="builtintype" id="6315016">uint16</span><span class="op" id="6315022">(</span><span class="ident" id="6315023">h</span><span class="op" id="6315024">.</span><span class="ident" id="6315025">ReaderVersion</span><span class="op" id="6315038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315041">b</span><span class="op" id="6315042">.</span><span class="builtintype" id="6315043">uint16</span><span class="op" id="6315049">(</span><span class="ident" id="6315050">h</span><span class="op" id="6315051">.</span><span class="ident" id="6315052">Flags</span><span class="op" id="6315057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315060">b</span><span class="op" id="6315061">.</span><span class="builtintype" id="6315062">uint16</span><span class="op" id="6315068">(</span><span class="ident" id="6315069">h</span><span class="op" id="6315070">.</span><span class="ident" id="6315071">Method</span><span class="op" id="6315077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315080">b</span><span class="op" id="6315081">.</span><span class="builtintype" id="6315082">uint16</span><span class="op" id="6315088">(</span><span class="ident" id="6315089">h</span><span class="op" id="6315090">.</span><span class="ident" id="6315091">ModifiedTime</span><span class="op" id="6315103">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315106">b</span><span class="op" id="6315107">.</span><span class="builtintype" id="6315108">uint16</span><span class="op" id="6315114">(</span><span class="ident" id="6315115">h</span><span class="op" id="6315116">.</span><span class="ident" id="6315117">ModifiedDate</span><span class="op" id="6315129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315132">b</span><span class="op" id="6315133">.</span><span class="builtintype" id="6315134">uint32</span><span class="op" id="6315140">(</span><span class="num" id="6315141">0</span><span class="op" id="6315142">)</span>&nbsp;<span class="comment" id="6315144">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315194">b</span><span class="op" id="6315195">.</span><span class="builtintype" id="6315196">uint32</span><span class="op" id="6315202">(</span><span class="num" id="6315203">0</span><span class="op" id="6315204">)</span>&nbsp;<span class="comment" id="6315206">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315227">b</span><span class="op" id="6315228">.</span><span class="builtintype" id="6315229">uint32</span><span class="op" id="6315235">(</span><span class="num" id="6315236">0</span><span class="op" id="6315237">)</span>&nbsp;<span class="comment" id="6315239">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315280">b</span><span class="op" id="6315281">.</span><span class="builtintype" id="6315282">uint16</span><span class="op" id="6315288">(</span><span class="builtintype" id="6315289">uint16</span><span class="op" id="6315295">(</span><span class="builtinfunc" id="6315296">len</span><span class="op" id="6315299">(</span><span class="ident" id="6315300">h</span><span class="op" id="6315301">.</span><span class="ident" id="6315302">Name</span><span class="op" id="6315306">)</span><span class="op" id="6315307">)</span><span class="op" id="6315308">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315311">b</span><span class="op" id="6315312">.</span><span class="builtintype" id="6315313">uint16</span><span class="op" id="6315319">(</span><span class="builtintype" id="6315320">uint16</span><span class="op" id="6315326">(</span><span class="builtinfunc" id="6315327">len</span><span class="op" id="6315330">(</span><span class="ident" id="6315331">h</span><span class="op" id="6315332">.</span><span class="ident" id="6315333">Extra</span><span class="op" id="6315338">)</span><span class="op" id="6315339">)</span><span class="op" id="6315340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315343">if</span>&nbsp;<span class="ident" id="6315346">_</span><span class="op" id="6315347">,</span>&nbsp;<span class="ident" id="6315349">err</span>&nbsp;<span class="op" id="6315353">:=</span>&nbsp;<span class="ident" id="6315356">w</span><span class="op" id="6315357">.</span><span class="ident" id="6315358">Write</span><span class="op" id="6315363">(</span><span class="ident" id="6315364">buf</span><span class="op" id="6315367">[</span><span class="op" id="6315368">:</span><span class="op" id="6315369">]</span><span class="op" id="6315370">)</span><span class="op" id="6315371">;</span>&nbsp;<span class="ident" id="6315373">err</span>&nbsp;<span class="op" id="6315377">!=</span>&nbsp;<span class="ident" id="6315380">nil</span>&nbsp;<span class="op" id="6315384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315388">return</span>&nbsp;<span class="ident" id="6315395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315403">if</span>&nbsp;<span class="ident" id="6315406">_</span><span class="op" id="6315407">,</span>&nbsp;<span class="ident" id="6315409">err</span>&nbsp;<span class="op" id="6315413">:=</span>&nbsp;<span class="ident" id="6315416">io</span><span class="op" id="6315418">.</span><span class="ident" id="6315419">WriteString</span><span class="op" id="6315430">(</span><span class="ident" id="6315431">w</span><span class="op" id="6315432">,</span>&nbsp;<span class="ident" id="6315434">h</span><span class="op" id="6315435">.</span><span class="ident" id="6315436">Name</span><span class="op" id="6315440">)</span><span class="op" id="6315441">;</span>&nbsp;<span class="ident" id="6315443">err</span>&nbsp;<span class="op" id="6315447">!=</span>&nbsp;<span class="ident" id="6315450">nil</span>&nbsp;<span class="op" id="6315454">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315458">return</span>&nbsp;<span class="ident" id="6315465">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315473">_</span><span class="op" id="6315474">,</span>&nbsp;<span class="ident" id="6315476">err</span>&nbsp;<span class="op" id="6315480">:=</span>&nbsp;<span class="ident" id="6315483">w</span><span class="op" id="6315484">.</span><span class="ident" id="6315485">Write</span><span class="op" id="6315490">(</span><span class="ident" id="6315491">h</span><span class="op" id="6315492">.</span><span class="ident" id="6315493">Extra</span><span class="op" id="6315498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315501">return</span>&nbsp;<span class="ident" id="6315508">err</span><br>
<span class="lineno"></span><span class="op" id="6315512">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6315515">type</span>&nbsp;<span class="ident" id="6315520">fileWriter</span>&nbsp;<span class="keyword" id="6315531">struct</span>&nbsp;<span class="op" id="6315538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315541">*</span><span class="ident" id="6315542">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315550">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315560">io</span><span class="op" id="6315562">.</span><span class="ident" id="6315563">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315571">rawCount</span>&nbsp;&nbsp;<span class="op" id="6315581">*</span><span class="ident" id="6315582">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315595">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315605">io</span><span class="op" id="6315607">.</span><span class="ident" id="6315608">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315621">compCount</span>&nbsp;<span class="op" id="6315631">*</span><span class="ident" id="6315632">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315645">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315655">hash</span><span class="op" id="6315659">.</span><span class="ident" id="6315660">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315668">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315678">bool</span><br>
<span class="lineno"></span><span class="op" id="6315683">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6315686">func</span>&nbsp;<span class="op" id="6315691">(</span><span class="ident" id="6315692">w</span>&nbsp;<span class="op" id="6315694">*</span><span class="ident" id="6315695">fileWriter</span><span class="op" id="6315705">)</span>&nbsp;<span class="ident" id="6315707">Write</span><span class="op" id="6315712">(</span><span class="ident" id="6315713">p</span>&nbsp;<span class="op" id="6315715">[</span><span class="op" id="6315716">]</span><span class="builtintype" id="6315717">byte</span><span class="op" id="6315721">)</span>&nbsp;<span class="op" id="6315723">(</span><span class="builtintype" id="6315724">int</span><span class="op" id="6315727">,</span>&nbsp;<span class="builtintype" id="6315729">error</span><span class="op" id="6315734">)</span>&nbsp;<span class="op" id="6315736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315739">if</span>&nbsp;<span class="ident" id="6315742">w</span><span class="op" id="6315743">.</span><span class="ident" id="6315744">closed</span>&nbsp;<span class="op" id="6315751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315755">return</span>&nbsp;<span class="num" id="6315762">0</span><span class="op" id="6315763">,</span>&nbsp;<span class="ident" id="6315765">errors</span><span class="op" id="6315771">.</span><span class="ident" id="6315772">New</span><span class="op" id="6315775">(</span><span class="string" id="6315776">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6315803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315806">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315809">w</span><span class="op" id="6315810">.</span><span class="ident" id="6315811">crc32</span><span class="op" id="6315816">.</span><span class="ident" id="6315817">Write</span><span class="op" id="6315822">(</span><span class="ident" id="6315823">p</span><span class="op" id="6315824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315827">return</span>&nbsp;<span class="ident" id="6315834">w</span><span class="op" id="6315835">.</span><span class="ident" id="6315836">rawCount</span><span class="op" id="6315844">.</span><span class="ident" id="6315845">Write</span><span class="op" id="6315850">(</span><span class="ident" id="6315851">p</span><span class="op" id="6315852">)</span><br>
<span class="lineno"></span><span class="op" id="6315854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6315857">func</span>&nbsp;<span class="op" id="6315862">(</span><span class="ident" id="6315863">w</span>&nbsp;<span class="op" id="6315865">*</span><span class="ident" id="6315866">fileWriter</span><span class="op" id="6315876">)</span>&nbsp;<span class="builtinfunc" id="6315878">close</span><span class="op" id="6315883">(</span><span class="op" id="6315884">)</span>&nbsp;<span class="builtintype" id="6315886">error</span>&nbsp;<span class="op" id="6315892">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315895">if</span>&nbsp;<span class="ident" id="6315898">w</span><span class="op" id="6315899">.</span><span class="ident" id="6315900">closed</span>&nbsp;<span class="op" id="6315907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315911">return</span>&nbsp;<span class="ident" id="6315918">errors</span><span class="op" id="6315924">.</span><span class="ident" id="6315925">New</span><span class="op" id="6315928">(</span><span class="string" id="6315929">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6315953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315959">w</span><span class="op" id="6315960">.</span><span class="ident" id="6315961">closed</span>&nbsp;<span class="op" id="6315968">=</span>&nbsp;<span class="builtintype" id="6315970">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315976">if</span>&nbsp;<span class="ident" id="6315979">err</span>&nbsp;<span class="op" id="6315983">:=</span>&nbsp;<span class="ident" id="6315986">w</span><span class="op" id="6315987">.</span><span class="ident" id="6315988">comp</span><span class="op" id="6315992">.</span><span class="ident" id="6315993">Close</span><span class="op" id="6315998">(</span><span class="op" id="6315999">)</span><span class="op" id="6316000">;</span>&nbsp;<span class="ident" id="6316002">err</span>&nbsp;<span class="op" id="6316006">!=</span>&nbsp;<span class="ident" id="6316009">nil</span>&nbsp;<span class="op" id="6316013">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316017">return</span>&nbsp;<span class="ident" id="6316024">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316033">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316055">fh</span>&nbsp;<span class="op" id="6316058">:=</span>&nbsp;<span class="ident" id="6316061">w</span><span class="op" id="6316062">.</span><span class="ident" id="6316063">header</span><span class="op" id="6316069">.</span><span class="ident" id="6316070">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316082">fh</span><span class="op" id="6316084">.</span><span class="ident" id="6316085">CRC32</span>&nbsp;<span class="op" id="6316091">=</span>&nbsp;<span class="ident" id="6316093">w</span><span class="op" id="6316094">.</span><span class="ident" id="6316095">crc32</span><span class="op" id="6316100">.</span><span class="ident" id="6316101">Sum32</span><span class="op" id="6316106">(</span><span class="op" id="6316107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316110">fh</span><span class="op" id="6316112">.</span><span class="ident" id="6316113">CompressedSize64</span>&nbsp;<span class="op" id="6316130">=</span>&nbsp;<span class="ident" id="6316132">uint64</span><span class="op" id="6316138">(</span><span class="ident" id="6316139">w</span><span class="op" id="6316140">.</span><span class="ident" id="6316141">compCount</span><span class="op" id="6316150">.</span><span class="ident" id="6316151">count</span><span class="op" id="6316156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316159">fh</span><span class="op" id="6316161">.</span><span class="ident" id="6316162">UncompressedSize64</span>&nbsp;<span class="op" id="6316181">=</span>&nbsp;<span class="ident" id="6316183">uint64</span><span class="op" id="6316189">(</span><span class="ident" id="6316190">w</span><span class="op" id="6316191">.</span><span class="ident" id="6316192">rawCount</span><span class="op" id="6316200">.</span><span class="ident" id="6316201">count</span><span class="op" id="6316206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316210">if</span>&nbsp;<span class="ident" id="6316213">fh</span><span class="op" id="6316215">.</span><span class="ident" id="6316216">isZip64</span><span class="op" id="6316223">(</span><span class="op" id="6316224">)</span>&nbsp;<span class="op" id="6316226">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316230">fh</span><span class="op" id="6316232">.</span><span class="ident" id="6316233">CompressedSize</span>&nbsp;<span class="op" id="6316248">=</span>&nbsp;<span class="ident" id="6316250">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316262">fh</span><span class="op" id="6316264">.</span><span class="ident" id="6316265">UncompressedSize</span>&nbsp;<span class="op" id="6316282">=</span>&nbsp;<span class="ident" id="6316284">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316296">fh</span><span class="op" id="6316298">.</span><span class="ident" id="6316299">ReaderVersion</span>&nbsp;<span class="op" id="6316313">=</span>&nbsp;<span class="ident" id="6316315">zipVersion45</span>&nbsp;<span class="comment" id="6316328">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316381">}</span>&nbsp;<span class="keyword" id="6316383">else</span>&nbsp;<span class="op" id="6316388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316392">fh</span><span class="op" id="6316394">.</span><span class="ident" id="6316395">CompressedSize</span>&nbsp;<span class="op" id="6316410">=</span>&nbsp;<span class="builtintype" id="6316412">uint32</span><span class="op" id="6316418">(</span><span class="ident" id="6316419">fh</span><span class="op" id="6316421">.</span><span class="ident" id="6316422">CompressedSize64</span><span class="op" id="6316438">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316442">fh</span><span class="op" id="6316444">.</span><span class="ident" id="6316445">UncompressedSize</span>&nbsp;<span class="op" id="6316462">=</span>&nbsp;<span class="builtintype" id="6316464">uint32</span><span class="op" id="6316470">(</span><span class="ident" id="6316471">fh</span><span class="op" id="6316473">.</span><span class="ident" id="6316474">UncompressedSize64</span><span class="op" id="6316492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316499">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316566">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316626">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316690">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316755">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316819">var</span>&nbsp;<span class="ident" id="6316823">buf</span>&nbsp;<span class="op" id="6316827">[</span><span class="op" id="6316828">]</span><span class="builtintype" id="6316829">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316835">if</span>&nbsp;<span class="ident" id="6316838">fh</span><span class="op" id="6316840">.</span><span class="ident" id="6316841">isZip64</span><span class="op" id="6316848">(</span><span class="op" id="6316849">)</span>&nbsp;<span class="op" id="6316851">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316855">buf</span>&nbsp;<span class="op" id="6316859">=</span>&nbsp;<span class="builtinfunc" id="6316861">make</span><span class="op" id="6316865">(</span><span class="op" id="6316866">[</span><span class="op" id="6316867">]</span><span class="builtintype" id="6316868">byte</span><span class="op" id="6316872">,</span>&nbsp;<span class="ident" id="6316874">dataDescriptor64Len</span><span class="op" id="6316893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316896">}</span>&nbsp;<span class="keyword" id="6316898">else</span>&nbsp;<span class="op" id="6316903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316907">buf</span>&nbsp;<span class="op" id="6316911">=</span>&nbsp;<span class="builtinfunc" id="6316913">make</span><span class="op" id="6316917">(</span><span class="op" id="6316918">[</span><span class="op" id="6316919">]</span><span class="builtintype" id="6316920">byte</span><span class="op" id="6316924">,</span>&nbsp;<span class="ident" id="6316926">dataDescriptorLen</span><span class="op" id="6316943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316949">b</span>&nbsp;<span class="op" id="6316951">:=</span>&nbsp;<span class="ident" id="6316954">writeBuf</span><span class="op" id="6316962">(</span><span class="ident" id="6316963">buf</span><span class="op" id="6316966">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316969">b</span><span class="op" id="6316970">.</span><span class="builtintype" id="6316971">uint32</span><span class="op" id="6316977">(</span><span class="ident" id="6316978">dataDescriptorSignature</span><span class="op" id="6317001">)</span>&nbsp;<span class="comment" id="6317003">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317043">b</span><span class="op" id="6317044">.</span><span class="builtintype" id="6317045">uint32</span><span class="op" id="6317051">(</span><span class="ident" id="6317052">fh</span><span class="op" id="6317054">.</span><span class="ident" id="6317055">CRC32</span><span class="op" id="6317060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317063">if</span>&nbsp;<span class="ident" id="6317066">fh</span><span class="op" id="6317068">.</span><span class="ident" id="6317069">isZip64</span><span class="op" id="6317076">(</span><span class="op" id="6317077">)</span>&nbsp;<span class="op" id="6317079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317083">b</span><span class="op" id="6317084">.</span><span class="ident" id="6317085">uint64</span><span class="op" id="6317091">(</span><span class="ident" id="6317092">fh</span><span class="op" id="6317094">.</span><span class="ident" id="6317095">CompressedSize64</span><span class="op" id="6317111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317115">b</span><span class="op" id="6317116">.</span><span class="ident" id="6317117">uint64</span><span class="op" id="6317123">(</span><span class="ident" id="6317124">fh</span><span class="op" id="6317126">.</span><span class="ident" id="6317127">UncompressedSize64</span><span class="op" id="6317145">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317148">}</span>&nbsp;<span class="keyword" id="6317150">else</span>&nbsp;<span class="op" id="6317155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317159">b</span><span class="op" id="6317160">.</span><span class="builtintype" id="6317161">uint32</span><span class="op" id="6317167">(</span><span class="ident" id="6317168">fh</span><span class="op" id="6317170">.</span><span class="ident" id="6317171">CompressedSize</span><span class="op" id="6317185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317189">b</span><span class="op" id="6317190">.</span><span class="builtintype" id="6317191">uint32</span><span class="op" id="6317197">(</span><span class="ident" id="6317198">fh</span><span class="op" id="6317200">.</span><span class="ident" id="6317201">UncompressedSize</span><span class="op" id="6317217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317223">_</span><span class="op" id="6317224">,</span>&nbsp;<span class="ident" id="6317226">err</span>&nbsp;<span class="op" id="6317230">:=</span>&nbsp;<span class="ident" id="6317233">w</span><span class="op" id="6317234">.</span><span class="ident" id="6317235">zipw</span><span class="op" id="6317239">.</span><span class="ident" id="6317240">Write</span><span class="op" id="6317245">(</span><span class="ident" id="6317246">buf</span><span class="op" id="6317249">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317252">return</span>&nbsp;<span class="ident" id="6317259">err</span><br>
<span class="lineno"></span><span class="op" id="6317263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317266">type</span>&nbsp;<span class="ident" id="6317271">countWriter</span>&nbsp;<span class="keyword" id="6317283">struct</span>&nbsp;<span class="op" id="6317290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317293">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317299">io</span><span class="op" id="6317301">.</span><span class="ident" id="6317302">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317310">count</span>&nbsp;<span class="ident" id="6317316">int64</span><br>
<span class="lineno"></span><span class="op" id="6317322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317325">func</span>&nbsp;<span class="op" id="6317330">(</span><span class="ident" id="6317331">w</span>&nbsp;<span class="op" id="6317333">*</span><span class="ident" id="6317334">countWriter</span><span class="op" id="6317345">)</span>&nbsp;<span class="ident" id="6317347">Write</span><span class="op" id="6317352">(</span><span class="ident" id="6317353">p</span>&nbsp;<span class="op" id="6317355">[</span><span class="op" id="6317356">]</span><span class="builtintype" id="6317357">byte</span><span class="op" id="6317361">)</span>&nbsp;<span class="op" id="6317363">(</span><span class="builtintype" id="6317364">int</span><span class="op" id="6317367">,</span>&nbsp;<span class="builtintype" id="6317369">error</span><span class="op" id="6317374">)</span>&nbsp;<span class="op" id="6317376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317379">n</span><span class="op" id="6317380">,</span>&nbsp;<span class="ident" id="6317382">err</span>&nbsp;<span class="op" id="6317386">:=</span>&nbsp;<span class="ident" id="6317389">w</span><span class="op" id="6317390">.</span><span class="ident" id="6317391">w</span><span class="op" id="6317392">.</span><span class="ident" id="6317393">Write</span><span class="op" id="6317398">(</span><span class="ident" id="6317399">p</span><span class="op" id="6317400">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317403">w</span><span class="op" id="6317404">.</span><span class="ident" id="6317405">count</span>&nbsp;<span class="op" id="6317411">+=</span>&nbsp;<span class="ident" id="6317414">int64</span><span class="op" id="6317419">(</span><span class="ident" id="6317420">n</span><span class="op" id="6317421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317424">return</span>&nbsp;<span class="ident" id="6317431">n</span><span class="op" id="6317432">,</span>&nbsp;<span class="ident" id="6317434">err</span><br>
<span class="lineno"></span><span class="op" id="6317438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317441">type</span>&nbsp;<span class="ident" id="6317446">nopCloser</span>&nbsp;<span class="keyword" id="6317456">struct</span>&nbsp;<span class="op" id="6317463">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317466">io</span><span class="op" id="6317468">.</span><span class="ident" id="6317469">Writer</span><br>
<span class="lineno"></span><span class="op" id="6317476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317479">func</span>&nbsp;<span class="op" id="6317484">(</span><span class="ident" id="6317485">w</span>&nbsp;<span class="ident" id="6317487">nopCloser</span><span class="op" id="6317496">)</span>&nbsp;<span class="ident" id="6317498">Close</span><span class="op" id="6317503">(</span><span class="op" id="6317504">)</span>&nbsp;<span class="builtintype" id="6317506">error</span>&nbsp;<span class="op" id="6317512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317515">return</span>&nbsp;<span class="ident" id="6317522">nil</span><br>
<span class="lineno">340</span><span class="op" id="6317526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317529">type</span>&nbsp;<span class="ident" id="6317534">writeBuf</span>&nbsp;<span class="op" id="6317543">[</span><span class="op" id="6317544">]</span><span class="builtintype" id="6317545">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317551">func</span>&nbsp;<span class="op" id="6317556">(</span><span class="ident" id="6317557">b</span>&nbsp;<span class="op" id="6317559">*</span><span class="ident" id="6317560">writeBuf</span><span class="op" id="6317568">)</span>&nbsp;<span class="builtintype" id="6317570">uint16</span><span class="op" id="6317576">(</span><span class="ident" id="6317577">v</span>&nbsp;<span class="builtintype" id="6317579">uint16</span><span class="op" id="6317585">)</span>&nbsp;<span class="op" id="6317587">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317590">binary</span><span class="op" id="6317596">.</span><span class="ident" id="6317597">LittleEndian</span><span class="op" id="6317609">.</span><span class="ident" id="6317610">PutUint16</span><span class="op" id="6317619">(</span><span class="op" id="6317620">*</span><span class="ident" id="6317621">b</span><span class="op" id="6317622">,</span>&nbsp;<span class="ident" id="6317624">v</span><span class="op" id="6317625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317628">*</span><span class="ident" id="6317629">b</span>&nbsp;<span class="op" id="6317631">=</span>&nbsp;<span class="op" id="6317633">(</span><span class="op" id="6317634">*</span><span class="ident" id="6317635">b</span><span class="op" id="6317636">)</span><span class="op" id="6317637">[</span><span class="num" id="6317638">2</span><span class="op" id="6317639">:</span><span class="op" id="6317640">]</span><br>
<span class="lineno"></span><span class="op" id="6317642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317645">func</span>&nbsp;<span class="op" id="6317650">(</span><span class="ident" id="6317651">b</span>&nbsp;<span class="op" id="6317653">*</span><span class="ident" id="6317654">writeBuf</span><span class="op" id="6317662">)</span>&nbsp;<span class="builtintype" id="6317664">uint32</span><span class="op" id="6317670">(</span><span class="ident" id="6317671">v</span>&nbsp;<span class="builtintype" id="6317673">uint32</span><span class="op" id="6317679">)</span>&nbsp;<span class="op" id="6317681">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317684">binary</span><span class="op" id="6317690">.</span><span class="ident" id="6317691">LittleEndian</span><span class="op" id="6317703">.</span><span class="ident" id="6317704">PutUint32</span><span class="op" id="6317713">(</span><span class="op" id="6317714">*</span><span class="ident" id="6317715">b</span><span class="op" id="6317716">,</span>&nbsp;<span class="ident" id="6317718">v</span><span class="op" id="6317719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317722">*</span><span class="ident" id="6317723">b</span>&nbsp;<span class="op" id="6317725">=</span>&nbsp;<span class="op" id="6317727">(</span><span class="op" id="6317728">*</span><span class="ident" id="6317729">b</span><span class="op" id="6317730">)</span><span class="op" id="6317731">[</span><span class="num" id="6317732">4</span><span class="op" id="6317733">:</span><span class="op" id="6317734">]</span><br>
<span class="lineno"></span><span class="op" id="6317736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6317739">func</span>&nbsp;<span class="op" id="6317744">(</span><span class="ident" id="6317745">b</span>&nbsp;<span class="op" id="6317747">*</span><span class="ident" id="6317748">writeBuf</span><span class="op" id="6317756">)</span>&nbsp;<span class="ident" id="6317758">uint64</span><span class="op" id="6317764">(</span><span class="ident" id="6317765">v</span>&nbsp;<span class="ident" id="6317767">uint64</span><span class="op" id="6317773">)</span>&nbsp;<span class="op" id="6317775">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317778">binary</span><span class="op" id="6317784">.</span><span class="ident" id="6317785">LittleEndian</span><span class="op" id="6317797">.</span><span class="ident" id="6317798">PutUint64</span><span class="op" id="6317807">(</span><span class="op" id="6317808">*</span><span class="ident" id="6317809">b</span><span class="op" id="6317810">,</span>&nbsp;<span class="ident" id="6317812">v</span><span class="op" id="6317813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317816">*</span><span class="ident" id="6317817">b</span>&nbsp;<span class="op" id="6317819">=</span>&nbsp;<span class="op" id="6317821">(</span><span class="op" id="6317822">*</span><span class="ident" id="6317823">b</span><span class="op" id="6317824">)</span><span class="op" id="6317825">[</span><span class="num" id="6317826">8</span><span class="op" id="6317827">:</span><span class="op" id="6317828">]</span><br>
<span class="lineno"></span><span class="op" id="6317830">}</span>
</div>
</body>
</html>
