<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5224422">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5224477">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5224531">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5224582">package</span>&nbsp;<span class="ident" id="5224590">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5224598">import</span>&nbsp;<span class="op" id="5224605">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5224608">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5224614">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5224630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5224633">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5224702">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5224787">type</span>&nbsp;<span class="ident" id="5224792">queue</span>&nbsp;<span class="keyword" id="5224798">struct</span>&nbsp;<span class="op" id="5224805">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224808">sparse</span>&nbsp;<span class="op" id="5224815">[</span><span class="op" id="5224816">]</span><span class="builtintype" id="5224817">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224825">dense</span>&nbsp;&nbsp;<span class="op" id="5224832">[</span><span class="op" id="5224833">]</span><span class="ident" id="5224834">entry</span><br>
<span class="lineno"></span><span class="op" id="5224840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5224843">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5224878">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5224937">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5225002">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5225067">type</span>&nbsp;<span class="ident" id="5225072">entry</span>&nbsp;<span class="keyword" id="5225078">struct</span>&nbsp;<span class="op" id="5225085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225088">pc</span>&nbsp;<span class="builtintype" id="5225091">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225099">t</span>&nbsp;&nbsp;<span class="op" id="5225102">*</span><span class="ident" id="5225103">thread</span><br>
<span class="lineno"></span><span class="op" id="5225110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5225113">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5225176">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5225229">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5225278">type</span>&nbsp;<span class="ident" id="5225283">thread</span>&nbsp;<span class="keyword" id="5225290">struct</span>&nbsp;<span class="op" id="5225297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225300">inst</span>&nbsp;<span class="op" id="5225305">*</span><span class="ident" id="5225306">syntax</span><span class="op" id="5225312">.</span><span class="ident" id="5225313">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5225319">cap</span>&nbsp;&nbsp;<span class="op" id="5225324">[</span><span class="op" id="5225325">]</span><span class="builtintype" id="5225326">int</span><br>
<span class="lineno"></span><span class="op" id="5225330">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5225333">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5225398">type</span>&nbsp;<span class="ident" id="5225403">machine</span>&nbsp;<span class="keyword" id="5225411">struct</span>&nbsp;<span class="op" id="5225418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225421">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225430">*</span><span class="ident" id="5225431">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225443">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225468">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225477">*</span><span class="ident" id="5225478">syntax</span><span class="op" id="5225484">.</span><span class="ident" id="5225485">Prog</span>&nbsp;<span class="comment" id="5225490">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225511">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225520">*</span><span class="ident" id="5225521">onePassProg</span>&nbsp;<span class="comment" id="5225533">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225577">q0</span><span class="op" id="5225579">,</span>&nbsp;<span class="ident" id="5225581">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5225586">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225599">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225630">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225639">[</span><span class="op" id="5225640">]</span><span class="op" id="5225641">*</span><span class="ident" id="5225642">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225652">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225682">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5225691">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225704">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225734">matchcap</span>&nbsp;<span class="op" id="5225743">[</span><span class="op" id="5225744">]</span><span class="builtintype" id="5225745">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225756">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225795">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225834">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5225846">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225858">inputString</span>&nbsp;<span class="ident" id="5225870">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225883">inputReader</span>&nbsp;<span class="ident" id="5225895">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5225907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225910">func</span>&nbsp;<span class="op" id="5225915">(</span><span class="ident" id="5225916">m</span>&nbsp;<span class="op" id="5225918">*</span><span class="ident" id="5225919">machine</span><span class="op" id="5225926">)</span>&nbsp;<span class="ident" id="5225928">newInputBytes</span><span class="op" id="5225941">(</span><span class="ident" id="5225942">b</span>&nbsp;<span class="op" id="5225944">[</span><span class="op" id="5225945">]</span><span class="builtintype" id="5225946">byte</span><span class="op" id="5225950">)</span>&nbsp;<span class="ident" id="5225952">input</span>&nbsp;<span class="op" id="5225958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225961">m</span><span class="op" id="5225962">.</span><span class="ident" id="5225963">inputBytes</span><span class="op" id="5225973">.</span><span class="ident" id="5225974">str</span>&nbsp;<span class="op" id="5225978">=</span>&nbsp;<span class="ident" id="5225980">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225983">return</span>&nbsp;<span class="op" id="5225990">&amp;</span><span class="ident" id="5225991">m</span><span class="op" id="5225992">.</span><span class="ident" id="5225993">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5226004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226007">func</span>&nbsp;<span class="op" id="5226012">(</span><span class="ident" id="5226013">m</span>&nbsp;<span class="op" id="5226015">*</span><span class="ident" id="5226016">machine</span><span class="op" id="5226023">)</span>&nbsp;<span class="ident" id="5226025">newInputString</span><span class="op" id="5226039">(</span><span class="ident" id="5226040">s</span>&nbsp;<span class="builtintype" id="5226042">string</span><span class="op" id="5226048">)</span>&nbsp;<span class="ident" id="5226050">input</span>&nbsp;<span class="op" id="5226056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226059">m</span><span class="op" id="5226060">.</span><span class="ident" id="5226061">inputString</span><span class="op" id="5226072">.</span><span class="ident" id="5226073">str</span>&nbsp;<span class="op" id="5226077">=</span>&nbsp;<span class="ident" id="5226079">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226082">return</span>&nbsp;<span class="op" id="5226089">&amp;</span><span class="ident" id="5226090">m</span><span class="op" id="5226091">.</span><span class="ident" id="5226092">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5226104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226107">func</span>&nbsp;<span class="op" id="5226112">(</span><span class="ident" id="5226113">m</span>&nbsp;<span class="op" id="5226115">*</span><span class="ident" id="5226116">machine</span><span class="op" id="5226123">)</span>&nbsp;<span class="ident" id="5226125">newInputReader</span><span class="op" id="5226139">(</span><span class="ident" id="5226140">r</span>&nbsp;<span class="ident" id="5226142">io</span><span class="op" id="5226144">.</span><span class="ident" id="5226145">RuneReader</span><span class="op" id="5226155">)</span>&nbsp;<span class="ident" id="5226157">input</span>&nbsp;<span class="op" id="5226163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226166">m</span><span class="op" id="5226167">.</span><span class="ident" id="5226168">inputReader</span><span class="op" id="5226179">.</span><span class="ident" id="5226180">r</span>&nbsp;<span class="op" id="5226182">=</span>&nbsp;<span class="ident" id="5226184">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226187">m</span><span class="op" id="5226188">.</span><span class="ident" id="5226189">inputReader</span><span class="op" id="5226200">.</span><span class="ident" id="5226201">atEOT</span>&nbsp;<span class="op" id="5226207">=</span>&nbsp;<span class="builtintype" id="5226209">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226216">m</span><span class="op" id="5226217">.</span><span class="ident" id="5226218">inputReader</span><span class="op" id="5226229">.</span><span class="ident" id="5226230">pos</span>&nbsp;<span class="op" id="5226234">=</span>&nbsp;<span class="num" id="5226236">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226239">return</span>&nbsp;<span class="op" id="5226246">&amp;</span><span class="ident" id="5226247">m</span><span class="op" id="5226248">.</span><span class="ident" id="5226249">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5226261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5226264">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5226321">func</span>&nbsp;<span class="ident" id="5226326">progMachine</span><span class="op" id="5226337">(</span><span class="ident" id="5226338">p</span>&nbsp;<span class="op" id="5226340">*</span><span class="ident" id="5226341">syntax</span><span class="op" id="5226347">.</span><span class="ident" id="5226348">Prog</span><span class="op" id="5226352">,</span>&nbsp;<span class="ident" id="5226354">op</span>&nbsp;<span class="op" id="5226357">*</span><span class="ident" id="5226358">onePassProg</span><span class="op" id="5226369">)</span>&nbsp;<span class="op" id="5226371">*</span><span class="ident" id="5226372">machine</span>&nbsp;<span class="op" id="5226380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226383">m</span>&nbsp;<span class="op" id="5226385">:=</span>&nbsp;<span class="op" id="5226388">&amp;</span><span class="ident" id="5226389">machine</span><span class="op" id="5226396">{</span><span class="ident" id="5226397">p</span><span class="op" id="5226398">:</span>&nbsp;<span class="ident" id="5226400">p</span><span class="op" id="5226401">,</span>&nbsp;<span class="ident" id="5226403">op</span><span class="op" id="5226405">:</span>&nbsp;<span class="ident" id="5226407">op</span><span class="op" id="5226409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226412">n</span>&nbsp;<span class="op" id="5226414">:=</span>&nbsp;<span class="builtinfunc" id="5226417">len</span><span class="op" id="5226420">(</span><span class="ident" id="5226421">m</span><span class="op" id="5226422">.</span><span class="ident" id="5226423">p</span><span class="op" id="5226424">.</span><span class="ident" id="5226425">Inst</span><span class="op" id="5226429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226432">m</span><span class="op" id="5226433">.</span><span class="ident" id="5226434">q0</span>&nbsp;<span class="op" id="5226437">=</span>&nbsp;<span class="ident" id="5226439">queue</span><span class="op" id="5226444">{</span><span class="builtinfunc" id="5226445">make</span><span class="op" id="5226449">(</span><span class="op" id="5226450">[</span><span class="op" id="5226451">]</span><span class="builtintype" id="5226452">uint32</span><span class="op" id="5226458">,</span>&nbsp;<span class="ident" id="5226460">n</span><span class="op" id="5226461">)</span><span class="op" id="5226462">,</span>&nbsp;<span class="builtinfunc" id="5226464">make</span><span class="op" id="5226468">(</span><span class="op" id="5226469">[</span><span class="op" id="5226470">]</span><span class="ident" id="5226471">entry</span><span class="op" id="5226476">,</span>&nbsp;<span class="num" id="5226478">0</span><span class="op" id="5226479">,</span>&nbsp;<span class="ident" id="5226481">n</span><span class="op" id="5226482">)</span><span class="op" id="5226483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226486">m</span><span class="op" id="5226487">.</span><span class="ident" id="5226488">q1</span>&nbsp;<span class="op" id="5226491">=</span>&nbsp;<span class="ident" id="5226493">queue</span><span class="op" id="5226498">{</span><span class="builtinfunc" id="5226499">make</span><span class="op" id="5226503">(</span><span class="op" id="5226504">[</span><span class="op" id="5226505">]</span><span class="builtintype" id="5226506">uint32</span><span class="op" id="5226512">,</span>&nbsp;<span class="ident" id="5226514">n</span><span class="op" id="5226515">)</span><span class="op" id="5226516">,</span>&nbsp;<span class="builtinfunc" id="5226518">make</span><span class="op" id="5226522">(</span><span class="op" id="5226523">[</span><span class="op" id="5226524">]</span><span class="ident" id="5226525">entry</span><span class="op" id="5226530">,</span>&nbsp;<span class="num" id="5226532">0</span><span class="op" id="5226533">,</span>&nbsp;<span class="ident" id="5226535">n</span><span class="op" id="5226536">)</span><span class="op" id="5226537">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226540">ncap</span>&nbsp;<span class="op" id="5226545">:=</span>&nbsp;<span class="ident" id="5226548">p</span><span class="op" id="5226549">.</span><span class="ident" id="5226550">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226558">if</span>&nbsp;<span class="ident" id="5226561">ncap</span>&nbsp;<span class="op" id="5226566">&lt;</span>&nbsp;<span class="num" id="5226568">2</span>&nbsp;<span class="op" id="5226570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226574">ncap</span>&nbsp;<span class="op" id="5226579">=</span>&nbsp;<span class="num" id="5226581">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226587">m</span><span class="op" id="5226588">.</span><span class="ident" id="5226589">matchcap</span>&nbsp;<span class="op" id="5226598">=</span>&nbsp;<span class="builtinfunc" id="5226600">make</span><span class="op" id="5226604">(</span><span class="op" id="5226605">[</span><span class="op" id="5226606">]</span><span class="builtintype" id="5226607">int</span><span class="op" id="5226610">,</span>&nbsp;<span class="ident" id="5226612">ncap</span><span class="op" id="5226616">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226619">return</span>&nbsp;<span class="ident" id="5226626">m</span><br>
<span class="lineno"></span><span class="op" id="5226628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226631">func</span>&nbsp;<span class="op" id="5226636">(</span><span class="ident" id="5226637">m</span>&nbsp;<span class="op" id="5226639">*</span><span class="ident" id="5226640">machine</span><span class="op" id="5226647">)</span>&nbsp;<span class="ident" id="5226649">init</span><span class="op" id="5226653">(</span><span class="ident" id="5226654">ncap</span>&nbsp;<span class="builtintype" id="5226659">int</span><span class="op" id="5226662">)</span>&nbsp;<span class="op" id="5226664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226667">for</span>&nbsp;<span class="ident" id="5226671">_</span><span class="op" id="5226672">,</span>&nbsp;<span class="ident" id="5226674">t</span>&nbsp;<span class="op" id="5226676">:=</span>&nbsp;<span class="keyword" id="5226679">range</span>&nbsp;<span class="ident" id="5226685">m</span><span class="op" id="5226686">.</span><span class="ident" id="5226687">pool</span>&nbsp;<span class="op" id="5226692">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226696">t</span><span class="op" id="5226697">.</span><span class="builtinfunc" id="5226698">cap</span>&nbsp;<span class="op" id="5226702">=</span>&nbsp;<span class="ident" id="5226704">t</span><span class="op" id="5226705">.</span><span class="builtinfunc" id="5226706">cap</span><span class="op" id="5226709">[</span><span class="op" id="5226710">:</span><span class="ident" id="5226711">ncap</span><span class="op" id="5226715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226721">m</span><span class="op" id="5226722">.</span><span class="ident" id="5226723">matchcap</span>&nbsp;<span class="op" id="5226732">=</span>&nbsp;<span class="ident" id="5226734">m</span><span class="op" id="5226735">.</span><span class="ident" id="5226736">matchcap</span><span class="op" id="5226744">[</span><span class="op" id="5226745">:</span><span class="ident" id="5226746">ncap</span><span class="op" id="5226750">]</span><br>
<span class="lineno"></span><span class="op" id="5226752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5226755">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5226815">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5226853">func</span>&nbsp;<span class="op" id="5226858">(</span><span class="ident" id="5226859">m</span>&nbsp;<span class="op" id="5226861">*</span><span class="ident" id="5226862">machine</span><span class="op" id="5226869">)</span>&nbsp;<span class="ident" id="5226871">alloc</span><span class="op" id="5226876">(</span><span class="ident" id="5226877">i</span>&nbsp;<span class="op" id="5226879">*</span><span class="ident" id="5226880">syntax</span><span class="op" id="5226886">.</span><span class="ident" id="5226887">Inst</span><span class="op" id="5226891">)</span>&nbsp;<span class="op" id="5226893">*</span><span class="ident" id="5226894">thread</span>&nbsp;<span class="op" id="5226901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226904">var</span>&nbsp;<span class="ident" id="5226908">t</span>&nbsp;<span class="op" id="5226910">*</span><span class="ident" id="5226911">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226919">if</span>&nbsp;<span class="ident" id="5226922">n</span>&nbsp;<span class="op" id="5226924">:=</span>&nbsp;<span class="builtinfunc" id="5226927">len</span><span class="op" id="5226930">(</span><span class="ident" id="5226931">m</span><span class="op" id="5226932">.</span><span class="ident" id="5226933">pool</span><span class="op" id="5226937">)</span><span class="op" id="5226938">;</span>&nbsp;<span class="ident" id="5226940">n</span>&nbsp;<span class="op" id="5226942">&gt;</span>&nbsp;<span class="num" id="5226944">0</span>&nbsp;<span class="op" id="5226946">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226950">t</span>&nbsp;<span class="op" id="5226952">=</span>&nbsp;<span class="ident" id="5226954">m</span><span class="op" id="5226955">.</span><span class="ident" id="5226956">pool</span><span class="op" id="5226960">[</span><span class="ident" id="5226961">n</span><span class="op" id="5226962">-</span><span class="num" id="5226963">1</span><span class="op" id="5226964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226968">m</span><span class="op" id="5226969">.</span><span class="ident" id="5226970">pool</span>&nbsp;<span class="op" id="5226975">=</span>&nbsp;<span class="ident" id="5226977">m</span><span class="op" id="5226978">.</span><span class="ident" id="5226979">pool</span><span class="op" id="5226983">[</span><span class="op" id="5226984">:</span><span class="ident" id="5226985">n</span><span class="op" id="5226986">-</span><span class="num" id="5226987">1</span><span class="op" id="5226988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226991">}</span>&nbsp;<span class="keyword" id="5226993">else</span>&nbsp;<span class="op" id="5226998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227002">t</span>&nbsp;<span class="op" id="5227004">=</span>&nbsp;<span class="builtinfunc" id="5227006">new</span><span class="op" id="5227009">(</span><span class="ident" id="5227010">thread</span><span class="op" id="5227016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227020">t</span><span class="op" id="5227021">.</span><span class="builtinfunc" id="5227022">cap</span>&nbsp;<span class="op" id="5227026">=</span>&nbsp;<span class="builtinfunc" id="5227028">make</span><span class="op" id="5227032">(</span><span class="op" id="5227033">[</span><span class="op" id="5227034">]</span><span class="builtintype" id="5227035">int</span><span class="op" id="5227038">,</span>&nbsp;<span class="builtinfunc" id="5227040">len</span><span class="op" id="5227043">(</span><span class="ident" id="5227044">m</span><span class="op" id="5227045">.</span><span class="ident" id="5227046">matchcap</span><span class="op" id="5227054">)</span><span class="op" id="5227055">,</span>&nbsp;<span class="builtinfunc" id="5227057">cap</span><span class="op" id="5227060">(</span><span class="ident" id="5227061">m</span><span class="op" id="5227062">.</span><span class="ident" id="5227063">matchcap</span><span class="op" id="5227071">)</span><span class="op" id="5227072">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227078">t</span><span class="op" id="5227079">.</span><span class="ident" id="5227080">inst</span>&nbsp;<span class="op" id="5227085">=</span>&nbsp;<span class="ident" id="5227087">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227090">return</span>&nbsp;<span class="ident" id="5227097">t</span><br>
<span class="lineno"></span><span class="op" id="5227099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5227102">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5227138">func</span>&nbsp;<span class="op" id="5227143">(</span><span class="ident" id="5227144">m</span>&nbsp;<span class="op" id="5227146">*</span><span class="ident" id="5227147">machine</span><span class="op" id="5227154">)</span>&nbsp;<span class="ident" id="5227156">free</span><span class="op" id="5227160">(</span><span class="ident" id="5227161">t</span>&nbsp;<span class="op" id="5227163">*</span><span class="ident" id="5227164">thread</span><span class="op" id="5227170">)</span>&nbsp;<span class="op" id="5227172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227175">m</span><span class="op" id="5227176">.</span><span class="ident" id="5227177">inputBytes</span><span class="op" id="5227187">.</span><span class="ident" id="5227188">str</span>&nbsp;<span class="op" id="5227192">=</span>&nbsp;<span class="ident" id="5227194">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227199">m</span><span class="op" id="5227200">.</span><span class="ident" id="5227201">inputString</span><span class="op" id="5227212">.</span><span class="ident" id="5227213">str</span>&nbsp;<span class="op" id="5227217">=</span>&nbsp;<span class="string" id="5227219">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227223">m</span><span class="op" id="5227224">.</span><span class="ident" id="5227225">inputReader</span><span class="op" id="5227236">.</span><span class="ident" id="5227237">r</span>&nbsp;<span class="op" id="5227239">=</span>&nbsp;<span class="ident" id="5227241">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227246">m</span><span class="op" id="5227247">.</span><span class="ident" id="5227248">pool</span>&nbsp;<span class="op" id="5227253">=</span>&nbsp;<span class="builtinfunc" id="5227255">append</span><span class="op" id="5227261">(</span><span class="ident" id="5227262">m</span><span class="op" id="5227263">.</span><span class="ident" id="5227264">pool</span><span class="op" id="5227268">,</span>&nbsp;<span class="ident" id="5227270">t</span><span class="op" id="5227271">)</span><br>
<span class="lineno"></span><span class="op" id="5227273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5227276">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5227334">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5227375">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5227428">func</span>&nbsp;<span class="op" id="5227433">(</span><span class="ident" id="5227434">m</span>&nbsp;<span class="op" id="5227436">*</span><span class="ident" id="5227437">machine</span><span class="op" id="5227444">)</span>&nbsp;<span class="ident" id="5227446">match</span><span class="op" id="5227451">(</span><span class="ident" id="5227452">i</span>&nbsp;<span class="ident" id="5227454">input</span><span class="op" id="5227459">,</span>&nbsp;<span class="ident" id="5227461">pos</span>&nbsp;<span class="builtintype" id="5227465">int</span><span class="op" id="5227468">)</span>&nbsp;<span class="builtintype" id="5227470">bool</span>&nbsp;<span class="op" id="5227475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227478">startCond</span>&nbsp;<span class="op" id="5227488">:=</span>&nbsp;<span class="ident" id="5227491">m</span><span class="op" id="5227492">.</span><span class="ident" id="5227493">re</span><span class="op" id="5227495">.</span><span class="ident" id="5227496">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227502">if</span>&nbsp;<span class="ident" id="5227505">startCond</span>&nbsp;<span class="op" id="5227515">==</span>&nbsp;<span class="op" id="5227518">^</span><span class="ident" id="5227519">syntax</span><span class="op" id="5227525">.</span><span class="ident" id="5227526">EmptyOp</span><span class="op" id="5227533">(</span><span class="num" id="5227534">0</span><span class="op" id="5227535">)</span>&nbsp;<span class="op" id="5227537">{</span>&nbsp;<span class="comment" id="5227539">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227555">return</span>&nbsp;<span class="builtintype" id="5227562">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227572">m</span><span class="op" id="5227573">.</span><span class="ident" id="5227574">matched</span>&nbsp;<span class="op" id="5227582">=</span>&nbsp;<span class="builtintype" id="5227584">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227591">for</span>&nbsp;<span class="ident" id="5227595">i</span>&nbsp;<span class="op" id="5227597">:=</span>&nbsp;<span class="keyword" id="5227600">range</span>&nbsp;<span class="ident" id="5227606">m</span><span class="op" id="5227607">.</span><span class="ident" id="5227608">matchcap</span>&nbsp;<span class="op" id="5227617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227621">m</span><span class="op" id="5227622">.</span><span class="ident" id="5227623">matchcap</span><span class="op" id="5227631">[</span><span class="ident" id="5227632">i</span><span class="op" id="5227633">]</span>&nbsp;<span class="op" id="5227635">=</span>&nbsp;<span class="op" id="5227637">-</span><span class="num" id="5227638">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227641">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227644">runq</span><span class="op" id="5227648">,</span>&nbsp;<span class="ident" id="5227650">nextq</span>&nbsp;<span class="op" id="5227656">:=</span>&nbsp;<span class="op" id="5227659">&amp;</span><span class="ident" id="5227660">m</span><span class="op" id="5227661">.</span><span class="ident" id="5227662">q0</span><span class="op" id="5227664">,</span>&nbsp;<span class="op" id="5227666">&amp;</span><span class="ident" id="5227667">m</span><span class="op" id="5227668">.</span><span class="ident" id="5227669">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227673">r</span><span class="op" id="5227674">,</span>&nbsp;<span class="ident" id="5227676">r1</span>&nbsp;<span class="op" id="5227679">:=</span>&nbsp;<span class="ident" id="5227682">endOfText</span><span class="op" id="5227691">,</span>&nbsp;<span class="ident" id="5227693">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227704">width</span><span class="op" id="5227709">,</span>&nbsp;<span class="ident" id="5227711">width1</span>&nbsp;<span class="op" id="5227718">:=</span>&nbsp;<span class="num" id="5227721">0</span><span class="op" id="5227722">,</span>&nbsp;<span class="num" id="5227724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227727">r</span><span class="op" id="5227728">,</span>&nbsp;<span class="ident" id="5227730">width</span>&nbsp;<span class="op" id="5227736">=</span>&nbsp;<span class="ident" id="5227738">i</span><span class="op" id="5227739">.</span><span class="ident" id="5227740">step</span><span class="op" id="5227744">(</span><span class="ident" id="5227745">pos</span><span class="op" id="5227748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227751">if</span>&nbsp;<span class="ident" id="5227754">r</span>&nbsp;<span class="op" id="5227756">!=</span>&nbsp;<span class="ident" id="5227759">endOfText</span>&nbsp;<span class="op" id="5227769">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227773">r1</span><span class="op" id="5227775">,</span>&nbsp;<span class="ident" id="5227777">width1</span>&nbsp;<span class="op" id="5227784">=</span>&nbsp;<span class="ident" id="5227786">i</span><span class="op" id="5227787">.</span><span class="ident" id="5227788">step</span><span class="op" id="5227792">(</span><span class="ident" id="5227793">pos</span>&nbsp;<span class="op" id="5227797">+</span>&nbsp;<span class="ident" id="5227799">width</span><span class="op" id="5227804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227810">var</span>&nbsp;<span class="ident" id="5227814">flag</span>&nbsp;<span class="ident" id="5227819">syntax</span><span class="op" id="5227825">.</span><span class="ident" id="5227826">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227835">if</span>&nbsp;<span class="ident" id="5227838">pos</span>&nbsp;<span class="op" id="5227842">==</span>&nbsp;<span class="num" id="5227845">0</span>&nbsp;<span class="op" id="5227847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227851">flag</span>&nbsp;<span class="op" id="5227856">=</span>&nbsp;<span class="ident" id="5227858">syntax</span><span class="op" id="5227864">.</span><span class="ident" id="5227865">EmptyOpContext</span><span class="op" id="5227879">(</span><span class="op" id="5227880">-</span><span class="num" id="5227881">1</span><span class="op" id="5227882">,</span>&nbsp;<span class="ident" id="5227884">r</span><span class="op" id="5227885">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227888">}</span>&nbsp;<span class="keyword" id="5227890">else</span>&nbsp;<span class="op" id="5227895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227899">flag</span>&nbsp;<span class="op" id="5227904">=</span>&nbsp;<span class="ident" id="5227906">i</span><span class="op" id="5227907">.</span><span class="ident" id="5227908">context</span><span class="op" id="5227915">(</span><span class="ident" id="5227916">pos</span><span class="op" id="5227919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227925">for</span>&nbsp;<span class="op" id="5227929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227933">if</span>&nbsp;<span class="builtinfunc" id="5227936">len</span><span class="op" id="5227939">(</span><span class="ident" id="5227940">runq</span><span class="op" id="5227944">.</span><span class="ident" id="5227945">dense</span><span class="op" id="5227950">)</span>&nbsp;<span class="op" id="5227952">==</span>&nbsp;<span class="num" id="5227955">0</span>&nbsp;<span class="op" id="5227957">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227962">if</span>&nbsp;<span class="ident" id="5227965">startCond</span><span class="op" id="5227974">&amp;</span><span class="ident" id="5227975">syntax</span><span class="op" id="5227981">.</span><span class="ident" id="5227982">EmptyBeginText</span>&nbsp;<span class="op" id="5227997">!=</span>&nbsp;<span class="num" id="5228000">0</span>&nbsp;<span class="op" id="5228002">&amp;&amp;</span>&nbsp;<span class="ident" id="5228005">pos</span>&nbsp;<span class="op" id="5228009">!=</span>&nbsp;<span class="num" id="5228012">0</span>&nbsp;<span class="op" id="5228014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228020">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228067">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228081">if</span>&nbsp;<span class="ident" id="5228084">m</span><span class="op" id="5228085">.</span><span class="ident" id="5228086">matched</span>&nbsp;<span class="op" id="5228094">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228100">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228166">if</span>&nbsp;<span class="builtinfunc" id="5228169">len</span><span class="op" id="5228172">(</span><span class="ident" id="5228173">m</span><span class="op" id="5228174">.</span><span class="ident" id="5228175">re</span><span class="op" id="5228177">.</span><span class="ident" id="5228178">prefix</span><span class="op" id="5228184">)</span>&nbsp;<span class="op" id="5228186">&gt;</span>&nbsp;<span class="num" id="5228188">0</span>&nbsp;<span class="op" id="5228190">&amp;&amp;</span>&nbsp;<span class="ident" id="5228193">r1</span>&nbsp;<span class="op" id="5228196">!=</span>&nbsp;<span class="ident" id="5228199">m</span><span class="op" id="5228200">.</span><span class="ident" id="5228201">re</span><span class="op" id="5228203">.</span><span class="ident" id="5228204">prefixRune</span>&nbsp;<span class="op" id="5228215">&amp;&amp;</span>&nbsp;<span class="ident" id="5228218">i</span><span class="op" id="5228219">.</span><span class="ident" id="5228220">canCheckPrefix</span><span class="op" id="5228234">(</span><span class="op" id="5228235">)</span>&nbsp;<span class="op" id="5228237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228243">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228301">advance</span>&nbsp;<span class="op" id="5228309">:=</span>&nbsp;<span class="ident" id="5228312">i</span><span class="op" id="5228313">.</span><span class="ident" id="5228314">index</span><span class="op" id="5228319">(</span><span class="ident" id="5228320">m</span><span class="op" id="5228321">.</span><span class="ident" id="5228322">re</span><span class="op" id="5228324">,</span>&nbsp;<span class="ident" id="5228326">pos</span><span class="op" id="5228329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228335">if</span>&nbsp;<span class="ident" id="5228338">advance</span>&nbsp;<span class="op" id="5228346">&lt;</span>&nbsp;<span class="num" id="5228348">0</span>&nbsp;<span class="op" id="5228350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228357">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228373">pos</span>&nbsp;<span class="op" id="5228377">+=</span>&nbsp;<span class="ident" id="5228380">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228392">r</span><span class="op" id="5228393">,</span>&nbsp;<span class="ident" id="5228395">width</span>&nbsp;<span class="op" id="5228401">=</span>&nbsp;<span class="ident" id="5228403">i</span><span class="op" id="5228404">.</span><span class="ident" id="5228405">step</span><span class="op" id="5228409">(</span><span class="ident" id="5228410">pos</span><span class="op" id="5228413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228419">r1</span><span class="op" id="5228421">,</span>&nbsp;<span class="ident" id="5228423">width1</span>&nbsp;<span class="op" id="5228430">=</span>&nbsp;<span class="ident" id="5228432">i</span><span class="op" id="5228433">.</span><span class="ident" id="5228434">step</span><span class="op" id="5228438">(</span><span class="ident" id="5228439">pos</span>&nbsp;<span class="op" id="5228443">+</span>&nbsp;<span class="ident" id="5228445">width</span><span class="op" id="5228450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228463">if</span>&nbsp;<span class="op" id="5228466">!</span><span class="ident" id="5228467">m</span><span class="op" id="5228468">.</span><span class="ident" id="5228469">matched</span>&nbsp;<span class="op" id="5228477">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228482">if</span>&nbsp;<span class="builtinfunc" id="5228485">len</span><span class="op" id="5228488">(</span><span class="ident" id="5228489">m</span><span class="op" id="5228490">.</span><span class="ident" id="5228491">matchcap</span><span class="op" id="5228499">)</span>&nbsp;<span class="op" id="5228501">&gt;</span>&nbsp;<span class="num" id="5228503">0</span>&nbsp;<span class="op" id="5228505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228511">m</span><span class="op" id="5228512">.</span><span class="ident" id="5228513">matchcap</span><span class="op" id="5228521">[</span><span class="num" id="5228522">0</span><span class="op" id="5228523">]</span>&nbsp;<span class="op" id="5228525">=</span>&nbsp;<span class="ident" id="5228527">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228539">m</span><span class="op" id="5228540">.</span><span class="ident" id="5228541">add</span><span class="op" id="5228544">(</span><span class="ident" id="5228545">runq</span><span class="op" id="5228549">,</span>&nbsp;<span class="builtintype" id="5228551">uint32</span><span class="op" id="5228557">(</span><span class="ident" id="5228558">m</span><span class="op" id="5228559">.</span><span class="ident" id="5228560">p</span><span class="op" id="5228561">.</span><span class="ident" id="5228562">Start</span><span class="op" id="5228567">)</span><span class="op" id="5228568">,</span>&nbsp;<span class="ident" id="5228570">pos</span><span class="op" id="5228573">,</span>&nbsp;<span class="ident" id="5228575">m</span><span class="op" id="5228576">.</span><span class="ident" id="5228577">matchcap</span><span class="op" id="5228585">,</span>&nbsp;<span class="ident" id="5228587">flag</span><span class="op" id="5228591">,</span>&nbsp;<span class="ident" id="5228593">nil</span><span class="op" id="5228596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228600">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228604">flag</span>&nbsp;<span class="op" id="5228609">=</span>&nbsp;<span class="ident" id="5228611">syntax</span><span class="op" id="5228617">.</span><span class="ident" id="5228618">EmptyOpContext</span><span class="op" id="5228632">(</span><span class="ident" id="5228633">r</span><span class="op" id="5228634">,</span>&nbsp;<span class="ident" id="5228636">r1</span><span class="op" id="5228638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228642">m</span><span class="op" id="5228643">.</span><span class="ident" id="5228644">step</span><span class="op" id="5228648">(</span><span class="ident" id="5228649">runq</span><span class="op" id="5228653">,</span>&nbsp;<span class="ident" id="5228655">nextq</span><span class="op" id="5228660">,</span>&nbsp;<span class="ident" id="5228662">pos</span><span class="op" id="5228665">,</span>&nbsp;<span class="ident" id="5228667">pos</span><span class="op" id="5228670">+</span><span class="ident" id="5228671">width</span><span class="op" id="5228676">,</span>&nbsp;<span class="ident" id="5228678">r</span><span class="op" id="5228679">,</span>&nbsp;<span class="ident" id="5228681">flag</span><span class="op" id="5228685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228689">if</span>&nbsp;<span class="ident" id="5228692">width</span>&nbsp;<span class="op" id="5228698">==</span>&nbsp;<span class="num" id="5228701">0</span>&nbsp;<span class="op" id="5228703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228708">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228716">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228720">if</span>&nbsp;<span class="builtinfunc" id="5228723">len</span><span class="op" id="5228726">(</span><span class="ident" id="5228727">m</span><span class="op" id="5228728">.</span><span class="ident" id="5228729">matchcap</span><span class="op" id="5228737">)</span>&nbsp;<span class="op" id="5228739">==</span>&nbsp;<span class="num" id="5228742">0</span>&nbsp;<span class="op" id="5228744">&amp;&amp;</span>&nbsp;<span class="ident" id="5228747">m</span><span class="op" id="5228748">.</span><span class="ident" id="5228749">matched</span>&nbsp;<span class="op" id="5228757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228762">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5228807">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228851">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228859">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228863">pos</span>&nbsp;<span class="op" id="5228867">+=</span>&nbsp;<span class="ident" id="5228870">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228878">r</span><span class="op" id="5228879">,</span>&nbsp;<span class="ident" id="5228881">width</span>&nbsp;<span class="op" id="5228887">=</span>&nbsp;<span class="ident" id="5228889">r1</span><span class="op" id="5228891">,</span>&nbsp;<span class="ident" id="5228893">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228902">if</span>&nbsp;<span class="ident" id="5228905">r</span>&nbsp;<span class="op" id="5228907">!=</span>&nbsp;<span class="ident" id="5228910">endOfText</span>&nbsp;<span class="op" id="5228920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228925">r1</span><span class="op" id="5228927">,</span>&nbsp;<span class="ident" id="5228929">width1</span>&nbsp;<span class="op" id="5228936">=</span>&nbsp;<span class="ident" id="5228938">i</span><span class="op" id="5228939">.</span><span class="ident" id="5228940">step</span><span class="op" id="5228944">(</span><span class="ident" id="5228945">pos</span>&nbsp;<span class="op" id="5228949">+</span>&nbsp;<span class="ident" id="5228951">width</span><span class="op" id="5228956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228960">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228964">runq</span><span class="op" id="5228968">,</span>&nbsp;<span class="ident" id="5228970">nextq</span>&nbsp;<span class="op" id="5228976">=</span>&nbsp;<span class="ident" id="5228978">nextq</span><span class="op" id="5228983">,</span>&nbsp;<span class="ident" id="5228985">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228994">m</span><span class="op" id="5228995">.</span><span class="ident" id="5228996">clear</span><span class="op" id="5229001">(</span><span class="ident" id="5229002">nextq</span><span class="op" id="5229007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229010">return</span>&nbsp;<span class="ident" id="5229017">m</span><span class="op" id="5229018">.</span><span class="ident" id="5229019">matched</span><br>
<span class="lineno"></span><span class="op" id="5229027">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5229030">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5229078">func</span>&nbsp;<span class="op" id="5229083">(</span><span class="ident" id="5229084">m</span>&nbsp;<span class="op" id="5229086">*</span><span class="ident" id="5229087">machine</span><span class="op" id="5229094">)</span>&nbsp;<span class="ident" id="5229096">clear</span><span class="op" id="5229101">(</span><span class="ident" id="5229102">q</span>&nbsp;<span class="op" id="5229104">*</span><span class="ident" id="5229105">queue</span><span class="op" id="5229110">)</span>&nbsp;<span class="op" id="5229112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229115">for</span>&nbsp;<span class="ident" id="5229119">_</span><span class="op" id="5229120">,</span>&nbsp;<span class="ident" id="5229122">d</span>&nbsp;<span class="op" id="5229124">:=</span>&nbsp;<span class="keyword" id="5229127">range</span>&nbsp;<span class="ident" id="5229133">q</span><span class="op" id="5229134">.</span><span class="ident" id="5229135">dense</span>&nbsp;<span class="op" id="5229141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229145">if</span>&nbsp;<span class="ident" id="5229148">d</span><span class="op" id="5229149">.</span><span class="ident" id="5229150">t</span>&nbsp;<span class="op" id="5229152">!=</span>&nbsp;<span class="ident" id="5229155">nil</span>&nbsp;<span class="op" id="5229159">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229164">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229182">m</span><span class="op" id="5229183">.</span><span class="ident" id="5229184">pool</span>&nbsp;<span class="op" id="5229189">=</span>&nbsp;<span class="builtinfunc" id="5229191">append</span><span class="op" id="5229197">(</span><span class="ident" id="5229198">m</span><span class="op" id="5229199">.</span><span class="ident" id="5229200">pool</span><span class="op" id="5229204">,</span>&nbsp;<span class="ident" id="5229206">d</span><span class="op" id="5229207">.</span><span class="ident" id="5229208">t</span><span class="op" id="5229209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229219">q</span><span class="op" id="5229220">.</span><span class="ident" id="5229221">dense</span>&nbsp;<span class="op" id="5229227">=</span>&nbsp;<span class="ident" id="5229229">q</span><span class="op" id="5229230">.</span><span class="ident" id="5229231">dense</span><span class="op" id="5229236">[</span><span class="op" id="5229237">:</span><span class="num" id="5229238">0</span><span class="op" id="5229239">]</span><br>
<span class="lineno">195</span><span class="op" id="5229241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5229244">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5229314">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5229361">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5229420">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5229473">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5229538">func</span>&nbsp;<span class="op" id="5229543">(</span><span class="ident" id="5229544">m</span>&nbsp;<span class="op" id="5229546">*</span><span class="ident" id="5229547">machine</span><span class="op" id="5229554">)</span>&nbsp;<span class="ident" id="5229556">step</span><span class="op" id="5229560">(</span><span class="ident" id="5229561">runq</span><span class="op" id="5229565">,</span>&nbsp;<span class="ident" id="5229567">nextq</span>&nbsp;<span class="op" id="5229573">*</span><span class="ident" id="5229574">queue</span><span class="op" id="5229579">,</span>&nbsp;<span class="ident" id="5229581">pos</span><span class="op" id="5229584">,</span>&nbsp;<span class="ident" id="5229586">nextPos</span>&nbsp;<span class="builtintype" id="5229594">int</span><span class="op" id="5229597">,</span>&nbsp;<span class="ident" id="5229599">c</span>&nbsp;<span class="builtintype" id="5229601">rune</span><span class="op" id="5229605">,</span>&nbsp;<span class="ident" id="5229607">nextCond</span>&nbsp;<span class="ident" id="5229616">syntax</span><span class="op" id="5229622">.</span><span class="ident" id="5229623">EmptyOp</span><span class="op" id="5229630">)</span>&nbsp;<span class="op" id="5229632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229635">longest</span>&nbsp;<span class="op" id="5229643">:=</span>&nbsp;<span class="ident" id="5229646">m</span><span class="op" id="5229647">.</span><span class="ident" id="5229648">re</span><span class="op" id="5229650">.</span><span class="ident" id="5229651">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229660">for</span>&nbsp;<span class="ident" id="5229664">j</span>&nbsp;<span class="op" id="5229666">:=</span>&nbsp;<span class="num" id="5229669">0</span><span class="op" id="5229670">;</span>&nbsp;<span class="ident" id="5229672">j</span>&nbsp;<span class="op" id="5229674">&lt;</span>&nbsp;<span class="builtinfunc" id="5229676">len</span><span class="op" id="5229679">(</span><span class="ident" id="5229680">runq</span><span class="op" id="5229684">.</span><span class="ident" id="5229685">dense</span><span class="op" id="5229690">)</span><span class="op" id="5229691">;</span>&nbsp;<span class="ident" id="5229693">j</span><span class="op" id="5229694">++</span>&nbsp;<span class="op" id="5229697">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229701">d</span>&nbsp;<span class="op" id="5229703">:=</span>&nbsp;<span class="op" id="5229706">&amp;</span><span class="ident" id="5229707">runq</span><span class="op" id="5229711">.</span><span class="ident" id="5229712">dense</span><span class="op" id="5229717">[</span><span class="ident" id="5229718">j</span><span class="op" id="5229719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229723">t</span>&nbsp;<span class="op" id="5229725">:=</span>&nbsp;<span class="ident" id="5229728">d</span><span class="op" id="5229729">.</span><span class="ident" id="5229730">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229734">if</span>&nbsp;<span class="ident" id="5229737">t</span>&nbsp;<span class="op" id="5229739">==</span>&nbsp;<span class="ident" id="5229742">nil</span>&nbsp;<span class="op" id="5229746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229751">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229762">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229766">if</span>&nbsp;<span class="ident" id="5229769">longest</span>&nbsp;<span class="op" id="5229777">&amp;&amp;</span>&nbsp;<span class="ident" id="5229780">m</span><span class="op" id="5229781">.</span><span class="ident" id="5229782">matched</span>&nbsp;<span class="op" id="5229790">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5229793">len</span><span class="op" id="5229796">(</span><span class="ident" id="5229797">t</span><span class="op" id="5229798">.</span><span class="builtinfunc" id="5229799">cap</span><span class="op" id="5229802">)</span>&nbsp;<span class="op" id="5229804">&gt;</span>&nbsp;<span class="num" id="5229806">0</span>&nbsp;<span class="op" id="5229808">&amp;&amp;</span>&nbsp;<span class="ident" id="5229811">m</span><span class="op" id="5229812">.</span><span class="ident" id="5229813">matchcap</span><span class="op" id="5229821">[</span><span class="num" id="5229822">0</span><span class="op" id="5229823">]</span>&nbsp;<span class="op" id="5229825">&lt;</span>&nbsp;<span class="ident" id="5229827">t</span><span class="op" id="5229828">.</span><span class="builtinfunc" id="5229829">cap</span><span class="op" id="5229832">[</span><span class="num" id="5229833">0</span><span class="op" id="5229834">]</span>&nbsp;<span class="op" id="5229836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229841">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229857">m</span><span class="op" id="5229858">.</span><span class="ident" id="5229859">pool</span>&nbsp;<span class="op" id="5229864">=</span>&nbsp;<span class="builtinfunc" id="5229866">append</span><span class="op" id="5229872">(</span><span class="ident" id="5229873">m</span><span class="op" id="5229874">.</span><span class="ident" id="5229875">pool</span><span class="op" id="5229879">,</span>&nbsp;<span class="ident" id="5229881">t</span><span class="op" id="5229882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229887">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229898">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229902">i</span>&nbsp;<span class="op" id="5229904">:=</span>&nbsp;<span class="ident" id="5229907">t</span><span class="op" id="5229908">.</span><span class="ident" id="5229909">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229916">add</span>&nbsp;<span class="op" id="5229920">:=</span>&nbsp;<span class="builtintype" id="5229923">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229931">switch</span>&nbsp;<span class="ident" id="5229938">i</span><span class="op" id="5229939">.</span><span class="ident" id="5229940">Op</span>&nbsp;<span class="op" id="5229943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229947">default</span><span class="op" id="5229954">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5229959">panic</span><span class="op" id="5229964">(</span><span class="string" id="5229965">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5229975">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229980">case</span>&nbsp;<span class="ident" id="5229985">syntax</span><span class="op" id="5229991">.</span><span class="ident" id="5229992">InstMatch</span><span class="op" id="5230001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230006">if</span>&nbsp;<span class="builtinfunc" id="5230009">len</span><span class="op" id="5230012">(</span><span class="ident" id="5230013">t</span><span class="op" id="5230014">.</span><span class="builtinfunc" id="5230015">cap</span><span class="op" id="5230018">)</span>&nbsp;<span class="op" id="5230020">&gt;</span>&nbsp;<span class="num" id="5230022">0</span>&nbsp;<span class="op" id="5230024">&amp;&amp;</span>&nbsp;<span class="op" id="5230027">(</span><span class="op" id="5230028">!</span><span class="ident" id="5230029">longest</span>&nbsp;<span class="op" id="5230037">||</span>&nbsp;<span class="op" id="5230040">!</span><span class="ident" id="5230041">m</span><span class="op" id="5230042">.</span><span class="ident" id="5230043">matched</span>&nbsp;<span class="op" id="5230051">||</span>&nbsp;<span class="ident" id="5230054">m</span><span class="op" id="5230055">.</span><span class="ident" id="5230056">matchcap</span><span class="op" id="5230064">[</span><span class="num" id="5230065">1</span><span class="op" id="5230066">]</span>&nbsp;<span class="op" id="5230068">&lt;</span>&nbsp;<span class="ident" id="5230070">pos</span><span class="op" id="5230073">)</span>&nbsp;<span class="op" id="5230075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230081">t</span><span class="op" id="5230082">.</span><span class="builtinfunc" id="5230083">cap</span><span class="op" id="5230086">[</span><span class="num" id="5230087">1</span><span class="op" id="5230088">]</span>&nbsp;<span class="op" id="5230090">=</span>&nbsp;<span class="ident" id="5230092">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5230100">copy</span><span class="op" id="5230104">(</span><span class="ident" id="5230105">m</span><span class="op" id="5230106">.</span><span class="ident" id="5230107">matchcap</span><span class="op" id="5230115">,</span>&nbsp;<span class="ident" id="5230117">t</span><span class="op" id="5230118">.</span><span class="builtinfunc" id="5230119">cap</span><span class="op" id="5230122">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230132">if</span>&nbsp;<span class="op" id="5230135">!</span><span class="ident" id="5230136">longest</span>&nbsp;<span class="op" id="5230144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230150">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230211">for</span>&nbsp;<span class="ident" id="5230215">_</span><span class="op" id="5230216">,</span>&nbsp;<span class="ident" id="5230218">d</span>&nbsp;<span class="op" id="5230220">:=</span>&nbsp;<span class="keyword" id="5230223">range</span>&nbsp;<span class="ident" id="5230229">runq</span><span class="op" id="5230233">.</span><span class="ident" id="5230234">dense</span><span class="op" id="5230239">[</span><span class="ident" id="5230240">j</span><span class="op" id="5230241">+</span><span class="num" id="5230242">1</span><span class="op" id="5230243">:</span><span class="op" id="5230244">]</span>&nbsp;<span class="op" id="5230246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230253">if</span>&nbsp;<span class="ident" id="5230256">d</span><span class="op" id="5230257">.</span><span class="ident" id="5230258">t</span>&nbsp;<span class="op" id="5230260">!=</span>&nbsp;<span class="ident" id="5230263">nil</span>&nbsp;<span class="op" id="5230267">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230275">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230296">m</span><span class="op" id="5230297">.</span><span class="ident" id="5230298">pool</span>&nbsp;<span class="op" id="5230303">=</span>&nbsp;<span class="builtinfunc" id="5230305">append</span><span class="op" id="5230311">(</span><span class="ident" id="5230312">m</span><span class="op" id="5230313">.</span><span class="ident" id="5230314">pool</span><span class="op" id="5230318">,</span>&nbsp;<span class="ident" id="5230320">d</span><span class="op" id="5230321">.</span><span class="ident" id="5230322">t</span><span class="op" id="5230323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230342">runq</span><span class="op" id="5230346">.</span><span class="ident" id="5230347">dense</span>&nbsp;<span class="op" id="5230353">=</span>&nbsp;<span class="ident" id="5230355">runq</span><span class="op" id="5230359">.</span><span class="ident" id="5230360">dense</span><span class="op" id="5230365">[</span><span class="op" id="5230366">:</span><span class="num" id="5230367">0</span><span class="op" id="5230368">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230378">m</span><span class="op" id="5230379">.</span><span class="ident" id="5230380">matched</span>&nbsp;<span class="op" id="5230388">=</span>&nbsp;<span class="builtintype" id="5230390">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230398">case</span>&nbsp;<span class="ident" id="5230403">syntax</span><span class="op" id="5230409">.</span><span class="ident" id="5230410">InstRune</span><span class="op" id="5230418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230423">add</span>&nbsp;<span class="op" id="5230427">=</span>&nbsp;<span class="ident" id="5230429">i</span><span class="op" id="5230430">.</span><span class="ident" id="5230431">MatchRune</span><span class="op" id="5230440">(</span><span class="ident" id="5230441">c</span><span class="op" id="5230442">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230446">case</span>&nbsp;<span class="ident" id="5230451">syntax</span><span class="op" id="5230457">.</span><span class="ident" id="5230458">InstRune1</span><span class="op" id="5230467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230472">add</span>&nbsp;<span class="op" id="5230476">=</span>&nbsp;<span class="ident" id="5230478">c</span>&nbsp;<span class="op" id="5230480">==</span>&nbsp;<span class="ident" id="5230483">i</span><span class="op" id="5230484">.</span><span class="ident" id="5230485">Rune</span><span class="op" id="5230489">[</span><span class="num" id="5230490">0</span><span class="op" id="5230491">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230495">case</span>&nbsp;<span class="ident" id="5230500">syntax</span><span class="op" id="5230506">.</span><span class="ident" id="5230507">InstRuneAny</span><span class="op" id="5230518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230523">add</span>&nbsp;<span class="op" id="5230527">=</span>&nbsp;<span class="builtintype" id="5230529">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230536">case</span>&nbsp;<span class="ident" id="5230541">syntax</span><span class="op" id="5230547">.</span><span class="ident" id="5230548">InstRuneAnyNotNL</span><span class="op" id="5230564">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230569">add</span>&nbsp;<span class="op" id="5230573">=</span>&nbsp;<span class="ident" id="5230575">c</span>&nbsp;<span class="op" id="5230577">!=</span>&nbsp;<span class="string" id="5230580">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230591">if</span>&nbsp;<span class="ident" id="5230594">add</span>&nbsp;<span class="op" id="5230598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230603">t</span>&nbsp;<span class="op" id="5230605">=</span>&nbsp;<span class="ident" id="5230607">m</span><span class="op" id="5230608">.</span><span class="ident" id="5230609">add</span><span class="op" id="5230612">(</span><span class="ident" id="5230613">nextq</span><span class="op" id="5230618">,</span>&nbsp;<span class="ident" id="5230620">i</span><span class="op" id="5230621">.</span><span class="ident" id="5230622">Out</span><span class="op" id="5230625">,</span>&nbsp;<span class="ident" id="5230627">nextPos</span><span class="op" id="5230634">,</span>&nbsp;<span class="ident" id="5230636">t</span><span class="op" id="5230637">.</span><span class="builtinfunc" id="5230638">cap</span><span class="op" id="5230641">,</span>&nbsp;<span class="ident" id="5230643">nextCond</span><span class="op" id="5230651">,</span>&nbsp;<span class="ident" id="5230653">t</span><span class="op" id="5230654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230658">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230662">if</span>&nbsp;<span class="ident" id="5230665">t</span>&nbsp;<span class="op" id="5230667">!=</span>&nbsp;<span class="ident" id="5230670">nil</span>&nbsp;<span class="op" id="5230674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230679">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230695">m</span><span class="op" id="5230696">.</span><span class="ident" id="5230697">pool</span>&nbsp;<span class="op" id="5230702">=</span>&nbsp;<span class="builtinfunc" id="5230704">append</span><span class="op" id="5230710">(</span><span class="ident" id="5230711">m</span><span class="op" id="5230712">.</span><span class="ident" id="5230713">pool</span><span class="op" id="5230717">,</span>&nbsp;<span class="ident" id="5230719">t</span><span class="op" id="5230720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230727">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230730">runq</span><span class="op" id="5230734">.</span><span class="ident" id="5230735">dense</span>&nbsp;<span class="op" id="5230741">=</span>&nbsp;<span class="ident" id="5230743">runq</span><span class="op" id="5230747">.</span><span class="ident" id="5230748">dense</span><span class="op" id="5230753">[</span><span class="op" id="5230754">:</span><span class="num" id="5230755">0</span><span class="op" id="5230756">]</span><br>
<span class="lineno"></span><span class="op" id="5230758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230761">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5230835">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5230924">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5231001">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5231018">func</span>&nbsp;<span class="op" id="5231023">(</span><span class="ident" id="5231024">m</span>&nbsp;<span class="op" id="5231026">*</span><span class="ident" id="5231027">machine</span><span class="op" id="5231034">)</span>&nbsp;<span class="ident" id="5231036">add</span><span class="op" id="5231039">(</span><span class="ident" id="5231040">q</span>&nbsp;<span class="op" id="5231042">*</span><span class="ident" id="5231043">queue</span><span class="op" id="5231048">,</span>&nbsp;<span class="ident" id="5231050">pc</span>&nbsp;<span class="builtintype" id="5231053">uint32</span><span class="op" id="5231059">,</span>&nbsp;<span class="ident" id="5231061">pos</span>&nbsp;<span class="builtintype" id="5231065">int</span><span class="op" id="5231068">,</span>&nbsp;<span class="builtinfunc" id="5231070">cap</span>&nbsp;<span class="op" id="5231074">[</span><span class="op" id="5231075">]</span><span class="builtintype" id="5231076">int</span><span class="op" id="5231079">,</span>&nbsp;<span class="ident" id="5231081">cond</span>&nbsp;<span class="ident" id="5231086">syntax</span><span class="op" id="5231092">.</span><span class="ident" id="5231093">EmptyOp</span><span class="op" id="5231100">,</span>&nbsp;<span class="ident" id="5231102">t</span>&nbsp;<span class="op" id="5231104">*</span><span class="ident" id="5231105">thread</span><span class="op" id="5231111">)</span>&nbsp;<span class="op" id="5231113">*</span><span class="ident" id="5231114">thread</span>&nbsp;<span class="op" id="5231121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231124">if</span>&nbsp;<span class="ident" id="5231127">pc</span>&nbsp;<span class="op" id="5231130">==</span>&nbsp;<span class="num" id="5231133">0</span>&nbsp;<span class="op" id="5231135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231139">return</span>&nbsp;<span class="ident" id="5231146">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231152">if</span>&nbsp;<span class="ident" id="5231155">j</span>&nbsp;<span class="op" id="5231157">:=</span>&nbsp;<span class="ident" id="5231160">q</span><span class="op" id="5231161">.</span><span class="ident" id="5231162">sparse</span><span class="op" id="5231168">[</span><span class="ident" id="5231169">pc</span><span class="op" id="5231171">]</span><span class="op" id="5231172">;</span>&nbsp;<span class="ident" id="5231174">j</span>&nbsp;<span class="op" id="5231176">&lt;</span>&nbsp;<span class="builtintype" id="5231178">uint32</span><span class="op" id="5231184">(</span><span class="builtinfunc" id="5231185">len</span><span class="op" id="5231188">(</span><span class="ident" id="5231189">q</span><span class="op" id="5231190">.</span><span class="ident" id="5231191">dense</span><span class="op" id="5231196">)</span><span class="op" id="5231197">)</span>&nbsp;<span class="op" id="5231199">&amp;&amp;</span>&nbsp;<span class="ident" id="5231202">q</span><span class="op" id="5231203">.</span><span class="ident" id="5231204">dense</span><span class="op" id="5231209">[</span><span class="ident" id="5231210">j</span><span class="op" id="5231211">]</span><span class="op" id="5231212">.</span><span class="ident" id="5231213">pc</span>&nbsp;<span class="op" id="5231216">==</span>&nbsp;<span class="ident" id="5231219">pc</span>&nbsp;<span class="op" id="5231222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231226">return</span>&nbsp;<span class="ident" id="5231233">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231240">j</span>&nbsp;<span class="op" id="5231242">:=</span>&nbsp;<span class="builtinfunc" id="5231245">len</span><span class="op" id="5231248">(</span><span class="ident" id="5231249">q</span><span class="op" id="5231250">.</span><span class="ident" id="5231251">dense</span><span class="op" id="5231256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231259">q</span><span class="op" id="5231260">.</span><span class="ident" id="5231261">dense</span>&nbsp;<span class="op" id="5231267">=</span>&nbsp;<span class="ident" id="5231269">q</span><span class="op" id="5231270">.</span><span class="ident" id="5231271">dense</span><span class="op" id="5231276">[</span><span class="op" id="5231277">:</span><span class="ident" id="5231278">j</span><span class="op" id="5231279">+</span><span class="num" id="5231280">1</span><span class="op" id="5231281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231284">d</span>&nbsp;<span class="op" id="5231286">:=</span>&nbsp;<span class="op" id="5231289">&amp;</span><span class="ident" id="5231290">q</span><span class="op" id="5231291">.</span><span class="ident" id="5231292">dense</span><span class="op" id="5231297">[</span><span class="ident" id="5231298">j</span><span class="op" id="5231299">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231302">d</span><span class="op" id="5231303">.</span><span class="ident" id="5231304">t</span>&nbsp;<span class="op" id="5231306">=</span>&nbsp;<span class="ident" id="5231308">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231313">d</span><span class="op" id="5231314">.</span><span class="ident" id="5231315">pc</span>&nbsp;<span class="op" id="5231318">=</span>&nbsp;<span class="ident" id="5231320">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231324">q</span><span class="op" id="5231325">.</span><span class="ident" id="5231326">sparse</span><span class="op" id="5231332">[</span><span class="ident" id="5231333">pc</span><span class="op" id="5231335">]</span>&nbsp;<span class="op" id="5231337">=</span>&nbsp;<span class="builtintype" id="5231339">uint32</span><span class="op" id="5231345">(</span><span class="ident" id="5231346">j</span><span class="op" id="5231347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231351">i</span>&nbsp;<span class="op" id="5231353">:=</span>&nbsp;<span class="op" id="5231356">&amp;</span><span class="ident" id="5231357">m</span><span class="op" id="5231358">.</span><span class="ident" id="5231359">p</span><span class="op" id="5231360">.</span><span class="ident" id="5231361">Inst</span><span class="op" id="5231365">[</span><span class="ident" id="5231366">pc</span><span class="op" id="5231368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231371">switch</span>&nbsp;<span class="ident" id="5231378">i</span><span class="op" id="5231379">.</span><span class="ident" id="5231380">Op</span>&nbsp;<span class="op" id="5231383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231386">default</span><span class="op" id="5231393">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5231397">panic</span><span class="op" id="5231402">(</span><span class="string" id="5231403">&#34;unhandled&#34;</span><span class="op" id="5231414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231417">case</span>&nbsp;<span class="ident" id="5231422">syntax</span><span class="op" id="5231428">.</span><span class="ident" id="5231429">InstFail</span><span class="op" id="5231437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231441">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231453">case</span>&nbsp;<span class="ident" id="5231458">syntax</span><span class="op" id="5231464">.</span><span class="ident" id="5231465">InstAlt</span><span class="op" id="5231472">,</span>&nbsp;<span class="ident" id="5231474">syntax</span><span class="op" id="5231480">.</span><span class="ident" id="5231481">InstAltMatch</span><span class="op" id="5231493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231497">t</span>&nbsp;<span class="op" id="5231499">=</span>&nbsp;<span class="ident" id="5231501">m</span><span class="op" id="5231502">.</span><span class="ident" id="5231503">add</span><span class="op" id="5231506">(</span><span class="ident" id="5231507">q</span><span class="op" id="5231508">,</span>&nbsp;<span class="ident" id="5231510">i</span><span class="op" id="5231511">.</span><span class="ident" id="5231512">Out</span><span class="op" id="5231515">,</span>&nbsp;<span class="ident" id="5231517">pos</span><span class="op" id="5231520">,</span>&nbsp;<span class="builtinfunc" id="5231522">cap</span><span class="op" id="5231525">,</span>&nbsp;<span class="ident" id="5231527">cond</span><span class="op" id="5231531">,</span>&nbsp;<span class="ident" id="5231533">t</span><span class="op" id="5231534">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231538">t</span>&nbsp;<span class="op" id="5231540">=</span>&nbsp;<span class="ident" id="5231542">m</span><span class="op" id="5231543">.</span><span class="ident" id="5231544">add</span><span class="op" id="5231547">(</span><span class="ident" id="5231548">q</span><span class="op" id="5231549">,</span>&nbsp;<span class="ident" id="5231551">i</span><span class="op" id="5231552">.</span><span class="ident" id="5231553">Arg</span><span class="op" id="5231556">,</span>&nbsp;<span class="ident" id="5231558">pos</span><span class="op" id="5231561">,</span>&nbsp;<span class="builtinfunc" id="5231563">cap</span><span class="op" id="5231566">,</span>&nbsp;<span class="ident" id="5231568">cond</span><span class="op" id="5231572">,</span>&nbsp;<span class="ident" id="5231574">t</span><span class="op" id="5231575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231578">case</span>&nbsp;<span class="ident" id="5231583">syntax</span><span class="op" id="5231589">.</span><span class="ident" id="5231590">InstEmptyWidth</span><span class="op" id="5231604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231608">if</span>&nbsp;<span class="ident" id="5231611">syntax</span><span class="op" id="5231617">.</span><span class="ident" id="5231618">EmptyOp</span><span class="op" id="5231625">(</span><span class="ident" id="5231626">i</span><span class="op" id="5231627">.</span><span class="ident" id="5231628">Arg</span><span class="op" id="5231631">)</span><span class="op" id="5231632">&amp;^</span><span class="ident" id="5231634">cond</span>&nbsp;<span class="op" id="5231639">==</span>&nbsp;<span class="num" id="5231642">0</span>&nbsp;<span class="op" id="5231644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231649">t</span>&nbsp;<span class="op" id="5231651">=</span>&nbsp;<span class="ident" id="5231653">m</span><span class="op" id="5231654">.</span><span class="ident" id="5231655">add</span><span class="op" id="5231658">(</span><span class="ident" id="5231659">q</span><span class="op" id="5231660">,</span>&nbsp;<span class="ident" id="5231662">i</span><span class="op" id="5231663">.</span><span class="ident" id="5231664">Out</span><span class="op" id="5231667">,</span>&nbsp;<span class="ident" id="5231669">pos</span><span class="op" id="5231672">,</span>&nbsp;<span class="builtinfunc" id="5231674">cap</span><span class="op" id="5231677">,</span>&nbsp;<span class="ident" id="5231679">cond</span><span class="op" id="5231683">,</span>&nbsp;<span class="ident" id="5231685">t</span><span class="op" id="5231686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231690">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231693">case</span>&nbsp;<span class="ident" id="5231698">syntax</span><span class="op" id="5231704">.</span><span class="ident" id="5231705">InstNop</span><span class="op" id="5231712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231716">t</span>&nbsp;<span class="op" id="5231718">=</span>&nbsp;<span class="ident" id="5231720">m</span><span class="op" id="5231721">.</span><span class="ident" id="5231722">add</span><span class="op" id="5231725">(</span><span class="ident" id="5231726">q</span><span class="op" id="5231727">,</span>&nbsp;<span class="ident" id="5231729">i</span><span class="op" id="5231730">.</span><span class="ident" id="5231731">Out</span><span class="op" id="5231734">,</span>&nbsp;<span class="ident" id="5231736">pos</span><span class="op" id="5231739">,</span>&nbsp;<span class="builtinfunc" id="5231741">cap</span><span class="op" id="5231744">,</span>&nbsp;<span class="ident" id="5231746">cond</span><span class="op" id="5231750">,</span>&nbsp;<span class="ident" id="5231752">t</span><span class="op" id="5231753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231756">case</span>&nbsp;<span class="ident" id="5231761">syntax</span><span class="op" id="5231767">.</span><span class="ident" id="5231768">InstCapture</span><span class="op" id="5231779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231783">if</span>&nbsp;<span class="builtintype" id="5231786">int</span><span class="op" id="5231789">(</span><span class="ident" id="5231790">i</span><span class="op" id="5231791">.</span><span class="ident" id="5231792">Arg</span><span class="op" id="5231795">)</span>&nbsp;<span class="op" id="5231797">&lt;</span>&nbsp;<span class="builtinfunc" id="5231799">len</span><span class="op" id="5231802">(</span><span class="builtinfunc" id="5231803">cap</span><span class="op" id="5231806">)</span>&nbsp;<span class="op" id="5231808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231813">opos</span>&nbsp;<span class="op" id="5231818">:=</span>&nbsp;<span class="builtinfunc" id="5231821">cap</span><span class="op" id="5231824">[</span><span class="ident" id="5231825">i</span><span class="op" id="5231826">.</span><span class="ident" id="5231827">Arg</span><span class="op" id="5231830">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5231835">cap</span><span class="op" id="5231838">[</span><span class="ident" id="5231839">i</span><span class="op" id="5231840">.</span><span class="ident" id="5231841">Arg</span><span class="op" id="5231844">]</span>&nbsp;<span class="op" id="5231846">=</span>&nbsp;<span class="ident" id="5231848">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231855">m</span><span class="op" id="5231856">.</span><span class="ident" id="5231857">add</span><span class="op" id="5231860">(</span><span class="ident" id="5231861">q</span><span class="op" id="5231862">,</span>&nbsp;<span class="ident" id="5231864">i</span><span class="op" id="5231865">.</span><span class="ident" id="5231866">Out</span><span class="op" id="5231869">,</span>&nbsp;<span class="ident" id="5231871">pos</span><span class="op" id="5231874">,</span>&nbsp;<span class="builtinfunc" id="5231876">cap</span><span class="op" id="5231879">,</span>&nbsp;<span class="ident" id="5231881">cond</span><span class="op" id="5231885">,</span>&nbsp;<span class="ident" id="5231887">nil</span><span class="op" id="5231890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5231895">cap</span><span class="op" id="5231898">[</span><span class="ident" id="5231899">i</span><span class="op" id="5231900">.</span><span class="ident" id="5231901">Arg</span><span class="op" id="5231904">]</span>&nbsp;<span class="op" id="5231906">=</span>&nbsp;<span class="ident" id="5231908">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231915">}</span>&nbsp;<span class="keyword" id="5231917">else</span>&nbsp;<span class="op" id="5231922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231927">t</span>&nbsp;<span class="op" id="5231929">=</span>&nbsp;<span class="ident" id="5231931">m</span><span class="op" id="5231932">.</span><span class="ident" id="5231933">add</span><span class="op" id="5231936">(</span><span class="ident" id="5231937">q</span><span class="op" id="5231938">,</span>&nbsp;<span class="ident" id="5231940">i</span><span class="op" id="5231941">.</span><span class="ident" id="5231942">Out</span><span class="op" id="5231945">,</span>&nbsp;<span class="ident" id="5231947">pos</span><span class="op" id="5231950">,</span>&nbsp;<span class="builtinfunc" id="5231952">cap</span><span class="op" id="5231955">,</span>&nbsp;<span class="ident" id="5231957">cond</span><span class="op" id="5231961">,</span>&nbsp;<span class="ident" id="5231963">t</span><span class="op" id="5231964">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231971">case</span>&nbsp;<span class="ident" id="5231976">syntax</span><span class="op" id="5231982">.</span><span class="ident" id="5231983">InstMatch</span><span class="op" id="5231992">,</span>&nbsp;<span class="ident" id="5231994">syntax</span><span class="op" id="5232000">.</span><span class="ident" id="5232001">InstRune</span><span class="op" id="5232009">,</span>&nbsp;<span class="ident" id="5232011">syntax</span><span class="op" id="5232017">.</span><span class="ident" id="5232018">InstRune1</span><span class="op" id="5232027">,</span>&nbsp;<span class="ident" id="5232029">syntax</span><span class="op" id="5232035">.</span><span class="ident" id="5232036">InstRuneAny</span><span class="op" id="5232047">,</span>&nbsp;<span class="ident" id="5232049">syntax</span><span class="op" id="5232055">.</span><span class="ident" id="5232056">InstRuneAnyNotNL</span><span class="op" id="5232072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232076">if</span>&nbsp;<span class="ident" id="5232079">t</span>&nbsp;<span class="op" id="5232081">==</span>&nbsp;<span class="ident" id="5232084">nil</span>&nbsp;<span class="op" id="5232088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232093">t</span>&nbsp;<span class="op" id="5232095">=</span>&nbsp;<span class="ident" id="5232097">m</span><span class="op" id="5232098">.</span><span class="ident" id="5232099">alloc</span><span class="op" id="5232104">(</span><span class="ident" id="5232105">i</span><span class="op" id="5232106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232110">}</span>&nbsp;<span class="keyword" id="5232112">else</span>&nbsp;<span class="op" id="5232117">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232122">t</span><span class="op" id="5232123">.</span><span class="ident" id="5232124">inst</span>&nbsp;<span class="op" id="5232129">=</span>&nbsp;<span class="ident" id="5232131">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232139">if</span>&nbsp;<span class="builtinfunc" id="5232142">len</span><span class="op" id="5232145">(</span><span class="builtinfunc" id="5232146">cap</span><span class="op" id="5232149">)</span>&nbsp;<span class="op" id="5232151">&gt;</span>&nbsp;<span class="num" id="5232153">0</span>&nbsp;<span class="op" id="5232155">&amp;&amp;</span>&nbsp;<span class="op" id="5232158">&amp;</span><span class="ident" id="5232159">t</span><span class="op" id="5232160">.</span><span class="builtinfunc" id="5232161">cap</span><span class="op" id="5232164">[</span><span class="num" id="5232165">0</span><span class="op" id="5232166">]</span>&nbsp;<span class="op" id="5232168">!=</span>&nbsp;<span class="op" id="5232171">&amp;</span><span class="builtinfunc" id="5232172">cap</span><span class="op" id="5232175">[</span><span class="num" id="5232176">0</span><span class="op" id="5232177">]</span>&nbsp;<span class="op" id="5232179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5232184">copy</span><span class="op" id="5232188">(</span><span class="ident" id="5232189">t</span><span class="op" id="5232190">.</span><span class="builtinfunc" id="5232191">cap</span><span class="op" id="5232194">,</span>&nbsp;<span class="builtinfunc" id="5232196">cap</span><span class="op" id="5232199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232203">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232207">d</span><span class="op" id="5232208">.</span><span class="ident" id="5232209">t</span>&nbsp;<span class="op" id="5232211">=</span>&nbsp;<span class="ident" id="5232213">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232217">t</span>&nbsp;<span class="op" id="5232219">=</span>&nbsp;<span class="ident" id="5232221">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232229">return</span>&nbsp;<span class="ident" id="5232236">t</span><br>
<span class="lineno"></span><span class="op" id="5232238">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5232241">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5232301">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5232342">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5232395">func</span>&nbsp;<span class="op" id="5232400">(</span><span class="ident" id="5232401">m</span>&nbsp;<span class="op" id="5232403">*</span><span class="ident" id="5232404">machine</span><span class="op" id="5232411">)</span>&nbsp;<span class="ident" id="5232413">onepass</span><span class="op" id="5232420">(</span><span class="ident" id="5232421">i</span>&nbsp;<span class="ident" id="5232423">input</span><span class="op" id="5232428">,</span>&nbsp;<span class="ident" id="5232430">pos</span>&nbsp;<span class="builtintype" id="5232434">int</span><span class="op" id="5232437">)</span>&nbsp;<span class="builtintype" id="5232439">bool</span>&nbsp;<span class="op" id="5232444">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232447">startCond</span>&nbsp;<span class="op" id="5232457">:=</span>&nbsp;<span class="ident" id="5232460">m</span><span class="op" id="5232461">.</span><span class="ident" id="5232462">re</span><span class="op" id="5232464">.</span><span class="ident" id="5232465">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232471">if</span>&nbsp;<span class="ident" id="5232474">startCond</span>&nbsp;<span class="op" id="5232484">==</span>&nbsp;<span class="op" id="5232487">^</span><span class="ident" id="5232488">syntax</span><span class="op" id="5232494">.</span><span class="ident" id="5232495">EmptyOp</span><span class="op" id="5232502">(</span><span class="num" id="5232503">0</span><span class="op" id="5232504">)</span>&nbsp;<span class="op" id="5232506">{</span>&nbsp;<span class="comment" id="5232508">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232524">return</span>&nbsp;<span class="builtintype" id="5232531">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232541">m</span><span class="op" id="5232542">.</span><span class="ident" id="5232543">matched</span>&nbsp;<span class="op" id="5232551">=</span>&nbsp;<span class="builtintype" id="5232553">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232560">for</span>&nbsp;<span class="ident" id="5232564">i</span>&nbsp;<span class="op" id="5232566">:=</span>&nbsp;<span class="keyword" id="5232569">range</span>&nbsp;<span class="ident" id="5232575">m</span><span class="op" id="5232576">.</span><span class="ident" id="5232577">matchcap</span>&nbsp;<span class="op" id="5232586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232590">m</span><span class="op" id="5232591">.</span><span class="ident" id="5232592">matchcap</span><span class="op" id="5232600">[</span><span class="ident" id="5232601">i</span><span class="op" id="5232602">]</span>&nbsp;<span class="op" id="5232604">=</span>&nbsp;<span class="op" id="5232606">-</span><span class="num" id="5232607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232613">r</span><span class="op" id="5232614">,</span>&nbsp;<span class="ident" id="5232616">r1</span>&nbsp;<span class="op" id="5232619">:=</span>&nbsp;<span class="ident" id="5232622">endOfText</span><span class="op" id="5232631">,</span>&nbsp;<span class="ident" id="5232633">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232644">width</span><span class="op" id="5232649">,</span>&nbsp;<span class="ident" id="5232651">width1</span>&nbsp;<span class="op" id="5232658">:=</span>&nbsp;<span class="num" id="5232661">0</span><span class="op" id="5232662">,</span>&nbsp;<span class="num" id="5232664">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232667">r</span><span class="op" id="5232668">,</span>&nbsp;<span class="ident" id="5232670">width</span>&nbsp;<span class="op" id="5232676">=</span>&nbsp;<span class="ident" id="5232678">i</span><span class="op" id="5232679">.</span><span class="ident" id="5232680">step</span><span class="op" id="5232684">(</span><span class="ident" id="5232685">pos</span><span class="op" id="5232688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232691">if</span>&nbsp;<span class="ident" id="5232694">r</span>&nbsp;<span class="op" id="5232696">!=</span>&nbsp;<span class="ident" id="5232699">endOfText</span>&nbsp;<span class="op" id="5232709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232713">r1</span><span class="op" id="5232715">,</span>&nbsp;<span class="ident" id="5232717">width1</span>&nbsp;<span class="op" id="5232724">=</span>&nbsp;<span class="ident" id="5232726">i</span><span class="op" id="5232727">.</span><span class="ident" id="5232728">step</span><span class="op" id="5232732">(</span><span class="ident" id="5232733">pos</span>&nbsp;<span class="op" id="5232737">+</span>&nbsp;<span class="ident" id="5232739">width</span><span class="op" id="5232744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232750">var</span>&nbsp;<span class="ident" id="5232754">flag</span>&nbsp;<span class="ident" id="5232759">syntax</span><span class="op" id="5232765">.</span><span class="ident" id="5232766">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232775">if</span>&nbsp;<span class="ident" id="5232778">pos</span>&nbsp;<span class="op" id="5232782">==</span>&nbsp;<span class="num" id="5232785">0</span>&nbsp;<span class="op" id="5232787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232791">flag</span>&nbsp;<span class="op" id="5232796">=</span>&nbsp;<span class="ident" id="5232798">syntax</span><span class="op" id="5232804">.</span><span class="ident" id="5232805">EmptyOpContext</span><span class="op" id="5232819">(</span><span class="op" id="5232820">-</span><span class="num" id="5232821">1</span><span class="op" id="5232822">,</span>&nbsp;<span class="ident" id="5232824">r</span><span class="op" id="5232825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232828">}</span>&nbsp;<span class="keyword" id="5232830">else</span>&nbsp;<span class="op" id="5232835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232839">flag</span>&nbsp;<span class="op" id="5232844">=</span>&nbsp;<span class="ident" id="5232846">i</span><span class="op" id="5232847">.</span><span class="ident" id="5232848">context</span><span class="op" id="5232855">(</span><span class="ident" id="5232856">pos</span><span class="op" id="5232859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232862">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232865">pc</span>&nbsp;<span class="op" id="5232868">:=</span>&nbsp;<span class="ident" id="5232871">m</span><span class="op" id="5232872">.</span><span class="ident" id="5232873">op</span><span class="op" id="5232875">.</span><span class="ident" id="5232876">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232883">inst</span>&nbsp;<span class="op" id="5232888">:=</span>&nbsp;<span class="ident" id="5232891">m</span><span class="op" id="5232892">.</span><span class="ident" id="5232893">op</span><span class="op" id="5232895">.</span><span class="ident" id="5232896">Inst</span><span class="op" id="5232900">[</span><span class="ident" id="5232901">pc</span><span class="op" id="5232903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232906">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232961">if</span>&nbsp;<span class="ident" id="5232964">pos</span>&nbsp;<span class="op" id="5232968">==</span>&nbsp;<span class="num" id="5232971">0</span>&nbsp;<span class="op" id="5232973">&amp;&amp;</span>&nbsp;<span class="ident" id="5232976">syntax</span><span class="op" id="5232982">.</span><span class="ident" id="5232983">EmptyOp</span><span class="op" id="5232990">(</span><span class="ident" id="5232991">inst</span><span class="op" id="5232995">.</span><span class="ident" id="5232996">Arg</span><span class="op" id="5232999">)</span><span class="op" id="5233000">&amp;^</span><span class="ident" id="5233002">flag</span>&nbsp;<span class="op" id="5233007">==</span>&nbsp;<span class="num" id="5233010">0</span>&nbsp;<span class="op" id="5233012">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5233017">len</span><span class="op" id="5233020">(</span><span class="ident" id="5233021">m</span><span class="op" id="5233022">.</span><span class="ident" id="5233023">re</span><span class="op" id="5233025">.</span><span class="ident" id="5233026">prefix</span><span class="op" id="5233032">)</span>&nbsp;<span class="op" id="5233034">&gt;</span>&nbsp;<span class="num" id="5233036">0</span>&nbsp;<span class="op" id="5233038">&amp;&amp;</span>&nbsp;<span class="ident" id="5233041">i</span><span class="op" id="5233042">.</span><span class="ident" id="5233043">canCheckPrefix</span><span class="op" id="5233057">(</span><span class="op" id="5233058">)</span>&nbsp;<span class="op" id="5233060">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233064">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233120">if</span>&nbsp;<span class="ident" id="5233123">i</span><span class="op" id="5233124">.</span><span class="ident" id="5233125">hasPrefix</span><span class="op" id="5233134">(</span><span class="ident" id="5233135">m</span><span class="op" id="5233136">.</span><span class="ident" id="5233137">re</span><span class="op" id="5233139">)</span>&nbsp;<span class="op" id="5233141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233146">pos</span>&nbsp;<span class="op" id="5233150">+=</span>&nbsp;<span class="builtinfunc" id="5233153">len</span><span class="op" id="5233156">(</span><span class="ident" id="5233157">m</span><span class="op" id="5233158">.</span><span class="ident" id="5233159">re</span><span class="op" id="5233161">.</span><span class="ident" id="5233162">prefix</span><span class="op" id="5233168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233173">r</span><span class="op" id="5233174">,</span>&nbsp;<span class="ident" id="5233176">width</span>&nbsp;<span class="op" id="5233182">=</span>&nbsp;<span class="ident" id="5233184">i</span><span class="op" id="5233185">.</span><span class="ident" id="5233186">step</span><span class="op" id="5233190">(</span><span class="ident" id="5233191">pos</span><span class="op" id="5233194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233199">r1</span><span class="op" id="5233201">,</span>&nbsp;<span class="ident" id="5233203">width1</span>&nbsp;<span class="op" id="5233210">=</span>&nbsp;<span class="ident" id="5233212">i</span><span class="op" id="5233213">.</span><span class="ident" id="5233214">step</span><span class="op" id="5233218">(</span><span class="ident" id="5233219">pos</span>&nbsp;<span class="op" id="5233223">+</span>&nbsp;<span class="ident" id="5233225">width</span><span class="op" id="5233230">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233235">flag</span>&nbsp;<span class="op" id="5233240">=</span>&nbsp;<span class="ident" id="5233242">i</span><span class="op" id="5233243">.</span><span class="ident" id="5233244">context</span><span class="op" id="5233251">(</span><span class="ident" id="5233252">pos</span><span class="op" id="5233255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233260">pc</span>&nbsp;<span class="op" id="5233263">=</span>&nbsp;<span class="builtintype" id="5233265">int</span><span class="op" id="5233268">(</span><span class="ident" id="5233269">m</span><span class="op" id="5233270">.</span><span class="ident" id="5233271">re</span><span class="op" id="5233273">.</span><span class="ident" id="5233274">prefixEnd</span><span class="op" id="5233283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233287">}</span>&nbsp;<span class="keyword" id="5233289">else</span>&nbsp;<span class="op" id="5233294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233299">return</span>&nbsp;<span class="ident" id="5233306">m</span><span class="op" id="5233307">.</span><span class="ident" id="5233308">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233318">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233324">for</span>&nbsp;<span class="op" id="5233328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233332">inst</span>&nbsp;<span class="op" id="5233337">=</span>&nbsp;<span class="ident" id="5233339">m</span><span class="op" id="5233340">.</span><span class="ident" id="5233341">op</span><span class="op" id="5233343">.</span><span class="ident" id="5233344">Inst</span><span class="op" id="5233348">[</span><span class="ident" id="5233349">pc</span><span class="op" id="5233351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233355">pc</span>&nbsp;<span class="op" id="5233358">=</span>&nbsp;<span class="builtintype" id="5233360">int</span><span class="op" id="5233363">(</span><span class="ident" id="5233364">inst</span><span class="op" id="5233368">.</span><span class="ident" id="5233369">Out</span><span class="op" id="5233372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233376">switch</span>&nbsp;<span class="ident" id="5233383">inst</span><span class="op" id="5233387">.</span><span class="ident" id="5233388">Op</span>&nbsp;<span class="op" id="5233391">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233395">default</span><span class="op" id="5233402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5233407">panic</span><span class="op" id="5233412">(</span><span class="string" id="5233413">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5233423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233427">case</span>&nbsp;<span class="ident" id="5233432">syntax</span><span class="op" id="5233438">.</span><span class="ident" id="5233439">InstMatch</span><span class="op" id="5233448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233453">m</span><span class="op" id="5233454">.</span><span class="ident" id="5233455">matched</span>&nbsp;<span class="op" id="5233463">=</span>&nbsp;<span class="builtintype" id="5233465">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233473">if</span>&nbsp;<span class="builtinfunc" id="5233476">len</span><span class="op" id="5233479">(</span><span class="ident" id="5233480">m</span><span class="op" id="5233481">.</span><span class="ident" id="5233482">matchcap</span><span class="op" id="5233490">)</span>&nbsp;<span class="op" id="5233492">&gt;</span>&nbsp;<span class="num" id="5233494">0</span>&nbsp;<span class="op" id="5233496">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233502">m</span><span class="op" id="5233503">.</span><span class="ident" id="5233504">matchcap</span><span class="op" id="5233512">[</span><span class="num" id="5233513">0</span><span class="op" id="5233514">]</span>&nbsp;<span class="op" id="5233516">=</span>&nbsp;<span class="num" id="5233518">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233524">m</span><span class="op" id="5233525">.</span><span class="ident" id="5233526">matchcap</span><span class="op" id="5233534">[</span><span class="num" id="5233535">1</span><span class="op" id="5233536">]</span>&nbsp;<span class="op" id="5233538">=</span>&nbsp;<span class="ident" id="5233540">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233552">return</span>&nbsp;<span class="ident" id="5233559">m</span><span class="op" id="5233560">.</span><span class="ident" id="5233561">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233571">case</span>&nbsp;<span class="ident" id="5233576">syntax</span><span class="op" id="5233582">.</span><span class="ident" id="5233583">InstRune</span><span class="op" id="5233591">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233596">if</span>&nbsp;<span class="op" id="5233599">!</span><span class="ident" id="5233600">inst</span><span class="op" id="5233604">.</span><span class="ident" id="5233605">MatchRune</span><span class="op" id="5233614">(</span><span class="ident" id="5233615">r</span><span class="op" id="5233616">)</span>&nbsp;<span class="op" id="5233618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233624">return</span>&nbsp;<span class="ident" id="5233631">m</span><span class="op" id="5233632">.</span><span class="ident" id="5233633">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233648">case</span>&nbsp;<span class="ident" id="5233653">syntax</span><span class="op" id="5233659">.</span><span class="ident" id="5233660">InstRune1</span><span class="op" id="5233669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233674">if</span>&nbsp;<span class="ident" id="5233677">r</span>&nbsp;<span class="op" id="5233679">!=</span>&nbsp;<span class="ident" id="5233682">inst</span><span class="op" id="5233686">.</span><span class="ident" id="5233687">Rune</span><span class="op" id="5233691">[</span><span class="num" id="5233692">0</span><span class="op" id="5233693">]</span>&nbsp;<span class="op" id="5233695">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233701">return</span>&nbsp;<span class="ident" id="5233708">m</span><span class="op" id="5233709">.</span><span class="ident" id="5233710">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233725">case</span>&nbsp;<span class="ident" id="5233730">syntax</span><span class="op" id="5233736">.</span><span class="ident" id="5233737">InstRuneAny</span><span class="op" id="5233748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233753">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233766">case</span>&nbsp;<span class="ident" id="5233771">syntax</span><span class="op" id="5233777">.</span><span class="ident" id="5233778">InstRuneAnyNotNL</span><span class="op" id="5233794">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233799">if</span>&nbsp;<span class="ident" id="5233802">r</span>&nbsp;<span class="op" id="5233804">==</span>&nbsp;<span class="string" id="5233807">&#39;\n&#39;</span>&nbsp;<span class="op" id="5233812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233818">return</span>&nbsp;<span class="ident" id="5233825">m</span><span class="op" id="5233826">.</span><span class="ident" id="5233827">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233842">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233909">case</span>&nbsp;<span class="ident" id="5233914">syntax</span><span class="op" id="5233920">.</span><span class="ident" id="5233921">InstAlt</span><span class="op" id="5233928">,</span>&nbsp;<span class="ident" id="5233930">syntax</span><span class="op" id="5233936">.</span><span class="ident" id="5233937">InstAltMatch</span><span class="op" id="5233949">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233954">pc</span>&nbsp;<span class="op" id="5233957">=</span>&nbsp;<span class="builtintype" id="5233959">int</span><span class="op" id="5233962">(</span><span class="ident" id="5233963">onePassNext</span><span class="op" id="5233974">(</span><span class="op" id="5233975">&amp;</span><span class="ident" id="5233976">inst</span><span class="op" id="5233980">,</span>&nbsp;<span class="ident" id="5233982">r</span><span class="op" id="5233983">)</span><span class="op" id="5233984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233989">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234000">case</span>&nbsp;<span class="ident" id="5234005">syntax</span><span class="op" id="5234011">.</span><span class="ident" id="5234012">InstFail</span><span class="op" id="5234020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234025">return</span>&nbsp;<span class="ident" id="5234032">m</span><span class="op" id="5234033">.</span><span class="ident" id="5234034">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234044">case</span>&nbsp;<span class="ident" id="5234049">syntax</span><span class="op" id="5234055">.</span><span class="ident" id="5234056">InstNop</span><span class="op" id="5234063">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234068">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234079">case</span>&nbsp;<span class="ident" id="5234084">syntax</span><span class="op" id="5234090">.</span><span class="ident" id="5234091">InstEmptyWidth</span><span class="op" id="5234105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234110">if</span>&nbsp;<span class="ident" id="5234113">syntax</span><span class="op" id="5234119">.</span><span class="ident" id="5234120">EmptyOp</span><span class="op" id="5234127">(</span><span class="ident" id="5234128">inst</span><span class="op" id="5234132">.</span><span class="ident" id="5234133">Arg</span><span class="op" id="5234136">)</span><span class="op" id="5234137">&amp;^</span><span class="ident" id="5234139">flag</span>&nbsp;<span class="op" id="5234144">!=</span>&nbsp;<span class="num" id="5234147">0</span>&nbsp;<span class="op" id="5234149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234155">return</span>&nbsp;<span class="ident" id="5234162">m</span><span class="op" id="5234163">.</span><span class="ident" id="5234164">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234175">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234180">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234191">case</span>&nbsp;<span class="ident" id="5234196">syntax</span><span class="op" id="5234202">.</span><span class="ident" id="5234203">InstCapture</span><span class="op" id="5234214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234219">if</span>&nbsp;<span class="builtintype" id="5234222">int</span><span class="op" id="5234225">(</span><span class="ident" id="5234226">inst</span><span class="op" id="5234230">.</span><span class="ident" id="5234231">Arg</span><span class="op" id="5234234">)</span>&nbsp;<span class="op" id="5234236">&lt;</span>&nbsp;<span class="builtinfunc" id="5234238">len</span><span class="op" id="5234241">(</span><span class="ident" id="5234242">m</span><span class="op" id="5234243">.</span><span class="ident" id="5234244">matchcap</span><span class="op" id="5234252">)</span>&nbsp;<span class="op" id="5234254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234260">m</span><span class="op" id="5234261">.</span><span class="ident" id="5234262">matchcap</span><span class="op" id="5234270">[</span><span class="ident" id="5234271">inst</span><span class="op" id="5234275">.</span><span class="ident" id="5234276">Arg</span><span class="op" id="5234279">]</span>&nbsp;<span class="op" id="5234281">=</span>&nbsp;<span class="ident" id="5234283">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234290">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234295">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234310">if</span>&nbsp;<span class="ident" id="5234313">width</span>&nbsp;<span class="op" id="5234319">==</span>&nbsp;<span class="num" id="5234322">0</span>&nbsp;<span class="op" id="5234324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234329">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234337">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234341">flag</span>&nbsp;<span class="op" id="5234346">=</span>&nbsp;<span class="ident" id="5234348">syntax</span><span class="op" id="5234354">.</span><span class="ident" id="5234355">EmptyOpContext</span><span class="op" id="5234369">(</span><span class="ident" id="5234370">r</span><span class="op" id="5234371">,</span>&nbsp;<span class="ident" id="5234373">r1</span><span class="op" id="5234375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234379">pos</span>&nbsp;<span class="op" id="5234383">+=</span>&nbsp;<span class="ident" id="5234386">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234394">r</span><span class="op" id="5234395">,</span>&nbsp;<span class="ident" id="5234397">width</span>&nbsp;<span class="op" id="5234403">=</span>&nbsp;<span class="ident" id="5234405">r1</span><span class="op" id="5234407">,</span>&nbsp;<span class="ident" id="5234409">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234418">if</span>&nbsp;<span class="ident" id="5234421">r</span>&nbsp;<span class="op" id="5234423">!=</span>&nbsp;<span class="ident" id="5234426">endOfText</span>&nbsp;<span class="op" id="5234436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234441">r1</span><span class="op" id="5234443">,</span>&nbsp;<span class="ident" id="5234445">width1</span>&nbsp;<span class="op" id="5234452">=</span>&nbsp;<span class="ident" id="5234454">i</span><span class="op" id="5234455">.</span><span class="ident" id="5234456">step</span><span class="op" id="5234460">(</span><span class="ident" id="5234461">pos</span>&nbsp;<span class="op" id="5234465">+</span>&nbsp;<span class="ident" id="5234467">width</span><span class="op" id="5234472">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234482">return</span>&nbsp;<span class="ident" id="5234489">m</span><span class="op" id="5234490">.</span><span class="ident" id="5234491">matched</span><br>
<span class="lineno"></span><span class="op" id="5234499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5234502">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5234541">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5234581">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5234639">var</span>&nbsp;<span class="ident" id="5234643">empty</span>&nbsp;<span class="op" id="5234649">=</span>&nbsp;<span class="builtinfunc" id="5234651">make</span><span class="op" id="5234655">(</span><span class="op" id="5234656">[</span><span class="op" id="5234657">]</span><span class="builtintype" id="5234658">int</span><span class="op" id="5234661">,</span>&nbsp;<span class="num" id="5234663">0</span><span class="op" id="5234664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5234667">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5234730">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5234769">func</span>&nbsp;<span class="op" id="5234774">(</span><span class="ident" id="5234775">re</span>&nbsp;<span class="op" id="5234778">*</span><span class="ident" id="5234779">Regexp</span><span class="op" id="5234785">)</span>&nbsp;<span class="ident" id="5234787">doExecute</span><span class="op" id="5234796">(</span><span class="ident" id="5234797">r</span>&nbsp;<span class="ident" id="5234799">io</span><span class="op" id="5234801">.</span><span class="ident" id="5234802">RuneReader</span><span class="op" id="5234812">,</span>&nbsp;<span class="ident" id="5234814">b</span>&nbsp;<span class="op" id="5234816">[</span><span class="op" id="5234817">]</span><span class="builtintype" id="5234818">byte</span><span class="op" id="5234822">,</span>&nbsp;<span class="ident" id="5234824">s</span>&nbsp;<span class="builtintype" id="5234826">string</span><span class="op" id="5234832">,</span>&nbsp;<span class="ident" id="5234834">pos</span>&nbsp;<span class="builtintype" id="5234838">int</span><span class="op" id="5234841">,</span>&nbsp;<span class="ident" id="5234843">ncap</span>&nbsp;<span class="builtintype" id="5234848">int</span><span class="op" id="5234851">)</span>&nbsp;<span class="op" id="5234853">[</span><span class="op" id="5234854">]</span><span class="builtintype" id="5234855">int</span>&nbsp;<span class="op" id="5234859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234862">m</span>&nbsp;<span class="op" id="5234864">:=</span>&nbsp;<span class="ident" id="5234867">re</span><span class="op" id="5234869">.</span><span class="ident" id="5234870">get</span><span class="op" id="5234873">(</span><span class="op" id="5234874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234877">var</span>&nbsp;<span class="ident" id="5234881">i</span>&nbsp;<span class="ident" id="5234883">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234890">if</span>&nbsp;<span class="ident" id="5234893">r</span>&nbsp;<span class="op" id="5234895">!=</span>&nbsp;<span class="ident" id="5234898">nil</span>&nbsp;<span class="op" id="5234902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234906">i</span>&nbsp;<span class="op" id="5234908">=</span>&nbsp;<span class="ident" id="5234910">m</span><span class="op" id="5234911">.</span><span class="ident" id="5234912">newInputReader</span><span class="op" id="5234926">(</span><span class="ident" id="5234927">r</span><span class="op" id="5234928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234931">}</span>&nbsp;<span class="keyword" id="5234933">else</span>&nbsp;<span class="keyword" id="5234938">if</span>&nbsp;<span class="ident" id="5234941">b</span>&nbsp;<span class="op" id="5234943">!=</span>&nbsp;<span class="ident" id="5234946">nil</span>&nbsp;<span class="op" id="5234950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234954">i</span>&nbsp;<span class="op" id="5234956">=</span>&nbsp;<span class="ident" id="5234958">m</span><span class="op" id="5234959">.</span><span class="ident" id="5234960">newInputBytes</span><span class="op" id="5234973">(</span><span class="ident" id="5234974">b</span><span class="op" id="5234975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234978">}</span>&nbsp;<span class="keyword" id="5234980">else</span>&nbsp;<span class="op" id="5234985">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234989">i</span>&nbsp;<span class="op" id="5234991">=</span>&nbsp;<span class="ident" id="5234993">m</span><span class="op" id="5234994">.</span><span class="ident" id="5234995">newInputString</span><span class="op" id="5235009">(</span><span class="ident" id="5235010">s</span><span class="op" id="5235011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235017">if</span>&nbsp;<span class="ident" id="5235020">m</span><span class="op" id="5235021">.</span><span class="ident" id="5235022">op</span>&nbsp;<span class="op" id="5235025">!=</span>&nbsp;<span class="ident" id="5235028">notOnePass</span>&nbsp;<span class="op" id="5235039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235043">if</span>&nbsp;<span class="op" id="5235046">!</span><span class="ident" id="5235047">m</span><span class="op" id="5235048">.</span><span class="ident" id="5235049">onepass</span><span class="op" id="5235056">(</span><span class="ident" id="5235057">i</span><span class="op" id="5235058">,</span>&nbsp;<span class="ident" id="5235060">pos</span><span class="op" id="5235063">)</span>&nbsp;<span class="op" id="5235065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235070">re</span><span class="op" id="5235072">.</span><span class="ident" id="5235073">put</span><span class="op" id="5235076">(</span><span class="ident" id="5235077">m</span><span class="op" id="5235078">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235083">return</span>&nbsp;<span class="ident" id="5235090">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235099">}</span>&nbsp;<span class="keyword" id="5235101">else</span>&nbsp;<span class="op" id="5235106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235110">m</span><span class="op" id="5235111">.</span><span class="ident" id="5235112">init</span><span class="op" id="5235116">(</span><span class="ident" id="5235117">ncap</span><span class="op" id="5235121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235125">if</span>&nbsp;<span class="op" id="5235128">!</span><span class="ident" id="5235129">m</span><span class="op" id="5235130">.</span><span class="ident" id="5235131">match</span><span class="op" id="5235136">(</span><span class="ident" id="5235137">i</span><span class="op" id="5235138">,</span>&nbsp;<span class="ident" id="5235140">pos</span><span class="op" id="5235143">)</span>&nbsp;<span class="op" id="5235145">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235150">re</span><span class="op" id="5235152">.</span><span class="ident" id="5235153">put</span><span class="op" id="5235156">(</span><span class="ident" id="5235157">m</span><span class="op" id="5235158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235163">return</span>&nbsp;<span class="ident" id="5235170">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235182">if</span>&nbsp;<span class="ident" id="5235185">ncap</span>&nbsp;<span class="op" id="5235190">==</span>&nbsp;<span class="num" id="5235193">0</span>&nbsp;<span class="op" id="5235195">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235199">re</span><span class="op" id="5235201">.</span><span class="ident" id="5235202">put</span><span class="op" id="5235205">(</span><span class="ident" id="5235206">m</span><span class="op" id="5235207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235211">return</span>&nbsp;<span class="ident" id="5235218">empty</span>&nbsp;<span class="comment" id="5235224">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5235249">cap</span>&nbsp;<span class="op" id="5235253">:=</span>&nbsp;<span class="builtinfunc" id="5235256">make</span><span class="op" id="5235260">(</span><span class="op" id="5235261">[</span><span class="op" id="5235262">]</span><span class="builtintype" id="5235263">int</span><span class="op" id="5235266">,</span>&nbsp;<span class="builtinfunc" id="5235268">len</span><span class="op" id="5235271">(</span><span class="ident" id="5235272">m</span><span class="op" id="5235273">.</span><span class="ident" id="5235274">matchcap</span><span class="op" id="5235282">)</span><span class="op" id="5235283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5235286">copy</span><span class="op" id="5235290">(</span><span class="builtinfunc" id="5235291">cap</span><span class="op" id="5235294">,</span>&nbsp;<span class="ident" id="5235296">m</span><span class="op" id="5235297">.</span><span class="ident" id="5235298">matchcap</span><span class="op" id="5235306">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235309">re</span><span class="op" id="5235311">.</span><span class="ident" id="5235312">put</span><span class="op" id="5235315">(</span><span class="ident" id="5235316">m</span><span class="op" id="5235317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235320">return</span>&nbsp;<span class="builtinfunc" id="5235327">cap</span><br>
<span class="lineno"></span><span class="op" id="5235331">}</span>
</div>
</body>
</html>
