<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3399056">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3399112">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3399166">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3399217">package</span>&nbsp;<span class="ident" id="3399225">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3399230">import</span>&nbsp;<span class="string" id="3399237">&#34;time&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399245">//&nbsp;protocols&nbsp;contains&nbsp;minimal&nbsp;mappings&nbsp;between&nbsp;internet&nbsp;protocol</span><br>
<span class="lineno">10</span><span class="comment" id="3399310">//&nbsp;names&nbsp;and&nbsp;numbers&nbsp;for&nbsp;platforms&nbsp;that&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;complete&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3399380">//&nbsp;protocol&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="3399401">//</span><br>
<span class="lineno"></span><span class="comment" id="3399404">//&nbsp;See&nbsp;http://www.iana.org/assignments/protocol-numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3399460">var</span>&nbsp;<span class="ident" id="3399464">protocols</span>&nbsp;<span class="op" id="3399474">=</span>&nbsp;<span class="keyword" id="3399476">map</span><span class="op" id="3399479">[</span><span class="builtintype" id="3399480">string</span><span class="op" id="3399486">]</span><span class="builtintype" id="3399487">int</span><span class="op" id="3399490">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399493">&#34;icmp&#34;</span><span class="op" id="3399499">:</span>&nbsp;<span class="num" id="3399501">1</span><span class="op" id="3399502">,</span>&nbsp;<span class="string" id="3399504">&#34;ICMP&#34;</span><span class="op" id="3399510">:</span>&nbsp;<span class="num" id="3399512">1</span><span class="op" id="3399513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399516">&#34;igmp&#34;</span><span class="op" id="3399522">:</span>&nbsp;<span class="num" id="3399524">2</span><span class="op" id="3399525">,</span>&nbsp;<span class="string" id="3399527">&#34;IGMP&#34;</span><span class="op" id="3399533">:</span>&nbsp;<span class="num" id="3399535">2</span><span class="op" id="3399536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399539">&#34;tcp&#34;</span><span class="op" id="3399544">:</span>&nbsp;<span class="num" id="3399546">6</span><span class="op" id="3399547">,</span>&nbsp;<span class="string" id="3399549">&#34;TCP&#34;</span><span class="op" id="3399554">:</span>&nbsp;<span class="num" id="3399556">6</span><span class="op" id="3399557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399560">&#34;udp&#34;</span><span class="op" id="3399565">:</span>&nbsp;<span class="num" id="3399567">17</span><span class="op" id="3399569">,</span>&nbsp;<span class="string" id="3399571">&#34;UDP&#34;</span><span class="op" id="3399576">:</span>&nbsp;<span class="num" id="3399578">17</span><span class="op" id="3399580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399583">&#34;ipv6-icmp&#34;</span><span class="op" id="3399594">:</span>&nbsp;<span class="num" id="3399596">58</span><span class="op" id="3399598">,</span>&nbsp;<span class="string" id="3399600">&#34;IPV6-ICMP&#34;</span><span class="op" id="3399611">:</span>&nbsp;<span class="num" id="3399613">58</span><span class="op" id="3399615">,</span>&nbsp;<span class="string" id="3399617">&#34;IPv6-ICMP&#34;</span><span class="op" id="3399628">:</span>&nbsp;<span class="num" id="3399630">58</span><span class="op" id="3399632">,</span><br>
<span class="lineno">20</span><span class="op" id="3399634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399637">//&nbsp;LookupHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;given&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="3399701">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3399750">func</span>&nbsp;<span class="ident" id="3399755">LookupHost</span><span class="op" id="3399765">(</span><span class="ident" id="3399766">host</span>&nbsp;<span class="builtintype" id="3399771">string</span><span class="op" id="3399777">)</span>&nbsp;<span class="op" id="3399779">(</span><span class="ident" id="3399780">addrs</span>&nbsp;<span class="op" id="3399786">[</span><span class="op" id="3399787">]</span><span class="builtintype" id="3399788">string</span><span class="op" id="3399794">,</span>&nbsp;<span class="ident" id="3399796">err</span>&nbsp;<span class="builtintype" id="3399800">error</span><span class="op" id="3399805">)</span>&nbsp;<span class="op" id="3399807">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399810">return</span>&nbsp;<span class="ident" id="3399817">lookupHost</span><span class="op" id="3399827">(</span><span class="ident" id="3399828">host</span><span class="op" id="3399832">)</span><br>
<span class="lineno"></span><span class="op" id="3399834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399837">//&nbsp;LookupIP&nbsp;looks&nbsp;up&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="3399889">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno">30</span><span class="keyword" id="3399952">func</span>&nbsp;<span class="ident" id="3399957">LookupIP</span><span class="op" id="3399965">(</span><span class="ident" id="3399966">host</span>&nbsp;<span class="builtintype" id="3399971">string</span><span class="op" id="3399977">)</span>&nbsp;<span class="op" id="3399979">(</span><span class="ident" id="3399980">addrs</span>&nbsp;<span class="op" id="3399986">[</span><span class="op" id="3399987">]</span><span class="ident" id="3399988">IP</span><span class="op" id="3399990">,</span>&nbsp;<span class="ident" id="3399992">err</span>&nbsp;<span class="builtintype" id="3399996">error</span><span class="op" id="3400001">)</span>&nbsp;<span class="op" id="3400003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400006">return</span>&nbsp;<span class="ident" id="3400013">lookupIPMerge</span><span class="op" id="3400026">(</span><span class="ident" id="3400027">host</span><span class="op" id="3400031">)</span><br>
<span class="lineno"></span><span class="op" id="3400033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3400036">var</span>&nbsp;<span class="ident" id="3400040">lookupGroup</span>&nbsp;<span class="ident" id="3400052">singleflight</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3400066">//&nbsp;lookupIPMerge&nbsp;wraps&nbsp;lookupIP,&nbsp;but&nbsp;makes&nbsp;sure&nbsp;that&nbsp;for&nbsp;any&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3400133">//&nbsp;host,&nbsp;only&nbsp;one&nbsp;lookup&nbsp;is&nbsp;in-flight&nbsp;at&nbsp;a&nbsp;time.&nbsp;The&nbsp;returned&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="3400202">//&nbsp;is&nbsp;always&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="keyword" id="3400236">func</span>&nbsp;<span class="ident" id="3400241">lookupIPMerge</span><span class="op" id="3400254">(</span><span class="ident" id="3400255">host</span>&nbsp;<span class="builtintype" id="3400260">string</span><span class="op" id="3400266">)</span>&nbsp;<span class="op" id="3400268">(</span><span class="ident" id="3400269">addrs</span>&nbsp;<span class="op" id="3400275">[</span><span class="op" id="3400276">]</span><span class="ident" id="3400277">IP</span><span class="op" id="3400279">,</span>&nbsp;<span class="ident" id="3400281">err</span>&nbsp;<span class="builtintype" id="3400285">error</span><span class="op" id="3400290">)</span>&nbsp;<span class="op" id="3400292">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400295">addrsi</span><span class="op" id="3400301">,</span>&nbsp;<span class="ident" id="3400303">err</span><span class="op" id="3400306">,</span>&nbsp;<span class="ident" id="3400308">shared</span>&nbsp;<span class="op" id="3400315">:=</span>&nbsp;<span class="ident" id="3400318">lookupGroup</span><span class="op" id="3400329">.</span><span class="ident" id="3400330">Do</span><span class="op" id="3400332">(</span><span class="ident" id="3400333">host</span><span class="op" id="3400337">,</span>&nbsp;<span class="keyword" id="3400339">func</span><span class="op" id="3400343">(</span><span class="op" id="3400344">)</span>&nbsp;<span class="op" id="3400346">(</span><span class="keyword" id="3400347">interface</span><span class="op" id="3400356">{</span><span class="op" id="3400357">}</span><span class="op" id="3400358">,</span>&nbsp;<span class="builtintype" id="3400360">error</span><span class="op" id="3400365">)</span>&nbsp;<span class="op" id="3400367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400371">return</span>&nbsp;<span class="ident" id="3400378">lookupIP</span><span class="op" id="3400386">(</span><span class="ident" id="3400387">host</span><span class="op" id="3400391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400394">}</span><span class="op" id="3400395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400398">return</span>&nbsp;<span class="ident" id="3400405">lookupIPReturn</span><span class="op" id="3400419">(</span><span class="ident" id="3400420">addrsi</span><span class="op" id="3400426">,</span>&nbsp;<span class="ident" id="3400428">err</span><span class="op" id="3400431">,</span>&nbsp;<span class="ident" id="3400433">shared</span><span class="op" id="3400439">)</span><br>
<span class="lineno"></span><span class="op" id="3400441">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3400444">//&nbsp;lookupIPReturn&nbsp;turns&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;singleflight.Do&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3400512">//&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="keyword" id="3400548">func</span>&nbsp;<span class="ident" id="3400553">lookupIPReturn</span><span class="op" id="3400567">(</span><span class="ident" id="3400568">addrsi</span>&nbsp;<span class="keyword" id="3400575">interface</span><span class="op" id="3400584">{</span><span class="op" id="3400585">}</span><span class="op" id="3400586">,</span>&nbsp;<span class="ident" id="3400588">err</span>&nbsp;<span class="builtintype" id="3400592">error</span><span class="op" id="3400597">,</span>&nbsp;<span class="ident" id="3400599">shared</span>&nbsp;<span class="builtintype" id="3400606">bool</span><span class="op" id="3400610">)</span>&nbsp;<span class="op" id="3400612">(</span><span class="op" id="3400613">[</span><span class="op" id="3400614">]</span><span class="ident" id="3400615">IP</span><span class="op" id="3400617">,</span>&nbsp;<span class="builtintype" id="3400619">error</span><span class="op" id="3400624">)</span>&nbsp;<span class="op" id="3400626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400629">if</span>&nbsp;<span class="ident" id="3400632">err</span>&nbsp;<span class="op" id="3400636">!=</span>&nbsp;<span class="ident" id="3400639">nil</span>&nbsp;<span class="op" id="3400643">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400647">return</span>&nbsp;<span class="ident" id="3400654">nil</span><span class="op" id="3400657">,</span>&nbsp;<span class="ident" id="3400659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400667">addrs</span>&nbsp;<span class="op" id="3400673">:=</span>&nbsp;<span class="ident" id="3400676">addrsi</span><span class="op" id="3400682">.</span><span class="op" id="3400683">(</span><span class="op" id="3400684">[</span><span class="op" id="3400685">]</span><span class="ident" id="3400686">IP</span><span class="op" id="3400688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400691">if</span>&nbsp;<span class="ident" id="3400694">shared</span>&nbsp;<span class="op" id="3400701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400705">clone</span>&nbsp;<span class="op" id="3400711">:=</span>&nbsp;<span class="builtinfunc" id="3400714">make</span><span class="op" id="3400718">(</span><span class="op" id="3400719">[</span><span class="op" id="3400720">]</span><span class="ident" id="3400721">IP</span><span class="op" id="3400723">,</span>&nbsp;<span class="builtinfunc" id="3400725">len</span><span class="op" id="3400728">(</span><span class="ident" id="3400729">addrs</span><span class="op" id="3400734">)</span><span class="op" id="3400735">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3400739">copy</span><span class="op" id="3400743">(</span><span class="ident" id="3400744">clone</span><span class="op" id="3400749">,</span>&nbsp;<span class="ident" id="3400751">addrs</span><span class="op" id="3400756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400760">addrs</span>&nbsp;<span class="op" id="3400766">=</span>&nbsp;<span class="ident" id="3400768">clone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400778">return</span>&nbsp;<span class="ident" id="3400785">addrs</span><span class="op" id="3400790">,</span>&nbsp;<span class="ident" id="3400792">nil</span><br>
<span class="lineno"></span><span class="op" id="3400796">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3400799">//&nbsp;lookupIPDeadline&nbsp;looks&nbsp;up&nbsp;a&nbsp;hostname&nbsp;with&nbsp;a&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3400856">func</span>&nbsp;<span class="ident" id="3400861">lookupIPDeadline</span><span class="op" id="3400877">(</span><span class="ident" id="3400878">host</span>&nbsp;<span class="builtintype" id="3400883">string</span><span class="op" id="3400889">,</span>&nbsp;<span class="ident" id="3400891">deadline</span>&nbsp;<span class="ident" id="3400900">time</span><span class="op" id="3400904">.</span><span class="ident" id="3400905">Time</span><span class="op" id="3400909">)</span>&nbsp;<span class="op" id="3400911">(</span><span class="ident" id="3400912">addrs</span>&nbsp;<span class="op" id="3400918">[</span><span class="op" id="3400919">]</span><span class="ident" id="3400920">IP</span><span class="op" id="3400922">,</span>&nbsp;<span class="ident" id="3400924">err</span>&nbsp;<span class="builtintype" id="3400928">error</span><span class="op" id="3400933">)</span>&nbsp;<span class="op" id="3400935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400938">if</span>&nbsp;<span class="ident" id="3400941">deadline</span><span class="op" id="3400949">.</span><span class="ident" id="3400950">IsZero</span><span class="op" id="3400956">(</span><span class="op" id="3400957">)</span>&nbsp;<span class="op" id="3400959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400963">return</span>&nbsp;<span class="ident" id="3400970">lookupIPMerge</span><span class="op" id="3400983">(</span><span class="ident" id="3400984">host</span><span class="op" id="3400988">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400995">//&nbsp;We&nbsp;could&nbsp;push&nbsp;the&nbsp;deadline&nbsp;down&nbsp;into&nbsp;the&nbsp;name&nbsp;resolution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401056">//&nbsp;functions.&nbsp;&nbsp;However,&nbsp;the&nbsp;most&nbsp;commonly&nbsp;used&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401119">//&nbsp;calls&nbsp;getaddrinfo,&nbsp;which&nbsp;has&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401165">timeout</span>&nbsp;<span class="op" id="3401173">:=</span>&nbsp;<span class="ident" id="3401176">deadline</span><span class="op" id="3401184">.</span><span class="ident" id="3401185">Sub</span><span class="op" id="3401188">(</span><span class="ident" id="3401189">time</span><span class="op" id="3401193">.</span><span class="ident" id="3401194">Now</span><span class="op" id="3401197">(</span><span class="op" id="3401198">)</span><span class="op" id="3401199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401202">if</span>&nbsp;<span class="ident" id="3401205">timeout</span>&nbsp;<span class="op" id="3401213">&lt;=</span>&nbsp;<span class="num" id="3401216">0</span>&nbsp;<span class="op" id="3401218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401222">return</span>&nbsp;<span class="ident" id="3401229">nil</span><span class="op" id="3401232">,</span>&nbsp;<span class="ident" id="3401234">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401246">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401249">t</span>&nbsp;<span class="op" id="3401251">:=</span>&nbsp;<span class="ident" id="3401254">time</span><span class="op" id="3401258">.</span><span class="ident" id="3401259">NewTimer</span><span class="op" id="3401267">(</span><span class="ident" id="3401268">timeout</span><span class="op" id="3401275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401278">defer</span>&nbsp;<span class="ident" id="3401284">t</span><span class="op" id="3401285">.</span><span class="ident" id="3401286">Stop</span><span class="op" id="3401290">(</span><span class="op" id="3401291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401295">ch</span>&nbsp;<span class="op" id="3401298">:=</span>&nbsp;<span class="ident" id="3401301">lookupGroup</span><span class="op" id="3401312">.</span><span class="ident" id="3401313">DoChan</span><span class="op" id="3401319">(</span><span class="ident" id="3401320">host</span><span class="op" id="3401324">,</span>&nbsp;<span class="keyword" id="3401326">func</span><span class="op" id="3401330">(</span><span class="op" id="3401331">)</span>&nbsp;<span class="op" id="3401333">(</span><span class="keyword" id="3401334">interface</span><span class="op" id="3401343">{</span><span class="op" id="3401344">}</span><span class="op" id="3401345">,</span>&nbsp;<span class="builtintype" id="3401347">error</span><span class="op" id="3401352">)</span>&nbsp;<span class="op" id="3401354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401358">return</span>&nbsp;<span class="ident" id="3401365">lookupIP</span><span class="op" id="3401373">(</span><span class="ident" id="3401374">host</span><span class="op" id="3401378">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401381">}</span><span class="op" id="3401382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401386">select</span>&nbsp;<span class="op" id="3401393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401396">case</span>&nbsp;<span class="op" id="3401401">&lt;-</span><span class="ident" id="3401403">t</span><span class="op" id="3401404">.</span><span class="ident" id="3401405">C</span><span class="op" id="3401406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401410">//&nbsp;The&nbsp;DNS&nbsp;lookup&nbsp;timed&nbsp;out&nbsp;for&nbsp;some&nbsp;reason.&nbsp;&nbsp;Force</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401464">//&nbsp;future&nbsp;requests&nbsp;to&nbsp;start&nbsp;the&nbsp;DNS&nbsp;lookup&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401515">//&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for&nbsp;the&nbsp;current&nbsp;lookup&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401566">//&nbsp;complete.&nbsp;&nbsp;See&nbsp;issue&nbsp;8602.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401598">lookupGroup</span><span class="op" id="3401609">.</span><span class="ident" id="3401610">Forget</span><span class="op" id="3401616">(</span><span class="ident" id="3401617">host</span><span class="op" id="3401621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401626">return</span>&nbsp;<span class="ident" id="3401633">nil</span><span class="op" id="3401636">,</span>&nbsp;<span class="ident" id="3401638">errTimeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401651">case</span>&nbsp;<span class="ident" id="3401656">r</span>&nbsp;<span class="op" id="3401658">:=</span>&nbsp;<span class="op" id="3401661">&lt;-</span><span class="ident" id="3401663">ch</span><span class="op" id="3401665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401669">return</span>&nbsp;<span class="ident" id="3401676">lookupIPReturn</span><span class="op" id="3401690">(</span><span class="ident" id="3401691">r</span><span class="op" id="3401692">.</span><span class="ident" id="3401693">v</span><span class="op" id="3401694">,</span>&nbsp;<span class="ident" id="3401696">r</span><span class="op" id="3401697">.</span><span class="ident" id="3401698">err</span><span class="op" id="3401701">,</span>&nbsp;<span class="ident" id="3401703">r</span><span class="op" id="3401704">.</span><span class="ident" id="3401705">shared</span><span class="op" id="3401711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401714">}</span><br>
<span class="lineno">95</span><span class="op" id="3401716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3401719">//&nbsp;LookupPort&nbsp;looks&nbsp;up&nbsp;the&nbsp;port&nbsp;for&nbsp;the&nbsp;given&nbsp;network&nbsp;and&nbsp;service.</span><br>
<span class="lineno"></span><span class="keyword" id="3401786">func</span>&nbsp;<span class="ident" id="3401791">LookupPort</span><span class="op" id="3401801">(</span><span class="ident" id="3401802">network</span><span class="op" id="3401809">,</span>&nbsp;<span class="ident" id="3401811">service</span>&nbsp;<span class="builtintype" id="3401819">string</span><span class="op" id="3401825">)</span>&nbsp;<span class="op" id="3401827">(</span><span class="ident" id="3401828">port</span>&nbsp;<span class="builtintype" id="3401833">int</span><span class="op" id="3401836">,</span>&nbsp;<span class="ident" id="3401838">err</span>&nbsp;<span class="builtintype" id="3401842">error</span><span class="op" id="3401847">)</span>&nbsp;<span class="op" id="3401849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401852">return</span>&nbsp;<span class="ident" id="3401859">lookupPort</span><span class="op" id="3401869">(</span><span class="ident" id="3401870">network</span><span class="op" id="3401877">,</span>&nbsp;<span class="ident" id="3401879">service</span><span class="op" id="3401886">)</span><br>
<span class="lineno">100</span><span class="op" id="3401888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3401891">//&nbsp;LookupCNAME&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;DNS&nbsp;host&nbsp;for&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3401957">//&nbsp;Callers&nbsp;that&nbsp;do&nbsp;not&nbsp;care&nbsp;about&nbsp;the&nbsp;canonical&nbsp;name&nbsp;can&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3402019">//&nbsp;LookupHost&nbsp;or&nbsp;LookupIP&nbsp;directly;&nbsp;both&nbsp;take&nbsp;care&nbsp;of&nbsp;resolving</span><br>
<span class="lineno">105</span><span class="comment" id="3402083">//&nbsp;the&nbsp;canonical&nbsp;name&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;lookup.</span><br>
<span class="lineno"></span><span class="keyword" id="3402128">func</span>&nbsp;<span class="ident" id="3402133">LookupCNAME</span><span class="op" id="3402144">(</span><span class="ident" id="3402145">name</span>&nbsp;<span class="builtintype" id="3402150">string</span><span class="op" id="3402156">)</span>&nbsp;<span class="op" id="3402158">(</span><span class="ident" id="3402159">cname</span>&nbsp;<span class="builtintype" id="3402165">string</span><span class="op" id="3402171">,</span>&nbsp;<span class="ident" id="3402173">err</span>&nbsp;<span class="builtintype" id="3402177">error</span><span class="op" id="3402182">)</span>&nbsp;<span class="op" id="3402184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402187">return</span>&nbsp;<span class="ident" id="3402194">lookupCNAME</span><span class="op" id="3402205">(</span><span class="ident" id="3402206">name</span><span class="op" id="3402210">)</span><br>
<span class="lineno"></span><span class="op" id="3402212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3402215">//&nbsp;LookupSRV&nbsp;tries&nbsp;to&nbsp;resolve&nbsp;an&nbsp;SRV&nbsp;query&nbsp;of&nbsp;the&nbsp;given&nbsp;service,</span><br>
<span class="lineno"></span><span class="comment" id="3402280">//&nbsp;protocol,&nbsp;and&nbsp;domain&nbsp;name.&nbsp;&nbsp;The&nbsp;proto&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;or&nbsp;&#34;udp&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3402340">//&nbsp;The&nbsp;returned&nbsp;records&nbsp;are&nbsp;sorted&nbsp;by&nbsp;priority&nbsp;and&nbsp;randomized</span><br>
<span class="lineno"></span><span class="comment" id="3402402">//&nbsp;by&nbsp;weight&nbsp;within&nbsp;a&nbsp;priority.</span><br>
<span class="lineno"></span><span class="comment" id="3402434">//</span><br>
<span class="lineno">115</span><span class="comment" id="3402437">//&nbsp;LookupSRV&nbsp;constructs&nbsp;the&nbsp;DNS&nbsp;name&nbsp;to&nbsp;look&nbsp;up&nbsp;following&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="comment" id="3402505">//&nbsp;That&nbsp;is,&nbsp;it&nbsp;looks&nbsp;up&nbsp;_service._proto.name.&nbsp;&nbsp;To&nbsp;accommodate&nbsp;services</span><br>
<span class="lineno"></span><span class="comment" id="3402576">//&nbsp;publishing&nbsp;SRV&nbsp;records&nbsp;under&nbsp;non-standard&nbsp;names,&nbsp;if&nbsp;both&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3402644">//&nbsp;and&nbsp;proto&nbsp;are&nbsp;empty&nbsp;strings,&nbsp;LookupSRV&nbsp;looks&nbsp;up&nbsp;name&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3402710">func</span>&nbsp;<span class="ident" id="3402715">LookupSRV</span><span class="op" id="3402724">(</span><span class="ident" id="3402725">service</span><span class="op" id="3402732">,</span>&nbsp;<span class="ident" id="3402734">proto</span><span class="op" id="3402739">,</span>&nbsp;<span class="ident" id="3402741">name</span>&nbsp;<span class="builtintype" id="3402746">string</span><span class="op" id="3402752">)</span>&nbsp;<span class="op" id="3402754">(</span><span class="ident" id="3402755">cname</span>&nbsp;<span class="builtintype" id="3402761">string</span><span class="op" id="3402767">,</span>&nbsp;<span class="ident" id="3402769">addrs</span>&nbsp;<span class="op" id="3402775">[</span><span class="op" id="3402776">]</span><span class="op" id="3402777">*</span><span class="ident" id="3402778">SRV</span><span class="op" id="3402781">,</span>&nbsp;<span class="ident" id="3402783">err</span>&nbsp;<span class="builtintype" id="3402787">error</span><span class="op" id="3402792">)</span>&nbsp;<span class="op" id="3402794">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402797">return</span>&nbsp;<span class="ident" id="3402804">lookupSRV</span><span class="op" id="3402813">(</span><span class="ident" id="3402814">service</span><span class="op" id="3402821">,</span>&nbsp;<span class="ident" id="3402823">proto</span><span class="op" id="3402828">,</span>&nbsp;<span class="ident" id="3402830">name</span><span class="op" id="3402834">)</span><br>
<span class="lineno"></span><span class="op" id="3402836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3402839">//&nbsp;LookupMX&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;MX&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name&nbsp;sorted&nbsp;by&nbsp;preference.</span><br>
<span class="lineno"></span><span class="keyword" id="3402926">func</span>&nbsp;<span class="ident" id="3402931">LookupMX</span><span class="op" id="3402939">(</span><span class="ident" id="3402940">name</span>&nbsp;<span class="builtintype" id="3402945">string</span><span class="op" id="3402951">)</span>&nbsp;<span class="op" id="3402953">(</span><span class="ident" id="3402954">mx</span>&nbsp;<span class="op" id="3402957">[</span><span class="op" id="3402958">]</span><span class="op" id="3402959">*</span><span class="ident" id="3402960">MX</span><span class="op" id="3402962">,</span>&nbsp;<span class="ident" id="3402964">err</span>&nbsp;<span class="builtintype" id="3402968">error</span><span class="op" id="3402973">)</span>&nbsp;<span class="op" id="3402975">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402978">return</span>&nbsp;<span class="ident" id="3402985">lookupMX</span><span class="op" id="3402993">(</span><span class="ident" id="3402994">name</span><span class="op" id="3402998">)</span><br>
<span class="lineno"></span><span class="op" id="3403000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3403003">//&nbsp;LookupNS&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;NS&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3403069">func</span>&nbsp;<span class="ident" id="3403074">LookupNS</span><span class="op" id="3403082">(</span><span class="ident" id="3403083">name</span>&nbsp;<span class="builtintype" id="3403088">string</span><span class="op" id="3403094">)</span>&nbsp;<span class="op" id="3403096">(</span><span class="ident" id="3403097">ns</span>&nbsp;<span class="op" id="3403100">[</span><span class="op" id="3403101">]</span><span class="op" id="3403102">*</span><span class="ident" id="3403103">NS</span><span class="op" id="3403105">,</span>&nbsp;<span class="ident" id="3403107">err</span>&nbsp;<span class="builtintype" id="3403111">error</span><span class="op" id="3403116">)</span>&nbsp;<span class="op" id="3403118">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403121">return</span>&nbsp;<span class="ident" id="3403128">lookupNS</span><span class="op" id="3403136">(</span><span class="ident" id="3403137">name</span><span class="op" id="3403141">)</span><br>
<span class="lineno"></span><span class="op" id="3403143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3403146">//&nbsp;LookupTXT&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;TXT&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3403214">func</span>&nbsp;<span class="ident" id="3403219">LookupTXT</span><span class="op" id="3403228">(</span><span class="ident" id="3403229">name</span>&nbsp;<span class="builtintype" id="3403234">string</span><span class="op" id="3403240">)</span>&nbsp;<span class="op" id="3403242">(</span><span class="ident" id="3403243">txt</span>&nbsp;<span class="op" id="3403247">[</span><span class="op" id="3403248">]</span><span class="builtintype" id="3403249">string</span><span class="op" id="3403255">,</span>&nbsp;<span class="ident" id="3403257">err</span>&nbsp;<span class="builtintype" id="3403261">error</span><span class="op" id="3403266">)</span>&nbsp;<span class="op" id="3403268">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403271">return</span>&nbsp;<span class="ident" id="3403278">lookupTXT</span><span class="op" id="3403287">(</span><span class="ident" id="3403288">name</span><span class="op" id="3403292">)</span><br>
<span class="lineno"></span><span class="op" id="3403294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3403297">//&nbsp;LookupAddr&nbsp;performs&nbsp;a&nbsp;reverse&nbsp;lookup&nbsp;for&nbsp;the&nbsp;given&nbsp;address,&nbsp;returning&nbsp;a&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3403377">//&nbsp;of&nbsp;names&nbsp;mapping&nbsp;to&nbsp;that&nbsp;address.</span><br>
<span class="lineno">140</span><span class="keyword" id="3403414">func</span>&nbsp;<span class="ident" id="3403419">LookupAddr</span><span class="op" id="3403429">(</span><span class="ident" id="3403430">addr</span>&nbsp;<span class="builtintype" id="3403435">string</span><span class="op" id="3403441">)</span>&nbsp;<span class="op" id="3403443">(</span><span class="ident" id="3403444">name</span>&nbsp;<span class="op" id="3403449">[</span><span class="op" id="3403450">]</span><span class="builtintype" id="3403451">string</span><span class="op" id="3403457">,</span>&nbsp;<span class="ident" id="3403459">err</span>&nbsp;<span class="builtintype" id="3403463">error</span><span class="op" id="3403468">)</span>&nbsp;<span class="op" id="3403470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403473">return</span>&nbsp;<span class="ident" id="3403480">lookupAddr</span><span class="op" id="3403490">(</span><span class="ident" id="3403491">addr</span><span class="op" id="3403495">)</span><br>
<span class="lineno"></span><span class="op" id="3403497">}</span>
</div>
</body>
</html>
