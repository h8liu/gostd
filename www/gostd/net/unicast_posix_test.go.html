<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8144972">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8145028">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8145082">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8145133">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145151">package</span>&nbsp;<span class="ident" id="8145159">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145164">import</span>&nbsp;<span class="op" id="8145171">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8145174">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8145185">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8145196">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8145206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8145209">var</span>&nbsp;<span class="ident" id="8145213">listenerTests</span>&nbsp;<span class="op" id="8145227">=</span>&nbsp;<span class="op" id="8145229">[</span><span class="op" id="8145230">]</span><span class="keyword" id="8145231">struct</span>&nbsp;<span class="op" id="8145238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145241">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8145250">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145258">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8145267">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145275">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8145284">bool</span>&nbsp;<span class="comment" id="8145289">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145330">wildcard</span>&nbsp;<span class="builtintype" id="8145339">bool</span>&nbsp;<span class="comment" id="8145344">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="8145374">}</span><span class="op" id="8145375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145378">{</span><span class="ident" id="8145379">net</span><span class="op" id="8145382">:</span>&nbsp;<span class="string" id="8145384">&#34;tcp&#34;</span><span class="op" id="8145389">,</span>&nbsp;<span class="ident" id="8145391">laddr</span><span class="op" id="8145396">:</span>&nbsp;<span class="string" id="8145398">&#34;&#34;</span><span class="op" id="8145400">,</span>&nbsp;<span class="ident" id="8145402">wildcard</span><span class="op" id="8145410">:</span>&nbsp;<span class="builtintype" id="8145412">true</span><span class="op" id="8145416">}</span><span class="op" id="8145417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145420">{</span><span class="ident" id="8145421">net</span><span class="op" id="8145424">:</span>&nbsp;<span class="string" id="8145426">&#34;tcp&#34;</span><span class="op" id="8145431">,</span>&nbsp;<span class="ident" id="8145433">laddr</span><span class="op" id="8145438">:</span>&nbsp;<span class="string" id="8145440">&#34;0.0.0.0&#34;</span><span class="op" id="8145449">,</span>&nbsp;<span class="ident" id="8145451">wildcard</span><span class="op" id="8145459">:</span>&nbsp;<span class="builtintype" id="8145461">true</span><span class="op" id="8145465">}</span><span class="op" id="8145466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145469">{</span><span class="ident" id="8145470">net</span><span class="op" id="8145473">:</span>&nbsp;<span class="string" id="8145475">&#34;tcp&#34;</span><span class="op" id="8145480">,</span>&nbsp;<span class="ident" id="8145482">laddr</span><span class="op" id="8145487">:</span>&nbsp;<span class="string" id="8145489">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8145507">,</span>&nbsp;<span class="ident" id="8145509">wildcard</span><span class="op" id="8145517">:</span>&nbsp;<span class="builtintype" id="8145519">true</span><span class="op" id="8145523">}</span><span class="op" id="8145524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145527">{</span><span class="ident" id="8145528">net</span><span class="op" id="8145531">:</span>&nbsp;<span class="string" id="8145533">&#34;tcp&#34;</span><span class="op" id="8145538">,</span>&nbsp;<span class="ident" id="8145540">laddr</span><span class="op" id="8145545">:</span>&nbsp;<span class="string" id="8145547">&#34;[::]&#34;</span><span class="op" id="8145553">,</span>&nbsp;<span class="ident" id="8145555">ipv6</span><span class="op" id="8145559">:</span>&nbsp;<span class="builtintype" id="8145561">true</span><span class="op" id="8145565">,</span>&nbsp;<span class="ident" id="8145567">wildcard</span><span class="op" id="8145575">:</span>&nbsp;<span class="builtintype" id="8145577">true</span><span class="op" id="8145581">}</span><span class="op" id="8145582">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145586">{</span><span class="ident" id="8145587">net</span><span class="op" id="8145590">:</span>&nbsp;<span class="string" id="8145592">&#34;tcp&#34;</span><span class="op" id="8145597">,</span>&nbsp;<span class="ident" id="8145599">laddr</span><span class="op" id="8145604">:</span>&nbsp;<span class="string" id="8145606">&#34;127.0.0.1&#34;</span><span class="op" id="8145617">}</span><span class="op" id="8145618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145621">{</span><span class="ident" id="8145622">net</span><span class="op" id="8145625">:</span>&nbsp;<span class="string" id="8145627">&#34;tcp&#34;</span><span class="op" id="8145632">,</span>&nbsp;<span class="ident" id="8145634">laddr</span><span class="op" id="8145639">:</span>&nbsp;<span class="string" id="8145641">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8145661">}</span><span class="op" id="8145662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145665">{</span><span class="ident" id="8145666">net</span><span class="op" id="8145669">:</span>&nbsp;<span class="string" id="8145671">&#34;tcp&#34;</span><span class="op" id="8145676">,</span>&nbsp;<span class="ident" id="8145678">laddr</span><span class="op" id="8145683">:</span>&nbsp;<span class="string" id="8145685">&#34;[::1]&#34;</span><span class="op" id="8145692">,</span>&nbsp;<span class="ident" id="8145694">ipv6</span><span class="op" id="8145698">:</span>&nbsp;<span class="builtintype" id="8145700">true</span><span class="op" id="8145704">}</span><span class="op" id="8145705">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145709">{</span><span class="ident" id="8145710">net</span><span class="op" id="8145713">:</span>&nbsp;<span class="string" id="8145715">&#34;tcp4&#34;</span><span class="op" id="8145721">,</span>&nbsp;<span class="ident" id="8145723">laddr</span><span class="op" id="8145728">:</span>&nbsp;<span class="string" id="8145730">&#34;&#34;</span><span class="op" id="8145732">,</span>&nbsp;<span class="ident" id="8145734">wildcard</span><span class="op" id="8145742">:</span>&nbsp;<span class="builtintype" id="8145744">true</span><span class="op" id="8145748">}</span><span class="op" id="8145749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145752">{</span><span class="ident" id="8145753">net</span><span class="op" id="8145756">:</span>&nbsp;<span class="string" id="8145758">&#34;tcp4&#34;</span><span class="op" id="8145764">,</span>&nbsp;<span class="ident" id="8145766">laddr</span><span class="op" id="8145771">:</span>&nbsp;<span class="string" id="8145773">&#34;0.0.0.0&#34;</span><span class="op" id="8145782">,</span>&nbsp;<span class="ident" id="8145784">wildcard</span><span class="op" id="8145792">:</span>&nbsp;<span class="builtintype" id="8145794">true</span><span class="op" id="8145798">}</span><span class="op" id="8145799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145802">{</span><span class="ident" id="8145803">net</span><span class="op" id="8145806">:</span>&nbsp;<span class="string" id="8145808">&#34;tcp4&#34;</span><span class="op" id="8145814">,</span>&nbsp;<span class="ident" id="8145816">laddr</span><span class="op" id="8145821">:</span>&nbsp;<span class="string" id="8145823">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8145841">,</span>&nbsp;<span class="ident" id="8145843">wildcard</span><span class="op" id="8145851">:</span>&nbsp;<span class="builtintype" id="8145853">true</span><span class="op" id="8145857">}</span><span class="op" id="8145858">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145862">{</span><span class="ident" id="8145863">net</span><span class="op" id="8145866">:</span>&nbsp;<span class="string" id="8145868">&#34;tcp4&#34;</span><span class="op" id="8145874">,</span>&nbsp;<span class="ident" id="8145876">laddr</span><span class="op" id="8145881">:</span>&nbsp;<span class="string" id="8145883">&#34;127.0.0.1&#34;</span><span class="op" id="8145894">}</span><span class="op" id="8145895">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145898">{</span><span class="ident" id="8145899">net</span><span class="op" id="8145902">:</span>&nbsp;<span class="string" id="8145904">&#34;tcp4&#34;</span><span class="op" id="8145910">,</span>&nbsp;<span class="ident" id="8145912">laddr</span><span class="op" id="8145917">:</span>&nbsp;<span class="string" id="8145919">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8145939">}</span><span class="op" id="8145940">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145944">{</span><span class="ident" id="8145945">net</span><span class="op" id="8145948">:</span>&nbsp;<span class="string" id="8145950">&#34;tcp6&#34;</span><span class="op" id="8145956">,</span>&nbsp;<span class="ident" id="8145958">laddr</span><span class="op" id="8145963">:</span>&nbsp;<span class="string" id="8145965">&#34;&#34;</span><span class="op" id="8145967">,</span>&nbsp;<span class="ident" id="8145969">ipv6</span><span class="op" id="8145973">:</span>&nbsp;<span class="builtintype" id="8145975">true</span><span class="op" id="8145979">,</span>&nbsp;<span class="ident" id="8145981">wildcard</span><span class="op" id="8145989">:</span>&nbsp;<span class="builtintype" id="8145991">true</span><span class="op" id="8145995">}</span><span class="op" id="8145996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145999">{</span><span class="ident" id="8146000">net</span><span class="op" id="8146003">:</span>&nbsp;<span class="string" id="8146005">&#34;tcp6&#34;</span><span class="op" id="8146011">,</span>&nbsp;<span class="ident" id="8146013">laddr</span><span class="op" id="8146018">:</span>&nbsp;<span class="string" id="8146020">&#34;[::]&#34;</span><span class="op" id="8146026">,</span>&nbsp;<span class="ident" id="8146028">ipv6</span><span class="op" id="8146032">:</span>&nbsp;<span class="builtintype" id="8146034">true</span><span class="op" id="8146038">,</span>&nbsp;<span class="ident" id="8146040">wildcard</span><span class="op" id="8146048">:</span>&nbsp;<span class="builtintype" id="8146050">true</span><span class="op" id="8146054">}</span><span class="op" id="8146055">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146059">{</span><span class="ident" id="8146060">net</span><span class="op" id="8146063">:</span>&nbsp;<span class="string" id="8146065">&#34;tcp6&#34;</span><span class="op" id="8146071">,</span>&nbsp;<span class="ident" id="8146073">laddr</span><span class="op" id="8146078">:</span>&nbsp;<span class="string" id="8146080">&#34;[::1]&#34;</span><span class="op" id="8146087">,</span>&nbsp;<span class="ident" id="8146089">ipv6</span><span class="op" id="8146093">:</span>&nbsp;<span class="builtintype" id="8146095">true</span><span class="op" id="8146099">}</span><span class="op" id="8146100">,</span><br>
<span class="lineno"></span><span class="op" id="8146102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8146105">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8146170">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="8146235">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8146249">func</span>&nbsp;<span class="ident" id="8146254">TestTCPListener</span><span class="op" id="8146269">(</span><span class="ident" id="8146270">t</span>&nbsp;<span class="op" id="8146272">*</span><span class="ident" id="8146273">testing</span><span class="op" id="8146280">.</span><span class="ident" id="8146281">T</span><span class="op" id="8146282">)</span>&nbsp;<span class="op" id="8146284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146287">switch</span>&nbsp;<span class="ident" id="8146294">runtime</span><span class="op" id="8146301">.</span><span class="ident" id="8146302">GOOS</span>&nbsp;<span class="op" id="8146307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146310">case</span>&nbsp;<span class="string" id="8146315">&#34;plan9&#34;</span><span class="op" id="8146322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146326">t</span><span class="op" id="8146327">.</span><span class="ident" id="8146328">Skipf</span><span class="op" id="8146333">(</span><span class="string" id="8146334">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8146355">,</span>&nbsp;<span class="ident" id="8146357">runtime</span><span class="op" id="8146364">.</span><span class="ident" id="8146365">GOOS</span><span class="op" id="8146369">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146376">for</span>&nbsp;<span class="ident" id="8146380">_</span><span class="op" id="8146381">,</span>&nbsp;<span class="ident" id="8146383">tt</span>&nbsp;<span class="op" id="8146386">:=</span>&nbsp;<span class="keyword" id="8146389">range</span>&nbsp;<span class="ident" id="8146395">listenerTests</span>&nbsp;<span class="op" id="8146409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146413">if</span>&nbsp;<span class="ident" id="8146416">tt</span><span class="op" id="8146418">.</span><span class="ident" id="8146419">wildcard</span>&nbsp;<span class="op" id="8146428">&amp;&amp;</span>&nbsp;<span class="op" id="8146431">(</span><span class="ident" id="8146432">testing</span><span class="op" id="8146439">.</span><span class="ident" id="8146440">Short</span><span class="op" id="8146445">(</span><span class="op" id="8146446">)</span>&nbsp;<span class="op" id="8146448">||</span>&nbsp;<span class="op" id="8146451">!</span><span class="op" id="8146452">*</span><span class="ident" id="8146453">testExternal</span><span class="op" id="8146465">)</span>&nbsp;<span class="op" id="8146467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146472">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146487">if</span>&nbsp;<span class="ident" id="8146490">tt</span><span class="op" id="8146492">.</span><span class="ident" id="8146493">ipv6</span>&nbsp;<span class="op" id="8146498">&amp;&amp;</span>&nbsp;<span class="op" id="8146501">!</span><span class="ident" id="8146502">supportsIPv6</span>&nbsp;<span class="op" id="8146515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146520">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146535">l1</span><span class="op" id="8146537">,</span>&nbsp;<span class="ident" id="8146539">port</span>&nbsp;<span class="op" id="8146544">:=</span>&nbsp;<span class="ident" id="8146547">usableListenPort</span><span class="op" id="8146563">(</span><span class="ident" id="8146564">t</span><span class="op" id="8146565">,</span>&nbsp;<span class="ident" id="8146567">tt</span><span class="op" id="8146569">.</span><span class="ident" id="8146570">net</span><span class="op" id="8146573">,</span>&nbsp;<span class="ident" id="8146575">tt</span><span class="op" id="8146577">.</span><span class="ident" id="8146578">laddr</span><span class="op" id="8146583">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146587">checkFirstListener</span><span class="op" id="8146605">(</span><span class="ident" id="8146606">t</span><span class="op" id="8146607">,</span>&nbsp;<span class="ident" id="8146609">tt</span><span class="op" id="8146611">.</span><span class="ident" id="8146612">net</span><span class="op" id="8146615">,</span>&nbsp;<span class="ident" id="8146617">tt</span><span class="op" id="8146619">.</span><span class="ident" id="8146620">laddr</span><span class="op" id="8146625">+</span><span class="string" id="8146626">&#34;:&#34;</span><span class="op" id="8146629">+</span><span class="ident" id="8146630">port</span><span class="op" id="8146634">,</span>&nbsp;<span class="ident" id="8146636">l1</span><span class="op" id="8146638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146642">l2</span><span class="op" id="8146644">,</span>&nbsp;<span class="ident" id="8146646">err</span>&nbsp;<span class="op" id="8146650">:=</span>&nbsp;<span class="ident" id="8146653">Listen</span><span class="op" id="8146659">(</span><span class="ident" id="8146660">tt</span><span class="op" id="8146662">.</span><span class="ident" id="8146663">net</span><span class="op" id="8146666">,</span>&nbsp;<span class="ident" id="8146668">tt</span><span class="op" id="8146670">.</span><span class="ident" id="8146671">laddr</span><span class="op" id="8146676">+</span><span class="string" id="8146677">&#34;:&#34;</span><span class="op" id="8146680">+</span><span class="ident" id="8146681">port</span><span class="op" id="8146685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146689">checkSecondListener</span><span class="op" id="8146708">(</span><span class="ident" id="8146709">t</span><span class="op" id="8146710">,</span>&nbsp;<span class="ident" id="8146712">tt</span><span class="op" id="8146714">.</span><span class="ident" id="8146715">net</span><span class="op" id="8146718">,</span>&nbsp;<span class="ident" id="8146720">tt</span><span class="op" id="8146722">.</span><span class="ident" id="8146723">laddr</span><span class="op" id="8146728">+</span><span class="string" id="8146729">&#34;:&#34;</span><span class="op" id="8146732">+</span><span class="ident" id="8146733">port</span><span class="op" id="8146737">,</span>&nbsp;<span class="ident" id="8146739">err</span><span class="op" id="8146742">,</span>&nbsp;<span class="ident" id="8146744">l2</span><span class="op" id="8146746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146750">l1</span><span class="op" id="8146752">.</span><span class="ident" id="8146753">Close</span><span class="op" id="8146758">(</span><span class="op" id="8146759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146762">}</span><br>
<span class="lineno">65</span><span class="op" id="8146764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8146767">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8146832">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8146897">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="8146911">func</span>&nbsp;<span class="ident" id="8146916">TestUDPListener</span><span class="op" id="8146931">(</span><span class="ident" id="8146932">t</span>&nbsp;<span class="op" id="8146934">*</span><span class="ident" id="8146935">testing</span><span class="op" id="8146942">.</span><span class="ident" id="8146943">T</span><span class="op" id="8146944">)</span>&nbsp;<span class="op" id="8146946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146949">switch</span>&nbsp;<span class="ident" id="8146956">runtime</span><span class="op" id="8146963">.</span><span class="ident" id="8146964">GOOS</span>&nbsp;<span class="op" id="8146969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8146972">case</span>&nbsp;<span class="string" id="8146977">&#34;plan9&#34;</span><span class="op" id="8146984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146988">t</span><span class="op" id="8146989">.</span><span class="ident" id="8146990">Skipf</span><span class="op" id="8146995">(</span><span class="string" id="8146996">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8147017">,</span>&nbsp;<span class="ident" id="8147019">runtime</span><span class="op" id="8147026">.</span><span class="ident" id="8147027">GOOS</span><span class="op" id="8147031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147034">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147038">toudpnet</span>&nbsp;<span class="op" id="8147047">:=</span>&nbsp;<span class="keyword" id="8147050">func</span><span class="op" id="8147054">(</span><span class="ident" id="8147055">net</span>&nbsp;<span class="builtintype" id="8147059">string</span><span class="op" id="8147065">)</span>&nbsp;<span class="builtintype" id="8147067">string</span>&nbsp;<span class="op" id="8147074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147078">switch</span>&nbsp;<span class="ident" id="8147085">net</span>&nbsp;<span class="op" id="8147089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147093">case</span>&nbsp;<span class="string" id="8147098">&#34;tcp&#34;</span><span class="op" id="8147103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147108">return</span>&nbsp;<span class="string" id="8147115">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147123">case</span>&nbsp;<span class="string" id="8147128">&#34;tcp4&#34;</span><span class="op" id="8147134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147139">return</span>&nbsp;<span class="string" id="8147146">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147155">case</span>&nbsp;<span class="string" id="8147160">&#34;tcp6&#34;</span><span class="op" id="8147166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147171">return</span>&nbsp;<span class="string" id="8147178">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147187">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147191">return</span>&nbsp;<span class="string" id="8147198">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147211">for</span>&nbsp;<span class="ident" id="8147215">_</span><span class="op" id="8147216">,</span>&nbsp;<span class="ident" id="8147218">tt</span>&nbsp;<span class="op" id="8147221">:=</span>&nbsp;<span class="keyword" id="8147224">range</span>&nbsp;<span class="ident" id="8147230">listenerTests</span>&nbsp;<span class="op" id="8147244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147248">if</span>&nbsp;<span class="ident" id="8147251">tt</span><span class="op" id="8147253">.</span><span class="ident" id="8147254">wildcard</span>&nbsp;<span class="op" id="8147263">&amp;&amp;</span>&nbsp;<span class="op" id="8147266">(</span><span class="ident" id="8147267">testing</span><span class="op" id="8147274">.</span><span class="ident" id="8147275">Short</span><span class="op" id="8147280">(</span><span class="op" id="8147281">)</span>&nbsp;<span class="op" id="8147283">||</span>&nbsp;<span class="op" id="8147286">!</span><span class="op" id="8147287">*</span><span class="ident" id="8147288">testExternal</span><span class="op" id="8147300">)</span>&nbsp;<span class="op" id="8147302">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147307">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147322">if</span>&nbsp;<span class="ident" id="8147325">tt</span><span class="op" id="8147327">.</span><span class="ident" id="8147328">ipv6</span>&nbsp;<span class="op" id="8147333">&amp;&amp;</span>&nbsp;<span class="op" id="8147336">!</span><span class="ident" id="8147337">supportsIPv6</span>&nbsp;<span class="op" id="8147350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147355">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147366">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147370">tt</span><span class="op" id="8147372">.</span><span class="ident" id="8147373">net</span>&nbsp;<span class="op" id="8147377">=</span>&nbsp;<span class="ident" id="8147379">toudpnet</span><span class="op" id="8147387">(</span><span class="ident" id="8147388">tt</span><span class="op" id="8147390">.</span><span class="ident" id="8147391">net</span><span class="op" id="8147394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147398">l1</span><span class="op" id="8147400">,</span>&nbsp;<span class="ident" id="8147402">port</span>&nbsp;<span class="op" id="8147407">:=</span>&nbsp;<span class="ident" id="8147410">usableListenPacketPort</span><span class="op" id="8147432">(</span><span class="ident" id="8147433">t</span><span class="op" id="8147434">,</span>&nbsp;<span class="ident" id="8147436">tt</span><span class="op" id="8147438">.</span><span class="ident" id="8147439">net</span><span class="op" id="8147442">,</span>&nbsp;<span class="ident" id="8147444">tt</span><span class="op" id="8147446">.</span><span class="ident" id="8147447">laddr</span><span class="op" id="8147452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147456">checkFirstListener</span><span class="op" id="8147474">(</span><span class="ident" id="8147475">t</span><span class="op" id="8147476">,</span>&nbsp;<span class="ident" id="8147478">tt</span><span class="op" id="8147480">.</span><span class="ident" id="8147481">net</span><span class="op" id="8147484">,</span>&nbsp;<span class="ident" id="8147486">tt</span><span class="op" id="8147488">.</span><span class="ident" id="8147489">laddr</span><span class="op" id="8147494">+</span><span class="string" id="8147495">&#34;:&#34;</span><span class="op" id="8147498">+</span><span class="ident" id="8147499">port</span><span class="op" id="8147503">,</span>&nbsp;<span class="ident" id="8147505">l1</span><span class="op" id="8147507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147511">l2</span><span class="op" id="8147513">,</span>&nbsp;<span class="ident" id="8147515">err</span>&nbsp;<span class="op" id="8147519">:=</span>&nbsp;<span class="ident" id="8147522">ListenPacket</span><span class="op" id="8147534">(</span><span class="ident" id="8147535">tt</span><span class="op" id="8147537">.</span><span class="ident" id="8147538">net</span><span class="op" id="8147541">,</span>&nbsp;<span class="ident" id="8147543">tt</span><span class="op" id="8147545">.</span><span class="ident" id="8147546">laddr</span><span class="op" id="8147551">+</span><span class="string" id="8147552">&#34;:&#34;</span><span class="op" id="8147555">+</span><span class="ident" id="8147556">port</span><span class="op" id="8147560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147564">checkSecondListener</span><span class="op" id="8147583">(</span><span class="ident" id="8147584">t</span><span class="op" id="8147585">,</span>&nbsp;<span class="ident" id="8147587">tt</span><span class="op" id="8147589">.</span><span class="ident" id="8147590">net</span><span class="op" id="8147593">,</span>&nbsp;<span class="ident" id="8147595">tt</span><span class="op" id="8147597">.</span><span class="ident" id="8147598">laddr</span><span class="op" id="8147603">+</span><span class="string" id="8147604">&#34;:&#34;</span><span class="op" id="8147607">+</span><span class="ident" id="8147608">port</span><span class="op" id="8147612">,</span>&nbsp;<span class="ident" id="8147614">err</span><span class="op" id="8147617">,</span>&nbsp;<span class="ident" id="8147619">l2</span><span class="op" id="8147621">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147625">l1</span><span class="op" id="8147627">.</span><span class="ident" id="8147628">Close</span><span class="op" id="8147633">(</span><span class="op" id="8147634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147637">}</span><br>
<span class="lineno"></span><span class="op" id="8147639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8147642">var</span>&nbsp;<span class="ident" id="8147646">dualStackListenerTests</span>&nbsp;<span class="op" id="8147669">=</span>&nbsp;<span class="op" id="8147671">[</span><span class="op" id="8147672">]</span><span class="keyword" id="8147673">struct</span>&nbsp;<span class="op" id="8147680">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147683">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8147692">string</span>&nbsp;<span class="comment" id="8147699">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147718">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8147727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147735">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8147744">string</span>&nbsp;<span class="comment" id="8147751">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147771">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8147780">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147788">wildcard</span>&nbsp;<span class="builtintype" id="8147797">bool</span>&nbsp;&nbsp;<span class="comment" id="8147803">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147834">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8147843">error</span>&nbsp;<span class="comment" id="8147849">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="8147887">}</span><span class="op" id="8147888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8147891">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8147973">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148062">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148151">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148237">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148323">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148409">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148498">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148585">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148672">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148759">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148846">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148933">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149020">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149109">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149196">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149283">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149370">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149457">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149546">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149633">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149720">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149807">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149894">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149898">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149935">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149969">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150042">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150074">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150147">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150179">//&nbsp;&nbsp;&nbsp;&nbsp;net.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150251">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8150283">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150338">{</span><span class="ident" id="8150339">net1</span><span class="op" id="8150343">:</span>&nbsp;<span class="string" id="8150345">&#34;tcp&#34;</span><span class="op" id="8150350">,</span>&nbsp;<span class="ident" id="8150352">laddr1</span><span class="op" id="8150358">:</span>&nbsp;<span class="string" id="8150360">&#34;&#34;</span><span class="op" id="8150362">,</span>&nbsp;<span class="ident" id="8150364">net2</span><span class="op" id="8150368">:</span>&nbsp;<span class="string" id="8150370">&#34;tcp&#34;</span><span class="op" id="8150375">,</span>&nbsp;<span class="ident" id="8150377">laddr2</span><span class="op" id="8150383">:</span>&nbsp;<span class="string" id="8150385">&#34;&#34;</span><span class="op" id="8150387">,</span>&nbsp;<span class="ident" id="8150389">wildcard</span><span class="op" id="8150397">:</span>&nbsp;<span class="builtintype" id="8150399">true</span><span class="op" id="8150403">,</span>&nbsp;<span class="ident" id="8150405">xerr</span><span class="op" id="8150409">:</span>&nbsp;<span class="ident" id="8150411">syscall</span><span class="op" id="8150418">.</span><span class="ident" id="8150419">EADDRINUSE</span><span class="op" id="8150429">}</span><span class="op" id="8150430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150433">{</span><span class="ident" id="8150434">net1</span><span class="op" id="8150438">:</span>&nbsp;<span class="string" id="8150440">&#34;tcp&#34;</span><span class="op" id="8150445">,</span>&nbsp;<span class="ident" id="8150447">laddr1</span><span class="op" id="8150453">:</span>&nbsp;<span class="string" id="8150455">&#34;&#34;</span><span class="op" id="8150457">,</span>&nbsp;<span class="ident" id="8150459">net2</span><span class="op" id="8150463">:</span>&nbsp;<span class="string" id="8150465">&#34;tcp&#34;</span><span class="op" id="8150470">,</span>&nbsp;<span class="ident" id="8150472">laddr2</span><span class="op" id="8150478">:</span>&nbsp;<span class="string" id="8150480">&#34;0.0.0.0&#34;</span><span class="op" id="8150489">,</span>&nbsp;<span class="ident" id="8150491">wildcard</span><span class="op" id="8150499">:</span>&nbsp;<span class="builtintype" id="8150501">true</span><span class="op" id="8150505">,</span>&nbsp;<span class="ident" id="8150507">xerr</span><span class="op" id="8150511">:</span>&nbsp;<span class="ident" id="8150513">syscall</span><span class="op" id="8150520">.</span><span class="ident" id="8150521">EADDRINUSE</span><span class="op" id="8150531">}</span><span class="op" id="8150532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150535">{</span><span class="ident" id="8150536">net1</span><span class="op" id="8150540">:</span>&nbsp;<span class="string" id="8150542">&#34;tcp&#34;</span><span class="op" id="8150547">,</span>&nbsp;<span class="ident" id="8150549">laddr1</span><span class="op" id="8150555">:</span>&nbsp;<span class="string" id="8150557">&#34;0.0.0.0&#34;</span><span class="op" id="8150566">,</span>&nbsp;<span class="ident" id="8150568">net2</span><span class="op" id="8150572">:</span>&nbsp;<span class="string" id="8150574">&#34;tcp&#34;</span><span class="op" id="8150579">,</span>&nbsp;<span class="ident" id="8150581">laddr2</span><span class="op" id="8150587">:</span>&nbsp;<span class="string" id="8150589">&#34;&#34;</span><span class="op" id="8150591">,</span>&nbsp;<span class="ident" id="8150593">wildcard</span><span class="op" id="8150601">:</span>&nbsp;<span class="builtintype" id="8150603">true</span><span class="op" id="8150607">,</span>&nbsp;<span class="ident" id="8150609">xerr</span><span class="op" id="8150613">:</span>&nbsp;<span class="ident" id="8150615">syscall</span><span class="op" id="8150622">.</span><span class="ident" id="8150623">EADDRINUSE</span><span class="op" id="8150633">}</span><span class="op" id="8150634">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150638">{</span><span class="ident" id="8150639">net1</span><span class="op" id="8150643">:</span>&nbsp;<span class="string" id="8150645">&#34;tcp&#34;</span><span class="op" id="8150650">,</span>&nbsp;<span class="ident" id="8150652">laddr1</span><span class="op" id="8150658">:</span>&nbsp;<span class="string" id="8150660">&#34;&#34;</span><span class="op" id="8150662">,</span>&nbsp;<span class="ident" id="8150664">net2</span><span class="op" id="8150668">:</span>&nbsp;<span class="string" id="8150670">&#34;tcp&#34;</span><span class="op" id="8150675">,</span>&nbsp;<span class="ident" id="8150677">laddr2</span><span class="op" id="8150683">:</span>&nbsp;<span class="string" id="8150685">&#34;[::]&#34;</span><span class="op" id="8150691">,</span>&nbsp;<span class="ident" id="8150693">wildcard</span><span class="op" id="8150701">:</span>&nbsp;<span class="builtintype" id="8150703">true</span><span class="op" id="8150707">,</span>&nbsp;<span class="ident" id="8150709">xerr</span><span class="op" id="8150713">:</span>&nbsp;<span class="ident" id="8150715">syscall</span><span class="op" id="8150722">.</span><span class="ident" id="8150723">EADDRINUSE</span><span class="op" id="8150733">}</span><span class="op" id="8150734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150737">{</span><span class="ident" id="8150738">net1</span><span class="op" id="8150742">:</span>&nbsp;<span class="string" id="8150744">&#34;tcp&#34;</span><span class="op" id="8150749">,</span>&nbsp;<span class="ident" id="8150751">laddr1</span><span class="op" id="8150757">:</span>&nbsp;<span class="string" id="8150759">&#34;[::]&#34;</span><span class="op" id="8150765">,</span>&nbsp;<span class="ident" id="8150767">net2</span><span class="op" id="8150771">:</span>&nbsp;<span class="string" id="8150773">&#34;tcp&#34;</span><span class="op" id="8150778">,</span>&nbsp;<span class="ident" id="8150780">laddr2</span><span class="op" id="8150786">:</span>&nbsp;<span class="string" id="8150788">&#34;&#34;</span><span class="op" id="8150790">,</span>&nbsp;<span class="ident" id="8150792">wildcard</span><span class="op" id="8150800">:</span>&nbsp;<span class="builtintype" id="8150802">true</span><span class="op" id="8150806">,</span>&nbsp;<span class="ident" id="8150808">xerr</span><span class="op" id="8150812">:</span>&nbsp;<span class="ident" id="8150814">syscall</span><span class="op" id="8150821">.</span><span class="ident" id="8150822">EADDRINUSE</span><span class="op" id="8150832">}</span><span class="op" id="8150833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150836">{</span><span class="ident" id="8150837">net1</span><span class="op" id="8150841">:</span>&nbsp;<span class="string" id="8150843">&#34;tcp&#34;</span><span class="op" id="8150848">,</span>&nbsp;<span class="ident" id="8150850">laddr1</span><span class="op" id="8150856">:</span>&nbsp;<span class="string" id="8150858">&#34;0.0.0.0&#34;</span><span class="op" id="8150867">,</span>&nbsp;<span class="ident" id="8150869">net2</span><span class="op" id="8150873">:</span>&nbsp;<span class="string" id="8150875">&#34;tcp&#34;</span><span class="op" id="8150880">,</span>&nbsp;<span class="ident" id="8150882">laddr2</span><span class="op" id="8150888">:</span>&nbsp;<span class="string" id="8150890">&#34;[::]&#34;</span><span class="op" id="8150896">,</span>&nbsp;<span class="ident" id="8150898">wildcard</span><span class="op" id="8150906">:</span>&nbsp;<span class="builtintype" id="8150908">true</span><span class="op" id="8150912">,</span>&nbsp;<span class="ident" id="8150914">xerr</span><span class="op" id="8150918">:</span>&nbsp;<span class="ident" id="8150920">syscall</span><span class="op" id="8150927">.</span><span class="ident" id="8150928">EADDRINUSE</span><span class="op" id="8150938">}</span><span class="op" id="8150939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150942">{</span><span class="ident" id="8150943">net1</span><span class="op" id="8150947">:</span>&nbsp;<span class="string" id="8150949">&#34;tcp&#34;</span><span class="op" id="8150954">,</span>&nbsp;<span class="ident" id="8150956">laddr1</span><span class="op" id="8150962">:</span>&nbsp;<span class="string" id="8150964">&#34;[::]&#34;</span><span class="op" id="8150970">,</span>&nbsp;<span class="ident" id="8150972">net2</span><span class="op" id="8150976">:</span>&nbsp;<span class="string" id="8150978">&#34;tcp&#34;</span><span class="op" id="8150983">,</span>&nbsp;<span class="ident" id="8150985">laddr2</span><span class="op" id="8150991">:</span>&nbsp;<span class="string" id="8150993">&#34;0.0.0.0&#34;</span><span class="op" id="8151002">,</span>&nbsp;<span class="ident" id="8151004">wildcard</span><span class="op" id="8151012">:</span>&nbsp;<span class="builtintype" id="8151014">true</span><span class="op" id="8151018">,</span>&nbsp;<span class="ident" id="8151020">xerr</span><span class="op" id="8151024">:</span>&nbsp;<span class="ident" id="8151026">syscall</span><span class="op" id="8151033">.</span><span class="ident" id="8151034">EADDRINUSE</span><span class="op" id="8151044">}</span><span class="op" id="8151045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151048">{</span><span class="ident" id="8151049">net1</span><span class="op" id="8151053">:</span>&nbsp;<span class="string" id="8151055">&#34;tcp&#34;</span><span class="op" id="8151060">,</span>&nbsp;<span class="ident" id="8151062">laddr1</span><span class="op" id="8151068">:</span>&nbsp;<span class="string" id="8151070">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8151088">,</span>&nbsp;<span class="ident" id="8151090">net2</span><span class="op" id="8151094">:</span>&nbsp;<span class="string" id="8151096">&#34;tcp&#34;</span><span class="op" id="8151101">,</span>&nbsp;<span class="ident" id="8151103">laddr2</span><span class="op" id="8151109">:</span>&nbsp;<span class="string" id="8151111">&#34;[::]&#34;</span><span class="op" id="8151117">,</span>&nbsp;<span class="ident" id="8151119">wildcard</span><span class="op" id="8151127">:</span>&nbsp;<span class="builtintype" id="8151129">true</span><span class="op" id="8151133">,</span>&nbsp;<span class="ident" id="8151135">xerr</span><span class="op" id="8151139">:</span>&nbsp;<span class="ident" id="8151141">syscall</span><span class="op" id="8151148">.</span><span class="ident" id="8151149">EADDRINUSE</span><span class="op" id="8151159">}</span><span class="op" id="8151160">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151163">{</span><span class="ident" id="8151164">net1</span><span class="op" id="8151168">:</span>&nbsp;<span class="string" id="8151170">&#34;tcp&#34;</span><span class="op" id="8151175">,</span>&nbsp;<span class="ident" id="8151177">laddr1</span><span class="op" id="8151183">:</span>&nbsp;<span class="string" id="8151185">&#34;[::]&#34;</span><span class="op" id="8151191">,</span>&nbsp;<span class="ident" id="8151193">net2</span><span class="op" id="8151197">:</span>&nbsp;<span class="string" id="8151199">&#34;tcp&#34;</span><span class="op" id="8151204">,</span>&nbsp;<span class="ident" id="8151206">laddr2</span><span class="op" id="8151212">:</span>&nbsp;<span class="string" id="8151214">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8151232">,</span>&nbsp;<span class="ident" id="8151234">wildcard</span><span class="op" id="8151242">:</span>&nbsp;<span class="builtintype" id="8151244">true</span><span class="op" id="8151248">,</span>&nbsp;<span class="ident" id="8151250">xerr</span><span class="op" id="8151254">:</span>&nbsp;<span class="ident" id="8151256">syscall</span><span class="op" id="8151263">.</span><span class="ident" id="8151264">EADDRINUSE</span><span class="op" id="8151274">}</span><span class="op" id="8151275">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151279">{</span><span class="ident" id="8151280">net1</span><span class="op" id="8151284">:</span>&nbsp;<span class="string" id="8151286">&#34;tcp4&#34;</span><span class="op" id="8151292">,</span>&nbsp;<span class="ident" id="8151294">laddr1</span><span class="op" id="8151300">:</span>&nbsp;<span class="string" id="8151302">&#34;&#34;</span><span class="op" id="8151304">,</span>&nbsp;<span class="ident" id="8151306">net2</span><span class="op" id="8151310">:</span>&nbsp;<span class="string" id="8151312">&#34;tcp6&#34;</span><span class="op" id="8151318">,</span>&nbsp;<span class="ident" id="8151320">laddr2</span><span class="op" id="8151326">:</span>&nbsp;<span class="string" id="8151328">&#34;&#34;</span><span class="op" id="8151330">,</span>&nbsp;<span class="ident" id="8151332">wildcard</span><span class="op" id="8151340">:</span>&nbsp;<span class="builtintype" id="8151342">true</span><span class="op" id="8151346">}</span><span class="op" id="8151347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151350">{</span><span class="ident" id="8151351">net1</span><span class="op" id="8151355">:</span>&nbsp;<span class="string" id="8151357">&#34;tcp6&#34;</span><span class="op" id="8151363">,</span>&nbsp;<span class="ident" id="8151365">laddr1</span><span class="op" id="8151371">:</span>&nbsp;<span class="string" id="8151373">&#34;&#34;</span><span class="op" id="8151375">,</span>&nbsp;<span class="ident" id="8151377">net2</span><span class="op" id="8151381">:</span>&nbsp;<span class="string" id="8151383">&#34;tcp4&#34;</span><span class="op" id="8151389">,</span>&nbsp;<span class="ident" id="8151391">laddr2</span><span class="op" id="8151397">:</span>&nbsp;<span class="string" id="8151399">&#34;&#34;</span><span class="op" id="8151401">,</span>&nbsp;<span class="ident" id="8151403">wildcard</span><span class="op" id="8151411">:</span>&nbsp;<span class="builtintype" id="8151413">true</span><span class="op" id="8151417">}</span><span class="op" id="8151418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151421">{</span><span class="ident" id="8151422">net1</span><span class="op" id="8151426">:</span>&nbsp;<span class="string" id="8151428">&#34;tcp4&#34;</span><span class="op" id="8151434">,</span>&nbsp;<span class="ident" id="8151436">laddr1</span><span class="op" id="8151442">:</span>&nbsp;<span class="string" id="8151444">&#34;0.0.0.0&#34;</span><span class="op" id="8151453">,</span>&nbsp;<span class="ident" id="8151455">net2</span><span class="op" id="8151459">:</span>&nbsp;<span class="string" id="8151461">&#34;tcp6&#34;</span><span class="op" id="8151467">,</span>&nbsp;<span class="ident" id="8151469">laddr2</span><span class="op" id="8151475">:</span>&nbsp;<span class="string" id="8151477">&#34;[::]&#34;</span><span class="op" id="8151483">,</span>&nbsp;<span class="ident" id="8151485">wildcard</span><span class="op" id="8151493">:</span>&nbsp;<span class="builtintype" id="8151495">true</span><span class="op" id="8151499">}</span><span class="op" id="8151500">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151503">{</span><span class="ident" id="8151504">net1</span><span class="op" id="8151508">:</span>&nbsp;<span class="string" id="8151510">&#34;tcp6&#34;</span><span class="op" id="8151516">,</span>&nbsp;<span class="ident" id="8151518">laddr1</span><span class="op" id="8151524">:</span>&nbsp;<span class="string" id="8151526">&#34;[::]&#34;</span><span class="op" id="8151532">,</span>&nbsp;<span class="ident" id="8151534">net2</span><span class="op" id="8151538">:</span>&nbsp;<span class="string" id="8151540">&#34;tcp4&#34;</span><span class="op" id="8151546">,</span>&nbsp;<span class="ident" id="8151548">laddr2</span><span class="op" id="8151554">:</span>&nbsp;<span class="string" id="8151556">&#34;0.0.0.0&#34;</span><span class="op" id="8151565">,</span>&nbsp;<span class="ident" id="8151567">wildcard</span><span class="op" id="8151575">:</span>&nbsp;<span class="builtintype" id="8151577">true</span><span class="op" id="8151581">}</span><span class="op" id="8151582">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151586">{</span><span class="ident" id="8151587">net1</span><span class="op" id="8151591">:</span>&nbsp;<span class="string" id="8151593">&#34;tcp&#34;</span><span class="op" id="8151598">,</span>&nbsp;<span class="ident" id="8151600">laddr1</span><span class="op" id="8151606">:</span>&nbsp;<span class="string" id="8151608">&#34;127.0.0.1&#34;</span><span class="op" id="8151619">,</span>&nbsp;<span class="ident" id="8151621">net2</span><span class="op" id="8151625">:</span>&nbsp;<span class="string" id="8151627">&#34;tcp&#34;</span><span class="op" id="8151632">,</span>&nbsp;<span class="ident" id="8151634">laddr2</span><span class="op" id="8151640">:</span>&nbsp;<span class="string" id="8151642">&#34;[::1]&#34;</span><span class="op" id="8151649">}</span><span class="op" id="8151650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151653">{</span><span class="ident" id="8151654">net1</span><span class="op" id="8151658">:</span>&nbsp;<span class="string" id="8151660">&#34;tcp&#34;</span><span class="op" id="8151665">,</span>&nbsp;<span class="ident" id="8151667">laddr1</span><span class="op" id="8151673">:</span>&nbsp;<span class="string" id="8151675">&#34;[::1]&#34;</span><span class="op" id="8151682">,</span>&nbsp;<span class="ident" id="8151684">net2</span><span class="op" id="8151688">:</span>&nbsp;<span class="string" id="8151690">&#34;tcp&#34;</span><span class="op" id="8151695">,</span>&nbsp;<span class="ident" id="8151697">laddr2</span><span class="op" id="8151703">:</span>&nbsp;<span class="string" id="8151705">&#34;127.0.0.1&#34;</span><span class="op" id="8151716">}</span><span class="op" id="8151717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151720">{</span><span class="ident" id="8151721">net1</span><span class="op" id="8151725">:</span>&nbsp;<span class="string" id="8151727">&#34;tcp4&#34;</span><span class="op" id="8151733">,</span>&nbsp;<span class="ident" id="8151735">laddr1</span><span class="op" id="8151741">:</span>&nbsp;<span class="string" id="8151743">&#34;127.0.0.1&#34;</span><span class="op" id="8151754">,</span>&nbsp;<span class="ident" id="8151756">net2</span><span class="op" id="8151760">:</span>&nbsp;<span class="string" id="8151762">&#34;tcp6&#34;</span><span class="op" id="8151768">,</span>&nbsp;<span class="ident" id="8151770">laddr2</span><span class="op" id="8151776">:</span>&nbsp;<span class="string" id="8151778">&#34;[::1]&#34;</span><span class="op" id="8151785">}</span><span class="op" id="8151786">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151789">{</span><span class="ident" id="8151790">net1</span><span class="op" id="8151794">:</span>&nbsp;<span class="string" id="8151796">&#34;tcp6&#34;</span><span class="op" id="8151802">,</span>&nbsp;<span class="ident" id="8151804">laddr1</span><span class="op" id="8151810">:</span>&nbsp;<span class="string" id="8151812">&#34;[::1]&#34;</span><span class="op" id="8151819">,</span>&nbsp;<span class="ident" id="8151821">net2</span><span class="op" id="8151825">:</span>&nbsp;<span class="string" id="8151827">&#34;tcp4&#34;</span><span class="op" id="8151833">,</span>&nbsp;<span class="ident" id="8151835">laddr2</span><span class="op" id="8151841">:</span>&nbsp;<span class="string" id="8151843">&#34;127.0.0.1&#34;</span><span class="op" id="8151854">}</span><span class="op" id="8151855">,</span><br>
<span class="lineno"></span><span class="op" id="8151857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8151860">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8151924">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="8151987">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8152023">func</span>&nbsp;<span class="ident" id="8152028">TestDualStackTCPListener</span><span class="op" id="8152052">(</span><span class="ident" id="8152053">t</span>&nbsp;<span class="op" id="8152055">*</span><span class="ident" id="8152056">testing</span><span class="op" id="8152063">.</span><span class="ident" id="8152064">T</span><span class="op" id="8152065">)</span>&nbsp;<span class="op" id="8152067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152070">if</span>&nbsp;<span class="ident" id="8152073">testing</span><span class="op" id="8152080">.</span><span class="ident" id="8152081">Short</span><span class="op" id="8152086">(</span><span class="op" id="8152087">)</span>&nbsp;<span class="op" id="8152089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152093">t</span><span class="op" id="8152094">.</span><span class="ident" id="8152095">Skip</span><span class="op" id="8152099">(</span><span class="string" id="8152100">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8152141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152144">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152147">switch</span>&nbsp;<span class="ident" id="8152154">runtime</span><span class="op" id="8152161">.</span><span class="ident" id="8152162">GOOS</span>&nbsp;<span class="op" id="8152167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152170">case</span>&nbsp;<span class="string" id="8152175">&#34;plan9&#34;</span><span class="op" id="8152182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152186">t</span><span class="op" id="8152187">.</span><span class="ident" id="8152188">Skipf</span><span class="op" id="8152193">(</span><span class="string" id="8152194">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8152215">,</span>&nbsp;<span class="ident" id="8152217">runtime</span><span class="op" id="8152224">.</span><span class="ident" id="8152225">GOOS</span><span class="op" id="8152229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152235">if</span>&nbsp;<span class="op" id="8152238">!</span><span class="ident" id="8152239">supportsIPv6</span>&nbsp;<span class="op" id="8152252">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152256">t</span><span class="op" id="8152257">.</span><span class="ident" id="8152258">Skip</span><span class="op" id="8152262">(</span><span class="string" id="8152263">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8152286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152293">for</span>&nbsp;<span class="ident" id="8152297">_</span><span class="op" id="8152298">,</span>&nbsp;<span class="ident" id="8152300">tt</span>&nbsp;<span class="op" id="8152303">:=</span>&nbsp;<span class="keyword" id="8152306">range</span>&nbsp;<span class="ident" id="8152312">dualStackListenerTests</span>&nbsp;<span class="op" id="8152335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152339">if</span>&nbsp;<span class="ident" id="8152342">tt</span><span class="op" id="8152344">.</span><span class="ident" id="8152345">wildcard</span>&nbsp;<span class="op" id="8152354">&amp;&amp;</span>&nbsp;<span class="op" id="8152357">!</span><span class="op" id="8152358">*</span><span class="ident" id="8152359">testExternal</span>&nbsp;<span class="op" id="8152372">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152377">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152392">switch</span>&nbsp;<span class="ident" id="8152399">runtime</span><span class="op" id="8152406">.</span><span class="ident" id="8152407">GOOS</span>&nbsp;<span class="op" id="8152412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152416">case</span>&nbsp;<span class="string" id="8152421">&#34;openbsd&#34;</span><span class="op" id="8152430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152435">if</span>&nbsp;<span class="ident" id="8152438">tt</span><span class="op" id="8152440">.</span><span class="ident" id="8152441">wildcard</span>&nbsp;<span class="op" id="8152450">&amp;&amp;</span>&nbsp;<span class="ident" id="8152453">differentWildcardAddr</span><span class="op" id="8152474">(</span><span class="ident" id="8152475">tt</span><span class="op" id="8152477">.</span><span class="ident" id="8152478">laddr1</span><span class="op" id="8152484">,</span>&nbsp;<span class="ident" id="8152486">tt</span><span class="op" id="8152488">.</span><span class="ident" id="8152489">laddr2</span><span class="op" id="8152495">)</span>&nbsp;<span class="op" id="8152497">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152503">tt</span><span class="op" id="8152505">.</span><span class="ident" id="8152506">xerr</span>&nbsp;<span class="op" id="8152511">=</span>&nbsp;<span class="ident" id="8152513">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152528">l1</span><span class="op" id="8152530">,</span>&nbsp;<span class="ident" id="8152532">port</span>&nbsp;<span class="op" id="8152537">:=</span>&nbsp;<span class="ident" id="8152540">usableListenPort</span><span class="op" id="8152556">(</span><span class="ident" id="8152557">t</span><span class="op" id="8152558">,</span>&nbsp;<span class="ident" id="8152560">tt</span><span class="op" id="8152562">.</span><span class="ident" id="8152563">net1</span><span class="op" id="8152567">,</span>&nbsp;<span class="ident" id="8152569">tt</span><span class="op" id="8152571">.</span><span class="ident" id="8152572">laddr1</span><span class="op" id="8152578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152582">laddr</span>&nbsp;<span class="op" id="8152588">:=</span>&nbsp;<span class="ident" id="8152591">tt</span><span class="op" id="8152593">.</span><span class="ident" id="8152594">laddr1</span>&nbsp;<span class="op" id="8152601">+</span>&nbsp;<span class="string" id="8152603">&#34;:&#34;</span>&nbsp;<span class="op" id="8152607">+</span>&nbsp;<span class="ident" id="8152609">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152616">checkFirstListener</span><span class="op" id="8152634">(</span><span class="ident" id="8152635">t</span><span class="op" id="8152636">,</span>&nbsp;<span class="ident" id="8152638">tt</span><span class="op" id="8152640">.</span><span class="ident" id="8152641">net1</span><span class="op" id="8152645">,</span>&nbsp;<span class="ident" id="8152647">laddr</span><span class="op" id="8152652">,</span>&nbsp;<span class="ident" id="8152654">l1</span><span class="op" id="8152656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152660">laddr</span>&nbsp;<span class="op" id="8152666">=</span>&nbsp;<span class="ident" id="8152668">tt</span><span class="op" id="8152670">.</span><span class="ident" id="8152671">laddr2</span>&nbsp;<span class="op" id="8152678">+</span>&nbsp;<span class="string" id="8152680">&#34;:&#34;</span>&nbsp;<span class="op" id="8152684">+</span>&nbsp;<span class="ident" id="8152686">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152693">l2</span><span class="op" id="8152695">,</span>&nbsp;<span class="ident" id="8152697">err</span>&nbsp;<span class="op" id="8152701">:=</span>&nbsp;<span class="ident" id="8152704">Listen</span><span class="op" id="8152710">(</span><span class="ident" id="8152711">tt</span><span class="op" id="8152713">.</span><span class="ident" id="8152714">net2</span><span class="op" id="8152718">,</span>&nbsp;<span class="ident" id="8152720">laddr</span><span class="op" id="8152725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152729">checkDualStackSecondListener</span><span class="op" id="8152757">(</span><span class="ident" id="8152758">t</span><span class="op" id="8152759">,</span>&nbsp;<span class="ident" id="8152761">tt</span><span class="op" id="8152763">.</span><span class="ident" id="8152764">net2</span><span class="op" id="8152768">,</span>&nbsp;<span class="ident" id="8152770">laddr</span><span class="op" id="8152775">,</span>&nbsp;<span class="ident" id="8152777">tt</span><span class="op" id="8152779">.</span><span class="ident" id="8152780">xerr</span><span class="op" id="8152784">,</span>&nbsp;<span class="ident" id="8152786">err</span><span class="op" id="8152789">,</span>&nbsp;<span class="ident" id="8152791">l2</span><span class="op" id="8152793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152797">l1</span><span class="op" id="8152799">.</span><span class="ident" id="8152800">Close</span><span class="op" id="8152805">(</span><span class="op" id="8152806">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152809">}</span><br>
<span class="lineno"></span><span class="op" id="8152811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8152814">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8152878">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="8152941">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8152977">func</span>&nbsp;<span class="ident" id="8152982">TestDualStackUDPListener</span><span class="op" id="8153006">(</span><span class="ident" id="8153007">t</span>&nbsp;<span class="op" id="8153009">*</span><span class="ident" id="8153010">testing</span><span class="op" id="8153017">.</span><span class="ident" id="8153018">T</span><span class="op" id="8153019">)</span>&nbsp;<span class="op" id="8153021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153024">if</span>&nbsp;<span class="ident" id="8153027">testing</span><span class="op" id="8153034">.</span><span class="ident" id="8153035">Short</span><span class="op" id="8153040">(</span><span class="op" id="8153041">)</span>&nbsp;<span class="op" id="8153043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153047">t</span><span class="op" id="8153048">.</span><span class="ident" id="8153049">Skip</span><span class="op" id="8153053">(</span><span class="string" id="8153054">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8153095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153098">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153101">switch</span>&nbsp;<span class="ident" id="8153108">runtime</span><span class="op" id="8153115">.</span><span class="ident" id="8153116">GOOS</span>&nbsp;<span class="op" id="8153121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153124">case</span>&nbsp;<span class="string" id="8153129">&#34;plan9&#34;</span><span class="op" id="8153136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153140">t</span><span class="op" id="8153141">.</span><span class="ident" id="8153142">Skipf</span><span class="op" id="8153147">(</span><span class="string" id="8153148">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8153169">,</span>&nbsp;<span class="ident" id="8153171">runtime</span><span class="op" id="8153178">.</span><span class="ident" id="8153179">GOOS</span><span class="op" id="8153183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153189">if</span>&nbsp;<span class="op" id="8153192">!</span><span class="ident" id="8153193">supportsIPv6</span>&nbsp;<span class="op" id="8153206">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153210">t</span><span class="op" id="8153211">.</span><span class="ident" id="8153212">Skip</span><span class="op" id="8153216">(</span><span class="string" id="8153217">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8153240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153247">toudpnet</span>&nbsp;<span class="op" id="8153256">:=</span>&nbsp;<span class="keyword" id="8153259">func</span><span class="op" id="8153263">(</span><span class="ident" id="8153264">net</span>&nbsp;<span class="builtintype" id="8153268">string</span><span class="op" id="8153274">)</span>&nbsp;<span class="builtintype" id="8153276">string</span>&nbsp;<span class="op" id="8153283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153287">switch</span>&nbsp;<span class="ident" id="8153294">net</span>&nbsp;<span class="op" id="8153298">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153302">case</span>&nbsp;<span class="string" id="8153307">&#34;tcp&#34;</span><span class="op" id="8153312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153317">return</span>&nbsp;<span class="string" id="8153324">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153332">case</span>&nbsp;<span class="string" id="8153337">&#34;tcp4&#34;</span><span class="op" id="8153343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153348">return</span>&nbsp;<span class="string" id="8153355">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153364">case</span>&nbsp;<span class="string" id="8153369">&#34;tcp6&#34;</span><span class="op" id="8153375">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153380">return</span>&nbsp;<span class="string" id="8153387">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153400">return</span>&nbsp;<span class="string" id="8153407">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153420">for</span>&nbsp;<span class="ident" id="8153424">_</span><span class="op" id="8153425">,</span>&nbsp;<span class="ident" id="8153427">tt</span>&nbsp;<span class="op" id="8153430">:=</span>&nbsp;<span class="keyword" id="8153433">range</span>&nbsp;<span class="ident" id="8153439">dualStackListenerTests</span>&nbsp;<span class="op" id="8153462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153466">if</span>&nbsp;<span class="ident" id="8153469">tt</span><span class="op" id="8153471">.</span><span class="ident" id="8153472">wildcard</span>&nbsp;<span class="op" id="8153481">&amp;&amp;</span>&nbsp;<span class="op" id="8153484">(</span><span class="ident" id="8153485">testing</span><span class="op" id="8153492">.</span><span class="ident" id="8153493">Short</span><span class="op" id="8153498">(</span><span class="op" id="8153499">)</span>&nbsp;<span class="op" id="8153501">||</span>&nbsp;<span class="op" id="8153504">!</span><span class="op" id="8153505">*</span><span class="ident" id="8153506">testExternal</span><span class="op" id="8153518">)</span>&nbsp;<span class="op" id="8153520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153525">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153540">tt</span><span class="op" id="8153542">.</span><span class="ident" id="8153543">net1</span>&nbsp;<span class="op" id="8153548">=</span>&nbsp;<span class="ident" id="8153550">toudpnet</span><span class="op" id="8153558">(</span><span class="ident" id="8153559">tt</span><span class="op" id="8153561">.</span><span class="ident" id="8153562">net1</span><span class="op" id="8153566">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153570">tt</span><span class="op" id="8153572">.</span><span class="ident" id="8153573">net2</span>&nbsp;<span class="op" id="8153578">=</span>&nbsp;<span class="ident" id="8153580">toudpnet</span><span class="op" id="8153588">(</span><span class="ident" id="8153589">tt</span><span class="op" id="8153591">.</span><span class="ident" id="8153592">net2</span><span class="op" id="8153596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153600">switch</span>&nbsp;<span class="ident" id="8153607">runtime</span><span class="op" id="8153614">.</span><span class="ident" id="8153615">GOOS</span>&nbsp;<span class="op" id="8153620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153624">case</span>&nbsp;<span class="string" id="8153629">&#34;openbsd&#34;</span><span class="op" id="8153638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8153643">if</span>&nbsp;<span class="ident" id="8153646">tt</span><span class="op" id="8153648">.</span><span class="ident" id="8153649">wildcard</span>&nbsp;<span class="op" id="8153658">&amp;&amp;</span>&nbsp;<span class="ident" id="8153661">differentWildcardAddr</span><span class="op" id="8153682">(</span><span class="ident" id="8153683">tt</span><span class="op" id="8153685">.</span><span class="ident" id="8153686">laddr1</span><span class="op" id="8153692">,</span>&nbsp;<span class="ident" id="8153694">tt</span><span class="op" id="8153696">.</span><span class="ident" id="8153697">laddr2</span><span class="op" id="8153703">)</span>&nbsp;<span class="op" id="8153705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153711">tt</span><span class="op" id="8153713">.</span><span class="ident" id="8153714">xerr</span>&nbsp;<span class="op" id="8153719">=</span>&nbsp;<span class="ident" id="8153721">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153736">l1</span><span class="op" id="8153738">,</span>&nbsp;<span class="ident" id="8153740">port</span>&nbsp;<span class="op" id="8153745">:=</span>&nbsp;<span class="ident" id="8153748">usableListenPacketPort</span><span class="op" id="8153770">(</span><span class="ident" id="8153771">t</span><span class="op" id="8153772">,</span>&nbsp;<span class="ident" id="8153774">tt</span><span class="op" id="8153776">.</span><span class="ident" id="8153777">net1</span><span class="op" id="8153781">,</span>&nbsp;<span class="ident" id="8153783">tt</span><span class="op" id="8153785">.</span><span class="ident" id="8153786">laddr1</span><span class="op" id="8153792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153796">laddr</span>&nbsp;<span class="op" id="8153802">:=</span>&nbsp;<span class="ident" id="8153805">tt</span><span class="op" id="8153807">.</span><span class="ident" id="8153808">laddr1</span>&nbsp;<span class="op" id="8153815">+</span>&nbsp;<span class="string" id="8153817">&#34;:&#34;</span>&nbsp;<span class="op" id="8153821">+</span>&nbsp;<span class="ident" id="8153823">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153830">checkFirstListener</span><span class="op" id="8153848">(</span><span class="ident" id="8153849">t</span><span class="op" id="8153850">,</span>&nbsp;<span class="ident" id="8153852">tt</span><span class="op" id="8153854">.</span><span class="ident" id="8153855">net1</span><span class="op" id="8153859">,</span>&nbsp;<span class="ident" id="8153861">laddr</span><span class="op" id="8153866">,</span>&nbsp;<span class="ident" id="8153868">l1</span><span class="op" id="8153870">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153874">laddr</span>&nbsp;<span class="op" id="8153880">=</span>&nbsp;<span class="ident" id="8153882">tt</span><span class="op" id="8153884">.</span><span class="ident" id="8153885">laddr2</span>&nbsp;<span class="op" id="8153892">+</span>&nbsp;<span class="string" id="8153894">&#34;:&#34;</span>&nbsp;<span class="op" id="8153898">+</span>&nbsp;<span class="ident" id="8153900">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153907">l2</span><span class="op" id="8153909">,</span>&nbsp;<span class="ident" id="8153911">err</span>&nbsp;<span class="op" id="8153915">:=</span>&nbsp;<span class="ident" id="8153918">ListenPacket</span><span class="op" id="8153930">(</span><span class="ident" id="8153931">tt</span><span class="op" id="8153933">.</span><span class="ident" id="8153934">net2</span><span class="op" id="8153938">,</span>&nbsp;<span class="ident" id="8153940">laddr</span><span class="op" id="8153945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153949">checkDualStackSecondListener</span><span class="op" id="8153977">(</span><span class="ident" id="8153978">t</span><span class="op" id="8153979">,</span>&nbsp;<span class="ident" id="8153981">tt</span><span class="op" id="8153983">.</span><span class="ident" id="8153984">net2</span><span class="op" id="8153988">,</span>&nbsp;<span class="ident" id="8153990">laddr</span><span class="op" id="8153995">,</span>&nbsp;<span class="ident" id="8153997">tt</span><span class="op" id="8153999">.</span><span class="ident" id="8154000">xerr</span><span class="op" id="8154004">,</span>&nbsp;<span class="ident" id="8154006">err</span><span class="op" id="8154009">,</span>&nbsp;<span class="ident" id="8154011">l2</span><span class="op" id="8154013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154017">l1</span><span class="op" id="8154019">.</span><span class="ident" id="8154020">Close</span><span class="op" id="8154025">(</span><span class="op" id="8154026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154029">}</span><br>
<span class="lineno">250</span><span class="op" id="8154031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8154034">func</span>&nbsp;<span class="ident" id="8154039">usableListenPort</span><span class="op" id="8154055">(</span><span class="ident" id="8154056">t</span>&nbsp;<span class="op" id="8154058">*</span><span class="ident" id="8154059">testing</span><span class="op" id="8154066">.</span><span class="ident" id="8154067">T</span><span class="op" id="8154068">,</span>&nbsp;<span class="ident" id="8154070">net</span><span class="op" id="8154073">,</span>&nbsp;<span class="ident" id="8154075">laddr</span>&nbsp;<span class="builtintype" id="8154081">string</span><span class="op" id="8154087">)</span>&nbsp;<span class="op" id="8154089">(</span><span class="ident" id="8154090">l</span>&nbsp;<span class="ident" id="8154092">Listener</span><span class="op" id="8154100">,</span>&nbsp;<span class="ident" id="8154102">port</span>&nbsp;<span class="builtintype" id="8154107">string</span><span class="op" id="8154113">)</span>&nbsp;<span class="op" id="8154115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154118">var</span>&nbsp;<span class="ident" id="8154122">nladdr</span>&nbsp;<span class="builtintype" id="8154129">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154137">var</span>&nbsp;<span class="ident" id="8154141">err</span>&nbsp;<span class="builtintype" id="8154145">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154152">switch</span>&nbsp;<span class="ident" id="8154159">net</span>&nbsp;<span class="op" id="8154163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154166">default</span><span class="op" id="8154173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8154177">panic</span><span class="op" id="8154182">(</span><span class="string" id="8154183">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8154207">+</span>&nbsp;<span class="ident" id="8154209">net</span><span class="op" id="8154212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154215">case</span>&nbsp;<span class="string" id="8154220">&#34;tcp&#34;</span><span class="op" id="8154225">,</span>&nbsp;<span class="string" id="8154227">&#34;tcp4&#34;</span><span class="op" id="8154233">,</span>&nbsp;<span class="string" id="8154235">&#34;tcp6&#34;</span><span class="op" id="8154241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154245">l</span><span class="op" id="8154246">,</span>&nbsp;<span class="ident" id="8154248">err</span>&nbsp;<span class="op" id="8154252">=</span>&nbsp;<span class="ident" id="8154254">Listen</span><span class="op" id="8154260">(</span><span class="ident" id="8154261">net</span><span class="op" id="8154264">,</span>&nbsp;<span class="ident" id="8154266">laddr</span><span class="op" id="8154271">+</span><span class="string" id="8154272">&#34;:0&#34;</span><span class="op" id="8154276">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154280">if</span>&nbsp;<span class="ident" id="8154283">err</span>&nbsp;<span class="op" id="8154287">!=</span>&nbsp;<span class="ident" id="8154290">nil</span>&nbsp;<span class="op" id="8154294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154299">t</span><span class="op" id="8154300">.</span><span class="ident" id="8154301">Fatalf</span><span class="op" id="8154307">(</span><span class="string" id="8154308">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8154341">,</span>&nbsp;<span class="ident" id="8154343">net</span><span class="op" id="8154346">,</span>&nbsp;<span class="ident" id="8154348">laddr</span><span class="op" id="8154353">,</span>&nbsp;<span class="ident" id="8154355">err</span><span class="op" id="8154358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154366">nladdr</span>&nbsp;<span class="op" id="8154373">=</span>&nbsp;<span class="ident" id="8154375">l</span><span class="op" id="8154376">.</span><span class="op" id="8154377">(</span><span class="op" id="8154378">*</span><span class="ident" id="8154379">TCPListener</span><span class="op" id="8154390">)</span><span class="op" id="8154391">.</span><span class="ident" id="8154392">Addr</span><span class="op" id="8154396">(</span><span class="op" id="8154397">)</span><span class="op" id="8154398">.</span><span class="ident" id="8154399">String</span><span class="op" id="8154405">(</span><span class="op" id="8154406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154409">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154412">_</span><span class="op" id="8154413">,</span>&nbsp;<span class="ident" id="8154415">port</span><span class="op" id="8154419">,</span>&nbsp;<span class="ident" id="8154421">err</span>&nbsp;<span class="op" id="8154425">=</span>&nbsp;<span class="ident" id="8154427">SplitHostPort</span><span class="op" id="8154440">(</span><span class="ident" id="8154441">nladdr</span><span class="op" id="8154447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154450">if</span>&nbsp;<span class="ident" id="8154453">err</span>&nbsp;<span class="op" id="8154457">!=</span>&nbsp;<span class="ident" id="8154460">nil</span>&nbsp;<span class="op" id="8154464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154468">t</span><span class="op" id="8154469">.</span><span class="ident" id="8154470">Fatalf</span><span class="op" id="8154476">(</span><span class="string" id="8154477">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8154503">,</span>&nbsp;<span class="ident" id="8154505">err</span><span class="op" id="8154508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154514">return</span>&nbsp;<span class="ident" id="8154521">l</span><span class="op" id="8154522">,</span>&nbsp;<span class="ident" id="8154524">port</span><br>
<span class="lineno">270</span><span class="op" id="8154529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8154532">func</span>&nbsp;<span class="ident" id="8154537">usableListenPacketPort</span><span class="op" id="8154559">(</span><span class="ident" id="8154560">t</span>&nbsp;<span class="op" id="8154562">*</span><span class="ident" id="8154563">testing</span><span class="op" id="8154570">.</span><span class="ident" id="8154571">T</span><span class="op" id="8154572">,</span>&nbsp;<span class="ident" id="8154574">net</span><span class="op" id="8154577">,</span>&nbsp;<span class="ident" id="8154579">laddr</span>&nbsp;<span class="builtintype" id="8154585">string</span><span class="op" id="8154591">)</span>&nbsp;<span class="op" id="8154593">(</span><span class="ident" id="8154594">l</span>&nbsp;<span class="ident" id="8154596">PacketConn</span><span class="op" id="8154606">,</span>&nbsp;<span class="ident" id="8154608">port</span>&nbsp;<span class="builtintype" id="8154613">string</span><span class="op" id="8154619">)</span>&nbsp;<span class="op" id="8154621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154624">var</span>&nbsp;<span class="ident" id="8154628">nladdr</span>&nbsp;<span class="builtintype" id="8154635">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154643">var</span>&nbsp;<span class="ident" id="8154647">err</span>&nbsp;<span class="builtintype" id="8154651">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154658">switch</span>&nbsp;<span class="ident" id="8154665">net</span>&nbsp;<span class="op" id="8154669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154672">default</span><span class="op" id="8154679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8154683">panic</span><span class="op" id="8154688">(</span><span class="string" id="8154689">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8154719">+</span>&nbsp;<span class="ident" id="8154721">net</span><span class="op" id="8154724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154727">case</span>&nbsp;<span class="string" id="8154732">&#34;udp&#34;</span><span class="op" id="8154737">,</span>&nbsp;<span class="string" id="8154739">&#34;udp4&#34;</span><span class="op" id="8154745">,</span>&nbsp;<span class="string" id="8154747">&#34;udp6&#34;</span><span class="op" id="8154753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154757">l</span><span class="op" id="8154758">,</span>&nbsp;<span class="ident" id="8154760">err</span>&nbsp;<span class="op" id="8154764">=</span>&nbsp;<span class="ident" id="8154766">ListenPacket</span><span class="op" id="8154778">(</span><span class="ident" id="8154779">net</span><span class="op" id="8154782">,</span>&nbsp;<span class="ident" id="8154784">laddr</span><span class="op" id="8154789">+</span><span class="string" id="8154790">&#34;:0&#34;</span><span class="op" id="8154794">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154798">if</span>&nbsp;<span class="ident" id="8154801">err</span>&nbsp;<span class="op" id="8154805">!=</span>&nbsp;<span class="ident" id="8154808">nil</span>&nbsp;<span class="op" id="8154812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154817">t</span><span class="op" id="8154818">.</span><span class="ident" id="8154819">Fatalf</span><span class="op" id="8154825">(</span><span class="string" id="8154826">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8154865">,</span>&nbsp;<span class="ident" id="8154867">net</span><span class="op" id="8154870">,</span>&nbsp;<span class="ident" id="8154872">laddr</span><span class="op" id="8154877">,</span>&nbsp;<span class="ident" id="8154879">err</span><span class="op" id="8154882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154890">nladdr</span>&nbsp;<span class="op" id="8154897">=</span>&nbsp;<span class="ident" id="8154899">l</span><span class="op" id="8154900">.</span><span class="op" id="8154901">(</span><span class="op" id="8154902">*</span><span class="ident" id="8154903">UDPConn</span><span class="op" id="8154910">)</span><span class="op" id="8154911">.</span><span class="ident" id="8154912">LocalAddr</span><span class="op" id="8154921">(</span><span class="op" id="8154922">)</span><span class="op" id="8154923">.</span><span class="ident" id="8154924">String</span><span class="op" id="8154930">(</span><span class="op" id="8154931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8154934">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154937">_</span><span class="op" id="8154938">,</span>&nbsp;<span class="ident" id="8154940">port</span><span class="op" id="8154944">,</span>&nbsp;<span class="ident" id="8154946">err</span>&nbsp;<span class="op" id="8154950">=</span>&nbsp;<span class="ident" id="8154952">SplitHostPort</span><span class="op" id="8154965">(</span><span class="ident" id="8154966">nladdr</span><span class="op" id="8154972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8154975">if</span>&nbsp;<span class="ident" id="8154978">err</span>&nbsp;<span class="op" id="8154982">!=</span>&nbsp;<span class="ident" id="8154985">nil</span>&nbsp;<span class="op" id="8154989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8154993">t</span><span class="op" id="8154994">.</span><span class="ident" id="8154995">Fatalf</span><span class="op" id="8155001">(</span><span class="string" id="8155002">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8155028">,</span>&nbsp;<span class="ident" id="8155030">err</span><span class="op" id="8155033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8155036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155039">return</span>&nbsp;<span class="ident" id="8155046">l</span><span class="op" id="8155047">,</span>&nbsp;<span class="ident" id="8155049">port</span><br>
<span class="lineno">290</span><span class="op" id="8155054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8155057">func</span>&nbsp;<span class="ident" id="8155062">differentWildcardAddr</span><span class="op" id="8155083">(</span><span class="ident" id="8155084">i</span><span class="op" id="8155085">,</span>&nbsp;<span class="ident" id="8155087">j</span>&nbsp;<span class="builtintype" id="8155089">string</span><span class="op" id="8155095">)</span>&nbsp;<span class="builtintype" id="8155097">bool</span>&nbsp;<span class="op" id="8155102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155105">if</span>&nbsp;<span class="op" id="8155108">(</span><span class="ident" id="8155109">i</span>&nbsp;<span class="op" id="8155111">==</span>&nbsp;<span class="string" id="8155114">&#34;&#34;</span>&nbsp;<span class="op" id="8155117">||</span>&nbsp;<span class="ident" id="8155120">i</span>&nbsp;<span class="op" id="8155122">==</span>&nbsp;<span class="string" id="8155125">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8155135">||</span>&nbsp;<span class="ident" id="8155138">i</span>&nbsp;<span class="op" id="8155140">==</span>&nbsp;<span class="string" id="8155143">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8155159">)</span>&nbsp;<span class="op" id="8155161">&amp;&amp;</span>&nbsp;<span class="op" id="8155164">(</span><span class="ident" id="8155165">j</span>&nbsp;<span class="op" id="8155167">==</span>&nbsp;<span class="string" id="8155170">&#34;&#34;</span>&nbsp;<span class="op" id="8155173">||</span>&nbsp;<span class="ident" id="8155176">j</span>&nbsp;<span class="op" id="8155178">==</span>&nbsp;<span class="string" id="8155181">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8155191">||</span>&nbsp;<span class="ident" id="8155194">j</span>&nbsp;<span class="op" id="8155196">==</span>&nbsp;<span class="string" id="8155199">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8155215">)</span>&nbsp;<span class="op" id="8155217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155221">return</span>&nbsp;<span class="builtintype" id="8155228">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8155235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155238">if</span>&nbsp;<span class="ident" id="8155241">i</span>&nbsp;<span class="op" id="8155243">==</span>&nbsp;<span class="string" id="8155246">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8155253">&amp;&amp;</span>&nbsp;<span class="ident" id="8155256">j</span>&nbsp;<span class="op" id="8155258">==</span>&nbsp;<span class="string" id="8155261">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8155268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155272">return</span>&nbsp;<span class="builtintype" id="8155279">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8155286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155289">return</span>&nbsp;<span class="builtintype" id="8155296">true</span><br>
<span class="lineno">300</span><span class="op" id="8155301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8155304">func</span>&nbsp;<span class="ident" id="8155309">checkFirstListener</span><span class="op" id="8155327">(</span><span class="ident" id="8155328">t</span>&nbsp;<span class="op" id="8155330">*</span><span class="ident" id="8155331">testing</span><span class="op" id="8155338">.</span><span class="ident" id="8155339">T</span><span class="op" id="8155340">,</span>&nbsp;<span class="ident" id="8155342">net</span><span class="op" id="8155345">,</span>&nbsp;<span class="ident" id="8155347">laddr</span>&nbsp;<span class="builtintype" id="8155353">string</span><span class="op" id="8155359">,</span>&nbsp;<span class="ident" id="8155361">l</span>&nbsp;<span class="keyword" id="8155363">interface</span><span class="op" id="8155372">{</span><span class="op" id="8155373">}</span><span class="op" id="8155374">)</span>&nbsp;<span class="op" id="8155376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155379">switch</span>&nbsp;<span class="ident" id="8155386">net</span>&nbsp;<span class="op" id="8155390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155393">case</span>&nbsp;<span class="string" id="8155398">&#34;tcp&#34;</span><span class="op" id="8155403">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155407">fd</span>&nbsp;<span class="op" id="8155410">:=</span>&nbsp;<span class="ident" id="8155413">l</span><span class="op" id="8155414">.</span><span class="op" id="8155415">(</span><span class="op" id="8155416">*</span><span class="ident" id="8155417">TCPListener</span><span class="op" id="8155428">)</span><span class="op" id="8155429">.</span><span class="ident" id="8155430">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155435">checkDualStackAddrFamily</span><span class="op" id="8155459">(</span><span class="ident" id="8155460">t</span><span class="op" id="8155461">,</span>&nbsp;<span class="ident" id="8155463">net</span><span class="op" id="8155466">,</span>&nbsp;<span class="ident" id="8155468">laddr</span><span class="op" id="8155473">,</span>&nbsp;<span class="ident" id="8155475">fd</span><span class="op" id="8155477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155480">case</span>&nbsp;<span class="string" id="8155485">&#34;tcp4&#34;</span><span class="op" id="8155491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155495">fd</span>&nbsp;<span class="op" id="8155498">:=</span>&nbsp;<span class="ident" id="8155501">l</span><span class="op" id="8155502">.</span><span class="op" id="8155503">(</span><span class="op" id="8155504">*</span><span class="ident" id="8155505">TCPListener</span><span class="op" id="8155516">)</span><span class="op" id="8155517">.</span><span class="ident" id="8155518">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155523">if</span>&nbsp;<span class="ident" id="8155526">fd</span><span class="op" id="8155528">.</span><span class="ident" id="8155529">family</span>&nbsp;<span class="op" id="8155536">!=</span>&nbsp;<span class="ident" id="8155539">syscall</span><span class="op" id="8155546">.</span><span class="ident" id="8155547">AF_INET</span>&nbsp;<span class="op" id="8155555">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155560">t</span><span class="op" id="8155561">.</span><span class="ident" id="8155562">Fatalf</span><span class="op" id="8155568">(</span><span class="string" id="8155569">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8155630">,</span>&nbsp;<span class="ident" id="8155632">net</span><span class="op" id="8155635">,</span>&nbsp;<span class="ident" id="8155637">laddr</span><span class="op" id="8155642">,</span>&nbsp;<span class="ident" id="8155644">fd</span><span class="op" id="8155646">.</span><span class="ident" id="8155647">family</span><span class="op" id="8155653">,</span>&nbsp;<span class="ident" id="8155655">syscall</span><span class="op" id="8155662">.</span><span class="ident" id="8155663">AF_INET</span><span class="op" id="8155670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8155674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155677">case</span>&nbsp;<span class="string" id="8155682">&#34;tcp6&#34;</span><span class="op" id="8155688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155692">fd</span>&nbsp;<span class="op" id="8155695">:=</span>&nbsp;<span class="ident" id="8155698">l</span><span class="op" id="8155699">.</span><span class="op" id="8155700">(</span><span class="op" id="8155701">*</span><span class="ident" id="8155702">TCPListener</span><span class="op" id="8155713">)</span><span class="op" id="8155714">.</span><span class="ident" id="8155715">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155720">if</span>&nbsp;<span class="ident" id="8155723">fd</span><span class="op" id="8155725">.</span><span class="ident" id="8155726">family</span>&nbsp;<span class="op" id="8155733">!=</span>&nbsp;<span class="ident" id="8155736">syscall</span><span class="op" id="8155743">.</span><span class="ident" id="8155744">AF_INET6</span>&nbsp;<span class="op" id="8155753">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155758">t</span><span class="op" id="8155759">.</span><span class="ident" id="8155760">Fatalf</span><span class="op" id="8155766">(</span><span class="string" id="8155767">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8155828">,</span>&nbsp;<span class="ident" id="8155830">net</span><span class="op" id="8155833">,</span>&nbsp;<span class="ident" id="8155835">laddr</span><span class="op" id="8155840">,</span>&nbsp;<span class="ident" id="8155842">fd</span><span class="op" id="8155844">.</span><span class="ident" id="8155845">family</span><span class="op" id="8155851">,</span>&nbsp;<span class="ident" id="8155853">syscall</span><span class="op" id="8155860">.</span><span class="ident" id="8155861">AF_INET6</span><span class="op" id="8155869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8155873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155876">case</span>&nbsp;<span class="string" id="8155881">&#34;udp&#34;</span><span class="op" id="8155886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155890">fd</span>&nbsp;<span class="op" id="8155893">:=</span>&nbsp;<span class="ident" id="8155896">l</span><span class="op" id="8155897">.</span><span class="op" id="8155898">(</span><span class="op" id="8155899">*</span><span class="ident" id="8155900">UDPConn</span><span class="op" id="8155907">)</span><span class="op" id="8155908">.</span><span class="ident" id="8155909">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155914">checkDualStackAddrFamily</span><span class="op" id="8155938">(</span><span class="ident" id="8155939">t</span><span class="op" id="8155940">,</span>&nbsp;<span class="ident" id="8155942">net</span><span class="op" id="8155945">,</span>&nbsp;<span class="ident" id="8155947">laddr</span><span class="op" id="8155952">,</span>&nbsp;<span class="ident" id="8155954">fd</span><span class="op" id="8155956">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155959">case</span>&nbsp;<span class="string" id="8155964">&#34;udp4&#34;</span><span class="op" id="8155970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8155974">fd</span>&nbsp;<span class="op" id="8155977">:=</span>&nbsp;<span class="ident" id="8155980">l</span><span class="op" id="8155981">.</span><span class="op" id="8155982">(</span><span class="op" id="8155983">*</span><span class="ident" id="8155984">UDPConn</span><span class="op" id="8155991">)</span><span class="op" id="8155992">.</span><span class="ident" id="8155993">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8155998">if</span>&nbsp;<span class="ident" id="8156001">fd</span><span class="op" id="8156003">.</span><span class="ident" id="8156004">family</span>&nbsp;<span class="op" id="8156011">!=</span>&nbsp;<span class="ident" id="8156014">syscall</span><span class="op" id="8156021">.</span><span class="ident" id="8156022">AF_INET</span>&nbsp;<span class="op" id="8156030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156035">t</span><span class="op" id="8156036">.</span><span class="ident" id="8156037">Fatalf</span><span class="op" id="8156043">(</span><span class="string" id="8156044">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8156111">,</span>&nbsp;<span class="ident" id="8156113">net</span><span class="op" id="8156116">,</span>&nbsp;<span class="ident" id="8156118">laddr</span><span class="op" id="8156123">,</span>&nbsp;<span class="ident" id="8156125">fd</span><span class="op" id="8156127">.</span><span class="ident" id="8156128">family</span><span class="op" id="8156134">,</span>&nbsp;<span class="ident" id="8156136">syscall</span><span class="op" id="8156143">.</span><span class="ident" id="8156144">AF_INET</span><span class="op" id="8156151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156155">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156158">case</span>&nbsp;<span class="string" id="8156163">&#34;udp6&#34;</span><span class="op" id="8156169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156173">fd</span>&nbsp;<span class="op" id="8156176">:=</span>&nbsp;<span class="ident" id="8156179">l</span><span class="op" id="8156180">.</span><span class="op" id="8156181">(</span><span class="op" id="8156182">*</span><span class="ident" id="8156183">UDPConn</span><span class="op" id="8156190">)</span><span class="op" id="8156191">.</span><span class="ident" id="8156192">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156197">if</span>&nbsp;<span class="ident" id="8156200">fd</span><span class="op" id="8156202">.</span><span class="ident" id="8156203">family</span>&nbsp;<span class="op" id="8156210">!=</span>&nbsp;<span class="ident" id="8156213">syscall</span><span class="op" id="8156220">.</span><span class="ident" id="8156221">AF_INET6</span>&nbsp;<span class="op" id="8156230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156235">t</span><span class="op" id="8156236">.</span><span class="ident" id="8156237">Fatalf</span><span class="op" id="8156243">(</span><span class="string" id="8156244">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8156311">,</span>&nbsp;<span class="ident" id="8156313">net</span><span class="op" id="8156316">,</span>&nbsp;<span class="ident" id="8156318">laddr</span><span class="op" id="8156323">,</span>&nbsp;<span class="ident" id="8156325">fd</span><span class="op" id="8156327">.</span><span class="ident" id="8156328">family</span><span class="op" id="8156334">,</span>&nbsp;<span class="ident" id="8156336">syscall</span><span class="op" id="8156343">.</span><span class="ident" id="8156344">AF_INET6</span><span class="op" id="8156352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156356">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156359">default</span><span class="op" id="8156366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156370">t</span><span class="op" id="8156371">.</span><span class="ident" id="8156372">Fatalf</span><span class="op" id="8156378">(</span><span class="string" id="8156379">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8156403">,</span>&nbsp;<span class="ident" id="8156405">net</span><span class="op" id="8156408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156411">}</span><br>
<span class="lineno"></span><span class="op" id="8156413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="8156416">func</span>&nbsp;<span class="ident" id="8156421">checkSecondListener</span><span class="op" id="8156440">(</span><span class="ident" id="8156441">t</span>&nbsp;<span class="op" id="8156443">*</span><span class="ident" id="8156444">testing</span><span class="op" id="8156451">.</span><span class="ident" id="8156452">T</span><span class="op" id="8156453">,</span>&nbsp;<span class="ident" id="8156455">net</span><span class="op" id="8156458">,</span>&nbsp;<span class="ident" id="8156460">laddr</span>&nbsp;<span class="builtintype" id="8156466">string</span><span class="op" id="8156472">,</span>&nbsp;<span class="ident" id="8156474">err</span>&nbsp;<span class="builtintype" id="8156478">error</span><span class="op" id="8156483">,</span>&nbsp;<span class="ident" id="8156485">l</span>&nbsp;<span class="keyword" id="8156487">interface</span><span class="op" id="8156496">{</span><span class="op" id="8156497">}</span><span class="op" id="8156498">)</span>&nbsp;<span class="op" id="8156500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156503">switch</span>&nbsp;<span class="ident" id="8156510">net</span>&nbsp;<span class="op" id="8156514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156517">case</span>&nbsp;<span class="string" id="8156522">&#34;tcp&#34;</span><span class="op" id="8156527">,</span>&nbsp;<span class="string" id="8156529">&#34;tcp4&#34;</span><span class="op" id="8156535">,</span>&nbsp;<span class="string" id="8156537">&#34;tcp6&#34;</span><span class="op" id="8156543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156547">if</span>&nbsp;<span class="ident" id="8156550">err</span>&nbsp;<span class="op" id="8156554">==</span>&nbsp;<span class="ident" id="8156557">nil</span>&nbsp;<span class="op" id="8156561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156566">l</span><span class="op" id="8156567">.</span><span class="op" id="8156568">(</span><span class="op" id="8156569">*</span><span class="ident" id="8156570">TCPListener</span><span class="op" id="8156581">)</span><span class="op" id="8156582">.</span><span class="ident" id="8156583">Close</span><span class="op" id="8156588">(</span><span class="op" id="8156589">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156594">t</span><span class="op" id="8156595">.</span><span class="ident" id="8156596">Fatalf</span><span class="op" id="8156602">(</span><span class="string" id="8156603">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8156638">,</span>&nbsp;<span class="ident" id="8156640">net</span><span class="op" id="8156643">,</span>&nbsp;<span class="ident" id="8156645">laddr</span><span class="op" id="8156650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156657">case</span>&nbsp;<span class="string" id="8156662">&#34;udp&#34;</span><span class="op" id="8156667">,</span>&nbsp;<span class="string" id="8156669">&#34;udp4&#34;</span><span class="op" id="8156675">,</span>&nbsp;<span class="string" id="8156677">&#34;udp6&#34;</span><span class="op" id="8156683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156687">if</span>&nbsp;<span class="ident" id="8156690">err</span>&nbsp;<span class="op" id="8156694">==</span>&nbsp;<span class="ident" id="8156697">nil</span>&nbsp;<span class="op" id="8156701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156706">l</span><span class="op" id="8156707">.</span><span class="op" id="8156708">(</span><span class="op" id="8156709">*</span><span class="ident" id="8156710">UDPConn</span><span class="op" id="8156717">)</span><span class="op" id="8156718">.</span><span class="ident" id="8156719">Close</span><span class="op" id="8156724">(</span><span class="op" id="8156725">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156730">t</span><span class="op" id="8156731">.</span><span class="ident" id="8156732">Fatalf</span><span class="op" id="8156738">(</span><span class="string" id="8156739">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8156780">,</span>&nbsp;<span class="ident" id="8156782">net</span><span class="op" id="8156785">,</span>&nbsp;<span class="ident" id="8156787">laddr</span><span class="op" id="8156792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156799">default</span><span class="op" id="8156806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156810">t</span><span class="op" id="8156811">.</span><span class="ident" id="8156812">Fatalf</span><span class="op" id="8156818">(</span><span class="string" id="8156819">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8156843">,</span>&nbsp;<span class="ident" id="8156845">net</span><span class="op" id="8156848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156851">}</span><br>
<span class="lineno">350</span><span class="op" id="8156853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8156856">func</span>&nbsp;<span class="ident" id="8156861">checkDualStackSecondListener</span><span class="op" id="8156889">(</span><span class="ident" id="8156890">t</span>&nbsp;<span class="op" id="8156892">*</span><span class="ident" id="8156893">testing</span><span class="op" id="8156900">.</span><span class="ident" id="8156901">T</span><span class="op" id="8156902">,</span>&nbsp;<span class="ident" id="8156904">net</span><span class="op" id="8156907">,</span>&nbsp;<span class="ident" id="8156909">laddr</span>&nbsp;<span class="builtintype" id="8156915">string</span><span class="op" id="8156921">,</span>&nbsp;<span class="ident" id="8156923">xerr</span><span class="op" id="8156927">,</span>&nbsp;<span class="ident" id="8156929">err</span>&nbsp;<span class="builtintype" id="8156933">error</span><span class="op" id="8156938">,</span>&nbsp;<span class="ident" id="8156940">l</span>&nbsp;<span class="keyword" id="8156942">interface</span><span class="op" id="8156951">{</span><span class="op" id="8156952">}</span><span class="op" id="8156953">)</span>&nbsp;<span class="op" id="8156955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156958">switch</span>&nbsp;<span class="ident" id="8156965">net</span>&nbsp;<span class="op" id="8156969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156972">case</span>&nbsp;<span class="string" id="8156977">&#34;tcp&#34;</span><span class="op" id="8156982">,</span>&nbsp;<span class="string" id="8156984">&#34;tcp4&#34;</span><span class="op" id="8156990">,</span>&nbsp;<span class="string" id="8156992">&#34;tcp6&#34;</span><span class="op" id="8156998">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157002">if</span>&nbsp;<span class="ident" id="8157005">xerr</span>&nbsp;<span class="op" id="8157010">==</span>&nbsp;<span class="ident" id="8157013">nil</span>&nbsp;<span class="op" id="8157017">&amp;&amp;</span>&nbsp;<span class="ident" id="8157020">err</span>&nbsp;<span class="op" id="8157024">!=</span>&nbsp;<span class="ident" id="8157027">nil</span>&nbsp;<span class="op" id="8157031">||</span>&nbsp;<span class="ident" id="8157034">xerr</span>&nbsp;<span class="op" id="8157039">!=</span>&nbsp;<span class="ident" id="8157042">nil</span>&nbsp;<span class="op" id="8157046">&amp;&amp;</span>&nbsp;<span class="ident" id="8157049">err</span>&nbsp;<span class="op" id="8157053">==</span>&nbsp;<span class="ident" id="8157056">nil</span>&nbsp;<span class="op" id="8157060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157065">t</span><span class="op" id="8157066">.</span><span class="ident" id="8157067">Fatalf</span><span class="op" id="8157073">(</span><span class="string" id="8157074">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8157121">,</span>&nbsp;<span class="ident" id="8157123">net</span><span class="op" id="8157126">,</span>&nbsp;<span class="ident" id="8157128">laddr</span><span class="op" id="8157133">,</span>&nbsp;<span class="ident" id="8157135">err</span><span class="op" id="8157138">,</span>&nbsp;<span class="ident" id="8157140">xerr</span><span class="op" id="8157144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157152">if</span>&nbsp;<span class="ident" id="8157155">err</span>&nbsp;<span class="op" id="8157159">==</span>&nbsp;<span class="ident" id="8157162">nil</span>&nbsp;<span class="op" id="8157166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157171">l</span><span class="op" id="8157172">.</span><span class="op" id="8157173">(</span><span class="op" id="8157174">*</span><span class="ident" id="8157175">TCPListener</span><span class="op" id="8157186">)</span><span class="op" id="8157187">.</span><span class="ident" id="8157188">Close</span><span class="op" id="8157193">(</span><span class="op" id="8157194">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157201">case</span>&nbsp;<span class="string" id="8157206">&#34;udp&#34;</span><span class="op" id="8157211">,</span>&nbsp;<span class="string" id="8157213">&#34;udp4&#34;</span><span class="op" id="8157219">,</span>&nbsp;<span class="string" id="8157221">&#34;udp6&#34;</span><span class="op" id="8157227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157231">if</span>&nbsp;<span class="ident" id="8157234">xerr</span>&nbsp;<span class="op" id="8157239">==</span>&nbsp;<span class="ident" id="8157242">nil</span>&nbsp;<span class="op" id="8157246">&amp;&amp;</span>&nbsp;<span class="ident" id="8157249">err</span>&nbsp;<span class="op" id="8157253">!=</span>&nbsp;<span class="ident" id="8157256">nil</span>&nbsp;<span class="op" id="8157260">||</span>&nbsp;<span class="ident" id="8157263">xerr</span>&nbsp;<span class="op" id="8157268">!=</span>&nbsp;<span class="ident" id="8157271">nil</span>&nbsp;<span class="op" id="8157275">&amp;&amp;</span>&nbsp;<span class="ident" id="8157278">err</span>&nbsp;<span class="op" id="8157282">==</span>&nbsp;<span class="ident" id="8157285">nil</span>&nbsp;<span class="op" id="8157289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157294">t</span><span class="op" id="8157295">.</span><span class="ident" id="8157296">Fatalf</span><span class="op" id="8157302">(</span><span class="string" id="8157303">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8157356">,</span>&nbsp;<span class="ident" id="8157358">net</span><span class="op" id="8157361">,</span>&nbsp;<span class="ident" id="8157363">laddr</span><span class="op" id="8157368">,</span>&nbsp;<span class="ident" id="8157370">err</span><span class="op" id="8157373">,</span>&nbsp;<span class="ident" id="8157375">xerr</span><span class="op" id="8157379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157383">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157387">if</span>&nbsp;<span class="ident" id="8157390">err</span>&nbsp;<span class="op" id="8157394">==</span>&nbsp;<span class="ident" id="8157397">nil</span>&nbsp;<span class="op" id="8157401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157406">l</span><span class="op" id="8157407">.</span><span class="op" id="8157408">(</span><span class="op" id="8157409">*</span><span class="ident" id="8157410">UDPConn</span><span class="op" id="8157417">)</span><span class="op" id="8157418">.</span><span class="ident" id="8157419">Close</span><span class="op" id="8157424">(</span><span class="op" id="8157425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157432">default</span><span class="op" id="8157439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157443">t</span><span class="op" id="8157444">.</span><span class="ident" id="8157445">Fatalf</span><span class="op" id="8157451">(</span><span class="string" id="8157452">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8157476">,</span>&nbsp;<span class="ident" id="8157478">net</span><span class="op" id="8157481">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157484">}</span><br>
<span class="lineno"></span><span class="op" id="8157486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8157489">func</span>&nbsp;<span class="ident" id="8157494">checkDualStackAddrFamily</span><span class="op" id="8157518">(</span><span class="ident" id="8157519">t</span>&nbsp;<span class="op" id="8157521">*</span><span class="ident" id="8157522">testing</span><span class="op" id="8157529">.</span><span class="ident" id="8157530">T</span><span class="op" id="8157531">,</span>&nbsp;<span class="ident" id="8157533">net</span><span class="op" id="8157536">,</span>&nbsp;<span class="ident" id="8157538">laddr</span>&nbsp;<span class="builtintype" id="8157544">string</span><span class="op" id="8157550">,</span>&nbsp;<span class="ident" id="8157552">fd</span>&nbsp;<span class="op" id="8157555">*</span><span class="ident" id="8157556">netFD</span><span class="op" id="8157561">)</span>&nbsp;<span class="op" id="8157563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157566">switch</span>&nbsp;<span class="ident" id="8157573">a</span>&nbsp;<span class="op" id="8157575">:=</span>&nbsp;<span class="ident" id="8157578">fd</span><span class="op" id="8157580">.</span><span class="ident" id="8157581">laddr</span><span class="op" id="8157586">.</span><span class="op" id="8157587">(</span><span class="keyword" id="8157588">type</span><span class="op" id="8157592">)</span>&nbsp;<span class="op" id="8157594">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157597">case</span>&nbsp;<span class="op" id="8157602">*</span><span class="ident" id="8157603">TCPAddr</span><span class="op" id="8157610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8157614">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8157670">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8157723">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8157780">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157802">if</span>&nbsp;<span class="ident" id="8157805">supportsIPv4map</span>&nbsp;<span class="op" id="8157821">&amp;&amp;</span>&nbsp;<span class="ident" id="8157824">fd</span><span class="op" id="8157826">.</span><span class="ident" id="8157827">laddr</span><span class="op" id="8157832">.</span><span class="op" id="8157833">(</span><span class="op" id="8157834">*</span><span class="ident" id="8157835">TCPAddr</span><span class="op" id="8157842">)</span><span class="op" id="8157843">.</span><span class="ident" id="8157844">isWildcard</span><span class="op" id="8157854">(</span><span class="op" id="8157855">)</span>&nbsp;<span class="op" id="8157857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157862">if</span>&nbsp;<span class="ident" id="8157865">fd</span><span class="op" id="8157867">.</span><span class="ident" id="8157868">family</span>&nbsp;<span class="op" id="8157875">!=</span>&nbsp;<span class="ident" id="8157878">syscall</span><span class="op" id="8157885">.</span><span class="ident" id="8157886">AF_INET6</span>&nbsp;<span class="op" id="8157895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157901">t</span><span class="op" id="8157902">.</span><span class="ident" id="8157903">Fatalf</span><span class="op" id="8157909">(</span><span class="string" id="8157910">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8157965">,</span>&nbsp;<span class="ident" id="8157967">net</span><span class="op" id="8157970">,</span>&nbsp;<span class="ident" id="8157972">laddr</span><span class="op" id="8157977">,</span>&nbsp;<span class="ident" id="8157979">fd</span><span class="op" id="8157981">.</span><span class="ident" id="8157982">family</span><span class="op" id="8157988">,</span>&nbsp;<span class="ident" id="8157990">syscall</span><span class="op" id="8157997">.</span><span class="ident" id="8157998">AF_INET6</span><span class="op" id="8158006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158015">}</span>&nbsp;<span class="keyword" id="8158017">else</span>&nbsp;<span class="op" id="8158022">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158027">if</span>&nbsp;<span class="ident" id="8158030">fd</span><span class="op" id="8158032">.</span><span class="ident" id="8158033">family</span>&nbsp;<span class="op" id="8158040">!=</span>&nbsp;<span class="ident" id="8158043">a</span><span class="op" id="8158044">.</span><span class="ident" id="8158045">family</span><span class="op" id="8158051">(</span><span class="op" id="8158052">)</span>&nbsp;<span class="op" id="8158054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158060">t</span><span class="op" id="8158061">.</span><span class="ident" id="8158062">Fatalf</span><span class="op" id="8158068">(</span><span class="string" id="8158069">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8158124">,</span>&nbsp;<span class="ident" id="8158126">net</span><span class="op" id="8158129">,</span>&nbsp;<span class="ident" id="8158131">laddr</span><span class="op" id="8158136">,</span>&nbsp;<span class="ident" id="8158138">fd</span><span class="op" id="8158140">.</span><span class="ident" id="8158141">family</span><span class="op" id="8158147">,</span>&nbsp;<span class="ident" id="8158149">a</span><span class="op" id="8158150">.</span><span class="ident" id="8158151">family</span><span class="op" id="8158157">(</span><span class="op" id="8158158">)</span><span class="op" id="8158159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158171">case</span>&nbsp;<span class="op" id="8158176">*</span><span class="ident" id="8158177">UDPAddr</span><span class="op" id="8158184">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8158188">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8158244">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8158297">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8158354">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158376">if</span>&nbsp;<span class="ident" id="8158379">supportsIPv4map</span>&nbsp;<span class="op" id="8158395">&amp;&amp;</span>&nbsp;<span class="ident" id="8158398">fd</span><span class="op" id="8158400">.</span><span class="ident" id="8158401">laddr</span><span class="op" id="8158406">.</span><span class="op" id="8158407">(</span><span class="op" id="8158408">*</span><span class="ident" id="8158409">UDPAddr</span><span class="op" id="8158416">)</span><span class="op" id="8158417">.</span><span class="ident" id="8158418">isWildcard</span><span class="op" id="8158428">(</span><span class="op" id="8158429">)</span>&nbsp;<span class="op" id="8158431">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158436">if</span>&nbsp;<span class="ident" id="8158439">fd</span><span class="op" id="8158441">.</span><span class="ident" id="8158442">family</span>&nbsp;<span class="op" id="8158449">!=</span>&nbsp;<span class="ident" id="8158452">syscall</span><span class="op" id="8158459">.</span><span class="ident" id="8158460">AF_INET6</span>&nbsp;<span class="op" id="8158469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158475">t</span><span class="op" id="8158476">.</span><span class="ident" id="8158477">Fatalf</span><span class="op" id="8158483">(</span><span class="string" id="8158484">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8158545">,</span>&nbsp;<span class="ident" id="8158547">net</span><span class="op" id="8158550">,</span>&nbsp;<span class="ident" id="8158552">laddr</span><span class="op" id="8158557">,</span>&nbsp;<span class="ident" id="8158559">fd</span><span class="op" id="8158561">.</span><span class="ident" id="8158562">family</span><span class="op" id="8158568">,</span>&nbsp;<span class="ident" id="8158570">syscall</span><span class="op" id="8158577">.</span><span class="ident" id="8158578">AF_INET6</span><span class="op" id="8158586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158595">}</span>&nbsp;<span class="keyword" id="8158597">else</span>&nbsp;<span class="op" id="8158602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158607">if</span>&nbsp;<span class="ident" id="8158610">fd</span><span class="op" id="8158612">.</span><span class="ident" id="8158613">family</span>&nbsp;<span class="op" id="8158620">!=</span>&nbsp;<span class="ident" id="8158623">a</span><span class="op" id="8158624">.</span><span class="ident" id="8158625">family</span><span class="op" id="8158631">(</span><span class="op" id="8158632">)</span>&nbsp;<span class="op" id="8158634">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158640">t</span><span class="op" id="8158641">.</span><span class="ident" id="8158642">Fatalf</span><span class="op" id="8158648">(</span><span class="string" id="8158649">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8158710">,</span>&nbsp;<span class="ident" id="8158712">net</span><span class="op" id="8158715">,</span>&nbsp;<span class="ident" id="8158717">laddr</span><span class="op" id="8158722">,</span>&nbsp;<span class="ident" id="8158724">fd</span><span class="op" id="8158726">.</span><span class="ident" id="8158727">family</span><span class="op" id="8158733">,</span>&nbsp;<span class="ident" id="8158735">a</span><span class="op" id="8158736">.</span><span class="ident" id="8158737">family</span><span class="op" id="8158743">(</span><span class="op" id="8158744">)</span><span class="op" id="8158745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8158757">default</span><span class="op" id="8158764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158768">t</span><span class="op" id="8158769">.</span><span class="ident" id="8158770">Fatalf</span><span class="op" id="8158776">(</span><span class="string" id="8158777">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="8158815">,</span>&nbsp;<span class="ident" id="8158817">a</span><span class="op" id="8158818">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158821">}</span><br>
<span class="lineno"></span><span class="op" id="8158823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8158826">var</span>&nbsp;<span class="ident" id="8158830">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8158857">=</span>&nbsp;<span class="op" id="8158859">[</span><span class="op" id="8158860">]</span><span class="keyword" id="8158861">struct</span>&nbsp;<span class="op" id="8158868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158871">net</span>&nbsp;&nbsp;<span class="builtintype" id="8158876">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8158884">addr</span>&nbsp;<span class="builtintype" id="8158889">string</span><br>
<span class="lineno"></span><span class="op" id="8158896">}</span><span class="op" id="8158897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158900">{</span><span class="string" id="8158901">&#34;tcp6&#34;</span><span class="op" id="8158907">,</span>&nbsp;<span class="string" id="8158909">&#34;127.0.0.1&#34;</span><span class="op" id="8158920">}</span><span class="op" id="8158921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8158924">{</span><span class="string" id="8158925">&#34;tcp6&#34;</span><span class="op" id="8158931">,</span>&nbsp;<span class="string" id="8158933">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8158953">}</span><span class="op" id="8158954">,</span><br>
<span class="lineno"></span><span class="op" id="8158956">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="8158959">func</span>&nbsp;<span class="ident" id="8158964">TestProhibitionaryDialArgs</span><span class="op" id="8158990">(</span><span class="ident" id="8158991">t</span>&nbsp;<span class="op" id="8158993">*</span><span class="ident" id="8158994">testing</span><span class="op" id="8159001">.</span><span class="ident" id="8159002">T</span><span class="op" id="8159003">)</span>&nbsp;<span class="op" id="8159005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159008">switch</span>&nbsp;<span class="ident" id="8159015">runtime</span><span class="op" id="8159022">.</span><span class="ident" id="8159023">GOOS</span>&nbsp;<span class="op" id="8159028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159031">case</span>&nbsp;<span class="string" id="8159036">&#34;plan9&#34;</span><span class="op" id="8159043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159047">t</span><span class="op" id="8159048">.</span><span class="ident" id="8159049">Skipf</span><span class="op" id="8159054">(</span><span class="string" id="8159055">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8159076">,</span>&nbsp;<span class="ident" id="8159078">runtime</span><span class="op" id="8159085">.</span><span class="ident" id="8159086">GOOS</span><span class="op" id="8159090">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8159096">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159166">if</span>&nbsp;<span class="op" id="8159169">!</span><span class="ident" id="8159170">supportsIPv4map</span>&nbsp;<span class="op" id="8159186">||</span>&nbsp;<span class="ident" id="8159189">testing</span><span class="op" id="8159196">.</span><span class="ident" id="8159197">Short</span><span class="op" id="8159202">(</span><span class="op" id="8159203">)</span>&nbsp;<span class="op" id="8159205">||</span>&nbsp;<span class="op" id="8159208">!</span><span class="op" id="8159209">*</span><span class="ident" id="8159210">testExternal</span>&nbsp;<span class="op" id="8159223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159227">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159235">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159239">l</span><span class="op" id="8159240">,</span>&nbsp;<span class="ident" id="8159242">port</span>&nbsp;<span class="op" id="8159247">:=</span>&nbsp;<span class="ident" id="8159250">usableListenPort</span><span class="op" id="8159266">(</span><span class="ident" id="8159267">t</span><span class="op" id="8159268">,</span>&nbsp;<span class="string" id="8159270">&#34;tcp&#34;</span><span class="op" id="8159275">,</span>&nbsp;<span class="string" id="8159277">&#34;[::]&#34;</span><span class="op" id="8159283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159286">defer</span>&nbsp;<span class="ident" id="8159292">l</span><span class="op" id="8159293">.</span><span class="ident" id="8159294">Close</span><span class="op" id="8159299">(</span><span class="op" id="8159300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159304">for</span>&nbsp;<span class="ident" id="8159308">_</span><span class="op" id="8159309">,</span>&nbsp;<span class="ident" id="8159311">tt</span>&nbsp;<span class="op" id="8159314">:=</span>&nbsp;<span class="keyword" id="8159317">range</span>&nbsp;<span class="ident" id="8159323">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8159350">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159354">c</span><span class="op" id="8159355">,</span>&nbsp;<span class="ident" id="8159357">err</span>&nbsp;<span class="op" id="8159361">:=</span>&nbsp;<span class="ident" id="8159364">Dial</span><span class="op" id="8159368">(</span><span class="ident" id="8159369">tt</span><span class="op" id="8159371">.</span><span class="ident" id="8159372">net</span><span class="op" id="8159375">,</span>&nbsp;<span class="ident" id="8159377">tt</span><span class="op" id="8159379">.</span><span class="ident" id="8159380">addr</span><span class="op" id="8159384">+</span><span class="string" id="8159385">&#34;:&#34;</span><span class="op" id="8159388">+</span><span class="ident" id="8159389">port</span><span class="op" id="8159393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159397">if</span>&nbsp;<span class="ident" id="8159400">err</span>&nbsp;<span class="op" id="8159404">==</span>&nbsp;<span class="ident" id="8159407">nil</span>&nbsp;<span class="op" id="8159411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159416">c</span><span class="op" id="8159417">.</span><span class="ident" id="8159418">Close</span><span class="op" id="8159423">(</span><span class="op" id="8159424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159429">t</span><span class="op" id="8159430">.</span><span class="ident" id="8159431">Fatalf</span><span class="op" id="8159437">(</span><span class="string" id="8159438">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8159464">,</span>&nbsp;<span class="ident" id="8159466">tt</span><span class="op" id="8159468">.</span><span class="ident" id="8159469">net</span><span class="op" id="8159472">,</span>&nbsp;<span class="ident" id="8159474">tt</span><span class="op" id="8159476">.</span><span class="ident" id="8159477">addr</span><span class="op" id="8159481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159485">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159488">}</span><br>
<span class="lineno"></span><span class="op" id="8159490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8159493">func</span>&nbsp;<span class="ident" id="8159498">TestWildWildcardListener</span><span class="op" id="8159522">(</span><span class="ident" id="8159523">t</span>&nbsp;<span class="op" id="8159525">*</span><span class="ident" id="8159526">testing</span><span class="op" id="8159533">.</span><span class="ident" id="8159534">T</span><span class="op" id="8159535">)</span>&nbsp;<span class="op" id="8159537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159540">switch</span>&nbsp;<span class="ident" id="8159547">runtime</span><span class="op" id="8159554">.</span><span class="ident" id="8159555">GOOS</span>&nbsp;<span class="op" id="8159560">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159563">case</span>&nbsp;<span class="string" id="8159568">&#34;plan9&#34;</span><span class="op" id="8159575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159579">t</span><span class="op" id="8159580">.</span><span class="ident" id="8159581">Skipf</span><span class="op" id="8159586">(</span><span class="string" id="8159587">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8159608">,</span>&nbsp;<span class="ident" id="8159610">runtime</span><span class="op" id="8159617">.</span><span class="ident" id="8159618">GOOS</span><span class="op" id="8159622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159629">if</span>&nbsp;<span class="ident" id="8159632">testing</span><span class="op" id="8159639">.</span><span class="ident" id="8159640">Short</span><span class="op" id="8159645">(</span><span class="op" id="8159646">)</span>&nbsp;<span class="op" id="8159648">||</span>&nbsp;<span class="op" id="8159651">!</span><span class="op" id="8159652">*</span><span class="ident" id="8159653">testExternal</span>&nbsp;<span class="op" id="8159666">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159670">t</span><span class="op" id="8159671">.</span><span class="ident" id="8159672">Skip</span><span class="op" id="8159676">(</span><span class="string" id="8159677">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8159718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159725">defer</span>&nbsp;<span class="keyword" id="8159731">func</span><span class="op" id="8159735">(</span><span class="op" id="8159736">)</span>&nbsp;<span class="op" id="8159738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159742">if</span>&nbsp;<span class="ident" id="8159745">p</span>&nbsp;<span class="op" id="8159747">:=</span>&nbsp;<span class="builtinfunc" id="8159750">recover</span><span class="op" id="8159757">(</span><span class="op" id="8159758">)</span><span class="op" id="8159759">;</span>&nbsp;<span class="ident" id="8159761">p</span>&nbsp;<span class="op" id="8159763">!=</span>&nbsp;<span class="ident" id="8159766">nil</span>&nbsp;<span class="op" id="8159770">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159775">t</span><span class="op" id="8159776">.</span><span class="ident" id="8159777">Fatalf</span><span class="op" id="8159783">(</span><span class="string" id="8159784">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8159847">,</span>&nbsp;<span class="ident" id="8159849">p</span><span class="op" id="8159850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159857">}</span><span class="op" id="8159858">(</span><span class="op" id="8159859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159863">if</span>&nbsp;<span class="ident" id="8159866">ln</span><span class="op" id="8159868">,</span>&nbsp;<span class="ident" id="8159870">err</span>&nbsp;<span class="op" id="8159874">:=</span>&nbsp;<span class="ident" id="8159877">Listen</span><span class="op" id="8159883">(</span><span class="string" id="8159884">&#34;tcp&#34;</span><span class="op" id="8159889">,</span>&nbsp;<span class="string" id="8159891">&#34;&#34;</span><span class="op" id="8159893">)</span><span class="op" id="8159894">;</span>&nbsp;<span class="ident" id="8159896">err</span>&nbsp;<span class="op" id="8159900">==</span>&nbsp;<span class="ident" id="8159903">nil</span>&nbsp;<span class="op" id="8159907">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159911">ln</span><span class="op" id="8159913">.</span><span class="ident" id="8159914">Close</span><span class="op" id="8159919">(</span><span class="op" id="8159920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159926">if</span>&nbsp;<span class="ident" id="8159929">ln</span><span class="op" id="8159931">,</span>&nbsp;<span class="ident" id="8159933">err</span>&nbsp;<span class="op" id="8159937">:=</span>&nbsp;<span class="ident" id="8159940">ListenPacket</span><span class="op" id="8159952">(</span><span class="string" id="8159953">&#34;udp&#34;</span><span class="op" id="8159958">,</span>&nbsp;<span class="string" id="8159960">&#34;&#34;</span><span class="op" id="8159962">)</span><span class="op" id="8159963">;</span>&nbsp;<span class="ident" id="8159965">err</span>&nbsp;<span class="op" id="8159969">==</span>&nbsp;<span class="ident" id="8159972">nil</span>&nbsp;<span class="op" id="8159976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8159980">ln</span><span class="op" id="8159982">.</span><span class="ident" id="8159983">Close</span><span class="op" id="8159988">(</span><span class="op" id="8159989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8159992">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8159995">if</span>&nbsp;<span class="ident" id="8159998">ln</span><span class="op" id="8160000">,</span>&nbsp;<span class="ident" id="8160002">err</span>&nbsp;<span class="op" id="8160006">:=</span>&nbsp;<span class="ident" id="8160009">ListenTCP</span><span class="op" id="8160018">(</span><span class="string" id="8160019">&#34;tcp&#34;</span><span class="op" id="8160024">,</span>&nbsp;<span class="ident" id="8160026">nil</span><span class="op" id="8160029">)</span><span class="op" id="8160030">;</span>&nbsp;<span class="ident" id="8160032">err</span>&nbsp;<span class="op" id="8160036">==</span>&nbsp;<span class="ident" id="8160039">nil</span>&nbsp;<span class="op" id="8160043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160047">ln</span><span class="op" id="8160049">.</span><span class="ident" id="8160050">Close</span><span class="op" id="8160055">(</span><span class="op" id="8160056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160062">if</span>&nbsp;<span class="ident" id="8160065">ln</span><span class="op" id="8160067">,</span>&nbsp;<span class="ident" id="8160069">err</span>&nbsp;<span class="op" id="8160073">:=</span>&nbsp;<span class="ident" id="8160076">ListenUDP</span><span class="op" id="8160085">(</span><span class="string" id="8160086">&#34;udp&#34;</span><span class="op" id="8160091">,</span>&nbsp;<span class="ident" id="8160093">nil</span><span class="op" id="8160096">)</span><span class="op" id="8160097">;</span>&nbsp;<span class="ident" id="8160099">err</span>&nbsp;<span class="op" id="8160103">==</span>&nbsp;<span class="ident" id="8160106">nil</span>&nbsp;<span class="op" id="8160110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160114">ln</span><span class="op" id="8160116">.</span><span class="ident" id="8160117">Close</span><span class="op" id="8160122">(</span><span class="op" id="8160123">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160129">if</span>&nbsp;<span class="ident" id="8160132">ln</span><span class="op" id="8160134">,</span>&nbsp;<span class="ident" id="8160136">err</span>&nbsp;<span class="op" id="8160140">:=</span>&nbsp;<span class="ident" id="8160143">ListenIP</span><span class="op" id="8160151">(</span><span class="string" id="8160152">&#34;ip:icmp&#34;</span><span class="op" id="8160161">,</span>&nbsp;<span class="ident" id="8160163">nil</span><span class="op" id="8160166">)</span><span class="op" id="8160167">;</span>&nbsp;<span class="ident" id="8160169">err</span>&nbsp;<span class="op" id="8160173">==</span>&nbsp;<span class="ident" id="8160176">nil</span>&nbsp;<span class="op" id="8160180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160184">ln</span><span class="op" id="8160186">.</span><span class="ident" id="8160187">Close</span><span class="op" id="8160192">(</span><span class="op" id="8160193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160196">}</span><br>
<span class="lineno"></span><span class="op" id="8160198">}</span>
</div>
</body>
</html>
