<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4807601">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4807656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4807710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4807761">package</span>&nbsp;<span class="ident" id="4807769">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807776">import</span>&nbsp;<span class="op" id="4807783">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807786">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807794">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4807801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807804">type</span>&nbsp;<span class="ident" id="4807809">huffmanEncoder</span>&nbsp;<span class="keyword" id="4807824">struct</span>&nbsp;<span class="op" id="4807831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807834">codeBits</span>&nbsp;<span class="op" id="4807843">[</span><span class="op" id="4807844">]</span><span class="builtintype" id="4807845">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807852">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807861">[</span><span class="op" id="4807862">]</span><span class="builtintype" id="4807863">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4807870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807873">type</span>&nbsp;<span class="ident" id="4807878">literalNode</span>&nbsp;<span class="keyword" id="4807890">struct</span>&nbsp;<span class="op" id="4807897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807900">literal</span>&nbsp;<span class="builtintype" id="4807908">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807916">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4807924">int32</span><br>
<span class="lineno">20</span><span class="op" id="4807930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807933">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4808011">type</span>&nbsp;<span class="ident" id="4808016">levelInfo</span>&nbsp;<span class="keyword" id="4808026">struct</span>&nbsp;<span class="op" id="4808033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808036">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808072">level</span>&nbsp;<span class="builtintype" id="4808078">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808086">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808135">lastFreq</span>&nbsp;<span class="builtintype" id="4808144">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808152">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808213">nextCharFreq</span>&nbsp;<span class="builtintype" id="4808226">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808234">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808310">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808377">nextPairFreq</span>&nbsp;<span class="builtintype" id="4808390">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808398">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808474">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808499">needed</span>&nbsp;<span class="builtintype" id="4808506">int32</span><br>
<span class="lineno">40</span><span class="op" id="4808512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4808515">func</span>&nbsp;<span class="ident" id="4808520">maxNode</span><span class="op" id="4808527">(</span><span class="op" id="4808528">)</span>&nbsp;<span class="ident" id="4808530">literalNode</span>&nbsp;<span class="op" id="4808542">{</span>&nbsp;<span class="keyword" id="4808544">return</span>&nbsp;<span class="ident" id="4808551">literalNode</span><span class="op" id="4808562">{</span><span class="ident" id="4808563">math</span><span class="op" id="4808567">.</span><span class="ident" id="4808568">MaxUint16</span><span class="op" id="4808577">,</span>&nbsp;<span class="ident" id="4808579">math</span><span class="op" id="4808583">.</span><span class="ident" id="4808584">MaxInt32</span><span class="op" id="4808592">}</span>&nbsp;<span class="op" id="4808594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4808597">func</span>&nbsp;<span class="ident" id="4808602">newHuffmanEncoder</span><span class="op" id="4808619">(</span><span class="ident" id="4808620">size</span>&nbsp;<span class="builtintype" id="4808625">int</span><span class="op" id="4808628">)</span>&nbsp;<span class="op" id="4808630">*</span><span class="ident" id="4808631">huffmanEncoder</span>&nbsp;<span class="op" id="4808646">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808649">return</span>&nbsp;<span class="op" id="4808656">&amp;</span><span class="ident" id="4808657">huffmanEncoder</span><span class="op" id="4808671">{</span><span class="builtinfunc" id="4808672">make</span><span class="op" id="4808676">(</span><span class="op" id="4808677">[</span><span class="op" id="4808678">]</span><span class="builtintype" id="4808679">uint8</span><span class="op" id="4808684">,</span>&nbsp;<span class="ident" id="4808686">size</span><span class="op" id="4808690">)</span><span class="op" id="4808691">,</span>&nbsp;<span class="builtinfunc" id="4808693">make</span><span class="op" id="4808697">(</span><span class="op" id="4808698">[</span><span class="op" id="4808699">]</span><span class="builtintype" id="4808700">uint16</span><span class="op" id="4808706">,</span>&nbsp;<span class="ident" id="4808708">size</span><span class="op" id="4808712">)</span><span class="op" id="4808713">}</span><br>
<span class="lineno"></span><span class="op" id="4808715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4808718">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4808786">func</span>&nbsp;<span class="ident" id="4808791">generateFixedLiteralEncoding</span><span class="op" id="4808819">(</span><span class="op" id="4808820">)</span>&nbsp;<span class="op" id="4808822">*</span><span class="ident" id="4808823">huffmanEncoder</span>&nbsp;<span class="op" id="4808838">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808841">h</span>&nbsp;<span class="op" id="4808843">:=</span>&nbsp;<span class="ident" id="4808846">newHuffmanEncoder</span><span class="op" id="4808863">(</span><span class="ident" id="4808864">maxLit</span><span class="op" id="4808870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808873">codeBits</span>&nbsp;<span class="op" id="4808882">:=</span>&nbsp;<span class="ident" id="4808885">h</span><span class="op" id="4808886">.</span><span class="ident" id="4808887">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808897">code</span>&nbsp;<span class="op" id="4808902">:=</span>&nbsp;<span class="ident" id="4808905">h</span><span class="op" id="4808906">.</span><span class="ident" id="4808907">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808913">var</span>&nbsp;<span class="ident" id="4808917">ch</span>&nbsp;<span class="builtintype" id="4808920">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808928">for</span>&nbsp;<span class="ident" id="4808932">ch</span>&nbsp;<span class="op" id="4808935">=</span>&nbsp;<span class="num" id="4808937">0</span><span class="op" id="4808938">;</span>&nbsp;<span class="ident" id="4808940">ch</span>&nbsp;<span class="op" id="4808943">&lt;</span>&nbsp;<span class="ident" id="4808945">maxLit</span><span class="op" id="4808951">;</span>&nbsp;<span class="ident" id="4808953">ch</span><span class="op" id="4808955">++</span>&nbsp;<span class="op" id="4808958">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808962">var</span>&nbsp;<span class="ident" id="4808966">bits</span>&nbsp;<span class="builtintype" id="4808971">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808980">var</span>&nbsp;<span class="ident" id="4808984">size</span>&nbsp;<span class="builtintype" id="4808989">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808997">switch</span>&nbsp;<span class="op" id="4809004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809008">case</span>&nbsp;<span class="ident" id="4809013">ch</span>&nbsp;<span class="op" id="4809016">&lt;</span>&nbsp;<span class="num" id="4809018">144</span><span class="op" id="4809021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809026">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809063">bits</span>&nbsp;<span class="op" id="4809068">=</span>&nbsp;<span class="ident" id="4809070">ch</span>&nbsp;<span class="op" id="4809073">+</span>&nbsp;<span class="num" id="4809075">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809081">size</span>&nbsp;<span class="op" id="4809086">=</span>&nbsp;<span class="num" id="4809088">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809093">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809101">case</span>&nbsp;<span class="ident" id="4809106">ch</span>&nbsp;<span class="op" id="4809109">&lt;</span>&nbsp;<span class="num" id="4809111">256</span><span class="op" id="4809114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809119">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809156">bits</span>&nbsp;<span class="op" id="4809161">=</span>&nbsp;<span class="ident" id="4809163">ch</span>&nbsp;<span class="op" id="4809166">+</span>&nbsp;<span class="num" id="4809168">400</span>&nbsp;<span class="op" id="4809172">-</span>&nbsp;<span class="num" id="4809174">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809181">size</span>&nbsp;<span class="op" id="4809186">=</span>&nbsp;<span class="num" id="4809188">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809193">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809201">case</span>&nbsp;<span class="ident" id="4809206">ch</span>&nbsp;<span class="op" id="4809209">&lt;</span>&nbsp;<span class="num" id="4809211">280</span><span class="op" id="4809214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809219">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809252">bits</span>&nbsp;<span class="op" id="4809257">=</span>&nbsp;<span class="ident" id="4809259">ch</span>&nbsp;<span class="op" id="4809262">-</span>&nbsp;<span class="num" id="4809264">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809271">size</span>&nbsp;<span class="op" id="4809276">=</span>&nbsp;<span class="num" id="4809278">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809283">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809291">default</span><span class="op" id="4809298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809303">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809338">bits</span>&nbsp;<span class="op" id="4809343">=</span>&nbsp;<span class="ident" id="4809345">ch</span>&nbsp;<span class="op" id="4809348">+</span>&nbsp;<span class="num" id="4809350">192</span>&nbsp;<span class="op" id="4809354">-</span>&nbsp;<span class="num" id="4809356">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809363">size</span>&nbsp;<span class="op" id="4809368">=</span>&nbsp;<span class="num" id="4809370">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809378">codeBits</span><span class="op" id="4809386">[</span><span class="ident" id="4809387">ch</span><span class="op" id="4809389">]</span>&nbsp;<span class="op" id="4809391">=</span>&nbsp;<span class="ident" id="4809393">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809400">code</span><span class="op" id="4809404">[</span><span class="ident" id="4809405">ch</span><span class="op" id="4809407">]</span>&nbsp;<span class="op" id="4809409">=</span>&nbsp;<span class="ident" id="4809411">reverseBits</span><span class="op" id="4809422">(</span><span class="ident" id="4809423">bits</span><span class="op" id="4809427">,</span>&nbsp;<span class="ident" id="4809429">size</span><span class="op" id="4809433">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809439">return</span>&nbsp;<span class="ident" id="4809446">h</span><br>
<span class="lineno"></span><span class="op" id="4809448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4809451">func</span>&nbsp;<span class="ident" id="4809456">generateFixedOffsetEncoding</span><span class="op" id="4809483">(</span><span class="op" id="4809484">)</span>&nbsp;<span class="op" id="4809486">*</span><span class="ident" id="4809487">huffmanEncoder</span>&nbsp;<span class="op" id="4809502">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809505">h</span>&nbsp;<span class="op" id="4809507">:=</span>&nbsp;<span class="ident" id="4809510">newHuffmanEncoder</span><span class="op" id="4809527">(</span><span class="num" id="4809528">30</span><span class="op" id="4809530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809533">codeBits</span>&nbsp;<span class="op" id="4809542">:=</span>&nbsp;<span class="ident" id="4809545">h</span><span class="op" id="4809546">.</span><span class="ident" id="4809547">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809557">code</span>&nbsp;<span class="op" id="4809562">:=</span>&nbsp;<span class="ident" id="4809565">h</span><span class="op" id="4809566">.</span><span class="ident" id="4809567">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809573">for</span>&nbsp;<span class="ident" id="4809577">ch</span>&nbsp;<span class="op" id="4809580">:=</span>&nbsp;<span class="builtintype" id="4809583">uint16</span><span class="op" id="4809589">(</span><span class="num" id="4809590">0</span><span class="op" id="4809591">)</span><span class="op" id="4809592">;</span>&nbsp;<span class="ident" id="4809594">ch</span>&nbsp;<span class="op" id="4809597">&lt;</span>&nbsp;<span class="num" id="4809599">30</span><span class="op" id="4809601">;</span>&nbsp;<span class="ident" id="4809603">ch</span><span class="op" id="4809605">++</span>&nbsp;<span class="op" id="4809608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809612">codeBits</span><span class="op" id="4809620">[</span><span class="ident" id="4809621">ch</span><span class="op" id="4809623">]</span>&nbsp;<span class="op" id="4809625">=</span>&nbsp;<span class="num" id="4809627">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809631">code</span><span class="op" id="4809635">[</span><span class="ident" id="4809636">ch</span><span class="op" id="4809638">]</span>&nbsp;<span class="op" id="4809640">=</span>&nbsp;<span class="ident" id="4809642">reverseBits</span><span class="op" id="4809653">(</span><span class="ident" id="4809654">ch</span><span class="op" id="4809656">,</span>&nbsp;<span class="num" id="4809658">5</span><span class="op" id="4809659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809665">return</span>&nbsp;<span class="ident" id="4809672">h</span><br>
<span class="lineno"></span><span class="op" id="4809674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4809677">var</span>&nbsp;<span class="ident" id="4809681">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4809702">*</span><span class="ident" id="4809703">huffmanEncoder</span>&nbsp;<span class="op" id="4809718">=</span>&nbsp;<span class="ident" id="4809720">generateFixedLiteralEncoding</span><span class="op" id="4809748">(</span><span class="op" id="4809749">)</span><br>
<span class="lineno"></span><span class="keyword" id="4809751">var</span>&nbsp;<span class="ident" id="4809755">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4809775">*</span><span class="ident" id="4809776">huffmanEncoder</span>&nbsp;<span class="op" id="4809791">=</span>&nbsp;<span class="ident" id="4809793">generateFixedOffsetEncoding</span><span class="op" id="4809820">(</span><span class="op" id="4809821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4809824">func</span>&nbsp;<span class="op" id="4809829">(</span><span class="ident" id="4809830">h</span>&nbsp;<span class="op" id="4809832">*</span><span class="ident" id="4809833">huffmanEncoder</span><span class="op" id="4809847">)</span>&nbsp;<span class="ident" id="4809849">bitLength</span><span class="op" id="4809858">(</span><span class="ident" id="4809859">freq</span>&nbsp;<span class="op" id="4809864">[</span><span class="op" id="4809865">]</span><span class="builtintype" id="4809866">int32</span><span class="op" id="4809871">)</span>&nbsp;<span class="ident" id="4809873">int64</span>&nbsp;<span class="op" id="4809879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809882">var</span>&nbsp;<span class="ident" id="4809886">total</span>&nbsp;<span class="ident" id="4809892">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809899">for</span>&nbsp;<span class="ident" id="4809903">i</span><span class="op" id="4809904">,</span>&nbsp;<span class="ident" id="4809906">f</span>&nbsp;<span class="op" id="4809908">:=</span>&nbsp;<span class="keyword" id="4809911">range</span>&nbsp;<span class="ident" id="4809917">freq</span>&nbsp;<span class="op" id="4809922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809926">if</span>&nbsp;<span class="ident" id="4809929">f</span>&nbsp;<span class="op" id="4809931">!=</span>&nbsp;<span class="num" id="4809934">0</span>&nbsp;<span class="op" id="4809936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809941">total</span>&nbsp;<span class="op" id="4809947">+=</span>&nbsp;<span class="ident" id="4809950">int64</span><span class="op" id="4809955">(</span><span class="ident" id="4809956">f</span><span class="op" id="4809957">)</span>&nbsp;<span class="op" id="4809959">*</span>&nbsp;<span class="ident" id="4809961">int64</span><span class="op" id="4809966">(</span><span class="ident" id="4809967">h</span><span class="op" id="4809968">.</span><span class="ident" id="4809969">codeBits</span><span class="op" id="4809977">[</span><span class="ident" id="4809978">i</span><span class="op" id="4809979">]</span><span class="op" id="4809980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809987">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809990">return</span>&nbsp;<span class="ident" id="4809997">total</span><br>
<span class="lineno"></span><span class="op" id="4810003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4810006">const</span>&nbsp;<span class="ident" id="4810012">maxBitsLimit</span>&nbsp;<span class="op" id="4810025">=</span>&nbsp;<span class="num" id="4810027">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4810031">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4810114">//</span><br>
<span class="lineno"></span><span class="comment" id="4810117">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4810169">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4810240">//</span><br>
<span class="lineno">115</span><span class="comment" id="4810243">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4810303">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4810389">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4810476">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4810500">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4810585">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4810622">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4810705">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4810754">func</span>&nbsp;<span class="op" id="4810759">(</span><span class="ident" id="4810760">h</span>&nbsp;<span class="op" id="4810762">*</span><span class="ident" id="4810763">huffmanEncoder</span><span class="op" id="4810777">)</span>&nbsp;<span class="ident" id="4810779">bitCounts</span><span class="op" id="4810788">(</span><span class="ident" id="4810789">list</span>&nbsp;<span class="op" id="4810794">[</span><span class="op" id="4810795">]</span><span class="ident" id="4810796">literalNode</span><span class="op" id="4810807">,</span>&nbsp;<span class="ident" id="4810809">maxBits</span>&nbsp;<span class="builtintype" id="4810817">int32</span><span class="op" id="4810822">)</span>&nbsp;<span class="op" id="4810824">[</span><span class="op" id="4810825">]</span><span class="builtintype" id="4810826">int32</span>&nbsp;<span class="op" id="4810832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810835">if</span>&nbsp;<span class="ident" id="4810838">maxBits</span>&nbsp;<span class="op" id="4810846">&gt;=</span>&nbsp;<span class="ident" id="4810849">maxBitsLimit</span>&nbsp;<span class="op" id="4810862">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4810866">panic</span><span class="op" id="4810871">(</span><span class="string" id="4810872">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4810898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810904">n</span>&nbsp;<span class="op" id="4810906">:=</span>&nbsp;<span class="builtintype" id="4810909">int32</span><span class="op" id="4810914">(</span><span class="builtinfunc" id="4810915">len</span><span class="op" id="4810918">(</span><span class="ident" id="4810919">list</span><span class="op" id="4810923">)</span><span class="op" id="4810924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810927">list</span>&nbsp;<span class="op" id="4810932">=</span>&nbsp;<span class="ident" id="4810934">list</span><span class="op" id="4810938">[</span><span class="num" id="4810939">0</span>&nbsp;<span class="op" id="4810941">:</span>&nbsp;<span class="ident" id="4810943">n</span><span class="op" id="4810944">+</span><span class="num" id="4810945">1</span><span class="op" id="4810946">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810949">list</span><span class="op" id="4810953">[</span><span class="ident" id="4810954">n</span><span class="op" id="4810955">]</span>&nbsp;<span class="op" id="4810957">=</span>&nbsp;<span class="ident" id="4810959">maxNode</span><span class="op" id="4810966">(</span><span class="op" id="4810967">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4810971">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811043">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811094">if</span>&nbsp;<span class="ident" id="4811097">maxBits</span>&nbsp;<span class="op" id="4811105">&gt;</span>&nbsp;<span class="ident" id="4811107">n</span><span class="op" id="4811108">-</span><span class="num" id="4811109">1</span>&nbsp;<span class="op" id="4811111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811115">maxBits</span>&nbsp;<span class="op" id="4811123">=</span>&nbsp;<span class="ident" id="4811125">n</span>&nbsp;<span class="op" id="4811127">-</span>&nbsp;<span class="num" id="4811129">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811136">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811185">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811237">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811296">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811346">var</span>&nbsp;<span class="ident" id="4811350">levels</span>&nbsp;<span class="op" id="4811357">[</span><span class="ident" id="4811358">maxBitsLimit</span><span class="op" id="4811370">]</span><span class="ident" id="4811371">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811382">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811442">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811493">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811552">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811581">var</span>&nbsp;<span class="ident" id="4811585">leafCounts</span>&nbsp;<span class="op" id="4811596">[</span><span class="ident" id="4811597">maxBitsLimit</span><span class="op" id="4811609">]</span><span class="op" id="4811610">[</span><span class="ident" id="4811611">maxBitsLimit</span><span class="op" id="4811623">]</span><span class="builtintype" id="4811624">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811632">for</span>&nbsp;<span class="ident" id="4811636">level</span>&nbsp;<span class="op" id="4811642">:=</span>&nbsp;<span class="builtintype" id="4811645">int32</span><span class="op" id="4811650">(</span><span class="num" id="4811651">1</span><span class="op" id="4811652">)</span><span class="op" id="4811653">;</span>&nbsp;<span class="ident" id="4811655">level</span>&nbsp;<span class="op" id="4811661">&lt;=</span>&nbsp;<span class="ident" id="4811664">maxBits</span><span class="op" id="4811671">;</span>&nbsp;<span class="ident" id="4811673">level</span><span class="op" id="4811678">++</span>&nbsp;<span class="op" id="4811681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811685">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811757">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811826">levels</span><span class="op" id="4811832">[</span><span class="ident" id="4811833">level</span><span class="op" id="4811838">]</span>&nbsp;<span class="op" id="4811840">=</span>&nbsp;<span class="ident" id="4811842">levelInfo</span><span class="op" id="4811851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811856">level</span><span class="op" id="4811861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811870">level</span><span class="op" id="4811875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811880">lastFreq</span><span class="op" id="4811888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811894">list</span><span class="op" id="4811898">[</span><span class="num" id="4811899">1</span><span class="op" id="4811900">]</span><span class="op" id="4811901">.</span><span class="ident" id="4811902">freq</span><span class="op" id="4811906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811911">nextCharFreq</span><span class="op" id="4811923">:</span>&nbsp;<span class="ident" id="4811925">list</span><span class="op" id="4811929">[</span><span class="num" id="4811930">2</span><span class="op" id="4811931">]</span><span class="op" id="4811932">.</span><span class="ident" id="4811933">freq</span><span class="op" id="4811937">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811942">nextPairFreq</span><span class="op" id="4811954">:</span>&nbsp;<span class="ident" id="4811956">list</span><span class="op" id="4811960">[</span><span class="num" id="4811961">0</span><span class="op" id="4811962">]</span><span class="op" id="4811963">.</span><span class="ident" id="4811964">freq</span>&nbsp;<span class="op" id="4811969">+</span>&nbsp;<span class="ident" id="4811971">list</span><span class="op" id="4811975">[</span><span class="num" id="4811976">1</span><span class="op" id="4811977">]</span><span class="op" id="4811978">.</span><span class="ident" id="4811979">freq</span><span class="op" id="4811983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811991">leafCounts</span><span class="op" id="4812001">[</span><span class="ident" id="4812002">level</span><span class="op" id="4812007">]</span><span class="op" id="4812008">[</span><span class="ident" id="4812009">level</span><span class="op" id="4812014">]</span>&nbsp;<span class="op" id="4812016">=</span>&nbsp;<span class="num" id="4812018">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812022">if</span>&nbsp;<span class="ident" id="4812025">level</span>&nbsp;<span class="op" id="4812031">==</span>&nbsp;<span class="num" id="4812034">1</span>&nbsp;<span class="op" id="4812036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812041">levels</span><span class="op" id="4812047">[</span><span class="ident" id="4812048">level</span><span class="op" id="4812053">]</span><span class="op" id="4812054">.</span><span class="ident" id="4812055">nextPairFreq</span>&nbsp;<span class="op" id="4812068">=</span>&nbsp;<span class="ident" id="4812070">math</span><span class="op" id="4812074">.</span><span class="ident" id="4812075">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812093">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812173">levels</span><span class="op" id="4812179">[</span><span class="ident" id="4812180">maxBits</span><span class="op" id="4812187">]</span><span class="op" id="4812188">.</span><span class="ident" id="4812189">needed</span>&nbsp;<span class="op" id="4812196">=</span>&nbsp;<span class="num" id="4812198">2</span><span class="op" id="4812199">*</span><span class="ident" id="4812200">n</span>&nbsp;<span class="op" id="4812202">-</span>&nbsp;<span class="num" id="4812204">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812208">level</span>&nbsp;<span class="op" id="4812214">:=</span>&nbsp;<span class="ident" id="4812217">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812226">for</span>&nbsp;<span class="op" id="4812230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812234">l</span>&nbsp;<span class="op" id="4812236">:=</span>&nbsp;<span class="op" id="4812239">&amp;</span><span class="ident" id="4812240">levels</span><span class="op" id="4812246">[</span><span class="ident" id="4812247">level</span><span class="op" id="4812252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812256">if</span>&nbsp;<span class="ident" id="4812259">l</span><span class="op" id="4812260">.</span><span class="ident" id="4812261">nextPairFreq</span>&nbsp;<span class="op" id="4812274">==</span>&nbsp;<span class="ident" id="4812277">math</span><span class="op" id="4812281">.</span><span class="ident" id="4812282">MaxInt32</span>&nbsp;<span class="op" id="4812291">&amp;&amp;</span>&nbsp;<span class="ident" id="4812294">l</span><span class="op" id="4812295">.</span><span class="ident" id="4812296">nextCharFreq</span>&nbsp;<span class="op" id="4812309">==</span>&nbsp;<span class="ident" id="4812312">math</span><span class="op" id="4812316">.</span><span class="ident" id="4812317">MaxInt32</span>&nbsp;<span class="op" id="4812326">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812331">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812376">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812419">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812491">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812532">l</span><span class="op" id="4812533">.</span><span class="ident" id="4812534">needed</span>&nbsp;<span class="op" id="4812541">=</span>&nbsp;<span class="num" id="4812543">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812548">levels</span><span class="op" id="4812554">[</span><span class="ident" id="4812555">level</span><span class="op" id="4812560">+</span><span class="num" id="4812561">1</span><span class="op" id="4812562">]</span><span class="op" id="4812563">.</span><span class="ident" id="4812564">nextPairFreq</span>&nbsp;<span class="op" id="4812577">=</span>&nbsp;<span class="ident" id="4812579">math</span><span class="op" id="4812583">.</span><span class="ident" id="4812584">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812596">level</span><span class="op" id="4812601">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812607">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812623">prevFreq</span>&nbsp;<span class="op" id="4812632">:=</span>&nbsp;<span class="ident" id="4812635">l</span><span class="op" id="4812636">.</span><span class="ident" id="4812637">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812648">if</span>&nbsp;<span class="ident" id="4812651">l</span><span class="op" id="4812652">.</span><span class="ident" id="4812653">nextCharFreq</span>&nbsp;<span class="op" id="4812666">&lt;</span>&nbsp;<span class="ident" id="4812668">l</span><span class="op" id="4812669">.</span><span class="ident" id="4812670">nextPairFreq</span>&nbsp;<span class="op" id="4812683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812688">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812736">n</span>&nbsp;<span class="op" id="4812738">:=</span>&nbsp;<span class="ident" id="4812741">leafCounts</span><span class="op" id="4812751">[</span><span class="ident" id="4812752">level</span><span class="op" id="4812757">]</span><span class="op" id="4812758">[</span><span class="ident" id="4812759">level</span><span class="op" id="4812764">]</span>&nbsp;<span class="op" id="4812766">+</span>&nbsp;<span class="num" id="4812768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812773">l</span><span class="op" id="4812774">.</span><span class="ident" id="4812775">lastFreq</span>&nbsp;<span class="op" id="4812784">=</span>&nbsp;<span class="ident" id="4812786">l</span><span class="op" id="4812787">.</span><span class="ident" id="4812788">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812804">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812862">leafCounts</span><span class="op" id="4812872">[</span><span class="ident" id="4812873">level</span><span class="op" id="4812878">]</span><span class="op" id="4812879">[</span><span class="ident" id="4812880">level</span><span class="op" id="4812885">]</span>&nbsp;<span class="op" id="4812887">=</span>&nbsp;<span class="ident" id="4812889">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812894">l</span><span class="op" id="4812895">.</span><span class="ident" id="4812896">nextCharFreq</span>&nbsp;<span class="op" id="4812909">=</span>&nbsp;<span class="ident" id="4812911">list</span><span class="op" id="4812915">[</span><span class="ident" id="4812916">n</span><span class="op" id="4812917">]</span><span class="op" id="4812918">.</span><span class="ident" id="4812919">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812926">}</span>&nbsp;<span class="keyword" id="4812928">else</span>&nbsp;<span class="op" id="4812933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812938">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813003">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813056">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813093">l</span><span class="op" id="4813094">.</span><span class="ident" id="4813095">lastFreq</span>&nbsp;<span class="op" id="4813104">=</span>&nbsp;<span class="ident" id="4813106">l</span><span class="op" id="4813107">.</span><span class="ident" id="4813108">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813124">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4813208">copy</span><span class="op" id="4813212">(</span><span class="ident" id="4813213">leafCounts</span><span class="op" id="4813223">[</span><span class="ident" id="4813224">level</span><span class="op" id="4813229">]</span><span class="op" id="4813230">[</span><span class="op" id="4813231">:</span><span class="ident" id="4813232">level</span><span class="op" id="4813237">]</span><span class="op" id="4813238">,</span>&nbsp;<span class="ident" id="4813240">leafCounts</span><span class="op" id="4813250">[</span><span class="ident" id="4813251">level</span><span class="op" id="4813256">-</span><span class="num" id="4813257">1</span><span class="op" id="4813258">]</span><span class="op" id="4813259">[</span><span class="op" id="4813260">:</span><span class="ident" id="4813261">level</span><span class="op" id="4813266">]</span><span class="op" id="4813267">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813272">levels</span><span class="op" id="4813278">[</span><span class="ident" id="4813279">l</span><span class="op" id="4813280">.</span><span class="ident" id="4813281">level</span><span class="op" id="4813286">-</span><span class="num" id="4813287">1</span><span class="op" id="4813288">]</span><span class="op" id="4813289">.</span><span class="ident" id="4813290">needed</span>&nbsp;<span class="op" id="4813297">=</span>&nbsp;<span class="num" id="4813299">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813308">if</span>&nbsp;<span class="ident" id="4813311">l</span><span class="op" id="4813312">.</span><span class="ident" id="4813313">needed</span><span class="op" id="4813319">--</span><span class="op" id="4813321">;</span>&nbsp;<span class="ident" id="4813323">l</span><span class="op" id="4813324">.</span><span class="ident" id="4813325">needed</span>&nbsp;<span class="op" id="4813332">==</span>&nbsp;<span class="num" id="4813335">0</span>&nbsp;<span class="op" id="4813337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813342">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813400">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813463">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813538">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813556">if</span>&nbsp;<span class="ident" id="4813559">l</span><span class="op" id="4813560">.</span><span class="ident" id="4813561">level</span>&nbsp;<span class="op" id="4813567">==</span>&nbsp;<span class="ident" id="4813570">maxBits</span>&nbsp;<span class="op" id="4813578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813584">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813601">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813615">levels</span><span class="op" id="4813621">[</span><span class="ident" id="4813622">l</span><span class="op" id="4813623">.</span><span class="ident" id="4813624">level</span><span class="op" id="4813629">+</span><span class="num" id="4813630">1</span><span class="op" id="4813631">]</span><span class="op" id="4813632">.</span><span class="ident" id="4813633">nextPairFreq</span>&nbsp;<span class="op" id="4813646">=</span>&nbsp;<span class="ident" id="4813648">prevFreq</span>&nbsp;<span class="op" id="4813657">+</span>&nbsp;<span class="ident" id="4813659">l</span><span class="op" id="4813660">.</span><span class="ident" id="4813661">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813673">level</span><span class="op" id="4813678">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813683">}</span>&nbsp;<span class="keyword" id="4813685">else</span>&nbsp;<span class="op" id="4813690">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813695">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813764">for</span>&nbsp;<span class="ident" id="4813768">levels</span><span class="op" id="4813774">[</span><span class="ident" id="4813775">level</span><span class="op" id="4813780">-</span><span class="num" id="4813781">1</span><span class="op" id="4813782">]</span><span class="op" id="4813783">.</span><span class="ident" id="4813784">needed</span>&nbsp;<span class="op" id="4813791">&gt;</span>&nbsp;<span class="num" id="4813793">0</span>&nbsp;<span class="op" id="4813795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813801">level</span><span class="op" id="4813806">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813816">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813823">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813899">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813922">if</span>&nbsp;<span class="ident" id="4813925">leafCounts</span><span class="op" id="4813935">[</span><span class="ident" id="4813936">maxBits</span><span class="op" id="4813943">]</span><span class="op" id="4813944">[</span><span class="ident" id="4813945">maxBits</span><span class="op" id="4813952">]</span>&nbsp;<span class="op" id="4813954">!=</span>&nbsp;<span class="ident" id="4813957">n</span>&nbsp;<span class="op" id="4813959">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4813963">panic</span><span class="op" id="4813968">(</span><span class="string" id="4813969">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4814004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814011">bitCount</span>&nbsp;<span class="op" id="4814020">:=</span>&nbsp;<span class="builtinfunc" id="4814023">make</span><span class="op" id="4814027">(</span><span class="op" id="4814028">[</span><span class="op" id="4814029">]</span><span class="builtintype" id="4814030">int32</span><span class="op" id="4814035">,</span>&nbsp;<span class="ident" id="4814037">maxBits</span><span class="op" id="4814044">+</span><span class="num" id="4814045">1</span><span class="op" id="4814046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814049">bits</span>&nbsp;<span class="op" id="4814054">:=</span>&nbsp;<span class="num" id="4814057">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814060">counts</span>&nbsp;<span class="op" id="4814067">:=</span>&nbsp;<span class="op" id="4814070">&amp;</span><span class="ident" id="4814071">leafCounts</span><span class="op" id="4814081">[</span><span class="ident" id="4814082">maxBits</span><span class="op" id="4814089">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814092">for</span>&nbsp;<span class="ident" id="4814096">level</span>&nbsp;<span class="op" id="4814102">:=</span>&nbsp;<span class="ident" id="4814105">maxBits</span><span class="op" id="4814112">;</span>&nbsp;<span class="ident" id="4814114">level</span>&nbsp;<span class="op" id="4814120">&gt;</span>&nbsp;<span class="num" id="4814122">0</span><span class="op" id="4814123">;</span>&nbsp;<span class="ident" id="4814125">level</span><span class="op" id="4814130">--</span>&nbsp;<span class="op" id="4814133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814137">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814213">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814234">bitCount</span><span class="op" id="4814242">[</span><span class="ident" id="4814243">bits</span><span class="op" id="4814247">]</span>&nbsp;<span class="op" id="4814249">=</span>&nbsp;<span class="ident" id="4814251">counts</span><span class="op" id="4814257">[</span><span class="ident" id="4814258">level</span><span class="op" id="4814263">]</span>&nbsp;<span class="op" id="4814265">-</span>&nbsp;<span class="ident" id="4814267">counts</span><span class="op" id="4814273">[</span><span class="ident" id="4814274">level</span><span class="op" id="4814279">-</span><span class="num" id="4814280">1</span><span class="op" id="4814281">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814285">bits</span><span class="op" id="4814289">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814296">return</span>&nbsp;<span class="ident" id="4814303">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4814312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4814315">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4814394">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4814415">func</span>&nbsp;<span class="op" id="4814420">(</span><span class="ident" id="4814421">h</span>&nbsp;<span class="op" id="4814423">*</span><span class="ident" id="4814424">huffmanEncoder</span><span class="op" id="4814438">)</span>&nbsp;<span class="ident" id="4814440">assignEncodingAndSize</span><span class="op" id="4814461">(</span><span class="ident" id="4814462">bitCount</span>&nbsp;<span class="op" id="4814471">[</span><span class="op" id="4814472">]</span><span class="builtintype" id="4814473">int32</span><span class="op" id="4814478">,</span>&nbsp;<span class="ident" id="4814480">list</span>&nbsp;<span class="op" id="4814485">[</span><span class="op" id="4814486">]</span><span class="ident" id="4814487">literalNode</span><span class="op" id="4814498">)</span>&nbsp;<span class="op" id="4814500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814503">code</span>&nbsp;<span class="op" id="4814508">:=</span>&nbsp;<span class="builtintype" id="4814511">uint16</span><span class="op" id="4814517">(</span><span class="num" id="4814518">0</span><span class="op" id="4814519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814522">for</span>&nbsp;<span class="ident" id="4814526">n</span><span class="op" id="4814527">,</span>&nbsp;<span class="ident" id="4814529">bits</span>&nbsp;<span class="op" id="4814534">:=</span>&nbsp;<span class="keyword" id="4814537">range</span>&nbsp;<span class="ident" id="4814543">bitCount</span>&nbsp;<span class="op" id="4814552">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814556">code</span>&nbsp;<span class="op" id="4814561">&lt;&lt;=</span>&nbsp;<span class="num" id="4814565">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814569">if</span>&nbsp;<span class="ident" id="4814572">n</span>&nbsp;<span class="op" id="4814574">==</span>&nbsp;<span class="num" id="4814577">0</span>&nbsp;<span class="op" id="4814579">||</span>&nbsp;<span class="ident" id="4814582">bits</span>&nbsp;<span class="op" id="4814587">==</span>&nbsp;<span class="num" id="4814590">0</span>&nbsp;<span class="op" id="4814592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814597">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814612">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814675">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814730">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814777">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814831">chunk</span>&nbsp;<span class="op" id="4814837">:=</span>&nbsp;<span class="ident" id="4814840">list</span><span class="op" id="4814844">[</span><span class="builtinfunc" id="4814845">len</span><span class="op" id="4814848">(</span><span class="ident" id="4814849">list</span><span class="op" id="4814853">)</span><span class="op" id="4814854">-</span><span class="builtintype" id="4814855">int</span><span class="op" id="4814858">(</span><span class="ident" id="4814859">bits</span><span class="op" id="4814863">)</span><span class="op" id="4814864">:</span><span class="op" id="4814865">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814869">sortByLiteral</span><span class="op" id="4814882">(</span><span class="ident" id="4814883">chunk</span><span class="op" id="4814888">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814892">for</span>&nbsp;<span class="ident" id="4814896">_</span><span class="op" id="4814897">,</span>&nbsp;<span class="ident" id="4814899">node</span>&nbsp;<span class="op" id="4814904">:=</span>&nbsp;<span class="keyword" id="4814907">range</span>&nbsp;<span class="ident" id="4814913">chunk</span>&nbsp;<span class="op" id="4814919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814924">h</span><span class="op" id="4814925">.</span><span class="ident" id="4814926">codeBits</span><span class="op" id="4814934">[</span><span class="ident" id="4814935">node</span><span class="op" id="4814939">.</span><span class="ident" id="4814940">literal</span><span class="op" id="4814947">]</span>&nbsp;<span class="op" id="4814949">=</span>&nbsp;<span class="builtintype" id="4814951">uint8</span><span class="op" id="4814956">(</span><span class="ident" id="4814957">n</span><span class="op" id="4814958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814963">h</span><span class="op" id="4814964">.</span><span class="ident" id="4814965">code</span><span class="op" id="4814969">[</span><span class="ident" id="4814970">node</span><span class="op" id="4814974">.</span><span class="ident" id="4814975">literal</span><span class="op" id="4814982">]</span>&nbsp;<span class="op" id="4814984">=</span>&nbsp;<span class="ident" id="4814986">reverseBits</span><span class="op" id="4814997">(</span><span class="ident" id="4814998">code</span><span class="op" id="4815002">,</span>&nbsp;<span class="builtintype" id="4815004">uint8</span><span class="op" id="4815009">(</span><span class="ident" id="4815010">n</span><span class="op" id="4815011">)</span><span class="op" id="4815012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815017">code</span><span class="op" id="4815021">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815026">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815030">list</span>&nbsp;<span class="op" id="4815035">=</span>&nbsp;<span class="ident" id="4815037">list</span><span class="op" id="4815041">[</span><span class="num" id="4815042">0</span>&nbsp;<span class="op" id="4815044">:</span>&nbsp;<span class="builtinfunc" id="4815046">len</span><span class="op" id="4815049">(</span><span class="ident" id="4815050">list</span><span class="op" id="4815054">)</span><span class="op" id="4815055">-</span><span class="builtintype" id="4815056">int</span><span class="op" id="4815059">(</span><span class="ident" id="4815060">bits</span><span class="op" id="4815064">)</span><span class="op" id="4815065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815068">}</span><br>
<span class="lineno"></span><span class="op" id="4815070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815073">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4815166">//</span><br>
<span class="lineno"></span><span class="comment" id="4815169">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4815259">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4815322">func</span>&nbsp;<span class="op" id="4815327">(</span><span class="ident" id="4815328">h</span>&nbsp;<span class="op" id="4815330">*</span><span class="ident" id="4815331">huffmanEncoder</span><span class="op" id="4815345">)</span>&nbsp;<span class="ident" id="4815347">generate</span><span class="op" id="4815355">(</span><span class="ident" id="4815356">freq</span>&nbsp;<span class="op" id="4815361">[</span><span class="op" id="4815362">]</span><span class="builtintype" id="4815363">int32</span><span class="op" id="4815368">,</span>&nbsp;<span class="ident" id="4815370">maxBits</span>&nbsp;<span class="builtintype" id="4815378">int32</span><span class="op" id="4815383">)</span>&nbsp;<span class="op" id="4815385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815388">list</span>&nbsp;<span class="op" id="4815393">:=</span>&nbsp;<span class="builtinfunc" id="4815396">make</span><span class="op" id="4815400">(</span><span class="op" id="4815401">[</span><span class="op" id="4815402">]</span><span class="ident" id="4815403">literalNode</span><span class="op" id="4815414">,</span>&nbsp;<span class="builtinfunc" id="4815416">len</span><span class="op" id="4815419">(</span><span class="ident" id="4815420">freq</span><span class="op" id="4815424">)</span><span class="op" id="4815425">+</span><span class="num" id="4815426">1</span><span class="op" id="4815427">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815430">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815462">count</span>&nbsp;<span class="op" id="4815468">:=</span>&nbsp;<span class="num" id="4815471">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815474">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815548">for</span>&nbsp;<span class="ident" id="4815552">i</span><span class="op" id="4815553">,</span>&nbsp;<span class="ident" id="4815555">f</span>&nbsp;<span class="op" id="4815557">:=</span>&nbsp;<span class="keyword" id="4815560">range</span>&nbsp;<span class="ident" id="4815566">freq</span>&nbsp;<span class="op" id="4815571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815575">if</span>&nbsp;<span class="ident" id="4815578">f</span>&nbsp;<span class="op" id="4815580">!=</span>&nbsp;<span class="num" id="4815583">0</span>&nbsp;<span class="op" id="4815585">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815590">list</span><span class="op" id="4815594">[</span><span class="ident" id="4815595">count</span><span class="op" id="4815600">]</span>&nbsp;<span class="op" id="4815602">=</span>&nbsp;<span class="ident" id="4815604">literalNode</span><span class="op" id="4815615">{</span><span class="builtintype" id="4815616">uint16</span><span class="op" id="4815622">(</span><span class="ident" id="4815623">i</span><span class="op" id="4815624">)</span><span class="op" id="4815625">,</span>&nbsp;<span class="ident" id="4815627">f</span><span class="op" id="4815628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815633">count</span><span class="op" id="4815638">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815643">}</span>&nbsp;<span class="keyword" id="4815645">else</span>&nbsp;<span class="op" id="4815650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815655">h</span><span class="op" id="4815656">.</span><span class="ident" id="4815657">codeBits</span><span class="op" id="4815665">[</span><span class="ident" id="4815666">i</span><span class="op" id="4815667">]</span>&nbsp;<span class="op" id="4815669">=</span>&nbsp;<span class="num" id="4815671">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815675">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815681">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815758">h</span><span class="op" id="4815759">.</span><span class="ident" id="4815760">codeBits</span>&nbsp;<span class="op" id="4815769">=</span>&nbsp;<span class="ident" id="4815771">h</span><span class="op" id="4815772">.</span><span class="ident" id="4815773">codeBits</span><span class="op" id="4815781">[</span><span class="num" id="4815782">0</span><span class="op" id="4815783">:</span><span class="builtinfunc" id="4815784">len</span><span class="op" id="4815787">(</span><span class="ident" id="4815788">freq</span><span class="op" id="4815792">)</span><span class="op" id="4815793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815796">list</span>&nbsp;<span class="op" id="4815801">=</span>&nbsp;<span class="ident" id="4815803">list</span><span class="op" id="4815807">[</span><span class="num" id="4815808">0</span><span class="op" id="4815809">:</span><span class="ident" id="4815810">count</span><span class="op" id="4815815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815818">if</span>&nbsp;<span class="ident" id="4815821">count</span>&nbsp;<span class="op" id="4815827">&lt;=</span>&nbsp;<span class="num" id="4815830">2</span>&nbsp;<span class="op" id="4815832">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815836">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815928">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815985">for</span>&nbsp;<span class="ident" id="4815989">i</span><span class="op" id="4815990">,</span>&nbsp;<span class="ident" id="4815992">node</span>&nbsp;<span class="op" id="4815997">:=</span>&nbsp;<span class="keyword" id="4816000">range</span>&nbsp;<span class="ident" id="4816006">list</span>&nbsp;<span class="op" id="4816011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4816016">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816070">h</span><span class="op" id="4816071">.</span><span class="ident" id="4816072">codeBits</span><span class="op" id="4816080">[</span><span class="ident" id="4816081">node</span><span class="op" id="4816085">.</span><span class="ident" id="4816086">literal</span><span class="op" id="4816093">]</span>&nbsp;<span class="op" id="4816095">=</span>&nbsp;<span class="num" id="4816097">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816102">h</span><span class="op" id="4816103">.</span><span class="ident" id="4816104">code</span><span class="op" id="4816108">[</span><span class="ident" id="4816109">node</span><span class="op" id="4816113">.</span><span class="ident" id="4816114">literal</span><span class="op" id="4816121">]</span>&nbsp;<span class="op" id="4816123">=</span>&nbsp;<span class="builtintype" id="4816125">uint16</span><span class="op" id="4816131">(</span><span class="ident" id="4816132">i</span><span class="op" id="4816133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816141">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816152">sortByFreq</span><span class="op" id="4816162">(</span><span class="ident" id="4816163">list</span><span class="op" id="4816167">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4816171">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816221">bitCount</span>&nbsp;<span class="op" id="4816230">:=</span>&nbsp;<span class="ident" id="4816233">h</span><span class="op" id="4816234">.</span><span class="ident" id="4816235">bitCounts</span><span class="op" id="4816244">(</span><span class="ident" id="4816245">list</span><span class="op" id="4816249">,</span>&nbsp;<span class="ident" id="4816251">maxBits</span><span class="op" id="4816258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4816261">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816287">h</span><span class="op" id="4816288">.</span><span class="ident" id="4816289">assignEncodingAndSize</span><span class="op" id="4816310">(</span><span class="ident" id="4816311">bitCount</span><span class="op" id="4816319">,</span>&nbsp;<span class="ident" id="4816321">list</span><span class="op" id="4816325">)</span><br>
<span class="lineno">295</span><span class="op" id="4816327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816330">type</span>&nbsp;<span class="ident" id="4816335">literalNodeSorter</span>&nbsp;<span class="keyword" id="4816353">struct</span>&nbsp;<span class="op" id="4816360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816363">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816368">[</span><span class="op" id="4816369">]</span><span class="ident" id="4816370">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816383">less</span>&nbsp;<span class="keyword" id="4816388">func</span><span class="op" id="4816392">(</span><span class="ident" id="4816393">i</span><span class="op" id="4816394">,</span>&nbsp;<span class="ident" id="4816396">j</span>&nbsp;<span class="builtintype" id="4816398">int</span><span class="op" id="4816401">)</span>&nbsp;<span class="builtintype" id="4816403">bool</span><br>
<span class="lineno">300</span><span class="op" id="4816408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816411">func</span>&nbsp;<span class="op" id="4816416">(</span><span class="ident" id="4816417">s</span>&nbsp;<span class="ident" id="4816419">literalNodeSorter</span><span class="op" id="4816436">)</span>&nbsp;<span class="ident" id="4816438">Len</span><span class="op" id="4816441">(</span><span class="op" id="4816442">)</span>&nbsp;<span class="builtintype" id="4816444">int</span>&nbsp;<span class="op" id="4816448">{</span>&nbsp;<span class="keyword" id="4816450">return</span>&nbsp;<span class="builtinfunc" id="4816457">len</span><span class="op" id="4816460">(</span><span class="ident" id="4816461">s</span><span class="op" id="4816462">.</span><span class="ident" id="4816463">a</span><span class="op" id="4816464">)</span>&nbsp;<span class="op" id="4816466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816469">func</span>&nbsp;<span class="op" id="4816474">(</span><span class="ident" id="4816475">s</span>&nbsp;<span class="ident" id="4816477">literalNodeSorter</span><span class="op" id="4816494">)</span>&nbsp;<span class="ident" id="4816496">Less</span><span class="op" id="4816500">(</span><span class="ident" id="4816501">i</span><span class="op" id="4816502">,</span>&nbsp;<span class="ident" id="4816504">j</span>&nbsp;<span class="builtintype" id="4816506">int</span><span class="op" id="4816509">)</span>&nbsp;<span class="builtintype" id="4816511">bool</span>&nbsp;<span class="op" id="4816516">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816519">return</span>&nbsp;<span class="ident" id="4816526">s</span><span class="op" id="4816527">.</span><span class="ident" id="4816528">less</span><span class="op" id="4816532">(</span><span class="ident" id="4816533">i</span><span class="op" id="4816534">,</span>&nbsp;<span class="ident" id="4816536">j</span><span class="op" id="4816537">)</span><br>
<span class="lineno"></span><span class="op" id="4816539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816542">func</span>&nbsp;<span class="op" id="4816547">(</span><span class="ident" id="4816548">s</span>&nbsp;<span class="ident" id="4816550">literalNodeSorter</span><span class="op" id="4816567">)</span>&nbsp;<span class="ident" id="4816569">Swap</span><span class="op" id="4816573">(</span><span class="ident" id="4816574">i</span><span class="op" id="4816575">,</span>&nbsp;<span class="ident" id="4816577">j</span>&nbsp;<span class="builtintype" id="4816579">int</span><span class="op" id="4816582">)</span>&nbsp;<span class="op" id="4816584">{</span>&nbsp;<span class="ident" id="4816586">s</span><span class="op" id="4816587">.</span><span class="ident" id="4816588">a</span><span class="op" id="4816589">[</span><span class="ident" id="4816590">i</span><span class="op" id="4816591">]</span><span class="op" id="4816592">,</span>&nbsp;<span class="ident" id="4816594">s</span><span class="op" id="4816595">.</span><span class="ident" id="4816596">a</span><span class="op" id="4816597">[</span><span class="ident" id="4816598">j</span><span class="op" id="4816599">]</span>&nbsp;<span class="op" id="4816601">=</span>&nbsp;<span class="ident" id="4816603">s</span><span class="op" id="4816604">.</span><span class="ident" id="4816605">a</span><span class="op" id="4816606">[</span><span class="ident" id="4816607">j</span><span class="op" id="4816608">]</span><span class="op" id="4816609">,</span>&nbsp;<span class="ident" id="4816611">s</span><span class="op" id="4816612">.</span><span class="ident" id="4816613">a</span><span class="op" id="4816614">[</span><span class="ident" id="4816615">i</span><span class="op" id="4816616">]</span>&nbsp;<span class="op" id="4816618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4816621">func</span>&nbsp;<span class="ident" id="4816626">sortByFreq</span><span class="op" id="4816636">(</span><span class="ident" id="4816637">a</span>&nbsp;<span class="op" id="4816639">[</span><span class="op" id="4816640">]</span><span class="ident" id="4816641">literalNode</span><span class="op" id="4816652">)</span>&nbsp;<span class="op" id="4816654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816657">s</span>&nbsp;<span class="op" id="4816659">:=</span>&nbsp;<span class="op" id="4816662">&amp;</span><span class="ident" id="4816663">literalNodeSorter</span><span class="op" id="4816680">{</span><span class="ident" id="4816681">a</span><span class="op" id="4816682">,</span>&nbsp;<span class="keyword" id="4816684">func</span><span class="op" id="4816688">(</span><span class="ident" id="4816689">i</span><span class="op" id="4816690">,</span>&nbsp;<span class="ident" id="4816692">j</span>&nbsp;<span class="builtintype" id="4816694">int</span><span class="op" id="4816697">)</span>&nbsp;<span class="builtintype" id="4816699">bool</span>&nbsp;<span class="op" id="4816704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816708">if</span>&nbsp;<span class="ident" id="4816711">a</span><span class="op" id="4816712">[</span><span class="ident" id="4816713">i</span><span class="op" id="4816714">]</span><span class="op" id="4816715">.</span><span class="ident" id="4816716">freq</span>&nbsp;<span class="op" id="4816721">==</span>&nbsp;<span class="ident" id="4816724">a</span><span class="op" id="4816725">[</span><span class="ident" id="4816726">j</span><span class="op" id="4816727">]</span><span class="op" id="4816728">.</span><span class="ident" id="4816729">freq</span>&nbsp;<span class="op" id="4816734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816739">return</span>&nbsp;<span class="ident" id="4816746">a</span><span class="op" id="4816747">[</span><span class="ident" id="4816748">i</span><span class="op" id="4816749">]</span><span class="op" id="4816750">.</span><span class="ident" id="4816751">literal</span>&nbsp;<span class="op" id="4816759">&lt;</span>&nbsp;<span class="ident" id="4816761">a</span><span class="op" id="4816762">[</span><span class="ident" id="4816763">j</span><span class="op" id="4816764">]</span><span class="op" id="4816765">.</span><span class="ident" id="4816766">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816776">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816780">return</span>&nbsp;<span class="ident" id="4816787">a</span><span class="op" id="4816788">[</span><span class="ident" id="4816789">i</span><span class="op" id="4816790">]</span><span class="op" id="4816791">.</span><span class="ident" id="4816792">freq</span>&nbsp;<span class="op" id="4816797">&lt;</span>&nbsp;<span class="ident" id="4816799">a</span><span class="op" id="4816800">[</span><span class="ident" id="4816801">j</span><span class="op" id="4816802">]</span><span class="op" id="4816803">.</span><span class="ident" id="4816804">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816810">}</span><span class="op" id="4816811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816814">sort</span><span class="op" id="4816818">.</span><span class="ident" id="4816819">Sort</span><span class="op" id="4816823">(</span><span class="ident" id="4816824">s</span><span class="op" id="4816825">)</span><br>
<span class="lineno"></span><span class="op" id="4816827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4816830">func</span>&nbsp;<span class="ident" id="4816835">sortByLiteral</span><span class="op" id="4816848">(</span><span class="ident" id="4816849">a</span>&nbsp;<span class="op" id="4816851">[</span><span class="op" id="4816852">]</span><span class="ident" id="4816853">literalNode</span><span class="op" id="4816864">)</span>&nbsp;<span class="op" id="4816866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816869">s</span>&nbsp;<span class="op" id="4816871">:=</span>&nbsp;<span class="op" id="4816874">&amp;</span><span class="ident" id="4816875">literalNodeSorter</span><span class="op" id="4816892">{</span><span class="ident" id="4816893">a</span><span class="op" id="4816894">,</span>&nbsp;<span class="keyword" id="4816896">func</span><span class="op" id="4816900">(</span><span class="ident" id="4816901">i</span><span class="op" id="4816902">,</span>&nbsp;<span class="ident" id="4816904">j</span>&nbsp;<span class="builtintype" id="4816906">int</span><span class="op" id="4816909">)</span>&nbsp;<span class="builtintype" id="4816911">bool</span>&nbsp;<span class="op" id="4816916">{</span>&nbsp;<span class="keyword" id="4816918">return</span>&nbsp;<span class="ident" id="4816925">a</span><span class="op" id="4816926">[</span><span class="ident" id="4816927">i</span><span class="op" id="4816928">]</span><span class="op" id="4816929">.</span><span class="ident" id="4816930">literal</span>&nbsp;<span class="op" id="4816938">&lt;</span>&nbsp;<span class="ident" id="4816940">a</span><span class="op" id="4816941">[</span><span class="ident" id="4816942">j</span><span class="op" id="4816943">]</span><span class="op" id="4816944">.</span><span class="ident" id="4816945">literal</span>&nbsp;<span class="op" id="4816953">}</span><span class="op" id="4816954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816957">sort</span><span class="op" id="4816961">.</span><span class="ident" id="4816962">Sort</span><span class="op" id="4816966">(</span><span class="ident" id="4816967">s</span><span class="op" id="4816968">)</span><br>
<span class="lineno"></span><span class="op" id="4816970">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
