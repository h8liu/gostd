<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1895294">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1895349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1895403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1895454">package</span>&nbsp;<span class="ident" id="1895462">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1895471">import</span>&nbsp;<span class="op" id="1895478">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1895481">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1895490">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1895493">func</span>&nbsp;<span class="ident" id="1895498">mapaccess1_fast32</span><span class="op" id="1895515">(</span><span class="ident" id="1895516">t</span>&nbsp;<span class="op" id="1895518">*</span><span class="ident" id="1895519">maptype</span><span class="op" id="1895526">,</span>&nbsp;<span class="ident" id="1895528">h</span>&nbsp;<span class="op" id="1895530">*</span><span class="ident" id="1895531">hmap</span><span class="op" id="1895535">,</span>&nbsp;<span class="ident" id="1895537">key</span>&nbsp;<span class="builtintype" id="1895541">uint32</span><span class="op" id="1895547">)</span>&nbsp;<span class="ident" id="1895549">unsafe</span><span class="op" id="1895555">.</span><span class="ident" id="1895556">Pointer</span>&nbsp;<span class="op" id="1895564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895567">if</span>&nbsp;<span class="ident" id="1895570">raceenabled</span>&nbsp;<span class="op" id="1895582">&amp;&amp;</span>&nbsp;<span class="ident" id="1895585">h</span>&nbsp;<span class="op" id="1895587">!=</span>&nbsp;<span class="ident" id="1895590">nil</span>&nbsp;<span class="op" id="1895594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895598">callerpc</span>&nbsp;<span class="op" id="1895607">:=</span>&nbsp;<span class="ident" id="1895610">getcallerpc</span><span class="op" id="1895621">(</span><span class="ident" id="1895622">unsafe</span><span class="op" id="1895628">.</span><span class="ident" id="1895629">Pointer</span><span class="op" id="1895636">(</span><span class="op" id="1895637">&amp;</span><span class="ident" id="1895638">t</span><span class="op" id="1895639">)</span><span class="op" id="1895640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895644">racereadpc</span><span class="op" id="1895654">(</span><span class="ident" id="1895655">unsafe</span><span class="op" id="1895661">.</span><span class="ident" id="1895662">Pointer</span><span class="op" id="1895669">(</span><span class="ident" id="1895670">h</span><span class="op" id="1895671">)</span><span class="op" id="1895672">,</span>&nbsp;<span class="ident" id="1895674">callerpc</span><span class="op" id="1895682">,</span>&nbsp;<span class="ident" id="1895684">funcPC</span><span class="op" id="1895690">(</span><span class="ident" id="1895691">mapaccess1_fast32</span><span class="op" id="1895708">)</span><span class="op" id="1895709">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895715">if</span>&nbsp;<span class="ident" id="1895718">h</span>&nbsp;<span class="op" id="1895720">==</span>&nbsp;<span class="ident" id="1895723">nil</span>&nbsp;<span class="op" id="1895727">||</span>&nbsp;<span class="ident" id="1895730">h</span><span class="op" id="1895731">.</span><span class="ident" id="1895732">count</span>&nbsp;<span class="op" id="1895738">==</span>&nbsp;<span class="num" id="1895741">0</span>&nbsp;<span class="op" id="1895743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895747">return</span>&nbsp;<span class="ident" id="1895754">unsafe</span><span class="op" id="1895760">.</span><span class="ident" id="1895761">Pointer</span><span class="op" id="1895768">(</span><span class="ident" id="1895769">t</span><span class="op" id="1895770">.</span><span class="ident" id="1895771">elem</span><span class="op" id="1895775">.</span><span class="ident" id="1895776">zero</span><span class="op" id="1895780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895786">var</span>&nbsp;<span class="ident" id="1895790">b</span>&nbsp;<span class="op" id="1895792">*</span><span class="ident" id="1895793">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895799">if</span>&nbsp;<span class="ident" id="1895802">h</span><span class="op" id="1895803">.</span><span class="ident" id="1895804">B</span>&nbsp;<span class="op" id="1895806">==</span>&nbsp;<span class="num" id="1895809">0</span>&nbsp;<span class="op" id="1895811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895815">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895856">b</span>&nbsp;<span class="op" id="1895858">=</span>&nbsp;<span class="op" id="1895860">(</span><span class="op" id="1895861">*</span><span class="ident" id="1895862">bmap</span><span class="op" id="1895866">)</span><span class="op" id="1895867">(</span><span class="ident" id="1895868">h</span><span class="op" id="1895869">.</span><span class="ident" id="1895870">buckets</span><span class="op" id="1895877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895880">}</span>&nbsp;<span class="keyword" id="1895882">else</span>&nbsp;<span class="op" id="1895887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895891">hash</span>&nbsp;<span class="op" id="1895896">:=</span>&nbsp;<span class="ident" id="1895899">goalg</span><span class="op" id="1895904">(</span><span class="ident" id="1895905">t</span><span class="op" id="1895906">.</span><span class="ident" id="1895907">key</span><span class="op" id="1895910">.</span><span class="ident" id="1895911">alg</span><span class="op" id="1895914">)</span><span class="op" id="1895915">.</span><span class="ident" id="1895916">hash</span><span class="op" id="1895920">(</span><span class="ident" id="1895921">noescape</span><span class="op" id="1895929">(</span><span class="ident" id="1895930">unsafe</span><span class="op" id="1895936">.</span><span class="ident" id="1895937">Pointer</span><span class="op" id="1895944">(</span><span class="op" id="1895945">&amp;</span><span class="ident" id="1895946">key</span><span class="op" id="1895949">)</span><span class="op" id="1895950">)</span><span class="op" id="1895951">,</span>&nbsp;<span class="num" id="1895953">4</span><span class="op" id="1895954">,</span>&nbsp;<span class="builtintype" id="1895956">uintptr</span><span class="op" id="1895963">(</span><span class="ident" id="1895964">h</span><span class="op" id="1895965">.</span><span class="ident" id="1895966">hash0</span><span class="op" id="1895971">)</span><span class="op" id="1895972">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895976">m</span>&nbsp;<span class="op" id="1895978">:=</span>&nbsp;<span class="builtintype" id="1895981">uintptr</span><span class="op" id="1895988">(</span><span class="num" id="1895989">1</span><span class="op" id="1895990">)</span><span class="op" id="1895991">&lt;&lt;</span><span class="ident" id="1895993">h</span><span class="op" id="1895994">.</span><span class="ident" id="1895995">B</span>&nbsp;<span class="op" id="1895997">-</span>&nbsp;<span class="num" id="1895999">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896003">b</span>&nbsp;<span class="op" id="1896005">=</span>&nbsp;<span class="op" id="1896007">(</span><span class="op" id="1896008">*</span><span class="ident" id="1896009">bmap</span><span class="op" id="1896013">)</span><span class="op" id="1896014">(</span><span class="ident" id="1896015">add</span><span class="op" id="1896018">(</span><span class="ident" id="1896019">h</span><span class="op" id="1896020">.</span><span class="ident" id="1896021">buckets</span><span class="op" id="1896028">,</span>&nbsp;<span class="op" id="1896030">(</span><span class="ident" id="1896031">hash</span><span class="op" id="1896035">&amp;</span><span class="ident" id="1896036">m</span><span class="op" id="1896037">)</span><span class="op" id="1896038">*</span><span class="builtintype" id="1896039">uintptr</span><span class="op" id="1896046">(</span><span class="ident" id="1896047">t</span><span class="op" id="1896048">.</span><span class="ident" id="1896049">bucketsize</span><span class="op" id="1896059">)</span><span class="op" id="1896060">)</span><span class="op" id="1896061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896065">if</span>&nbsp;<span class="ident" id="1896068">c</span>&nbsp;<span class="op" id="1896070">:=</span>&nbsp;<span class="ident" id="1896073">h</span><span class="op" id="1896074">.</span><span class="ident" id="1896075">oldbuckets</span><span class="op" id="1896085">;</span>&nbsp;<span class="ident" id="1896087">c</span>&nbsp;<span class="op" id="1896089">!=</span>&nbsp;<span class="ident" id="1896092">nil</span>&nbsp;<span class="op" id="1896096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896101">oldb</span>&nbsp;<span class="op" id="1896106">:=</span>&nbsp;<span class="op" id="1896109">(</span><span class="op" id="1896110">*</span><span class="ident" id="1896111">bmap</span><span class="op" id="1896115">)</span><span class="op" id="1896116">(</span><span class="ident" id="1896117">add</span><span class="op" id="1896120">(</span><span class="ident" id="1896121">c</span><span class="op" id="1896122">,</span>&nbsp;<span class="op" id="1896124">(</span><span class="ident" id="1896125">hash</span><span class="op" id="1896129">&amp;</span><span class="op" id="1896130">(</span><span class="ident" id="1896131">m</span><span class="op" id="1896132">&gt;&gt;</span><span class="num" id="1896134">1</span><span class="op" id="1896135">)</span><span class="op" id="1896136">)</span><span class="op" id="1896137">*</span><span class="builtintype" id="1896138">uintptr</span><span class="op" id="1896145">(</span><span class="ident" id="1896146">t</span><span class="op" id="1896147">.</span><span class="ident" id="1896148">bucketsize</span><span class="op" id="1896158">)</span><span class="op" id="1896159">)</span><span class="op" id="1896160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896165">if</span>&nbsp;<span class="op" id="1896168">!</span><span class="ident" id="1896169">evacuated</span><span class="op" id="1896178">(</span><span class="ident" id="1896179">oldb</span><span class="op" id="1896183">)</span>&nbsp;<span class="op" id="1896185">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896191">b</span>&nbsp;<span class="op" id="1896193">=</span>&nbsp;<span class="ident" id="1896195">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896213">for</span>&nbsp;<span class="op" id="1896217">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896221">for</span>&nbsp;<span class="ident" id="1896225">i</span>&nbsp;<span class="op" id="1896227">:=</span>&nbsp;<span class="builtintype" id="1896230">uintptr</span><span class="op" id="1896237">(</span><span class="num" id="1896238">0</span><span class="op" id="1896239">)</span><span class="op" id="1896240">;</span>&nbsp;<span class="ident" id="1896242">i</span>&nbsp;<span class="op" id="1896244">&lt;</span>&nbsp;<span class="ident" id="1896246">bucketCnt</span><span class="op" id="1896255">;</span>&nbsp;<span class="ident" id="1896257">i</span><span class="op" id="1896258">++</span>&nbsp;<span class="op" id="1896261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896266">k</span>&nbsp;<span class="op" id="1896268">:=</span>&nbsp;<span class="op" id="1896271">*</span><span class="op" id="1896272">(</span><span class="op" id="1896273">(</span><span class="op" id="1896274">*</span><span class="builtintype" id="1896275">uint32</span><span class="op" id="1896281">)</span><span class="op" id="1896282">(</span><span class="ident" id="1896283">add</span><span class="op" id="1896286">(</span><span class="ident" id="1896287">unsafe</span><span class="op" id="1896293">.</span><span class="ident" id="1896294">Pointer</span><span class="op" id="1896301">(</span><span class="ident" id="1896302">b</span><span class="op" id="1896303">)</span><span class="op" id="1896304">,</span>&nbsp;<span class="ident" id="1896306">dataOffset</span><span class="op" id="1896316">+</span><span class="ident" id="1896317">i</span><span class="op" id="1896318">*</span><span class="num" id="1896319">4</span><span class="op" id="1896320">)</span><span class="op" id="1896321">)</span><span class="op" id="1896322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896327">if</span>&nbsp;<span class="ident" id="1896330">k</span>&nbsp;<span class="op" id="1896332">!=</span>&nbsp;<span class="ident" id="1896335">key</span>&nbsp;<span class="op" id="1896339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896345">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896357">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896362">x</span>&nbsp;<span class="op" id="1896364">:=</span>&nbsp;<span class="op" id="1896367">*</span><span class="op" id="1896368">(</span><span class="op" id="1896369">(</span><span class="op" id="1896370">*</span><span class="builtintype" id="1896371">uint8</span><span class="op" id="1896376">)</span><span class="op" id="1896377">(</span><span class="ident" id="1896378">add</span><span class="op" id="1896381">(</span><span class="ident" id="1896382">unsafe</span><span class="op" id="1896388">.</span><span class="ident" id="1896389">Pointer</span><span class="op" id="1896396">(</span><span class="ident" id="1896397">b</span><span class="op" id="1896398">)</span><span class="op" id="1896399">,</span>&nbsp;<span class="ident" id="1896401">i</span><span class="op" id="1896402">)</span><span class="op" id="1896403">)</span><span class="op" id="1896404">)</span>&nbsp;<span class="comment" id="1896406">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896450">if</span>&nbsp;<span class="ident" id="1896453">x</span>&nbsp;<span class="op" id="1896455">==</span>&nbsp;<span class="ident" id="1896458">empty</span>&nbsp;<span class="op" id="1896464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896470">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896487">return</span>&nbsp;<span class="ident" id="1896494">add</span><span class="op" id="1896497">(</span><span class="ident" id="1896498">unsafe</span><span class="op" id="1896504">.</span><span class="ident" id="1896505">Pointer</span><span class="op" id="1896512">(</span><span class="ident" id="1896513">b</span><span class="op" id="1896514">)</span><span class="op" id="1896515">,</span>&nbsp;<span class="ident" id="1896517">dataOffset</span><span class="op" id="1896527">+</span><span class="ident" id="1896528">bucketCnt</span><span class="op" id="1896537">*</span><span class="num" id="1896538">4</span><span class="op" id="1896539">+</span><span class="ident" id="1896540">i</span><span class="op" id="1896541">*</span><span class="builtintype" id="1896542">uintptr</span><span class="op" id="1896549">(</span><span class="ident" id="1896550">t</span><span class="op" id="1896551">.</span><span class="ident" id="1896552">valuesize</span><span class="op" id="1896561">)</span><span class="op" id="1896562">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896570">b</span>&nbsp;<span class="op" id="1896572">=</span>&nbsp;<span class="ident" id="1896574">b</span><span class="op" id="1896575">.</span><span class="ident" id="1896576">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896587">if</span>&nbsp;<span class="ident" id="1896590">b</span>&nbsp;<span class="op" id="1896592">==</span>&nbsp;<span class="ident" id="1896595">nil</span>&nbsp;<span class="op" id="1896599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896604">return</span>&nbsp;<span class="ident" id="1896611">unsafe</span><span class="op" id="1896617">.</span><span class="ident" id="1896618">Pointer</span><span class="op" id="1896625">(</span><span class="ident" id="1896626">t</span><span class="op" id="1896627">.</span><span class="ident" id="1896628">elem</span><span class="op" id="1896632">.</span><span class="ident" id="1896633">zero</span><span class="op" id="1896637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896641">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896644">}</span><br>
<span class="lineno"></span><span class="op" id="1896646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1896649">func</span>&nbsp;<span class="ident" id="1896654">mapaccess2_fast32</span><span class="op" id="1896671">(</span><span class="ident" id="1896672">t</span>&nbsp;<span class="op" id="1896674">*</span><span class="ident" id="1896675">maptype</span><span class="op" id="1896682">,</span>&nbsp;<span class="ident" id="1896684">h</span>&nbsp;<span class="op" id="1896686">*</span><span class="ident" id="1896687">hmap</span><span class="op" id="1896691">,</span>&nbsp;<span class="ident" id="1896693">key</span>&nbsp;<span class="builtintype" id="1896697">uint32</span><span class="op" id="1896703">)</span>&nbsp;<span class="op" id="1896705">(</span><span class="ident" id="1896706">unsafe</span><span class="op" id="1896712">.</span><span class="ident" id="1896713">Pointer</span><span class="op" id="1896720">,</span>&nbsp;<span class="builtintype" id="1896722">bool</span><span class="op" id="1896726">)</span>&nbsp;<span class="op" id="1896728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896731">if</span>&nbsp;<span class="ident" id="1896734">raceenabled</span>&nbsp;<span class="op" id="1896746">&amp;&amp;</span>&nbsp;<span class="ident" id="1896749">h</span>&nbsp;<span class="op" id="1896751">!=</span>&nbsp;<span class="ident" id="1896754">nil</span>&nbsp;<span class="op" id="1896758">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896762">callerpc</span>&nbsp;<span class="op" id="1896771">:=</span>&nbsp;<span class="ident" id="1896774">getcallerpc</span><span class="op" id="1896785">(</span><span class="ident" id="1896786">unsafe</span><span class="op" id="1896792">.</span><span class="ident" id="1896793">Pointer</span><span class="op" id="1896800">(</span><span class="op" id="1896801">&amp;</span><span class="ident" id="1896802">t</span><span class="op" id="1896803">)</span><span class="op" id="1896804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896808">racereadpc</span><span class="op" id="1896818">(</span><span class="ident" id="1896819">unsafe</span><span class="op" id="1896825">.</span><span class="ident" id="1896826">Pointer</span><span class="op" id="1896833">(</span><span class="ident" id="1896834">h</span><span class="op" id="1896835">)</span><span class="op" id="1896836">,</span>&nbsp;<span class="ident" id="1896838">callerpc</span><span class="op" id="1896846">,</span>&nbsp;<span class="ident" id="1896848">funcPC</span><span class="op" id="1896854">(</span><span class="ident" id="1896855">mapaccess2_fast32</span><span class="op" id="1896872">)</span><span class="op" id="1896873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896879">if</span>&nbsp;<span class="ident" id="1896882">h</span>&nbsp;<span class="op" id="1896884">==</span>&nbsp;<span class="ident" id="1896887">nil</span>&nbsp;<span class="op" id="1896891">||</span>&nbsp;<span class="ident" id="1896894">h</span><span class="op" id="1896895">.</span><span class="ident" id="1896896">count</span>&nbsp;<span class="op" id="1896902">==</span>&nbsp;<span class="num" id="1896905">0</span>&nbsp;<span class="op" id="1896907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896911">return</span>&nbsp;<span class="ident" id="1896918">unsafe</span><span class="op" id="1896924">.</span><span class="ident" id="1896925">Pointer</span><span class="op" id="1896932">(</span><span class="ident" id="1896933">t</span><span class="op" id="1896934">.</span><span class="ident" id="1896935">elem</span><span class="op" id="1896939">.</span><span class="ident" id="1896940">zero</span><span class="op" id="1896944">)</span><span class="op" id="1896945">,</span>&nbsp;<span class="builtintype" id="1896947">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896957">var</span>&nbsp;<span class="ident" id="1896961">b</span>&nbsp;<span class="op" id="1896963">*</span><span class="ident" id="1896964">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896970">if</span>&nbsp;<span class="ident" id="1896973">h</span><span class="op" id="1896974">.</span><span class="ident" id="1896975">B</span>&nbsp;<span class="op" id="1896977">==</span>&nbsp;<span class="num" id="1896980">0</span>&nbsp;<span class="op" id="1896982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1896986">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897027">b</span>&nbsp;<span class="op" id="1897029">=</span>&nbsp;<span class="op" id="1897031">(</span><span class="op" id="1897032">*</span><span class="ident" id="1897033">bmap</span><span class="op" id="1897037">)</span><span class="op" id="1897038">(</span><span class="ident" id="1897039">h</span><span class="op" id="1897040">.</span><span class="ident" id="1897041">buckets</span><span class="op" id="1897048">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897051">}</span>&nbsp;<span class="keyword" id="1897053">else</span>&nbsp;<span class="op" id="1897058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897062">hash</span>&nbsp;<span class="op" id="1897067">:=</span>&nbsp;<span class="ident" id="1897070">goalg</span><span class="op" id="1897075">(</span><span class="ident" id="1897076">t</span><span class="op" id="1897077">.</span><span class="ident" id="1897078">key</span><span class="op" id="1897081">.</span><span class="ident" id="1897082">alg</span><span class="op" id="1897085">)</span><span class="op" id="1897086">.</span><span class="ident" id="1897087">hash</span><span class="op" id="1897091">(</span><span class="ident" id="1897092">noescape</span><span class="op" id="1897100">(</span><span class="ident" id="1897101">unsafe</span><span class="op" id="1897107">.</span><span class="ident" id="1897108">Pointer</span><span class="op" id="1897115">(</span><span class="op" id="1897116">&amp;</span><span class="ident" id="1897117">key</span><span class="op" id="1897120">)</span><span class="op" id="1897121">)</span><span class="op" id="1897122">,</span>&nbsp;<span class="num" id="1897124">4</span><span class="op" id="1897125">,</span>&nbsp;<span class="builtintype" id="1897127">uintptr</span><span class="op" id="1897134">(</span><span class="ident" id="1897135">h</span><span class="op" id="1897136">.</span><span class="ident" id="1897137">hash0</span><span class="op" id="1897142">)</span><span class="op" id="1897143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897147">m</span>&nbsp;<span class="op" id="1897149">:=</span>&nbsp;<span class="builtintype" id="1897152">uintptr</span><span class="op" id="1897159">(</span><span class="num" id="1897160">1</span><span class="op" id="1897161">)</span><span class="op" id="1897162">&lt;&lt;</span><span class="ident" id="1897164">h</span><span class="op" id="1897165">.</span><span class="ident" id="1897166">B</span>&nbsp;<span class="op" id="1897168">-</span>&nbsp;<span class="num" id="1897170">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897174">b</span>&nbsp;<span class="op" id="1897176">=</span>&nbsp;<span class="op" id="1897178">(</span><span class="op" id="1897179">*</span><span class="ident" id="1897180">bmap</span><span class="op" id="1897184">)</span><span class="op" id="1897185">(</span><span class="ident" id="1897186">add</span><span class="op" id="1897189">(</span><span class="ident" id="1897190">h</span><span class="op" id="1897191">.</span><span class="ident" id="1897192">buckets</span><span class="op" id="1897199">,</span>&nbsp;<span class="op" id="1897201">(</span><span class="ident" id="1897202">hash</span><span class="op" id="1897206">&amp;</span><span class="ident" id="1897207">m</span><span class="op" id="1897208">)</span><span class="op" id="1897209">*</span><span class="builtintype" id="1897210">uintptr</span><span class="op" id="1897217">(</span><span class="ident" id="1897218">t</span><span class="op" id="1897219">.</span><span class="ident" id="1897220">bucketsize</span><span class="op" id="1897230">)</span><span class="op" id="1897231">)</span><span class="op" id="1897232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897236">if</span>&nbsp;<span class="ident" id="1897239">c</span>&nbsp;<span class="op" id="1897241">:=</span>&nbsp;<span class="ident" id="1897244">h</span><span class="op" id="1897245">.</span><span class="ident" id="1897246">oldbuckets</span><span class="op" id="1897256">;</span>&nbsp;<span class="ident" id="1897258">c</span>&nbsp;<span class="op" id="1897260">!=</span>&nbsp;<span class="ident" id="1897263">nil</span>&nbsp;<span class="op" id="1897267">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897272">oldb</span>&nbsp;<span class="op" id="1897277">:=</span>&nbsp;<span class="op" id="1897280">(</span><span class="op" id="1897281">*</span><span class="ident" id="1897282">bmap</span><span class="op" id="1897286">)</span><span class="op" id="1897287">(</span><span class="ident" id="1897288">add</span><span class="op" id="1897291">(</span><span class="ident" id="1897292">c</span><span class="op" id="1897293">,</span>&nbsp;<span class="op" id="1897295">(</span><span class="ident" id="1897296">hash</span><span class="op" id="1897300">&amp;</span><span class="op" id="1897301">(</span><span class="ident" id="1897302">m</span><span class="op" id="1897303">&gt;&gt;</span><span class="num" id="1897305">1</span><span class="op" id="1897306">)</span><span class="op" id="1897307">)</span><span class="op" id="1897308">*</span><span class="builtintype" id="1897309">uintptr</span><span class="op" id="1897316">(</span><span class="ident" id="1897317">t</span><span class="op" id="1897318">.</span><span class="ident" id="1897319">bucketsize</span><span class="op" id="1897329">)</span><span class="op" id="1897330">)</span><span class="op" id="1897331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897336">if</span>&nbsp;<span class="op" id="1897339">!</span><span class="ident" id="1897340">evacuated</span><span class="op" id="1897349">(</span><span class="ident" id="1897350">oldb</span><span class="op" id="1897354">)</span>&nbsp;<span class="op" id="1897356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897362">b</span>&nbsp;<span class="op" id="1897364">=</span>&nbsp;<span class="ident" id="1897366">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897378">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897384">for</span>&nbsp;<span class="op" id="1897388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897392">for</span>&nbsp;<span class="ident" id="1897396">i</span>&nbsp;<span class="op" id="1897398">:=</span>&nbsp;<span class="builtintype" id="1897401">uintptr</span><span class="op" id="1897408">(</span><span class="num" id="1897409">0</span><span class="op" id="1897410">)</span><span class="op" id="1897411">;</span>&nbsp;<span class="ident" id="1897413">i</span>&nbsp;<span class="op" id="1897415">&lt;</span>&nbsp;<span class="ident" id="1897417">bucketCnt</span><span class="op" id="1897426">;</span>&nbsp;<span class="ident" id="1897428">i</span><span class="op" id="1897429">++</span>&nbsp;<span class="op" id="1897432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897437">k</span>&nbsp;<span class="op" id="1897439">:=</span>&nbsp;<span class="op" id="1897442">*</span><span class="op" id="1897443">(</span><span class="op" id="1897444">(</span><span class="op" id="1897445">*</span><span class="builtintype" id="1897446">uint32</span><span class="op" id="1897452">)</span><span class="op" id="1897453">(</span><span class="ident" id="1897454">add</span><span class="op" id="1897457">(</span><span class="ident" id="1897458">unsafe</span><span class="op" id="1897464">.</span><span class="ident" id="1897465">Pointer</span><span class="op" id="1897472">(</span><span class="ident" id="1897473">b</span><span class="op" id="1897474">)</span><span class="op" id="1897475">,</span>&nbsp;<span class="ident" id="1897477">dataOffset</span><span class="op" id="1897487">+</span><span class="ident" id="1897488">i</span><span class="op" id="1897489">*</span><span class="num" id="1897490">4</span><span class="op" id="1897491">)</span><span class="op" id="1897492">)</span><span class="op" id="1897493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897498">if</span>&nbsp;<span class="ident" id="1897501">k</span>&nbsp;<span class="op" id="1897503">!=</span>&nbsp;<span class="ident" id="1897506">key</span>&nbsp;<span class="op" id="1897510">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897516">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897533">x</span>&nbsp;<span class="op" id="1897535">:=</span>&nbsp;<span class="op" id="1897538">*</span><span class="op" id="1897539">(</span><span class="op" id="1897540">(</span><span class="op" id="1897541">*</span><span class="builtintype" id="1897542">uint8</span><span class="op" id="1897547">)</span><span class="op" id="1897548">(</span><span class="ident" id="1897549">add</span><span class="op" id="1897552">(</span><span class="ident" id="1897553">unsafe</span><span class="op" id="1897559">.</span><span class="ident" id="1897560">Pointer</span><span class="op" id="1897567">(</span><span class="ident" id="1897568">b</span><span class="op" id="1897569">)</span><span class="op" id="1897570">,</span>&nbsp;<span class="ident" id="1897572">i</span><span class="op" id="1897573">)</span><span class="op" id="1897574">)</span><span class="op" id="1897575">)</span>&nbsp;<span class="comment" id="1897577">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897621">if</span>&nbsp;<span class="ident" id="1897624">x</span>&nbsp;<span class="op" id="1897626">==</span>&nbsp;<span class="ident" id="1897629">empty</span>&nbsp;<span class="op" id="1897635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897641">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897658">return</span>&nbsp;<span class="ident" id="1897665">add</span><span class="op" id="1897668">(</span><span class="ident" id="1897669">unsafe</span><span class="op" id="1897675">.</span><span class="ident" id="1897676">Pointer</span><span class="op" id="1897683">(</span><span class="ident" id="1897684">b</span><span class="op" id="1897685">)</span><span class="op" id="1897686">,</span>&nbsp;<span class="ident" id="1897688">dataOffset</span><span class="op" id="1897698">+</span><span class="ident" id="1897699">bucketCnt</span><span class="op" id="1897708">*</span><span class="num" id="1897709">4</span><span class="op" id="1897710">+</span><span class="ident" id="1897711">i</span><span class="op" id="1897712">*</span><span class="builtintype" id="1897713">uintptr</span><span class="op" id="1897720">(</span><span class="ident" id="1897721">t</span><span class="op" id="1897722">.</span><span class="ident" id="1897723">valuesize</span><span class="op" id="1897732">)</span><span class="op" id="1897733">)</span><span class="op" id="1897734">,</span>&nbsp;<span class="builtintype" id="1897736">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897747">b</span>&nbsp;<span class="op" id="1897749">=</span>&nbsp;<span class="ident" id="1897751">b</span><span class="op" id="1897752">.</span><span class="ident" id="1897753">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897764">if</span>&nbsp;<span class="ident" id="1897767">b</span>&nbsp;<span class="op" id="1897769">==</span>&nbsp;<span class="ident" id="1897772">nil</span>&nbsp;<span class="op" id="1897776">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897781">return</span>&nbsp;<span class="ident" id="1897788">unsafe</span><span class="op" id="1897794">.</span><span class="ident" id="1897795">Pointer</span><span class="op" id="1897802">(</span><span class="ident" id="1897803">t</span><span class="op" id="1897804">.</span><span class="ident" id="1897805">elem</span><span class="op" id="1897809">.</span><span class="ident" id="1897810">zero</span><span class="op" id="1897814">)</span><span class="op" id="1897815">,</span>&nbsp;<span class="builtintype" id="1897817">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897828">}</span><br>
<span class="lineno"></span><span class="op" id="1897830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1897833">func</span>&nbsp;<span class="ident" id="1897838">mapaccess1_fast64</span><span class="op" id="1897855">(</span><span class="ident" id="1897856">t</span>&nbsp;<span class="op" id="1897858">*</span><span class="ident" id="1897859">maptype</span><span class="op" id="1897866">,</span>&nbsp;<span class="ident" id="1897868">h</span>&nbsp;<span class="op" id="1897870">*</span><span class="ident" id="1897871">hmap</span><span class="op" id="1897875">,</span>&nbsp;<span class="ident" id="1897877">key</span>&nbsp;<span class="ident" id="1897881">uint64</span><span class="op" id="1897887">)</span>&nbsp;<span class="ident" id="1897889">unsafe</span><span class="op" id="1897895">.</span><span class="ident" id="1897896">Pointer</span>&nbsp;<span class="op" id="1897904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897907">if</span>&nbsp;<span class="ident" id="1897910">raceenabled</span>&nbsp;<span class="op" id="1897922">&amp;&amp;</span>&nbsp;<span class="ident" id="1897925">h</span>&nbsp;<span class="op" id="1897927">!=</span>&nbsp;<span class="ident" id="1897930">nil</span>&nbsp;<span class="op" id="1897934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897938">callerpc</span>&nbsp;<span class="op" id="1897947">:=</span>&nbsp;<span class="ident" id="1897950">getcallerpc</span><span class="op" id="1897961">(</span><span class="ident" id="1897962">unsafe</span><span class="op" id="1897968">.</span><span class="ident" id="1897969">Pointer</span><span class="op" id="1897976">(</span><span class="op" id="1897977">&amp;</span><span class="ident" id="1897978">t</span><span class="op" id="1897979">)</span><span class="op" id="1897980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897984">racereadpc</span><span class="op" id="1897994">(</span><span class="ident" id="1897995">unsafe</span><span class="op" id="1898001">.</span><span class="ident" id="1898002">Pointer</span><span class="op" id="1898009">(</span><span class="ident" id="1898010">h</span><span class="op" id="1898011">)</span><span class="op" id="1898012">,</span>&nbsp;<span class="ident" id="1898014">callerpc</span><span class="op" id="1898022">,</span>&nbsp;<span class="ident" id="1898024">funcPC</span><span class="op" id="1898030">(</span><span class="ident" id="1898031">mapaccess1_fast64</span><span class="op" id="1898048">)</span><span class="op" id="1898049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898052">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898055">if</span>&nbsp;<span class="ident" id="1898058">h</span>&nbsp;<span class="op" id="1898060">==</span>&nbsp;<span class="ident" id="1898063">nil</span>&nbsp;<span class="op" id="1898067">||</span>&nbsp;<span class="ident" id="1898070">h</span><span class="op" id="1898071">.</span><span class="ident" id="1898072">count</span>&nbsp;<span class="op" id="1898078">==</span>&nbsp;<span class="num" id="1898081">0</span>&nbsp;<span class="op" id="1898083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898087">return</span>&nbsp;<span class="ident" id="1898094">unsafe</span><span class="op" id="1898100">.</span><span class="ident" id="1898101">Pointer</span><span class="op" id="1898108">(</span><span class="ident" id="1898109">t</span><span class="op" id="1898110">.</span><span class="ident" id="1898111">elem</span><span class="op" id="1898115">.</span><span class="ident" id="1898116">zero</span><span class="op" id="1898120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898126">var</span>&nbsp;<span class="ident" id="1898130">b</span>&nbsp;<span class="op" id="1898132">*</span><span class="ident" id="1898133">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898139">if</span>&nbsp;<span class="ident" id="1898142">h</span><span class="op" id="1898143">.</span><span class="ident" id="1898144">B</span>&nbsp;<span class="op" id="1898146">==</span>&nbsp;<span class="num" id="1898149">0</span>&nbsp;<span class="op" id="1898151">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1898155">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898196">b</span>&nbsp;<span class="op" id="1898198">=</span>&nbsp;<span class="op" id="1898200">(</span><span class="op" id="1898201">*</span><span class="ident" id="1898202">bmap</span><span class="op" id="1898206">)</span><span class="op" id="1898207">(</span><span class="ident" id="1898208">h</span><span class="op" id="1898209">.</span><span class="ident" id="1898210">buckets</span><span class="op" id="1898217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898220">}</span>&nbsp;<span class="keyword" id="1898222">else</span>&nbsp;<span class="op" id="1898227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898231">hash</span>&nbsp;<span class="op" id="1898236">:=</span>&nbsp;<span class="ident" id="1898239">goalg</span><span class="op" id="1898244">(</span><span class="ident" id="1898245">t</span><span class="op" id="1898246">.</span><span class="ident" id="1898247">key</span><span class="op" id="1898250">.</span><span class="ident" id="1898251">alg</span><span class="op" id="1898254">)</span><span class="op" id="1898255">.</span><span class="ident" id="1898256">hash</span><span class="op" id="1898260">(</span><span class="ident" id="1898261">noescape</span><span class="op" id="1898269">(</span><span class="ident" id="1898270">unsafe</span><span class="op" id="1898276">.</span><span class="ident" id="1898277">Pointer</span><span class="op" id="1898284">(</span><span class="op" id="1898285">&amp;</span><span class="ident" id="1898286">key</span><span class="op" id="1898289">)</span><span class="op" id="1898290">)</span><span class="op" id="1898291">,</span>&nbsp;<span class="num" id="1898293">8</span><span class="op" id="1898294">,</span>&nbsp;<span class="builtintype" id="1898296">uintptr</span><span class="op" id="1898303">(</span><span class="ident" id="1898304">h</span><span class="op" id="1898305">.</span><span class="ident" id="1898306">hash0</span><span class="op" id="1898311">)</span><span class="op" id="1898312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898316">m</span>&nbsp;<span class="op" id="1898318">:=</span>&nbsp;<span class="builtintype" id="1898321">uintptr</span><span class="op" id="1898328">(</span><span class="num" id="1898329">1</span><span class="op" id="1898330">)</span><span class="op" id="1898331">&lt;&lt;</span><span class="ident" id="1898333">h</span><span class="op" id="1898334">.</span><span class="ident" id="1898335">B</span>&nbsp;<span class="op" id="1898337">-</span>&nbsp;<span class="num" id="1898339">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898343">b</span>&nbsp;<span class="op" id="1898345">=</span>&nbsp;<span class="op" id="1898347">(</span><span class="op" id="1898348">*</span><span class="ident" id="1898349">bmap</span><span class="op" id="1898353">)</span><span class="op" id="1898354">(</span><span class="ident" id="1898355">add</span><span class="op" id="1898358">(</span><span class="ident" id="1898359">h</span><span class="op" id="1898360">.</span><span class="ident" id="1898361">buckets</span><span class="op" id="1898368">,</span>&nbsp;<span class="op" id="1898370">(</span><span class="ident" id="1898371">hash</span><span class="op" id="1898375">&amp;</span><span class="ident" id="1898376">m</span><span class="op" id="1898377">)</span><span class="op" id="1898378">*</span><span class="builtintype" id="1898379">uintptr</span><span class="op" id="1898386">(</span><span class="ident" id="1898387">t</span><span class="op" id="1898388">.</span><span class="ident" id="1898389">bucketsize</span><span class="op" id="1898399">)</span><span class="op" id="1898400">)</span><span class="op" id="1898401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898405">if</span>&nbsp;<span class="ident" id="1898408">c</span>&nbsp;<span class="op" id="1898410">:=</span>&nbsp;<span class="ident" id="1898413">h</span><span class="op" id="1898414">.</span><span class="ident" id="1898415">oldbuckets</span><span class="op" id="1898425">;</span>&nbsp;<span class="ident" id="1898427">c</span>&nbsp;<span class="op" id="1898429">!=</span>&nbsp;<span class="ident" id="1898432">nil</span>&nbsp;<span class="op" id="1898436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898441">oldb</span>&nbsp;<span class="op" id="1898446">:=</span>&nbsp;<span class="op" id="1898449">(</span><span class="op" id="1898450">*</span><span class="ident" id="1898451">bmap</span><span class="op" id="1898455">)</span><span class="op" id="1898456">(</span><span class="ident" id="1898457">add</span><span class="op" id="1898460">(</span><span class="ident" id="1898461">c</span><span class="op" id="1898462">,</span>&nbsp;<span class="op" id="1898464">(</span><span class="ident" id="1898465">hash</span><span class="op" id="1898469">&amp;</span><span class="op" id="1898470">(</span><span class="ident" id="1898471">m</span><span class="op" id="1898472">&gt;&gt;</span><span class="num" id="1898474">1</span><span class="op" id="1898475">)</span><span class="op" id="1898476">)</span><span class="op" id="1898477">*</span><span class="builtintype" id="1898478">uintptr</span><span class="op" id="1898485">(</span><span class="ident" id="1898486">t</span><span class="op" id="1898487">.</span><span class="ident" id="1898488">bucketsize</span><span class="op" id="1898498">)</span><span class="op" id="1898499">)</span><span class="op" id="1898500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898505">if</span>&nbsp;<span class="op" id="1898508">!</span><span class="ident" id="1898509">evacuated</span><span class="op" id="1898518">(</span><span class="ident" id="1898519">oldb</span><span class="op" id="1898523">)</span>&nbsp;<span class="op" id="1898525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898531">b</span>&nbsp;<span class="op" id="1898533">=</span>&nbsp;<span class="ident" id="1898535">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898553">for</span>&nbsp;<span class="op" id="1898557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898561">for</span>&nbsp;<span class="ident" id="1898565">i</span>&nbsp;<span class="op" id="1898567">:=</span>&nbsp;<span class="builtintype" id="1898570">uintptr</span><span class="op" id="1898577">(</span><span class="num" id="1898578">0</span><span class="op" id="1898579">)</span><span class="op" id="1898580">;</span>&nbsp;<span class="ident" id="1898582">i</span>&nbsp;<span class="op" id="1898584">&lt;</span>&nbsp;<span class="ident" id="1898586">bucketCnt</span><span class="op" id="1898595">;</span>&nbsp;<span class="ident" id="1898597">i</span><span class="op" id="1898598">++</span>&nbsp;<span class="op" id="1898601">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898606">k</span>&nbsp;<span class="op" id="1898608">:=</span>&nbsp;<span class="op" id="1898611">*</span><span class="op" id="1898612">(</span><span class="op" id="1898613">(</span><span class="op" id="1898614">*</span><span class="ident" id="1898615">uint64</span><span class="op" id="1898621">)</span><span class="op" id="1898622">(</span><span class="ident" id="1898623">add</span><span class="op" id="1898626">(</span><span class="ident" id="1898627">unsafe</span><span class="op" id="1898633">.</span><span class="ident" id="1898634">Pointer</span><span class="op" id="1898641">(</span><span class="ident" id="1898642">b</span><span class="op" id="1898643">)</span><span class="op" id="1898644">,</span>&nbsp;<span class="ident" id="1898646">dataOffset</span><span class="op" id="1898656">+</span><span class="ident" id="1898657">i</span><span class="op" id="1898658">*</span><span class="num" id="1898659">8</span><span class="op" id="1898660">)</span><span class="op" id="1898661">)</span><span class="op" id="1898662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898667">if</span>&nbsp;<span class="ident" id="1898670">k</span>&nbsp;<span class="op" id="1898672">!=</span>&nbsp;<span class="ident" id="1898675">key</span>&nbsp;<span class="op" id="1898679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898685">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898702">x</span>&nbsp;<span class="op" id="1898704">:=</span>&nbsp;<span class="op" id="1898707">*</span><span class="op" id="1898708">(</span><span class="op" id="1898709">(</span><span class="op" id="1898710">*</span><span class="builtintype" id="1898711">uint8</span><span class="op" id="1898716">)</span><span class="op" id="1898717">(</span><span class="ident" id="1898718">add</span><span class="op" id="1898721">(</span><span class="ident" id="1898722">unsafe</span><span class="op" id="1898728">.</span><span class="ident" id="1898729">Pointer</span><span class="op" id="1898736">(</span><span class="ident" id="1898737">b</span><span class="op" id="1898738">)</span><span class="op" id="1898739">,</span>&nbsp;<span class="ident" id="1898741">i</span><span class="op" id="1898742">)</span><span class="op" id="1898743">)</span><span class="op" id="1898744">)</span>&nbsp;<span class="comment" id="1898746">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898790">if</span>&nbsp;<span class="ident" id="1898793">x</span>&nbsp;<span class="op" id="1898795">==</span>&nbsp;<span class="ident" id="1898798">empty</span>&nbsp;<span class="op" id="1898804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898810">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898827">return</span>&nbsp;<span class="ident" id="1898834">add</span><span class="op" id="1898837">(</span><span class="ident" id="1898838">unsafe</span><span class="op" id="1898844">.</span><span class="ident" id="1898845">Pointer</span><span class="op" id="1898852">(</span><span class="ident" id="1898853">b</span><span class="op" id="1898854">)</span><span class="op" id="1898855">,</span>&nbsp;<span class="ident" id="1898857">dataOffset</span><span class="op" id="1898867">+</span><span class="ident" id="1898868">bucketCnt</span><span class="op" id="1898877">*</span><span class="num" id="1898878">8</span><span class="op" id="1898879">+</span><span class="ident" id="1898880">i</span><span class="op" id="1898881">*</span><span class="builtintype" id="1898882">uintptr</span><span class="op" id="1898889">(</span><span class="ident" id="1898890">t</span><span class="op" id="1898891">.</span><span class="ident" id="1898892">valuesize</span><span class="op" id="1898901">)</span><span class="op" id="1898902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898906">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898910">b</span>&nbsp;<span class="op" id="1898912">=</span>&nbsp;<span class="ident" id="1898914">b</span><span class="op" id="1898915">.</span><span class="ident" id="1898916">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898927">if</span>&nbsp;<span class="ident" id="1898930">b</span>&nbsp;<span class="op" id="1898932">==</span>&nbsp;<span class="ident" id="1898935">nil</span>&nbsp;<span class="op" id="1898939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898944">return</span>&nbsp;<span class="ident" id="1898951">unsafe</span><span class="op" id="1898957">.</span><span class="ident" id="1898958">Pointer</span><span class="op" id="1898965">(</span><span class="ident" id="1898966">t</span><span class="op" id="1898967">.</span><span class="ident" id="1898968">elem</span><span class="op" id="1898972">.</span><span class="ident" id="1898973">zero</span><span class="op" id="1898977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898984">}</span><br>
<span class="lineno">135</span><span class="op" id="1898986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1898989">func</span>&nbsp;<span class="ident" id="1898994">mapaccess2_fast64</span><span class="op" id="1899011">(</span><span class="ident" id="1899012">t</span>&nbsp;<span class="op" id="1899014">*</span><span class="ident" id="1899015">maptype</span><span class="op" id="1899022">,</span>&nbsp;<span class="ident" id="1899024">h</span>&nbsp;<span class="op" id="1899026">*</span><span class="ident" id="1899027">hmap</span><span class="op" id="1899031">,</span>&nbsp;<span class="ident" id="1899033">key</span>&nbsp;<span class="ident" id="1899037">uint64</span><span class="op" id="1899043">)</span>&nbsp;<span class="op" id="1899045">(</span><span class="ident" id="1899046">unsafe</span><span class="op" id="1899052">.</span><span class="ident" id="1899053">Pointer</span><span class="op" id="1899060">,</span>&nbsp;<span class="builtintype" id="1899062">bool</span><span class="op" id="1899066">)</span>&nbsp;<span class="op" id="1899068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899071">if</span>&nbsp;<span class="ident" id="1899074">raceenabled</span>&nbsp;<span class="op" id="1899086">&amp;&amp;</span>&nbsp;<span class="ident" id="1899089">h</span>&nbsp;<span class="op" id="1899091">!=</span>&nbsp;<span class="ident" id="1899094">nil</span>&nbsp;<span class="op" id="1899098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899102">callerpc</span>&nbsp;<span class="op" id="1899111">:=</span>&nbsp;<span class="ident" id="1899114">getcallerpc</span><span class="op" id="1899125">(</span><span class="ident" id="1899126">unsafe</span><span class="op" id="1899132">.</span><span class="ident" id="1899133">Pointer</span><span class="op" id="1899140">(</span><span class="op" id="1899141">&amp;</span><span class="ident" id="1899142">t</span><span class="op" id="1899143">)</span><span class="op" id="1899144">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899148">racereadpc</span><span class="op" id="1899158">(</span><span class="ident" id="1899159">unsafe</span><span class="op" id="1899165">.</span><span class="ident" id="1899166">Pointer</span><span class="op" id="1899173">(</span><span class="ident" id="1899174">h</span><span class="op" id="1899175">)</span><span class="op" id="1899176">,</span>&nbsp;<span class="ident" id="1899178">callerpc</span><span class="op" id="1899186">,</span>&nbsp;<span class="ident" id="1899188">funcPC</span><span class="op" id="1899194">(</span><span class="ident" id="1899195">mapaccess2_fast64</span><span class="op" id="1899212">)</span><span class="op" id="1899213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899219">if</span>&nbsp;<span class="ident" id="1899222">h</span>&nbsp;<span class="op" id="1899224">==</span>&nbsp;<span class="ident" id="1899227">nil</span>&nbsp;<span class="op" id="1899231">||</span>&nbsp;<span class="ident" id="1899234">h</span><span class="op" id="1899235">.</span><span class="ident" id="1899236">count</span>&nbsp;<span class="op" id="1899242">==</span>&nbsp;<span class="num" id="1899245">0</span>&nbsp;<span class="op" id="1899247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899251">return</span>&nbsp;<span class="ident" id="1899258">unsafe</span><span class="op" id="1899264">.</span><span class="ident" id="1899265">Pointer</span><span class="op" id="1899272">(</span><span class="ident" id="1899273">t</span><span class="op" id="1899274">.</span><span class="ident" id="1899275">elem</span><span class="op" id="1899279">.</span><span class="ident" id="1899280">zero</span><span class="op" id="1899284">)</span><span class="op" id="1899285">,</span>&nbsp;<span class="builtintype" id="1899287">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899294">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899297">var</span>&nbsp;<span class="ident" id="1899301">b</span>&nbsp;<span class="op" id="1899303">*</span><span class="ident" id="1899304">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899310">if</span>&nbsp;<span class="ident" id="1899313">h</span><span class="op" id="1899314">.</span><span class="ident" id="1899315">B</span>&nbsp;<span class="op" id="1899317">==</span>&nbsp;<span class="num" id="1899320">0</span>&nbsp;<span class="op" id="1899322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1899326">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899367">b</span>&nbsp;<span class="op" id="1899369">=</span>&nbsp;<span class="op" id="1899371">(</span><span class="op" id="1899372">*</span><span class="ident" id="1899373">bmap</span><span class="op" id="1899377">)</span><span class="op" id="1899378">(</span><span class="ident" id="1899379">h</span><span class="op" id="1899380">.</span><span class="ident" id="1899381">buckets</span><span class="op" id="1899388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899391">}</span>&nbsp;<span class="keyword" id="1899393">else</span>&nbsp;<span class="op" id="1899398">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899402">hash</span>&nbsp;<span class="op" id="1899407">:=</span>&nbsp;<span class="ident" id="1899410">goalg</span><span class="op" id="1899415">(</span><span class="ident" id="1899416">t</span><span class="op" id="1899417">.</span><span class="ident" id="1899418">key</span><span class="op" id="1899421">.</span><span class="ident" id="1899422">alg</span><span class="op" id="1899425">)</span><span class="op" id="1899426">.</span><span class="ident" id="1899427">hash</span><span class="op" id="1899431">(</span><span class="ident" id="1899432">noescape</span><span class="op" id="1899440">(</span><span class="ident" id="1899441">unsafe</span><span class="op" id="1899447">.</span><span class="ident" id="1899448">Pointer</span><span class="op" id="1899455">(</span><span class="op" id="1899456">&amp;</span><span class="ident" id="1899457">key</span><span class="op" id="1899460">)</span><span class="op" id="1899461">)</span><span class="op" id="1899462">,</span>&nbsp;<span class="num" id="1899464">8</span><span class="op" id="1899465">,</span>&nbsp;<span class="builtintype" id="1899467">uintptr</span><span class="op" id="1899474">(</span><span class="ident" id="1899475">h</span><span class="op" id="1899476">.</span><span class="ident" id="1899477">hash0</span><span class="op" id="1899482">)</span><span class="op" id="1899483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899487">m</span>&nbsp;<span class="op" id="1899489">:=</span>&nbsp;<span class="builtintype" id="1899492">uintptr</span><span class="op" id="1899499">(</span><span class="num" id="1899500">1</span><span class="op" id="1899501">)</span><span class="op" id="1899502">&lt;&lt;</span><span class="ident" id="1899504">h</span><span class="op" id="1899505">.</span><span class="ident" id="1899506">B</span>&nbsp;<span class="op" id="1899508">-</span>&nbsp;<span class="num" id="1899510">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899514">b</span>&nbsp;<span class="op" id="1899516">=</span>&nbsp;<span class="op" id="1899518">(</span><span class="op" id="1899519">*</span><span class="ident" id="1899520">bmap</span><span class="op" id="1899524">)</span><span class="op" id="1899525">(</span><span class="ident" id="1899526">add</span><span class="op" id="1899529">(</span><span class="ident" id="1899530">h</span><span class="op" id="1899531">.</span><span class="ident" id="1899532">buckets</span><span class="op" id="1899539">,</span>&nbsp;<span class="op" id="1899541">(</span><span class="ident" id="1899542">hash</span><span class="op" id="1899546">&amp;</span><span class="ident" id="1899547">m</span><span class="op" id="1899548">)</span><span class="op" id="1899549">*</span><span class="builtintype" id="1899550">uintptr</span><span class="op" id="1899557">(</span><span class="ident" id="1899558">t</span><span class="op" id="1899559">.</span><span class="ident" id="1899560">bucketsize</span><span class="op" id="1899570">)</span><span class="op" id="1899571">)</span><span class="op" id="1899572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899576">if</span>&nbsp;<span class="ident" id="1899579">c</span>&nbsp;<span class="op" id="1899581">:=</span>&nbsp;<span class="ident" id="1899584">h</span><span class="op" id="1899585">.</span><span class="ident" id="1899586">oldbuckets</span><span class="op" id="1899596">;</span>&nbsp;<span class="ident" id="1899598">c</span>&nbsp;<span class="op" id="1899600">!=</span>&nbsp;<span class="ident" id="1899603">nil</span>&nbsp;<span class="op" id="1899607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899612">oldb</span>&nbsp;<span class="op" id="1899617">:=</span>&nbsp;<span class="op" id="1899620">(</span><span class="op" id="1899621">*</span><span class="ident" id="1899622">bmap</span><span class="op" id="1899626">)</span><span class="op" id="1899627">(</span><span class="ident" id="1899628">add</span><span class="op" id="1899631">(</span><span class="ident" id="1899632">c</span><span class="op" id="1899633">,</span>&nbsp;<span class="op" id="1899635">(</span><span class="ident" id="1899636">hash</span><span class="op" id="1899640">&amp;</span><span class="op" id="1899641">(</span><span class="ident" id="1899642">m</span><span class="op" id="1899643">&gt;&gt;</span><span class="num" id="1899645">1</span><span class="op" id="1899646">)</span><span class="op" id="1899647">)</span><span class="op" id="1899648">*</span><span class="builtintype" id="1899649">uintptr</span><span class="op" id="1899656">(</span><span class="ident" id="1899657">t</span><span class="op" id="1899658">.</span><span class="ident" id="1899659">bucketsize</span><span class="op" id="1899669">)</span><span class="op" id="1899670">)</span><span class="op" id="1899671">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899676">if</span>&nbsp;<span class="op" id="1899679">!</span><span class="ident" id="1899680">evacuated</span><span class="op" id="1899689">(</span><span class="ident" id="1899690">oldb</span><span class="op" id="1899694">)</span>&nbsp;<span class="op" id="1899696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899702">b</span>&nbsp;<span class="op" id="1899704">=</span>&nbsp;<span class="ident" id="1899706">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899721">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899724">for</span>&nbsp;<span class="op" id="1899728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899732">for</span>&nbsp;<span class="ident" id="1899736">i</span>&nbsp;<span class="op" id="1899738">:=</span>&nbsp;<span class="builtintype" id="1899741">uintptr</span><span class="op" id="1899748">(</span><span class="num" id="1899749">0</span><span class="op" id="1899750">)</span><span class="op" id="1899751">;</span>&nbsp;<span class="ident" id="1899753">i</span>&nbsp;<span class="op" id="1899755">&lt;</span>&nbsp;<span class="ident" id="1899757">bucketCnt</span><span class="op" id="1899766">;</span>&nbsp;<span class="ident" id="1899768">i</span><span class="op" id="1899769">++</span>&nbsp;<span class="op" id="1899772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899777">k</span>&nbsp;<span class="op" id="1899779">:=</span>&nbsp;<span class="op" id="1899782">*</span><span class="op" id="1899783">(</span><span class="op" id="1899784">(</span><span class="op" id="1899785">*</span><span class="ident" id="1899786">uint64</span><span class="op" id="1899792">)</span><span class="op" id="1899793">(</span><span class="ident" id="1899794">add</span><span class="op" id="1899797">(</span><span class="ident" id="1899798">unsafe</span><span class="op" id="1899804">.</span><span class="ident" id="1899805">Pointer</span><span class="op" id="1899812">(</span><span class="ident" id="1899813">b</span><span class="op" id="1899814">)</span><span class="op" id="1899815">,</span>&nbsp;<span class="ident" id="1899817">dataOffset</span><span class="op" id="1899827">+</span><span class="ident" id="1899828">i</span><span class="op" id="1899829">*</span><span class="num" id="1899830">8</span><span class="op" id="1899831">)</span><span class="op" id="1899832">)</span><span class="op" id="1899833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899838">if</span>&nbsp;<span class="ident" id="1899841">k</span>&nbsp;<span class="op" id="1899843">!=</span>&nbsp;<span class="ident" id="1899846">key</span>&nbsp;<span class="op" id="1899850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899856">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899873">x</span>&nbsp;<span class="op" id="1899875">:=</span>&nbsp;<span class="op" id="1899878">*</span><span class="op" id="1899879">(</span><span class="op" id="1899880">(</span><span class="op" id="1899881">*</span><span class="builtintype" id="1899882">uint8</span><span class="op" id="1899887">)</span><span class="op" id="1899888">(</span><span class="ident" id="1899889">add</span><span class="op" id="1899892">(</span><span class="ident" id="1899893">unsafe</span><span class="op" id="1899899">.</span><span class="ident" id="1899900">Pointer</span><span class="op" id="1899907">(</span><span class="ident" id="1899908">b</span><span class="op" id="1899909">)</span><span class="op" id="1899910">,</span>&nbsp;<span class="ident" id="1899912">i</span><span class="op" id="1899913">)</span><span class="op" id="1899914">)</span><span class="op" id="1899915">)</span>&nbsp;<span class="comment" id="1899917">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899961">if</span>&nbsp;<span class="ident" id="1899964">x</span>&nbsp;<span class="op" id="1899966">==</span>&nbsp;<span class="ident" id="1899969">empty</span>&nbsp;<span class="op" id="1899975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899981">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899993">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899998">return</span>&nbsp;<span class="ident" id="1900005">add</span><span class="op" id="1900008">(</span><span class="ident" id="1900009">unsafe</span><span class="op" id="1900015">.</span><span class="ident" id="1900016">Pointer</span><span class="op" id="1900023">(</span><span class="ident" id="1900024">b</span><span class="op" id="1900025">)</span><span class="op" id="1900026">,</span>&nbsp;<span class="ident" id="1900028">dataOffset</span><span class="op" id="1900038">+</span><span class="ident" id="1900039">bucketCnt</span><span class="op" id="1900048">*</span><span class="num" id="1900049">8</span><span class="op" id="1900050">+</span><span class="ident" id="1900051">i</span><span class="op" id="1900052">*</span><span class="builtintype" id="1900053">uintptr</span><span class="op" id="1900060">(</span><span class="ident" id="1900061">t</span><span class="op" id="1900062">.</span><span class="ident" id="1900063">valuesize</span><span class="op" id="1900072">)</span><span class="op" id="1900073">)</span><span class="op" id="1900074">,</span>&nbsp;<span class="builtintype" id="1900076">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900087">b</span>&nbsp;<span class="op" id="1900089">=</span>&nbsp;<span class="ident" id="1900091">b</span><span class="op" id="1900092">.</span><span class="ident" id="1900093">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900104">if</span>&nbsp;<span class="ident" id="1900107">b</span>&nbsp;<span class="op" id="1900109">==</span>&nbsp;<span class="ident" id="1900112">nil</span>&nbsp;<span class="op" id="1900116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900121">return</span>&nbsp;<span class="ident" id="1900128">unsafe</span><span class="op" id="1900134">.</span><span class="ident" id="1900135">Pointer</span><span class="op" id="1900142">(</span><span class="ident" id="1900143">t</span><span class="op" id="1900144">.</span><span class="ident" id="1900145">elem</span><span class="op" id="1900149">.</span><span class="ident" id="1900150">zero</span><span class="op" id="1900154">)</span><span class="op" id="1900155">,</span>&nbsp;<span class="builtintype" id="1900157">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900168">}</span><br>
<span class="lineno"></span><span class="op" id="1900170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1900173">func</span>&nbsp;<span class="ident" id="1900178">mapaccess1_faststr</span><span class="op" id="1900196">(</span><span class="ident" id="1900197">t</span>&nbsp;<span class="op" id="1900199">*</span><span class="ident" id="1900200">maptype</span><span class="op" id="1900207">,</span>&nbsp;<span class="ident" id="1900209">h</span>&nbsp;<span class="op" id="1900211">*</span><span class="ident" id="1900212">hmap</span><span class="op" id="1900216">,</span>&nbsp;<span class="ident" id="1900218">ky</span>&nbsp;<span class="builtintype" id="1900221">string</span><span class="op" id="1900227">)</span>&nbsp;<span class="ident" id="1900229">unsafe</span><span class="op" id="1900235">.</span><span class="ident" id="1900236">Pointer</span>&nbsp;<span class="op" id="1900244">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900247">if</span>&nbsp;<span class="ident" id="1900250">raceenabled</span>&nbsp;<span class="op" id="1900262">&amp;&amp;</span>&nbsp;<span class="ident" id="1900265">h</span>&nbsp;<span class="op" id="1900267">!=</span>&nbsp;<span class="ident" id="1900270">nil</span>&nbsp;<span class="op" id="1900274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900278">callerpc</span>&nbsp;<span class="op" id="1900287">:=</span>&nbsp;<span class="ident" id="1900290">getcallerpc</span><span class="op" id="1900301">(</span><span class="ident" id="1900302">unsafe</span><span class="op" id="1900308">.</span><span class="ident" id="1900309">Pointer</span><span class="op" id="1900316">(</span><span class="op" id="1900317">&amp;</span><span class="ident" id="1900318">t</span><span class="op" id="1900319">)</span><span class="op" id="1900320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900324">racereadpc</span><span class="op" id="1900334">(</span><span class="ident" id="1900335">unsafe</span><span class="op" id="1900341">.</span><span class="ident" id="1900342">Pointer</span><span class="op" id="1900349">(</span><span class="ident" id="1900350">h</span><span class="op" id="1900351">)</span><span class="op" id="1900352">,</span>&nbsp;<span class="ident" id="1900354">callerpc</span><span class="op" id="1900362">,</span>&nbsp;<span class="ident" id="1900364">funcPC</span><span class="op" id="1900370">(</span><span class="ident" id="1900371">mapaccess1_faststr</span><span class="op" id="1900389">)</span><span class="op" id="1900390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900396">if</span>&nbsp;<span class="ident" id="1900399">h</span>&nbsp;<span class="op" id="1900401">==</span>&nbsp;<span class="ident" id="1900404">nil</span>&nbsp;<span class="op" id="1900408">||</span>&nbsp;<span class="ident" id="1900411">h</span><span class="op" id="1900412">.</span><span class="ident" id="1900413">count</span>&nbsp;<span class="op" id="1900419">==</span>&nbsp;<span class="num" id="1900422">0</span>&nbsp;<span class="op" id="1900424">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900428">return</span>&nbsp;<span class="ident" id="1900435">unsafe</span><span class="op" id="1900441">.</span><span class="ident" id="1900442">Pointer</span><span class="op" id="1900449">(</span><span class="ident" id="1900450">t</span><span class="op" id="1900451">.</span><span class="ident" id="1900452">elem</span><span class="op" id="1900456">.</span><span class="ident" id="1900457">zero</span><span class="op" id="1900461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900467">key</span>&nbsp;<span class="op" id="1900471">:=</span>&nbsp;<span class="op" id="1900474">(</span><span class="op" id="1900475">*</span><span class="ident" id="1900476">stringStruct</span><span class="op" id="1900488">)</span><span class="op" id="1900489">(</span><span class="ident" id="1900490">unsafe</span><span class="op" id="1900496">.</span><span class="ident" id="1900497">Pointer</span><span class="op" id="1900504">(</span><span class="op" id="1900505">&amp;</span><span class="ident" id="1900506">ky</span><span class="op" id="1900508">)</span><span class="op" id="1900509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900512">if</span>&nbsp;<span class="ident" id="1900515">h</span><span class="op" id="1900516">.</span><span class="ident" id="1900517">B</span>&nbsp;<span class="op" id="1900519">==</span>&nbsp;<span class="num" id="1900522">0</span>&nbsp;<span class="op" id="1900524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1900528">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900551">b</span>&nbsp;<span class="op" id="1900553">:=</span>&nbsp;<span class="op" id="1900556">(</span><span class="op" id="1900557">*</span><span class="ident" id="1900558">bmap</span><span class="op" id="1900562">)</span><span class="op" id="1900563">(</span><span class="ident" id="1900564">h</span><span class="op" id="1900565">.</span><span class="ident" id="1900566">buckets</span><span class="op" id="1900573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900577">if</span>&nbsp;<span class="ident" id="1900580">key</span><span class="op" id="1900583">.</span><span class="builtinfunc" id="1900584">len</span>&nbsp;<span class="op" id="1900588">&lt;</span>&nbsp;<span class="num" id="1900590">32</span>&nbsp;<span class="op" id="1900593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1900598">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900647">for</span>&nbsp;<span class="ident" id="1900651">i</span>&nbsp;<span class="op" id="1900653">:=</span>&nbsp;<span class="builtintype" id="1900656">uintptr</span><span class="op" id="1900663">(</span><span class="num" id="1900664">0</span><span class="op" id="1900665">)</span><span class="op" id="1900666">;</span>&nbsp;<span class="ident" id="1900668">i</span>&nbsp;<span class="op" id="1900670">&lt;</span>&nbsp;<span class="ident" id="1900672">bucketCnt</span><span class="op" id="1900681">;</span>&nbsp;<span class="ident" id="1900683">i</span><span class="op" id="1900684">++</span>&nbsp;<span class="op" id="1900687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900693">x</span>&nbsp;<span class="op" id="1900695">:=</span>&nbsp;<span class="op" id="1900698">*</span><span class="op" id="1900699">(</span><span class="op" id="1900700">(</span><span class="op" id="1900701">*</span><span class="builtintype" id="1900702">uint8</span><span class="op" id="1900707">)</span><span class="op" id="1900708">(</span><span class="ident" id="1900709">add</span><span class="op" id="1900712">(</span><span class="ident" id="1900713">unsafe</span><span class="op" id="1900719">.</span><span class="ident" id="1900720">Pointer</span><span class="op" id="1900727">(</span><span class="ident" id="1900728">b</span><span class="op" id="1900729">)</span><span class="op" id="1900730">,</span>&nbsp;<span class="ident" id="1900732">i</span><span class="op" id="1900733">)</span><span class="op" id="1900734">)</span><span class="op" id="1900735">)</span>&nbsp;<span class="comment" id="1900737">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900782">if</span>&nbsp;<span class="ident" id="1900785">x</span>&nbsp;<span class="op" id="1900787">==</span>&nbsp;<span class="ident" id="1900790">empty</span>&nbsp;<span class="op" id="1900796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900803">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900822">k</span>&nbsp;<span class="op" id="1900824">:=</span>&nbsp;<span class="op" id="1900827">(</span><span class="op" id="1900828">*</span><span class="ident" id="1900829">stringStruct</span><span class="op" id="1900841">)</span><span class="op" id="1900842">(</span><span class="ident" id="1900843">add</span><span class="op" id="1900846">(</span><span class="ident" id="1900847">unsafe</span><span class="op" id="1900853">.</span><span class="ident" id="1900854">Pointer</span><span class="op" id="1900861">(</span><span class="ident" id="1900862">b</span><span class="op" id="1900863">)</span><span class="op" id="1900864">,</span>&nbsp;<span class="ident" id="1900866">dataOffset</span><span class="op" id="1900876">+</span><span class="ident" id="1900877">i</span><span class="op" id="1900878">*</span><span class="num" id="1900879">2</span><span class="op" id="1900880">*</span><span class="ident" id="1900881">ptrSize</span><span class="op" id="1900888">)</span><span class="op" id="1900889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900895">if</span>&nbsp;<span class="ident" id="1900898">k</span><span class="op" id="1900899">.</span><span class="builtinfunc" id="1900900">len</span>&nbsp;<span class="op" id="1900904">!=</span>&nbsp;<span class="ident" id="1900907">key</span><span class="op" id="1900910">.</span><span class="builtinfunc" id="1900911">len</span>&nbsp;<span class="op" id="1900915">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1900935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1900941">if</span>&nbsp;<span class="ident" id="1900944">k</span><span class="op" id="1900945">.</span><span class="ident" id="1900946">str</span>&nbsp;<span class="op" id="1900950">==</span>&nbsp;<span class="ident" id="1900953">key</span><span class="op" id="1900956">.</span><span class="ident" id="1900957">str</span>&nbsp;<span class="op" id="1900961">||</span>&nbsp;<span class="ident" id="1900964">memeq</span><span class="op" id="1900969">(</span><span class="ident" id="1900970">k</span><span class="op" id="1900971">.</span><span class="ident" id="1900972">str</span><span class="op" id="1900975">,</span>&nbsp;<span class="ident" id="1900977">key</span><span class="op" id="1900980">.</span><span class="ident" id="1900981">str</span><span class="op" id="1900984">,</span>&nbsp;<span class="builtintype" id="1900986">uintptr</span><span class="op" id="1900993">(</span><span class="ident" id="1900994">key</span><span class="op" id="1900997">.</span><span class="builtinfunc" id="1900998">len</span><span class="op" id="1901001">)</span><span class="op" id="1901002">)</span>&nbsp;<span class="op" id="1901004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901011">return</span>&nbsp;<span class="ident" id="1901018">add</span><span class="op" id="1901021">(</span><span class="ident" id="1901022">unsafe</span><span class="op" id="1901028">.</span><span class="ident" id="1901029">Pointer</span><span class="op" id="1901036">(</span><span class="ident" id="1901037">b</span><span class="op" id="1901038">)</span><span class="op" id="1901039">,</span>&nbsp;<span class="ident" id="1901041">dataOffset</span><span class="op" id="1901051">+</span><span class="ident" id="1901052">bucketCnt</span><span class="op" id="1901061">*</span><span class="num" id="1901062">2</span><span class="op" id="1901063">*</span><span class="ident" id="1901064">ptrSize</span><span class="op" id="1901071">+</span><span class="ident" id="1901072">i</span><span class="op" id="1901073">*</span><span class="builtintype" id="1901074">uintptr</span><span class="op" id="1901081">(</span><span class="ident" id="1901082">t</span><span class="op" id="1901083">.</span><span class="ident" id="1901084">valuesize</span><span class="op" id="1901093">)</span><span class="op" id="1901094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901100">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901110">return</span>&nbsp;<span class="ident" id="1901117">unsafe</span><span class="op" id="1901123">.</span><span class="ident" id="1901124">Pointer</span><span class="op" id="1901131">(</span><span class="ident" id="1901132">t</span><span class="op" id="1901133">.</span><span class="ident" id="1901134">elem</span><span class="op" id="1901138">.</span><span class="ident" id="1901139">zero</span><span class="op" id="1901143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901151">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901212">keymaybe</span>&nbsp;<span class="op" id="1901221">:=</span>&nbsp;<span class="builtintype" id="1901224">uintptr</span><span class="op" id="1901231">(</span><span class="ident" id="1901232">bucketCnt</span><span class="op" id="1901241">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901245">for</span>&nbsp;<span class="ident" id="1901249">i</span>&nbsp;<span class="op" id="1901251">:=</span>&nbsp;<span class="builtintype" id="1901254">uintptr</span><span class="op" id="1901261">(</span><span class="num" id="1901262">0</span><span class="op" id="1901263">)</span><span class="op" id="1901264">;</span>&nbsp;<span class="ident" id="1901266">i</span>&nbsp;<span class="op" id="1901268">&lt;</span>&nbsp;<span class="ident" id="1901270">bucketCnt</span><span class="op" id="1901279">;</span>&nbsp;<span class="ident" id="1901281">i</span><span class="op" id="1901282">++</span>&nbsp;<span class="op" id="1901285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901290">x</span>&nbsp;<span class="op" id="1901292">:=</span>&nbsp;<span class="op" id="1901295">*</span><span class="op" id="1901296">(</span><span class="op" id="1901297">(</span><span class="op" id="1901298">*</span><span class="builtintype" id="1901299">uint8</span><span class="op" id="1901304">)</span><span class="op" id="1901305">(</span><span class="ident" id="1901306">add</span><span class="op" id="1901309">(</span><span class="ident" id="1901310">unsafe</span><span class="op" id="1901316">.</span><span class="ident" id="1901317">Pointer</span><span class="op" id="1901324">(</span><span class="ident" id="1901325">b</span><span class="op" id="1901326">)</span><span class="op" id="1901327">,</span>&nbsp;<span class="ident" id="1901329">i</span><span class="op" id="1901330">)</span><span class="op" id="1901331">)</span><span class="op" id="1901332">)</span>&nbsp;<span class="comment" id="1901334">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901378">if</span>&nbsp;<span class="ident" id="1901381">x</span>&nbsp;<span class="op" id="1901383">==</span>&nbsp;<span class="ident" id="1901386">empty</span>&nbsp;<span class="op" id="1901392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901398">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901410">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901415">k</span>&nbsp;<span class="op" id="1901417">:=</span>&nbsp;<span class="op" id="1901420">(</span><span class="op" id="1901421">*</span><span class="ident" id="1901422">stringStruct</span><span class="op" id="1901434">)</span><span class="op" id="1901435">(</span><span class="ident" id="1901436">add</span><span class="op" id="1901439">(</span><span class="ident" id="1901440">unsafe</span><span class="op" id="1901446">.</span><span class="ident" id="1901447">Pointer</span><span class="op" id="1901454">(</span><span class="ident" id="1901455">b</span><span class="op" id="1901456">)</span><span class="op" id="1901457">,</span>&nbsp;<span class="ident" id="1901459">dataOffset</span><span class="op" id="1901469">+</span><span class="ident" id="1901470">i</span><span class="op" id="1901471">*</span><span class="num" id="1901472">2</span><span class="op" id="1901473">*</span><span class="ident" id="1901474">ptrSize</span><span class="op" id="1901481">)</span><span class="op" id="1901482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901487">if</span>&nbsp;<span class="ident" id="1901490">k</span><span class="op" id="1901491">.</span><span class="builtinfunc" id="1901492">len</span>&nbsp;<span class="op" id="1901496">!=</span>&nbsp;<span class="ident" id="1901499">key</span><span class="op" id="1901502">.</span><span class="builtinfunc" id="1901503">len</span>&nbsp;<span class="op" id="1901507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901513">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901530">if</span>&nbsp;<span class="ident" id="1901533">k</span><span class="op" id="1901534">.</span><span class="ident" id="1901535">str</span>&nbsp;<span class="op" id="1901539">==</span>&nbsp;<span class="ident" id="1901542">key</span><span class="op" id="1901545">.</span><span class="ident" id="1901546">str</span>&nbsp;<span class="op" id="1901550">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901556">return</span>&nbsp;<span class="ident" id="1901563">add</span><span class="op" id="1901566">(</span><span class="ident" id="1901567">unsafe</span><span class="op" id="1901573">.</span><span class="ident" id="1901574">Pointer</span><span class="op" id="1901581">(</span><span class="ident" id="1901582">b</span><span class="op" id="1901583">)</span><span class="op" id="1901584">,</span>&nbsp;<span class="ident" id="1901586">dataOffset</span><span class="op" id="1901596">+</span><span class="ident" id="1901597">bucketCnt</span><span class="op" id="1901606">*</span><span class="num" id="1901607">2</span><span class="op" id="1901608">*</span><span class="ident" id="1901609">ptrSize</span><span class="op" id="1901616">+</span><span class="ident" id="1901617">i</span><span class="op" id="1901618">*</span><span class="builtintype" id="1901619">uintptr</span><span class="op" id="1901626">(</span><span class="ident" id="1901627">t</span><span class="op" id="1901628">.</span><span class="ident" id="1901629">valuesize</span><span class="op" id="1901638">)</span><span class="op" id="1901639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901649">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901675">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901764">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901795">if</span>&nbsp;<span class="op" id="1901798">*</span><span class="op" id="1901799">(</span><span class="op" id="1901800">(</span><span class="op" id="1901801">*</span><span class="op" id="1901802">[</span><span class="num" id="1901803">4</span><span class="op" id="1901804">]</span><span class="builtintype" id="1901805">byte</span><span class="op" id="1901809">)</span><span class="op" id="1901810">(</span><span class="ident" id="1901811">key</span><span class="op" id="1901814">.</span><span class="ident" id="1901815">str</span><span class="op" id="1901818">)</span><span class="op" id="1901819">)</span>&nbsp;<span class="op" id="1901821">!=</span>&nbsp;<span class="op" id="1901824">*</span><span class="op" id="1901825">(</span><span class="op" id="1901826">(</span><span class="op" id="1901827">*</span><span class="op" id="1901828">[</span><span class="num" id="1901829">4</span><span class="op" id="1901830">]</span><span class="builtintype" id="1901831">byte</span><span class="op" id="1901835">)</span><span class="op" id="1901836">(</span><span class="ident" id="1901837">k</span><span class="op" id="1901838">.</span><span class="ident" id="1901839">str</span><span class="op" id="1901842">)</span><span class="op" id="1901843">)</span>&nbsp;<span class="op" id="1901845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901851">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901868">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901893">if</span>&nbsp;<span class="op" id="1901896">*</span><span class="op" id="1901897">(</span><span class="op" id="1901898">(</span><span class="op" id="1901899">*</span><span class="op" id="1901900">[</span><span class="num" id="1901901">4</span><span class="op" id="1901902">]</span><span class="builtintype" id="1901903">byte</span><span class="op" id="1901907">)</span><span class="op" id="1901908">(</span><span class="ident" id="1901909">add</span><span class="op" id="1901912">(</span><span class="ident" id="1901913">key</span><span class="op" id="1901916">.</span><span class="ident" id="1901917">str</span><span class="op" id="1901920">,</span>&nbsp;<span class="builtintype" id="1901922">uintptr</span><span class="op" id="1901929">(</span><span class="ident" id="1901930">key</span><span class="op" id="1901933">.</span><span class="builtinfunc" id="1901934">len</span><span class="op" id="1901937">)</span><span class="op" id="1901938">-</span><span class="num" id="1901939">4</span><span class="op" id="1901940">)</span><span class="op" id="1901941">)</span><span class="op" id="1901942">)</span>&nbsp;<span class="op" id="1901944">!=</span>&nbsp;<span class="op" id="1901947">*</span><span class="op" id="1901948">(</span><span class="op" id="1901949">(</span><span class="op" id="1901950">*</span><span class="op" id="1901951">[</span><span class="num" id="1901952">4</span><span class="op" id="1901953">]</span><span class="builtintype" id="1901954">byte</span><span class="op" id="1901958">)</span><span class="op" id="1901959">(</span><span class="ident" id="1901960">add</span><span class="op" id="1901963">(</span><span class="ident" id="1901964">k</span><span class="op" id="1901965">.</span><span class="ident" id="1901966">str</span><span class="op" id="1901969">,</span>&nbsp;<span class="builtintype" id="1901971">uintptr</span><span class="op" id="1901978">(</span><span class="ident" id="1901979">key</span><span class="op" id="1901982">.</span><span class="builtinfunc" id="1901983">len</span><span class="op" id="1901986">)</span><span class="op" id="1901987">-</span><span class="num" id="1901988">4</span><span class="op" id="1901989">)</span><span class="op" id="1901990">)</span><span class="op" id="1901991">)</span>&nbsp;<span class="op" id="1901993">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901999">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902016">if</span>&nbsp;<span class="ident" id="1902019">keymaybe</span>&nbsp;<span class="op" id="1902028">!=</span>&nbsp;<span class="ident" id="1902031">bucketCnt</span>&nbsp;<span class="op" id="1902041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902047">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902117">goto</span>&nbsp;<span class="ident" id="1902122">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902137">keymaybe</span>&nbsp;<span class="op" id="1902146">=</span>&nbsp;<span class="ident" id="1902148">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902156">if</span>&nbsp;<span class="ident" id="1902159">keymaybe</span>&nbsp;<span class="op" id="1902168">!=</span>&nbsp;<span class="ident" id="1902171">bucketCnt</span>&nbsp;<span class="op" id="1902181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902186">k</span>&nbsp;<span class="op" id="1902188">:=</span>&nbsp;<span class="op" id="1902191">(</span><span class="op" id="1902192">*</span><span class="ident" id="1902193">stringStruct</span><span class="op" id="1902205">)</span><span class="op" id="1902206">(</span><span class="ident" id="1902207">add</span><span class="op" id="1902210">(</span><span class="ident" id="1902211">unsafe</span><span class="op" id="1902217">.</span><span class="ident" id="1902218">Pointer</span><span class="op" id="1902225">(</span><span class="ident" id="1902226">b</span><span class="op" id="1902227">)</span><span class="op" id="1902228">,</span>&nbsp;<span class="ident" id="1902230">dataOffset</span><span class="op" id="1902240">+</span><span class="ident" id="1902241">keymaybe</span><span class="op" id="1902249">*</span><span class="num" id="1902250">2</span><span class="op" id="1902251">*</span><span class="ident" id="1902252">ptrSize</span><span class="op" id="1902259">)</span><span class="op" id="1902260">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902265">if</span>&nbsp;<span class="ident" id="1902268">memeq</span><span class="op" id="1902273">(</span><span class="ident" id="1902274">k</span><span class="op" id="1902275">.</span><span class="ident" id="1902276">str</span><span class="op" id="1902279">,</span>&nbsp;<span class="ident" id="1902281">key</span><span class="op" id="1902284">.</span><span class="ident" id="1902285">str</span><span class="op" id="1902288">,</span>&nbsp;<span class="builtintype" id="1902290">uintptr</span><span class="op" id="1902297">(</span><span class="ident" id="1902298">key</span><span class="op" id="1902301">.</span><span class="builtinfunc" id="1902302">len</span><span class="op" id="1902305">)</span><span class="op" id="1902306">)</span>&nbsp;<span class="op" id="1902308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902314">return</span>&nbsp;<span class="ident" id="1902321">add</span><span class="op" id="1902324">(</span><span class="ident" id="1902325">unsafe</span><span class="op" id="1902331">.</span><span class="ident" id="1902332">Pointer</span><span class="op" id="1902339">(</span><span class="ident" id="1902340">b</span><span class="op" id="1902341">)</span><span class="op" id="1902342">,</span>&nbsp;<span class="ident" id="1902344">dataOffset</span><span class="op" id="1902354">+</span><span class="ident" id="1902355">bucketCnt</span><span class="op" id="1902364">*</span><span class="num" id="1902365">2</span><span class="op" id="1902366">*</span><span class="ident" id="1902367">ptrSize</span><span class="op" id="1902374">+</span><span class="ident" id="1902375">keymaybe</span><span class="op" id="1902383">*</span><span class="builtintype" id="1902384">uintptr</span><span class="op" id="1902391">(</span><span class="ident" id="1902392">t</span><span class="op" id="1902393">.</span><span class="ident" id="1902394">valuesize</span><span class="op" id="1902403">)</span><span class="op" id="1902404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902417">return</span>&nbsp;<span class="ident" id="1902424">unsafe</span><span class="op" id="1902430">.</span><span class="ident" id="1902431">Pointer</span><span class="op" id="1902438">(</span><span class="ident" id="1902439">t</span><span class="op" id="1902440">.</span><span class="ident" id="1902441">elem</span><span class="op" id="1902445">.</span><span class="ident" id="1902446">zero</span><span class="op" id="1902450">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902453">}</span><br>
<span class="lineno"></span><span class="ident" id="1902455">dohash</span><span class="op" id="1902461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902464">hash</span>&nbsp;<span class="op" id="1902469">:=</span>&nbsp;<span class="ident" id="1902472">goalg</span><span class="op" id="1902477">(</span><span class="ident" id="1902478">t</span><span class="op" id="1902479">.</span><span class="ident" id="1902480">key</span><span class="op" id="1902483">.</span><span class="ident" id="1902484">alg</span><span class="op" id="1902487">)</span><span class="op" id="1902488">.</span><span class="ident" id="1902489">hash</span><span class="op" id="1902493">(</span><span class="ident" id="1902494">noescape</span><span class="op" id="1902502">(</span><span class="ident" id="1902503">unsafe</span><span class="op" id="1902509">.</span><span class="ident" id="1902510">Pointer</span><span class="op" id="1902517">(</span><span class="op" id="1902518">&amp;</span><span class="ident" id="1902519">ky</span><span class="op" id="1902521">)</span><span class="op" id="1902522">)</span><span class="op" id="1902523">,</span>&nbsp;<span class="num" id="1902525">2</span><span class="op" id="1902526">*</span><span class="ident" id="1902527">ptrSize</span><span class="op" id="1902534">,</span>&nbsp;<span class="builtintype" id="1902536">uintptr</span><span class="op" id="1902543">(</span><span class="ident" id="1902544">h</span><span class="op" id="1902545">.</span><span class="ident" id="1902546">hash0</span><span class="op" id="1902551">)</span><span class="op" id="1902552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902555">m</span>&nbsp;<span class="op" id="1902557">:=</span>&nbsp;<span class="builtintype" id="1902560">uintptr</span><span class="op" id="1902567">(</span><span class="num" id="1902568">1</span><span class="op" id="1902569">)</span><span class="op" id="1902570">&lt;&lt;</span><span class="ident" id="1902572">h</span><span class="op" id="1902573">.</span><span class="ident" id="1902574">B</span>&nbsp;<span class="op" id="1902576">-</span>&nbsp;<span class="num" id="1902578">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902581">b</span>&nbsp;<span class="op" id="1902583">:=</span>&nbsp;<span class="op" id="1902586">(</span><span class="op" id="1902587">*</span><span class="ident" id="1902588">bmap</span><span class="op" id="1902592">)</span><span class="op" id="1902593">(</span><span class="ident" id="1902594">add</span><span class="op" id="1902597">(</span><span class="ident" id="1902598">h</span><span class="op" id="1902599">.</span><span class="ident" id="1902600">buckets</span><span class="op" id="1902607">,</span>&nbsp;<span class="op" id="1902609">(</span><span class="ident" id="1902610">hash</span><span class="op" id="1902614">&amp;</span><span class="ident" id="1902615">m</span><span class="op" id="1902616">)</span><span class="op" id="1902617">*</span><span class="builtintype" id="1902618">uintptr</span><span class="op" id="1902625">(</span><span class="ident" id="1902626">t</span><span class="op" id="1902627">.</span><span class="ident" id="1902628">bucketsize</span><span class="op" id="1902638">)</span><span class="op" id="1902639">)</span><span class="op" id="1902640">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902643">if</span>&nbsp;<span class="ident" id="1902646">c</span>&nbsp;<span class="op" id="1902648">:=</span>&nbsp;<span class="ident" id="1902651">h</span><span class="op" id="1902652">.</span><span class="ident" id="1902653">oldbuckets</span><span class="op" id="1902663">;</span>&nbsp;<span class="ident" id="1902665">c</span>&nbsp;<span class="op" id="1902667">!=</span>&nbsp;<span class="ident" id="1902670">nil</span>&nbsp;<span class="op" id="1902674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902678">oldb</span>&nbsp;<span class="op" id="1902683">:=</span>&nbsp;<span class="op" id="1902686">(</span><span class="op" id="1902687">*</span><span class="ident" id="1902688">bmap</span><span class="op" id="1902692">)</span><span class="op" id="1902693">(</span><span class="ident" id="1902694">add</span><span class="op" id="1902697">(</span><span class="ident" id="1902698">c</span><span class="op" id="1902699">,</span>&nbsp;<span class="op" id="1902701">(</span><span class="ident" id="1902702">hash</span><span class="op" id="1902706">&amp;</span><span class="op" id="1902707">(</span><span class="ident" id="1902708">m</span><span class="op" id="1902709">&gt;&gt;</span><span class="num" id="1902711">1</span><span class="op" id="1902712">)</span><span class="op" id="1902713">)</span><span class="op" id="1902714">*</span><span class="builtintype" id="1902715">uintptr</span><span class="op" id="1902722">(</span><span class="ident" id="1902723">t</span><span class="op" id="1902724">.</span><span class="ident" id="1902725">bucketsize</span><span class="op" id="1902735">)</span><span class="op" id="1902736">)</span><span class="op" id="1902737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902741">if</span>&nbsp;<span class="op" id="1902744">!</span><span class="ident" id="1902745">evacuated</span><span class="op" id="1902754">(</span><span class="ident" id="1902755">oldb</span><span class="op" id="1902759">)</span>&nbsp;<span class="op" id="1902761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902766">b</span>&nbsp;<span class="op" id="1902768">=</span>&nbsp;<span class="ident" id="1902770">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902777">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902783">top</span>&nbsp;<span class="op" id="1902787">:=</span>&nbsp;<span class="builtintype" id="1902790">uint8</span><span class="op" id="1902795">(</span><span class="ident" id="1902796">hash</span>&nbsp;<span class="op" id="1902801">&gt;&gt;</span>&nbsp;<span class="op" id="1902804">(</span><span class="ident" id="1902805">ptrSize</span><span class="op" id="1902812">*</span><span class="num" id="1902813">8</span>&nbsp;<span class="op" id="1902815">-</span>&nbsp;<span class="num" id="1902817">8</span><span class="op" id="1902818">)</span><span class="op" id="1902819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902822">if</span>&nbsp;<span class="ident" id="1902825">top</span>&nbsp;<span class="op" id="1902829">&lt;</span>&nbsp;<span class="ident" id="1902831">minTopHash</span>&nbsp;<span class="op" id="1902842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902846">top</span>&nbsp;<span class="op" id="1902850">+=</span>&nbsp;<span class="ident" id="1902853">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902865">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902868">for</span>&nbsp;<span class="op" id="1902872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902876">for</span>&nbsp;<span class="ident" id="1902880">i</span>&nbsp;<span class="op" id="1902882">:=</span>&nbsp;<span class="builtintype" id="1902885">uintptr</span><span class="op" id="1902892">(</span><span class="num" id="1902893">0</span><span class="op" id="1902894">)</span><span class="op" id="1902895">;</span>&nbsp;<span class="ident" id="1902897">i</span>&nbsp;<span class="op" id="1902899">&lt;</span>&nbsp;<span class="ident" id="1902901">bucketCnt</span><span class="op" id="1902910">;</span>&nbsp;<span class="ident" id="1902912">i</span><span class="op" id="1902913">++</span>&nbsp;<span class="op" id="1902916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902921">x</span>&nbsp;<span class="op" id="1902923">:=</span>&nbsp;<span class="op" id="1902926">*</span><span class="op" id="1902927">(</span><span class="op" id="1902928">(</span><span class="op" id="1902929">*</span><span class="builtintype" id="1902930">uint8</span><span class="op" id="1902935">)</span><span class="op" id="1902936">(</span><span class="ident" id="1902937">add</span><span class="op" id="1902940">(</span><span class="ident" id="1902941">unsafe</span><span class="op" id="1902947">.</span><span class="ident" id="1902948">Pointer</span><span class="op" id="1902955">(</span><span class="ident" id="1902956">b</span><span class="op" id="1902957">)</span><span class="op" id="1902958">,</span>&nbsp;<span class="ident" id="1902960">i</span><span class="op" id="1902961">)</span><span class="op" id="1902962">)</span><span class="op" id="1902963">)</span>&nbsp;<span class="comment" id="1902965">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903009">if</span>&nbsp;<span class="ident" id="1903012">x</span>&nbsp;<span class="op" id="1903014">!=</span>&nbsp;<span class="ident" id="1903017">top</span>&nbsp;<span class="op" id="1903021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903027">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903044">k</span>&nbsp;<span class="op" id="1903046">:=</span>&nbsp;<span class="op" id="1903049">(</span><span class="op" id="1903050">*</span><span class="ident" id="1903051">stringStruct</span><span class="op" id="1903063">)</span><span class="op" id="1903064">(</span><span class="ident" id="1903065">add</span><span class="op" id="1903068">(</span><span class="ident" id="1903069">unsafe</span><span class="op" id="1903075">.</span><span class="ident" id="1903076">Pointer</span><span class="op" id="1903083">(</span><span class="ident" id="1903084">b</span><span class="op" id="1903085">)</span><span class="op" id="1903086">,</span>&nbsp;<span class="ident" id="1903088">dataOffset</span><span class="op" id="1903098">+</span><span class="ident" id="1903099">i</span><span class="op" id="1903100">*</span><span class="num" id="1903101">2</span><span class="op" id="1903102">*</span><span class="ident" id="1903103">ptrSize</span><span class="op" id="1903110">)</span><span class="op" id="1903111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903116">if</span>&nbsp;<span class="ident" id="1903119">k</span><span class="op" id="1903120">.</span><span class="builtinfunc" id="1903121">len</span>&nbsp;<span class="op" id="1903125">!=</span>&nbsp;<span class="ident" id="1903128">key</span><span class="op" id="1903131">.</span><span class="builtinfunc" id="1903132">len</span>&nbsp;<span class="op" id="1903136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903142">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903154">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903159">if</span>&nbsp;<span class="ident" id="1903162">k</span><span class="op" id="1903163">.</span><span class="ident" id="1903164">str</span>&nbsp;<span class="op" id="1903168">==</span>&nbsp;<span class="ident" id="1903171">key</span><span class="op" id="1903174">.</span><span class="ident" id="1903175">str</span>&nbsp;<span class="op" id="1903179">||</span>&nbsp;<span class="ident" id="1903182">memeq</span><span class="op" id="1903187">(</span><span class="ident" id="1903188">k</span><span class="op" id="1903189">.</span><span class="ident" id="1903190">str</span><span class="op" id="1903193">,</span>&nbsp;<span class="ident" id="1903195">key</span><span class="op" id="1903198">.</span><span class="ident" id="1903199">str</span><span class="op" id="1903202">,</span>&nbsp;<span class="builtintype" id="1903204">uintptr</span><span class="op" id="1903211">(</span><span class="ident" id="1903212">key</span><span class="op" id="1903215">.</span><span class="builtinfunc" id="1903216">len</span><span class="op" id="1903219">)</span><span class="op" id="1903220">)</span>&nbsp;<span class="op" id="1903222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903228">return</span>&nbsp;<span class="ident" id="1903235">add</span><span class="op" id="1903238">(</span><span class="ident" id="1903239">unsafe</span><span class="op" id="1903245">.</span><span class="ident" id="1903246">Pointer</span><span class="op" id="1903253">(</span><span class="ident" id="1903254">b</span><span class="op" id="1903255">)</span><span class="op" id="1903256">,</span>&nbsp;<span class="ident" id="1903258">dataOffset</span><span class="op" id="1903268">+</span><span class="ident" id="1903269">bucketCnt</span><span class="op" id="1903278">*</span><span class="num" id="1903279">2</span><span class="op" id="1903280">*</span><span class="ident" id="1903281">ptrSize</span><span class="op" id="1903288">+</span><span class="ident" id="1903289">i</span><span class="op" id="1903290">*</span><span class="builtintype" id="1903291">uintptr</span><span class="op" id="1903298">(</span><span class="ident" id="1903299">t</span><span class="op" id="1903300">.</span><span class="ident" id="1903301">valuesize</span><span class="op" id="1903310">)</span><span class="op" id="1903311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903324">b</span>&nbsp;<span class="op" id="1903326">=</span>&nbsp;<span class="ident" id="1903328">b</span><span class="op" id="1903329">.</span><span class="ident" id="1903330">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903341">if</span>&nbsp;<span class="ident" id="1903344">b</span>&nbsp;<span class="op" id="1903346">==</span>&nbsp;<span class="ident" id="1903349">nil</span>&nbsp;<span class="op" id="1903353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903358">return</span>&nbsp;<span class="ident" id="1903365">unsafe</span><span class="op" id="1903371">.</span><span class="ident" id="1903372">Pointer</span><span class="op" id="1903379">(</span><span class="ident" id="1903380">t</span><span class="op" id="1903381">.</span><span class="ident" id="1903382">elem</span><span class="op" id="1903386">.</span><span class="ident" id="1903387">zero</span><span class="op" id="1903391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903398">}</span><br>
<span class="lineno"></span><span class="op" id="1903400">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1903403">func</span>&nbsp;<span class="ident" id="1903408">mapaccess2_faststr</span><span class="op" id="1903426">(</span><span class="ident" id="1903427">t</span>&nbsp;<span class="op" id="1903429">*</span><span class="ident" id="1903430">maptype</span><span class="op" id="1903437">,</span>&nbsp;<span class="ident" id="1903439">h</span>&nbsp;<span class="op" id="1903441">*</span><span class="ident" id="1903442">hmap</span><span class="op" id="1903446">,</span>&nbsp;<span class="ident" id="1903448">ky</span>&nbsp;<span class="builtintype" id="1903451">string</span><span class="op" id="1903457">)</span>&nbsp;<span class="op" id="1903459">(</span><span class="ident" id="1903460">unsafe</span><span class="op" id="1903466">.</span><span class="ident" id="1903467">Pointer</span><span class="op" id="1903474">,</span>&nbsp;<span class="builtintype" id="1903476">bool</span><span class="op" id="1903480">)</span>&nbsp;<span class="op" id="1903482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903485">if</span>&nbsp;<span class="ident" id="1903488">raceenabled</span>&nbsp;<span class="op" id="1903500">&amp;&amp;</span>&nbsp;<span class="ident" id="1903503">h</span>&nbsp;<span class="op" id="1903505">!=</span>&nbsp;<span class="ident" id="1903508">nil</span>&nbsp;<span class="op" id="1903512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903516">callerpc</span>&nbsp;<span class="op" id="1903525">:=</span>&nbsp;<span class="ident" id="1903528">getcallerpc</span><span class="op" id="1903539">(</span><span class="ident" id="1903540">unsafe</span><span class="op" id="1903546">.</span><span class="ident" id="1903547">Pointer</span><span class="op" id="1903554">(</span><span class="op" id="1903555">&amp;</span><span class="ident" id="1903556">t</span><span class="op" id="1903557">)</span><span class="op" id="1903558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903562">racereadpc</span><span class="op" id="1903572">(</span><span class="ident" id="1903573">unsafe</span><span class="op" id="1903579">.</span><span class="ident" id="1903580">Pointer</span><span class="op" id="1903587">(</span><span class="ident" id="1903588">h</span><span class="op" id="1903589">)</span><span class="op" id="1903590">,</span>&nbsp;<span class="ident" id="1903592">callerpc</span><span class="op" id="1903600">,</span>&nbsp;<span class="ident" id="1903602">funcPC</span><span class="op" id="1903608">(</span><span class="ident" id="1903609">mapaccess2_faststr</span><span class="op" id="1903627">)</span><span class="op" id="1903628">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903634">if</span>&nbsp;<span class="ident" id="1903637">h</span>&nbsp;<span class="op" id="1903639">==</span>&nbsp;<span class="ident" id="1903642">nil</span>&nbsp;<span class="op" id="1903646">||</span>&nbsp;<span class="ident" id="1903649">h</span><span class="op" id="1903650">.</span><span class="ident" id="1903651">count</span>&nbsp;<span class="op" id="1903657">==</span>&nbsp;<span class="num" id="1903660">0</span>&nbsp;<span class="op" id="1903662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903666">return</span>&nbsp;<span class="ident" id="1903673">unsafe</span><span class="op" id="1903679">.</span><span class="ident" id="1903680">Pointer</span><span class="op" id="1903687">(</span><span class="ident" id="1903688">t</span><span class="op" id="1903689">.</span><span class="ident" id="1903690">elem</span><span class="op" id="1903694">.</span><span class="ident" id="1903695">zero</span><span class="op" id="1903699">)</span><span class="op" id="1903700">,</span>&nbsp;<span class="builtintype" id="1903702">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903712">key</span>&nbsp;<span class="op" id="1903716">:=</span>&nbsp;<span class="op" id="1903719">(</span><span class="op" id="1903720">*</span><span class="ident" id="1903721">stringStruct</span><span class="op" id="1903733">)</span><span class="op" id="1903734">(</span><span class="ident" id="1903735">unsafe</span><span class="op" id="1903741">.</span><span class="ident" id="1903742">Pointer</span><span class="op" id="1903749">(</span><span class="op" id="1903750">&amp;</span><span class="ident" id="1903751">ky</span><span class="op" id="1903753">)</span><span class="op" id="1903754">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903757">if</span>&nbsp;<span class="ident" id="1903760">h</span><span class="op" id="1903761">.</span><span class="ident" id="1903762">B</span>&nbsp;<span class="op" id="1903764">==</span>&nbsp;<span class="num" id="1903767">0</span>&nbsp;<span class="op" id="1903769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1903773">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903796">b</span>&nbsp;<span class="op" id="1903798">:=</span>&nbsp;<span class="op" id="1903801">(</span><span class="op" id="1903802">*</span><span class="ident" id="1903803">bmap</span><span class="op" id="1903807">)</span><span class="op" id="1903808">(</span><span class="ident" id="1903809">h</span><span class="op" id="1903810">.</span><span class="ident" id="1903811">buckets</span><span class="op" id="1903818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903822">if</span>&nbsp;<span class="ident" id="1903825">key</span><span class="op" id="1903828">.</span><span class="builtinfunc" id="1903829">len</span>&nbsp;<span class="op" id="1903833">&lt;</span>&nbsp;<span class="num" id="1903835">32</span>&nbsp;<span class="op" id="1903838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1903843">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903892">for</span>&nbsp;<span class="ident" id="1903896">i</span>&nbsp;<span class="op" id="1903898">:=</span>&nbsp;<span class="builtintype" id="1903901">uintptr</span><span class="op" id="1903908">(</span><span class="num" id="1903909">0</span><span class="op" id="1903910">)</span><span class="op" id="1903911">;</span>&nbsp;<span class="ident" id="1903913">i</span>&nbsp;<span class="op" id="1903915">&lt;</span>&nbsp;<span class="ident" id="1903917">bucketCnt</span><span class="op" id="1903926">;</span>&nbsp;<span class="ident" id="1903928">i</span><span class="op" id="1903929">++</span>&nbsp;<span class="op" id="1903932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903938">x</span>&nbsp;<span class="op" id="1903940">:=</span>&nbsp;<span class="op" id="1903943">*</span><span class="op" id="1903944">(</span><span class="op" id="1903945">(</span><span class="op" id="1903946">*</span><span class="builtintype" id="1903947">uint8</span><span class="op" id="1903952">)</span><span class="op" id="1903953">(</span><span class="ident" id="1903954">add</span><span class="op" id="1903957">(</span><span class="ident" id="1903958">unsafe</span><span class="op" id="1903964">.</span><span class="ident" id="1903965">Pointer</span><span class="op" id="1903972">(</span><span class="ident" id="1903973">b</span><span class="op" id="1903974">)</span><span class="op" id="1903975">,</span>&nbsp;<span class="ident" id="1903977">i</span><span class="op" id="1903978">)</span><span class="op" id="1903979">)</span><span class="op" id="1903980">)</span>&nbsp;<span class="comment" id="1903982">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904027">if</span>&nbsp;<span class="ident" id="1904030">x</span>&nbsp;<span class="op" id="1904032">==</span>&nbsp;<span class="ident" id="1904035">empty</span>&nbsp;<span class="op" id="1904041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904048">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904061">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904067">k</span>&nbsp;<span class="op" id="1904069">:=</span>&nbsp;<span class="op" id="1904072">(</span><span class="op" id="1904073">*</span><span class="ident" id="1904074">stringStruct</span><span class="op" id="1904086">)</span><span class="op" id="1904087">(</span><span class="ident" id="1904088">add</span><span class="op" id="1904091">(</span><span class="ident" id="1904092">unsafe</span><span class="op" id="1904098">.</span><span class="ident" id="1904099">Pointer</span><span class="op" id="1904106">(</span><span class="ident" id="1904107">b</span><span class="op" id="1904108">)</span><span class="op" id="1904109">,</span>&nbsp;<span class="ident" id="1904111">dataOffset</span><span class="op" id="1904121">+</span><span class="ident" id="1904122">i</span><span class="op" id="1904123">*</span><span class="num" id="1904124">2</span><span class="op" id="1904125">*</span><span class="ident" id="1904126">ptrSize</span><span class="op" id="1904133">)</span><span class="op" id="1904134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904140">if</span>&nbsp;<span class="ident" id="1904143">k</span><span class="op" id="1904144">.</span><span class="builtinfunc" id="1904145">len</span>&nbsp;<span class="op" id="1904149">!=</span>&nbsp;<span class="ident" id="1904152">key</span><span class="op" id="1904155">.</span><span class="builtinfunc" id="1904156">len</span>&nbsp;<span class="op" id="1904160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904167">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904186">if</span>&nbsp;<span class="ident" id="1904189">k</span><span class="op" id="1904190">.</span><span class="ident" id="1904191">str</span>&nbsp;<span class="op" id="1904195">==</span>&nbsp;<span class="ident" id="1904198">key</span><span class="op" id="1904201">.</span><span class="ident" id="1904202">str</span>&nbsp;<span class="op" id="1904206">||</span>&nbsp;<span class="ident" id="1904209">memeq</span><span class="op" id="1904214">(</span><span class="ident" id="1904215">k</span><span class="op" id="1904216">.</span><span class="ident" id="1904217">str</span><span class="op" id="1904220">,</span>&nbsp;<span class="ident" id="1904222">key</span><span class="op" id="1904225">.</span><span class="ident" id="1904226">str</span><span class="op" id="1904229">,</span>&nbsp;<span class="builtintype" id="1904231">uintptr</span><span class="op" id="1904238">(</span><span class="ident" id="1904239">key</span><span class="op" id="1904242">.</span><span class="builtinfunc" id="1904243">len</span><span class="op" id="1904246">)</span><span class="op" id="1904247">)</span>&nbsp;<span class="op" id="1904249">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904256">return</span>&nbsp;<span class="ident" id="1904263">add</span><span class="op" id="1904266">(</span><span class="ident" id="1904267">unsafe</span><span class="op" id="1904273">.</span><span class="ident" id="1904274">Pointer</span><span class="op" id="1904281">(</span><span class="ident" id="1904282">b</span><span class="op" id="1904283">)</span><span class="op" id="1904284">,</span>&nbsp;<span class="ident" id="1904286">dataOffset</span><span class="op" id="1904296">+</span><span class="ident" id="1904297">bucketCnt</span><span class="op" id="1904306">*</span><span class="num" id="1904307">2</span><span class="op" id="1904308">*</span><span class="ident" id="1904309">ptrSize</span><span class="op" id="1904316">+</span><span class="ident" id="1904317">i</span><span class="op" id="1904318">*</span><span class="builtintype" id="1904319">uintptr</span><span class="op" id="1904326">(</span><span class="ident" id="1904327">t</span><span class="op" id="1904328">.</span><span class="ident" id="1904329">valuesize</span><span class="op" id="1904338">)</span><span class="op" id="1904339">)</span><span class="op" id="1904340">,</span>&nbsp;<span class="builtintype" id="1904342">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904361">return</span>&nbsp;<span class="ident" id="1904368">unsafe</span><span class="op" id="1904374">.</span><span class="ident" id="1904375">Pointer</span><span class="op" id="1904382">(</span><span class="ident" id="1904383">t</span><span class="op" id="1904384">.</span><span class="ident" id="1904385">elem</span><span class="op" id="1904389">.</span><span class="ident" id="1904390">zero</span><span class="op" id="1904394">)</span><span class="op" id="1904395">,</span>&nbsp;<span class="builtintype" id="1904397">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904405">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904409">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904470">keymaybe</span>&nbsp;<span class="op" id="1904479">:=</span>&nbsp;<span class="builtintype" id="1904482">uintptr</span><span class="op" id="1904489">(</span><span class="ident" id="1904490">bucketCnt</span><span class="op" id="1904499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904503">for</span>&nbsp;<span class="ident" id="1904507">i</span>&nbsp;<span class="op" id="1904509">:=</span>&nbsp;<span class="builtintype" id="1904512">uintptr</span><span class="op" id="1904519">(</span><span class="num" id="1904520">0</span><span class="op" id="1904521">)</span><span class="op" id="1904522">;</span>&nbsp;<span class="ident" id="1904524">i</span>&nbsp;<span class="op" id="1904526">&lt;</span>&nbsp;<span class="ident" id="1904528">bucketCnt</span><span class="op" id="1904537">;</span>&nbsp;<span class="ident" id="1904539">i</span><span class="op" id="1904540">++</span>&nbsp;<span class="op" id="1904543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904548">x</span>&nbsp;<span class="op" id="1904550">:=</span>&nbsp;<span class="op" id="1904553">*</span><span class="op" id="1904554">(</span><span class="op" id="1904555">(</span><span class="op" id="1904556">*</span><span class="builtintype" id="1904557">uint8</span><span class="op" id="1904562">)</span><span class="op" id="1904563">(</span><span class="ident" id="1904564">add</span><span class="op" id="1904567">(</span><span class="ident" id="1904568">unsafe</span><span class="op" id="1904574">.</span><span class="ident" id="1904575">Pointer</span><span class="op" id="1904582">(</span><span class="ident" id="1904583">b</span><span class="op" id="1904584">)</span><span class="op" id="1904585">,</span>&nbsp;<span class="ident" id="1904587">i</span><span class="op" id="1904588">)</span><span class="op" id="1904589">)</span><span class="op" id="1904590">)</span>&nbsp;<span class="comment" id="1904592">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904636">if</span>&nbsp;<span class="ident" id="1904639">x</span>&nbsp;<span class="op" id="1904641">==</span>&nbsp;<span class="ident" id="1904644">empty</span>&nbsp;<span class="op" id="1904650">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904673">k</span>&nbsp;<span class="op" id="1904675">:=</span>&nbsp;<span class="op" id="1904678">(</span><span class="op" id="1904679">*</span><span class="ident" id="1904680">stringStruct</span><span class="op" id="1904692">)</span><span class="op" id="1904693">(</span><span class="ident" id="1904694">add</span><span class="op" id="1904697">(</span><span class="ident" id="1904698">unsafe</span><span class="op" id="1904704">.</span><span class="ident" id="1904705">Pointer</span><span class="op" id="1904712">(</span><span class="ident" id="1904713">b</span><span class="op" id="1904714">)</span><span class="op" id="1904715">,</span>&nbsp;<span class="ident" id="1904717">dataOffset</span><span class="op" id="1904727">+</span><span class="ident" id="1904728">i</span><span class="op" id="1904729">*</span><span class="num" id="1904730">2</span><span class="op" id="1904731">*</span><span class="ident" id="1904732">ptrSize</span><span class="op" id="1904739">)</span><span class="op" id="1904740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904745">if</span>&nbsp;<span class="ident" id="1904748">k</span><span class="op" id="1904749">.</span><span class="builtinfunc" id="1904750">len</span>&nbsp;<span class="op" id="1904754">!=</span>&nbsp;<span class="ident" id="1904757">key</span><span class="op" id="1904760">.</span><span class="builtinfunc" id="1904761">len</span>&nbsp;<span class="op" id="1904765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904771">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904788">if</span>&nbsp;<span class="ident" id="1904791">k</span><span class="op" id="1904792">.</span><span class="ident" id="1904793">str</span>&nbsp;<span class="op" id="1904797">==</span>&nbsp;<span class="ident" id="1904800">key</span><span class="op" id="1904803">.</span><span class="ident" id="1904804">str</span>&nbsp;<span class="op" id="1904808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904814">return</span>&nbsp;<span class="ident" id="1904821">add</span><span class="op" id="1904824">(</span><span class="ident" id="1904825">unsafe</span><span class="op" id="1904831">.</span><span class="ident" id="1904832">Pointer</span><span class="op" id="1904839">(</span><span class="ident" id="1904840">b</span><span class="op" id="1904841">)</span><span class="op" id="1904842">,</span>&nbsp;<span class="ident" id="1904844">dataOffset</span><span class="op" id="1904854">+</span><span class="ident" id="1904855">bucketCnt</span><span class="op" id="1904864">*</span><span class="num" id="1904865">2</span><span class="op" id="1904866">*</span><span class="ident" id="1904867">ptrSize</span><span class="op" id="1904874">+</span><span class="ident" id="1904875">i</span><span class="op" id="1904876">*</span><span class="builtintype" id="1904877">uintptr</span><span class="op" id="1904884">(</span><span class="ident" id="1904885">t</span><span class="op" id="1904886">.</span><span class="ident" id="1904887">valuesize</span><span class="op" id="1904896">)</span><span class="op" id="1904897">)</span><span class="op" id="1904898">,</span>&nbsp;<span class="builtintype" id="1904900">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904913">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904939">if</span>&nbsp;<span class="op" id="1904942">*</span><span class="op" id="1904943">(</span><span class="op" id="1904944">(</span><span class="op" id="1904945">*</span><span class="op" id="1904946">[</span><span class="num" id="1904947">4</span><span class="op" id="1904948">]</span><span class="builtintype" id="1904949">byte</span><span class="op" id="1904953">)</span><span class="op" id="1904954">(</span><span class="ident" id="1904955">key</span><span class="op" id="1904958">.</span><span class="ident" id="1904959">str</span><span class="op" id="1904962">)</span><span class="op" id="1904963">)</span>&nbsp;<span class="op" id="1904965">!=</span>&nbsp;<span class="op" id="1904968">*</span><span class="op" id="1904969">(</span><span class="op" id="1904970">(</span><span class="op" id="1904971">*</span><span class="op" id="1904972">[</span><span class="num" id="1904973">4</span><span class="op" id="1904974">]</span><span class="builtintype" id="1904975">byte</span><span class="op" id="1904979">)</span><span class="op" id="1904980">(</span><span class="ident" id="1904981">k</span><span class="op" id="1904982">.</span><span class="ident" id="1904983">str</span><span class="op" id="1904986">)</span><span class="op" id="1904987">)</span>&nbsp;<span class="op" id="1904989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904995">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1905012">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905037">if</span>&nbsp;<span class="op" id="1905040">*</span><span class="op" id="1905041">(</span><span class="op" id="1905042">(</span><span class="op" id="1905043">*</span><span class="op" id="1905044">[</span><span class="num" id="1905045">4</span><span class="op" id="1905046">]</span><span class="builtintype" id="1905047">byte</span><span class="op" id="1905051">)</span><span class="op" id="1905052">(</span><span class="ident" id="1905053">add</span><span class="op" id="1905056">(</span><span class="ident" id="1905057">key</span><span class="op" id="1905060">.</span><span class="ident" id="1905061">str</span><span class="op" id="1905064">,</span>&nbsp;<span class="builtintype" id="1905066">uintptr</span><span class="op" id="1905073">(</span><span class="ident" id="1905074">key</span><span class="op" id="1905077">.</span><span class="builtinfunc" id="1905078">len</span><span class="op" id="1905081">)</span><span class="op" id="1905082">-</span><span class="num" id="1905083">4</span><span class="op" id="1905084">)</span><span class="op" id="1905085">)</span><span class="op" id="1905086">)</span>&nbsp;<span class="op" id="1905088">!=</span>&nbsp;<span class="op" id="1905091">*</span><span class="op" id="1905092">(</span><span class="op" id="1905093">(</span><span class="op" id="1905094">*</span><span class="op" id="1905095">[</span><span class="num" id="1905096">4</span><span class="op" id="1905097">]</span><span class="builtintype" id="1905098">byte</span><span class="op" id="1905102">)</span><span class="op" id="1905103">(</span><span class="ident" id="1905104">add</span><span class="op" id="1905107">(</span><span class="ident" id="1905108">k</span><span class="op" id="1905109">.</span><span class="ident" id="1905110">str</span><span class="op" id="1905113">,</span>&nbsp;<span class="builtintype" id="1905115">uintptr</span><span class="op" id="1905122">(</span><span class="ident" id="1905123">key</span><span class="op" id="1905126">.</span><span class="builtinfunc" id="1905127">len</span><span class="op" id="1905130">)</span><span class="op" id="1905131">-</span><span class="num" id="1905132">4</span><span class="op" id="1905133">)</span><span class="op" id="1905134">)</span><span class="op" id="1905135">)</span>&nbsp;<span class="op" id="1905137">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905143">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905160">if</span>&nbsp;<span class="ident" id="1905163">keymaybe</span>&nbsp;<span class="op" id="1905172">!=</span>&nbsp;<span class="ident" id="1905175">bucketCnt</span>&nbsp;<span class="op" id="1905185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1905191">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905261">goto</span>&nbsp;<span class="ident" id="1905266">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905281">keymaybe</span>&nbsp;<span class="op" id="1905290">=</span>&nbsp;<span class="ident" id="1905292">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905300">if</span>&nbsp;<span class="ident" id="1905303">keymaybe</span>&nbsp;<span class="op" id="1905312">!=</span>&nbsp;<span class="ident" id="1905315">bucketCnt</span>&nbsp;<span class="op" id="1905325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905330">k</span>&nbsp;<span class="op" id="1905332">:=</span>&nbsp;<span class="op" id="1905335">(</span><span class="op" id="1905336">*</span><span class="ident" id="1905337">stringStruct</span><span class="op" id="1905349">)</span><span class="op" id="1905350">(</span><span class="ident" id="1905351">add</span><span class="op" id="1905354">(</span><span class="ident" id="1905355">unsafe</span><span class="op" id="1905361">.</span><span class="ident" id="1905362">Pointer</span><span class="op" id="1905369">(</span><span class="ident" id="1905370">b</span><span class="op" id="1905371">)</span><span class="op" id="1905372">,</span>&nbsp;<span class="ident" id="1905374">dataOffset</span><span class="op" id="1905384">+</span><span class="ident" id="1905385">keymaybe</span><span class="op" id="1905393">*</span><span class="num" id="1905394">2</span><span class="op" id="1905395">*</span><span class="ident" id="1905396">ptrSize</span><span class="op" id="1905403">)</span><span class="op" id="1905404">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905409">if</span>&nbsp;<span class="ident" id="1905412">memeq</span><span class="op" id="1905417">(</span><span class="ident" id="1905418">k</span><span class="op" id="1905419">.</span><span class="ident" id="1905420">str</span><span class="op" id="1905423">,</span>&nbsp;<span class="ident" id="1905425">key</span><span class="op" id="1905428">.</span><span class="ident" id="1905429">str</span><span class="op" id="1905432">,</span>&nbsp;<span class="builtintype" id="1905434">uintptr</span><span class="op" id="1905441">(</span><span class="ident" id="1905442">key</span><span class="op" id="1905445">.</span><span class="builtinfunc" id="1905446">len</span><span class="op" id="1905449">)</span><span class="op" id="1905450">)</span>&nbsp;<span class="op" id="1905452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905458">return</span>&nbsp;<span class="ident" id="1905465">add</span><span class="op" id="1905468">(</span><span class="ident" id="1905469">unsafe</span><span class="op" id="1905475">.</span><span class="ident" id="1905476">Pointer</span><span class="op" id="1905483">(</span><span class="ident" id="1905484">b</span><span class="op" id="1905485">)</span><span class="op" id="1905486">,</span>&nbsp;<span class="ident" id="1905488">dataOffset</span><span class="op" id="1905498">+</span><span class="ident" id="1905499">bucketCnt</span><span class="op" id="1905508">*</span><span class="num" id="1905509">2</span><span class="op" id="1905510">*</span><span class="ident" id="1905511">ptrSize</span><span class="op" id="1905518">+</span><span class="ident" id="1905519">keymaybe</span><span class="op" id="1905527">*</span><span class="builtintype" id="1905528">uintptr</span><span class="op" id="1905535">(</span><span class="ident" id="1905536">t</span><span class="op" id="1905537">.</span><span class="ident" id="1905538">valuesize</span><span class="op" id="1905547">)</span><span class="op" id="1905548">)</span><span class="op" id="1905549">,</span>&nbsp;<span class="builtintype" id="1905551">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905567">return</span>&nbsp;<span class="ident" id="1905574">unsafe</span><span class="op" id="1905580">.</span><span class="ident" id="1905581">Pointer</span><span class="op" id="1905588">(</span><span class="ident" id="1905589">t</span><span class="op" id="1905590">.</span><span class="ident" id="1905591">elem</span><span class="op" id="1905595">.</span><span class="ident" id="1905596">zero</span><span class="op" id="1905600">)</span><span class="op" id="1905601">,</span>&nbsp;<span class="builtintype" id="1905603">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905610">}</span><br>
<span class="lineno"></span><span class="ident" id="1905612">dohash</span><span class="op" id="1905618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905621">hash</span>&nbsp;<span class="op" id="1905626">:=</span>&nbsp;<span class="ident" id="1905629">goalg</span><span class="op" id="1905634">(</span><span class="ident" id="1905635">t</span><span class="op" id="1905636">.</span><span class="ident" id="1905637">key</span><span class="op" id="1905640">.</span><span class="ident" id="1905641">alg</span><span class="op" id="1905644">)</span><span class="op" id="1905645">.</span><span class="ident" id="1905646">hash</span><span class="op" id="1905650">(</span><span class="ident" id="1905651">noescape</span><span class="op" id="1905659">(</span><span class="ident" id="1905660">unsafe</span><span class="op" id="1905666">.</span><span class="ident" id="1905667">Pointer</span><span class="op" id="1905674">(</span><span class="op" id="1905675">&amp;</span><span class="ident" id="1905676">ky</span><span class="op" id="1905678">)</span><span class="op" id="1905679">)</span><span class="op" id="1905680">,</span>&nbsp;<span class="num" id="1905682">2</span><span class="op" id="1905683">*</span><span class="ident" id="1905684">ptrSize</span><span class="op" id="1905691">,</span>&nbsp;<span class="builtintype" id="1905693">uintptr</span><span class="op" id="1905700">(</span><span class="ident" id="1905701">h</span><span class="op" id="1905702">.</span><span class="ident" id="1905703">hash0</span><span class="op" id="1905708">)</span><span class="op" id="1905709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905712">m</span>&nbsp;<span class="op" id="1905714">:=</span>&nbsp;<span class="builtintype" id="1905717">uintptr</span><span class="op" id="1905724">(</span><span class="num" id="1905725">1</span><span class="op" id="1905726">)</span><span class="op" id="1905727">&lt;&lt;</span><span class="ident" id="1905729">h</span><span class="op" id="1905730">.</span><span class="ident" id="1905731">B</span>&nbsp;<span class="op" id="1905733">-</span>&nbsp;<span class="num" id="1905735">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905738">b</span>&nbsp;<span class="op" id="1905740">:=</span>&nbsp;<span class="op" id="1905743">(</span><span class="op" id="1905744">*</span><span class="ident" id="1905745">bmap</span><span class="op" id="1905749">)</span><span class="op" id="1905750">(</span><span class="ident" id="1905751">add</span><span class="op" id="1905754">(</span><span class="ident" id="1905755">h</span><span class="op" id="1905756">.</span><span class="ident" id="1905757">buckets</span><span class="op" id="1905764">,</span>&nbsp;<span class="op" id="1905766">(</span><span class="ident" id="1905767">hash</span><span class="op" id="1905771">&amp;</span><span class="ident" id="1905772">m</span><span class="op" id="1905773">)</span><span class="op" id="1905774">*</span><span class="builtintype" id="1905775">uintptr</span><span class="op" id="1905782">(</span><span class="ident" id="1905783">t</span><span class="op" id="1905784">.</span><span class="ident" id="1905785">bucketsize</span><span class="op" id="1905795">)</span><span class="op" id="1905796">)</span><span class="op" id="1905797">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905800">if</span>&nbsp;<span class="ident" id="1905803">c</span>&nbsp;<span class="op" id="1905805">:=</span>&nbsp;<span class="ident" id="1905808">h</span><span class="op" id="1905809">.</span><span class="ident" id="1905810">oldbuckets</span><span class="op" id="1905820">;</span>&nbsp;<span class="ident" id="1905822">c</span>&nbsp;<span class="op" id="1905824">!=</span>&nbsp;<span class="ident" id="1905827">nil</span>&nbsp;<span class="op" id="1905831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905835">oldb</span>&nbsp;<span class="op" id="1905840">:=</span>&nbsp;<span class="op" id="1905843">(</span><span class="op" id="1905844">*</span><span class="ident" id="1905845">bmap</span><span class="op" id="1905849">)</span><span class="op" id="1905850">(</span><span class="ident" id="1905851">add</span><span class="op" id="1905854">(</span><span class="ident" id="1905855">c</span><span class="op" id="1905856">,</span>&nbsp;<span class="op" id="1905858">(</span><span class="ident" id="1905859">hash</span><span class="op" id="1905863">&amp;</span><span class="op" id="1905864">(</span><span class="ident" id="1905865">m</span><span class="op" id="1905866">&gt;&gt;</span><span class="num" id="1905868">1</span><span class="op" id="1905869">)</span><span class="op" id="1905870">)</span><span class="op" id="1905871">*</span><span class="builtintype" id="1905872">uintptr</span><span class="op" id="1905879">(</span><span class="ident" id="1905880">t</span><span class="op" id="1905881">.</span><span class="ident" id="1905882">bucketsize</span><span class="op" id="1905892">)</span><span class="op" id="1905893">)</span><span class="op" id="1905894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905898">if</span>&nbsp;<span class="op" id="1905901">!</span><span class="ident" id="1905902">evacuated</span><span class="op" id="1905911">(</span><span class="ident" id="1905912">oldb</span><span class="op" id="1905916">)</span>&nbsp;<span class="op" id="1905918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905923">b</span>&nbsp;<span class="op" id="1905925">=</span>&nbsp;<span class="ident" id="1905927">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905934">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905940">top</span>&nbsp;<span class="op" id="1905944">:=</span>&nbsp;<span class="builtintype" id="1905947">uint8</span><span class="op" id="1905952">(</span><span class="ident" id="1905953">hash</span>&nbsp;<span class="op" id="1905958">&gt;&gt;</span>&nbsp;<span class="op" id="1905961">(</span><span class="ident" id="1905962">ptrSize</span><span class="op" id="1905969">*</span><span class="num" id="1905970">8</span>&nbsp;<span class="op" id="1905972">-</span>&nbsp;<span class="num" id="1905974">8</span><span class="op" id="1905975">)</span><span class="op" id="1905976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905979">if</span>&nbsp;<span class="ident" id="1905982">top</span>&nbsp;<span class="op" id="1905986">&lt;</span>&nbsp;<span class="ident" id="1905988">minTopHash</span>&nbsp;<span class="op" id="1905999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906003">top</span>&nbsp;<span class="op" id="1906007">+=</span>&nbsp;<span class="ident" id="1906010">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906022">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906025">for</span>&nbsp;<span class="op" id="1906029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906033">for</span>&nbsp;<span class="ident" id="1906037">i</span>&nbsp;<span class="op" id="1906039">:=</span>&nbsp;<span class="builtintype" id="1906042">uintptr</span><span class="op" id="1906049">(</span><span class="num" id="1906050">0</span><span class="op" id="1906051">)</span><span class="op" id="1906052">;</span>&nbsp;<span class="ident" id="1906054">i</span>&nbsp;<span class="op" id="1906056">&lt;</span>&nbsp;<span class="ident" id="1906058">bucketCnt</span><span class="op" id="1906067">;</span>&nbsp;<span class="ident" id="1906069">i</span><span class="op" id="1906070">++</span>&nbsp;<span class="op" id="1906073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906078">x</span>&nbsp;<span class="op" id="1906080">:=</span>&nbsp;<span class="op" id="1906083">*</span><span class="op" id="1906084">(</span><span class="op" id="1906085">(</span><span class="op" id="1906086">*</span><span class="builtintype" id="1906087">uint8</span><span class="op" id="1906092">)</span><span class="op" id="1906093">(</span><span class="ident" id="1906094">add</span><span class="op" id="1906097">(</span><span class="ident" id="1906098">unsafe</span><span class="op" id="1906104">.</span><span class="ident" id="1906105">Pointer</span><span class="op" id="1906112">(</span><span class="ident" id="1906113">b</span><span class="op" id="1906114">)</span><span class="op" id="1906115">,</span>&nbsp;<span class="ident" id="1906117">i</span><span class="op" id="1906118">)</span><span class="op" id="1906119">)</span><span class="op" id="1906120">)</span>&nbsp;<span class="comment" id="1906122">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906166">if</span>&nbsp;<span class="ident" id="1906169">x</span>&nbsp;<span class="op" id="1906171">!=</span>&nbsp;<span class="ident" id="1906174">top</span>&nbsp;<span class="op" id="1906178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906184">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906201">k</span>&nbsp;<span class="op" id="1906203">:=</span>&nbsp;<span class="op" id="1906206">(</span><span class="op" id="1906207">*</span><span class="ident" id="1906208">stringStruct</span><span class="op" id="1906220">)</span><span class="op" id="1906221">(</span><span class="ident" id="1906222">add</span><span class="op" id="1906225">(</span><span class="ident" id="1906226">unsafe</span><span class="op" id="1906232">.</span><span class="ident" id="1906233">Pointer</span><span class="op" id="1906240">(</span><span class="ident" id="1906241">b</span><span class="op" id="1906242">)</span><span class="op" id="1906243">,</span>&nbsp;<span class="ident" id="1906245">dataOffset</span><span class="op" id="1906255">+</span><span class="ident" id="1906256">i</span><span class="op" id="1906257">*</span><span class="num" id="1906258">2</span><span class="op" id="1906259">*</span><span class="ident" id="1906260">ptrSize</span><span class="op" id="1906267">)</span><span class="op" id="1906268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906273">if</span>&nbsp;<span class="ident" id="1906276">k</span><span class="op" id="1906277">.</span><span class="builtinfunc" id="1906278">len</span>&nbsp;<span class="op" id="1906282">!=</span>&nbsp;<span class="ident" id="1906285">key</span><span class="op" id="1906288">.</span><span class="builtinfunc" id="1906289">len</span>&nbsp;<span class="op" id="1906293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906299">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906311">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906316">if</span>&nbsp;<span class="ident" id="1906319">k</span><span class="op" id="1906320">.</span><span class="ident" id="1906321">str</span>&nbsp;<span class="op" id="1906325">==</span>&nbsp;<span class="ident" id="1906328">key</span><span class="op" id="1906331">.</span><span class="ident" id="1906332">str</span>&nbsp;<span class="op" id="1906336">||</span>&nbsp;<span class="ident" id="1906339">memeq</span><span class="op" id="1906344">(</span><span class="ident" id="1906345">k</span><span class="op" id="1906346">.</span><span class="ident" id="1906347">str</span><span class="op" id="1906350">,</span>&nbsp;<span class="ident" id="1906352">key</span><span class="op" id="1906355">.</span><span class="ident" id="1906356">str</span><span class="op" id="1906359">,</span>&nbsp;<span class="builtintype" id="1906361">uintptr</span><span class="op" id="1906368">(</span><span class="ident" id="1906369">key</span><span class="op" id="1906372">.</span><span class="builtinfunc" id="1906373">len</span><span class="op" id="1906376">)</span><span class="op" id="1906377">)</span>&nbsp;<span class="op" id="1906379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906385">return</span>&nbsp;<span class="ident" id="1906392">add</span><span class="op" id="1906395">(</span><span class="ident" id="1906396">unsafe</span><span class="op" id="1906402">.</span><span class="ident" id="1906403">Pointer</span><span class="op" id="1906410">(</span><span class="ident" id="1906411">b</span><span class="op" id="1906412">)</span><span class="op" id="1906413">,</span>&nbsp;<span class="ident" id="1906415">dataOffset</span><span class="op" id="1906425">+</span><span class="ident" id="1906426">bucketCnt</span><span class="op" id="1906435">*</span><span class="num" id="1906436">2</span><span class="op" id="1906437">*</span><span class="ident" id="1906438">ptrSize</span><span class="op" id="1906445">+</span><span class="ident" id="1906446">i</span><span class="op" id="1906447">*</span><span class="builtintype" id="1906448">uintptr</span><span class="op" id="1906455">(</span><span class="ident" id="1906456">t</span><span class="op" id="1906457">.</span><span class="ident" id="1906458">valuesize</span><span class="op" id="1906467">)</span><span class="op" id="1906468">)</span><span class="op" id="1906469">,</span>&nbsp;<span class="builtintype" id="1906471">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906487">b</span>&nbsp;<span class="op" id="1906489">=</span>&nbsp;<span class="ident" id="1906491">b</span><span class="op" id="1906492">.</span><span class="ident" id="1906493">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906504">if</span>&nbsp;<span class="ident" id="1906507">b</span>&nbsp;<span class="op" id="1906509">==</span>&nbsp;<span class="ident" id="1906512">nil</span>&nbsp;<span class="op" id="1906516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906521">return</span>&nbsp;<span class="ident" id="1906528">unsafe</span><span class="op" id="1906534">.</span><span class="ident" id="1906535">Pointer</span><span class="op" id="1906542">(</span><span class="ident" id="1906543">t</span><span class="op" id="1906544">.</span><span class="ident" id="1906545">elem</span><span class="op" id="1906549">.</span><span class="ident" id="1906550">zero</span><span class="op" id="1906554">)</span><span class="op" id="1906555">,</span>&nbsp;<span class="builtintype" id="1906557">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906568">}</span><br>
<span class="lineno"></span><span class="op" id="1906570">}</span>
</div>
</body>
</html>
