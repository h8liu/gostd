<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2035660">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2035716">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2035770">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2035821">package</span>&nbsp;<span class="ident" id="2035829">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2035837">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="2035899">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="2035919">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="2035993">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="2036021">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2036096">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="2036134">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2036203">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="2036276">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="2036351">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2036403">//</span><br>
<span class="lineno"></span><span class="comment" id="2036406">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="2036422">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="2036491">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="2036570">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="2036649">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2036725">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2036804">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="2036882">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2036963">import</span>&nbsp;<span class="op" id="2036970">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2036973">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2036983">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="2036988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2036991">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="2037065">const</span>&nbsp;<span class="op" id="2037071">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037074">MaxVarintLen16</span>&nbsp;<span class="op" id="2037089">=</span>&nbsp;<span class="num" id="2037091">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037094">MaxVarintLen32</span>&nbsp;<span class="op" id="2037109">=</span>&nbsp;<span class="num" id="2037111">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037114">MaxVarintLen64</span>&nbsp;<span class="op" id="2037129">=</span>&nbsp;<span class="num" id="2037131">10</span><br>
<span class="lineno"></span><span class="op" id="2037134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2037137">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="2037218">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2037272">func</span>&nbsp;<span class="ident" id="2037277">PutUvarint</span><span class="op" id="2037287">(</span><span class="ident" id="2037288">buf</span>&nbsp;<span class="op" id="2037292">[</span><span class="op" id="2037293">]</span><span class="builtintype" id="2037294">byte</span><span class="op" id="2037298">,</span>&nbsp;<span class="ident" id="2037300">x</span>&nbsp;<span class="ident" id="2037302">uint64</span><span class="op" id="2037308">)</span>&nbsp;<span class="builtintype" id="2037310">int</span>&nbsp;<span class="op" id="2037314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037317">i</span>&nbsp;<span class="op" id="2037319">:=</span>&nbsp;<span class="num" id="2037322">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037325">for</span>&nbsp;<span class="ident" id="2037329">x</span>&nbsp;<span class="op" id="2037331">&gt;=</span>&nbsp;<span class="num" id="2037334">0x80</span>&nbsp;<span class="op" id="2037339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037343">buf</span><span class="op" id="2037346">[</span><span class="ident" id="2037347">i</span><span class="op" id="2037348">]</span>&nbsp;<span class="op" id="2037350">=</span>&nbsp;<span class="builtintype" id="2037352">byte</span><span class="op" id="2037356">(</span><span class="ident" id="2037357">x</span><span class="op" id="2037358">)</span>&nbsp;<span class="op" id="2037360">|</span>&nbsp;<span class="num" id="2037362">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037369">x</span>&nbsp;<span class="op" id="2037371">&gt;&gt;=</span>&nbsp;<span class="num" id="2037375">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037379">i</span><span class="op" id="2037380">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2037384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037387">buf</span><span class="op" id="2037390">[</span><span class="ident" id="2037391">i</span><span class="op" id="2037392">]</span>&nbsp;<span class="op" id="2037394">=</span>&nbsp;<span class="builtintype" id="2037396">byte</span><span class="op" id="2037400">(</span><span class="ident" id="2037401">x</span><span class="op" id="2037402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037405">return</span>&nbsp;<span class="ident" id="2037412">i</span>&nbsp;<span class="op" id="2037414">+</span>&nbsp;<span class="num" id="2037416">1</span><br>
<span class="lineno">50</span><span class="op" id="2037418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2037421">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2037489">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2037557">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="2037603">//</span><br>
<span class="lineno"></span><span class="comment" id="2037606">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2037631">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2037679">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2037730">//</span><br>
<span class="lineno">60</span><span class="keyword" id="2037733">func</span>&nbsp;<span class="ident" id="2037738">Uvarint</span><span class="op" id="2037745">(</span><span class="ident" id="2037746">buf</span>&nbsp;<span class="op" id="2037750">[</span><span class="op" id="2037751">]</span><span class="builtintype" id="2037752">byte</span><span class="op" id="2037756">)</span>&nbsp;<span class="op" id="2037758">(</span><span class="ident" id="2037759">uint64</span><span class="op" id="2037765">,</span>&nbsp;<span class="builtintype" id="2037767">int</span><span class="op" id="2037770">)</span>&nbsp;<span class="op" id="2037772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037775">var</span>&nbsp;<span class="ident" id="2037779">x</span>&nbsp;<span class="ident" id="2037781">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037789">var</span>&nbsp;<span class="ident" id="2037793">s</span>&nbsp;<span class="builtintype" id="2037795">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037801">for</span>&nbsp;<span class="ident" id="2037805">i</span><span class="op" id="2037806">,</span>&nbsp;<span class="ident" id="2037808">b</span>&nbsp;<span class="op" id="2037810">:=</span>&nbsp;<span class="keyword" id="2037813">range</span>&nbsp;<span class="ident" id="2037819">buf</span>&nbsp;<span class="op" id="2037823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037827">if</span>&nbsp;<span class="ident" id="2037830">b</span>&nbsp;<span class="op" id="2037832">&lt;</span>&nbsp;<span class="num" id="2037834">0x80</span>&nbsp;<span class="op" id="2037839">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037844">if</span>&nbsp;<span class="ident" id="2037847">i</span>&nbsp;<span class="op" id="2037849">&gt;</span>&nbsp;<span class="num" id="2037851">9</span>&nbsp;<span class="op" id="2037853">||</span>&nbsp;<span class="ident" id="2037856">i</span>&nbsp;<span class="op" id="2037858">==</span>&nbsp;<span class="num" id="2037861">9</span>&nbsp;<span class="op" id="2037863">&amp;&amp;</span>&nbsp;<span class="ident" id="2037866">b</span>&nbsp;<span class="op" id="2037868">&gt;</span>&nbsp;<span class="num" id="2037870">1</span>&nbsp;<span class="op" id="2037872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037878">return</span>&nbsp;<span class="num" id="2037885">0</span><span class="op" id="2037886">,</span>&nbsp;<span class="op" id="2037888">-</span><span class="op" id="2037889">(</span><span class="ident" id="2037890">i</span>&nbsp;<span class="op" id="2037892">+</span>&nbsp;<span class="num" id="2037894">1</span><span class="op" id="2037895">)</span>&nbsp;<span class="comment" id="2037897">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2037912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037917">return</span>&nbsp;<span class="ident" id="2037924">x</span>&nbsp;<span class="op" id="2037926">|</span>&nbsp;<span class="ident" id="2037928">uint64</span><span class="op" id="2037934">(</span><span class="ident" id="2037935">b</span><span class="op" id="2037936">)</span><span class="op" id="2037937">&lt;&lt;</span><span class="ident" id="2037939">s</span><span class="op" id="2037940">,</span>&nbsp;<span class="ident" id="2037942">i</span>&nbsp;<span class="op" id="2037944">+</span>&nbsp;<span class="num" id="2037946">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2037950">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037954">x</span>&nbsp;<span class="op" id="2037956">|=</span>&nbsp;<span class="ident" id="2037959">uint64</span><span class="op" id="2037965">(</span><span class="ident" id="2037966">b</span><span class="op" id="2037967">&amp;</span><span class="num" id="2037968">0x7f</span><span class="op" id="2037972">)</span>&nbsp;<span class="op" id="2037974">&lt;&lt;</span>&nbsp;<span class="ident" id="2037977">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037981">s</span>&nbsp;<span class="op" id="2037983">+=</span>&nbsp;<span class="num" id="2037986">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2037989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2037992">return</span>&nbsp;<span class="num" id="2037999">0</span><span class="op" id="2038000">,</span>&nbsp;<span class="num" id="2038002">0</span><br>
<span class="lineno"></span><span class="op" id="2038004">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="2038007">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2038087">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2038140">func</span>&nbsp;<span class="ident" id="2038145">PutVarint</span><span class="op" id="2038154">(</span><span class="ident" id="2038155">buf</span>&nbsp;<span class="op" id="2038159">[</span><span class="op" id="2038160">]</span><span class="builtintype" id="2038161">byte</span><span class="op" id="2038165">,</span>&nbsp;<span class="ident" id="2038167">x</span>&nbsp;<span class="ident" id="2038169">int64</span><span class="op" id="2038174">)</span>&nbsp;<span class="builtintype" id="2038176">int</span>&nbsp;<span class="op" id="2038180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2038183">ux</span>&nbsp;<span class="op" id="2038186">:=</span>&nbsp;<span class="ident" id="2038189">uint64</span><span class="op" id="2038195">(</span><span class="ident" id="2038196">x</span><span class="op" id="2038197">)</span>&nbsp;<span class="op" id="2038199">&lt;&lt;</span>&nbsp;<span class="num" id="2038202">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038205">if</span>&nbsp;<span class="ident" id="2038208">x</span>&nbsp;<span class="op" id="2038210">&lt;</span>&nbsp;<span class="num" id="2038212">0</span>&nbsp;<span class="op" id="2038214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2038218">ux</span>&nbsp;<span class="op" id="2038221">=</span>&nbsp;<span class="op" id="2038223">^</span><span class="ident" id="2038224">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2038228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038231">return</span>&nbsp;<span class="ident" id="2038238">PutUvarint</span><span class="op" id="2038248">(</span><span class="ident" id="2038249">buf</span><span class="op" id="2038252">,</span>&nbsp;<span class="ident" id="2038254">ux</span><span class="op" id="2038256">)</span><br>
<span class="lineno"></span><span class="op" id="2038258">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="2038261">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2038328">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2038396">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="2038461">//</span><br>
<span class="lineno">90</span><span class="comment" id="2038464">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2038489">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2038537">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2038588">//</span><br>
<span class="lineno"></span><span class="keyword" id="2038591">func</span>&nbsp;<span class="ident" id="2038596">Varint</span><span class="op" id="2038602">(</span><span class="ident" id="2038603">buf</span>&nbsp;<span class="op" id="2038607">[</span><span class="op" id="2038608">]</span><span class="builtintype" id="2038609">byte</span><span class="op" id="2038613">)</span>&nbsp;<span class="op" id="2038615">(</span><span class="ident" id="2038616">int64</span><span class="op" id="2038621">,</span>&nbsp;<span class="builtintype" id="2038623">int</span><span class="op" id="2038626">)</span>&nbsp;<span class="op" id="2038628">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2038631">ux</span><span class="op" id="2038633">,</span>&nbsp;<span class="ident" id="2038635">n</span>&nbsp;<span class="op" id="2038637">:=</span>&nbsp;<span class="ident" id="2038640">Uvarint</span><span class="op" id="2038647">(</span><span class="ident" id="2038648">buf</span><span class="op" id="2038651">)</span>&nbsp;<span class="comment" id="2038653">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2038693">x</span>&nbsp;<span class="op" id="2038695">:=</span>&nbsp;<span class="ident" id="2038698">int64</span><span class="op" id="2038703">(</span><span class="ident" id="2038704">ux</span>&nbsp;<span class="op" id="2038707">&gt;&gt;</span>&nbsp;<span class="num" id="2038710">1</span><span class="op" id="2038711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038714">if</span>&nbsp;<span class="ident" id="2038717">ux</span><span class="op" id="2038719">&amp;</span><span class="num" id="2038720">1</span>&nbsp;<span class="op" id="2038722">!=</span>&nbsp;<span class="num" id="2038725">0</span>&nbsp;<span class="op" id="2038727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2038731">x</span>&nbsp;<span class="op" id="2038733">=</span>&nbsp;<span class="op" id="2038735">^</span><span class="ident" id="2038736">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2038739">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038742">return</span>&nbsp;<span class="ident" id="2038749">x</span><span class="op" id="2038750">,</span>&nbsp;<span class="ident" id="2038752">n</span><br>
<span class="lineno"></span><span class="op" id="2038754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2038757">var</span>&nbsp;<span class="ident" id="2038761">overflow</span>&nbsp;<span class="op" id="2038770">=</span>&nbsp;<span class="ident" id="2038772">errors</span><span class="op" id="2038778">.</span><span class="ident" id="2038779">New</span><span class="op" id="2038782">(</span><span class="string" id="2038783">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="2038826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2038829">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="2038913">func</span>&nbsp;<span class="ident" id="2038918">ReadUvarint</span><span class="op" id="2038929">(</span><span class="ident" id="2038930">r</span>&nbsp;<span class="ident" id="2038932">io</span><span class="op" id="2038934">.</span><span class="ident" id="2038935">ByteReader</span><span class="op" id="2038945">)</span>&nbsp;<span class="op" id="2038947">(</span><span class="ident" id="2038948">uint64</span><span class="op" id="2038954">,</span>&nbsp;<span class="builtintype" id="2038956">error</span><span class="op" id="2038961">)</span>&nbsp;<span class="op" id="2038963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038966">var</span>&nbsp;<span class="ident" id="2038970">x</span>&nbsp;<span class="ident" id="2038972">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038980">var</span>&nbsp;<span class="ident" id="2038984">s</span>&nbsp;<span class="builtintype" id="2038986">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038992">for</span>&nbsp;<span class="ident" id="2038996">i</span>&nbsp;<span class="op" id="2038998">:=</span>&nbsp;<span class="num" id="2039001">0</span><span class="op" id="2039002">;</span>&nbsp;<span class="op" id="2039004">;</span>&nbsp;<span class="ident" id="2039006">i</span><span class="op" id="2039007">++</span>&nbsp;<span class="op" id="2039010">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039014">b</span><span class="op" id="2039015">,</span>&nbsp;<span class="ident" id="2039017">err</span>&nbsp;<span class="op" id="2039021">:=</span>&nbsp;<span class="ident" id="2039024">r</span><span class="op" id="2039025">.</span><span class="ident" id="2039026">ReadByte</span><span class="op" id="2039034">(</span><span class="op" id="2039035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039039">if</span>&nbsp;<span class="ident" id="2039042">err</span>&nbsp;<span class="op" id="2039046">!=</span>&nbsp;<span class="ident" id="2039049">nil</span>&nbsp;<span class="op" id="2039053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039058">return</span>&nbsp;<span class="ident" id="2039065">x</span><span class="op" id="2039066">,</span>&nbsp;<span class="ident" id="2039068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2039074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039078">if</span>&nbsp;<span class="ident" id="2039081">b</span>&nbsp;<span class="op" id="2039083">&lt;</span>&nbsp;<span class="num" id="2039085">0x80</span>&nbsp;<span class="op" id="2039090">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039095">if</span>&nbsp;<span class="ident" id="2039098">i</span>&nbsp;<span class="op" id="2039100">&gt;</span>&nbsp;<span class="num" id="2039102">9</span>&nbsp;<span class="op" id="2039104">||</span>&nbsp;<span class="ident" id="2039107">i</span>&nbsp;<span class="op" id="2039109">==</span>&nbsp;<span class="num" id="2039112">9</span>&nbsp;<span class="op" id="2039114">&amp;&amp;</span>&nbsp;<span class="ident" id="2039117">b</span>&nbsp;<span class="op" id="2039119">&gt;</span>&nbsp;<span class="num" id="2039121">1</span>&nbsp;<span class="op" id="2039123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039129">return</span>&nbsp;<span class="ident" id="2039136">x</span><span class="op" id="2039137">,</span>&nbsp;<span class="ident" id="2039139">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2039151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039156">return</span>&nbsp;<span class="ident" id="2039163">x</span>&nbsp;<span class="op" id="2039165">|</span>&nbsp;<span class="ident" id="2039167">uint64</span><span class="op" id="2039173">(</span><span class="ident" id="2039174">b</span><span class="op" id="2039175">)</span><span class="op" id="2039176">&lt;&lt;</span><span class="ident" id="2039178">s</span><span class="op" id="2039179">,</span>&nbsp;<span class="ident" id="2039181">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2039187">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039191">x</span>&nbsp;<span class="op" id="2039193">|=</span>&nbsp;<span class="ident" id="2039196">uint64</span><span class="op" id="2039202">(</span><span class="ident" id="2039203">b</span><span class="op" id="2039204">&amp;</span><span class="num" id="2039205">0x7f</span><span class="op" id="2039209">)</span>&nbsp;<span class="op" id="2039211">&lt;&lt;</span>&nbsp;<span class="ident" id="2039214">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039218">s</span>&nbsp;<span class="op" id="2039220">+=</span>&nbsp;<span class="num" id="2039223">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2039226">}</span><br>
<span class="lineno"></span><span class="op" id="2039228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2039231">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="2039312">func</span>&nbsp;<span class="ident" id="2039317">ReadVarint</span><span class="op" id="2039327">(</span><span class="ident" id="2039328">r</span>&nbsp;<span class="ident" id="2039330">io</span><span class="op" id="2039332">.</span><span class="ident" id="2039333">ByteReader</span><span class="op" id="2039343">)</span>&nbsp;<span class="op" id="2039345">(</span><span class="ident" id="2039346">int64</span><span class="op" id="2039351">,</span>&nbsp;<span class="builtintype" id="2039353">error</span><span class="op" id="2039358">)</span>&nbsp;<span class="op" id="2039360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039363">ux</span><span class="op" id="2039365">,</span>&nbsp;<span class="ident" id="2039367">err</span>&nbsp;<span class="op" id="2039371">:=</span>&nbsp;<span class="ident" id="2039374">ReadUvarint</span><span class="op" id="2039385">(</span><span class="ident" id="2039386">r</span><span class="op" id="2039387">)</span>&nbsp;<span class="comment" id="2039389">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039429">x</span>&nbsp;<span class="op" id="2039431">:=</span>&nbsp;<span class="ident" id="2039434">int64</span><span class="op" id="2039439">(</span><span class="ident" id="2039440">ux</span>&nbsp;<span class="op" id="2039443">&gt;&gt;</span>&nbsp;<span class="num" id="2039446">1</span><span class="op" id="2039447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039450">if</span>&nbsp;<span class="ident" id="2039453">ux</span><span class="op" id="2039455">&amp;</span><span class="num" id="2039456">1</span>&nbsp;<span class="op" id="2039458">!=</span>&nbsp;<span class="num" id="2039461">0</span>&nbsp;<span class="op" id="2039463">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2039467">x</span>&nbsp;<span class="op" id="2039469">=</span>&nbsp;<span class="op" id="2039471">^</span><span class="ident" id="2039472">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2039475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2039478">return</span>&nbsp;<span class="ident" id="2039485">x</span><span class="op" id="2039486">,</span>&nbsp;<span class="ident" id="2039488">err</span><br>
<span class="lineno"></span><span class="op" id="2039492">}</span>
</div>
</body>
</html>
