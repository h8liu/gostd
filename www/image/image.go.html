<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5518748">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5518803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5518857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5518908">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5518963">//</span><br>
<span class="lineno"></span><span class="comment" id="5518966">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5519044">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5519089">//</span><br>
<span class="lineno">10</span><span class="comment" id="5519092">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5519170">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5519249">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5519325">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5519396">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5519473">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5519545">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5519569">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5519648">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5519680">//</span><br>
<span class="lineno">20</span><span class="comment" id="5519683">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5519731">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5519784">package</span>&nbsp;<span class="ident" id="5519792">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5519799">import</span>&nbsp;<span class="op" id="5519806">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5519809">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5519823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519826">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5519881">type</span>&nbsp;<span class="ident" id="5519886">Config</span>&nbsp;<span class="keyword" id="5519893">struct</span>&nbsp;<span class="op" id="5519900">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519903">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519917">color</span><span class="op" id="5519922">.</span><span class="ident" id="5519923">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519930">Width</span><span class="op" id="5519935">,</span>&nbsp;<span class="ident" id="5519937">Height</span>&nbsp;<span class="builtintype" id="5519944">int</span><br>
<span class="lineno"></span><span class="op" id="5519948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519951">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5520030">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5520040">type</span>&nbsp;<span class="ident" id="5520045">Image</span>&nbsp;<span class="keyword" id="5520051">interface</span>&nbsp;<span class="op" id="5520061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520064">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520112">ColorModel</span><span class="op" id="5520122">(</span><span class="op" id="5520123">)</span>&nbsp;<span class="ident" id="5520125">color</span><span class="op" id="5520130">.</span><span class="ident" id="5520131">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520138">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520208">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520268">Bounds</span><span class="op" id="5520274">(</span><span class="op" id="5520275">)</span>&nbsp;<span class="ident" id="5520277">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520288">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520337">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520418">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520490">At</span><span class="op" id="5520492">(</span><span class="ident" id="5520493">x</span><span class="op" id="5520494">,</span>&nbsp;<span class="ident" id="5520496">y</span>&nbsp;<span class="builtintype" id="5520498">int</span><span class="op" id="5520501">)</span>&nbsp;<span class="ident" id="5520503">color</span><span class="op" id="5520508">.</span><span class="ident" id="5520509">Color</span><br>
<span class="lineno"></span><span class="op" id="5520515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520518">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5520593">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5520671">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5520746">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5520822">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5520836">type</span>&nbsp;<span class="ident" id="5520841">PalettedImage</span>&nbsp;<span class="keyword" id="5520855">interface</span>&nbsp;<span class="op" id="5520865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520868">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520935">ColorIndexAt</span><span class="op" id="5520947">(</span><span class="ident" id="5520948">x</span><span class="op" id="5520949">,</span>&nbsp;<span class="ident" id="5520951">y</span>&nbsp;<span class="builtintype" id="5520953">int</span><span class="op" id="5520956">)</span>&nbsp;<span class="builtintype" id="5520958">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520965">Image</span><br>
<span class="lineno"></span><span class="op" id="5520971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520974">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5521047">type</span>&nbsp;<span class="ident" id="5521052">RGBA</span>&nbsp;<span class="keyword" id="5521057">struct</span>&nbsp;<span class="op" id="5521064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521067">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521135">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521203">Pix</span>&nbsp;<span class="op" id="5521207">[</span><span class="op" id="5521208">]</span><span class="builtintype" id="5521209">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521216">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521292">Stride</span>&nbsp;<span class="builtintype" id="5521299">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521304">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521336">Rect</span>&nbsp;<span class="ident" id="5521341">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5521351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5521354">func</span>&nbsp;<span class="op" id="5521359">(</span><span class="ident" id="5521360">p</span>&nbsp;<span class="op" id="5521362">*</span><span class="ident" id="5521363">RGBA</span><span class="op" id="5521367">)</span>&nbsp;<span class="ident" id="5521369">ColorModel</span><span class="op" id="5521379">(</span><span class="op" id="5521380">)</span>&nbsp;<span class="ident" id="5521382">color</span><span class="op" id="5521387">.</span><span class="ident" id="5521388">Model</span>&nbsp;<span class="op" id="5521394">{</span>&nbsp;<span class="keyword" id="5521396">return</span>&nbsp;<span class="ident" id="5521403">color</span><span class="op" id="5521408">.</span><span class="ident" id="5521409">RGBAModel</span>&nbsp;<span class="op" id="5521419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521422">func</span>&nbsp;<span class="op" id="5521427">(</span><span class="ident" id="5521428">p</span>&nbsp;<span class="op" id="5521430">*</span><span class="ident" id="5521431">RGBA</span><span class="op" id="5521435">)</span>&nbsp;<span class="ident" id="5521437">Bounds</span><span class="op" id="5521443">(</span><span class="op" id="5521444">)</span>&nbsp;<span class="ident" id="5521446">Rectangle</span>&nbsp;<span class="op" id="5521456">{</span>&nbsp;<span class="keyword" id="5521458">return</span>&nbsp;<span class="ident" id="5521465">p</span><span class="op" id="5521466">.</span><span class="ident" id="5521467">Rect</span>&nbsp;<span class="op" id="5521472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521475">func</span>&nbsp;<span class="op" id="5521480">(</span><span class="ident" id="5521481">p</span>&nbsp;<span class="op" id="5521483">*</span><span class="ident" id="5521484">RGBA</span><span class="op" id="5521488">)</span>&nbsp;<span class="ident" id="5521490">At</span><span class="op" id="5521492">(</span><span class="ident" id="5521493">x</span><span class="op" id="5521494">,</span>&nbsp;<span class="ident" id="5521496">y</span>&nbsp;<span class="builtintype" id="5521498">int</span><span class="op" id="5521501">)</span>&nbsp;<span class="ident" id="5521503">color</span><span class="op" id="5521508">.</span><span class="ident" id="5521509">Color</span>&nbsp;<span class="op" id="5521515">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521518">return</span>&nbsp;<span class="ident" id="5521525">p</span><span class="op" id="5521526">.</span><span class="ident" id="5521527">RGBAAt</span><span class="op" id="5521533">(</span><span class="ident" id="5521534">x</span><span class="op" id="5521535">,</span>&nbsp;<span class="ident" id="5521537">y</span><span class="op" id="5521538">)</span><br>
<span class="lineno"></span><span class="op" id="5521540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521543">func</span>&nbsp;<span class="op" id="5521548">(</span><span class="ident" id="5521549">p</span>&nbsp;<span class="op" id="5521551">*</span><span class="ident" id="5521552">RGBA</span><span class="op" id="5521556">)</span>&nbsp;<span class="ident" id="5521558">RGBAAt</span><span class="op" id="5521564">(</span><span class="ident" id="5521565">x</span><span class="op" id="5521566">,</span>&nbsp;<span class="ident" id="5521568">y</span>&nbsp;<span class="builtintype" id="5521570">int</span><span class="op" id="5521573">)</span>&nbsp;<span class="ident" id="5521575">color</span><span class="op" id="5521580">.</span><span class="ident" id="5521581">RGBA</span>&nbsp;<span class="op" id="5521586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521589">if</span>&nbsp;<span class="op" id="5521592">!</span><span class="op" id="5521593">(</span><span class="ident" id="5521594">Point</span><span class="op" id="5521599">{</span><span class="ident" id="5521600">x</span><span class="op" id="5521601">,</span>&nbsp;<span class="ident" id="5521603">y</span><span class="op" id="5521604">}</span><span class="op" id="5521605">.</span><span class="ident" id="5521606">In</span><span class="op" id="5521608">(</span><span class="ident" id="5521609">p</span><span class="op" id="5521610">.</span><span class="ident" id="5521611">Rect</span><span class="op" id="5521615">)</span><span class="op" id="5521616">)</span>&nbsp;<span class="op" id="5521618">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521622">return</span>&nbsp;<span class="ident" id="5521629">color</span><span class="op" id="5521634">.</span><span class="ident" id="5521635">RGBA</span><span class="op" id="5521639">{</span><span class="op" id="5521640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521646">i</span>&nbsp;<span class="op" id="5521648">:=</span>&nbsp;<span class="ident" id="5521651">p</span><span class="op" id="5521652">.</span><span class="ident" id="5521653">PixOffset</span><span class="op" id="5521662">(</span><span class="ident" id="5521663">x</span><span class="op" id="5521664">,</span>&nbsp;<span class="ident" id="5521666">y</span><span class="op" id="5521667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521670">return</span>&nbsp;<span class="ident" id="5521677">color</span><span class="op" id="5521682">.</span><span class="ident" id="5521683">RGBA</span><span class="op" id="5521687">{</span><span class="ident" id="5521688">p</span><span class="op" id="5521689">.</span><span class="ident" id="5521690">Pix</span><span class="op" id="5521693">[</span><span class="ident" id="5521694">i</span><span class="op" id="5521695">+</span><span class="num" id="5521696">0</span><span class="op" id="5521697">]</span><span class="op" id="5521698">,</span>&nbsp;<span class="ident" id="5521700">p</span><span class="op" id="5521701">.</span><span class="ident" id="5521702">Pix</span><span class="op" id="5521705">[</span><span class="ident" id="5521706">i</span><span class="op" id="5521707">+</span><span class="num" id="5521708">1</span><span class="op" id="5521709">]</span><span class="op" id="5521710">,</span>&nbsp;<span class="ident" id="5521712">p</span><span class="op" id="5521713">.</span><span class="ident" id="5521714">Pix</span><span class="op" id="5521717">[</span><span class="ident" id="5521718">i</span><span class="op" id="5521719">+</span><span class="num" id="5521720">2</span><span class="op" id="5521721">]</span><span class="op" id="5521722">,</span>&nbsp;<span class="ident" id="5521724">p</span><span class="op" id="5521725">.</span><span class="ident" id="5521726">Pix</span><span class="op" id="5521729">[</span><span class="ident" id="5521730">i</span><span class="op" id="5521731">+</span><span class="num" id="5521732">3</span><span class="op" id="5521733">]</span><span class="op" id="5521734">}</span><br>
<span class="lineno"></span><span class="op" id="5521736">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5521739">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5521818">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5521842">func</span>&nbsp;<span class="op" id="5521847">(</span><span class="ident" id="5521848">p</span>&nbsp;<span class="op" id="5521850">*</span><span class="ident" id="5521851">RGBA</span><span class="op" id="5521855">)</span>&nbsp;<span class="ident" id="5521857">PixOffset</span><span class="op" id="5521866">(</span><span class="ident" id="5521867">x</span><span class="op" id="5521868">,</span>&nbsp;<span class="ident" id="5521870">y</span>&nbsp;<span class="builtintype" id="5521872">int</span><span class="op" id="5521875">)</span>&nbsp;<span class="builtintype" id="5521877">int</span>&nbsp;<span class="op" id="5521881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521884">return</span>&nbsp;<span class="op" id="5521891">(</span><span class="ident" id="5521892">y</span><span class="op" id="5521893">-</span><span class="ident" id="5521894">p</span><span class="op" id="5521895">.</span><span class="ident" id="5521896">Rect</span><span class="op" id="5521900">.</span><span class="ident" id="5521901">Min</span><span class="op" id="5521904">.</span><span class="ident" id="5521905">Y</span><span class="op" id="5521906">)</span><span class="op" id="5521907">*</span><span class="ident" id="5521908">p</span><span class="op" id="5521909">.</span><span class="ident" id="5521910">Stride</span>&nbsp;<span class="op" id="5521917">+</span>&nbsp;<span class="op" id="5521919">(</span><span class="ident" id="5521920">x</span><span class="op" id="5521921">-</span><span class="ident" id="5521922">p</span><span class="op" id="5521923">.</span><span class="ident" id="5521924">Rect</span><span class="op" id="5521928">.</span><span class="ident" id="5521929">Min</span><span class="op" id="5521932">.</span><span class="ident" id="5521933">X</span><span class="op" id="5521934">)</span><span class="op" id="5521935">*</span><span class="num" id="5521936">4</span><br>
<span class="lineno">90</span><span class="op" id="5521938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521941">func</span>&nbsp;<span class="op" id="5521946">(</span><span class="ident" id="5521947">p</span>&nbsp;<span class="op" id="5521949">*</span><span class="ident" id="5521950">RGBA</span><span class="op" id="5521954">)</span>&nbsp;<span class="ident" id="5521956">Set</span><span class="op" id="5521959">(</span><span class="ident" id="5521960">x</span><span class="op" id="5521961">,</span>&nbsp;<span class="ident" id="5521963">y</span>&nbsp;<span class="builtintype" id="5521965">int</span><span class="op" id="5521968">,</span>&nbsp;<span class="ident" id="5521970">c</span>&nbsp;<span class="ident" id="5521972">color</span><span class="op" id="5521977">.</span><span class="ident" id="5521978">Color</span><span class="op" id="5521983">)</span>&nbsp;<span class="op" id="5521985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521988">if</span>&nbsp;<span class="op" id="5521991">!</span><span class="op" id="5521992">(</span><span class="ident" id="5521993">Point</span><span class="op" id="5521998">{</span><span class="ident" id="5521999">x</span><span class="op" id="5522000">,</span>&nbsp;<span class="ident" id="5522002">y</span><span class="op" id="5522003">}</span><span class="op" id="5522004">.</span><span class="ident" id="5522005">In</span><span class="op" id="5522007">(</span><span class="ident" id="5522008">p</span><span class="op" id="5522009">.</span><span class="ident" id="5522010">Rect</span><span class="op" id="5522014">)</span><span class="op" id="5522015">)</span>&nbsp;<span class="op" id="5522017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522021">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522032">i</span>&nbsp;<span class="op" id="5522034">:=</span>&nbsp;<span class="ident" id="5522037">p</span><span class="op" id="5522038">.</span><span class="ident" id="5522039">PixOffset</span><span class="op" id="5522048">(</span><span class="ident" id="5522049">x</span><span class="op" id="5522050">,</span>&nbsp;<span class="ident" id="5522052">y</span><span class="op" id="5522053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522056">c1</span>&nbsp;<span class="op" id="5522059">:=</span>&nbsp;<span class="ident" id="5522062">color</span><span class="op" id="5522067">.</span><span class="ident" id="5522068">RGBAModel</span><span class="op" id="5522077">.</span><span class="ident" id="5522078">Convert</span><span class="op" id="5522085">(</span><span class="ident" id="5522086">c</span><span class="op" id="5522087">)</span><span class="op" id="5522088">.</span><span class="op" id="5522089">(</span><span class="ident" id="5522090">color</span><span class="op" id="5522095">.</span><span class="ident" id="5522096">RGBA</span><span class="op" id="5522100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522103">p</span><span class="op" id="5522104">.</span><span class="ident" id="5522105">Pix</span><span class="op" id="5522108">[</span><span class="ident" id="5522109">i</span><span class="op" id="5522110">+</span><span class="num" id="5522111">0</span><span class="op" id="5522112">]</span>&nbsp;<span class="op" id="5522114">=</span>&nbsp;<span class="ident" id="5522116">c1</span><span class="op" id="5522118">.</span><span class="ident" id="5522119">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522122">p</span><span class="op" id="5522123">.</span><span class="ident" id="5522124">Pix</span><span class="op" id="5522127">[</span><span class="ident" id="5522128">i</span><span class="op" id="5522129">+</span><span class="num" id="5522130">1</span><span class="op" id="5522131">]</span>&nbsp;<span class="op" id="5522133">=</span>&nbsp;<span class="ident" id="5522135">c1</span><span class="op" id="5522137">.</span><span class="ident" id="5522138">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522141">p</span><span class="op" id="5522142">.</span><span class="ident" id="5522143">Pix</span><span class="op" id="5522146">[</span><span class="ident" id="5522147">i</span><span class="op" id="5522148">+</span><span class="num" id="5522149">2</span><span class="op" id="5522150">]</span>&nbsp;<span class="op" id="5522152">=</span>&nbsp;<span class="ident" id="5522154">c1</span><span class="op" id="5522156">.</span><span class="ident" id="5522157">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522160">p</span><span class="op" id="5522161">.</span><span class="ident" id="5522162">Pix</span><span class="op" id="5522165">[</span><span class="ident" id="5522166">i</span><span class="op" id="5522167">+</span><span class="num" id="5522168">3</span><span class="op" id="5522169">]</span>&nbsp;<span class="op" id="5522171">=</span>&nbsp;<span class="ident" id="5522173">c1</span><span class="op" id="5522175">.</span><span class="ident" id="5522176">A</span><br>
<span class="lineno"></span><span class="op" id="5522178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522181">func</span>&nbsp;<span class="op" id="5522186">(</span><span class="ident" id="5522187">p</span>&nbsp;<span class="op" id="5522189">*</span><span class="ident" id="5522190">RGBA</span><span class="op" id="5522194">)</span>&nbsp;<span class="ident" id="5522196">SetRGBA</span><span class="op" id="5522203">(</span><span class="ident" id="5522204">x</span><span class="op" id="5522205">,</span>&nbsp;<span class="ident" id="5522207">y</span>&nbsp;<span class="builtintype" id="5522209">int</span><span class="op" id="5522212">,</span>&nbsp;<span class="ident" id="5522214">c</span>&nbsp;<span class="ident" id="5522216">color</span><span class="op" id="5522221">.</span><span class="ident" id="5522222">RGBA</span><span class="op" id="5522226">)</span>&nbsp;<span class="op" id="5522228">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522231">if</span>&nbsp;<span class="op" id="5522234">!</span><span class="op" id="5522235">(</span><span class="ident" id="5522236">Point</span><span class="op" id="5522241">{</span><span class="ident" id="5522242">x</span><span class="op" id="5522243">,</span>&nbsp;<span class="ident" id="5522245">y</span><span class="op" id="5522246">}</span><span class="op" id="5522247">.</span><span class="ident" id="5522248">In</span><span class="op" id="5522250">(</span><span class="ident" id="5522251">p</span><span class="op" id="5522252">.</span><span class="ident" id="5522253">Rect</span><span class="op" id="5522257">)</span><span class="op" id="5522258">)</span>&nbsp;<span class="op" id="5522260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522275">i</span>&nbsp;<span class="op" id="5522277">:=</span>&nbsp;<span class="ident" id="5522280">p</span><span class="op" id="5522281">.</span><span class="ident" id="5522282">PixOffset</span><span class="op" id="5522291">(</span><span class="ident" id="5522292">x</span><span class="op" id="5522293">,</span>&nbsp;<span class="ident" id="5522295">y</span><span class="op" id="5522296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522299">p</span><span class="op" id="5522300">.</span><span class="ident" id="5522301">Pix</span><span class="op" id="5522304">[</span><span class="ident" id="5522305">i</span><span class="op" id="5522306">+</span><span class="num" id="5522307">0</span><span class="op" id="5522308">]</span>&nbsp;<span class="op" id="5522310">=</span>&nbsp;<span class="ident" id="5522312">c</span><span class="op" id="5522313">.</span><span class="ident" id="5522314">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522317">p</span><span class="op" id="5522318">.</span><span class="ident" id="5522319">Pix</span><span class="op" id="5522322">[</span><span class="ident" id="5522323">i</span><span class="op" id="5522324">+</span><span class="num" id="5522325">1</span><span class="op" id="5522326">]</span>&nbsp;<span class="op" id="5522328">=</span>&nbsp;<span class="ident" id="5522330">c</span><span class="op" id="5522331">.</span><span class="ident" id="5522332">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522335">p</span><span class="op" id="5522336">.</span><span class="ident" id="5522337">Pix</span><span class="op" id="5522340">[</span><span class="ident" id="5522341">i</span><span class="op" id="5522342">+</span><span class="num" id="5522343">2</span><span class="op" id="5522344">]</span>&nbsp;<span class="op" id="5522346">=</span>&nbsp;<span class="ident" id="5522348">c</span><span class="op" id="5522349">.</span><span class="ident" id="5522350">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522353">p</span><span class="op" id="5522354">.</span><span class="ident" id="5522355">Pix</span><span class="op" id="5522358">[</span><span class="ident" id="5522359">i</span><span class="op" id="5522360">+</span><span class="num" id="5522361">3</span><span class="op" id="5522362">]</span>&nbsp;<span class="op" id="5522364">=</span>&nbsp;<span class="ident" id="5522366">c</span><span class="op" id="5522367">.</span><span class="ident" id="5522368">A</span><br>
<span class="lineno"></span><span class="op" id="5522370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5522373">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5522450">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5522522">func</span>&nbsp;<span class="op" id="5522527">(</span><span class="ident" id="5522528">p</span>&nbsp;<span class="op" id="5522530">*</span><span class="ident" id="5522531">RGBA</span><span class="op" id="5522535">)</span>&nbsp;<span class="ident" id="5522537">SubImage</span><span class="op" id="5522545">(</span><span class="ident" id="5522546">r</span>&nbsp;<span class="ident" id="5522548">Rectangle</span><span class="op" id="5522557">)</span>&nbsp;<span class="ident" id="5522559">Image</span>&nbsp;<span class="op" id="5522565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522568">r</span>&nbsp;<span class="op" id="5522570">=</span>&nbsp;<span class="ident" id="5522572">r</span><span class="op" id="5522573">.</span><span class="ident" id="5522574">Intersect</span><span class="op" id="5522583">(</span><span class="ident" id="5522584">p</span><span class="op" id="5522585">.</span><span class="ident" id="5522586">Rect</span><span class="op" id="5522590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522593">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522674">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522756">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522806">if</span>&nbsp;<span class="ident" id="5522809">r</span><span class="op" id="5522810">.</span><span class="ident" id="5522811">Empty</span><span class="op" id="5522816">(</span><span class="op" id="5522817">)</span>&nbsp;<span class="op" id="5522819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522823">return</span>&nbsp;<span class="op" id="5522830">&amp;</span><span class="ident" id="5522831">RGBA</span><span class="op" id="5522835">{</span><span class="op" id="5522836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522839">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522842">i</span>&nbsp;<span class="op" id="5522844">:=</span>&nbsp;<span class="ident" id="5522847">p</span><span class="op" id="5522848">.</span><span class="ident" id="5522849">PixOffset</span><span class="op" id="5522858">(</span><span class="ident" id="5522859">r</span><span class="op" id="5522860">.</span><span class="ident" id="5522861">Min</span><span class="op" id="5522864">.</span><span class="ident" id="5522865">X</span><span class="op" id="5522866">,</span>&nbsp;<span class="ident" id="5522868">r</span><span class="op" id="5522869">.</span><span class="ident" id="5522870">Min</span><span class="op" id="5522873">.</span><span class="ident" id="5522874">Y</span><span class="op" id="5522875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522878">return</span>&nbsp;<span class="op" id="5522885">&amp;</span><span class="ident" id="5522886">RGBA</span><span class="op" id="5522890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522894">Pix</span><span class="op" id="5522897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522902">p</span><span class="op" id="5522903">.</span><span class="ident" id="5522904">Pix</span><span class="op" id="5522907">[</span><span class="ident" id="5522908">i</span><span class="op" id="5522909">:</span><span class="op" id="5522910">]</span><span class="op" id="5522911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522915">Stride</span><span class="op" id="5522921">:</span>&nbsp;<span class="ident" id="5522923">p</span><span class="op" id="5522924">.</span><span class="ident" id="5522925">Stride</span><span class="op" id="5522931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522935">Rect</span><span class="op" id="5522939">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5522943">r</span><span class="op" id="5522944">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522947">}</span><br>
<span class="lineno"></span><span class="op" id="5522949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522952">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5523025">func</span>&nbsp;<span class="op" id="5523030">(</span><span class="ident" id="5523031">p</span>&nbsp;<span class="op" id="5523033">*</span><span class="ident" id="5523034">RGBA</span><span class="op" id="5523038">)</span>&nbsp;<span class="ident" id="5523040">Opaque</span><span class="op" id="5523046">(</span><span class="op" id="5523047">)</span>&nbsp;<span class="builtintype" id="5523049">bool</span>&nbsp;<span class="op" id="5523054">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523057">if</span>&nbsp;<span class="ident" id="5523060">p</span><span class="op" id="5523061">.</span><span class="ident" id="5523062">Rect</span><span class="op" id="5523066">.</span><span class="ident" id="5523067">Empty</span><span class="op" id="5523072">(</span><span class="op" id="5523073">)</span>&nbsp;<span class="op" id="5523075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523079">return</span>&nbsp;<span class="ident" id="5523086">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523095">i0</span><span class="op" id="5523097">,</span>&nbsp;<span class="ident" id="5523099">i1</span>&nbsp;<span class="op" id="5523102">:=</span>&nbsp;<span class="num" id="5523105">3</span><span class="op" id="5523106">,</span>&nbsp;<span class="ident" id="5523108">p</span><span class="op" id="5523109">.</span><span class="ident" id="5523110">Rect</span><span class="op" id="5523114">.</span><span class="ident" id="5523115">Dx</span><span class="op" id="5523117">(</span><span class="op" id="5523118">)</span><span class="op" id="5523119">*</span><span class="num" id="5523120">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523123">for</span>&nbsp;<span class="ident" id="5523127">y</span>&nbsp;<span class="op" id="5523129">:=</span>&nbsp;<span class="ident" id="5523132">p</span><span class="op" id="5523133">.</span><span class="ident" id="5523134">Rect</span><span class="op" id="5523138">.</span><span class="ident" id="5523139">Min</span><span class="op" id="5523142">.</span><span class="ident" id="5523143">Y</span><span class="op" id="5523144">;</span>&nbsp;<span class="ident" id="5523146">y</span>&nbsp;<span class="op" id="5523148">&lt;</span>&nbsp;<span class="ident" id="5523150">p</span><span class="op" id="5523151">.</span><span class="ident" id="5523152">Rect</span><span class="op" id="5523156">.</span><span class="ident" id="5523157">Max</span><span class="op" id="5523160">.</span><span class="ident" id="5523161">Y</span><span class="op" id="5523162">;</span>&nbsp;<span class="ident" id="5523164">y</span><span class="op" id="5523165">++</span>&nbsp;<span class="op" id="5523168">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523172">for</span>&nbsp;<span class="ident" id="5523176">i</span>&nbsp;<span class="op" id="5523178">:=</span>&nbsp;<span class="ident" id="5523181">i0</span><span class="op" id="5523183">;</span>&nbsp;<span class="ident" id="5523185">i</span>&nbsp;<span class="op" id="5523187">&lt;</span>&nbsp;<span class="ident" id="5523189">i1</span><span class="op" id="5523191">;</span>&nbsp;<span class="ident" id="5523193">i</span>&nbsp;<span class="op" id="5523195">+=</span>&nbsp;<span class="num" id="5523198">4</span>&nbsp;<span class="op" id="5523200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523205">if</span>&nbsp;<span class="ident" id="5523208">p</span><span class="op" id="5523209">.</span><span class="ident" id="5523210">Pix</span><span class="op" id="5523213">[</span><span class="ident" id="5523214">i</span><span class="op" id="5523215">]</span>&nbsp;<span class="op" id="5523217">!=</span>&nbsp;<span class="num" id="5523220">0xff</span>&nbsp;<span class="op" id="5523225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523231">return</span>&nbsp;<span class="ident" id="5523238">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523251">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523255">i0</span>&nbsp;<span class="op" id="5523258">+=</span>&nbsp;<span class="ident" id="5523261">p</span><span class="op" id="5523262">.</span><span class="ident" id="5523263">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523272">i1</span>&nbsp;<span class="op" id="5523275">+=</span>&nbsp;<span class="ident" id="5523278">p</span><span class="op" id="5523279">.</span><span class="ident" id="5523280">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523291">return</span>&nbsp;<span class="ident" id="5523298">true</span><br>
<span class="lineno"></span><span class="op" id="5523303">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5523306">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5523359">func</span>&nbsp;<span class="ident" id="5523364">NewRGBA</span><span class="op" id="5523371">(</span><span class="ident" id="5523372">r</span>&nbsp;<span class="ident" id="5523374">Rectangle</span><span class="op" id="5523383">)</span>&nbsp;<span class="op" id="5523385">*</span><span class="ident" id="5523386">RGBA</span>&nbsp;<span class="op" id="5523391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523394">w</span><span class="op" id="5523395">,</span>&nbsp;<span class="ident" id="5523397">h</span>&nbsp;<span class="op" id="5523399">:=</span>&nbsp;<span class="ident" id="5523402">r</span><span class="op" id="5523403">.</span><span class="ident" id="5523404">Dx</span><span class="op" id="5523406">(</span><span class="op" id="5523407">)</span><span class="op" id="5523408">,</span>&nbsp;<span class="ident" id="5523410">r</span><span class="op" id="5523411">.</span><span class="ident" id="5523412">Dy</span><span class="op" id="5523414">(</span><span class="op" id="5523415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523418">buf</span>&nbsp;<span class="op" id="5523422">:=</span>&nbsp;<span class="builtinfunc" id="5523425">make</span><span class="op" id="5523429">(</span><span class="op" id="5523430">[</span><span class="op" id="5523431">]</span><span class="builtintype" id="5523432">uint8</span><span class="op" id="5523437">,</span>&nbsp;<span class="num" id="5523439">4</span><span class="op" id="5523440">*</span><span class="ident" id="5523441">w</span><span class="op" id="5523442">*</span><span class="ident" id="5523443">h</span><span class="op" id="5523444">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523447">return</span>&nbsp;<span class="op" id="5523454">&amp;</span><span class="ident" id="5523455">RGBA</span><span class="op" id="5523459">{</span><span class="ident" id="5523460">buf</span><span class="op" id="5523463">,</span>&nbsp;<span class="num" id="5523465">4</span>&nbsp;<span class="op" id="5523467">*</span>&nbsp;<span class="ident" id="5523469">w</span><span class="op" id="5523470">,</span>&nbsp;<span class="ident" id="5523472">r</span><span class="op" id="5523473">}</span><br>
<span class="lineno"></span><span class="op" id="5523475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5523478">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5523555">type</span>&nbsp;<span class="ident" id="5523560">RGBA64</span>&nbsp;<span class="keyword" id="5523567">struct</span>&nbsp;<span class="op" id="5523574">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523577">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523667">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523735">Pix</span>&nbsp;<span class="op" id="5523739">[</span><span class="op" id="5523740">]</span><span class="builtintype" id="5523741">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523748">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523824">Stride</span>&nbsp;<span class="builtintype" id="5523831">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523836">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523868">Rect</span>&nbsp;<span class="ident" id="5523873">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5523883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523886">func</span>&nbsp;<span class="op" id="5523891">(</span><span class="ident" id="5523892">p</span>&nbsp;<span class="op" id="5523894">*</span><span class="ident" id="5523895">RGBA64</span><span class="op" id="5523901">)</span>&nbsp;<span class="ident" id="5523903">ColorModel</span><span class="op" id="5523913">(</span><span class="op" id="5523914">)</span>&nbsp;<span class="ident" id="5523916">color</span><span class="op" id="5523921">.</span><span class="ident" id="5523922">Model</span>&nbsp;<span class="op" id="5523928">{</span>&nbsp;<span class="keyword" id="5523930">return</span>&nbsp;<span class="ident" id="5523937">color</span><span class="op" id="5523942">.</span><span class="ident" id="5523943">RGBA64Model</span>&nbsp;<span class="op" id="5523955">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5523958">func</span>&nbsp;<span class="op" id="5523963">(</span><span class="ident" id="5523964">p</span>&nbsp;<span class="op" id="5523966">*</span><span class="ident" id="5523967">RGBA64</span><span class="op" id="5523973">)</span>&nbsp;<span class="ident" id="5523975">Bounds</span><span class="op" id="5523981">(</span><span class="op" id="5523982">)</span>&nbsp;<span class="ident" id="5523984">Rectangle</span>&nbsp;<span class="op" id="5523994">{</span>&nbsp;<span class="keyword" id="5523996">return</span>&nbsp;<span class="ident" id="5524003">p</span><span class="op" id="5524004">.</span><span class="ident" id="5524005">Rect</span>&nbsp;<span class="op" id="5524010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5524013">func</span>&nbsp;<span class="op" id="5524018">(</span><span class="ident" id="5524019">p</span>&nbsp;<span class="op" id="5524021">*</span><span class="ident" id="5524022">RGBA64</span><span class="op" id="5524028">)</span>&nbsp;<span class="ident" id="5524030">At</span><span class="op" id="5524032">(</span><span class="ident" id="5524033">x</span><span class="op" id="5524034">,</span>&nbsp;<span class="ident" id="5524036">y</span>&nbsp;<span class="builtintype" id="5524038">int</span><span class="op" id="5524041">)</span>&nbsp;<span class="ident" id="5524043">color</span><span class="op" id="5524048">.</span><span class="ident" id="5524049">Color</span>&nbsp;<span class="op" id="5524055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524058">return</span>&nbsp;<span class="ident" id="5524065">p</span><span class="op" id="5524066">.</span><span class="ident" id="5524067">RGBA64At</span><span class="op" id="5524075">(</span><span class="ident" id="5524076">x</span><span class="op" id="5524077">,</span>&nbsp;<span class="ident" id="5524079">y</span><span class="op" id="5524080">)</span><br>
<span class="lineno">175</span><span class="op" id="5524082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5524085">func</span>&nbsp;<span class="op" id="5524090">(</span><span class="ident" id="5524091">p</span>&nbsp;<span class="op" id="5524093">*</span><span class="ident" id="5524094">RGBA64</span><span class="op" id="5524100">)</span>&nbsp;<span class="ident" id="5524102">RGBA64At</span><span class="op" id="5524110">(</span><span class="ident" id="5524111">x</span><span class="op" id="5524112">,</span>&nbsp;<span class="ident" id="5524114">y</span>&nbsp;<span class="builtintype" id="5524116">int</span><span class="op" id="5524119">)</span>&nbsp;<span class="ident" id="5524121">color</span><span class="op" id="5524126">.</span><span class="ident" id="5524127">RGBA64</span>&nbsp;<span class="op" id="5524134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524137">if</span>&nbsp;<span class="op" id="5524140">!</span><span class="op" id="5524141">(</span><span class="ident" id="5524142">Point</span><span class="op" id="5524147">{</span><span class="ident" id="5524148">x</span><span class="op" id="5524149">,</span>&nbsp;<span class="ident" id="5524151">y</span><span class="op" id="5524152">}</span><span class="op" id="5524153">.</span><span class="ident" id="5524154">In</span><span class="op" id="5524156">(</span><span class="ident" id="5524157">p</span><span class="op" id="5524158">.</span><span class="ident" id="5524159">Rect</span><span class="op" id="5524163">)</span><span class="op" id="5524164">)</span>&nbsp;<span class="op" id="5524166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524170">return</span>&nbsp;<span class="ident" id="5524177">color</span><span class="op" id="5524182">.</span><span class="ident" id="5524183">RGBA64</span><span class="op" id="5524189">{</span><span class="op" id="5524190">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524196">i</span>&nbsp;<span class="op" id="5524198">:=</span>&nbsp;<span class="ident" id="5524201">p</span><span class="op" id="5524202">.</span><span class="ident" id="5524203">PixOffset</span><span class="op" id="5524212">(</span><span class="ident" id="5524213">x</span><span class="op" id="5524214">,</span>&nbsp;<span class="ident" id="5524216">y</span><span class="op" id="5524217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524220">return</span>&nbsp;<span class="ident" id="5524227">color</span><span class="op" id="5524232">.</span><span class="ident" id="5524233">RGBA64</span><span class="op" id="5524239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5524243">uint16</span><span class="op" id="5524249">(</span><span class="ident" id="5524250">p</span><span class="op" id="5524251">.</span><span class="ident" id="5524252">Pix</span><span class="op" id="5524255">[</span><span class="ident" id="5524256">i</span><span class="op" id="5524257">+</span><span class="num" id="5524258">0</span><span class="op" id="5524259">]</span><span class="op" id="5524260">)</span><span class="op" id="5524261">&lt;&lt;</span><span class="num" id="5524263">8</span>&nbsp;<span class="op" id="5524265">|</span>&nbsp;<span class="builtintype" id="5524267">uint16</span><span class="op" id="5524273">(</span><span class="ident" id="5524274">p</span><span class="op" id="5524275">.</span><span class="ident" id="5524276">Pix</span><span class="op" id="5524279">[</span><span class="ident" id="5524280">i</span><span class="op" id="5524281">+</span><span class="num" id="5524282">1</span><span class="op" id="5524283">]</span><span class="op" id="5524284">)</span><span class="op" id="5524285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5524289">uint16</span><span class="op" id="5524295">(</span><span class="ident" id="5524296">p</span><span class="op" id="5524297">.</span><span class="ident" id="5524298">Pix</span><span class="op" id="5524301">[</span><span class="ident" id="5524302">i</span><span class="op" id="5524303">+</span><span class="num" id="5524304">2</span><span class="op" id="5524305">]</span><span class="op" id="5524306">)</span><span class="op" id="5524307">&lt;&lt;</span><span class="num" id="5524309">8</span>&nbsp;<span class="op" id="5524311">|</span>&nbsp;<span class="builtintype" id="5524313">uint16</span><span class="op" id="5524319">(</span><span class="ident" id="5524320">p</span><span class="op" id="5524321">.</span><span class="ident" id="5524322">Pix</span><span class="op" id="5524325">[</span><span class="ident" id="5524326">i</span><span class="op" id="5524327">+</span><span class="num" id="5524328">3</span><span class="op" id="5524329">]</span><span class="op" id="5524330">)</span><span class="op" id="5524331">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5524335">uint16</span><span class="op" id="5524341">(</span><span class="ident" id="5524342">p</span><span class="op" id="5524343">.</span><span class="ident" id="5524344">Pix</span><span class="op" id="5524347">[</span><span class="ident" id="5524348">i</span><span class="op" id="5524349">+</span><span class="num" id="5524350">4</span><span class="op" id="5524351">]</span><span class="op" id="5524352">)</span><span class="op" id="5524353">&lt;&lt;</span><span class="num" id="5524355">8</span>&nbsp;<span class="op" id="5524357">|</span>&nbsp;<span class="builtintype" id="5524359">uint16</span><span class="op" id="5524365">(</span><span class="ident" id="5524366">p</span><span class="op" id="5524367">.</span><span class="ident" id="5524368">Pix</span><span class="op" id="5524371">[</span><span class="ident" id="5524372">i</span><span class="op" id="5524373">+</span><span class="num" id="5524374">5</span><span class="op" id="5524375">]</span><span class="op" id="5524376">)</span><span class="op" id="5524377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5524381">uint16</span><span class="op" id="5524387">(</span><span class="ident" id="5524388">p</span><span class="op" id="5524389">.</span><span class="ident" id="5524390">Pix</span><span class="op" id="5524393">[</span><span class="ident" id="5524394">i</span><span class="op" id="5524395">+</span><span class="num" id="5524396">6</span><span class="op" id="5524397">]</span><span class="op" id="5524398">)</span><span class="op" id="5524399">&lt;&lt;</span><span class="num" id="5524401">8</span>&nbsp;<span class="op" id="5524403">|</span>&nbsp;<span class="builtintype" id="5524405">uint16</span><span class="op" id="5524411">(</span><span class="ident" id="5524412">p</span><span class="op" id="5524413">.</span><span class="ident" id="5524414">Pix</span><span class="op" id="5524417">[</span><span class="ident" id="5524418">i</span><span class="op" id="5524419">+</span><span class="num" id="5524420">7</span><span class="op" id="5524421">]</span><span class="op" id="5524422">)</span><span class="op" id="5524423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524426">}</span><br>
<span class="lineno"></span><span class="op" id="5524428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5524431">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5524510">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5524534">func</span>&nbsp;<span class="op" id="5524539">(</span><span class="ident" id="5524540">p</span>&nbsp;<span class="op" id="5524542">*</span><span class="ident" id="5524543">RGBA64</span><span class="op" id="5524549">)</span>&nbsp;<span class="ident" id="5524551">PixOffset</span><span class="op" id="5524560">(</span><span class="ident" id="5524561">x</span><span class="op" id="5524562">,</span>&nbsp;<span class="ident" id="5524564">y</span>&nbsp;<span class="builtintype" id="5524566">int</span><span class="op" id="5524569">)</span>&nbsp;<span class="builtintype" id="5524571">int</span>&nbsp;<span class="op" id="5524575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524578">return</span>&nbsp;<span class="op" id="5524585">(</span><span class="ident" id="5524586">y</span><span class="op" id="5524587">-</span><span class="ident" id="5524588">p</span><span class="op" id="5524589">.</span><span class="ident" id="5524590">Rect</span><span class="op" id="5524594">.</span><span class="ident" id="5524595">Min</span><span class="op" id="5524598">.</span><span class="ident" id="5524599">Y</span><span class="op" id="5524600">)</span><span class="op" id="5524601">*</span><span class="ident" id="5524602">p</span><span class="op" id="5524603">.</span><span class="ident" id="5524604">Stride</span>&nbsp;<span class="op" id="5524611">+</span>&nbsp;<span class="op" id="5524613">(</span><span class="ident" id="5524614">x</span><span class="op" id="5524615">-</span><span class="ident" id="5524616">p</span><span class="op" id="5524617">.</span><span class="ident" id="5524618">Rect</span><span class="op" id="5524622">.</span><span class="ident" id="5524623">Min</span><span class="op" id="5524626">.</span><span class="ident" id="5524627">X</span><span class="op" id="5524628">)</span><span class="op" id="5524629">*</span><span class="num" id="5524630">8</span><br>
<span class="lineno"></span><span class="op" id="5524632">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5524635">func</span>&nbsp;<span class="op" id="5524640">(</span><span class="ident" id="5524641">p</span>&nbsp;<span class="op" id="5524643">*</span><span class="ident" id="5524644">RGBA64</span><span class="op" id="5524650">)</span>&nbsp;<span class="ident" id="5524652">Set</span><span class="op" id="5524655">(</span><span class="ident" id="5524656">x</span><span class="op" id="5524657">,</span>&nbsp;<span class="ident" id="5524659">y</span>&nbsp;<span class="builtintype" id="5524661">int</span><span class="op" id="5524664">,</span>&nbsp;<span class="ident" id="5524666">c</span>&nbsp;<span class="ident" id="5524668">color</span><span class="op" id="5524673">.</span><span class="ident" id="5524674">Color</span><span class="op" id="5524679">)</span>&nbsp;<span class="op" id="5524681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524684">if</span>&nbsp;<span class="op" id="5524687">!</span><span class="op" id="5524688">(</span><span class="ident" id="5524689">Point</span><span class="op" id="5524694">{</span><span class="ident" id="5524695">x</span><span class="op" id="5524696">,</span>&nbsp;<span class="ident" id="5524698">y</span><span class="op" id="5524699">}</span><span class="op" id="5524700">.</span><span class="ident" id="5524701">In</span><span class="op" id="5524703">(</span><span class="ident" id="5524704">p</span><span class="op" id="5524705">.</span><span class="ident" id="5524706">Rect</span><span class="op" id="5524710">)</span><span class="op" id="5524711">)</span>&nbsp;<span class="op" id="5524713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524717">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524725">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524728">i</span>&nbsp;<span class="op" id="5524730">:=</span>&nbsp;<span class="ident" id="5524733">p</span><span class="op" id="5524734">.</span><span class="ident" id="5524735">PixOffset</span><span class="op" id="5524744">(</span><span class="ident" id="5524745">x</span><span class="op" id="5524746">,</span>&nbsp;<span class="ident" id="5524748">y</span><span class="op" id="5524749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524752">c1</span>&nbsp;<span class="op" id="5524755">:=</span>&nbsp;<span class="ident" id="5524758">color</span><span class="op" id="5524763">.</span><span class="ident" id="5524764">RGBA64Model</span><span class="op" id="5524775">.</span><span class="ident" id="5524776">Convert</span><span class="op" id="5524783">(</span><span class="ident" id="5524784">c</span><span class="op" id="5524785">)</span><span class="op" id="5524786">.</span><span class="op" id="5524787">(</span><span class="ident" id="5524788">color</span><span class="op" id="5524793">.</span><span class="ident" id="5524794">RGBA64</span><span class="op" id="5524800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524803">p</span><span class="op" id="5524804">.</span><span class="ident" id="5524805">Pix</span><span class="op" id="5524808">[</span><span class="ident" id="5524809">i</span><span class="op" id="5524810">+</span><span class="num" id="5524811">0</span><span class="op" id="5524812">]</span>&nbsp;<span class="op" id="5524814">=</span>&nbsp;<span class="builtintype" id="5524816">uint8</span><span class="op" id="5524821">(</span><span class="ident" id="5524822">c1</span><span class="op" id="5524824">.</span><span class="ident" id="5524825">R</span>&nbsp;<span class="op" id="5524827">&gt;&gt;</span>&nbsp;<span class="num" id="5524830">8</span><span class="op" id="5524831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524834">p</span><span class="op" id="5524835">.</span><span class="ident" id="5524836">Pix</span><span class="op" id="5524839">[</span><span class="ident" id="5524840">i</span><span class="op" id="5524841">+</span><span class="num" id="5524842">1</span><span class="op" id="5524843">]</span>&nbsp;<span class="op" id="5524845">=</span>&nbsp;<span class="builtintype" id="5524847">uint8</span><span class="op" id="5524852">(</span><span class="ident" id="5524853">c1</span><span class="op" id="5524855">.</span><span class="ident" id="5524856">R</span><span class="op" id="5524857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524860">p</span><span class="op" id="5524861">.</span><span class="ident" id="5524862">Pix</span><span class="op" id="5524865">[</span><span class="ident" id="5524866">i</span><span class="op" id="5524867">+</span><span class="num" id="5524868">2</span><span class="op" id="5524869">]</span>&nbsp;<span class="op" id="5524871">=</span>&nbsp;<span class="builtintype" id="5524873">uint8</span><span class="op" id="5524878">(</span><span class="ident" id="5524879">c1</span><span class="op" id="5524881">.</span><span class="ident" id="5524882">G</span>&nbsp;<span class="op" id="5524884">&gt;&gt;</span>&nbsp;<span class="num" id="5524887">8</span><span class="op" id="5524888">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524891">p</span><span class="op" id="5524892">.</span><span class="ident" id="5524893">Pix</span><span class="op" id="5524896">[</span><span class="ident" id="5524897">i</span><span class="op" id="5524898">+</span><span class="num" id="5524899">3</span><span class="op" id="5524900">]</span>&nbsp;<span class="op" id="5524902">=</span>&nbsp;<span class="builtintype" id="5524904">uint8</span><span class="op" id="5524909">(</span><span class="ident" id="5524910">c1</span><span class="op" id="5524912">.</span><span class="ident" id="5524913">G</span><span class="op" id="5524914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524917">p</span><span class="op" id="5524918">.</span><span class="ident" id="5524919">Pix</span><span class="op" id="5524922">[</span><span class="ident" id="5524923">i</span><span class="op" id="5524924">+</span><span class="num" id="5524925">4</span><span class="op" id="5524926">]</span>&nbsp;<span class="op" id="5524928">=</span>&nbsp;<span class="builtintype" id="5524930">uint8</span><span class="op" id="5524935">(</span><span class="ident" id="5524936">c1</span><span class="op" id="5524938">.</span><span class="ident" id="5524939">B</span>&nbsp;<span class="op" id="5524941">&gt;&gt;</span>&nbsp;<span class="num" id="5524944">8</span><span class="op" id="5524945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524948">p</span><span class="op" id="5524949">.</span><span class="ident" id="5524950">Pix</span><span class="op" id="5524953">[</span><span class="ident" id="5524954">i</span><span class="op" id="5524955">+</span><span class="num" id="5524956">5</span><span class="op" id="5524957">]</span>&nbsp;<span class="op" id="5524959">=</span>&nbsp;<span class="builtintype" id="5524961">uint8</span><span class="op" id="5524966">(</span><span class="ident" id="5524967">c1</span><span class="op" id="5524969">.</span><span class="ident" id="5524970">B</span><span class="op" id="5524971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524974">p</span><span class="op" id="5524975">.</span><span class="ident" id="5524976">Pix</span><span class="op" id="5524979">[</span><span class="ident" id="5524980">i</span><span class="op" id="5524981">+</span><span class="num" id="5524982">6</span><span class="op" id="5524983">]</span>&nbsp;<span class="op" id="5524985">=</span>&nbsp;<span class="builtintype" id="5524987">uint8</span><span class="op" id="5524992">(</span><span class="ident" id="5524993">c1</span><span class="op" id="5524995">.</span><span class="ident" id="5524996">A</span>&nbsp;<span class="op" id="5524998">&gt;&gt;</span>&nbsp;<span class="num" id="5525001">8</span><span class="op" id="5525002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525005">p</span><span class="op" id="5525006">.</span><span class="ident" id="5525007">Pix</span><span class="op" id="5525010">[</span><span class="ident" id="5525011">i</span><span class="op" id="5525012">+</span><span class="num" id="5525013">7</span><span class="op" id="5525014">]</span>&nbsp;<span class="op" id="5525016">=</span>&nbsp;<span class="builtintype" id="5525018">uint8</span><span class="op" id="5525023">(</span><span class="ident" id="5525024">c1</span><span class="op" id="5525026">.</span><span class="ident" id="5525027">A</span><span class="op" id="5525028">)</span><br>
<span class="lineno">210</span><span class="op" id="5525030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5525033">func</span>&nbsp;<span class="op" id="5525038">(</span><span class="ident" id="5525039">p</span>&nbsp;<span class="op" id="5525041">*</span><span class="ident" id="5525042">RGBA64</span><span class="op" id="5525048">)</span>&nbsp;<span class="ident" id="5525050">SetRGBA64</span><span class="op" id="5525059">(</span><span class="ident" id="5525060">x</span><span class="op" id="5525061">,</span>&nbsp;<span class="ident" id="5525063">y</span>&nbsp;<span class="builtintype" id="5525065">int</span><span class="op" id="5525068">,</span>&nbsp;<span class="ident" id="5525070">c</span>&nbsp;<span class="ident" id="5525072">color</span><span class="op" id="5525077">.</span><span class="ident" id="5525078">RGBA64</span><span class="op" id="5525084">)</span>&nbsp;<span class="op" id="5525086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525089">if</span>&nbsp;<span class="op" id="5525092">!</span><span class="op" id="5525093">(</span><span class="ident" id="5525094">Point</span><span class="op" id="5525099">{</span><span class="ident" id="5525100">x</span><span class="op" id="5525101">,</span>&nbsp;<span class="ident" id="5525103">y</span><span class="op" id="5525104">}</span><span class="op" id="5525105">.</span><span class="ident" id="5525106">In</span><span class="op" id="5525108">(</span><span class="ident" id="5525109">p</span><span class="op" id="5525110">.</span><span class="ident" id="5525111">Rect</span><span class="op" id="5525115">)</span><span class="op" id="5525116">)</span>&nbsp;<span class="op" id="5525118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525122">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525133">i</span>&nbsp;<span class="op" id="5525135">:=</span>&nbsp;<span class="ident" id="5525138">p</span><span class="op" id="5525139">.</span><span class="ident" id="5525140">PixOffset</span><span class="op" id="5525149">(</span><span class="ident" id="5525150">x</span><span class="op" id="5525151">,</span>&nbsp;<span class="ident" id="5525153">y</span><span class="op" id="5525154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525157">p</span><span class="op" id="5525158">.</span><span class="ident" id="5525159">Pix</span><span class="op" id="5525162">[</span><span class="ident" id="5525163">i</span><span class="op" id="5525164">+</span><span class="num" id="5525165">0</span><span class="op" id="5525166">]</span>&nbsp;<span class="op" id="5525168">=</span>&nbsp;<span class="builtintype" id="5525170">uint8</span><span class="op" id="5525175">(</span><span class="ident" id="5525176">c</span><span class="op" id="5525177">.</span><span class="ident" id="5525178">R</span>&nbsp;<span class="op" id="5525180">&gt;&gt;</span>&nbsp;<span class="num" id="5525183">8</span><span class="op" id="5525184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525187">p</span><span class="op" id="5525188">.</span><span class="ident" id="5525189">Pix</span><span class="op" id="5525192">[</span><span class="ident" id="5525193">i</span><span class="op" id="5525194">+</span><span class="num" id="5525195">1</span><span class="op" id="5525196">]</span>&nbsp;<span class="op" id="5525198">=</span>&nbsp;<span class="builtintype" id="5525200">uint8</span><span class="op" id="5525205">(</span><span class="ident" id="5525206">c</span><span class="op" id="5525207">.</span><span class="ident" id="5525208">R</span><span class="op" id="5525209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525212">p</span><span class="op" id="5525213">.</span><span class="ident" id="5525214">Pix</span><span class="op" id="5525217">[</span><span class="ident" id="5525218">i</span><span class="op" id="5525219">+</span><span class="num" id="5525220">2</span><span class="op" id="5525221">]</span>&nbsp;<span class="op" id="5525223">=</span>&nbsp;<span class="builtintype" id="5525225">uint8</span><span class="op" id="5525230">(</span><span class="ident" id="5525231">c</span><span class="op" id="5525232">.</span><span class="ident" id="5525233">G</span>&nbsp;<span class="op" id="5525235">&gt;&gt;</span>&nbsp;<span class="num" id="5525238">8</span><span class="op" id="5525239">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525242">p</span><span class="op" id="5525243">.</span><span class="ident" id="5525244">Pix</span><span class="op" id="5525247">[</span><span class="ident" id="5525248">i</span><span class="op" id="5525249">+</span><span class="num" id="5525250">3</span><span class="op" id="5525251">]</span>&nbsp;<span class="op" id="5525253">=</span>&nbsp;<span class="builtintype" id="5525255">uint8</span><span class="op" id="5525260">(</span><span class="ident" id="5525261">c</span><span class="op" id="5525262">.</span><span class="ident" id="5525263">G</span><span class="op" id="5525264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525267">p</span><span class="op" id="5525268">.</span><span class="ident" id="5525269">Pix</span><span class="op" id="5525272">[</span><span class="ident" id="5525273">i</span><span class="op" id="5525274">+</span><span class="num" id="5525275">4</span><span class="op" id="5525276">]</span>&nbsp;<span class="op" id="5525278">=</span>&nbsp;<span class="builtintype" id="5525280">uint8</span><span class="op" id="5525285">(</span><span class="ident" id="5525286">c</span><span class="op" id="5525287">.</span><span class="ident" id="5525288">B</span>&nbsp;<span class="op" id="5525290">&gt;&gt;</span>&nbsp;<span class="num" id="5525293">8</span><span class="op" id="5525294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525297">p</span><span class="op" id="5525298">.</span><span class="ident" id="5525299">Pix</span><span class="op" id="5525302">[</span><span class="ident" id="5525303">i</span><span class="op" id="5525304">+</span><span class="num" id="5525305">5</span><span class="op" id="5525306">]</span>&nbsp;<span class="op" id="5525308">=</span>&nbsp;<span class="builtintype" id="5525310">uint8</span><span class="op" id="5525315">(</span><span class="ident" id="5525316">c</span><span class="op" id="5525317">.</span><span class="ident" id="5525318">B</span><span class="op" id="5525319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525322">p</span><span class="op" id="5525323">.</span><span class="ident" id="5525324">Pix</span><span class="op" id="5525327">[</span><span class="ident" id="5525328">i</span><span class="op" id="5525329">+</span><span class="num" id="5525330">6</span><span class="op" id="5525331">]</span>&nbsp;<span class="op" id="5525333">=</span>&nbsp;<span class="builtintype" id="5525335">uint8</span><span class="op" id="5525340">(</span><span class="ident" id="5525341">c</span><span class="op" id="5525342">.</span><span class="ident" id="5525343">A</span>&nbsp;<span class="op" id="5525345">&gt;&gt;</span>&nbsp;<span class="num" id="5525348">8</span><span class="op" id="5525349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525352">p</span><span class="op" id="5525353">.</span><span class="ident" id="5525354">Pix</span><span class="op" id="5525357">[</span><span class="ident" id="5525358">i</span><span class="op" id="5525359">+</span><span class="num" id="5525360">7</span><span class="op" id="5525361">]</span>&nbsp;<span class="op" id="5525363">=</span>&nbsp;<span class="builtintype" id="5525365">uint8</span><span class="op" id="5525370">(</span><span class="ident" id="5525371">c</span><span class="op" id="5525372">.</span><span class="ident" id="5525373">A</span><span class="op" id="5525374">)</span><br>
<span class="lineno">225</span><span class="op" id="5525376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5525379">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5525456">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5525528">func</span>&nbsp;<span class="op" id="5525533">(</span><span class="ident" id="5525534">p</span>&nbsp;<span class="op" id="5525536">*</span><span class="ident" id="5525537">RGBA64</span><span class="op" id="5525543">)</span>&nbsp;<span class="ident" id="5525545">SubImage</span><span class="op" id="5525553">(</span><span class="ident" id="5525554">r</span>&nbsp;<span class="ident" id="5525556">Rectangle</span><span class="op" id="5525565">)</span>&nbsp;<span class="ident" id="5525567">Image</span>&nbsp;<span class="op" id="5525573">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525576">r</span>&nbsp;<span class="op" id="5525578">=</span>&nbsp;<span class="ident" id="5525580">r</span><span class="op" id="5525581">.</span><span class="ident" id="5525582">Intersect</span><span class="op" id="5525591">(</span><span class="ident" id="5525592">p</span><span class="op" id="5525593">.</span><span class="ident" id="5525594">Rect</span><span class="op" id="5525598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525601">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525682">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525764">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525814">if</span>&nbsp;<span class="ident" id="5525817">r</span><span class="op" id="5525818">.</span><span class="ident" id="5525819">Empty</span><span class="op" id="5525824">(</span><span class="op" id="5525825">)</span>&nbsp;<span class="op" id="5525827">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525831">return</span>&nbsp;<span class="op" id="5525838">&amp;</span><span class="ident" id="5525839">RGBA64</span><span class="op" id="5525845">{</span><span class="op" id="5525846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525852">i</span>&nbsp;<span class="op" id="5525854">:=</span>&nbsp;<span class="ident" id="5525857">p</span><span class="op" id="5525858">.</span><span class="ident" id="5525859">PixOffset</span><span class="op" id="5525868">(</span><span class="ident" id="5525869">r</span><span class="op" id="5525870">.</span><span class="ident" id="5525871">Min</span><span class="op" id="5525874">.</span><span class="ident" id="5525875">X</span><span class="op" id="5525876">,</span>&nbsp;<span class="ident" id="5525878">r</span><span class="op" id="5525879">.</span><span class="ident" id="5525880">Min</span><span class="op" id="5525883">.</span><span class="ident" id="5525884">Y</span><span class="op" id="5525885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525888">return</span>&nbsp;<span class="op" id="5525895">&amp;</span><span class="ident" id="5525896">RGBA64</span><span class="op" id="5525902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525906">Pix</span><span class="op" id="5525909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525914">p</span><span class="op" id="5525915">.</span><span class="ident" id="5525916">Pix</span><span class="op" id="5525919">[</span><span class="ident" id="5525920">i</span><span class="op" id="5525921">:</span><span class="op" id="5525922">]</span><span class="op" id="5525923">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525927">Stride</span><span class="op" id="5525933">:</span>&nbsp;<span class="ident" id="5525935">p</span><span class="op" id="5525936">.</span><span class="ident" id="5525937">Stride</span><span class="op" id="5525943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525947">Rect</span><span class="op" id="5525951">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5525955">r</span><span class="op" id="5525956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525959">}</span><br>
<span class="lineno"></span><span class="op" id="5525961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5525964">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5526037">func</span>&nbsp;<span class="op" id="5526042">(</span><span class="ident" id="5526043">p</span>&nbsp;<span class="op" id="5526045">*</span><span class="ident" id="5526046">RGBA64</span><span class="op" id="5526052">)</span>&nbsp;<span class="ident" id="5526054">Opaque</span><span class="op" id="5526060">(</span><span class="op" id="5526061">)</span>&nbsp;<span class="builtintype" id="5526063">bool</span>&nbsp;<span class="op" id="5526068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526071">if</span>&nbsp;<span class="ident" id="5526074">p</span><span class="op" id="5526075">.</span><span class="ident" id="5526076">Rect</span><span class="op" id="5526080">.</span><span class="ident" id="5526081">Empty</span><span class="op" id="5526086">(</span><span class="op" id="5526087">)</span>&nbsp;<span class="op" id="5526089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526093">return</span>&nbsp;<span class="ident" id="5526100">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526106">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526109">i0</span><span class="op" id="5526111">,</span>&nbsp;<span class="ident" id="5526113">i1</span>&nbsp;<span class="op" id="5526116">:=</span>&nbsp;<span class="num" id="5526119">6</span><span class="op" id="5526120">,</span>&nbsp;<span class="ident" id="5526122">p</span><span class="op" id="5526123">.</span><span class="ident" id="5526124">Rect</span><span class="op" id="5526128">.</span><span class="ident" id="5526129">Dx</span><span class="op" id="5526131">(</span><span class="op" id="5526132">)</span><span class="op" id="5526133">*</span><span class="num" id="5526134">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526137">for</span>&nbsp;<span class="ident" id="5526141">y</span>&nbsp;<span class="op" id="5526143">:=</span>&nbsp;<span class="ident" id="5526146">p</span><span class="op" id="5526147">.</span><span class="ident" id="5526148">Rect</span><span class="op" id="5526152">.</span><span class="ident" id="5526153">Min</span><span class="op" id="5526156">.</span><span class="ident" id="5526157">Y</span><span class="op" id="5526158">;</span>&nbsp;<span class="ident" id="5526160">y</span>&nbsp;<span class="op" id="5526162">&lt;</span>&nbsp;<span class="ident" id="5526164">p</span><span class="op" id="5526165">.</span><span class="ident" id="5526166">Rect</span><span class="op" id="5526170">.</span><span class="ident" id="5526171">Max</span><span class="op" id="5526174">.</span><span class="ident" id="5526175">Y</span><span class="op" id="5526176">;</span>&nbsp;<span class="ident" id="5526178">y</span><span class="op" id="5526179">++</span>&nbsp;<span class="op" id="5526182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526186">for</span>&nbsp;<span class="ident" id="5526190">i</span>&nbsp;<span class="op" id="5526192">:=</span>&nbsp;<span class="ident" id="5526195">i0</span><span class="op" id="5526197">;</span>&nbsp;<span class="ident" id="5526199">i</span>&nbsp;<span class="op" id="5526201">&lt;</span>&nbsp;<span class="ident" id="5526203">i1</span><span class="op" id="5526205">;</span>&nbsp;<span class="ident" id="5526207">i</span>&nbsp;<span class="op" id="5526209">+=</span>&nbsp;<span class="num" id="5526212">8</span>&nbsp;<span class="op" id="5526214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526219">if</span>&nbsp;<span class="ident" id="5526222">p</span><span class="op" id="5526223">.</span><span class="ident" id="5526224">Pix</span><span class="op" id="5526227">[</span><span class="ident" id="5526228">i</span><span class="op" id="5526229">+</span><span class="num" id="5526230">0</span><span class="op" id="5526231">]</span>&nbsp;<span class="op" id="5526233">!=</span>&nbsp;<span class="num" id="5526236">0xff</span>&nbsp;<span class="op" id="5526241">||</span>&nbsp;<span class="ident" id="5526244">p</span><span class="op" id="5526245">.</span><span class="ident" id="5526246">Pix</span><span class="op" id="5526249">[</span><span class="ident" id="5526250">i</span><span class="op" id="5526251">+</span><span class="num" id="5526252">1</span><span class="op" id="5526253">]</span>&nbsp;<span class="op" id="5526255">!=</span>&nbsp;<span class="num" id="5526258">0xff</span>&nbsp;<span class="op" id="5526263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526269">return</span>&nbsp;<span class="ident" id="5526276">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526293">i0</span>&nbsp;<span class="op" id="5526296">+=</span>&nbsp;<span class="ident" id="5526299">p</span><span class="op" id="5526300">.</span><span class="ident" id="5526301">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526310">i1</span>&nbsp;<span class="op" id="5526313">+=</span>&nbsp;<span class="ident" id="5526316">p</span><span class="op" id="5526317">.</span><span class="ident" id="5526318">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526326">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526329">return</span>&nbsp;<span class="ident" id="5526336">true</span><br>
<span class="lineno"></span><span class="op" id="5526341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5526344">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5526401">func</span>&nbsp;<span class="ident" id="5526406">NewRGBA64</span><span class="op" id="5526415">(</span><span class="ident" id="5526416">r</span>&nbsp;<span class="ident" id="5526418">Rectangle</span><span class="op" id="5526427">)</span>&nbsp;<span class="op" id="5526429">*</span><span class="ident" id="5526430">RGBA64</span>&nbsp;<span class="op" id="5526437">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526440">w</span><span class="op" id="5526441">,</span>&nbsp;<span class="ident" id="5526443">h</span>&nbsp;<span class="op" id="5526445">:=</span>&nbsp;<span class="ident" id="5526448">r</span><span class="op" id="5526449">.</span><span class="ident" id="5526450">Dx</span><span class="op" id="5526452">(</span><span class="op" id="5526453">)</span><span class="op" id="5526454">,</span>&nbsp;<span class="ident" id="5526456">r</span><span class="op" id="5526457">.</span><span class="ident" id="5526458">Dy</span><span class="op" id="5526460">(</span><span class="op" id="5526461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526464">pix</span>&nbsp;<span class="op" id="5526468">:=</span>&nbsp;<span class="builtinfunc" id="5526471">make</span><span class="op" id="5526475">(</span><span class="op" id="5526476">[</span><span class="op" id="5526477">]</span><span class="builtintype" id="5526478">uint8</span><span class="op" id="5526483">,</span>&nbsp;<span class="num" id="5526485">8</span><span class="op" id="5526486">*</span><span class="ident" id="5526487">w</span><span class="op" id="5526488">*</span><span class="ident" id="5526489">h</span><span class="op" id="5526490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526493">return</span>&nbsp;<span class="op" id="5526500">&amp;</span><span class="ident" id="5526501">RGBA64</span><span class="op" id="5526507">{</span><span class="ident" id="5526508">pix</span><span class="op" id="5526511">,</span>&nbsp;<span class="num" id="5526513">8</span>&nbsp;<span class="op" id="5526515">*</span>&nbsp;<span class="ident" id="5526517">w</span><span class="op" id="5526518">,</span>&nbsp;<span class="ident" id="5526520">r</span><span class="op" id="5526521">}</span><br>
<span class="lineno"></span><span class="op" id="5526523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5526526">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5526601">type</span>&nbsp;<span class="ident" id="5526606">NRGBA</span>&nbsp;<span class="keyword" id="5526612">struct</span>&nbsp;<span class="op" id="5526619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526622">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526690">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526758">Pix</span>&nbsp;<span class="op" id="5526762">[</span><span class="op" id="5526763">]</span><span class="builtintype" id="5526764">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526771">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526847">Stride</span>&nbsp;<span class="builtintype" id="5526854">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526859">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526891">Rect</span>&nbsp;<span class="ident" id="5526896">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5526906">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5526909">func</span>&nbsp;<span class="op" id="5526914">(</span><span class="ident" id="5526915">p</span>&nbsp;<span class="op" id="5526917">*</span><span class="ident" id="5526918">NRGBA</span><span class="op" id="5526923">)</span>&nbsp;<span class="ident" id="5526925">ColorModel</span><span class="op" id="5526935">(</span><span class="op" id="5526936">)</span>&nbsp;<span class="ident" id="5526938">color</span><span class="op" id="5526943">.</span><span class="ident" id="5526944">Model</span>&nbsp;<span class="op" id="5526950">{</span>&nbsp;<span class="keyword" id="5526952">return</span>&nbsp;<span class="ident" id="5526959">color</span><span class="op" id="5526964">.</span><span class="ident" id="5526965">NRGBAModel</span>&nbsp;<span class="op" id="5526976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5526979">func</span>&nbsp;<span class="op" id="5526984">(</span><span class="ident" id="5526985">p</span>&nbsp;<span class="op" id="5526987">*</span><span class="ident" id="5526988">NRGBA</span><span class="op" id="5526993">)</span>&nbsp;<span class="ident" id="5526995">Bounds</span><span class="op" id="5527001">(</span><span class="op" id="5527002">)</span>&nbsp;<span class="ident" id="5527004">Rectangle</span>&nbsp;<span class="op" id="5527014">{</span>&nbsp;<span class="keyword" id="5527016">return</span>&nbsp;<span class="ident" id="5527023">p</span><span class="op" id="5527024">.</span><span class="ident" id="5527025">Rect</span>&nbsp;<span class="op" id="5527030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5527033">func</span>&nbsp;<span class="op" id="5527038">(</span><span class="ident" id="5527039">p</span>&nbsp;<span class="op" id="5527041">*</span><span class="ident" id="5527042">NRGBA</span><span class="op" id="5527047">)</span>&nbsp;<span class="ident" id="5527049">At</span><span class="op" id="5527051">(</span><span class="ident" id="5527052">x</span><span class="op" id="5527053">,</span>&nbsp;<span class="ident" id="5527055">y</span>&nbsp;<span class="builtintype" id="5527057">int</span><span class="op" id="5527060">)</span>&nbsp;<span class="ident" id="5527062">color</span><span class="op" id="5527067">.</span><span class="ident" id="5527068">Color</span>&nbsp;<span class="op" id="5527074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527077">return</span>&nbsp;<span class="ident" id="5527084">p</span><span class="op" id="5527085">.</span><span class="ident" id="5527086">NRGBAAt</span><span class="op" id="5527093">(</span><span class="ident" id="5527094">x</span><span class="op" id="5527095">,</span>&nbsp;<span class="ident" id="5527097">y</span><span class="op" id="5527098">)</span><br>
<span class="lineno"></span><span class="op" id="5527100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5527103">func</span>&nbsp;<span class="op" id="5527108">(</span><span class="ident" id="5527109">p</span>&nbsp;<span class="op" id="5527111">*</span><span class="ident" id="5527112">NRGBA</span><span class="op" id="5527117">)</span>&nbsp;<span class="ident" id="5527119">NRGBAAt</span><span class="op" id="5527126">(</span><span class="ident" id="5527127">x</span><span class="op" id="5527128">,</span>&nbsp;<span class="ident" id="5527130">y</span>&nbsp;<span class="builtintype" id="5527132">int</span><span class="op" id="5527135">)</span>&nbsp;<span class="ident" id="5527137">color</span><span class="op" id="5527142">.</span><span class="ident" id="5527143">NRGBA</span>&nbsp;<span class="op" id="5527149">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527152">if</span>&nbsp;<span class="op" id="5527155">!</span><span class="op" id="5527156">(</span><span class="ident" id="5527157">Point</span><span class="op" id="5527162">{</span><span class="ident" id="5527163">x</span><span class="op" id="5527164">,</span>&nbsp;<span class="ident" id="5527166">y</span><span class="op" id="5527167">}</span><span class="op" id="5527168">.</span><span class="ident" id="5527169">In</span><span class="op" id="5527171">(</span><span class="ident" id="5527172">p</span><span class="op" id="5527173">.</span><span class="ident" id="5527174">Rect</span><span class="op" id="5527178">)</span><span class="op" id="5527179">)</span>&nbsp;<span class="op" id="5527181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527185">return</span>&nbsp;<span class="ident" id="5527192">color</span><span class="op" id="5527197">.</span><span class="ident" id="5527198">NRGBA</span><span class="op" id="5527203">{</span><span class="op" id="5527204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527210">i</span>&nbsp;<span class="op" id="5527212">:=</span>&nbsp;<span class="ident" id="5527215">p</span><span class="op" id="5527216">.</span><span class="ident" id="5527217">PixOffset</span><span class="op" id="5527226">(</span><span class="ident" id="5527227">x</span><span class="op" id="5527228">,</span>&nbsp;<span class="ident" id="5527230">y</span><span class="op" id="5527231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527234">return</span>&nbsp;<span class="ident" id="5527241">color</span><span class="op" id="5527246">.</span><span class="ident" id="5527247">NRGBA</span><span class="op" id="5527252">{</span><span class="ident" id="5527253">p</span><span class="op" id="5527254">.</span><span class="ident" id="5527255">Pix</span><span class="op" id="5527258">[</span><span class="ident" id="5527259">i</span><span class="op" id="5527260">+</span><span class="num" id="5527261">0</span><span class="op" id="5527262">]</span><span class="op" id="5527263">,</span>&nbsp;<span class="ident" id="5527265">p</span><span class="op" id="5527266">.</span><span class="ident" id="5527267">Pix</span><span class="op" id="5527270">[</span><span class="ident" id="5527271">i</span><span class="op" id="5527272">+</span><span class="num" id="5527273">1</span><span class="op" id="5527274">]</span><span class="op" id="5527275">,</span>&nbsp;<span class="ident" id="5527277">p</span><span class="op" id="5527278">.</span><span class="ident" id="5527279">Pix</span><span class="op" id="5527282">[</span><span class="ident" id="5527283">i</span><span class="op" id="5527284">+</span><span class="num" id="5527285">2</span><span class="op" id="5527286">]</span><span class="op" id="5527287">,</span>&nbsp;<span class="ident" id="5527289">p</span><span class="op" id="5527290">.</span><span class="ident" id="5527291">Pix</span><span class="op" id="5527294">[</span><span class="ident" id="5527295">i</span><span class="op" id="5527296">+</span><span class="num" id="5527297">3</span><span class="op" id="5527298">]</span><span class="op" id="5527299">}</span><br>
<span class="lineno">295</span><span class="op" id="5527301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5527304">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5527383">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5527407">func</span>&nbsp;<span class="op" id="5527412">(</span><span class="ident" id="5527413">p</span>&nbsp;<span class="op" id="5527415">*</span><span class="ident" id="5527416">NRGBA</span><span class="op" id="5527421">)</span>&nbsp;<span class="ident" id="5527423">PixOffset</span><span class="op" id="5527432">(</span><span class="ident" id="5527433">x</span><span class="op" id="5527434">,</span>&nbsp;<span class="ident" id="5527436">y</span>&nbsp;<span class="builtintype" id="5527438">int</span><span class="op" id="5527441">)</span>&nbsp;<span class="builtintype" id="5527443">int</span>&nbsp;<span class="op" id="5527447">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527450">return</span>&nbsp;<span class="op" id="5527457">(</span><span class="ident" id="5527458">y</span><span class="op" id="5527459">-</span><span class="ident" id="5527460">p</span><span class="op" id="5527461">.</span><span class="ident" id="5527462">Rect</span><span class="op" id="5527466">.</span><span class="ident" id="5527467">Min</span><span class="op" id="5527470">.</span><span class="ident" id="5527471">Y</span><span class="op" id="5527472">)</span><span class="op" id="5527473">*</span><span class="ident" id="5527474">p</span><span class="op" id="5527475">.</span><span class="ident" id="5527476">Stride</span>&nbsp;<span class="op" id="5527483">+</span>&nbsp;<span class="op" id="5527485">(</span><span class="ident" id="5527486">x</span><span class="op" id="5527487">-</span><span class="ident" id="5527488">p</span><span class="op" id="5527489">.</span><span class="ident" id="5527490">Rect</span><span class="op" id="5527494">.</span><span class="ident" id="5527495">Min</span><span class="op" id="5527498">.</span><span class="ident" id="5527499">X</span><span class="op" id="5527500">)</span><span class="op" id="5527501">*</span><span class="num" id="5527502">4</span><br>
<span class="lineno"></span><span class="op" id="5527504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5527507">func</span>&nbsp;<span class="op" id="5527512">(</span><span class="ident" id="5527513">p</span>&nbsp;<span class="op" id="5527515">*</span><span class="ident" id="5527516">NRGBA</span><span class="op" id="5527521">)</span>&nbsp;<span class="ident" id="5527523">Set</span><span class="op" id="5527526">(</span><span class="ident" id="5527527">x</span><span class="op" id="5527528">,</span>&nbsp;<span class="ident" id="5527530">y</span>&nbsp;<span class="builtintype" id="5527532">int</span><span class="op" id="5527535">,</span>&nbsp;<span class="ident" id="5527537">c</span>&nbsp;<span class="ident" id="5527539">color</span><span class="op" id="5527544">.</span><span class="ident" id="5527545">Color</span><span class="op" id="5527550">)</span>&nbsp;<span class="op" id="5527552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527555">if</span>&nbsp;<span class="op" id="5527558">!</span><span class="op" id="5527559">(</span><span class="ident" id="5527560">Point</span><span class="op" id="5527565">{</span><span class="ident" id="5527566">x</span><span class="op" id="5527567">,</span>&nbsp;<span class="ident" id="5527569">y</span><span class="op" id="5527570">}</span><span class="op" id="5527571">.</span><span class="ident" id="5527572">In</span><span class="op" id="5527574">(</span><span class="ident" id="5527575">p</span><span class="op" id="5527576">.</span><span class="ident" id="5527577">Rect</span><span class="op" id="5527581">)</span><span class="op" id="5527582">)</span>&nbsp;<span class="op" id="5527584">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527588">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527599">i</span>&nbsp;<span class="op" id="5527601">:=</span>&nbsp;<span class="ident" id="5527604">p</span><span class="op" id="5527605">.</span><span class="ident" id="5527606">PixOffset</span><span class="op" id="5527615">(</span><span class="ident" id="5527616">x</span><span class="op" id="5527617">,</span>&nbsp;<span class="ident" id="5527619">y</span><span class="op" id="5527620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527623">c1</span>&nbsp;<span class="op" id="5527626">:=</span>&nbsp;<span class="ident" id="5527629">color</span><span class="op" id="5527634">.</span><span class="ident" id="5527635">NRGBAModel</span><span class="op" id="5527645">.</span><span class="ident" id="5527646">Convert</span><span class="op" id="5527653">(</span><span class="ident" id="5527654">c</span><span class="op" id="5527655">)</span><span class="op" id="5527656">.</span><span class="op" id="5527657">(</span><span class="ident" id="5527658">color</span><span class="op" id="5527663">.</span><span class="ident" id="5527664">NRGBA</span><span class="op" id="5527669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527672">p</span><span class="op" id="5527673">.</span><span class="ident" id="5527674">Pix</span><span class="op" id="5527677">[</span><span class="ident" id="5527678">i</span><span class="op" id="5527679">+</span><span class="num" id="5527680">0</span><span class="op" id="5527681">]</span>&nbsp;<span class="op" id="5527683">=</span>&nbsp;<span class="ident" id="5527685">c1</span><span class="op" id="5527687">.</span><span class="ident" id="5527688">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527691">p</span><span class="op" id="5527692">.</span><span class="ident" id="5527693">Pix</span><span class="op" id="5527696">[</span><span class="ident" id="5527697">i</span><span class="op" id="5527698">+</span><span class="num" id="5527699">1</span><span class="op" id="5527700">]</span>&nbsp;<span class="op" id="5527702">=</span>&nbsp;<span class="ident" id="5527704">c1</span><span class="op" id="5527706">.</span><span class="ident" id="5527707">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527710">p</span><span class="op" id="5527711">.</span><span class="ident" id="5527712">Pix</span><span class="op" id="5527715">[</span><span class="ident" id="5527716">i</span><span class="op" id="5527717">+</span><span class="num" id="5527718">2</span><span class="op" id="5527719">]</span>&nbsp;<span class="op" id="5527721">=</span>&nbsp;<span class="ident" id="5527723">c1</span><span class="op" id="5527725">.</span><span class="ident" id="5527726">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527729">p</span><span class="op" id="5527730">.</span><span class="ident" id="5527731">Pix</span><span class="op" id="5527734">[</span><span class="ident" id="5527735">i</span><span class="op" id="5527736">+</span><span class="num" id="5527737">3</span><span class="op" id="5527738">]</span>&nbsp;<span class="op" id="5527740">=</span>&nbsp;<span class="ident" id="5527742">c1</span><span class="op" id="5527744">.</span><span class="ident" id="5527745">A</span><br>
<span class="lineno"></span><span class="op" id="5527747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5527750">func</span>&nbsp;<span class="op" id="5527755">(</span><span class="ident" id="5527756">p</span>&nbsp;<span class="op" id="5527758">*</span><span class="ident" id="5527759">NRGBA</span><span class="op" id="5527764">)</span>&nbsp;<span class="ident" id="5527766">SetNRGBA</span><span class="op" id="5527774">(</span><span class="ident" id="5527775">x</span><span class="op" id="5527776">,</span>&nbsp;<span class="ident" id="5527778">y</span>&nbsp;<span class="builtintype" id="5527780">int</span><span class="op" id="5527783">,</span>&nbsp;<span class="ident" id="5527785">c</span>&nbsp;<span class="ident" id="5527787">color</span><span class="op" id="5527792">.</span><span class="ident" id="5527793">NRGBA</span><span class="op" id="5527798">)</span>&nbsp;<span class="op" id="5527800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527803">if</span>&nbsp;<span class="op" id="5527806">!</span><span class="op" id="5527807">(</span><span class="ident" id="5527808">Point</span><span class="op" id="5527813">{</span><span class="ident" id="5527814">x</span><span class="op" id="5527815">,</span>&nbsp;<span class="ident" id="5527817">y</span><span class="op" id="5527818">}</span><span class="op" id="5527819">.</span><span class="ident" id="5527820">In</span><span class="op" id="5527822">(</span><span class="ident" id="5527823">p</span><span class="op" id="5527824">.</span><span class="ident" id="5527825">Rect</span><span class="op" id="5527829">)</span><span class="op" id="5527830">)</span>&nbsp;<span class="op" id="5527832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527836">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527847">i</span>&nbsp;<span class="op" id="5527849">:=</span>&nbsp;<span class="ident" id="5527852">p</span><span class="op" id="5527853">.</span><span class="ident" id="5527854">PixOffset</span><span class="op" id="5527863">(</span><span class="ident" id="5527864">x</span><span class="op" id="5527865">,</span>&nbsp;<span class="ident" id="5527867">y</span><span class="op" id="5527868">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527871">p</span><span class="op" id="5527872">.</span><span class="ident" id="5527873">Pix</span><span class="op" id="5527876">[</span><span class="ident" id="5527877">i</span><span class="op" id="5527878">+</span><span class="num" id="5527879">0</span><span class="op" id="5527880">]</span>&nbsp;<span class="op" id="5527882">=</span>&nbsp;<span class="ident" id="5527884">c</span><span class="op" id="5527885">.</span><span class="ident" id="5527886">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527889">p</span><span class="op" id="5527890">.</span><span class="ident" id="5527891">Pix</span><span class="op" id="5527894">[</span><span class="ident" id="5527895">i</span><span class="op" id="5527896">+</span><span class="num" id="5527897">1</span><span class="op" id="5527898">]</span>&nbsp;<span class="op" id="5527900">=</span>&nbsp;<span class="ident" id="5527902">c</span><span class="op" id="5527903">.</span><span class="ident" id="5527904">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527907">p</span><span class="op" id="5527908">.</span><span class="ident" id="5527909">Pix</span><span class="op" id="5527912">[</span><span class="ident" id="5527913">i</span><span class="op" id="5527914">+</span><span class="num" id="5527915">2</span><span class="op" id="5527916">]</span>&nbsp;<span class="op" id="5527918">=</span>&nbsp;<span class="ident" id="5527920">c</span><span class="op" id="5527921">.</span><span class="ident" id="5527922">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527925">p</span><span class="op" id="5527926">.</span><span class="ident" id="5527927">Pix</span><span class="op" id="5527930">[</span><span class="ident" id="5527931">i</span><span class="op" id="5527932">+</span><span class="num" id="5527933">3</span><span class="op" id="5527934">]</span>&nbsp;<span class="op" id="5527936">=</span>&nbsp;<span class="ident" id="5527938">c</span><span class="op" id="5527939">.</span><span class="ident" id="5527940">A</span><br>
<span class="lineno"></span><span class="op" id="5527942">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5527945">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5528022">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5528094">func</span>&nbsp;<span class="op" id="5528099">(</span><span class="ident" id="5528100">p</span>&nbsp;<span class="op" id="5528102">*</span><span class="ident" id="5528103">NRGBA</span><span class="op" id="5528108">)</span>&nbsp;<span class="ident" id="5528110">SubImage</span><span class="op" id="5528118">(</span><span class="ident" id="5528119">r</span>&nbsp;<span class="ident" id="5528121">Rectangle</span><span class="op" id="5528130">)</span>&nbsp;<span class="ident" id="5528132">Image</span>&nbsp;<span class="op" id="5528138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528141">r</span>&nbsp;<span class="op" id="5528143">=</span>&nbsp;<span class="ident" id="5528145">r</span><span class="op" id="5528146">.</span><span class="ident" id="5528147">Intersect</span><span class="op" id="5528156">(</span><span class="ident" id="5528157">p</span><span class="op" id="5528158">.</span><span class="ident" id="5528159">Rect</span><span class="op" id="5528163">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528166">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528247">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528329">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528379">if</span>&nbsp;<span class="ident" id="5528382">r</span><span class="op" id="5528383">.</span><span class="ident" id="5528384">Empty</span><span class="op" id="5528389">(</span><span class="op" id="5528390">)</span>&nbsp;<span class="op" id="5528392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528396">return</span>&nbsp;<span class="op" id="5528403">&amp;</span><span class="ident" id="5528404">NRGBA</span><span class="op" id="5528409">{</span><span class="op" id="5528410">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528416">i</span>&nbsp;<span class="op" id="5528418">:=</span>&nbsp;<span class="ident" id="5528421">p</span><span class="op" id="5528422">.</span><span class="ident" id="5528423">PixOffset</span><span class="op" id="5528432">(</span><span class="ident" id="5528433">r</span><span class="op" id="5528434">.</span><span class="ident" id="5528435">Min</span><span class="op" id="5528438">.</span><span class="ident" id="5528439">X</span><span class="op" id="5528440">,</span>&nbsp;<span class="ident" id="5528442">r</span><span class="op" id="5528443">.</span><span class="ident" id="5528444">Min</span><span class="op" id="5528447">.</span><span class="ident" id="5528448">Y</span><span class="op" id="5528449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528452">return</span>&nbsp;<span class="op" id="5528459">&amp;</span><span class="ident" id="5528460">NRGBA</span><span class="op" id="5528465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528469">Pix</span><span class="op" id="5528472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528477">p</span><span class="op" id="5528478">.</span><span class="ident" id="5528479">Pix</span><span class="op" id="5528482">[</span><span class="ident" id="5528483">i</span><span class="op" id="5528484">:</span><span class="op" id="5528485">]</span><span class="op" id="5528486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528490">Stride</span><span class="op" id="5528496">:</span>&nbsp;<span class="ident" id="5528498">p</span><span class="op" id="5528499">.</span><span class="ident" id="5528500">Stride</span><span class="op" id="5528506">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528510">Rect</span><span class="op" id="5528514">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5528518">r</span><span class="op" id="5528519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528522">}</span><br>
<span class="lineno"></span><span class="op" id="5528524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5528527">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5528600">func</span>&nbsp;<span class="op" id="5528605">(</span><span class="ident" id="5528606">p</span>&nbsp;<span class="op" id="5528608">*</span><span class="ident" id="5528609">NRGBA</span><span class="op" id="5528614">)</span>&nbsp;<span class="ident" id="5528616">Opaque</span><span class="op" id="5528622">(</span><span class="op" id="5528623">)</span>&nbsp;<span class="builtintype" id="5528625">bool</span>&nbsp;<span class="op" id="5528630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528633">if</span>&nbsp;<span class="ident" id="5528636">p</span><span class="op" id="5528637">.</span><span class="ident" id="5528638">Rect</span><span class="op" id="5528642">.</span><span class="ident" id="5528643">Empty</span><span class="op" id="5528648">(</span><span class="op" id="5528649">)</span>&nbsp;<span class="op" id="5528651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528655">return</span>&nbsp;<span class="ident" id="5528662">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528671">i0</span><span class="op" id="5528673">,</span>&nbsp;<span class="ident" id="5528675">i1</span>&nbsp;<span class="op" id="5528678">:=</span>&nbsp;<span class="num" id="5528681">3</span><span class="op" id="5528682">,</span>&nbsp;<span class="ident" id="5528684">p</span><span class="op" id="5528685">.</span><span class="ident" id="5528686">Rect</span><span class="op" id="5528690">.</span><span class="ident" id="5528691">Dx</span><span class="op" id="5528693">(</span><span class="op" id="5528694">)</span><span class="op" id="5528695">*</span><span class="num" id="5528696">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528699">for</span>&nbsp;<span class="ident" id="5528703">y</span>&nbsp;<span class="op" id="5528705">:=</span>&nbsp;<span class="ident" id="5528708">p</span><span class="op" id="5528709">.</span><span class="ident" id="5528710">Rect</span><span class="op" id="5528714">.</span><span class="ident" id="5528715">Min</span><span class="op" id="5528718">.</span><span class="ident" id="5528719">Y</span><span class="op" id="5528720">;</span>&nbsp;<span class="ident" id="5528722">y</span>&nbsp;<span class="op" id="5528724">&lt;</span>&nbsp;<span class="ident" id="5528726">p</span><span class="op" id="5528727">.</span><span class="ident" id="5528728">Rect</span><span class="op" id="5528732">.</span><span class="ident" id="5528733">Max</span><span class="op" id="5528736">.</span><span class="ident" id="5528737">Y</span><span class="op" id="5528738">;</span>&nbsp;<span class="ident" id="5528740">y</span><span class="op" id="5528741">++</span>&nbsp;<span class="op" id="5528744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528748">for</span>&nbsp;<span class="ident" id="5528752">i</span>&nbsp;<span class="op" id="5528754">:=</span>&nbsp;<span class="ident" id="5528757">i0</span><span class="op" id="5528759">;</span>&nbsp;<span class="ident" id="5528761">i</span>&nbsp;<span class="op" id="5528763">&lt;</span>&nbsp;<span class="ident" id="5528765">i1</span><span class="op" id="5528767">;</span>&nbsp;<span class="ident" id="5528769">i</span>&nbsp;<span class="op" id="5528771">+=</span>&nbsp;<span class="num" id="5528774">4</span>&nbsp;<span class="op" id="5528776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528781">if</span>&nbsp;<span class="ident" id="5528784">p</span><span class="op" id="5528785">.</span><span class="ident" id="5528786">Pix</span><span class="op" id="5528789">[</span><span class="ident" id="5528790">i</span><span class="op" id="5528791">]</span>&nbsp;<span class="op" id="5528793">!=</span>&nbsp;<span class="num" id="5528796">0xff</span>&nbsp;<span class="op" id="5528801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528807">return</span>&nbsp;<span class="ident" id="5528814">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528823">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528831">i0</span>&nbsp;<span class="op" id="5528834">+=</span>&nbsp;<span class="ident" id="5528837">p</span><span class="op" id="5528838">.</span><span class="ident" id="5528839">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528848">i1</span>&nbsp;<span class="op" id="5528851">+=</span>&nbsp;<span class="ident" id="5528854">p</span><span class="op" id="5528855">.</span><span class="ident" id="5528856">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528867">return</span>&nbsp;<span class="ident" id="5528874">true</span><br>
<span class="lineno">360</span><span class="op" id="5528879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5528882">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5528937">func</span>&nbsp;<span class="ident" id="5528942">NewNRGBA</span><span class="op" id="5528950">(</span><span class="ident" id="5528951">r</span>&nbsp;<span class="ident" id="5528953">Rectangle</span><span class="op" id="5528962">)</span>&nbsp;<span class="op" id="5528964">*</span><span class="ident" id="5528965">NRGBA</span>&nbsp;<span class="op" id="5528971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528974">w</span><span class="op" id="5528975">,</span>&nbsp;<span class="ident" id="5528977">h</span>&nbsp;<span class="op" id="5528979">:=</span>&nbsp;<span class="ident" id="5528982">r</span><span class="op" id="5528983">.</span><span class="ident" id="5528984">Dx</span><span class="op" id="5528986">(</span><span class="op" id="5528987">)</span><span class="op" id="5528988">,</span>&nbsp;<span class="ident" id="5528990">r</span><span class="op" id="5528991">.</span><span class="ident" id="5528992">Dy</span><span class="op" id="5528994">(</span><span class="op" id="5528995">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528998">pix</span>&nbsp;<span class="op" id="5529002">:=</span>&nbsp;<span class="builtinfunc" id="5529005">make</span><span class="op" id="5529009">(</span><span class="op" id="5529010">[</span><span class="op" id="5529011">]</span><span class="builtintype" id="5529012">uint8</span><span class="op" id="5529017">,</span>&nbsp;<span class="num" id="5529019">4</span><span class="op" id="5529020">*</span><span class="ident" id="5529021">w</span><span class="op" id="5529022">*</span><span class="ident" id="5529023">h</span><span class="op" id="5529024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529027">return</span>&nbsp;<span class="op" id="5529034">&amp;</span><span class="ident" id="5529035">NRGBA</span><span class="op" id="5529040">{</span><span class="ident" id="5529041">pix</span><span class="op" id="5529044">,</span>&nbsp;<span class="num" id="5529046">4</span>&nbsp;<span class="op" id="5529048">*</span>&nbsp;<span class="ident" id="5529050">w</span><span class="op" id="5529051">,</span>&nbsp;<span class="ident" id="5529053">r</span><span class="op" id="5529054">}</span><br>
<span class="lineno"></span><span class="op" id="5529056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5529059">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5529138">type</span>&nbsp;<span class="ident" id="5529143">NRGBA64</span>&nbsp;<span class="keyword" id="5529151">struct</span>&nbsp;<span class="op" id="5529158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529161">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529251">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529319">Pix</span>&nbsp;<span class="op" id="5529323">[</span><span class="op" id="5529324">]</span><span class="builtintype" id="5529325">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529332">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529408">Stride</span>&nbsp;<span class="builtintype" id="5529415">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529420">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529452">Rect</span>&nbsp;<span class="ident" id="5529457">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5529467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5529470">func</span>&nbsp;<span class="op" id="5529475">(</span><span class="ident" id="5529476">p</span>&nbsp;<span class="op" id="5529478">*</span><span class="ident" id="5529479">NRGBA64</span><span class="op" id="5529486">)</span>&nbsp;<span class="ident" id="5529488">ColorModel</span><span class="op" id="5529498">(</span><span class="op" id="5529499">)</span>&nbsp;<span class="ident" id="5529501">color</span><span class="op" id="5529506">.</span><span class="ident" id="5529507">Model</span>&nbsp;<span class="op" id="5529513">{</span>&nbsp;<span class="keyword" id="5529515">return</span>&nbsp;<span class="ident" id="5529522">color</span><span class="op" id="5529527">.</span><span class="ident" id="5529528">NRGBA64Model</span>&nbsp;<span class="op" id="5529541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5529544">func</span>&nbsp;<span class="op" id="5529549">(</span><span class="ident" id="5529550">p</span>&nbsp;<span class="op" id="5529552">*</span><span class="ident" id="5529553">NRGBA64</span><span class="op" id="5529560">)</span>&nbsp;<span class="ident" id="5529562">Bounds</span><span class="op" id="5529568">(</span><span class="op" id="5529569">)</span>&nbsp;<span class="ident" id="5529571">Rectangle</span>&nbsp;<span class="op" id="5529581">{</span>&nbsp;<span class="keyword" id="5529583">return</span>&nbsp;<span class="ident" id="5529590">p</span><span class="op" id="5529591">.</span><span class="ident" id="5529592">Rect</span>&nbsp;<span class="op" id="5529597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5529600">func</span>&nbsp;<span class="op" id="5529605">(</span><span class="ident" id="5529606">p</span>&nbsp;<span class="op" id="5529608">*</span><span class="ident" id="5529609">NRGBA64</span><span class="op" id="5529616">)</span>&nbsp;<span class="ident" id="5529618">At</span><span class="op" id="5529620">(</span><span class="ident" id="5529621">x</span><span class="op" id="5529622">,</span>&nbsp;<span class="ident" id="5529624">y</span>&nbsp;<span class="builtintype" id="5529626">int</span><span class="op" id="5529629">)</span>&nbsp;<span class="ident" id="5529631">color</span><span class="op" id="5529636">.</span><span class="ident" id="5529637">Color</span>&nbsp;<span class="op" id="5529643">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529646">return</span>&nbsp;<span class="ident" id="5529653">p</span><span class="op" id="5529654">.</span><span class="ident" id="5529655">NRGBA64At</span><span class="op" id="5529664">(</span><span class="ident" id="5529665">x</span><span class="op" id="5529666">,</span>&nbsp;<span class="ident" id="5529668">y</span><span class="op" id="5529669">)</span><br>
<span class="lineno"></span><span class="op" id="5529671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5529674">func</span>&nbsp;<span class="op" id="5529679">(</span><span class="ident" id="5529680">p</span>&nbsp;<span class="op" id="5529682">*</span><span class="ident" id="5529683">NRGBA64</span><span class="op" id="5529690">)</span>&nbsp;<span class="ident" id="5529692">NRGBA64At</span><span class="op" id="5529701">(</span><span class="ident" id="5529702">x</span><span class="op" id="5529703">,</span>&nbsp;<span class="ident" id="5529705">y</span>&nbsp;<span class="builtintype" id="5529707">int</span><span class="op" id="5529710">)</span>&nbsp;<span class="ident" id="5529712">color</span><span class="op" id="5529717">.</span><span class="ident" id="5529718">NRGBA64</span>&nbsp;<span class="op" id="5529726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529729">if</span>&nbsp;<span class="op" id="5529732">!</span><span class="op" id="5529733">(</span><span class="ident" id="5529734">Point</span><span class="op" id="5529739">{</span><span class="ident" id="5529740">x</span><span class="op" id="5529741">,</span>&nbsp;<span class="ident" id="5529743">y</span><span class="op" id="5529744">}</span><span class="op" id="5529745">.</span><span class="ident" id="5529746">In</span><span class="op" id="5529748">(</span><span class="ident" id="5529749">p</span><span class="op" id="5529750">.</span><span class="ident" id="5529751">Rect</span><span class="op" id="5529755">)</span><span class="op" id="5529756">)</span>&nbsp;<span class="op" id="5529758">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529762">return</span>&nbsp;<span class="ident" id="5529769">color</span><span class="op" id="5529774">.</span><span class="ident" id="5529775">NRGBA64</span><span class="op" id="5529782">{</span><span class="op" id="5529783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529789">i</span>&nbsp;<span class="op" id="5529791">:=</span>&nbsp;<span class="ident" id="5529794">p</span><span class="op" id="5529795">.</span><span class="ident" id="5529796">PixOffset</span><span class="op" id="5529805">(</span><span class="ident" id="5529806">x</span><span class="op" id="5529807">,</span>&nbsp;<span class="ident" id="5529809">y</span><span class="op" id="5529810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529813">return</span>&nbsp;<span class="ident" id="5529820">color</span><span class="op" id="5529825">.</span><span class="ident" id="5529826">NRGBA64</span><span class="op" id="5529833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5529837">uint16</span><span class="op" id="5529843">(</span><span class="ident" id="5529844">p</span><span class="op" id="5529845">.</span><span class="ident" id="5529846">Pix</span><span class="op" id="5529849">[</span><span class="ident" id="5529850">i</span><span class="op" id="5529851">+</span><span class="num" id="5529852">0</span><span class="op" id="5529853">]</span><span class="op" id="5529854">)</span><span class="op" id="5529855">&lt;&lt;</span><span class="num" id="5529857">8</span>&nbsp;<span class="op" id="5529859">|</span>&nbsp;<span class="builtintype" id="5529861">uint16</span><span class="op" id="5529867">(</span><span class="ident" id="5529868">p</span><span class="op" id="5529869">.</span><span class="ident" id="5529870">Pix</span><span class="op" id="5529873">[</span><span class="ident" id="5529874">i</span><span class="op" id="5529875">+</span><span class="num" id="5529876">1</span><span class="op" id="5529877">]</span><span class="op" id="5529878">)</span><span class="op" id="5529879">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5529883">uint16</span><span class="op" id="5529889">(</span><span class="ident" id="5529890">p</span><span class="op" id="5529891">.</span><span class="ident" id="5529892">Pix</span><span class="op" id="5529895">[</span><span class="ident" id="5529896">i</span><span class="op" id="5529897">+</span><span class="num" id="5529898">2</span><span class="op" id="5529899">]</span><span class="op" id="5529900">)</span><span class="op" id="5529901">&lt;&lt;</span><span class="num" id="5529903">8</span>&nbsp;<span class="op" id="5529905">|</span>&nbsp;<span class="builtintype" id="5529907">uint16</span><span class="op" id="5529913">(</span><span class="ident" id="5529914">p</span><span class="op" id="5529915">.</span><span class="ident" id="5529916">Pix</span><span class="op" id="5529919">[</span><span class="ident" id="5529920">i</span><span class="op" id="5529921">+</span><span class="num" id="5529922">3</span><span class="op" id="5529923">]</span><span class="op" id="5529924">)</span><span class="op" id="5529925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5529929">uint16</span><span class="op" id="5529935">(</span><span class="ident" id="5529936">p</span><span class="op" id="5529937">.</span><span class="ident" id="5529938">Pix</span><span class="op" id="5529941">[</span><span class="ident" id="5529942">i</span><span class="op" id="5529943">+</span><span class="num" id="5529944">4</span><span class="op" id="5529945">]</span><span class="op" id="5529946">)</span><span class="op" id="5529947">&lt;&lt;</span><span class="num" id="5529949">8</span>&nbsp;<span class="op" id="5529951">|</span>&nbsp;<span class="builtintype" id="5529953">uint16</span><span class="op" id="5529959">(</span><span class="ident" id="5529960">p</span><span class="op" id="5529961">.</span><span class="ident" id="5529962">Pix</span><span class="op" id="5529965">[</span><span class="ident" id="5529966">i</span><span class="op" id="5529967">+</span><span class="num" id="5529968">5</span><span class="op" id="5529969">]</span><span class="op" id="5529970">)</span><span class="op" id="5529971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5529975">uint16</span><span class="op" id="5529981">(</span><span class="ident" id="5529982">p</span><span class="op" id="5529983">.</span><span class="ident" id="5529984">Pix</span><span class="op" id="5529987">[</span><span class="ident" id="5529988">i</span><span class="op" id="5529989">+</span><span class="num" id="5529990">6</span><span class="op" id="5529991">]</span><span class="op" id="5529992">)</span><span class="op" id="5529993">&lt;&lt;</span><span class="num" id="5529995">8</span>&nbsp;<span class="op" id="5529997">|</span>&nbsp;<span class="builtintype" id="5529999">uint16</span><span class="op" id="5530005">(</span><span class="ident" id="5530006">p</span><span class="op" id="5530007">.</span><span class="ident" id="5530008">Pix</span><span class="op" id="5530011">[</span><span class="ident" id="5530012">i</span><span class="op" id="5530013">+</span><span class="num" id="5530014">7</span><span class="op" id="5530015">]</span><span class="op" id="5530016">)</span><span class="op" id="5530017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530020">}</span><br>
<span class="lineno"></span><span class="op" id="5530022">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5530025">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5530104">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5530128">func</span>&nbsp;<span class="op" id="5530133">(</span><span class="ident" id="5530134">p</span>&nbsp;<span class="op" id="5530136">*</span><span class="ident" id="5530137">NRGBA64</span><span class="op" id="5530144">)</span>&nbsp;<span class="ident" id="5530146">PixOffset</span><span class="op" id="5530155">(</span><span class="ident" id="5530156">x</span><span class="op" id="5530157">,</span>&nbsp;<span class="ident" id="5530159">y</span>&nbsp;<span class="builtintype" id="5530161">int</span><span class="op" id="5530164">)</span>&nbsp;<span class="builtintype" id="5530166">int</span>&nbsp;<span class="op" id="5530170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530173">return</span>&nbsp;<span class="op" id="5530180">(</span><span class="ident" id="5530181">y</span><span class="op" id="5530182">-</span><span class="ident" id="5530183">p</span><span class="op" id="5530184">.</span><span class="ident" id="5530185">Rect</span><span class="op" id="5530189">.</span><span class="ident" id="5530190">Min</span><span class="op" id="5530193">.</span><span class="ident" id="5530194">Y</span><span class="op" id="5530195">)</span><span class="op" id="5530196">*</span><span class="ident" id="5530197">p</span><span class="op" id="5530198">.</span><span class="ident" id="5530199">Stride</span>&nbsp;<span class="op" id="5530206">+</span>&nbsp;<span class="op" id="5530208">(</span><span class="ident" id="5530209">x</span><span class="op" id="5530210">-</span><span class="ident" id="5530211">p</span><span class="op" id="5530212">.</span><span class="ident" id="5530213">Rect</span><span class="op" id="5530217">.</span><span class="ident" id="5530218">Min</span><span class="op" id="5530221">.</span><span class="ident" id="5530222">X</span><span class="op" id="5530223">)</span><span class="op" id="5530224">*</span><span class="num" id="5530225">8</span><br>
<span class="lineno">405</span><span class="op" id="5530227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530230">func</span>&nbsp;<span class="op" id="5530235">(</span><span class="ident" id="5530236">p</span>&nbsp;<span class="op" id="5530238">*</span><span class="ident" id="5530239">NRGBA64</span><span class="op" id="5530246">)</span>&nbsp;<span class="ident" id="5530248">Set</span><span class="op" id="5530251">(</span><span class="ident" id="5530252">x</span><span class="op" id="5530253">,</span>&nbsp;<span class="ident" id="5530255">y</span>&nbsp;<span class="builtintype" id="5530257">int</span><span class="op" id="5530260">,</span>&nbsp;<span class="ident" id="5530262">c</span>&nbsp;<span class="ident" id="5530264">color</span><span class="op" id="5530269">.</span><span class="ident" id="5530270">Color</span><span class="op" id="5530275">)</span>&nbsp;<span class="op" id="5530277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530280">if</span>&nbsp;<span class="op" id="5530283">!</span><span class="op" id="5530284">(</span><span class="ident" id="5530285">Point</span><span class="op" id="5530290">{</span><span class="ident" id="5530291">x</span><span class="op" id="5530292">,</span>&nbsp;<span class="ident" id="5530294">y</span><span class="op" id="5530295">}</span><span class="op" id="5530296">.</span><span class="ident" id="5530297">In</span><span class="op" id="5530299">(</span><span class="ident" id="5530300">p</span><span class="op" id="5530301">.</span><span class="ident" id="5530302">Rect</span><span class="op" id="5530306">)</span><span class="op" id="5530307">)</span>&nbsp;<span class="op" id="5530309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530313">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530324">i</span>&nbsp;<span class="op" id="5530326">:=</span>&nbsp;<span class="ident" id="5530329">p</span><span class="op" id="5530330">.</span><span class="ident" id="5530331">PixOffset</span><span class="op" id="5530340">(</span><span class="ident" id="5530341">x</span><span class="op" id="5530342">,</span>&nbsp;<span class="ident" id="5530344">y</span><span class="op" id="5530345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530348">c1</span>&nbsp;<span class="op" id="5530351">:=</span>&nbsp;<span class="ident" id="5530354">color</span><span class="op" id="5530359">.</span><span class="ident" id="5530360">NRGBA64Model</span><span class="op" id="5530372">.</span><span class="ident" id="5530373">Convert</span><span class="op" id="5530380">(</span><span class="ident" id="5530381">c</span><span class="op" id="5530382">)</span><span class="op" id="5530383">.</span><span class="op" id="5530384">(</span><span class="ident" id="5530385">color</span><span class="op" id="5530390">.</span><span class="ident" id="5530391">NRGBA64</span><span class="op" id="5530398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530401">p</span><span class="op" id="5530402">.</span><span class="ident" id="5530403">Pix</span><span class="op" id="5530406">[</span><span class="ident" id="5530407">i</span><span class="op" id="5530408">+</span><span class="num" id="5530409">0</span><span class="op" id="5530410">]</span>&nbsp;<span class="op" id="5530412">=</span>&nbsp;<span class="builtintype" id="5530414">uint8</span><span class="op" id="5530419">(</span><span class="ident" id="5530420">c1</span><span class="op" id="5530422">.</span><span class="ident" id="5530423">R</span>&nbsp;<span class="op" id="5530425">&gt;&gt;</span>&nbsp;<span class="num" id="5530428">8</span><span class="op" id="5530429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530432">p</span><span class="op" id="5530433">.</span><span class="ident" id="5530434">Pix</span><span class="op" id="5530437">[</span><span class="ident" id="5530438">i</span><span class="op" id="5530439">+</span><span class="num" id="5530440">1</span><span class="op" id="5530441">]</span>&nbsp;<span class="op" id="5530443">=</span>&nbsp;<span class="builtintype" id="5530445">uint8</span><span class="op" id="5530450">(</span><span class="ident" id="5530451">c1</span><span class="op" id="5530453">.</span><span class="ident" id="5530454">R</span><span class="op" id="5530455">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530458">p</span><span class="op" id="5530459">.</span><span class="ident" id="5530460">Pix</span><span class="op" id="5530463">[</span><span class="ident" id="5530464">i</span><span class="op" id="5530465">+</span><span class="num" id="5530466">2</span><span class="op" id="5530467">]</span>&nbsp;<span class="op" id="5530469">=</span>&nbsp;<span class="builtintype" id="5530471">uint8</span><span class="op" id="5530476">(</span><span class="ident" id="5530477">c1</span><span class="op" id="5530479">.</span><span class="ident" id="5530480">G</span>&nbsp;<span class="op" id="5530482">&gt;&gt;</span>&nbsp;<span class="num" id="5530485">8</span><span class="op" id="5530486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530489">p</span><span class="op" id="5530490">.</span><span class="ident" id="5530491">Pix</span><span class="op" id="5530494">[</span><span class="ident" id="5530495">i</span><span class="op" id="5530496">+</span><span class="num" id="5530497">3</span><span class="op" id="5530498">]</span>&nbsp;<span class="op" id="5530500">=</span>&nbsp;<span class="builtintype" id="5530502">uint8</span><span class="op" id="5530507">(</span><span class="ident" id="5530508">c1</span><span class="op" id="5530510">.</span><span class="ident" id="5530511">G</span><span class="op" id="5530512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530515">p</span><span class="op" id="5530516">.</span><span class="ident" id="5530517">Pix</span><span class="op" id="5530520">[</span><span class="ident" id="5530521">i</span><span class="op" id="5530522">+</span><span class="num" id="5530523">4</span><span class="op" id="5530524">]</span>&nbsp;<span class="op" id="5530526">=</span>&nbsp;<span class="builtintype" id="5530528">uint8</span><span class="op" id="5530533">(</span><span class="ident" id="5530534">c1</span><span class="op" id="5530536">.</span><span class="ident" id="5530537">B</span>&nbsp;<span class="op" id="5530539">&gt;&gt;</span>&nbsp;<span class="num" id="5530542">8</span><span class="op" id="5530543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530546">p</span><span class="op" id="5530547">.</span><span class="ident" id="5530548">Pix</span><span class="op" id="5530551">[</span><span class="ident" id="5530552">i</span><span class="op" id="5530553">+</span><span class="num" id="5530554">5</span><span class="op" id="5530555">]</span>&nbsp;<span class="op" id="5530557">=</span>&nbsp;<span class="builtintype" id="5530559">uint8</span><span class="op" id="5530564">(</span><span class="ident" id="5530565">c1</span><span class="op" id="5530567">.</span><span class="ident" id="5530568">B</span><span class="op" id="5530569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530572">p</span><span class="op" id="5530573">.</span><span class="ident" id="5530574">Pix</span><span class="op" id="5530577">[</span><span class="ident" id="5530578">i</span><span class="op" id="5530579">+</span><span class="num" id="5530580">6</span><span class="op" id="5530581">]</span>&nbsp;<span class="op" id="5530583">=</span>&nbsp;<span class="builtintype" id="5530585">uint8</span><span class="op" id="5530590">(</span><span class="ident" id="5530591">c1</span><span class="op" id="5530593">.</span><span class="ident" id="5530594">A</span>&nbsp;<span class="op" id="5530596">&gt;&gt;</span>&nbsp;<span class="num" id="5530599">8</span><span class="op" id="5530600">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530603">p</span><span class="op" id="5530604">.</span><span class="ident" id="5530605">Pix</span><span class="op" id="5530608">[</span><span class="ident" id="5530609">i</span><span class="op" id="5530610">+</span><span class="num" id="5530611">7</span><span class="op" id="5530612">]</span>&nbsp;<span class="op" id="5530614">=</span>&nbsp;<span class="builtintype" id="5530616">uint8</span><span class="op" id="5530621">(</span><span class="ident" id="5530622">c1</span><span class="op" id="5530624">.</span><span class="ident" id="5530625">A</span><span class="op" id="5530626">)</span><br>
<span class="lineno"></span><span class="op" id="5530628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530631">func</span>&nbsp;<span class="op" id="5530636">(</span><span class="ident" id="5530637">p</span>&nbsp;<span class="op" id="5530639">*</span><span class="ident" id="5530640">NRGBA64</span><span class="op" id="5530647">)</span>&nbsp;<span class="ident" id="5530649">SetNRGBA64</span><span class="op" id="5530659">(</span><span class="ident" id="5530660">x</span><span class="op" id="5530661">,</span>&nbsp;<span class="ident" id="5530663">y</span>&nbsp;<span class="builtintype" id="5530665">int</span><span class="op" id="5530668">,</span>&nbsp;<span class="ident" id="5530670">c</span>&nbsp;<span class="ident" id="5530672">color</span><span class="op" id="5530677">.</span><span class="ident" id="5530678">NRGBA64</span><span class="op" id="5530685">)</span>&nbsp;<span class="op" id="5530687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530690">if</span>&nbsp;<span class="op" id="5530693">!</span><span class="op" id="5530694">(</span><span class="ident" id="5530695">Point</span><span class="op" id="5530700">{</span><span class="ident" id="5530701">x</span><span class="op" id="5530702">,</span>&nbsp;<span class="ident" id="5530704">y</span><span class="op" id="5530705">}</span><span class="op" id="5530706">.</span><span class="ident" id="5530707">In</span><span class="op" id="5530709">(</span><span class="ident" id="5530710">p</span><span class="op" id="5530711">.</span><span class="ident" id="5530712">Rect</span><span class="op" id="5530716">)</span><span class="op" id="5530717">)</span>&nbsp;<span class="op" id="5530719">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530723">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530734">i</span>&nbsp;<span class="op" id="5530736">:=</span>&nbsp;<span class="ident" id="5530739">p</span><span class="op" id="5530740">.</span><span class="ident" id="5530741">PixOffset</span><span class="op" id="5530750">(</span><span class="ident" id="5530751">x</span><span class="op" id="5530752">,</span>&nbsp;<span class="ident" id="5530754">y</span><span class="op" id="5530755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530758">p</span><span class="op" id="5530759">.</span><span class="ident" id="5530760">Pix</span><span class="op" id="5530763">[</span><span class="ident" id="5530764">i</span><span class="op" id="5530765">+</span><span class="num" id="5530766">0</span><span class="op" id="5530767">]</span>&nbsp;<span class="op" id="5530769">=</span>&nbsp;<span class="builtintype" id="5530771">uint8</span><span class="op" id="5530776">(</span><span class="ident" id="5530777">c</span><span class="op" id="5530778">.</span><span class="ident" id="5530779">R</span>&nbsp;<span class="op" id="5530781">&gt;&gt;</span>&nbsp;<span class="num" id="5530784">8</span><span class="op" id="5530785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530788">p</span><span class="op" id="5530789">.</span><span class="ident" id="5530790">Pix</span><span class="op" id="5530793">[</span><span class="ident" id="5530794">i</span><span class="op" id="5530795">+</span><span class="num" id="5530796">1</span><span class="op" id="5530797">]</span>&nbsp;<span class="op" id="5530799">=</span>&nbsp;<span class="builtintype" id="5530801">uint8</span><span class="op" id="5530806">(</span><span class="ident" id="5530807">c</span><span class="op" id="5530808">.</span><span class="ident" id="5530809">R</span><span class="op" id="5530810">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530813">p</span><span class="op" id="5530814">.</span><span class="ident" id="5530815">Pix</span><span class="op" id="5530818">[</span><span class="ident" id="5530819">i</span><span class="op" id="5530820">+</span><span class="num" id="5530821">2</span><span class="op" id="5530822">]</span>&nbsp;<span class="op" id="5530824">=</span>&nbsp;<span class="builtintype" id="5530826">uint8</span><span class="op" id="5530831">(</span><span class="ident" id="5530832">c</span><span class="op" id="5530833">.</span><span class="ident" id="5530834">G</span>&nbsp;<span class="op" id="5530836">&gt;&gt;</span>&nbsp;<span class="num" id="5530839">8</span><span class="op" id="5530840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530843">p</span><span class="op" id="5530844">.</span><span class="ident" id="5530845">Pix</span><span class="op" id="5530848">[</span><span class="ident" id="5530849">i</span><span class="op" id="5530850">+</span><span class="num" id="5530851">3</span><span class="op" id="5530852">]</span>&nbsp;<span class="op" id="5530854">=</span>&nbsp;<span class="builtintype" id="5530856">uint8</span><span class="op" id="5530861">(</span><span class="ident" id="5530862">c</span><span class="op" id="5530863">.</span><span class="ident" id="5530864">G</span><span class="op" id="5530865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530868">p</span><span class="op" id="5530869">.</span><span class="ident" id="5530870">Pix</span><span class="op" id="5530873">[</span><span class="ident" id="5530874">i</span><span class="op" id="5530875">+</span><span class="num" id="5530876">4</span><span class="op" id="5530877">]</span>&nbsp;<span class="op" id="5530879">=</span>&nbsp;<span class="builtintype" id="5530881">uint8</span><span class="op" id="5530886">(</span><span class="ident" id="5530887">c</span><span class="op" id="5530888">.</span><span class="ident" id="5530889">B</span>&nbsp;<span class="op" id="5530891">&gt;&gt;</span>&nbsp;<span class="num" id="5530894">8</span><span class="op" id="5530895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530898">p</span><span class="op" id="5530899">.</span><span class="ident" id="5530900">Pix</span><span class="op" id="5530903">[</span><span class="ident" id="5530904">i</span><span class="op" id="5530905">+</span><span class="num" id="5530906">5</span><span class="op" id="5530907">]</span>&nbsp;<span class="op" id="5530909">=</span>&nbsp;<span class="builtintype" id="5530911">uint8</span><span class="op" id="5530916">(</span><span class="ident" id="5530917">c</span><span class="op" id="5530918">.</span><span class="ident" id="5530919">B</span><span class="op" id="5530920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530923">p</span><span class="op" id="5530924">.</span><span class="ident" id="5530925">Pix</span><span class="op" id="5530928">[</span><span class="ident" id="5530929">i</span><span class="op" id="5530930">+</span><span class="num" id="5530931">6</span><span class="op" id="5530932">]</span>&nbsp;<span class="op" id="5530934">=</span>&nbsp;<span class="builtintype" id="5530936">uint8</span><span class="op" id="5530941">(</span><span class="ident" id="5530942">c</span><span class="op" id="5530943">.</span><span class="ident" id="5530944">A</span>&nbsp;<span class="op" id="5530946">&gt;&gt;</span>&nbsp;<span class="num" id="5530949">8</span><span class="op" id="5530950">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530953">p</span><span class="op" id="5530954">.</span><span class="ident" id="5530955">Pix</span><span class="op" id="5530958">[</span><span class="ident" id="5530959">i</span><span class="op" id="5530960">+</span><span class="num" id="5530961">7</span><span class="op" id="5530962">]</span>&nbsp;<span class="op" id="5530964">=</span>&nbsp;<span class="builtintype" id="5530966">uint8</span><span class="op" id="5530971">(</span><span class="ident" id="5530972">c</span><span class="op" id="5530973">.</span><span class="ident" id="5530974">A</span><span class="op" id="5530975">)</span><br>
<span class="lineno"></span><span class="op" id="5530977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5530980">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5531057">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5531129">func</span>&nbsp;<span class="op" id="5531134">(</span><span class="ident" id="5531135">p</span>&nbsp;<span class="op" id="5531137">*</span><span class="ident" id="5531138">NRGBA64</span><span class="op" id="5531145">)</span>&nbsp;<span class="ident" id="5531147">SubImage</span><span class="op" id="5531155">(</span><span class="ident" id="5531156">r</span>&nbsp;<span class="ident" id="5531158">Rectangle</span><span class="op" id="5531167">)</span>&nbsp;<span class="ident" id="5531169">Image</span>&nbsp;<span class="op" id="5531175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531178">r</span>&nbsp;<span class="op" id="5531180">=</span>&nbsp;<span class="ident" id="5531182">r</span><span class="op" id="5531183">.</span><span class="ident" id="5531184">Intersect</span><span class="op" id="5531193">(</span><span class="ident" id="5531194">p</span><span class="op" id="5531195">.</span><span class="ident" id="5531196">Rect</span><span class="op" id="5531200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531203">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531284">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531366">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531416">if</span>&nbsp;<span class="ident" id="5531419">r</span><span class="op" id="5531420">.</span><span class="ident" id="5531421">Empty</span><span class="op" id="5531426">(</span><span class="op" id="5531427">)</span>&nbsp;<span class="op" id="5531429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531433">return</span>&nbsp;<span class="op" id="5531440">&amp;</span><span class="ident" id="5531441">NRGBA64</span><span class="op" id="5531448">{</span><span class="op" id="5531449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531455">i</span>&nbsp;<span class="op" id="5531457">:=</span>&nbsp;<span class="ident" id="5531460">p</span><span class="op" id="5531461">.</span><span class="ident" id="5531462">PixOffset</span><span class="op" id="5531471">(</span><span class="ident" id="5531472">r</span><span class="op" id="5531473">.</span><span class="ident" id="5531474">Min</span><span class="op" id="5531477">.</span><span class="ident" id="5531478">X</span><span class="op" id="5531479">,</span>&nbsp;<span class="ident" id="5531481">r</span><span class="op" id="5531482">.</span><span class="ident" id="5531483">Min</span><span class="op" id="5531486">.</span><span class="ident" id="5531487">Y</span><span class="op" id="5531488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531491">return</span>&nbsp;<span class="op" id="5531498">&amp;</span><span class="ident" id="5531499">NRGBA64</span><span class="op" id="5531506">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531510">Pix</span><span class="op" id="5531513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531518">p</span><span class="op" id="5531519">.</span><span class="ident" id="5531520">Pix</span><span class="op" id="5531523">[</span><span class="ident" id="5531524">i</span><span class="op" id="5531525">:</span><span class="op" id="5531526">]</span><span class="op" id="5531527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531531">Stride</span><span class="op" id="5531537">:</span>&nbsp;<span class="ident" id="5531539">p</span><span class="op" id="5531540">.</span><span class="ident" id="5531541">Stride</span><span class="op" id="5531547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531551">Rect</span><span class="op" id="5531555">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5531559">r</span><span class="op" id="5531560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531563">}</span><br>
<span class="lineno"></span><span class="op" id="5531565">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5531568">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5531641">func</span>&nbsp;<span class="op" id="5531646">(</span><span class="ident" id="5531647">p</span>&nbsp;<span class="op" id="5531649">*</span><span class="ident" id="5531650">NRGBA64</span><span class="op" id="5531657">)</span>&nbsp;<span class="ident" id="5531659">Opaque</span><span class="op" id="5531665">(</span><span class="op" id="5531666">)</span>&nbsp;<span class="builtintype" id="5531668">bool</span>&nbsp;<span class="op" id="5531673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531676">if</span>&nbsp;<span class="ident" id="5531679">p</span><span class="op" id="5531680">.</span><span class="ident" id="5531681">Rect</span><span class="op" id="5531685">.</span><span class="ident" id="5531686">Empty</span><span class="op" id="5531691">(</span><span class="op" id="5531692">)</span>&nbsp;<span class="op" id="5531694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531698">return</span>&nbsp;<span class="ident" id="5531705">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531714">i0</span><span class="op" id="5531716">,</span>&nbsp;<span class="ident" id="5531718">i1</span>&nbsp;<span class="op" id="5531721">:=</span>&nbsp;<span class="num" id="5531724">6</span><span class="op" id="5531725">,</span>&nbsp;<span class="ident" id="5531727">p</span><span class="op" id="5531728">.</span><span class="ident" id="5531729">Rect</span><span class="op" id="5531733">.</span><span class="ident" id="5531734">Dx</span><span class="op" id="5531736">(</span><span class="op" id="5531737">)</span><span class="op" id="5531738">*</span><span class="num" id="5531739">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531742">for</span>&nbsp;<span class="ident" id="5531746">y</span>&nbsp;<span class="op" id="5531748">:=</span>&nbsp;<span class="ident" id="5531751">p</span><span class="op" id="5531752">.</span><span class="ident" id="5531753">Rect</span><span class="op" id="5531757">.</span><span class="ident" id="5531758">Min</span><span class="op" id="5531761">.</span><span class="ident" id="5531762">Y</span><span class="op" id="5531763">;</span>&nbsp;<span class="ident" id="5531765">y</span>&nbsp;<span class="op" id="5531767">&lt;</span>&nbsp;<span class="ident" id="5531769">p</span><span class="op" id="5531770">.</span><span class="ident" id="5531771">Rect</span><span class="op" id="5531775">.</span><span class="ident" id="5531776">Max</span><span class="op" id="5531779">.</span><span class="ident" id="5531780">Y</span><span class="op" id="5531781">;</span>&nbsp;<span class="ident" id="5531783">y</span><span class="op" id="5531784">++</span>&nbsp;<span class="op" id="5531787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531791">for</span>&nbsp;<span class="ident" id="5531795">i</span>&nbsp;<span class="op" id="5531797">:=</span>&nbsp;<span class="ident" id="5531800">i0</span><span class="op" id="5531802">;</span>&nbsp;<span class="ident" id="5531804">i</span>&nbsp;<span class="op" id="5531806">&lt;</span>&nbsp;<span class="ident" id="5531808">i1</span><span class="op" id="5531810">;</span>&nbsp;<span class="ident" id="5531812">i</span>&nbsp;<span class="op" id="5531814">+=</span>&nbsp;<span class="num" id="5531817">8</span>&nbsp;<span class="op" id="5531819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531824">if</span>&nbsp;<span class="ident" id="5531827">p</span><span class="op" id="5531828">.</span><span class="ident" id="5531829">Pix</span><span class="op" id="5531832">[</span><span class="ident" id="5531833">i</span><span class="op" id="5531834">+</span><span class="num" id="5531835">0</span><span class="op" id="5531836">]</span>&nbsp;<span class="op" id="5531838">!=</span>&nbsp;<span class="num" id="5531841">0xff</span>&nbsp;<span class="op" id="5531846">||</span>&nbsp;<span class="ident" id="5531849">p</span><span class="op" id="5531850">.</span><span class="ident" id="5531851">Pix</span><span class="op" id="5531854">[</span><span class="ident" id="5531855">i</span><span class="op" id="5531856">+</span><span class="num" id="5531857">1</span><span class="op" id="5531858">]</span>&nbsp;<span class="op" id="5531860">!=</span>&nbsp;<span class="num" id="5531863">0xff</span>&nbsp;<span class="op" id="5531868">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531874">return</span>&nbsp;<span class="ident" id="5531881">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531898">i0</span>&nbsp;<span class="op" id="5531901">+=</span>&nbsp;<span class="ident" id="5531904">p</span><span class="op" id="5531905">.</span><span class="ident" id="5531906">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531915">i1</span>&nbsp;<span class="op" id="5531918">+=</span>&nbsp;<span class="ident" id="5531921">p</span><span class="op" id="5531922">.</span><span class="ident" id="5531923">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531934">return</span>&nbsp;<span class="ident" id="5531941">true</span><br>
<span class="lineno"></span><span class="op" id="5531946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5531949">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5532008">func</span>&nbsp;<span class="ident" id="5532013">NewNRGBA64</span><span class="op" id="5532023">(</span><span class="ident" id="5532024">r</span>&nbsp;<span class="ident" id="5532026">Rectangle</span><span class="op" id="5532035">)</span>&nbsp;<span class="op" id="5532037">*</span><span class="ident" id="5532038">NRGBA64</span>&nbsp;<span class="op" id="5532046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532049">w</span><span class="op" id="5532050">,</span>&nbsp;<span class="ident" id="5532052">h</span>&nbsp;<span class="op" id="5532054">:=</span>&nbsp;<span class="ident" id="5532057">r</span><span class="op" id="5532058">.</span><span class="ident" id="5532059">Dx</span><span class="op" id="5532061">(</span><span class="op" id="5532062">)</span><span class="op" id="5532063">,</span>&nbsp;<span class="ident" id="5532065">r</span><span class="op" id="5532066">.</span><span class="ident" id="5532067">Dy</span><span class="op" id="5532069">(</span><span class="op" id="5532070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532073">pix</span>&nbsp;<span class="op" id="5532077">:=</span>&nbsp;<span class="builtinfunc" id="5532080">make</span><span class="op" id="5532084">(</span><span class="op" id="5532085">[</span><span class="op" id="5532086">]</span><span class="builtintype" id="5532087">uint8</span><span class="op" id="5532092">,</span>&nbsp;<span class="num" id="5532094">8</span><span class="op" id="5532095">*</span><span class="ident" id="5532096">w</span><span class="op" id="5532097">*</span><span class="ident" id="5532098">h</span><span class="op" id="5532099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532102">return</span>&nbsp;<span class="op" id="5532109">&amp;</span><span class="ident" id="5532110">NRGBA64</span><span class="op" id="5532117">{</span><span class="ident" id="5532118">pix</span><span class="op" id="5532121">,</span>&nbsp;<span class="num" id="5532123">8</span>&nbsp;<span class="op" id="5532125">*</span>&nbsp;<span class="ident" id="5532127">w</span><span class="op" id="5532128">,</span>&nbsp;<span class="ident" id="5532130">r</span><span class="op" id="5532131">}</span><br>
<span class="lineno"></span><span class="op" id="5532133">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5532136">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5532211">type</span>&nbsp;<span class="ident" id="5532216">Alpha</span>&nbsp;<span class="keyword" id="5532222">struct</span>&nbsp;<span class="op" id="5532229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532232">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532296">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532364">Pix</span>&nbsp;<span class="op" id="5532368">[</span><span class="op" id="5532369">]</span><span class="builtintype" id="5532370">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532377">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532453">Stride</span>&nbsp;<span class="builtintype" id="5532460">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532465">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532497">Rect</span>&nbsp;<span class="ident" id="5532502">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5532512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532515">func</span>&nbsp;<span class="op" id="5532520">(</span><span class="ident" id="5532521">p</span>&nbsp;<span class="op" id="5532523">*</span><span class="ident" id="5532524">Alpha</span><span class="op" id="5532529">)</span>&nbsp;<span class="ident" id="5532531">ColorModel</span><span class="op" id="5532541">(</span><span class="op" id="5532542">)</span>&nbsp;<span class="ident" id="5532544">color</span><span class="op" id="5532549">.</span><span class="ident" id="5532550">Model</span>&nbsp;<span class="op" id="5532556">{</span>&nbsp;<span class="keyword" id="5532558">return</span>&nbsp;<span class="ident" id="5532565">color</span><span class="op" id="5532570">.</span><span class="ident" id="5532571">AlphaModel</span>&nbsp;<span class="op" id="5532582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532585">func</span>&nbsp;<span class="op" id="5532590">(</span><span class="ident" id="5532591">p</span>&nbsp;<span class="op" id="5532593">*</span><span class="ident" id="5532594">Alpha</span><span class="op" id="5532599">)</span>&nbsp;<span class="ident" id="5532601">Bounds</span><span class="op" id="5532607">(</span><span class="op" id="5532608">)</span>&nbsp;<span class="ident" id="5532610">Rectangle</span>&nbsp;<span class="op" id="5532620">{</span>&nbsp;<span class="keyword" id="5532622">return</span>&nbsp;<span class="ident" id="5532629">p</span><span class="op" id="5532630">.</span><span class="ident" id="5532631">Rect</span>&nbsp;<span class="op" id="5532636">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5532639">func</span>&nbsp;<span class="op" id="5532644">(</span><span class="ident" id="5532645">p</span>&nbsp;<span class="op" id="5532647">*</span><span class="ident" id="5532648">Alpha</span><span class="op" id="5532653">)</span>&nbsp;<span class="ident" id="5532655">At</span><span class="op" id="5532657">(</span><span class="ident" id="5532658">x</span><span class="op" id="5532659">,</span>&nbsp;<span class="ident" id="5532661">y</span>&nbsp;<span class="builtintype" id="5532663">int</span><span class="op" id="5532666">)</span>&nbsp;<span class="ident" id="5532668">color</span><span class="op" id="5532673">.</span><span class="ident" id="5532674">Color</span>&nbsp;<span class="op" id="5532680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532683">return</span>&nbsp;<span class="ident" id="5532690">p</span><span class="op" id="5532691">.</span><span class="ident" id="5532692">AlphaAt</span><span class="op" id="5532699">(</span><span class="ident" id="5532700">x</span><span class="op" id="5532701">,</span>&nbsp;<span class="ident" id="5532703">y</span><span class="op" id="5532704">)</span><br>
<span class="lineno"></span><span class="op" id="5532706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5532709">func</span>&nbsp;<span class="op" id="5532714">(</span><span class="ident" id="5532715">p</span>&nbsp;<span class="op" id="5532717">*</span><span class="ident" id="5532718">Alpha</span><span class="op" id="5532723">)</span>&nbsp;<span class="ident" id="5532725">AlphaAt</span><span class="op" id="5532732">(</span><span class="ident" id="5532733">x</span><span class="op" id="5532734">,</span>&nbsp;<span class="ident" id="5532736">y</span>&nbsp;<span class="builtintype" id="5532738">int</span><span class="op" id="5532741">)</span>&nbsp;<span class="ident" id="5532743">color</span><span class="op" id="5532748">.</span><span class="ident" id="5532749">Alpha</span>&nbsp;<span class="op" id="5532755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532758">if</span>&nbsp;<span class="op" id="5532761">!</span><span class="op" id="5532762">(</span><span class="ident" id="5532763">Point</span><span class="op" id="5532768">{</span><span class="ident" id="5532769">x</span><span class="op" id="5532770">,</span>&nbsp;<span class="ident" id="5532772">y</span><span class="op" id="5532773">}</span><span class="op" id="5532774">.</span><span class="ident" id="5532775">In</span><span class="op" id="5532777">(</span><span class="ident" id="5532778">p</span><span class="op" id="5532779">.</span><span class="ident" id="5532780">Rect</span><span class="op" id="5532784">)</span><span class="op" id="5532785">)</span>&nbsp;<span class="op" id="5532787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532791">return</span>&nbsp;<span class="ident" id="5532798">color</span><span class="op" id="5532803">.</span><span class="ident" id="5532804">Alpha</span><span class="op" id="5532809">{</span><span class="op" id="5532810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532816">i</span>&nbsp;<span class="op" id="5532818">:=</span>&nbsp;<span class="ident" id="5532821">p</span><span class="op" id="5532822">.</span><span class="ident" id="5532823">PixOffset</span><span class="op" id="5532832">(</span><span class="ident" id="5532833">x</span><span class="op" id="5532834">,</span>&nbsp;<span class="ident" id="5532836">y</span><span class="op" id="5532837">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532840">return</span>&nbsp;<span class="ident" id="5532847">color</span><span class="op" id="5532852">.</span><span class="ident" id="5532853">Alpha</span><span class="op" id="5532858">{</span><span class="ident" id="5532859">p</span><span class="op" id="5532860">.</span><span class="ident" id="5532861">Pix</span><span class="op" id="5532864">[</span><span class="ident" id="5532865">i</span><span class="op" id="5532866">]</span><span class="op" id="5532867">}</span><br>
<span class="lineno"></span><span class="op" id="5532869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532872">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5532951">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5532975">func</span>&nbsp;<span class="op" id="5532980">(</span><span class="ident" id="5532981">p</span>&nbsp;<span class="op" id="5532983">*</span><span class="ident" id="5532984">Alpha</span><span class="op" id="5532989">)</span>&nbsp;<span class="ident" id="5532991">PixOffset</span><span class="op" id="5533000">(</span><span class="ident" id="5533001">x</span><span class="op" id="5533002">,</span>&nbsp;<span class="ident" id="5533004">y</span>&nbsp;<span class="builtintype" id="5533006">int</span><span class="op" id="5533009">)</span>&nbsp;<span class="builtintype" id="5533011">int</span>&nbsp;<span class="op" id="5533015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533018">return</span>&nbsp;<span class="op" id="5533025">(</span><span class="ident" id="5533026">y</span><span class="op" id="5533027">-</span><span class="ident" id="5533028">p</span><span class="op" id="5533029">.</span><span class="ident" id="5533030">Rect</span><span class="op" id="5533034">.</span><span class="ident" id="5533035">Min</span><span class="op" id="5533038">.</span><span class="ident" id="5533039">Y</span><span class="op" id="5533040">)</span><span class="op" id="5533041">*</span><span class="ident" id="5533042">p</span><span class="op" id="5533043">.</span><span class="ident" id="5533044">Stride</span>&nbsp;<span class="op" id="5533051">+</span>&nbsp;<span class="op" id="5533053">(</span><span class="ident" id="5533054">x</span><span class="op" id="5533055">-</span><span class="ident" id="5533056">p</span><span class="op" id="5533057">.</span><span class="ident" id="5533058">Rect</span><span class="op" id="5533062">.</span><span class="ident" id="5533063">Min</span><span class="op" id="5533066">.</span><span class="ident" id="5533067">X</span><span class="op" id="5533068">)</span><span class="op" id="5533069">*</span><span class="num" id="5533070">1</span><br>
<span class="lineno"></span><span class="op" id="5533072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5533075">func</span>&nbsp;<span class="op" id="5533080">(</span><span class="ident" id="5533081">p</span>&nbsp;<span class="op" id="5533083">*</span><span class="ident" id="5533084">Alpha</span><span class="op" id="5533089">)</span>&nbsp;<span class="ident" id="5533091">Set</span><span class="op" id="5533094">(</span><span class="ident" id="5533095">x</span><span class="op" id="5533096">,</span>&nbsp;<span class="ident" id="5533098">y</span>&nbsp;<span class="builtintype" id="5533100">int</span><span class="op" id="5533103">,</span>&nbsp;<span class="ident" id="5533105">c</span>&nbsp;<span class="ident" id="5533107">color</span><span class="op" id="5533112">.</span><span class="ident" id="5533113">Color</span><span class="op" id="5533118">)</span>&nbsp;<span class="op" id="5533120">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533123">if</span>&nbsp;<span class="op" id="5533126">!</span><span class="op" id="5533127">(</span><span class="ident" id="5533128">Point</span><span class="op" id="5533133">{</span><span class="ident" id="5533134">x</span><span class="op" id="5533135">,</span>&nbsp;<span class="ident" id="5533137">y</span><span class="op" id="5533138">}</span><span class="op" id="5533139">.</span><span class="ident" id="5533140">In</span><span class="op" id="5533142">(</span><span class="ident" id="5533143">p</span><span class="op" id="5533144">.</span><span class="ident" id="5533145">Rect</span><span class="op" id="5533149">)</span><span class="op" id="5533150">)</span>&nbsp;<span class="op" id="5533152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533167">i</span>&nbsp;<span class="op" id="5533169">:=</span>&nbsp;<span class="ident" id="5533172">p</span><span class="op" id="5533173">.</span><span class="ident" id="5533174">PixOffset</span><span class="op" id="5533183">(</span><span class="ident" id="5533184">x</span><span class="op" id="5533185">,</span>&nbsp;<span class="ident" id="5533187">y</span><span class="op" id="5533188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533191">p</span><span class="op" id="5533192">.</span><span class="ident" id="5533193">Pix</span><span class="op" id="5533196">[</span><span class="ident" id="5533197">i</span><span class="op" id="5533198">]</span>&nbsp;<span class="op" id="5533200">=</span>&nbsp;<span class="ident" id="5533202">color</span><span class="op" id="5533207">.</span><span class="ident" id="5533208">AlphaModel</span><span class="op" id="5533218">.</span><span class="ident" id="5533219">Convert</span><span class="op" id="5533226">(</span><span class="ident" id="5533227">c</span><span class="op" id="5533228">)</span><span class="op" id="5533229">.</span><span class="op" id="5533230">(</span><span class="ident" id="5533231">color</span><span class="op" id="5533236">.</span><span class="ident" id="5533237">Alpha</span><span class="op" id="5533242">)</span><span class="op" id="5533243">.</span><span class="ident" id="5533244">A</span><br>
<span class="lineno">520</span><span class="op" id="5533246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5533249">func</span>&nbsp;<span class="op" id="5533254">(</span><span class="ident" id="5533255">p</span>&nbsp;<span class="op" id="5533257">*</span><span class="ident" id="5533258">Alpha</span><span class="op" id="5533263">)</span>&nbsp;<span class="ident" id="5533265">SetAlpha</span><span class="op" id="5533273">(</span><span class="ident" id="5533274">x</span><span class="op" id="5533275">,</span>&nbsp;<span class="ident" id="5533277">y</span>&nbsp;<span class="builtintype" id="5533279">int</span><span class="op" id="5533282">,</span>&nbsp;<span class="ident" id="5533284">c</span>&nbsp;<span class="ident" id="5533286">color</span><span class="op" id="5533291">.</span><span class="ident" id="5533292">Alpha</span><span class="op" id="5533297">)</span>&nbsp;<span class="op" id="5533299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533302">if</span>&nbsp;<span class="op" id="5533305">!</span><span class="op" id="5533306">(</span><span class="ident" id="5533307">Point</span><span class="op" id="5533312">{</span><span class="ident" id="5533313">x</span><span class="op" id="5533314">,</span>&nbsp;<span class="ident" id="5533316">y</span><span class="op" id="5533317">}</span><span class="op" id="5533318">.</span><span class="ident" id="5533319">In</span><span class="op" id="5533321">(</span><span class="ident" id="5533322">p</span><span class="op" id="5533323">.</span><span class="ident" id="5533324">Rect</span><span class="op" id="5533328">)</span><span class="op" id="5533329">)</span>&nbsp;<span class="op" id="5533331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533335">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533346">i</span>&nbsp;<span class="op" id="5533348">:=</span>&nbsp;<span class="ident" id="5533351">p</span><span class="op" id="5533352">.</span><span class="ident" id="5533353">PixOffset</span><span class="op" id="5533362">(</span><span class="ident" id="5533363">x</span><span class="op" id="5533364">,</span>&nbsp;<span class="ident" id="5533366">y</span><span class="op" id="5533367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533370">p</span><span class="op" id="5533371">.</span><span class="ident" id="5533372">Pix</span><span class="op" id="5533375">[</span><span class="ident" id="5533376">i</span><span class="op" id="5533377">]</span>&nbsp;<span class="op" id="5533379">=</span>&nbsp;<span class="ident" id="5533381">c</span><span class="op" id="5533382">.</span><span class="ident" id="5533383">A</span><br>
<span class="lineno"></span><span class="op" id="5533385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5533388">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5533465">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5533537">func</span>&nbsp;<span class="op" id="5533542">(</span><span class="ident" id="5533543">p</span>&nbsp;<span class="op" id="5533545">*</span><span class="ident" id="5533546">Alpha</span><span class="op" id="5533551">)</span>&nbsp;<span class="ident" id="5533553">SubImage</span><span class="op" id="5533561">(</span><span class="ident" id="5533562">r</span>&nbsp;<span class="ident" id="5533564">Rectangle</span><span class="op" id="5533573">)</span>&nbsp;<span class="ident" id="5533575">Image</span>&nbsp;<span class="op" id="5533581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533584">r</span>&nbsp;<span class="op" id="5533586">=</span>&nbsp;<span class="ident" id="5533588">r</span><span class="op" id="5533589">.</span><span class="ident" id="5533590">Intersect</span><span class="op" id="5533599">(</span><span class="ident" id="5533600">p</span><span class="op" id="5533601">.</span><span class="ident" id="5533602">Rect</span><span class="op" id="5533606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533609">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533690">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533772">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533822">if</span>&nbsp;<span class="ident" id="5533825">r</span><span class="op" id="5533826">.</span><span class="ident" id="5533827">Empty</span><span class="op" id="5533832">(</span><span class="op" id="5533833">)</span>&nbsp;<span class="op" id="5533835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533839">return</span>&nbsp;<span class="op" id="5533846">&amp;</span><span class="ident" id="5533847">Alpha</span><span class="op" id="5533852">{</span><span class="op" id="5533853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533856">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533859">i</span>&nbsp;<span class="op" id="5533861">:=</span>&nbsp;<span class="ident" id="5533864">p</span><span class="op" id="5533865">.</span><span class="ident" id="5533866">PixOffset</span><span class="op" id="5533875">(</span><span class="ident" id="5533876">r</span><span class="op" id="5533877">.</span><span class="ident" id="5533878">Min</span><span class="op" id="5533881">.</span><span class="ident" id="5533882">X</span><span class="op" id="5533883">,</span>&nbsp;<span class="ident" id="5533885">r</span><span class="op" id="5533886">.</span><span class="ident" id="5533887">Min</span><span class="op" id="5533890">.</span><span class="ident" id="5533891">Y</span><span class="op" id="5533892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533895">return</span>&nbsp;<span class="op" id="5533902">&amp;</span><span class="ident" id="5533903">Alpha</span><span class="op" id="5533908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533912">Pix</span><span class="op" id="5533915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533920">p</span><span class="op" id="5533921">.</span><span class="ident" id="5533922">Pix</span><span class="op" id="5533925">[</span><span class="ident" id="5533926">i</span><span class="op" id="5533927">:</span><span class="op" id="5533928">]</span><span class="op" id="5533929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533933">Stride</span><span class="op" id="5533939">:</span>&nbsp;<span class="ident" id="5533941">p</span><span class="op" id="5533942">.</span><span class="ident" id="5533943">Stride</span><span class="op" id="5533949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533953">Rect</span><span class="op" id="5533957">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5533961">r</span><span class="op" id="5533962">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533965">}</span><br>
<span class="lineno"></span><span class="op" id="5533967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533970">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5534043">func</span>&nbsp;<span class="op" id="5534048">(</span><span class="ident" id="5534049">p</span>&nbsp;<span class="op" id="5534051">*</span><span class="ident" id="5534052">Alpha</span><span class="op" id="5534057">)</span>&nbsp;<span class="ident" id="5534059">Opaque</span><span class="op" id="5534065">(</span><span class="op" id="5534066">)</span>&nbsp;<span class="builtintype" id="5534068">bool</span>&nbsp;<span class="op" id="5534073">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534076">if</span>&nbsp;<span class="ident" id="5534079">p</span><span class="op" id="5534080">.</span><span class="ident" id="5534081">Rect</span><span class="op" id="5534085">.</span><span class="ident" id="5534086">Empty</span><span class="op" id="5534091">(</span><span class="op" id="5534092">)</span>&nbsp;<span class="op" id="5534094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534098">return</span>&nbsp;<span class="ident" id="5534105">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534114">i0</span><span class="op" id="5534116">,</span>&nbsp;<span class="ident" id="5534118">i1</span>&nbsp;<span class="op" id="5534121">:=</span>&nbsp;<span class="num" id="5534124">0</span><span class="op" id="5534125">,</span>&nbsp;<span class="ident" id="5534127">p</span><span class="op" id="5534128">.</span><span class="ident" id="5534129">Rect</span><span class="op" id="5534133">.</span><span class="ident" id="5534134">Dx</span><span class="op" id="5534136">(</span><span class="op" id="5534137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534140">for</span>&nbsp;<span class="ident" id="5534144">y</span>&nbsp;<span class="op" id="5534146">:=</span>&nbsp;<span class="ident" id="5534149">p</span><span class="op" id="5534150">.</span><span class="ident" id="5534151">Rect</span><span class="op" id="5534155">.</span><span class="ident" id="5534156">Min</span><span class="op" id="5534159">.</span><span class="ident" id="5534160">Y</span><span class="op" id="5534161">;</span>&nbsp;<span class="ident" id="5534163">y</span>&nbsp;<span class="op" id="5534165">&lt;</span>&nbsp;<span class="ident" id="5534167">p</span><span class="op" id="5534168">.</span><span class="ident" id="5534169">Rect</span><span class="op" id="5534173">.</span><span class="ident" id="5534174">Max</span><span class="op" id="5534177">.</span><span class="ident" id="5534178">Y</span><span class="op" id="5534179">;</span>&nbsp;<span class="ident" id="5534181">y</span><span class="op" id="5534182">++</span>&nbsp;<span class="op" id="5534185">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534189">for</span>&nbsp;<span class="ident" id="5534193">i</span>&nbsp;<span class="op" id="5534195">:=</span>&nbsp;<span class="ident" id="5534198">i0</span><span class="op" id="5534200">;</span>&nbsp;<span class="ident" id="5534202">i</span>&nbsp;<span class="op" id="5534204">&lt;</span>&nbsp;<span class="ident" id="5534206">i1</span><span class="op" id="5534208">;</span>&nbsp;<span class="ident" id="5534210">i</span><span class="op" id="5534211">++</span>&nbsp;<span class="op" id="5534214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534219">if</span>&nbsp;<span class="ident" id="5534222">p</span><span class="op" id="5534223">.</span><span class="ident" id="5534224">Pix</span><span class="op" id="5534227">[</span><span class="ident" id="5534228">i</span><span class="op" id="5534229">]</span>&nbsp;<span class="op" id="5534231">!=</span>&nbsp;<span class="num" id="5534234">0xff</span>&nbsp;<span class="op" id="5534239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534245">return</span>&nbsp;<span class="ident" id="5534252">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534265">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534269">i0</span>&nbsp;<span class="op" id="5534272">+=</span>&nbsp;<span class="ident" id="5534275">p</span><span class="op" id="5534276">.</span><span class="ident" id="5534277">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534286">i1</span>&nbsp;<span class="op" id="5534289">+=</span>&nbsp;<span class="ident" id="5534292">p</span><span class="op" id="5534293">.</span><span class="ident" id="5534294">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534305">return</span>&nbsp;<span class="ident" id="5534312">true</span><br>
<span class="lineno"></span><span class="op" id="5534317">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5534320">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5534375">func</span>&nbsp;<span class="ident" id="5534380">NewAlpha</span><span class="op" id="5534388">(</span><span class="ident" id="5534389">r</span>&nbsp;<span class="ident" id="5534391">Rectangle</span><span class="op" id="5534400">)</span>&nbsp;<span class="op" id="5534402">*</span><span class="ident" id="5534403">Alpha</span>&nbsp;<span class="op" id="5534409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534412">w</span><span class="op" id="5534413">,</span>&nbsp;<span class="ident" id="5534415">h</span>&nbsp;<span class="op" id="5534417">:=</span>&nbsp;<span class="ident" id="5534420">r</span><span class="op" id="5534421">.</span><span class="ident" id="5534422">Dx</span><span class="op" id="5534424">(</span><span class="op" id="5534425">)</span><span class="op" id="5534426">,</span>&nbsp;<span class="ident" id="5534428">r</span><span class="op" id="5534429">.</span><span class="ident" id="5534430">Dy</span><span class="op" id="5534432">(</span><span class="op" id="5534433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534436">pix</span>&nbsp;<span class="op" id="5534440">:=</span>&nbsp;<span class="builtinfunc" id="5534443">make</span><span class="op" id="5534447">(</span><span class="op" id="5534448">[</span><span class="op" id="5534449">]</span><span class="builtintype" id="5534450">uint8</span><span class="op" id="5534455">,</span>&nbsp;<span class="num" id="5534457">1</span><span class="op" id="5534458">*</span><span class="ident" id="5534459">w</span><span class="op" id="5534460">*</span><span class="ident" id="5534461">h</span><span class="op" id="5534462">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534465">return</span>&nbsp;<span class="op" id="5534472">&amp;</span><span class="ident" id="5534473">Alpha</span><span class="op" id="5534478">{</span><span class="ident" id="5534479">pix</span><span class="op" id="5534482">,</span>&nbsp;<span class="num" id="5534484">1</span>&nbsp;<span class="op" id="5534486">*</span>&nbsp;<span class="ident" id="5534488">w</span><span class="op" id="5534489">,</span>&nbsp;<span class="ident" id="5534491">r</span><span class="op" id="5534492">}</span><br>
<span class="lineno"></span><span class="op" id="5534494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534497">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5534576">type</span>&nbsp;<span class="ident" id="5534581">Alpha16</span>&nbsp;<span class="keyword" id="5534589">struct</span>&nbsp;<span class="op" id="5534596">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534599">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534684">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534752">Pix</span>&nbsp;<span class="op" id="5534756">[</span><span class="op" id="5534757">]</span><span class="builtintype" id="5534758">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534765">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534841">Stride</span>&nbsp;<span class="builtintype" id="5534848">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534853">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534885">Rect</span>&nbsp;<span class="ident" id="5534890">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5534900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5534903">func</span>&nbsp;<span class="op" id="5534908">(</span><span class="ident" id="5534909">p</span>&nbsp;<span class="op" id="5534911">*</span><span class="ident" id="5534912">Alpha16</span><span class="op" id="5534919">)</span>&nbsp;<span class="ident" id="5534921">ColorModel</span><span class="op" id="5534931">(</span><span class="op" id="5534932">)</span>&nbsp;<span class="ident" id="5534934">color</span><span class="op" id="5534939">.</span><span class="ident" id="5534940">Model</span>&nbsp;<span class="op" id="5534946">{</span>&nbsp;<span class="keyword" id="5534948">return</span>&nbsp;<span class="ident" id="5534955">color</span><span class="op" id="5534960">.</span><span class="ident" id="5534961">Alpha16Model</span>&nbsp;<span class="op" id="5534974">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5534977">func</span>&nbsp;<span class="op" id="5534982">(</span><span class="ident" id="5534983">p</span>&nbsp;<span class="op" id="5534985">*</span><span class="ident" id="5534986">Alpha16</span><span class="op" id="5534993">)</span>&nbsp;<span class="ident" id="5534995">Bounds</span><span class="op" id="5535001">(</span><span class="op" id="5535002">)</span>&nbsp;<span class="ident" id="5535004">Rectangle</span>&nbsp;<span class="op" id="5535014">{</span>&nbsp;<span class="keyword" id="5535016">return</span>&nbsp;<span class="ident" id="5535023">p</span><span class="op" id="5535024">.</span><span class="ident" id="5535025">Rect</span>&nbsp;<span class="op" id="5535030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535033">func</span>&nbsp;<span class="op" id="5535038">(</span><span class="ident" id="5535039">p</span>&nbsp;<span class="op" id="5535041">*</span><span class="ident" id="5535042">Alpha16</span><span class="op" id="5535049">)</span>&nbsp;<span class="ident" id="5535051">At</span><span class="op" id="5535053">(</span><span class="ident" id="5535054">x</span><span class="op" id="5535055">,</span>&nbsp;<span class="ident" id="5535057">y</span>&nbsp;<span class="builtintype" id="5535059">int</span><span class="op" id="5535062">)</span>&nbsp;<span class="ident" id="5535064">color</span><span class="op" id="5535069">.</span><span class="ident" id="5535070">Color</span>&nbsp;<span class="op" id="5535076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535079">return</span>&nbsp;<span class="ident" id="5535086">p</span><span class="op" id="5535087">.</span><span class="ident" id="5535088">Alpha16At</span><span class="op" id="5535097">(</span><span class="ident" id="5535098">x</span><span class="op" id="5535099">,</span>&nbsp;<span class="ident" id="5535101">y</span><span class="op" id="5535102">)</span><br>
<span class="lineno">590</span><span class="op" id="5535104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535107">func</span>&nbsp;<span class="op" id="5535112">(</span><span class="ident" id="5535113">p</span>&nbsp;<span class="op" id="5535115">*</span><span class="ident" id="5535116">Alpha16</span><span class="op" id="5535123">)</span>&nbsp;<span class="ident" id="5535125">Alpha16At</span><span class="op" id="5535134">(</span><span class="ident" id="5535135">x</span><span class="op" id="5535136">,</span>&nbsp;<span class="ident" id="5535138">y</span>&nbsp;<span class="builtintype" id="5535140">int</span><span class="op" id="5535143">)</span>&nbsp;<span class="ident" id="5535145">color</span><span class="op" id="5535150">.</span><span class="ident" id="5535151">Alpha16</span>&nbsp;<span class="op" id="5535159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535162">if</span>&nbsp;<span class="op" id="5535165">!</span><span class="op" id="5535166">(</span><span class="ident" id="5535167">Point</span><span class="op" id="5535172">{</span><span class="ident" id="5535173">x</span><span class="op" id="5535174">,</span>&nbsp;<span class="ident" id="5535176">y</span><span class="op" id="5535177">}</span><span class="op" id="5535178">.</span><span class="ident" id="5535179">In</span><span class="op" id="5535181">(</span><span class="ident" id="5535182">p</span><span class="op" id="5535183">.</span><span class="ident" id="5535184">Rect</span><span class="op" id="5535188">)</span><span class="op" id="5535189">)</span>&nbsp;<span class="op" id="5535191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535195">return</span>&nbsp;<span class="ident" id="5535202">color</span><span class="op" id="5535207">.</span><span class="ident" id="5535208">Alpha16</span><span class="op" id="5535215">{</span><span class="op" id="5535216">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535222">i</span>&nbsp;<span class="op" id="5535224">:=</span>&nbsp;<span class="ident" id="5535227">p</span><span class="op" id="5535228">.</span><span class="ident" id="5535229">PixOffset</span><span class="op" id="5535238">(</span><span class="ident" id="5535239">x</span><span class="op" id="5535240">,</span>&nbsp;<span class="ident" id="5535242">y</span><span class="op" id="5535243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535246">return</span>&nbsp;<span class="ident" id="5535253">color</span><span class="op" id="5535258">.</span><span class="ident" id="5535259">Alpha16</span><span class="op" id="5535266">{</span><span class="builtintype" id="5535267">uint16</span><span class="op" id="5535273">(</span><span class="ident" id="5535274">p</span><span class="op" id="5535275">.</span><span class="ident" id="5535276">Pix</span><span class="op" id="5535279">[</span><span class="ident" id="5535280">i</span><span class="op" id="5535281">+</span><span class="num" id="5535282">0</span><span class="op" id="5535283">]</span><span class="op" id="5535284">)</span><span class="op" id="5535285">&lt;&lt;</span><span class="num" id="5535287">8</span>&nbsp;<span class="op" id="5535289">|</span>&nbsp;<span class="builtintype" id="5535291">uint16</span><span class="op" id="5535297">(</span><span class="ident" id="5535298">p</span><span class="op" id="5535299">.</span><span class="ident" id="5535300">Pix</span><span class="op" id="5535303">[</span><span class="ident" id="5535304">i</span><span class="op" id="5535305">+</span><span class="num" id="5535306">1</span><span class="op" id="5535307">]</span><span class="op" id="5535308">)</span><span class="op" id="5535309">}</span><br>
<span class="lineno"></span><span class="op" id="5535311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5535314">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5535393">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5535417">func</span>&nbsp;<span class="op" id="5535422">(</span><span class="ident" id="5535423">p</span>&nbsp;<span class="op" id="5535425">*</span><span class="ident" id="5535426">Alpha16</span><span class="op" id="5535433">)</span>&nbsp;<span class="ident" id="5535435">PixOffset</span><span class="op" id="5535444">(</span><span class="ident" id="5535445">x</span><span class="op" id="5535446">,</span>&nbsp;<span class="ident" id="5535448">y</span>&nbsp;<span class="builtintype" id="5535450">int</span><span class="op" id="5535453">)</span>&nbsp;<span class="builtintype" id="5535455">int</span>&nbsp;<span class="op" id="5535459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535462">return</span>&nbsp;<span class="op" id="5535469">(</span><span class="ident" id="5535470">y</span><span class="op" id="5535471">-</span><span class="ident" id="5535472">p</span><span class="op" id="5535473">.</span><span class="ident" id="5535474">Rect</span><span class="op" id="5535478">.</span><span class="ident" id="5535479">Min</span><span class="op" id="5535482">.</span><span class="ident" id="5535483">Y</span><span class="op" id="5535484">)</span><span class="op" id="5535485">*</span><span class="ident" id="5535486">p</span><span class="op" id="5535487">.</span><span class="ident" id="5535488">Stride</span>&nbsp;<span class="op" id="5535495">+</span>&nbsp;<span class="op" id="5535497">(</span><span class="ident" id="5535498">x</span><span class="op" id="5535499">-</span><span class="ident" id="5535500">p</span><span class="op" id="5535501">.</span><span class="ident" id="5535502">Rect</span><span class="op" id="5535506">.</span><span class="ident" id="5535507">Min</span><span class="op" id="5535510">.</span><span class="ident" id="5535511">X</span><span class="op" id="5535512">)</span><span class="op" id="5535513">*</span><span class="num" id="5535514">2</span><br>
<span class="lineno"></span><span class="op" id="5535516">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5535519">func</span>&nbsp;<span class="op" id="5535524">(</span><span class="ident" id="5535525">p</span>&nbsp;<span class="op" id="5535527">*</span><span class="ident" id="5535528">Alpha16</span><span class="op" id="5535535">)</span>&nbsp;<span class="ident" id="5535537">Set</span><span class="op" id="5535540">(</span><span class="ident" id="5535541">x</span><span class="op" id="5535542">,</span>&nbsp;<span class="ident" id="5535544">y</span>&nbsp;<span class="builtintype" id="5535546">int</span><span class="op" id="5535549">,</span>&nbsp;<span class="ident" id="5535551">c</span>&nbsp;<span class="ident" id="5535553">color</span><span class="op" id="5535558">.</span><span class="ident" id="5535559">Color</span><span class="op" id="5535564">)</span>&nbsp;<span class="op" id="5535566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535569">if</span>&nbsp;<span class="op" id="5535572">!</span><span class="op" id="5535573">(</span><span class="ident" id="5535574">Point</span><span class="op" id="5535579">{</span><span class="ident" id="5535580">x</span><span class="op" id="5535581">,</span>&nbsp;<span class="ident" id="5535583">y</span><span class="op" id="5535584">}</span><span class="op" id="5535585">.</span><span class="ident" id="5535586">In</span><span class="op" id="5535588">(</span><span class="ident" id="5535589">p</span><span class="op" id="5535590">.</span><span class="ident" id="5535591">Rect</span><span class="op" id="5535595">)</span><span class="op" id="5535596">)</span>&nbsp;<span class="op" id="5535598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535602">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535610">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535613">i</span>&nbsp;<span class="op" id="5535615">:=</span>&nbsp;<span class="ident" id="5535618">p</span><span class="op" id="5535619">.</span><span class="ident" id="5535620">PixOffset</span><span class="op" id="5535629">(</span><span class="ident" id="5535630">x</span><span class="op" id="5535631">,</span>&nbsp;<span class="ident" id="5535633">y</span><span class="op" id="5535634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535637">c1</span>&nbsp;<span class="op" id="5535640">:=</span>&nbsp;<span class="ident" id="5535643">color</span><span class="op" id="5535648">.</span><span class="ident" id="5535649">Alpha16Model</span><span class="op" id="5535661">.</span><span class="ident" id="5535662">Convert</span><span class="op" id="5535669">(</span><span class="ident" id="5535670">c</span><span class="op" id="5535671">)</span><span class="op" id="5535672">.</span><span class="op" id="5535673">(</span><span class="ident" id="5535674">color</span><span class="op" id="5535679">.</span><span class="ident" id="5535680">Alpha16</span><span class="op" id="5535687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535690">p</span><span class="op" id="5535691">.</span><span class="ident" id="5535692">Pix</span><span class="op" id="5535695">[</span><span class="ident" id="5535696">i</span><span class="op" id="5535697">+</span><span class="num" id="5535698">0</span><span class="op" id="5535699">]</span>&nbsp;<span class="op" id="5535701">=</span>&nbsp;<span class="builtintype" id="5535703">uint8</span><span class="op" id="5535708">(</span><span class="ident" id="5535709">c1</span><span class="op" id="5535711">.</span><span class="ident" id="5535712">A</span>&nbsp;<span class="op" id="5535714">&gt;&gt;</span>&nbsp;<span class="num" id="5535717">8</span><span class="op" id="5535718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535721">p</span><span class="op" id="5535722">.</span><span class="ident" id="5535723">Pix</span><span class="op" id="5535726">[</span><span class="ident" id="5535727">i</span><span class="op" id="5535728">+</span><span class="num" id="5535729">1</span><span class="op" id="5535730">]</span>&nbsp;<span class="op" id="5535732">=</span>&nbsp;<span class="builtintype" id="5535734">uint8</span><span class="op" id="5535739">(</span><span class="ident" id="5535740">c1</span><span class="op" id="5535742">.</span><span class="ident" id="5535743">A</span><span class="op" id="5535744">)</span><br>
<span class="lineno"></span><span class="op" id="5535746">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5535749">func</span>&nbsp;<span class="op" id="5535754">(</span><span class="ident" id="5535755">p</span>&nbsp;<span class="op" id="5535757">*</span><span class="ident" id="5535758">Alpha16</span><span class="op" id="5535765">)</span>&nbsp;<span class="ident" id="5535767">SetAlpha16</span><span class="op" id="5535777">(</span><span class="ident" id="5535778">x</span><span class="op" id="5535779">,</span>&nbsp;<span class="ident" id="5535781">y</span>&nbsp;<span class="builtintype" id="5535783">int</span><span class="op" id="5535786">,</span>&nbsp;<span class="ident" id="5535788">c</span>&nbsp;<span class="ident" id="5535790">color</span><span class="op" id="5535795">.</span><span class="ident" id="5535796">Alpha16</span><span class="op" id="5535803">)</span>&nbsp;<span class="op" id="5535805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535808">if</span>&nbsp;<span class="op" id="5535811">!</span><span class="op" id="5535812">(</span><span class="ident" id="5535813">Point</span><span class="op" id="5535818">{</span><span class="ident" id="5535819">x</span><span class="op" id="5535820">,</span>&nbsp;<span class="ident" id="5535822">y</span><span class="op" id="5535823">}</span><span class="op" id="5535824">.</span><span class="ident" id="5535825">In</span><span class="op" id="5535827">(</span><span class="ident" id="5535828">p</span><span class="op" id="5535829">.</span><span class="ident" id="5535830">Rect</span><span class="op" id="5535834">)</span><span class="op" id="5535835">)</span>&nbsp;<span class="op" id="5535837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535849">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535852">i</span>&nbsp;<span class="op" id="5535854">:=</span>&nbsp;<span class="ident" id="5535857">p</span><span class="op" id="5535858">.</span><span class="ident" id="5535859">PixOffset</span><span class="op" id="5535868">(</span><span class="ident" id="5535869">x</span><span class="op" id="5535870">,</span>&nbsp;<span class="ident" id="5535872">y</span><span class="op" id="5535873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535876">p</span><span class="op" id="5535877">.</span><span class="ident" id="5535878">Pix</span><span class="op" id="5535881">[</span><span class="ident" id="5535882">i</span><span class="op" id="5535883">+</span><span class="num" id="5535884">0</span><span class="op" id="5535885">]</span>&nbsp;<span class="op" id="5535887">=</span>&nbsp;<span class="builtintype" id="5535889">uint8</span><span class="op" id="5535894">(</span><span class="ident" id="5535895">c</span><span class="op" id="5535896">.</span><span class="ident" id="5535897">A</span>&nbsp;<span class="op" id="5535899">&gt;&gt;</span>&nbsp;<span class="num" id="5535902">8</span><span class="op" id="5535903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535906">p</span><span class="op" id="5535907">.</span><span class="ident" id="5535908">Pix</span><span class="op" id="5535911">[</span><span class="ident" id="5535912">i</span><span class="op" id="5535913">+</span><span class="num" id="5535914">1</span><span class="op" id="5535915">]</span>&nbsp;<span class="op" id="5535917">=</span>&nbsp;<span class="builtintype" id="5535919">uint8</span><span class="op" id="5535924">(</span><span class="ident" id="5535925">c</span><span class="op" id="5535926">.</span><span class="ident" id="5535927">A</span><span class="op" id="5535928">)</span><br>
<span class="lineno"></span><span class="op" id="5535930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5535933">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5536010">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5536082">func</span>&nbsp;<span class="op" id="5536087">(</span><span class="ident" id="5536088">p</span>&nbsp;<span class="op" id="5536090">*</span><span class="ident" id="5536091">Alpha16</span><span class="op" id="5536098">)</span>&nbsp;<span class="ident" id="5536100">SubImage</span><span class="op" id="5536108">(</span><span class="ident" id="5536109">r</span>&nbsp;<span class="ident" id="5536111">Rectangle</span><span class="op" id="5536120">)</span>&nbsp;<span class="ident" id="5536122">Image</span>&nbsp;<span class="op" id="5536128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536131">r</span>&nbsp;<span class="op" id="5536133">=</span>&nbsp;<span class="ident" id="5536135">r</span><span class="op" id="5536136">.</span><span class="ident" id="5536137">Intersect</span><span class="op" id="5536146">(</span><span class="ident" id="5536147">p</span><span class="op" id="5536148">.</span><span class="ident" id="5536149">Rect</span><span class="op" id="5536153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536156">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536237">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536319">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536369">if</span>&nbsp;<span class="ident" id="5536372">r</span><span class="op" id="5536373">.</span><span class="ident" id="5536374">Empty</span><span class="op" id="5536379">(</span><span class="op" id="5536380">)</span>&nbsp;<span class="op" id="5536382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536386">return</span>&nbsp;<span class="op" id="5536393">&amp;</span><span class="ident" id="5536394">Alpha16</span><span class="op" id="5536401">{</span><span class="op" id="5536402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536405">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536408">i</span>&nbsp;<span class="op" id="5536410">:=</span>&nbsp;<span class="ident" id="5536413">p</span><span class="op" id="5536414">.</span><span class="ident" id="5536415">PixOffset</span><span class="op" id="5536424">(</span><span class="ident" id="5536425">r</span><span class="op" id="5536426">.</span><span class="ident" id="5536427">Min</span><span class="op" id="5536430">.</span><span class="ident" id="5536431">X</span><span class="op" id="5536432">,</span>&nbsp;<span class="ident" id="5536434">r</span><span class="op" id="5536435">.</span><span class="ident" id="5536436">Min</span><span class="op" id="5536439">.</span><span class="ident" id="5536440">Y</span><span class="op" id="5536441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536444">return</span>&nbsp;<span class="op" id="5536451">&amp;</span><span class="ident" id="5536452">Alpha16</span><span class="op" id="5536459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536463">Pix</span><span class="op" id="5536466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536471">p</span><span class="op" id="5536472">.</span><span class="ident" id="5536473">Pix</span><span class="op" id="5536476">[</span><span class="ident" id="5536477">i</span><span class="op" id="5536478">:</span><span class="op" id="5536479">]</span><span class="op" id="5536480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536484">Stride</span><span class="op" id="5536490">:</span>&nbsp;<span class="ident" id="5536492">p</span><span class="op" id="5536493">.</span><span class="ident" id="5536494">Stride</span><span class="op" id="5536500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536504">Rect</span><span class="op" id="5536508">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5536512">r</span><span class="op" id="5536513">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536516">}</span><br>
<span class="lineno"></span><span class="op" id="5536518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536521">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5536594">func</span>&nbsp;<span class="op" id="5536599">(</span><span class="ident" id="5536600">p</span>&nbsp;<span class="op" id="5536602">*</span><span class="ident" id="5536603">Alpha16</span><span class="op" id="5536610">)</span>&nbsp;<span class="ident" id="5536612">Opaque</span><span class="op" id="5536618">(</span><span class="op" id="5536619">)</span>&nbsp;<span class="builtintype" id="5536621">bool</span>&nbsp;<span class="op" id="5536626">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536629">if</span>&nbsp;<span class="ident" id="5536632">p</span><span class="op" id="5536633">.</span><span class="ident" id="5536634">Rect</span><span class="op" id="5536638">.</span><span class="ident" id="5536639">Empty</span><span class="op" id="5536644">(</span><span class="op" id="5536645">)</span>&nbsp;<span class="op" id="5536647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536651">return</span>&nbsp;<span class="ident" id="5536658">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536667">i0</span><span class="op" id="5536669">,</span>&nbsp;<span class="ident" id="5536671">i1</span>&nbsp;<span class="op" id="5536674">:=</span>&nbsp;<span class="num" id="5536677">0</span><span class="op" id="5536678">,</span>&nbsp;<span class="ident" id="5536680">p</span><span class="op" id="5536681">.</span><span class="ident" id="5536682">Rect</span><span class="op" id="5536686">.</span><span class="ident" id="5536687">Dx</span><span class="op" id="5536689">(</span><span class="op" id="5536690">)</span><span class="op" id="5536691">*</span><span class="num" id="5536692">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536695">for</span>&nbsp;<span class="ident" id="5536699">y</span>&nbsp;<span class="op" id="5536701">:=</span>&nbsp;<span class="ident" id="5536704">p</span><span class="op" id="5536705">.</span><span class="ident" id="5536706">Rect</span><span class="op" id="5536710">.</span><span class="ident" id="5536711">Min</span><span class="op" id="5536714">.</span><span class="ident" id="5536715">Y</span><span class="op" id="5536716">;</span>&nbsp;<span class="ident" id="5536718">y</span>&nbsp;<span class="op" id="5536720">&lt;</span>&nbsp;<span class="ident" id="5536722">p</span><span class="op" id="5536723">.</span><span class="ident" id="5536724">Rect</span><span class="op" id="5536728">.</span><span class="ident" id="5536729">Max</span><span class="op" id="5536732">.</span><span class="ident" id="5536733">Y</span><span class="op" id="5536734">;</span>&nbsp;<span class="ident" id="5536736">y</span><span class="op" id="5536737">++</span>&nbsp;<span class="op" id="5536740">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536744">for</span>&nbsp;<span class="ident" id="5536748">i</span>&nbsp;<span class="op" id="5536750">:=</span>&nbsp;<span class="ident" id="5536753">i0</span><span class="op" id="5536755">;</span>&nbsp;<span class="ident" id="5536757">i</span>&nbsp;<span class="op" id="5536759">&lt;</span>&nbsp;<span class="ident" id="5536761">i1</span><span class="op" id="5536763">;</span>&nbsp;<span class="ident" id="5536765">i</span>&nbsp;<span class="op" id="5536767">+=</span>&nbsp;<span class="num" id="5536770">2</span>&nbsp;<span class="op" id="5536772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536777">if</span>&nbsp;<span class="ident" id="5536780">p</span><span class="op" id="5536781">.</span><span class="ident" id="5536782">Pix</span><span class="op" id="5536785">[</span><span class="ident" id="5536786">i</span><span class="op" id="5536787">+</span><span class="num" id="5536788">0</span><span class="op" id="5536789">]</span>&nbsp;<span class="op" id="5536791">!=</span>&nbsp;<span class="num" id="5536794">0xff</span>&nbsp;<span class="op" id="5536799">||</span>&nbsp;<span class="ident" id="5536802">p</span><span class="op" id="5536803">.</span><span class="ident" id="5536804">Pix</span><span class="op" id="5536807">[</span><span class="ident" id="5536808">i</span><span class="op" id="5536809">+</span><span class="num" id="5536810">1</span><span class="op" id="5536811">]</span>&nbsp;<span class="op" id="5536813">!=</span>&nbsp;<span class="num" id="5536816">0xff</span>&nbsp;<span class="op" id="5536821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536827">return</span>&nbsp;<span class="ident" id="5536834">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536847">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536851">i0</span>&nbsp;<span class="op" id="5536854">+=</span>&nbsp;<span class="ident" id="5536857">p</span><span class="op" id="5536858">.</span><span class="ident" id="5536859">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536868">i1</span>&nbsp;<span class="op" id="5536871">+=</span>&nbsp;<span class="ident" id="5536874">p</span><span class="op" id="5536875">.</span><span class="ident" id="5536876">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536887">return</span>&nbsp;<span class="ident" id="5536894">true</span><br>
<span class="lineno"></span><span class="op" id="5536899">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5536902">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5536961">func</span>&nbsp;<span class="ident" id="5536966">NewAlpha16</span><span class="op" id="5536976">(</span><span class="ident" id="5536977">r</span>&nbsp;<span class="ident" id="5536979">Rectangle</span><span class="op" id="5536988">)</span>&nbsp;<span class="op" id="5536990">*</span><span class="ident" id="5536991">Alpha16</span>&nbsp;<span class="op" id="5536999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537002">w</span><span class="op" id="5537003">,</span>&nbsp;<span class="ident" id="5537005">h</span>&nbsp;<span class="op" id="5537007">:=</span>&nbsp;<span class="ident" id="5537010">r</span><span class="op" id="5537011">.</span><span class="ident" id="5537012">Dx</span><span class="op" id="5537014">(</span><span class="op" id="5537015">)</span><span class="op" id="5537016">,</span>&nbsp;<span class="ident" id="5537018">r</span><span class="op" id="5537019">.</span><span class="ident" id="5537020">Dy</span><span class="op" id="5537022">(</span><span class="op" id="5537023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537026">pix</span>&nbsp;<span class="op" id="5537030">:=</span>&nbsp;<span class="builtinfunc" id="5537033">make</span><span class="op" id="5537037">(</span><span class="op" id="5537038">[</span><span class="op" id="5537039">]</span><span class="builtintype" id="5537040">uint8</span><span class="op" id="5537045">,</span>&nbsp;<span class="num" id="5537047">2</span><span class="op" id="5537048">*</span><span class="ident" id="5537049">w</span><span class="op" id="5537050">*</span><span class="ident" id="5537051">h</span><span class="op" id="5537052">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537055">return</span>&nbsp;<span class="op" id="5537062">&amp;</span><span class="ident" id="5537063">Alpha16</span><span class="op" id="5537070">{</span><span class="ident" id="5537071">pix</span><span class="op" id="5537074">,</span>&nbsp;<span class="num" id="5537076">2</span>&nbsp;<span class="op" id="5537078">*</span>&nbsp;<span class="ident" id="5537080">w</span><span class="op" id="5537081">,</span>&nbsp;<span class="ident" id="5537083">r</span><span class="op" id="5537084">}</span><br>
<span class="lineno"></span><span class="op" id="5537086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5537089">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5537162">type</span>&nbsp;<span class="ident" id="5537167">Gray</span>&nbsp;<span class="keyword" id="5537172">struct</span>&nbsp;<span class="op" id="5537179">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537182">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537245">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537313">Pix</span>&nbsp;<span class="op" id="5537317">[</span><span class="op" id="5537318">]</span><span class="builtintype" id="5537319">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537326">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537402">Stride</span>&nbsp;<span class="builtintype" id="5537409">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537414">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537446">Rect</span>&nbsp;<span class="ident" id="5537451">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5537461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537464">func</span>&nbsp;<span class="op" id="5537469">(</span><span class="ident" id="5537470">p</span>&nbsp;<span class="op" id="5537472">*</span><span class="ident" id="5537473">Gray</span><span class="op" id="5537477">)</span>&nbsp;<span class="ident" id="5537479">ColorModel</span><span class="op" id="5537489">(</span><span class="op" id="5537490">)</span>&nbsp;<span class="ident" id="5537492">color</span><span class="op" id="5537497">.</span><span class="ident" id="5537498">Model</span>&nbsp;<span class="op" id="5537504">{</span>&nbsp;<span class="keyword" id="5537506">return</span>&nbsp;<span class="ident" id="5537513">color</span><span class="op" id="5537518">.</span><span class="ident" id="5537519">GrayModel</span>&nbsp;<span class="op" id="5537529">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5537532">func</span>&nbsp;<span class="op" id="5537537">(</span><span class="ident" id="5537538">p</span>&nbsp;<span class="op" id="5537540">*</span><span class="ident" id="5537541">Gray</span><span class="op" id="5537545">)</span>&nbsp;<span class="ident" id="5537547">Bounds</span><span class="op" id="5537553">(</span><span class="op" id="5537554">)</span>&nbsp;<span class="ident" id="5537556">Rectangle</span>&nbsp;<span class="op" id="5537566">{</span>&nbsp;<span class="keyword" id="5537568">return</span>&nbsp;<span class="ident" id="5537575">p</span><span class="op" id="5537576">.</span><span class="ident" id="5537577">Rect</span>&nbsp;<span class="op" id="5537582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537585">func</span>&nbsp;<span class="op" id="5537590">(</span><span class="ident" id="5537591">p</span>&nbsp;<span class="op" id="5537593">*</span><span class="ident" id="5537594">Gray</span><span class="op" id="5537598">)</span>&nbsp;<span class="ident" id="5537600">At</span><span class="op" id="5537602">(</span><span class="ident" id="5537603">x</span><span class="op" id="5537604">,</span>&nbsp;<span class="ident" id="5537606">y</span>&nbsp;<span class="builtintype" id="5537608">int</span><span class="op" id="5537611">)</span>&nbsp;<span class="ident" id="5537613">color</span><span class="op" id="5537618">.</span><span class="ident" id="5537619">Color</span>&nbsp;<span class="op" id="5537625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537628">return</span>&nbsp;<span class="ident" id="5537635">p</span><span class="op" id="5537636">.</span><span class="ident" id="5537637">GrayAt</span><span class="op" id="5537643">(</span><span class="ident" id="5537644">x</span><span class="op" id="5537645">,</span>&nbsp;<span class="ident" id="5537647">y</span><span class="op" id="5537648">)</span><br>
<span class="lineno">685</span><span class="op" id="5537650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537653">func</span>&nbsp;<span class="op" id="5537658">(</span><span class="ident" id="5537659">p</span>&nbsp;<span class="op" id="5537661">*</span><span class="ident" id="5537662">Gray</span><span class="op" id="5537666">)</span>&nbsp;<span class="ident" id="5537668">GrayAt</span><span class="op" id="5537674">(</span><span class="ident" id="5537675">x</span><span class="op" id="5537676">,</span>&nbsp;<span class="ident" id="5537678">y</span>&nbsp;<span class="builtintype" id="5537680">int</span><span class="op" id="5537683">)</span>&nbsp;<span class="ident" id="5537685">color</span><span class="op" id="5537690">.</span><span class="ident" id="5537691">Gray</span>&nbsp;<span class="op" id="5537696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537699">if</span>&nbsp;<span class="op" id="5537702">!</span><span class="op" id="5537703">(</span><span class="ident" id="5537704">Point</span><span class="op" id="5537709">{</span><span class="ident" id="5537710">x</span><span class="op" id="5537711">,</span>&nbsp;<span class="ident" id="5537713">y</span><span class="op" id="5537714">}</span><span class="op" id="5537715">.</span><span class="ident" id="5537716">In</span><span class="op" id="5537718">(</span><span class="ident" id="5537719">p</span><span class="op" id="5537720">.</span><span class="ident" id="5537721">Rect</span><span class="op" id="5537725">)</span><span class="op" id="5537726">)</span>&nbsp;<span class="op" id="5537728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537732">return</span>&nbsp;<span class="ident" id="5537739">color</span><span class="op" id="5537744">.</span><span class="ident" id="5537745">Gray</span><span class="op" id="5537749">{</span><span class="op" id="5537750">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537756">i</span>&nbsp;<span class="op" id="5537758">:=</span>&nbsp;<span class="ident" id="5537761">p</span><span class="op" id="5537762">.</span><span class="ident" id="5537763">PixOffset</span><span class="op" id="5537772">(</span><span class="ident" id="5537773">x</span><span class="op" id="5537774">,</span>&nbsp;<span class="ident" id="5537776">y</span><span class="op" id="5537777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537780">return</span>&nbsp;<span class="ident" id="5537787">color</span><span class="op" id="5537792">.</span><span class="ident" id="5537793">Gray</span><span class="op" id="5537797">{</span><span class="ident" id="5537798">p</span><span class="op" id="5537799">.</span><span class="ident" id="5537800">Pix</span><span class="op" id="5537803">[</span><span class="ident" id="5537804">i</span><span class="op" id="5537805">]</span><span class="op" id="5537806">}</span><br>
<span class="lineno"></span><span class="op" id="5537808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5537811">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5537890">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5537914">func</span>&nbsp;<span class="op" id="5537919">(</span><span class="ident" id="5537920">p</span>&nbsp;<span class="op" id="5537922">*</span><span class="ident" id="5537923">Gray</span><span class="op" id="5537927">)</span>&nbsp;<span class="ident" id="5537929">PixOffset</span><span class="op" id="5537938">(</span><span class="ident" id="5537939">x</span><span class="op" id="5537940">,</span>&nbsp;<span class="ident" id="5537942">y</span>&nbsp;<span class="builtintype" id="5537944">int</span><span class="op" id="5537947">)</span>&nbsp;<span class="builtintype" id="5537949">int</span>&nbsp;<span class="op" id="5537953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537956">return</span>&nbsp;<span class="op" id="5537963">(</span><span class="ident" id="5537964">y</span><span class="op" id="5537965">-</span><span class="ident" id="5537966">p</span><span class="op" id="5537967">.</span><span class="ident" id="5537968">Rect</span><span class="op" id="5537972">.</span><span class="ident" id="5537973">Min</span><span class="op" id="5537976">.</span><span class="ident" id="5537977">Y</span><span class="op" id="5537978">)</span><span class="op" id="5537979">*</span><span class="ident" id="5537980">p</span><span class="op" id="5537981">.</span><span class="ident" id="5537982">Stride</span>&nbsp;<span class="op" id="5537989">+</span>&nbsp;<span class="op" id="5537991">(</span><span class="ident" id="5537992">x</span><span class="op" id="5537993">-</span><span class="ident" id="5537994">p</span><span class="op" id="5537995">.</span><span class="ident" id="5537996">Rect</span><span class="op" id="5538000">.</span><span class="ident" id="5538001">Min</span><span class="op" id="5538004">.</span><span class="ident" id="5538005">X</span><span class="op" id="5538006">)</span><span class="op" id="5538007">*</span><span class="num" id="5538008">1</span><br>
<span class="lineno"></span><span class="op" id="5538010">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5538013">func</span>&nbsp;<span class="op" id="5538018">(</span><span class="ident" id="5538019">p</span>&nbsp;<span class="op" id="5538021">*</span><span class="ident" id="5538022">Gray</span><span class="op" id="5538026">)</span>&nbsp;<span class="ident" id="5538028">Set</span><span class="op" id="5538031">(</span><span class="ident" id="5538032">x</span><span class="op" id="5538033">,</span>&nbsp;<span class="ident" id="5538035">y</span>&nbsp;<span class="builtintype" id="5538037">int</span><span class="op" id="5538040">,</span>&nbsp;<span class="ident" id="5538042">c</span>&nbsp;<span class="ident" id="5538044">color</span><span class="op" id="5538049">.</span><span class="ident" id="5538050">Color</span><span class="op" id="5538055">)</span>&nbsp;<span class="op" id="5538057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538060">if</span>&nbsp;<span class="op" id="5538063">!</span><span class="op" id="5538064">(</span><span class="ident" id="5538065">Point</span><span class="op" id="5538070">{</span><span class="ident" id="5538071">x</span><span class="op" id="5538072">,</span>&nbsp;<span class="ident" id="5538074">y</span><span class="op" id="5538075">}</span><span class="op" id="5538076">.</span><span class="ident" id="5538077">In</span><span class="op" id="5538079">(</span><span class="ident" id="5538080">p</span><span class="op" id="5538081">.</span><span class="ident" id="5538082">Rect</span><span class="op" id="5538086">)</span><span class="op" id="5538087">)</span>&nbsp;<span class="op" id="5538089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538101">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538104">i</span>&nbsp;<span class="op" id="5538106">:=</span>&nbsp;<span class="ident" id="5538109">p</span><span class="op" id="5538110">.</span><span class="ident" id="5538111">PixOffset</span><span class="op" id="5538120">(</span><span class="ident" id="5538121">x</span><span class="op" id="5538122">,</span>&nbsp;<span class="ident" id="5538124">y</span><span class="op" id="5538125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538128">p</span><span class="op" id="5538129">.</span><span class="ident" id="5538130">Pix</span><span class="op" id="5538133">[</span><span class="ident" id="5538134">i</span><span class="op" id="5538135">]</span>&nbsp;<span class="op" id="5538137">=</span>&nbsp;<span class="ident" id="5538139">color</span><span class="op" id="5538144">.</span><span class="ident" id="5538145">GrayModel</span><span class="op" id="5538154">.</span><span class="ident" id="5538155">Convert</span><span class="op" id="5538162">(</span><span class="ident" id="5538163">c</span><span class="op" id="5538164">)</span><span class="op" id="5538165">.</span><span class="op" id="5538166">(</span><span class="ident" id="5538167">color</span><span class="op" id="5538172">.</span><span class="ident" id="5538173">Gray</span><span class="op" id="5538177">)</span><span class="op" id="5538178">.</span><span class="ident" id="5538179">Y</span><br>
<span class="lineno"></span><span class="op" id="5538181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538184">func</span>&nbsp;<span class="op" id="5538189">(</span><span class="ident" id="5538190">p</span>&nbsp;<span class="op" id="5538192">*</span><span class="ident" id="5538193">Gray</span><span class="op" id="5538197">)</span>&nbsp;<span class="ident" id="5538199">SetGray</span><span class="op" id="5538206">(</span><span class="ident" id="5538207">x</span><span class="op" id="5538208">,</span>&nbsp;<span class="ident" id="5538210">y</span>&nbsp;<span class="builtintype" id="5538212">int</span><span class="op" id="5538215">,</span>&nbsp;<span class="ident" id="5538217">c</span>&nbsp;<span class="ident" id="5538219">color</span><span class="op" id="5538224">.</span><span class="ident" id="5538225">Gray</span><span class="op" id="5538229">)</span>&nbsp;<span class="op" id="5538231">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538234">if</span>&nbsp;<span class="op" id="5538237">!</span><span class="op" id="5538238">(</span><span class="ident" id="5538239">Point</span><span class="op" id="5538244">{</span><span class="ident" id="5538245">x</span><span class="op" id="5538246">,</span>&nbsp;<span class="ident" id="5538248">y</span><span class="op" id="5538249">}</span><span class="op" id="5538250">.</span><span class="ident" id="5538251">In</span><span class="op" id="5538253">(</span><span class="ident" id="5538254">p</span><span class="op" id="5538255">.</span><span class="ident" id="5538256">Rect</span><span class="op" id="5538260">)</span><span class="op" id="5538261">)</span>&nbsp;<span class="op" id="5538263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538267">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538278">i</span>&nbsp;<span class="op" id="5538280">:=</span>&nbsp;<span class="ident" id="5538283">p</span><span class="op" id="5538284">.</span><span class="ident" id="5538285">PixOffset</span><span class="op" id="5538294">(</span><span class="ident" id="5538295">x</span><span class="op" id="5538296">,</span>&nbsp;<span class="ident" id="5538298">y</span><span class="op" id="5538299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538302">p</span><span class="op" id="5538303">.</span><span class="ident" id="5538304">Pix</span><span class="op" id="5538307">[</span><span class="ident" id="5538308">i</span><span class="op" id="5538309">]</span>&nbsp;<span class="op" id="5538311">=</span>&nbsp;<span class="ident" id="5538313">c</span><span class="op" id="5538314">.</span><span class="ident" id="5538315">Y</span><br>
<span class="lineno">715</span><span class="op" id="5538317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538320">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5538397">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5538469">func</span>&nbsp;<span class="op" id="5538474">(</span><span class="ident" id="5538475">p</span>&nbsp;<span class="op" id="5538477">*</span><span class="ident" id="5538478">Gray</span><span class="op" id="5538482">)</span>&nbsp;<span class="ident" id="5538484">SubImage</span><span class="op" id="5538492">(</span><span class="ident" id="5538493">r</span>&nbsp;<span class="ident" id="5538495">Rectangle</span><span class="op" id="5538504">)</span>&nbsp;<span class="ident" id="5538506">Image</span>&nbsp;<span class="op" id="5538512">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538515">r</span>&nbsp;<span class="op" id="5538517">=</span>&nbsp;<span class="ident" id="5538519">r</span><span class="op" id="5538520">.</span><span class="ident" id="5538521">Intersect</span><span class="op" id="5538530">(</span><span class="ident" id="5538531">p</span><span class="op" id="5538532">.</span><span class="ident" id="5538533">Rect</span><span class="op" id="5538537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538540">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538621">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538703">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538753">if</span>&nbsp;<span class="ident" id="5538756">r</span><span class="op" id="5538757">.</span><span class="ident" id="5538758">Empty</span><span class="op" id="5538763">(</span><span class="op" id="5538764">)</span>&nbsp;<span class="op" id="5538766">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538770">return</span>&nbsp;<span class="op" id="5538777">&amp;</span><span class="ident" id="5538778">Gray</span><span class="op" id="5538782">{</span><span class="op" id="5538783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538789">i</span>&nbsp;<span class="op" id="5538791">:=</span>&nbsp;<span class="ident" id="5538794">p</span><span class="op" id="5538795">.</span><span class="ident" id="5538796">PixOffset</span><span class="op" id="5538805">(</span><span class="ident" id="5538806">r</span><span class="op" id="5538807">.</span><span class="ident" id="5538808">Min</span><span class="op" id="5538811">.</span><span class="ident" id="5538812">X</span><span class="op" id="5538813">,</span>&nbsp;<span class="ident" id="5538815">r</span><span class="op" id="5538816">.</span><span class="ident" id="5538817">Min</span><span class="op" id="5538820">.</span><span class="ident" id="5538821">Y</span><span class="op" id="5538822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538825">return</span>&nbsp;<span class="op" id="5538832">&amp;</span><span class="ident" id="5538833">Gray</span><span class="op" id="5538837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538841">Pix</span><span class="op" id="5538844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538849">p</span><span class="op" id="5538850">.</span><span class="ident" id="5538851">Pix</span><span class="op" id="5538854">[</span><span class="ident" id="5538855">i</span><span class="op" id="5538856">:</span><span class="op" id="5538857">]</span><span class="op" id="5538858">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538862">Stride</span><span class="op" id="5538868">:</span>&nbsp;<span class="ident" id="5538870">p</span><span class="op" id="5538871">.</span><span class="ident" id="5538872">Stride</span><span class="op" id="5538878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538882">Rect</span><span class="op" id="5538886">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5538890">r</span><span class="op" id="5538891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538894">}</span><br>
<span class="lineno"></span><span class="op" id="5538896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5538899">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5538972">func</span>&nbsp;<span class="op" id="5538977">(</span><span class="ident" id="5538978">p</span>&nbsp;<span class="op" id="5538980">*</span><span class="ident" id="5538981">Gray</span><span class="op" id="5538985">)</span>&nbsp;<span class="ident" id="5538987">Opaque</span><span class="op" id="5538993">(</span><span class="op" id="5538994">)</span>&nbsp;<span class="builtintype" id="5538996">bool</span>&nbsp;<span class="op" id="5539001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539004">return</span>&nbsp;<span class="ident" id="5539011">true</span><br>
<span class="lineno"></span><span class="op" id="5539016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5539019">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5539072">func</span>&nbsp;<span class="ident" id="5539077">NewGray</span><span class="op" id="5539084">(</span><span class="ident" id="5539085">r</span>&nbsp;<span class="ident" id="5539087">Rectangle</span><span class="op" id="5539096">)</span>&nbsp;<span class="op" id="5539098">*</span><span class="ident" id="5539099">Gray</span>&nbsp;<span class="op" id="5539104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539107">w</span><span class="op" id="5539108">,</span>&nbsp;<span class="ident" id="5539110">h</span>&nbsp;<span class="op" id="5539112">:=</span>&nbsp;<span class="ident" id="5539115">r</span><span class="op" id="5539116">.</span><span class="ident" id="5539117">Dx</span><span class="op" id="5539119">(</span><span class="op" id="5539120">)</span><span class="op" id="5539121">,</span>&nbsp;<span class="ident" id="5539123">r</span><span class="op" id="5539124">.</span><span class="ident" id="5539125">Dy</span><span class="op" id="5539127">(</span><span class="op" id="5539128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539131">pix</span>&nbsp;<span class="op" id="5539135">:=</span>&nbsp;<span class="builtinfunc" id="5539138">make</span><span class="op" id="5539142">(</span><span class="op" id="5539143">[</span><span class="op" id="5539144">]</span><span class="builtintype" id="5539145">uint8</span><span class="op" id="5539150">,</span>&nbsp;<span class="num" id="5539152">1</span><span class="op" id="5539153">*</span><span class="ident" id="5539154">w</span><span class="op" id="5539155">*</span><span class="ident" id="5539156">h</span><span class="op" id="5539157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539160">return</span>&nbsp;<span class="op" id="5539167">&amp;</span><span class="ident" id="5539168">Gray</span><span class="op" id="5539172">{</span><span class="ident" id="5539173">pix</span><span class="op" id="5539176">,</span>&nbsp;<span class="num" id="5539178">1</span>&nbsp;<span class="op" id="5539180">*</span>&nbsp;<span class="ident" id="5539182">w</span><span class="op" id="5539183">,</span>&nbsp;<span class="ident" id="5539185">r</span><span class="op" id="5539186">}</span><br>
<span class="lineno">745</span><span class="op" id="5539188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539191">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5539268">type</span>&nbsp;<span class="ident" id="5539273">Gray16</span>&nbsp;<span class="keyword" id="5539280">struct</span>&nbsp;<span class="op" id="5539287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539290">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539374">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539442">Pix</span>&nbsp;<span class="op" id="5539446">[</span><span class="op" id="5539447">]</span><span class="builtintype" id="5539448">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539455">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539531">Stride</span>&nbsp;<span class="builtintype" id="5539538">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539543">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539575">Rect</span>&nbsp;<span class="ident" id="5539580">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5539590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5539593">func</span>&nbsp;<span class="op" id="5539598">(</span><span class="ident" id="5539599">p</span>&nbsp;<span class="op" id="5539601">*</span><span class="ident" id="5539602">Gray16</span><span class="op" id="5539608">)</span>&nbsp;<span class="ident" id="5539610">ColorModel</span><span class="op" id="5539620">(</span><span class="op" id="5539621">)</span>&nbsp;<span class="ident" id="5539623">color</span><span class="op" id="5539628">.</span><span class="ident" id="5539629">Model</span>&nbsp;<span class="op" id="5539635">{</span>&nbsp;<span class="keyword" id="5539637">return</span>&nbsp;<span class="ident" id="5539644">color</span><span class="op" id="5539649">.</span><span class="ident" id="5539650">Gray16Model</span>&nbsp;<span class="op" id="5539662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5539665">func</span>&nbsp;<span class="op" id="5539670">(</span><span class="ident" id="5539671">p</span>&nbsp;<span class="op" id="5539673">*</span><span class="ident" id="5539674">Gray16</span><span class="op" id="5539680">)</span>&nbsp;<span class="ident" id="5539682">Bounds</span><span class="op" id="5539688">(</span><span class="op" id="5539689">)</span>&nbsp;<span class="ident" id="5539691">Rectangle</span>&nbsp;<span class="op" id="5539701">{</span>&nbsp;<span class="keyword" id="5539703">return</span>&nbsp;<span class="ident" id="5539710">p</span><span class="op" id="5539711">.</span><span class="ident" id="5539712">Rect</span>&nbsp;<span class="op" id="5539717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5539720">func</span>&nbsp;<span class="op" id="5539725">(</span><span class="ident" id="5539726">p</span>&nbsp;<span class="op" id="5539728">*</span><span class="ident" id="5539729">Gray16</span><span class="op" id="5539735">)</span>&nbsp;<span class="ident" id="5539737">At</span><span class="op" id="5539739">(</span><span class="ident" id="5539740">x</span><span class="op" id="5539741">,</span>&nbsp;<span class="ident" id="5539743">y</span>&nbsp;<span class="builtintype" id="5539745">int</span><span class="op" id="5539748">)</span>&nbsp;<span class="ident" id="5539750">color</span><span class="op" id="5539755">.</span><span class="ident" id="5539756">Color</span>&nbsp;<span class="op" id="5539762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539765">return</span>&nbsp;<span class="ident" id="5539772">p</span><span class="op" id="5539773">.</span><span class="ident" id="5539774">Gray16At</span><span class="op" id="5539782">(</span><span class="ident" id="5539783">x</span><span class="op" id="5539784">,</span>&nbsp;<span class="ident" id="5539786">y</span><span class="op" id="5539787">)</span><br>
<span class="lineno"></span><span class="op" id="5539789">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5539792">func</span>&nbsp;<span class="op" id="5539797">(</span><span class="ident" id="5539798">p</span>&nbsp;<span class="op" id="5539800">*</span><span class="ident" id="5539801">Gray16</span><span class="op" id="5539807">)</span>&nbsp;<span class="ident" id="5539809">Gray16At</span><span class="op" id="5539817">(</span><span class="ident" id="5539818">x</span><span class="op" id="5539819">,</span>&nbsp;<span class="ident" id="5539821">y</span>&nbsp;<span class="builtintype" id="5539823">int</span><span class="op" id="5539826">)</span>&nbsp;<span class="ident" id="5539828">color</span><span class="op" id="5539833">.</span><span class="ident" id="5539834">Gray16</span>&nbsp;<span class="op" id="5539841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539844">if</span>&nbsp;<span class="op" id="5539847">!</span><span class="op" id="5539848">(</span><span class="ident" id="5539849">Point</span><span class="op" id="5539854">{</span><span class="ident" id="5539855">x</span><span class="op" id="5539856">,</span>&nbsp;<span class="ident" id="5539858">y</span><span class="op" id="5539859">}</span><span class="op" id="5539860">.</span><span class="ident" id="5539861">In</span><span class="op" id="5539863">(</span><span class="ident" id="5539864">p</span><span class="op" id="5539865">.</span><span class="ident" id="5539866">Rect</span><span class="op" id="5539870">)</span><span class="op" id="5539871">)</span>&nbsp;<span class="op" id="5539873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539877">return</span>&nbsp;<span class="ident" id="5539884">color</span><span class="op" id="5539889">.</span><span class="ident" id="5539890">Gray16</span><span class="op" id="5539896">{</span><span class="op" id="5539897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539900">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539903">i</span>&nbsp;<span class="op" id="5539905">:=</span>&nbsp;<span class="ident" id="5539908">p</span><span class="op" id="5539909">.</span><span class="ident" id="5539910">PixOffset</span><span class="op" id="5539919">(</span><span class="ident" id="5539920">x</span><span class="op" id="5539921">,</span>&nbsp;<span class="ident" id="5539923">y</span><span class="op" id="5539924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539927">return</span>&nbsp;<span class="ident" id="5539934">color</span><span class="op" id="5539939">.</span><span class="ident" id="5539940">Gray16</span><span class="op" id="5539946">{</span><span class="builtintype" id="5539947">uint16</span><span class="op" id="5539953">(</span><span class="ident" id="5539954">p</span><span class="op" id="5539955">.</span><span class="ident" id="5539956">Pix</span><span class="op" id="5539959">[</span><span class="ident" id="5539960">i</span><span class="op" id="5539961">+</span><span class="num" id="5539962">0</span><span class="op" id="5539963">]</span><span class="op" id="5539964">)</span><span class="op" id="5539965">&lt;&lt;</span><span class="num" id="5539967">8</span>&nbsp;<span class="op" id="5539969">|</span>&nbsp;<span class="builtintype" id="5539971">uint16</span><span class="op" id="5539977">(</span><span class="ident" id="5539978">p</span><span class="op" id="5539979">.</span><span class="ident" id="5539980">Pix</span><span class="op" id="5539983">[</span><span class="ident" id="5539984">i</span><span class="op" id="5539985">+</span><span class="num" id="5539986">1</span><span class="op" id="5539987">]</span><span class="op" id="5539988">)</span><span class="op" id="5539989">}</span><br>
<span class="lineno"></span><span class="op" id="5539991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539994">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5540073">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5540097">func</span>&nbsp;<span class="op" id="5540102">(</span><span class="ident" id="5540103">p</span>&nbsp;<span class="op" id="5540105">*</span><span class="ident" id="5540106">Gray16</span><span class="op" id="5540112">)</span>&nbsp;<span class="ident" id="5540114">PixOffset</span><span class="op" id="5540123">(</span><span class="ident" id="5540124">x</span><span class="op" id="5540125">,</span>&nbsp;<span class="ident" id="5540127">y</span>&nbsp;<span class="builtintype" id="5540129">int</span><span class="op" id="5540132">)</span>&nbsp;<span class="builtintype" id="5540134">int</span>&nbsp;<span class="op" id="5540138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540141">return</span>&nbsp;<span class="op" id="5540148">(</span><span class="ident" id="5540149">y</span><span class="op" id="5540150">-</span><span class="ident" id="5540151">p</span><span class="op" id="5540152">.</span><span class="ident" id="5540153">Rect</span><span class="op" id="5540157">.</span><span class="ident" id="5540158">Min</span><span class="op" id="5540161">.</span><span class="ident" id="5540162">Y</span><span class="op" id="5540163">)</span><span class="op" id="5540164">*</span><span class="ident" id="5540165">p</span><span class="op" id="5540166">.</span><span class="ident" id="5540167">Stride</span>&nbsp;<span class="op" id="5540174">+</span>&nbsp;<span class="op" id="5540176">(</span><span class="ident" id="5540177">x</span><span class="op" id="5540178">-</span><span class="ident" id="5540179">p</span><span class="op" id="5540180">.</span><span class="ident" id="5540181">Rect</span><span class="op" id="5540185">.</span><span class="ident" id="5540186">Min</span><span class="op" id="5540189">.</span><span class="ident" id="5540190">X</span><span class="op" id="5540191">)</span><span class="op" id="5540192">*</span><span class="num" id="5540193">2</span><br>
<span class="lineno"></span><span class="op" id="5540195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5540198">func</span>&nbsp;<span class="op" id="5540203">(</span><span class="ident" id="5540204">p</span>&nbsp;<span class="op" id="5540206">*</span><span class="ident" id="5540207">Gray16</span><span class="op" id="5540213">)</span>&nbsp;<span class="ident" id="5540215">Set</span><span class="op" id="5540218">(</span><span class="ident" id="5540219">x</span><span class="op" id="5540220">,</span>&nbsp;<span class="ident" id="5540222">y</span>&nbsp;<span class="builtintype" id="5540224">int</span><span class="op" id="5540227">,</span>&nbsp;<span class="ident" id="5540229">c</span>&nbsp;<span class="ident" id="5540231">color</span><span class="op" id="5540236">.</span><span class="ident" id="5540237">Color</span><span class="op" id="5540242">)</span>&nbsp;<span class="op" id="5540244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540247">if</span>&nbsp;<span class="op" id="5540250">!</span><span class="op" id="5540251">(</span><span class="ident" id="5540252">Point</span><span class="op" id="5540257">{</span><span class="ident" id="5540258">x</span><span class="op" id="5540259">,</span>&nbsp;<span class="ident" id="5540261">y</span><span class="op" id="5540262">}</span><span class="op" id="5540263">.</span><span class="ident" id="5540264">In</span><span class="op" id="5540266">(</span><span class="ident" id="5540267">p</span><span class="op" id="5540268">.</span><span class="ident" id="5540269">Rect</span><span class="op" id="5540273">)</span><span class="op" id="5540274">)</span>&nbsp;<span class="op" id="5540276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540280">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540291">i</span>&nbsp;<span class="op" id="5540293">:=</span>&nbsp;<span class="ident" id="5540296">p</span><span class="op" id="5540297">.</span><span class="ident" id="5540298">PixOffset</span><span class="op" id="5540307">(</span><span class="ident" id="5540308">x</span><span class="op" id="5540309">,</span>&nbsp;<span class="ident" id="5540311">y</span><span class="op" id="5540312">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540315">c1</span>&nbsp;<span class="op" id="5540318">:=</span>&nbsp;<span class="ident" id="5540321">color</span><span class="op" id="5540326">.</span><span class="ident" id="5540327">Gray16Model</span><span class="op" id="5540338">.</span><span class="ident" id="5540339">Convert</span><span class="op" id="5540346">(</span><span class="ident" id="5540347">c</span><span class="op" id="5540348">)</span><span class="op" id="5540349">.</span><span class="op" id="5540350">(</span><span class="ident" id="5540351">color</span><span class="op" id="5540356">.</span><span class="ident" id="5540357">Gray16</span><span class="op" id="5540363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540366">p</span><span class="op" id="5540367">.</span><span class="ident" id="5540368">Pix</span><span class="op" id="5540371">[</span><span class="ident" id="5540372">i</span><span class="op" id="5540373">+</span><span class="num" id="5540374">0</span><span class="op" id="5540375">]</span>&nbsp;<span class="op" id="5540377">=</span>&nbsp;<span class="builtintype" id="5540379">uint8</span><span class="op" id="5540384">(</span><span class="ident" id="5540385">c1</span><span class="op" id="5540387">.</span><span class="ident" id="5540388">Y</span>&nbsp;<span class="op" id="5540390">&gt;&gt;</span>&nbsp;<span class="num" id="5540393">8</span><span class="op" id="5540394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540397">p</span><span class="op" id="5540398">.</span><span class="ident" id="5540399">Pix</span><span class="op" id="5540402">[</span><span class="ident" id="5540403">i</span><span class="op" id="5540404">+</span><span class="num" id="5540405">1</span><span class="op" id="5540406">]</span>&nbsp;<span class="op" id="5540408">=</span>&nbsp;<span class="builtintype" id="5540410">uint8</span><span class="op" id="5540415">(</span><span class="ident" id="5540416">c1</span><span class="op" id="5540418">.</span><span class="ident" id="5540419">Y</span><span class="op" id="5540420">)</span><br>
<span class="lineno"></span><span class="op" id="5540422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5540425">func</span>&nbsp;<span class="op" id="5540430">(</span><span class="ident" id="5540431">p</span>&nbsp;<span class="op" id="5540433">*</span><span class="ident" id="5540434">Gray16</span><span class="op" id="5540440">)</span>&nbsp;<span class="ident" id="5540442">SetGray16</span><span class="op" id="5540451">(</span><span class="ident" id="5540452">x</span><span class="op" id="5540453">,</span>&nbsp;<span class="ident" id="5540455">y</span>&nbsp;<span class="builtintype" id="5540457">int</span><span class="op" id="5540460">,</span>&nbsp;<span class="ident" id="5540462">c</span>&nbsp;<span class="ident" id="5540464">color</span><span class="op" id="5540469">.</span><span class="ident" id="5540470">Gray16</span><span class="op" id="5540476">)</span>&nbsp;<span class="op" id="5540478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540481">if</span>&nbsp;<span class="op" id="5540484">!</span><span class="op" id="5540485">(</span><span class="ident" id="5540486">Point</span><span class="op" id="5540491">{</span><span class="ident" id="5540492">x</span><span class="op" id="5540493">,</span>&nbsp;<span class="ident" id="5540495">y</span><span class="op" id="5540496">}</span><span class="op" id="5540497">.</span><span class="ident" id="5540498">In</span><span class="op" id="5540500">(</span><span class="ident" id="5540501">p</span><span class="op" id="5540502">.</span><span class="ident" id="5540503">Rect</span><span class="op" id="5540507">)</span><span class="op" id="5540508">)</span>&nbsp;<span class="op" id="5540510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540514">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540525">i</span>&nbsp;<span class="op" id="5540527">:=</span>&nbsp;<span class="ident" id="5540530">p</span><span class="op" id="5540531">.</span><span class="ident" id="5540532">PixOffset</span><span class="op" id="5540541">(</span><span class="ident" id="5540542">x</span><span class="op" id="5540543">,</span>&nbsp;<span class="ident" id="5540545">y</span><span class="op" id="5540546">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540549">p</span><span class="op" id="5540550">.</span><span class="ident" id="5540551">Pix</span><span class="op" id="5540554">[</span><span class="ident" id="5540555">i</span><span class="op" id="5540556">+</span><span class="num" id="5540557">0</span><span class="op" id="5540558">]</span>&nbsp;<span class="op" id="5540560">=</span>&nbsp;<span class="builtintype" id="5540562">uint8</span><span class="op" id="5540567">(</span><span class="ident" id="5540568">c</span><span class="op" id="5540569">.</span><span class="ident" id="5540570">Y</span>&nbsp;<span class="op" id="5540572">&gt;&gt;</span>&nbsp;<span class="num" id="5540575">8</span><span class="op" id="5540576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540579">p</span><span class="op" id="5540580">.</span><span class="ident" id="5540581">Pix</span><span class="op" id="5540584">[</span><span class="ident" id="5540585">i</span><span class="op" id="5540586">+</span><span class="num" id="5540587">1</span><span class="op" id="5540588">]</span>&nbsp;<span class="op" id="5540590">=</span>&nbsp;<span class="builtintype" id="5540592">uint8</span><span class="op" id="5540597">(</span><span class="ident" id="5540598">c</span><span class="op" id="5540599">.</span><span class="ident" id="5540600">Y</span><span class="op" id="5540601">)</span><br>
<span class="lineno"></span><span class="op" id="5540603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5540606">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5540683">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5540755">func</span>&nbsp;<span class="op" id="5540760">(</span><span class="ident" id="5540761">p</span>&nbsp;<span class="op" id="5540763">*</span><span class="ident" id="5540764">Gray16</span><span class="op" id="5540770">)</span>&nbsp;<span class="ident" id="5540772">SubImage</span><span class="op" id="5540780">(</span><span class="ident" id="5540781">r</span>&nbsp;<span class="ident" id="5540783">Rectangle</span><span class="op" id="5540792">)</span>&nbsp;<span class="ident" id="5540794">Image</span>&nbsp;<span class="op" id="5540800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540803">r</span>&nbsp;<span class="op" id="5540805">=</span>&nbsp;<span class="ident" id="5540807">r</span><span class="op" id="5540808">.</span><span class="ident" id="5540809">Intersect</span><span class="op" id="5540818">(</span><span class="ident" id="5540819">p</span><span class="op" id="5540820">.</span><span class="ident" id="5540821">Rect</span><span class="op" id="5540825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540828">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540909">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540991">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541041">if</span>&nbsp;<span class="ident" id="5541044">r</span><span class="op" id="5541045">.</span><span class="ident" id="5541046">Empty</span><span class="op" id="5541051">(</span><span class="op" id="5541052">)</span>&nbsp;<span class="op" id="5541054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541058">return</span>&nbsp;<span class="op" id="5541065">&amp;</span><span class="ident" id="5541066">Gray16</span><span class="op" id="5541072">{</span><span class="op" id="5541073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541079">i</span>&nbsp;<span class="op" id="5541081">:=</span>&nbsp;<span class="ident" id="5541084">p</span><span class="op" id="5541085">.</span><span class="ident" id="5541086">PixOffset</span><span class="op" id="5541095">(</span><span class="ident" id="5541096">r</span><span class="op" id="5541097">.</span><span class="ident" id="5541098">Min</span><span class="op" id="5541101">.</span><span class="ident" id="5541102">X</span><span class="op" id="5541103">,</span>&nbsp;<span class="ident" id="5541105">r</span><span class="op" id="5541106">.</span><span class="ident" id="5541107">Min</span><span class="op" id="5541110">.</span><span class="ident" id="5541111">Y</span><span class="op" id="5541112">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541115">return</span>&nbsp;<span class="op" id="5541122">&amp;</span><span class="ident" id="5541123">Gray16</span><span class="op" id="5541129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541133">Pix</span><span class="op" id="5541136">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541141">p</span><span class="op" id="5541142">.</span><span class="ident" id="5541143">Pix</span><span class="op" id="5541146">[</span><span class="ident" id="5541147">i</span><span class="op" id="5541148">:</span><span class="op" id="5541149">]</span><span class="op" id="5541150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541154">Stride</span><span class="op" id="5541160">:</span>&nbsp;<span class="ident" id="5541162">p</span><span class="op" id="5541163">.</span><span class="ident" id="5541164">Stride</span><span class="op" id="5541170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541174">Rect</span><span class="op" id="5541178">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5541182">r</span><span class="op" id="5541183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541186">}</span><br>
<span class="lineno">815</span><span class="op" id="5541188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541191">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5541264">func</span>&nbsp;<span class="op" id="5541269">(</span><span class="ident" id="5541270">p</span>&nbsp;<span class="op" id="5541272">*</span><span class="ident" id="5541273">Gray16</span><span class="op" id="5541279">)</span>&nbsp;<span class="ident" id="5541281">Opaque</span><span class="op" id="5541287">(</span><span class="op" id="5541288">)</span>&nbsp;<span class="builtintype" id="5541290">bool</span>&nbsp;<span class="op" id="5541295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541298">return</span>&nbsp;<span class="ident" id="5541305">true</span><br>
<span class="lineno">820</span><span class="op" id="5541310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541313">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5541370">func</span>&nbsp;<span class="ident" id="5541375">NewGray16</span><span class="op" id="5541384">(</span><span class="ident" id="5541385">r</span>&nbsp;<span class="ident" id="5541387">Rectangle</span><span class="op" id="5541396">)</span>&nbsp;<span class="op" id="5541398">*</span><span class="ident" id="5541399">Gray16</span>&nbsp;<span class="op" id="5541406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541409">w</span><span class="op" id="5541410">,</span>&nbsp;<span class="ident" id="5541412">h</span>&nbsp;<span class="op" id="5541414">:=</span>&nbsp;<span class="ident" id="5541417">r</span><span class="op" id="5541418">.</span><span class="ident" id="5541419">Dx</span><span class="op" id="5541421">(</span><span class="op" id="5541422">)</span><span class="op" id="5541423">,</span>&nbsp;<span class="ident" id="5541425">r</span><span class="op" id="5541426">.</span><span class="ident" id="5541427">Dy</span><span class="op" id="5541429">(</span><span class="op" id="5541430">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541433">pix</span>&nbsp;<span class="op" id="5541437">:=</span>&nbsp;<span class="builtinfunc" id="5541440">make</span><span class="op" id="5541444">(</span><span class="op" id="5541445">[</span><span class="op" id="5541446">]</span><span class="builtintype" id="5541447">uint8</span><span class="op" id="5541452">,</span>&nbsp;<span class="num" id="5541454">2</span><span class="op" id="5541455">*</span><span class="ident" id="5541456">w</span><span class="op" id="5541457">*</span><span class="ident" id="5541458">h</span><span class="op" id="5541459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541462">return</span>&nbsp;<span class="op" id="5541469">&amp;</span><span class="ident" id="5541470">Gray16</span><span class="op" id="5541476">{</span><span class="ident" id="5541477">pix</span><span class="op" id="5541480">,</span>&nbsp;<span class="num" id="5541482">2</span>&nbsp;<span class="op" id="5541484">*</span>&nbsp;<span class="ident" id="5541486">w</span><span class="op" id="5541487">,</span>&nbsp;<span class="ident" id="5541489">r</span><span class="op" id="5541490">}</span><br>
<span class="lineno"></span><span class="op" id="5541492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541495">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5541568">type</span>&nbsp;<span class="ident" id="5541573">Paletted</span>&nbsp;<span class="keyword" id="5541582">struct</span>&nbsp;<span class="op" id="5541589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541592">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541659">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541727">Pix</span>&nbsp;<span class="op" id="5541731">[</span><span class="op" id="5541732">]</span><span class="builtintype" id="5541733">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541740">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541816">Stride</span>&nbsp;<span class="builtintype" id="5541823">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541828">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541860">Rect</span>&nbsp;<span class="ident" id="5541865">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541876">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541912">Palette</span>&nbsp;<span class="ident" id="5541920">color</span><span class="op" id="5541925">.</span><span class="ident" id="5541926">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5541934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5541937">func</span>&nbsp;<span class="op" id="5541942">(</span><span class="ident" id="5541943">p</span>&nbsp;<span class="op" id="5541945">*</span><span class="ident" id="5541946">Paletted</span><span class="op" id="5541954">)</span>&nbsp;<span class="ident" id="5541956">ColorModel</span><span class="op" id="5541966">(</span><span class="op" id="5541967">)</span>&nbsp;<span class="ident" id="5541969">color</span><span class="op" id="5541974">.</span><span class="ident" id="5541975">Model</span>&nbsp;<span class="op" id="5541981">{</span>&nbsp;<span class="keyword" id="5541983">return</span>&nbsp;<span class="ident" id="5541990">p</span><span class="op" id="5541991">.</span><span class="ident" id="5541992">Palette</span>&nbsp;<span class="op" id="5542000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5542003">func</span>&nbsp;<span class="op" id="5542008">(</span><span class="ident" id="5542009">p</span>&nbsp;<span class="op" id="5542011">*</span><span class="ident" id="5542012">Paletted</span><span class="op" id="5542020">)</span>&nbsp;<span class="ident" id="5542022">Bounds</span><span class="op" id="5542028">(</span><span class="op" id="5542029">)</span>&nbsp;<span class="ident" id="5542031">Rectangle</span>&nbsp;<span class="op" id="5542041">{</span>&nbsp;<span class="keyword" id="5542043">return</span>&nbsp;<span class="ident" id="5542050">p</span><span class="op" id="5542051">.</span><span class="ident" id="5542052">Rect</span>&nbsp;<span class="op" id="5542057">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5542060">func</span>&nbsp;<span class="op" id="5542065">(</span><span class="ident" id="5542066">p</span>&nbsp;<span class="op" id="5542068">*</span><span class="ident" id="5542069">Paletted</span><span class="op" id="5542077">)</span>&nbsp;<span class="ident" id="5542079">At</span><span class="op" id="5542081">(</span><span class="ident" id="5542082">x</span><span class="op" id="5542083">,</span>&nbsp;<span class="ident" id="5542085">y</span>&nbsp;<span class="builtintype" id="5542087">int</span><span class="op" id="5542090">)</span>&nbsp;<span class="ident" id="5542092">color</span><span class="op" id="5542097">.</span><span class="ident" id="5542098">Color</span>&nbsp;<span class="op" id="5542104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542107">if</span>&nbsp;<span class="builtinfunc" id="5542110">len</span><span class="op" id="5542113">(</span><span class="ident" id="5542114">p</span><span class="op" id="5542115">.</span><span class="ident" id="5542116">Palette</span><span class="op" id="5542123">)</span>&nbsp;<span class="op" id="5542125">==</span>&nbsp;<span class="num" id="5542128">0</span>&nbsp;<span class="op" id="5542130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542134">return</span>&nbsp;<span class="ident" id="5542141">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542146">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542149">if</span>&nbsp;<span class="op" id="5542152">!</span><span class="op" id="5542153">(</span><span class="ident" id="5542154">Point</span><span class="op" id="5542159">{</span><span class="ident" id="5542160">x</span><span class="op" id="5542161">,</span>&nbsp;<span class="ident" id="5542163">y</span><span class="op" id="5542164">}</span><span class="op" id="5542165">.</span><span class="ident" id="5542166">In</span><span class="op" id="5542168">(</span><span class="ident" id="5542169">p</span><span class="op" id="5542170">.</span><span class="ident" id="5542171">Rect</span><span class="op" id="5542175">)</span><span class="op" id="5542176">)</span>&nbsp;<span class="op" id="5542178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542182">return</span>&nbsp;<span class="ident" id="5542189">p</span><span class="op" id="5542190">.</span><span class="ident" id="5542191">Palette</span><span class="op" id="5542198">[</span><span class="num" id="5542199">0</span><span class="op" id="5542200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542206">i</span>&nbsp;<span class="op" id="5542208">:=</span>&nbsp;<span class="ident" id="5542211">p</span><span class="op" id="5542212">.</span><span class="ident" id="5542213">PixOffset</span><span class="op" id="5542222">(</span><span class="ident" id="5542223">x</span><span class="op" id="5542224">,</span>&nbsp;<span class="ident" id="5542226">y</span><span class="op" id="5542227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542230">return</span>&nbsp;<span class="ident" id="5542237">p</span><span class="op" id="5542238">.</span><span class="ident" id="5542239">Palette</span><span class="op" id="5542246">[</span><span class="ident" id="5542247">p</span><span class="op" id="5542248">.</span><span class="ident" id="5542249">Pix</span><span class="op" id="5542252">[</span><span class="ident" id="5542253">i</span><span class="op" id="5542254">]</span><span class="op" id="5542255">]</span><br>
<span class="lineno">855</span><span class="op" id="5542257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5542260">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5542339">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5542363">func</span>&nbsp;<span class="op" id="5542368">(</span><span class="ident" id="5542369">p</span>&nbsp;<span class="op" id="5542371">*</span><span class="ident" id="5542372">Paletted</span><span class="op" id="5542380">)</span>&nbsp;<span class="ident" id="5542382">PixOffset</span><span class="op" id="5542391">(</span><span class="ident" id="5542392">x</span><span class="op" id="5542393">,</span>&nbsp;<span class="ident" id="5542395">y</span>&nbsp;<span class="builtintype" id="5542397">int</span><span class="op" id="5542400">)</span>&nbsp;<span class="builtintype" id="5542402">int</span>&nbsp;<span class="op" id="5542406">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542409">return</span>&nbsp;<span class="op" id="5542416">(</span><span class="ident" id="5542417">y</span><span class="op" id="5542418">-</span><span class="ident" id="5542419">p</span><span class="op" id="5542420">.</span><span class="ident" id="5542421">Rect</span><span class="op" id="5542425">.</span><span class="ident" id="5542426">Min</span><span class="op" id="5542429">.</span><span class="ident" id="5542430">Y</span><span class="op" id="5542431">)</span><span class="op" id="5542432">*</span><span class="ident" id="5542433">p</span><span class="op" id="5542434">.</span><span class="ident" id="5542435">Stride</span>&nbsp;<span class="op" id="5542442">+</span>&nbsp;<span class="op" id="5542444">(</span><span class="ident" id="5542445">x</span><span class="op" id="5542446">-</span><span class="ident" id="5542447">p</span><span class="op" id="5542448">.</span><span class="ident" id="5542449">Rect</span><span class="op" id="5542453">.</span><span class="ident" id="5542454">Min</span><span class="op" id="5542457">.</span><span class="ident" id="5542458">X</span><span class="op" id="5542459">)</span><span class="op" id="5542460">*</span><span class="num" id="5542461">1</span><br>
<span class="lineno"></span><span class="op" id="5542463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5542466">func</span>&nbsp;<span class="op" id="5542471">(</span><span class="ident" id="5542472">p</span>&nbsp;<span class="op" id="5542474">*</span><span class="ident" id="5542475">Paletted</span><span class="op" id="5542483">)</span>&nbsp;<span class="ident" id="5542485">Set</span><span class="op" id="5542488">(</span><span class="ident" id="5542489">x</span><span class="op" id="5542490">,</span>&nbsp;<span class="ident" id="5542492">y</span>&nbsp;<span class="builtintype" id="5542494">int</span><span class="op" id="5542497">,</span>&nbsp;<span class="ident" id="5542499">c</span>&nbsp;<span class="ident" id="5542501">color</span><span class="op" id="5542506">.</span><span class="ident" id="5542507">Color</span><span class="op" id="5542512">)</span>&nbsp;<span class="op" id="5542514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542517">if</span>&nbsp;<span class="op" id="5542520">!</span><span class="op" id="5542521">(</span><span class="ident" id="5542522">Point</span><span class="op" id="5542527">{</span><span class="ident" id="5542528">x</span><span class="op" id="5542529">,</span>&nbsp;<span class="ident" id="5542531">y</span><span class="op" id="5542532">}</span><span class="op" id="5542533">.</span><span class="ident" id="5542534">In</span><span class="op" id="5542536">(</span><span class="ident" id="5542537">p</span><span class="op" id="5542538">.</span><span class="ident" id="5542539">Rect</span><span class="op" id="5542543">)</span><span class="op" id="5542544">)</span>&nbsp;<span class="op" id="5542546">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542561">i</span>&nbsp;<span class="op" id="5542563">:=</span>&nbsp;<span class="ident" id="5542566">p</span><span class="op" id="5542567">.</span><span class="ident" id="5542568">PixOffset</span><span class="op" id="5542577">(</span><span class="ident" id="5542578">x</span><span class="op" id="5542579">,</span>&nbsp;<span class="ident" id="5542581">y</span><span class="op" id="5542582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542585">p</span><span class="op" id="5542586">.</span><span class="ident" id="5542587">Pix</span><span class="op" id="5542590">[</span><span class="ident" id="5542591">i</span><span class="op" id="5542592">]</span>&nbsp;<span class="op" id="5542594">=</span>&nbsp;<span class="builtintype" id="5542596">uint8</span><span class="op" id="5542601">(</span><span class="ident" id="5542602">p</span><span class="op" id="5542603">.</span><span class="ident" id="5542604">Palette</span><span class="op" id="5542611">.</span><span class="ident" id="5542612">Index</span><span class="op" id="5542617">(</span><span class="ident" id="5542618">c</span><span class="op" id="5542619">)</span><span class="op" id="5542620">)</span><br>
<span class="lineno"></span><span class="op" id="5542622">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5542625">func</span>&nbsp;<span class="op" id="5542630">(</span><span class="ident" id="5542631">p</span>&nbsp;<span class="op" id="5542633">*</span><span class="ident" id="5542634">Paletted</span><span class="op" id="5542642">)</span>&nbsp;<span class="ident" id="5542644">ColorIndexAt</span><span class="op" id="5542656">(</span><span class="ident" id="5542657">x</span><span class="op" id="5542658">,</span>&nbsp;<span class="ident" id="5542660">y</span>&nbsp;<span class="builtintype" id="5542662">int</span><span class="op" id="5542665">)</span>&nbsp;<span class="builtintype" id="5542667">uint8</span>&nbsp;<span class="op" id="5542673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542676">if</span>&nbsp;<span class="op" id="5542679">!</span><span class="op" id="5542680">(</span><span class="ident" id="5542681">Point</span><span class="op" id="5542686">{</span><span class="ident" id="5542687">x</span><span class="op" id="5542688">,</span>&nbsp;<span class="ident" id="5542690">y</span><span class="op" id="5542691">}</span><span class="op" id="5542692">.</span><span class="ident" id="5542693">In</span><span class="op" id="5542695">(</span><span class="ident" id="5542696">p</span><span class="op" id="5542697">.</span><span class="ident" id="5542698">Rect</span><span class="op" id="5542702">)</span><span class="op" id="5542703">)</span>&nbsp;<span class="op" id="5542705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542709">return</span>&nbsp;<span class="num" id="5542716">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542719">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542722">i</span>&nbsp;<span class="op" id="5542724">:=</span>&nbsp;<span class="ident" id="5542727">p</span><span class="op" id="5542728">.</span><span class="ident" id="5542729">PixOffset</span><span class="op" id="5542738">(</span><span class="ident" id="5542739">x</span><span class="op" id="5542740">,</span>&nbsp;<span class="ident" id="5542742">y</span><span class="op" id="5542743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542746">return</span>&nbsp;<span class="ident" id="5542753">p</span><span class="op" id="5542754">.</span><span class="ident" id="5542755">Pix</span><span class="op" id="5542758">[</span><span class="ident" id="5542759">i</span><span class="op" id="5542760">]</span><br>
<span class="lineno"></span><span class="op" id="5542762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5542765">func</span>&nbsp;<span class="op" id="5542770">(</span><span class="ident" id="5542771">p</span>&nbsp;<span class="op" id="5542773">*</span><span class="ident" id="5542774">Paletted</span><span class="op" id="5542782">)</span>&nbsp;<span class="ident" id="5542784">SetColorIndex</span><span class="op" id="5542797">(</span><span class="ident" id="5542798">x</span><span class="op" id="5542799">,</span>&nbsp;<span class="ident" id="5542801">y</span>&nbsp;<span class="builtintype" id="5542803">int</span><span class="op" id="5542806">,</span>&nbsp;<span class="ident" id="5542808">index</span>&nbsp;<span class="builtintype" id="5542814">uint8</span><span class="op" id="5542819">)</span>&nbsp;<span class="op" id="5542821">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542824">if</span>&nbsp;<span class="op" id="5542827">!</span><span class="op" id="5542828">(</span><span class="ident" id="5542829">Point</span><span class="op" id="5542834">{</span><span class="ident" id="5542835">x</span><span class="op" id="5542836">,</span>&nbsp;<span class="ident" id="5542838">y</span><span class="op" id="5542839">}</span><span class="op" id="5542840">.</span><span class="ident" id="5542841">In</span><span class="op" id="5542843">(</span><span class="ident" id="5542844">p</span><span class="op" id="5542845">.</span><span class="ident" id="5542846">Rect</span><span class="op" id="5542850">)</span><span class="op" id="5542851">)</span>&nbsp;<span class="op" id="5542853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542868">i</span>&nbsp;<span class="op" id="5542870">:=</span>&nbsp;<span class="ident" id="5542873">p</span><span class="op" id="5542874">.</span><span class="ident" id="5542875">PixOffset</span><span class="op" id="5542884">(</span><span class="ident" id="5542885">x</span><span class="op" id="5542886">,</span>&nbsp;<span class="ident" id="5542888">y</span><span class="op" id="5542889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542892">p</span><span class="op" id="5542893">.</span><span class="ident" id="5542894">Pix</span><span class="op" id="5542897">[</span><span class="ident" id="5542898">i</span><span class="op" id="5542899">]</span>&nbsp;<span class="op" id="5542901">=</span>&nbsp;<span class="ident" id="5542903">index</span><br>
<span class="lineno">885</span><span class="op" id="5542909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5542912">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5542989">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5543061">func</span>&nbsp;<span class="op" id="5543066">(</span><span class="ident" id="5543067">p</span>&nbsp;<span class="op" id="5543069">*</span><span class="ident" id="5543070">Paletted</span><span class="op" id="5543078">)</span>&nbsp;<span class="ident" id="5543080">SubImage</span><span class="op" id="5543088">(</span><span class="ident" id="5543089">r</span>&nbsp;<span class="ident" id="5543091">Rectangle</span><span class="op" id="5543100">)</span>&nbsp;<span class="ident" id="5543102">Image</span>&nbsp;<span class="op" id="5543108">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543111">r</span>&nbsp;<span class="op" id="5543113">=</span>&nbsp;<span class="ident" id="5543115">r</span><span class="op" id="5543116">.</span><span class="ident" id="5543117">Intersect</span><span class="op" id="5543126">(</span><span class="ident" id="5543127">p</span><span class="op" id="5543128">.</span><span class="ident" id="5543129">Rect</span><span class="op" id="5543133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543136">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543217">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543299">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543349">if</span>&nbsp;<span class="ident" id="5543352">r</span><span class="op" id="5543353">.</span><span class="ident" id="5543354">Empty</span><span class="op" id="5543359">(</span><span class="op" id="5543360">)</span>&nbsp;<span class="op" id="5543362">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543366">return</span>&nbsp;<span class="op" id="5543373">&amp;</span><span class="ident" id="5543374">Paletted</span><span class="op" id="5543382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543387">Palette</span><span class="op" id="5543394">:</span>&nbsp;<span class="ident" id="5543396">p</span><span class="op" id="5543397">.</span><span class="ident" id="5543398">Palette</span><span class="op" id="5543405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543415">i</span>&nbsp;<span class="op" id="5543417">:=</span>&nbsp;<span class="ident" id="5543420">p</span><span class="op" id="5543421">.</span><span class="ident" id="5543422">PixOffset</span><span class="op" id="5543431">(</span><span class="ident" id="5543432">r</span><span class="op" id="5543433">.</span><span class="ident" id="5543434">Min</span><span class="op" id="5543437">.</span><span class="ident" id="5543438">X</span><span class="op" id="5543439">,</span>&nbsp;<span class="ident" id="5543441">r</span><span class="op" id="5543442">.</span><span class="ident" id="5543443">Min</span><span class="op" id="5543446">.</span><span class="ident" id="5543447">Y</span><span class="op" id="5543448">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543451">return</span>&nbsp;<span class="op" id="5543458">&amp;</span><span class="ident" id="5543459">Paletted</span><span class="op" id="5543467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543471">Pix</span><span class="op" id="5543474">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543480">p</span><span class="op" id="5543481">.</span><span class="ident" id="5543482">Pix</span><span class="op" id="5543485">[</span><span class="ident" id="5543486">i</span><span class="op" id="5543487">:</span><span class="op" id="5543488">]</span><span class="op" id="5543489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543493">Stride</span><span class="op" id="5543499">:</span>&nbsp;&nbsp;<span class="ident" id="5543502">p</span><span class="op" id="5543503">.</span><span class="ident" id="5543504">Stride</span><span class="op" id="5543510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543514">Rect</span><span class="op" id="5543518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543523">p</span><span class="op" id="5543524">.</span><span class="ident" id="5543525">Rect</span><span class="op" id="5543529">.</span><span class="ident" id="5543530">Intersect</span><span class="op" id="5543539">(</span><span class="ident" id="5543540">r</span><span class="op" id="5543541">)</span><span class="op" id="5543542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543546">Palette</span><span class="op" id="5543553">:</span>&nbsp;<span class="ident" id="5543555">p</span><span class="op" id="5543556">.</span><span class="ident" id="5543557">Palette</span><span class="op" id="5543564">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543567">}</span><br>
<span class="lineno"></span><span class="op" id="5543569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5543572">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5543645">func</span>&nbsp;<span class="op" id="5543650">(</span><span class="ident" id="5543651">p</span>&nbsp;<span class="op" id="5543653">*</span><span class="ident" id="5543654">Paletted</span><span class="op" id="5543662">)</span>&nbsp;<span class="ident" id="5543664">Opaque</span><span class="op" id="5543670">(</span><span class="op" id="5543671">)</span>&nbsp;<span class="builtintype" id="5543673">bool</span>&nbsp;<span class="op" id="5543678">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543681">var</span>&nbsp;<span class="ident" id="5543685">present</span>&nbsp;<span class="op" id="5543693">[</span><span class="num" id="5543694">256</span><span class="op" id="5543697">]</span><span class="builtintype" id="5543698">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543704">i0</span><span class="op" id="5543706">,</span>&nbsp;<span class="ident" id="5543708">i1</span>&nbsp;<span class="op" id="5543711">:=</span>&nbsp;<span class="num" id="5543714">0</span><span class="op" id="5543715">,</span>&nbsp;<span class="ident" id="5543717">p</span><span class="op" id="5543718">.</span><span class="ident" id="5543719">Rect</span><span class="op" id="5543723">.</span><span class="ident" id="5543724">Dx</span><span class="op" id="5543726">(</span><span class="op" id="5543727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543730">for</span>&nbsp;<span class="ident" id="5543734">y</span>&nbsp;<span class="op" id="5543736">:=</span>&nbsp;<span class="ident" id="5543739">p</span><span class="op" id="5543740">.</span><span class="ident" id="5543741">Rect</span><span class="op" id="5543745">.</span><span class="ident" id="5543746">Min</span><span class="op" id="5543749">.</span><span class="ident" id="5543750">Y</span><span class="op" id="5543751">;</span>&nbsp;<span class="ident" id="5543753">y</span>&nbsp;<span class="op" id="5543755">&lt;</span>&nbsp;<span class="ident" id="5543757">p</span><span class="op" id="5543758">.</span><span class="ident" id="5543759">Rect</span><span class="op" id="5543763">.</span><span class="ident" id="5543764">Max</span><span class="op" id="5543767">.</span><span class="ident" id="5543768">Y</span><span class="op" id="5543769">;</span>&nbsp;<span class="ident" id="5543771">y</span><span class="op" id="5543772">++</span>&nbsp;<span class="op" id="5543775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543779">for</span>&nbsp;<span class="ident" id="5543783">_</span><span class="op" id="5543784">,</span>&nbsp;<span class="ident" id="5543786">c</span>&nbsp;<span class="op" id="5543788">:=</span>&nbsp;<span class="keyword" id="5543791">range</span>&nbsp;<span class="ident" id="5543797">p</span><span class="op" id="5543798">.</span><span class="ident" id="5543799">Pix</span><span class="op" id="5543802">[</span><span class="ident" id="5543803">i0</span><span class="op" id="5543805">:</span><span class="ident" id="5543806">i1</span><span class="op" id="5543808">]</span>&nbsp;<span class="op" id="5543810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543815">present</span><span class="op" id="5543822">[</span><span class="ident" id="5543823">c</span><span class="op" id="5543824">]</span>&nbsp;<span class="op" id="5543826">=</span>&nbsp;<span class="ident" id="5543828">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543839">i0</span>&nbsp;<span class="op" id="5543842">+=</span>&nbsp;<span class="ident" id="5543845">p</span><span class="op" id="5543846">.</span><span class="ident" id="5543847">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543856">i1</span>&nbsp;<span class="op" id="5543859">+=</span>&nbsp;<span class="ident" id="5543862">p</span><span class="op" id="5543863">.</span><span class="ident" id="5543864">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543875">for</span>&nbsp;<span class="ident" id="5543879">i</span><span class="op" id="5543880">,</span>&nbsp;<span class="ident" id="5543882">c</span>&nbsp;<span class="op" id="5543884">:=</span>&nbsp;<span class="keyword" id="5543887">range</span>&nbsp;<span class="ident" id="5543893">p</span><span class="op" id="5543894">.</span><span class="ident" id="5543895">Palette</span>&nbsp;<span class="op" id="5543903">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543907">if</span>&nbsp;<span class="op" id="5543910">!</span><span class="ident" id="5543911">present</span><span class="op" id="5543918">[</span><span class="ident" id="5543919">i</span><span class="op" id="5543920">]</span>&nbsp;<span class="op" id="5543922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543927">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543942">_</span><span class="op" id="5543943">,</span>&nbsp;<span class="ident" id="5543945">_</span><span class="op" id="5543946">,</span>&nbsp;<span class="ident" id="5543948">_</span><span class="op" id="5543949">,</span>&nbsp;<span class="ident" id="5543951">a</span>&nbsp;<span class="op" id="5543953">:=</span>&nbsp;<span class="ident" id="5543956">c</span><span class="op" id="5543957">.</span><span class="ident" id="5543958">RGBA</span><span class="op" id="5543962">(</span><span class="op" id="5543963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543967">if</span>&nbsp;<span class="ident" id="5543970">a</span>&nbsp;<span class="op" id="5543972">!=</span>&nbsp;<span class="num" id="5543975">0xffff</span>&nbsp;<span class="op" id="5543982">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543987">return</span>&nbsp;<span class="ident" id="5543994">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544008">return</span>&nbsp;<span class="ident" id="5544015">true</span><br>
<span class="lineno"></span><span class="op" id="5544020">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5544023">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5544103">func</span>&nbsp;<span class="ident" id="5544108">NewPaletted</span><span class="op" id="5544119">(</span><span class="ident" id="5544120">r</span>&nbsp;<span class="ident" id="5544122">Rectangle</span><span class="op" id="5544131">,</span>&nbsp;<span class="ident" id="5544133">p</span>&nbsp;<span class="ident" id="5544135">color</span><span class="op" id="5544140">.</span><span class="ident" id="5544141">Palette</span><span class="op" id="5544148">)</span>&nbsp;<span class="op" id="5544150">*</span><span class="ident" id="5544151">Paletted</span>&nbsp;<span class="op" id="5544160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544163">w</span><span class="op" id="5544164">,</span>&nbsp;<span class="ident" id="5544166">h</span>&nbsp;<span class="op" id="5544168">:=</span>&nbsp;<span class="ident" id="5544171">r</span><span class="op" id="5544172">.</span><span class="ident" id="5544173">Dx</span><span class="op" id="5544175">(</span><span class="op" id="5544176">)</span><span class="op" id="5544177">,</span>&nbsp;<span class="ident" id="5544179">r</span><span class="op" id="5544180">.</span><span class="ident" id="5544181">Dy</span><span class="op" id="5544183">(</span><span class="op" id="5544184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544187">pix</span>&nbsp;<span class="op" id="5544191">:=</span>&nbsp;<span class="builtinfunc" id="5544194">make</span><span class="op" id="5544198">(</span><span class="op" id="5544199">[</span><span class="op" id="5544200">]</span><span class="builtintype" id="5544201">uint8</span><span class="op" id="5544206">,</span>&nbsp;<span class="num" id="5544208">1</span><span class="op" id="5544209">*</span><span class="ident" id="5544210">w</span><span class="op" id="5544211">*</span><span class="ident" id="5544212">h</span><span class="op" id="5544213">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544216">return</span>&nbsp;<span class="op" id="5544223">&amp;</span><span class="ident" id="5544224">Paletted</span><span class="op" id="5544232">{</span><span class="ident" id="5544233">pix</span><span class="op" id="5544236">,</span>&nbsp;<span class="num" id="5544238">1</span>&nbsp;<span class="op" id="5544240">*</span>&nbsp;<span class="ident" id="5544242">w</span><span class="op" id="5544243">,</span>&nbsp;<span class="ident" id="5544245">r</span><span class="op" id="5544246">,</span>&nbsp;<span class="ident" id="5544248">p</span><span class="op" id="5544249">}</span><br>
<span class="lineno"></span><span class="op" id="5544251">}</span>
</div>
</body>
</html>
