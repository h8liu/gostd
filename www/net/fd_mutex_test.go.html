<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7861067">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7861122">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7861176">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7861227">package</span>&nbsp;<span class="ident" id="7861235">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7861240">import</span>&nbsp;<span class="op" id="7861247">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7861250">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7861263">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7861274">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7861285">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7861292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7861295">func</span>&nbsp;<span class="ident" id="7861300">TestMutexLock</span><span class="op" id="7861313">(</span><span class="ident" id="7861314">t</span>&nbsp;<span class="op" id="7861316">*</span><span class="ident" id="7861317"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7861324">.</span><span class="ident" id="7861325">T</span><span class="op" id="7861326">)</span>&nbsp;<span class="op" id="7861328">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861331">var</span>&nbsp;<span class="ident" id="7861335">mu</span>&nbsp;<span class="ident" id="7861338"><a href="/net/fd_mutex.go.html#1380501">fdMutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861348">if</span>&nbsp;<span class="op" id="7861351">!</span><span class="ident" id="7861352"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861354">.</span><span class="ident" id="7861355">Incref</span><span class="op" id="7861361">(</span><span class="op" id="7861362">)</span>&nbsp;<span class="op" id="7861364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861368"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861369">.</span><span class="ident" id="7861370">Fatal</span><span class="op" id="7861375">(</span><span class="string" id="7861376">&#34;broken&#34;</span><span class="op" id="7861384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861387">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861390">if</span>&nbsp;<span class="ident" id="7861393"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861395">.</span><span class="ident" id="7861396">Decref</span><span class="op" id="7861402">(</span><span class="op" id="7861403">)</span>&nbsp;<span class="op" id="7861405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861409"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861410">.</span><span class="ident" id="7861411">Fatal</span><span class="op" id="7861416">(</span><span class="string" id="7861417">&#34;broken&#34;</span><span class="op" id="7861425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861432">if</span>&nbsp;<span class="op" id="7861435">!</span><span class="ident" id="7861436"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861438">.</span><span class="ident" id="7861439">RWLock</span><span class="op" id="7861445">(</span><span class="builtintype" id="7861446">true</span><span class="op" id="7861450">)</span>&nbsp;<span class="op" id="7861452">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861456"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861457">.</span><span class="ident" id="7861458">Fatal</span><span class="op" id="7861463">(</span><span class="string" id="7861464">&#34;broken&#34;</span><span class="op" id="7861472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861478">if</span>&nbsp;<span class="ident" id="7861481"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861483">.</span><span class="ident" id="7861484">RWUnlock</span><span class="op" id="7861492">(</span><span class="builtintype" id="7861493">true</span><span class="op" id="7861497">)</span>&nbsp;<span class="op" id="7861499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861503"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861504">.</span><span class="ident" id="7861505">Fatal</span><span class="op" id="7861510">(</span><span class="string" id="7861511">&#34;broken&#34;</span><span class="op" id="7861519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861522">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861526">if</span>&nbsp;<span class="op" id="7861529">!</span><span class="ident" id="7861530"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861532">.</span><span class="ident" id="7861533">RWLock</span><span class="op" id="7861539">(</span><span class="builtintype" id="7861540">false</span><span class="op" id="7861545">)</span>&nbsp;<span class="op" id="7861547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861551"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861552">.</span><span class="ident" id="7861553">Fatal</span><span class="op" id="7861558">(</span><span class="string" id="7861559">&#34;broken&#34;</span><span class="op" id="7861567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861573">if</span>&nbsp;<span class="ident" id="7861576"><a href="/net/fd_mutex_test.go.html#7861335">mu</a></span><span class="op" id="7861578">.</span><span class="ident" id="7861579">RWUnlock</span><span class="op" id="7861587">(</span><span class="builtintype" id="7861588">false</span><span class="op" id="7861593">)</span>&nbsp;<span class="op" id="7861595">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861599"><a href="/net/fd_mutex_test.go.html#7861314">t</a></span><span class="op" id="7861600">.</span><span class="ident" id="7861601">Fatal</span><span class="op" id="7861606">(</span><span class="string" id="7861607">&#34;broken&#34;</span><span class="op" id="7861615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861618">}</span><br>
<span class="lineno"></span><span class="op" id="7861620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7861623">func</span>&nbsp;<span class="ident" id="7861628">TestMutexClose</span><span class="op" id="7861642">(</span><span class="ident" id="7861643">t</span>&nbsp;<span class="op" id="7861645">*</span><span class="ident" id="7861646"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7861653">.</span><span class="ident" id="7861654">T</span><span class="op" id="7861655">)</span>&nbsp;<span class="op" id="7861657">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861660">var</span>&nbsp;<span class="ident" id="7861664">mu</span>&nbsp;<span class="ident" id="7861667"><a href="/net/fd_mutex.go.html#1380501">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861676">if</span>&nbsp;<span class="op" id="7861679">!</span><span class="ident" id="7861680"><a href="/net/fd_mutex_test.go.html#7861664">mu</a></span><span class="op" id="7861682">.</span><span class="ident" id="7861683">IncrefAndClose</span><span class="op" id="7861697">(</span><span class="op" id="7861698">)</span>&nbsp;<span class="op" id="7861700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861704"><a href="/net/fd_mutex_test.go.html#7861643">t</a></span><span class="op" id="7861705">.</span><span class="ident" id="7861706">Fatal</span><span class="op" id="7861711">(</span><span class="string" id="7861712">&#34;broken&#34;</span><span class="op" id="7861720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861727">if</span>&nbsp;<span class="ident" id="7861730"><a href="/net/fd_mutex_test.go.html#7861664">mu</a></span><span class="op" id="7861732">.</span><span class="ident" id="7861733">Incref</span><span class="op" id="7861739">(</span><span class="op" id="7861740">)</span>&nbsp;<span class="op" id="7861742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861746"><a href="/net/fd_mutex_test.go.html#7861643">t</a></span><span class="op" id="7861747">.</span><span class="ident" id="7861748">Fatal</span><span class="op" id="7861753">(</span><span class="string" id="7861754">&#34;broken&#34;</span><span class="op" id="7861762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861768">if</span>&nbsp;<span class="ident" id="7861771"><a href="/net/fd_mutex_test.go.html#7861664">mu</a></span><span class="op" id="7861773">.</span><span class="ident" id="7861774">RWLock</span><span class="op" id="7861780">(</span><span class="builtintype" id="7861781">true</span><span class="op" id="7861785">)</span>&nbsp;<span class="op" id="7861787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861791"><a href="/net/fd_mutex_test.go.html#7861643">t</a></span><span class="op" id="7861792">.</span><span class="ident" id="7861793">Fatal</span><span class="op" id="7861798">(</span><span class="string" id="7861799">&#34;broken&#34;</span><span class="op" id="7861807">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861813">if</span>&nbsp;<span class="ident" id="7861816"><a href="/net/fd_mutex_test.go.html#7861664">mu</a></span><span class="op" id="7861818">.</span><span class="ident" id="7861819">RWLock</span><span class="op" id="7861825">(</span><span class="builtintype" id="7861826">false</span><span class="op" id="7861831">)</span>&nbsp;<span class="op" id="7861833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861837"><a href="/net/fd_mutex_test.go.html#7861643">t</a></span><span class="op" id="7861838">.</span><span class="ident" id="7861839">Fatal</span><span class="op" id="7861844">(</span><span class="string" id="7861845">&#34;broken&#34;</span><span class="op" id="7861853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861859">if</span>&nbsp;<span class="ident" id="7861862"><a href="/net/fd_mutex_test.go.html#7861664">mu</a></span><span class="op" id="7861864">.</span><span class="ident" id="7861865">IncrefAndClose</span><span class="op" id="7861879">(</span><span class="op" id="7861880">)</span>&nbsp;<span class="op" id="7861882">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861886"><a href="/net/fd_mutex_test.go.html#7861643">t</a></span><span class="op" id="7861887">.</span><span class="ident" id="7861888">Fatal</span><span class="op" id="7861893">(</span><span class="string" id="7861894">&#34;broken&#34;</span><span class="op" id="7861902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861905">}</span><br>
<span class="lineno"></span><span class="op" id="7861907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7861910">func</span>&nbsp;<span class="ident" id="7861915">TestMutexCloseUnblock</span><span class="op" id="7861936">(</span><span class="ident" id="7861937">t</span>&nbsp;<span class="op" id="7861939">*</span><span class="ident" id="7861940"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7861947">.</span><span class="ident" id="7861948">T</span><span class="op" id="7861949">)</span>&nbsp;<span class="op" id="7861951">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861954">c</span>&nbsp;<span class="op" id="7861956">:=</span>&nbsp;<span class="builtinfunc" id="7861959">make</span><span class="op" id="7861963">(</span><span class="keyword" id="7861964">chan</span>&nbsp;<span class="builtintype" id="7861969">bool</span><span class="op" id="7861973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861976">var</span>&nbsp;<span class="ident" id="7861980">mu</span>&nbsp;<span class="ident" id="7861983"><a href="/net/fd_mutex.go.html#1380501">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861992"><a href="/net/fd_mutex_test.go.html#7861980">mu</a></span><span class="op" id="7861994">.</span><span class="ident" id="7861995">RWLock</span><span class="op" id="7862001">(</span><span class="builtintype" id="7862002">true</span><span class="op" id="7862006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862009">for</span>&nbsp;<span class="ident" id="7862013">i</span>&nbsp;<span class="op" id="7862015">:=</span>&nbsp;<span class="num" id="7862018">0</span><span class="op" id="7862019">;</span>&nbsp;<span class="ident" id="7862021"><a href="/net/fd_mutex_test.go.html#7862013">i</a></span>&nbsp;<span class="op" id="7862023">&lt;</span>&nbsp;<span class="num" id="7862025">4</span><span class="op" id="7862026">;</span>&nbsp;<span class="ident" id="7862028"><a href="/net/fd_mutex_test.go.html#7862013">i</a></span><span class="op" id="7862029">++</span>&nbsp;<span class="op" id="7862032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862036">go</span>&nbsp;<span class="keyword" id="7862039">func</span><span class="op" id="7862043">(</span><span class="op" id="7862044">)</span>&nbsp;<span class="op" id="7862046">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862051">if</span>&nbsp;<span class="ident" id="7862054"><a href="/net/fd_mutex_test.go.html#7861980">mu</a></span><span class="op" id="7862056">.</span><span class="ident" id="7862057">RWLock</span><span class="op" id="7862063">(</span><span class="builtintype" id="7862064">true</span><span class="op" id="7862068">)</span>&nbsp;<span class="op" id="7862070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862076"><a href="/net/fd_mutex_test.go.html#7861937">t</a></span><span class="op" id="7862077">.</span><span class="ident" id="7862078">Error</span><span class="op" id="7862083">(</span><span class="string" id="7862084">&#34;broken&#34;</span><span class="op" id="7862092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862098">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862113"><a href="/net/fd_mutex_test.go.html#7861954">c</a></span>&nbsp;<span class="op" id="7862115">&lt;-</span>&nbsp;<span class="builtintype" id="7862118">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862125">}</span><span class="op" id="7862126">(</span><span class="op" id="7862127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7862133">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862200"><a href="/net/fd_mutex_test.go.html#7861285">time</a></span><span class="op" id="7862204">.</span><span class="ident" id="7862205">Sleep</span><span class="op" id="7862210">(</span><span class="ident" id="7862211"><a href="/net/fd_mutex_test.go.html#7861285">time</a></span><span class="op" id="7862215">.</span><span class="ident" id="7862216">Millisecond</span><span class="op" id="7862227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862230">select</span>&nbsp;<span class="op" id="7862237">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862240">case</span>&nbsp;<span class="op" id="7862245">&lt;-</span><span class="ident" id="7862247"><a href="/net/fd_mutex_test.go.html#7861954">c</a></span><span class="op" id="7862248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862252"><a href="/net/fd_mutex_test.go.html#7861937">t</a></span><span class="op" id="7862253">.</span><span class="ident" id="7862254">Fatal</span><span class="op" id="7862259">(</span><span class="string" id="7862260">&#34;broken&#34;</span><span class="op" id="7862268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862271">default</span><span class="op" id="7862278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862284"><a href="/net/fd_mutex_test.go.html#7861980">mu</a></span><span class="op" id="7862286">.</span><span class="ident" id="7862287">IncrefAndClose</span><span class="op" id="7862301">(</span><span class="op" id="7862302">)</span>&nbsp;<span class="comment" id="7862304">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862334">for</span>&nbsp;<span class="ident" id="7862338">i</span>&nbsp;<span class="op" id="7862340">:=</span>&nbsp;<span class="num" id="7862343">0</span><span class="op" id="7862344">;</span>&nbsp;<span class="ident" id="7862346"><a href="/net/fd_mutex_test.go.html#7862338">i</a></span>&nbsp;<span class="op" id="7862348">&lt;</span>&nbsp;<span class="num" id="7862350">4</span><span class="op" id="7862351">;</span>&nbsp;<span class="ident" id="7862353"><a href="/net/fd_mutex_test.go.html#7862338">i</a></span><span class="op" id="7862354">++</span>&nbsp;<span class="op" id="7862357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862361">select</span>&nbsp;<span class="op" id="7862368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862372">case</span>&nbsp;<span class="op" id="7862377">&lt;-</span><span class="ident" id="7862379"><a href="/net/fd_mutex_test.go.html#7861954">c</a></span><span class="op" id="7862380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862384">case</span>&nbsp;<span class="op" id="7862389">&lt;-</span><span class="ident" id="7862391"><a href="/net/fd_mutex_test.go.html#7861285">time</a></span><span class="op" id="7862395">.</span><span class="ident" id="7862396">After</span><span class="op" id="7862401">(</span><span class="num" id="7862402">10</span>&nbsp;<span class="op" id="7862405">*</span>&nbsp;<span class="ident" id="7862407"><a href="/net/fd_mutex_test.go.html#7861285">time</a></span><span class="op" id="7862411">.</span><span class="ident" id="7862412">Second</span><span class="op" id="7862418">)</span><span class="op" id="7862419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862424"><a href="/net/fd_mutex_test.go.html#7861937">t</a></span><span class="op" id="7862425">.</span><span class="ident" id="7862426">Fatal</span><span class="op" id="7862431">(</span><span class="string" id="7862432">&#34;broken&#34;</span><span class="op" id="7862440">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862450">if</span>&nbsp;<span class="ident" id="7862453"><a href="/net/fd_mutex_test.go.html#7861980">mu</a></span><span class="op" id="7862455">.</span><span class="ident" id="7862456">Decref</span><span class="op" id="7862462">(</span><span class="op" id="7862463">)</span>&nbsp;<span class="op" id="7862465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862469"><a href="/net/fd_mutex_test.go.html#7861937">t</a></span><span class="op" id="7862470">.</span><span class="ident" id="7862471">Fatal</span><span class="op" id="7862476">(</span><span class="string" id="7862477">&#34;broken&#34;</span><span class="op" id="7862485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862488">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862491">if</span>&nbsp;<span class="op" id="7862494">!</span><span class="ident" id="7862495"><a href="/net/fd_mutex_test.go.html#7861980">mu</a></span><span class="op" id="7862497">.</span><span class="ident" id="7862498">RWUnlock</span><span class="op" id="7862506">(</span><span class="builtintype" id="7862507">true</span><span class="op" id="7862511">)</span>&nbsp;<span class="op" id="7862513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862517"><a href="/net/fd_mutex_test.go.html#7861937">t</a></span><span class="op" id="7862518">.</span><span class="ident" id="7862519">Fatal</span><span class="op" id="7862524">(</span><span class="string" id="7862525">&#34;broken&#34;</span><span class="op" id="7862533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862536">}</span><br>
<span class="lineno"></span><span class="op" id="7862538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7862541">func</span>&nbsp;<span class="ident" id="7862546">TestMutexPanic</span><span class="op" id="7862560">(</span><span class="ident" id="7862561">t</span>&nbsp;<span class="op" id="7862563">*</span><span class="ident" id="7862564"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7862571">.</span><span class="ident" id="7862572">T</span><span class="op" id="7862573">)</span>&nbsp;<span class="op" id="7862575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862578">ensurePanics</span>&nbsp;<span class="op" id="7862591">:=</span>&nbsp;<span class="keyword" id="7862594">func</span><span class="op" id="7862598">(</span><span class="ident" id="7862599">f</span>&nbsp;<span class="keyword" id="7862601">func</span><span class="op" id="7862605">(</span><span class="op" id="7862606">)</span><span class="op" id="7862607">)</span>&nbsp;<span class="op" id="7862609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862613">defer</span>&nbsp;<span class="keyword" id="7862619">func</span><span class="op" id="7862623">(</span><span class="op" id="7862624">)</span>&nbsp;<span class="op" id="7862626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862631">if</span>&nbsp;<span class="builtinfunc" id="7862634">recover</span><span class="op" id="7862641">(</span><span class="op" id="7862642">)</span>&nbsp;<span class="op" id="7862644">==</span>&nbsp;<span class="ident" id="7862647">nil</span>&nbsp;<span class="op" id="7862651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862657"><a href="/net/fd_mutex_test.go.html#7862561">t</a></span><span class="op" id="7862658">.</span><span class="ident" id="7862659">Fatal</span><span class="op" id="7862664">(</span><span class="string" id="7862665">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7862681">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862690">}</span><span class="op" id="7862691">(</span><span class="op" id="7862692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862696"><a href="/net/fd_mutex_test.go.html#7862599">f</a></span><span class="op" id="7862697">(</span><span class="op" id="7862698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7862701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7862705">var</span>&nbsp;<span class="ident" id="7862709">mu</span>&nbsp;<span class="ident" id="7862712"><a href="/net/fd_mutex.go.html#1380501">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862721"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7862733">(</span><span class="keyword" id="7862734">func</span><span class="op" id="7862738">(</span><span class="op" id="7862739">)</span>&nbsp;<span class="op" id="7862741">{</span>&nbsp;<span class="ident" id="7862743"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862745">.</span><span class="ident" id="7862746">Decref</span><span class="op" id="7862752">(</span><span class="op" id="7862753">)</span>&nbsp;<span class="op" id="7862755">}</span><span class="op" id="7862756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862759"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7862771">(</span><span class="keyword" id="7862772">func</span><span class="op" id="7862776">(</span><span class="op" id="7862777">)</span>&nbsp;<span class="op" id="7862779">{</span>&nbsp;<span class="ident" id="7862781"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862783">.</span><span class="ident" id="7862784">RWUnlock</span><span class="op" id="7862792">(</span><span class="builtintype" id="7862793">true</span><span class="op" id="7862797">)</span>&nbsp;<span class="op" id="7862799">}</span><span class="op" id="7862800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862803"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7862815">(</span><span class="keyword" id="7862816">func</span><span class="op" id="7862820">(</span><span class="op" id="7862821">)</span>&nbsp;<span class="op" id="7862823">{</span>&nbsp;<span class="ident" id="7862825"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862827">.</span><span class="ident" id="7862828">RWUnlock</span><span class="op" id="7862836">(</span><span class="builtintype" id="7862837">false</span><span class="op" id="7862842">)</span>&nbsp;<span class="op" id="7862844">}</span><span class="op" id="7862845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862849"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7862861">(</span><span class="keyword" id="7862862">func</span><span class="op" id="7862866">(</span><span class="op" id="7862867">)</span>&nbsp;<span class="op" id="7862869">{</span>&nbsp;<span class="ident" id="7862871"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862873">.</span><span class="ident" id="7862874">Incref</span><span class="op" id="7862880">(</span><span class="op" id="7862881">)</span><span class="op" id="7862882">;</span>&nbsp;<span class="ident" id="7862884"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862886">.</span><span class="ident" id="7862887">Decref</span><span class="op" id="7862893">(</span><span class="op" id="7862894">)</span><span class="op" id="7862895">;</span>&nbsp;<span class="ident" id="7862897"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862899">.</span><span class="ident" id="7862900">Decref</span><span class="op" id="7862906">(</span><span class="op" id="7862907">)</span>&nbsp;<span class="op" id="7862909">}</span><span class="op" id="7862910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862913"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7862925">(</span><span class="keyword" id="7862926">func</span><span class="op" id="7862930">(</span><span class="op" id="7862931">)</span>&nbsp;<span class="op" id="7862933">{</span>&nbsp;<span class="ident" id="7862935"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862937">.</span><span class="ident" id="7862938">RWLock</span><span class="op" id="7862944">(</span><span class="builtintype" id="7862945">true</span><span class="op" id="7862949">)</span><span class="op" id="7862950">;</span>&nbsp;<span class="ident" id="7862952"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862954">.</span><span class="ident" id="7862955">RWUnlock</span><span class="op" id="7862963">(</span><span class="builtintype" id="7862964">true</span><span class="op" id="7862968">)</span><span class="op" id="7862969">;</span>&nbsp;<span class="ident" id="7862971"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7862973">.</span><span class="ident" id="7862974">RWUnlock</span><span class="op" id="7862982">(</span><span class="builtintype" id="7862983">true</span><span class="op" id="7862987">)</span>&nbsp;<span class="op" id="7862989">}</span><span class="op" id="7862990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7862993"><a href="/net/fd_mutex_test.go.html#7862578">ensurePanics</a></span><span class="op" id="7863005">(</span><span class="keyword" id="7863006">func</span><span class="op" id="7863010">(</span><span class="op" id="7863011">)</span>&nbsp;<span class="op" id="7863013">{</span>&nbsp;<span class="ident" id="7863015"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863017">.</span><span class="ident" id="7863018">RWLock</span><span class="op" id="7863024">(</span><span class="builtintype" id="7863025">false</span><span class="op" id="7863030">)</span><span class="op" id="7863031">;</span>&nbsp;<span class="ident" id="7863033"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863035">.</span><span class="ident" id="7863036">RWUnlock</span><span class="op" id="7863044">(</span><span class="builtintype" id="7863045">false</span><span class="op" id="7863050">)</span><span class="op" id="7863051">;</span>&nbsp;<span class="ident" id="7863053"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863055">.</span><span class="ident" id="7863056">RWUnlock</span><span class="op" id="7863064">(</span><span class="builtintype" id="7863065">false</span><span class="op" id="7863070">)</span>&nbsp;<span class="op" id="7863072">}</span><span class="op" id="7863073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7863077">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863115"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863117">.</span><span class="ident" id="7863118">Incref</span><span class="op" id="7863124">(</span><span class="op" id="7863125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863128"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863130">.</span><span class="ident" id="7863131">Decref</span><span class="op" id="7863137">(</span><span class="op" id="7863138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863141"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863143">.</span><span class="ident" id="7863144">RWLock</span><span class="op" id="7863150">(</span><span class="builtintype" id="7863151">true</span><span class="op" id="7863155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863158"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863160">.</span><span class="ident" id="7863161">RWUnlock</span><span class="op" id="7863169">(</span><span class="builtintype" id="7863170">true</span><span class="op" id="7863174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863177"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863179">.</span><span class="ident" id="7863180">RWLock</span><span class="op" id="7863186">(</span><span class="builtintype" id="7863187">false</span><span class="op" id="7863192">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863195"><a href="/net/fd_mutex_test.go.html#7862709">mu</a></span><span class="op" id="7863197">.</span><span class="ident" id="7863198">RWUnlock</span><span class="op" id="7863206">(</span><span class="builtintype" id="7863207">false</span><span class="op" id="7863212">)</span><br>
<span class="lineno"></span><span class="op" id="7863214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863217">func</span>&nbsp;<span class="ident" id="7863222">TestMutexStress</span><span class="op" id="7863237">(</span><span class="ident" id="7863238">t</span>&nbsp;<span class="op" id="7863240">*</span><span class="ident" id="7863241"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7863248">.</span><span class="ident" id="7863249">T</span><span class="op" id="7863250">)</span>&nbsp;<span class="op" id="7863252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863255">P</span>&nbsp;<span class="op" id="7863257">:=</span>&nbsp;<span class="num" id="7863260">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863263">N</span>&nbsp;<span class="op" id="7863265">:=</span>&nbsp;<span class="builtintype" id="7863268">int</span><span class="op" id="7863271">(</span><span class="num" id="7863272">1e6</span><span class="op" id="7863275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863278">if</span>&nbsp;<span class="ident" id="7863281"><a href="/net/fd_mutex_test.go.html#7861274">testing</a></span><span class="op" id="7863288">.</span><span class="ident" id="7863289">Short</span><span class="op" id="7863294">(</span><span class="op" id="7863295">)</span>&nbsp;<span class="op" id="7863297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863301"><a href="/net/fd_mutex_test.go.html#7863255">P</a></span>&nbsp;<span class="op" id="7863303">=</span>&nbsp;<span class="num" id="7863305">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863309"><a href="/net/fd_mutex_test.go.html#7863263">N</a></span>&nbsp;<span class="op" id="7863311">=</span>&nbsp;<span class="num" id="7863313">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863318">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863321">defer</span>&nbsp;<span class="ident" id="7863327"><a href="/net/fd_mutex_test.go.html#7861263">runtime</a></span><span class="op" id="7863334">.</span><span class="ident" id="7863335">GOMAXPROCS</span><span class="op" id="7863345">(</span><span class="ident" id="7863346"><a href="/net/fd_mutex_test.go.html#7861263">runtime</a></span><span class="op" id="7863353">.</span><span class="ident" id="7863354">GOMAXPROCS</span><span class="op" id="7863364">(</span><span class="ident" id="7863365"><a href="/net/fd_mutex_test.go.html#7863255">P</a></span><span class="op" id="7863366">)</span><span class="op" id="7863367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863370">done</span>&nbsp;<span class="op" id="7863375">:=</span>&nbsp;<span class="builtinfunc" id="7863378">make</span><span class="op" id="7863382">(</span><span class="keyword" id="7863383">chan</span>&nbsp;<span class="builtintype" id="7863388">bool</span><span class="op" id="7863392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863395">var</span>&nbsp;<span class="ident" id="7863399">mu</span>&nbsp;<span class="ident" id="7863402"><a href="/net/fd_mutex.go.html#1380501">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863411">var</span>&nbsp;<span class="ident" id="7863415">readState</span>&nbsp;<span class="op" id="7863425">[</span><span class="num" id="7863426">2</span><span class="op" id="7863427">]</span><span class="ident" id="7863428">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863436">var</span>&nbsp;<span class="ident" id="7863440">writeState</span>&nbsp;<span class="op" id="7863451">[</span><span class="num" id="7863452">2</span><span class="op" id="7863453">]</span><span class="ident" id="7863454">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863462">for</span>&nbsp;<span class="ident" id="7863466">p</span>&nbsp;<span class="op" id="7863468">:=</span>&nbsp;<span class="num" id="7863471">0</span><span class="op" id="7863472">;</span>&nbsp;<span class="ident" id="7863474"><a href="/net/fd_mutex_test.go.html#7863466">p</a></span>&nbsp;<span class="op" id="7863476">&lt;</span>&nbsp;<span class="ident" id="7863478"><a href="/net/fd_mutex_test.go.html#7863255">P</a></span><span class="op" id="7863479">;</span>&nbsp;<span class="ident" id="7863481"><a href="/net/fd_mutex_test.go.html#7863466">p</a></span><span class="op" id="7863482">++</span>&nbsp;<span class="op" id="7863485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863489">go</span>&nbsp;<span class="keyword" id="7863492">func</span><span class="op" id="7863496">(</span><span class="op" id="7863497">)</span>&nbsp;<span class="op" id="7863499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863504">r</span>&nbsp;<span class="op" id="7863506">:=</span>&nbsp;<span class="ident" id="7863509"><a href="/net/fd_mutex_test.go.html#7861250">rand</a></span><span class="op" id="7863513">.</span><span class="ident" id="7863514">New</span><span class="op" id="7863517">(</span><span class="ident" id="7863518"><a href="/net/fd_mutex_test.go.html#7861250">rand</a></span><span class="op" id="7863522">.</span><span class="ident" id="7863523">NewSource</span><span class="op" id="7863532">(</span><span class="ident" id="7863533"><a href="/net/fd_mutex_test.go.html#7861250">rand</a></span><span class="op" id="7863537">.</span><span class="ident" id="7863538">Int63</span><span class="op" id="7863543">(</span><span class="op" id="7863544">)</span><span class="op" id="7863545">)</span><span class="op" id="7863546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863551">for</span>&nbsp;<span class="ident" id="7863555">i</span>&nbsp;<span class="op" id="7863557">:=</span>&nbsp;<span class="num" id="7863560">0</span><span class="op" id="7863561">;</span>&nbsp;<span class="ident" id="7863563"><a href="/net/fd_mutex_test.go.html#7863555">i</a></span>&nbsp;<span class="op" id="7863565">&lt;</span>&nbsp;<span class="ident" id="7863567"><a href="/net/fd_mutex_test.go.html#7863263">N</a></span><span class="op" id="7863568">;</span>&nbsp;<span class="ident" id="7863570"><a href="/net/fd_mutex_test.go.html#7863555">i</a></span><span class="op" id="7863571">++</span>&nbsp;<span class="op" id="7863574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863580">switch</span>&nbsp;<span class="ident" id="7863587"><a href="/net/fd_mutex_test.go.html#7863504">r</a></span><span class="op" id="7863588">.</span><span class="ident" id="7863589">Intn</span><span class="op" id="7863593">(</span><span class="num" id="7863594">3</span><span class="op" id="7863595">)</span>&nbsp;<span class="op" id="7863597">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863603">case</span>&nbsp;<span class="num" id="7863608">0</span><span class="op" id="7863609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863616">if</span>&nbsp;<span class="op" id="7863619">!</span><span class="ident" id="7863620"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7863622">.</span><span class="ident" id="7863623">Incref</span><span class="op" id="7863629">(</span><span class="op" id="7863630">)</span>&nbsp;<span class="op" id="7863632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863640"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7863641">.</span><span class="ident" id="7863642">Error</span><span class="op" id="7863647">(</span><span class="string" id="7863648">&#34;broken&#34;</span><span class="op" id="7863656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863664">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863676">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863683">if</span>&nbsp;<span class="ident" id="7863686"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7863688">.</span><span class="ident" id="7863689">Decref</span><span class="op" id="7863695">(</span><span class="op" id="7863696">)</span>&nbsp;<span class="op" id="7863698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863706"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7863707">.</span><span class="ident" id="7863708">Error</span><span class="op" id="7863713">(</span><span class="string" id="7863714">&#34;broken&#34;</span><span class="op" id="7863722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863748">case</span>&nbsp;<span class="num" id="7863753">1</span><span class="op" id="7863754">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863761">if</span>&nbsp;<span class="op" id="7863764">!</span><span class="ident" id="7863765"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7863767">.</span><span class="ident" id="7863768">RWLock</span><span class="op" id="7863774">(</span><span class="builtintype" id="7863775">true</span><span class="op" id="7863779">)</span>&nbsp;<span class="op" id="7863781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863789"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7863790">.</span><span class="ident" id="7863791">Error</span><span class="op" id="7863796">(</span><span class="string" id="7863797">&#34;broken&#34;</span><span class="op" id="7863805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863813">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7863832">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863894">if</span>&nbsp;<span class="ident" id="7863897"><a href="/net/fd_mutex_test.go.html#7863415">readState</a></span><span class="op" id="7863906">[</span><span class="num" id="7863907">0</span><span class="op" id="7863908">]</span>&nbsp;<span class="op" id="7863910">!=</span>&nbsp;<span class="ident" id="7863913"><a href="/net/fd_mutex_test.go.html#7863415">readState</a></span><span class="op" id="7863922">[</span><span class="num" id="7863923">1</span><span class="op" id="7863924">]</span>&nbsp;<span class="op" id="7863926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863934"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7863935">.</span><span class="ident" id="7863936">Error</span><span class="op" id="7863941">(</span><span class="string" id="7863942">&#34;broken&#34;</span><span class="op" id="7863950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863958">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863977"><a href="/net/fd_mutex_test.go.html#7863415">readState</a></span><span class="op" id="7863986">[</span><span class="num" id="7863987">0</span><span class="op" id="7863988">]</span><span class="op" id="7863989">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863997"><a href="/net/fd_mutex_test.go.html#7863415">readState</a></span><span class="op" id="7864006">[</span><span class="num" id="7864007">1</span><span class="op" id="7864008">]</span><span class="op" id="7864009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864017">if</span>&nbsp;<span class="ident" id="7864020"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7864022">.</span><span class="ident" id="7864023">RWUnlock</span><span class="op" id="7864031">(</span><span class="builtintype" id="7864032">true</span><span class="op" id="7864036">)</span>&nbsp;<span class="op" id="7864038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864046"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864047">.</span><span class="ident" id="7864048">Error</span><span class="op" id="7864053">(</span><span class="string" id="7864054">&#34;broken&#34;</span><span class="op" id="7864062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864070">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864082">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864088">case</span>&nbsp;<span class="num" id="7864093">2</span><span class="op" id="7864094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864101">if</span>&nbsp;<span class="op" id="7864104">!</span><span class="ident" id="7864105"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7864107">.</span><span class="ident" id="7864108">RWLock</span><span class="op" id="7864114">(</span><span class="builtintype" id="7864115">false</span><span class="op" id="7864120">)</span>&nbsp;<span class="op" id="7864122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864130"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864131">.</span><span class="ident" id="7864132">Error</span><span class="op" id="7864137">(</span><span class="string" id="7864138">&#34;broken&#34;</span><span class="op" id="7864146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864166">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7864173">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864235">if</span>&nbsp;<span class="ident" id="7864238"><a href="/net/fd_mutex_test.go.html#7863440">writeState</a></span><span class="op" id="7864248">[</span><span class="num" id="7864249">0</span><span class="op" id="7864250">]</span>&nbsp;<span class="op" id="7864252">!=</span>&nbsp;<span class="ident" id="7864255"><a href="/net/fd_mutex_test.go.html#7863440">writeState</a></span><span class="op" id="7864265">[</span><span class="num" id="7864266">1</span><span class="op" id="7864267">]</span>&nbsp;<span class="op" id="7864269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864277"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864278">.</span><span class="ident" id="7864279">Error</span><span class="op" id="7864284">(</span><span class="string" id="7864285">&#34;broken&#34;</span><span class="op" id="7864293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864301">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864313">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864320"><a href="/net/fd_mutex_test.go.html#7863440">writeState</a></span><span class="op" id="7864330">[</span><span class="num" id="7864331">0</span><span class="op" id="7864332">]</span><span class="op" id="7864333">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864341"><a href="/net/fd_mutex_test.go.html#7863440">writeState</a></span><span class="op" id="7864351">[</span><span class="num" id="7864352">1</span><span class="op" id="7864353">]</span><span class="op" id="7864354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864362">if</span>&nbsp;<span class="ident" id="7864365"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7864367">.</span><span class="ident" id="7864368">RWUnlock</span><span class="op" id="7864376">(</span><span class="builtintype" id="7864377">false</span><span class="op" id="7864382">)</span>&nbsp;<span class="op" id="7864384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864392"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864393">.</span><span class="ident" id="7864394">Error</span><span class="op" id="7864399">(</span><span class="string" id="7864400">&#34;broken&#34;</span><span class="op" id="7864408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864416">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864444"><a href="/net/fd_mutex_test.go.html#7863370">done</a></span>&nbsp;<span class="op" id="7864449">&lt;-</span>&nbsp;<span class="builtintype" id="7864452">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864459">}</span><span class="op" id="7864460">(</span><span class="op" id="7864461">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864467">for</span>&nbsp;<span class="ident" id="7864471">p</span>&nbsp;<span class="op" id="7864473">:=</span>&nbsp;<span class="num" id="7864476">0</span><span class="op" id="7864477">;</span>&nbsp;<span class="ident" id="7864479"><a href="/net/fd_mutex_test.go.html#7864471">p</a></span>&nbsp;<span class="op" id="7864481">&lt;</span>&nbsp;<span class="ident" id="7864483"><a href="/net/fd_mutex_test.go.html#7863255">P</a></span><span class="op" id="7864484">;</span>&nbsp;<span class="ident" id="7864486"><a href="/net/fd_mutex_test.go.html#7864471">p</a></span><span class="op" id="7864487">++</span>&nbsp;<span class="op" id="7864490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864494">&lt;-</span><span class="ident" id="7864496"><a href="/net/fd_mutex_test.go.html#7863370">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864505">if</span>&nbsp;<span class="op" id="7864508">!</span><span class="ident" id="7864509"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7864511">.</span><span class="ident" id="7864512">IncrefAndClose</span><span class="op" id="7864526">(</span><span class="op" id="7864527">)</span>&nbsp;<span class="op" id="7864529">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864533"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864534">.</span><span class="ident" id="7864535">Fatal</span><span class="op" id="7864540">(</span><span class="string" id="7864541">&#34;broken&#34;</span><span class="op" id="7864549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864555">if</span>&nbsp;<span class="op" id="7864558">!</span><span class="ident" id="7864559"><a href="/net/fd_mutex_test.go.html#7863399">mu</a></span><span class="op" id="7864561">.</span><span class="ident" id="7864562">Decref</span><span class="op" id="7864568">(</span><span class="op" id="7864569">)</span>&nbsp;<span class="op" id="7864571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864575"><a href="/net/fd_mutex_test.go.html#7863238">t</a></span><span class="op" id="7864576">.</span><span class="ident" id="7864577">Fatal</span><span class="op" id="7864582">(</span><span class="string" id="7864583">&#34;broken&#34;</span><span class="op" id="7864591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864594">}</span><br>
<span class="lineno">195</span><span class="op" id="7864596">}</span>
</div>
</body>
</html>
