<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7080279">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7080334">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7080388">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7080439">package</span>&nbsp;<span class="ident" id="7080447">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7080452">import</span>&nbsp;<span class="op" id="7080459">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080462">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080471">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080487">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080506">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080520">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080536">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080552">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080562">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080569">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080575">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080587">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080594">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080600">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080611">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080628">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080639">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7080650">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7080657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7080660">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7080738">type</span>&nbsp;<span class="ident" id="7080743">zeroSource</span>&nbsp;<span class="keyword" id="7080754">struct</span><span class="op" id="7080760">{</span><span class="op" id="7080761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7080764">func</span>&nbsp;<span class="op" id="7080769">(</span><span class="ident" id="7080770">zeroSource</span><span class="op" id="7080780">)</span>&nbsp;<span class="ident" id="7080782">Read</span><span class="op" id="7080786">(</span><span class="ident" id="7080787">b</span>&nbsp;<span class="op" id="7080789">[</span><span class="op" id="7080790">]</span><span class="builtintype" id="7080791">byte</span><span class="op" id="7080795">)</span>&nbsp;<span class="op" id="7080797">(</span><span class="ident" id="7080798">n</span>&nbsp;<span class="builtintype" id="7080800">int</span><span class="op" id="7080803">,</span>&nbsp;<span class="ident" id="7080805">err</span>&nbsp;<span class="builtintype" id="7080809">error</span><span class="op" id="7080814">)</span>&nbsp;<span class="op" id="7080816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7080819">for</span>&nbsp;<span class="ident" id="7080823">i</span>&nbsp;<span class="op" id="7080825">:=</span>&nbsp;<span class="keyword" id="7080828">range</span>&nbsp;<span class="ident" id="7080834">b</span>&nbsp;<span class="op" id="7080836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7080840">b</span><span class="op" id="7080841">[</span><span class="ident" id="7080842">i</span><span class="op" id="7080843">]</span>&nbsp;<span class="op" id="7080845">=</span>&nbsp;<span class="num" id="7080847">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7080850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7080854">return</span>&nbsp;<span class="builtinfunc" id="7080861">len</span><span class="op" id="7080864">(</span><span class="ident" id="7080865">b</span><span class="op" id="7080866">)</span><span class="op" id="7080867">,</span>&nbsp;<span class="builtintype" id="7080869">nil</span><br>
<span class="lineno"></span><span class="op" id="7080873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7080876">var</span>&nbsp;<span class="ident" id="7080880">testConfig</span>&nbsp;<span class="op" id="7080891">*</span><span class="ident" id="7080892">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7080900">func</span>&nbsp;<span class="ident" id="7080905">init</span><span class="op" id="7080909">(</span><span class="op" id="7080910">)</span>&nbsp;<span class="op" id="7080912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7080915">testConfig</span>&nbsp;<span class="op" id="7080926">=</span>&nbsp;<span class="op" id="7080928">&amp;</span><span class="ident" id="7080929">Config</span><span class="op" id="7080935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7080939">Time</span><span class="op" id="7080943">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7080959">func</span><span class="op" id="7080963">(</span><span class="op" id="7080964">)</span>&nbsp;<span class="ident" id="7080966">time</span><span class="op" id="7080970">.</span><span class="ident" id="7080971">Time</span>&nbsp;<span class="op" id="7080976">{</span>&nbsp;<span class="keyword" id="7080978">return</span>&nbsp;<span class="ident" id="7080985">time</span><span class="op" id="7080989">.</span><span class="ident" id="7080990">Unix</span><span class="op" id="7080994">(</span><span class="num" id="7080995">0</span><span class="op" id="7080996">,</span>&nbsp;<span class="num" id="7080998">0</span><span class="op" id="7080999">)</span>&nbsp;<span class="op" id="7081001">}</span><span class="op" id="7081002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081006">Rand</span><span class="op" id="7081010">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081026">zeroSource</span><span class="op" id="7081036">{</span><span class="op" id="7081037">}</span><span class="op" id="7081038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081042">Certificates</span><span class="op" id="7081054">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7081062">make</span><span class="op" id="7081066">(</span><span class="op" id="7081067">[</span><span class="op" id="7081068">]</span><span class="ident" id="7081069">Certificate</span><span class="op" id="7081080">,</span>&nbsp;<span class="num" id="7081082">2</span><span class="op" id="7081083">)</span><span class="op" id="7081084">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081088">InsecureSkipVerify</span><span class="op" id="7081106">:</span>&nbsp;<span class="builtintype" id="7081108">true</span><span class="op" id="7081112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081116">MinVersion</span><span class="op" id="7081126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081136">VersionSSL30</span><span class="op" id="7081148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081152">MaxVersion</span><span class="op" id="7081162">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081172">VersionTLS12</span><span class="op" id="7081184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7081187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081190">testConfig</span><span class="op" id="7081200">.</span><span class="ident" id="7081201">Certificates</span><span class="op" id="7081213">[</span><span class="num" id="7081214">0</span><span class="op" id="7081215">]</span><span class="op" id="7081216">.</span><span class="ident" id="7081217">Certificate</span>&nbsp;<span class="op" id="7081229">=</span>&nbsp;<span class="op" id="7081231">[</span><span class="op" id="7081232">]</span><span class="op" id="7081233">[</span><span class="op" id="7081234">]</span><span class="builtintype" id="7081235">byte</span><span class="op" id="7081239">{</span><span class="ident" id="7081240">testRSACertificate</span><span class="op" id="7081258">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081261">testConfig</span><span class="op" id="7081271">.</span><span class="ident" id="7081272">Certificates</span><span class="op" id="7081284">[</span><span class="num" id="7081285">0</span><span class="op" id="7081286">]</span><span class="op" id="7081287">.</span><span class="ident" id="7081288">PrivateKey</span>&nbsp;<span class="op" id="7081299">=</span>&nbsp;<span class="ident" id="7081301">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081320">testConfig</span><span class="op" id="7081330">.</span><span class="ident" id="7081331">Certificates</span><span class="op" id="7081343">[</span><span class="num" id="7081344">1</span><span class="op" id="7081345">]</span><span class="op" id="7081346">.</span><span class="ident" id="7081347">Certificate</span>&nbsp;<span class="op" id="7081359">=</span>&nbsp;<span class="op" id="7081361">[</span><span class="op" id="7081362">]</span><span class="op" id="7081363">[</span><span class="op" id="7081364">]</span><span class="builtintype" id="7081365">byte</span><span class="op" id="7081369">{</span><span class="ident" id="7081370">testSNICertificate</span><span class="op" id="7081388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081391">testConfig</span><span class="op" id="7081401">.</span><span class="ident" id="7081402">Certificates</span><span class="op" id="7081414">[</span><span class="num" id="7081415">1</span><span class="op" id="7081416">]</span><span class="op" id="7081417">.</span><span class="ident" id="7081418">PrivateKey</span>&nbsp;<span class="op" id="7081429">=</span>&nbsp;<span class="ident" id="7081431">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081450">testConfig</span><span class="op" id="7081460">.</span><span class="ident" id="7081461">BuildNameToCertificate</span><span class="op" id="7081483">(</span><span class="op" id="7081484">)</span><br>
<span class="lineno"></span><span class="op" id="7081486">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7081489">func</span>&nbsp;<span class="ident" id="7081494">testClientHelloFailure</span><span class="op" id="7081516">(</span><span class="ident" id="7081517">t</span>&nbsp;<span class="op" id="7081519">*</span><span class="ident" id="7081520">testing</span><span class="op" id="7081527">.</span><span class="ident" id="7081528">T</span><span class="op" id="7081529">,</span>&nbsp;<span class="ident" id="7081531">m</span>&nbsp;<span class="ident" id="7081533">handshakeMessage</span><span class="op" id="7081549">,</span>&nbsp;<span class="ident" id="7081551">expectedSubStr</span>&nbsp;<span class="builtintype" id="7081566">string</span><span class="op" id="7081572">)</span>&nbsp;<span class="op" id="7081574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7081577">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7081618">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7081661">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081681">c</span><span class="op" id="7081682">,</span>&nbsp;<span class="ident" id="7081684">s</span>&nbsp;<span class="op" id="7081686">:=</span>&nbsp;<span class="ident" id="7081689">net</span><span class="op" id="7081692">.</span><span class="ident" id="7081693">Pipe</span><span class="op" id="7081697">(</span><span class="op" id="7081698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7081701">go</span>&nbsp;<span class="keyword" id="7081704">func</span><span class="op" id="7081708">(</span><span class="op" id="7081709">)</span>&nbsp;<span class="op" id="7081711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081715">cli</span>&nbsp;<span class="op" id="7081719">:=</span>&nbsp;<span class="ident" id="7081722">Client</span><span class="op" id="7081728">(</span><span class="ident" id="7081729">c</span><span class="op" id="7081730">,</span>&nbsp;<span class="ident" id="7081732">testConfig</span><span class="op" id="7081742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7081746">if</span>&nbsp;<span class="ident" id="7081749">ch</span><span class="op" id="7081751">,</span>&nbsp;<span class="ident" id="7081753">ok</span>&nbsp;<span class="op" id="7081756">:=</span>&nbsp;<span class="ident" id="7081759">m</span><span class="op" id="7081760">.</span><span class="op" id="7081761">(</span><span class="op" id="7081762">*</span><span class="ident" id="7081763">clientHelloMsg</span><span class="op" id="7081777">)</span><span class="op" id="7081778">;</span>&nbsp;<span class="ident" id="7081780">ok</span>&nbsp;<span class="op" id="7081783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081788">cli</span><span class="op" id="7081791">.</span><span class="ident" id="7081792">vers</span>&nbsp;<span class="op" id="7081797">=</span>&nbsp;<span class="ident" id="7081799">ch</span><span class="op" id="7081801">.</span><span class="ident" id="7081802">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7081809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081813">cli</span><span class="op" id="7081816">.</span><span class="ident" id="7081817">writeRecord</span><span class="op" id="7081828">(</span><span class="ident" id="7081829">recordTypeHandshake</span><span class="op" id="7081848">,</span>&nbsp;<span class="ident" id="7081850">m</span><span class="op" id="7081851">.</span><span class="ident" id="7081852">marshal</span><span class="op" id="7081859">(</span><span class="op" id="7081860">)</span><span class="op" id="7081861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081865">c</span><span class="op" id="7081866">.</span><span class="ident" id="7081867">Close</span><span class="op" id="7081872">(</span><span class="op" id="7081873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7081876">}</span><span class="op" id="7081877">(</span><span class="op" id="7081878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081881">err</span>&nbsp;<span class="op" id="7081885">:=</span>&nbsp;<span class="ident" id="7081888">Server</span><span class="op" id="7081894">(</span><span class="ident" id="7081895">s</span><span class="op" id="7081896">,</span>&nbsp;<span class="ident" id="7081898">testConfig</span><span class="op" id="7081908">)</span><span class="op" id="7081909">.</span><span class="ident" id="7081910">Handshake</span><span class="op" id="7081919">(</span><span class="op" id="7081920">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7081923">s</span><span class="op" id="7081924">.</span><span class="ident" id="7081925">Close</span><span class="op" id="7081930">(</span><span class="op" id="7081931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7081934">if</span>&nbsp;<span class="ident" id="7081937">err</span>&nbsp;<span class="op" id="7081941">==</span>&nbsp;<span class="builtintype" id="7081944">nil</span>&nbsp;<span class="op" id="7081948">||</span>&nbsp;<span class="op" id="7081951">!</span><span class="ident" id="7081952">strings</span><span class="op" id="7081959">.</span><span class="ident" id="7081960">Contains</span><span class="op" id="7081968">(</span><span class="ident" id="7081969">err</span><span class="op" id="7081972">.</span><span class="ident" id="7081973">Error</span><span class="op" id="7081978">(</span><span class="op" id="7081979">)</span><span class="op" id="7081980">,</span>&nbsp;<span class="ident" id="7081982">expectedSubStr</span><span class="op" id="7081996">)</span>&nbsp;<span class="op" id="7081998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082002">t</span><span class="op" id="7082003">.</span><span class="ident" id="7082004">Errorf</span><span class="op" id="7082010">(</span><span class="string" id="7082011">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7082060">,</span>&nbsp;<span class="ident" id="7082062">err</span><span class="op" id="7082065">,</span>&nbsp;<span class="ident" id="7082067">expectedSubStr</span><span class="op" id="7082081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082084">}</span><br>
<span class="lineno"></span><span class="op" id="7082086">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7082089">func</span>&nbsp;<span class="ident" id="7082094">TestSimpleError</span><span class="op" id="7082109">(</span><span class="ident" id="7082110">t</span>&nbsp;<span class="op" id="7082112">*</span><span class="ident" id="7082113">testing</span><span class="op" id="7082120">.</span><span class="ident" id="7082121">T</span><span class="op" id="7082122">)</span>&nbsp;<span class="op" id="7082124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082127">testClientHelloFailure</span><span class="op" id="7082149">(</span><span class="ident" id="7082150">t</span><span class="op" id="7082151">,</span>&nbsp;<span class="op" id="7082153">&amp;</span><span class="ident" id="7082154">serverHelloDoneMsg</span><span class="op" id="7082172">{</span><span class="op" id="7082173">}</span><span class="op" id="7082174">,</span>&nbsp;<span class="string" id="7082176">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7082206">)</span><br>
<span class="lineno"></span><span class="op" id="7082208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7082211">var</span>&nbsp;<span class="ident" id="7082215">badProtocolVersions</span>&nbsp;<span class="op" id="7082235">=</span>&nbsp;<span class="op" id="7082237">[</span><span class="op" id="7082238">]</span><span class="builtintype" id="7082239">uint16</span><span class="op" id="7082245">{</span><span class="num" id="7082246">0x0000</span><span class="op" id="7082252">,</span>&nbsp;<span class="num" id="7082254">0x0005</span><span class="op" id="7082260">,</span>&nbsp;<span class="num" id="7082262">0x0100</span><span class="op" id="7082268">,</span>&nbsp;<span class="num" id="7082270">0x0105</span><span class="op" id="7082276">,</span>&nbsp;<span class="num" id="7082278">0x0200</span><span class="op" id="7082284">,</span>&nbsp;<span class="num" id="7082286">0x0205</span><span class="op" id="7082292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7082295">func</span>&nbsp;<span class="ident" id="7082300">TestRejectBadProtocolVersion</span><span class="op" id="7082328">(</span><span class="ident" id="7082329">t</span>&nbsp;<span class="op" id="7082331">*</span><span class="ident" id="7082332">testing</span><span class="op" id="7082339">.</span><span class="ident" id="7082340">T</span><span class="op" id="7082341">)</span>&nbsp;<span class="op" id="7082343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7082346">for</span>&nbsp;<span class="ident" id="7082350">_</span><span class="op" id="7082351">,</span>&nbsp;<span class="ident" id="7082353">v</span>&nbsp;<span class="op" id="7082355">:=</span>&nbsp;<span class="keyword" id="7082358">range</span>&nbsp;<span class="ident" id="7082364">badProtocolVersions</span>&nbsp;<span class="op" id="7082384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082388">testClientHelloFailure</span><span class="op" id="7082410">(</span><span class="ident" id="7082411">t</span><span class="op" id="7082412">,</span>&nbsp;<span class="op" id="7082414">&amp;</span><span class="ident" id="7082415">clientHelloMsg</span><span class="op" id="7082429">{</span><span class="ident" id="7082430">vers</span><span class="op" id="7082434">:</span>&nbsp;<span class="ident" id="7082436">v</span><span class="op" id="7082437">}</span><span class="op" id="7082438">,</span>&nbsp;<span class="string" id="7082440">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7082479">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082482">}</span><br>
<span class="lineno"></span><span class="op" id="7082484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7082487">func</span>&nbsp;<span class="ident" id="7082492">TestNoSuiteOverlap</span><span class="op" id="7082510">(</span><span class="ident" id="7082511">t</span>&nbsp;<span class="op" id="7082513">*</span><span class="ident" id="7082514">testing</span><span class="op" id="7082521">.</span><span class="ident" id="7082522">T</span><span class="op" id="7082523">)</span>&nbsp;<span class="op" id="7082525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082528">clientHello</span>&nbsp;<span class="op" id="7082540">:=</span>&nbsp;<span class="op" id="7082543">&amp;</span><span class="ident" id="7082544">clientHelloMsg</span><span class="op" id="7082558">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082562">vers</span><span class="op" id="7082566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7082582">0x0301</span><span class="op" id="7082588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082592">cipherSuites</span><span class="op" id="7082604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082612">[</span><span class="op" id="7082613">]</span><span class="builtintype" id="7082614">uint16</span><span class="op" id="7082620">{</span><span class="num" id="7082621">0xff00</span><span class="op" id="7082627">}</span><span class="op" id="7082628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082632">compressionMethods</span><span class="op" id="7082650">:</span>&nbsp;<span class="op" id="7082652">[</span><span class="op" id="7082653">]</span><span class="builtintype" id="7082654">uint8</span><span class="op" id="7082659">{</span><span class="num" id="7082660">0</span><span class="op" id="7082661">}</span><span class="op" id="7082662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082668">testClientHelloFailure</span><span class="op" id="7082690">(</span><span class="ident" id="7082691">t</span><span class="op" id="7082692">,</span>&nbsp;<span class="ident" id="7082694">clientHello</span><span class="op" id="7082705">,</span>&nbsp;<span class="string" id="7082707">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7082760">)</span><br>
<span class="lineno">95</span><span class="op" id="7082762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7082765">func</span>&nbsp;<span class="ident" id="7082770">TestNoCompressionOverlap</span><span class="op" id="7082794">(</span><span class="ident" id="7082795">t</span>&nbsp;<span class="op" id="7082797">*</span><span class="ident" id="7082798">testing</span><span class="op" id="7082805">.</span><span class="ident" id="7082806">T</span><span class="op" id="7082807">)</span>&nbsp;<span class="op" id="7082809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082812">clientHello</span>&nbsp;<span class="op" id="7082824">:=</span>&nbsp;<span class="op" id="7082827">&amp;</span><span class="ident" id="7082828">clientHelloMsg</span><span class="op" id="7082842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082846">vers</span><span class="op" id="7082850">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7082866">0x0301</span><span class="op" id="7082872">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082876">cipherSuites</span><span class="op" id="7082888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082896">[</span><span class="op" id="7082897">]</span><span class="builtintype" id="7082898">uint16</span><span class="op" id="7082904">{</span><span class="ident" id="7082905">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7082929">}</span><span class="op" id="7082930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082934">compressionMethods</span><span class="op" id="7082952">:</span>&nbsp;<span class="op" id="7082954">[</span><span class="op" id="7082955">]</span><span class="builtintype" id="7082956">uint8</span><span class="op" id="7082961">{</span><span class="num" id="7082962">0xff</span><span class="op" id="7082966">}</span><span class="op" id="7082967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7082970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7082973">testClientHelloFailure</span><span class="op" id="7082995">(</span><span class="ident" id="7082996">t</span><span class="op" id="7082997">,</span>&nbsp;<span class="ident" id="7082999">clientHello</span><span class="op" id="7083010">,</span>&nbsp;<span class="string" id="7083012">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7083062">)</span><br>
<span class="lineno"></span><span class="op" id="7083064">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7083067">func</span>&nbsp;<span class="ident" id="7083072">TestTLS12OnlyCipherSuites</span><span class="op" id="7083097">(</span><span class="ident" id="7083098">t</span>&nbsp;<span class="op" id="7083100">*</span><span class="ident" id="7083101">testing</span><span class="op" id="7083108">.</span><span class="ident" id="7083109">T</span><span class="op" id="7083110">)</span>&nbsp;<span class="op" id="7083112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083115">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083186">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7083221">var</span>&nbsp;<span class="ident" id="7083225">zeros</span>&nbsp;<span class="op" id="7083231">[</span><span class="num" id="7083232">32</span><span class="op" id="7083234">]</span><span class="builtintype" id="7083235">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083242">clientHello</span>&nbsp;<span class="op" id="7083254">:=</span>&nbsp;<span class="op" id="7083257">&amp;</span><span class="ident" id="7083258">clientHelloMsg</span><span class="op" id="7083272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083276">vers</span><span class="op" id="7083280">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7083284">VersionTLS11</span><span class="op" id="7083296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083300">random</span><span class="op" id="7083306">:</span>&nbsp;<span class="ident" id="7083308">zeros</span><span class="op" id="7083313">[</span><span class="op" id="7083314">:</span><span class="op" id="7083315">]</span><span class="op" id="7083316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083320">cipherSuites</span><span class="op" id="7083332">:</span>&nbsp;<span class="op" id="7083334">[</span><span class="op" id="7083335">]</span><span class="builtintype" id="7083336">uint16</span><span class="op" id="7083342">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083347">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083399">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083447">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7083499">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083541">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7083578">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083583">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7083607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7083611">}</span><span class="op" id="7083612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083616">compressionMethods</span><span class="op" id="7083634">:</span>&nbsp;<span class="op" id="7083636">[</span><span class="op" id="7083637">]</span><span class="builtintype" id="7083638">uint8</span><span class="op" id="7083643">{</span><span class="ident" id="7083644">compressionNone</span><span class="op" id="7083659">}</span><span class="op" id="7083660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083664">supportedCurves</span><span class="op" id="7083679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7083684">[</span><span class="op" id="7083685">]</span><span class="ident" id="7083686">CurveID</span><span class="op" id="7083693">{</span><span class="ident" id="7083694">CurveP256</span><span class="op" id="7083703">,</span>&nbsp;<span class="ident" id="7083705">CurveP384</span><span class="op" id="7083714">,</span>&nbsp;<span class="ident" id="7083716">CurveP521</span><span class="op" id="7083725">}</span><span class="op" id="7083726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083730">supportedPoints</span><span class="op" id="7083745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7083750">[</span><span class="op" id="7083751">]</span><span class="builtintype" id="7083752">uint8</span><span class="op" id="7083757">{</span><span class="ident" id="7083758">pointFormatUncompressed</span><span class="op" id="7083781">}</span><span class="op" id="7083782">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7083785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083789">c</span><span class="op" id="7083790">,</span>&nbsp;<span class="ident" id="7083792">s</span>&nbsp;<span class="op" id="7083794">:=</span>&nbsp;<span class="ident" id="7083797">net</span><span class="op" id="7083800">.</span><span class="ident" id="7083801">Pipe</span><span class="op" id="7083805">(</span><span class="op" id="7083806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7083809">var</span>&nbsp;<span class="ident" id="7083813">reply</span>&nbsp;<span class="keyword" id="7083819">interface</span><span class="op" id="7083828">{</span><span class="op" id="7083829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7083832">var</span>&nbsp;<span class="ident" id="7083836">clientErr</span>&nbsp;<span class="builtintype" id="7083846">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7083853">go</span>&nbsp;<span class="keyword" id="7083856">func</span><span class="op" id="7083860">(</span><span class="op" id="7083861">)</span>&nbsp;<span class="op" id="7083863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083867">cli</span>&nbsp;<span class="op" id="7083871">:=</span>&nbsp;<span class="ident" id="7083874">Client</span><span class="op" id="7083880">(</span><span class="ident" id="7083881">c</span><span class="op" id="7083882">,</span>&nbsp;<span class="ident" id="7083884">testConfig</span><span class="op" id="7083894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083898">cli</span><span class="op" id="7083901">.</span><span class="ident" id="7083902">vers</span>&nbsp;<span class="op" id="7083907">=</span>&nbsp;<span class="ident" id="7083909">clientHello</span><span class="op" id="7083920">.</span><span class="ident" id="7083921">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083928">cli</span><span class="op" id="7083931">.</span><span class="ident" id="7083932">writeRecord</span><span class="op" id="7083943">(</span><span class="ident" id="7083944">recordTypeHandshake</span><span class="op" id="7083963">,</span>&nbsp;<span class="ident" id="7083965">clientHello</span><span class="op" id="7083976">.</span><span class="ident" id="7083977">marshal</span><span class="op" id="7083984">(</span><span class="op" id="7083985">)</span><span class="op" id="7083986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7083990">reply</span><span class="op" id="7083995">,</span>&nbsp;<span class="ident" id="7083997">clientErr</span>&nbsp;<span class="op" id="7084007">=</span>&nbsp;<span class="ident" id="7084009">cli</span><span class="op" id="7084012">.</span><span class="ident" id="7084013">readHandshake</span><span class="op" id="7084026">(</span><span class="op" id="7084027">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084031">c</span><span class="op" id="7084032">.</span><span class="ident" id="7084033">Close</span><span class="op" id="7084038">(</span><span class="op" id="7084039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084042">}</span><span class="op" id="7084043">(</span><span class="op" id="7084044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084047">config</span>&nbsp;<span class="op" id="7084054">:=</span>&nbsp;<span class="op" id="7084057">*</span><span class="ident" id="7084058">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084070">config</span><span class="op" id="7084076">.</span><span class="ident" id="7084077">CipherSuites</span>&nbsp;<span class="op" id="7084090">=</span>&nbsp;<span class="ident" id="7084092">clientHello</span><span class="op" id="7084103">.</span><span class="ident" id="7084104">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084118">Server</span><span class="op" id="7084124">(</span><span class="ident" id="7084125">s</span><span class="op" id="7084126">,</span>&nbsp;<span class="op" id="7084128">&amp;</span><span class="ident" id="7084129">config</span><span class="op" id="7084135">)</span><span class="op" id="7084136">.</span><span class="ident" id="7084137">Handshake</span><span class="op" id="7084146">(</span><span class="op" id="7084147">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084150">s</span><span class="op" id="7084151">.</span><span class="ident" id="7084152">Close</span><span class="op" id="7084157">(</span><span class="op" id="7084158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084161">if</span>&nbsp;<span class="ident" id="7084164">clientErr</span>&nbsp;<span class="op" id="7084174">!=</span>&nbsp;<span class="builtintype" id="7084177">nil</span>&nbsp;<span class="op" id="7084181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084185">t</span><span class="op" id="7084186">.</span><span class="ident" id="7084187">Fatal</span><span class="op" id="7084192">(</span><span class="ident" id="7084193">clientErr</span><span class="op" id="7084202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084208">serverHello</span><span class="op" id="7084219">,</span>&nbsp;<span class="ident" id="7084221">ok</span>&nbsp;<span class="op" id="7084224">:=</span>&nbsp;<span class="ident" id="7084227">reply</span><span class="op" id="7084232">.</span><span class="op" id="7084233">(</span><span class="op" id="7084234">*</span><span class="ident" id="7084235">serverHelloMsg</span><span class="op" id="7084249">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084252">if</span>&nbsp;<span class="op" id="7084255">!</span><span class="ident" id="7084256">ok</span>&nbsp;<span class="op" id="7084259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084263">t</span><span class="op" id="7084264">.</span><span class="ident" id="7084265">Fatalf</span><span class="op" id="7084271">(</span><span class="string" id="7084272">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7084323">,</span>&nbsp;<span class="ident" id="7084325">reply</span><span class="op" id="7084330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084336">if</span>&nbsp;<span class="ident" id="7084339">s</span>&nbsp;<span class="op" id="7084341">:=</span>&nbsp;<span class="ident" id="7084344">serverHello</span><span class="op" id="7084355">.</span><span class="ident" id="7084356">cipherSuite</span><span class="op" id="7084367">;</span>&nbsp;<span class="ident" id="7084369">s</span>&nbsp;<span class="op" id="7084371">!=</span>&nbsp;<span class="ident" id="7084374">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7084399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084403">t</span><span class="op" id="7084404">.</span><span class="ident" id="7084405">Fatalf</span><span class="op" id="7084411">(</span><span class="string" id="7084412">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7084446">,</span>&nbsp;<span class="ident" id="7084448">s</span><span class="op" id="7084449">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084452">}</span><br>
<span class="lineno"></span><span class="op" id="7084454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7084457">func</span>&nbsp;<span class="ident" id="7084462">TestAlertForwarding</span><span class="op" id="7084481">(</span><span class="ident" id="7084482">t</span>&nbsp;<span class="op" id="7084484">*</span><span class="ident" id="7084485">testing</span><span class="op" id="7084492">.</span><span class="ident" id="7084493">T</span><span class="op" id="7084494">)</span>&nbsp;<span class="op" id="7084496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084499">c</span><span class="op" id="7084500">,</span>&nbsp;<span class="ident" id="7084502">s</span>&nbsp;<span class="op" id="7084504">:=</span>&nbsp;<span class="ident" id="7084507">net</span><span class="op" id="7084510">.</span><span class="ident" id="7084511">Pipe</span><span class="op" id="7084515">(</span><span class="op" id="7084516">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084519">go</span>&nbsp;<span class="keyword" id="7084522">func</span><span class="op" id="7084526">(</span><span class="op" id="7084527">)</span>&nbsp;<span class="op" id="7084529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084533">Client</span><span class="op" id="7084539">(</span><span class="ident" id="7084540">c</span><span class="op" id="7084541">,</span>&nbsp;<span class="ident" id="7084543">testConfig</span><span class="op" id="7084553">)</span><span class="op" id="7084554">.</span><span class="ident" id="7084555">sendAlert</span><span class="op" id="7084564">(</span><span class="ident" id="7084565">alertUnknownCA</span><span class="op" id="7084579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084583">c</span><span class="op" id="7084584">.</span><span class="ident" id="7084585">Close</span><span class="op" id="7084590">(</span><span class="op" id="7084591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084594">}</span><span class="op" id="7084595">(</span><span class="op" id="7084596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084600">err</span>&nbsp;<span class="op" id="7084604">:=</span>&nbsp;<span class="ident" id="7084607">Server</span><span class="op" id="7084613">(</span><span class="ident" id="7084614">s</span><span class="op" id="7084615">,</span>&nbsp;<span class="ident" id="7084617">testConfig</span><span class="op" id="7084627">)</span><span class="op" id="7084628">.</span><span class="ident" id="7084629">Handshake</span><span class="op" id="7084638">(</span><span class="op" id="7084639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084642">s</span><span class="op" id="7084643">.</span><span class="ident" id="7084644">Close</span><span class="op" id="7084649">(</span><span class="op" id="7084650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084653">if</span>&nbsp;<span class="ident" id="7084656">e</span><span class="op" id="7084657">,</span>&nbsp;<span class="ident" id="7084659">ok</span>&nbsp;<span class="op" id="7084662">:=</span>&nbsp;<span class="ident" id="7084665">err</span><span class="op" id="7084668">.</span><span class="op" id="7084669">(</span><span class="op" id="7084670">*</span><span class="ident" id="7084671">net</span><span class="op" id="7084674">.</span><span class="ident" id="7084675">OpError</span><span class="op" id="7084682">)</span><span class="op" id="7084683">;</span>&nbsp;<span class="op" id="7084685">!</span><span class="ident" id="7084686">ok</span>&nbsp;<span class="op" id="7084689">||</span>&nbsp;<span class="ident" id="7084692">e</span><span class="op" id="7084693">.</span><span class="ident" id="7084694">Err</span>&nbsp;<span class="op" id="7084698">!=</span>&nbsp;<span class="builtintype" id="7084701">error</span><span class="op" id="7084706">(</span><span class="ident" id="7084707">alertUnknownCA</span><span class="op" id="7084721">)</span>&nbsp;<span class="op" id="7084723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084727">t</span><span class="op" id="7084728">.</span><span class="ident" id="7084729">Errorf</span><span class="op" id="7084735">(</span><span class="string" id="7084736">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7084765">,</span>&nbsp;<span class="ident" id="7084767">err</span><span class="op" id="7084770">,</span>&nbsp;<span class="builtintype" id="7084772">error</span><span class="op" id="7084777">(</span><span class="ident" id="7084778">alertUnknownCA</span><span class="op" id="7084792">)</span><span class="op" id="7084793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084796">}</span><br>
<span class="lineno">165</span><span class="op" id="7084798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7084801">func</span>&nbsp;<span class="ident" id="7084806">TestClose</span><span class="op" id="7084815">(</span><span class="ident" id="7084816">t</span>&nbsp;<span class="op" id="7084818">*</span><span class="ident" id="7084819">testing</span><span class="op" id="7084826">.</span><span class="ident" id="7084827">T</span><span class="op" id="7084828">)</span>&nbsp;<span class="op" id="7084830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084833">c</span><span class="op" id="7084834">,</span>&nbsp;<span class="ident" id="7084836">s</span>&nbsp;<span class="op" id="7084838">:=</span>&nbsp;<span class="ident" id="7084841">net</span><span class="op" id="7084844">.</span><span class="ident" id="7084845">Pipe</span><span class="op" id="7084849">(</span><span class="op" id="7084850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084853">go</span>&nbsp;<span class="ident" id="7084856">c</span><span class="op" id="7084857">.</span><span class="ident" id="7084858">Close</span><span class="op" id="7084863">(</span><span class="op" id="7084864">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084868">err</span>&nbsp;<span class="op" id="7084872">:=</span>&nbsp;<span class="ident" id="7084875">Server</span><span class="op" id="7084881">(</span><span class="ident" id="7084882">s</span><span class="op" id="7084883">,</span>&nbsp;<span class="ident" id="7084885">testConfig</span><span class="op" id="7084895">)</span><span class="op" id="7084896">.</span><span class="ident" id="7084897">Handshake</span><span class="op" id="7084906">(</span><span class="op" id="7084907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084910">s</span><span class="op" id="7084911">.</span><span class="ident" id="7084912">Close</span><span class="op" id="7084917">(</span><span class="op" id="7084918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7084921">if</span>&nbsp;<span class="ident" id="7084924">err</span>&nbsp;<span class="op" id="7084928">!=</span>&nbsp;<span class="ident" id="7084931">io</span><span class="op" id="7084933">.</span><span class="ident" id="7084934">EOF</span>&nbsp;<span class="op" id="7084938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7084942">t</span><span class="op" id="7084943">.</span><span class="ident" id="7084944">Errorf</span><span class="op" id="7084950">(</span><span class="string" id="7084951">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7084980">,</span>&nbsp;<span class="ident" id="7084982">err</span><span class="op" id="7084985">,</span>&nbsp;<span class="ident" id="7084987">io</span><span class="op" id="7084989">.</span><span class="ident" id="7084990">EOF</span><span class="op" id="7084993">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7084996">}</span><br>
<span class="lineno"></span><span class="op" id="7084998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7085001">func</span>&nbsp;<span class="ident" id="7085006">testHandshake</span><span class="op" id="7085019">(</span><span class="ident" id="7085020">clientConfig</span><span class="op" id="7085032">,</span>&nbsp;<span class="ident" id="7085034">serverConfig</span>&nbsp;<span class="op" id="7085047">*</span><span class="ident" id="7085048">Config</span><span class="op" id="7085054">)</span>&nbsp;<span class="op" id="7085056">(</span><span class="ident" id="7085057">state</span>&nbsp;<span class="ident" id="7085063">ConnectionState</span><span class="op" id="7085078">,</span>&nbsp;<span class="ident" id="7085080">err</span>&nbsp;<span class="builtintype" id="7085084">error</span><span class="op" id="7085089">)</span>&nbsp;<span class="op" id="7085091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085094">c</span><span class="op" id="7085095">,</span>&nbsp;<span class="ident" id="7085097">s</span>&nbsp;<span class="op" id="7085099">:=</span>&nbsp;<span class="ident" id="7085102">net</span><span class="op" id="7085105">.</span><span class="ident" id="7085106">Pipe</span><span class="op" id="7085110">(</span><span class="op" id="7085111">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085114">done</span>&nbsp;<span class="op" id="7085119">:=</span>&nbsp;<span class="builtinfunc" id="7085122">make</span><span class="op" id="7085126">(</span><span class="keyword" id="7085127">chan</span>&nbsp;<span class="builtintype" id="7085132">bool</span><span class="op" id="7085136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7085139">go</span>&nbsp;<span class="keyword" id="7085142">func</span><span class="op" id="7085146">(</span><span class="op" id="7085147">)</span>&nbsp;<span class="op" id="7085149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085153">cli</span>&nbsp;<span class="op" id="7085157">:=</span>&nbsp;<span class="ident" id="7085160">Client</span><span class="op" id="7085166">(</span><span class="ident" id="7085167">c</span><span class="op" id="7085168">,</span>&nbsp;<span class="ident" id="7085170">clientConfig</span><span class="op" id="7085182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085186">cli</span><span class="op" id="7085189">.</span><span class="ident" id="7085190">Handshake</span><span class="op" id="7085199">(</span><span class="op" id="7085200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085204">c</span><span class="op" id="7085205">.</span><span class="ident" id="7085206">Close</span><span class="op" id="7085211">(</span><span class="op" id="7085212">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085216">done</span>&nbsp;<span class="op" id="7085221">&lt;-</span>&nbsp;<span class="builtintype" id="7085224">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085230">}</span><span class="op" id="7085231">(</span><span class="op" id="7085232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085235">server</span>&nbsp;<span class="op" id="7085242">:=</span>&nbsp;<span class="ident" id="7085245">Server</span><span class="op" id="7085251">(</span><span class="ident" id="7085252">s</span><span class="op" id="7085253">,</span>&nbsp;<span class="ident" id="7085255">serverConfig</span><span class="op" id="7085267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085270">err</span>&nbsp;<span class="op" id="7085274">=</span>&nbsp;<span class="ident" id="7085276">server</span><span class="op" id="7085282">.</span><span class="ident" id="7085283">Handshake</span><span class="op" id="7085292">(</span><span class="op" id="7085293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7085296">if</span>&nbsp;<span class="ident" id="7085299">err</span>&nbsp;<span class="op" id="7085303">==</span>&nbsp;<span class="builtintype" id="7085306">nil</span>&nbsp;<span class="op" id="7085310">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085314">state</span>&nbsp;<span class="op" id="7085320">=</span>&nbsp;<span class="ident" id="7085322">server</span><span class="op" id="7085328">.</span><span class="ident" id="7085329">ConnectionState</span><span class="op" id="7085344">(</span><span class="op" id="7085345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085351">s</span><span class="op" id="7085352">.</span><span class="ident" id="7085353">Close</span><span class="op" id="7085358">(</span><span class="op" id="7085359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085362">&lt;-</span><span class="ident" id="7085364">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7085370">return</span><br>
<span class="lineno">195</span><span class="op" id="7085377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7085380">func</span>&nbsp;<span class="ident" id="7085385">TestVersion</span><span class="op" id="7085396">(</span><span class="ident" id="7085397">t</span>&nbsp;<span class="op" id="7085399">*</span><span class="ident" id="7085400">testing</span><span class="op" id="7085407">.</span><span class="ident" id="7085408">T</span><span class="op" id="7085409">)</span>&nbsp;<span class="op" id="7085411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085414">serverConfig</span>&nbsp;<span class="op" id="7085427">:=</span>&nbsp;<span class="op" id="7085430">&amp;</span><span class="ident" id="7085431">Config</span><span class="op" id="7085437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085441">Certificates</span><span class="op" id="7085453">:</span>&nbsp;<span class="ident" id="7085455">testConfig</span><span class="op" id="7085465">.</span><span class="ident" id="7085466">Certificates</span><span class="op" id="7085478">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085482">MaxVersion</span><span class="op" id="7085492">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7085496">VersionTLS11</span><span class="op" id="7085508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085514">clientConfig</span>&nbsp;<span class="op" id="7085527">:=</span>&nbsp;<span class="op" id="7085530">&amp;</span><span class="ident" id="7085531">Config</span><span class="op" id="7085537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085541">InsecureSkipVerify</span><span class="op" id="7085559">:</span>&nbsp;<span class="builtintype" id="7085561">true</span><span class="op" id="7085565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085568">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085571">state</span><span class="op" id="7085576">,</span>&nbsp;<span class="ident" id="7085578">err</span>&nbsp;<span class="op" id="7085582">:=</span>&nbsp;<span class="ident" id="7085585">testHandshake</span><span class="op" id="7085598">(</span><span class="ident" id="7085599">clientConfig</span><span class="op" id="7085611">,</span>&nbsp;<span class="ident" id="7085613">serverConfig</span><span class="op" id="7085625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7085628">if</span>&nbsp;<span class="ident" id="7085631">err</span>&nbsp;<span class="op" id="7085635">!=</span>&nbsp;<span class="builtintype" id="7085638">nil</span>&nbsp;<span class="op" id="7085642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085646">t</span><span class="op" id="7085647">.</span><span class="ident" id="7085648">Fatalf</span><span class="op" id="7085654">(</span><span class="string" id="7085655">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7085677">,</span>&nbsp;<span class="ident" id="7085679">err</span><span class="op" id="7085682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7085688">if</span>&nbsp;<span class="ident" id="7085691">state</span><span class="op" id="7085696">.</span><span class="ident" id="7085697">Version</span>&nbsp;<span class="op" id="7085705">!=</span>&nbsp;<span class="ident" id="7085708">VersionTLS11</span>&nbsp;<span class="op" id="7085721">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085725">t</span><span class="op" id="7085726">.</span><span class="ident" id="7085727">Fatalf</span><span class="op" id="7085733">(</span><span class="string" id="7085734">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7085770">,</span>&nbsp;<span class="ident" id="7085772">state</span><span class="op" id="7085777">.</span><span class="ident" id="7085778">Version</span><span class="op" id="7085785">,</span>&nbsp;<span class="ident" id="7085787">VersionTLS11</span><span class="op" id="7085799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7085802">}</span><br>
<span class="lineno"></span><span class="op" id="7085804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7085807">func</span>&nbsp;<span class="ident" id="7085812">TestCipherSuitePreference</span><span class="op" id="7085837">(</span><span class="ident" id="7085838">t</span>&nbsp;<span class="op" id="7085840">*</span><span class="ident" id="7085841">testing</span><span class="op" id="7085848">.</span><span class="ident" id="7085849">T</span><span class="op" id="7085850">)</span>&nbsp;<span class="op" id="7085852">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085855">serverConfig</span>&nbsp;<span class="op" id="7085868">:=</span>&nbsp;<span class="op" id="7085871">&amp;</span><span class="ident" id="7085872">Config</span><span class="op" id="7085878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085882">CipherSuites</span><span class="op" id="7085894">:</span>&nbsp;<span class="op" id="7085896">[</span><span class="op" id="7085897">]</span><span class="builtintype" id="7085898">uint16</span><span class="op" id="7085904">{</span><span class="ident" id="7085905">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7085929">,</span>&nbsp;<span class="ident" id="7085931">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7085959">,</span>&nbsp;<span class="ident" id="7085961">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7085991">}</span><span class="op" id="7085992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7085996">Certificates</span><span class="op" id="7086008">:</span>&nbsp;<span class="ident" id="7086010">testConfig</span><span class="op" id="7086020">.</span><span class="ident" id="7086021">Certificates</span><span class="op" id="7086033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086037">MaxVersion</span><span class="op" id="7086047">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7086051">VersionTLS11</span><span class="op" id="7086063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086066">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086069">clientConfig</span>&nbsp;<span class="op" id="7086082">:=</span>&nbsp;<span class="op" id="7086085">&amp;</span><span class="ident" id="7086086">Config</span><span class="op" id="7086092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086096">CipherSuites</span><span class="op" id="7086108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086116">[</span><span class="op" id="7086117">]</span><span class="builtintype" id="7086118">uint16</span><span class="op" id="7086124">{</span><span class="ident" id="7086125">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7086153">,</span>&nbsp;<span class="ident" id="7086155">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7086179">}</span><span class="op" id="7086180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086184">InsecureSkipVerify</span><span class="op" id="7086202">:</span>&nbsp;<span class="builtintype" id="7086204">true</span><span class="op" id="7086208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086214">state</span><span class="op" id="7086219">,</span>&nbsp;<span class="ident" id="7086221">err</span>&nbsp;<span class="op" id="7086225">:=</span>&nbsp;<span class="ident" id="7086228">testHandshake</span><span class="op" id="7086241">(</span><span class="ident" id="7086242">clientConfig</span><span class="op" id="7086254">,</span>&nbsp;<span class="ident" id="7086256">serverConfig</span><span class="op" id="7086268">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7086271">if</span>&nbsp;<span class="ident" id="7086274">err</span>&nbsp;<span class="op" id="7086278">!=</span>&nbsp;<span class="builtintype" id="7086281">nil</span>&nbsp;<span class="op" id="7086285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086289">t</span><span class="op" id="7086290">.</span><span class="ident" id="7086291">Fatalf</span><span class="op" id="7086297">(</span><span class="string" id="7086298">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7086320">,</span>&nbsp;<span class="ident" id="7086322">err</span><span class="op" id="7086325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7086331">if</span>&nbsp;<span class="ident" id="7086334">state</span><span class="op" id="7086339">.</span><span class="ident" id="7086340">CipherSuite</span>&nbsp;<span class="op" id="7086352">!=</span>&nbsp;<span class="ident" id="7086355">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7086384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7086388">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086451">t</span><span class="op" id="7086452">.</span><span class="ident" id="7086453">Fatalf</span><span class="op" id="7086459">(</span><span class="string" id="7086460">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7086502">,</span>&nbsp;<span class="ident" id="7086504">state</span><span class="op" id="7086509">.</span><span class="ident" id="7086510">CipherSuite</span><span class="op" id="7086521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086528">serverConfig</span><span class="op" id="7086540">.</span><span class="ident" id="7086541">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7086566">=</span>&nbsp;<span class="builtintype" id="7086568">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086574">state</span><span class="op" id="7086579">,</span>&nbsp;<span class="ident" id="7086581">err</span>&nbsp;<span class="op" id="7086585">=</span>&nbsp;<span class="ident" id="7086587">testHandshake</span><span class="op" id="7086600">(</span><span class="ident" id="7086601">clientConfig</span><span class="op" id="7086613">,</span>&nbsp;<span class="ident" id="7086615">serverConfig</span><span class="op" id="7086627">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7086630">if</span>&nbsp;<span class="ident" id="7086633">err</span>&nbsp;<span class="op" id="7086637">!=</span>&nbsp;<span class="builtintype" id="7086640">nil</span>&nbsp;<span class="op" id="7086644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086648">t</span><span class="op" id="7086649">.</span><span class="ident" id="7086650">Fatalf</span><span class="op" id="7086656">(</span><span class="string" id="7086657">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7086679">,</span>&nbsp;<span class="ident" id="7086681">err</span><span class="op" id="7086684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7086690">if</span>&nbsp;<span class="ident" id="7086693">state</span><span class="op" id="7086698">.</span><span class="ident" id="7086699">CipherSuite</span>&nbsp;<span class="op" id="7086711">!=</span>&nbsp;<span class="ident" id="7086714">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7086739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7086743">t</span><span class="op" id="7086744">.</span><span class="ident" id="7086745">Fatalf</span><span class="op" id="7086751">(</span><span class="string" id="7086752">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7086794">,</span>&nbsp;<span class="ident" id="7086796">state</span><span class="op" id="7086801">.</span><span class="ident" id="7086802">CipherSuite</span><span class="op" id="7086813">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7086816">}</span><br>
<span class="lineno"></span><span class="op" id="7086818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7086821">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7086896">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7086912">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7086992">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7087011">type</span>&nbsp;<span class="ident" id="7087016">serverTest</span>&nbsp;<span class="keyword" id="7087027">struct</span>&nbsp;<span class="op" id="7087034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087037">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087110">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087151">name</span>&nbsp;<span class="builtintype" id="7087156">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087164">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087230">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087275">command</span>&nbsp;<span class="op" id="7087283">[</span><span class="op" id="7087284">]</span><span class="builtintype" id="7087285">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087293">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087357">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087391">expectedPeerCerts</span>&nbsp;<span class="op" id="7087409">[</span><span class="op" id="7087410">]</span><span class="builtintype" id="7087411">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087419">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087490">config</span>&nbsp;<span class="op" id="7087497">*</span><span class="ident" id="7087498">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087506">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087580">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087618">expectAlert</span>&nbsp;<span class="builtintype" id="7087630">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087636">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087705">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087777">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7087807">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087815">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087884">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7087957">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7087994">validate</span>&nbsp;<span class="keyword" id="7088003">func</span><span class="op" id="7088007">(</span><span class="ident" id="7088008">ConnectionState</span><span class="op" id="7088023">)</span>&nbsp;<span class="builtintype" id="7088025">error</span><br>
<span class="lineno">270</span><span class="op" id="7088031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7088034">var</span>&nbsp;<span class="ident" id="7088038">defaultClientCommand</span>&nbsp;<span class="op" id="7088059">=</span>&nbsp;<span class="op" id="7088061">[</span><span class="op" id="7088062">]</span><span class="builtintype" id="7088063">string</span><span class="op" id="7088069">{</span><span class="string" id="7088070">&#34;openssl&#34;</span><span class="op" id="7088079">,</span>&nbsp;<span class="string" id="7088081">&#34;s_client&#34;</span><span class="op" id="7088091">,</span>&nbsp;<span class="string" id="7088093">&#34;-no_ticket&#34;</span><span class="op" id="7088105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7088108">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7088184">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7088264">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7088279">func</span>&nbsp;<span class="op" id="7088284">(</span><span class="ident" id="7088285">test</span>&nbsp;<span class="op" id="7088290">*</span><span class="ident" id="7088291">serverTest</span><span class="op" id="7088301">)</span>&nbsp;<span class="ident" id="7088303">connFromCommand</span><span class="op" id="7088318">(</span><span class="op" id="7088319">)</span>&nbsp;<span class="op" id="7088321">(</span><span class="ident" id="7088322">conn</span>&nbsp;<span class="op" id="7088327">*</span><span class="ident" id="7088328">recordingConn</span><span class="op" id="7088341">,</span>&nbsp;<span class="ident" id="7088343">child</span>&nbsp;<span class="op" id="7088349">*</span><span class="ident" id="7088350">exec</span><span class="op" id="7088354">.</span><span class="ident" id="7088355">Cmd</span><span class="op" id="7088358">,</span>&nbsp;<span class="ident" id="7088360">err</span>&nbsp;<span class="builtintype" id="7088364">error</span><span class="op" id="7088369">)</span>&nbsp;<span class="op" id="7088371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088374">l</span><span class="op" id="7088375">,</span>&nbsp;<span class="ident" id="7088377">err</span>&nbsp;<span class="op" id="7088381">:=</span>&nbsp;<span class="ident" id="7088384">net</span><span class="op" id="7088387">.</span><span class="ident" id="7088388">ListenTCP</span><span class="op" id="7088397">(</span><span class="string" id="7088398">&#34;tcp&#34;</span><span class="op" id="7088403">,</span>&nbsp;<span class="op" id="7088405">&amp;</span><span class="ident" id="7088406">net</span><span class="op" id="7088409">.</span><span class="ident" id="7088410">TCPAddr</span><span class="op" id="7088417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088421">IP</span><span class="op" id="7088423">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7088427">net</span><span class="op" id="7088430">.</span><span class="ident" id="7088431">IPv4</span><span class="op" id="7088435">(</span><span class="num" id="7088436">127</span><span class="op" id="7088439">,</span>&nbsp;<span class="num" id="7088441">0</span><span class="op" id="7088442">,</span>&nbsp;<span class="num" id="7088444">0</span><span class="op" id="7088445">,</span>&nbsp;<span class="num" id="7088447">1</span><span class="op" id="7088448">)</span><span class="op" id="7088449">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088453">Port</span><span class="op" id="7088457">:</span>&nbsp;<span class="num" id="7088459">0</span><span class="op" id="7088460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7088463">}</span><span class="op" id="7088464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088467">if</span>&nbsp;<span class="ident" id="7088470">err</span>&nbsp;<span class="op" id="7088474">!=</span>&nbsp;<span class="builtintype" id="7088477">nil</span>&nbsp;<span class="op" id="7088481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088485">return</span>&nbsp;<span class="builtintype" id="7088492">nil</span><span class="op" id="7088495">,</span>&nbsp;<span class="builtintype" id="7088497">nil</span><span class="op" id="7088500">,</span>&nbsp;<span class="ident" id="7088502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7088507">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088510">defer</span>&nbsp;<span class="ident" id="7088516">l</span><span class="op" id="7088517">.</span><span class="ident" id="7088518">Close</span><span class="op" id="7088523">(</span><span class="op" id="7088524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088528">port</span>&nbsp;<span class="op" id="7088533">:=</span>&nbsp;<span class="ident" id="7088536">l</span><span class="op" id="7088537">.</span><span class="ident" id="7088538">Addr</span><span class="op" id="7088542">(</span><span class="op" id="7088543">)</span><span class="op" id="7088544">.</span><span class="op" id="7088545">(</span><span class="op" id="7088546">*</span><span class="ident" id="7088547">net</span><span class="op" id="7088550">.</span><span class="ident" id="7088551">TCPAddr</span><span class="op" id="7088558">)</span><span class="op" id="7088559">.</span><span class="ident" id="7088560">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088567">var</span>&nbsp;<span class="ident" id="7088571">command</span>&nbsp;<span class="op" id="7088579">[</span><span class="op" id="7088580">]</span><span class="builtintype" id="7088581">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088589">command</span>&nbsp;<span class="op" id="7088597">=</span>&nbsp;<span class="builtinfunc" id="7088599">append</span><span class="op" id="7088605">(</span><span class="ident" id="7088606">command</span><span class="op" id="7088613">,</span>&nbsp;<span class="ident" id="7088615">test</span><span class="op" id="7088619">.</span><span class="ident" id="7088620">command</span><span class="op" id="7088627">...</span><span class="op" id="7088630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088633">if</span>&nbsp;<span class="builtinfunc" id="7088636">len</span><span class="op" id="7088639">(</span><span class="ident" id="7088640">command</span><span class="op" id="7088647">)</span>&nbsp;<span class="op" id="7088649">==</span>&nbsp;<span class="num" id="7088652">0</span>&nbsp;<span class="op" id="7088654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088658">command</span>&nbsp;<span class="op" id="7088666">=</span>&nbsp;<span class="ident" id="7088668">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7088690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088693">command</span>&nbsp;<span class="op" id="7088701">=</span>&nbsp;<span class="builtinfunc" id="7088703">append</span><span class="op" id="7088709">(</span><span class="ident" id="7088710">command</span><span class="op" id="7088717">,</span>&nbsp;<span class="string" id="7088719">&#34;-connect&#34;</span><span class="op" id="7088729">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088732">command</span>&nbsp;<span class="op" id="7088740">=</span>&nbsp;<span class="builtinfunc" id="7088742">append</span><span class="op" id="7088748">(</span><span class="ident" id="7088749">command</span><span class="op" id="7088756">,</span>&nbsp;<span class="ident" id="7088758">fmt</span><span class="op" id="7088761">.</span><span class="ident" id="7088762">Sprintf</span><span class="op" id="7088769">(</span><span class="string" id="7088770">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7088784">,</span>&nbsp;<span class="ident" id="7088786">port</span><span class="op" id="7088790">)</span><span class="op" id="7088791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088794">cmd</span>&nbsp;<span class="op" id="7088798">:=</span>&nbsp;<span class="ident" id="7088801">exec</span><span class="op" id="7088805">.</span><span class="ident" id="7088806">Command</span><span class="op" id="7088813">(</span><span class="ident" id="7088814">command</span><span class="op" id="7088821">[</span><span class="num" id="7088822">0</span><span class="op" id="7088823">]</span><span class="op" id="7088824">,</span>&nbsp;<span class="ident" id="7088826">command</span><span class="op" id="7088833">[</span><span class="num" id="7088834">1</span><span class="op" id="7088835">:</span><span class="op" id="7088836">]</span><span class="op" id="7088837">...</span><span class="op" id="7088840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088843">cmd</span><span class="op" id="7088846">.</span><span class="ident" id="7088847">Stdin</span>&nbsp;<span class="op" id="7088853">=</span>&nbsp;<span class="builtintype" id="7088855">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088860">var</span>&nbsp;<span class="ident" id="7088864">output</span>&nbsp;<span class="ident" id="7088871">bytes</span><span class="op" id="7088876">.</span><span class="ident" id="7088877">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088885">cmd</span><span class="op" id="7088888">.</span><span class="ident" id="7088889">Stdout</span>&nbsp;<span class="op" id="7088896">=</span>&nbsp;<span class="op" id="7088898">&amp;</span><span class="ident" id="7088899">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088907">cmd</span><span class="op" id="7088910">.</span><span class="ident" id="7088911">Stderr</span>&nbsp;<span class="op" id="7088918">=</span>&nbsp;<span class="op" id="7088920">&amp;</span><span class="ident" id="7088921">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088929">if</span>&nbsp;<span class="ident" id="7088932">err</span>&nbsp;<span class="op" id="7088936">:=</span>&nbsp;<span class="ident" id="7088939">cmd</span><span class="op" id="7088942">.</span><span class="ident" id="7088943">Start</span><span class="op" id="7088948">(</span><span class="op" id="7088949">)</span><span class="op" id="7088950">;</span>&nbsp;<span class="ident" id="7088952">err</span>&nbsp;<span class="op" id="7088956">!=</span>&nbsp;<span class="builtintype" id="7088959">nil</span>&nbsp;<span class="op" id="7088963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7088967">return</span>&nbsp;<span class="builtintype" id="7088974">nil</span><span class="op" id="7088977">,</span>&nbsp;<span class="builtintype" id="7088979">nil</span><span class="op" id="7088982">,</span>&nbsp;<span class="ident" id="7088984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7088989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7088993">connChan</span>&nbsp;<span class="op" id="7089002">:=</span>&nbsp;<span class="builtinfunc" id="7089005">make</span><span class="op" id="7089009">(</span><span class="keyword" id="7089010">chan</span>&nbsp;<span class="keyword" id="7089015">interface</span><span class="op" id="7089024">{</span><span class="op" id="7089025">}</span><span class="op" id="7089026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089029">go</span>&nbsp;<span class="keyword" id="7089032">func</span><span class="op" id="7089036">(</span><span class="op" id="7089037">)</span>&nbsp;<span class="op" id="7089039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089043">tcpConn</span><span class="op" id="7089050">,</span>&nbsp;<span class="ident" id="7089052">err</span>&nbsp;<span class="op" id="7089056">:=</span>&nbsp;<span class="ident" id="7089059">l</span><span class="op" id="7089060">.</span><span class="ident" id="7089061">Accept</span><span class="op" id="7089067">(</span><span class="op" id="7089068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089072">if</span>&nbsp;<span class="ident" id="7089075">err</span>&nbsp;<span class="op" id="7089079">!=</span>&nbsp;<span class="builtintype" id="7089082">nil</span>&nbsp;<span class="op" id="7089086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089091">connChan</span>&nbsp;<span class="op" id="7089100">&lt;-</span>&nbsp;<span class="ident" id="7089103">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089113">connChan</span>&nbsp;<span class="op" id="7089122">&lt;-</span>&nbsp;<span class="ident" id="7089125">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089134">}</span><span class="op" id="7089135">(</span><span class="op" id="7089136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089140">var</span>&nbsp;<span class="ident" id="7089144">tcpConn</span>&nbsp;<span class="ident" id="7089152">net</span><span class="op" id="7089155">.</span><span class="ident" id="7089156">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089162">select</span>&nbsp;<span class="op" id="7089169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089172">case</span>&nbsp;<span class="ident" id="7089177">connOrError</span>&nbsp;<span class="op" id="7089189">:=</span>&nbsp;<span class="op" id="7089192">&lt;-</span><span class="ident" id="7089194">connChan</span><span class="op" id="7089202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089206">if</span>&nbsp;<span class="ident" id="7089209">err</span><span class="op" id="7089212">,</span>&nbsp;<span class="ident" id="7089214">ok</span>&nbsp;<span class="op" id="7089217">:=</span>&nbsp;<span class="ident" id="7089220">connOrError</span><span class="op" id="7089231">.</span><span class="op" id="7089232">(</span><span class="builtintype" id="7089233">error</span><span class="op" id="7089238">)</span><span class="op" id="7089239">;</span>&nbsp;<span class="ident" id="7089241">ok</span>&nbsp;<span class="op" id="7089244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089249">return</span>&nbsp;<span class="builtintype" id="7089256">nil</span><span class="op" id="7089259">,</span>&nbsp;<span class="builtintype" id="7089261">nil</span><span class="op" id="7089264">,</span>&nbsp;<span class="ident" id="7089266">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089272">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089276">tcpConn</span>&nbsp;<span class="op" id="7089284">=</span>&nbsp;<span class="ident" id="7089286">connOrError</span><span class="op" id="7089297">.</span><span class="op" id="7089298">(</span><span class="ident" id="7089299">net</span><span class="op" id="7089302">.</span><span class="ident" id="7089303">Conn</span><span class="op" id="7089307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089310">case</span>&nbsp;<span class="op" id="7089315">&lt;-</span><span class="ident" id="7089317">time</span><span class="op" id="7089321">.</span><span class="ident" id="7089322">After</span><span class="op" id="7089327">(</span><span class="num" id="7089328">2</span>&nbsp;<span class="op" id="7089330">*</span>&nbsp;<span class="ident" id="7089332">time</span><span class="op" id="7089336">.</span><span class="ident" id="7089337">Second</span><span class="op" id="7089343">)</span><span class="op" id="7089344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089348">output</span><span class="op" id="7089354">.</span><span class="ident" id="7089355">WriteTo</span><span class="op" id="7089362">(</span><span class="ident" id="7089363">os</span><span class="op" id="7089365">.</span><span class="ident" id="7089366">Stdout</span><span class="op" id="7089372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089376">return</span>&nbsp;<span class="builtintype" id="7089383">nil</span><span class="op" id="7089386">,</span>&nbsp;<span class="builtintype" id="7089388">nil</span><span class="op" id="7089391">,</span>&nbsp;<span class="ident" id="7089393">errors</span><span class="op" id="7089399">.</span><span class="ident" id="7089400">New</span><span class="op" id="7089403">(</span><span class="string" id="7089404">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7089457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089460">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089464">record</span>&nbsp;<span class="op" id="7089471">:=</span>&nbsp;<span class="op" id="7089474">&amp;</span><span class="ident" id="7089475">recordingConn</span><span class="op" id="7089488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089492">Conn</span><span class="op" id="7089496">:</span>&nbsp;<span class="ident" id="7089498">tcpConn</span><span class="op" id="7089505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089512">return</span>&nbsp;<span class="ident" id="7089519">record</span><span class="op" id="7089525">,</span>&nbsp;<span class="ident" id="7089527">cmd</span><span class="op" id="7089530">,</span>&nbsp;<span class="builtintype" id="7089532">nil</span><br>
<span class="lineno"></span><span class="op" id="7089536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7089539">func</span>&nbsp;<span class="op" id="7089544">(</span><span class="ident" id="7089545">test</span>&nbsp;<span class="op" id="7089550">*</span><span class="ident" id="7089551">serverTest</span><span class="op" id="7089561">)</span>&nbsp;<span class="ident" id="7089563">dataPath</span><span class="op" id="7089571">(</span><span class="op" id="7089572">)</span>&nbsp;<span class="builtintype" id="7089574">string</span>&nbsp;<span class="op" id="7089581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089584">return</span>&nbsp;<span class="ident" id="7089591">filepath</span><span class="op" id="7089599">.</span><span class="ident" id="7089600">Join</span><span class="op" id="7089604">(</span><span class="string" id="7089605">&#34;testdata&#34;</span><span class="op" id="7089615">,</span>&nbsp;<span class="string" id="7089617">&#34;Server-&#34;</span><span class="op" id="7089626">+</span><span class="ident" id="7089627">test</span><span class="op" id="7089631">.</span><span class="ident" id="7089632">name</span><span class="op" id="7089636">)</span><br>
<span class="lineno">335</span><span class="op" id="7089638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7089641">func</span>&nbsp;<span class="op" id="7089646">(</span><span class="ident" id="7089647">test</span>&nbsp;<span class="op" id="7089652">*</span><span class="ident" id="7089653">serverTest</span><span class="op" id="7089663">)</span>&nbsp;<span class="ident" id="7089665">loadData</span><span class="op" id="7089673">(</span><span class="op" id="7089674">)</span>&nbsp;<span class="op" id="7089676">(</span><span class="ident" id="7089677">flows</span>&nbsp;<span class="op" id="7089683">[</span><span class="op" id="7089684">]</span><span class="op" id="7089685">[</span><span class="op" id="7089686">]</span><span class="builtintype" id="7089687">byte</span><span class="op" id="7089691">,</span>&nbsp;<span class="ident" id="7089693">err</span>&nbsp;<span class="builtintype" id="7089697">error</span><span class="op" id="7089702">)</span>&nbsp;<span class="op" id="7089704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7089707">in</span><span class="op" id="7089709">,</span>&nbsp;<span class="ident" id="7089711">err</span>&nbsp;<span class="op" id="7089715">:=</span>&nbsp;<span class="ident" id="7089718">os</span><span class="op" id="7089720">.</span><span class="ident" id="7089721">Open</span><span class="op" id="7089725">(</span><span class="ident" id="7089726">test</span><span class="op" id="7089730">.</span><span class="ident" id="7089731">dataPath</span><span class="op" id="7089739">(</span><span class="op" id="7089740">)</span><span class="op" id="7089741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089744">if</span>&nbsp;<span class="ident" id="7089747">err</span>&nbsp;<span class="op" id="7089751">!=</span>&nbsp;<span class="builtintype" id="7089754">nil</span>&nbsp;<span class="op" id="7089758">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089762">return</span>&nbsp;<span class="builtintype" id="7089769">nil</span><span class="op" id="7089772">,</span>&nbsp;<span class="ident" id="7089774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7089779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089782">defer</span>&nbsp;<span class="ident" id="7089788">in</span><span class="op" id="7089790">.</span><span class="ident" id="7089791">Close</span><span class="op" id="7089796">(</span><span class="op" id="7089797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089800">return</span>&nbsp;<span class="ident" id="7089807">parseTestData</span><span class="op" id="7089820">(</span><span class="ident" id="7089821">in</span><span class="op" id="7089823">)</span><br>
<span class="lineno"></span><span class="op" id="7089825">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7089828">func</span>&nbsp;<span class="op" id="7089833">(</span><span class="ident" id="7089834">test</span>&nbsp;<span class="op" id="7089839">*</span><span class="ident" id="7089840">serverTest</span><span class="op" id="7089850">)</span>&nbsp;<span class="ident" id="7089852">run</span><span class="op" id="7089855">(</span><span class="ident" id="7089856">t</span>&nbsp;<span class="op" id="7089858">*</span><span class="ident" id="7089859">testing</span><span class="op" id="7089866">.</span><span class="ident" id="7089867">T</span><span class="op" id="7089868">,</span>&nbsp;<span class="ident" id="7089870">write</span>&nbsp;<span class="builtintype" id="7089876">bool</span><span class="op" id="7089880">)</span>&nbsp;<span class="op" id="7089882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089885">var</span>&nbsp;<span class="ident" id="7089889">clientConn</span><span class="op" id="7089899">,</span>&nbsp;<span class="ident" id="7089901">serverConn</span>&nbsp;<span class="ident" id="7089912">net</span><span class="op" id="7089915">.</span><span class="ident" id="7089916">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089922">var</span>&nbsp;<span class="ident" id="7089926">recordingConn</span>&nbsp;<span class="op" id="7089940">*</span><span class="ident" id="7089941">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089956">var</span>&nbsp;<span class="ident" id="7089960">childProcess</span>&nbsp;<span class="op" id="7089973">*</span><span class="ident" id="7089974">exec</span><span class="op" id="7089978">.</span><span class="ident" id="7089979">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089985">if</span>&nbsp;<span class="ident" id="7089988">write</span>&nbsp;<span class="op" id="7089994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7089998">var</span>&nbsp;<span class="ident" id="7090002">err</span>&nbsp;<span class="builtintype" id="7090006">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090014">recordingConn</span><span class="op" id="7090027">,</span>&nbsp;<span class="ident" id="7090029">childProcess</span><span class="op" id="7090041">,</span>&nbsp;<span class="ident" id="7090043">err</span>&nbsp;<span class="op" id="7090047">=</span>&nbsp;<span class="ident" id="7090049">test</span><span class="op" id="7090053">.</span><span class="ident" id="7090054">connFromCommand</span><span class="op" id="7090069">(</span><span class="op" id="7090070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090074">if</span>&nbsp;<span class="ident" id="7090077">err</span>&nbsp;<span class="op" id="7090081">!=</span>&nbsp;<span class="builtintype" id="7090084">nil</span>&nbsp;<span class="op" id="7090088">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090093">t</span><span class="op" id="7090094">.</span><span class="ident" id="7090095">Fatalf</span><span class="op" id="7090101">(</span><span class="string" id="7090102">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7090134">,</span>&nbsp;<span class="ident" id="7090136">err</span><span class="op" id="7090139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090147">serverConn</span>&nbsp;<span class="op" id="7090158">=</span>&nbsp;<span class="ident" id="7090160">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090175">}</span>&nbsp;<span class="keyword" id="7090177">else</span>&nbsp;<span class="op" id="7090182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090186">clientConn</span><span class="op" id="7090196">,</span>&nbsp;<span class="ident" id="7090198">serverConn</span>&nbsp;<span class="op" id="7090209">=</span>&nbsp;<span class="ident" id="7090211">net</span><span class="op" id="7090214">.</span><span class="ident" id="7090215">Pipe</span><span class="op" id="7090219">(</span><span class="op" id="7090220">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090226">config</span>&nbsp;<span class="op" id="7090233">:=</span>&nbsp;<span class="ident" id="7090236">test</span><span class="op" id="7090240">.</span><span class="ident" id="7090241">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090249">if</span>&nbsp;<span class="ident" id="7090252">config</span>&nbsp;<span class="op" id="7090259">==</span>&nbsp;<span class="builtintype" id="7090262">nil</span>&nbsp;<span class="op" id="7090266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090270">config</span>&nbsp;<span class="op" id="7090277">=</span>&nbsp;<span class="ident" id="7090279">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090291">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090294">server</span>&nbsp;<span class="op" id="7090301">:=</span>&nbsp;<span class="ident" id="7090304">Server</span><span class="op" id="7090310">(</span><span class="ident" id="7090311">serverConn</span><span class="op" id="7090321">,</span>&nbsp;<span class="ident" id="7090323">config</span><span class="op" id="7090329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090332">connStateChan</span>&nbsp;<span class="op" id="7090346">:=</span>&nbsp;<span class="builtinfunc" id="7090349">make</span><span class="op" id="7090353">(</span><span class="keyword" id="7090354">chan</span>&nbsp;<span class="ident" id="7090359">ConnectionState</span><span class="op" id="7090374">,</span>&nbsp;<span class="num" id="7090376">1</span><span class="op" id="7090377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090380">go</span>&nbsp;<span class="keyword" id="7090383">func</span><span class="op" id="7090387">(</span><span class="op" id="7090388">)</span>&nbsp;<span class="op" id="7090390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090394">var</span>&nbsp;<span class="ident" id="7090398">err</span>&nbsp;<span class="builtintype" id="7090402">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090410">if</span>&nbsp;<span class="ident" id="7090413">_</span><span class="op" id="7090414">,</span>&nbsp;<span class="ident" id="7090416">err</span>&nbsp;<span class="op" id="7090420">=</span>&nbsp;<span class="ident" id="7090422">server</span><span class="op" id="7090428">.</span><span class="ident" id="7090429">Write</span><span class="op" id="7090434">(</span><span class="op" id="7090435">[</span><span class="op" id="7090436">]</span><span class="builtintype" id="7090437">byte</span><span class="op" id="7090441">(</span><span class="string" id="7090442">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7090458">)</span><span class="op" id="7090459">)</span><span class="op" id="7090460">;</span>&nbsp;<span class="ident" id="7090462">err</span>&nbsp;<span class="op" id="7090466">!=</span>&nbsp;<span class="builtintype" id="7090469">nil</span>&nbsp;<span class="op" id="7090473">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090478">t</span><span class="op" id="7090479">.</span><span class="ident" id="7090480">Logf</span><span class="op" id="7090484">(</span><span class="string" id="7090485">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7090514">,</span>&nbsp;<span class="ident" id="7090516">err</span><span class="op" id="7090519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090527">if</span>&nbsp;<span class="builtinfunc" id="7090530">len</span><span class="op" id="7090533">(</span><span class="ident" id="7090534">test</span><span class="op" id="7090538">.</span><span class="ident" id="7090539">expectHandshakeErrorIncluding</span><span class="op" id="7090568">)</span>&nbsp;<span class="op" id="7090570">&gt;</span>&nbsp;<span class="num" id="7090572">0</span>&nbsp;<span class="op" id="7090574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090579">if</span>&nbsp;<span class="ident" id="7090582">err</span>&nbsp;<span class="op" id="7090586">==</span>&nbsp;<span class="builtintype" id="7090589">nil</span>&nbsp;<span class="op" id="7090593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090599">t</span><span class="op" id="7090600">.</span><span class="ident" id="7090601">Errorf</span><span class="op" id="7090607">(</span><span class="string" id="7090608">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7090647">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090652">}</span>&nbsp;<span class="keyword" id="7090654">else</span>&nbsp;<span class="keyword" id="7090659">if</span>&nbsp;<span class="ident" id="7090662">s</span>&nbsp;<span class="op" id="7090664">:=</span>&nbsp;<span class="ident" id="7090667">err</span><span class="op" id="7090670">.</span><span class="ident" id="7090671">Error</span><span class="op" id="7090676">(</span><span class="op" id="7090677">)</span><span class="op" id="7090678">;</span>&nbsp;<span class="op" id="7090680">!</span><span class="ident" id="7090681">strings</span><span class="op" id="7090688">.</span><span class="ident" id="7090689">Contains</span><span class="op" id="7090697">(</span><span class="ident" id="7090698">s</span><span class="op" id="7090699">,</span>&nbsp;<span class="ident" id="7090701">test</span><span class="op" id="7090705">.</span><span class="ident" id="7090706">expectHandshakeErrorIncluding</span><span class="op" id="7090735">)</span>&nbsp;<span class="op" id="7090737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090743">t</span><span class="op" id="7090744">.</span><span class="ident" id="7090745">Errorf</span><span class="op" id="7090751">(</span><span class="string" id="7090752">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7090797">,</span>&nbsp;<span class="ident" id="7090799">test</span><span class="op" id="7090803">.</span><span class="ident" id="7090804">expectHandshakeErrorIncluding</span><span class="op" id="7090833">,</span>&nbsp;<span class="ident" id="7090835">s</span><span class="op" id="7090836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090849">server</span><span class="op" id="7090855">.</span><span class="ident" id="7090856">Close</span><span class="op" id="7090861">(</span><span class="op" id="7090862">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090866">serverConn</span><span class="op" id="7090876">.</span><span class="ident" id="7090877">Close</span><span class="op" id="7090882">(</span><span class="op" id="7090883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090887">connStateChan</span>&nbsp;<span class="op" id="7090901">&lt;-</span>&nbsp;<span class="ident" id="7090904">server</span><span class="op" id="7090910">.</span><span class="ident" id="7090911">ConnectionState</span><span class="op" id="7090926">(</span><span class="op" id="7090927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7090930">}</span><span class="op" id="7090931">(</span><span class="op" id="7090932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090936">if</span>&nbsp;<span class="op" id="7090939">!</span><span class="ident" id="7090940">write</span>&nbsp;<span class="op" id="7090946">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7090950">flows</span><span class="op" id="7090955">,</span>&nbsp;<span class="ident" id="7090957">err</span>&nbsp;<span class="op" id="7090961">:=</span>&nbsp;<span class="ident" id="7090964">test</span><span class="op" id="7090968">.</span><span class="ident" id="7090969">loadData</span><span class="op" id="7090977">(</span><span class="op" id="7090978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7090982">if</span>&nbsp;<span class="ident" id="7090985">err</span>&nbsp;<span class="op" id="7090989">!=</span>&nbsp;<span class="builtintype" id="7090992">nil</span>&nbsp;<span class="op" id="7090996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091001">if</span>&nbsp;<span class="op" id="7091004">!</span><span class="ident" id="7091005">test</span><span class="op" id="7091009">.</span><span class="ident" id="7091010">expectAlert</span>&nbsp;<span class="op" id="7091022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091028">t</span><span class="op" id="7091029">.</span><span class="ident" id="7091030">Fatalf</span><span class="op" id="7091036">(</span><span class="string" id="7091037">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7091070">,</span>&nbsp;<span class="ident" id="7091072">test</span><span class="op" id="7091076">.</span><span class="ident" id="7091077">name</span><span class="op" id="7091081">,</span>&nbsp;<span class="ident" id="7091083">test</span><span class="op" id="7091087">.</span><span class="ident" id="7091088">dataPath</span><span class="op" id="7091096">(</span><span class="op" id="7091097">)</span><span class="op" id="7091098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091103">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091111">for</span>&nbsp;<span class="ident" id="7091115">i</span><span class="op" id="7091116">,</span>&nbsp;<span class="ident" id="7091118">b</span>&nbsp;<span class="op" id="7091120">:=</span>&nbsp;<span class="keyword" id="7091123">range</span>&nbsp;<span class="ident" id="7091129">flows</span>&nbsp;<span class="op" id="7091135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091140">if</span>&nbsp;<span class="ident" id="7091143">i</span><span class="op" id="7091144">%</span><span class="num" id="7091145">2</span>&nbsp;<span class="op" id="7091147">==</span>&nbsp;<span class="num" id="7091150">0</span>&nbsp;<span class="op" id="7091152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091158">clientConn</span><span class="op" id="7091168">.</span><span class="ident" id="7091169">Write</span><span class="op" id="7091174">(</span><span class="ident" id="7091175">b</span><span class="op" id="7091176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091182">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091199">bb</span>&nbsp;<span class="op" id="7091202">:=</span>&nbsp;<span class="builtinfunc" id="7091205">make</span><span class="op" id="7091209">(</span><span class="op" id="7091210">[</span><span class="op" id="7091211">]</span><span class="builtintype" id="7091212">byte</span><span class="op" id="7091216">,</span>&nbsp;<span class="builtinfunc" id="7091218">len</span><span class="op" id="7091221">(</span><span class="ident" id="7091222">b</span><span class="op" id="7091223">)</span><span class="op" id="7091224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091229">n</span><span class="op" id="7091230">,</span>&nbsp;<span class="ident" id="7091232">err</span>&nbsp;<span class="op" id="7091236">:=</span>&nbsp;<span class="ident" id="7091239">io</span><span class="op" id="7091241">.</span><span class="ident" id="7091242">ReadFull</span><span class="op" id="7091250">(</span><span class="ident" id="7091251">clientConn</span><span class="op" id="7091261">,</span>&nbsp;<span class="ident" id="7091263">bb</span><span class="op" id="7091265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091270">if</span>&nbsp;<span class="ident" id="7091273">test</span><span class="op" id="7091277">.</span><span class="ident" id="7091278">expectAlert</span>&nbsp;<span class="op" id="7091290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091296">if</span>&nbsp;<span class="ident" id="7091299">err</span>&nbsp;<span class="op" id="7091303">==</span>&nbsp;<span class="builtintype" id="7091306">nil</span>&nbsp;<span class="op" id="7091310">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091317">t</span><span class="op" id="7091318">.</span><span class="ident" id="7091319">Fatal</span><span class="op" id="7091324">(</span><span class="string" id="7091325">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7091367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091378">}</span>&nbsp;<span class="keyword" id="7091380">else</span>&nbsp;<span class="op" id="7091385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091391">if</span>&nbsp;<span class="ident" id="7091394">err</span>&nbsp;<span class="op" id="7091398">!=</span>&nbsp;<span class="builtintype" id="7091401">nil</span>&nbsp;<span class="op" id="7091405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091412">t</span><span class="op" id="7091413">.</span><span class="ident" id="7091414">Fatalf</span><span class="op" id="7091420">(</span><span class="string" id="7091421">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7091474">,</span>&nbsp;<span class="ident" id="7091476">test</span><span class="op" id="7091480">.</span><span class="ident" id="7091481">name</span><span class="op" id="7091485">,</span>&nbsp;<span class="ident" id="7091487">i</span><span class="op" id="7091488">+</span><span class="num" id="7091489">1</span><span class="op" id="7091490">,</span>&nbsp;<span class="ident" id="7091492">err</span><span class="op" id="7091495">,</span>&nbsp;<span class="ident" id="7091497">n</span><span class="op" id="7091498">,</span>&nbsp;<span class="builtinfunc" id="7091500">len</span><span class="op" id="7091503">(</span><span class="ident" id="7091504">bb</span><span class="op" id="7091506">)</span><span class="op" id="7091507">,</span>&nbsp;<span class="ident" id="7091509">bb</span><span class="op" id="7091511">[</span><span class="op" id="7091512">:</span><span class="ident" id="7091513">n</span><span class="op" id="7091514">]</span><span class="op" id="7091515">,</span>&nbsp;<span class="ident" id="7091517">b</span><span class="op" id="7091518">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091530">if</span>&nbsp;<span class="op" id="7091533">!</span><span class="ident" id="7091534">bytes</span><span class="op" id="7091539">.</span><span class="ident" id="7091540">Equal</span><span class="op" id="7091545">(</span><span class="ident" id="7091546">b</span><span class="op" id="7091547">,</span>&nbsp;<span class="ident" id="7091549">bb</span><span class="op" id="7091551">)</span>&nbsp;<span class="op" id="7091553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091560">t</span><span class="op" id="7091561">.</span><span class="ident" id="7091562">Fatalf</span><span class="op" id="7091568">(</span><span class="string" id="7091569">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7091611">,</span>&nbsp;<span class="ident" id="7091613">test</span><span class="op" id="7091617">.</span><span class="ident" id="7091618">name</span><span class="op" id="7091622">,</span>&nbsp;<span class="ident" id="7091624">i</span><span class="op" id="7091625">+</span><span class="num" id="7091626">1</span><span class="op" id="7091627">,</span>&nbsp;<span class="ident" id="7091629">bb</span><span class="op" id="7091631">,</span>&nbsp;<span class="ident" id="7091633">b</span><span class="op" id="7091634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091645">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091653">clientConn</span><span class="op" id="7091663">.</span><span class="ident" id="7091664">Close</span><span class="op" id="7091669">(</span><span class="op" id="7091670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7091673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091677">connState</span>&nbsp;<span class="op" id="7091687">:=</span>&nbsp;<span class="op" id="7091690">&lt;-</span><span class="ident" id="7091692">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091707">peerCerts</span>&nbsp;<span class="op" id="7091717">:=</span>&nbsp;<span class="ident" id="7091720">connState</span><span class="op" id="7091729">.</span><span class="ident" id="7091730">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091748">if</span>&nbsp;<span class="builtinfunc" id="7091751">len</span><span class="op" id="7091754">(</span><span class="ident" id="7091755">peerCerts</span><span class="op" id="7091764">)</span>&nbsp;<span class="op" id="7091766">==</span>&nbsp;<span class="builtinfunc" id="7091769">len</span><span class="op" id="7091772">(</span><span class="ident" id="7091773">test</span><span class="op" id="7091777">.</span><span class="ident" id="7091778">expectedPeerCerts</span><span class="op" id="7091795">)</span>&nbsp;<span class="op" id="7091797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091801">for</span>&nbsp;<span class="ident" id="7091805">i</span><span class="op" id="7091806">,</span>&nbsp;<span class="ident" id="7091808">peerCert</span>&nbsp;<span class="op" id="7091817">:=</span>&nbsp;<span class="keyword" id="7091820">range</span>&nbsp;<span class="ident" id="7091826">peerCerts</span>&nbsp;<span class="op" id="7091836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091841">block</span><span class="op" id="7091846">,</span>&nbsp;<span class="ident" id="7091848">_</span>&nbsp;<span class="op" id="7091850">:=</span>&nbsp;<span class="ident" id="7091853">pem</span><span class="op" id="7091856">.</span><span class="ident" id="7091857">Decode</span><span class="op" id="7091863">(</span><span class="op" id="7091864">[</span><span class="op" id="7091865">]</span><span class="builtintype" id="7091866">byte</span><span class="op" id="7091870">(</span><span class="ident" id="7091871">test</span><span class="op" id="7091875">.</span><span class="ident" id="7091876">expectedPeerCerts</span><span class="op" id="7091893">[</span><span class="ident" id="7091894">i</span><span class="op" id="7091895">]</span><span class="op" id="7091896">)</span><span class="op" id="7091897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7091902">if</span>&nbsp;<span class="op" id="7091905">!</span><span class="ident" id="7091906">bytes</span><span class="op" id="7091911">.</span><span class="ident" id="7091912">Equal</span><span class="op" id="7091917">(</span><span class="ident" id="7091918">block</span><span class="op" id="7091923">.</span><span class="ident" id="7091924">Bytes</span><span class="op" id="7091929">,</span>&nbsp;<span class="ident" id="7091931">peerCert</span><span class="op" id="7091939">.</span><span class="ident" id="7091940">Raw</span><span class="op" id="7091943">)</span>&nbsp;<span class="op" id="7091945">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7091951">t</span><span class="op" id="7091952">.</span><span class="ident" id="7091953">Fatalf</span><span class="op" id="7091959">(</span><span class="string" id="7091960">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7091990">,</span>&nbsp;<span class="ident" id="7091992">test</span><span class="op" id="7091996">.</span><span class="ident" id="7091997">name</span><span class="op" id="7092001">,</span>&nbsp;<span class="ident" id="7092003">i</span><span class="op" id="7092004">+</span><span class="num" id="7092005">1</span><span class="op" id="7092006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092018">}</span>&nbsp;<span class="keyword" id="7092020">else</span>&nbsp;<span class="op" id="7092025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092029">t</span><span class="op" id="7092030">.</span><span class="ident" id="7092031">Fatalf</span><span class="op" id="7092037">(</span><span class="string" id="7092038">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7092097">,</span>&nbsp;<span class="ident" id="7092099">test</span><span class="op" id="7092103">.</span><span class="ident" id="7092104">name</span><span class="op" id="7092108">,</span>&nbsp;<span class="builtinfunc" id="7092110">len</span><span class="op" id="7092113">(</span><span class="ident" id="7092114">test</span><span class="op" id="7092118">.</span><span class="ident" id="7092119">expectedPeerCerts</span><span class="op" id="7092136">)</span><span class="op" id="7092137">,</span>&nbsp;<span class="builtinfunc" id="7092139">len</span><span class="op" id="7092142">(</span><span class="ident" id="7092143">peerCerts</span><span class="op" id="7092152">)</span><span class="op" id="7092153">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092160">if</span>&nbsp;<span class="ident" id="7092163">test</span><span class="op" id="7092167">.</span><span class="ident" id="7092168">validate</span>&nbsp;<span class="op" id="7092177">!=</span>&nbsp;<span class="builtintype" id="7092180">nil</span>&nbsp;<span class="op" id="7092184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092188">if</span>&nbsp;<span class="ident" id="7092191">err</span>&nbsp;<span class="op" id="7092195">:=</span>&nbsp;<span class="ident" id="7092198">test</span><span class="op" id="7092202">.</span><span class="ident" id="7092203">validate</span><span class="op" id="7092211">(</span><span class="ident" id="7092212">connState</span><span class="op" id="7092221">)</span><span class="op" id="7092222">;</span>&nbsp;<span class="ident" id="7092224">err</span>&nbsp;<span class="op" id="7092228">!=</span>&nbsp;<span class="builtintype" id="7092231">nil</span>&nbsp;<span class="op" id="7092235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092240">t</span><span class="op" id="7092241">.</span><span class="ident" id="7092242">Fatalf</span><span class="op" id="7092248">(</span><span class="string" id="7092249">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7092287">,</span>&nbsp;<span class="ident" id="7092289">err</span><span class="op" id="7092292">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092303">if</span>&nbsp;<span class="ident" id="7092306">write</span>&nbsp;<span class="op" id="7092312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092316">path</span>&nbsp;<span class="op" id="7092321">:=</span>&nbsp;<span class="ident" id="7092324">test</span><span class="op" id="7092328">.</span><span class="ident" id="7092329">dataPath</span><span class="op" id="7092337">(</span><span class="op" id="7092338">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092342">out</span><span class="op" id="7092345">,</span>&nbsp;<span class="ident" id="7092347">err</span>&nbsp;<span class="op" id="7092351">:=</span>&nbsp;<span class="ident" id="7092354">os</span><span class="op" id="7092356">.</span><span class="ident" id="7092357">OpenFile</span><span class="op" id="7092365">(</span><span class="ident" id="7092366">path</span><span class="op" id="7092370">,</span>&nbsp;<span class="ident" id="7092372">os</span><span class="op" id="7092374">.</span><span class="ident" id="7092375">O_WRONLY</span><span class="op" id="7092383">|</span><span class="ident" id="7092384">os</span><span class="op" id="7092386">.</span><span class="ident" id="7092387">O_CREATE</span><span class="op" id="7092395">|</span><span class="ident" id="7092396">os</span><span class="op" id="7092398">.</span><span class="ident" id="7092399">O_TRUNC</span><span class="op" id="7092406">,</span>&nbsp;<span class="num" id="7092408">0644</span><span class="op" id="7092412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092416">if</span>&nbsp;<span class="ident" id="7092419">err</span>&nbsp;<span class="op" id="7092423">!=</span>&nbsp;<span class="builtintype" id="7092426">nil</span>&nbsp;<span class="op" id="7092430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092435">t</span><span class="op" id="7092436">.</span><span class="ident" id="7092437">Fatalf</span><span class="op" id="7092443">(</span><span class="string" id="7092444">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7092478">,</span>&nbsp;<span class="ident" id="7092480">err</span><span class="op" id="7092483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092491">defer</span>&nbsp;<span class="ident" id="7092497">out</span><span class="op" id="7092500">.</span><span class="ident" id="7092501">Close</span><span class="op" id="7092506">(</span><span class="op" id="7092507">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092511">recordingConn</span><span class="op" id="7092524">.</span><span class="ident" id="7092525">Close</span><span class="op" id="7092530">(</span><span class="op" id="7092531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092535">if</span>&nbsp;<span class="builtinfunc" id="7092538">len</span><span class="op" id="7092541">(</span><span class="ident" id="7092542">recordingConn</span><span class="op" id="7092555">.</span><span class="ident" id="7092556">flows</span><span class="op" id="7092561">)</span>&nbsp;<span class="op" id="7092563">&lt;</span>&nbsp;<span class="num" id="7092565">3</span>&nbsp;<span class="op" id="7092567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092572">childProcess</span><span class="op" id="7092584">.</span><span class="ident" id="7092585">Stdout</span><span class="op" id="7092591">.</span><span class="op" id="7092592">(</span><span class="op" id="7092593">*</span><span class="ident" id="7092594">bytes</span><span class="op" id="7092599">.</span><span class="ident" id="7092600">Buffer</span><span class="op" id="7092606">)</span><span class="op" id="7092607">.</span><span class="ident" id="7092608">WriteTo</span><span class="op" id="7092615">(</span><span class="ident" id="7092616">os</span><span class="op" id="7092618">.</span><span class="ident" id="7092619">Stdout</span><span class="op" id="7092625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092630">if</span>&nbsp;<span class="builtinfunc" id="7092633">len</span><span class="op" id="7092636">(</span><span class="ident" id="7092637">test</span><span class="op" id="7092641">.</span><span class="ident" id="7092642">expectHandshakeErrorIncluding</span><span class="op" id="7092671">)</span>&nbsp;<span class="op" id="7092673">==</span>&nbsp;<span class="num" id="7092676">0</span>&nbsp;<span class="op" id="7092678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092684">t</span><span class="op" id="7092685">.</span><span class="ident" id="7092686">Fatalf</span><span class="op" id="7092692">(</span><span class="string" id="7092693">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7092711">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092724">recordingConn</span><span class="op" id="7092737">.</span><span class="ident" id="7092738">WriteTo</span><span class="op" id="7092745">(</span><span class="ident" id="7092746">out</span><span class="op" id="7092749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092753">fmt</span><span class="op" id="7092756">.</span><span class="ident" id="7092757">Printf</span><span class="op" id="7092763">(</span><span class="string" id="7092764">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7092776">,</span>&nbsp;<span class="ident" id="7092778">path</span><span class="op" id="7092782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092786">childProcess</span><span class="op" id="7092798">.</span><span class="ident" id="7092799">Wait</span><span class="op" id="7092803">(</span><span class="op" id="7092804">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7092807">}</span><br>
<span class="lineno"></span><span class="op" id="7092809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7092812">func</span>&nbsp;<span class="ident" id="7092817">runServerTestForVersion</span><span class="op" id="7092840">(</span><span class="ident" id="7092841">t</span>&nbsp;<span class="op" id="7092843">*</span><span class="ident" id="7092844">testing</span><span class="op" id="7092851">.</span><span class="ident" id="7092852">T</span><span class="op" id="7092853">,</span>&nbsp;<span class="ident" id="7092855">template</span>&nbsp;<span class="op" id="7092864">*</span><span class="ident" id="7092865">serverTest</span><span class="op" id="7092875">,</span>&nbsp;<span class="ident" id="7092877">prefix</span><span class="op" id="7092883">,</span>&nbsp;<span class="ident" id="7092885">option</span>&nbsp;<span class="builtintype" id="7092892">string</span><span class="op" id="7092898">)</span>&nbsp;<span class="op" id="7092900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092903">test</span>&nbsp;<span class="op" id="7092908">:=</span>&nbsp;<span class="op" id="7092911">*</span><span class="ident" id="7092912">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092922">test</span><span class="op" id="7092926">.</span><span class="ident" id="7092927">name</span>&nbsp;<span class="op" id="7092932">=</span>&nbsp;<span class="ident" id="7092934">prefix</span>&nbsp;<span class="op" id="7092941">+</span>&nbsp;<span class="ident" id="7092943">test</span><span class="op" id="7092947">.</span><span class="ident" id="7092948">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7092954">if</span>&nbsp;<span class="builtinfunc" id="7092957">len</span><span class="op" id="7092960">(</span><span class="ident" id="7092961">test</span><span class="op" id="7092965">.</span><span class="ident" id="7092966">command</span><span class="op" id="7092973">)</span>&nbsp;<span class="op" id="7092975">==</span>&nbsp;<span class="num" id="7092978">0</span>&nbsp;<span class="op" id="7092980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7092984">test</span><span class="op" id="7092988">.</span><span class="ident" id="7092989">command</span>&nbsp;<span class="op" id="7092997">=</span>&nbsp;<span class="ident" id="7092999">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7093021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093024">test</span><span class="op" id="7093028">.</span><span class="ident" id="7093029">command</span>&nbsp;<span class="op" id="7093037">=</span>&nbsp;<span class="builtinfunc" id="7093039">append</span><span class="op" id="7093045">(</span><span class="op" id="7093046">[</span><span class="op" id="7093047">]</span><span class="builtintype" id="7093048">string</span><span class="op" id="7093054">(</span><span class="builtintype" id="7093055">nil</span><span class="op" id="7093058">)</span><span class="op" id="7093059">,</span>&nbsp;<span class="ident" id="7093061">test</span><span class="op" id="7093065">.</span><span class="ident" id="7093066">command</span><span class="op" id="7093073">...</span><span class="op" id="7093076">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093079">test</span><span class="op" id="7093083">.</span><span class="ident" id="7093084">command</span>&nbsp;<span class="op" id="7093092">=</span>&nbsp;<span class="builtinfunc" id="7093094">append</span><span class="op" id="7093100">(</span><span class="ident" id="7093101">test</span><span class="op" id="7093105">.</span><span class="ident" id="7093106">command</span><span class="op" id="7093113">,</span>&nbsp;<span class="ident" id="7093115">option</span><span class="op" id="7093121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093124">test</span><span class="op" id="7093128">.</span><span class="ident" id="7093129">run</span><span class="op" id="7093132">(</span><span class="ident" id="7093133">t</span><span class="op" id="7093134">,</span>&nbsp;<span class="op" id="7093136">*</span><span class="ident" id="7093137">update</span><span class="op" id="7093143">)</span><br>
<span class="lineno"></span><span class="op" id="7093145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093148">func</span>&nbsp;<span class="ident" id="7093153">runServerTestSSLv3</span><span class="op" id="7093171">(</span><span class="ident" id="7093172">t</span>&nbsp;<span class="op" id="7093174">*</span><span class="ident" id="7093175">testing</span><span class="op" id="7093182">.</span><span class="ident" id="7093183">T</span><span class="op" id="7093184">,</span>&nbsp;<span class="ident" id="7093186">template</span>&nbsp;<span class="op" id="7093195">*</span><span class="ident" id="7093196">serverTest</span><span class="op" id="7093206">)</span>&nbsp;<span class="op" id="7093208">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093211">runServerTestForVersion</span><span class="op" id="7093234">(</span><span class="ident" id="7093235">t</span><span class="op" id="7093236">,</span>&nbsp;<span class="ident" id="7093238">template</span><span class="op" id="7093246">,</span>&nbsp;<span class="string" id="7093248">&#34;SSLv3-&#34;</span><span class="op" id="7093256">,</span>&nbsp;<span class="string" id="7093258">&#34;-ssl3&#34;</span><span class="op" id="7093265">)</span><br>
<span class="lineno"></span><span class="op" id="7093267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093270">func</span>&nbsp;<span class="ident" id="7093275">runServerTestTLS10</span><span class="op" id="7093293">(</span><span class="ident" id="7093294">t</span>&nbsp;<span class="op" id="7093296">*</span><span class="ident" id="7093297">testing</span><span class="op" id="7093304">.</span><span class="ident" id="7093305">T</span><span class="op" id="7093306">,</span>&nbsp;<span class="ident" id="7093308">template</span>&nbsp;<span class="op" id="7093317">*</span><span class="ident" id="7093318">serverTest</span><span class="op" id="7093328">)</span>&nbsp;<span class="op" id="7093330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093333">runServerTestForVersion</span><span class="op" id="7093356">(</span><span class="ident" id="7093357">t</span><span class="op" id="7093358">,</span>&nbsp;<span class="ident" id="7093360">template</span><span class="op" id="7093368">,</span>&nbsp;<span class="string" id="7093370">&#34;TLSv10-&#34;</span><span class="op" id="7093379">,</span>&nbsp;<span class="string" id="7093381">&#34;-tls1&#34;</span><span class="op" id="7093388">)</span><br>
<span class="lineno">470</span><span class="op" id="7093390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093393">func</span>&nbsp;<span class="ident" id="7093398">runServerTestTLS11</span><span class="op" id="7093416">(</span><span class="ident" id="7093417">t</span>&nbsp;<span class="op" id="7093419">*</span><span class="ident" id="7093420">testing</span><span class="op" id="7093427">.</span><span class="ident" id="7093428">T</span><span class="op" id="7093429">,</span>&nbsp;<span class="ident" id="7093431">template</span>&nbsp;<span class="op" id="7093440">*</span><span class="ident" id="7093441">serverTest</span><span class="op" id="7093451">)</span>&nbsp;<span class="op" id="7093453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093456">runServerTestForVersion</span><span class="op" id="7093479">(</span><span class="ident" id="7093480">t</span><span class="op" id="7093481">,</span>&nbsp;<span class="ident" id="7093483">template</span><span class="op" id="7093491">,</span>&nbsp;<span class="string" id="7093493">&#34;TLSv11-&#34;</span><span class="op" id="7093502">,</span>&nbsp;<span class="string" id="7093504">&#34;-tls1_1&#34;</span><span class="op" id="7093513">)</span><br>
<span class="lineno"></span><span class="op" id="7093515">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7093518">func</span>&nbsp;<span class="ident" id="7093523">runServerTestTLS12</span><span class="op" id="7093541">(</span><span class="ident" id="7093542">t</span>&nbsp;<span class="op" id="7093544">*</span><span class="ident" id="7093545">testing</span><span class="op" id="7093552">.</span><span class="ident" id="7093553">T</span><span class="op" id="7093554">,</span>&nbsp;<span class="ident" id="7093556">template</span>&nbsp;<span class="op" id="7093565">*</span><span class="ident" id="7093566">serverTest</span><span class="op" id="7093576">)</span>&nbsp;<span class="op" id="7093578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093581">runServerTestForVersion</span><span class="op" id="7093604">(</span><span class="ident" id="7093605">t</span><span class="op" id="7093606">,</span>&nbsp;<span class="ident" id="7093608">template</span><span class="op" id="7093616">,</span>&nbsp;<span class="string" id="7093618">&#34;TLSv12-&#34;</span><span class="op" id="7093627">,</span>&nbsp;<span class="string" id="7093629">&#34;-tls1_2&#34;</span><span class="op" id="7093638">)</span><br>
<span class="lineno"></span><span class="op" id="7093640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7093643">func</span>&nbsp;<span class="ident" id="7093648">TestHandshakeServerRSARC4</span><span class="op" id="7093673">(</span><span class="ident" id="7093674">t</span>&nbsp;<span class="op" id="7093676">*</span><span class="ident" id="7093677">testing</span><span class="op" id="7093684">.</span><span class="ident" id="7093685">T</span><span class="op" id="7093686">)</span>&nbsp;<span class="op" id="7093688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093691">test</span>&nbsp;<span class="op" id="7093696">:=</span>&nbsp;<span class="op" id="7093699">&amp;</span><span class="ident" id="7093700">serverTest</span><span class="op" id="7093710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093714">name</span><span class="op" id="7093718">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7093723">&#34;RSA-RC4&#34;</span><span class="op" id="7093732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093736">command</span><span class="op" id="7093743">:</span>&nbsp;<span class="op" id="7093745">[</span><span class="op" id="7093746">]</span><span class="builtintype" id="7093747">string</span><span class="op" id="7093753">{</span><span class="string" id="7093754">&#34;openssl&#34;</span><span class="op" id="7093763">,</span>&nbsp;<span class="string" id="7093765">&#34;s_client&#34;</span><span class="op" id="7093775">,</span>&nbsp;<span class="string" id="7093777">&#34;-no_ticket&#34;</span><span class="op" id="7093789">,</span>&nbsp;<span class="string" id="7093791">&#34;-cipher&#34;</span><span class="op" id="7093800">,</span>&nbsp;<span class="string" id="7093802">&#34;RC4-SHA&#34;</span><span class="op" id="7093811">}</span><span class="op" id="7093812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7093815">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093818">runServerTestSSLv3</span><span class="op" id="7093836">(</span><span class="ident" id="7093837">t</span><span class="op" id="7093838">,</span>&nbsp;<span class="ident" id="7093840">test</span><span class="op" id="7093844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093847">runServerTestTLS10</span><span class="op" id="7093865">(</span><span class="ident" id="7093866">t</span><span class="op" id="7093867">,</span>&nbsp;<span class="ident" id="7093869">test</span><span class="op" id="7093873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093876">runServerTestTLS11</span><span class="op" id="7093894">(</span><span class="ident" id="7093895">t</span><span class="op" id="7093896">,</span>&nbsp;<span class="ident" id="7093898">test</span><span class="op" id="7093902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093905">runServerTestTLS12</span><span class="op" id="7093923">(</span><span class="ident" id="7093924">t</span><span class="op" id="7093925">,</span>&nbsp;<span class="ident" id="7093927">test</span><span class="op" id="7093931">)</span><br>
<span class="lineno"></span><span class="op" id="7093933">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7093936">func</span>&nbsp;<span class="ident" id="7093941">TestHandshakeServerRSA3DES</span><span class="op" id="7093967">(</span><span class="ident" id="7093968">t</span>&nbsp;<span class="op" id="7093970">*</span><span class="ident" id="7093971">testing</span><span class="op" id="7093978">.</span><span class="ident" id="7093979">T</span><span class="op" id="7093980">)</span>&nbsp;<span class="op" id="7093982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7093985">test</span>&nbsp;<span class="op" id="7093990">:=</span>&nbsp;<span class="op" id="7093993">&amp;</span><span class="ident" id="7093994">serverTest</span><span class="op" id="7094004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094008">name</span><span class="op" id="7094012">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094017">&#34;RSA-3DES&#34;</span><span class="op" id="7094027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094031">command</span><span class="op" id="7094038">:</span>&nbsp;<span class="op" id="7094040">[</span><span class="op" id="7094041">]</span><span class="builtintype" id="7094042">string</span><span class="op" id="7094048">{</span><span class="string" id="7094049">&#34;openssl&#34;</span><span class="op" id="7094058">,</span>&nbsp;<span class="string" id="7094060">&#34;s_client&#34;</span><span class="op" id="7094070">,</span>&nbsp;<span class="string" id="7094072">&#34;-no_ticket&#34;</span><span class="op" id="7094084">,</span>&nbsp;<span class="string" id="7094086">&#34;-cipher&#34;</span><span class="op" id="7094095">,</span>&nbsp;<span class="string" id="7094097">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7094111">}</span><span class="op" id="7094112">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7094115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094118">runServerTestSSLv3</span><span class="op" id="7094136">(</span><span class="ident" id="7094137">t</span><span class="op" id="7094138">,</span>&nbsp;<span class="ident" id="7094140">test</span><span class="op" id="7094144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094147">runServerTestTLS10</span><span class="op" id="7094165">(</span><span class="ident" id="7094166">t</span><span class="op" id="7094167">,</span>&nbsp;<span class="ident" id="7094169">test</span><span class="op" id="7094173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094176">runServerTestTLS12</span><span class="op" id="7094194">(</span><span class="ident" id="7094195">t</span><span class="op" id="7094196">,</span>&nbsp;<span class="ident" id="7094198">test</span><span class="op" id="7094202">)</span><br>
<span class="lineno"></span><span class="op" id="7094204">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7094207">func</span>&nbsp;<span class="ident" id="7094212">TestHandshakeServerRSAAES</span><span class="op" id="7094237">(</span><span class="ident" id="7094238">t</span>&nbsp;<span class="op" id="7094240">*</span><span class="ident" id="7094241">testing</span><span class="op" id="7094248">.</span><span class="ident" id="7094249">T</span><span class="op" id="7094250">)</span>&nbsp;<span class="op" id="7094252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094255">test</span>&nbsp;<span class="op" id="7094260">:=</span>&nbsp;<span class="op" id="7094263">&amp;</span><span class="ident" id="7094264">serverTest</span><span class="op" id="7094274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094278">name</span><span class="op" id="7094282">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094287">&#34;RSA-AES&#34;</span><span class="op" id="7094296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094300">command</span><span class="op" id="7094307">:</span>&nbsp;<span class="op" id="7094309">[</span><span class="op" id="7094310">]</span><span class="builtintype" id="7094311">string</span><span class="op" id="7094317">{</span><span class="string" id="7094318">&#34;openssl&#34;</span><span class="op" id="7094327">,</span>&nbsp;<span class="string" id="7094329">&#34;s_client&#34;</span><span class="op" id="7094339">,</span>&nbsp;<span class="string" id="7094341">&#34;-no_ticket&#34;</span><span class="op" id="7094353">,</span>&nbsp;<span class="string" id="7094355">&#34;-cipher&#34;</span><span class="op" id="7094364">,</span>&nbsp;<span class="string" id="7094366">&#34;AES128-SHA&#34;</span><span class="op" id="7094378">}</span><span class="op" id="7094379">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7094382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094385">runServerTestSSLv3</span><span class="op" id="7094403">(</span><span class="ident" id="7094404">t</span><span class="op" id="7094405">,</span>&nbsp;<span class="ident" id="7094407">test</span><span class="op" id="7094411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094414">runServerTestTLS10</span><span class="op" id="7094432">(</span><span class="ident" id="7094433">t</span><span class="op" id="7094434">,</span>&nbsp;<span class="ident" id="7094436">test</span><span class="op" id="7094440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094443">runServerTestTLS12</span><span class="op" id="7094461">(</span><span class="ident" id="7094462">t</span><span class="op" id="7094463">,</span>&nbsp;<span class="ident" id="7094465">test</span><span class="op" id="7094469">)</span><br>
<span class="lineno"></span><span class="op" id="7094471">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7094474">func</span>&nbsp;<span class="ident" id="7094479">TestHandshakeServerAESGCM</span><span class="op" id="7094504">(</span><span class="ident" id="7094505">t</span>&nbsp;<span class="op" id="7094507">*</span><span class="ident" id="7094508">testing</span><span class="op" id="7094515">.</span><span class="ident" id="7094516">T</span><span class="op" id="7094517">)</span>&nbsp;<span class="op" id="7094519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094522">test</span>&nbsp;<span class="op" id="7094527">:=</span>&nbsp;<span class="op" id="7094530">&amp;</span><span class="ident" id="7094531">serverTest</span><span class="op" id="7094541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094545">name</span><span class="op" id="7094549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7094554">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7094567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094571">command</span><span class="op" id="7094578">:</span>&nbsp;<span class="op" id="7094580">[</span><span class="op" id="7094581">]</span><span class="builtintype" id="7094582">string</span><span class="op" id="7094588">{</span><span class="string" id="7094589">&#34;openssl&#34;</span><span class="op" id="7094598">,</span>&nbsp;<span class="string" id="7094600">&#34;s_client&#34;</span><span class="op" id="7094610">,</span>&nbsp;<span class="string" id="7094612">&#34;-no_ticket&#34;</span><span class="op" id="7094624">,</span>&nbsp;<span class="string" id="7094626">&#34;-cipher&#34;</span><span class="op" id="7094635">,</span>&nbsp;<span class="string" id="7094637">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7094666">}</span><span class="op" id="7094667">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7094670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094673">runServerTestTLS12</span><span class="op" id="7094691">(</span><span class="ident" id="7094692">t</span><span class="op" id="7094693">,</span>&nbsp;<span class="ident" id="7094695">test</span><span class="op" id="7094699">)</span><br>
<span class="lineno"></span><span class="op" id="7094701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7094704">func</span>&nbsp;<span class="ident" id="7094709">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7094741">(</span><span class="ident" id="7094742">t</span>&nbsp;<span class="op" id="7094744">*</span><span class="ident" id="7094745">testing</span><span class="op" id="7094752">.</span><span class="ident" id="7094753">T</span><span class="op" id="7094754">)</span>&nbsp;<span class="op" id="7094756">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094759">config</span>&nbsp;<span class="op" id="7094766">:=</span>&nbsp;<span class="op" id="7094769">*</span><span class="ident" id="7094770">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094782">config</span><span class="op" id="7094788">.</span><span class="ident" id="7094789">Certificates</span>&nbsp;<span class="op" id="7094802">=</span>&nbsp;<span class="builtinfunc" id="7094804">make</span><span class="op" id="7094808">(</span><span class="op" id="7094809">[</span><span class="op" id="7094810">]</span><span class="ident" id="7094811">Certificate</span><span class="op" id="7094822">,</span>&nbsp;<span class="num" id="7094824">1</span><span class="op" id="7094825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094828">config</span><span class="op" id="7094834">.</span><span class="ident" id="7094835">Certificates</span><span class="op" id="7094847">[</span><span class="num" id="7094848">0</span><span class="op" id="7094849">]</span><span class="op" id="7094850">.</span><span class="ident" id="7094851">Certificate</span>&nbsp;<span class="op" id="7094863">=</span>&nbsp;<span class="op" id="7094865">[</span><span class="op" id="7094866">]</span><span class="op" id="7094867">[</span><span class="op" id="7094868">]</span><span class="builtintype" id="7094869">byte</span><span class="op" id="7094873">{</span><span class="ident" id="7094874">testECDSACertificate</span><span class="op" id="7094894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094897">config</span><span class="op" id="7094903">.</span><span class="ident" id="7094904">Certificates</span><span class="op" id="7094916">[</span><span class="num" id="7094917">0</span><span class="op" id="7094918">]</span><span class="op" id="7094919">.</span><span class="ident" id="7094920">PrivateKey</span>&nbsp;<span class="op" id="7094931">=</span>&nbsp;<span class="ident" id="7094933">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094954">config</span><span class="op" id="7094960">.</span><span class="ident" id="7094961">BuildNameToCertificate</span><span class="op" id="7094983">(</span><span class="op" id="7094984">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094988">test</span>&nbsp;<span class="op" id="7094993">:=</span>&nbsp;<span class="op" id="7094996">&amp;</span><span class="ident" id="7094997">serverTest</span><span class="op" id="7095007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095011">name</span><span class="op" id="7095015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7095020">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7095037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095041">command</span><span class="op" id="7095048">:</span>&nbsp;<span class="op" id="7095050">[</span><span class="op" id="7095051">]</span><span class="builtintype" id="7095052">string</span><span class="op" id="7095058">{</span><span class="string" id="7095059">&#34;openssl&#34;</span><span class="op" id="7095068">,</span>&nbsp;<span class="string" id="7095070">&#34;s_client&#34;</span><span class="op" id="7095080">,</span>&nbsp;<span class="string" id="7095082">&#34;-no_ticket&#34;</span><span class="op" id="7095094">,</span>&nbsp;<span class="string" id="7095096">&#34;-cipher&#34;</span><span class="op" id="7095105">,</span>&nbsp;<span class="string" id="7095107">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7095131">}</span><span class="op" id="7095132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095136">config</span><span class="op" id="7095142">:</span>&nbsp;&nbsp;<span class="op" id="7095145">&amp;</span><span class="ident" id="7095146">config</span><span class="op" id="7095152">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7095155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095158">runServerTestTLS10</span><span class="op" id="7095176">(</span><span class="ident" id="7095177">t</span><span class="op" id="7095178">,</span>&nbsp;<span class="ident" id="7095180">test</span><span class="op" id="7095184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095187">runServerTestTLS12</span><span class="op" id="7095205">(</span><span class="ident" id="7095206">t</span><span class="op" id="7095207">,</span>&nbsp;<span class="ident" id="7095209">test</span><span class="op" id="7095213">)</span><br>
<span class="lineno"></span><span class="op" id="7095215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7095218">func</span>&nbsp;<span class="ident" id="7095223">TestHandshakeServerALPN</span><span class="op" id="7095246">(</span><span class="ident" id="7095247">t</span>&nbsp;<span class="op" id="7095249">*</span><span class="ident" id="7095250">testing</span><span class="op" id="7095257">.</span><span class="ident" id="7095258">T</span><span class="op" id="7095259">)</span>&nbsp;<span class="op" id="7095261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095264">config</span>&nbsp;<span class="op" id="7095271">:=</span>&nbsp;<span class="op" id="7095274">*</span><span class="ident" id="7095275">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095287">config</span><span class="op" id="7095293">.</span><span class="ident" id="7095294">NextProtos</span>&nbsp;<span class="op" id="7095305">=</span>&nbsp;<span class="op" id="7095307">[</span><span class="op" id="7095308">]</span><span class="builtintype" id="7095309">string</span><span class="op" id="7095315">{</span><span class="string" id="7095316">&#34;proto1&#34;</span><span class="op" id="7095324">,</span>&nbsp;<span class="string" id="7095326">&#34;proto2&#34;</span><span class="op" id="7095334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095338">test</span>&nbsp;<span class="op" id="7095343">:=</span>&nbsp;<span class="op" id="7095346">&amp;</span><span class="ident" id="7095347">serverTest</span><span class="op" id="7095357">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095361">name</span><span class="op" id="7095365">:</span>&nbsp;<span class="string" id="7095367">&#34;ALPN&#34;</span><span class="op" id="7095373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7095377">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7095443">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095486">command</span><span class="op" id="7095493">:</span>&nbsp;<span class="op" id="7095495">[</span><span class="op" id="7095496">]</span><span class="builtintype" id="7095497">string</span><span class="op" id="7095503">{</span><span class="string" id="7095504">&#34;openssl&#34;</span><span class="op" id="7095513">,</span>&nbsp;<span class="string" id="7095515">&#34;s_client&#34;</span><span class="op" id="7095525">,</span>&nbsp;<span class="string" id="7095527">&#34;-alpn&#34;</span><span class="op" id="7095534">,</span>&nbsp;<span class="string" id="7095536">&#34;proto2,proto1&#34;</span><span class="op" id="7095551">}</span><span class="op" id="7095552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095556">config</span><span class="op" id="7095562">:</span>&nbsp;&nbsp;<span class="op" id="7095565">&amp;</span><span class="ident" id="7095566">config</span><span class="op" id="7095572">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095576">validate</span><span class="op" id="7095584">:</span>&nbsp;<span class="keyword" id="7095586">func</span><span class="op" id="7095590">(</span><span class="ident" id="7095591">state</span>&nbsp;<span class="ident" id="7095597">ConnectionState</span><span class="op" id="7095612">)</span>&nbsp;<span class="builtintype" id="7095614">error</span>&nbsp;<span class="op" id="7095620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7095625">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7095684">if</span>&nbsp;<span class="ident" id="7095687">state</span><span class="op" id="7095692">.</span><span class="ident" id="7095693">NegotiatedProtocol</span>&nbsp;<span class="op" id="7095712">!=</span>&nbsp;<span class="string" id="7095715">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7095724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7095730">return</span>&nbsp;<span class="ident" id="7095737">fmt</span><span class="op" id="7095740">.</span><span class="ident" id="7095741">Errorf</span><span class="op" id="7095747">(</span><span class="string" id="7095748">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7095780">,</span>&nbsp;<span class="ident" id="7095782">state</span><span class="op" id="7095787">.</span><span class="ident" id="7095788">NegotiatedProtocol</span><span class="op" id="7095806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7095811">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7095816">return</span>&nbsp;<span class="builtintype" id="7095823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7095829">}</span><span class="op" id="7095830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7095833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095836">runServerTestTLS12</span><span class="op" id="7095854">(</span><span class="ident" id="7095855">t</span><span class="op" id="7095856">,</span>&nbsp;<span class="ident" id="7095858">test</span><span class="op" id="7095862">)</span><br>
<span class="lineno"></span><span class="op" id="7095864">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7095867">func</span>&nbsp;<span class="ident" id="7095872">TestHandshakeServerALPNNoMatch</span><span class="op" id="7095902">(</span><span class="ident" id="7095903">t</span>&nbsp;<span class="op" id="7095905">*</span><span class="ident" id="7095906">testing</span><span class="op" id="7095913">.</span><span class="ident" id="7095914">T</span><span class="op" id="7095915">)</span>&nbsp;<span class="op" id="7095917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095920">config</span>&nbsp;<span class="op" id="7095927">:=</span>&nbsp;<span class="op" id="7095930">*</span><span class="ident" id="7095931">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095943">config</span><span class="op" id="7095949">.</span><span class="ident" id="7095950">NextProtos</span>&nbsp;<span class="op" id="7095961">=</span>&nbsp;<span class="op" id="7095963">[</span><span class="op" id="7095964">]</span><span class="builtintype" id="7095965">string</span><span class="op" id="7095971">{</span><span class="string" id="7095972">&#34;proto3&#34;</span><span class="op" id="7095980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7095984">test</span>&nbsp;<span class="op" id="7095989">:=</span>&nbsp;<span class="op" id="7095992">&amp;</span><span class="ident" id="7095993">serverTest</span><span class="op" id="7096003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096007">name</span><span class="op" id="7096011">:</span>&nbsp;<span class="string" id="7096013">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7096027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7096031">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7096097">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096140">command</span><span class="op" id="7096147">:</span>&nbsp;<span class="op" id="7096149">[</span><span class="op" id="7096150">]</span><span class="builtintype" id="7096151">string</span><span class="op" id="7096157">{</span><span class="string" id="7096158">&#34;openssl&#34;</span><span class="op" id="7096167">,</span>&nbsp;<span class="string" id="7096169">&#34;s_client&#34;</span><span class="op" id="7096179">,</span>&nbsp;<span class="string" id="7096181">&#34;-alpn&#34;</span><span class="op" id="7096188">,</span>&nbsp;<span class="string" id="7096190">&#34;proto2,proto1&#34;</span><span class="op" id="7096205">}</span><span class="op" id="7096206">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096210">config</span><span class="op" id="7096216">:</span>&nbsp;&nbsp;<span class="op" id="7096219">&amp;</span><span class="ident" id="7096220">config</span><span class="op" id="7096226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096230">validate</span><span class="op" id="7096238">:</span>&nbsp;<span class="keyword" id="7096240">func</span><span class="op" id="7096244">(</span><span class="ident" id="7096245">state</span>&nbsp;<span class="ident" id="7096251">ConnectionState</span><span class="op" id="7096266">)</span>&nbsp;<span class="builtintype" id="7096268">error</span>&nbsp;<span class="op" id="7096274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7096279">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7096338">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7096381">if</span>&nbsp;<span class="ident" id="7096384">state</span><span class="op" id="7096389">.</span><span class="ident" id="7096390">NegotiatedProtocol</span>&nbsp;<span class="op" id="7096409">!=</span>&nbsp;<span class="string" id="7096412">&#34;&#34;</span>&nbsp;<span class="op" id="7096415">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7096421">return</span>&nbsp;<span class="ident" id="7096428">fmt</span><span class="op" id="7096431">.</span><span class="ident" id="7096432">Errorf</span><span class="op" id="7096438">(</span><span class="string" id="7096439">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7096467">,</span>&nbsp;<span class="ident" id="7096469">state</span><span class="op" id="7096474">.</span><span class="ident" id="7096475">NegotiatedProtocol</span><span class="op" id="7096493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7096498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7096503">return</span>&nbsp;<span class="builtintype" id="7096510">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7096516">}</span><span class="op" id="7096517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7096520">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096523">runServerTestTLS12</span><span class="op" id="7096541">(</span><span class="ident" id="7096542">t</span><span class="op" id="7096543">,</span>&nbsp;<span class="ident" id="7096545">test</span><span class="op" id="7096549">)</span><br>
<span class="lineno"></span><span class="op" id="7096551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096554">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7096626">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7096706">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7096770">func</span>&nbsp;<span class="ident" id="7096775">TestHandshakeServerSNI</span><span class="op" id="7096797">(</span><span class="ident" id="7096798">t</span>&nbsp;<span class="op" id="7096800">*</span><span class="ident" id="7096801">testing</span><span class="op" id="7096808">.</span><span class="ident" id="7096809">T</span><span class="op" id="7096810">)</span>&nbsp;<span class="op" id="7096812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096815">test</span>&nbsp;<span class="op" id="7096820">:=</span>&nbsp;<span class="op" id="7096823">&amp;</span><span class="ident" id="7096824">serverTest</span><span class="op" id="7096834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096838">name</span><span class="op" id="7096842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7096847">&#34;SNI&#34;</span><span class="op" id="7096852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096856">command</span><span class="op" id="7096863">:</span>&nbsp;<span class="op" id="7096865">[</span><span class="op" id="7096866">]</span><span class="builtintype" id="7096867">string</span><span class="op" id="7096873">{</span><span class="string" id="7096874">&#34;openssl&#34;</span><span class="op" id="7096883">,</span>&nbsp;<span class="string" id="7096885">&#34;s_client&#34;</span><span class="op" id="7096895">,</span>&nbsp;<span class="string" id="7096897">&#34;-no_ticket&#34;</span><span class="op" id="7096909">,</span>&nbsp;<span class="string" id="7096911">&#34;-cipher&#34;</span><span class="op" id="7096920">,</span>&nbsp;<span class="string" id="7096922">&#34;AES128-SHA&#34;</span><span class="op" id="7096934">,</span>&nbsp;<span class="string" id="7096936">&#34;-servername&#34;</span><span class="op" id="7096949">,</span>&nbsp;<span class="string" id="7096951">&#34;snitest.com&#34;</span><span class="op" id="7096964">}</span><span class="op" id="7096965">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7096968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7096971">runServerTestTLS12</span><span class="op" id="7096989">(</span><span class="ident" id="7096990">t</span><span class="op" id="7096991">,</span>&nbsp;<span class="ident" id="7096993">test</span><span class="op" id="7096997">)</span><br>
<span class="lineno"></span><span class="op" id="7096999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7097002">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7097081">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7097124">func</span>&nbsp;<span class="ident" id="7097129">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7097165">(</span><span class="ident" id="7097166">t</span>&nbsp;<span class="op" id="7097168">*</span><span class="ident" id="7097169">testing</span><span class="op" id="7097176">.</span><span class="ident" id="7097177">T</span><span class="op" id="7097178">)</span>&nbsp;<span class="op" id="7097180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097183">config</span>&nbsp;<span class="op" id="7097190">:=</span>&nbsp;<span class="op" id="7097193">*</span><span class="ident" id="7097194">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7097207">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097276">nameToCert</span>&nbsp;<span class="op" id="7097287">:=</span>&nbsp;<span class="ident" id="7097290">config</span><span class="op" id="7097296">.</span><span class="ident" id="7097297">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097316">config</span><span class="op" id="7097322">.</span><span class="ident" id="7097323">NameToCertificate</span>&nbsp;<span class="op" id="7097341">=</span>&nbsp;<span class="builtintype" id="7097343">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097348">config</span><span class="op" id="7097354">.</span><span class="ident" id="7097355">GetCertificate</span>&nbsp;<span class="op" id="7097370">=</span>&nbsp;<span class="keyword" id="7097372">func</span><span class="op" id="7097376">(</span><span class="ident" id="7097377">clientHello</span>&nbsp;<span class="op" id="7097389">*</span><span class="ident" id="7097390">ClientHelloInfo</span><span class="op" id="7097405">)</span>&nbsp;<span class="op" id="7097407">(</span><span class="op" id="7097408">*</span><span class="ident" id="7097409">Certificate</span><span class="op" id="7097420">,</span>&nbsp;<span class="builtintype" id="7097422">error</span><span class="op" id="7097427">)</span>&nbsp;<span class="op" id="7097429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097433">cert</span><span class="op" id="7097437">,</span>&nbsp;<span class="ident" id="7097439">_</span>&nbsp;<span class="op" id="7097441">:=</span>&nbsp;<span class="ident" id="7097444">nameToCert</span><span class="op" id="7097454">[</span><span class="ident" id="7097455">clientHello</span><span class="op" id="7097466">.</span><span class="ident" id="7097467">ServerName</span><span class="op" id="7097477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7097481">return</span>&nbsp;<span class="ident" id="7097488">cert</span><span class="op" id="7097492">,</span>&nbsp;<span class="builtintype" id="7097494">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7097499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097502">test</span>&nbsp;<span class="op" id="7097507">:=</span>&nbsp;<span class="op" id="7097510">&amp;</span><span class="ident" id="7097511">serverTest</span><span class="op" id="7097521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097525">name</span><span class="op" id="7097529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7097534">&#34;SNI&#34;</span><span class="op" id="7097539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097543">command</span><span class="op" id="7097550">:</span>&nbsp;<span class="op" id="7097552">[</span><span class="op" id="7097553">]</span><span class="builtintype" id="7097554">string</span><span class="op" id="7097560">{</span><span class="string" id="7097561">&#34;openssl&#34;</span><span class="op" id="7097570">,</span>&nbsp;<span class="string" id="7097572">&#34;s_client&#34;</span><span class="op" id="7097582">,</span>&nbsp;<span class="string" id="7097584">&#34;-no_ticket&#34;</span><span class="op" id="7097596">,</span>&nbsp;<span class="string" id="7097598">&#34;-cipher&#34;</span><span class="op" id="7097607">,</span>&nbsp;<span class="string" id="7097609">&#34;AES128-SHA&#34;</span><span class="op" id="7097621">,</span>&nbsp;<span class="string" id="7097623">&#34;-servername&#34;</span><span class="op" id="7097636">,</span>&nbsp;<span class="string" id="7097638">&#34;snitest.com&#34;</span><span class="op" id="7097651">}</span><span class="op" id="7097652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097656">config</span><span class="op" id="7097662">:</span>&nbsp;&nbsp;<span class="op" id="7097665">&amp;</span><span class="ident" id="7097666">config</span><span class="op" id="7097672">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7097675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7097678">runServerTestTLS12</span><span class="op" id="7097696">(</span><span class="ident" id="7097697">t</span><span class="op" id="7097698">,</span>&nbsp;<span class="ident" id="7097700">test</span><span class="op" id="7097704">)</span><br>
<span class="lineno"></span><span class="op" id="7097706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7097709">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7097768">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7097843">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7097917">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7097947">func</span>&nbsp;<span class="ident" id="7097952">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7097996">(</span><span class="ident" id="7097997">t</span>&nbsp;<span class="op" id="7097999">*</span><span class="ident" id="7098000">testing</span><span class="op" id="7098007">.</span><span class="ident" id="7098008">T</span><span class="op" id="7098009">)</span>&nbsp;<span class="op" id="7098011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098014">config</span>&nbsp;<span class="op" id="7098021">:=</span>&nbsp;<span class="op" id="7098024">*</span><span class="ident" id="7098025">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098038">config</span><span class="op" id="7098044">.</span><span class="ident" id="7098045">GetCertificate</span>&nbsp;<span class="op" id="7098060">=</span>&nbsp;<span class="keyword" id="7098062">func</span><span class="op" id="7098066">(</span><span class="ident" id="7098067">clientHello</span>&nbsp;<span class="op" id="7098079">*</span><span class="ident" id="7098080">ClientHelloInfo</span><span class="op" id="7098095">)</span>&nbsp;<span class="op" id="7098097">(</span><span class="op" id="7098098">*</span><span class="ident" id="7098099">Certificate</span><span class="op" id="7098110">,</span>&nbsp;<span class="builtintype" id="7098112">error</span><span class="op" id="7098117">)</span>&nbsp;<span class="op" id="7098119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7098123">return</span>&nbsp;<span class="builtintype" id="7098130">nil</span><span class="op" id="7098133">,</span>&nbsp;<span class="builtintype" id="7098135">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098143">test</span>&nbsp;<span class="op" id="7098148">:=</span>&nbsp;<span class="op" id="7098151">&amp;</span><span class="ident" id="7098152">serverTest</span><span class="op" id="7098162">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098166">name</span><span class="op" id="7098170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7098175">&#34;SNI&#34;</span><span class="op" id="7098180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098184">command</span><span class="op" id="7098191">:</span>&nbsp;<span class="op" id="7098193">[</span><span class="op" id="7098194">]</span><span class="builtintype" id="7098195">string</span><span class="op" id="7098201">{</span><span class="string" id="7098202">&#34;openssl&#34;</span><span class="op" id="7098211">,</span>&nbsp;<span class="string" id="7098213">&#34;s_client&#34;</span><span class="op" id="7098223">,</span>&nbsp;<span class="string" id="7098225">&#34;-no_ticket&#34;</span><span class="op" id="7098237">,</span>&nbsp;<span class="string" id="7098239">&#34;-cipher&#34;</span><span class="op" id="7098248">,</span>&nbsp;<span class="string" id="7098250">&#34;AES128-SHA&#34;</span><span class="op" id="7098262">,</span>&nbsp;<span class="string" id="7098264">&#34;-servername&#34;</span><span class="op" id="7098277">,</span>&nbsp;<span class="string" id="7098279">&#34;snitest.com&#34;</span><span class="op" id="7098292">}</span><span class="op" id="7098293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098297">config</span><span class="op" id="7098303">:</span>&nbsp;&nbsp;<span class="op" id="7098306">&amp;</span><span class="ident" id="7098307">config</span><span class="op" id="7098313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098319">runServerTestTLS12</span><span class="op" id="7098337">(</span><span class="ident" id="7098338">t</span><span class="op" id="7098339">,</span>&nbsp;<span class="ident" id="7098341">test</span><span class="op" id="7098345">)</span><br>
<span class="lineno">625</span><span class="op" id="7098347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7098350">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7098426">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7098467">func</span>&nbsp;<span class="ident" id="7098472">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7098513">(</span><span class="ident" id="7098514">t</span>&nbsp;<span class="op" id="7098516">*</span><span class="ident" id="7098517">testing</span><span class="op" id="7098524">.</span><span class="ident" id="7098525">T</span><span class="op" id="7098526">)</span>&nbsp;<span class="op" id="7098528">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098531">config</span>&nbsp;<span class="op" id="7098538">:=</span>&nbsp;<span class="op" id="7098541">*</span><span class="ident" id="7098542">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098555">config</span><span class="op" id="7098561">.</span><span class="ident" id="7098562">GetCertificate</span>&nbsp;<span class="op" id="7098577">=</span>&nbsp;<span class="keyword" id="7098579">func</span><span class="op" id="7098583">(</span><span class="ident" id="7098584">clientHello</span>&nbsp;<span class="op" id="7098596">*</span><span class="ident" id="7098597">ClientHelloInfo</span><span class="op" id="7098612">)</span>&nbsp;<span class="op" id="7098614">(</span><span class="op" id="7098615">*</span><span class="ident" id="7098616">Certificate</span><span class="op" id="7098627">,</span>&nbsp;<span class="builtintype" id="7098629">error</span><span class="op" id="7098634">)</span>&nbsp;<span class="op" id="7098636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7098640">return</span>&nbsp;<span class="builtintype" id="7098647">nil</span><span class="op" id="7098650">,</span>&nbsp;<span class="ident" id="7098652">fmt</span><span class="op" id="7098655">.</span><span class="ident" id="7098656">Errorf</span><span class="op" id="7098662">(</span><span class="string" id="7098663">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7098693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098696">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098699">test</span>&nbsp;<span class="op" id="7098704">:=</span>&nbsp;<span class="op" id="7098707">&amp;</span><span class="ident" id="7098708">serverTest</span><span class="op" id="7098718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098722">name</span><span class="op" id="7098726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7098735">&#34;SNI&#34;</span><span class="op" id="7098740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098744">command</span><span class="op" id="7098751">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098757">[</span><span class="op" id="7098758">]</span><span class="builtintype" id="7098759">string</span><span class="op" id="7098765">{</span><span class="string" id="7098766">&#34;openssl&#34;</span><span class="op" id="7098775">,</span>&nbsp;<span class="string" id="7098777">&#34;s_client&#34;</span><span class="op" id="7098787">,</span>&nbsp;<span class="string" id="7098789">&#34;-no_ticket&#34;</span><span class="op" id="7098801">,</span>&nbsp;<span class="string" id="7098803">&#34;-cipher&#34;</span><span class="op" id="7098812">,</span>&nbsp;<span class="string" id="7098814">&#34;AES128-SHA&#34;</span><span class="op" id="7098826">,</span>&nbsp;<span class="string" id="7098828">&#34;-servername&#34;</span><span class="op" id="7098841">,</span>&nbsp;<span class="string" id="7098843">&#34;snitest.com&#34;</span><span class="op" id="7098856">}</span><span class="op" id="7098857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098861">config</span><span class="op" id="7098867">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098874">&amp;</span><span class="ident" id="7098875">config</span><span class="op" id="7098881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098885">expectAlert</span><span class="op" id="7098896">:</span>&nbsp;<span class="builtintype" id="7098898">true</span><span class="op" id="7098902">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7098905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098908">runServerTestTLS12</span><span class="op" id="7098926">(</span><span class="ident" id="7098927">t</span><span class="op" id="7098928">,</span>&nbsp;<span class="ident" id="7098930">test</span><span class="op" id="7098934">)</span><br>
<span class="lineno"></span><span class="op" id="7098936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7098939">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7099019">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7099093">func</span>&nbsp;<span class="ident" id="7099098">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7099132">(</span><span class="ident" id="7099133">t</span>&nbsp;<span class="op" id="7099135">*</span><span class="ident" id="7099136">testing</span><span class="op" id="7099143">.</span><span class="ident" id="7099144">T</span><span class="op" id="7099145">)</span>&nbsp;<span class="op" id="7099147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099150">config</span>&nbsp;<span class="op" id="7099157">:=</span>&nbsp;<span class="op" id="7099160">*</span><span class="ident" id="7099161">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099173">config</span><span class="op" id="7099179">.</span><span class="ident" id="7099180">CipherSuites</span>&nbsp;<span class="op" id="7099193">=</span>&nbsp;<span class="op" id="7099195">[</span><span class="op" id="7099196">]</span><span class="builtintype" id="7099197">uint16</span><span class="op" id="7099203">{</span><span class="ident" id="7099204">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7099240">,</span>&nbsp;<span class="ident" id="7099242">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7099276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099279">config</span><span class="op" id="7099285">.</span><span class="ident" id="7099286">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7099311">=</span>&nbsp;<span class="builtintype" id="7099313">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099320">test</span>&nbsp;<span class="op" id="7099325">:=</span>&nbsp;<span class="op" id="7099328">&amp;</span><span class="ident" id="7099329">serverTest</span><span class="op" id="7099339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099343">name</span><span class="op" id="7099347">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7099351">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7099381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099385">config</span><span class="op" id="7099391">:</span>&nbsp;<span class="op" id="7099393">&amp;</span><span class="ident" id="7099394">config</span><span class="op" id="7099400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7099403">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099406">runServerTestTLS12</span><span class="op" id="7099424">(</span><span class="ident" id="7099425">t</span><span class="op" id="7099426">,</span>&nbsp;<span class="ident" id="7099428">test</span><span class="op" id="7099432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099436">config</span>&nbsp;<span class="op" id="7099443">=</span>&nbsp;<span class="op" id="7099445">*</span><span class="ident" id="7099446">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099458">config</span><span class="op" id="7099464">.</span><span class="ident" id="7099465">CipherSuites</span>&nbsp;<span class="op" id="7099478">=</span>&nbsp;<span class="op" id="7099480">[</span><span class="op" id="7099481">]</span><span class="builtintype" id="7099482">uint16</span><span class="op" id="7099488">{</span><span class="ident" id="7099489">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7099523">,</span>&nbsp;<span class="ident" id="7099525">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7099561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099564">config</span><span class="op" id="7099570">.</span><span class="ident" id="7099571">Certificates</span>&nbsp;<span class="op" id="7099584">=</span>&nbsp;<span class="op" id="7099586">[</span><span class="op" id="7099587">]</span><span class="ident" id="7099588">Certificate</span><span class="op" id="7099599">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7099603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099608">Certificate</span><span class="op" id="7099619">:</span>&nbsp;<span class="op" id="7099621">[</span><span class="op" id="7099622">]</span><span class="op" id="7099623">[</span><span class="op" id="7099624">]</span><span class="builtintype" id="7099625">byte</span><span class="op" id="7099629">{</span><span class="ident" id="7099630">testECDSACertificate</span><span class="op" id="7099650">}</span><span class="op" id="7099651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099656">PrivateKey</span><span class="op" id="7099666">:</span>&nbsp;&nbsp;<span class="ident" id="7099669">testECDSAPrivateKey</span><span class="op" id="7099688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7099692">}</span><span class="op" id="7099693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7099696">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099699">config</span><span class="op" id="7099705">.</span><span class="ident" id="7099706">BuildNameToCertificate</span><span class="op" id="7099728">(</span><span class="op" id="7099729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099732">config</span><span class="op" id="7099738">.</span><span class="ident" id="7099739">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7099764">=</span>&nbsp;<span class="builtintype" id="7099766">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099773">test</span>&nbsp;<span class="op" id="7099778">=</span>&nbsp;<span class="op" id="7099780">&amp;</span><span class="ident" id="7099781">serverTest</span><span class="op" id="7099791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099795">name</span><span class="op" id="7099799">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7099803">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7099835">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099839">config</span><span class="op" id="7099845">:</span>&nbsp;<span class="op" id="7099847">&amp;</span><span class="ident" id="7099848">config</span><span class="op" id="7099854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7099857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099860">runServerTestTLS12</span><span class="op" id="7099878">(</span><span class="ident" id="7099879">t</span><span class="op" id="7099880">,</span>&nbsp;<span class="ident" id="7099882">test</span><span class="op" id="7099886">)</span><br>
<span class="lineno"></span><span class="op" id="7099888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7099891">func</span>&nbsp;<span class="ident" id="7099896">TestResumption</span><span class="op" id="7099910">(</span><span class="ident" id="7099911">t</span>&nbsp;<span class="op" id="7099913">*</span><span class="ident" id="7099914">testing</span><span class="op" id="7099921">.</span><span class="ident" id="7099922">T</span><span class="op" id="7099923">)</span>&nbsp;<span class="op" id="7099925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099928">sessionFilePath</span>&nbsp;<span class="op" id="7099944">:=</span>&nbsp;<span class="ident" id="7099947">tempFile</span><span class="op" id="7099955">(</span><span class="string" id="7099956">&#34;&#34;</span><span class="op" id="7099958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7099961">defer</span>&nbsp;<span class="ident" id="7099967">os</span><span class="op" id="7099969">.</span><span class="ident" id="7099970">Remove</span><span class="op" id="7099976">(</span><span class="ident" id="7099977">sessionFilePath</span><span class="op" id="7099992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7099996">test</span>&nbsp;<span class="op" id="7100001">:=</span>&nbsp;<span class="op" id="7100004">&amp;</span><span class="ident" id="7100005">serverTest</span><span class="op" id="7100015">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100019">name</span><span class="op" id="7100023">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7100028">&#34;IssueTicket&#34;</span><span class="op" id="7100041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100045">command</span><span class="op" id="7100052">:</span>&nbsp;<span class="op" id="7100054">[</span><span class="op" id="7100055">]</span><span class="builtintype" id="7100056">string</span><span class="op" id="7100062">{</span><span class="string" id="7100063">&#34;openssl&#34;</span><span class="op" id="7100072">,</span>&nbsp;<span class="string" id="7100074">&#34;s_client&#34;</span><span class="op" id="7100084">,</span>&nbsp;<span class="string" id="7100086">&#34;-cipher&#34;</span><span class="op" id="7100095">,</span>&nbsp;<span class="string" id="7100097">&#34;RC4-SHA&#34;</span><span class="op" id="7100106">,</span>&nbsp;<span class="string" id="7100108">&#34;-sess_out&#34;</span><span class="op" id="7100119">,</span>&nbsp;<span class="ident" id="7100121">sessionFilePath</span><span class="op" id="7100136">}</span><span class="op" id="7100137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100143">runServerTestTLS12</span><span class="op" id="7100161">(</span><span class="ident" id="7100162">t</span><span class="op" id="7100163">,</span>&nbsp;<span class="ident" id="7100165">test</span><span class="op" id="7100169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100173">test</span>&nbsp;<span class="op" id="7100178">=</span>&nbsp;<span class="op" id="7100180">&amp;</span><span class="ident" id="7100181">serverTest</span><span class="op" id="7100191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100195">name</span><span class="op" id="7100199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7100204">&#34;Resume&#34;</span><span class="op" id="7100212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100216">command</span><span class="op" id="7100223">:</span>&nbsp;<span class="op" id="7100225">[</span><span class="op" id="7100226">]</span><span class="builtintype" id="7100227">string</span><span class="op" id="7100233">{</span><span class="string" id="7100234">&#34;openssl&#34;</span><span class="op" id="7100243">,</span>&nbsp;<span class="string" id="7100245">&#34;s_client&#34;</span><span class="op" id="7100255">,</span>&nbsp;<span class="string" id="7100257">&#34;-cipher&#34;</span><span class="op" id="7100266">,</span>&nbsp;<span class="string" id="7100268">&#34;RC4-SHA&#34;</span><span class="op" id="7100277">,</span>&nbsp;<span class="string" id="7100279">&#34;-sess_in&#34;</span><span class="op" id="7100289">,</span>&nbsp;<span class="ident" id="7100291">sessionFilePath</span><span class="op" id="7100306">}</span><span class="op" id="7100307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100313">runServerTestTLS12</span><span class="op" id="7100331">(</span><span class="ident" id="7100332">t</span><span class="op" id="7100333">,</span>&nbsp;<span class="ident" id="7100335">test</span><span class="op" id="7100339">)</span><br>
<span class="lineno">690</span><span class="op" id="7100341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7100344">func</span>&nbsp;<span class="ident" id="7100349">TestResumptionDisabled</span><span class="op" id="7100371">(</span><span class="ident" id="7100372">t</span>&nbsp;<span class="op" id="7100374">*</span><span class="ident" id="7100375">testing</span><span class="op" id="7100382">.</span><span class="ident" id="7100383">T</span><span class="op" id="7100384">)</span>&nbsp;<span class="op" id="7100386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100389">sessionFilePath</span>&nbsp;<span class="op" id="7100405">:=</span>&nbsp;<span class="ident" id="7100408">tempFile</span><span class="op" id="7100416">(</span><span class="string" id="7100417">&#34;&#34;</span><span class="op" id="7100419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7100422">defer</span>&nbsp;<span class="ident" id="7100428">os</span><span class="op" id="7100430">.</span><span class="ident" id="7100431">Remove</span><span class="op" id="7100437">(</span><span class="ident" id="7100438">sessionFilePath</span><span class="op" id="7100453">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100457">config</span>&nbsp;<span class="op" id="7100464">:=</span>&nbsp;<span class="op" id="7100467">*</span><span class="ident" id="7100468">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100481">test</span>&nbsp;<span class="op" id="7100486">:=</span>&nbsp;<span class="op" id="7100489">&amp;</span><span class="ident" id="7100490">serverTest</span><span class="op" id="7100500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100504">name</span><span class="op" id="7100508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7100513">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7100536">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100540">command</span><span class="op" id="7100547">:</span>&nbsp;<span class="op" id="7100549">[</span><span class="op" id="7100550">]</span><span class="builtintype" id="7100551">string</span><span class="op" id="7100557">{</span><span class="string" id="7100558">&#34;openssl&#34;</span><span class="op" id="7100567">,</span>&nbsp;<span class="string" id="7100569">&#34;s_client&#34;</span><span class="op" id="7100579">,</span>&nbsp;<span class="string" id="7100581">&#34;-cipher&#34;</span><span class="op" id="7100590">,</span>&nbsp;<span class="string" id="7100592">&#34;RC4-SHA&#34;</span><span class="op" id="7100601">,</span>&nbsp;<span class="string" id="7100603">&#34;-sess_out&#34;</span><span class="op" id="7100614">,</span>&nbsp;<span class="ident" id="7100616">sessionFilePath</span><span class="op" id="7100631">}</span><span class="op" id="7100632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100636">config</span><span class="op" id="7100642">:</span>&nbsp;&nbsp;<span class="op" id="7100645">&amp;</span><span class="ident" id="7100646">config</span><span class="op" id="7100652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100658">runServerTestTLS12</span><span class="op" id="7100676">(</span><span class="ident" id="7100677">t</span><span class="op" id="7100678">,</span>&nbsp;<span class="ident" id="7100680">test</span><span class="op" id="7100684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100688">config</span><span class="op" id="7100694">.</span><span class="ident" id="7100695">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7100718">=</span>&nbsp;<span class="builtintype" id="7100720">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100727">test</span>&nbsp;<span class="op" id="7100732">=</span>&nbsp;<span class="op" id="7100734">&amp;</span><span class="ident" id="7100735">serverTest</span><span class="op" id="7100745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100749">name</span><span class="op" id="7100753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7100758">&#34;ResumeDisabled&#34;</span><span class="op" id="7100774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100778">command</span><span class="op" id="7100785">:</span>&nbsp;<span class="op" id="7100787">[</span><span class="op" id="7100788">]</span><span class="builtintype" id="7100789">string</span><span class="op" id="7100795">{</span><span class="string" id="7100796">&#34;openssl&#34;</span><span class="op" id="7100805">,</span>&nbsp;<span class="string" id="7100807">&#34;s_client&#34;</span><span class="op" id="7100817">,</span>&nbsp;<span class="string" id="7100819">&#34;-cipher&#34;</span><span class="op" id="7100828">,</span>&nbsp;<span class="string" id="7100830">&#34;RC4-SHA&#34;</span><span class="op" id="7100839">,</span>&nbsp;<span class="string" id="7100841">&#34;-sess_in&#34;</span><span class="op" id="7100851">,</span>&nbsp;<span class="ident" id="7100853">sessionFilePath</span><span class="op" id="7100868">}</span><span class="op" id="7100869">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100873">config</span><span class="op" id="7100879">:</span>&nbsp;&nbsp;<span class="op" id="7100882">&amp;</span><span class="ident" id="7100883">config</span><span class="op" id="7100889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7100895">runServerTestTLS12</span><span class="op" id="7100913">(</span><span class="ident" id="7100914">t</span><span class="op" id="7100915">,</span>&nbsp;<span class="ident" id="7100917">test</span><span class="op" id="7100921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7100925">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7100997">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7101065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7101068">func</span>&nbsp;<span class="ident" id="7101073">TestFallbackSCSV</span><span class="op" id="7101089">(</span><span class="ident" id="7101090">t</span>&nbsp;<span class="op" id="7101092">*</span><span class="ident" id="7101093">testing</span><span class="op" id="7101100">.</span><span class="ident" id="7101101">T</span><span class="op" id="7101102">)</span>&nbsp;<span class="op" id="7101104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7101107">test</span>&nbsp;<span class="op" id="7101112">:=</span>&nbsp;<span class="op" id="7101115">&amp;</span><span class="ident" id="7101116">serverTest</span><span class="op" id="7101126">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7101130">name</span><span class="op" id="7101134">:</span>&nbsp;<span class="string" id="7101136">&#34;FallbackSCSV&#34;</span><span class="op" id="7101150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7101154">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7101215">command</span><span class="op" id="7101222">:</span>&nbsp;<span class="op" id="7101224">[</span><span class="op" id="7101225">]</span><span class="builtintype" id="7101226">string</span><span class="op" id="7101232">{</span><span class="string" id="7101233">&#34;openssl&#34;</span><span class="op" id="7101242">,</span>&nbsp;<span class="string" id="7101244">&#34;s_client&#34;</span><span class="op" id="7101254">,</span>&nbsp;<span class="string" id="7101256">&#34;-fallback_scsv&#34;</span><span class="op" id="7101272">}</span><span class="op" id="7101273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7101277">expectHandshakeErrorIncluding</span><span class="op" id="7101306">:</span>&nbsp;<span class="string" id="7101308">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7101340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7101343">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7101346">runServerTestTLS11</span><span class="op" id="7101364">(</span><span class="ident" id="7101365">t</span><span class="op" id="7101366">,</span>&nbsp;<span class="ident" id="7101368">test</span><span class="op" id="7101372">)</span><br>
<span class="lineno"></span><span class="op" id="7101374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7101377">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7101438">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7101500">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7101536">const</span>&nbsp;<span class="ident" id="7101542">clientCertificatePEM</span>&nbsp;<span class="op" id="7101563">=</span>&nbsp;<span class="string" id="7101565">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102298">const</span>&nbsp;<span class="ident" id="7102304">clientKeyPEM</span>&nbsp;<span class="op" id="7102317">=</span>&nbsp;<span class="string" id="7102319">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7103206">const</span>&nbsp;<span class="ident" id="7103212">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7103238">=</span>&nbsp;<span class="string" id="7103240">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7103993">const</span>&nbsp;<span class="ident" id="7103999">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7104017">=</span>&nbsp;<span class="string" id="7104019">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7104459">func</span>&nbsp;<span class="ident" id="7104464">TestClientAuth</span><span class="op" id="7104478">(</span><span class="ident" id="7104479">t</span>&nbsp;<span class="op" id="7104481">*</span><span class="ident" id="7104482">testing</span><span class="op" id="7104489">.</span><span class="ident" id="7104490">T</span><span class="op" id="7104491">)</span>&nbsp;<span class="op" id="7104493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104496">var</span>&nbsp;<span class="ident" id="7104500">certPath</span><span class="op" id="7104508">,</span>&nbsp;<span class="ident" id="7104510">keyPath</span><span class="op" id="7104517">,</span>&nbsp;<span class="ident" id="7104519">ecdsaCertPath</span><span class="op" id="7104532">,</span>&nbsp;<span class="ident" id="7104534">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7104547">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104556">if</span>&nbsp;<span class="op" id="7104559">*</span><span class="ident" id="7104560">update</span>&nbsp;<span class="op" id="7104567">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104571">certPath</span>&nbsp;<span class="op" id="7104580">=</span>&nbsp;<span class="ident" id="7104582">tempFile</span><span class="op" id="7104590">(</span><span class="ident" id="7104591">clientCertificatePEM</span><span class="op" id="7104611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104615">defer</span>&nbsp;<span class="ident" id="7104621">os</span><span class="op" id="7104623">.</span><span class="ident" id="7104624">Remove</span><span class="op" id="7104630">(</span><span class="ident" id="7104631">certPath</span><span class="op" id="7104639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104643">keyPath</span>&nbsp;<span class="op" id="7104651">=</span>&nbsp;<span class="ident" id="7104653">tempFile</span><span class="op" id="7104661">(</span><span class="ident" id="7104662">clientKeyPEM</span><span class="op" id="7104674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104678">defer</span>&nbsp;<span class="ident" id="7104684">os</span><span class="op" id="7104686">.</span><span class="ident" id="7104687">Remove</span><span class="op" id="7104693">(</span><span class="ident" id="7104694">keyPath</span><span class="op" id="7104701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104705">ecdsaCertPath</span>&nbsp;<span class="op" id="7104719">=</span>&nbsp;<span class="ident" id="7104721">tempFile</span><span class="op" id="7104729">(</span><span class="ident" id="7104730">clientECDSACertificatePEM</span><span class="op" id="7104755">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104759">defer</span>&nbsp;<span class="ident" id="7104765">os</span><span class="op" id="7104767">.</span><span class="ident" id="7104768">Remove</span><span class="op" id="7104774">(</span><span class="ident" id="7104775">ecdsaCertPath</span><span class="op" id="7104788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104792">ecdsaKeyPath</span>&nbsp;<span class="op" id="7104805">=</span>&nbsp;<span class="ident" id="7104807">tempFile</span><span class="op" id="7104815">(</span><span class="ident" id="7104816">clientECDSAKeyPEM</span><span class="op" id="7104833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7104837">defer</span>&nbsp;<span class="ident" id="7104843">os</span><span class="op" id="7104845">.</span><span class="ident" id="7104846">Remove</span><span class="op" id="7104852">(</span><span class="ident" id="7104853">ecdsaKeyPath</span><span class="op" id="7104865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7104868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104872">config</span>&nbsp;<span class="op" id="7104879">:=</span>&nbsp;<span class="op" id="7104882">*</span><span class="ident" id="7104883">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104895">config</span><span class="op" id="7104901">.</span><span class="ident" id="7104902">ClientAuth</span>&nbsp;<span class="op" id="7104913">=</span>&nbsp;<span class="ident" id="7104915">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104935">test</span>&nbsp;<span class="op" id="7104940">:=</span>&nbsp;<span class="op" id="7104943">&amp;</span><span class="ident" id="7104944">serverTest</span><span class="op" id="7104954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7104958">name</span><span class="op" id="7104962">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7104967">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7104996">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105000">command</span><span class="op" id="7105007">:</span>&nbsp;<span class="op" id="7105009">[</span><span class="op" id="7105010">]</span><span class="builtintype" id="7105011">string</span><span class="op" id="7105017">{</span><span class="string" id="7105018">&#34;openssl&#34;</span><span class="op" id="7105027">,</span>&nbsp;<span class="string" id="7105029">&#34;s_client&#34;</span><span class="op" id="7105039">,</span>&nbsp;<span class="string" id="7105041">&#34;-no_ticket&#34;</span><span class="op" id="7105053">,</span>&nbsp;<span class="string" id="7105055">&#34;-cipher&#34;</span><span class="op" id="7105064">,</span>&nbsp;<span class="string" id="7105066">&#34;RC4-SHA&#34;</span><span class="op" id="7105075">}</span><span class="op" id="7105076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105080">config</span><span class="op" id="7105086">:</span>&nbsp;&nbsp;<span class="op" id="7105089">&amp;</span><span class="ident" id="7105090">config</span><span class="op" id="7105096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105102">runServerTestTLS12</span><span class="op" id="7105120">(</span><span class="ident" id="7105121">t</span><span class="op" id="7105122">,</span>&nbsp;<span class="ident" id="7105124">test</span><span class="op" id="7105128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105132">test</span>&nbsp;<span class="op" id="7105137">=</span>&nbsp;<span class="op" id="7105139">&amp;</span><span class="ident" id="7105140">serverTest</span><span class="op" id="7105150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105154">name</span><span class="op" id="7105158">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7105173">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7105202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105206">command</span><span class="op" id="7105213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105225">[</span><span class="op" id="7105226">]</span><span class="builtintype" id="7105227">string</span><span class="op" id="7105233">{</span><span class="string" id="7105234">&#34;openssl&#34;</span><span class="op" id="7105243">,</span>&nbsp;<span class="string" id="7105245">&#34;s_client&#34;</span><span class="op" id="7105255">,</span>&nbsp;<span class="string" id="7105257">&#34;-no_ticket&#34;</span><span class="op" id="7105269">,</span>&nbsp;<span class="string" id="7105271">&#34;-cipher&#34;</span><span class="op" id="7105280">,</span>&nbsp;<span class="string" id="7105282">&#34;RC4-SHA&#34;</span><span class="op" id="7105291">,</span>&nbsp;<span class="string" id="7105293">&#34;-cert&#34;</span><span class="op" id="7105300">,</span>&nbsp;<span class="ident" id="7105302">certPath</span><span class="op" id="7105310">,</span>&nbsp;<span class="string" id="7105312">&#34;-key&#34;</span><span class="op" id="7105318">,</span>&nbsp;<span class="ident" id="7105320">keyPath</span><span class="op" id="7105327">}</span><span class="op" id="7105328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105332">config</span><span class="op" id="7105338">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105351">&amp;</span><span class="ident" id="7105352">config</span><span class="op" id="7105358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105362">expectedPeerCerts</span><span class="op" id="7105379">:</span>&nbsp;<span class="op" id="7105381">[</span><span class="op" id="7105382">]</span><span class="builtintype" id="7105383">string</span><span class="op" id="7105389">{</span><span class="ident" id="7105390">clientCertificatePEM</span><span class="op" id="7105410">}</span><span class="op" id="7105411">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105417">runServerTestTLS12</span><span class="op" id="7105435">(</span><span class="ident" id="7105436">t</span><span class="op" id="7105437">,</span>&nbsp;<span class="ident" id="7105439">test</span><span class="op" id="7105443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105447">test</span>&nbsp;<span class="op" id="7105452">=</span>&nbsp;<span class="op" id="7105454">&amp;</span><span class="ident" id="7105455">serverTest</span><span class="op" id="7105465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105469">name</span><span class="op" id="7105473">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7105488">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7105522">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105526">command</span><span class="op" id="7105533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105545">[</span><span class="op" id="7105546">]</span><span class="builtintype" id="7105547">string</span><span class="op" id="7105553">{</span><span class="string" id="7105554">&#34;openssl&#34;</span><span class="op" id="7105563">,</span>&nbsp;<span class="string" id="7105565">&#34;s_client&#34;</span><span class="op" id="7105575">,</span>&nbsp;<span class="string" id="7105577">&#34;-no_ticket&#34;</span><span class="op" id="7105589">,</span>&nbsp;<span class="string" id="7105591">&#34;-cipher&#34;</span><span class="op" id="7105600">,</span>&nbsp;<span class="string" id="7105602">&#34;RC4-SHA&#34;</span><span class="op" id="7105611">,</span>&nbsp;<span class="string" id="7105613">&#34;-cert&#34;</span><span class="op" id="7105620">,</span>&nbsp;<span class="ident" id="7105622">ecdsaCertPath</span><span class="op" id="7105635">,</span>&nbsp;<span class="string" id="7105637">&#34;-key&#34;</span><span class="op" id="7105643">,</span>&nbsp;<span class="ident" id="7105645">ecdsaKeyPath</span><span class="op" id="7105657">}</span><span class="op" id="7105658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105662">config</span><span class="op" id="7105668">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105681">&amp;</span><span class="ident" id="7105682">config</span><span class="op" id="7105688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105692">expectedPeerCerts</span><span class="op" id="7105709">:</span>&nbsp;<span class="op" id="7105711">[</span><span class="op" id="7105712">]</span><span class="builtintype" id="7105713">string</span><span class="op" id="7105719">{</span><span class="ident" id="7105720">clientECDSACertificatePEM</span><span class="op" id="7105745">}</span><span class="op" id="7105746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7105749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105752">runServerTestTLS12</span><span class="op" id="7105770">(</span><span class="ident" id="7105771">t</span><span class="op" id="7105772">,</span>&nbsp;<span class="ident" id="7105774">test</span><span class="op" id="7105778">)</span><br>
<span class="lineno">830</span><span class="op" id="7105780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105783">func</span>&nbsp;<span class="ident" id="7105788">bigFromString</span><span class="op" id="7105801">(</span><span class="ident" id="7105802">s</span>&nbsp;<span class="builtintype" id="7105804">string</span><span class="op" id="7105810">)</span>&nbsp;<span class="op" id="7105812">*</span><span class="ident" id="7105813">big</span><span class="op" id="7105816">.</span><span class="ident" id="7105817">Int</span>&nbsp;<span class="op" id="7105821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105824">ret</span>&nbsp;<span class="op" id="7105828">:=</span>&nbsp;<span class="builtinfunc" id="7105831">new</span><span class="op" id="7105834">(</span><span class="ident" id="7105835">big</span><span class="op" id="7105838">.</span><span class="ident" id="7105839">Int</span><span class="op" id="7105842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105845">ret</span><span class="op" id="7105848">.</span><span class="ident" id="7105849">SetString</span><span class="op" id="7105858">(</span><span class="ident" id="7105859">s</span><span class="op" id="7105860">,</span>&nbsp;<span class="num" id="7105862">10</span><span class="op" id="7105864">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7105867">return</span>&nbsp;<span class="ident" id="7105874">ret</span><br>
<span class="lineno"></span><span class="op" id="7105878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105881">func</span>&nbsp;<span class="ident" id="7105886">fromHex</span><span class="op" id="7105893">(</span><span class="ident" id="7105894">s</span>&nbsp;<span class="builtintype" id="7105896">string</span><span class="op" id="7105902">)</span>&nbsp;<span class="op" id="7105904">[</span><span class="op" id="7105905">]</span><span class="builtintype" id="7105906">byte</span>&nbsp;<span class="op" id="7105911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7105914">b</span><span class="op" id="7105915">,</span>&nbsp;<span class="ident" id="7105917">_</span>&nbsp;<span class="op" id="7105919">:=</span>&nbsp;<span class="ident" id="7105922">hex</span><span class="op" id="7105925">.</span><span class="ident" id="7105926">DecodeString</span><span class="op" id="7105938">(</span><span class="ident" id="7105939">s</span><span class="op" id="7105940">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7105943">return</span>&nbsp;<span class="ident" id="7105950">b</span><br>
<span class="lineno"></span><span class="op" id="7105952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105955">var</span>&nbsp;<span class="ident" id="7105959">testRSACertificate</span>&nbsp;<span class="op" id="7105978">=</span>&nbsp;<span class="ident" id="7105980">fromHex</span><span class="op" id="7105987">(</span><span class="string" id="7105988">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7107374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7107377">var</span>&nbsp;<span class="ident" id="7107381">testECDSACertificate</span>&nbsp;<span class="op" id="7107402">=</span>&nbsp;<span class="ident" id="7107404">fromHex</span><span class="op" id="7107411">(</span><span class="string" id="7107412">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7108446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7108449">var</span>&nbsp;<span class="ident" id="7108453">testSNICertificate</span>&nbsp;<span class="op" id="7108472">=</span>&nbsp;<span class="ident" id="7108474">fromHex</span><span class="op" id="7108481">(</span><span class="string" id="7108482">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7109488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7109491">var</span>&nbsp;<span class="ident" id="7109495">testRSAPrivateKey</span>&nbsp;<span class="op" id="7109513">=</span>&nbsp;<span class="op" id="7109515">&amp;</span><span class="ident" id="7109516">rsa</span><span class="op" id="7109519">.</span><span class="ident" id="7109520">PrivateKey</span><span class="op" id="7109530">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7109533">PublicKey</span><span class="op" id="7109542">:</span>&nbsp;<span class="ident" id="7109544">rsa</span><span class="op" id="7109547">.</span><span class="ident" id="7109548">PublicKey</span><span class="op" id="7109557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7109561">N</span><span class="op" id="7109562">:</span>&nbsp;<span class="ident" id="7109564">bigFromString</span><span class="op" id="7109577">(</span><span class="string" id="7109578">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7109889">)</span><span class="op" id="7109890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7109894">E</span><span class="op" id="7109895">:</span>&nbsp;<span class="num" id="7109897">65537</span><span class="op" id="7109902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109905">}</span><span class="op" id="7109906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7109909">D</span><span class="op" id="7109910">:</span>&nbsp;<span class="ident" id="7109912">bigFromString</span><span class="op" id="7109925">(</span><span class="string" id="7109926">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7110236">)</span><span class="op" id="7110237">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110240">Primes</span><span class="op" id="7110246">:</span>&nbsp;<span class="op" id="7110248">[</span><span class="op" id="7110249">]</span><span class="op" id="7110250">*</span><span class="ident" id="7110251">big</span><span class="op" id="7110254">.</span><span class="ident" id="7110255">Int</span><span class="op" id="7110258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110262">bigFromString</span><span class="op" id="7110275">(</span><span class="string" id="7110276">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7110433">)</span><span class="op" id="7110434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110438">bigFromString</span><span class="op" id="7110451">(</span><span class="string" id="7110452">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7110609">)</span><span class="op" id="7110610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7110613">}</span><span class="op" id="7110614">,</span><br>
<span class="lineno"></span><span class="op" id="7110616">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7110619">var</span>&nbsp;<span class="ident" id="7110623">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7110643">=</span>&nbsp;<span class="op" id="7110645">&amp;</span><span class="ident" id="7110646">ecdsa</span><span class="op" id="7110651">.</span><span class="ident" id="7110652">PrivateKey</span><span class="op" id="7110662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110665">PublicKey</span><span class="op" id="7110674">:</span>&nbsp;<span class="ident" id="7110676">ecdsa</span><span class="op" id="7110681">.</span><span class="ident" id="7110682">PublicKey</span><span class="op" id="7110691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110695">Curve</span><span class="op" id="7110700">:</span>&nbsp;<span class="ident" id="7110702">elliptic</span><span class="op" id="7110710">.</span><span class="ident" id="7110711">P521</span><span class="op" id="7110715">(</span><span class="op" id="7110716">)</span><span class="op" id="7110717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110721">X</span><span class="op" id="7110722">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110728">bigFromString</span><span class="op" id="7110741">(</span><span class="string" id="7110742">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7110901">)</span><span class="op" id="7110902">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110906">Y</span><span class="op" id="7110907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7110913">bigFromString</span><span class="op" id="7110926">(</span><span class="string" id="7110927">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7111086">)</span><span class="op" id="7111087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7111090">}</span><span class="op" id="7111091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7111094">D</span><span class="op" id="7111095">:</span>&nbsp;<span class="ident" id="7111097">bigFromString</span><span class="op" id="7111110">(</span><span class="string" id="7111111">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7111270">)</span><span class="op" id="7111271">,</span><br>
<span class="lineno"></span><span class="op" id="7111273">}</span>
</div>
</body>
</html>
