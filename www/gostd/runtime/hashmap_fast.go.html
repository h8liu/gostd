<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1552321">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1552376">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1552430">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1552481">package</span>&nbsp;<span class="ident" id="1552489">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1552498">import</span>&nbsp;<span class="op" id="1552505">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1552508">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1552517">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1552520">func</span>&nbsp;<span class="ident" id="1552525">mapaccess1_fast32</span><span class="op" id="1552542">(</span><span class="ident" id="1552543">t</span>&nbsp;<span class="op" id="1552545">*</span><span class="ident" id="1552546">maptype</span><span class="op" id="1552553">,</span>&nbsp;<span class="ident" id="1552555">h</span>&nbsp;<span class="op" id="1552557">*</span><span class="ident" id="1552558">hmap</span><span class="op" id="1552562">,</span>&nbsp;<span class="ident" id="1552564">key</span>&nbsp;<span class="builtintype" id="1552568">uint32</span><span class="op" id="1552574">)</span>&nbsp;<span class="ident" id="1552576">unsafe</span><span class="op" id="1552582">.</span><span class="ident" id="1552583">Pointer</span>&nbsp;<span class="op" id="1552591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552594">if</span>&nbsp;<span class="ident" id="1552597">raceenabled</span>&nbsp;<span class="op" id="1552609">&amp;&amp;</span>&nbsp;<span class="ident" id="1552612">h</span>&nbsp;<span class="op" id="1552614">!=</span>&nbsp;<span class="ident" id="1552617">nil</span>&nbsp;<span class="op" id="1552621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552625">callerpc</span>&nbsp;<span class="op" id="1552634">:=</span>&nbsp;<span class="ident" id="1552637">getcallerpc</span><span class="op" id="1552648">(</span><span class="ident" id="1552649">unsafe</span><span class="op" id="1552655">.</span><span class="ident" id="1552656">Pointer</span><span class="op" id="1552663">(</span><span class="op" id="1552664">&amp;</span><span class="ident" id="1552665">t</span><span class="op" id="1552666">)</span><span class="op" id="1552667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552671">racereadpc</span><span class="op" id="1552681">(</span><span class="ident" id="1552682">unsafe</span><span class="op" id="1552688">.</span><span class="ident" id="1552689">Pointer</span><span class="op" id="1552696">(</span><span class="ident" id="1552697">h</span><span class="op" id="1552698">)</span><span class="op" id="1552699">,</span>&nbsp;<span class="ident" id="1552701">callerpc</span><span class="op" id="1552709">,</span>&nbsp;<span class="ident" id="1552711">funcPC</span><span class="op" id="1552717">(</span><span class="ident" id="1552718">mapaccess1_fast32</span><span class="op" id="1552735">)</span><span class="op" id="1552736">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552742">if</span>&nbsp;<span class="ident" id="1552745">h</span>&nbsp;<span class="op" id="1552747">==</span>&nbsp;<span class="ident" id="1552750">nil</span>&nbsp;<span class="op" id="1552754">||</span>&nbsp;<span class="ident" id="1552757">h</span><span class="op" id="1552758">.</span><span class="ident" id="1552759">count</span>&nbsp;<span class="op" id="1552765">==</span>&nbsp;<span class="num" id="1552768">0</span>&nbsp;<span class="op" id="1552770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552774">return</span>&nbsp;<span class="ident" id="1552781">unsafe</span><span class="op" id="1552787">.</span><span class="ident" id="1552788">Pointer</span><span class="op" id="1552795">(</span><span class="ident" id="1552796">t</span><span class="op" id="1552797">.</span><span class="ident" id="1552798">elem</span><span class="op" id="1552802">.</span><span class="ident" id="1552803">zero</span><span class="op" id="1552807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552813">var</span>&nbsp;<span class="ident" id="1552817">b</span>&nbsp;<span class="op" id="1552819">*</span><span class="ident" id="1552820">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552826">if</span>&nbsp;<span class="ident" id="1552829">h</span><span class="op" id="1552830">.</span><span class="ident" id="1552831">B</span>&nbsp;<span class="op" id="1552833">==</span>&nbsp;<span class="num" id="1552836">0</span>&nbsp;<span class="op" id="1552838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1552842">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552883">b</span>&nbsp;<span class="op" id="1552885">=</span>&nbsp;<span class="op" id="1552887">(</span><span class="op" id="1552888">*</span><span class="ident" id="1552889">bmap</span><span class="op" id="1552893">)</span><span class="op" id="1552894">(</span><span class="ident" id="1552895">h</span><span class="op" id="1552896">.</span><span class="ident" id="1552897">buckets</span><span class="op" id="1552904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552907">}</span>&nbsp;<span class="keyword" id="1552909">else</span>&nbsp;<span class="op" id="1552914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552918">hash</span>&nbsp;<span class="op" id="1552923">:=</span>&nbsp;<span class="ident" id="1552926">goalg</span><span class="op" id="1552931">(</span><span class="ident" id="1552932">t</span><span class="op" id="1552933">.</span><span class="ident" id="1552934">key</span><span class="op" id="1552937">.</span><span class="ident" id="1552938">alg</span><span class="op" id="1552941">)</span><span class="op" id="1552942">.</span><span class="ident" id="1552943">hash</span><span class="op" id="1552947">(</span><span class="ident" id="1552948">noescape</span><span class="op" id="1552956">(</span><span class="ident" id="1552957">unsafe</span><span class="op" id="1552963">.</span><span class="ident" id="1552964">Pointer</span><span class="op" id="1552971">(</span><span class="op" id="1552972">&amp;</span><span class="ident" id="1552973">key</span><span class="op" id="1552976">)</span><span class="op" id="1552977">)</span><span class="op" id="1552978">,</span>&nbsp;<span class="num" id="1552980">4</span><span class="op" id="1552981">,</span>&nbsp;<span class="builtintype" id="1552983">uintptr</span><span class="op" id="1552990">(</span><span class="ident" id="1552991">h</span><span class="op" id="1552992">.</span><span class="ident" id="1552993">hash0</span><span class="op" id="1552998">)</span><span class="op" id="1552999">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553003">m</span>&nbsp;<span class="op" id="1553005">:=</span>&nbsp;<span class="builtintype" id="1553008">uintptr</span><span class="op" id="1553015">(</span><span class="num" id="1553016">1</span><span class="op" id="1553017">)</span><span class="op" id="1553018">&lt;&lt;</span><span class="ident" id="1553020">h</span><span class="op" id="1553021">.</span><span class="ident" id="1553022">B</span>&nbsp;<span class="op" id="1553024">-</span>&nbsp;<span class="num" id="1553026">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553030">b</span>&nbsp;<span class="op" id="1553032">=</span>&nbsp;<span class="op" id="1553034">(</span><span class="op" id="1553035">*</span><span class="ident" id="1553036">bmap</span><span class="op" id="1553040">)</span><span class="op" id="1553041">(</span><span class="ident" id="1553042">add</span><span class="op" id="1553045">(</span><span class="ident" id="1553046">h</span><span class="op" id="1553047">.</span><span class="ident" id="1553048">buckets</span><span class="op" id="1553055">,</span>&nbsp;<span class="op" id="1553057">(</span><span class="ident" id="1553058">hash</span><span class="op" id="1553062">&amp;</span><span class="ident" id="1553063">m</span><span class="op" id="1553064">)</span><span class="op" id="1553065">*</span><span class="builtintype" id="1553066">uintptr</span><span class="op" id="1553073">(</span><span class="ident" id="1553074">t</span><span class="op" id="1553075">.</span><span class="ident" id="1553076">bucketsize</span><span class="op" id="1553086">)</span><span class="op" id="1553087">)</span><span class="op" id="1553088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553092">if</span>&nbsp;<span class="ident" id="1553095">c</span>&nbsp;<span class="op" id="1553097">:=</span>&nbsp;<span class="ident" id="1553100">h</span><span class="op" id="1553101">.</span><span class="ident" id="1553102">oldbuckets</span><span class="op" id="1553112">;</span>&nbsp;<span class="ident" id="1553114">c</span>&nbsp;<span class="op" id="1553116">!=</span>&nbsp;<span class="ident" id="1553119">nil</span>&nbsp;<span class="op" id="1553123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553128">oldb</span>&nbsp;<span class="op" id="1553133">:=</span>&nbsp;<span class="op" id="1553136">(</span><span class="op" id="1553137">*</span><span class="ident" id="1553138">bmap</span><span class="op" id="1553142">)</span><span class="op" id="1553143">(</span><span class="ident" id="1553144">add</span><span class="op" id="1553147">(</span><span class="ident" id="1553148">c</span><span class="op" id="1553149">,</span>&nbsp;<span class="op" id="1553151">(</span><span class="ident" id="1553152">hash</span><span class="op" id="1553156">&amp;</span><span class="op" id="1553157">(</span><span class="ident" id="1553158">m</span><span class="op" id="1553159">&gt;&gt;</span><span class="num" id="1553161">1</span><span class="op" id="1553162">)</span><span class="op" id="1553163">)</span><span class="op" id="1553164">*</span><span class="builtintype" id="1553165">uintptr</span><span class="op" id="1553172">(</span><span class="ident" id="1553173">t</span><span class="op" id="1553174">.</span><span class="ident" id="1553175">bucketsize</span><span class="op" id="1553185">)</span><span class="op" id="1553186">)</span><span class="op" id="1553187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553192">if</span>&nbsp;<span class="op" id="1553195">!</span><span class="ident" id="1553196">evacuated</span><span class="op" id="1553205">(</span><span class="ident" id="1553206">oldb</span><span class="op" id="1553210">)</span>&nbsp;<span class="op" id="1553212">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553218">b</span>&nbsp;<span class="op" id="1553220">=</span>&nbsp;<span class="ident" id="1553222">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553240">for</span>&nbsp;<span class="op" id="1553244">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553248">for</span>&nbsp;<span class="ident" id="1553252">i</span>&nbsp;<span class="op" id="1553254">:=</span>&nbsp;<span class="builtintype" id="1553257">uintptr</span><span class="op" id="1553264">(</span><span class="num" id="1553265">0</span><span class="op" id="1553266">)</span><span class="op" id="1553267">;</span>&nbsp;<span class="ident" id="1553269">i</span>&nbsp;<span class="op" id="1553271">&lt;</span>&nbsp;<span class="ident" id="1553273">bucketCnt</span><span class="op" id="1553282">;</span>&nbsp;<span class="ident" id="1553284">i</span><span class="op" id="1553285">++</span>&nbsp;<span class="op" id="1553288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553293">k</span>&nbsp;<span class="op" id="1553295">:=</span>&nbsp;<span class="op" id="1553298">*</span><span class="op" id="1553299">(</span><span class="op" id="1553300">(</span><span class="op" id="1553301">*</span><span class="builtintype" id="1553302">uint32</span><span class="op" id="1553308">)</span><span class="op" id="1553309">(</span><span class="ident" id="1553310">add</span><span class="op" id="1553313">(</span><span class="ident" id="1553314">unsafe</span><span class="op" id="1553320">.</span><span class="ident" id="1553321">Pointer</span><span class="op" id="1553328">(</span><span class="ident" id="1553329">b</span><span class="op" id="1553330">)</span><span class="op" id="1553331">,</span>&nbsp;<span class="ident" id="1553333">dataOffset</span><span class="op" id="1553343">+</span><span class="ident" id="1553344">i</span><span class="op" id="1553345">*</span><span class="num" id="1553346">4</span><span class="op" id="1553347">)</span><span class="op" id="1553348">)</span><span class="op" id="1553349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553354">if</span>&nbsp;<span class="ident" id="1553357">k</span>&nbsp;<span class="op" id="1553359">!=</span>&nbsp;<span class="ident" id="1553362">key</span>&nbsp;<span class="op" id="1553366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553372">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553384">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553389">x</span>&nbsp;<span class="op" id="1553391">:=</span>&nbsp;<span class="op" id="1553394">*</span><span class="op" id="1553395">(</span><span class="op" id="1553396">(</span><span class="op" id="1553397">*</span><span class="builtintype" id="1553398">uint8</span><span class="op" id="1553403">)</span><span class="op" id="1553404">(</span><span class="ident" id="1553405">add</span><span class="op" id="1553408">(</span><span class="ident" id="1553409">unsafe</span><span class="op" id="1553415">.</span><span class="ident" id="1553416">Pointer</span><span class="op" id="1553423">(</span><span class="ident" id="1553424">b</span><span class="op" id="1553425">)</span><span class="op" id="1553426">,</span>&nbsp;<span class="ident" id="1553428">i</span><span class="op" id="1553429">)</span><span class="op" id="1553430">)</span><span class="op" id="1553431">)</span>&nbsp;<span class="comment" id="1553433">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553477">if</span>&nbsp;<span class="ident" id="1553480">x</span>&nbsp;<span class="op" id="1553482">==</span>&nbsp;<span class="ident" id="1553485">empty</span>&nbsp;<span class="op" id="1553491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553497">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553514">return</span>&nbsp;<span class="ident" id="1553521">add</span><span class="op" id="1553524">(</span><span class="ident" id="1553525">unsafe</span><span class="op" id="1553531">.</span><span class="ident" id="1553532">Pointer</span><span class="op" id="1553539">(</span><span class="ident" id="1553540">b</span><span class="op" id="1553541">)</span><span class="op" id="1553542">,</span>&nbsp;<span class="ident" id="1553544">dataOffset</span><span class="op" id="1553554">+</span><span class="ident" id="1553555">bucketCnt</span><span class="op" id="1553564">*</span><span class="num" id="1553565">4</span><span class="op" id="1553566">+</span><span class="ident" id="1553567">i</span><span class="op" id="1553568">*</span><span class="builtintype" id="1553569">uintptr</span><span class="op" id="1553576">(</span><span class="ident" id="1553577">t</span><span class="op" id="1553578">.</span><span class="ident" id="1553579">valuesize</span><span class="op" id="1553588">)</span><span class="op" id="1553589">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553597">b</span>&nbsp;<span class="op" id="1553599">=</span>&nbsp;<span class="ident" id="1553601">b</span><span class="op" id="1553602">.</span><span class="ident" id="1553603">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553614">if</span>&nbsp;<span class="ident" id="1553617">b</span>&nbsp;<span class="op" id="1553619">==</span>&nbsp;<span class="ident" id="1553622">nil</span>&nbsp;<span class="op" id="1553626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553631">return</span>&nbsp;<span class="ident" id="1553638">unsafe</span><span class="op" id="1553644">.</span><span class="ident" id="1553645">Pointer</span><span class="op" id="1553652">(</span><span class="ident" id="1553653">t</span><span class="op" id="1553654">.</span><span class="ident" id="1553655">elem</span><span class="op" id="1553659">.</span><span class="ident" id="1553660">zero</span><span class="op" id="1553664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553668">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553671">}</span><br>
<span class="lineno"></span><span class="op" id="1553673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1553676">func</span>&nbsp;<span class="ident" id="1553681">mapaccess2_fast32</span><span class="op" id="1553698">(</span><span class="ident" id="1553699">t</span>&nbsp;<span class="op" id="1553701">*</span><span class="ident" id="1553702">maptype</span><span class="op" id="1553709">,</span>&nbsp;<span class="ident" id="1553711">h</span>&nbsp;<span class="op" id="1553713">*</span><span class="ident" id="1553714">hmap</span><span class="op" id="1553718">,</span>&nbsp;<span class="ident" id="1553720">key</span>&nbsp;<span class="builtintype" id="1553724">uint32</span><span class="op" id="1553730">)</span>&nbsp;<span class="op" id="1553732">(</span><span class="ident" id="1553733">unsafe</span><span class="op" id="1553739">.</span><span class="ident" id="1553740">Pointer</span><span class="op" id="1553747">,</span>&nbsp;<span class="builtintype" id="1553749">bool</span><span class="op" id="1553753">)</span>&nbsp;<span class="op" id="1553755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553758">if</span>&nbsp;<span class="ident" id="1553761">raceenabled</span>&nbsp;<span class="op" id="1553773">&amp;&amp;</span>&nbsp;<span class="ident" id="1553776">h</span>&nbsp;<span class="op" id="1553778">!=</span>&nbsp;<span class="ident" id="1553781">nil</span>&nbsp;<span class="op" id="1553785">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553789">callerpc</span>&nbsp;<span class="op" id="1553798">:=</span>&nbsp;<span class="ident" id="1553801">getcallerpc</span><span class="op" id="1553812">(</span><span class="ident" id="1553813">unsafe</span><span class="op" id="1553819">.</span><span class="ident" id="1553820">Pointer</span><span class="op" id="1553827">(</span><span class="op" id="1553828">&amp;</span><span class="ident" id="1553829">t</span><span class="op" id="1553830">)</span><span class="op" id="1553831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553835">racereadpc</span><span class="op" id="1553845">(</span><span class="ident" id="1553846">unsafe</span><span class="op" id="1553852">.</span><span class="ident" id="1553853">Pointer</span><span class="op" id="1553860">(</span><span class="ident" id="1553861">h</span><span class="op" id="1553862">)</span><span class="op" id="1553863">,</span>&nbsp;<span class="ident" id="1553865">callerpc</span><span class="op" id="1553873">,</span>&nbsp;<span class="ident" id="1553875">funcPC</span><span class="op" id="1553881">(</span><span class="ident" id="1553882">mapaccess2_fast32</span><span class="op" id="1553899">)</span><span class="op" id="1553900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553906">if</span>&nbsp;<span class="ident" id="1553909">h</span>&nbsp;<span class="op" id="1553911">==</span>&nbsp;<span class="ident" id="1553914">nil</span>&nbsp;<span class="op" id="1553918">||</span>&nbsp;<span class="ident" id="1553921">h</span><span class="op" id="1553922">.</span><span class="ident" id="1553923">count</span>&nbsp;<span class="op" id="1553929">==</span>&nbsp;<span class="num" id="1553932">0</span>&nbsp;<span class="op" id="1553934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553938">return</span>&nbsp;<span class="ident" id="1553945">unsafe</span><span class="op" id="1553951">.</span><span class="ident" id="1553952">Pointer</span><span class="op" id="1553959">(</span><span class="ident" id="1553960">t</span><span class="op" id="1553961">.</span><span class="ident" id="1553962">elem</span><span class="op" id="1553966">.</span><span class="ident" id="1553967">zero</span><span class="op" id="1553971">)</span><span class="op" id="1553972">,</span>&nbsp;<span class="builtintype" id="1553974">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553984">var</span>&nbsp;<span class="ident" id="1553988">b</span>&nbsp;<span class="op" id="1553990">*</span><span class="ident" id="1553991">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553997">if</span>&nbsp;<span class="ident" id="1554000">h</span><span class="op" id="1554001">.</span><span class="ident" id="1554002">B</span>&nbsp;<span class="op" id="1554004">==</span>&nbsp;<span class="num" id="1554007">0</span>&nbsp;<span class="op" id="1554009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1554013">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554054">b</span>&nbsp;<span class="op" id="1554056">=</span>&nbsp;<span class="op" id="1554058">(</span><span class="op" id="1554059">*</span><span class="ident" id="1554060">bmap</span><span class="op" id="1554064">)</span><span class="op" id="1554065">(</span><span class="ident" id="1554066">h</span><span class="op" id="1554067">.</span><span class="ident" id="1554068">buckets</span><span class="op" id="1554075">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554078">}</span>&nbsp;<span class="keyword" id="1554080">else</span>&nbsp;<span class="op" id="1554085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554089">hash</span>&nbsp;<span class="op" id="1554094">:=</span>&nbsp;<span class="ident" id="1554097">goalg</span><span class="op" id="1554102">(</span><span class="ident" id="1554103">t</span><span class="op" id="1554104">.</span><span class="ident" id="1554105">key</span><span class="op" id="1554108">.</span><span class="ident" id="1554109">alg</span><span class="op" id="1554112">)</span><span class="op" id="1554113">.</span><span class="ident" id="1554114">hash</span><span class="op" id="1554118">(</span><span class="ident" id="1554119">noescape</span><span class="op" id="1554127">(</span><span class="ident" id="1554128">unsafe</span><span class="op" id="1554134">.</span><span class="ident" id="1554135">Pointer</span><span class="op" id="1554142">(</span><span class="op" id="1554143">&amp;</span><span class="ident" id="1554144">key</span><span class="op" id="1554147">)</span><span class="op" id="1554148">)</span><span class="op" id="1554149">,</span>&nbsp;<span class="num" id="1554151">4</span><span class="op" id="1554152">,</span>&nbsp;<span class="builtintype" id="1554154">uintptr</span><span class="op" id="1554161">(</span><span class="ident" id="1554162">h</span><span class="op" id="1554163">.</span><span class="ident" id="1554164">hash0</span><span class="op" id="1554169">)</span><span class="op" id="1554170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554174">m</span>&nbsp;<span class="op" id="1554176">:=</span>&nbsp;<span class="builtintype" id="1554179">uintptr</span><span class="op" id="1554186">(</span><span class="num" id="1554187">1</span><span class="op" id="1554188">)</span><span class="op" id="1554189">&lt;&lt;</span><span class="ident" id="1554191">h</span><span class="op" id="1554192">.</span><span class="ident" id="1554193">B</span>&nbsp;<span class="op" id="1554195">-</span>&nbsp;<span class="num" id="1554197">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554201">b</span>&nbsp;<span class="op" id="1554203">=</span>&nbsp;<span class="op" id="1554205">(</span><span class="op" id="1554206">*</span><span class="ident" id="1554207">bmap</span><span class="op" id="1554211">)</span><span class="op" id="1554212">(</span><span class="ident" id="1554213">add</span><span class="op" id="1554216">(</span><span class="ident" id="1554217">h</span><span class="op" id="1554218">.</span><span class="ident" id="1554219">buckets</span><span class="op" id="1554226">,</span>&nbsp;<span class="op" id="1554228">(</span><span class="ident" id="1554229">hash</span><span class="op" id="1554233">&amp;</span><span class="ident" id="1554234">m</span><span class="op" id="1554235">)</span><span class="op" id="1554236">*</span><span class="builtintype" id="1554237">uintptr</span><span class="op" id="1554244">(</span><span class="ident" id="1554245">t</span><span class="op" id="1554246">.</span><span class="ident" id="1554247">bucketsize</span><span class="op" id="1554257">)</span><span class="op" id="1554258">)</span><span class="op" id="1554259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554263">if</span>&nbsp;<span class="ident" id="1554266">c</span>&nbsp;<span class="op" id="1554268">:=</span>&nbsp;<span class="ident" id="1554271">h</span><span class="op" id="1554272">.</span><span class="ident" id="1554273">oldbuckets</span><span class="op" id="1554283">;</span>&nbsp;<span class="ident" id="1554285">c</span>&nbsp;<span class="op" id="1554287">!=</span>&nbsp;<span class="ident" id="1554290">nil</span>&nbsp;<span class="op" id="1554294">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554299">oldb</span>&nbsp;<span class="op" id="1554304">:=</span>&nbsp;<span class="op" id="1554307">(</span><span class="op" id="1554308">*</span><span class="ident" id="1554309">bmap</span><span class="op" id="1554313">)</span><span class="op" id="1554314">(</span><span class="ident" id="1554315">add</span><span class="op" id="1554318">(</span><span class="ident" id="1554319">c</span><span class="op" id="1554320">,</span>&nbsp;<span class="op" id="1554322">(</span><span class="ident" id="1554323">hash</span><span class="op" id="1554327">&amp;</span><span class="op" id="1554328">(</span><span class="ident" id="1554329">m</span><span class="op" id="1554330">&gt;&gt;</span><span class="num" id="1554332">1</span><span class="op" id="1554333">)</span><span class="op" id="1554334">)</span><span class="op" id="1554335">*</span><span class="builtintype" id="1554336">uintptr</span><span class="op" id="1554343">(</span><span class="ident" id="1554344">t</span><span class="op" id="1554345">.</span><span class="ident" id="1554346">bucketsize</span><span class="op" id="1554356">)</span><span class="op" id="1554357">)</span><span class="op" id="1554358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554363">if</span>&nbsp;<span class="op" id="1554366">!</span><span class="ident" id="1554367">evacuated</span><span class="op" id="1554376">(</span><span class="ident" id="1554377">oldb</span><span class="op" id="1554381">)</span>&nbsp;<span class="op" id="1554383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554389">b</span>&nbsp;<span class="op" id="1554391">=</span>&nbsp;<span class="ident" id="1554393">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554405">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554411">for</span>&nbsp;<span class="op" id="1554415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554419">for</span>&nbsp;<span class="ident" id="1554423">i</span>&nbsp;<span class="op" id="1554425">:=</span>&nbsp;<span class="builtintype" id="1554428">uintptr</span><span class="op" id="1554435">(</span><span class="num" id="1554436">0</span><span class="op" id="1554437">)</span><span class="op" id="1554438">;</span>&nbsp;<span class="ident" id="1554440">i</span>&nbsp;<span class="op" id="1554442">&lt;</span>&nbsp;<span class="ident" id="1554444">bucketCnt</span><span class="op" id="1554453">;</span>&nbsp;<span class="ident" id="1554455">i</span><span class="op" id="1554456">++</span>&nbsp;<span class="op" id="1554459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554464">k</span>&nbsp;<span class="op" id="1554466">:=</span>&nbsp;<span class="op" id="1554469">*</span><span class="op" id="1554470">(</span><span class="op" id="1554471">(</span><span class="op" id="1554472">*</span><span class="builtintype" id="1554473">uint32</span><span class="op" id="1554479">)</span><span class="op" id="1554480">(</span><span class="ident" id="1554481">add</span><span class="op" id="1554484">(</span><span class="ident" id="1554485">unsafe</span><span class="op" id="1554491">.</span><span class="ident" id="1554492">Pointer</span><span class="op" id="1554499">(</span><span class="ident" id="1554500">b</span><span class="op" id="1554501">)</span><span class="op" id="1554502">,</span>&nbsp;<span class="ident" id="1554504">dataOffset</span><span class="op" id="1554514">+</span><span class="ident" id="1554515">i</span><span class="op" id="1554516">*</span><span class="num" id="1554517">4</span><span class="op" id="1554518">)</span><span class="op" id="1554519">)</span><span class="op" id="1554520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554525">if</span>&nbsp;<span class="ident" id="1554528">k</span>&nbsp;<span class="op" id="1554530">!=</span>&nbsp;<span class="ident" id="1554533">key</span>&nbsp;<span class="op" id="1554537">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554543">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554560">x</span>&nbsp;<span class="op" id="1554562">:=</span>&nbsp;<span class="op" id="1554565">*</span><span class="op" id="1554566">(</span><span class="op" id="1554567">(</span><span class="op" id="1554568">*</span><span class="builtintype" id="1554569">uint8</span><span class="op" id="1554574">)</span><span class="op" id="1554575">(</span><span class="ident" id="1554576">add</span><span class="op" id="1554579">(</span><span class="ident" id="1554580">unsafe</span><span class="op" id="1554586">.</span><span class="ident" id="1554587">Pointer</span><span class="op" id="1554594">(</span><span class="ident" id="1554595">b</span><span class="op" id="1554596">)</span><span class="op" id="1554597">,</span>&nbsp;<span class="ident" id="1554599">i</span><span class="op" id="1554600">)</span><span class="op" id="1554601">)</span><span class="op" id="1554602">)</span>&nbsp;<span class="comment" id="1554604">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554648">if</span>&nbsp;<span class="ident" id="1554651">x</span>&nbsp;<span class="op" id="1554653">==</span>&nbsp;<span class="ident" id="1554656">empty</span>&nbsp;<span class="op" id="1554662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554668">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554685">return</span>&nbsp;<span class="ident" id="1554692">add</span><span class="op" id="1554695">(</span><span class="ident" id="1554696">unsafe</span><span class="op" id="1554702">.</span><span class="ident" id="1554703">Pointer</span><span class="op" id="1554710">(</span><span class="ident" id="1554711">b</span><span class="op" id="1554712">)</span><span class="op" id="1554713">,</span>&nbsp;<span class="ident" id="1554715">dataOffset</span><span class="op" id="1554725">+</span><span class="ident" id="1554726">bucketCnt</span><span class="op" id="1554735">*</span><span class="num" id="1554736">4</span><span class="op" id="1554737">+</span><span class="ident" id="1554738">i</span><span class="op" id="1554739">*</span><span class="builtintype" id="1554740">uintptr</span><span class="op" id="1554747">(</span><span class="ident" id="1554748">t</span><span class="op" id="1554749">.</span><span class="ident" id="1554750">valuesize</span><span class="op" id="1554759">)</span><span class="op" id="1554760">)</span><span class="op" id="1554761">,</span>&nbsp;<span class="builtintype" id="1554763">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554774">b</span>&nbsp;<span class="op" id="1554776">=</span>&nbsp;<span class="ident" id="1554778">b</span><span class="op" id="1554779">.</span><span class="ident" id="1554780">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554791">if</span>&nbsp;<span class="ident" id="1554794">b</span>&nbsp;<span class="op" id="1554796">==</span>&nbsp;<span class="ident" id="1554799">nil</span>&nbsp;<span class="op" id="1554803">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554808">return</span>&nbsp;<span class="ident" id="1554815">unsafe</span><span class="op" id="1554821">.</span><span class="ident" id="1554822">Pointer</span><span class="op" id="1554829">(</span><span class="ident" id="1554830">t</span><span class="op" id="1554831">.</span><span class="ident" id="1554832">elem</span><span class="op" id="1554836">.</span><span class="ident" id="1554837">zero</span><span class="op" id="1554841">)</span><span class="op" id="1554842">,</span>&nbsp;<span class="builtintype" id="1554844">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554855">}</span><br>
<span class="lineno"></span><span class="op" id="1554857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1554860">func</span>&nbsp;<span class="ident" id="1554865">mapaccess1_fast64</span><span class="op" id="1554882">(</span><span class="ident" id="1554883">t</span>&nbsp;<span class="op" id="1554885">*</span><span class="ident" id="1554886">maptype</span><span class="op" id="1554893">,</span>&nbsp;<span class="ident" id="1554895">h</span>&nbsp;<span class="op" id="1554897">*</span><span class="ident" id="1554898">hmap</span><span class="op" id="1554902">,</span>&nbsp;<span class="ident" id="1554904">key</span>&nbsp;<span class="ident" id="1554908">uint64</span><span class="op" id="1554914">)</span>&nbsp;<span class="ident" id="1554916">unsafe</span><span class="op" id="1554922">.</span><span class="ident" id="1554923">Pointer</span>&nbsp;<span class="op" id="1554931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554934">if</span>&nbsp;<span class="ident" id="1554937">raceenabled</span>&nbsp;<span class="op" id="1554949">&amp;&amp;</span>&nbsp;<span class="ident" id="1554952">h</span>&nbsp;<span class="op" id="1554954">!=</span>&nbsp;<span class="ident" id="1554957">nil</span>&nbsp;<span class="op" id="1554961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554965">callerpc</span>&nbsp;<span class="op" id="1554974">:=</span>&nbsp;<span class="ident" id="1554977">getcallerpc</span><span class="op" id="1554988">(</span><span class="ident" id="1554989">unsafe</span><span class="op" id="1554995">.</span><span class="ident" id="1554996">Pointer</span><span class="op" id="1555003">(</span><span class="op" id="1555004">&amp;</span><span class="ident" id="1555005">t</span><span class="op" id="1555006">)</span><span class="op" id="1555007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555011">racereadpc</span><span class="op" id="1555021">(</span><span class="ident" id="1555022">unsafe</span><span class="op" id="1555028">.</span><span class="ident" id="1555029">Pointer</span><span class="op" id="1555036">(</span><span class="ident" id="1555037">h</span><span class="op" id="1555038">)</span><span class="op" id="1555039">,</span>&nbsp;<span class="ident" id="1555041">callerpc</span><span class="op" id="1555049">,</span>&nbsp;<span class="ident" id="1555051">funcPC</span><span class="op" id="1555057">(</span><span class="ident" id="1555058">mapaccess1_fast64</span><span class="op" id="1555075">)</span><span class="op" id="1555076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555079">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555082">if</span>&nbsp;<span class="ident" id="1555085">h</span>&nbsp;<span class="op" id="1555087">==</span>&nbsp;<span class="ident" id="1555090">nil</span>&nbsp;<span class="op" id="1555094">||</span>&nbsp;<span class="ident" id="1555097">h</span><span class="op" id="1555098">.</span><span class="ident" id="1555099">count</span>&nbsp;<span class="op" id="1555105">==</span>&nbsp;<span class="num" id="1555108">0</span>&nbsp;<span class="op" id="1555110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555114">return</span>&nbsp;<span class="ident" id="1555121">unsafe</span><span class="op" id="1555127">.</span><span class="ident" id="1555128">Pointer</span><span class="op" id="1555135">(</span><span class="ident" id="1555136">t</span><span class="op" id="1555137">.</span><span class="ident" id="1555138">elem</span><span class="op" id="1555142">.</span><span class="ident" id="1555143">zero</span><span class="op" id="1555147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555153">var</span>&nbsp;<span class="ident" id="1555157">b</span>&nbsp;<span class="op" id="1555159">*</span><span class="ident" id="1555160">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555166">if</span>&nbsp;<span class="ident" id="1555169">h</span><span class="op" id="1555170">.</span><span class="ident" id="1555171">B</span>&nbsp;<span class="op" id="1555173">==</span>&nbsp;<span class="num" id="1555176">0</span>&nbsp;<span class="op" id="1555178">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555182">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555223">b</span>&nbsp;<span class="op" id="1555225">=</span>&nbsp;<span class="op" id="1555227">(</span><span class="op" id="1555228">*</span><span class="ident" id="1555229">bmap</span><span class="op" id="1555233">)</span><span class="op" id="1555234">(</span><span class="ident" id="1555235">h</span><span class="op" id="1555236">.</span><span class="ident" id="1555237">buckets</span><span class="op" id="1555244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555247">}</span>&nbsp;<span class="keyword" id="1555249">else</span>&nbsp;<span class="op" id="1555254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555258">hash</span>&nbsp;<span class="op" id="1555263">:=</span>&nbsp;<span class="ident" id="1555266">goalg</span><span class="op" id="1555271">(</span><span class="ident" id="1555272">t</span><span class="op" id="1555273">.</span><span class="ident" id="1555274">key</span><span class="op" id="1555277">.</span><span class="ident" id="1555278">alg</span><span class="op" id="1555281">)</span><span class="op" id="1555282">.</span><span class="ident" id="1555283">hash</span><span class="op" id="1555287">(</span><span class="ident" id="1555288">noescape</span><span class="op" id="1555296">(</span><span class="ident" id="1555297">unsafe</span><span class="op" id="1555303">.</span><span class="ident" id="1555304">Pointer</span><span class="op" id="1555311">(</span><span class="op" id="1555312">&amp;</span><span class="ident" id="1555313">key</span><span class="op" id="1555316">)</span><span class="op" id="1555317">)</span><span class="op" id="1555318">,</span>&nbsp;<span class="num" id="1555320">8</span><span class="op" id="1555321">,</span>&nbsp;<span class="builtintype" id="1555323">uintptr</span><span class="op" id="1555330">(</span><span class="ident" id="1555331">h</span><span class="op" id="1555332">.</span><span class="ident" id="1555333">hash0</span><span class="op" id="1555338">)</span><span class="op" id="1555339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555343">m</span>&nbsp;<span class="op" id="1555345">:=</span>&nbsp;<span class="builtintype" id="1555348">uintptr</span><span class="op" id="1555355">(</span><span class="num" id="1555356">1</span><span class="op" id="1555357">)</span><span class="op" id="1555358">&lt;&lt;</span><span class="ident" id="1555360">h</span><span class="op" id="1555361">.</span><span class="ident" id="1555362">B</span>&nbsp;<span class="op" id="1555364">-</span>&nbsp;<span class="num" id="1555366">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555370">b</span>&nbsp;<span class="op" id="1555372">=</span>&nbsp;<span class="op" id="1555374">(</span><span class="op" id="1555375">*</span><span class="ident" id="1555376">bmap</span><span class="op" id="1555380">)</span><span class="op" id="1555381">(</span><span class="ident" id="1555382">add</span><span class="op" id="1555385">(</span><span class="ident" id="1555386">h</span><span class="op" id="1555387">.</span><span class="ident" id="1555388">buckets</span><span class="op" id="1555395">,</span>&nbsp;<span class="op" id="1555397">(</span><span class="ident" id="1555398">hash</span><span class="op" id="1555402">&amp;</span><span class="ident" id="1555403">m</span><span class="op" id="1555404">)</span><span class="op" id="1555405">*</span><span class="builtintype" id="1555406">uintptr</span><span class="op" id="1555413">(</span><span class="ident" id="1555414">t</span><span class="op" id="1555415">.</span><span class="ident" id="1555416">bucketsize</span><span class="op" id="1555426">)</span><span class="op" id="1555427">)</span><span class="op" id="1555428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555432">if</span>&nbsp;<span class="ident" id="1555435">c</span>&nbsp;<span class="op" id="1555437">:=</span>&nbsp;<span class="ident" id="1555440">h</span><span class="op" id="1555441">.</span><span class="ident" id="1555442">oldbuckets</span><span class="op" id="1555452">;</span>&nbsp;<span class="ident" id="1555454">c</span>&nbsp;<span class="op" id="1555456">!=</span>&nbsp;<span class="ident" id="1555459">nil</span>&nbsp;<span class="op" id="1555463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555468">oldb</span>&nbsp;<span class="op" id="1555473">:=</span>&nbsp;<span class="op" id="1555476">(</span><span class="op" id="1555477">*</span><span class="ident" id="1555478">bmap</span><span class="op" id="1555482">)</span><span class="op" id="1555483">(</span><span class="ident" id="1555484">add</span><span class="op" id="1555487">(</span><span class="ident" id="1555488">c</span><span class="op" id="1555489">,</span>&nbsp;<span class="op" id="1555491">(</span><span class="ident" id="1555492">hash</span><span class="op" id="1555496">&amp;</span><span class="op" id="1555497">(</span><span class="ident" id="1555498">m</span><span class="op" id="1555499">&gt;&gt;</span><span class="num" id="1555501">1</span><span class="op" id="1555502">)</span><span class="op" id="1555503">)</span><span class="op" id="1555504">*</span><span class="builtintype" id="1555505">uintptr</span><span class="op" id="1555512">(</span><span class="ident" id="1555513">t</span><span class="op" id="1555514">.</span><span class="ident" id="1555515">bucketsize</span><span class="op" id="1555525">)</span><span class="op" id="1555526">)</span><span class="op" id="1555527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555532">if</span>&nbsp;<span class="op" id="1555535">!</span><span class="ident" id="1555536">evacuated</span><span class="op" id="1555545">(</span><span class="ident" id="1555546">oldb</span><span class="op" id="1555550">)</span>&nbsp;<span class="op" id="1555552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555558">b</span>&nbsp;<span class="op" id="1555560">=</span>&nbsp;<span class="ident" id="1555562">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555580">for</span>&nbsp;<span class="op" id="1555584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555588">for</span>&nbsp;<span class="ident" id="1555592">i</span>&nbsp;<span class="op" id="1555594">:=</span>&nbsp;<span class="builtintype" id="1555597">uintptr</span><span class="op" id="1555604">(</span><span class="num" id="1555605">0</span><span class="op" id="1555606">)</span><span class="op" id="1555607">;</span>&nbsp;<span class="ident" id="1555609">i</span>&nbsp;<span class="op" id="1555611">&lt;</span>&nbsp;<span class="ident" id="1555613">bucketCnt</span><span class="op" id="1555622">;</span>&nbsp;<span class="ident" id="1555624">i</span><span class="op" id="1555625">++</span>&nbsp;<span class="op" id="1555628">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555633">k</span>&nbsp;<span class="op" id="1555635">:=</span>&nbsp;<span class="op" id="1555638">*</span><span class="op" id="1555639">(</span><span class="op" id="1555640">(</span><span class="op" id="1555641">*</span><span class="ident" id="1555642">uint64</span><span class="op" id="1555648">)</span><span class="op" id="1555649">(</span><span class="ident" id="1555650">add</span><span class="op" id="1555653">(</span><span class="ident" id="1555654">unsafe</span><span class="op" id="1555660">.</span><span class="ident" id="1555661">Pointer</span><span class="op" id="1555668">(</span><span class="ident" id="1555669">b</span><span class="op" id="1555670">)</span><span class="op" id="1555671">,</span>&nbsp;<span class="ident" id="1555673">dataOffset</span><span class="op" id="1555683">+</span><span class="ident" id="1555684">i</span><span class="op" id="1555685">*</span><span class="num" id="1555686">8</span><span class="op" id="1555687">)</span><span class="op" id="1555688">)</span><span class="op" id="1555689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555694">if</span>&nbsp;<span class="ident" id="1555697">k</span>&nbsp;<span class="op" id="1555699">!=</span>&nbsp;<span class="ident" id="1555702">key</span>&nbsp;<span class="op" id="1555706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555712">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555729">x</span>&nbsp;<span class="op" id="1555731">:=</span>&nbsp;<span class="op" id="1555734">*</span><span class="op" id="1555735">(</span><span class="op" id="1555736">(</span><span class="op" id="1555737">*</span><span class="builtintype" id="1555738">uint8</span><span class="op" id="1555743">)</span><span class="op" id="1555744">(</span><span class="ident" id="1555745">add</span><span class="op" id="1555748">(</span><span class="ident" id="1555749">unsafe</span><span class="op" id="1555755">.</span><span class="ident" id="1555756">Pointer</span><span class="op" id="1555763">(</span><span class="ident" id="1555764">b</span><span class="op" id="1555765">)</span><span class="op" id="1555766">,</span>&nbsp;<span class="ident" id="1555768">i</span><span class="op" id="1555769">)</span><span class="op" id="1555770">)</span><span class="op" id="1555771">)</span>&nbsp;<span class="comment" id="1555773">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555817">if</span>&nbsp;<span class="ident" id="1555820">x</span>&nbsp;<span class="op" id="1555822">==</span>&nbsp;<span class="ident" id="1555825">empty</span>&nbsp;<span class="op" id="1555831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555837">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555854">return</span>&nbsp;<span class="ident" id="1555861">add</span><span class="op" id="1555864">(</span><span class="ident" id="1555865">unsafe</span><span class="op" id="1555871">.</span><span class="ident" id="1555872">Pointer</span><span class="op" id="1555879">(</span><span class="ident" id="1555880">b</span><span class="op" id="1555881">)</span><span class="op" id="1555882">,</span>&nbsp;<span class="ident" id="1555884">dataOffset</span><span class="op" id="1555894">+</span><span class="ident" id="1555895">bucketCnt</span><span class="op" id="1555904">*</span><span class="num" id="1555905">8</span><span class="op" id="1555906">+</span><span class="ident" id="1555907">i</span><span class="op" id="1555908">*</span><span class="builtintype" id="1555909">uintptr</span><span class="op" id="1555916">(</span><span class="ident" id="1555917">t</span><span class="op" id="1555918">.</span><span class="ident" id="1555919">valuesize</span><span class="op" id="1555928">)</span><span class="op" id="1555929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555933">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555937">b</span>&nbsp;<span class="op" id="1555939">=</span>&nbsp;<span class="ident" id="1555941">b</span><span class="op" id="1555942">.</span><span class="ident" id="1555943">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555954">if</span>&nbsp;<span class="ident" id="1555957">b</span>&nbsp;<span class="op" id="1555959">==</span>&nbsp;<span class="ident" id="1555962">nil</span>&nbsp;<span class="op" id="1555966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555971">return</span>&nbsp;<span class="ident" id="1555978">unsafe</span><span class="op" id="1555984">.</span><span class="ident" id="1555985">Pointer</span><span class="op" id="1555992">(</span><span class="ident" id="1555993">t</span><span class="op" id="1555994">.</span><span class="ident" id="1555995">elem</span><span class="op" id="1555999">.</span><span class="ident" id="1556000">zero</span><span class="op" id="1556004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556011">}</span><br>
<span class="lineno">135</span><span class="op" id="1556013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1556016">func</span>&nbsp;<span class="ident" id="1556021">mapaccess2_fast64</span><span class="op" id="1556038">(</span><span class="ident" id="1556039">t</span>&nbsp;<span class="op" id="1556041">*</span><span class="ident" id="1556042">maptype</span><span class="op" id="1556049">,</span>&nbsp;<span class="ident" id="1556051">h</span>&nbsp;<span class="op" id="1556053">*</span><span class="ident" id="1556054">hmap</span><span class="op" id="1556058">,</span>&nbsp;<span class="ident" id="1556060">key</span>&nbsp;<span class="ident" id="1556064">uint64</span><span class="op" id="1556070">)</span>&nbsp;<span class="op" id="1556072">(</span><span class="ident" id="1556073">unsafe</span><span class="op" id="1556079">.</span><span class="ident" id="1556080">Pointer</span><span class="op" id="1556087">,</span>&nbsp;<span class="builtintype" id="1556089">bool</span><span class="op" id="1556093">)</span>&nbsp;<span class="op" id="1556095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556098">if</span>&nbsp;<span class="ident" id="1556101">raceenabled</span>&nbsp;<span class="op" id="1556113">&amp;&amp;</span>&nbsp;<span class="ident" id="1556116">h</span>&nbsp;<span class="op" id="1556118">!=</span>&nbsp;<span class="ident" id="1556121">nil</span>&nbsp;<span class="op" id="1556125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556129">callerpc</span>&nbsp;<span class="op" id="1556138">:=</span>&nbsp;<span class="ident" id="1556141">getcallerpc</span><span class="op" id="1556152">(</span><span class="ident" id="1556153">unsafe</span><span class="op" id="1556159">.</span><span class="ident" id="1556160">Pointer</span><span class="op" id="1556167">(</span><span class="op" id="1556168">&amp;</span><span class="ident" id="1556169">t</span><span class="op" id="1556170">)</span><span class="op" id="1556171">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556175">racereadpc</span><span class="op" id="1556185">(</span><span class="ident" id="1556186">unsafe</span><span class="op" id="1556192">.</span><span class="ident" id="1556193">Pointer</span><span class="op" id="1556200">(</span><span class="ident" id="1556201">h</span><span class="op" id="1556202">)</span><span class="op" id="1556203">,</span>&nbsp;<span class="ident" id="1556205">callerpc</span><span class="op" id="1556213">,</span>&nbsp;<span class="ident" id="1556215">funcPC</span><span class="op" id="1556221">(</span><span class="ident" id="1556222">mapaccess2_fast64</span><span class="op" id="1556239">)</span><span class="op" id="1556240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556246">if</span>&nbsp;<span class="ident" id="1556249">h</span>&nbsp;<span class="op" id="1556251">==</span>&nbsp;<span class="ident" id="1556254">nil</span>&nbsp;<span class="op" id="1556258">||</span>&nbsp;<span class="ident" id="1556261">h</span><span class="op" id="1556262">.</span><span class="ident" id="1556263">count</span>&nbsp;<span class="op" id="1556269">==</span>&nbsp;<span class="num" id="1556272">0</span>&nbsp;<span class="op" id="1556274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556278">return</span>&nbsp;<span class="ident" id="1556285">unsafe</span><span class="op" id="1556291">.</span><span class="ident" id="1556292">Pointer</span><span class="op" id="1556299">(</span><span class="ident" id="1556300">t</span><span class="op" id="1556301">.</span><span class="ident" id="1556302">elem</span><span class="op" id="1556306">.</span><span class="ident" id="1556307">zero</span><span class="op" id="1556311">)</span><span class="op" id="1556312">,</span>&nbsp;<span class="builtintype" id="1556314">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556321">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556324">var</span>&nbsp;<span class="ident" id="1556328">b</span>&nbsp;<span class="op" id="1556330">*</span><span class="ident" id="1556331">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556337">if</span>&nbsp;<span class="ident" id="1556340">h</span><span class="op" id="1556341">.</span><span class="ident" id="1556342">B</span>&nbsp;<span class="op" id="1556344">==</span>&nbsp;<span class="num" id="1556347">0</span>&nbsp;<span class="op" id="1556349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556353">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556394">b</span>&nbsp;<span class="op" id="1556396">=</span>&nbsp;<span class="op" id="1556398">(</span><span class="op" id="1556399">*</span><span class="ident" id="1556400">bmap</span><span class="op" id="1556404">)</span><span class="op" id="1556405">(</span><span class="ident" id="1556406">h</span><span class="op" id="1556407">.</span><span class="ident" id="1556408">buckets</span><span class="op" id="1556415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556418">}</span>&nbsp;<span class="keyword" id="1556420">else</span>&nbsp;<span class="op" id="1556425">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556429">hash</span>&nbsp;<span class="op" id="1556434">:=</span>&nbsp;<span class="ident" id="1556437">goalg</span><span class="op" id="1556442">(</span><span class="ident" id="1556443">t</span><span class="op" id="1556444">.</span><span class="ident" id="1556445">key</span><span class="op" id="1556448">.</span><span class="ident" id="1556449">alg</span><span class="op" id="1556452">)</span><span class="op" id="1556453">.</span><span class="ident" id="1556454">hash</span><span class="op" id="1556458">(</span><span class="ident" id="1556459">noescape</span><span class="op" id="1556467">(</span><span class="ident" id="1556468">unsafe</span><span class="op" id="1556474">.</span><span class="ident" id="1556475">Pointer</span><span class="op" id="1556482">(</span><span class="op" id="1556483">&amp;</span><span class="ident" id="1556484">key</span><span class="op" id="1556487">)</span><span class="op" id="1556488">)</span><span class="op" id="1556489">,</span>&nbsp;<span class="num" id="1556491">8</span><span class="op" id="1556492">,</span>&nbsp;<span class="builtintype" id="1556494">uintptr</span><span class="op" id="1556501">(</span><span class="ident" id="1556502">h</span><span class="op" id="1556503">.</span><span class="ident" id="1556504">hash0</span><span class="op" id="1556509">)</span><span class="op" id="1556510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556514">m</span>&nbsp;<span class="op" id="1556516">:=</span>&nbsp;<span class="builtintype" id="1556519">uintptr</span><span class="op" id="1556526">(</span><span class="num" id="1556527">1</span><span class="op" id="1556528">)</span><span class="op" id="1556529">&lt;&lt;</span><span class="ident" id="1556531">h</span><span class="op" id="1556532">.</span><span class="ident" id="1556533">B</span>&nbsp;<span class="op" id="1556535">-</span>&nbsp;<span class="num" id="1556537">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556541">b</span>&nbsp;<span class="op" id="1556543">=</span>&nbsp;<span class="op" id="1556545">(</span><span class="op" id="1556546">*</span><span class="ident" id="1556547">bmap</span><span class="op" id="1556551">)</span><span class="op" id="1556552">(</span><span class="ident" id="1556553">add</span><span class="op" id="1556556">(</span><span class="ident" id="1556557">h</span><span class="op" id="1556558">.</span><span class="ident" id="1556559">buckets</span><span class="op" id="1556566">,</span>&nbsp;<span class="op" id="1556568">(</span><span class="ident" id="1556569">hash</span><span class="op" id="1556573">&amp;</span><span class="ident" id="1556574">m</span><span class="op" id="1556575">)</span><span class="op" id="1556576">*</span><span class="builtintype" id="1556577">uintptr</span><span class="op" id="1556584">(</span><span class="ident" id="1556585">t</span><span class="op" id="1556586">.</span><span class="ident" id="1556587">bucketsize</span><span class="op" id="1556597">)</span><span class="op" id="1556598">)</span><span class="op" id="1556599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556603">if</span>&nbsp;<span class="ident" id="1556606">c</span>&nbsp;<span class="op" id="1556608">:=</span>&nbsp;<span class="ident" id="1556611">h</span><span class="op" id="1556612">.</span><span class="ident" id="1556613">oldbuckets</span><span class="op" id="1556623">;</span>&nbsp;<span class="ident" id="1556625">c</span>&nbsp;<span class="op" id="1556627">!=</span>&nbsp;<span class="ident" id="1556630">nil</span>&nbsp;<span class="op" id="1556634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556639">oldb</span>&nbsp;<span class="op" id="1556644">:=</span>&nbsp;<span class="op" id="1556647">(</span><span class="op" id="1556648">*</span><span class="ident" id="1556649">bmap</span><span class="op" id="1556653">)</span><span class="op" id="1556654">(</span><span class="ident" id="1556655">add</span><span class="op" id="1556658">(</span><span class="ident" id="1556659">c</span><span class="op" id="1556660">,</span>&nbsp;<span class="op" id="1556662">(</span><span class="ident" id="1556663">hash</span><span class="op" id="1556667">&amp;</span><span class="op" id="1556668">(</span><span class="ident" id="1556669">m</span><span class="op" id="1556670">&gt;&gt;</span><span class="num" id="1556672">1</span><span class="op" id="1556673">)</span><span class="op" id="1556674">)</span><span class="op" id="1556675">*</span><span class="builtintype" id="1556676">uintptr</span><span class="op" id="1556683">(</span><span class="ident" id="1556684">t</span><span class="op" id="1556685">.</span><span class="ident" id="1556686">bucketsize</span><span class="op" id="1556696">)</span><span class="op" id="1556697">)</span><span class="op" id="1556698">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556703">if</span>&nbsp;<span class="op" id="1556706">!</span><span class="ident" id="1556707">evacuated</span><span class="op" id="1556716">(</span><span class="ident" id="1556717">oldb</span><span class="op" id="1556721">)</span>&nbsp;<span class="op" id="1556723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556729">b</span>&nbsp;<span class="op" id="1556731">=</span>&nbsp;<span class="ident" id="1556733">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556748">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556751">for</span>&nbsp;<span class="op" id="1556755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556759">for</span>&nbsp;<span class="ident" id="1556763">i</span>&nbsp;<span class="op" id="1556765">:=</span>&nbsp;<span class="builtintype" id="1556768">uintptr</span><span class="op" id="1556775">(</span><span class="num" id="1556776">0</span><span class="op" id="1556777">)</span><span class="op" id="1556778">;</span>&nbsp;<span class="ident" id="1556780">i</span>&nbsp;<span class="op" id="1556782">&lt;</span>&nbsp;<span class="ident" id="1556784">bucketCnt</span><span class="op" id="1556793">;</span>&nbsp;<span class="ident" id="1556795">i</span><span class="op" id="1556796">++</span>&nbsp;<span class="op" id="1556799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556804">k</span>&nbsp;<span class="op" id="1556806">:=</span>&nbsp;<span class="op" id="1556809">*</span><span class="op" id="1556810">(</span><span class="op" id="1556811">(</span><span class="op" id="1556812">*</span><span class="ident" id="1556813">uint64</span><span class="op" id="1556819">)</span><span class="op" id="1556820">(</span><span class="ident" id="1556821">add</span><span class="op" id="1556824">(</span><span class="ident" id="1556825">unsafe</span><span class="op" id="1556831">.</span><span class="ident" id="1556832">Pointer</span><span class="op" id="1556839">(</span><span class="ident" id="1556840">b</span><span class="op" id="1556841">)</span><span class="op" id="1556842">,</span>&nbsp;<span class="ident" id="1556844">dataOffset</span><span class="op" id="1556854">+</span><span class="ident" id="1556855">i</span><span class="op" id="1556856">*</span><span class="num" id="1556857">8</span><span class="op" id="1556858">)</span><span class="op" id="1556859">)</span><span class="op" id="1556860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556865">if</span>&nbsp;<span class="ident" id="1556868">k</span>&nbsp;<span class="op" id="1556870">!=</span>&nbsp;<span class="ident" id="1556873">key</span>&nbsp;<span class="op" id="1556877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556883">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556900">x</span>&nbsp;<span class="op" id="1556902">:=</span>&nbsp;<span class="op" id="1556905">*</span><span class="op" id="1556906">(</span><span class="op" id="1556907">(</span><span class="op" id="1556908">*</span><span class="builtintype" id="1556909">uint8</span><span class="op" id="1556914">)</span><span class="op" id="1556915">(</span><span class="ident" id="1556916">add</span><span class="op" id="1556919">(</span><span class="ident" id="1556920">unsafe</span><span class="op" id="1556926">.</span><span class="ident" id="1556927">Pointer</span><span class="op" id="1556934">(</span><span class="ident" id="1556935">b</span><span class="op" id="1556936">)</span><span class="op" id="1556937">,</span>&nbsp;<span class="ident" id="1556939">i</span><span class="op" id="1556940">)</span><span class="op" id="1556941">)</span><span class="op" id="1556942">)</span>&nbsp;<span class="comment" id="1556944">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556988">if</span>&nbsp;<span class="ident" id="1556991">x</span>&nbsp;<span class="op" id="1556993">==</span>&nbsp;<span class="ident" id="1556996">empty</span>&nbsp;<span class="op" id="1557002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557008">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557020">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557025">return</span>&nbsp;<span class="ident" id="1557032">add</span><span class="op" id="1557035">(</span><span class="ident" id="1557036">unsafe</span><span class="op" id="1557042">.</span><span class="ident" id="1557043">Pointer</span><span class="op" id="1557050">(</span><span class="ident" id="1557051">b</span><span class="op" id="1557052">)</span><span class="op" id="1557053">,</span>&nbsp;<span class="ident" id="1557055">dataOffset</span><span class="op" id="1557065">+</span><span class="ident" id="1557066">bucketCnt</span><span class="op" id="1557075">*</span><span class="num" id="1557076">8</span><span class="op" id="1557077">+</span><span class="ident" id="1557078">i</span><span class="op" id="1557079">*</span><span class="builtintype" id="1557080">uintptr</span><span class="op" id="1557087">(</span><span class="ident" id="1557088">t</span><span class="op" id="1557089">.</span><span class="ident" id="1557090">valuesize</span><span class="op" id="1557099">)</span><span class="op" id="1557100">)</span><span class="op" id="1557101">,</span>&nbsp;<span class="builtintype" id="1557103">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557114">b</span>&nbsp;<span class="op" id="1557116">=</span>&nbsp;<span class="ident" id="1557118">b</span><span class="op" id="1557119">.</span><span class="ident" id="1557120">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557131">if</span>&nbsp;<span class="ident" id="1557134">b</span>&nbsp;<span class="op" id="1557136">==</span>&nbsp;<span class="ident" id="1557139">nil</span>&nbsp;<span class="op" id="1557143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557148">return</span>&nbsp;<span class="ident" id="1557155">unsafe</span><span class="op" id="1557161">.</span><span class="ident" id="1557162">Pointer</span><span class="op" id="1557169">(</span><span class="ident" id="1557170">t</span><span class="op" id="1557171">.</span><span class="ident" id="1557172">elem</span><span class="op" id="1557176">.</span><span class="ident" id="1557177">zero</span><span class="op" id="1557181">)</span><span class="op" id="1557182">,</span>&nbsp;<span class="builtintype" id="1557184">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557195">}</span><br>
<span class="lineno"></span><span class="op" id="1557197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1557200">func</span>&nbsp;<span class="ident" id="1557205">mapaccess1_faststr</span><span class="op" id="1557223">(</span><span class="ident" id="1557224">t</span>&nbsp;<span class="op" id="1557226">*</span><span class="ident" id="1557227">maptype</span><span class="op" id="1557234">,</span>&nbsp;<span class="ident" id="1557236">h</span>&nbsp;<span class="op" id="1557238">*</span><span class="ident" id="1557239">hmap</span><span class="op" id="1557243">,</span>&nbsp;<span class="ident" id="1557245">ky</span>&nbsp;<span class="builtintype" id="1557248">string</span><span class="op" id="1557254">)</span>&nbsp;<span class="ident" id="1557256">unsafe</span><span class="op" id="1557262">.</span><span class="ident" id="1557263">Pointer</span>&nbsp;<span class="op" id="1557271">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557274">if</span>&nbsp;<span class="ident" id="1557277">raceenabled</span>&nbsp;<span class="op" id="1557289">&amp;&amp;</span>&nbsp;<span class="ident" id="1557292">h</span>&nbsp;<span class="op" id="1557294">!=</span>&nbsp;<span class="ident" id="1557297">nil</span>&nbsp;<span class="op" id="1557301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557305">callerpc</span>&nbsp;<span class="op" id="1557314">:=</span>&nbsp;<span class="ident" id="1557317">getcallerpc</span><span class="op" id="1557328">(</span><span class="ident" id="1557329">unsafe</span><span class="op" id="1557335">.</span><span class="ident" id="1557336">Pointer</span><span class="op" id="1557343">(</span><span class="op" id="1557344">&amp;</span><span class="ident" id="1557345">t</span><span class="op" id="1557346">)</span><span class="op" id="1557347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557351">racereadpc</span><span class="op" id="1557361">(</span><span class="ident" id="1557362">unsafe</span><span class="op" id="1557368">.</span><span class="ident" id="1557369">Pointer</span><span class="op" id="1557376">(</span><span class="ident" id="1557377">h</span><span class="op" id="1557378">)</span><span class="op" id="1557379">,</span>&nbsp;<span class="ident" id="1557381">callerpc</span><span class="op" id="1557389">,</span>&nbsp;<span class="ident" id="1557391">funcPC</span><span class="op" id="1557397">(</span><span class="ident" id="1557398">mapaccess1_faststr</span><span class="op" id="1557416">)</span><span class="op" id="1557417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557423">if</span>&nbsp;<span class="ident" id="1557426">h</span>&nbsp;<span class="op" id="1557428">==</span>&nbsp;<span class="ident" id="1557431">nil</span>&nbsp;<span class="op" id="1557435">||</span>&nbsp;<span class="ident" id="1557438">h</span><span class="op" id="1557439">.</span><span class="ident" id="1557440">count</span>&nbsp;<span class="op" id="1557446">==</span>&nbsp;<span class="num" id="1557449">0</span>&nbsp;<span class="op" id="1557451">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557455">return</span>&nbsp;<span class="ident" id="1557462">unsafe</span><span class="op" id="1557468">.</span><span class="ident" id="1557469">Pointer</span><span class="op" id="1557476">(</span><span class="ident" id="1557477">t</span><span class="op" id="1557478">.</span><span class="ident" id="1557479">elem</span><span class="op" id="1557483">.</span><span class="ident" id="1557484">zero</span><span class="op" id="1557488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557494">key</span>&nbsp;<span class="op" id="1557498">:=</span>&nbsp;<span class="op" id="1557501">(</span><span class="op" id="1557502">*</span><span class="ident" id="1557503">stringStruct</span><span class="op" id="1557515">)</span><span class="op" id="1557516">(</span><span class="ident" id="1557517">unsafe</span><span class="op" id="1557523">.</span><span class="ident" id="1557524">Pointer</span><span class="op" id="1557531">(</span><span class="op" id="1557532">&amp;</span><span class="ident" id="1557533">ky</span><span class="op" id="1557535">)</span><span class="op" id="1557536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557539">if</span>&nbsp;<span class="ident" id="1557542">h</span><span class="op" id="1557543">.</span><span class="ident" id="1557544">B</span>&nbsp;<span class="op" id="1557546">==</span>&nbsp;<span class="num" id="1557549">0</span>&nbsp;<span class="op" id="1557551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1557555">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557578">b</span>&nbsp;<span class="op" id="1557580">:=</span>&nbsp;<span class="op" id="1557583">(</span><span class="op" id="1557584">*</span><span class="ident" id="1557585">bmap</span><span class="op" id="1557589">)</span><span class="op" id="1557590">(</span><span class="ident" id="1557591">h</span><span class="op" id="1557592">.</span><span class="ident" id="1557593">buckets</span><span class="op" id="1557600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557604">if</span>&nbsp;<span class="ident" id="1557607">key</span><span class="op" id="1557610">.</span><span class="builtinfunc" id="1557611">len</span>&nbsp;<span class="op" id="1557615">&lt;</span>&nbsp;<span class="num" id="1557617">32</span>&nbsp;<span class="op" id="1557620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1557625">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557674">for</span>&nbsp;<span class="ident" id="1557678">i</span>&nbsp;<span class="op" id="1557680">:=</span>&nbsp;<span class="builtintype" id="1557683">uintptr</span><span class="op" id="1557690">(</span><span class="num" id="1557691">0</span><span class="op" id="1557692">)</span><span class="op" id="1557693">;</span>&nbsp;<span class="ident" id="1557695">i</span>&nbsp;<span class="op" id="1557697">&lt;</span>&nbsp;<span class="ident" id="1557699">bucketCnt</span><span class="op" id="1557708">;</span>&nbsp;<span class="ident" id="1557710">i</span><span class="op" id="1557711">++</span>&nbsp;<span class="op" id="1557714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557720">x</span>&nbsp;<span class="op" id="1557722">:=</span>&nbsp;<span class="op" id="1557725">*</span><span class="op" id="1557726">(</span><span class="op" id="1557727">(</span><span class="op" id="1557728">*</span><span class="builtintype" id="1557729">uint8</span><span class="op" id="1557734">)</span><span class="op" id="1557735">(</span><span class="ident" id="1557736">add</span><span class="op" id="1557739">(</span><span class="ident" id="1557740">unsafe</span><span class="op" id="1557746">.</span><span class="ident" id="1557747">Pointer</span><span class="op" id="1557754">(</span><span class="ident" id="1557755">b</span><span class="op" id="1557756">)</span><span class="op" id="1557757">,</span>&nbsp;<span class="ident" id="1557759">i</span><span class="op" id="1557760">)</span><span class="op" id="1557761">)</span><span class="op" id="1557762">)</span>&nbsp;<span class="comment" id="1557764">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557809">if</span>&nbsp;<span class="ident" id="1557812">x</span>&nbsp;<span class="op" id="1557814">==</span>&nbsp;<span class="ident" id="1557817">empty</span>&nbsp;<span class="op" id="1557823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557830">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557849">k</span>&nbsp;<span class="op" id="1557851">:=</span>&nbsp;<span class="op" id="1557854">(</span><span class="op" id="1557855">*</span><span class="ident" id="1557856">stringStruct</span><span class="op" id="1557868">)</span><span class="op" id="1557869">(</span><span class="ident" id="1557870">add</span><span class="op" id="1557873">(</span><span class="ident" id="1557874">unsafe</span><span class="op" id="1557880">.</span><span class="ident" id="1557881">Pointer</span><span class="op" id="1557888">(</span><span class="ident" id="1557889">b</span><span class="op" id="1557890">)</span><span class="op" id="1557891">,</span>&nbsp;<span class="ident" id="1557893">dataOffset</span><span class="op" id="1557903">+</span><span class="ident" id="1557904">i</span><span class="op" id="1557905">*</span><span class="num" id="1557906">2</span><span class="op" id="1557907">*</span><span class="ident" id="1557908">ptrSize</span><span class="op" id="1557915">)</span><span class="op" id="1557916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557922">if</span>&nbsp;<span class="ident" id="1557925">k</span><span class="op" id="1557926">.</span><span class="builtinfunc" id="1557927">len</span>&nbsp;<span class="op" id="1557931">!=</span>&nbsp;<span class="ident" id="1557934">key</span><span class="op" id="1557937">.</span><span class="builtinfunc" id="1557938">len</span>&nbsp;<span class="op" id="1557942">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557949">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557968">if</span>&nbsp;<span class="ident" id="1557971">k</span><span class="op" id="1557972">.</span><span class="ident" id="1557973">str</span>&nbsp;<span class="op" id="1557977">==</span>&nbsp;<span class="ident" id="1557980">key</span><span class="op" id="1557983">.</span><span class="ident" id="1557984">str</span>&nbsp;<span class="op" id="1557988">||</span>&nbsp;<span class="ident" id="1557991">memeq</span><span class="op" id="1557996">(</span><span class="ident" id="1557997">k</span><span class="op" id="1557998">.</span><span class="ident" id="1557999">str</span><span class="op" id="1558002">,</span>&nbsp;<span class="ident" id="1558004">key</span><span class="op" id="1558007">.</span><span class="ident" id="1558008">str</span><span class="op" id="1558011">,</span>&nbsp;<span class="builtintype" id="1558013">uintptr</span><span class="op" id="1558020">(</span><span class="ident" id="1558021">key</span><span class="op" id="1558024">.</span><span class="builtinfunc" id="1558025">len</span><span class="op" id="1558028">)</span><span class="op" id="1558029">)</span>&nbsp;<span class="op" id="1558031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558038">return</span>&nbsp;<span class="ident" id="1558045">add</span><span class="op" id="1558048">(</span><span class="ident" id="1558049">unsafe</span><span class="op" id="1558055">.</span><span class="ident" id="1558056">Pointer</span><span class="op" id="1558063">(</span><span class="ident" id="1558064">b</span><span class="op" id="1558065">)</span><span class="op" id="1558066">,</span>&nbsp;<span class="ident" id="1558068">dataOffset</span><span class="op" id="1558078">+</span><span class="ident" id="1558079">bucketCnt</span><span class="op" id="1558088">*</span><span class="num" id="1558089">2</span><span class="op" id="1558090">*</span><span class="ident" id="1558091">ptrSize</span><span class="op" id="1558098">+</span><span class="ident" id="1558099">i</span><span class="op" id="1558100">*</span><span class="builtintype" id="1558101">uintptr</span><span class="op" id="1558108">(</span><span class="ident" id="1558109">t</span><span class="op" id="1558110">.</span><span class="ident" id="1558111">valuesize</span><span class="op" id="1558120">)</span><span class="op" id="1558121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558127">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558137">return</span>&nbsp;<span class="ident" id="1558144">unsafe</span><span class="op" id="1558150">.</span><span class="ident" id="1558151">Pointer</span><span class="op" id="1558158">(</span><span class="ident" id="1558159">t</span><span class="op" id="1558160">.</span><span class="ident" id="1558161">elem</span><span class="op" id="1558165">.</span><span class="ident" id="1558166">zero</span><span class="op" id="1558170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558178">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558239">keymaybe</span>&nbsp;<span class="op" id="1558248">:=</span>&nbsp;<span class="builtintype" id="1558251">uintptr</span><span class="op" id="1558258">(</span><span class="ident" id="1558259">bucketCnt</span><span class="op" id="1558268">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558272">for</span>&nbsp;<span class="ident" id="1558276">i</span>&nbsp;<span class="op" id="1558278">:=</span>&nbsp;<span class="builtintype" id="1558281">uintptr</span><span class="op" id="1558288">(</span><span class="num" id="1558289">0</span><span class="op" id="1558290">)</span><span class="op" id="1558291">;</span>&nbsp;<span class="ident" id="1558293">i</span>&nbsp;<span class="op" id="1558295">&lt;</span>&nbsp;<span class="ident" id="1558297">bucketCnt</span><span class="op" id="1558306">;</span>&nbsp;<span class="ident" id="1558308">i</span><span class="op" id="1558309">++</span>&nbsp;<span class="op" id="1558312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558317">x</span>&nbsp;<span class="op" id="1558319">:=</span>&nbsp;<span class="op" id="1558322">*</span><span class="op" id="1558323">(</span><span class="op" id="1558324">(</span><span class="op" id="1558325">*</span><span class="builtintype" id="1558326">uint8</span><span class="op" id="1558331">)</span><span class="op" id="1558332">(</span><span class="ident" id="1558333">add</span><span class="op" id="1558336">(</span><span class="ident" id="1558337">unsafe</span><span class="op" id="1558343">.</span><span class="ident" id="1558344">Pointer</span><span class="op" id="1558351">(</span><span class="ident" id="1558352">b</span><span class="op" id="1558353">)</span><span class="op" id="1558354">,</span>&nbsp;<span class="ident" id="1558356">i</span><span class="op" id="1558357">)</span><span class="op" id="1558358">)</span><span class="op" id="1558359">)</span>&nbsp;<span class="comment" id="1558361">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558405">if</span>&nbsp;<span class="ident" id="1558408">x</span>&nbsp;<span class="op" id="1558410">==</span>&nbsp;<span class="ident" id="1558413">empty</span>&nbsp;<span class="op" id="1558419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558425">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558437">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558442">k</span>&nbsp;<span class="op" id="1558444">:=</span>&nbsp;<span class="op" id="1558447">(</span><span class="op" id="1558448">*</span><span class="ident" id="1558449">stringStruct</span><span class="op" id="1558461">)</span><span class="op" id="1558462">(</span><span class="ident" id="1558463">add</span><span class="op" id="1558466">(</span><span class="ident" id="1558467">unsafe</span><span class="op" id="1558473">.</span><span class="ident" id="1558474">Pointer</span><span class="op" id="1558481">(</span><span class="ident" id="1558482">b</span><span class="op" id="1558483">)</span><span class="op" id="1558484">,</span>&nbsp;<span class="ident" id="1558486">dataOffset</span><span class="op" id="1558496">+</span><span class="ident" id="1558497">i</span><span class="op" id="1558498">*</span><span class="num" id="1558499">2</span><span class="op" id="1558500">*</span><span class="ident" id="1558501">ptrSize</span><span class="op" id="1558508">)</span><span class="op" id="1558509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558514">if</span>&nbsp;<span class="ident" id="1558517">k</span><span class="op" id="1558518">.</span><span class="builtinfunc" id="1558519">len</span>&nbsp;<span class="op" id="1558523">!=</span>&nbsp;<span class="ident" id="1558526">key</span><span class="op" id="1558529">.</span><span class="builtinfunc" id="1558530">len</span>&nbsp;<span class="op" id="1558534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558540">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558557">if</span>&nbsp;<span class="ident" id="1558560">k</span><span class="op" id="1558561">.</span><span class="ident" id="1558562">str</span>&nbsp;<span class="op" id="1558566">==</span>&nbsp;<span class="ident" id="1558569">key</span><span class="op" id="1558572">.</span><span class="ident" id="1558573">str</span>&nbsp;<span class="op" id="1558577">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558583">return</span>&nbsp;<span class="ident" id="1558590">add</span><span class="op" id="1558593">(</span><span class="ident" id="1558594">unsafe</span><span class="op" id="1558600">.</span><span class="ident" id="1558601">Pointer</span><span class="op" id="1558608">(</span><span class="ident" id="1558609">b</span><span class="op" id="1558610">)</span><span class="op" id="1558611">,</span>&nbsp;<span class="ident" id="1558613">dataOffset</span><span class="op" id="1558623">+</span><span class="ident" id="1558624">bucketCnt</span><span class="op" id="1558633">*</span><span class="num" id="1558634">2</span><span class="op" id="1558635">*</span><span class="ident" id="1558636">ptrSize</span><span class="op" id="1558643">+</span><span class="ident" id="1558644">i</span><span class="op" id="1558645">*</span><span class="builtintype" id="1558646">uintptr</span><span class="op" id="1558653">(</span><span class="ident" id="1558654">t</span><span class="op" id="1558655">.</span><span class="ident" id="1558656">valuesize</span><span class="op" id="1558665">)</span><span class="op" id="1558666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558676">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558702">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558791">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558822">if</span>&nbsp;<span class="op" id="1558825">*</span><span class="op" id="1558826">(</span><span class="op" id="1558827">(</span><span class="op" id="1558828">*</span><span class="op" id="1558829">[</span><span class="num" id="1558830">4</span><span class="op" id="1558831">]</span><span class="builtintype" id="1558832">byte</span><span class="op" id="1558836">)</span><span class="op" id="1558837">(</span><span class="ident" id="1558838">key</span><span class="op" id="1558841">.</span><span class="ident" id="1558842">str</span><span class="op" id="1558845">)</span><span class="op" id="1558846">)</span>&nbsp;<span class="op" id="1558848">!=</span>&nbsp;<span class="op" id="1558851">*</span><span class="op" id="1558852">(</span><span class="op" id="1558853">(</span><span class="op" id="1558854">*</span><span class="op" id="1558855">[</span><span class="num" id="1558856">4</span><span class="op" id="1558857">]</span><span class="builtintype" id="1558858">byte</span><span class="op" id="1558862">)</span><span class="op" id="1558863">(</span><span class="ident" id="1558864">k</span><span class="op" id="1558865">.</span><span class="ident" id="1558866">str</span><span class="op" id="1558869">)</span><span class="op" id="1558870">)</span>&nbsp;<span class="op" id="1558872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558878">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558895">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558920">if</span>&nbsp;<span class="op" id="1558923">*</span><span class="op" id="1558924">(</span><span class="op" id="1558925">(</span><span class="op" id="1558926">*</span><span class="op" id="1558927">[</span><span class="num" id="1558928">4</span><span class="op" id="1558929">]</span><span class="builtintype" id="1558930">byte</span><span class="op" id="1558934">)</span><span class="op" id="1558935">(</span><span class="ident" id="1558936">add</span><span class="op" id="1558939">(</span><span class="ident" id="1558940">key</span><span class="op" id="1558943">.</span><span class="ident" id="1558944">str</span><span class="op" id="1558947">,</span>&nbsp;<span class="builtintype" id="1558949">uintptr</span><span class="op" id="1558956">(</span><span class="ident" id="1558957">key</span><span class="op" id="1558960">.</span><span class="builtinfunc" id="1558961">len</span><span class="op" id="1558964">)</span><span class="op" id="1558965">-</span><span class="num" id="1558966">4</span><span class="op" id="1558967">)</span><span class="op" id="1558968">)</span><span class="op" id="1558969">)</span>&nbsp;<span class="op" id="1558971">!=</span>&nbsp;<span class="op" id="1558974">*</span><span class="op" id="1558975">(</span><span class="op" id="1558976">(</span><span class="op" id="1558977">*</span><span class="op" id="1558978">[</span><span class="num" id="1558979">4</span><span class="op" id="1558980">]</span><span class="builtintype" id="1558981">byte</span><span class="op" id="1558985">)</span><span class="op" id="1558986">(</span><span class="ident" id="1558987">add</span><span class="op" id="1558990">(</span><span class="ident" id="1558991">k</span><span class="op" id="1558992">.</span><span class="ident" id="1558993">str</span><span class="op" id="1558996">,</span>&nbsp;<span class="builtintype" id="1558998">uintptr</span><span class="op" id="1559005">(</span><span class="ident" id="1559006">key</span><span class="op" id="1559009">.</span><span class="builtinfunc" id="1559010">len</span><span class="op" id="1559013">)</span><span class="op" id="1559014">-</span><span class="num" id="1559015">4</span><span class="op" id="1559016">)</span><span class="op" id="1559017">)</span><span class="op" id="1559018">)</span>&nbsp;<span class="op" id="1559020">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559026">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559043">if</span>&nbsp;<span class="ident" id="1559046">keymaybe</span>&nbsp;<span class="op" id="1559055">!=</span>&nbsp;<span class="ident" id="1559058">bucketCnt</span>&nbsp;<span class="op" id="1559068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559074">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559144">goto</span>&nbsp;<span class="ident" id="1559149">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559164">keymaybe</span>&nbsp;<span class="op" id="1559173">=</span>&nbsp;<span class="ident" id="1559175">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559183">if</span>&nbsp;<span class="ident" id="1559186">keymaybe</span>&nbsp;<span class="op" id="1559195">!=</span>&nbsp;<span class="ident" id="1559198">bucketCnt</span>&nbsp;<span class="op" id="1559208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559213">k</span>&nbsp;<span class="op" id="1559215">:=</span>&nbsp;<span class="op" id="1559218">(</span><span class="op" id="1559219">*</span><span class="ident" id="1559220">stringStruct</span><span class="op" id="1559232">)</span><span class="op" id="1559233">(</span><span class="ident" id="1559234">add</span><span class="op" id="1559237">(</span><span class="ident" id="1559238">unsafe</span><span class="op" id="1559244">.</span><span class="ident" id="1559245">Pointer</span><span class="op" id="1559252">(</span><span class="ident" id="1559253">b</span><span class="op" id="1559254">)</span><span class="op" id="1559255">,</span>&nbsp;<span class="ident" id="1559257">dataOffset</span><span class="op" id="1559267">+</span><span class="ident" id="1559268">keymaybe</span><span class="op" id="1559276">*</span><span class="num" id="1559277">2</span><span class="op" id="1559278">*</span><span class="ident" id="1559279">ptrSize</span><span class="op" id="1559286">)</span><span class="op" id="1559287">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559292">if</span>&nbsp;<span class="ident" id="1559295">memeq</span><span class="op" id="1559300">(</span><span class="ident" id="1559301">k</span><span class="op" id="1559302">.</span><span class="ident" id="1559303">str</span><span class="op" id="1559306">,</span>&nbsp;<span class="ident" id="1559308">key</span><span class="op" id="1559311">.</span><span class="ident" id="1559312">str</span><span class="op" id="1559315">,</span>&nbsp;<span class="builtintype" id="1559317">uintptr</span><span class="op" id="1559324">(</span><span class="ident" id="1559325">key</span><span class="op" id="1559328">.</span><span class="builtinfunc" id="1559329">len</span><span class="op" id="1559332">)</span><span class="op" id="1559333">)</span>&nbsp;<span class="op" id="1559335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559341">return</span>&nbsp;<span class="ident" id="1559348">add</span><span class="op" id="1559351">(</span><span class="ident" id="1559352">unsafe</span><span class="op" id="1559358">.</span><span class="ident" id="1559359">Pointer</span><span class="op" id="1559366">(</span><span class="ident" id="1559367">b</span><span class="op" id="1559368">)</span><span class="op" id="1559369">,</span>&nbsp;<span class="ident" id="1559371">dataOffset</span><span class="op" id="1559381">+</span><span class="ident" id="1559382">bucketCnt</span><span class="op" id="1559391">*</span><span class="num" id="1559392">2</span><span class="op" id="1559393">*</span><span class="ident" id="1559394">ptrSize</span><span class="op" id="1559401">+</span><span class="ident" id="1559402">keymaybe</span><span class="op" id="1559410">*</span><span class="builtintype" id="1559411">uintptr</span><span class="op" id="1559418">(</span><span class="ident" id="1559419">t</span><span class="op" id="1559420">.</span><span class="ident" id="1559421">valuesize</span><span class="op" id="1559430">)</span><span class="op" id="1559431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559444">return</span>&nbsp;<span class="ident" id="1559451">unsafe</span><span class="op" id="1559457">.</span><span class="ident" id="1559458">Pointer</span><span class="op" id="1559465">(</span><span class="ident" id="1559466">t</span><span class="op" id="1559467">.</span><span class="ident" id="1559468">elem</span><span class="op" id="1559472">.</span><span class="ident" id="1559473">zero</span><span class="op" id="1559477">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559480">}</span><br>
<span class="lineno"></span><span class="ident" id="1559482">dohash</span><span class="op" id="1559488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559491">hash</span>&nbsp;<span class="op" id="1559496">:=</span>&nbsp;<span class="ident" id="1559499">goalg</span><span class="op" id="1559504">(</span><span class="ident" id="1559505">t</span><span class="op" id="1559506">.</span><span class="ident" id="1559507">key</span><span class="op" id="1559510">.</span><span class="ident" id="1559511">alg</span><span class="op" id="1559514">)</span><span class="op" id="1559515">.</span><span class="ident" id="1559516">hash</span><span class="op" id="1559520">(</span><span class="ident" id="1559521">noescape</span><span class="op" id="1559529">(</span><span class="ident" id="1559530">unsafe</span><span class="op" id="1559536">.</span><span class="ident" id="1559537">Pointer</span><span class="op" id="1559544">(</span><span class="op" id="1559545">&amp;</span><span class="ident" id="1559546">ky</span><span class="op" id="1559548">)</span><span class="op" id="1559549">)</span><span class="op" id="1559550">,</span>&nbsp;<span class="num" id="1559552">2</span><span class="op" id="1559553">*</span><span class="ident" id="1559554">ptrSize</span><span class="op" id="1559561">,</span>&nbsp;<span class="builtintype" id="1559563">uintptr</span><span class="op" id="1559570">(</span><span class="ident" id="1559571">h</span><span class="op" id="1559572">.</span><span class="ident" id="1559573">hash0</span><span class="op" id="1559578">)</span><span class="op" id="1559579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559582">m</span>&nbsp;<span class="op" id="1559584">:=</span>&nbsp;<span class="builtintype" id="1559587">uintptr</span><span class="op" id="1559594">(</span><span class="num" id="1559595">1</span><span class="op" id="1559596">)</span><span class="op" id="1559597">&lt;&lt;</span><span class="ident" id="1559599">h</span><span class="op" id="1559600">.</span><span class="ident" id="1559601">B</span>&nbsp;<span class="op" id="1559603">-</span>&nbsp;<span class="num" id="1559605">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559608">b</span>&nbsp;<span class="op" id="1559610">:=</span>&nbsp;<span class="op" id="1559613">(</span><span class="op" id="1559614">*</span><span class="ident" id="1559615">bmap</span><span class="op" id="1559619">)</span><span class="op" id="1559620">(</span><span class="ident" id="1559621">add</span><span class="op" id="1559624">(</span><span class="ident" id="1559625">h</span><span class="op" id="1559626">.</span><span class="ident" id="1559627">buckets</span><span class="op" id="1559634">,</span>&nbsp;<span class="op" id="1559636">(</span><span class="ident" id="1559637">hash</span><span class="op" id="1559641">&amp;</span><span class="ident" id="1559642">m</span><span class="op" id="1559643">)</span><span class="op" id="1559644">*</span><span class="builtintype" id="1559645">uintptr</span><span class="op" id="1559652">(</span><span class="ident" id="1559653">t</span><span class="op" id="1559654">.</span><span class="ident" id="1559655">bucketsize</span><span class="op" id="1559665">)</span><span class="op" id="1559666">)</span><span class="op" id="1559667">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559670">if</span>&nbsp;<span class="ident" id="1559673">c</span>&nbsp;<span class="op" id="1559675">:=</span>&nbsp;<span class="ident" id="1559678">h</span><span class="op" id="1559679">.</span><span class="ident" id="1559680">oldbuckets</span><span class="op" id="1559690">;</span>&nbsp;<span class="ident" id="1559692">c</span>&nbsp;<span class="op" id="1559694">!=</span>&nbsp;<span class="ident" id="1559697">nil</span>&nbsp;<span class="op" id="1559701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559705">oldb</span>&nbsp;<span class="op" id="1559710">:=</span>&nbsp;<span class="op" id="1559713">(</span><span class="op" id="1559714">*</span><span class="ident" id="1559715">bmap</span><span class="op" id="1559719">)</span><span class="op" id="1559720">(</span><span class="ident" id="1559721">add</span><span class="op" id="1559724">(</span><span class="ident" id="1559725">c</span><span class="op" id="1559726">,</span>&nbsp;<span class="op" id="1559728">(</span><span class="ident" id="1559729">hash</span><span class="op" id="1559733">&amp;</span><span class="op" id="1559734">(</span><span class="ident" id="1559735">m</span><span class="op" id="1559736">&gt;&gt;</span><span class="num" id="1559738">1</span><span class="op" id="1559739">)</span><span class="op" id="1559740">)</span><span class="op" id="1559741">*</span><span class="builtintype" id="1559742">uintptr</span><span class="op" id="1559749">(</span><span class="ident" id="1559750">t</span><span class="op" id="1559751">.</span><span class="ident" id="1559752">bucketsize</span><span class="op" id="1559762">)</span><span class="op" id="1559763">)</span><span class="op" id="1559764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559768">if</span>&nbsp;<span class="op" id="1559771">!</span><span class="ident" id="1559772">evacuated</span><span class="op" id="1559781">(</span><span class="ident" id="1559782">oldb</span><span class="op" id="1559786">)</span>&nbsp;<span class="op" id="1559788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559793">b</span>&nbsp;<span class="op" id="1559795">=</span>&nbsp;<span class="ident" id="1559797">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559804">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559810">top</span>&nbsp;<span class="op" id="1559814">:=</span>&nbsp;<span class="builtintype" id="1559817">uint8</span><span class="op" id="1559822">(</span><span class="ident" id="1559823">hash</span>&nbsp;<span class="op" id="1559828">&gt;&gt;</span>&nbsp;<span class="op" id="1559831">(</span><span class="ident" id="1559832">ptrSize</span><span class="op" id="1559839">*</span><span class="num" id="1559840">8</span>&nbsp;<span class="op" id="1559842">-</span>&nbsp;<span class="num" id="1559844">8</span><span class="op" id="1559845">)</span><span class="op" id="1559846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559849">if</span>&nbsp;<span class="ident" id="1559852">top</span>&nbsp;<span class="op" id="1559856">&lt;</span>&nbsp;<span class="ident" id="1559858">minTopHash</span>&nbsp;<span class="op" id="1559869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559873">top</span>&nbsp;<span class="op" id="1559877">+=</span>&nbsp;<span class="ident" id="1559880">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559892">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559895">for</span>&nbsp;<span class="op" id="1559899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559903">for</span>&nbsp;<span class="ident" id="1559907">i</span>&nbsp;<span class="op" id="1559909">:=</span>&nbsp;<span class="builtintype" id="1559912">uintptr</span><span class="op" id="1559919">(</span><span class="num" id="1559920">0</span><span class="op" id="1559921">)</span><span class="op" id="1559922">;</span>&nbsp;<span class="ident" id="1559924">i</span>&nbsp;<span class="op" id="1559926">&lt;</span>&nbsp;<span class="ident" id="1559928">bucketCnt</span><span class="op" id="1559937">;</span>&nbsp;<span class="ident" id="1559939">i</span><span class="op" id="1559940">++</span>&nbsp;<span class="op" id="1559943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559948">x</span>&nbsp;<span class="op" id="1559950">:=</span>&nbsp;<span class="op" id="1559953">*</span><span class="op" id="1559954">(</span><span class="op" id="1559955">(</span><span class="op" id="1559956">*</span><span class="builtintype" id="1559957">uint8</span><span class="op" id="1559962">)</span><span class="op" id="1559963">(</span><span class="ident" id="1559964">add</span><span class="op" id="1559967">(</span><span class="ident" id="1559968">unsafe</span><span class="op" id="1559974">.</span><span class="ident" id="1559975">Pointer</span><span class="op" id="1559982">(</span><span class="ident" id="1559983">b</span><span class="op" id="1559984">)</span><span class="op" id="1559985">,</span>&nbsp;<span class="ident" id="1559987">i</span><span class="op" id="1559988">)</span><span class="op" id="1559989">)</span><span class="op" id="1559990">)</span>&nbsp;<span class="comment" id="1559992">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560036">if</span>&nbsp;<span class="ident" id="1560039">x</span>&nbsp;<span class="op" id="1560041">!=</span>&nbsp;<span class="ident" id="1560044">top</span>&nbsp;<span class="op" id="1560048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560054">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560071">k</span>&nbsp;<span class="op" id="1560073">:=</span>&nbsp;<span class="op" id="1560076">(</span><span class="op" id="1560077">*</span><span class="ident" id="1560078">stringStruct</span><span class="op" id="1560090">)</span><span class="op" id="1560091">(</span><span class="ident" id="1560092">add</span><span class="op" id="1560095">(</span><span class="ident" id="1560096">unsafe</span><span class="op" id="1560102">.</span><span class="ident" id="1560103">Pointer</span><span class="op" id="1560110">(</span><span class="ident" id="1560111">b</span><span class="op" id="1560112">)</span><span class="op" id="1560113">,</span>&nbsp;<span class="ident" id="1560115">dataOffset</span><span class="op" id="1560125">+</span><span class="ident" id="1560126">i</span><span class="op" id="1560127">*</span><span class="num" id="1560128">2</span><span class="op" id="1560129">*</span><span class="ident" id="1560130">ptrSize</span><span class="op" id="1560137">)</span><span class="op" id="1560138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560143">if</span>&nbsp;<span class="ident" id="1560146">k</span><span class="op" id="1560147">.</span><span class="builtinfunc" id="1560148">len</span>&nbsp;<span class="op" id="1560152">!=</span>&nbsp;<span class="ident" id="1560155">key</span><span class="op" id="1560158">.</span><span class="builtinfunc" id="1560159">len</span>&nbsp;<span class="op" id="1560163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560169">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560181">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560186">if</span>&nbsp;<span class="ident" id="1560189">k</span><span class="op" id="1560190">.</span><span class="ident" id="1560191">str</span>&nbsp;<span class="op" id="1560195">==</span>&nbsp;<span class="ident" id="1560198">key</span><span class="op" id="1560201">.</span><span class="ident" id="1560202">str</span>&nbsp;<span class="op" id="1560206">||</span>&nbsp;<span class="ident" id="1560209">memeq</span><span class="op" id="1560214">(</span><span class="ident" id="1560215">k</span><span class="op" id="1560216">.</span><span class="ident" id="1560217">str</span><span class="op" id="1560220">,</span>&nbsp;<span class="ident" id="1560222">key</span><span class="op" id="1560225">.</span><span class="ident" id="1560226">str</span><span class="op" id="1560229">,</span>&nbsp;<span class="builtintype" id="1560231">uintptr</span><span class="op" id="1560238">(</span><span class="ident" id="1560239">key</span><span class="op" id="1560242">.</span><span class="builtinfunc" id="1560243">len</span><span class="op" id="1560246">)</span><span class="op" id="1560247">)</span>&nbsp;<span class="op" id="1560249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560255">return</span>&nbsp;<span class="ident" id="1560262">add</span><span class="op" id="1560265">(</span><span class="ident" id="1560266">unsafe</span><span class="op" id="1560272">.</span><span class="ident" id="1560273">Pointer</span><span class="op" id="1560280">(</span><span class="ident" id="1560281">b</span><span class="op" id="1560282">)</span><span class="op" id="1560283">,</span>&nbsp;<span class="ident" id="1560285">dataOffset</span><span class="op" id="1560295">+</span><span class="ident" id="1560296">bucketCnt</span><span class="op" id="1560305">*</span><span class="num" id="1560306">2</span><span class="op" id="1560307">*</span><span class="ident" id="1560308">ptrSize</span><span class="op" id="1560315">+</span><span class="ident" id="1560316">i</span><span class="op" id="1560317">*</span><span class="builtintype" id="1560318">uintptr</span><span class="op" id="1560325">(</span><span class="ident" id="1560326">t</span><span class="op" id="1560327">.</span><span class="ident" id="1560328">valuesize</span><span class="op" id="1560337">)</span><span class="op" id="1560338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560351">b</span>&nbsp;<span class="op" id="1560353">=</span>&nbsp;<span class="ident" id="1560355">b</span><span class="op" id="1560356">.</span><span class="ident" id="1560357">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560368">if</span>&nbsp;<span class="ident" id="1560371">b</span>&nbsp;<span class="op" id="1560373">==</span>&nbsp;<span class="ident" id="1560376">nil</span>&nbsp;<span class="op" id="1560380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560385">return</span>&nbsp;<span class="ident" id="1560392">unsafe</span><span class="op" id="1560398">.</span><span class="ident" id="1560399">Pointer</span><span class="op" id="1560406">(</span><span class="ident" id="1560407">t</span><span class="op" id="1560408">.</span><span class="ident" id="1560409">elem</span><span class="op" id="1560413">.</span><span class="ident" id="1560414">zero</span><span class="op" id="1560418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560425">}</span><br>
<span class="lineno"></span><span class="op" id="1560427">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1560430">func</span>&nbsp;<span class="ident" id="1560435">mapaccess2_faststr</span><span class="op" id="1560453">(</span><span class="ident" id="1560454">t</span>&nbsp;<span class="op" id="1560456">*</span><span class="ident" id="1560457">maptype</span><span class="op" id="1560464">,</span>&nbsp;<span class="ident" id="1560466">h</span>&nbsp;<span class="op" id="1560468">*</span><span class="ident" id="1560469">hmap</span><span class="op" id="1560473">,</span>&nbsp;<span class="ident" id="1560475">ky</span>&nbsp;<span class="builtintype" id="1560478">string</span><span class="op" id="1560484">)</span>&nbsp;<span class="op" id="1560486">(</span><span class="ident" id="1560487">unsafe</span><span class="op" id="1560493">.</span><span class="ident" id="1560494">Pointer</span><span class="op" id="1560501">,</span>&nbsp;<span class="builtintype" id="1560503">bool</span><span class="op" id="1560507">)</span>&nbsp;<span class="op" id="1560509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560512">if</span>&nbsp;<span class="ident" id="1560515">raceenabled</span>&nbsp;<span class="op" id="1560527">&amp;&amp;</span>&nbsp;<span class="ident" id="1560530">h</span>&nbsp;<span class="op" id="1560532">!=</span>&nbsp;<span class="ident" id="1560535">nil</span>&nbsp;<span class="op" id="1560539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560543">callerpc</span>&nbsp;<span class="op" id="1560552">:=</span>&nbsp;<span class="ident" id="1560555">getcallerpc</span><span class="op" id="1560566">(</span><span class="ident" id="1560567">unsafe</span><span class="op" id="1560573">.</span><span class="ident" id="1560574">Pointer</span><span class="op" id="1560581">(</span><span class="op" id="1560582">&amp;</span><span class="ident" id="1560583">t</span><span class="op" id="1560584">)</span><span class="op" id="1560585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560589">racereadpc</span><span class="op" id="1560599">(</span><span class="ident" id="1560600">unsafe</span><span class="op" id="1560606">.</span><span class="ident" id="1560607">Pointer</span><span class="op" id="1560614">(</span><span class="ident" id="1560615">h</span><span class="op" id="1560616">)</span><span class="op" id="1560617">,</span>&nbsp;<span class="ident" id="1560619">callerpc</span><span class="op" id="1560627">,</span>&nbsp;<span class="ident" id="1560629">funcPC</span><span class="op" id="1560635">(</span><span class="ident" id="1560636">mapaccess2_faststr</span><span class="op" id="1560654">)</span><span class="op" id="1560655">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560661">if</span>&nbsp;<span class="ident" id="1560664">h</span>&nbsp;<span class="op" id="1560666">==</span>&nbsp;<span class="ident" id="1560669">nil</span>&nbsp;<span class="op" id="1560673">||</span>&nbsp;<span class="ident" id="1560676">h</span><span class="op" id="1560677">.</span><span class="ident" id="1560678">count</span>&nbsp;<span class="op" id="1560684">==</span>&nbsp;<span class="num" id="1560687">0</span>&nbsp;<span class="op" id="1560689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560693">return</span>&nbsp;<span class="ident" id="1560700">unsafe</span><span class="op" id="1560706">.</span><span class="ident" id="1560707">Pointer</span><span class="op" id="1560714">(</span><span class="ident" id="1560715">t</span><span class="op" id="1560716">.</span><span class="ident" id="1560717">elem</span><span class="op" id="1560721">.</span><span class="ident" id="1560722">zero</span><span class="op" id="1560726">)</span><span class="op" id="1560727">,</span>&nbsp;<span class="builtintype" id="1560729">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560739">key</span>&nbsp;<span class="op" id="1560743">:=</span>&nbsp;<span class="op" id="1560746">(</span><span class="op" id="1560747">*</span><span class="ident" id="1560748">stringStruct</span><span class="op" id="1560760">)</span><span class="op" id="1560761">(</span><span class="ident" id="1560762">unsafe</span><span class="op" id="1560768">.</span><span class="ident" id="1560769">Pointer</span><span class="op" id="1560776">(</span><span class="op" id="1560777">&amp;</span><span class="ident" id="1560778">ky</span><span class="op" id="1560780">)</span><span class="op" id="1560781">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560784">if</span>&nbsp;<span class="ident" id="1560787">h</span><span class="op" id="1560788">.</span><span class="ident" id="1560789">B</span>&nbsp;<span class="op" id="1560791">==</span>&nbsp;<span class="num" id="1560794">0</span>&nbsp;<span class="op" id="1560796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560800">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560823">b</span>&nbsp;<span class="op" id="1560825">:=</span>&nbsp;<span class="op" id="1560828">(</span><span class="op" id="1560829">*</span><span class="ident" id="1560830">bmap</span><span class="op" id="1560834">)</span><span class="op" id="1560835">(</span><span class="ident" id="1560836">h</span><span class="op" id="1560837">.</span><span class="ident" id="1560838">buckets</span><span class="op" id="1560845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560849">if</span>&nbsp;<span class="ident" id="1560852">key</span><span class="op" id="1560855">.</span><span class="builtinfunc" id="1560856">len</span>&nbsp;<span class="op" id="1560860">&lt;</span>&nbsp;<span class="num" id="1560862">32</span>&nbsp;<span class="op" id="1560865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560870">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560919">for</span>&nbsp;<span class="ident" id="1560923">i</span>&nbsp;<span class="op" id="1560925">:=</span>&nbsp;<span class="builtintype" id="1560928">uintptr</span><span class="op" id="1560935">(</span><span class="num" id="1560936">0</span><span class="op" id="1560937">)</span><span class="op" id="1560938">;</span>&nbsp;<span class="ident" id="1560940">i</span>&nbsp;<span class="op" id="1560942">&lt;</span>&nbsp;<span class="ident" id="1560944">bucketCnt</span><span class="op" id="1560953">;</span>&nbsp;<span class="ident" id="1560955">i</span><span class="op" id="1560956">++</span>&nbsp;<span class="op" id="1560959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560965">x</span>&nbsp;<span class="op" id="1560967">:=</span>&nbsp;<span class="op" id="1560970">*</span><span class="op" id="1560971">(</span><span class="op" id="1560972">(</span><span class="op" id="1560973">*</span><span class="builtintype" id="1560974">uint8</span><span class="op" id="1560979">)</span><span class="op" id="1560980">(</span><span class="ident" id="1560981">add</span><span class="op" id="1560984">(</span><span class="ident" id="1560985">unsafe</span><span class="op" id="1560991">.</span><span class="ident" id="1560992">Pointer</span><span class="op" id="1560999">(</span><span class="ident" id="1561000">b</span><span class="op" id="1561001">)</span><span class="op" id="1561002">,</span>&nbsp;<span class="ident" id="1561004">i</span><span class="op" id="1561005">)</span><span class="op" id="1561006">)</span><span class="op" id="1561007">)</span>&nbsp;<span class="comment" id="1561009">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561054">if</span>&nbsp;<span class="ident" id="1561057">x</span>&nbsp;<span class="op" id="1561059">==</span>&nbsp;<span class="ident" id="1561062">empty</span>&nbsp;<span class="op" id="1561068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561075">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561088">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561094">k</span>&nbsp;<span class="op" id="1561096">:=</span>&nbsp;<span class="op" id="1561099">(</span><span class="op" id="1561100">*</span><span class="ident" id="1561101">stringStruct</span><span class="op" id="1561113">)</span><span class="op" id="1561114">(</span><span class="ident" id="1561115">add</span><span class="op" id="1561118">(</span><span class="ident" id="1561119">unsafe</span><span class="op" id="1561125">.</span><span class="ident" id="1561126">Pointer</span><span class="op" id="1561133">(</span><span class="ident" id="1561134">b</span><span class="op" id="1561135">)</span><span class="op" id="1561136">,</span>&nbsp;<span class="ident" id="1561138">dataOffset</span><span class="op" id="1561148">+</span><span class="ident" id="1561149">i</span><span class="op" id="1561150">*</span><span class="num" id="1561151">2</span><span class="op" id="1561152">*</span><span class="ident" id="1561153">ptrSize</span><span class="op" id="1561160">)</span><span class="op" id="1561161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561167">if</span>&nbsp;<span class="ident" id="1561170">k</span><span class="op" id="1561171">.</span><span class="builtinfunc" id="1561172">len</span>&nbsp;<span class="op" id="1561176">!=</span>&nbsp;<span class="ident" id="1561179">key</span><span class="op" id="1561182">.</span><span class="builtinfunc" id="1561183">len</span>&nbsp;<span class="op" id="1561187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561194">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561213">if</span>&nbsp;<span class="ident" id="1561216">k</span><span class="op" id="1561217">.</span><span class="ident" id="1561218">str</span>&nbsp;<span class="op" id="1561222">==</span>&nbsp;<span class="ident" id="1561225">key</span><span class="op" id="1561228">.</span><span class="ident" id="1561229">str</span>&nbsp;<span class="op" id="1561233">||</span>&nbsp;<span class="ident" id="1561236">memeq</span><span class="op" id="1561241">(</span><span class="ident" id="1561242">k</span><span class="op" id="1561243">.</span><span class="ident" id="1561244">str</span><span class="op" id="1561247">,</span>&nbsp;<span class="ident" id="1561249">key</span><span class="op" id="1561252">.</span><span class="ident" id="1561253">str</span><span class="op" id="1561256">,</span>&nbsp;<span class="builtintype" id="1561258">uintptr</span><span class="op" id="1561265">(</span><span class="ident" id="1561266">key</span><span class="op" id="1561269">.</span><span class="builtinfunc" id="1561270">len</span><span class="op" id="1561273">)</span><span class="op" id="1561274">)</span>&nbsp;<span class="op" id="1561276">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561283">return</span>&nbsp;<span class="ident" id="1561290">add</span><span class="op" id="1561293">(</span><span class="ident" id="1561294">unsafe</span><span class="op" id="1561300">.</span><span class="ident" id="1561301">Pointer</span><span class="op" id="1561308">(</span><span class="ident" id="1561309">b</span><span class="op" id="1561310">)</span><span class="op" id="1561311">,</span>&nbsp;<span class="ident" id="1561313">dataOffset</span><span class="op" id="1561323">+</span><span class="ident" id="1561324">bucketCnt</span><span class="op" id="1561333">*</span><span class="num" id="1561334">2</span><span class="op" id="1561335">*</span><span class="ident" id="1561336">ptrSize</span><span class="op" id="1561343">+</span><span class="ident" id="1561344">i</span><span class="op" id="1561345">*</span><span class="builtintype" id="1561346">uintptr</span><span class="op" id="1561353">(</span><span class="ident" id="1561354">t</span><span class="op" id="1561355">.</span><span class="ident" id="1561356">valuesize</span><span class="op" id="1561365">)</span><span class="op" id="1561366">)</span><span class="op" id="1561367">,</span>&nbsp;<span class="builtintype" id="1561369">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561388">return</span>&nbsp;<span class="ident" id="1561395">unsafe</span><span class="op" id="1561401">.</span><span class="ident" id="1561402">Pointer</span><span class="op" id="1561409">(</span><span class="ident" id="1561410">t</span><span class="op" id="1561411">.</span><span class="ident" id="1561412">elem</span><span class="op" id="1561416">.</span><span class="ident" id="1561417">zero</span><span class="op" id="1561421">)</span><span class="op" id="1561422">,</span>&nbsp;<span class="builtintype" id="1561424">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561432">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1561436">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561497">keymaybe</span>&nbsp;<span class="op" id="1561506">:=</span>&nbsp;<span class="builtintype" id="1561509">uintptr</span><span class="op" id="1561516">(</span><span class="ident" id="1561517">bucketCnt</span><span class="op" id="1561526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561530">for</span>&nbsp;<span class="ident" id="1561534">i</span>&nbsp;<span class="op" id="1561536">:=</span>&nbsp;<span class="builtintype" id="1561539">uintptr</span><span class="op" id="1561546">(</span><span class="num" id="1561547">0</span><span class="op" id="1561548">)</span><span class="op" id="1561549">;</span>&nbsp;<span class="ident" id="1561551">i</span>&nbsp;<span class="op" id="1561553">&lt;</span>&nbsp;<span class="ident" id="1561555">bucketCnt</span><span class="op" id="1561564">;</span>&nbsp;<span class="ident" id="1561566">i</span><span class="op" id="1561567">++</span>&nbsp;<span class="op" id="1561570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561575">x</span>&nbsp;<span class="op" id="1561577">:=</span>&nbsp;<span class="op" id="1561580">*</span><span class="op" id="1561581">(</span><span class="op" id="1561582">(</span><span class="op" id="1561583">*</span><span class="builtintype" id="1561584">uint8</span><span class="op" id="1561589">)</span><span class="op" id="1561590">(</span><span class="ident" id="1561591">add</span><span class="op" id="1561594">(</span><span class="ident" id="1561595">unsafe</span><span class="op" id="1561601">.</span><span class="ident" id="1561602">Pointer</span><span class="op" id="1561609">(</span><span class="ident" id="1561610">b</span><span class="op" id="1561611">)</span><span class="op" id="1561612">,</span>&nbsp;<span class="ident" id="1561614">i</span><span class="op" id="1561615">)</span><span class="op" id="1561616">)</span><span class="op" id="1561617">)</span>&nbsp;<span class="comment" id="1561619">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561663">if</span>&nbsp;<span class="ident" id="1561666">x</span>&nbsp;<span class="op" id="1561668">==</span>&nbsp;<span class="ident" id="1561671">empty</span>&nbsp;<span class="op" id="1561677">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561683">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561700">k</span>&nbsp;<span class="op" id="1561702">:=</span>&nbsp;<span class="op" id="1561705">(</span><span class="op" id="1561706">*</span><span class="ident" id="1561707">stringStruct</span><span class="op" id="1561719">)</span><span class="op" id="1561720">(</span><span class="ident" id="1561721">add</span><span class="op" id="1561724">(</span><span class="ident" id="1561725">unsafe</span><span class="op" id="1561731">.</span><span class="ident" id="1561732">Pointer</span><span class="op" id="1561739">(</span><span class="ident" id="1561740">b</span><span class="op" id="1561741">)</span><span class="op" id="1561742">,</span>&nbsp;<span class="ident" id="1561744">dataOffset</span><span class="op" id="1561754">+</span><span class="ident" id="1561755">i</span><span class="op" id="1561756">*</span><span class="num" id="1561757">2</span><span class="op" id="1561758">*</span><span class="ident" id="1561759">ptrSize</span><span class="op" id="1561766">)</span><span class="op" id="1561767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561772">if</span>&nbsp;<span class="ident" id="1561775">k</span><span class="op" id="1561776">.</span><span class="builtinfunc" id="1561777">len</span>&nbsp;<span class="op" id="1561781">!=</span>&nbsp;<span class="ident" id="1561784">key</span><span class="op" id="1561787">.</span><span class="builtinfunc" id="1561788">len</span>&nbsp;<span class="op" id="1561792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561798">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561815">if</span>&nbsp;<span class="ident" id="1561818">k</span><span class="op" id="1561819">.</span><span class="ident" id="1561820">str</span>&nbsp;<span class="op" id="1561824">==</span>&nbsp;<span class="ident" id="1561827">key</span><span class="op" id="1561830">.</span><span class="ident" id="1561831">str</span>&nbsp;<span class="op" id="1561835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561841">return</span>&nbsp;<span class="ident" id="1561848">add</span><span class="op" id="1561851">(</span><span class="ident" id="1561852">unsafe</span><span class="op" id="1561858">.</span><span class="ident" id="1561859">Pointer</span><span class="op" id="1561866">(</span><span class="ident" id="1561867">b</span><span class="op" id="1561868">)</span><span class="op" id="1561869">,</span>&nbsp;<span class="ident" id="1561871">dataOffset</span><span class="op" id="1561881">+</span><span class="ident" id="1561882">bucketCnt</span><span class="op" id="1561891">*</span><span class="num" id="1561892">2</span><span class="op" id="1561893">*</span><span class="ident" id="1561894">ptrSize</span><span class="op" id="1561901">+</span><span class="ident" id="1561902">i</span><span class="op" id="1561903">*</span><span class="builtintype" id="1561904">uintptr</span><span class="op" id="1561911">(</span><span class="ident" id="1561912">t</span><span class="op" id="1561913">.</span><span class="ident" id="1561914">valuesize</span><span class="op" id="1561923">)</span><span class="op" id="1561924">)</span><span class="op" id="1561925">,</span>&nbsp;<span class="builtintype" id="1561927">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1561940">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561966">if</span>&nbsp;<span class="op" id="1561969">*</span><span class="op" id="1561970">(</span><span class="op" id="1561971">(</span><span class="op" id="1561972">*</span><span class="op" id="1561973">[</span><span class="num" id="1561974">4</span><span class="op" id="1561975">]</span><span class="builtintype" id="1561976">byte</span><span class="op" id="1561980">)</span><span class="op" id="1561981">(</span><span class="ident" id="1561982">key</span><span class="op" id="1561985">.</span><span class="ident" id="1561986">str</span><span class="op" id="1561989">)</span><span class="op" id="1561990">)</span>&nbsp;<span class="op" id="1561992">!=</span>&nbsp;<span class="op" id="1561995">*</span><span class="op" id="1561996">(</span><span class="op" id="1561997">(</span><span class="op" id="1561998">*</span><span class="op" id="1561999">[</span><span class="num" id="1562000">4</span><span class="op" id="1562001">]</span><span class="builtintype" id="1562002">byte</span><span class="op" id="1562006">)</span><span class="op" id="1562007">(</span><span class="ident" id="1562008">k</span><span class="op" id="1562009">.</span><span class="ident" id="1562010">str</span><span class="op" id="1562013">)</span><span class="op" id="1562014">)</span>&nbsp;<span class="op" id="1562016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1562039">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562064">if</span>&nbsp;<span class="op" id="1562067">*</span><span class="op" id="1562068">(</span><span class="op" id="1562069">(</span><span class="op" id="1562070">*</span><span class="op" id="1562071">[</span><span class="num" id="1562072">4</span><span class="op" id="1562073">]</span><span class="builtintype" id="1562074">byte</span><span class="op" id="1562078">)</span><span class="op" id="1562079">(</span><span class="ident" id="1562080">add</span><span class="op" id="1562083">(</span><span class="ident" id="1562084">key</span><span class="op" id="1562087">.</span><span class="ident" id="1562088">str</span><span class="op" id="1562091">,</span>&nbsp;<span class="builtintype" id="1562093">uintptr</span><span class="op" id="1562100">(</span><span class="ident" id="1562101">key</span><span class="op" id="1562104">.</span><span class="builtinfunc" id="1562105">len</span><span class="op" id="1562108">)</span><span class="op" id="1562109">-</span><span class="num" id="1562110">4</span><span class="op" id="1562111">)</span><span class="op" id="1562112">)</span><span class="op" id="1562113">)</span>&nbsp;<span class="op" id="1562115">!=</span>&nbsp;<span class="op" id="1562118">*</span><span class="op" id="1562119">(</span><span class="op" id="1562120">(</span><span class="op" id="1562121">*</span><span class="op" id="1562122">[</span><span class="num" id="1562123">4</span><span class="op" id="1562124">]</span><span class="builtintype" id="1562125">byte</span><span class="op" id="1562129">)</span><span class="op" id="1562130">(</span><span class="ident" id="1562131">add</span><span class="op" id="1562134">(</span><span class="ident" id="1562135">k</span><span class="op" id="1562136">.</span><span class="ident" id="1562137">str</span><span class="op" id="1562140">,</span>&nbsp;<span class="builtintype" id="1562142">uintptr</span><span class="op" id="1562149">(</span><span class="ident" id="1562150">key</span><span class="op" id="1562153">.</span><span class="builtinfunc" id="1562154">len</span><span class="op" id="1562157">)</span><span class="op" id="1562158">-</span><span class="num" id="1562159">4</span><span class="op" id="1562160">)</span><span class="op" id="1562161">)</span><span class="op" id="1562162">)</span>&nbsp;<span class="op" id="1562164">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562170">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562187">if</span>&nbsp;<span class="ident" id="1562190">keymaybe</span>&nbsp;<span class="op" id="1562199">!=</span>&nbsp;<span class="ident" id="1562202">bucketCnt</span>&nbsp;<span class="op" id="1562212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1562218">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562288">goto</span>&nbsp;<span class="ident" id="1562293">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562308">keymaybe</span>&nbsp;<span class="op" id="1562317">=</span>&nbsp;<span class="ident" id="1562319">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562327">if</span>&nbsp;<span class="ident" id="1562330">keymaybe</span>&nbsp;<span class="op" id="1562339">!=</span>&nbsp;<span class="ident" id="1562342">bucketCnt</span>&nbsp;<span class="op" id="1562352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562357">k</span>&nbsp;<span class="op" id="1562359">:=</span>&nbsp;<span class="op" id="1562362">(</span><span class="op" id="1562363">*</span><span class="ident" id="1562364">stringStruct</span><span class="op" id="1562376">)</span><span class="op" id="1562377">(</span><span class="ident" id="1562378">add</span><span class="op" id="1562381">(</span><span class="ident" id="1562382">unsafe</span><span class="op" id="1562388">.</span><span class="ident" id="1562389">Pointer</span><span class="op" id="1562396">(</span><span class="ident" id="1562397">b</span><span class="op" id="1562398">)</span><span class="op" id="1562399">,</span>&nbsp;<span class="ident" id="1562401">dataOffset</span><span class="op" id="1562411">+</span><span class="ident" id="1562412">keymaybe</span><span class="op" id="1562420">*</span><span class="num" id="1562421">2</span><span class="op" id="1562422">*</span><span class="ident" id="1562423">ptrSize</span><span class="op" id="1562430">)</span><span class="op" id="1562431">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562436">if</span>&nbsp;<span class="ident" id="1562439">memeq</span><span class="op" id="1562444">(</span><span class="ident" id="1562445">k</span><span class="op" id="1562446">.</span><span class="ident" id="1562447">str</span><span class="op" id="1562450">,</span>&nbsp;<span class="ident" id="1562452">key</span><span class="op" id="1562455">.</span><span class="ident" id="1562456">str</span><span class="op" id="1562459">,</span>&nbsp;<span class="builtintype" id="1562461">uintptr</span><span class="op" id="1562468">(</span><span class="ident" id="1562469">key</span><span class="op" id="1562472">.</span><span class="builtinfunc" id="1562473">len</span><span class="op" id="1562476">)</span><span class="op" id="1562477">)</span>&nbsp;<span class="op" id="1562479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562485">return</span>&nbsp;<span class="ident" id="1562492">add</span><span class="op" id="1562495">(</span><span class="ident" id="1562496">unsafe</span><span class="op" id="1562502">.</span><span class="ident" id="1562503">Pointer</span><span class="op" id="1562510">(</span><span class="ident" id="1562511">b</span><span class="op" id="1562512">)</span><span class="op" id="1562513">,</span>&nbsp;<span class="ident" id="1562515">dataOffset</span><span class="op" id="1562525">+</span><span class="ident" id="1562526">bucketCnt</span><span class="op" id="1562535">*</span><span class="num" id="1562536">2</span><span class="op" id="1562537">*</span><span class="ident" id="1562538">ptrSize</span><span class="op" id="1562545">+</span><span class="ident" id="1562546">keymaybe</span><span class="op" id="1562554">*</span><span class="builtintype" id="1562555">uintptr</span><span class="op" id="1562562">(</span><span class="ident" id="1562563">t</span><span class="op" id="1562564">.</span><span class="ident" id="1562565">valuesize</span><span class="op" id="1562574">)</span><span class="op" id="1562575">)</span><span class="op" id="1562576">,</span>&nbsp;<span class="builtintype" id="1562578">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562594">return</span>&nbsp;<span class="ident" id="1562601">unsafe</span><span class="op" id="1562607">.</span><span class="ident" id="1562608">Pointer</span><span class="op" id="1562615">(</span><span class="ident" id="1562616">t</span><span class="op" id="1562617">.</span><span class="ident" id="1562618">elem</span><span class="op" id="1562622">.</span><span class="ident" id="1562623">zero</span><span class="op" id="1562627">)</span><span class="op" id="1562628">,</span>&nbsp;<span class="builtintype" id="1562630">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562637">}</span><br>
<span class="lineno"></span><span class="ident" id="1562639">dohash</span><span class="op" id="1562645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562648">hash</span>&nbsp;<span class="op" id="1562653">:=</span>&nbsp;<span class="ident" id="1562656">goalg</span><span class="op" id="1562661">(</span><span class="ident" id="1562662">t</span><span class="op" id="1562663">.</span><span class="ident" id="1562664">key</span><span class="op" id="1562667">.</span><span class="ident" id="1562668">alg</span><span class="op" id="1562671">)</span><span class="op" id="1562672">.</span><span class="ident" id="1562673">hash</span><span class="op" id="1562677">(</span><span class="ident" id="1562678">noescape</span><span class="op" id="1562686">(</span><span class="ident" id="1562687">unsafe</span><span class="op" id="1562693">.</span><span class="ident" id="1562694">Pointer</span><span class="op" id="1562701">(</span><span class="op" id="1562702">&amp;</span><span class="ident" id="1562703">ky</span><span class="op" id="1562705">)</span><span class="op" id="1562706">)</span><span class="op" id="1562707">,</span>&nbsp;<span class="num" id="1562709">2</span><span class="op" id="1562710">*</span><span class="ident" id="1562711">ptrSize</span><span class="op" id="1562718">,</span>&nbsp;<span class="builtintype" id="1562720">uintptr</span><span class="op" id="1562727">(</span><span class="ident" id="1562728">h</span><span class="op" id="1562729">.</span><span class="ident" id="1562730">hash0</span><span class="op" id="1562735">)</span><span class="op" id="1562736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562739">m</span>&nbsp;<span class="op" id="1562741">:=</span>&nbsp;<span class="builtintype" id="1562744">uintptr</span><span class="op" id="1562751">(</span><span class="num" id="1562752">1</span><span class="op" id="1562753">)</span><span class="op" id="1562754">&lt;&lt;</span><span class="ident" id="1562756">h</span><span class="op" id="1562757">.</span><span class="ident" id="1562758">B</span>&nbsp;<span class="op" id="1562760">-</span>&nbsp;<span class="num" id="1562762">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562765">b</span>&nbsp;<span class="op" id="1562767">:=</span>&nbsp;<span class="op" id="1562770">(</span><span class="op" id="1562771">*</span><span class="ident" id="1562772">bmap</span><span class="op" id="1562776">)</span><span class="op" id="1562777">(</span><span class="ident" id="1562778">add</span><span class="op" id="1562781">(</span><span class="ident" id="1562782">h</span><span class="op" id="1562783">.</span><span class="ident" id="1562784">buckets</span><span class="op" id="1562791">,</span>&nbsp;<span class="op" id="1562793">(</span><span class="ident" id="1562794">hash</span><span class="op" id="1562798">&amp;</span><span class="ident" id="1562799">m</span><span class="op" id="1562800">)</span><span class="op" id="1562801">*</span><span class="builtintype" id="1562802">uintptr</span><span class="op" id="1562809">(</span><span class="ident" id="1562810">t</span><span class="op" id="1562811">.</span><span class="ident" id="1562812">bucketsize</span><span class="op" id="1562822">)</span><span class="op" id="1562823">)</span><span class="op" id="1562824">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562827">if</span>&nbsp;<span class="ident" id="1562830">c</span>&nbsp;<span class="op" id="1562832">:=</span>&nbsp;<span class="ident" id="1562835">h</span><span class="op" id="1562836">.</span><span class="ident" id="1562837">oldbuckets</span><span class="op" id="1562847">;</span>&nbsp;<span class="ident" id="1562849">c</span>&nbsp;<span class="op" id="1562851">!=</span>&nbsp;<span class="ident" id="1562854">nil</span>&nbsp;<span class="op" id="1562858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562862">oldb</span>&nbsp;<span class="op" id="1562867">:=</span>&nbsp;<span class="op" id="1562870">(</span><span class="op" id="1562871">*</span><span class="ident" id="1562872">bmap</span><span class="op" id="1562876">)</span><span class="op" id="1562877">(</span><span class="ident" id="1562878">add</span><span class="op" id="1562881">(</span><span class="ident" id="1562882">c</span><span class="op" id="1562883">,</span>&nbsp;<span class="op" id="1562885">(</span><span class="ident" id="1562886">hash</span><span class="op" id="1562890">&amp;</span><span class="op" id="1562891">(</span><span class="ident" id="1562892">m</span><span class="op" id="1562893">&gt;&gt;</span><span class="num" id="1562895">1</span><span class="op" id="1562896">)</span><span class="op" id="1562897">)</span><span class="op" id="1562898">*</span><span class="builtintype" id="1562899">uintptr</span><span class="op" id="1562906">(</span><span class="ident" id="1562907">t</span><span class="op" id="1562908">.</span><span class="ident" id="1562909">bucketsize</span><span class="op" id="1562919">)</span><span class="op" id="1562920">)</span><span class="op" id="1562921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562925">if</span>&nbsp;<span class="op" id="1562928">!</span><span class="ident" id="1562929">evacuated</span><span class="op" id="1562938">(</span><span class="ident" id="1562939">oldb</span><span class="op" id="1562943">)</span>&nbsp;<span class="op" id="1562945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562950">b</span>&nbsp;<span class="op" id="1562952">=</span>&nbsp;<span class="ident" id="1562954">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562961">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562967">top</span>&nbsp;<span class="op" id="1562971">:=</span>&nbsp;<span class="builtintype" id="1562974">uint8</span><span class="op" id="1562979">(</span><span class="ident" id="1562980">hash</span>&nbsp;<span class="op" id="1562985">&gt;&gt;</span>&nbsp;<span class="op" id="1562988">(</span><span class="ident" id="1562989">ptrSize</span><span class="op" id="1562996">*</span><span class="num" id="1562997">8</span>&nbsp;<span class="op" id="1562999">-</span>&nbsp;<span class="num" id="1563001">8</span><span class="op" id="1563002">)</span><span class="op" id="1563003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563006">if</span>&nbsp;<span class="ident" id="1563009">top</span>&nbsp;<span class="op" id="1563013">&lt;</span>&nbsp;<span class="ident" id="1563015">minTopHash</span>&nbsp;<span class="op" id="1563026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563030">top</span>&nbsp;<span class="op" id="1563034">+=</span>&nbsp;<span class="ident" id="1563037">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563049">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563052">for</span>&nbsp;<span class="op" id="1563056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563060">for</span>&nbsp;<span class="ident" id="1563064">i</span>&nbsp;<span class="op" id="1563066">:=</span>&nbsp;<span class="builtintype" id="1563069">uintptr</span><span class="op" id="1563076">(</span><span class="num" id="1563077">0</span><span class="op" id="1563078">)</span><span class="op" id="1563079">;</span>&nbsp;<span class="ident" id="1563081">i</span>&nbsp;<span class="op" id="1563083">&lt;</span>&nbsp;<span class="ident" id="1563085">bucketCnt</span><span class="op" id="1563094">;</span>&nbsp;<span class="ident" id="1563096">i</span><span class="op" id="1563097">++</span>&nbsp;<span class="op" id="1563100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563105">x</span>&nbsp;<span class="op" id="1563107">:=</span>&nbsp;<span class="op" id="1563110">*</span><span class="op" id="1563111">(</span><span class="op" id="1563112">(</span><span class="op" id="1563113">*</span><span class="builtintype" id="1563114">uint8</span><span class="op" id="1563119">)</span><span class="op" id="1563120">(</span><span class="ident" id="1563121">add</span><span class="op" id="1563124">(</span><span class="ident" id="1563125">unsafe</span><span class="op" id="1563131">.</span><span class="ident" id="1563132">Pointer</span><span class="op" id="1563139">(</span><span class="ident" id="1563140">b</span><span class="op" id="1563141">)</span><span class="op" id="1563142">,</span>&nbsp;<span class="ident" id="1563144">i</span><span class="op" id="1563145">)</span><span class="op" id="1563146">)</span><span class="op" id="1563147">)</span>&nbsp;<span class="comment" id="1563149">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563193">if</span>&nbsp;<span class="ident" id="1563196">x</span>&nbsp;<span class="op" id="1563198">!=</span>&nbsp;<span class="ident" id="1563201">top</span>&nbsp;<span class="op" id="1563205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563211">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563228">k</span>&nbsp;<span class="op" id="1563230">:=</span>&nbsp;<span class="op" id="1563233">(</span><span class="op" id="1563234">*</span><span class="ident" id="1563235">stringStruct</span><span class="op" id="1563247">)</span><span class="op" id="1563248">(</span><span class="ident" id="1563249">add</span><span class="op" id="1563252">(</span><span class="ident" id="1563253">unsafe</span><span class="op" id="1563259">.</span><span class="ident" id="1563260">Pointer</span><span class="op" id="1563267">(</span><span class="ident" id="1563268">b</span><span class="op" id="1563269">)</span><span class="op" id="1563270">,</span>&nbsp;<span class="ident" id="1563272">dataOffset</span><span class="op" id="1563282">+</span><span class="ident" id="1563283">i</span><span class="op" id="1563284">*</span><span class="num" id="1563285">2</span><span class="op" id="1563286">*</span><span class="ident" id="1563287">ptrSize</span><span class="op" id="1563294">)</span><span class="op" id="1563295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563300">if</span>&nbsp;<span class="ident" id="1563303">k</span><span class="op" id="1563304">.</span><span class="builtinfunc" id="1563305">len</span>&nbsp;<span class="op" id="1563309">!=</span>&nbsp;<span class="ident" id="1563312">key</span><span class="op" id="1563315">.</span><span class="builtinfunc" id="1563316">len</span>&nbsp;<span class="op" id="1563320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563326">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563338">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563343">if</span>&nbsp;<span class="ident" id="1563346">k</span><span class="op" id="1563347">.</span><span class="ident" id="1563348">str</span>&nbsp;<span class="op" id="1563352">==</span>&nbsp;<span class="ident" id="1563355">key</span><span class="op" id="1563358">.</span><span class="ident" id="1563359">str</span>&nbsp;<span class="op" id="1563363">||</span>&nbsp;<span class="ident" id="1563366">memeq</span><span class="op" id="1563371">(</span><span class="ident" id="1563372">k</span><span class="op" id="1563373">.</span><span class="ident" id="1563374">str</span><span class="op" id="1563377">,</span>&nbsp;<span class="ident" id="1563379">key</span><span class="op" id="1563382">.</span><span class="ident" id="1563383">str</span><span class="op" id="1563386">,</span>&nbsp;<span class="builtintype" id="1563388">uintptr</span><span class="op" id="1563395">(</span><span class="ident" id="1563396">key</span><span class="op" id="1563399">.</span><span class="builtinfunc" id="1563400">len</span><span class="op" id="1563403">)</span><span class="op" id="1563404">)</span>&nbsp;<span class="op" id="1563406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563412">return</span>&nbsp;<span class="ident" id="1563419">add</span><span class="op" id="1563422">(</span><span class="ident" id="1563423">unsafe</span><span class="op" id="1563429">.</span><span class="ident" id="1563430">Pointer</span><span class="op" id="1563437">(</span><span class="ident" id="1563438">b</span><span class="op" id="1563439">)</span><span class="op" id="1563440">,</span>&nbsp;<span class="ident" id="1563442">dataOffset</span><span class="op" id="1563452">+</span><span class="ident" id="1563453">bucketCnt</span><span class="op" id="1563462">*</span><span class="num" id="1563463">2</span><span class="op" id="1563464">*</span><span class="ident" id="1563465">ptrSize</span><span class="op" id="1563472">+</span><span class="ident" id="1563473">i</span><span class="op" id="1563474">*</span><span class="builtintype" id="1563475">uintptr</span><span class="op" id="1563482">(</span><span class="ident" id="1563483">t</span><span class="op" id="1563484">.</span><span class="ident" id="1563485">valuesize</span><span class="op" id="1563494">)</span><span class="op" id="1563495">)</span><span class="op" id="1563496">,</span>&nbsp;<span class="builtintype" id="1563498">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563514">b</span>&nbsp;<span class="op" id="1563516">=</span>&nbsp;<span class="ident" id="1563518">b</span><span class="op" id="1563519">.</span><span class="ident" id="1563520">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563531">if</span>&nbsp;<span class="ident" id="1563534">b</span>&nbsp;<span class="op" id="1563536">==</span>&nbsp;<span class="ident" id="1563539">nil</span>&nbsp;<span class="op" id="1563543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563548">return</span>&nbsp;<span class="ident" id="1563555">unsafe</span><span class="op" id="1563561">.</span><span class="ident" id="1563562">Pointer</span><span class="op" id="1563569">(</span><span class="ident" id="1563570">t</span><span class="op" id="1563571">.</span><span class="ident" id="1563572">elem</span><span class="op" id="1563576">.</span><span class="ident" id="1563577">zero</span><span class="op" id="1563581">)</span><span class="op" id="1563582">,</span>&nbsp;<span class="builtintype" id="1563584">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563595">}</span><br>
<span class="lineno"></span><span class="op" id="1563597">}</span>
</div>
</body>
</html>
