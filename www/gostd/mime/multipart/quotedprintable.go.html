<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3491918">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3491973">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3492027">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3492078">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3492151">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3492166">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3492238">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3492312">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3492361">package</span>&nbsp;<span class="ident" id="3492369">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3492380">import</span>&nbsp;<span class="op" id="3492387">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3492390">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3492399">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3492408">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3492415">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3492420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3492423">type</span>&nbsp;<span class="ident" id="3492428">qpReader</span>&nbsp;<span class="keyword" id="3492437">struct</span>&nbsp;<span class="op" id="3492444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492447">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3492452">*</span><span class="ident" id="3492453">bufio</span><span class="op" id="3492458">.</span><span class="ident" id="3492459">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492467">rerr</span>&nbsp;<span class="builtintype" id="3492472">error</span>&nbsp;&nbsp;<span class="comment" id="3492479">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492499">line</span>&nbsp;<span class="op" id="3492504">[</span><span class="op" id="3492505">]</span><span class="builtintype" id="3492506">byte</span>&nbsp;<span class="comment" id="3492511">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3492547">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3492550">func</span>&nbsp;<span class="ident" id="3492555">newQuotedPrintableReader</span><span class="op" id="3492579">(</span><span class="ident" id="3492580">r</span>&nbsp;<span class="ident" id="3492582">io</span><span class="op" id="3492584">.</span><span class="ident" id="3492585">Reader</span><span class="op" id="3492591">)</span>&nbsp;<span class="ident" id="3492593">io</span><span class="op" id="3492595">.</span><span class="ident" id="3492596">Reader</span>&nbsp;<span class="op" id="3492603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492606">return</span>&nbsp;<span class="op" id="3492613">&amp;</span><span class="ident" id="3492614">qpReader</span><span class="op" id="3492622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492626">br</span><span class="op" id="3492628">:</span>&nbsp;<span class="ident" id="3492630">bufio</span><span class="op" id="3492635">.</span><span class="ident" id="3492636">NewReader</span><span class="op" id="3492645">(</span><span class="ident" id="3492646">r</span><span class="op" id="3492647">)</span><span class="op" id="3492648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492651">}</span><br>
<span class="lineno">30</span><span class="op" id="3492653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3492656">func</span>&nbsp;<span class="ident" id="3492661">fromHex</span><span class="op" id="3492668">(</span><span class="ident" id="3492669">b</span>&nbsp;<span class="builtintype" id="3492671">byte</span><span class="op" id="3492675">)</span>&nbsp;<span class="op" id="3492677">(</span><span class="builtintype" id="3492678">byte</span><span class="op" id="3492682">,</span>&nbsp;<span class="builtintype" id="3492684">error</span><span class="op" id="3492689">)</span>&nbsp;<span class="op" id="3492691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492694">switch</span>&nbsp;<span class="op" id="3492701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492704">case</span>&nbsp;<span class="ident" id="3492709">b</span>&nbsp;<span class="op" id="3492711">&gt;=</span>&nbsp;<span class="string" id="3492714">&#39;0&#39;</span>&nbsp;<span class="op" id="3492718">&amp;&amp;</span>&nbsp;<span class="ident" id="3492721">b</span>&nbsp;<span class="op" id="3492723">&lt;=</span>&nbsp;<span class="string" id="3492726">&#39;9&#39;</span><span class="op" id="3492729">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492733">return</span>&nbsp;<span class="ident" id="3492740">b</span>&nbsp;<span class="op" id="3492742">-</span>&nbsp;<span class="string" id="3492744">&#39;0&#39;</span><span class="op" id="3492747">,</span>&nbsp;<span class="builtintype" id="3492749">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492754">case</span>&nbsp;<span class="ident" id="3492759">b</span>&nbsp;<span class="op" id="3492761">&gt;=</span>&nbsp;<span class="string" id="3492764">&#39;A&#39;</span>&nbsp;<span class="op" id="3492768">&amp;&amp;</span>&nbsp;<span class="ident" id="3492771">b</span>&nbsp;<span class="op" id="3492773">&lt;=</span>&nbsp;<span class="string" id="3492776">&#39;F&#39;</span><span class="op" id="3492779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492783">return</span>&nbsp;<span class="ident" id="3492790">b</span>&nbsp;<span class="op" id="3492792">-</span>&nbsp;<span class="string" id="3492794">&#39;A&#39;</span>&nbsp;<span class="op" id="3492798">+</span>&nbsp;<span class="num" id="3492800">10</span><span class="op" id="3492802">,</span>&nbsp;<span class="builtintype" id="3492804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492812">return</span>&nbsp;<span class="num" id="3492819">0</span><span class="op" id="3492820">,</span>&nbsp;<span class="ident" id="3492822">fmt</span><span class="op" id="3492825">.</span><span class="ident" id="3492826">Errorf</span><span class="op" id="3492832">(</span><span class="string" id="3492833">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3492886">,</span>&nbsp;<span class="ident" id="3492888">b</span><span class="op" id="3492889">)</span><br>
<span class="lineno">40</span><span class="op" id="3492891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3492894">func</span>&nbsp;<span class="op" id="3492899">(</span><span class="ident" id="3492900">q</span>&nbsp;<span class="op" id="3492902">*</span><span class="ident" id="3492903">qpReader</span><span class="op" id="3492911">)</span>&nbsp;<span class="ident" id="3492913">readHexByte</span><span class="op" id="3492924">(</span><span class="ident" id="3492925">v</span>&nbsp;<span class="op" id="3492927">[</span><span class="op" id="3492928">]</span><span class="builtintype" id="3492929">byte</span><span class="op" id="3492933">)</span>&nbsp;<span class="op" id="3492935">(</span><span class="ident" id="3492936">b</span>&nbsp;<span class="builtintype" id="3492938">byte</span><span class="op" id="3492942">,</span>&nbsp;<span class="ident" id="3492944">err</span>&nbsp;<span class="builtintype" id="3492948">error</span><span class="op" id="3492953">)</span>&nbsp;<span class="op" id="3492955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492958">if</span>&nbsp;<span class="builtinfunc" id="3492961">len</span><span class="op" id="3492964">(</span><span class="ident" id="3492965">v</span><span class="op" id="3492966">)</span>&nbsp;<span class="op" id="3492968">&lt;</span>&nbsp;<span class="num" id="3492970">2</span>&nbsp;<span class="op" id="3492972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492976">return</span>&nbsp;<span class="num" id="3492983">0</span><span class="op" id="3492984">,</span>&nbsp;<span class="ident" id="3492986">io</span><span class="op" id="3492988">.</span><span class="ident" id="3492989">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493010">var</span>&nbsp;<span class="ident" id="3493014">hb</span><span class="op" id="3493016">,</span>&nbsp;<span class="ident" id="3493018">lb</span>&nbsp;<span class="builtintype" id="3493021">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493027">if</span>&nbsp;<span class="ident" id="3493030">hb</span><span class="op" id="3493032">,</span>&nbsp;<span class="ident" id="3493034">err</span>&nbsp;<span class="op" id="3493038">=</span>&nbsp;<span class="ident" id="3493040">fromHex</span><span class="op" id="3493047">(</span><span class="ident" id="3493048">v</span><span class="op" id="3493049">[</span><span class="num" id="3493050">0</span><span class="op" id="3493051">]</span><span class="op" id="3493052">)</span><span class="op" id="3493053">;</span>&nbsp;<span class="ident" id="3493055">err</span>&nbsp;<span class="op" id="3493059">!=</span>&nbsp;<span class="builtintype" id="3493062">nil</span>&nbsp;<span class="op" id="3493066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493070">return</span>&nbsp;<span class="num" id="3493077">0</span><span class="op" id="3493078">,</span>&nbsp;<span class="ident" id="3493080">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493085">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493088">if</span>&nbsp;<span class="ident" id="3493091">lb</span><span class="op" id="3493093">,</span>&nbsp;<span class="ident" id="3493095">err</span>&nbsp;<span class="op" id="3493099">=</span>&nbsp;<span class="ident" id="3493101">fromHex</span><span class="op" id="3493108">(</span><span class="ident" id="3493109">v</span><span class="op" id="3493110">[</span><span class="num" id="3493111">1</span><span class="op" id="3493112">]</span><span class="op" id="3493113">)</span><span class="op" id="3493114">;</span>&nbsp;<span class="ident" id="3493116">err</span>&nbsp;<span class="op" id="3493120">!=</span>&nbsp;<span class="builtintype" id="3493123">nil</span>&nbsp;<span class="op" id="3493127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493131">return</span>&nbsp;<span class="num" id="3493138">0</span><span class="op" id="3493139">,</span>&nbsp;<span class="ident" id="3493141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493149">return</span>&nbsp;<span class="ident" id="3493156">hb</span><span class="op" id="3493158">&lt;&lt;</span><span class="num" id="3493160">4</span>&nbsp;<span class="op" id="3493162">|</span>&nbsp;<span class="ident" id="3493164">lb</span><span class="op" id="3493166">,</span>&nbsp;<span class="builtintype" id="3493168">nil</span><br>
<span class="lineno"></span><span class="op" id="3493172">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3493175">func</span>&nbsp;<span class="ident" id="3493180">isQPDiscardWhitespace</span><span class="op" id="3493201">(</span><span class="ident" id="3493202">r</span>&nbsp;<span class="builtintype" id="3493204">rune</span><span class="op" id="3493208">)</span>&nbsp;<span class="builtintype" id="3493210">bool</span>&nbsp;<span class="op" id="3493215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493218">switch</span>&nbsp;<span class="ident" id="3493225">r</span>&nbsp;<span class="op" id="3493227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493230">case</span>&nbsp;<span class="string" id="3493235">&#39;\n&#39;</span><span class="op" id="3493239">,</span>&nbsp;<span class="string" id="3493241">&#39;\r&#39;</span><span class="op" id="3493245">,</span>&nbsp;<span class="string" id="3493247">&#39;&nbsp;&#39;</span><span class="op" id="3493250">,</span>&nbsp;<span class="string" id="3493252">&#39;\t&#39;</span><span class="op" id="3493256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493260">return</span>&nbsp;<span class="builtintype" id="3493267">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493276">return</span>&nbsp;<span class="builtintype" id="3493283">false</span><br>
<span class="lineno"></span><span class="op" id="3493289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3493292">var</span>&nbsp;<span class="op" id="3493296">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493299">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493310">=</span>&nbsp;<span class="op" id="3493312">[</span><span class="op" id="3493313">]</span><span class="builtintype" id="3493314">byte</span><span class="op" id="3493318">(</span><span class="string" id="3493319">&#34;\r\n&#34;</span><span class="op" id="3493325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493328">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493339">=</span>&nbsp;<span class="op" id="3493341">[</span><span class="op" id="3493342">]</span><span class="builtintype" id="3493343">byte</span><span class="op" id="3493347">(</span><span class="string" id="3493348">&#34;\n&#34;</span><span class="op" id="3493352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493355">softSuffix</span>&nbsp;<span class="op" id="3493366">=</span>&nbsp;<span class="op" id="3493368">[</span><span class="op" id="3493369">]</span><span class="builtintype" id="3493370">byte</span><span class="op" id="3493374">(</span><span class="string" id="3493375">&#34;=&#34;</span><span class="op" id="3493378">)</span><br>
<span class="lineno"></span><span class="op" id="3493380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3493383">func</span>&nbsp;<span class="op" id="3493388">(</span><span class="ident" id="3493389">q</span>&nbsp;<span class="op" id="3493391">*</span><span class="ident" id="3493392">qpReader</span><span class="op" id="3493400">)</span>&nbsp;<span class="ident" id="3493402">Read</span><span class="op" id="3493406">(</span><span class="ident" id="3493407">p</span>&nbsp;<span class="op" id="3493409">[</span><span class="op" id="3493410">]</span><span class="builtintype" id="3493411">byte</span><span class="op" id="3493415">)</span>&nbsp;<span class="op" id="3493417">(</span><span class="ident" id="3493418">n</span>&nbsp;<span class="builtintype" id="3493420">int</span><span class="op" id="3493423">,</span>&nbsp;<span class="ident" id="3493425">err</span>&nbsp;<span class="builtintype" id="3493429">error</span><span class="op" id="3493434">)</span>&nbsp;<span class="op" id="3493436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493439">for</span>&nbsp;<span class="builtinfunc" id="3493443">len</span><span class="op" id="3493446">(</span><span class="ident" id="3493447">p</span><span class="op" id="3493448">)</span>&nbsp;<span class="op" id="3493450">&gt;</span>&nbsp;<span class="num" id="3493452">0</span>&nbsp;<span class="op" id="3493454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493458">if</span>&nbsp;<span class="builtinfunc" id="3493461">len</span><span class="op" id="3493464">(</span><span class="ident" id="3493465">q</span><span class="op" id="3493466">.</span><span class="ident" id="3493467">line</span><span class="op" id="3493471">)</span>&nbsp;<span class="op" id="3493473">==</span>&nbsp;<span class="num" id="3493476">0</span>&nbsp;<span class="op" id="3493478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493483">if</span>&nbsp;<span class="ident" id="3493486">q</span><span class="op" id="3493487">.</span><span class="ident" id="3493488">rerr</span>&nbsp;<span class="op" id="3493493">!=</span>&nbsp;<span class="builtintype" id="3493496">nil</span>&nbsp;<span class="op" id="3493500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493506">return</span>&nbsp;<span class="ident" id="3493513">n</span><span class="op" id="3493514">,</span>&nbsp;<span class="ident" id="3493516">q</span><span class="op" id="3493517">.</span><span class="ident" id="3493518">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493531">q</span><span class="op" id="3493532">.</span><span class="ident" id="3493533">line</span><span class="op" id="3493537">,</span>&nbsp;<span class="ident" id="3493539">q</span><span class="op" id="3493540">.</span><span class="ident" id="3493541">rerr</span>&nbsp;<span class="op" id="3493546">=</span>&nbsp;<span class="ident" id="3493548">q</span><span class="op" id="3493549">.</span><span class="ident" id="3493550">br</span><span class="op" id="3493552">.</span><span class="ident" id="3493553">ReadSlice</span><span class="op" id="3493562">(</span><span class="string" id="3493563">&#39;\n&#39;</span><span class="op" id="3493567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3493573">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493625">hasLF</span>&nbsp;<span class="op" id="3493631">:=</span>&nbsp;<span class="ident" id="3493634">bytes</span><span class="op" id="3493639">.</span><span class="ident" id="3493640">HasSuffix</span><span class="op" id="3493649">(</span><span class="ident" id="3493650">q</span><span class="op" id="3493651">.</span><span class="ident" id="3493652">line</span><span class="op" id="3493656">,</span>&nbsp;<span class="ident" id="3493658">lf</span><span class="op" id="3493660">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493665">hasCR</span>&nbsp;<span class="op" id="3493671">:=</span>&nbsp;<span class="ident" id="3493674">bytes</span><span class="op" id="3493679">.</span><span class="ident" id="3493680">HasSuffix</span><span class="op" id="3493689">(</span><span class="ident" id="3493690">q</span><span class="op" id="3493691">.</span><span class="ident" id="3493692">line</span><span class="op" id="3493696">,</span>&nbsp;<span class="ident" id="3493698">crlf</span><span class="op" id="3493702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493707">wholeLine</span>&nbsp;<span class="op" id="3493717">:=</span>&nbsp;<span class="ident" id="3493720">q</span><span class="op" id="3493721">.</span><span class="ident" id="3493722">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493730">q</span><span class="op" id="3493731">.</span><span class="ident" id="3493732">line</span>&nbsp;<span class="op" id="3493737">=</span>&nbsp;<span class="ident" id="3493739">bytes</span><span class="op" id="3493744">.</span><span class="ident" id="3493745">TrimRightFunc</span><span class="op" id="3493758">(</span><span class="ident" id="3493759">wholeLine</span><span class="op" id="3493768">,</span>&nbsp;<span class="ident" id="3493770">isQPDiscardWhitespace</span><span class="op" id="3493791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493796">if</span>&nbsp;<span class="ident" id="3493799">bytes</span><span class="op" id="3493804">.</span><span class="ident" id="3493805">HasSuffix</span><span class="op" id="3493814">(</span><span class="ident" id="3493815">q</span><span class="op" id="3493816">.</span><span class="ident" id="3493817">line</span><span class="op" id="3493821">,</span>&nbsp;<span class="ident" id="3493823">softSuffix</span><span class="op" id="3493833">)</span>&nbsp;<span class="op" id="3493835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493841">rightStripped</span>&nbsp;<span class="op" id="3493855">:=</span>&nbsp;<span class="ident" id="3493858">wholeLine</span><span class="op" id="3493867">[</span><span class="builtinfunc" id="3493868">len</span><span class="op" id="3493871">(</span><span class="ident" id="3493872">q</span><span class="op" id="3493873">.</span><span class="ident" id="3493874">line</span><span class="op" id="3493878">)</span><span class="op" id="3493879">:</span><span class="op" id="3493880">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493886">q</span><span class="op" id="3493887">.</span><span class="ident" id="3493888">line</span>&nbsp;<span class="op" id="3493893">=</span>&nbsp;<span class="ident" id="3493895">q</span><span class="op" id="3493896">.</span><span class="ident" id="3493897">line</span><span class="op" id="3493901">[</span><span class="op" id="3493902">:</span><span class="builtinfunc" id="3493903">len</span><span class="op" id="3493906">(</span><span class="ident" id="3493907">q</span><span class="op" id="3493908">.</span><span class="ident" id="3493909">line</span><span class="op" id="3493913">)</span><span class="op" id="3493914">-</span><span class="num" id="3493915">1</span><span class="op" id="3493916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493922">if</span>&nbsp;<span class="op" id="3493925">!</span><span class="ident" id="3493926">bytes</span><span class="op" id="3493931">.</span><span class="ident" id="3493932">HasPrefix</span><span class="op" id="3493941">(</span><span class="ident" id="3493942">rightStripped</span><span class="op" id="3493955">,</span>&nbsp;<span class="ident" id="3493957">lf</span><span class="op" id="3493959">)</span>&nbsp;<span class="op" id="3493961">&amp;&amp;</span>&nbsp;<span class="op" id="3493964">!</span><span class="ident" id="3493965">bytes</span><span class="op" id="3493970">.</span><span class="ident" id="3493971">HasPrefix</span><span class="op" id="3493980">(</span><span class="ident" id="3493981">rightStripped</span><span class="op" id="3493994">,</span>&nbsp;<span class="ident" id="3493996">crlf</span><span class="op" id="3494000">)</span>&nbsp;<span class="op" id="3494002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494009">q</span><span class="op" id="3494010">.</span><span class="ident" id="3494011">rerr</span>&nbsp;<span class="op" id="3494016">=</span>&nbsp;<span class="ident" id="3494018">fmt</span><span class="op" id="3494021">.</span><span class="ident" id="3494022">Errorf</span><span class="op" id="3494028">(</span><span class="string" id="3494029">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3494067">,</span>&nbsp;<span class="ident" id="3494069">rightStripped</span><span class="op" id="3494082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494093">}</span>&nbsp;<span class="keyword" id="3494095">else</span>&nbsp;<span class="keyword" id="3494100">if</span>&nbsp;<span class="ident" id="3494103">hasLF</span>&nbsp;<span class="op" id="3494109">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494115">if</span>&nbsp;<span class="ident" id="3494118">hasCR</span>&nbsp;<span class="op" id="3494124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494131">q</span><span class="op" id="3494132">.</span><span class="ident" id="3494133">line</span>&nbsp;<span class="op" id="3494138">=</span>&nbsp;<span class="builtinfunc" id="3494140">append</span><span class="op" id="3494146">(</span><span class="ident" id="3494147">q</span><span class="op" id="3494148">.</span><span class="ident" id="3494149">line</span><span class="op" id="3494153">,</span>&nbsp;<span class="string" id="3494155">&#39;\r&#39;</span><span class="op" id="3494159">,</span>&nbsp;<span class="string" id="3494161">&#39;\n&#39;</span><span class="op" id="3494165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494171">}</span>&nbsp;<span class="keyword" id="3494173">else</span>&nbsp;<span class="op" id="3494178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494185">q</span><span class="op" id="3494186">.</span><span class="ident" id="3494187">line</span>&nbsp;<span class="op" id="3494192">=</span>&nbsp;<span class="builtinfunc" id="3494194">append</span><span class="op" id="3494200">(</span><span class="ident" id="3494201">q</span><span class="op" id="3494202">.</span><span class="ident" id="3494203">line</span><span class="op" id="3494207">,</span>&nbsp;<span class="string" id="3494209">&#39;\n&#39;</span><span class="op" id="3494213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494219">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494229">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494244">b</span>&nbsp;<span class="op" id="3494246">:=</span>&nbsp;<span class="ident" id="3494249">q</span><span class="op" id="3494250">.</span><span class="ident" id="3494251">line</span><span class="op" id="3494255">[</span><span class="num" id="3494256">0</span><span class="op" id="3494257">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494262">switch</span>&nbsp;<span class="op" id="3494269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494273">case</span>&nbsp;<span class="ident" id="3494278">b</span>&nbsp;<span class="op" id="3494280">==</span>&nbsp;<span class="string" id="3494283">&#39;=&#39;</span><span class="op" id="3494286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494291">b</span><span class="op" id="3494292">,</span>&nbsp;<span class="ident" id="3494294">err</span>&nbsp;<span class="op" id="3494298">=</span>&nbsp;<span class="ident" id="3494300">q</span><span class="op" id="3494301">.</span><span class="ident" id="3494302">readHexByte</span><span class="op" id="3494313">(</span><span class="ident" id="3494314">q</span><span class="op" id="3494315">.</span><span class="ident" id="3494316">line</span><span class="op" id="3494320">[</span><span class="num" id="3494321">1</span><span class="op" id="3494322">:</span><span class="op" id="3494323">]</span><span class="op" id="3494324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494329">if</span>&nbsp;<span class="ident" id="3494332">err</span>&nbsp;<span class="op" id="3494336">!=</span>&nbsp;<span class="builtintype" id="3494339">nil</span>&nbsp;<span class="op" id="3494343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494349">return</span>&nbsp;<span class="ident" id="3494356">n</span><span class="op" id="3494357">,</span>&nbsp;<span class="ident" id="3494359">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494371">q</span><span class="op" id="3494372">.</span><span class="ident" id="3494373">line</span>&nbsp;<span class="op" id="3494378">=</span>&nbsp;<span class="ident" id="3494380">q</span><span class="op" id="3494381">.</span><span class="ident" id="3494382">line</span><span class="op" id="3494386">[</span><span class="num" id="3494387">2</span><span class="op" id="3494388">:</span><span class="op" id="3494389">]</span>&nbsp;<span class="comment" id="3494391">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494430">case</span>&nbsp;<span class="ident" id="3494435">b</span>&nbsp;<span class="op" id="3494437">==</span>&nbsp;<span class="string" id="3494440">&#39;\t&#39;</span>&nbsp;<span class="op" id="3494445">||</span>&nbsp;<span class="ident" id="3494448">b</span>&nbsp;<span class="op" id="3494450">==</span>&nbsp;<span class="string" id="3494453">&#39;\r&#39;</span>&nbsp;<span class="op" id="3494458">||</span>&nbsp;<span class="ident" id="3494461">b</span>&nbsp;<span class="op" id="3494463">==</span>&nbsp;<span class="string" id="3494466">&#39;\n&#39;</span><span class="op" id="3494470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494475">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494483">case</span>&nbsp;<span class="ident" id="3494488">b</span>&nbsp;<span class="op" id="3494490">&lt;</span>&nbsp;<span class="string" id="3494492">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3494496">||</span>&nbsp;<span class="ident" id="3494499">b</span>&nbsp;<span class="op" id="3494501">&gt;</span>&nbsp;<span class="string" id="3494503">&#39;~&#39;</span><span class="op" id="3494506">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494511">return</span>&nbsp;<span class="ident" id="3494518">n</span><span class="op" id="3494519">,</span>&nbsp;<span class="ident" id="3494521">fmt</span><span class="op" id="3494524">.</span><span class="ident" id="3494525">Errorf</span><span class="op" id="3494531">(</span><span class="string" id="3494532">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3494599">,</span>&nbsp;<span class="ident" id="3494601">b</span><span class="op" id="3494602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494610">p</span><span class="op" id="3494611">[</span><span class="num" id="3494612">0</span><span class="op" id="3494613">]</span>&nbsp;<span class="op" id="3494615">=</span>&nbsp;<span class="ident" id="3494617">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494621">p</span>&nbsp;<span class="op" id="3494623">=</span>&nbsp;<span class="ident" id="3494625">p</span><span class="op" id="3494626">[</span><span class="num" id="3494627">1</span><span class="op" id="3494628">:</span><span class="op" id="3494629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494633">q</span><span class="op" id="3494634">.</span><span class="ident" id="3494635">line</span>&nbsp;<span class="op" id="3494640">=</span>&nbsp;<span class="ident" id="3494642">q</span><span class="op" id="3494643">.</span><span class="ident" id="3494644">line</span><span class="op" id="3494648">[</span><span class="num" id="3494649">1</span><span class="op" id="3494650">:</span><span class="op" id="3494651">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494655">n</span><span class="op" id="3494656">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494663">return</span>&nbsp;<span class="ident" id="3494670">n</span><span class="op" id="3494671">,</span>&nbsp;<span class="builtintype" id="3494673">nil</span><br>
<span class="lineno"></span><span class="op" id="3494677">}</span>
</div>
</body>
</html>
