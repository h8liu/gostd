<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5856162">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5856218">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5856272">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5856323">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5856390">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5856449">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5856490">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="5856537">//</span><br>
<span class="lineno">10</span><span class="comment" id="5856540">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5856605">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="5856639">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="5856690">//</span><br>
<span class="lineno"></span><span class="comment" id="5856693">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="5856747">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5856776">//</span><br>
<span class="lineno"></span><span class="comment" id="5856779">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="5856845">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5856913">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="5856958">//</span><br>
<span class="lineno"></span><span class="comment" id="5856961">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5856977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="5857038">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="5857046">//</span><br>
<span class="lineno">25</span><span class="comment" id="5857049">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5857105">//</span><br>
<span class="lineno"></span><span class="comment" id="5857108">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="5857164">//</span><br>
<span class="lineno"></span><span class="comment" id="5857167">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="5857209">//</span><br>
<span class="lineno"></span><span class="comment" id="5857212">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="5857271">//</span><br>
<span class="lineno"></span><span class="comment" id="5857274">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5857323">//</span><br>
<span class="lineno">35</span><span class="comment" id="5857326">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="5857383">//</span><br>
<span class="lineno"></span><span class="comment" id="5857386">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="5857461">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="5857481">//</span><br>
<span class="lineno">40</span><span class="comment" id="5857484">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="5857532">//</span><br>
<span class="lineno"></span><span class="comment" id="5857535">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="5857596">//</span><br>
<span class="lineno"></span><span class="keyword" id="5857599">package</span>&nbsp;<span class="ident" id="5857607">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5857614">import</span>&nbsp;<span class="op" id="5857621">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857624">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857633">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857642">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857649">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857666">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857672">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857679">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857691">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857697">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857708">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857725">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857736">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857747">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="5857754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857757">func</span>&nbsp;<span class="ident" id="5857762">init</span><span class="op" id="5857766">(</span><span class="op" id="5857767">)</span>&nbsp;<span class="op" id="5857769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857772">http</span><span class="op" id="5857776">.</span><span class="ident" id="5857777">Handle</span><span class="op" id="5857783">(</span><span class="string" id="5857784">&#34;/debug/pprof/&#34;</span><span class="op" id="5857799">,</span>&nbsp;<span class="ident" id="5857801">http</span><span class="op" id="5857805">.</span><span class="ident" id="5857806">HandlerFunc</span><span class="op" id="5857817">(</span><span class="ident" id="5857818">Index</span><span class="op" id="5857823">)</span><span class="op" id="5857824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857827">http</span><span class="op" id="5857831">.</span><span class="ident" id="5857832">Handle</span><span class="op" id="5857838">(</span><span class="string" id="5857839">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="5857861">,</span>&nbsp;<span class="ident" id="5857863">http</span><span class="op" id="5857867">.</span><span class="ident" id="5857868">HandlerFunc</span><span class="op" id="5857879">(</span><span class="ident" id="5857880">Cmdline</span><span class="op" id="5857887">)</span><span class="op" id="5857888">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857891">http</span><span class="op" id="5857895">.</span><span class="ident" id="5857896">Handle</span><span class="op" id="5857902">(</span><span class="string" id="5857903">&#34;/debug/pprof/profile&#34;</span><span class="op" id="5857925">,</span>&nbsp;<span class="ident" id="5857927">http</span><span class="op" id="5857931">.</span><span class="ident" id="5857932">HandlerFunc</span><span class="op" id="5857943">(</span><span class="ident" id="5857944">Profile</span><span class="op" id="5857951">)</span><span class="op" id="5857952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857955">http</span><span class="op" id="5857959">.</span><span class="ident" id="5857960">Handle</span><span class="op" id="5857966">(</span><span class="string" id="5857967">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="5857988">,</span>&nbsp;<span class="ident" id="5857990">http</span><span class="op" id="5857994">.</span><span class="ident" id="5857995">HandlerFunc</span><span class="op" id="5858006">(</span><span class="ident" id="5858007">Symbol</span><span class="op" id="5858013">)</span><span class="op" id="5858014">)</span><br>
<span class="lineno"></span><span class="op" id="5858016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858019">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="5858066">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5858122">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="5858190">func</span>&nbsp;<span class="ident" id="5858195">Cmdline</span><span class="op" id="5858202">(</span><span class="ident" id="5858203">w</span>&nbsp;<span class="ident" id="5858205">http</span><span class="op" id="5858209">.</span><span class="ident" id="5858210">ResponseWriter</span><span class="op" id="5858224">,</span>&nbsp;<span class="ident" id="5858226">r</span>&nbsp;<span class="op" id="5858228">*</span><span class="ident" id="5858229">http</span><span class="op" id="5858233">.</span><span class="ident" id="5858234">Request</span><span class="op" id="5858241">)</span>&nbsp;<span class="op" id="5858243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858246">w</span><span class="op" id="5858247">.</span><span class="ident" id="5858248">Header</span><span class="op" id="5858254">(</span><span class="op" id="5858255">)</span><span class="op" id="5858256">.</span><span class="ident" id="5858257">Set</span><span class="op" id="5858260">(</span><span class="string" id="5858261">&#34;Content-Type&#34;</span><span class="op" id="5858275">,</span>&nbsp;<span class="string" id="5858277">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5858304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858307">fmt</span><span class="op" id="5858310">.</span><span class="ident" id="5858311">Fprintf</span><span class="op" id="5858318">(</span><span class="ident" id="5858319">w</span><span class="op" id="5858320">,</span>&nbsp;<span class="ident" id="5858322">strings</span><span class="op" id="5858329">.</span><span class="ident" id="5858330">Join</span><span class="op" id="5858334">(</span><span class="ident" id="5858335">os</span><span class="op" id="5858337">.</span><span class="ident" id="5858338">Args</span><span class="op" id="5858342">,</span>&nbsp;<span class="string" id="5858344">&#34;\x00&#34;</span><span class="op" id="5858350">)</span><span class="op" id="5858351">)</span><br>
<span class="lineno">75</span><span class="op" id="5858353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858356">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5858414">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5858482">func</span>&nbsp;<span class="ident" id="5858487">Profile</span><span class="op" id="5858494">(</span><span class="ident" id="5858495">w</span>&nbsp;<span class="ident" id="5858497">http</span><span class="op" id="5858501">.</span><span class="ident" id="5858502">ResponseWriter</span><span class="op" id="5858516">,</span>&nbsp;<span class="ident" id="5858518">r</span>&nbsp;<span class="op" id="5858520">*</span><span class="ident" id="5858521">http</span><span class="op" id="5858525">.</span><span class="ident" id="5858526">Request</span><span class="op" id="5858533">)</span>&nbsp;<span class="op" id="5858535">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858538">sec</span><span class="op" id="5858541">,</span>&nbsp;<span class="ident" id="5858543">_</span>&nbsp;<span class="op" id="5858545">:=</span>&nbsp;<span class="ident" id="5858548">strconv</span><span class="op" id="5858555">.</span><span class="ident" id="5858556">ParseInt</span><span class="op" id="5858564">(</span><span class="ident" id="5858565">r</span><span class="op" id="5858566">.</span><span class="ident" id="5858567">FormValue</span><span class="op" id="5858576">(</span><span class="string" id="5858577">&#34;seconds&#34;</span><span class="op" id="5858586">)</span><span class="op" id="5858587">,</span>&nbsp;<span class="num" id="5858589">10</span><span class="op" id="5858591">,</span>&nbsp;<span class="num" id="5858593">64</span><span class="op" id="5858595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858598">if</span>&nbsp;<span class="ident" id="5858601">sec</span>&nbsp;<span class="op" id="5858605">==</span>&nbsp;<span class="num" id="5858608">0</span>&nbsp;<span class="op" id="5858610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858614">sec</span>&nbsp;<span class="op" id="5858618">=</span>&nbsp;<span class="num" id="5858620">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858628">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858685">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858727">w</span><span class="op" id="5858728">.</span><span class="ident" id="5858729">Header</span><span class="op" id="5858735">(</span><span class="op" id="5858736">)</span><span class="op" id="5858737">.</span><span class="ident" id="5858738">Set</span><span class="op" id="5858741">(</span><span class="string" id="5858742">&#34;Content-Type&#34;</span><span class="op" id="5858756">,</span>&nbsp;<span class="string" id="5858758">&#34;application/octet-stream&#34;</span><span class="op" id="5858784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858787">if</span>&nbsp;<span class="ident" id="5858790">err</span>&nbsp;<span class="op" id="5858794">:=</span>&nbsp;<span class="ident" id="5858797">pprof</span><span class="op" id="5858802">.</span><span class="ident" id="5858803">StartCPUProfile</span><span class="op" id="5858818">(</span><span class="ident" id="5858819">w</span><span class="op" id="5858820">)</span><span class="op" id="5858821">;</span>&nbsp;<span class="ident" id="5858823">err</span>&nbsp;<span class="op" id="5858827">!=</span>&nbsp;<span class="ident" id="5858830">nil</span>&nbsp;<span class="op" id="5858834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858838">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858885">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858929">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858955">w</span><span class="op" id="5858956">.</span><span class="ident" id="5858957">Header</span><span class="op" id="5858963">(</span><span class="op" id="5858964">)</span><span class="op" id="5858965">.</span><span class="ident" id="5858966">Set</span><span class="op" id="5858969">(</span><span class="string" id="5858970">&#34;Content-Type&#34;</span><span class="op" id="5858984">,</span>&nbsp;<span class="string" id="5858986">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5859013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859017">w</span><span class="op" id="5859018">.</span><span class="ident" id="5859019">WriteHeader</span><span class="op" id="5859030">(</span><span class="ident" id="5859031">http</span><span class="op" id="5859035">.</span><span class="ident" id="5859036">StatusInternalServerError</span><span class="op" id="5859061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859065">fmt</span><span class="op" id="5859068">.</span><span class="ident" id="5859069">Fprintf</span><span class="op" id="5859076">(</span><span class="ident" id="5859077">w</span><span class="op" id="5859078">,</span>&nbsp;<span class="string" id="5859080">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="5859118">,</span>&nbsp;<span class="ident" id="5859120">err</span><span class="op" id="5859123">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859127">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859138">time</span><span class="op" id="5859142">.</span><span class="ident" id="5859143">Sleep</span><span class="op" id="5859148">(</span><span class="ident" id="5859149">time</span><span class="op" id="5859153">.</span><span class="ident" id="5859154">Duration</span><span class="op" id="5859162">(</span><span class="ident" id="5859163">sec</span><span class="op" id="5859166">)</span>&nbsp;<span class="op" id="5859168">*</span>&nbsp;<span class="ident" id="5859170">time</span><span class="op" id="5859174">.</span><span class="ident" id="5859175">Second</span><span class="op" id="5859181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859184">pprof</span><span class="op" id="5859189">.</span><span class="ident" id="5859190">StopCPUProfile</span><span class="op" id="5859204">(</span><span class="op" id="5859205">)</span><br>
<span class="lineno"></span><span class="op" id="5859207">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5859210">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="5859273">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5859344">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5859411">func</span>&nbsp;<span class="ident" id="5859416">Symbol</span><span class="op" id="5859422">(</span><span class="ident" id="5859423">w</span>&nbsp;<span class="ident" id="5859425">http</span><span class="op" id="5859429">.</span><span class="ident" id="5859430">ResponseWriter</span><span class="op" id="5859444">,</span>&nbsp;<span class="ident" id="5859446">r</span>&nbsp;<span class="op" id="5859448">*</span><span class="ident" id="5859449">http</span><span class="op" id="5859453">.</span><span class="ident" id="5859454">Request</span><span class="op" id="5859461">)</span>&nbsp;<span class="op" id="5859463">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859466">w</span><span class="op" id="5859467">.</span><span class="ident" id="5859468">Header</span><span class="op" id="5859474">(</span><span class="op" id="5859475">)</span><span class="op" id="5859476">.</span><span class="ident" id="5859477">Set</span><span class="op" id="5859480">(</span><span class="string" id="5859481">&#34;Content-Type&#34;</span><span class="op" id="5859495">,</span>&nbsp;<span class="string" id="5859497">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5859524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859528">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859575">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859624">var</span>&nbsp;<span class="ident" id="5859628">buf</span>&nbsp;<span class="ident" id="5859632">bytes</span><span class="op" id="5859637">.</span><span class="ident" id="5859638">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859647">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859698">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859756">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859808">fmt</span><span class="op" id="5859811">.</span><span class="ident" id="5859812">Fprintf</span><span class="op" id="5859819">(</span><span class="op" id="5859820">&amp;</span><span class="ident" id="5859821">buf</span><span class="op" id="5859824">,</span>&nbsp;<span class="string" id="5859826">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="5859844">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859848">var</span>&nbsp;<span class="ident" id="5859852">b</span>&nbsp;<span class="op" id="5859854">*</span><span class="ident" id="5859855">bufio</span><span class="op" id="5859860">.</span><span class="ident" id="5859861">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859869">if</span>&nbsp;<span class="ident" id="5859872">r</span><span class="op" id="5859873">.</span><span class="ident" id="5859874">Method</span>&nbsp;<span class="op" id="5859881">==</span>&nbsp;<span class="string" id="5859884">&#34;POST&#34;</span>&nbsp;<span class="op" id="5859891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859895">b</span>&nbsp;<span class="op" id="5859897">=</span>&nbsp;<span class="ident" id="5859899">bufio</span><span class="op" id="5859904">.</span><span class="ident" id="5859905">NewReader</span><span class="op" id="5859914">(</span><span class="ident" id="5859915">r</span><span class="op" id="5859916">.</span><span class="ident" id="5859917">Body</span><span class="op" id="5859921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859924">}</span>&nbsp;<span class="keyword" id="5859926">else</span>&nbsp;<span class="op" id="5859931">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859935">b</span>&nbsp;<span class="op" id="5859937">=</span>&nbsp;<span class="ident" id="5859939">bufio</span><span class="op" id="5859944">.</span><span class="ident" id="5859945">NewReader</span><span class="op" id="5859954">(</span><span class="ident" id="5859955">strings</span><span class="op" id="5859962">.</span><span class="ident" id="5859963">NewReader</span><span class="op" id="5859972">(</span><span class="ident" id="5859973">r</span><span class="op" id="5859974">.</span><span class="ident" id="5859975">URL</span><span class="op" id="5859978">.</span><span class="ident" id="5859979">RawQuery</span><span class="op" id="5859987">)</span><span class="op" id="5859988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859995">for</span>&nbsp;<span class="op" id="5859999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860003">word</span><span class="op" id="5860007">,</span>&nbsp;<span class="ident" id="5860009">err</span>&nbsp;<span class="op" id="5860013">:=</span>&nbsp;<span class="ident" id="5860016">b</span><span class="op" id="5860017">.</span><span class="ident" id="5860018">ReadSlice</span><span class="op" id="5860027">(</span><span class="string" id="5860028">&#39;+&#39;</span><span class="op" id="5860031">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860035">if</span>&nbsp;<span class="ident" id="5860038">err</span>&nbsp;<span class="op" id="5860042">==</span>&nbsp;<span class="ident" id="5860045">nil</span>&nbsp;<span class="op" id="5860049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860054">word</span>&nbsp;<span class="op" id="5860059">=</span>&nbsp;<span class="ident" id="5860061">word</span><span class="op" id="5860065">[</span><span class="num" id="5860066">0</span>&nbsp;<span class="op" id="5860068">:</span>&nbsp;<span class="builtinfunc" id="5860070">len</span><span class="op" id="5860073">(</span><span class="ident" id="5860074">word</span><span class="op" id="5860078">)</span><span class="op" id="5860079">-</span><span class="num" id="5860080">1</span><span class="op" id="5860081">]</span>&nbsp;<span class="comment" id="5860083">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860099">pc</span><span class="op" id="5860101">,</span>&nbsp;<span class="ident" id="5860103">_</span>&nbsp;<span class="op" id="5860105">:=</span>&nbsp;<span class="ident" id="5860108">strconv</span><span class="op" id="5860115">.</span><span class="ident" id="5860116">ParseUint</span><span class="op" id="5860125">(</span><span class="builtintype" id="5860126">string</span><span class="op" id="5860132">(</span><span class="ident" id="5860133">word</span><span class="op" id="5860137">)</span><span class="op" id="5860138">,</span>&nbsp;<span class="num" id="5860140">0</span><span class="op" id="5860141">,</span>&nbsp;<span class="num" id="5860143">64</span><span class="op" id="5860145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860149">if</span>&nbsp;<span class="ident" id="5860152">pc</span>&nbsp;<span class="op" id="5860155">!=</span>&nbsp;<span class="num" id="5860158">0</span>&nbsp;<span class="op" id="5860160">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860165">f</span>&nbsp;<span class="op" id="5860167">:=</span>&nbsp;<span class="ident" id="5860170">runtime</span><span class="op" id="5860177">.</span><span class="ident" id="5860178">FuncForPC</span><span class="op" id="5860187">(</span><span class="builtintype" id="5860188">uintptr</span><span class="op" id="5860195">(</span><span class="ident" id="5860196">pc</span><span class="op" id="5860198">)</span><span class="op" id="5860199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860204">if</span>&nbsp;<span class="ident" id="5860207">f</span>&nbsp;<span class="op" id="5860209">!=</span>&nbsp;<span class="ident" id="5860212">nil</span>&nbsp;<span class="op" id="5860216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860222">fmt</span><span class="op" id="5860225">.</span><span class="ident" id="5860226">Fprintf</span><span class="op" id="5860233">(</span><span class="op" id="5860234">&amp;</span><span class="ident" id="5860235">buf</span><span class="op" id="5860238">,</span>&nbsp;<span class="string" id="5860240">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="5860250">,</span>&nbsp;<span class="ident" id="5860252">pc</span><span class="op" id="5860254">,</span>&nbsp;<span class="ident" id="5860256">f</span><span class="op" id="5860257">.</span><span class="ident" id="5860258">Name</span><span class="op" id="5860262">(</span><span class="op" id="5860263">)</span><span class="op" id="5860264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860273">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860278">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860326">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860384">if</span>&nbsp;<span class="ident" id="5860387">err</span>&nbsp;<span class="op" id="5860391">!=</span>&nbsp;<span class="ident" id="5860394">nil</span>&nbsp;<span class="op" id="5860398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860403">if</span>&nbsp;<span class="ident" id="5860406">err</span>&nbsp;<span class="op" id="5860410">!=</span>&nbsp;<span class="ident" id="5860413">io</span><span class="op" id="5860415">.</span><span class="ident" id="5860416">EOF</span>&nbsp;<span class="op" id="5860420">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860426">fmt</span><span class="op" id="5860429">.</span><span class="ident" id="5860430">Fprintf</span><span class="op" id="5860437">(</span><span class="op" id="5860438">&amp;</span><span class="ident" id="5860439">buf</span><span class="op" id="5860442">,</span>&nbsp;<span class="string" id="5860444">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="5860467">,</span>&nbsp;<span class="ident" id="5860469">err</span><span class="op" id="5860472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860493">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860497">w</span><span class="op" id="5860498">.</span><span class="ident" id="5860499">Write</span><span class="op" id="5860504">(</span><span class="ident" id="5860505">buf</span><span class="op" id="5860508">.</span><span class="ident" id="5860509">Bytes</span><span class="op" id="5860514">(</span><span class="op" id="5860515">)</span><span class="op" id="5860516">)</span><br>
<span class="lineno"></span><span class="op" id="5860518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860521">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="5860587">func</span>&nbsp;<span class="ident" id="5860592">Handler</span><span class="op" id="5860599">(</span><span class="ident" id="5860600">name</span>&nbsp;<span class="builtintype" id="5860605">string</span><span class="op" id="5860611">)</span>&nbsp;<span class="ident" id="5860613">http</span><span class="op" id="5860617">.</span><span class="ident" id="5860618">Handler</span>&nbsp;<span class="op" id="5860626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860629">return</span>&nbsp;<span class="ident" id="5860636">handler</span><span class="op" id="5860643">(</span><span class="ident" id="5860644">name</span><span class="op" id="5860648">)</span><br>
<span class="lineno"></span><span class="op" id="5860650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5860653">type</span>&nbsp;<span class="ident" id="5860658">handler</span>&nbsp;<span class="builtintype" id="5860666">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5860674">func</span>&nbsp;<span class="op" id="5860679">(</span><span class="ident" id="5860680">name</span>&nbsp;<span class="ident" id="5860685">handler</span><span class="op" id="5860692">)</span>&nbsp;<span class="ident" id="5860694">ServeHTTP</span><span class="op" id="5860703">(</span><span class="ident" id="5860704">w</span>&nbsp;<span class="ident" id="5860706">http</span><span class="op" id="5860710">.</span><span class="ident" id="5860711">ResponseWriter</span><span class="op" id="5860725">,</span>&nbsp;<span class="ident" id="5860727">r</span>&nbsp;<span class="op" id="5860729">*</span><span class="ident" id="5860730">http</span><span class="op" id="5860734">.</span><span class="ident" id="5860735">Request</span><span class="op" id="5860742">)</span>&nbsp;<span class="op" id="5860744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860747">w</span><span class="op" id="5860748">.</span><span class="ident" id="5860749">Header</span><span class="op" id="5860755">(</span><span class="op" id="5860756">)</span><span class="op" id="5860757">.</span><span class="ident" id="5860758">Set</span><span class="op" id="5860761">(</span><span class="string" id="5860762">&#34;Content-Type&#34;</span><span class="op" id="5860776">,</span>&nbsp;<span class="string" id="5860778">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5860805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860808">debug</span><span class="op" id="5860813">,</span>&nbsp;<span class="ident" id="5860815">_</span>&nbsp;<span class="op" id="5860817">:=</span>&nbsp;<span class="ident" id="5860820">strconv</span><span class="op" id="5860827">.</span><span class="ident" id="5860828">Atoi</span><span class="op" id="5860832">(</span><span class="ident" id="5860833">r</span><span class="op" id="5860834">.</span><span class="ident" id="5860835">FormValue</span><span class="op" id="5860844">(</span><span class="string" id="5860845">&#34;debug&#34;</span><span class="op" id="5860852">)</span><span class="op" id="5860853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860856">p</span>&nbsp;<span class="op" id="5860858">:=</span>&nbsp;<span class="ident" id="5860861">pprof</span><span class="op" id="5860866">.</span><span class="ident" id="5860867">Lookup</span><span class="op" id="5860873">(</span><span class="builtintype" id="5860874">string</span><span class="op" id="5860880">(</span><span class="ident" id="5860881">name</span><span class="op" id="5860885">)</span><span class="op" id="5860886">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860889">if</span>&nbsp;<span class="ident" id="5860892">p</span>&nbsp;<span class="op" id="5860894">==</span>&nbsp;<span class="ident" id="5860897">nil</span>&nbsp;<span class="op" id="5860901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860905">w</span><span class="op" id="5860906">.</span><span class="ident" id="5860907">WriteHeader</span><span class="op" id="5860918">(</span><span class="num" id="5860919">404</span><span class="op" id="5860922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860926">fmt</span><span class="op" id="5860929">.</span><span class="ident" id="5860930">Fprintf</span><span class="op" id="5860937">(</span><span class="ident" id="5860938">w</span><span class="op" id="5860939">,</span>&nbsp;<span class="string" id="5860941">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="5860964">,</span>&nbsp;<span class="ident" id="5860966">name</span><span class="op" id="5860970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860974">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860982">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860985">gc</span><span class="op" id="5860987">,</span>&nbsp;<span class="ident" id="5860989">_</span>&nbsp;<span class="op" id="5860991">:=</span>&nbsp;<span class="ident" id="5860994">strconv</span><span class="op" id="5861001">.</span><span class="ident" id="5861002">Atoi</span><span class="op" id="5861006">(</span><span class="ident" id="5861007">r</span><span class="op" id="5861008">.</span><span class="ident" id="5861009">FormValue</span><span class="op" id="5861018">(</span><span class="string" id="5861019">&#34;gc&#34;</span><span class="op" id="5861023">)</span><span class="op" id="5861024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861027">if</span>&nbsp;<span class="ident" id="5861030">name</span>&nbsp;<span class="op" id="5861035">==</span>&nbsp;<span class="string" id="5861038">&#34;heap&#34;</span>&nbsp;<span class="op" id="5861045">&amp;&amp;</span>&nbsp;<span class="ident" id="5861048">gc</span>&nbsp;<span class="op" id="5861051">&gt;</span>&nbsp;<span class="num" id="5861053">0</span>&nbsp;<span class="op" id="5861055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861059">runtime</span><span class="op" id="5861066">.</span><span class="ident" id="5861067">GC</span><span class="op" id="5861069">(</span><span class="op" id="5861070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861076">p</span><span class="op" id="5861077">.</span><span class="ident" id="5861078">WriteTo</span><span class="op" id="5861085">(</span><span class="ident" id="5861086">w</span><span class="op" id="5861087">,</span>&nbsp;<span class="ident" id="5861089">debug</span><span class="op" id="5861094">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861097">return</span><br>
<span class="lineno"></span><span class="op" id="5861104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5861107">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5861180">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="5861243">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="5861312">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5861347">func</span>&nbsp;<span class="ident" id="5861352">Index</span><span class="op" id="5861357">(</span><span class="ident" id="5861358">w</span>&nbsp;<span class="ident" id="5861360">http</span><span class="op" id="5861364">.</span><span class="ident" id="5861365">ResponseWriter</span><span class="op" id="5861379">,</span>&nbsp;<span class="ident" id="5861381">r</span>&nbsp;<span class="op" id="5861383">*</span><span class="ident" id="5861384">http</span><span class="op" id="5861388">.</span><span class="ident" id="5861389">Request</span><span class="op" id="5861396">)</span>&nbsp;<span class="op" id="5861398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861401">if</span>&nbsp;<span class="ident" id="5861404">strings</span><span class="op" id="5861411">.</span><span class="ident" id="5861412">HasPrefix</span><span class="op" id="5861421">(</span><span class="ident" id="5861422">r</span><span class="op" id="5861423">.</span><span class="ident" id="5861424">URL</span><span class="op" id="5861427">.</span><span class="ident" id="5861428">Path</span><span class="op" id="5861432">,</span>&nbsp;<span class="string" id="5861434">&#34;/debug/pprof/&#34;</span><span class="op" id="5861449">)</span>&nbsp;<span class="op" id="5861451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861455">name</span>&nbsp;<span class="op" id="5861460">:=</span>&nbsp;<span class="ident" id="5861463">strings</span><span class="op" id="5861470">.</span><span class="ident" id="5861471">TrimPrefix</span><span class="op" id="5861481">(</span><span class="ident" id="5861482">r</span><span class="op" id="5861483">.</span><span class="ident" id="5861484">URL</span><span class="op" id="5861487">.</span><span class="ident" id="5861488">Path</span><span class="op" id="5861492">,</span>&nbsp;<span class="string" id="5861494">&#34;/debug/pprof/&#34;</span><span class="op" id="5861509">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861513">if</span>&nbsp;<span class="ident" id="5861516">name</span>&nbsp;<span class="op" id="5861521">!=</span>&nbsp;<span class="string" id="5861524">&#34;&#34;</span>&nbsp;<span class="op" id="5861527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861532">handler</span><span class="op" id="5861539">(</span><span class="ident" id="5861540">name</span><span class="op" id="5861544">)</span><span class="op" id="5861545">.</span><span class="ident" id="5861546">ServeHTTP</span><span class="op" id="5861555">(</span><span class="ident" id="5861556">w</span><span class="op" id="5861557">,</span>&nbsp;<span class="ident" id="5861559">r</span><span class="op" id="5861560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861565">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861577">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861581">profiles</span>&nbsp;<span class="op" id="5861590">:=</span>&nbsp;<span class="ident" id="5861593">pprof</span><span class="op" id="5861598">.</span><span class="ident" id="5861599">Profiles</span><span class="op" id="5861607">(</span><span class="op" id="5861608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861611">if</span>&nbsp;<span class="ident" id="5861614">err</span>&nbsp;<span class="op" id="5861618">:=</span>&nbsp;<span class="ident" id="5861621">indexTmpl</span><span class="op" id="5861630">.</span><span class="ident" id="5861631">Execute</span><span class="op" id="5861638">(</span><span class="ident" id="5861639">w</span><span class="op" id="5861640">,</span>&nbsp;<span class="ident" id="5861642">profiles</span><span class="op" id="5861650">)</span><span class="op" id="5861651">;</span>&nbsp;<span class="ident" id="5861653">err</span>&nbsp;<span class="op" id="5861657">!=</span>&nbsp;<span class="ident" id="5861660">nil</span>&nbsp;<span class="op" id="5861664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861668">log</span><span class="op" id="5861671">.</span><span class="ident" id="5861672">Print</span><span class="op" id="5861677">(</span><span class="ident" id="5861678">err</span><span class="op" id="5861681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861684">}</span><br>
<span class="lineno">190</span><span class="op" id="5861686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5861689">var</span>&nbsp;<span class="ident" id="5861693">indexTmpl</span>&nbsp;<span class="op" id="5861703">=</span>&nbsp;<span class="ident" id="5861705">template</span><span class="op" id="5861713">.</span><span class="ident" id="5861714">Must</span><span class="op" id="5861718">(</span><span class="ident" id="5861719">template</span><span class="op" id="5861727">.</span><span class="ident" id="5861728">New</span><span class="op" id="5861731">(</span><span class="string" id="5861732">&#34;index&#34;</span><span class="op" id="5861739">)</span><span class="op" id="5861740">.</span><span class="ident" id="5861741">Parse</span><span class="op" id="5861746">(</span><span class="string" id="5861747">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="5862066">)</span><span class="op" id="5862067">)</span>
</div>
</body>
</html>
